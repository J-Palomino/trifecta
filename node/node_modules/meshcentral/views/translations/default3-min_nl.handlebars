<!doctypehtml><html lang=nl dir=ltr xmlns=http://www.w3.org/1999/xhtml><meta http-equiv=X-UA-Compatible content="IE=edge"><meta http-equiv=Content-Type content="text/html;charset=utf-8"><meta name=viewport content="user-scalable=1,initial-scale=1,minimum-scale=1,maximum-scale=1"><meta name=apple-mobile-web-app-capable content=yes><meta name=format-detection content="telephone=no"><meta name=robots content=noindex,nofollow><link rel=manifest href={{{domainurl}}}manifest.json><link type=image/x-icon href={{{domainurl}}}favicon.ico rel="shortcut icon"><link keeplink=1 type=text/css href=styles/style-bootstrap.css media=screen rel=stylesheet title=CSS><link type=text/css href=styles/ol.css media=screen rel=stylesheet title=CSS><link type=text/css href=styles/ol3-contextmenu.min.css media=screen rel=stylesheet title=CSS><link type=text/css href=styles/xterm.css media=screen rel=stylesheet title=CSS><link type=text/css href=styles/flatpickr.min.css media=screen rel=stylesheet title=CSS><link id=theme-stylesheet href=styles/bootstrap{{{min}}}.css rel=stylesheet title=CSS><link href=styles/sweetalert2.min.css rel=stylesheet title=CSS><link href=styles/select2.min.css rel=stylesheet title=CSS><link href=styles/select2-bootstrap-5-theme.min.css rel=stylesheet title=CSS><link rel=apple-touch-icon href=/favicon-303x303.png><script src=scripts/common-0.0.1{{{min}}}.js></script><script src=scripts/meshcentral{{{min}}}.js></script><script src=scripts/amt-0.2.0{{{min}}}.js></script><script src=scripts/amt-wsman-0.2.0{{{min}}}.js></script><script src=scripts/amt-desktop-0.0.2{{{min}}}.js></script><script src=scripts/amt-terminal-0.0.2{{{min}}}.js></script><script src=scripts/zlib{{{min}}}.js></script><script src=scripts/zlib-inflate{{{min}}}.js></script><script src=scripts/zlib-adler32{{{min}}}.js></script><script src=scripts/zlib-crc32{{{min}}}.js></script><script src=scripts/amt-redir-ws-0.1.0{{{min}}}.js></script><script src=scripts/amt-wsman-ws-0.2.0{{{min}}}.js></script><script src=scripts/agent-redir-ws-0.1.1{{{min}}}.js></script><script src=scripts/agent-redir-rtc-0.1.0{{{min}}}.js></script><script src=scripts/agent-desktop-0.0.2{{{min}}}.js></script><script src=scripts/agent-rdp-0.0.1{{{min}}}.js></script><script src=scripts/qrcode.min.js></script><script src=scripts/xterm{{{min}}}.js></script><script src=scripts/xterm-addon-fit{{{min}}}.js></script><script src=scripts/flatpickr.js></script><script src=mstsc/mstsc.js></script><script src=mstsc/keyboard.js></script><script src=mstsc/rle.js></script><script src=mstsc/client.js></script><script src=mstsc/canvas.js></script><script src=scripts/jquery{{{min}}}.js></script><script src=scripts/bootstrap{{{min}}}.js></script><script src=scripts/fontawesome/all.min.js></script><script src=scripts/sweetalert2.all.min.js></script><script src=scripts/select2.full.min.js></script><script src=scripts/themes/theme-switcher.js></script><script keeplink=1 src=scripts/u2f-api{{{min}}}.js></script><script keeplink=1 src=scripts/charts{{{min}}}.js></script><script keeplink=1 src=scripts/moment{{min}}.js></script><script keeplink=1 src=scripts/chartjs-adapter-moment{{{min}}}.js></script><script keeplink=1 src=scripts/filesaver.min.js></script><script keeplink=1 src=scripts/ol{{{min}}}.js></script><script keeplink=1 src=scripts/ol3-contextmenu{{{min}}}.js></script><script keeplink=1 src=scripts/purify{{{min}}}.js></script><script keeplink=1 src=scripts/marked{{{min}}}.js></script><title>{{{title}}}</title><body id=body oncontextmenu=handleContextMenu(event) style=display:none;min-width:495px onload='"undefined"!=typeof startup&&startup()'><div id=contextMenu class="contextMenu noselect"style=display:none><div id=cxinfo class=cmtext onclick=cmaction(1,event)><b>Informatie</b></div><div id=cxdesktop class=cmtext onclick=cmaction(3,event)>Bureaublad</div><div id=cxterminal class=cmtext onclick=cmaction(2,event)>Terminal</div><div id=cxfiles class=cmtext onclick=cmaction(4,event)>Bestanden</div><div id=cxevents class=cmtext onclick=cmaction(5,event)>Gebeurtenissen</div><div id=cxdetails class=cmtext onclick=cmaction(6,event)>Details</div><div id=cxconsole class=cmtext onclick=cmaction(7,event)>Console</div><div id=cxwebrdp class=cmtext onclick=cmaction(11,event)>Web-RDP</div><div id=cxwebvnc class=cmtext onclick=cmaction(12,event)>Web-VNC</div><div id=cxwebssh class=cmtext onclick=cmaction(13,event)>Web-SSH</div><div id=cxrdp class=cmtext onclick=cmaction(14,event)>RDP</div><div id=cxplugins class=cmtext onclick=cmaction(8,event) style=display:none>Plugins</div><hr id=cxmgroupsplit><div id=cxstar class=cmtext onclick=cmaction(10,event) style=display:none>(De)Markeren</div><div id=cxmdesktop class=cmtext onclick=cmaction(9,event) style=display:none>Multi Desktop</div></div><div id=meshContextMenu class="contextMenu noselect"style=display:none;min-width:0><div id=cxselectall class=cmtext onclick=cmmeshaction(1,event)>Selecteer alles</div><div id=cxselectnone class=cmtext onclick=cmmeshaction(2,event)>Selecteer niets</div></div><div id=altPortContextMenu class="contextMenu noselect"style=display:none;min-width:0><div class=cmtext onclick=cmaltportaction(1,event)>Alternatieve poort</div></div><div id=sshPortContextMenu class="contextMenu noselect"style=display:none;min-width:0><div class=cmtext onclick=cmsshportaction(1,event)>Alternatieve poort</div></div><div id=rfbPortContextMenu class="contextMenu noselect"style=display:none;min-width:0><div class=cmtext onclick=cmrfbportaction(1,event)>Alternatieve poort</div></div><div id=httpPortContextMenu class="contextMenu noselect"style=display:none;min-width:0><div class=cmtext onclick=cmhttpportaction(1,event)>Alternatieve poort</div></div><div id=httpsPortContextMenu class="contextMenu noselect"style=display:none;min-width:0><div class=cmtext onclick=cmhttpsportaction(1,event)>Alternatieve poort</div></div><div id=filesContextMenu class="contextMenu noselect"style=display:none;min-width:0><div class=cmtext onclick=cmfilesaction(1,event)>Hernoemen</div><div class=cmtext onclick=cmfilesaction(2,event)>Bewerk</div><div class=cmtext onclick=cmfilesaction(3,event)>Verwijderen</div></div><div id=expandAllContextMenu class="contextMenu noselect"style=display:none;min-width:0><div class=cmtext onclick=cmexpandaction(1,event)>Alles uitvouwen</div><div class=cmtext onclick=cmexpandaction(2,event)>Alles inklappen</div></div><div id=deskPlayerContextMenu class="contextMenu noselect"style=display:none;min-width:0><div class=cmtext onclick=cmdeskplayeraction(1,event)>Open speler...</div></div><div id=deskKeyShortcutContextMenu class="contextMenu noselect"style=display:none;min-width:0><div class=cmtext onclick=cmdeskshortcutaction(1,event)>Aanpassen...</div></div><div id=deskPreConfigShortcutContextMenu class="contextMenu noselect"style="display:none;min-width:0;max-height:calc(80% - 50px);overflow-y:auto"><span id=deskPreConfigShortcutContextMenu1></span> <span id=deskPreConfigShortcutContextMenu2></span><div class=cmtext onclick=cmdeskpreconfigtypeaction(-1,event)>Aanpassen...</div></div><div id=deskPreConfigScriptContextMenu class="contextMenu noselect"style="display:none;min-width:0;max-height:calc(80% - 50px);overflow-y:auto"><span id=deskPreConfigScriptContextMenu1></span> <span id=deskPreConfigScriptContextMenu2></span></div><div id=container><div id=notifiyBox class=notifiyBox style=display:none></div><div id=masthead class=noselect><div style=float:left>{{{titlehtml}}}</div><div class=title onclick=go(1,event)>{{{title1}}}</div><div class=title2>{{{title2}}}</div><div style=float:right><div id=notificationCount onclick=clickNotificationIcon() class=unselectable style=display:none title="Klik om de huidige meldingen te bekijken">0</div></div><p id=logoutControl><span id=logoutControlSpan class=logoncontrolspan></span><span id=idleTimeoutNotify style=color:#ff0></span></p><img id=topMenuIcon class=noselect style=position:absolute;right:0;top:10px;color:#c8c8c8;font-size:44px;margin-right:8px;cursor:pointer;display:none onclick=topMenu() src=/images/3bars-30.png width=30 height=30><div class=textnewui id=textnewui onmouseup=toggleBootstrapUIMode() onkeypress='"Enter"==event.key&&toggleBootstrapUIMode()'><b>Try the new MeshCentral UI</b></div></div><div class="sidebar flex-column"id=page_leftbar><div style=height:24px></div><nav class="nav flex-column"><a class="nav-link active text-center text-white lbbuttonsel"id=LeftMenuMyDevices href=# data-target=general onmouseup=go(1,event) onkeypress='"Enter"==event.key&&go(1)'><i class="fa-solid fa-computer me-2"></i></a> <a class="nav-link text-center text-white"id=LeftMenuMyAccount href=# data-target=account onmouseup=go(2,event) onkeypress='"Enter"==event.key&&go(2)'><i class="fa-solid fa-user-gear me-2"></i></a> <a class="nav-link text-center text-white"id=LeftMenuMyEvents href=# data-target=events onmouseup=go(3,event) onkeypress='"Enter"==event.key&&go(3)'><i class="fa-solid fa-calendar-alt me-2"></i></a> <a class="nav-link text-center text-white"id=LeftMenuMyFiles href=# data-target=files onmouseup=go(5,event) onkeypress='"Enter"==event.key&&go(5)'><i class="fa-solid fa-folder-open me-2"></i></a> <a class="nav-link text-center text-white"id=LeftMenuMyUsers href=# data-target=users onmouseup=go(4,event) onkeypress='"Enter"==event.key&&go(4)'><i class="fa-solid fa-users me-2"></i></a> <a class="nav-link text-center text-white"id=LeftMenuMyServer href=# data-target=server onmouseup=go(6,event) onkeypress='"Enter"==event.key&&go(6)'><i class="fa-solid fa-server me-2"></i></a></nav></div><div id=topbar class=noselect><div><div style=position:relative><span id=logoutControlSpan2></span><div tabindex=0 id=uiMenuButton title="Wissel gebruikersinterface"onclick=showUserInterfaceSelectMenu() onkeypress='"Enter"==event.key&&showUserInterfaceSelectMenu()'>♦<div id=uiMenu style=display:none><table><tr><td><div tabindex=0 id=uiViewButton1 class=uiSelector onclick=userInterfaceSelectMenu(1) title="Linkerbalk interface"onkeypress='"Enter"==event.key&&userInterfaceSelectMenu(1)'><div class=uiSelector1></div></div><div tabindex=0 id=uiViewButton2 class=uiSelector onclick=userInterfaceSelectMenu(2) title="Boven werkbalk interface"onkeypress='"Enter"==event.key&&userInterfaceSelectMenu(2)'><div class=uiSelector2></div></div><div tabindex=0 id=uiViewButton3 class=uiSelector onclick=userInterfaceSelectMenu(3) title="Interface met vaste breedte"onkeypress='"Enter"==event.key&&userInterfaceSelectMenu(3)'><div class=uiSelector3></div></div><div tabindex=0 id=uiViewButton7 class=uiSelector onclick=toggleBootstrapUIMode() title="Toggle Modern UI"onkeypress='"Enter"==event.key&&toggleBootstrapUIMode()'><div class=uiSelector7></div></div><td><div tabindex=0 id=uiViewButton6 class=uiSelector onclick=showNotes(!1) title="Persoonlijke notities"onkeypress='"Enter"==event.key&&showNotes(!1)'><div class=uiSelector6></div></div><div tabindex=0 id=uiViewButton4 class=uiSelector onclick=toggleNightMode() title="Wissel dag/nachtmodus"onkeypress='"Enter"==event.key&&toggleNightMode()'><div class=uiSelector4></div></div><div tabindex=0 id=uiViewButton5 class=uiSelector onclick=toggleFooterBarMode() title="Schakel de voettekstbalk in"onkeypress='"Enter"==event.key&&toggleFooterBarMode()'><div class=uiSelector5></div></div><div class=uiSelector_end>&nbsp;</div></table></div></div><table id=MainMenuSpan cellpadding=0 cellspacing=0 class=style1><tr><td tabindex=0 id=MainMenuMyDevices class="topbar_td style3x"onmouseup=go(1,event) onkeypress='"Enter"==event.key&&go(1)'>Mijn apparaten<td tabindex=0 id=MainMenuMyAccount class="topbar_td style3x"onmouseup=go(2,event) onkeypress='"Enter"==event.key&&go(2)'>Mijn Account<td tabindex=0 id=MainMenuMyEvents class="topbar_td style3x"onmouseup=go(3,event) onkeypress='"Enter"==event.key&&go(3)'>Mijn gebeurtenissen<td tabindex=0 id=MainMenuMyFiles class="topbar_td style3x"onmouseup=go(5,event) onkeypress='"Enter"==event.key&&go(5)'>Mijn bestanden<td tabindex=0 id=MainMenuMyUsers class="topbar_td style3x"onmouseup=go(4,event) onkeypress='"Enter"==event.key&&go(4)'>Mijn gebruikers<td tabindex=0 id=MainMenuMyServer class="topbar_td style3x"onmouseup=go(6,event) onkeypress='"Enter"==event.key&&go(6)'>Mijn server<td class="topbar_td_end style3">&nbsp;</table><div id=MainSubMenuSpan style=display:none><table id=MainSubMenu cellpadding=0 cellspacing=0 class=style1><tr><td tabindex=0 id=MainDev class="topbar_td style3x"onmouseup=go(10,event) onkeypress='"Enter"==event.key&&go(10)'>Algemeen<td tabindex=0 id=MainDevDesktop class="topbar_td style3x"onmouseup=go(11,event) onkeypress='"Enter"==event.key&&go(11)'>Bureaublad<td tabindex=0 id=MainDevTerminal class="topbar_td style3x"onmouseup=go(12,event) onkeypress='"Enter"==event.key&&go(12)'>Terminal<td tabindex=0 id=MainDevFiles class="topbar_td style3x"onmouseup=go(13,event) onkeypress='"Enter"==event.key&&go(13)'>Bestanden<td tabindex=0 id=MainDevEvents class="topbar_td style3x"onmouseup=go(16,event) onkeypress='"Enter"==event.key&&go(16)'>Gebeurtenissen<td tabindex=0 id=MainDevInfo class="topbar_td style3x"onmouseup=go(17,event) onkeypress='"Enter"==event.key&&go(17)'>Details<td tabindex=0 id=MainDevAmt class="topbar_td style3x"onmouseup=go(14,event) onkeypress='"Enter"==event.key&&go(14)'>Intel®AMT<td tabindex=0 id=MainDevConsole class="topbar_td style3x"onmouseup=go(15,event) onkeypress='"Enter"==event.key&&go(15)'>Console<td tabindex=0 id=MainDevPlugins class="topbar_td style3x"onmouseup=go(19,event) onkeypress='"Enter"==event.key&&go(19)'>Plugins<td class="topbar_td_end style3">&nbsp;</table></div><div id=MeshSubMenuSpan style=display:none><table id=MeshSubMenu cellpadding=0 cellspacing=0 class=style1><tr><td tabindex=0 id=MeshGeneral class="topbar_td style3x"onmouseup=go(20,event) onkeypress='"Enter"==event.key&&go(20)'>Algemeen<td tabindex=0 id=MeshSummary class="topbar_td style3x"onmouseup=go(21,event) onkeypress='"Enter"==event.key&&go(21)'>Samenvatting<td class="topbar_td_end style3">&nbsp;</table></div><div id=EventsSubMenuSpan style=display:none><div id=EventsSubMenu class=style1><div class="row d-flex"><div class="col flex-grow-0 flex-shrink-0"><div tabindex=0 id=EventsLive class="topbar_td style3x"onmouseup=go(3,event) onkeypress='"Enter"==event.key&&go(3)'>Gebeurtenissen</div></div><div class="col flex-grow-0 flex-shrink-0"><div tabindex=0 id=EventsReport class="topbar_td style3x"onmouseup=go(60,event) onkeypress='"Enter"==event.key&&go(60)'>Rapport</div></div><div class="col flex-grow-0 flex-shrink-0"><div class=style3>&nbsp;</div></div></div></div></div><div id=UserSubMenuSpan style=display:none><table id=UserSubMenu cellpadding=0 cellspacing=0 class=style1><tr><td tabindex=0 id=UserGeneral class="topbar_td style3x"onmouseup=go(30,event) onkeypress='"Enter"==event.key&&go(30)'>Algemeen<td tabindex=0 id=UserEvents class="topbar_td style3x"onmouseup=go(31,event) onkeypress='"Enter"==event.key&&go(31)'>Gebeurtenissen<td class="topbar_td_end style3">&nbsp;</table></div><div id=UsersSubMenuSpan style=display:none><table id=UsersSubMenu cellpadding=0 cellspacing=0 class=style1><tr><td tabindex=0 id=UsersGeneral class="topbar_td style3x"onmouseup=go(4,event) onkeypress='"Enter"==event.key&&go(4)'>Gebruikers<td tabindex=0 id=UsersGroups class="topbar_td style3x"onmouseup=go(50,event) onkeypress='"Enter"==event.key&&go(50)'>Groepen<td tabindex=0 id=UsersRecordings class="topbar_td style3x"onmouseup=go(52,event) onkeypress='"Enter"==event.key&&go(52)'>Opnames<td class="topbar_td_end style3">&nbsp;</table></div><div id=ServerSubMenuSpan style=display:none><table id=ServerSubMenu cellpadding=0 cellspacing=0 class=style1><tr><td tabindex=0 id=ServerGeneral class="topbar_td style3x"onmouseup=go(6,event) onkeypress='"Enter"==event.key&&go(6)'>Algemeen<td tabindex=0 id=ServerStats class="topbar_td style3x"onmouseup=go(40,event) onkeypress='"Enter"==event.key&&go(40)'>Statistieken<td tabindex=0 id=ServerConsole class="topbar_td style3x"onmouseup=go(115,event) onkeypress='"Enter"==event.key&&go(115)'>Console<td tabindex=0 id=ServerTrace class="topbar_td style3x"onmouseup=go(41,event) onkeypress='"Enter"==event.key&&go(41)'>Traceer<td tabindex=0 id=ServerPlugins class="topbar_td style3x"onmouseup=go(42,event) onkeypress='"Enter"==event.key&&go(42)'>Plugins<td class="topbar_td_end style3">&nbsp;</table></div><div id=UserDummyMenuSpan><table id=UserDummyMenu cellpadding=0 cellspacing=0 class=style1><tr><td class=style3>&nbsp;</table></div></div></div></div><div id=column_l class=pt-3><div id=p0 style=display:none><div id=p0message><span id=p0span>Serververbinding verbroken</span>,<href onclick=reload() style=cursor:pointer><u>klik hier om opnieuw verbinding te maken</u></href>.</div></div><div id=p1 style=display:none><div id=p1title class="d-flex justify-content-between align-items-center"><div><h1>Mijn apparaten</h1></div><div style=display:none id=devListToolbarViewIcons><div id=devViewPageState style=float:left;line-height:32px;height:32px;font-size:16px;display:none></div><div tabindex=0 id=devViewPageButton1 class=viewSelector onclick=onDeviceViewPageChange(1) onkeypress='"Enter"==event.key&&onDeviceViewPageChange(1)'title="Ga naar de eerste pagina"style=display:none><div class=viewSelector9></div></div><div tabindex=0 id=devViewPageButton2 class=viewSelector onclick=onDeviceViewPageChange(2) onkeypress='"Enter"==event.key&&onDeviceViewPageChange(2)'title="Ga naar de vorige pagina"style=display:none><div class=viewSelector10></div></div><div tabindex=0 id=devViewPageButton3 class=viewSelector onclick=onDeviceViewPageChange(3) onkeypress='"Enter"==event.key&&onDeviceViewPageChange(3)'title="Ga naar de volgende pagina"style=display:none><div class=viewSelector11></div></div><div tabindex=0 id=devViewPageButton4 class=viewSelector onclick=onDeviceViewPageChange(4) onkeypress='"Enter"==event.key&&onDeviceViewPageChange(4)'title="Ga naar de laatste pagina  "style=display:none;margin-right:12px><div class=viewSelector8></div></div><span role=button tabindex=0 id=devViewButton1 class="fa-layers fa-fw fa-xl"onclick=onDeviceViewChange(1) onkeypress='"Enter"==event.key&&onDeviceViewChange(1)'title=kolommen><i class="fa-solid fa-bars"data-fa-transform="shrink-8 right-4 up-2"></i> <i class="fa-solid fa-bars"data-fa-transform="shrink-8 left-4 up-2"></i> <i class="fa-solid fa-bars"data-fa-transform="shrink-8 right-4 down-3"></i> <i class="fa-solid fa-bars"data-fa-transform="shrink-8 left-4 down-3"></i> </span><span role=button tabindex=0 id=devViewButton2 class="fa-layers fa-fw fa-xl"onclick=onDeviceViewChange(2) onkeypress='"Enter"==event.key&&onDeviceViewChange(2)'title=Lijst><i class="fa-solid fa-bars"></i> </span><span role=button tabindex=0 id=devViewButton3 class="fa-layers fa-fw fa-xl"onclick=onDeviceViewChange(3) onkeypress='"Enter"==event.key&&onDeviceViewChange(3)'title=Bureaubladen><i class="fa-solid fa-square"data-fa-transform="shrink-9 up-4 left-4"></i> <i class="fa-solid fa-square"data-fa-transform="shrink-9 up-4 right-4"></i> <i class="fa-solid fa-square"data-fa-transform="shrink-9 down-4 left-4"></i> <i class="fa-solid fa-square"data-fa-transform="shrink-9 down-4 right-4"></i> </span><span role=button tabindex=0 id=devViewButton5 class="fa-layers fa-fw fa-xl"onclick=onDeviceViewChange(5) onkeypress='"Enter"==event.key&&onDeviceViewChange(5)'title=Bureaubladen><i class="fa-solid fa-square"data-fa-transform="shrink-10 up-4 left-6"></i> <i class="fa-solid fa-square"data-fa-transform="shrink-10 up-4 right-1"></i> <i class="fa-solid fa-square"data-fa-transform="shrink-10 up-4 right-5"></i> <i class="fa-solid fa-square"data-fa-transform="shrink-10 down-4 left-1"></i> <i class="fa-solid fa-square"data-fa-transform="shrink-10 down-4 left-5"></i> <i class="fa-solid fa-square"data-fa-transform="shrink-10 down-4 right-6"></i> </span><span role=button tabindex=0 id=devViewButton4 class="fa-layers fa-fw fa-xl"onclick=onDeviceViewChange(4) onkeypress='"Enter"==event.key&&onDeviceViewChange(4)'title=Kaart style=display:none><i class="fa-solid fa-map-location-dot"></i></span></div></div><div id=devListToolbarSpan class="noselect d-flex align-items-center p-1"><div id=devListToolbar class="d-flex align-items-center visually-hidden"><span class="fa-layers fa-fw me-1"role=button style=display:none title="Alles inklappen"id=CollapseAllButton onclick=cmexpandaction(2)><i class="fa-solid fa-chevron-up"data-fa-transform=down-6></i> <i class="fa-solid fa-chevron-down"data-fa-transform=up-6></i> </span><span class="fa-layers fa-fw me-1"role=button style=display:none title="Alles uitvouwen"id=ExpandAllButton onclick=cmexpandaction(1)><i class="fa-solid fa-chevron-up"data-fa-transform=up-6></i> <i class="fa-solid fa-chevron-down"data-fa-transform=down-6></i> </span><input type=button class="btn btn-primary me-1 btn-sm"id=SelectAllButton onclick=selectallButtonFunction() value="Selecteer alles"> <input type=button class="btn btn-primary me-1 btn-sm"id=GroupActionButton disabled value=Groepsactie onclick=groupActionFunction()> <input type=button class="btn btn-primary me-1 btn-sm"id=ScrollToTopButton onclick=onDevicesScroll(!0) value="Scroll naar boven"> <input id=SearchInput class="form-control-sm me-1 btn-sm"placeholder=Filter onchange=onDeviceSearchChanged(event) onclick=onDeviceSearchChanged(event) onkeyup=onDeviceSearchChanged(event) onfocus=onSearchFocus(1) onblur=onSearchFocus(0) title="Filter: user:xxx or u:xxx ip:xxx group:xxx or g:xxx tag:xxx or t: xxx atag:xxx or a:xxx os:xxx amt:xxx desc:xxx wsc:ok wsc:noav wsc:noupdate wsc:nofirewall wsc:any"> <span id=SearchInputClearButton style=display:none;position:relative><span class="fa-layers fa-fw"role=button onclick=clearDeviceSearch() style=position:absolute;left:-25px;top:-15px><i class="fa-solid fa-circle"style=color:var(--bs-secondary-bg)></i> <i class="fa-solid fa-xmark"style=color:var(--bs-body-color)></i> </span></span><select class="form-select-sm me-1"id=DevFilterSelect onchange=onOnlineCheckBox(event) title="Apparaat filter"><option value=0 selected>Alles<option value=1>Online<option value=5>Offline<option value=2>Sessies<option value=3>Gemarkeerd<option value=4>Intel® AMT<option value=6>Help<option value=7>Getagd<option value=8>Niet getagd</select><div class=form-check title="Toon apparaatnaam besturingssysteem "><input class="form-check-input me-1"type=checkbox id=RealNameCheckBox onclick=onRealNameCheckBox()><label class=form-check-label for=RealNameCheckBox>Besturingssysteem naam</label></div><label style=display:none><input type=checkbox id=OnlineCheckBox class="form-check-input me-2"onclick=onOnlineCheckBox(event)><span title="Toon alleen apparaten die online zijn">Online</span></label> <span id=devsCustomUIBar></span></div><div id=kvmListToolbar class="d-flex align-items-center style14 visually-hidden"><span class="fa-layers fa-fw me-1"role=button style=display:none title="Alles inklappen"id=CollapseAllButton2 onclick=cmexpandaction(2)><i class="fa-solid fa-chevron-up"data-fa-transform=down-6></i> <i class="fa-solid fa-chevron-down"data-fa-transform=up-6></i> </span><span class="fa-layers fa-fw me-1"role=button style=display:none title="Alles uitvouwen"id=ExpandAllButton2 onclick=cmexpandaction(1)><i class="fa-solid fa-chevron-up"data-fa-transform=up-6></i> <i class="fa-solid fa-chevron-down"data-fa-transform=down-6></i> </span><input type=button class="btn btn-primary me-1 btn-sm"onclick=connectAllKvmFunction() value="Alles verbinden"> <input type=button class="btn btn-primary me-1 btn-sm"onclick=disconnectAllKvmFunction() value="Verbreek alles"> <input type=button class="btn btn-primary me-1 btn-sm"onclick=onDevicesScroll(!0) value="Scroll naar boven"><div class="form-check me-1"title="Automatisch verbinden"><input class="form-check-input me-1"type=checkbox id=autoConnectDesktopCheckbox onclick=autoConnectDesktops(event)><label class=form-check-label for=autoConnectDesktopCheckbox>Automatisch</label></div><input type=button class="btn btn-primary me-1 btn-sm"onclick=showMultiDesktopSettings() value=Instellingen> <input id=KvmSearchInput class="form-control-sm me-1"placeholder=Filter onchange=onDeviceSearchChanged(event) onclick=onDeviceSearchChanged(event) onkeyup=onDeviceSearchChanged(event) onfocus=onSearchFocus(1) onblur=onSearchFocus(0) title="Filter: user:xxx or u:xxx ip:xxx group:xxx or g:xxx tag:xxx or t: xxx atag:xxx or a:xxx os:xxx amt:xxx desc:xxx wsc:ok wsc:noav wsc:noupdate wsc:nofirewall wsc:any"> <span id=KvmSearchInputClearButton style=display:none;position:relative><span class="fa-layers fa-fw"role=button onclick=clearDeviceSearch() style=position:absolute;left:-25px;top:-15px><i class="fa-solid fa-circle"style=color:var(--bs-secondary-bg)></i> <i class="fa-solid fa-xmark"style=color:var(--bs-body-color)></i></span></span></div><div id=devMapToolbar class="d-flex align-items-center style14 visually-hidden"><input class="form-control-sm me-1"type=search id=mapSearchLocation placeholder="Zoek locatie"onfocus=onMapSearchFocus(1) onblur=onMapSearchFocus(0)> <input class="btn btn-primary me-1 btn-sm"type=button value=Zoeken title="Zoeken naar locatie"onclick=getSearchLocation()> <input class="btn btn-primary me-1 btn-sm"type=button id=refreshmap title="Reset kaartweergave"value=Herstarten onclick=refreshMap(!1,!0)></div><div class="d-flex align-items-center ms-auto"><div style=display:none id=devListToolbarView>Kijken <select id=viewselect onchange=onDeviceViewChange()><option value=1>kolommen<option value=2>Lijst<option value=3>Desktops met vaste breedte<option id=viewselectmapoption value=4 style=display:none>Kaart<option value=5>Bureaubladen</select></div><div style=display:none id=devListToolbarSize>Grootte <select id=sizeselect class="form-select-sm me-2"onchange=onDeviceViewChange()><option value=0>Klein<option value=1>Gemiddeld<option value=2>Grote</select> &nbsp;</div><div style=display:none id=devListToolbarSort>Sorteer <select id=sortselect class="form-select-sm me-2"onchange=mainUpdate(6)><option>Groep<option>Power<option>Apparaat<option>Tags<option>Groepstags<option>Laatst gezien</select> &nbsp;</div><i class="fa-solid fa-gear"role=button id=devListToolbarSettings onclick=onDeviceViewSettings()></i></div></div><div id=NoMeshesPanel style=display:none><table><tr><td valign=top style=width:50px><img src=images/info.png loading=lazy width=47 height=48><td><div id=getStarted1>Om meteen aan de slag te gaan, <a href=# onclick="return account_createMesh()"><strong>klik hier om een apparaatgroep te maken</strong></a>.</div><div id=getStarted2>Geen apparaatgroepen.</div></table></div><div id=xdevices class=noselect style=display:none onscroll=onDevicesScroll(!1)></div><div id=xdevicesmap style=display:none><div id=xmapSearchResultsDlg style=display:none><div id=xmapSearchResultsBck><div id=xmapSearchClose onclick=mapCloseSearchWindow()><b>X</b></div><div style=padding:5px>Locatie resultaten</div><div style=width:100%;margin:6px></div></div><div id=xmapSearchResults style=margin:6px></div></div></div><div id=xmap-info-window></div></div><div id=p2 style=display:none><div id=p2title><h1>Mijn Account</h1></div><div id=p2info style=overflow-y:auto><div id=p2AccountImageFrame><img id=p2AccountImage alt=""loading=lazy width=128 height=128 onclick=account_manageImage(0) src=images/user-256.png><div><a href=# onclick=account_manageImage(0)>Wijzig afbeelding</a></div></div><div id=p2AccountSecurity style=display:none><p><strong>Gebruikersaccount beveiliging</strong><div style=margin-left:25px><div id=managePhoneNumber1><div class=p2AccountActions><span id=authPhoneNumberCheck><strong>✓</strong></span></div><span><a href=# onclick="return account_managePhone()">Beheer telefoonnummer</a><br></span></div><div id=manageEmail2FA><div class=p2AccountActions><span id=authEmailSetupCheck><strong>✓</strong></span></div><span><a href=# onclick="return account_manageAuthEmail()">Beheer e-mailverificatie</a><br></span></div><div id=manageAuthApp><div class=p2AccountActions><span id=authAppSetupCheck><strong>✓</strong></span></div><span><a href=# onclick="return account_manageAuthApp()">Beheer authenticator-app</a><br></span></div><div id=manageDuoApp><div class=p2AccountActions><span id=authDuoSetupCheck><strong>✓</strong></span></div><span><a href=# onclick="return account_manageAuthDuo()">Manage Duo authentication</a><br></span></div><div id=manageHardwareOtp><div class=p2AccountActions><span id=authKeySetupCheck><strong>✓</strong></span></div><span><a href=# onclick="return account_manageHardwareOtp(0)">Beheer beveiligingssleutels</a><br></span></div><div id=managePushAuthDev><div class=p2AccountActions><span id=authPushAuthDevCheck><strong>✓</strong></span></div><span><a href=# onclick="return account_managePushAuthDev()">Beheer push-authenticatie</a><br></span></div><div id=manageMessaging1><div class=p2AccountActions><span id=authMessagingCheck><strong>✓</strong></span></div><span><a href=# onclick="return account_manageMessaging()">Beheer berichtenservice</a><br></span></div><div id=manageOtp><div class=p2AccountActions><span id=authCodesSetupCheck><strong>✓</strong></span></div><span><a href=# onclick="return account_manageOtp(0)">Beheer back-up codes</a><br></span></div><div class=p2AccountActions></div><span><a href=# onclick="return account_viewPreviousLogins()">Bekijk eerdere aanmeldingen</a><br></span></div></div><div id=p2AccountActions><p><strong>Gebruikersacties</strong><p class=mL><span id=managePhoneNumber2 style=display:none><a href=# onclick="return account_managePhone()">Beheer telefoonnummer</a><br></span><span id=manageMessaging2 style=display:none><a href=# onclick="return account_manageMessaging()">Beheer berichtenservice</a><br></span><span id=verifyEmailId style=display:none><a href=# onclick="return account_showVerifyEmail()">Verifieer Email</a><br></span><span id=accountEnableNotificationsSpan style=display:none><a href=# onclick="return account_enableNotifications()">Schakel webmeldingen in</a><br></span><a href=# onclick="return account_showLocalizationSettings()">Lokalisatie instellingen</a><br><a href=# onclick="return account_showAccountNotifySettings()">Meldingsinstellingen</a><br><span id=p2AccountPassActions><span id=accountChangeEmailAddressSpan style=display:none><a href=# onclick="return account_showChangeEmail()">Verander e-mailadres</a><br></span><a href=# onclick="return account_showChangePassword()">Verander wachtwoord</a><span id=p2nextPasswordUpdateTime></span><br><a href=# onclick="return account_showDeleteAccount()">Verwijder account</a><br></span><span id=accountCreateLoginTokenSpan style=display:none><a href=# onclick="return account_createLoginToken()">Maak een login-token aan</a><br></span><a href=# onclick="return account_showThemesSwitcher()">Switch theme</a><br></p><br style=clear:both></div><div id=p2logintokens></div><strong>Apparaatgroepen</strong> <span id=p2createMeshLink1>- <button class="btn btn-primary btn-sm"onclick="return account_createMesh()"><i class="fa-fw fa-solid fa-circle-plus"></i> Nieuw</button></span><br><br><div id=p2meshes></div><div id=p2noMeshFound style=display:none>Geen apparaatgroepen.<span id=p2createMeshLink2> <a href=# onclick="return account_createMesh()"><strong>Begin hier!</strong></a></span></div><br style=clear:both></div></div><div id=p3 style=display:none><div id=p3title><h1>Mijn gebeurtenissen</h1></div><table class=pTable><tr><td class="auto-style1 d-flex justify-content-end p-1"><div class="d-flex align-items-center"><label for=p3filterevents class=me-1>Filter</label> <select id=p3filterevents class="form-select-sm me-2"onchange=refreshEvents()><option notransval=1 value="">Alle Logboeken<option notransval=1 value=agentlog>Agent Logboeken<option notransval=1 value=relaylog>Relay Logboeken<option notransval=1 value=manual>Handmatige logboeken<option notransval=1 value=runcommands>Voer opdracht logboeken uit<option notransval=1 value=batchupload>Batch Upload Logboeken<option notransval=1 value=changenode>Wijzig Node Logboeken<option notransval=1 value=removenode>Verwijder node Logboeken</select> <label for=p3limitdropdown class=me-1>Tonen</label> <select id=p3limitdropdown class="form-select-sm me-2"onchange=refreshEvents()><option notransval=1 value=60>Laatste 60<option notransval=1 value=120>Laatste 120<option notransval=1 value=250>Laatste 250<option notransval=1 value=500>Laatste 500<option notransval=1 value=1000>Laatste 1000<option notransval=1 value="">Geen limiet</select> <a href=# onclick=p3showDownloadEventsDialog(2)><i class="fa-solid fa-download"title="Download gebeurtenissen"></i></a></div></table><div id=p3events></div></div><div id=p4 style=display:none><div id=p4title><h1>Mijn gebruikers</h1></div><table class=pTable><tr><td class="style14 d-flex align-items-center flex-wrap p-1"><div class="d-flex align-items-center"><input type=button id=UsersSelectAllButton class="btn btn-primary btn-sm me-1"onclick=p3usersSelectallButtonFunction() value="Selecteer alles"> <input type=button id=UsersGroupActionButton class="btn btn-primary btn-sm me-1"disabled value=Groepsactie onclick=p3usersGroupActionFunction()> <input id=UserNewAccountButton class="btn btn-primary btn-sm me-1"type=button onclick=showCreateNewAccountDialog() value="Nieuw account..."><div class="d-inline-flex align-items-center"><input id=UserSearchInput type=search class="form-control-sm me-1"placeholder=Filter onchange=onUserSearchInputChanged() onkeyup=onUserSearchInputChanged() autocomplete=off onfocus=onUserSearchFocus(1) onblur=onUserSearchFocus(0)></div></div><div class="d-flex align-items-center ms-auto"><input type=button class="btn btn-primary btn-sm me-2"onclick=showUserBroadcastDialog() style=margin-right:6px value="Bericht verzending"> <a href=# onclick=p4downloadUserInfo()><i role=button class="fa-solid fa-download me-2"title="Download gebruikers informatie"></i></a> <a href=# onclick=p4batchAccountCreate()><i role=button id=p4UserBatchCreate style=display:none title="Gebruikersaccounts aanmaken in batch"class="fa-solid fa-upload me-1"></i></a> <i style=cursor:pointer;margin-top:3px;margin-left:6px id=usersListToolbarSettings class="fa-solid fa-cog"title=Instellingen onclick=onUsersViewSettings()></i></div></table><div id=p3users></div></div><div id=p5 style=display:none><div id=p5title><h1>Mijn bestanden</h1></div><table id=p5toolbar class=table cellpadding=0 cellspacing=0><tr><td id=p5filehead valign=bottom class="d-flex align-items-center"><div id=p5rightOfButtons class="d-flex align-items-center"></div><div class="m-1 d-flex align-items-center"><input type=button id=p5FolderUp class="btn btn-primary btn-sm me-1"disabled onclick="return p5folderup()"value=Omhoog> <input type=button id=p5SelectAllButton class="btn btn-primary btn-sm me-1"disabled onclick=p5selectallfile() value="Selecteer alles"> <input type=button id=p5RenameFileButton class="btn btn-primary btn-sm me-1"disabled value=Hernoemen onclick=p5renamefile()> <input type=button id=p5DeleteFileButton class="btn btn-primary btn-sm me-1"disabled value=Verwijderen onclick=p5deletefile()> <input type=button id=p5ViewFileButton class="btn btn-primary btn-sm me-1"disabled value=Bewerk onclick=p5viewfile()> <input type=button id=p5NewFolderButton class="btn btn-primary btn-sm me-1"disabled value="Nieuwe map"onclick=p5createfolder()> <input type=button id=p5UploadButton class="btn btn-primary btn-sm me-1"disabled value=Uploaden onclick=p5uploadFile()> <input type=button id=p5DownloadButton class="btn btn-primary btn-sm me-1"disabled value=Download onclick=p5downloadButton()> <input type=button id=p5CutButton class="btn btn-primary btn-sm me-1"disabled value=Knippen onclick=p5copyFile(1)> <input type=button id=p5CopyButton class="btn btn-primary btn-sm me-1"disabled value=Kopiëren onclick=p5copyFile(0)> <input type=button id=p5PasteButton class="btn btn-primary btn-sm me-1"disabled value=Plakken onclick=p5pasteFile()></div><tr><td id=p5filesubhead class="d-flex align-items-center"><div class="d-flex align-items-center">&nbsp;&nbsp;<span id=p5currentpath></span></div><div style=float:right class="d-flex align-items-center ms-auto"><select id=p5sortdropdown class="form-select-sm me-1"onchange=updateFiles()><option value=1 selected>Sorteren op naam<option value=2>Sorteren op grootte<option value=3>Sorteren op datum<option value=4>Aflopend op naam<option value=5>Aflopend op grootte<option value=6>Aflopend op datum</select></div></table><div id=p5filetable><div id=p5PublicShare><div>Deze bestanden worden openbaar gedeeld, klik op "link" om de openbare URL te krijgen.</div></div><div id=bigok style=display:none><b>✓</b></div><div id=bigfail style=display:none><b>✗</b></div><span id=p5files></span></div><table id=p5toolbarBottom class="table table-hover"style=width:100% cellpadding=0 cellspacing=0><tr><td class=style6>&nbsp;<span id=p5bottomstatus></span></table></div><div id=p6 style=display:none><div id=p6info style=overflow-y:auto><div id=p6title><img id=MainMeshImage src=serverpic.ashx><h1>Mijn server</h1></div><div id=p2ServerActions><p><strong>Server acties</strong><div style=margin-left:25px><div id=p2ServerActionsBackup><div class=p2AccountActions><span style=display:none><strong>✓</strong></span></div><a id=p6backuplink href={{{domainurl}}}backup.zip rel="noreferrer noopener"target=_blank>Download server back-up</a></div><div id=p2ServerActionsRestore><div class=p2AccountActions><span style=display:none><strong>✓</strong></span></div><a href=# onclick="return server_showRestoreDlg()">Herstel server met back-up</a></div><div id=p2ServerActionsGoogleBackup style=display:none><div class=p2AccountActions><span id=p2ServerActionsGoogleBackupCheck style=display:none><strong>✓</strong></span></div><span><a href=# onclick="return server_setupGoogleDriveBackup()">Google Drive backup</a><br></span></div><div id=p2ServerActionsVersion><div class=p2AccountActions><span style=display:none><strong>✓</strong></span></div><a href=# onclick="return server_showVersionDlg()">Controleer server versie</a></div><div id=p2ServerActionsErrors><div class=p2AccountActions><span style=display:none><strong>✓</strong></span></div><a href=# onclick="return server_showErrorsDlg()">Serverlogboek weergeven</a></div><div id=p2ServerActionsConfig><div class=p2AccountActions><span style=display:none><strong>✓</strong></span></div><a href=# onclick="return server_showConfigDlg()">Serverconfiguratie weergeven</a></div></div><br></div><strong>Serverstatistieken</strong><br><br><div id=serverStats><div id=serverCpuChartView style=display:none><div class=chartViewCanvas style=height:40px;text-align:center><canvas id=serverCpuChart style=display:inline-block></canvas></div><div class=chartViewText id=serverCpuChartText></div></div><div id=serverMemoryChartView style=display:none><div class=chartViewCanvas style=height:40px;text-align:center><canvas id=serverMemoryChart style=display:inline-block></canvas></div><div class=chartViewText id=serverMemoryChartText></div></div><br><br><div id=serverStatsTable></div></div><div id=serverWarningsDiv style=display:none><br><strong>Serverwaarschuwingen</strong><br><br><div id=serverCertWarnings></div><div id=serverWarnings></div></div></div></div><div id=p10 style=display:none><div id=p10title class="d-flex align-items-center"><div id=p10BackButton class=pe-2><i class="fa-solid fa-square-caret-left fa-2xl"role=button tabindex=0 onclick=goBack() title=Terug onkeypress='"Enter"==event.key&&goBack()'></i></div><div class="fs-4 fw-bold">Algemeen - <span id=p10deviceName></span></div></div><div id=p10info style=overflow-y:auto class=pt-3><table style=width:100% cellpadding=0 cellspacing=0><tr><td style=width:auto valign=top><div id=p10html></div><td style=width:100px;display:none id=notesPanel valign=top><table><thead><tr><th>Notities<tbody><tr><td><div id=notesPanelArea style=width:300px;height:200px;resize:none;overflow-y:scroll></div></table><td style=width:20px><td style=width:200px;vertical-align:top;position:relative valign=top><div class=deviceNotifyLargeDot><div id=p10deviceMsg onclick=showDeviceMessages(null,null,event) class=deviceNotifyDotSub></div><i title=Gemarkeerd role=button class="fa-solid fa-star"id=p10deviceStar onclick=showDeviceSessions(null,null,event) data-fa-transform=shrink-5 data-fa-mask="fa-solid fa-circle"></i> <i title="Lijst met externe sessies die actief zijn op deze computer."role=button class="fa-solid fa-arrow-right-arrow-left"id=p10deviceNotify onclick=showDeviceSessions(null,null,event) data-fa-transform=shrink-5 data-fa-mask="fa-solid fa-circle"></i> <i title="Hulp gevraagd"role=button class="fa-solid fa-question"id=p10deviceHelp onclick=showDeviceHelpRequests(null,null,event) data-fa-transform=shrink-5 data-fa-mask="fa-solid fa-circle"></i></div><div id=p10deviceBattery class="deviceBatteryLarge deviceBatteryLarge1"></div><a href=# onclick=p10showiconselector()><img id=MainComputerImage></a><div id=MainComputerState></div></table><br><div id=p10html2></div><div id=p10html3></div><div id=p10html4></div><div id=p10html5></div></div></div><div id=p11 class=noselect style=display:none><div id=p11title class="d-flex align-items-center"><div id=p11BackButton class=pe-2><i class="fa-solid fa-2xl fa-square-caret-left"role=button tabindex=0 onclick=goBack() title=Terug onkeypress='"Enter"==event.key&&goBack()'></i></div><div class="fs-4 fw-bold">Bureaublad - <span id=p11deviceName></span></div><div id=devListToolbarViewIcons class=ms-auto><i class="fa-solid fa-xl fa-maximize fa-border"role=button onclick=deskToggleFull(event) title="Volledig scherm. Houd shift ingedrukt om de browser op volledig scherm weer te geven."></i></div></div><div id=p11warning onclick=showFeaturesDlg()><div class=icon2></div><div class=warningbox>Omleidingspoort of KVM functie is uitgeschakeld<span id=p11warninga>, klik hier om in te schakelen</span></div></div><div id=p11warning2 onclick=showPowerActionDlg()><div class=icon2></div><div class=warningbox>Externe computer is niet ingeschakeld, klik hier om een stroomopdracht uit te voeren.</div></div><div style=position:absolute;right:16px;margin-top:-14px;font-size:x-small;color:#000><div id=p11capslock style=display:inline-block;margin-left:1px;border-radius:5px;background-color:#a3ffb8;padding:2px>CAPS</div><div id=p11scrolllock style=display:inline-block;margin-left:1px;border-radius:5px;background-color:#a3ffb8;padding:2px>SCROLL</div><div id=p11numlock style=display:inline-block;margin-left:1px;border-radius:5px;background-color:#a3ffb8;padding:2px>NUM</div></div><div id=deskarea0 cellpadding=0 cellspacing=0><div id=deskarea1 class="areaHead d-flex flex-wrap"><div class="d-flex align-items-center"><input type=button class="btn btn-primary btn-sm me-1"id=autoconnectbutton1 value="Automatisch verbinden"onclick=autoConnectDesktop(event) onkeypress=return!1 onkeydown=return!1 style=display:none;margin-right:4px><div class="btn-group dropdown-center me-1"id=connectbutton1span><button type=button class="btn btn btn-primary btn-sm"id=connectbutton1 title="Verbinding maken via MeshAgent extern bureaublad"onclick=connectDesktop(event,3) onkeypress=return!1 onkeydown=return!1 disabled>Verbinden</button> <button type=button class="btn btn-primary btn-sm dropdown-toggle dropdown-toggle-split"id=connectbutton1d data-bs-toggle=dropdown aria-expanded=false><span class=visually-hidden>Toggle Dropdown</span></button><ul class=dropdown-menu><li><a class=dropdown-item onclick=cmdeskaction(1,event)>Vraag toestemming + informatiebalk</a><li><a class=dropdown-item onclick=cmdeskaction(2,event)>Vraag toestemming</a><li><a class=dropdown-item onclick=cmdeskaction(3,event)>Privacy balk</a></ul></div><div class="btn-group dropdown-center me-1"id=connectbutton1rspan><button type=button class="btn btn btn-primary btn-sm"id=connectbutton1r title="Verbinding maken via RDP"onclick=askRdpCredentials() onkeypress=return!1 onkeydown=return!1 disabled>RDP verbinden</button> <button type=button class="btn btn-primary btn-sm dropdown-toggle dropdown-toggle-split"id=connectbutton1rd data-bs-toggle=dropdown aria-expanded=false><span class=visually-hidden>Toggle Dropdown</span></button><ul class=dropdown-menu><li><a class=dropdown-item onclick=cmaltportaction(1,event)>Alternatieve poort</a></ul></div><span id=connectbutton1hspan><button class="btn btn-primary btn-sm me-1"type=button id=connectbutton1h title="Verbinding maken via hardware KVM"onclick=connectDesktop(event,2) onkeypress=return!1 onkeydown=return!1 disabled>HW verbinden</button></span><div class="btn-group dropdown-center me-1"id=disconnectbutton1span><button type=button class="btn btn btn-primary btn-sm"id=disconnectbutton1 title="Verbinding maken via MeshAgent extern bureaublad"onclick=connectDesktop(event,0) onkeypress=return!1 onkeydown=return!1>Verbreken</button> <button type=button class="btn btn-primary btn-sm dropdown-toggle dropdown-toggle-split"id=diconnectbutton1d data-bs-toggle=dropdown aria-expanded=false><span class=visually-hidden>Toggle Dropdown</span></button><ul class=dropdown-menu><li><a class=dropdown-item onclick=cmdeskaction(10,event)>Verbreken en vergrendelen</a><li><a class=dropdown-item onclick=cmdeskaction(11,event)>Verbreken</a></ul></div><span id=deskstatus style=line-height:22px>Verbroken</span><span id=deskmetadata></span></div><div class="d-flex align-items-center ms-auto"><div id=desktopCustomUiButtons style=float:left></div><div id=desktopCustomUpperRight style=float:left;margin-right:6px></div><input type=button class="btn btn-primary btn-sm"title="Wijzig de stroomstatus van het externe apparaat"onkeypress=return!1 onkeydown=return!1 value="Power Actie's..."onclick=showPowerActionDlg() style=display:none> <input id=deskActionsBtn type=button class="btn btn-primary btn-sm me-1"title="Voer power acties uit op het apparaat"onkeypress=return!1 onkeydown=return!1 value=Acties onclick=deviceActionFunction()> <input id=deskActionsSettings type=button class="btn btn-primary btn-sm me-1"value=Instellingen title="Bewerk externe bureaubladinstellingen"onkeypress=return!1 onkeydown=return!1 onclick=showDesktopSettings()> <input id=deskFocusBtn type=button title="Schakel focusmodus in, indien actief wordt alleen het gebied rond de muis bijgewerkt"onkeypress=return!1 onkeydown=return!1 value="Focus alles"onclick=deskToggleFocus() style=margin-right:3px;display:none><div id=deskRecordIcon class=deskareaicon title="Server neemt deze sessie op"style=display:none;background-color:red;width:12px;height:12px;border-radius:6px;margin-top:5px></div><div class=deskareaicon title="Draai naar rechts"onclick=drotate(1)><i class="fa-solid fa-rotate-right"></i></div><div class=deskareaicon title="Draai naar links"onclick=drotate(-1)><i class="fa-solid fa-rotate-left"></i></div><div class=deskareaicon title="Schakel weergavemodus"onclick=toggleAspectRatio(1)>⇲</div><div id=idx_deskFullBtn2 onclick=deskToggleFull(event) style=float:right>&nbsp;✖</div></div></div><div id=deskarea3x><div id=p11bigok style=display:none><b>✓</b></div><div id=p11bigfail style=display:none><b>✗</b></div><div id=DeskFocus oncontextmenu=return!1 onmousedown=dmousedown(event) onmouseup=dmouseup(event) onmousemove=dmousemove(event)></div><div id=DeskParent><canvas id=Desk width=640 height=480 oncontextmenu=return!1 onmousedown=dmousedown(event) onmouseup=dmouseup(event) onmousemove=dmousemove(event) onmousewheel=dmousewheel(event)></canvas></div><div id=DeskTools><div id=deskToolsAreaTop><a id=DeskToolsRefreshButton class=link-underline-primary style=right:2px onclick=refreshDeskTools()>Verversen</a><div id=deskToolsTopTabProcess class=deskToolsTopTab onclick=changeDeskToolTab(0) style=left:0;bottom:0>Processen</div><div id=deskToolsTopTabService class=deskToolsTopTab onclick=changeDeskToolTab(1) style=display:none;left:90px;color:gray>Services</div></div><div id=deskToolsArea><div id=DeskToolsProcessTab><div id=deskToolsHeader><a class=colmn1 title="Sorteer op proces ID"onclick=sortProcess(0)>PID</a> <a class=colmn2 title="Sorteren op naam"onclick=sortProcess(1)>Naam</a></div><div id=DeskToolsProcesses></div></div><div id=DeskToolsServiceTab style=display:none><div id=deskToolsServiceHeader><a class=colmn1 style=width:70px title="Sorteer op status"onclick=sortService(0)>Status</a> <a class=colmn2 title="Sorteren op naam"onclick=sortService(1)>Naam</a></div><div id=DeskToolsServices></div></div></div></div><div id=p11DeskConsoleMsg style=display:none;text-align:left;cursor:pointer;position:absolute;left:30px;top:17px;color:#ff0;background-color:rgba(0,0,0,.6);padding:10px;border-radius:5px;text-align:left onclick=p11clearConsoleMsg()></div><div id=p11DeskSessionSelector style=display:none;position:absolute;left:30px;top:17px;right:30px;bottom:17px;overflow-y:auto></div></div><div id=deskarea4 class="areaFoot d-flex flex-wrap"><div class="d-flex align-items-center"><select id=deskkeys class="form-select-sm me-1"cmenu=deskKeyShortcutContextMenu></select> <input id=DeskWD type=button class="btn btn-primary btn-sm me-1"value=Verzenden onkeypress=return!1 onkeydown=return!1 onclick=deskSendKeys()> <input id=DeskESC style=display:none type=button class="btn btn-primary btn-sm me-1"value=ESC onkeypress=return!1 onkeydown=return!1 onclick=sendDeskEsc()> <input id=DeskClip type=button class="btn btn-primary btn-sm me-1"value=Klembord onkeypress=return!1 onkeydown=return!1 onclick=showDeskClip()> <input id=DeskType class="btn btn-primary btn-sm me-1"cmenu=deskPreConfigShortcutContextMenu type=button value=Type onkeypress=return!1 onkeydown=return!1 onclick=showDeskType()><div id=DeskControlSpan title="Schakelen tussen muis- en toetsenbordinvoer"class=form-check><input id=DeskControl type=checkbox class=form-check-input onkeypress=return!1 onkeydown=return!1 onclick=toggleKvmControl()><label class=form-check-label for=DeskControl>Invoer</label></div>&nbsp;</div><div class="d-flex ms-auto align-items-center"><span id=DeskMonitorSelectionSpan></span> <span id=DeskLatency style=width:70px class=text-center title="Desktop sessie wachttijd"></span> <span id=DeskTimer style=width:70px class=text-center title="Sessie tijd"></span> <input id=DeskToolsButton type=button class="btn btn-primary btn-sm mx-1"value=Gereedschap title="Schakel hulpmiddelenweergave in"onkeypress=return!1 onkeydown=return!1 onclick=toggleDeskTools()> <span id=DeskGuestShareButton title="Deel het apparaat met een gast"role=button><i class="fa-solid fa-fw fa-share-nodes"id=DeskInputUnLockedButtonImage onclick=showShareDevice()></i> </span><span id=DeskInputUnLockedButton title="Externe invoer is ontgrendeld"role=button><i class="fa-solid fa-fw fa-keyboard"onclick=deskInputLockFunction(1)></i> </span><span id=DeskInputLockedButton title="Externe invoer is vergrendeld"role=button><i class="fa-solid fa-fw fa-keyboard"style=color:red onclick=deskInputLockFunction(0)></i> </span><span id=DeskRefreshButton title="Vernieuw het bureaublad"role=button><i class="fa-solid fa-fw fa-rotate"onclick=deskRefreshFunction()></i> </span><span id=DeskClipboardOutButton title="Upload lokaal klembord naar het externe apparaat"role=button><i class="fa-solid fa-fw fa-up-long"data-fa-transform="shrink-9 down-4"data-fa-mask="fa-solid fa-clipboard"onclick=deskClipboardOutFunction()></i> </span><span id=DeskClipboardInButton title="Download het externe klembord naar het lokale klembord"style=display:none role=button><i class="fa-solid fa-fw fa-down-long"data-fa-transform="shrink-9 down-4"data-fa-mask="fa-solid fa-clipboard"onclick=deskClipboardInFunction()></i> </span><span id=DeskRecordButton cmenu=deskPlayerContextMenu title="Neem externe bureaublad sessie op naar een bestand"style=display:none role=button><i class="fa-solid fa-fw fa-video"onclick=deskRecordSession() id=DeskRecordButtonImage></i> </span><span id=DeskSaveImageButton title="Bewaar een screenshot van het externe bureaublad"role=button><i class="fa-solid fa-fw fa-camera"onclick=deskSaveImage()></i> </span><span id=DeskBackgroundButton title="Wissel externe bureaublad achtergrond"role=button><i class="fa-solid fa-fw fa-image"onclick=deviceToggleBackground(event) id=DeskBackgroundButtonImage></i> </span><span id=DeskOpenWebButton title="Open een webadres op de externe computer"role=button><i class="fa-solid fa-fw fa-globe"onclick=deviceUrlFunction()></i> </span><span id=DeskLockButton title="Vergrendel de externe computer"role=button><i class="fa-solid fa-fw fa-lock"onclick=deviceLockFunction()></i> </span><span id=DeskNotifyButton title="Toon een melding op de externe computer"role=button><i class="fa-solid fa-fw fa-bell"onclick=deviceToastFunction()></i> </span><span id=DeskChatButton class=deskarea title="Open chatvenster op deze computer"role=button><i class="fa-solid fa-fw fa-message"onclick=deviceChat(event)></i> </span><span id=DeskRunButton cmenu=deskPreConfigScriptContextMenu class=deskarea title="Voer een script uit op deze computer"role=button><i class="fa-solid fa-fw fa-play"onclick=runDeviceCmd()></i></span></div></div></div></div><div id=p12 style=display:none><div id=p12title class="d-flex align-items-center"><div id=p12BackButton class=pe-2><i class="fa-solid fa-square-caret-left fa-2xl"role=button tabindex=0 onclick=goBack() title=Terug onkeypress='"Enter"==event.key&&goBack()'></i></div><div class="fs-4 fw-bold">Terminal - <span id=p12deviceName></span></div><div id=devListToolbarViewIcons2 class=ms-auto><i class="fa-solid fa-xl fa-maximize fa-border"role=button onclick=deskToggleFull(event) title="Volledig scherm. Houd shift ingedrukt om de browser op volledig scherm weer te geven."></i></div></div><div id=p12warning onclick=showFeaturesDlg()><div class=icon2></div><div class=warningbox>Omleidingspoort of KVM functie is uitgeschakeld<span id=p12warninga>, klik hier om in te schakelen</span></div></div><div id=p12warning2 onclick=showPowerActionDlg()><div class=icon2></div><div class=warningbox>Externe computer is niet ingeschakeld, klik hier om een stroomopdracht uit te voeren.</div></div><div id=termTable style=position:relative><table style=width:100% cellpadding=0 cellspacing=0><tr><td class="areaHead d-flex flex-wrap"><div class="d-flex align-items-center"><button type=button id=autoconnectbutton2 class="btn btn-primary btn-sm me-1"onclick=autoConnectTerminal(event) onkeypress=return!1 onkeydown=return!1 style=display:none><i class="fa-solid fa-play"></i> Automatisch verbinden</button><div class="btn-group dropdown-center me-1"id=connectbutton2span><button type=button class="btn btn btn-primary btn-sm"id=connectbutton2 title="Verbinding maken via MeshAgent extern bureaublad"onclick=connectTerminal(event,1) onkeypress=return!1 onkeydown=return!1 disabled>Verbinden</button> <button type=button class="btn btn-primary btn-sm dropdown-toggle dropdown-toggle-split"id=connectbutton2d data-bs-toggle=dropdown aria-expanded=false onclick=newContextMenu(event,1)><span class=visually-hidden>Toggle Dropdown</span></button><ul class=dropdown-menu><li><a class=dropdown-item onclick=cmtermaction(1,0,event)><b>Beheerder Shell</b></a><li><a class=dropdown-item onclick=cmtermaction(6,0,event)>Beheerder PowerShell</a><li><a class=dropdown-item onclick=cmtermaction(8,0,event)>Gebruiker Shell</a><li><a class=dropdown-item onclick=cmtermaction(9,0,event)>Gebruiker PowerShell</a><li><a class=dropdown-item onclick=cmtermaction(1,16,event)>Vraag naar de shell in beheersdersmodus</a><li><a class=dropdown-item onclick=cmtermaction(6,16,event)>Vraag naar de PowerShell in beheersdersmodus</a><li><a class=dropdown-item onclick=cmtermaction(8,16,event)>Vraag naar de shell in gebruikersmodus</a><li><a class=dropdown-item onclick=cmtermaction(9,16,event)>Vraag naar de PowerShell in gebruikersmodus</a><li class=ass><a class=dropdown-item onclick=cmtermaction(8,0,event)><b>Gebruiker Shell</b></a><li class=ass><a class=dropdown-item onclick=cmtermaction(9,0,event)>Gebruiker PowerShell</a><li class=lin><a class=dropdown-item onclick=cmtermaction(1,0,event)><b>Root Shell</b></a><li class=lin><a class=dropdown-item onclick=cmtermaction(8,0,event)>Gebruiker Shell</a><li class=lin><a class=dropdown-item onclick=cmtermaction(100,0,event)>Login Shell</a></ul></div><div class="btn-group dropdown-center me-1"id=connectbutton2sspan><button type=button class="btn btn btn-primary btn-sm"id=connectbutton2s title="Verbinding maken via MeshAgent extern bureaublad"onclick=connectTerminal(event,3) onkeypress=return!1 onkeydown=return!1 disabled>SSH verbinding</button> <button type=button class="btn btn-primary btn-sm dropdown-toggle dropdown-toggle-split"id=connectbutton2sd data-bs-toggle=dropdown aria-expanded=false><span class=visually-hidden>Toggle Dropdown</span></button><ul class=dropdown-menu><li><a class=dropdown-item onclick=cmsshportaction(1,event)>Alternatieve poort</a></ul></div><span id=connectbutton2hspan><button type=button class="btn btn-primary btn-sm me-1"id=connectbutton2h title="Maak verbinding met behulp van Intel® AMT hardware KVM"onclick=connectTerminal(event,2) onkeypress=return!1 onkeydown=return!1 disabled>HW verbinden</button></span> <span id=disconnectbutton2span><button type=button class="btn btn-primary btn-sm me-1"id=disconnectbutton2 onclick=connectTerminal(event,0) onkeypress=return!1 onkeydown=return!1>Verbreken</button></span> <span id=termstatus style=line-height:22px>Verbroken</span><span id=termtitle></span></div><div class="d-flex align-items-center ms-auto"><div id=idx_termFullBtn2 onclick=deskToggleFull(event) style=float:right>&nbsp;✖</div><div id=termRecordIcon class=deskareaicon title="Server neemt deze sessie op"style=display:none;background-color:red;width:12px;height:12px;border-radius:6px;margin-top:5px;margin-left:5px></div><input id=termActionsBtn type=button title="Voer power acties uit op het apparaat"onkeypress=return!1 onkeydown=return!1 value=Acties class="btn btn-primary me-1 btn-sm"onclick=deviceActionFunction()><div id=terminalCustomUpperRight style=float:left;margin-right:6px></div><div id=terminalCustomUiButtons style=float:left></div></div><tr><td id=termarea3x><div id=termarea3xdiv style=width:100%;height:100%;text-align:left></div><pre id=Term></pre><tr><td class="areaFoot d-flex flex-wrap"><div class="d-flex align-items-center"><input type=button onkeypress=return!1 onkeydown=return!1 class="btn btn-primary btn-sm me-1"id=ctrlcbutton value=Ctl-C onclick='termSendKey(3,"ctrlcbutton")'> <input type=button onkeypress=return!1 onkeydown=return!1 class="btn btn-primary btn-sm me-1"id=ctrlxbutton value=Ctl-X onclick='termSendKey(24,"ctrlxbutton")'> <input type=button onkeypress=return!1 onkeydown=return!1 class="btn btn-primary me-1 btn-sm"id=escbutton value=ESC onclick='termSendKey(27,"escbutton")'> <input type=button onkeypress=return!1 onkeydown=return!1 class="btn btn-primary me-1 btn-sm"id=bsbutton value=Backspace onclick='termSendKey(8,"bsbutton")'style=display:none> <input type=button onkeypress=return!1 onkeydown=return!1 class="btn btn-primary me-1 btn-sm"id=pastebutton value=Plakken title="Plak tekst in de terminal"onclick=showTermPasteDialog() style=display:none></div><div class="d-flex align-items-center ms-auto"><span id=TermTimer title="Sessie tijd"></span>&nbsp; <span id=terminalSettingsButtons style=display:none><input id=id_tcrbutton type=button onkeypress=return!1 onkeydown=return!1 class="btn btn-primary me-1 btn-sm"value=CR+LF title="Wissel wat de return toets zal verzenden"onclick=termToggleCr()> <input id=id_tfxkeysbutton type=button onkeypress=return!1 onkeydown=return!1 class="btn btn-primary me-1 btn-sm"value="Intel (F10 = ESC+[OM)"title="Schakel het emulatietype van F1 naar F10 toetsen"onclick=termToggleFx()> <input id=id_ttypebutton type=button onkeypress=return!1 onkeydown=return!1 class="btn btn-primary me-1 btn-sm"value="Extended Ascii"title="Schakel het type terminal emulatie in"onclick=termToggleType()> </span><span id=terminalSizeDropDown style=display:none><select id=termSizeList onkeypress=return!1 class="form-select-sm me-1"><option value=1>80x25<option value=2>100x30</select> </span><select id=specialkeylist class="form-select-sm me-1"onkeypress=return!1></select> <input id=specialkeylistinput type=button onkeypress=return!1 class="btn btn-primary btn-sm me-1"value=Verzenden title="Verzend de geselecteerde speciale sleutel"onclick=sendSpecialKey()></div></table><div id=p12TermConsoleMsg style=display:none;text-align:left;cursor:pointer;position:absolute;left:30px;top:45px;color:#ff0;background-color:rgba(0,0,0,.6);padding:10px;border-radius:5px onclick=p12clearConsoleMsg()></div></div></div><div id=p13 style=display:none><div id=p13title class="d-flex align-items-center"><div id=p13BackButton class=pe-2><i class="fa-solid fa-square-caret-left fa-2xl"role=button tabindex=0 onclick=goBack() title=Terug onkeypress='"Enter"==event.key&&goBack()'></i></div><div class="fs-4 fw-bold">Bestanden - <span id=p13deviceName></span></div></div><table id=p13toolbar cellpadding=0 cellspacing=0><tr><td class="areaHead d-flex flex-wrap"><div class="d-flex align-items-center"><button id=p13AutoConnect onclick=autoConnectFiles(event) class="btn btn-primary btn-sm me-1"type=button style=display:none><i class="fa-solid fa-play"></i> Automatisch verbinden</button><div class="btn-group dropdown-center me-1"id=p13Connectspan><button type=button class="btn btn btn-primary btn-sm"id=p13Connect title="Verbinding maken via MeshAgent extern bureaublad"onclick=connectFiles(event,1) onkeypress=return!1 onkeydown=return!1 disabled>Verbinden</button> <button type=button class="btn btn-primary btn-sm dropdown-toggle dropdown-toggle-split"id=p13Connectdrop data-bs-toggle=dropdown aria-expanded=false><span class=visually-hidden>Toggle Dropdown</span></button><ul class=dropdown-menu><li><a class=dropdown-item onclick=cmconnectfilesaction()>Vraag toestemming</a></ul></div><button id=p13Disconnect class="btn btn-primary btn-sm me-1"onclick=connectFiles(event) type=button>Verbreken</button><div class="btn-group dropdown-center me-1"id=p13Connectsspan><button type=button class="btn btn btn-primary btn-sm"id=p13Connects title="Verbinding maken via MeshAgent extern bureaublad"onclick=connectFiles(event,2) onkeypress=return!1 onkeydown=return!1 disabled>SFTP verbinding</button> <button type=button class="btn btn-primary btn-sm dropdown-toggle dropdown-toggle-split"id=p13Connectsdrop data-bs-toggle=dropdown aria-expanded=false><span class=visually-hidden>Toggle Dropdown</span></button><ul class=dropdown-menu><li><a class=dropdown-item onclick=cmsshportaction(1,event)>Alternatieve poort</a></ul></div><span id=p13Status>Verbroken</span></div><div class="d-flex align-items-center ms-auto"><input id=filesActionsBtn class="btn btn-primary me-1 btn-sm"type=button title="Voer power acties uit op het apparaat"value=Acties onclick=deviceActionFunction()><div id=filesRecordIcon class=deskareaicon title="Server neemt deze sessie op"style=display:none;background-color:red;width:12px;height:12px;border-radius:6px;margin-top:5px;margin-left:5px></div><div id=filesCustomUpperRight style=float:left;margin-right:6px></div><div id=filesCustomUiButtons style=float:left></div></div><tr><td class="areaHead2 d-flex align-items-center flex-wrap"valign=bottom><div id=p13rightOfButtons class="toright2 d-flex align-items-center"></div><div class="d-flex align-items-center"><input type=button disabled id=p13FolderUp class="btn btn-primary me-1 btn-sm"value=Omhoog onclick=p13folderup()> <input type=button disabled id=p13SelectAllButton class="btn btn-primary me-1 btn-sm"value="Selecteer alles"onclick=p13selectallfile()> <input type=button disabled id=p13RenameFileButton class="btn btn-primary me-1 btn-sm"value=Hernoemen onclick=p13renamefile()> <input type=button disabled id=p13DeleteFileButton class="btn btn-primary me-1 btn-sm"value=Verwijderen onclick=p13deletefile()> <input type=button disabled id=p13ViewFileButton class="btn btn-primary me-1 btn-sm"value=Bewerk onclick=p13viewfile()> <input type=button disabled id=p13NewFolderButton class="btn btn-primary me-1 btn-sm"value="Nieuwe map"onclick=p13createfolder()> <input type=button disabled id=p13UploadButton class="btn btn-primary me-1 btn-sm"value=Uploaden onclick=p13uploadFile()> <input type=button disabled id=p13DownloadButton class="btn btn-primary me-1 btn-sm"value=Download onclick=p13downloadButton()> <input type=button disabled id=p13CutButton class="btn btn-primary me-1 btn-sm"value=Knippen onclick=p13copyFile(1)> <input type=button disabled id=p13CopyButton class="btn btn-primary me-1 btn-sm"value=Kopiëren onclick=p13copyFile(0)> <input type=button disabled id=p13PasteButton class="btn btn-primary me-1 btn-sm"value=Plakken onclick=p13pasteFile()> <input type=button disabled id=p13ZipButton class="btn btn-primary me-1 btn-sm"value=Zip onclick=p13zipFiles()> <input type=button disabled id=p13UnzipButton class="btn btn-primary me-1 btn-sm"value=Uitpakken onclick=p13unzipFile()> <input type=button disabled id=p13RefreshButton class="btn btn-primary me-1 btn-sm"value=Verversen onclick=p13folderup(9999)> <input type=button disabled id=p13FindButton class="btn btn-primary me-1 btn-sm"value=Zoeken onclick=p13findfile()> <input type=button disabled id=p13GoToFolderButton class="btn btn-primary me-1 btn-sm"value=GoTo onclick=p13gotofolder()> <input type=button disabled id=p13OpenButton class="btn btn-primary me-1 btn-sm"value=Open onclick=p13openfilefolder()></div><tr><td class=areaHead3><div class=toright2><select id=p13sizedropdown class="form-select-sm me-2"onchange=p13updateFiles()><option value=0 selected>Human Readable<option value=1 title=Bytes>Bytes<option value=10 title=KB>Kilobytes<option value=20 title=MB>Megabytes<option value=30 title=GB>Gigabyte</select> <select id=p13sortdropdown class="form-select-sm me-2"onchange=p13updateFiles()><option value=1 selected>Sorteren op naam<option value=2>Sorteren op grootte<option value=3>Sorteren op datum<option value=4>Aflopend op naam<option value=5>Aflopend op grootte<option value=6>Aflopend op datum</select></div><div>&nbsp;&nbsp;<span id=p13currentpath></span></div></table><div id=p13FilesConsoleMsg style=display:none;text-align:left;cursor:pointer;position:absolute;left:30px;top:165px;color:#ff0;background-color:rgba(0,0,0,.6);padding:10px;border-radius:5px onclick=p13clearConsoleMsg()></div><div id=p13filetable><div id=p13bigok style=display:none><b>✓</b></div><div id=p13bigfail style=display:none><b>✗</b></div><span id=p13files></span></div><table id=p13toolbarBottom cellpadding=0 cellspacing=0><tr><td class=style6>&nbsp;<span id=p13bottomstatus></span></table></div><div id=p14 style=display:none><div id=p14title class="d-flex align-items-center"><div id=p14BackButton class=pe-2><i class="fa-solid fa-square-caret-left fa-2xl"role=button tabindex=0 onclick=goBack() title=Terug onkeypress='"Enter"==event.key&&goBack()'></i></div><div class="fs-4 fw-bold"><span id=p14deviceNamePrefix>Intel® AMT</span> - <span id=p14deviceName></span></div><div id=devListToolbarViewIcons class=ms-auto><i class="fa-solid fa-xl fa-maximize fa-border"role=button onclick=deskToggleFull(event) title="Volledig scherm. Houd shift ingedrukt om de browser op volledig scherm weer te geven."></i></div></div><iframe id=p14iframe src={{{domainurl}}}commander.ashx></iframe></div><div id=p15 style=display:none><div id=p15title class="d-flex align-items-center"><div id=p15BackButton class=pe-2><i class="fa-solid fa-square-caret-left fa-2xl"role=button tabindex=0 onclick=goBack() title=Terug onkeypress='"Enter"==event.key&&goBack()'></i></div><div class="fs-4 fw-bold"><span id=p15deviceName></span></div></div><table id=consoleTable cellpadding=0 cellspacing=0><tr><td class="areaHead d-flex flex-wrap"><div id=p15statetext class="d-flex align-items-center"></div><div class="d-flex align-items-center ms-auto"><div id=p15coreName class=me-1 title="Informatie over de huidige kern die op deze agent wordt uitgevoerd"></div><input type=button id=p15uploadCore class="btn btn-primary me-1 btn-sm"value="Agent actie"onclick=p15uploadCore(event) title="Wijzig de Javascript code module van de agent"> <i onclick=p15downloadConsoleText() title="Consoletekst downloaden"class="fa-solid fa-download me-1"></i></div><tr><td><div class=areaProgress><div id=consoleprogressbar></div></div><tr><td id=p15agentConsole><pre id=p15agentConsoleText></pre><tr><td class=areaFoot><table style=width:100%><tr><td style=width:99%><input id=p15consoleText class=form-control onkeyup=p15consoleSend(event) onfocus=onConsoleFocus(1) onblur=onConsoleFocus(0)><td>&nbsp;<td id=p15outputselecttd><select id=p15outputselect onchange=setupConsole()><option id=p15outputselect1 value=1>Agent<option id=p15outputselect3 value=3>Push<option id=p15outputselect2 value=2>MQTT</select><td style=width:1%><input id=id_p15consoleClear type=button class="btn btn-primary bottombutton"value=Wissen onclick=p15consoleClear()></table></table></div><div id=p16 style=display:none><div id=p16title class="d-flex align-items-center"><div id=p16BackButton class=pe-2><i class="fa-solid fa-square-caret-left fa-2xl"role=button tabindex=0 onclick=goBack() title=Terug onkeypress='"Enter"==event.key&&goBack()'></i></div><div class="fs-4 fw-bold">Gebeurtenissen - <span id=p16deviceName></span></div></div><table class=pTable><tr><td class="auto-style1 d-flex justify-content-end p-1"><div class="d-flex align-items-center"><label class=me-1 for=p16filterevents>Filter</label> <select id=p16filterevents class="form-control-sm me-2"onchange=refreshDeviceEvents()><option notransval=1 value="">Alle Logboeken<option notransval=1 value=agentlog>Agent Logboeken<option notransval=1 value=relaylog>Relay Logboeken<option notransval=1 value=manual>Handmatige logboeken<option notransval=1 value=runcommands>Voer opdracht logboeken uit<option notransval=1 value=batchupload>Batch Upload Logboeken<option notransval=1 value=changenode>Wijzig Node Logboeken<option notransval=1 value=removenode>Verwijder node Logboeken</select> <label class=me-1 for=p16limitdropdown>Tonen</label> <select id=p16limitdropdown class="form-control-sm me-2"onchange=refreshDeviceEvents()><option notransval=1 value=60>Laatste 60<option notransval=1 value=120>Laatste 120<option notransval=1 value=250>Laatste 250<option notransval=1 value=500>Laatste 500<option notransval=1 value=1000>Laatste 1000</select> <i onclick=p3showDownloadEventsDialog(1) class="fa-solid fa-download"title="Download gebeurtenissen"style=cursor:pointer></i></div></table><div id=p16events></div></div><div id=p17 style=display:none><div id=p17title class="d-flex align-items-center"><div id=p17BackButton class=pe-2><i class="fa-solid fa-square-caret-left fa-2xl"role=button tabindex=0 onclick=goBack() title=Terug onkeypress='"Enter"==event.key&&goBack()'></i></div><div class="fs-4 fw-bold">Details - <span id=p17deviceName></span></div><div id=devListToolbarViewIcons3 class=ms-auto><i class="fa-solid fa-chart-line fa-xl fa-border"role=button onclick=deskToggleCpuGraph(event) title="Toon processor en geheugengebruik van dit apparaat."></i></div></div><div id=p17info class="ps-0 pb-5 overflow-y-auto container-fluid"><div id=p17graph style=width:100%><table style=width:100%><tr><td style=width:64px;vertical-align:top><img src=images/details/graph64.png border=0 width=64><td><div class=DevSt style=margin-bottom:3px;margin-left:16px><b>Live weergave</b></div><div style="margin-bottom:10px;margin-left:16px;height:240px;width:calc(100% - 16px);position:relative"><canvas id=deviceDetailsStats style=position:absolute;top:0;left:0;right:0;bottom:0></canvas></div><div id=extraGraphValues style=display:none;margin-left:30px;margin-bottom:15px></div></table></div><div id=p17info2></div></div></div><div id=p19 style=display:none><div id=p19title><div id=p19BackButton style=float:left><div class=backButton tabindex=0 onclick=goBack() title=Terug onkeypress='"Enter"==event.key&&goBack()'><div class=backButtonEx></div></div></div><h1>Plugins - <span id=p19deviceName></span></h1></div><div id=p19headers></div><div id=p19pages></div></div><div id=p20 style=display:none><div id=p20main style=overflow-y:auto><div id=p20title class="d-flex align-items-center"><div id=p20BackButton class=pe-2><i class="fa-solid fa-square-caret-left fa-2xl"role=button tabindex=0 onclick=goBack() title=Terug onkeypress='"Enter"==event.key&&goBack()'></i></div><div class="fs-4 fw-bold">Algemeen - <span id=p20meshName></span></div></div><picture id=MainMeshImage style=border-width:0;height:200px;width:200px;float:right><source type=image/webp width=200 height=200 srcset=images/webp/mesh-256.webp><img alt=""width=200 height=200 src=images/mesh-256.png></picture><p id=p20info><p id=p20info2></div></div><div id=p21 style=display:none><div id=p21title class="d-flex align-items-center"><div id=p21BackButton class=pe-2><i class="fa-solid fa-square-caret-left fa-2xl"role=button tabindex=0 onclick=goBack() title=Terug onkeypress='"Enter"==event.key&&goBack()'></i></div><div class="fs-4 fw-bold">Samenvatting - <span id=p21meshName></span></div></div><div id=p21main style=overflow-y:auto><div style=width:100%><div style=display:table;width:93%><div id=meshPowerChartDiv style=width:23%;display:inline-block;text-align:center;max-width:250px><div style=margin:10px;font-size:16px>Status</div><canvas id=meshPowerChart style=width:250px;height:250px></canvas></div><div id=meshOsChartDiv style=width:23%;display:inline-block;text-align:center;max-width:250px><div style=margin:10px;font-size:16px>Agent Type</div><canvas id=meshOsChart style=width:250px;height:250px></canvas></div><div id=meshConnChartDiv style=width:23%;display:inline-block;text-align:center;max-width:250px><div style=margin:10px;font-size:16px>Connectiviteit</div><canvas id=meshConnChart style=width:250px;height:250px></canvas></div><div id=meshSecurityChartDiv style=width:23%;display:inline-block;text-align:center;max-width:250px><div style=margin:10px;font-size:16px>Beveiliging</div><canvas id=meshSecurityChart style=width:250px;height:250px></canvas></div></div></div><p id=p21info style=overflow-y:auto></div></div><div id=p30 style=display:none><div id=p30title class="d-flex align-items-center"><div id=p30BackButton class=pe-2><i class="fa-solid fa-square-caret-left fa-2xl"role=button tabindex=0 onclick=goBack() title=Terug onkeypress='"Enter"==event.key&&goBack()'></i></div><div class="fs-4 fw-bold">Algemeen - <span id=p30userName></span></div></div><div id=p30info style=overflow-y:auto><div class=row><div class=col><div id=p30html></div></div><div class=col-auto style=width:20px></div><div class=col-auto style=width:200px;position:relative><img id=p30userAuthServiceLogo loading=lazy style=display:none class=userAuthStrategyLogo width=64 height=64><picture id=MainUserImage style=display:none;border-width:0;height:200px;width:200px;float:right onclick=account_manageImage(1)><source type=image/webp width=200 height=200 srcset=images/webp/user-256.webp><img alt=""width=200 height=200 src=images/user-256.png></picture><img id=MainUserImageEx alt=""width=200 height=200 src=images/user-256.png onclick=account_manageImage(1)><div style=width:100%;text-align:center><strong><span id=MainUserState></span></strong></div></div></div><br><div id=p30html2></div><div id=p30html3></div></div></div><div id=p31 style=display:none><div id=p31title class="d-flex align-items-center"><div id=p31BackButton class=pe-2><i class="fa-solid fa-square-caret-left fa-2xl"role=button tabindex=0 onclick=goBack() title=Terug onkeypress='"Enter"==event.key&&goBack()'></i></div><div class="fs-4 fw-bold">Gebeurtenissen - <span id=p31userName></span></div></div>{{!-- --}} {{!-- --}}<table class=pTable><tr><td class=h1><td class="auto-style1 d-flex justify-content-end p-1"><div class="d-flex align-items-center"><label for=p31filterevents class=me-1>Filter</label> <select id=p31filterevents class="form-select-sm me-2"onchange=refreshUsersEvents()><option notransval=1 value="">Alle Logboeken<option notransval=1 value=agentlog>Agent Logboeken<option notransval=1 value=relaylog>Relay Logboeken<option notransval=1 value=manual>Handmatige logboeken<option notransval=1 value=runcommands>Voer opdracht logboeken uit<option notransval=1 value=batchupload>Batch Upload Logboeken<option notransval=1 value=changenode>Wijzig Node Logboeken<option notransval=1 value=removenode>Verwijder node Logboeken</select> <label for=p31limitdropdown class=me-1>Tonen</label> <select id=p31limitdropdown class="form-select-sm me-2"onchange=refreshUsersEvents()><option notransval=1 value=60>Laatste 60<option notransval=1 value=120>Laatste 120<option notransval=1 value=250>Laatste 250<option notransval=1 value=500>Laatste 500<option notransval=1 value=1000>Laatste 1000<option notransval=1 value="">Geen limiet</select> <a href=# onclick=p3showDownloadEventsDialog(3)><i class="fa-solid fa-download"role=button title="Download gebeurtenissen"></i></a></div><td class=h2></table><div id=p31events></div></div><div id=p40 style=display:none><div id=p40title><h1>Mijn serverstatistieken</h1></div><div class="areaHead d-flex align-items-center flex-wrap p-1"><div class="d-flex align-items-center"><input value=Verversen type=button class="btn btn-primary btn-sm me-2"onclick=refreshServerTimelineStats()><div class=form-check><input class="form-check-input me-1"type=checkbox id=p40log onclick=updateServerTimelineHours()><label class=form-check-label for=p40log>Log-X</label></div></div><div class="toright2 d-flex align-items-center ms-auto"><select id=p40server style=display:none onchange=updateServerTimelineStats()></select> <select id=p40type class="form-select-sm me-1"onchange=updateServerTimelineStats()><option value=0>Verbindingen<option value=1>Geheugen<option value=5>CPU<option value=3>Inkomend verkeer<option value=4>Uitgaand verkeer</select> <select id=p40time class="form-select-sm me-1"onchange=updateServerTimelineHours()><option value=3>Laatste 3 uur<option value=8>Laatste 8 uur<option value=24>Laatste dag<option value=168>Vorige week<option value=720>Laatste 30 dagen</select> <i class="fa-solid fa-download"title="Gegevenspunten downloaden (.csv)"style=cursor:pointer onclick=p40downloadEvents()></i></div></div><canvas id=serverMainStats></canvas></div><div id=p41 style=display:none><div id=p41title><h1>Mijn server traceren</h1></div><div class="areaHead d-flex align-items-center flex-wrap p-1"><div class="d-flex align-items-center"><input value=Traceren type=button class="btn btn-primary btn-sm me-1"onclick=setServerTracing()> <span id=p41traceStatus>Geen</span></div><div class="toright2 d-flex align-items-center ms-auto"><label for=p41limitdropdown class=me-1>Tonen</label> <select id=p41limitdropdown class="form-select-sm me-1"onchange=displayServerTrace()><option value=100>Laatste 100<option value=250>Laatste 250<option value=500>Laatste 500<option value=1000>Laatste 1000</select> <input value=Wissen type=button class="btn btn-primary btn-sm me-1"onclick=clearServerTracing()> <i class="fa-solid fa-download"title="Download sporen (.csv)"style=cursor:pointer onclick=p41downloadServerTrace()></i></div></div><div id=p41events></div></div><div id=p42 style=display:none><h1>Mijn serverplug-ins</h1><div class=areaHead><div class=toright2></div><div><input value="Download Plugin"type=button onclick="return pluginHandler.addPluginDlg()"></div></div><div id=pluginRestartNotice class=areaHead style=background-color:gold;display:none><div class=toright2><input value="Agentcores vernieuwen"type=button onclick="return distributeCore(),!1"></div><div style=padding:2px><div style=padding:2px><b>Opmerking:</b> Plug-ins zijn gewijzigd, dit kan een update van de agent vereisen.</div></div></div><table id=p42tbl><tr class=DevSt><th style=width:26px><th style=width:10px><th class=chName>Naam<th class=chDescription>Omschrijving<th class=chSite style=text-align:center>Link<th class=chVersion style=text-align:center>Versie<th class=chUpgradeAvail style=text-align:center>Laatste<th class=chStatus style=text-align:center>Status<th class=chAction style=text-align:center>Actie<th style=width:10px></table><div id=pluginNoneNotice style=width:100%;text-align:center;padding-top:10px;display:none><i>Geen plug-ins op server.</i></div></div><div id=p43 style=display:none><div id=p43BackButton><div class=backButton tabindex=0 onmouseup=go(42) title=Terug onkeypress='"Enter"==event.key&&go(42)'><div class=backButtonEx></div></div></div><h1>Mijn serverplug-ins - <span id=p43title></span></h1><iframe id=p43iframe frameborder=0 style="width:100%;height:calc(100vh - 245px);max-height:calc(100vh - 245px)"></iframe></div><div id=p50 style=display:none><div id=p50title><h1>Mijn gebruikersgroepen</h1></div><table class=pTable><tr><td class="style14 d-flex align-items-center flex-wrap p-1"><div id=p50userGroupOps class="d-flex align-items-center"><input type=button id=UsersGroupsSelectAllButton class="btn btn-primary btn-sm me-1"onclick=p50usersSelectallButtonFunction() value="Selecteer alles"> <input type=button id=UsersGroupsGroupActionButton class="btn btn-primary btn-sm me-1"disabled value=Groepsactie onclick=p50usersGroupActionFunction()> <input id=NewUserGroupButton type=button class="btn btn-primary btn-sm me-1"onclick=showCreateUserGroupDialog(1) value="Nieuwe Groep..."> <input id=DuplicateUserGroupButton type=button class="btn btn-primary btn-sm me-1"style=display:none onclick=showCreateUserGroupDialog(2) value="Dupliceer groep..."></div></table><div id=p50groups></div></div><div id=p51 style=display:none><div id=p51title class="d-flex align-items-center"><div id=p51BackButton class=pe-2><i class="fa-solid fa-square-caret-left fa-2xl"role=button tabindex=0 onclick=goBack() title=Terug onkeypress='"Enter"==event.key&&goBack()'></i></div><div class="fs-4 fw-bold">Gebruikersgroep. <span id=p51groupName></span></div></div><div id=p51info style=overflow-y:auto><div class=row><div class=col><div id=p51group></div></div><div class=col-auto style=width:20px></div><div class=col-auto style=width:200px><picture id=MainUserImage style=border-width:0;height:200px;width:200px;float:right><source type=image/webp width=200 height=200 srcset=images/webp/group-256.webp><img alt=""width=200 height=200 src=images/group-256.png></picture><div style=width:100%;text-align:center><strong><span id=MainUserState></span></strong></div></div></div><div id=p51group2></div><br></div></div><div id=p52 style=display:none><div id=p52title><h1>Mijn gebruikersopnames</h1></div><table class=pTable><tr><td class="style14 d-flex align-items-center flex-wrap p-1"><div class="d-flex align-items-center"><input type=button class="btn btn-primary btn-sm"onclick=refreshRecodings() value=Verversen></div><div class="d-flex align-items-center ms-auto"><input type=button class="btn btn-primary btn-sm"onclick=openRecodringPlayer() value="Open speler..."></div></table><div id=p52recordings style=overflow-y:auto></div></div><div id=p60 style=display:none><div id=p60title><h1>Mijn rapporten</h1></div>{{!-- --}} {{!-- --}}<table class=pTable><tr><td class=h1><td class=style14><div style=float:right;line-height:22px><a id=p60downloadReportDiv style=display:none href=# onclick=p60downloadReport()><i class="fa-solid fa-download"title="Rapport downloaden"></i></a>&nbsp;</div><div><button class="btn btn-primary btn-sm me-2 m-1"onclick=generateReportDialog()><i class="fa-regular fa-file-alt"></i> Genereer rapport...</button></div><td class=h2></table><div id=p60report style=overflow-y:auto></div></div><br id=column_l_bottomgap></div><div id=footer><div class=footer1>{{{footer}}}</div><div class=footer2 style=display:none><div class=row><div class="col-md-6 d-flex gap-2"></div><div class=col-md-6><a id=verifyEmailId2 style=display:none href=# onclick=account_showVerifyEmail()>Verifieer Email</a> &nbsp;<a id=termsLinkFooter href=terms>Voorwaarden &amp; Privacy</a></div></div></div></div><div class="modal fade"id=xxAddAgentModal tabindex=-1 aria-hidden=true><div class="modal-dialog modal-dialog-centered"id=xxAddAgentModalConf><div class=modal-content><div class=modal-header id=dialogHeader><h5 class="modal-title text-white"id=xxAddAgentTitle></h5><button type=button class=btn-close data-bs-dismiss=modal aria-label=Close></button></div><div class=modal-body id=xxAddAgentBody><div id=dialog1><div id=id_dialogMessage></div></div><div id=dialog2><div id=id_dialogOptions></div></div><div id=dialog3><div id=d3upload><div>Bestandsselectie</div><select id=d3uploadMode onchange=d3modechange()><option value=1>Lokaal bestand uploaden<option value=2>Selectie serverbestand</select></div><div id=d3localmode style=display:none><div>Upload bestand</div><form id=d3localmodeform method=post enctype=multipart/form-data action=uploadfile.ashx target=fileUploadFrame><input id=d3auth name=auth style=display:none> <input id=d3filter name=filter style=display:none> <input id=d3attrib name=attrib style=display:none> <input type=file id=d3localFile name=files onchange=d3setActions()> <input type=submit id=d3submit style=display:none></form></div><div id=d3servermode><div id=d3serveraction valign=bottom><input type=button id=p3FolderUp disabled onclick=d3folderup() value=Omhoog>&nbsp;<span id=p3CurrentFolder></span></div><div id=d3serverfiles></div></div></div><div id=dialog4><input id=d4WrapButton class="btn btn-primary me-1 mb-1"type=button value="Wrap Aan"onclick=d4ToggleWrap()> <input id=d4SizeButton class="btn btn-primary me-1 mb-1"type=button value=Klein onclick=d4ToggleSize()> <input id=d4EncodingButton class="btn btn-primary me-1 mb-1"type=button value=Raw onclick=d4ToggleEncoding()> <input id=d4LineBreakButton class="btn btn-primary me-1 mb-1"type=button value=Windows onclick=d4ToggleLineBreak()> <textarea id=d4editorarea autocomplete=off style="height:calc(100vh - 286px);width:100%;overflow:scroll;resize:none;white-space:pre"></textarea></div><div id=dialog7><div class=dtab><button id=td7meshkvm class=tablinks onclick='changeDesktopSettingsTab(event,"d7meshkvm")'>Agent</button> <button id=td7rdpkvm class=tablinks onclick='changeDesktopSettingsTab(event,"d7rdpkvm")'>RDP</button> <button id=td7amtkvm class=tablinks onclick='changeDesktopSettingsTab(event,"d7amtkvm")'>Intel® AMT</button></div><div id=d7meshkvm class=tabcontent><div style=margin-top:8px><div>Kwaliteit</div><select id=d7bitmapquality dir=rtl></select></div><div><div>Schalen</div><select id=d7bitmapscaling dir=rtl><option selected value=1024>100%<option value=896>87.5%<option value=768>75%<option value=640>62.5%<option value=512>50%<option value=384>37.5%<option value=256>25%<option value=128>12.5%</select></div><div><div>Frameverhouding</div><select id=d7framelimiter dir=rtl><option selected value=50>Snel<option value=100>Gemiddeld<option value=400>Traag<option value=1000>Erg traag</select></div><div><div>Codering</div><select id=d7encoding dir=rtl><option value=1>JPEG<option value=2>PNG<option value=3>TIFF<option selected value=4>WEBP</select></div><div id=d7desktopOtherSettings><div>Andere instellingen</div><div id=d7otherset2 style=display:block><label style=display:block><input type=checkbox id=d7deskSwapMouse>Wissel muisknoppen</label> <label style=display:block><input type=checkbox id=d7deskrmw>Muiswiel actie omgekeerd</label> <label style=display:block><input type=checkbox id=d7deskRemoteKeyMap>Gebruik de externe toetsenbord instelling</label> <label style=display:block id=d7deskAutoClipboardLabel><input type=checkbox id=d7deskAutoClipboard>Automatisch klembord</label> <label style=display:block id=d7deskAutoLockLabel><input type=checkbox id=d7deskAutoLock>Vergrendelen bij verbreken</label></div></div></div><div id=d7amtkvm class=tabcontent><div style=margin-top:8px><div>Beeldcodering</div><select id=d7desktopmode><option value=1>RLE8, snelste<option value=2>RLE16, Aanbevolen<option value=3>RAW8, langzaam<option value=4>RAW16, Zeer langzaam</select></div><div><div>Andere instellingen</div><div id=d7otherset style=display:block><label style=display:block><input type=checkbox id=d7showfocus>Toon focus tool</label> <label style=display:block><input type=checkbox id=d7showcursor>Lokale muiscursor weergeven</label> <label style=display:block><input type=checkbox id=d7localKeyMap>Lokale toetsenbordkaart</label> <label style=display:block><input type=checkbox id=d7kvmrmw>Muiswiel actie omgekeerd</label></div></div></div><div id=d7rdpkvm class=tabcontent><div style=margin-top:8px><div>Scherm grootte</div><select id=d7rdpsize><option notransval=1 value=canvas>Canvas grootte<option notransval=1 value=browser>Browser grootte<option notransval=1 value=screen>Scherm grootte<option notransval=1 value=640x480>640x480<option notransval=1 value=1024x768>1024x768<option notransval=1 value=1280x800>1280x800<option notransval=1 value=1440x900>1440x900<option notransval=1 value=1600x900>1600x900<option notransval=1 value=1680x1050>1680x1050<option notransval=1 value=1920x1080>1920x1080</select></div><div><div>Opties</div><div id=d7rdpflags style=display:block><label style=display:block><input type=checkbox id=d7rdp1>Achtergrond uitschakelen</label> <label style=display:block><input type=checkbox id=d7rdp2>Volledig venster slepen uitschakelen</label> <label style=display:block><input type=checkbox id=d7rdp3>Menu animaties uitschakelen</label> <label style=display:block><input type=checkbox id=d7rdp4>Thema's uitschakelen</label> <label style=display:block><input type=checkbox id=d7rdp6>Cursorschaduw uitschakelen</label> <label style=display:block><input type=checkbox id=d7rdp7>Cursorinstellingen uitschakelen</label> <label style=display:block><input type=checkbox id=d7rdp8>Lettertype vloeiend maken inschakelen</label> <label style=display:block><input type=checkbox id=d7rdp9>Bureaubladsamenstelling inschakelen</label> <label style=display:block><input type=checkbox id=d7rdpclip>Automatisch klembord</label> <label style=display:block><input type=checkbox id=d7rdpsmb>Wissel muisknoppen</label> <label style=display:block><input type=checkbox id=d7rdprmw>Muiswiel actie omgekeerd</label></div></div></div></div></div><div class=modal-footer><button type=button class="btn btn-primary"data-bs-dismiss=modal id=idx_dlgCancelButton>Annuleren</button> <button type=button class="btn btn-outline-success"id=idx_dlgOkButton>OK</button> <button type=button class="btn btn-outline-danger"id=idx_dlgDeleteButton style=display:none>Verwijderen</button></div></div></div></div><iframe name=fileUploadFrame style=display:none></iframe><form style=display:none method=post action=uploadfile.ashx enctype=multipart/form-data target=fileUploadFrame><input id=p5fileDragName name=name><input id=p5fileDragAuthCookie name=auth><input id=p5fileDragSize name=size><input id=p5fileDragType name=type><input id=p5fileDragData name=data><input id=p5fileDragLink name=link class="btn btn-outline-success"><input type=submit id=p5loginSubmit2 style=display:none class="btn btn-outline-success"></form><form style=display:none method=post action=uploadnodefile.ashx enctype=multipart/form-data target=fileUploadFrame><input id=p13fileDragName name=name class="btn btn-outline-success"><input id=p13fileDragSize name=size class="btn btn-outline-success"><input id=p13fileDragType name=type class="btn btn-outline-success"><input id=p13fileDragData name=data class="btn btn-outline-success"><input id=p13fileDragLink name=link class="btn btn-outline-success"><input type=submit id=p13loginSubmit2 style=display:none class="btn btn-outline-success"></form><div id=topMenu style="z-index:1000;background-color:#fff;box-shadow:0 0 15px #666;font-family:Arial,Helvetica,sans-serif;border-radius:0 0 5px 5px;position:fixed;top:50px;right:5px;width:170px;display:none"><div style="padding:12px;border-top:1px solid gray;color:#000;cursor:pointer"onclick=topMenu(1)>Mijn apparaten</div><div style="padding:12px;border-top:1px solid gray;color:#000;cursor:pointer"onclick=topMenu(2)>Mijn Account</div><div style="padding:12px;border-top:1px solid gray;color:#000;cursor:pointer"onclick=topMenu(3)>Mijn gebeurtenissen</div><div style="padding:12px;border-top:1px solid gray;color:#000;cursor:pointer"onclick=topMenu(5)>Mijn bestanden</div><div style="padding:12px;border-top:1px solid gray;color:#000;cursor:pointer"onclick=topMenu(4)>Mijn gebruikers</div><div style="padding:12px;border-top:1px solid gray;color:#000;cursor:pointer"onclick=topMenu(6)>Mijn server</div><div id=logoutMenuOption><a id=logoutMenuOptionRef href=/logout><div style="padding:12px;border-top:1px solid gray;color:#000;cursor:pointer">Uitloggen</div></a></div></div><audio id=chimes><source src=sounds/chimes.mp3 type=audio/mp3></audio><iframe style=display:none name=fileDownloadFrame></iframe></div><script>var i,args,urlargs,random="{{{randomlength}}}",webState="{{{webstate}}}";for(i in webState=null!=(webState=""!=webState?JSON.parse(decodeURIComponent(webState)):webState)&&"object"==typeof webState?webState:{})if("desktopsettings"!=i)try{localStorage.setItem(i,webState[i])}catch(e){}if(!webState.loctag)try{localStorage.removeItem("loctag")}catch(e){}var desktop,terminal,files,autoReconnect=!0,powerStatetable=["","Ingeschakeld","Slaapstand","Slaapstand","Slaapstand","Slaapstand","Uitzetten","Aanwezig"],StatusStrs=["Verbroken","Verbinden...","Setup...","Verbonden","Intel&reg; AMT verbonden"],agentsStr=["Onbekend","Windows 32bit console","Windows 64bit console","Windows 32bit service","Windows 64bit service","Linux 32bit","Linux 64bit","MIPS","XENx86","Android","Linux ARM","macOS x86-32bit","Android x86","PogoPlug ARM","Android","Linux Poky x86-32bit","macOS x86-64bit","ChromeOS","Linux Poky x86-64bit","Linux NoKVM x86-32bit","Linux NoKVM x86-64bit","Windows MinCore console","Windows MinCore service","NodeJS","ARM-Linaro","ARMv6l / ARMv7l","ARMv8 64bit","ARMv6l / ARMv7l / NoKVM","MIPS24KC (OpenWRT)","Apple Silicon","FreeBSD x86-64","Onbekend","Linux ARM 64 bit (glibc/2.24 NOKVM)","Alpine Linux x86 64 Bit (MUSL)","Assistant (Windows)","Armada370 - ARM32/HF (libc/2.26)","OpenWRT x86-64","OpenBSD x86-64","Onbekend","Onbekend","MIPSEL24KC (OpenWRT)","ARMADA/CORTEX-A53/MUSL (OpenWRT)","Windows ARM 64bit console","Windows ARM 64bit service"],agentsStrNoAgent=["","","","","Windows","","Linux","","","","","","","","","","","","","","","","","","","","","","","Apple"],sort=0,searchFocus=0,mapSearchFocus=0,userSearchFocus=0,consoleFocus=0,showRealNames=!1,meshserver=null,meshes={},loginTokens={},meshcount=0,nodes=null,usergroups=null,filetree={},userinfo=null,serverinfo=null,events=[],users=null,wssessions=null,stars={},nodeShortIdent=0,desktopsettings={encoding:2,showfocus:!1,showmouse:!0,showcad:!0,quality:40,scaling:1024,framerate:50,localkeymap:!1,swapmouse:!1,remotekeymap:!1,autoclipboard:!1,autolock:!1,agentencoding:4},multidesktopsettings={quality:20,scaling:128,framerate:1e3,agentencoding:4},debugLevel=parseInt("{{{debuglevel}}}"),features=parseInt("{{{features}}}"),features2=parseInt("{{{features2}}}"),sessionTime=parseInt("{{{sessiontime}}}"),webRelayPort=parseInt("{{{webRelayPort}}}"),webRelayDns="{{{webRelayDns}}}",hidePowerTimeline="{{{hidePowerTimeline}}}",showNotesPanel="{{{showNotesPanel}}}",sessionRefreshTimer=null,domain="{{{domain}}}",domainUrl="{{{domainurl}}}",authCookie="{{{authCookie}}}",authRelayCookie="{{{authRelayCookie}}}",logoutControls=JSON.parse(decodeURIComponent("{{{logoutControls}}}")),authCookieRenewTimer=null,multiDesktop={},serverPublicNamePort="{{{serverDnsName}}}:{{{serverPublicPort}}}",amtScanResults=null,debugmode=0,windowsBrowser=detectWindowsBrowser(),attemptWebRTC=0!=(128&features),webrtcconfiguration="{{{webrtcconfig}}}";if(""==webrtcconfiguration)webrtcconfiguration=null;else try{webrtcconfiguration=JSON.parse(decodeURIComponent(webrtcconfiguration))}catch(e){console.log('Invalid WebRTC config: "'+webrtcconfiguration+'".'),webrtcconfiguration=null}var passRequirements="{{{passRequirements}}}";""!=passRequirements&&(passRequirements=JSON.parse(decodeURIComponent(passRequirements)));var customui=""!=(customui="{{{customui}}}")?JSON.parse(decodeURIComponent(customui)):null,deskAspectRatio=0;try{deskAspectRatio=parseInt(getstore("deskAspectRatio","0"))}catch(e){}var uiMode=parseInt(getstore("uiMode",1)),webPageStackMenu=!1,webPageFullScreen=!0,nightMode=setNightMode(),footerBar="1"==getstore("footerBar","1"),sessionActivity=Date.now(),updateSessionTimer=null,pluginHandlerBuilder={{{pluginHandler}}},pluginHandler=null,installedPluginList=(null!=pluginHandlerBuilder&&(pluginHandler=new pluginHandlerBuilder),null),goBackStack=[],CollapsedGroups={};try{CollapsedGroups=JSON.parse(getstore("_collapse","{}"))}catch(e){}var deviceViewSettings={};try{deviceViewSettings=JSON.parse(getstore("_deviceViewSettings","{}"))}catch(e){}var userViewSettings={};try{userViewSettings=JSON.parse(getstore("_usersViewSettings","{}"))}catch(e){}var xterm=null,xtermfit=null,xtermResizeTimer=null,miscState={},checkedNodeids={},deskKeyboardShortcuts=[],deskKeyboardStrings=[],deskLastClipboardSent=null,requestedLastConnects=!1,devicePagingState=null,p11DeskConsoleMsgTimer=null,p12TermConsoleMsgTimer=null,p13FilesConsoleMsgTimer=null,webpSupport=!1;function startup(){if(0==(32&features)){var e=null;try{e=top.location.toString().toLowerCase()}catch(e){}if(top!=self&&(null==e||0==top.active))return void(top.location=self.location)}null!=(urlargs=parseUriArgs()).key&&(urlargs.key=""+urlargs.key),urlargs.key&&0==isAlphaNumeric(urlargs.key)&&delete urlargs.key,urlargs.locale&&0==isAlphaNumeric(urlargs.locale)&&delete urlargs.locale,delete urlargs.user,delete urlargs.pass,delete urlargs.viewmode,delete urlargs.gotonode,delete urlargs.gotodevicename,delete urlargs.gotodeviceip,delete urlargs.gotomesh,delete urlargs.gotouser,delete urlargs.gotougrp,urlargs.key&&(Q("termsLinkFooter").href+="?key="+urlargs.key),(args=parseUriArgs()).key&&0==isAlphaNumeric(args.key)&&delete args.key,args.locale&&0==isAlphaNumeric(args.locale)&&delete args.locale,args.locale||null!=(o=getstore("loctag",0))&&"*"!=o&&(args.locale=o),debugmode=args.debug,null!=args.webrtc&&(attemptWebRTC=1==args.webrtc),QV("p13AutoConnect",debugmode),QV("autoconnectbutton2",debugmode),QV("autoconnectbutton1",debugmode),nightMode&&(document.documentElement.setAttribute("data-bs-theme","dark"),QC("body").add("night"),QS("body")["background-color"]="#000"),toggleFullScreen();try{stars=JSON.parse(getstore("stars","{}"))}catch(e){}var e=0,t=parseInt("{{{hide}}}"),t=((t||args.hide)&&(args.hide&&(e=parseInt(args.hide)),t)&&(e|=t),args.hide=e,QV("uiViewButton5",!(4&args.hide)),adjustPanels(),"");logoutControls&&(null!=logoutControls.name&&(t='<span onmouseup=go(2) CLASS="LogoffLinkColor" style="cursor:pointer">'+format("Welkom {0}.",logoutControls.name)+"</span>"),null!=logoutControls.logoutUrl)&&(t+=format(' <a href="'+logoutControls.logoutUrl+'" CLASS="LogoffLinkColor">Uitloggen</a>')),1&args.hide?QH("logoutControlSpan2",t):QH("logoutControlSpan",t),document.onclick=function(e){hideContextMenu()},document.onkeypress=ondockeypress,document.onkeydown=ondockeydown,document.onkeyup=ondockeyup,window.addEventListener("blur",ondocblur,!1),window.onresize=function(){hideContextMenu(),mainUpdate(512),browserfullscreen=isBrowserFullscreen(),QV("DeskESC",browserfullscreen),null!=xtermfit&&12==xxcurrentView&&xtermfit.fit()},setTimeout(function(){urlargs.filter&&(Q("SearchInput").value=urlargs.filter,Q("KvmSearchInput").value=urlargs.filter),mainUpdate(512)},200),DOMPurify&&DOMPurify.addHook("afterSanitizeAttributes",function(e){"target"in e&&(e.setAttribute("target","_blank"),e.setAttribute("rel","noopener noreferrer")),e.hasAttribute("target")||!e.hasAttribute("xlink:href")&&!e.hasAttribute("href")||e.setAttribute("xlink:show","new")}),QV("textnewui",0!=(1073741824&features2)),(meshserver=MeshServerCreateControl(domainUrl)).onStateChanged=onStateChanged,meshserver.onMessage=onMessage,meshserver.trace=args.trace,meshserver.Start(),Q("sortselect").selectedIndex=sort=getstore("sort",0),Q("sizeselect").selectedIndex=getstore("viewsize",1),Q("KvmSearchInput").value=Q("SearchInput").value=getstore("_search",""),showRealNames=1==getstore("showRealNames",0),Q("RealNameCheckBox").checked=showRealNames,Q("DevFilterSelect").value=getstore("devFilterSelect",0),Q("viewselect").value=getstore("deviceView",1),Q("DeskControl").checked=1==getstore("DeskControl",1),QV("accountChangeEmailAddressSpan",0==(2097152&features)),mainUpdate(3);for(var n=1;n<5;n++)Q("devViewButton"+n).classList.remove("viewSelectorSel");Q("devViewButton"+Q("viewselect").value).classList.add("viewSelectorSel"),Q("p5filetable").addEventListener("drop",p5fileDragDrop,!1),Q("p5filetable").addEventListener("dragover",p5fileDragOver,!1),Q("p5filetable").addEventListener("dragleave",p5fileDragLeave,!1),Q("deskarea0").addEventListener("drop",p11fileDragDrop,!1),Q("deskarea0").addEventListener("dragover",p11fileDragOver,!1),Q("deskarea0").addEventListener("dragleave",p11fileDragLeave,!1),Q("p13filetable").addEventListener("drop",p13fileDragDrop,!1),Q("p13filetable").addEventListener("dragover",p13fileDragOver,!1),Q("p13filetable").addEventListener("dragleave",p13fileDragLeave,!1),setInterval(updateDeviceTimeline,12e4);e=null;try{e=localStorage.getItem("desktopsettings")}catch(e){}null!=e&&(desktopsettings=JSON.parse(e)),e=null;try{e=localStorage.getItem("multidesktopsettings")}catch(e){}null!=e&&(multidesktopsettings=JSON.parse(e)),applyDesktopSettings();for(var o="",a=1;a<27;a++)o+="<option value='"+a+"'>Ctrl-"+String.fromCharCode(64+a)+" ("+a+")</option>";QH("specialkeylist",o),setupGeneralServerStats(),setupServerTimelineStats(),userInterfaceSelectMenu(),setupMeshSummaryStats(),QV("p4UserBatchCreate",0==(524288&features)),d4EditWrapVal=Number(getstore("editorWrap",0)),d4EditSizeVal=Number(getstore("editorSize",0)),d4EditEncodingVal=Number(getstore("editorEncoding",0)),d4EditLineBreakVal=Number(getstore("editorLineBreak",0)),d4ToggleWrap(!0),d4ToggleSize(!0),d4ToggleEncoding(!0),d4ToggleLineBreak(!0),null!=pluginHandler&&pluginHandler.callHook("onWebUIStartupEnd"),-1==["en","ko","ja","zh-chs","zh-cht"].indexOf("{{{lang}}}")&&""!="{{{lang}}}".toLowerCase()&&QC("body").add("nonenglish");var i=document.getElementsByClassName("topbar_td");for(r in i)i[r].innerHTML&&(i[r].innerHTML=i[r].innerHTML.split(" ").join("&nbsp;"));if(null!=customui){if(customui.devicesbarbuttons){o="";for(r in customui.devicesbarbuttons){var s="one"==customui.devicesbarbuttons[r].selection||"many"==customui.devicesbarbuttons[r].selection?"disabled":"";o+='<input id="cui:'+r+'" type="button" value="'+customui.devicesbarbuttons[r].name+'" '+s+' onclick=customUIAction(event,"devicesbarbuttons") />'}QH("devsCustomUIBar",o)}if(customui.desktopbuttons){o="";for(r in customui.desktopbuttons)o+='<input id="cui:'+r+'" type="button" value="'+customui.desktopbuttons[r].name+'" style="float:left" onclick=customUIAction(event,"desktopbuttons") />';QH("desktopCustomUiButtons",o)}if(customui.terminalbuttons){o="";for(r in customui.terminalbuttons)o+='<input id="cui:'+r+'" type="button" value="'+customui.terminalbuttons[r].name+'" style="float:left" onclick=customUIAction(event,"terminalbuttons") />';QH("terminalCustomUiButtons",o)}if(customui.filesbuttons){o="";for(r in customui.filesbuttons)o+='<input id="cui:'+r+'" type="button" value="'+customui.filesbuttons[r].name+'" style="float:left" onclick=customUIAction(event,"filesbuttons") />';QH("filesCustomUiButtons",o)}}10<=sessionTime&&(sessionRefreshTimer=setTimeout(refreshCookieSession,Math.round(6e4*sessionTime*.8))),deskKeyboardShortcuts=[];var r,l=getstore("deskKeyShortcuts","0x0A002E,0x100000,0x100028,0x100026,0x10004C,0x10004D,0x11004D,0x100052,0x020073,0x080057,0x020009,0x100025,0x100027").split(",");for(r in l)""!=l[r]&&deskKeyboardShortcuts.push(parseInt(l[r]));updateDeskShortcutKeys();try{deskKeyboardStrings=JSON.parse(getstore("deskStrings","[]"))}catch(e){}updateDesktopStrings(),updateCollapseAllButton(),dialogBoxDrag(),urlargs.key&&(Q("p6backuplink").href+="?key="+urlargs.key),QV("uiViewButton4",0==(3145728&features2)),Q("DeskType").value=multiTranslate("[KeyboardTyping]|Type"),QV("ScrollToTopButton",0!=(134217728&features2))}function refreshCookieSession(){var e=null;try{e=new XDomainRequest}catch(e){}(e=e||new XMLHttpRequest).open("GET",window.location.origin+domainUrl+"refresh.ashx"),e.timeout=15e3,e.onload=function(){sessionRefreshTimer=setTimeout(refreshCookieSession,Math.round(6e4*sessionTime*.8))},e.onerror=e.ontimeout=function(){sessionRefreshTimer=null},e.send()}function customUIAction(e,t){e=e.srcElement.id;if(0!=e.startsWith("cui:")){var n=customui[t][e.substring(4)];if(null!=n){if("devicesbarbuttons"==t){for(var o=document.getElementsByClassName("DeviceCheckbox"),a=[],i=0;i<o.length;i++)!0===o[i].checked&&a.push(o[i].defaultValue.substring(6));if("string"==typeof n.action&&("event"==n.action&&meshserver.send({action:"uicustomevent",section:t,element:e.substring(4),selectedDevices:a,logmsg:n.logmsg}),n.action.startsWith("dialog:")&&showCustomUiDialog(n.action.substring(7),{section:t,element:e.substring(4),selectedDevices:a}),n.deselectdevices)){for(i=0;i<o.length;i++)o[i].checked=!1;checkedNodeids={},p1updateInfo()}}"devicebuttons"!=t&&"desktopbuttons"!=t&&"terminalbuttons"!=t&&"filesbuttons"!=t||(a=[currentNode._id],"string"==typeof n.action&&("event"==n.action&&meshserver.send({action:"uicustomevent",section:t,element:e.substring(4),selectedDevices:a,logmsg:n.logmsg}),n.action.startsWith("dialog:"))&&showCustomUiDialog(n.action.substring(7),{section:t,element:e.substring(4),selectedDevices:a}))}}}function showCustomUiDialog(e,t){if(null!=customui&&null!=customui.dialogs&&"object"==typeof customui.dialogs[e]){var n="",o=customui.dialogs[e];if("string"==typeof o.text&&(n+="<div style=margin-bottom:8px>"+o.text+"</div>"),"number"==typeof o.buttons&&o.buttons,"object"==typeof o.elements)for(var a in o.elements){var i=o.elements[a];if("text"==i.type&&(n+=addHtmlFormFloating(i.name,"<input id=cui:"+a+" class=form-control autocomplete=off />")),"textarea"==i.type&&(null==i.name?n+="<textarea id=cui:"+a+" style=width:356px;resize:none;height:100px autocomplete=off></textarea>":n+=addHtmlFormFloating(i.name,"<textarea id=cui:"+a+" style=width:230px;resize:none;height:100px autocomplete=off></textarea>")),"droplist"==i.type){var s,r="";for(s in i.options)r+='<option value="'+s+'">'+EscapeHtml(i.options[s])+"</option>";n+=addHtmlFormFloating(i.name,'<select id="cui:'+a+'" class=form-select autocomplete=off />'+r+"</select>")}}setModalContent("xxAddAgent",o.title,n),showModal("xxAddAgentModal","idx_dlgOkButton",{action:"uicustomevent",section:"dialogs",element:e,src:t,values:{},logmsg:o.logmsg})}}function showCustomUiDialogEx(e,t){if(1==e){var n=customui.dialogs[t.element];if("object"==typeof n.elements)for(var o in n.elements){var a=n.elements[o];"droplist"!=a.type&&"textarea"!=a.type&&"text"!=a.type||(t.values[o]=Q("cui:"+o).value)}if(meshserver.send(t),n.deselectdevices){for(var i=document.getElementsByClassName("DeviceCheckbox"),o=0;o<i.length;o++)i[o].checked=!1;checkedNodeids={},p1updateInfo()}}}function adjustPanels(){var e=args.hide,e=(0==footerBar&&(e|=4),QV("masthead",!(1&e)),QV("topbar",!(2&e)),QV("footer",!(4&e)),QV("p1title",!(8&e)),QV("p2title",!(8&e)),QV("p3title",!(8&e)),QV("p4title",!(8&e)),QV("p5title",!(8&e)),QV("p6title",!(8&e)),QV("p10title",!(8&e)),QV("p11title",!(8&e)),QV("p12title",!(8&e)),QV("p13title",!(8&e)),QV("p14title",!(8&e)),QV("p15title",!(8&e)),QV("p16title",!(8&e)),QV("p17title",!(8&e)),QV("p20title",!(8&e)),QV("p21title",!(8&e)),QV("p30title",!(8&e)),QV("p31title",!(8&e)),QV("p40title",!(8&e)),QV("p41title",!(8&e)),QV("p50title",!(8&e)),QV("p51title",!(8&e)),footerBar?QC("body").remove("nofooter"):QC("body").add("nofooter"),0!=args.hide&&(2==uiMode?(QS("container")["grid-template-rows"]=(1&e?"0":"66")+"px fit-content(48px) auto "+(4&e?"0":"45")+"px",QS("container")["-ms-grid-rows"]=(1&e?"0":"66")+"px fit-content(48px) auto "+(4&e?"0":"45")+"px"):(QS("container")["grid-template-rows"]=(1&e?"0":"66")+"px "+(2&e?"0":"24")+"px auto "+(4&e?"0":"45")+"px",QS("container")["-ms-grid-rows"]=(1&e?"0":"66")+"px "+(2&e?"0":"24")+"px auto "+(4&e?"0":"45")+"px")),(1&e?0:66)+(2&e?0:24)+(4&e?0:45)+(8&e?0:60)),t=1<uiMode?24:0,n=(QS("p2info").height="calc(100vh - "+(20+e+t)+"px)",QS("p2info")["max-height"]="calc(100vh - "+(20+e+t)+"px)",QS("p3users")["max-height"]="calc(100vh - "+(50+e)+"px)",QS("p50groups")["max-height"]="calc(100vh - "+(50+e)+"px)",QS("p3events").height="calc(100vh - "+(50+e)+"px)",QS("p5filetable").height="calc(100vh - "+(99+e)+"px)",QS("p13filetable").height="calc(100vh - "+(127+e+t)+"px)",QS("serverMainStats").height="calc(100vh - "+(50+e+t)+"px)",QS("serverMainStats")["max-height"]="calc(100vh - "+(50+e+t)+"px)",QS("xdevices")["max-height"]="calc(100vh - "+(46+e)+"px)",QS("xdevicesmap")["max-height"]="calc(100vh - "+(46+e)+"px)",QS("p15agentConsole").height="calc(100vh - "+(84+e+t)+"px)",QS("p15agentConsole")["max-height"]="calc(100vh - "+(84+e+t)+"px)",QS("p15agentConsoleText").height="calc(100vh - "+(81+e+t)+"px)",QS("p15agentConsoleText")["max-height"]="calc(100vh - "+(81+e+t)+"px)",!(0===args.xterm||null!=terminal&&null==xterm));fullscreen?(QS("deskarea3x").height=null,QS("deskarea3x")["max-height"]=null,QS("p14iframe").height=null,QS("p14iframe")["max-height"]=null,n&&(QS("termarea3x").height="calc(100vh - 55px)",QS("termarea3xdiv").height="calc(100vh - 55px)",QS("termarea3x")["max-width"]="calc(1px)")):(QS("deskarea3x").height="calc(100vh - "+(74+e+t)+"px)",QS("deskarea3x")["max-height"]="calc(100vh - "+(74+e+t)+"px)",QS("p14iframe").height="calc(100vh - "+(23+e+t)+"px)",QS("p14iframe")["max-height"]="calc(100vh - "+(23+e+t)+"px)",n&&(QS("termarea3x").height="calc(100vh - "+(74+e+t)+"px)",QS("termarea3xdiv").height="calc(100vh - "+(74+e+t)+"px)",QS("termarea3x")["max-width"]="calc(1px)")),QS("p43iframe").height="calc(100vh - "+(84+e)+"px)",QS("p43iframe")["max-height"]="calc(100vh - "+(84+e)+"px)",QS("p6info").height="calc(100vh - "+(e-50+t)+"px)",QS("p6info")["max-height"]="calc(100vh - "+(e-50+t)+"px)",QS("p10info").height="calc(100vh - "+(20+e+t)+"px)",QS("p10info")["max-height"]="calc(100vh - "+(20+e+t)+"px)",QS("p17info").height="calc(100vh - "+(20+e+t)+"px)",QS("p17info")["max-height"]="calc(100vh - "+(20+e+t)+"px)",QS("p20main").height="calc(100vh - "+(e-50+t)+"px)",QS("p20main")["max-height"]="calc(100vh - "+(e-50+t)+"px)",QS("p21main").height="calc(100vh - "+(20+e+t)+"px)",QS("p21main")["max-height"]="calc(100vh - "+(20+e+t)+"px)",QS("p30info").height="calc(100vh - "+(20+e+t)+"px)",QS("p30info")["max-height"]="calc(100vh - "+(20+e+t)+"px)",QS("p51info").height="calc(100vh - "+(20+e+t)+"px)",QS("p51info")["max-height"]="calc(100vh - "+(20+e+t)+"px)",QS("p16events").height="calc(100vh - "+(50+e+t)+"px)",QS("p16events")["max-height"]="calc(100vh - "+(50+e+t)+"px)",QS("p31events").height="calc(100vh - "+(50+e+t)+"px)",QS("p31events")["max-height"]="calc(100vh - "+(50+e+t)+"px)",QS("p41events").height="calc(100vh - "+(48+e+t)+"px)",QS("p41events")["max-height"]="calc(100vh - "+(48+e+t)+"px)",QS("p52recordings").height="calc(100vh - "+(48+e+t)+"px)",QS("p52recordings")["max-height"]="calc(100vh - "+(48+e+t)+"px)",QS("p60report").height="calc(100vh - "+(48+e+t)+"px)",QS("p60report")["max-height"]="calc(100vh - "+(48+e+t)+"px)",(32&args.hide||""!="{{currentNode}}".toLowerCase())&&(QV("p10BackButton",!1),QV("p11BackButton",!1),QV("p12BackButton",!1),QV("p13BackButton",!1),QV("p14BackButton",!1),QV("p15BackButton",!1),QV("p16BackButton",!1),QV("p17BackButton",!1)),p1updateInfo()}function toggleAspectRatio(e){1===e&&putstore("deskAspectRatio",deskAspectRatio=(deskAspectRatio+1)%3),deskAdjust()}function toggleStackMenu(e){1==webPageFullScreen&&(1===e&&putstore("webPageStackMenu",webPageStackMenu=!webPageStackMenu),0==webPageStackMenu?QC("body").remove("menu_stack"):(QC("body").add("menu_stack"),10<=xxcurrentView&&QC("column_l").remove("room4submenu")),deskAdjust())}function showUserInterfaceSelectMenu(){if(!xxdialogMode){Q("uiViewButton1").classList.remove("uiSelectorSel"),Q("uiViewButton2").classList.remove("uiSelectorSel"),Q("uiViewButton3").classList.remove("uiSelectorSel"),Q("uiViewButton4").classList.remove("uiSelectorSel"),Q("uiViewButton5").classList.remove("uiSelectorSel");try{Q("uiViewButton"+uiMode).classList.add("uiSelectorSel")}catch(e){}QV("uiMenu","none"==QS("uiMenu").display),nightMode&&Q("uiViewButton4").classList.add("uiSelectorSel"),footerBar&&Q("uiViewButton5").classList.add("uiSelectorSel")}}function userInterfaceSelectMenu(e){e&&putstore("uiMode",uiMode=e),webPageFullScreen=uiMode<3,webPageStackMenu=1<uiMode,toggleFullScreen(0),toggleStackMenu(0),webPageStackMenu&&10<=xxcurrentView?QC("column_l").add("room4submenu"):QC("column_l").remove("room4submenu"),adjustPanels()}function toggleNightMode(){var e;xxdialogMode||(e=getstore("nightMode","0"),xxdialogButtons=3,setModalContent("xxAddAgent","Nacht Modus","<input type=radio id=night0 name=nightmoderadio value=0 "+(0==e?"checked":"")+"><label for=night0>Browser standaard</label><br>"+("<input type=radio id=night2 name=nightmoderadio value=2 "+(2==e?"checked":"")+"><label for=night2>Lichte modus</label><br>")+("<input type=radio id=night1 name=nightmoderadio value=1 "+(1==e?"checked":"")+"><label for=night1>Donkere modus</label><br>")),showModal("xxAddAgentModal","idx_dlgOkButton",toggleNightModeEx),QV("uiMenu",!1))}function toggleNightModeEx(){var e="0";Q("night1").checked&&(e="1"),putstore("nightMode",e=Q("night2").checked?"2":e),setNightMode()}function setNightMode(){var e=getstore("nightMode","0");return nightMode=!1,0!=(1048576&features2)&&(e="1"),"1"==(e=0!=(2097152&features2)?"2":e)?nightMode=!0:"0"==e&&window.matchMedia&&(nightMode=window.matchMedia("(prefers-color-scheme: dark)").matches),nightMode?(document.documentElement.setAttribute("data-bs-theme","dark"),QC("body").add("night"),QS("body")["background-color"]="#000"):(document.documentElement.setAttribute("data-bs-theme","light"),QC("body").remove("night"),QS("body")["background-color"]="#d3d9d6"),nightMode}function toggleFooterBarMode(){putstore("footerBar",(footerBar=!footerBar)?"1":"0"),QS("container")["grid-template-rows"]=null,QS("container")["-ms-grid-rows"]=null,adjustPanels()}function toggleFullScreen(e){var t=document.getElementById("page_leftbar");1===e&&putstore("webPageFullScreen",webPageFullScreen=!webPageFullScreen),0==webPageFullScreen?(QC("body").remove("menu_stack"),QC("body").remove("fullscreen"),QC("body").remove("arg_hide"),10<=xxcurrentView&&QC("column_l").add("room4submenu"),QV("UserDummyMenuSpan",!1),t.classList.add("d-none")):(QC("body").add("fullscreen"),16&args.hide&&QC("body").add("arg_hide"),QV("page_leftbar",!(16&args.hide)),QV("MainMenuSpan",!(16&args.hide)),10<=xxcurrentView&&QC("column_l").remove("room4submenu"),QV("UserDummyMenuSpan",xxcurrentView<10&&webPageFullScreen),t.classList.remove("d-none")),mainUpdate(512),QV("body",!0)}function saveUserInterfaceMode(){var e=3;Q("ui0").checked&&(e=2),getstore("uiViewMode",3)!=e&&(putstore("uiViewMode",e),(e=new URL(window.location.href)).searchParams.has("sitestyle")&&(e.searchParams.delete("sitestyle"),window.history.replaceState({},document.title,e.toString())),reload())}function toggleBootstrapUIMode(){var e,t;xxdialogMode||(t="<div class=form-check><input type=radio class=form-check-input id=ui0 name=uiradio value=2 "+(2==(e=getstore("uiViewMode",3))?"checked":"")+"><label class=form-check-label for=ui0>Classic</label></div>",setModalContent("xxAddAgent","User Interface",t+="<div class=form-check><input type=radio class=form-check-input id=ui1 name=uiradio value=3 "+(3==e?"checked":"")+"><label class=form-check-label for=ui1>Modern</label></div>"),showModal("xxAddAgentModal","idx_dlgOkButton",saveUserInterfaceMode),QV("uiMenu",!1))}function getNodeFromId(e){if(null!=nodes)for(var t in nodes)if(nodes[t]._id==e)return nodes[t];return null}function reload(){var e=window.location.href;(e=e.endsWith("/#")?e.substring(0,e.length-2):e).endsWith("#")&&(e=e.substring(0,e.length-1)),window.location.href=e}function onStateChanged(e,t,n,o){0==t?(setDialogMode(0),go(0),deviceShares=powerTimelineUpdate=powerTimelineNode=powerTimelineReq=powerTimeline=null,deleteAllNotifications(),hideContextMenu(),QV("verifyEmailId2",!1),QV("logoutControl",!1),"noauth"==o?QH("p0span","Kan authenticatie niet uitvoeren"):"invalidorigin"==o?QH("p0span","Ongeldige herkomst in HTTP-verzoek"):(2==n?autoReconnect&&setTimeout(serverPoll,5e3):QH("p0span","Kan geen websocket aansluiten"),null!=authCookieRenewTimer&&(clearInterval(authCookieRenewTimer),authCookieRenewTimer=null))):2==t&&(meshserver.send({action:"usergroups"}),meshserver.send({action:"meshes"}),meshserver.send({action:"nodes",id:"{{currentNode}}",skip:null==devicePagingState?0:devicePagingState.skip}),meshserver.send({action:"loginTokens"}),null!=pluginHandler&&meshserver.send({action:"plugins"}),""=="{{currentNode}}".toLowerCase()&&meshserver.send({action:"files"}),""=="{{viewmode}}".toLowerCase()&&go(1),authCookieRenewTimer=setInterval(function(){meshserver.send({action:"authcookie"})},18e5),40==xxcurrentView)&&refreshServerTimelineStats()}function serverPoll(){var e=null;try{e=new XDomainRequest}catch(e){}(e=e||new XMLHttpRequest).open("HEAD",window.location.href),e.timeout=15e3,e.onload=function(){e.status<500?reload():setTimeout(serverPoll,1e4)},e.onerror=e.ontimeout=function(){setTimeout(serverPoll,1e4)},e.send()}function detectWindowsBrowser(){var e=window.navigator.userAgent.toUpperCase();return 0<=e.indexOf("WINDOWS")||0<=e.indexOf("WIN32")||0<=e.indexOf("WIN64")}function updateSiteAdmin(){var e=parseInt("{{{serverfeatures}}}"),t=userinfo.siteadmin,n=4294967295!=t&&0!=(1024&t)||0!=(256&features2);QV("p2AccountSecurity",0==(4&features)&&0==serverinfo.domainauth&&0!=(4096&features)&&0==n),QV("p2AccountActions",!n),QV("managePhoneNumber1",33554432&features&&67108864&features&&1!=serverinfo.lock2factor),QV("managePhoneNumber2",33554432&features&&!(67108864&features)&&1!=serverinfo.lock2factor),QV("manageMessaging1",33554432&features2&&67108864&features2&&1!=serverinfo.lock2factor),QV("manageMessaging2",33554432&features2&&!(67108864&features2)&&1!=serverinfo.lock2factor),QV("manageEmail2FA",8388608&features&&1!=serverinfo.lock2factor),QV("p2AccountPassActions",0==(4&features)&&0==serverinfo.domainauth&&null!=userinfo&&0==userinfo._id.split("/")[2].startsWith("~")),QV("accountCreateLoginTokenSpan",128&features2),QV("p2AccountImageFrame",!n),QV("p2ServerActions",21&t&&0!=(143&e)),QV("LeftMenuMyServer",21&t&&0!=(64&e)),QV("MainMenuMyServer",21&t),QV("p2ServerActionsBackup",1&t&&0!=(1&e)),QV("p2ServerActionsRestore",4&t&&0!=(2&e)),QV("p2ServerActionsVersion",16&t&&0!=(4&e)),QV("p2ServerActionsErrors",16&t&&0!=(8&e)),QV("p2ServerActionsConfig",16&t&&0!=(128&e)),QV("MainMenuMyFiles",8&t),QV("LeftMenuMyFiles",8&t),0==(8&t)&&5==xxcurrentView&&(setDialogMode(0),go(1)),null!=currentNode&&gotoDevice(currentNode._id,xxcurrentView,!0),null!=userinfo.flags&&1&userinfo.flags?(null==userinfo.accountImageRnd&&(userinfo.accountImageRnd=Math.floor(9999999999*Math.random())),Q("p2AccountImage").src="userimage.ashx?rnd="+userinfo.accountImageRnd):Q("p2AccountImage").src="images/user-256.png",0!=(2&userinfo.siteadmin)?(null==users&&meshserver.send({action:"users"}),null==wssessions&&meshserver.send({action:"wssessioncount"}),mainUpdate(24576)):(wssessions=users=null,mainUpdate(16384),(4==xxcurrentView||30<=xxcurrentView&&xxcurrentView<40)&&(setDialogMode(0),go(1),currentUser=null)),meshserver.send({action:"events",limit:parseInt(p3limitdropdown.value)}),QV("ServerConsole",4294967295===userinfo.siteadmin&&0!=(16&e)),QV("ServerTrace",4294967295===userinfo.siteadmin&&0!=(32&e)),115==xxcurrentView&&4294967295!=userinfo.siteadmin&&go(6),6==xxcurrentView&&0==(21&userinfo.siteadmin)&&go(1),0!=(21&t)&&meshserver.send({action:"serverstats",interval:1e4})}check_webp_feature("lossy",function(e,t){(webpSupport=t)||(d7encoding.options[1].disabled=!0,d7encoding.value=1)}),window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").addEventListener("change",setNightMode);var updateNaggleTimer=null,updateNaggleFlags=0;function mainUpdate(e){updateNaggleFlags|=e,null==updateNaggleTimer&&(updateNaggleTimer=setTimeout(function(){512&updateNaggleFlags&&center(),1&updateNaggleFlags&&onSearchInputChanged(),2&updateNaggleFlags&&onSortSelectChange(!1),128&updateNaggleFlags&&updateMeshes(),4&updateNaggleFlags&&(updateDevices(),updateDeviceDetails(),21==xxcurrentView)&&p21updateMesh(),8&updateNaggleFlags&&drawNotifications(),16&updateNaggleFlags&&32768&features&&updateMapMarkers(),32&updateNaggleFlags&&eventsUpdate(),64&updateNaggleFlags&&32768&features&&refreshMap(!1,!0),256&updateNaggleFlags&&drawDeviceTimeline(),1024&updateNaggleFlags&&deviceEventsUpdate(),2048&updateNaggleFlags&&userEventsUpdate(),4096&updateNaggleFlags&&p20updateMesh(),8192&updateNaggleFlags&&updateUserGroups(),16384&updateNaggleFlags&&updateUsers(),32768&updateNaggleFlags&&updateRecordings(),65536&updateNaggleFlags&&updateLoginTokens(),updateNaggleTimer=null,updateNaggleFlags=0,gotoStartViewPage()},150))}function count2factoraAuths(){var e;return null==userinfo?-1:(e=0,1==userinfo.otpsecret&&e++,0<userinfo.otphkeys&&(e+=userinfo.otphkeys),8388608&features&&1==userinfo.otpekey&&e++,33554432&features&&67108864&features&&null!=userinfo.phone&&e++,33554432&features2&&67108864&features2&&null!=userinfo.msghandle&&e++,0<e&&0<userinfo.otpkeys&&0==(262144&features2)&&e++,e)}var backupCodesWarningDone=!1;function updateSelf(){var e,t=count2factoraAuths(),n=4294967295!=userinfo.siteadmin&&0!=(1024&userinfo.siteadmin),n=(QV("verifyEmailId",!0!==userinfo.emailVerified&&null!=userinfo.email&&1==serverinfo.emailcheck),QV("verifyEmailId2",!0!==userinfo.emailVerified&&null!=userinfo.email&&1==serverinfo.emailcheck&&0==n),QV("manageOtp",1!=serverinfo.lock2factor&&0<t&&0==(262144&features2)),QV("authPhoneNumberCheck",null!=userinfo.phone),QV("authMessagingCheck",null!=userinfo.msghandle),QV("authEmailSetupCheck",1==userinfo.otpekey&&null!=userinfo.email&&1==userinfo.emailVerified),QV("authDuoSetupCheck",1==userinfo.otpduo&&0!=(536870912&features2)),QV("authAppSetupCheck",1==userinfo.otpsecret),QV("manageAuthApp",1!=serverinfo.lock2factor&&(1==userinfo.otpsecret||0==(131072&features2))),QV("manageDuoApp",1!=serverinfo.lock2factor&&0!=(536870912&features2)),QV("authKeySetupCheck",0<userinfo.otphkeys),QV("authPushAuthDevCheck",0<userinfo.otpdev&&0!=(64&features2)),QV("authCodesSetupCheck",0<userinfo.otpkeys),QV("managePushAuthDev",1!=serverinfo.lock2factor&&64&features2&&0<t),QV("manageHardwareOtp",1!=serverinfo.lock2factor),mainUpdate(4228),0==backupCodesWarningDone&&1==t&&0==(524288&features2)&&(addNotification({text:"Voeg back-upcodes met twee factoren toe. Als de huidige factor verloren gaat, is er geen manier om dit account te herstellen.",title:"Twee-factor authenticatie",tag:"backupcodes"}),backupCodesWarningDone=!0),4294967295==userinfo.siteadmin||0==(64&userinfo.siteadmin));QV("p2createMeshLink1",n),QV("p2createMeshLink2",n),QV("getStarted1",n),QV("getStarted2",!n),"number"==typeof userinfo.passchange&&(-1==userinfo.passchange?QH("p2nextPasswordUpdateTime"," - Reset bij volgende inlog."):null!=passRequirements&&"number"==typeof passRequirements.reset&&((t=userinfo.passchange+86400*passRequirements.reset-Math.floor(Date.now()/1e3))<0?QH("p2nextPasswordUpdateTime"," - Reset bij volgende inlog."):t<3600?(n=Math.floor(t/60),QH("p2nextPasswordUpdateTime",format(1==n?" - Herstart in {0} days.":" - Herstart in {0} minuten.",n))):t<86400?(e=Math.floor(t/3600),QH("p2nextPasswordUpdateTime",format(1==e?" - Herstart in 1 uur.":" - Herstart in {0} uren.",e))):(n=Math.floor(t/86400),QH("p2nextPasswordUpdateTime",format(1==e?" - Herstart in {0} dag.":" - Herstart in {0} dagen.",n))))),QV("MainMenuMyUsers",null!=users&&0==(4&features)||0!=(512&userinfo.siteadmin)&&0!=(134217728&features)),QV("LeftMenuMyUsers",null!=users&&0==(4&features)||0!=(512&userinfo.siteadmin)&&0!=(134217728&features)),QV("UsersGeneral",null!=users&&0==(4&features)),QV("UsersGroups",null!=users&&0==(4&features)),QV("UsersRecordings",0!=(512&userinfo.siteadmin)&&0!=(134217728&features))}function setSessionActivity(){sessionActivity=Date.now(),QH("idleTimeoutNotify","")}function checkIdleSessionTimeout(){var e=Date.now()-sessionActivity;e>serverinfo.timeout?(null!=desktop&&(desktop.Stop(),webRtcDesktopReset(),(desktopNode=desktop=null)!=pluginHandler)&&pluginHandler.callHook("onDesktopDisconnect"),null!=terminal&&(terminal.Stop(),terminal=null),null!=files&&(files.Stop(),files=null),serverinfo.logoutOnIdleSessionTimeout&&(window.location.href="logout")):(e=Math.round((serverinfo.timeout-e)/1e3))<=60?QH("idleTimeoutNotify","<br />"+format(1==e?"1 seconde totdat de verbinding wordt verbroken":"{0} seconden totdat de verbinding wordt verbroken",e)):(e=Math.round(e/60))<=5&&QH("idleTimeoutNotify","<br />"+format(1==e?"1 minuut totdat de verbinding wordt verbroken":"{0} minuten totdat de verbinding wordt verbroken",e))}function onMessage(H,n){switch(n.action){case"trace":serverTrace.unshift(n),displayServerTrace();break;case"intersession":"removeNotify"==n.subaction&&notificationDelete(n.id);break;case"traceinfo":"object"==typeof n.traceSources&&(null!=n.traceSources&&0<n.traceSources.length?(serverTraceSources=n.traceSources,QH("p41traceStatus",EscapeHtml(n.traceSources.join(", ")))):(serverTraceSources=[],QH("p41traceStatus","Geen")));break;case"serverstats":updateGeneralServerStats(n);break;case"serverwarnings":if(null!=n.warnings&&0<n.warnings.length){var R={1:"",2:"Ontbrekende WebDAV parameters.",3:'Niet herkende configuratie instelling "{0}".',4:"WebSocket compressie is uitgeschakeld, deze functie werkt niet meer in NodeJS v11.11 tot v12.15 en v13.2",5:"Kan Intel AMT TLS rootcertificaat voor standaarddomein niet laden.",6:"Kan Intel AMT TLS rootcertificaat voor domein {0} niet laden.",7:"CIRA lokale FQDN's genegeerd wanneer server in LAN-only of WAN-only modus.",8:"Er mogen niet meer dan 4 CIRA lokale FQDN's zijn. Waarde wordt genegeerd.",9:"Agent has hcontrole wordt overgeslagen, dit is onveilig.",10:"Ontbrekend Let's Encrypt e-mailadres.",11:"Ongeldige Let's Encrypt hostnamen.",12:"Ongeldige Let's Encrypt namen, mag geen * bevatten.",13:"Kan de Let's Encrypt module niet instellen.",14:"Ongeldige Let's Encrypt-namen, onmogelijk om te verhelpen: {0}",15:"Ongeldige Let's Encrypt email adres, onmogelijk om te verhelpen: {0}",16:"Kan CloudFlare vertrouwde proxy IPv6 adreslijst niet laden.",17:"SendGrid server heeft beperkte mogelijkeden LAN modus.",18:"SMTP server heeft beperkte mogelijkheden in LAN modus.",19:"SMS gateway heeft beperkte mogelijkheden in LAN modus.",20:'Ongeldige "LoginCookieEncryptionKey" in config.json.',21:"Back-uppad kan niet worden ingesteld in de map meshcentral-data, back-upinstellingen genegeerd.",22:"Kan de agent niet ondertekenen {0}: {1}",23:"Kan agent pictogram bestand niet laden: {0}.",24:"Kan agent logo bestand niet laden: {0}.",25:"Deze NodeJS-versie ondersteunt OpenID niet.",26:"Deze NodeJS versie ondersteunt geen Discord.js.",27:"Firebase vereist nu een JSON bestand voor een serviceaccount, Firebase is uitgeschakeld."},e="";for(r in n.warnings)"string"==typeof(t=n.warnings[r])?e+="<div style=color:red;padding-bottom:6px><b>Waarschuwing: "+t+"</b></div>":(null==(a=R[t.id])?a=t.msg:null!=t.args&&(a=format(a,...t.args)),e+="<div style=color:red;padding-bottom:6px><b>Waarschuwing: "+a+"</b></div>");QH("serverWarnings",e),QV("serverWarningsDiv",!0)}break;case"servertimelinestats":setServerTimelineStats(n.events);break;case"authcookie":authCookie=n.cookie,authRelayCookie=n.rcookie;break;case"serverinfo":if((serverinfo=n.serverinfo).timeout&&(setInterval(checkIdleSessionTimeout,1e4),checkIdleSessionTimeout()),1==debugmode&&console.log("Server time: ",printDateTime(new Date(serverinfo.serverTime))),setupServiceWorker(),null!=serverinfo.certExpire&&0<=(c=Math.floor((serverinfo.certExpire-Date.now())/864e5))&&c<20&&(QH("serverCertWarnings","<div style=color:red;padding-bottom:6px><b>Waarschuwing: "+format("Certificaat verloopt over {0} dag(en)",c)+"</b></div>"),QV("serverWarningsDiv",!0),addNotification({text:format("Certificaat verloopt over {0} dag(en)",c)})),serverinfo.preConfiguredRemoteInput){e="";for(r in serverinfo.preConfiguredRemoteInput)e+='<div class="cmtext" onclick="cmdeskpreconfigtypeaction('+r+',event)">'+EscapeHtml(serverinfo.preConfiguredRemoteInput[r].name)+"</div>";""!=e&&(e+="<hr />"),QH("deskPreConfigShortcutContextMenu1",e)}if(serverinfo.preConfiguredScripts){var e="",t="";for(r in serverinfo.preConfiguredScripts){var o=serverinfo.preConfiguredScripts[r],a='<div class="cmtext" onclick="cmdeskpreconfigscriptaction('+r+',event)">'+EscapeHtml(serverinfo.preConfiguredScripts[r].name)+"</div>";3!=o.type&&(e+=a),3<=o.type&&(t+=a)}QH("deskPreConfigScriptContextMenu1",e),QH("deskPreConfigScriptContextMenu2",t)}break;case"userinfo":userinfo=n.userinfo,updateSiteAdmin(),updateSelf();break;case"users":for(var i in users={},n.users)users[n.users[i]._id]=n.users[i];null!=currentUser&&(currentUser=users[currentUser._id]),mainUpdate(16384),updateSelf();break;case"wssessioncount":wssessions=n.wssessions,mainUpdate(16384);break;case"meshes":for(var i in meshes={},n.meshes)meshes[n.meshes[i]._id]=n.meshes[i];null!=currentMesh&&(currentMesh=meshes[currentMesh._id]),mainUpdate(132);break;case"usergroups":var s=0;if(Array.isArray(n.ugroups))for(var r in usergroups={},n.ugroups)s++,usergroups[n.ugroups[r]._id]=n.ugroups[r];else for(var r in usergroups=n.ugroups,n.ugroups)s++,n.ugroups[r]._id=r;0==s&&(usergroups=null),mainUpdate(8192);break;case"files":filetree=setupBackPointers(n.filetree),updateFiles(),d3updatefiles();break;case"nodes":for(var i in nodes=[],n.nodes)for(var l in n.nodes[i])null==n.nodes[i][l]._id?console.log("Invalid node ("+l+"): "+JSON.stringify(n.nodes)):(null==n.nodes[i][l].name&&(n.nodes[i][l].name="???"),n.nodes[i][l].namel=n.nodes[i][l].name.toLowerCase(),n.nodes[i][l].rname?n.nodes[i][l].rnamel=n.nodes[i][l].rname.toLowerCase():n.nodes[i][l].rnamel=n.nodes[i][l].namel,n.nodes[i][l].meshnamel=meshes[i]?meshes[i].name.toLowerCase():"*",n.nodes[i][l].meshid=i,n.nodes[i][l].state=n.nodes[i][l].state||0,n.nodes[i][l].icon||(n.nodes[i][l].icon=1),n.nodes[i][l].ident=++nodeShortIdent,nodes.push(n.nodes[i][l]));for(var r in stars)null==getNodeFromId(r)&&delete stars[r];null!=currentNode&&0==IsNodeViewable(currentNode)&&(currentNode=null,go(1)),null!=currentNode&&(null!=(currentNode=getNodeFromId(currentNode._id))?gotoDevice(currentNode._id,xxcurrentView,!0):go(1)),devicePagingState=null==n.totalcount?null:{total:n.totalcount,skip:n.skip,limit:n.limit},updateDevicePageState(),mainUpdate(71);break;case"powertimeline":if(n.nodeid==powerTimelineReq){for(var r in powerTimelineNode=n.nodeid,powerTimeline=n.timeline,powerTimelineUpdate=Date.now()+3e5,powerTimeline)r%2==1&&(powerTimeline[r]=1e3*powerTimeline[r]);currentNode._id==n.nodeid&&mainUpdate(256)}break;case"deviceShares":n.nodeid==deviceSharesReq&&(deviceSharesNode=n.nodeid,deviceShares=n.deviceShares,null!=currentNode&&currentNode._id==n.nodeid)&&gotoDevice(currentNode._id,xxcurrentView,!0);break;case"deviceMeshShares":n.meshid==deviceSharesReq&&(deviceSharesNode=n.meshid,deviceShares=n.deviceShares,null!=currentMesh&&currentMesh._id==n.meshid)&&p20updateMesh();break;case"getsysinfo":n.nodeid==powerTimelineReq&&(!0===n.noinfo?updateDeviceDetails(getNodeFromId(n.nodeid)):updateDeviceDetails(getNodeFromId(n.nodeid),n.hardware));break;case"lastconnect":null!=(T=getNodeFromId(n.nodeid))&&(T.lastconnect=n.time,T.lastaddr=n.addr,currentNode._id==T._id)&&""==Q("MainComputerState").innerHTML&&null!=T.lastconnect&&QH("MainComputerState","<span>Laatst gezien<br />"+printDateTime(new Date(T.lastconnect))+"</span>");break;case"lastconnects":var F=Object.keys(n.lastconnects);for(r in F){var O=F[r];null!=(T=getNodeFromId(O))&&(T.lastconnect=n.lastconnects[O])}mainUpdate(4);case"msg":if(null!=n.nodeid){var d=-1;if(null!=nodes)for(var r in nodes)if(nodes[r]._id==n.nodeid){d=r;break}if(-1!=d)if("cpuinfo"===n.type&&null!=currentNode&&currentNode._id==n.nodeid){var c=Date.now()/1e3,u=0,p=0;"number"==typeof n.cpu.total&&(u=n.cpu.total),"number"==typeof n.memory.percentConsumed&&(p=n.memory.percentConsumed),deviceDetailsStatsData.push([c,u,p]),deviceDetailsStatsDraw(n)}else if("console"===n.type)p15consoleReceive(nodes[d],n.value,n.source);else if("notify"===n.type){if(0==(8&(l=getstore("notifications",0)))&&null!=n.amtMessage)break;l={text:n.value,title:n.title,icon:n.icon,titleid:n.titleid,msgid:n.msgid,args:n.args};null!=n.id&&(l.id=n.id),null!=n.nodeid&&(l.nodeid=n.nodeid),null!=n.tag&&(l.tag=n.tag),null!=n.url&&(l.url=n.url),null!=n.username&&(l.username=n.username),"number"==typeof n.maxtime&&(l.maxtime=n.maxtime),addNotification(l)}else if("ps"===n.type)showDeskToolsProcesses(n);else if("services"===n.type)showDeskToolsServices(n);else if("service"===n.type)showServiceDetailsDialog(n);else if("getclip"===n.type&&null!=currentNode&&currentNode._id==n.nodeid)1==n.tag&&"clipboard"===xxdialogTag?Q("d2clipText").value=n.data:2===n.tag&&null!=navigator.clipboard&&navigator.clipboard.writeText(n.data).then(function(){}).catch(function(e){console.log(e)});else if("setclip"===n.type&&"clipboard"===xxdialogTag&&null!=currentNode&&currentNode._id==n.nodeid)QH("dlgClipStatus",n.success?"<span style=color:green>Geslaagd</span>":"<span style=color:red>Mislukt</span>"),setTimeout(function(){try{QH("dlgClipStatus","")}catch(e){}},2e3);else if("userSessions"===n.type&&null!=currentNode&&currentNode._id===n.nodeid&&null==desktop){var m=[];if(null!=n.data)for(var r in n.data)"Active"!=n.data[r].State&&"Connected"!=n.data[r].State&&"Console"!=n.data[r].StationName&&3!=debugmode||m.push(n.data[r]);if(0===m.length)connectDesktop(null,1,null,n.tag);else if(1===m.length)connectDesktop(null,1,m[0].SessionId,n.tag);else{var e="",g="{{{userSessionsSort}}}";for(r in m.sort(function(e,t){return e[g]?t[g]?e[g]<t[g]?-1:t[g]<e[g]?1:0:1:-1}),m)e+='<div style="text-align:left;cursor:pointer;background-color:gray;margin:5px;padding:5px;border-radius:5px" onclick=connectDesktop(event,1,'+m[r].SessionId+","+n.tag+")>"+m[r].State+(m[r].StationName?", "+m[r].StationName:""),m[r].Username&&(m[r].Domain?e+=" - "+m[r].Domain+"/"+m[r].Username:e+=" - "+m[r].Username),e+="</div>";QH("p11DeskSessionSelector",e),QV("p11DeskSessionSelector",!0)}}else"psinfo"===n.type?xxdialogTag==="ps|"+n.nodeid+"|"+n.pid&&(e="<div style=max-height:200px;overflow-y:auto>","object"==typeof n.value&&0<Object.keys(n.value).length?(n.value=jsonToCamel(n.value),!n.value.cmd&&n.value.path&&(n.value.cmd=n.value.path),!n.value.processUser&&n.value.userName&&(n.value.processUser=n.value.userName.split("\\")[1]),!n.value.processDomain&&n.value.userName&&(n.value.processDomain=n.value.userName.split("\\")[0]),n.value.processName&&(e+="<div style=padding:4px><div style=padding-bottom:4px>Proces naam</div><div style=word-wrap:break-word;padding-left:6px><b>"+n.value.processName+"</b></div></div>"),n.value.machineName&&(e+=addHtmlValue5("Machine naam",n.value.machineName)),n.value.cmd&&(e+="<div style=padding:4px><div style=padding-bottom:4px>Opdrachtregel</div><div style=word-wrap:break-word;padding-left:6px><b>"+n.value.cmd+"</b></div></div>"),n.value.mainWindowTitle&&(e+="<div style=padding:4px><div style=padding-bottom:4px>Venstertitel</div><div style=word-wrap:break-word;padding-left:6px><b>"+n.value.mainWindowTitle+"</b></div></div>"),n.value.processUser&&(e+=addHtmlValue5("Gebruiker",n.value.processUser)),n.value.processDomain&&(e+=addHtmlValue5("Domein",n.value.processDomain)),n.value.startTime&&(e+=addHtmlValue5("Start tijd",n.value.startTime)),e+="<hr />",n.value.PriorityBoostEnabled&&(e+=addHtmlValue5("Prioriteitsboost",n.value.PriorityBoostEnabled?"Ingeschakeld":"Uitgeschakeld")),n.value.sessionId&&(e+=addHtmlValue5("Sessie ID",n.value.sessionId)),n.value.handleCount&&(e+=addHtmlValue5("Telling verwerken",n.value.handleCount)),n.value.privilegedProcessorTime&&(e+=addHtmlValue5("Bevoorrechte processortijd",format("{0} seconden",n.value.privilegedProcessorTime))),n.value.totalProcessorTime&&(e+=addHtmlValue5("Totale processor tijd",format("{0} seconden",n.value.totalProcessorTime))),n.value.userProcessorTime&&(e+=addHtmlValue5("Processortijd gebruiker",format("{0} seconden",n.value.userProcessorTime))),n.value.nonpagedSystemMemorySize&&(e+=addHtmlValue5("Niet gewisseld geheugen",getNiceSize2(n.value.nonpagedSystemMemorySize))),n.value.pagedMemorySize&&(e+=addHtmlValue5("Gewisseld geheugen",getNiceSize2(n.value.pagedMemorySize))),n.value.privateMemorySize&&(e+=addHtmlValue5("Prive geheugen",getNiceSize2(n.value.privateMemorySize))),n.value.virtualMemorySize&&(e+=addHtmlValue5("Virtueel geheugen",getNiceSize2(n.value.virtualMemorySize))),n.value.workingSet&&(e+=addHtmlValue5("Werkset",getNiceSize2(n.value.workingSet))),n.value.peakWorkingSet&&(e+=addHtmlValue5("Piek werkset",getNiceSize2(n.value.peakWorkingSet))),n.value.peakPagedMemorySize&&(e+=addHtmlValue5("Piek gewisseld geheugen",getNiceSize2(n.value.peakPagedMemorySize))),n.value.peakVirtualMemorySize&&(e+=addHtmlValue5("Piek virtueel geheugen",getNiceSize2(n.value.peakVirtualMemorySize)))):e+="Geen informatie verstrekt",e+="</div>",QH("id_dialogOptions",e)):"deskBackground"===n.type&&(""!=n.data?Q("DeskBackgroundButtonImage").style.color="":Q("DeskBackgroundButtonImage").style.color="red")}else"notify"===n.type&&(l={text:n.value,title:n.title,icon:n.icon,titleid:n.titleid,msgid:n.msgid,args:n.args},null!=n.id&&(l.id=n.id),null!=n.tag&&(l.tag=n.tag),null!=n.url&&(l.url=n.url),null!=n.username&&(l.username=n.username),"number"==typeof n.maxtime&&(l.maxtime=n.maxtime),addNotification(l));break;case"getnetworkinfo":if(currentNode._id!=n.nodeid)return;if(updateDeviceDetails(getNodeFromId(n.nodeid),null,n),2==xxdialogMode&&xxdialogTag=="if"+n.nodeid){var e="<div class=dialogText>";if(currentNode.lastconnect&&(e+=addHtmlValue2("Laatste agentverbinding",printDateTime(new Date(currentNode.lastconnect)))),currentNode.lastaddr&&(2<(c=currentNode.lastaddr.split(":")).length?e+=addHtmlValue2("Laatste agentadres",currentNode.lastaddr+' <i class="fa-fw fa-regular fa-clipboard fa-sm" role=button title="Kopieer adres naar het klembord" onclick=copyTextToClip2("'+encodeURIComponentEx(currentNode.lastaddr)+'")></i>'):isPrivateIP(currentNode.lastaddr)?e+=addHtmlValue2("Laatste agentadres",c[0]+' <i class="fa-fw fa-regular fa-clipboard fa-sm" role=button title="Kopieer adres naar het klembord" onclick=copyTextToClip2("'+encodeURIComponentEx(c[0])+'")></i>'):e+=addHtmlValue2("Laatste agentadres",'<a href="https://iplocation.com/?ip='+c[0]+'" rel="noreferrer noopener" target="MeshIPLoopup">'+c[0]+'</a> <i class="fa-fw fa-regular fa-clipboard fa-sm" role=button title="Kopieer adres naar het klembord" onclick=copyTextToClip2("'+encodeURIComponentEx(c[0])+'")></i>')),null!=n.updateTime&&(e+=addHtmlValue2("Laatste update van interfaces",printDateTime(new Date(n.updateTime)))),null!=n.netif)for(var r in n.netif)e+="<hr />",(v=n.netif[r]).name&&(e+=addHtmlValue2("Naam","<b>"+EscapeHtml(v.name)+"</b>")),v.desc&&(e+=addHtmlValue2("Omschrijving",EscapeHtml(v.desc).replace("(R)","&reg;").replace("(r)","&reg;"))),v.dnssuffix&&(e+=addHtmlValue2("DNS-achtervoegsel",EscapeHtml(v.dnssuffix)+' <i class="fa-fw fa-regular fa-clipboard fa-sm" role=button title="Kopieer de naam naar het klembord" onclick=copyTextToClip2("'+encodeURIComponentEx(v.dnssuffix)+'")></i>')),v.mac&&(e+=addHtmlValue2("MAC adres",'<a href="https://maclookup.app/search/result?mac='+v.mac.substring(0,6)+'" rel="noreferrer noopener" target="MeshMACLoopup">'+EscapeHtml(v.mac.toLowerCase())+'</a> <i class="fa-fw fa-regular fa-clipboard fa-sm" role=button title="Kopieer MAC adres naar het klembord" onclick=copyTextToClip2("'+encodeURIComponentEx(v.mac.toLowerCase())+'")></i>')),v.v4addr&&(e+=addHtmlValue2("IPv4 adres",EscapeHtml(v.v4addr)+' <i class="fa-fw fa-regular fa-clipboard fa-sm" role=button title="Kopieer adres naar het klembord" onclick=copyTextToClip2("'+encodeURIComponentEx(v.v4addr)+'")></i>')),v.v4mask&&(e+=addHtmlValue2("IPv4 mask",EscapeHtml(v.v4mask)+' <i class="fa-fw fa-regular fa-clipboard fa-sm" role=button title="Kopieer adres naar het klembord" onclick=copyTextToClip2("'+encodeURIComponentEx(v.v4mask)+'")></i>')),v.v4gateway&&(e+=addHtmlValue2("IPv4 gateway",EscapeHtml(v.v4gateway)+' <i class="fa-fw fa-regular fa-clipboard fa-sm" role=button title="Kopieer adres naar het klembord" onclick=copyTextToClip2("'+encodeURIComponentEx(v.v4gateway)+'")></i>')),v.gatewaymac&&(e+=addHtmlValue2("Gateway MAC",'<a href="https://maclookup.app/search/result?mac='+v.gatewaymac.substring(0,6)+'" rel="noreferrer noopener" target="MeshMACLoopup">'+EscapeHtml(v.gatewaymac.toLowerCase())+'</a> <i class="fa-fw fa-regular fa-clipboard fa-sm" role=button title="Kopieer MAC adres naar het klembord" onclick=copyTextToClip2("'+encodeURIComponentEx(v.gatewaymac.toLowerCase())+'")></i>'));else if(null!=n.netif2)for(var r in n.netif2){var v=n.netif2[r];if(!(0==Array.isArray(v)||v.length<1||null==v[0]||"string"==typeof v[0].mac&&v[0].mac.startsWith("00:00:00:00"))){e=(e+="<hr />")+addHtmlValue2("Naam","<b>"+EscapeHtml(r)+"</b>"),"string"==typeof v[0].mac&&(e+=addHtmlValue2("MAC adres",'<a href="https://maclookup.app/search/result?mac='+v[0].mac.split(":").join("").substring(0,6)+'" rel="noreferrer noopener" target="MeshMACLoopup">'+EscapeHtml(v[0].mac.toLowerCase())+'</a> <i class="fa-fw fa-regular fa-clipboard fa-sm" role=button title="Kopieer MAC adres naar het klembord" onclick=copyTextToClip2("'+encodeURIComponentEx(v[0].mac.toLowerCase())+'")></i>')),v[0].fqdn&&(e+=addHtmlValue2("FQDN",v[0].fqdn));for(var h=0;h<v.length;h++){var f=v[h];"IPv6"==f.family?(f.address&&(e+=addHtmlValue2("IPv6 adres",EscapeHtml(f.address)+' <i class="fa-fw fa-regular fa-clipboard fa-sm" role=button title="Kopieer adres naar het klembord" onclick=copyTextToClip2("'+encodeURIComponentEx(f.address)+'")></i>')),f.netmask&&(e+=addHtmlValue2("IPv6 mask",EscapeHtml(f.netmask)+' <i class="fa-fw fa-regular fa-clipboard fa-sm" role=button title="Kopieer adres naar het klembord" onclick=copyTextToClip2("'+encodeURIComponentEx(f.netmask)+'")></i>')),f.gateway&&(e+=addHtmlValue2("IPv6 gateway",EscapeHtml(f.gateway)+' <i class="fa-fw fa-regular fa-clipboard fa-sm" role=button title="Kopieer adres naar het klembord" onclick=copyTextToClip2("'+encodeURIComponentEx(f.gateway)+'")></i>'))):"IPv4"==f.family&&(f.address&&(e+=addHtmlValue2("IPv4 adres",EscapeHtml(f.address)+' <i class="fa-fw fa-regular fa-clipboard fa-sm" role=button title="Kopieer adres naar het klembord" onclick=copyTextToClip2("'+encodeURIComponentEx(f.address)+'")></i>')),f.netmask&&(e+=addHtmlValue2("IPv4 mask",EscapeHtml(f.netmask)+' <i class="fa-fw fa-regular fa-clipboard fa-sm" role=button title="Kopieer adres naar het klembord" onclick=copyTextToClip2("'+encodeURIComponentEx(f.netmask)+'")></i>')),f.gateway)&&(e+=addHtmlValue2("IPv4 gateway",EscapeHtml(f.gateway)+' <i class="fa-fw fa-regular fa-clipboard fa-sm" role=button title="Kopieer adres naar het klembord" onclick=copyTextToClip2("'+encodeURIComponentEx(f.gateway)+'")></i>'))}}}else e+="<hr />Geen netwerkinterface informatie beschikbaar voor dit apparaat.";e+="</div>",QH("d2netinfo",e)}break;case"serverversion":2==xxdialogMode&&"MeshCentralServerUpdate"==xxdialogTag&&(e="<div class=dialogText>",n.tags.current||(n.tags.current="Onbekend"),n.tags.stable||(n.tags.stable="Onbekend"),n.tags.latest||(n.tags.latest="Onbekend"),e=(e=(e=e+addHtmlValue2("Huidige versie","<b>"+EscapeHtml(n.tags.current)+"</b>")+"<hr />")+addHtmlValue2('<label><input id=d2updateCheck1 type=checkbox class="form-check-input me-2" onclick=server_showVersionDlgUpdate()'+("Onbekend"==n.tags.stable||n.tags.current==n.tags.stable||0==(2048&features)?" disabled":"")+" /> Stabiele versie</label>","<b>"+EscapeHtml(n.tags.stable)+"</b>"))+addHtmlValue2('<label><input id=d2updateCheck2 type=checkbox class="form-check-input me-2" onclick=server_showVersionDlgUpdate()'+("Onbekend"==n.tags.latest||n.tags.current==n.tags.latest||0==(2048&features)?" disabled":"")+" /> Laatste versie</label>","<b>"+EscapeHtml(n.tags.latest)+"</b>")+"</div>",n.tags.current==n.tags.latest&&n.tags.current==n.tags.stable||0==(2048&features)?(setModalContent("xxAddAgent","MeshCentral Versie",e),showModal("xxAddAgentModal","idx_dlgOkButton")):(xxdialogTag=n.tags,setModalContent("xxAddAgent","MeshCentral Versie",e+="<hr />Controleer en klik op OK om de serverupdate te starten."),showModal("xxAddAgentModal","idx_dlgOkButton",function(){server_showVersionDlgEx(2,n.tags)}),server_showVersionDlgUpdate()));break;case"servererrors":2==xxdialogMode&&"MeshCentralServerErrors"==xxdialogTag&&(null==n.data?(setModalContent("xxAddAgent","Server Fouten","Server heeft geen foutenlogboek."),showModal("xxAddAgentModal","idx_dlgOkButton")):(setModalContent("xxAddAgent","MeshCentral serverfouten",e=(e='<div class="dialogText dialogTextLog"><pre id=d2ServerErrorsLogPre>'+EscapeHtml(n.data)+"</pre></div>")+'<br /><div style=float:right><i role=button class="fa-fw fa-solid fa-download fa-sm" title="Foutenlogboek downloaden" onclick=d2CopyServerErrorsToClip()></i></div>'+'<div><label><input id=d2clearErrorsCheck type=checkbox class="form-check-input me-2" onclick=server_showErrorsDlgUpdate() /> Controleer en klik op OK om het foutenlogboek te wissen.</label></div>'),showModal("xxAddAgentModal","idx_dlgOkButton",server_showErrorsDlgEx),server_showErrorsDlgUpdate()));break;case"serverconfig":2==xxdialogMode&&"MeshCentralServerConfig"==xxdialogTag&&(null==n.data?setModalContent("xxAddAgent","Server Configuratie","Server has no config file.","extra-large"):(setModalContent("xxAddAgent","Server Configuratie",4,"extra-large"),QV("d4EncodingButton",!1),QV("d4LineBreakButton",!1),Q("d4editorarea").value=n.data,Q("d4editorarea").setAttribute("readonly","readonly")),showModal("xxAddAgentModal","idx_dlgOkButton"));break;case"serverconsole":p15consoleReceive("serverconsole",n.value);break;case"events":null!=n.nodeid&&null!=currentNode&&n.nodeid==currentNode._id?(currentDeviceEvents=n.events,mainUpdate(1024)):null!=n.userid&&null!=currentUser&&n.userid==currentUser._id?(currentUserEvents=n.events,mainUpdate(2048)):(events=n.events,mainUpdate(32));break;case"recordings":p52recordings=n.events,null!=n.error&&(p52recordings=n.error),updateRecordings();break;case"getcookie":"MCRouter"==n.tag?(-1!=(_=serverinfo.name).indexOf(".")&&0==(2&features)||(_=window.location.hostname),domainUrl.substring(0,domainUrl.length-1),V="mcrouter://"+_+(443==serverinfo.port?"":":"+serverinfo.port)+domainUrl+"control.ashx?c="+authCookie+"&t="+serverinfo.tlshash+"&l={{{lang}}}"+(urlargs.key?"&key="+urlargs.key:""),null!=n.nodeid&&(V+="&nodeid="+n.nodeid),null!=n.tcpport&&(V+="&protocol=1&remoteport="+n.tcpport),n.localRelay&&(V+="&local=1"),n.localport&&(V+="&localport="+n.localport),null!=n.name&&(V+="&name="+encodeURIComponentEx(n.name)),null!=n.ip&&(V+="&remoteip="+n.ip),downloadFile(V+="&appid="+n.protocol+"&autoexit=1","")):"novnc"==n.tag?(u=window.location.origin+domainUrl+"novnc/vnc.html?ws=wss%3A%2F%2F"+window.location.host+encodeURIComponentEx(domainUrl)+(n.localRelay?"local":"mesh")+"relay.ashx%3Fauth%3D"+n.cookie+"&show_dot=1"+(urlargs.key?"&key="+urlargs.key:"")+"&l={{{lang}}}",null!=(T=getNodeFromId(n.nodeid))&&(u+="&name="+encodeURIComponentEx(T.name)),safeNewWindow(u,"mcnovnc/"+n.nodeid)):"mstsc"==n.tag?(p=window.location.origin+domainUrl+"mstsc.html?ws="+n.cookie+(urlargs.key?"&key="+urlargs.key:""),null!=(T=getNodeFromId(n.nodeid))&&(p+="&name="+encodeURIComponentEx(T.name)),n.localRelay&&(p+="&local=1"),safeNewWindow(p,"mcmstsc/"+n.nodeid)):"ssh"==n.tag&&(c=window.location.origin+domainUrl+"ssh.html?ws="+n.cookie+(urlargs.key?"&key="+urlargs.key:""),null!=(T=getNodeFromId(n.nodeid))&&(c+="&name="+encodeURIComponentEx(T.name)),n.localRelay&&(c+="&local=1"),safeNewWindow(c,"mcssh/"+n.nodeid));break;case"getNotes":(l=Q("d2devNotes"))&&n.id==decodeURIComponent(l.attributes.noteid.value)?(n.notes?QH("d2devNotes",decodeURIComponent(n.notes)):QH("d2devNotes",""),0==("true"==l.attributes.ro.value)&&(l.removeAttribute("readonly"),QE("idx_dlgOkButton",!0),QV("idx_dlgOkButton",!0),focusTextBox("d2devNotes"))):(Q("notesPanelArea").innerHTML=n.notes&&marked&&DOMPurify?DOMPurify.sanitize(marked.parse(decodeURIComponent(n.notes),{breaks:!0}),{USE_PROFILES:{html:!0}}):"","true"===showNotesPanel&&n.notes?QV("notesPanel",!0):QV("notesPanel",!1));break;case"otpauth-request":2==xxdialogMode&&"otpauth-request"==xxdialogTag&&(null!=n.err?(u=["","2FA is vergrendeld","Backup codes zijn vergrendeld","Inlogtoken in gebruik","OTP 2FA niet toegestaan","Account is uitgeschakeld","Kan OTPLIB niet laden"],0<n.err&&n.err<u.length?QH("d2optinfo",u[n.err]):QH("d2optinfo",format("Foutmelding #{0}",n.err))):(52==(p=n.secret).length?p=p.split(/(.............)/).filter(Boolean).join(" "):32==p.length&&(p=(p=p.split(/(....)/).filter(Boolean).join(" ")).substring(0,20)+"<br/>"+p.substring(20)),QH("d2optinfo","<table style=width:380px><tr><td style=vertical-align:top>"+format('Installeren <a href="https://play.google.com/store/apps/details?id=com.google.android.apps.authenticator2" rel="noreferrer noopener" target=_blank>Google Authenticator</a> of een compatibele applicatie en scan de streepjescode, gebruik <a href="{0}" rel="noreferrer noopener" target=_blank>deze link</a> of voer de link in geheim. Voer vervolgens het huidige 6-cijferige token hieronder in om 2-staps aanmelding te activeren.',n.url)+'<br /><br />Secret <img src=images/link4.png height=10 width=10 title="Kopieer geheim naar klembord" style=cursor:pointer onclick=d2CopySecretToClip()><br /><tt id=d2optsecret secret="'+n.secret+'" style=font-size:12px>'+p+'</tt><br /><br /></td><td style=width:1px;vertical-align:top><a href="'+n.url+'" rel="noreferrer noopener" target=_blank><div id="qrcode"></div></a></td><tr><td colspan=2 style="text-align:center;border-top:1px solid black"><br />Voer hier het token in voor tweestaps-aanmelding: <input type=text autocomplete="one-time-code" inputmode="numeric" pattern="[0-9]*" onkeypress="return (event.keyCode == 8) || (event.charCode >= 48 && event.charCode <= 57)" onkeyup=account_addOtpCheck(event) onkeydown=account_addOtpCheck() maxlength=6 id=d2otpauthinput type=text></td></table>'),new QRCode(Q("qrcode"),{text:n.url,width:128,height:128,colorDark:"#000000",colorLight:"#EEE",correctLevel:QRCode.CorrectLevel.H}),QV("idx_dlgOkButton",!0),QE("idx_dlgOkButton",!1),Q("d2otpauthinput").focus()));break;case"otpauth-setup":if(xxdialogMode)return;setModalContent("xxAddAgent","Verificatie-app",n.success?"<b style=color:green>Verificatie-app activatie geslaagd</b> U hebt nu een geldig token nodig om opnieuw in te loggen.":"<b style=color:red>Tweestapsverificatie is msilukt.</b> Wis het geheim van de applicatie en probeer het opnieuw. Je hebt maar een paar minuten om de juiste code in te voeren."),showModal("xxAddAgentModal","idx_dlgOkButton");break;case"otpauth-clear":if(xxdialogMode)return;setModalContent("xxAddAgent","Verificatie-app",n.success?"<b>Verificatie-applicatie verwijderd.</b> U kunt deze functie op elk moment opnieuw activeren.":"<b style=color:red>Tweestapsverificatie verwijdering is mislukt.</b> Probeer opnieuw"),showModal("xxAddAgentModal","idx_dlgOkButton");break;case"otpauth-getpasswords":if(xxdialogMode)return;e="Eenmalige tokens kunnen worden gebruikt als secundaire authenticatie. Genereer een set, druk ze af en bewaar ze op een veilige plaats.";if(e+='<div style="border-radius:6px;border: 2px dashed #888;width:100%;margin-top:8px"><div style="padding:8px;font-family:Arial, Helvetica, sans-serif;font-size:20px;font-weight:bold"><table class=selecttext style=width:100%;text-align:center>',n.passwords){var h=0,k="";for(r in n.passwords){++h%2&&(e+="<tr>");for(var x=""+n.passwords[r].p;x.length<8;)x="0"+x;!0===n.passwords[r].u?(e+="<td>"+x.substring(0,4)+"&nbsp;"+x.substring(4),""!=k&&(k+=" "),k+=x):e+="<td><strike style=color:#BBB>"+x.substring(0,4)+"&nbsp;"+x.substring(4)}}else e+="<tr><td>Geen actieve tokens";e=(e+="</table></div></div><br />")+"<div>"+'<input type=button value="Genereer nieuwe tokens" onclick="account_manageOtp(1);"></input>',null!=n.passwords&&(e=(e+='<input type=button value="Wis Tokens" onclick="account_manageOtp(2);"></input>')+'&nbsp;<img src=images/link4.png height=10 width=10 title="Kopieer de geldige code\'s naar het klembord" style=cursor:pointer onclick=copyTextToClip2("'+encodeURIComponentEx(k)+'")>'),setModalContent("xxAddAgent","Beheer back-up codes",e+="</div><br />"),showModal("xxAddAgentModal","idx_dlgOkButton");break;case"otp-hkey-get":if(xxdialogMode&&"otpauth-hardware-manage"!=xxdialogTag)return;var L='<div style="border-radius:6px;border:2px solid #CCC;background-color:#BBB;width:100%;box-sizing:border-box;margin-bottom:6px"><div style="margin:3px;font-family:Arial, Helvetica, sans-serif;font-size:16px;font-weight:bold"><table style=width:100%;text-align:left>',P="</table></div></div>",e='<a href="https://www.yubico.com/" rel="noreferrer noopener" target="_blank">Hardware sleutels</a> worden gebruikt als secundaire inlogverificatie.';if(e+='<div style="max-height:150px;overflow-y:auto;overflow-x:hidden;margin-top:6px;margin-bottom:6px">',n.keys&&0<n.keys.length)for(var r in n.keys){var G=n.keys[r];e+=L+'<tr style=margin:5px><td style=width:30px><img width=24 height=18 src="images/hardware-key-'+(U=2==G.type?"OTP":"WebAuthn")+'-24.png" style=margin-top:4px><td style=width:250px>'+G.name+'<td><input type=button value="Verwijderen" onclick=account_removehkey('+G.i+")></input>"+P}else e+=L+"<tr style=text-align:center><td>Geen sleutels geconfigureerd"+P;e=e+"</div>"+"<div>";c="number"==typeof userinfo.otphkeys?userinfo.otphkeys:0;"number"!=typeof serverinfo.maxfidokeys||serverinfo.maxfidokeys>c?(0!=(131072&features)&&(e+='<input id=d2addkey3 type=button value="Sleutel toevoegen" onclick="account_addhkey(3);"></input>'),0!=(16384&features)&&(e+='<input id=d2addkey2 type=button value="Voeg YubiKey&reg; OTP toe" onclick="account_addhkey(2);"></input>')):e+="Maximum aantal sleutels bereikt.",setModalContent("xxAddAgent","Beheer beveiligingssleutels",e+="</div><br />"),showModal("xxAddAgentModal","idx_dlgOkButton"),0==u2fSupported()&&QE("d2addkey1",!1);break;case"otp-hkey-yubikey-add":n.result?meshserver.send({action:"otp-hkey-get"}):(setModalContent("xxAddAgent","Beveiligingssleutel toevoegen","<br />Fout, kan sleutel niet toevoegen.<br /><br />"),showModal("xxAddAgentModal","idx_dlgOkButton"));break;case"otp-hkey-setup-response":if(xxdialogMode&&"otpauth-hardware-manage"!=xxdialogTag)return;1==n.result?meshserver.send({action:"otp-hkey-get"}):(setModalContent("xxAddAgent","Beveiligingssleutel toevoegen","<br />Fout, kan sleutel niet toevoegen.<br /><br />"),showModal("xxAddAgentModal","idx_dlgOkButton"));break;case"webauthn-startregister":if(xxdialogMode&&"otpauth-hardware-manage"!=xxdialogTag)return;setModalContent("xxAddAgent","Beveiligingssleutel toevoegen",e='Druk nu op de sleutelknop.<br /><br /><div style=width:100%;text-align:center><img width=120 height=117 src="images/hardware-keypress-120.png" /></div><input id=dp1keyname style=display:none value='+n.name+" />");u=n.request;n.request.challenge=Uint8Array.from(atob(n.request.challenge),function(e){return e.charCodeAt(0)}),n.request.user.id=Uint8Array.from(atob(n.request.user.id),function(e){return e.charCodeAt(0)}),navigator.credentials.create({publicKey:u}).then(function(e){meshserver.send({action:"webauthn-endregister",response:{rawId:btoa(String.fromCharCode.apply(null,new Uint8Array(e.rawId))),response:{attestationObject:btoa(String.fromCharCode.apply(null,new Uint8Array(e.response.attestationObject))),clientDataJSON:btoa(String.fromCharCode.apply(null,new Uint8Array(e.response.clientDataJSON)))},type:e.type}}),setDialogMode(0)},function(e){console.log("FOUT:"+e),setModalContent("xxAddAgent","Beveiligingssleutel toevoegen","FOUT:"+e)}),showModal("xxAddAgentModal","idx_dlgOkButton");break;case"verifyPhone":if(xxdialogMode&&"verifyPhone"!=xxdialogTag)return;setModalContent("xxAddAgent","Telefonische meldingen",e=(e='<table><tr><td><img src="images/phone80.png" style=padding:8px>')+"<td>Controleer uw telefoon en voer de verificatiecode in."+'<br /><br /><div style=width:100%;text-align:center>Verificatie code: <input type=tel pattern="[0-9]" inputmode="number" maxlength=6 id=d2phoneCodeInput onKeyUp=account_managePhoneCodeValidate() onkeypress="if (event.key==\'Enter\') account_managePhoneCodeValidate(1)"></div></table>'),showModal("xxAddAgentModal","idx_dlgOkButton",()=>account_managePhoneConfirm(3,n.cookie)),Q("d2phoneCodeInput").focus(),account_managePhoneCodeValidate();break;case"verifyMessaging":if(xxdialogMode&&"verifyMessaging"!=xxdialogTag)return;setModalContent("xxAddAgent","Berichten notificaties",e=(e='<table><tr><td><img src="images/messaging40.png" style=padding:8px>')+"<td>Controleer uw berichten applicatie en voer de verificatiecode in."+'<br /><br /><div style=width:100%;text-align:center>Verificatie code: <input type=tel pattern="[0-9]" inputmode="number" maxlength=6 id=d2phoneCodeInput onKeyUp=account_managePhoneCodeValidate() onkeypress="if (event.key==\'Enter\') account_managePhoneCodeValidate(1)"></div></table>'),showModal("xxAddAgentModal","idx_dlgOkButton",()=>account_manageMessagingConfirm(3,n.cookie)),Q("d2phoneCodeInput").focus(),account_managePhoneCodeValidate();break;case"fileoperation":setModalContent("xxAddAgent",EscapeHtml(n.file),4,"extra-large"),showModal("xxAddAgentModal","idx_dlgOkButton",()=>{var e,t;e=n,t=Q("d4editorarea").value,t=0===d4EditLineBreakVal?t.replace(/\r?\n|\r/g,"\r\n"):2===d4EditLineBreakVal?t.replace(/\r\n|\n/g,"\r"):t.replace(/\r\n|\r/g,"\n"),t=1==d4EditEncodingVal?encode_utf8(t):t,meshserver.send({action:"fileoperation",fileop:"set",path:e.path,file:e.file,data:btoa(t)})}),QV("d4EncodingButton",!0),QV("d4LineBreakButton",!0),Q("d4editorarea").value=1==d4EditEncodingVal?decode_utf8(atob(n.data)):atob(n.data);break;case"event":if(!n.event.nolog){if(currentNode&&n.event.nodeid==currentNode._id&&null!=currentDeviceEvents&&(n.event.action==p16filterevents.value||""==p16filterevents.value)){if(null!=currentDeviceEvents){currentDeviceEvents.unshift(n.event);for(var b=parseInt(p16limitdropdown.value);currentDeviceEvents.length>b;)currentDeviceEvents.pop()}mainUpdate(1024)}if(currentUser&&n.event.userid==currentUser._id&&(n.event.action==p31filterevents.value||""==p31filterevents.value)){if(null!=currentUserEvents){currentUserEvents.unshift(n.event);for(b=parseInt(p31limitdropdown.value);currentUserEvents.length>b;)currentUserEvents.pop()}mainUpdate(2048)}if(n.event.action==p3filterevents.value||""==p3filterevents.value){if(null!=events){events.unshift(n.event);for(b=parseInt(p3limitdropdown.value);events.length>b;)events.pop()}mainUpdate(32)}}if(!n.event.noact)switch(n.event.action){case"serverinfochange":null!=n.event.lock2factor&&(serverinfo.lock2factor=n.event.lock2factor,updateSelf(),updateSiteAdmin());break;case"deviceShareUpdate":n.event.nodeid==deviceSharesReq&&(deviceSharesNode=n.event.nodeid,deviceShares=n.event.deviceShares,currentNode._id==deviceSharesNode)&&gotoDevice(currentNode._id,xxcurrentView,!0);break;case"agentlog":98==n.event.msgid&&0<GetNodeRights(n.event.nodeid)&&(l=getNodeFromId(n.event.nodeid),addNotification({text:format("Hulp verzoek van, gebruiker: {0}, details: {1}",n.event.msgArgs[0],n.event.msgArgs[1]),title:l.name,icon:l.icon,nodeid:n.event.nodeid}));break;case"recording":null!=p52recordings&&"object"==typeof p52recordings&&(p52recordings.unshift(n.event),n.event.present=1,updateRecordings());break;case"userWebState":try{if(null!=localStorage){var y=localStorage.getItem("showRealNames"),w=localStorage.getItem("uiMode"),j=localStorage.getItem("sort"),M=localStorage.getItem("loctag"),z=localStorage.getItem("nightMode"),W=localStorage.getItem("footerBar"),S=JSON.parse(n.event.state);for(r in S)localStorage.setItem(r,S[r]);if(null!=S.showRealNames&&S.showRealNames!=y&&(showRealNames=Q("RealNameCheckBox").checked="1"==S.showRealNames,mainUpdate(6)),null!=S.uiMode&&S.uiMode!=w&&userInterfaceSelectMenu(parseInt(S.uiMode)),null!=S.sort&&S.sort!=j&&(document.getElementById("sortselect").selectedIndex=sort=parseInt(S.sort),mainUpdate(6)),null!=S.loctag&&S.loctag!=M&&(null!=S.loctag?args.locale=S.loctag:delete args.locale,mainUpdate(4294967295)),null!=S.nightMode&&S.nightMode!=z&&(putstore("nightMode",S.nightMode),setNightMode()),null!=S.footerBar&&S.footerBar!=W&&(footerBar="1"==S.footerBar,QS("container")["grid-template-rows"]=null,QS("container")["-ms-grid-rows"]=null,adjustPanels()),null!=S.stars&&S.stars!=JSON.stringify(stars)&&(stars=JSON.parse(S.stars),3==Q("DevFilterSelect").value?mainUpdate(5):mainUpdate(4),currentNode)&&refreshDevice(currentNode._id),null!=S.deskKeyShortcuts){deskKeyboardShortcuts=[];var K=S.deskKeyShortcuts.split(",");for(r in K)""!=K[r]&&deskKeyboardShortcuts.push(parseInt(K[r]));updateDeskShortcutKeys()}if(null!=S.deskStrings){o=null;try{o=JSON.parse(S.deskStrings)}catch(e){}Array.isArray(o)&&(deskKeyboardStrings=o,updateDesktopStrings())}}}catch(e){}break;case"servertimelinestats":addServerTimelineStats(n.event.data);break;case"accountcreate":case"accountchange":if("object"!=typeof n.event.account||null==n.event.account)return void console.log(n.event);userinfo._id==n.event.account._id&&(y=n.event.account.siteadmin||0,w=userinfo.siteadmin||0,j=n.event.account.removeRights||0,M=userinfo.removeRights||0,(n.event.account.quota!=userinfo.quota||0==(8&userinfo.siteadmin)&&0!=(8&n.event.account.siteadmin))&&meshserver.send({action:"files"}),z=userinfo.groups,userinfo=n.event.account,w==y&&M==j&&1!=n.event.accountImageChange||(1==n.event.accountImageChange&&(userinfo.accountImageRnd=Math.floor(9999999999*Math.random())),updateSiteAdmin()),updateSelf(),0!=(2&userinfo.siteadmin)&&(W=userinfo.groups||[],(z||[]).join(",")!=W.join(","))&&(users=wssessions=null,meshserver.send({action:"users"}),meshserver.send({action:"wssessioncount"})),n.event.nodeListChange==userinfo._id)&&meshserver.send({action:"nodes",skip:null==devicePagingState?0:devicePagingState.skip}),currentNode&&refreshDevice(currentNode._id),null!=users&&(null==userinfo.groups||0==userinfo.groups.length||1==findOne(n.event.account.groups,userinfo.groups)?users[n.event.account._id]=n.event.account:delete users[n.event.account._id],mainUpdate(16388));break;case"accountremove":null!=users&&(delete users[n.event.userid],mainUpdate(16384));break;case"createusergroup":case"usergroupchange":w=(usergroups=null==usergroups?{}:usergroups)[n.event.ugrpid];null==w?usergroups[n.event.ugrpid]={_id:n.event.ugrpid,name:n.event.name,desc:n.event.desc,domain:n.event.domain,links:n.event.links}:(w.name=n.event.name,n.event.desc?w.desc=n.event.desc:delete w.desc,n.event.links?w.links=n.event.links:delete w.links,n.event.flags?w.flags=n.event.flags:delete w.flags,"number"==typeof n.event.consent&&(w.consent=n.event.consent)),mainUpdate(28672),meshserver.send({action:"meshes"}),meshserver.send({action:"nodes",skip:null==devicePagingState?0:devicePagingState.skip});break;case"deleteusergroup":if(null!=usergroups&&null!=usergroups[n.event.ugrpid]){delete usergroups[n.event.ugrpid];var C=0;for(r in usergroups)C++;0==C&&(usergroups=null),mainUpdate(24576)}break;case"createmesh":null!=meshes[n.event.meshid]||!serverinfo.manageAllDeviceGroups&&null==n.event.mesh.links[userinfo._id]||(meshes[n.event.meshid]=n.event.mesh,mainUpdate(24708),meshserver.send({action:"files"}));break;case"meshchange":if(null==meshes[n.event.meshid]){var A=!1;for(r in null!=n.event.links[userinfo._id]&&(A=!0),null!=userinfo.links[n.event.meshid]&&(A=!0),userinfo.links)r.startsWith("ugrp/")&&null!=n.event.links[r]&&(A=!0);A&&(meshes[n.event.meshid]={_id:n.event.meshid,name:n.event.name,mtype:n.event.mtype,desc:n.event.desc,links:n.event.links,amt:n.event.amt,invite:n.event.invite,expireDevs:n.event.expireDevs,relayid:n.event.relayid},meshserver.send({action:"nodes",skip:null==devicePagingState?0:devicePagingState.skip}))}else{if(null!=n.event.name)for(var r in meshes[n.event.meshid].name=n.event.name,nodes)nodes[r].meshid==n.event.meshid&&(nodes[r].meshnamel=n.event.name.toLowerCase());if(null!=n.event.desc&&(meshes[n.event.meshid].desc=n.event.desc),null!=n.event.flags&&(meshes[n.event.meshid].flags=n.event.flags),null!=n.event.consent&&(meshes[n.event.meshid].consent=n.event.consent),n.event.links&&(meshes[n.event.meshid].links=n.event.links),n.event.amt&&(meshes[n.event.meshid].amt=n.event.amt),null!=n.event.invite?meshes[n.event.meshid].invite=n.event.invite:delete meshes[n.event.meshid].invite,null!=n.event.expireDevs&&(0<n.event.expireDevs?meshes[n.event.meshid].expireDevs=n.event.expireDevs:delete meshes[n.event.meshid].expireDevs),null!=n.event.relayid&&(meshes[n.event.meshid].relayid=n.event.relayid),0==IsMeshViewable(n.event.meshid)){20==xxcurrentView&&currentMesh==meshes[n.event.meshid]&&go(2),delete meshes[n.event.meshid];var D=[];for(r in nodes)(nodes[r].meshid!=n.event.meshid||null!=userinfo.links&&null!=userinfo.links[nodes[r]._id])&&D.push(nodes[r]);nodes=D,10<=xxcurrentView&&xxcurrentView<20&&currentNode&&!IsNodeViewable(currentNode)&&(setDialogMode(0),go(1))}}mainUpdate(24708),currentNode&&!IsNodeViewable(currentNode)&&(currentNode=null,10<=xxcurrentView)&&xxcurrentView<20&&go(1),20==xxcurrentView&&currentMesh._id==n.event.meshid&&mainUpdate(4096);break;case"deletemesh":meshes[n.event.meshid]&&(delete meshes[n.event.meshid],mainUpdate(128),meshserver.send({action:"files"}));D=[];if(null!=nodes)for(var r in nodes)nodes[r].meshid!=n.event.meshid&&D.push(nodes[r]);nodes=D,mainUpdate(24580),20<=xxcurrentView&&xxcurrentView<30&&currentMesh._id==n.event.meshid&&(setDialogMode(0),go(2)),10<=xxcurrentView&&xxcurrentView<20&&currentNode&&!IsNodeViewable(currentNode)&&(setDialogMode(0),go(1));break;case"addnode":var T=n.event.node;meshes[T.meshid]&&null==getNodeFromId(T._id)&&(T.namel=T.name.toLowerCase(),T.rname?T.rnamel=T.rname.toLowerCase():T.rnamel=T.namel,T.meshnamel=meshes[T.meshid]?meshes[T.meshid].name.toLowerCase():"*",T.state=0,T.icon||(T.icon=1),T.ident=++nodeShortIdent,nodes.push(T),mainUpdate(23),20==xxcurrentView)&&null!=currentMesh&&currentMesh._id==T.meshid&&mainUpdate(4096);break;case"removenode":d=-1;for(r in nodes)if(nodes[r]._id==n.event.nodeid){d=r;break}-1!=d&&(T=nodes[d],currentNode==T&&(10<=xxcurrentView&&xxcurrentView<20&&(setDialogMode(0),go(1)),currentNode=null),nodes.splice(d,1),mainUpdate(20),20==xxcurrentView)&&null!=currentMesh&&currentMesh._id==T.meshid&&mainUpdate(4096);break;case"changenode":d=-1;for(r in nodes)if(nodes[r]._id==n.event.nodeid){d=r;break}if(-1!=d){if((T=nodes[d]).name=n.event.node.name,T.rname=n.event.node.rname,T.lusers=n.event.node.lusers,T.users=n.event.node.users,T.host=n.event.node.host,T.desc=n.event.node.desc,T.ip=n.event.node.ip,T.osdesc=n.event.node.osdesc,T.publicip=n.event.node.publicip,T.iploc=n.event.node.iploc,T.wifiloc=n.event.node.wifiloc,T.gpsloc=n.event.node.gpsloc,T.tags=n.event.node.tags,T.ssh=n.event.node.ssh,T.rdp=n.event.node.rdp,T.userloc=n.event.node.userloc,T.rdpport=n.event.node.rdpport,T.rfbport=n.event.node.rfbport,T.sshport=n.event.node.sshport,T.httpport=n.event.node.httpport,T.httpsport=n.event.node.httpsport,T.consent=n.event.node.consent,T.pmt=n.event.node.pmt,null!=n.event.node.links?T.links=n.event.node.links:delete T.links,null!=n.event.node.agent&&(null==T.agent&&(T.agent={}),null!=n.event.node.agent.ver&&(T.agent.ver=n.event.node.agent.ver),null!=n.event.node.agent.id&&(T.agent.id=n.event.node.agent.id),null!=n.event.node.agent.caps&&(T.agent.caps=n.event.node.agent.caps),null!=n.event.node.agent.root&&(T.agent.root=n.event.node.agent.root),null!=n.event.node.agent.core?T.agent.core=n.event.node.agent.core:T.agent.core&&delete T.agent.core,T.agent.tag=n.event.node.agent.tag),null!=n.event.node.intelamt&&(null==T.intelamt&&(T.intelamt={}),null!=n.event.node.intelamt.state&&(T.intelamt.state=n.event.node.intelamt.state),null!=n.event.node.intelamt.host&&(T.intelamt.user=n.event.node.intelamt.host),null!=n.event.node.intelamt.user?T.intelamt.user=n.event.node.intelamt.user:delete T.intelamt.user,null!=n.event.node.intelamt.tls&&(T.intelamt.tls=n.event.node.intelamt.tls),null!=n.event.node.intelamt.ver&&(T.intelamt.ver=n.event.node.intelamt.ver),null!=n.event.node.intelamt.tag&&(T.intelamt.tag=n.event.node.intelamt.tag),null!=n.event.node.intelamt.uuid&&(T.intelamt.uuid=n.event.node.intelamt.uuid),null!=n.event.node.intelamt.realm&&(T.intelamt.realm=n.event.node.intelamt.realm),null!=n.event.node.intelamt.flags&&(T.intelamt.flags=n.event.node.intelamt.flags),null!=n.event.node.intelamt.warn?T.intelamt.warn=n.event.node.intelamt.warn:delete T.intelamt.warn),null!=n.event.node.av&&(T.av=n.event.node.av),null!=n.event.node.wsc&&(T.wsc=n.event.node.wsc),null!=n.event.node.volumes&&(T.volumes=n.event.node.volumes),T.namel=T.name.toLowerCase(),T.rname?T.rnamel=T.rname.toLowerCase():T.rnamel=T.namel,n.event.node.icon&&(T.icon=n.event.node.icon),n.event.node.meshid!=T.meshid)if(null!=meshes[n.event.node.meshid]||null!=userinfo.links&&null!=userinfo.links[T._id])T.meshid=n.event.node.meshid,T.meshnamel=meshes[n.event.node.meshid]?meshes[n.event.node.meshid].name.toLowerCase():"*",mainUpdate(7);else{null!=currentNode&&currentNode._id==T._id&&10<=xxcurrentView&&xxcurrentView<20&&!IsNodeViewable(currentNode)&&(currentNode=null,setDialogMode(0),go(1));d=-1;for(r in nodes)if(nodes[r]._id==n.event.nodeid){d=r;break}nodes.splice(d,1),mainUpdate(20)}updateDeviceViewDevice(T),mainUpdate(26),refreshDevice(T._id),20==xxcurrentView&&null!=currentMesh&&currentMesh._id==T.meshid&&mainUpdate(4096),currentNode==T&&null!=xxdialogMode&&"@xxmap"==xxdialogTag&&p10showNodeLocationDialog()}break;case"nodemeshchange":d=-1;for(r in nodes)if(nodes[r]._id==n.event.nodeid){d=r;break}if(-1!=d){T=nodes[d];null!=meshes[n.event.newMeshId]||null!=userinfo.links&&null!=userinfo.links[T._id]?(T.meshid=n.event.newMeshId,T.meshnamel=meshes[n.event.newMeshId]?meshes[n.event.newMeshId].name.toLowerCase():"*",mainUpdate(7)):(null!=currentNode&&currentNode._id==T._id&&10<=xxcurrentView&&xxcurrentView<20&&!IsNodeViewable(currentNode)&&(currentNode=null,setDialogMode(0),go(1)),nodes.splice(d,1),mainUpdate(20)),refreshDevice(n.event.nodeid)}else{T=n.event.node;if(!meshes[T.meshid])break;T.namel=T.name.toLowerCase(),T.rname?T.rnamel=T.rname.toLowerCase():T.rnamel=T.namel,T.meshnamel=meshes[T.meshid]?meshes[T.meshid].name.toLowerCase():"*",T.state=0,T.icon||(T.icon=1),T.ident=++nodeShortIdent,nodes.push(T),mainUpdate(23)}break;case"nodeconnect":var E,d=-1;for(r in nodes)if(nodes[r]._id==n.event.nodeid){d=r;break}-1!=d&&(T=nodes[d],l=getstore("notifications",0),n.event.meshid&&userinfo.links&&userinfo.links[n.event.meshid]&&userinfo.links[n.event.meshid].notify&&(l|=userinfo.links[n.event.meshid].notify),null!=userinfo.notify&&(null!=userinfo.notify[n.event.meshid]&&(l|=userinfo.notify[n.event.meshid]),null!=userinfo.notify[n.event.nodeid])&&(l|=userinfo.notify[n.event.nodeid]),2&l&&(y="Agent verbonden",null!=T.agent&&!1===T.agent.root&&(y="Agent verbonden met beperkte privileges"),E={title:T.name,icon:T.icon,nodeid:T._id,id:n.event.id},0==(1&T.conn)&&0!=(1&n.event.conn)&&(E.text=y,addNotification(E)),0==(2&T.conn)&&0!=(2&n.event.conn)&&(E.text="Intel AMT gedetecteerd",addNotification(E)),0==(4&T.conn)&&0!=(4&n.event.conn)&&(E.text="Intel AMT CIRA verbonden",addNotification(E)),0==(16&T.conn))&&0!=(16&n.event.conn)&&(E.text="MQTT verbonden",addNotification(E)),4&l&&(E={title:T.name,icon:T.icon,nodeid:T._id,id:n.event.id},0!=(1&T.conn)&&0==(1&n.event.conn)&&(E.text="Agent niet verbonden",addNotification(E)),0!=(2&T.conn)&&0==(2&n.event.conn)&&(E.text="Intel AMT niet gedetecteerd",addNotification(E)),0!=(4&T.conn)&&0==(4&n.event.conn)&&(E.text="Intel AMT CIRA verbroken",addNotification(E)),0!=(16&T.conn))&&0==(16&n.event.conn)&&(E.text="MQTT verbroken",addNotification(E)),T.conn=n.event.conn,T.pwr=n.event.pwr,T.lastconnect=Date.now(),0==(1&T.conn)&&delete T.sessions,1==(M=Q("DevFilterSelect").value)||5==M?mainUpdate(21):(updateDeviceViewDevice(T),mainUpdate(17)),refreshDevice(T._id),20==xxcurrentView)&&null!=currentMesh&&currentMesh._id==T.meshid&&mainUpdate(4096);break;case"wssessioncount":null!=wssessions&&(0==n.event.count&&wssessions[n.event.userid]?delete wssessions[n.event.userid]:wssessions[n.event.userid]=n.event.count,mainUpdate(16384));break;case"login":null!=users&&users[n.event.userid]&&(users[n.event.userid].login=Math.floor(new Date(n.event.time).getTime()/1e3));break;case"scanamtdevice":if(null==xxdialogMode||!Q("dp1range")||xxdialogTag!="AMTSCAN:"+n.event.range)return;e="";if(null==n.event.results)e="<div style=width:100%;text-align:center;margin-top:12px>Kan dit adresbereik niet scannen.</div><div style=width:100%;text-align:center;margin-top:12px;color:gray;line-height:1.5>Voorbeeld IP bereikwaarden<br />192.168.0.100<br />192.168.1.0/24<br />192.167.0.1-192.168.0.100</div>";else{for(var r in amtScanResults=n.event.results,n.event.results){var N=n.event.results[r],I=N.hostname,I=(20<(I="host"==N.hosttype?capitalizeFirstLetter(I.split(".")[0]):I).length&&(I=I.substring(0,20)+"..."),'<b title="'+EscapeHtml(N.hostname)+'">'+EscapeHtml(I)+"</b> - v"+N.ver);2==N.state?1==N.tls?I+=" met TLS.":I+=" zonder TLS.":I+=" not activated.",e+='<div style=width:100%;margin-bottom:2px;background-color:lightgray><div style=padding:4px><div style=display:inline-block;margin-right:5px><input class="DevScanCheckbox form-check-input me-2" name=dp1checkbox tag="'+EscapeHtml(r)+'" type=checkbox onclick=addAmtScanToMeshCheckbox() /></div><div class=j1 style=display:inline-block></div><div style=display:inline-block;margin-left:5px;overflow-x:auto;white-space:nowrap>'+I+"</div></div></div>"}""==e&&(e="<div style=width:100%;text-align:center;margin-top:12px>Scan leverde geen resultaten op.</div><div style=width:100%;text-align:center;margin-top:12px;color:gray;line-height:1.5>Voorbeeld IP bereikwaarden<br />192.168.0.100<br />192.168.1.0/24<br />192.167.0.1-192.168.0.100</div>")}QH("dp1results",e),QE("dp1range",!0),QE("dp1rangebutton",!0),QE("d2scanSelectButton",!0);break;case"notify":l={text:n.event.value,title:n.event.title,icon:n.event.icon,titleid:n.titleid,msgid:n.msgid,args:n.args};null!=n.id&&(l.id=n.id),null!=n.event.tag&&(l.tag=n.event.tag),"number"==typeof n.maxtime&&(l.maxtime=n.maxtime),addNotification(l);break;case"traceinfo":"object"==typeof n.event.traceSources&&(null!=n.event.traceSources&&0<n.event.traceSources.length?(serverTraceSources=n.event.traceSources,QH("p41traceStatus",EscapeHtml(n.event.traceSources.join(", ")))):(serverTraceSources=[],QH("p41traceStatus","Geen")));break;case"sysinfohash":null!=currentNode&&n.event.nodeid==powerTimelineReq&&meshserver.send({action:"getsysinfo",nodeid:n.event.nodeid});break;case"ifchange":null!=currentNode&&currentNode._id==n.event.nodeid&&meshserver.send({action:"getnetworkinfo",nodeid:currentNode._id});break;case"devicesessions":if(null!=(T=getNodeFromId(n.event.nodeid))){if(T.sessions=n.event.sessions,null!=T.sessions){for(var r in T.sessions)0==Object.keys(T.sessions[r]).length&&delete T.sessions[r];0==Object.keys(T.sessions).length&&delete T.sessions}updateDeviceViewDevice(T),null!=currentNode&&currentNode._id==n.event.nodeid&&gotoDevice(currentNode._id,xxcurrentView,!0),xxdialogTag=="SESSIONS-"+n.event.nodeid&&showDeviceSessions(n.event.nodeid,!0),xxdialogTag=="MESSAGES-"+n.event.nodeid&&showDeviceMessages(n.event.nodeid,!0),xxdialogTag=="HELPREQ-"+n.event.nodeid&&showDeviceHelpRequests(n.event.nodeid,!0),2!=Q("DevFilterSelect").value&&6!=Q("DevFilterSelect").value||mainUpdate(1)}break;case"loginTokenChanged":if(n.event.userid!=userinfo._id)return;loginTokens=n.event.loginTokens,mainUpdate(65536);break;case"loginTokenAdded":if(n.event.userid!=userinfo._id)return;(loginTokens=null==loginTokens?[]:loginTokens).push(n.event.newToken),mainUpdate(65536);break;case"stopped":break;case"updatePluginList":installedPluginList=n.event.list,updatePluginList();break;case"pluginStateChange":null!=pluginHandler&&pluginHandler.refreshPluginHandler();break;case"plugin":if(null!=pluginHandler)try{pluginHandler[n.event.plugin][n.event.pluginaction](n)}catch(e){console.log("PluginHandler kon geen gebeurtenisbericht weergeven: ",e)}}break;case"createInviteLink":var _,V;xxdialogTag==n.meshid&&(-1!=(_=serverinfo.name).indexOf(".")&&0==(2&features)||(_=window.location.hostname),domainUrl.substring(0,domainUrl.length-1),V=1==serverinfo.https?"https://"+_+(443==serverinfo.port?"":":"+serverinfo.port)+domainUrl+"agentinvite?c="+n.cookie+(urlargs.key?"&key="+urlargs.key:""):"http://"+_+(80==serverinfo.port?"":":"+serverinfo.port)+domainUrl+"agentinvite?c="+n.cookie+(urlargs.key?"&key="+urlargs.key:""),Q("agentInvitationLink").href=V,p=format(1==n.expire?"1 uur":"{0} uur",n.expire),24==n.expire&&(p="1 dag"),168==n.expire&&(p="1 week"),5040==n.expire&&(p="1 maand"),0==n.expire&&(p="Ongelimiteerd"),QH("agentInvitationLink",format("Uitnodigingslink ({0})",p)),QV("agentInvitationLinkDiv",!0));break;case"createDeviceShareLink":var U;xxdialogTag||(e="",null!=(T=getNodeFromId(n.nodeid))&&(e=(e=(e+=addHtmlValue("Apparaat",T.name))+addHtmlValue("Gast naam",n.guestname))+addHtmlValue("Gebruikers invoer",n.viewOnly?"Niet toegestaan, alleen kijken":"Toegestaan"),n.start&&n.expire&&(n.recurring?(e+=addHtmlValue("Start tijd",printDateTime(new Date(n.start))),n.expire<2?e+=addHtmlValue("Looptijd",format("{0} minuut",n.expire)):e+=addHtmlValue("Looptijd",format("{0} minuten",n.expire))):e=(e+=addHtmlValue("Start tijd",printDateTime(new Date(n.start))))+addHtmlValue("Verval datum",printDateTime(new Date(n.expire)))),1==n.recurring&&(e+=addHtmlValue("Terugkerend","Dagelijks")),2==n.recurring&&(e+=addHtmlValue("Terugkerend","Wekelijks")),t=[],7&n.consent&&t.push("Melden"),56&n.consent&&t.push("Melden"),64&n.consent&&t.push("Privacy balk"),0==t.length&&t.push("Geen"),e+=addHtmlValue("Toestemming van gebruiker",t.join(", ")),U="",n.p<=7?U=["","Externe terminal link","Extern bureaublad koppeling","Extern bureaublad + Terminal koppeling","Koppeling naar externe bestanden","Externe Terminal + Bestandend koppeling","Extern bureaublad + Bestanden koppeling","Extern bureaublad + Terminal + Bestanden koppeling"][n.p]:8==n.p?U=format("HTTP/{0} link",n.port):16==n.p&&(U=format("HTTPS/{0}",n.port)),setModalContent("xxAddAgent","Deel apparaat",e+='<div id=agentInvitationLinkDiv style="text-align:center;font-size:large;margin:16px"><a href="'+n.url+'" id=agentInvitationLink rel="noreferrer noopener" target="_blank" style=cursor:pointer>'+U+'</a> <i class="fa-regular fa-copy" title="Kopieer link naar het klembord" style=cursor:pointer onclick=d2CopyInviteToClip()></i></div></div>'),showModal("xxAddAgentModal","idx_dlgOkButton")));break;case"getmqttlogin":if(null==currentNode||currentNode._id!=n.nodeid||null!=xxdialogMode)return;e="Deze instellingen kunnen worden gebruikt om MQTT voor dit apparaat te verbinden.<br /><br />";delete n.action,delete n.nodeid,setModalContent("xxAddAgent","MQTT referenties",e+="<textarea readonly=readonly style=width:100%;resize:none;height:100px;overflow:auto;font-size:12px readonly>"+JSON.stringify(n)+"</textarea>"),showModal("xxAddAgentModal","idx_dlgOkButton");break;case"stopped":autoReconnect=!1,QH("p0span",n.msg);break;case"updatePluginList":installedPluginList=n.list,updatePluginList();break;case"pluginVersionsAvailable":null!=pluginHandler&&updatePluginList(n.list);break;case"downgradePluginVersions":var q='<select id="lastPluginVersion">';n.info.versionList.forEach(function(e){q+='<option value="'+e.zipball_url+'">'+e.name+"</option>"}),q+="</select>",setModalContent("xxAddAgent","Plugin Actie",format("Select the version to downgrade the plugin: {0}",n.info.name)+"<hr />"+q+"<hr />Houd er rekening mee dat downgraden niet wordt aanbevolen. Doe dit alleen als een recente upgrade iets heeft gebroken.NaN"+n.info.id+'" />'),showModal("xxAddAgentModal","idx_dlgOkButton",pluginActionEx);break;case"serverBackup":"googleDrive"==n.service&&(QV("p2ServerActionsGoogleBackup",0<n.state),QV("p2ServerActionsGoogleBackupCheck",2<n.state),miscState.googleDrive={state:n.state},2==n.state)&&(e='<img style=float:right src="images/googledrive-48.png" /><div>Ga naar de onderstaande URL, verleen toegang en kopieer de tokencode terug.</div><br />',setModalContent("xxAddAgent","Google Drive Backup",e=(e+=addHtmlValue("Activatie",'<a href="'+n.url+'" rel="noreferrer noopener" target="_blank">Browse to this URL</a>'))+addHtmlFormFloating("Code","<input id=gdcode onkeyup=server_setupGoogleDriveBackupCheck3() class=form-control></input>")),showModal("xxAddAgentModal","idx_dlgOkButton",()=>server_setupGoogleDriveBackupEx(3,"gd2")),Q("gdcode").focus(),QE("idx_dlgOkButton",!1));break;case"pluginError":setModalContent("xxAddAgent","Plugin fout",n.msg),showModal("xxAddAgentModal","idx_dlgOkButton");break;case"plugin":if(null!=pluginHandler&&"string"==typeof n.plugin)try{pluginHandler[n.plugin][n.method](H,n)}catch(e){console.log("Error loading plugin handler ("+e+")")}break;case"amtsetupbin":saveAs(new Blob([Uint8Array.from(atob(n.file),function(e){return e.charCodeAt(0)})],{type:"application/octet-stream"}),"setup.bin");break;case"previousLogins":null!=n.userid&&n.userid;var e="",C="BBB",B="";if(0==n.events.length)e+="No previous login.";else{for(var r in e+="<div style=max-height:260px;overflow-y:scroll;overflow-x:hidden><table>",n.events)107==(i=n.events[r].m)?(i="Geldige login",C="BBD1BB",B="",null!=n.events[r].tn&&(i=format("Token: {0}",n.events[r].tn),C="88D188")):108==i?(i="Ongeldige 2FA",C="DD9DC3",B="x"):109==i?(i="Vergrendeld account",C="E1BBBB",B="x"):110==i&&(i="Ongeldig wachtwoord",C="E1BBBB",B="x"),e+="<tr><td><img src=images/user-32"+B+'.png height=32 width=32 style=float:left srcset="images/user-64'+B+'.png 2x"><td><div style=width:300px;background-color:#'+C+";border-radius:6px;margin-bottom:4px;padding:4px><div>"+printDateTime(new Date(n.events[r].t))+", <b>"+EscapeHtml(i)+"</b></div><div style=font-size:x-small>"+EscapeHtml(n.events[r].a.join(", "))+"</div></div></tr>";e+="</table></div>"}setModalContent("xxAddAgent","Eerdere aanmeldingen",e),showModal("xxAddAgentModal","idx_dlgOkButton");break;case"getDeviceDetails":saveAs(new Blob([n.data],{type:"application/octet-stream"}),"apparaatlijst."+n.type);break;case"createLoginToken":if(xxdialogMode)return;e="Noteer deze gebruikersnaam en wachtwoord, het wachtwoord kan niet opnieuw worden weergegeven.<br /><br />";e+=addHtmlValue("Naam",EscapeHtml(n.name)),0!=n.expire&&(e+=addHtmlValue("Verlopen",EscapeHtml(printDateTime(new Date(n.expire))))),setModalContent("xxAddAgent","Maak een login-token aan",e=(e+=addHtmlValue("Gebruikersnaam",'<i class="fa-regular fa-copy" title="Kopieer link naar het klembord" style="margin:9px;cursor:pointer;float:right" onclick=copyTextToClip2("'+encodeURIComponentEx(n.tokenUser)+'")></i><div class=selecttext style=width:230px;padding:5px;background-color:orange;border-radius:5px;font-size:15px>'+EscapeHtml(n.tokenUser)+"</div>"))+addHtmlValue("Wachtwoord",'<i class="fa-regular fa-copy" title="Kopieer link naar het klembord" style="margin:9px;cursor:pointer;float:right" onclick=copyTextToClip2("'+encodeURIComponentEx(n.tokenPass)+'")></i><div class=selecttext style=width:230px;padding:5px;background-color:orange;border-radius:5px;font-size:15px>'+EscapeHtml(n.tokenPass)+"</div>")),showModal("xxAddAgentModal","idx_dlgOkButton");break;case"loginTokens":loginTokens=n.loginTokens,mainUpdate(65536);break;case"report":renderReport(n.data)}}function gotoStartViewPage(){var e=parseInt("{{viewmode}}");if(-1==xxcurrentView){if(""!="{{currentNode}}".toLowerCase()){if(null==getNodeFromId("{{currentNode}}"))return;gotoDevice("{{currentNode}}",e)}else if(null!=args.gotonode){if(96==args.gotonode.length&&(args.gotonode=btoa(hex2rstr(args.gotonode)).split("+").join("@").split("/").join("$")),null==getNodeFromId("node/"+domain+"/"+args.gotonode))return;gotoDevice("node/"+domain+"/"+args.gotonode,e),goBackStack.push(1)}else if(null!=args.gotodevicename){var t=null;if(null!=nodes)for(var n in nodes)nodes[n].name==args.gotodevicename&&(t=nodes[n]._id);t&&(gotoDevice(t,e),goBackStack.push(1))}else if(null!=args.gotodeviceip){t=null;if(null!=nodes)for(var n in nodes)nodes[n].ip==args.gotodeviceip&&(t=nodes[n]._id);t&&(gotoDevice(t,e),goBackStack.push(1))}else if(null!=args.gotomesh){if(null==meshes["mesh/"+domain+"/"+args.gotomesh])return;gotoMesh("mesh/"+domain+"/"+args.gotomesh),go(e),goBackStack.push(2)}else if(null!=args.gotouser){var o=args.gotouser;if(args.gotouser.indexOf("/")<0&&(o="user/"+domain+"/"+args.gotouser),null==users||null==users[o])return;gotoUser(encodeURIComponentEx(o)),go(e),goBackStack.push(4)}else if(null!=args.gotougrp){o=args.gotougrp;if(args.gotougrp.indexOf("/")<0&&(o="ugrp/"+domain+"/"+args.gotougrp),null==usergroups||null==usergroups[o])return;gotoUserGroup(o),go(e),goBackStack.push(50)}else isNaN(e)?(setDialogMode(0),go(1)):go(e);delete args.gotonode,delete args.gotomesh,delete args.gotouser,delete args.gotougrp}}function topMenu(e){null!=xxdialogMode&&0!=xxdialogMode&&999!=xxdialogMode||(void 0===e?1==("none"==QS("topMenu").display)?0!=xxdialogMode&&null!=xxdialogMode||(QV("topMenu",!0),xxdialogMode=999):(QV("topMenu",!1),xxdialogMode=0):(QV("topMenu",!1),xxdialogMode=0,1==e&&goForward("devices"),2==e&&goForward("account"),3==e&&goForward("events"),4==e&&goForward("users"),5==e&&goForward("files"),6==e&&goForward("server")))}function onRealNameCheckBox(){putstore("showRealNames",(showRealNames=Q("RealNameCheckBox").checked)?1:0),mainUpdate(7)}function onOnlineCheckBox(e){putstore("devFilterSelect",Q("DevFilterSelect").value),onDeviceSearchChanged(e)}function updateDevicePageState(){var e,t;null==devicePagingState||devicePagingState.total<=devicePagingState.limit?(QV("devViewPageState",!1),QV("devViewPageButton1",!1),QV("devViewPageButton2",!1),QV("devViewPageButton3",!1),QV("devViewPageButton4",!1)):(e=Math.floor((devicePagingState.skip+devicePagingState.limit)/devicePagingState.limit),t=Math.ceil(devicePagingState.total/devicePagingState.limit),QV("devViewPageState",!0),QV("devViewPageButton1",!0),QV("devViewPageButton2",!0),QV("devViewPageButton3",!0),QV("devViewPageButton4",!0),QH("devViewPageState",e+"/"+t))}function onDeviceViewPageChange(e){if(null!=devicePagingState){var t=Math.floor((devicePagingState.skip+devicePagingState.limit)/devicePagingState.limit),n=Math.ceil(devicePagingState.total/devicePagingState.limit);switch(e){case 1:1<t&&meshserver.send({action:"nodes",skip:0});break;case 2:1<t&&meshserver.send({action:"nodes",skip:(t-2)*devicePagingState.limit});break;case 3:t<n&&meshserver.send({action:"nodes",skip:t*devicePagingState.limit});break;case 4:t<n&&meshserver.send({action:"nodes",skip:(n-1)*devicePagingState.limit})}}}function onDeviceViewChange(e){null!=e&&(Q("viewselect").value=e);for(var t=1;t<6;t++)Q("devViewButton"+t).classList.remove("viewSelectorSel");Q("devViewButton"+Q("viewselect").value).classList.add("viewSelectorSel"),putstore("deviceView",Q("viewselect").value),putstore("viewsize",Q("sizeselect").value),mainUpdate(4),setTimeout(function(){mainUpdate(512)},200)}function onDeviceViewSettings(){var e;xxdialogMode||(null==deviceViewSettings&&(deviceViewSettings={}),Array.isArray(deviceViewSettings.devsCols)||(deviceViewSettings.devsCols=["user","ip","conn"]),e="",setModalContent("xxAddAgent","Kolomweergave apparaat",e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e+='<label><input id=d2c8 type=checkbox class="form-check-input me-2"'+(0<=deviceViewSettings.devsCols.indexOf("agtype")?" checked":"")+">Agent Type</label><br />")+('<label><input id=d2c9 type=checkbox class="form-check-input me-2"'+(0<=deviceViewSettings.devsCols.indexOf("agver")?" checked":"")+">Agent versie</label><br />"))+('<label><input id=d2c6 type=checkbox class="form-check-input me-2"'+(0<=deviceViewSettings.devsCols.indexOf("desc")?" checked":"")+">Apparaat beschrijving</label><br />"))+('<label><input id=d2c5 type=checkbox class="form-check-input me-2"'+(0<=deviceViewSettings.devsCols.indexOf("os")?" checked":"")+">Besturingssysteem</label><br />"))+('<label><input id=d2c10 type=checkbox class="form-check-input me-2"'+(0<=deviceViewSettings.devsCols.indexOf("tags")?" checked":"")+">Tags</label><br />"))+('<label><input id=d2c11 type=checkbox class="form-check-input me-2"'+(0<=deviceViewSettings.devsCols.indexOf("windowsav")?" checked":"")+">Windows AV</label><br />"))+('<label><input id=d2c12 type=checkbox class="form-check-input me-2"'+(0<=deviceViewSettings.devsCols.indexOf("windowsupdate")?" checked":"")+">Windows Update</label><br />"))+('<label><input id=d2c13 type=checkbox class="form-check-input me-2"'+(0<=deviceViewSettings.devsCols.indexOf("windowsfirewall")?" checked":"")+">Windows Firewall</label><br />"))+('<label><input id=d2c14 type=checkbox class="form-check-input me-2"'+(0<=deviceViewSettings.devsCols.indexOf("lastbootuptime")?" checked":"")+">Tijd van laatste opstart</label><br />"))+('<label><input id=d2c1 type=checkbox class="form-check-input me-2"'+(0<=deviceViewSettings.devsCols.indexOf("links")?" checked":"")+">MeshCentral Router Links</label><br />"))+('<label><input id=d2c2 type=checkbox class="form-check-input me-2"'+(0<=deviceViewSettings.devsCols.indexOf("user")?" checked":"")+">Ingelogde gebruikers</label><br />"))+('<label><input id=d2c3 type=checkbox class="form-check-input me-2"'+(0<=deviceViewSettings.devsCols.indexOf("ip")?" checked":"")+">IP-adres agent</label><br />"))+('<label><input id=d2c4 type=checkbox class="form-check-input me-2"'+(0<=deviceViewSettings.devsCols.indexOf("conn")?" checked":"")+">Server connectiviteit</label><br />"))+('<label><input id=d2c7 type=checkbox class="form-check-input me-2"'+(0<=deviceViewSettings.devsCols.indexOf("lastseen")?" checked":"")+">Laatst gezien</label><br />"))+('<label><input id=d2c15 type=checkbox class="form-check-input me-2"'+(0<=deviceViewSettings.devsCols.indexOf("amthost")?" checked":"")+">Intel&reg; AMT hostnaam</label><br />"))+('<label><input id=d2c17 type=checkbox class="form-check-input me-2"'+(0<=deviceViewSettings.devsCols.indexOf("amtstate")?" checked":"")+">Intel&reg; AMT status</label><br />")),showModal("xxAddAgentModal","idx_dlgOkButton",()=>onDeviceViewSettingsEx()))}function onDeviceViewSettingsEx(){var e=[];Q("d2c1").checked&&e.push("links"),Q("d2c2").checked&&e.push("user"),Q("d2c3").checked&&e.push("ip"),Q("d2c4").checked&&e.push("conn"),Q("d2c5").checked&&e.push("os"),Q("d2c6").checked&&e.push("desc"),Q("d2c7").checked&&e.push("lastseen"),Q("d2c8").checked&&e.push("agtype"),Q("d2c9").checked&&e.push("agver"),Q("d2c10").checked&&e.push("tags"),Q("d2c11").checked&&e.push("windowsav"),Q("d2c12").checked&&e.push("windowsupdate"),Q("d2c13").checked&&e.push("windowsfirewall"),Q("d2c14").checked&&e.push("lastbootuptime"),Q("d2c15").checked&&e.push("amthost"),Q("d2c17").checked&&e.push("amtstate"),deviceViewSettings.devsCols=e,putstore("_deviceViewSettings",JSON.stringify(deviceViewSettings)),mainUpdate(4)}function ondockeypress(e){if(!document.querySelector(".modal.show")){if(setSessionActivity(),!xxdialogMode&&11==xxcurrentView&&desktop&&Q("DeskControl").checked){if(null!=currentNode){var t=GetNodeRights(currentNode);if(0==(0==(8192&features2)&&(4294967295==t||0!=(8&t)&&0==(256&t))))return!1;t=4294967295!=t&&0!=(8&t)&&0==(256&t)&&0!=(4096&t);if(1==t&&(1==e.altKey||1==e.ctrlKey||e.keyCode<32&&8!=e.keyCode&&13!=e.keyCode||90<e.keyCode))return!1}return desktop.m.handleKeys(e)}if(!xxdialogMode&&12==xxcurrentView&&terminal&&3==terminal.State&&null==xterm)return terminal.m.TermHandleKeys(e);if(!xxdialogMode&&(15==xxcurrentView||115==xxcurrentView))return agentConsoleHandleKeys(e);if(!xxdialogMode&&4==xxcurrentView){if(1==e.ctrlKey||1==e.altKey||1==e.metaKey)return;var n=0;if(e.key?(1===e.key.length&&0==userSearchFocus&&(Q("UserSearchInput").value=Q("UserSearchInput").value+e.key,n=1),8==e.keyCode&&0==userSearchFocus&&(o=Q("UserSearchInput").value,Q("UserSearchInput").value=o.substring(0,o.length-1),n=1),27==e.keyCode&&(Q("UserSearchInput").value="",n=1)):0!=e.charCode&&0==userSearchFocus&&(Q("UserSearchInput").value=Q("UserSearchInput").value+String.fromCharCode(e.charCode),n=1),0<n)return 1==n&&onUserSearchInputChanged(),haltEvent(e)}if(!xxdialogMode&&1==xxcurrentView)if(1==e.ctrlKey&&96==e.charCode)showRealNames=!showRealNames,putstore("showRealNames",(Q("RealNameCheckBox").value=showRealNames)?1:0),mainUpdate(6);else if(1!=e.ctrlKey&&1!=e.altKey&&1!=e.metaKey){if(Q("viewselect").value<4){var o,n=0;if(e.key?(1===e.key.length&&0==searchFocus&&(Q("KvmSearchInput").value=Q("SearchInput").value=Q("SearchInput").value+e.key,n=1),8==e.keyCode&&0==searchFocus&&(o=Q("SearchInput").value,Q("KvmSearchInput").value=Q("SearchInput").value=o.substring(0,o.length-1),n=1),27==e.keyCode&&(Q("KvmSearchInput").value=Q("SearchInput").value="",n=1)):0!=e.charCode&&0==searchFocus&&(Q("KvmSearchInput").value=Q("SearchInput").value=Q("SearchInput").value+String.fromCharCode(e.charCode),n=1),0<n)return 1==n&&mainUpdate(5),haltEvent(e)}4==Q("viewselect").value&&(e.key?(1===e.key.length&&0==mapSearchFocus&&(Q("mapSearchLocation").value=Q("mapSearchLocation").value+e.key,n=1),27==e.keyCode&&(Q("mapSearchLocation").value="",mapCloseSearchWindow(),n=1),13==e.keyCode&&getSearchLocation()):0!=e.charCode&&0==mapSearchFocus&&(Q("mapSearchLocation").value=Q("mapSearchLocation").value+String.fromCharCode(e.charCode)))}}}function ondockeydown(e){if(setSessionActivity(),!xxdialogMode&&11==xxcurrentView&&desktop&&Q("DeskControl").checked){if(null!=currentNode){var t=GetNodeRights(currentNode);if(0==(0==(8192&features2)&&(4294967295==t||0!=(8&t)&&0==(256&t))))return!1;t=4294967295!=t&&0!=(8&t)&&0==(256&t)&&0!=(4096&t);if(1==t&&(1==e.altKey||1==e.ctrlKey||e.keyCode<32&&8!=e.keyCode&&13!=e.keyCode||90<e.keyCode))return!1}return desktop.m.handleKeyDown(e)}if(!xxdialogMode&&12==xxcurrentView&&terminal&&3==terminal.State&&null==xterm&&(terminal.m.TermHandleKeyDown(e),37<=e.keyCode)&&e.keyCode<=40&&haltEvent(e),!xxdialogMode&&13==xxcurrentView&&116==e.keyCode&&null!=p13filetree)return haltEvent(e),!1;if(!xxdialogMode&&(15==xxcurrentView||115==xxcurrentView))return agentConsoleHandleKeys(e);if(!xxdialogMode&&4==xxcurrentView&&(8===e.keyCode&&0==userSearchFocus&&(n=Q("UserSearchInput").value,Q("UserSearchInput").value=n.substring(0,n.length-1),o=1),27===e.keyCode&&(Q("UserSearchInput").value="",o=1),0<o))return 1==o&&mainUpdate(5),haltEvent(e);if(!xxdialogMode&&1==xxcurrentView&&1!=e.ctrlKey&&1!=e.altKey&&1!=e.metaKey){var n,o=0;if(Q("viewselect").value<4)if(8===e.keyCode&&0==searchFocus&&(n=Q("SearchInput").value,Q("KvmSearchInput").value=Q("SearchInput").value=n.substring(0,n.length-1),o=1),27===e.keyCode&&(Q("KvmSearchInput").value=Q("SearchInput").value="",o=1),0<o)return 1==o&&mainUpdate(5),haltEvent(e);4==Q("viewselect").value&&(8===e.keyCode&&0==mapSearchFocus&&(n=Q("mapSearchLocation").value,Q("mapSearchLocation").value=n.substring(0,n.length-1),o=1),27===e.keyCode)&&(Q("mapSearchLocation").value="",mapCloseSearchWindow())}}function ondockeyup(e){if(setSessionActivity(),!xxdialogMode&&11==xxcurrentView&&desktop&&Q("DeskControl").checked){if(null!=currentNode){var t=GetNodeRights(currentNode);if(0==(0==(8192&features2)&&(4294967295==t||0!=(8&t)&&0==(256&t))))return!1;t=4294967295!=t&&0!=(8&t)&&0==(256&t)&&0!=(4096&t);if(1==t&&(1==e.altKey||1==e.ctrlKey||e.keyCode<32&&8!=e.keyCode&&13!=e.keyCode||90<e.keyCode))return!1}return desktop.m.handleKeyUp(e)}return!xxdialogMode&&12==xxcurrentView&&terminal&&3==terminal.State&&null==xterm?terminal.m.TermHandleKeyUp(e):xxdialogMode||13!=xxcurrentView||116!=e.keyCode||null==p13filetree?xxdialogMode||4!=xxcurrentView||(8!==e.keyCode||0!=searchFocus)&&27!==e.keyCode?(xxdialogMode&&27==e.keyCode&&dialogclose(0),1!=e.shiftKey||27!=e.keyCode?!xxdialogMode&&0==xxcurrentView&&1!=e.ctrlKey&&1!=e.altKey&&1!=e.metaKey&&(Q("viewselect").value<4&&(8===e.keyCode&&0==searchFocus||27===e.keyCode)||4==Q("viewselect").value&&(8===e.keyCode&&0==mapSearchFocus||27===e.keyCode))?haltEvent(e):void 0:(dialogclose(0),Q("KvmSearchInput").value=Q("SearchInput").value="",mainUpdate(5),null!=desktop&&connectDesktop(),null!=terminal&&connectTerminal(),null!=files&&connectFiles(),void go(1))):haltEvent(e):(p13folderup(9999),haltEvent(e),!1)}function ondocblur(){if(!xxdialogMode&&11==xxcurrentView&&desktop&&Q("DeskControl").checked&&desktop.m.handleReleaseKeys)return desktop.m.handleReleaseKeys()}function devGrpMouseHover(e,t){setSessionActivity();Q("viewselect").value;e=e.children[1].children[1];e.children[0].classList.remove("g1s"),e.children[1].classList.remove("e2s"),e.children[2].classList.remove("g2s"),1==t&&(e.children[0].classList.add("g1s"),e.children[1].classList.add("e2s"),e.children[2].classList.add("g2s"))}function devMouseHover(e,t){setSessionActivity();var n,o=Q("viewselect").value;1==o?((n=e.children[0].children[0].children[1].children[0].children[0].children[0]).children[1].classList.remove("g1s"),n.children[2].classList.remove("e2s"),n.children[3].classList.remove("g2s"),1==t&&(n.children[1].classList.add("g1s"),n.children[2].classList.add("e2s"),n.children[3].classList.add("g2s"))):2==o&&((n=e).children[2].classList.remove("g1s"),n.children[4].classList.remove("e2s"),n.children[3].classList.remove("g2s"),1==t)&&(n.children[2].classList.add("g1s"),n.children[4].classList.add("e2s"),n.children[3].classList.add("g2s"))}var deviceHeaderCount,deviceHeaderId=0,deviceHeaderTotal=0,deviceHeadersTitles={},deviceHeaders={},oldviewmode=0;function updateDevices(){if(null!=nodes&&1==xxcurrentView){var e="",t=0,n=null,o={},a=Q("viewselect").value,i={},s={};if(QV("xdevices",4!=a),QV("xdevicesmap",4==a),QVH("devListToolbar",a<3),QVH("kvmListToolbar",3==a||5==a),QVH("devMapToolbar",4==a),QV("devListToolbarSize",3==a||5==a),QV("devListToolbarSettings",2==a),QV("NoMeshesPanel",0==nodes.length&&0==meshcount),QV("devListToolbarViewIcons",0<nodes.length),QV("devListToolbarSort",0<nodes.length&&4!=a),0==nodes.length&&(a=1,sort=0),4==a)setTimeout(function(){null!=xxmap.map&&xxmap.map.updateSize()},200);else{deviceHeaderCount={},deviceHeaders={},deviceHeadersTitles={};var r=[],l=((deviceHeaderTotal=deviceHeaderId=0)==sort?nodes.sort(meshSort):1==sort?nodes.sort(powerSort):2==sort?1==showRealNames?nodes.sort(deviceHostSort):nodes.sort(deviceSort):5==sort&&(deviceViewSettings&&deviceViewSettings.devsCols&&0<=deviceViewSettings.devsCols.indexOf("lastseen")||(0==requestedLastConnects&&(requestedLastConnects=!0,meshserver.send({action:"lastconnects"})),null==deviceViewSettings&&(deviceViewSettings={}),Array.isArray(deviceViewSettings.devsCols)?deviceViewSettings.devsCols.push("lastseen"):deviceViewSettings.devsCols=["user","ip","conn","lastseen"]),nodes.sort(lastConnectSort)),Q("column_l").clientWidth-60),d=Math.floor(l/301),d=301+Math.floor((l-301*d)/d),c=4;for(w in deviceViewSettings&&deviceViewSettings.devsCols&&(c=deviceViewSettings.devsCols.length+1,0<=deviceViewSettings.devsCols.indexOf("desc"))&&c--,nodes){var u=nodes[w];if(0!=u.v){var p,m,g=meshes[u.meshid],v=GetNodeRights(u);if(0==sort?(meshes[u.meshid]?u.meshid:"*")!=n&&(1!=a&&3!=a&&5!=a||null==n||(e+="</div>"),deviceHeaderSet(),p="",2==a&&(e+="<tr><td colspan="+c+">"),meshes[u.meshid]&&1==meshes[u.meshid].mtype&&(p="<span class=devHeaderx>, alleen Intel&reg; AMT</span>"),meshes[u.meshid]&&3==meshes[u.meshid].mtype&&(p=meshes[u.meshid].relayid?"<span class=devHeaderx>, Doorgestuurde apparaten</span>":"<span class=devHeaderx>, Lokale apparaten</span>"),1==a&&null!=n&&(2==t&&(e+="<td><div style=width:301px></div></td>"),""!=e)&&(e+="</tr></table>"),2==a&&(e+="<div>"),e=(e+="<div class=DevSt style=width:100%;padding-top:4px><span style=float:right>")+"<span id=DevxHeader"+deviceHeaderId+" class=devHeaderx></span>"+p+"</span>",1!=a&&2!=a&&3!=a&&5!=a||(k=CollapsedGroups[u.meshid],e+='<i role="button" cmenu=expandAllContextMenu onclick=toggleCollapseGroup("'+deviceHeaderId+'","'+u.meshid+'",'+a+') class="fa-fw fa-solid '+(!0===k?"fa-chevron-right":"fa-chevron-down")+'" id="DevxColImg'+deviceHeaderId+'"></i>'),n=meshes[u.meshid]?(e+='<span id=MxMESH cmenu=meshContextMenu tabindex=0 style=cursor:pointer onclick=gotoMesh("'+u.meshid+"\") onkeypress=\"if (event.key=='Enter') gotoMesh('"+u.meshid+"')\">"+EscapeHtml(meshes[u.meshid].name)+"</span>"+getMeshActions(g,v)+"</div>",u.meshid):(e+="<span id=MxMESH><i>Individuele apparaten</i></span></div>","*"),2==a&&(e+="</div>"),t=0,(o[n]=1)!=a&&3!=a&&5!=a||(e+="<div id=DevxCol"+deviceHeaderId+(!0===k?" style=display:none":"")+">")):1==sort?(p=u.pwr||0)!==n&&(1!=a&&3!=a&&5!=a||null==n||(e+="</div>"),deviceHeaderSet(),1==a&&null!==n&&(2==t&&(e+="<td><div style=width:301px></div></td>"),""!=e)&&(e+="</tr></table>"),2==a&&(e+="<tr><td colspan="+c+">"),e+="<div class=DevSt style=width:100%;padding-top:4px><span id=DevxHeader"+deviceHeaderId+" class=devHeaderx style=float:right></span>",1!=a&&2!=a&&3!=a&&5!=a||(k=CollapsedGroups["pwr:"+p],e+='<i role="button" cmenu=expandAllContextMenu onclick=toggleCollapseGroup("'+deviceHeaderId+'","pwr:'+p+'",'+a+') class="fa-fw fa-solid '+(!0===k?"fa-chevron-right":"fa-chevron-down")+'" id="DevxColImg'+deviceHeaderId+'"></i>'),e+="<span>"+PowerStateStr2(u.pwr)+"</span></div>",n=p,t=0,1!=a&&3!=a&&5!=a||(e+="<div id=DevxCol"+deviceHeaderId+(!0===k?" style=display:none":"")+">")):2!=sort&&5!=sort||null==n&&(n="1"),1==a?e+="<div name=xxdevice1 id=xv1"+u._id+" style=display:inline-block;position:relative;width:"+d+"px;height:50px;padding-top:1px;padding-bottom:1px></div>":2==a?(m=u.meshid,1==sort?m="pwr:"+(u.pwr||0):3!=sort&&4!=sort||(m="tag:**xx**xx*TaG*xx**xx**"),e+="<tr name=xxdevice2 colname=DevxCol"+m+" style=height:20px"+((k=3!=sort&4!=sort&CollapsedGroups[m])?";display:none":"")+" id=xv2"+u._id+"></tr>"):(3==a||5==a)&&1&u.conn&&0!=(8&v||256&v)&&u.agent&&0!=(1&u.agent.caps)&&(0!=Object.keys(checkedNodeids).length&&!checkedNodeids[u._id]||(e+=updateDeviceViewHtml(a,null,u),r.push(u._id))),(3==sort||4==sort)&&""!=e){if(u.tags)for(var h in u.tags){var f=u.tags[h],k=(4==sort&&(f=g?g.name+" - "+u.tags[h]:"**INDV*~*DEVS** - "+u.tags[h]),CollapsedGroups["tag:"+encodeURIComponentEx(f)]),x=e.replace("**xx**xx*TaG*xx**xx**",encodeURIComponentEx(f)+(k?" style=display:none":""));if(null==i[f]?(i[f]=x,s[f]=1):(i[f]+=x,s[f]+=1),3==a||5==a)break}else 4!=sort||null==g||null!=u.tags&&0!=u.tags.length||(f=g.name,k=CollapsedGroups["tag:"+encodeURIComponentEx(f)],x=e.replace("**xx**xx*TaG*xx**xx**",encodeURIComponentEx(f)+(k?" style=display:none":"")),null==i[f]?(i[f]=x,s[f]=1):(i[f]+=x,s[f]+=1));e=""}deviceHeaderTotal++,void 0===deviceHeaderCount[u.state]?deviceHeaderCount[u.state]=1:deviceHeaderCount[u.state]++}}if(1==a&&null!=n&&(e+="</div>"),32<=r.length&&(Q("autoConnectDesktopCheckbox").checked=!1),QE("autoConnectDesktopCheckbox",r.length<32),3==sort||4==sort){var b=[],y=0;for(w in i)b.push(w);for(h in b.sort(function(e,t){return sortCollator.compare(e.toLowerCase(),t.toLowerCase())}),b){var w=b[h];e=2==a?(e+="<tr><td colspan="+c+"><div class=DevSt style=width:100%;padding-top:4px>",k=CollapsedGroups["tag:"+encodeURIComponentEx(w)],(e+='<i role="button" cmenu=expandAllContextMenu onclick=toggleCollapseGroup("'+y+'","tag:'+encodeURIComponentEx(w)+'",2) class="fa-fw fa-solid '+(!0===k?"fa-chevron-right":"fa-chevron-down")+'" id="DevxColImg'+y+'"></i>')+"<span class=devHeaderx style=float:right>"+s[w]+" node"+(1<s[w]?"s":"")+"</span><span>"+EscapeHtml(w).split("|").join(" &rarr; ").split("**INDV*~*DEVS**").join("<i>Individuele apparaten</i>")+"</span></div>"+i[w]):(e+="<div class=DevSt style=width:100%;padding-top:4px><span class=devHeaderx style=float:right>"+format(1<s[w]?"{0} nodes":"{0} node",s[w])+"</span>",k=CollapsedGroups["tag:"+encodeURIComponentEx(w)],(e=(e+='<i role="button" cmenu=expandAllContextMenu onclick=toggleCollapseGroup("'+y+'","tag:'+encodeURIComponentEx(w)+'") class="fa-fw fa-solid '+(!0===k?"fa-chevron-right":"fa-chevron-down")+'" id="DevxColImg'+y+'"></i>')+"<span>"+EscapeHtml(w).split("|").join(" &rarr; ").split("**INDV*~*DEVS**").join("<i>Individuele apparaten</i>")+"</span></div>")+"<div id=DevxCol"+y+(!0===k?" style=display:none":"")+">"+i[w]+"</div>"),y++}}var M=!1;if(""==e&&0<nodes.length&&(""!=Q("SearchInput").value||0!=Q("DevFilterSelect").value)&&(M=!0,e=3==sort?'<div style="margin:30px">Er zijn geen apparaten opgenomen in groepen, klik op het apparaat "Groups" om het aan een groep toe te voegen.</div>':'<div style="margin:30px">Geen apparaten die overeenkomen met deze zoekopdracht. <a onclick=clearDeviceSearch()>Wis zoekfilter</a></div>'),1==a&&2==t&&(e+="<td><div style=width:301px></div></td>"),0==sort&&""==Q("SearchInput").value&&0==Q("DevFilterSelect").value&&a<3){var S=deviceHeaderId,C=[];for(w in meshes)C.push(meshes[w]);for(w in C.sort(nameSort),C){var A=C[w],v=GetMeshRights(A);null==o[A._id]&&(""!=n&&""!=e&&(e+="</tr></table>"),e+="<table style=width:100%;padding-top:4px cellpadding=0 cellspacing=0><tr><td colspan=3 class=DevSt>",S++,k=CollapsedGroups[A._id],e=(e=(e+='<i role="button" cmenu=expandAllContextMenu onclick=toggleCollapseGroup("'+S+'","'+A._id+'") class="fa-fw fa-solid '+(!0===k?"fa-chevron-right":"fa-chevron-down")+'" id="DevxColImg'+S+'"></i>')+'<span id=MxMESH style=cursor:pointer onclick=gotoMesh("'+A._id+'")>'+EscapeHtml(A.name)+"</span><span>")+getMeshActions(A,v)+"</span></td></tr><tr>",1==A.mtype?(e+="<td><div style=padding:10px><i>Geen Intel&reg; AMT apparaten in deze apparaatgroep",0==(4&v)||4294967295!=userinfo.siteadmin&&0!=(4096&userinfo.siteadmin)||(e+=", <a href=# style=cursor:pointer onclick='return addDeviceToMesh(\""+A._id+"\")'>Voeg toe</a>")):2==A.mtype?(e=e+"<td><div id=DevxCol"+S+(!0===k?" style=display:none":"")+"><div style=padding:10px><i>Geen apparaten in deze apparaatgroep.",0==(4&v)||4294967295!=userinfo.siteadmin&&0!=(4096&userinfo.siteadmin)||(e+=", <a href=# style=cursor:pointer onclick='return addAgentToMesh(\""+A._id+"\")'>Voeg toe</a>")):3==A.mtype?(e=e+"<td><div id=DevxCol"+S+(!0===k?" style=display:none":"")+"><div style=padding:10px><i>Geen lokale apparaten in deze apparaatgroep",0==(4&v)||4294967295!=userinfo.siteadmin&&0!=(4096&userinfo.siteadmin)||(e+=", <a href=# style=cursor:pointer onclick='return addLocalDeviceToMesh(\""+A._id+"\")'>Voeg toe</a>")):4==A.mtype&&(e=e+"<td><div id=DevxCol"+S+(!0===k?" style=display:none":"")+"><div style=padding:10px><i>Geen apparaten in deze apparaatgroep."),e+=".</i></div></td></div>",n=A._id,0)}}for(w in""!=e&&0==M?(e+="</table>",2==a&&(M="",null==deviceViewSettings&&(deviceViewSettings={}),Array.isArray(deviceViewSettings.devsCols)||(deviceViewSettings.devsCols=["user","ip","conn"]),0<=deviceViewSettings.devsCols.indexOf("agtype")&&(M+="<th style=width:100px>Agent Type"),0<=deviceViewSettings.devsCols.indexOf("agver")&&(M+="<th style=width:100px>Agent versie"),0<=deviceViewSettings.devsCols.indexOf("os")&&(M+="<th style=width:160px>OS"),0<=deviceViewSettings.devsCols.indexOf("tags")&&(M+="<th style=width:120px>Tags"),0<=deviceViewSettings.devsCols.indexOf("windowsav")&&(M+="<th style=width:100px>Windows AV"),0<=deviceViewSettings.devsCols.indexOf("windowsupdate")&&(M+="<th style=width:120px>Windows Update"),0<=deviceViewSettings.devsCols.indexOf("windowsfirewall")&&(M+="<th style=width:120px>Windows Firewall"),0<=deviceViewSettings.devsCols.indexOf("lastbootuptime")&&(M+="<th style=width:120px>Tijd van laatste opstart"),0<=deviceViewSettings.devsCols.indexOf("links")&&(M+="<th style=width:120px>Links"),0<=deviceViewSettings.devsCols.indexOf("user")&&(M+="<th style=width:120px>Gebruiker"),0<=deviceViewSettings.devsCols.indexOf("ip")&&(M+="<th style=width:120px>Adres"),0<=deviceViewSettings.devsCols.indexOf("conn")&&(M+="<th style=width:100px>Connectiviteit"),0<=deviceViewSettings.devsCols.indexOf("amthost")&&(M+="<th style=width:100px>AMT Host"),0<=deviceViewSettings.devsCols.indexOf("amtstate")&&(M+="<th style=width:100px>AMT status"),0<=deviceViewSettings.devsCols.indexOf("lastseen")&&(M+="<th style=width:120px>Laatst gezien",0==requestedLastConnects)&&(requestedLastConnects=!0,meshserver.send({action:"lastconnects"})),e="<table style=width:100%;margin-top:4px cellpadding=0 cellspacing=0><th>"+M+e+"</tr></table><div style=height:1px></div>")):(e+="</table>",3==sort&&(e='<div style="margin:10px"><i>Geen apparaten tags gevonden.</i></div>')),e+="<div style=border-top-style:solid;border-top-width:1px;border-top-color:#DDDDDD;cursor:pointer;font-size:small;margin-top:4px>",a<3&&0==sort&&0<Object.keys(meshes).length&&(4294967295==userinfo.siteadmin||0==(64&userinfo.siteadmin))&&(e+='<a href=# onclick="return account_createMesh()" title="Maak een nieuwe apparaatgroep." style=cursor:pointer>Apparaatgroep toevoegen</a>&nbsp'),4294967295!=userinfo.siteadmin&&0!=(128&userinfo.siteadmin)||(e+="<a href=# onclick='return p10showMeshCmdDialog(0)' style=cursor:pointer title=\"Download MeshCmd, een opdrachtregelprogramma dat vele functies uitvoert.\">MeshCmd</a>&nbsp","win32"!=navigator.platform.toLowerCase()&&"macintel"!=navigator.platform.toLowerCase())||(e+="<a href=# onclick='return p10showMeshRouterDialog()' style=cursor:pointer title=\"Download MeshCentral Router, een hulpmiddel voor het toewijzen van TCP-poorten.\">Router</a>&nbsp"),e+="</div><div style=height:60px></div>",QH("xdevices",e),deviceHeaderSet(),deviceHeaders)QH(w,deviceHeaders[w]);for(w in deviceHeadersTitles)Q(w).title=deviceHeadersTitles[w];if(p1updateInfo(),3!=a&&5!=a||1!=xxcurrentView)disconnectAllKvmFunction(),Q("autoConnectDesktopCheckbox").checked=!1;else{var D,T=[{x:180,y:101},{x:302,y:169},{x:454,y:255}][Q("sizeselect").selectedIndex];for(w in 3==a&&(M=T.x+2,l=l-5,D=Math.floor(l/M),D=M+Math.floor((l-D*M)/D),T.y=T.y*(D/T.x),T.x=D),multiDesktop)multiDesktop[w].xxdelete=!0;for(w in r){var E=r[w],N=E.split("/")[2],I=multiDesktop[E];if(null!=I){var _=5==a?I.m.width*T.y/I.m.height:T.x;I.m.CanvasId.setAttribute("style","background-color:black;width:"+_+"px;height:"+T.y+"px"),Q("xkvmid_"+N).appendChild(I.m.CanvasId),delete I.xxdelete,QH("skvmid_"+N,["Verbroken","Verbinden...","Setup...","",""][null==I.m.State?I.m.state:I.m.State])}else{u=getNodeFromId(E);if(desktopNode==u&&null!=desktop){var t=desktop.m.CanvasId,_=5==a?desktop.m.width*T.y/desktop.m.height:T.x;t.setAttribute("id","kvmid_"+N),t.setAttribute("style","background-color:black;width:"+_+"px;height:"+T.y+"px"),t.setAttribute("onclick","toggleKvmDevice('"+E+"')"),t.removeAttribute("onmousedown"),t.removeAttribute("onmouseup"),t.removeAttribute("onmousemove"),Q("xkvmid_"+N).appendChild(t),QH("skvmid_"+N,["Verbroken","Verbinden...","Setup...","",""][null==desktop.m.State?desktop.m.state:desktop.m.State]),desktop.m.SendCompressionLevel&&desktop.m.SendCompressionLevel(multidesktopsettings.agentencoding,multidesktopsettings.quality,multidesktopsettings.scaling,multidesktopsettings.framerate),desktop.shortid=N,desktop.onStateChanged=onMultiDesktopStateChange,desktop.m.onRemoteInputLockChanged=null,desktop.m.onKeyboardStateChanged=null,multiDesktop[E]=desktop,desktop=desktopNode=currentNode=null,QH("DeskParent",'<canvas id="Desk" oncontextmenu="return false" onmousedown=dmousedown(event) onmouseup=dmouseup(event) onmousemove=dmousemove(event)></canvas>')}else{(t=document.createElement("canvas")).setAttribute("id","kvmid_"+N),t.setAttribute("width",640),t.setAttribute("height",480),t.setAttribute("oncontextmenu","return false"),t.setAttribute("style","background-color:black;width:"+T.x+"px;height:"+T.y+"px"),t.setAttribute("onclick","toggleKvmDevice('"+E+"')");try{Q("xkvmid_"+N).appendChild(t)}catch(e){}1==Q("autoConnectDesktopCheckbox").checked&&setTimeout(function(){connectMultiDesktop(u,1)},100)}}}for(w in multiDesktop)1==multiDesktop[w].xxdelete?(multiDesktop[w].Stop(),delete multiDesktop[w]):debugmode&&multiDesktop[w].m&&multiDesktop[w].m.onScreenSizeChange&&mdeskAdjust(multiDesktop[w].m,multiDesktop[w].m.ScreenWidth,multiDesktop[w].m.ScreenHeight,multiDesktop[w].m.CanvasId);deskAdjust()}}oldviewmode=a,onDevicesScrollEx()}}var xxModal,onDevicesTouchActive=!1,onDevicesScrollnagleTimer=null;function onDevicesScroll(e){(e=void 0===e?!1:e)&&(Q("xdevices").scrollTop=0),null!=onDevicesScrollnagleTimer||onDevicesTouchActive||(onDevicesScrollnagleTimer=setTimeout(onDevicesScrollEx,250))}function onDeviceTouch(e){onDevicesTouchActive!=e&&0==(onDevicesTouchActive=e)&&onDevicesScrollEx()}function onDevicesScrollEx(){null!=onDevicesScrollnagleTimer&&(clearTimeout(onDevicesScrollnagleTimer),onDevicesScrollnagleTimer=null);for(var e,t=Q("xdevices").scrollTop-200,n=Q("xdevices").scrollTop+Q("xdevices").clientHeight+200,o=Q("viewselect").value,a=document.getElementsByName("xxdevice"+o),i=0;i<a.length;i++)a[i].offsetTop>=t&&a[i].offsetTop<n&&null!=(e=getNodeFromId(a[i].id.substring(3)))?updateDeviceViewHtml(o,a[i],e):a[i].innerHTML=""}function updateDeviceViewDevice(e){var t,n=Q("viewselect").value;1!=n&&2!=n?mainUpdate(4):null!=(e="string"==typeof e?getNodeFromId(e):e)&&null!=(t=Q("xv"+n+e._id))&&""!=t.innerHTML&&updateDeviceViewHtml(n,t,e)}function updateDeviceViewHtml(e,t,n){var o=EscapeHtml(n.name),a=(0==o.length&&(o="<i>Geen</i>"),null!=n.rname&&0<n.rname.length&&(o+=" / "+EscapeHtml(n.rname)),EscapeHtml(n.name));if(0==(a=1==showRealNames&&null!=n.rname?EscapeHtml(n.rname):a).length&&(a="<i>Geen</i>"),1==e&&"none"==t.parentNode.style.display||2==e&&"none"==t.style.display)t.innerHTML="";else{var i="",s="",r=(1==stars[n._id]&&(s+=2==e?"<img class=deviceNotifySmallDotSub src=images/icon-star-notify-10.png width=10 height=10>":"<img class=deviceNotifyDotSub src=images/icon-star-notify-16.png width=16 height=16>"),null!=n.sessions&&(null!=n.sessions.msg&&(s+=2==e?"<div onclick=showDeviceMessages('"+n._id+'\',null,event) style="width:10;height:10" class=deviceNotifySmallDotSub></div>':"<div onclick=showDeviceMessages('"+n._id+'\',null,event) style="width:16;height:16" class=deviceNotifyDotSub>'+Object.keys(n.sessions.msg).length+"</div>"),null==n.sessions.kvm&&null==n.sessions.terminal&&null==n.sessions.files&&null==n.sessions.tcp&&null==n.sessions.udp||(s+=2==e?"<img onclick=showDeviceSessions('"+n._id+"',null,event) class=deviceNotifySmallDotSub src=images/icon-relay-notify10.png width=10 height=10>":"<img onclick=showDeviceSessions('"+n._id+"',null,event) class=deviceNotifyDotSub src=images/icon-relay-notify.png width=16 height=16>"),null!=n.sessions.help&&(s+=2==e?"<img onclick=showDeviceHelpRequests('"+n._id+"',null,event) class=deviceNotifySmallDotSub src=images/icon-help-notify-10.png width=10 height=10>":"<img onclick=showDeviceHelpRequests('"+n._id+"',null,event) class=deviceNotifyDotSub src=images/icon-help-notify-16.png width=16 height=16>"),null!=n.sessions.battery)&&1==e&&(l="","ac"==(r=n.sessions.battery).state&&(l="Apparaat is aangesloten"),"dc"==r.state&&(l="Apparaat werkt op batterijen"),c="",d=-1,"number"==typeof r.level&&0<=r.level&&r.level<=100&&(c=r.level+"%",5<(d=Math.floor((r.level+10)/25)+1)&&(lvl=5),"ac"==r.state)&&(100==r.level?d=11:d+=5),0<d)&&(i+='<div class="deviceBatterySmall deviceBatterySmall'+d+'" title="'+(null!=l?l+", "+c:c)+'"></div>'),""!=s&&(i+=2==e?"<div class=deviceNotifySmallDot>"+s+"</div>":"<div class=deviceNotifyDot>"+s+"</div>"),n.icon);if(n.conn&&0!=n.conn||3==n.mtype||(r+=" gray"),1==e)t.innerHTML='<table id=devs cmenu=devsContentMenu onmouseover=devMouseHover(this,1) onmouseout=devMouseHover(this,0) style=width:100%;height:100%><tr><td style=width:22px><input class="'+n.meshid+' DeviceCheckbox form-check-input me-2" onchange=p1devcheck(event) value=devid_'+n._id+" type=checkbox "+(checkedNodeids[n._id]?" checked":"")+"></td><td><table onmouseup=gotoDevice('"+n._id+"',null,null,event) border=0 cellspacing=0 style=width:100%;height:100%;cursor:pointer><tr><td style=width:50px tabindex=0 onkeypress=\"if (event.key=='Enter') gotoDevice('"+n._id+'\',null,null,event)"><div class="i'+r+'" style=width:50px></div></td><td class=g1t></td><td class=e2t><div class=e1t style=width:'+(t.clientWidth-120)+'px title="'+o+'">'+a+"</div><div>"+NodeStateStr(n)+"</div></td><td class=g2t></td></tr></table></td></tr></table>"+i;else if(2==e){var l,d=[],c=(n.conn&&(0!=(1&n.conn)&&(4==n.mtype?"PDU"==n.porttype?d.push('<span title="Schakelpoort is klaar voor gebruik..">Schakelaar</span>'):d.push('<span title="IP-KVM poort is verbonden en klaar voor gebruik.">IP-KVM</span>'):d.push('<span title="Mesh-agent is verbonden en klaar voor gebruik.">Agent</span>')),0!=(2&n.conn)?d.push('<span title="Intel&reg; AMT CIRA is verbonden en klaar voor gebruik.">CIRA</span>'):0!=(4&n.conn)&&d.push('<span title="Intel&reg; AMT is routeerbaar.">AMT</span>'),0!=(8&n.conn)&&d.push('<span title="Mesh-agent is bereikbaar met een andere agent als relay.">Relay</span>'),0!=(16&n.conn))&&d.push('<span title="MQTT verbinding met het apparaat is actief.">MQTT</span>'),3==n.mtype&&((l=meshes[n.meshid])&&l.relayid?d.push('<span title="Lokale netwerkverbinding via een relay-agent.">Relay</span>'):d.push('<span title="Lokale netwerkverbinding.">Lokaal</span>')),n.desc&&0<=deviceViewSettings.devsCols.indexOf("desc")&&(a='<div class="flex-grow-1">'+a+"</div><div style=float:right"+(1==stars[n._id]?";padding-right:15px":"")+">"+EscapeHtml(n.desc)+"</div>"),n.meshid),u=(1==sort?c="pwr:"+(n.pwr||0):3!=sort&&4!=sort||(c="tag:**xx**xx*TaG*xx**xx**"),CollapsedGroups[c],"<td style=position:relative><div id=devs cmenu=devsContentMenu class=bar18 tabindex=0 onmouseover=devMouseHover(this,1) onmouseout=devMouseHover(this,0) style=height:18px;width:100%;font-size:medium onkeypress=\"if (event.key=='Enter') gotoDevice('"+n._id+"',null,null,event)\">");if(u=(u=(u+='<div class=deviceBarCheckbox><input class="'+n.meshid+' DeviceCheckbox form-check-input me-2" value=devid_'+n._id+" type=checkbox onchange=p1devcheck(event) "+(checkedNodeids[n._id]?" checked":"")+"></div>")+("<div class=deviceBarIcon onmouseup=gotoDevice('"+n._id+"',null,null,event)><div class=\"j"+r+'" style=width:16px;margin-top:1px;margin-left:2px;height:16px></div></div>'))+"<div class=g1 style=height:18px;float:left></div><div class=g2 style=height:18px;float:right></div>"+('<div class="style10 d-flex align-items-center" style=cursor:pointer;font-size:14px;max-height:18px;text-overflow:ellipsis;overflow:hidden;white-space:nowrap title="'+o+"\" onmouseup=gotoDevice('"+n._id+"',null,null,event)>"+a+"</div></div>"+i+"</td>"),null==deviceViewSettings&&(deviceViewSettings={}),Array.isArray(deviceViewSettings.devsCols)||(deviceViewSettings.devsCols=["user","ip","conn"]),0<=deviceViewSettings.devsCols.indexOf("agtype")&&(u+='<td style=text-align:center;font-size:x-small;padding-left:4px;padding-right:4px title="'+EscapeHtml(3!=n.mtype&&n.agent&&n.agent.id&&n.agent.id<=agentsStr.length?agentsStr[n.agent.id]:"")+'">'+EscapeHtml(3!=n.mtype&&n.agent&&n.agent.id&&n.agent.id<=agentsStr.length?agentsStr[n.agent.id]:"").replace(",","<br />")),0<=deviceViewSettings.devsCols.indexOf("agver")&&(u+='<td style=text-align:center;font-size:x-small;padding-left:4px;padding-right:4px title="'+EscapeHtml(n.agent&&n.agent.core?n.agent.core:"")+'">'+EscapeHtml(n.agent&&n.agent.core?n.agent.core:"").replace(",","<br />")),0<=deviceViewSettings.devsCols.indexOf("os")&&(3==n.mtype?(s="",4==n.agent.id&&(s="Windows"),6==n.agent.id&&(s="Linux"),29==n.agent.id&&(s="MacOS"),u+='<td style=text-align:center;font-size:x-small title="'+EscapeHtml(s)+'">'+EscapeHtml(s)):u+='<td style=text-align:center;font-size:x-small title="'+EscapeHtml(n.osdesc||"")+'">'+EscapeHtml(n.osdesc||"")),0<=deviceViewSettings.devsCols.indexOf("tags")){u+="<td style=text-align:center;font-size:x-small>";var p="";if(null!=n.tags)for(var m in n.tags)p+="<span class=tagSpan>"+EscapeHtml(n.tags[m])+"</span> ";u+="<span style=line-height:20px>"+p+"</span>"}0<=deviceViewSettings.devsCols.indexOf("windowsav")&&(u+="<td style=text-align:center>"+(n.wsc&&null!=n.wsc.antiVirus?"OK"==n.wsc.antiVirus?"<span style=color:green>OK</span>":"<span style=color:red>Uitgeschakeld</span>":"")),0<=deviceViewSettings.devsCols.indexOf("windowsupdate")&&(u+="<td style=text-align:center>"+(n.wsc&&null!=n.wsc.autoUpdate?"OK"==n.wsc.autoUpdate?"<span style=color:green>OK</span>":"<span style=color:red>Uitgeschakeld</span>":"")),0<=deviceViewSettings.devsCols.indexOf("windowsfirewall")&&(u+="<td style=text-align:center>"+(n.wsc&&null!=n.wsc.firewall?"OK"==n.wsc.firewall?"<span style=color:green>OK</span>":"<span style=color:red>Uitgeschakeld</span>":"")),0<=deviceViewSettings.devsCols.indexOf("lastbootuptime")&&(u+="<td style=text-align:center;font-size:x-small>"+(null!=n.lastbootuptime?printDateTime(new Date(n.lastbootuptime)):"")),0<=deviceViewSettings.devsCols.indexOf("links")&&(u+="<td style=text-align:center;font-size:x-small>"+getShortRouterLinks(n)),0<=deviceViewSettings.devsCols.indexOf("user")&&(u+="<td style=text-align:center>"+getUserShortStr(n)),0<=deviceViewSettings.devsCols.indexOf("ip")&&(l="",3==n.mtype?l=n.host:n.ip&&(l=n.ip),u+="<td style=text-align:center>"+l),0<=deviceViewSettings.devsCols.indexOf("conn")&&(u+="<td style=text-align:center>"+d.join("&nbsp;+&nbsp;")),0<=deviceViewSettings.devsCols.indexOf("lastseen")&&(u+="<td style=text-align:center;font-size:x-small>",0<n.conn?u+="Verbonden":null!=n.lastconnect&&(u+=printDateTime(new Date(n.lastconnect)))),0<=deviceViewSettings.devsCols.indexOf("amthost")&&(u+="<td style=text-align:center>"+(null==n.intelamt||null==n.intelamt.host?"":EscapeHtml(n.intelamt.host))),0<=deviceViewSettings.devsCols.indexOf("amtstate")&&(c="",n.intelamt&&(0==n.intelamt.state&&(c=' <span title="Intel&reg; AMT is niet geactiveerd">Pre</span>'),1==n.intelamt.state&&(c=' <span title="Intel&reg; AMT is in activeringsmodus">In</span>'),2==n.intelamt.state)&&n.intelamt.flags&&(2&n.intelamt.flags?c=' <span title="Intel&reg; AMT wordt geactiveerd in Client Control Mode">CCM</span>':4&n.intelamt.flags&&(c+=' <span title="Intel&reg; AMT wordt geactiveerd in de beheerdersmodus">ACM</span>')),u+="<td style=text-align:center>"+c),t.innerHTML=u}else if(3==e||5==e)return u="<div id=devs cmenu=devsContentMenu style=display:inline-block;position:relative;margin:1px;background-color:lightgray;border-radius:5px;position:relative><div tabindex=0 style=padding:3px;cursor:pointer onmouseup=gotoDevice('"+n._id+"',11,null,event) onkeypress=\"if (event.key=='Enter') gotoDevice('"+n._id+"',11,null,event)\">"+i,(u+='<div class="j'+r+'" style=width:16px;float:left></div>&nbsp;'+a+"</div>")+"<span onmouseup=gotoDevice('"+n._id+"',null,null,event)></span><div id=xkvmid_"+n._id.split("/")[2]+"><div id=skvmid_"+n._id.split("/")[2]+' tabindex=0 style="position:absolute;color:white;left:5px;top:27px;text-shadow:0px 0px 5px #000;z-index:10;cursor:default" onclick=toggleKvmDevice(\''+n._id+"') onkeypress=\"if (event.key=='Enter') toggleKvmDevice('"+n._id+"')\">Verbroken</div></div></div>"}}function getShortRouterLinks(e){var t="",n=GetNodeRights(e);if((0!=(1&e.conn)||3==e.mtype)&&e.agent&&0!=(8&n)&&14!=e.agent.id&&(0!=webRelayPort&&(t=(t+='<a href=# onclick=p10WebRouter("'+e._id+'",1,'+(e.httpport||80)+")>HTTP"+(e.httpport&&80!=e.httpport?"/"+e.httpport:"")+"</a>&nbsp;")+'<a href=# onclick=p10WebRouter("'+e._id+'",2,'+(e.httpsport||443)+")>HTTPS"+(e.httspport&&443!=e.httpsport?"/"+e.httpsport:"")+"</a>&nbsp;"),0<e.agent.id&&e.agent.id<5&&("win32"!=navigator.platform.toLowerCase()||null!=serverinfo.devicemeshrouterlinks&&0==serverinfo.devicemeshrouterlinks.rdp||(t+='<a href=# cmenu=altPortContextMenu id=rdpMCRouterLink onclick=p10MCRouter("'+e._id+'",3)>RDP</a>&nbsp;')),4<e.agent.id&&("win32"!=navigator.platform.toLowerCase()&&"macintel"!=navigator.platform.toLowerCase()||null!=serverinfo.devicemeshrouterlinks&&0==serverinfo.devicemeshrouterlinks.ssh||(t+='<a href=# onclick=p10MCRouter("'+e._id+'",4,'+(e.sshport||22)+")>SSH</a>&nbsp;"),"win32"!=navigator.platform.toLowerCase()||null!=serverinfo.devicemeshrouterlinks&&0==serverinfo.devicemeshrouterlinks.scp||(t+='<a href=# onclick=p10MCRouter("'+e._id+'",5,'+(e.sshport||22)+")>SCP</a>&nbsp;")),"win32"==navigator.platform.toLowerCase()||"macintel"==navigator.platform.toLowerCase())&&null!=serverinfo.devicemeshrouterlinks&&Array.isArray(serverinfo.devicemeshrouterlinks.extralinks))for(var o in serverinfo.devicemeshrouterlinks.extralinks){var o=serverinfo.devicemeshrouterlinks.extralinks[o],a='"'+o.protocol+'"';doesDeviceMatchFilterTags(e,o.filter)&&(3!=e.mtype||"mcrdesktop"!=o.protocol&&"mcrfiles"!=o.protocol)&&("number"==typeof o.protocol?a=o.protocol:"http"==o.protocol?a=1:"https"==o.protocol?a=2:"rdp"==o.protocol?a=3:"ssh"==o.protocol?a=4:"scp"==o.protocol?a=5:"mcrdesktop"==o.protocol?a=6:"mcrfiles"==o.protocol&&(a=7),t+='<a href=# onclick=p10MCRouter("'+e._id+'",'+a+","+o.port+(o.ip?',"'+o.ip+'"':",null")+","+(o.localport||0)+")>"+o.name+"</a>&nbsp;")}return t}function doesDeviceMatchFilterTags(e,t){if(null==t)return!0;if(Array.isArray(t)){if(0<=t.indexOf(e.meshid))return!0;if(0<=t.indexOf(e._id))return!0;if(Array.isArray(e.tags))for(var n in e.tags)if(0<=t.indexOf("tag:"+e.tags[n]))return!0}return!1}function showDeviceHelpRequests(e,t,n){if(n&&haltEvent(n),!xxdialogMode||t){var o=null,a="";if(null==(o=null==e?currentNode:getNodeFromId(e))||null==o.sessions)setDialogMode(0);else{if(null!=o.sessions.help)for(var i in o.sessions.help)a+='<div style="background-color:#CCC;padding:6px;border-radius:6px"><a style="float:right" onclick=closeDeviceHelpRequest("'+encodeURIComponentEx(i)+'","'+encodeURIComponentEx(o._id)+'")>Afwijzen</a><div style=margin-bottom:6px><b>'+EscapeHtml(i)+"</b></div><div style=margin-bottom:6px>"+EscapeHtml(o.sessions.help[i])+"</div></div>";""!=a&&(xxdialogTag="HELPREQ-"+o._id,setModalContent("xxAddAgent","Hulp verzoeken - "+EscapeHtml(o.name),a),showModal("xxAddAgentModal","idx_dlgOkButton"))}}return!1}function closeDeviceHelpRequest(e,t){setDialogMode(0),meshserver.send({action:"msg",type:"localapp",nodeid:decodeURIComponent(t),appid:decodeURIComponent(e),value:{cmd:"cancelhelp"}})}function showDeviceSessions(e,t,n){if(n&&haltEvent(n),!xxdialogMode||t){var o=null,a="";if(null==(o=null==e?currentNode:getNodeFromId(e))||null==o.sessions)setDialogMode(0);else{for(var i in o.sessions)if("kvm"==i&&null==o.sessions.multidesk)for(var s in a+="<u>Extern bureaublad</u>",o.sessions.kvm)s.startsWith("user/")?(r="",s!=userinfo._id&&4294967295!=GetNodeRights(o)||(r=' <i role=button onclick=\'return endDeviceSession("kvm", "'+encodeURIComponentEx(o._id)+'", "'+encodeURIComponentEx(s)+'")\' title="Deze sessie verbreken" class="fa-fw fa-solid fa-trash text-danger" ></i>'),a+=addHtmlValue2(getUserName(s),(1==o.sessions.kvm[s]?"1 sessie":nobreak(format("{0} sessies",o.sessions.kvm[s])))+r)):"busy"==s&&(a+=addHtmlValue2("Apparaat is bezet",1==o.sessions.kvm[s]?"1 sessie":nobreak(format("{0} sessies",o.sessions.kvm[s]))));else if("multidesk"==i)for(var s in a+="<u>Extern bureaublad</u>",o.sessions.multidesk){var r="";s!=userinfo._id&&4294967295!=GetNodeRights(o)||(r=' <i role=button onclick=\'return endDeviceSession("multidesk", "'+encodeURIComponentEx(o._id)+'", "'+encodeURIComponentEx(s)+'")\' title="Deze sessie verbreken" class="fa-fw fa-solid fa-trash text-danger"></i>'),a+=addHtmlValue2(getUserName(s),(1==o.sessions.multidesk[s]?"1 sessie":nobreak(format("{0} sessies",o.sessions.multidesk[s])))+r)}else if("terminal"==i)for(var s in a+="<u>Terminal</u>",o.sessions.terminal){r="";s!=userinfo._id&&4294967295!=GetNodeRights(o)||(r=' <i role=button onclick=\'return endDeviceSession("terminal", "'+encodeURIComponentEx(o._id)+'", "'+encodeURIComponentEx(s)+'")\' title="Deze sessie verbreken" class="fa-fw fa-solid fa-trash text-danger"></i>'),a+=addHtmlValue2(getUserName(s),(1==o.sessions.terminal[s]?"1 sessie":nobreak(format("{0} sessies",o.sessions.terminal[s])))+r)}else if("files"==i)for(var s in a+="<u>Bestanden</u>",o.sessions.files){r="";s!=userinfo._id&&4294967295!=GetNodeRights(o)||(r=' <i role=button onclick=\'return endDeviceSession("files", "'+encodeURIComponentEx(o._id)+'", "'+encodeURIComponentEx(s)+'")\' title="Deze sessie verbreken" class="fa-fw fa-solid fa-trash text-danger"></i>'),a+=addHtmlValue2(getUserName(s),(1==o.sessions.files[s]?"1 sessie":nobreak(format("{0} sessies",o.sessions.files[s])))+r)}else if("tcp"==i)for(var s in a+="<u>TCP routering</u>",o.sessions.tcp){r="";s!=userinfo._id&&4294967295!=GetNodeRights(o)||(r=' <i role=button onclick=\'return endDeviceSession("tcp", "'+encodeURIComponentEx(o._id)+'", "'+encodeURIComponentEx(s)+'")\' title="Deze sessie verbreken" class="fa-fw fa-solid fa-trash text-danger"></i>'),a+=addHtmlValue2(getUserName(s),(1==o.sessions.tcp[s]?"1 sessie":nobreak(format("{0} sessies",o.sessions.tcp[s])))+r)}else if("udp"==i)for(var s in a+="<u>UDP routering</u>",o.sessions.udp){r="";s!=userinfo._id&&4294967295!=GetNodeRights(o)||(r=' <i role=button onclick=\'return endDeviceSession("udp", "'+encodeURIComponentEx(o._id)+'", "'+encodeURIComponentEx(s)+'")\' title="Deze sessie verbreken" class="fa-fw fa-solid fa-trash text-danger"></i>'),a+=addHtmlValue2(getUserName(s),(1==o.sessions.udp[s]?"1 sessie":nobreak(format("{0} sessies",o.sessions.udp[s])))+r)}""!=a?(xxdialogTag="SESSIONS-"+o._id,setModalContent("xxAddAgent","Sessies - "+EscapeHtml(o.name),a),showModal("xxAddAgentModal","idx_dlgOkButton")):setDialogMode(0)}}return!1}function endDeviceSession(e,t,n){var n=decodeURIComponent(n).split("/"),o=n[0]+"/"+n[1]+"/"+n[2],a=null;4==n.length&&n[3].startsWith("guest:")&&(a=atob(n[3].substring(6))),"multidesk"==e?meshserver.send({action:"endDesktopMultiplex",nodeid:decodeURIComponent(t),xuserid:o,guestname:a,guestname:a}):meshserver.send({action:"msg",type:"endtunnel",nodeid:decodeURIComponent(t),xuserid:o,guestname:a,guestname:a,protocol:e})}function showDeviceMessages(e,t,n){if(n&&haltEvent(n),!xxdialogMode||t){var o=null,a="<div style=max-height:200px;overflow-y:auto>",i=0;if(null==(o=null==e?currentNode:getNodeFromId(e))||null==o.sessions||null==o.sessions.msg)setDialogMode(0);else{for(var s in o.sessions.msg){var r=s,l=5;"string"==typeof o.sessions.msg[s].msg&&(r=o.sessions.msg[s].msg),"number"==typeof o.sessions.msg[s].msgid&&null!=eventsMessageId[o.sessions.msg[s].msgid]&&(r=eventsMessageId[o.sessions.msg[s].msgid]),a+="<table style=width:96%><td style=width:24px><div class=NotifyIconSmall"+(l=(l="number"==typeof o.sessions.msg[s].icon?o.sessions.msg[s].icon:l)<1||9<l?5:l)+'></div><td><div style="border-radius:5px;background-color:#BBB;width:100%;padding:8px">'+EscapeHtml(r)+"</div></table>",i++}a+="</div>",0<i&&(xxdialogTag="MESSAGES-"+o._id,setModalContent("xxAddAgent","Agent berichten - "+EscapeHtml(o.name),a),showModal("xxAddAgentModal","idx_dlgOkButton"))}}return!1}function toggleCollapseGroup(e,t,n){if(2==n){var o=document.getElementsByName("xxdevice2");if(0==o.length)return;for(var a,i=[],s=0;s<o.length;s++)o[s].attributes.colname.value.substring(7)==t&&i.push(o[s]);(a="none"==i[0].style.display)?delete CollapsedGroups[t]:CollapsedGroups[t]=!0;for(s=0;s<i.length;s++)i[s].style.display=a?"":"none"}else(a="none"==QS("DevxCol"+e).display)?delete CollapsedGroups[t]:CollapsedGroups[t]=!0,QV("DevxCol"+e,a);a?(QC("DevxColImg"+e).remove("fa-chevron-right"),QC("DevxColImg"+e).add("fa-chevron-down")):(QC("DevxColImg"+e).remove("fa-chevron-down"),QC("DevxColImg"+e).add("fa-chevron-right")),putstore("_collapse",JSON.stringify(CollapsedGroups)),updateCollapseAllButton(),onDevicesScrollEx(),onDevicesScrollEx()}function toggleKvmDevice(e){var t=GetNodeRights(e="string"==typeof e?getNodeFromId(e):e);(8&t||256&t)&&1&e.conn&&connectMultiDesktop(e,1)}function getUserShortStr(e){var t,n;return null!=e&&null!=e.users&&Array.isArray(e.users)&&0!=e.users.length?1<e.users.length?'<span title="'+EscapeHtml(e.users.join(", "))+'">'+nobreak(format("{0} gebruikers",e.users.length))+"</span>":(0<(n=(t=e=e.users[0]).indexOf("\\"))&&(t=e.substring(n+1)),15<(t=EscapeHtml(t)).length&&(t=t.substring(0,14)+"&#8230;"),'<span title="'+EscapeHtml(e)+'">'+t+"</span>"):""}function autoConnectDesktops(){1==Q("autoConnectDesktopCheckbox").checked&&connectAllKvmFunction()}function connectAllKvmFunction(e){if(xxdialogMode)return!1;if(!0!==e){var n,t=0;for(i in nodes){var o=nodes[i],a=nodes[i]._id;null!=multiDesktop[a]||0!=Object.keys(checkedNodeids).length&&!checkedNodeids[a]||(8&(a=GetNodeRights(o))||256&a)&&1&o.conn&&1==o.v&&t++}if(8<t)return setModalContent("xxAddAgent","Alles verbinden",format("Weet u zeker dat u verbinding wilt maken met {0} apparaten?",t)),n=function(e,t){document.getElementById("xxAddAgentModal").removeEventListener("hide.bs.modal",n),Q("autoConnectDesktopCheckbox").checked=!1},document.getElementById("xxAddAgentModal").addEventListener("hide.bs.modal",n),void showModal("xxAddAgentModal","idx_dlgOkButton",()=>{document.getElementById("xxAddAgentModal").removeEventListener("hide.bs.modal",n),connectAllKvmFunction(!0)})}for(var i in nodes)1!=nodes[i].v||null!=multiDesktop[nodes[i]._id]||0!=Object.keys(checkedNodeids).length&&!checkedNodeids[nodes[i]._id]||toggleKvmDevice(nodes[i]._id)}function disconnectAllKvmFunction(){if(xxdialogMode)return!1;for(var e in multiDesktop)multiDesktop[e].Stop();multiDesktop={}}function onMultiDesktopStateChange(e,t){try{QH("skvmid_"+e.shortid,["Verbroken","Verbinden...","Setup...","",""][t])}catch(e){}}function onDeviceSearchChanged(e){var t=new URL(window.location.href);if(null==e||"SearchInput"!=e.target.id&&"KvmSearchInput"!=e.target.id?null!=e&&"DevFilterSelect"==e.target.id||(t.searchParams.delete("filter"),urlargs.filter&&delete urlargs.filter):("SearchInput"==e.target.id?Q("KvmSearchInput").value=Q("SearchInput").value:Q("SearchInput").value=Q("KvmSearchInput").value,""!=e.target.value?(t.searchParams.set("filter",e.target.value),urlargs.filter&&(urlargs.filter=e.target.value)):(t.searchParams.delete("filter"),urlargs.filter&&delete urlargs.filter)),0==(268435456&features)&&0<xxcurrentView)try{window.history.replaceState({},document.title,decodeURIComponent(t.toString()))}catch(e){}mainUpdate(5)}function showMultiDesktopSettings(){QV("td7amtkvm",!1),QV("td7meshkvm",!0),QV("td7rdpkvm",!1),QV("d7desktopOtherSettings",!1),d7bitmapquality.value=multidesktopsettings.quality,d7bitmapscaling.value=multidesktopsettings.scaling,d7encoding.value=multidesktopsettings.agentencoding,multidesktopsettings.framerate?d7framelimiter.value=multidesktopsettings.framerate:d7framelimiter.value=100,setModalContent("xxAddAgent","Instellingen extern bureaublad",x),showModal("xxAddAgentModal","idx_dlgOkButton",()=>showMultiDesktopSettingsChanged())}function showMultiDesktopSettingsChanged(){for(var e in multidesktopsettings.quality=d7bitmapquality.value,multidesktopsettings.scaling=d7bitmapscaling.value,multidesktopsettings.framerate=d7framelimiter.value,multidesktopsettings.agentencoding=d7encoding.value,localStorage.setItem("multidesktopsettings",JSON.stringify(multidesktopsettings)),multiDesktop)multiDesktop[e].m.SendCompressionLevel(multidesktopsettings.agentencoding,multidesktopsettings.quality,multidesktopsettings.scaling,multidesktopsettings.framerate)}function connectMultiDesktop(e,t){var n=e._id,o=n.split("/")[2],a=multiDesktop[n];null==a?null!=Q("kvmid_"+o)&&(2==t?null!=e.intelamt.user&&""!=e.intelamt.user&&((a=CreateAmtRedirect(CreateAmtRemoteDesktop("kvmid_"+o),authCookie)).shortid=o,a.onStateChanged=onMultiDesktopStateChange,a.m.bpp=1,a.m.useZRLE=!0,a.m.showmouse=!0,a.m.onKvmData=function(e){console.log("KVM Data received in multi-desktop mode, this is not supported.")},a.m.onScreenSizeChange=mdeskAdjust,a.Start(n,16994,"*","*",0),a.contype=2,multiDesktop[n]=a):1==t&&((a=CreateAgentRedirect(meshserver,CreateAgentRemoteDesktop("kvmid_"+o),serverPublicNamePort,authCookie,authRelayCookie,domainUrl)).m.UseExtendedKeyFlag=e.agent.id<5,a.m.mouseCursorActive(11==xxcurrentView),a.shortid=o,a.attemptWebRTC=attemptWebRTC,a.webrtcconfig=webrtcconfiguration,a.onStateChanged=onMultiDesktopStateChange,a.m.ImageType=multidesktopsettings.agentencoding,a.m.CompressionLevel=multidesktopsettings.quality,a.m.ScalingLevel=multidesktopsettings.scaling,multidesktopsettings.framerate&&(a.m.FrameRateTimer=multidesktopsettings.framerate),multidesktopsettings.swapmouse&&(a.m.SwapMouse=multidesktopsettings.swapmouse),multidesktopsettings.rmw&&(a.m.ReverseMouseWheel=multidesktopsettings.rmw),1==multidesktopsettings.remotekeymap&&(a.m.remoteKeyMap=multidesktopsettings.remotekeymap),a.m.onScreenSizeChange=mdeskAdjust,a.Start(n),a.contype=1,multiDesktop[n]=a)):(a.Stop(),delete multiDesktop[n])}function getMeshActions(e,t){return 0==(4&t)?"":(t="",1==e.mtype&&(0==(1&features)&&(t=(t+=' <a href=# role="button" title="Voeg een nieuwe Intel&reg; AMT computer toe welke zich op het lokale netwerk bevind." onclick=\'return addDeviceToMesh("'+e._id+"\")'>Lokaal toevoegen</a>")+' <a href=# role="button" title="Voeg een nieuwe Intel&reg; AMT computer toe door het lokale netwerk te scannen." onclick=\'return addAmtScanToMesh("'+e._id+"\")'>Scan Netwerk</a>"),e.amt)&&0<e.amt.type&&(t+=' <a href=# role="button" title="Voer Intel&reg; AMT-activering en configuratie uit." onclick=\'return showAmtSetup("'+e._id+"\")'>Setup</a>"),2!=e.mtype||4294967295!=userinfo.siteadmin&&0!=(4096&userinfo.siteadmin)||(t+=' <a href=# role="button" title="Voeg een nieuwe computer toe aan deze apparaatgroep door de mesh-agent te installeren." onclick=\'return addAgentToMesh("'+e._id+"\")'>Toevoegen agent</a>",0==(2&features)&&(t+=' <a href=# role="button" title="Nodig iemand uit om de mesh-agent in deze apparaatgroep te installeren." onclick=\'return inviteAgentToMesh("'+e._id+"\")'>Uitnodigen</a>")),3==e.mtype&&(t+=' <a href=# role="button" title="Voeg een apparaat toe dat zich op het lokale netwerk bevindt." onclick=\'return addLocalDeviceToMesh("'+e._id+"\")'>Apparaat toevoegen</a>"),t)}function addLocalDeviceToMesh(e){if(xxdialogMode)return!1;var t=meshes[e],t=format('Voeg een lokaal apparaat toe aan apparaatgroep "{0}".',EscapeHtml(t.name))+"<br /><br />";setModalContent("xxAddAgent","Voeg een lokaal apparaat toe",(t+=addHtmlFormFloating("Apparaat naam","<input id=dp1devicename class=form-control maxlength=32 autocomplete=off onchange=validateLocalDeviceToMesh() onkeyup=validateLocalDeviceToMesh() />"))+addHtmlFormFloating("Hostnaam",'<input id=dp1hostname class=form-control maxlength=32 autocomplete=off placeholder="Hetzelfde als de apparaatnaam" onchange=validateLocalDeviceToMesh() onkeyup=validateLocalDeviceToMesh() />')+addHtmlFormFloating("Type","<select id=dp1type class=form-select><option value=4>Windows (RDP)</option><option value=6>Linux (SSH/SCP/VNC)</option><option value=29>macOS (SSH/SCP/VNC)</option></select>")),showModal("xxAddAgentModal","idx_dlgOkButton",()=>addLocalDeviceToMeshEx(3,e)),validateLocalDeviceToMesh(),Q("dp1devicename").focus()}function validateLocalDeviceToMesh(){QE("idx_dlgOkButton",0<Q("dp1devicename").value.length)}function addLocalDeviceToMeshEx(e,t){var n=Q("dp1hostname").value;""==n&&(n=Q("dp1devicename").value),meshserver.send({action:"addlocaldevice",meshid:t,devicename:Q("dp1devicename").value,hostname:n,type:parseInt(Q("dp1type").value)})}function addDeviceToMesh(e){var t;return xxdialogMode||(t=meshes[e],t=format('Voeg een nieuwe Intel&reg; AMT computer toe aan een apparaatgroep "{0}".',EscapeHtml(t.name))+"<br /><br />",setModalContent("xxAddAgent","Toevoegen Intel&reg; AMT apparaat",t=(t=(t=(t=(t+=addHtmlFormFloating("Apparaat naam",'<input id=dp1devicename class="form-control" maxlength=32 autocomplete=off onchange=validateDeviceToMesh() onkeyup=validateDeviceToMesh() />'))+addHtmlFormFloating("Hostnaam",'<input id=dp1hostname class="form-control" maxlength=32 autocomplete=off placeholder="Hetzelfde als de apparaatnaam" onchange=validateDeviceToMesh() onkeyup=validateDeviceToMesh() />'))+addHtmlFormFloating("Gebruikersnaam",'<input id=dp1username class="form-control" maxlength=32 autocomplete=off placeholder="Beheerder" onchange=validateDeviceToMesh() onkeyup=validateDeviceToMesh() />'))+addHtmlFormFloating("Wachtwoord",'<input id=dp1password type=password class="form-control" autocomplete=off maxlength=32 onchange=validateDeviceToMesh() onkeyup=validateDeviceToMesh() />'))+addHtmlFormFloating("Beveiliging",'<select id=dp1tls class="form-select"><option value=0>Geen TLS beveiliging</option><option value=1>TLS beveiliging vereist</option></select>')),showModal("xxAddAgentModal","idx_dlgOkButton",()=>addDeviceToMeshEx(3,e)),validateDeviceToMesh(),Q("dp1devicename").focus()),!1}function showAmtImport(e){xxdialogMode||(setModalContent("xxAddAgent","Intel&reg; AMT apparaat importeren",'Maak meerdere Intel&reg; AMT apparaten in één keer door een JSON bestand met het volgende formaat te importeren:<br /><pre>[\r\n  {\r\n    "fqdn":"mycomputer.com",\r\n    "uuid":"xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx",\r\n    "version":"12.0.1",\r\n    "username":"admin",\r\n    "password":"password",\r\n    "tls":true\r\n  }\r\n]</pre><input type=file id=d4importFile class="form-control" accept=".json" onchange=showAmtImportValidate() />'),showModal("xxAddAgentModal","idx_dlgOkButton",()=>showAmtImportEx(3,e)),QE("idx_dlgOkButton",!1))}function showAmtImportValidate(){QE("idx_dlgOkButton",null!=Q("d4importFile").value)}function showAmtImportEx(e,n){var t=new FileReader;t.onload=function(e){var t=null;try{t=JSON.parse(e.target.result)}catch(e){return setModalContent("xxAddAgent","Intel&reg; AMT apparaat importeren",format("Ongeldig JSON-bestand: {0}.",e)),void showModal("xxAddAgentModal","idx_dlgOkButton")}null!=t?meshserver.send({action:"importamtdevices",meshid:n,amtdevices:t}):(setModalContent("xxAddAgent","Intel&reg; AMT apparaat importeren","Ongeldige JSON-bestandsindeling."),showModal("xxAddAgentModal","idx_dlgOkButton"))},t.readAsText(Q("d4importFile").files[0])}function showAmtSetup(e){var t,n;return xxdialogMode||(t=serverinfo.name,n=meshes[e],-1!=t.indexOf(".")&&0==(2&features)||(t=window.location.hostname),domainUrl.substring(0,domainUrl.length-1),t=1==serverinfo.https?"wss://"+t+(443==serverinfo.port?"":":"+serverinfo.port)+domainUrl:"ws://"+t+(80==serverinfo.port?"":":"+serverinfo.port)+domainUrl,n=format('Voeg toe, activeer en configureer Intel&reg; AMT aan groep "{0}" door MeshCmd periodiek uit te voeren als beheerder op het externe apparaat.',EscapeHtml(n.name))+"<br /><br />",n+="<textarea readonly=readonly style=width:100%;resize:none;height:100px;overflow:auto;font-size:12px readonly>meshcmd amtconfig --url "+t+"apf.ashx --id '"+e.split("/")[2]+"' --serverhttpshash "+serverinfo.tlshash+"</textarea>",null!=serverinfo.amtAcmFqdn&&(n+="<div style=margin-top:8px>Voor ACM activering moet Intel&reg; AMT worden ingesteld op de volgende vertrouwde FQDN: <b>"+serverinfo.amtAcmFqdn.join(", ")+"</b></div>"),setModalContent("xxAddAgent","Intel&reg; AMT setup",n),showModal("xxAddAgentModal","idx_dlgOkButton"),Q("idx_dlgOkButton").focus()),!1}function showAmtAcmSetup(){if(xxdialogMode)return!1;var e="<table><tr><td><img src=images/usbkey70.png height=70 width=31 style=margin-left:4px;margin-right:8px><td><div>Activeer Intel&reg; AMT in Admin Control Mode (ACM) gebruikmakend van een FAT geformateerde USB sleutel. Plaats setup.bin erop en start een of meer computers met deze sleutel.</div><div style=margin-top:6px>Begin met het invoeren van het oude en nieuwe MBEx-wachtwoord. </div></table>",e=(e=(e+=addHtmlFormFloating("Oud wachtwoord",'<input id=dp1password0 type=password class="form-control" autocomplete=off maxlength=32 onchange=validateAmtAcmSetupEx() onkeyup=validateAmtAcmSetupEx() />'))+addHtmlFormFloating("Nieuw Wachtwoord*",'<input id=dp1password1 type=password class="form-control" autocomplete=off maxlength=32 onchange=validateAmtAcmSetupEx() onkeyup=validateAmtAcmSetupEx() />'))+addHtmlFormFloating("Nieuw Wachtwoord*",'<input id=dp1password2 type=password class="form-control" autocomplete=off maxlength=32 onchange=validateAmtAcmSetupEx() onkeyup=validateAmtAcmSetupEx() />');32&features2&&1==currentMesh.mtype&&serverinfo.amtProvServerMeshId==currentMesh._id&&(e+='<label><input id=dp1lanprov type=checkbox class="form-check-input me-2" /> Gebruik voor bare-metal LAN activering.</label>'),setModalContent("xxAddAgent","Intel&reg; AMT ACM",e+='<div><span id=dp10passNotify style="font-size:10px"> * 8-16 karakters, 1 hoofdletter, 1 normale letter, 1 nummeriek, 1 niet alfanumeriek.</span></div>'),showModal("xxAddAgentModal","idx_dlgOkButton",showAmtAcmSetupEx),Q("dp1password0").focus(),validateAmtAcmSetupEx()}function validateAmtAcmSetupEx(){var e=Q("dp1password0").value,t=Q("dp1password1").value,n=Q("dp1password2").value,o=!0;"admin"!=e&&0==checkPasswordRequirements(e,{min:8,max:16,numeric:1,lower:1,upper:1,nonalpha:1})&&(o=!1),t==n&&0!=checkPasswordRequirements(t,{min:8,max:16,numeric:1,lower:1,upper:1,nonalpha:1})||(o=!1),QE("idx_dlgOkButton",o)}function showAmtAcmSetupEx(){meshserver.send({action:"amtsetupbin",oldmebxpass:Q("dp1password0").value,newmebxpass:Q("dp1password1").value,baremetal:32&features2&&Q("dp1lanprov").checked})}function addAmtScanToMesh(e){return xxdialogMode||(setModalContent("xxAddAgent","Scannen naar Intel&reg;  AMT-apparaten","Voer een reeks IP-adressen in om te scannen op Intel&reg; AMT-apparaten.<br /><br />"+addHtmlValue("IP-bereik",'<table style=width:250px><tr><td style=width:99%><input id=dp1range style=width:100% list=iprangelist value="192.168.1.0/24" onkeyup=addAmtScanToMeshKeyUp(event) /><td style=width:1%><input id=dp1rangebutton type=button value="Scan" onclick=addAmtScanToMeshButton()></input></tr></table>')+'<div id=dp1results style="width:100%;height:200px;background-color:white;border:1px gray solid;overflow-y:scroll"></div>'+('<input type=hidden id=amtScanMeshId value="'+(xxdialogTag=e)+'" />')+'<div style="padding:10px;margin-bottom:5px"><input id="idx_dlgCancelButton2" type="button" value="Annuleren" style="" onclick="dialogclose(0)" /><input id="idx_dlgOkButton2" type="button" value="OK" style="" onclick="dialogclose(1)" /><div><input id="d2scanSelectButton" type="button" value="Selecteer alles" onclick="scanSelectAll()" /></div></div>'),showModal("xxAddAgentModal","idx_dlgOkButton",addAmtScanToMeshEx),QE("idx_dlgOkButton2",!1),QE("d2scanSelectButton",!1),QH("dp1results","<div style=width:100%;text-align:center;margin-top:12px;color:gray;line-height:1.5>Voorbeeld IP bereikwaarden<br />192.168.0.100<br />192.168.1.0/24<br />192.167.0.1-192.168.0.100</div>"),focusTextBox("dp1range"),addAmtScanToMeshKeyUp()),!1}function scanSelectAll(){for(var e=document.getElementsByClassName("DevScanCheckbox"),t=0;t<e.length;t++)e[t].checked=!0;addAmtScanToMeshCheckbox()}function addAmtScanToMeshKeyUp(e){QE("dp1rangebutton",3<Q("dp1range").value.split(".").length),e&&13==e.keyCode&&(haltEvent(e),addAmtScanToMeshButton())}function addAmtScanToMeshEx(e){for(var t,n,o=document.getElementsByClassName("DevScanCheckbox"),a=0;a<o.length;a++)o[a].checked&&(t=o[a].getAttribute("tag"),n=(t=amtScanResults[t]).hostname,"host"==t.hosttype&&(n=capitalizeFirstLetter(n.split(".")[0])),meshserver.send({action:"addamtdevice",meshid:Q("amtScanMeshId").value,devicename:n,hostname:t.hostname,amtusername:"",amtpassword:"",amttls:t.tls}))}function addAmtScanToMeshButton(){var e=Q("dp1range").value.trim(),t=e.split(" ");""!=(e=(e=1<t.length?t[t.length-1]:e).trim())&&(QE("dp1range",!1),QE("dp1rangebutton",!1),QH("dp1results","<div style=width:100%;text-align:center;margin-top:20px>Scannen van ...</div><div style=width:100%;text-align:center;margin-top:6px;color:#666>"+e+"</div>"),xxdialogTag="AMTSCAN:"+e,meshserver.send({action:"scanamtdevice",range:e}))}function addAmtScanToMeshCheckbox(){for(var e=document.getElementsByClassName("DevScanCheckbox"),t=0,n=0;n<e.length;n++)e[n].checked&&t++;QE("idx_dlgOkButton2",0<t)}function checkEmail(e){var e=e.split("@"),t=2==e.length&&0<e[0].length&&1<e[1].split(".").length&&2<e[1].length;if(1==t){var n,o=e[1].split(".");for(n in o)0==o[n].length&&(t=!1)}return t}function inviteAgentToMesh(e){var t,n;return xxdialogMode||(t="",n=meshes[e],64&features&&(t=(t=(t=(t=(t=(t=(t=(t+=addHtmlFormFloating("Type uitnodiging","<select id=d2InviteType onchange=d2ChangedInviteType() class=form-select><option value=0>Uitnodigingslink</option><option value=1>E-mail uitnodiging</option></select>")+"<hr />")+"<div id=emailInviteDiv style=display:none>"+format('Nodig iemand uit om de mesh-agent te installeren. Er wordt een e-mail verzonden met de link naar de installatie van de mesh-agent voor de apparaatgroep "{0}".',EscapeHtml(n.name))+"<br /><br />")+addHtmlFormFloating("Naam (Optioneel)",'<input id=agentInviteName value="" placeholder="Name (optional)" class="form-control" maxlength=64 />'))+addHtmlFormFloating("E-mail",'<input id=agentInviteEmail placeholder="voorbeeld@email.nl" class="form-control" onkeyup=validateAgentInvite() />'))+addHtmlFormFloating("Besturingssysteem","<select id=agentInviteNameOs onchange=d2ChangedInviteType() class=form-select><option value=4>Verzend installatie link</option><option value=0 selected>Alle ondersteunde</option><option value=1>Alleen Windows</option><option value=3>Alleen Apple macOS</option><option value=2>alleen Linux</option><option value=5>MeshCentral Assistant</option></select>")+"<div id=d2agentexpirediv>")+addHtmlFormFloating("Link vervaldatum","<select id=agentInviteExpire class=form-select><option value=1>1 uur</option><option value=8>8 uur</option><option value=24>1 dag</option><option value=168>1 week</option><option value=5040>1 maand</option><option value=0>Ongelimiteerd</option></select>")+"</div><div id=d2agentInstallTypeDiv2>")+addHtmlFormFloating("Installatie type","<select id=agentInviteType class=form-select><option value=0>Achtergrond en interactief</option><option value=2>Alleen achtergrond</option><option value=1>Alleen interactief</option></select>")+"</div>")+addHtmlFormFloating("Bericht (optioneel)",'<textarea id="agentInviteMessage" class="form-control" style="height:100px;resize:none;" maxlength="1024"></textarea>')+"</div>"),t=(t=(t=(t+="<div id=urlInviteDiv>"+format('Nodig iemand uit om de mesh-agent te installeren door een uitnodigingslink te delen. Deze koppeling verwijst de gebruiker naar installatie-instructies voor de apparaatgroep "{0}". De link is openbaar en er is geen account voor deze server nodig.',EscapeHtml(n.name))+"<br /><br />")+addHtmlFormFloating("Link vervaldatum","<select id=d2inviteExpire class=form-select onchange=d2RequestInvitationLink()><option value=1>1 uur</option><option value=8>8 uur</option><option value=24>1 dag</option><option value=168>1 week</option><option value=5040>1 maand</option><option value=0>Ongelimiteerd</option></select>"))+addHtmlFormFloating("Agents","<select id=d2agentType class=form-select onchange=d2ChangedInviteType()><option value=0>Alle beschikbare agents</option><option value=1>Windows MeshAgent</option><option value=2>Linux MeshAgent</option><option value=4>MacOS MeshAgent</option><option value=8>MeshCentral Assistant</option><option value=16>Android MeshAgent</option></select>")+"<div id=d2agentInstallTypeDiv>")+addHtmlFormFloating("Installatie type","<select id=d2agentInviteType class=form-select onchange=d2RequestInvitationLink()><option value=0>Achtergrond en interactief</option><option value=2>Alleen achtergrond</option><option value=1>Alleen interactief</option></select>"),xxdialogTag=e,setModalContent("xxAddAgent","Uitnodigen",t=t+"</div>"+'<div id=agentInvitationLinkDiv style="text-align:center;font-size:large;margin:16px;display:none"><a href=# id=agentInvitationLink rel="noreferrer noopener" target="_blank" style=cursor:pointer></a> <img src=images/link4.png height=10 width=10 title="Kopieer link naar het klembord" style=cursor:pointer onclick=d2CopyInviteToClip()></div></div>'),showModal("xxAddAgentModal","idx_dlgOkButton",function(){performAgentInvite(3,e)}),(64&features?(Q("d2InviteType").focus(),d2ChangedInviteType):(Q("d2inviteExpire").focus(),validateAgentInvite))(),d2RequestInvitationLink()),!1}function d2RequestInvitationLink(){meshserver.send({action:"createInviteLink",meshid:xxdialogTag,expire:parseInt(Q("d2inviteExpire").value),flags:parseInt(Q("d2agentInviteType").value),agents:parseInt(Q("d2agentType").value)})}function d2ChangedInviteType(){64&features&&(QV("urlInviteDiv",0==Q("d2InviteType").value),QV("d2agentexpirediv",4==Q("agentInviteNameOs").value),QV("d2agentInstallTypeDiv2",Q("agentInviteNameOs").value<2),QV("emailInviteDiv",1==Q("d2InviteType").value)),QV("d2agentInstallTypeDiv",parseInt(Q("d2agentType").value)<2),validateAgentInvite(),d2RequestInvitationLink()}function d2CopyInviteToClip(){copyTextToClip(Q("agentInvitationLink").href)}function d2CopySecretToClip(){copyTextToClip(Q("d2optsecret").getAttribute("secret"))}function validateAgentInvite(){64&features&&1==Q("d2InviteType").value?(QE("idx_dlgOkButton",checkEmail(Q("agentInviteEmail").value)),QV("idx_dlgCancelButton",!0)):(QE("idx_dlgOkButton",!0),QV("idx_dlgCancelButton",!1))}function performAgentInvite(e,t){64&features&&1==Q("d2InviteType").value&&meshserver.send({action:"inviteAgent",meshid:t,email:Q("agentInviteEmail").value,name:Q("agentInviteName").value,os:Q("agentInviteNameOs").value,flags:Q("agentInviteType").value,msg:Q("agentInviteMessage").value,expire:parseInt(Q("agentInviteExpire").value)})}function addAgentToMesh(e){if(!xxdialogMode){var t,n=meshes[e],o="",a="",i="<select id=aginsSelect onchange=addAgentToMeshClick() class=form-select><option value=0>Windows</option><option value=1>Linux / BSD</option><option value=5>Linux / BSD / macOS Binair installatieprogramma</option><option value=2>Apple macOS</option>",i=(0==(2&features)&&(i+="<option value=6>Mobiel apparaat</option>"),o+=addHtmlFormFloating("Besturingssysteem",i=i+"<option value=7>MeshCentral Assistant</option>"+"<option value=3>Windows (Deïnstallatie)</option><option value=4>Linux / BSD (Deïnstalleren)</option><option value=8>Apple macOS (verwijderen)</option></select>"),serverinfo.name),s=(-1!=i.indexOf(".")&&0==(2&features)||(i=window.location.hostname),domainUrl.substring(0,domainUrl.length-1)),r="",r=1==serverinfo.https?443==serverinfo.port?"":":"+serverinfo.port:80==serverinfo.port?"":":"+serverinfo.port,l=[6,5,10005,25,26,28,30,32,36,37,40,41,16,29],d={6:"Linux x86-64",5:"Linux x86-32",10005:"Apple OSX Universal",25:"Linux ARM-HF, Rasberry Pi",26:"Linux ARM64-HF",28:"Linux MIPS24KC (OpenWRT)",30:"FreeBSD x86-64",32:"Linux ARM 64 bit (glibc/2.24 NOKVM)",36:"OpenWRT x86-64",37:"OpenBSD x86-64",40:"Linux MIPSEL24KC (OpenWRT)",41:"ARMADA/CORTEX-A53/MUSL (OpenWRT)",16:"Apple macOS x86-64",29:"Apple macOS ARM-64"};for(t in l)a+='<option value="'+l[t]+'">'+d[l[t]]+"</option>";o=(o=(o=(o=(o+='<div id="aginsSysTypeDiv">')+addHtmlFormFloating("Systeem type",'<select id="aginsSysType" onchange="addAgentToMeshClick()"  class="form-select">'+a+"</select>"))+"</div>"+'<div id="aginsTypeDiv">')+addHtmlFormFloating("Installatie type",'<select id="aginsType" onchange="addAgentToMeshClick()" class="form-select"><option value="0">Achtergrond & interactief</option><option value="2">Alleen achtergrond</option><option value="1">Alleen interactief</option></select>')+'</div><div id="asinsTypeDiv">')+addHtmlFormFloating("Installatie type",'<select id="asinsType" onchange="addAgentToMeshClick()" class="form-select"><option value="2">Applicatie, verbinding maken op gebruikersverzoek</option><option value="3">Applicatie, Altijd verbonden</option><option value="0">Systeemvak, verbinding maken op verzoek van de gebruiker</option><option value="1">Systeemvak, altijd verbonden</option><option value="4">Systeemvak, alleen monitoren</option></select>')+"</div><hr>",n.name.split("\\").join("").split("/").join("").split(":").join("").split("*").join("").split("?").join("").split('"').join("").split("<").join("").split(">").join("").split("|").join("").split(" ").join("").split("'").join("");o=(o=(o=(o+="<div id=agins_windows>"+format('Als u een nieuwe computer aan apparaatgroep "{0}" wilt toevoegen, downloadt u de mesh-agent en installeert u deze op de te beheren computer. Deze agent heeft server- en apparaatgroepinformatie erin ingebed.',EscapeHtml(n.name))+"<br /><br />")+addHtmlValue("Mesh Agent",'<a class=text-decoration-underline id=aginsw32lnk name="meshagents?id=3&meshid='+e.split("/")[2]+"&installflags=0"+(urlargs.key?"&key="+urlargs.key:"")+'" title="x86 32bit versie van de MeshAgent">Windows x86-32 (.exe)</a> <i class="fa-regular fa-clipboard" title="Kopieer de Windows x86 32-bits agent-URL naar het klembord" style=cursor:pointer onclick=copyAgentUrl("meshagents?id=3&meshid='+e.split("/")[2]+'&installflags=",1)></i>',["col-md-4","col-md-8"]))+addHtmlValue("Mesh Agent",'<a class=text-decoration-underline id=aginsw64lnk name="meshagents?id=4&meshid='+e.split("/")[2]+"&installflags=0"+(urlargs.key?"&key="+urlargs.key:"")+'" title="x86 64bit versie van de MeshAgent">Windows x86-64 (.exe)</a> <i class="fa-regular fa-clipboard" title="Kopieer de Windows x86 64-bits agent-URL naar het klembord" style=cursor:pointer onclick=copyAgentUrl("meshagents?id=4&meshid='+e.split("/")[2]+'&installflags=",1)></i>',["col-md-4","col-md-8"]))+addHtmlValue("Mesh Agent",'<a class=text-decoration-underline id=aginswa64lnk name="meshagents?id=43&meshid='+e.split("/")[2]+"&installflags=0"+(urlargs.key?"&key="+urlargs.key:"")+'" title="ARM 64bit versie van de MeshAgent">Windows ARM-64 (.exe)</a> <i class="fa-regular fa-clipboard" title="Kopieer de URL van de Windows ARM 64-bits agent naar het klembord" style=cursor:pointer onclick=copyAgentUrl("meshagents?id=43&meshid='+e.split("/")[2]+'&installflags=",1)></i>',["col-md-4","col-md-8"]),0<debugmode&&(o+=addHtmlValue("Instellingenbestand",'<a id=aginswmshlnk name="meshsettings?id='+e.split("/")[2]+"&installflags=0"+(urlargs.key?"&key="+urlargs.key:"")+'">'+format("{0} instellingen (.msh)",EscapeHtml(n.name))+"</a>")),setModalContent("xxAddAgent","Toevoegen Mesh agent",o=(o=(o=(o=(o=(o=(o=(o=(o=(o=(o=(o=(o=(o=(o=(o=(o=(o=(o=(o=(o=(o=(o=(o=(o+="</div>")+("<div id=agins_linux style=display:none>"+format('Voer de volgende opdracht uit om een computer toe te voegen aan "{0}". Root gegevens zijn nodig.',EscapeHtml(n.name))+"<br />"))+"<textarea id=agins_linux_area rows=2 cols=20 readonly=readonly style=border-radius:4px;padding:6px;margin-top:4px;margin-bottom:4px;border:0;width:100%;resize:none;height:160px;overflow:auto;font-size:12px class=form-control></textarea>"+'<div style=font-size:x-small;float:right>* Voor BSD, start eerst "pkg install wget sudo bash" .</div><a style=text-decoration:none title="Kopieer naar het klembord" onclick=copyAgentIdValue("agins_linux_area")>Kopiëren <i class="fa-regular fa-clipboard" style=cursor:pointer></i></a></div>')+("<div id=agins_osx style=display:none>"+format('Als u een nieuwe computer aan apparaatgroep "{0}" wilt toevoegen, downloadt u de mesh-agent en installeert u deze op de te beheren computer. In dit installatieprogramma van de agent zijn server- en apparaatgroepgegevens ingebed.',EscapeHtml(n.name))+"<br /><br />"))+addHtmlValue("Mesh Agent",'<a class=text-decoration-underline onclick=downloadFile("meshosxagent?id=16&meshid='+e.split("/")[2]+(urlargs.key?"&key="+urlargs.key:"")+'") title="x86-64bit versie van de macOS Mesh Agent">macOS x86-64bit</a> <i class="fa-regular fa-clipboard" title="Kopieer macOS agent link naar het klembord" style=cursor:pointer onclick=copyAgentUrl("meshosxagent?id=16&meshid='+e.split("/")[2]+'",0)></i>',["col-md-4","col-md-8"]))+addHtmlValue("Mesh Agent",'<a class=text-decoration-underline onclick=downloadFile("meshosxagent?id=29&meshid='+e.split("/")[2]+(urlargs.key?"&key="+urlargs.key:"")+'") title="ARM 64bit versie van de macOS Mesh Agent">macOS ARM (64bit)</a> <i class="fa-regular fa-clipboard" title="Kopieer macOS agent link naar het klembord" style=cursor:pointer onclick=copyAgentUrl("meshosxagent?id=29&meshid='+e.split("/")[2]+'",0)></i>',["col-md-4","col-md-8"]))+addHtmlValue("Mesh Agent",'<a class=text-decoration-underline onclick=downloadFile("meshosxagent?id=10005&meshid='+e.split("/")[2]+(urlargs.key?"&key="+urlargs.key:"")+'") title="Universele versie van macOS Mesh Agent">macOS (Universeel)</a> <i class="fa-regular fa-clipboard" title="Kopieer macOS agent link naar het klembord" style=cursor:pointer onclick=copyAgentUrl("meshosxagent?id=10005&meshid='+e.split("/")[2]+'",0)></i>',["col-md-4","col-md-8"])+"</div>")+('<div id=agins_qrcode style=display:none;min-height:180px><a id=agins_qrimage_a rel="noreferrer noopener" target=_blank><div id=agins_qrimage style=float:right;margin-left:10px;width:180px;height:180px;cursor:pointer></div></a><div>'+format('Om een mobiel apparaat toe te voegen aan de groep "{0}", downloadt u de MeshAgent applicatie en scant u deze QR-code.',EscapeHtml(n.name))+"</div>"))+"<table style=width:180px>"+'<tr><td style=text-align:center><a title="Google Play Store"rel="noreferrer noopener" target=_blank href="https://play.google.com/store/apps/details?id=com.meshcentral.agent2"><img style=cursor:pointer src="images/google-play-140.png" width=140 srcset="images/google-play-280.png 2x" /></a></td></tr>')+'<tr><td style=text-align:center><a title="Amazon App Store" rel="noreferrer noopener" target=_blank href="https://www.amazon.co.uk/gp/product/B097Z4Q7SK/"><img style=cursor:pointer src="images/amazon-appstore-140.png"  width=140 srcset="images/amazon-appstore-280.png 2x" /></a></td></tr>'+"</table>")+addHtmlValue("Android APK",'<a class=text-decoration-underline onclick=downloadFile("meshagents?id=14'+(urlargs.key?"&key="+urlargs.key:"")+'",null,true) title="APK versie van de MeshAgent">APK</a> <i class="fa-regular fa-clipboard" title="Kopieer URL naar het klembord" style=cursor:pointer onclick=copyAgentUrl("meshagents?id=14&meshid='+e.split("/")[2]+(urlargs.key?"&key="+urlargs.key:"")+'")></i>')+"</div>")+("<div id=agins_assistant style=display:none><table><tr><td style=vertical-align:top><div>"+format('MeshCentral Assistant is een Windows-tool die gebruikers kunnen gebruiken om hulp te vragen. Gebruik de onderstaande link om een versie te downloaden die verbinding maakt met de apparaatgroep "{0}".',EscapeHtml(n.name))+"</div><div></div><br />"))+('<a class=text-decoration-underline id=asinslnk name="meshagents?id=10006&meshid='+e.split("/")[2]+(urlargs.key?"&key="+urlargs.key:"")+'" title="MeshCentral Assistant voor Windows">Assistant voor Windows (.exe)</a> <i class="fa-regular fa-clipboard" title="Kopieer URL naar het klembord" style=cursor:pointer onclick=copyAgentUrl("meshagents?id=10006&meshid='+e.split("/")[2]+(urlargs.key?"&key="+urlargs.key:"")+'")></i>'))+'</td><td><img id=agass_img1 src=images/assistant-100.png width=74 height=100 srcset="images/assistant-200.png 2x"><img id=agass_img2 src=images/assistant2-100.png width=74 height=100 srcset="images/assistant2-200.png 2x"></td></tr></table></div>'+"<div id=agins_assistant2 style=display:none><table><tr><td style=vertical-align:top><div>MeshCentral Assistant is een Windows-tool die gebruikers kunnen gebruiken om hulp te vragen. Gebruik de onderstaande link om een versie te downloaden die de achtergrondagent in de gaten houdt.</div><div></div><br />")+('<a class=text-decoration-underline id=asinslnk2 name="meshagents?id=10006&meshid='+e.split("/")[2]+(urlargs.key?"&key="+urlargs.key:"")+'" title="MeshCentral Assistant voor Windows">Assistant voor Windows (.exe)</a> <i class="fa-regular fa-clipboard" title="Kopieer URL naar het klembord" style=cursor:pointer onclick=copyAgentUrl("meshagents?id=10006&meshid='+e.split("/")[2]+(urlargs.key?"&key="+urlargs.key:"")+'")></i>'))+'</td><td><img src=images/assistant-100.png width=74 height=100 srcset="images/assistant-200.png 2x"></td></tr></table></div>'+'<div id=agins_windows_un style=display:none>Om een mesh-agent te verwijderen, download het onderstaande bestand, voer het uit en klik op "deïnstalleer".<br /><br />')+addHtmlValue("Mesh Agent",'<a class=text-decoration-underline id=aginsw32unlnk name="meshagents?id=3&meshid='+e.split("/")[2]+"&installflags=0"+(urlargs.key?"&key="+urlargs.key:"")+'" title="x86 32bit versie van de MeshAgent">Windows x86-32 (.exe)</a> <i class="fa-regular fa-clipboard" title="Kopieer de Windows x86 32-bits agent-URL naar het klembord" style=cursor:pointer onclick=copyAgentUrl("meshagents?id=3&meshid='+e.split("/")[2]+'&installflags=",1)></i>',["col-md-4","col-md-8"]))+addHtmlValue("Mesh Agent",'<a class=text-decoration-underline id=aginsw64unlnk name="meshagents?id=4&meshid='+e.split("/")[2]+"&installflags=0"+(urlargs.key?"&key="+urlargs.key:"")+'" title="x86 64bit versie van de MeshAgent">Windows x86-64 (.exe)</a> <i class="fa-regular fa-clipboard" title="Kopieer de Windows x86 64-bits agent-URL naar het klembord" style=cursor:pointer onclick=copyAgentUrl("meshagents?id=4&meshid='+e.split("/")[2]+'&installflags=",1)></i>',["col-md-4","col-md-8"]))+addHtmlValue("Mesh Agent",'<a class=text-decoration-underline id=aginswa64unlnk name="meshagents?id=43&meshid='+e.split("/")[2]+"&installflags=0"+(urlargs.key?"&key="+urlargs.key:"")+'" title="ARM 64bit versie van de MeshAgent">Windows ARM-64 (.exe)</a> <i class="fa-regular fa-clipboard" title="Kopieer de URL van de Windows ARM 64-bits agent naar het klembord" style=cursor:pointer onclick=copyAgentUrl("meshagents?id=43&meshid='+e.split("/")[2]+'&installflags=",1)></i>',["col-md-4","col-md-8"])+"</div>")+"<div id=agins_linux_un style=display:none>Voer de volgende opdracht uit om een mesh-agent te verwijderen. Root rechten zijn nodig.<br />"+"<textarea id=agins_linux_area_un rows=2 cols=20 readonly=readonly style=border-radius:4px;padding:6px;margin-top:4px;margin-bottom:4px;border:0;width:100%;resize:none;height:160px;overflow:auto;font-size:12px  class=form-control></textarea>")+'<a style=text-decoration:none title="Kopieer naar het klembord" onclick=copyAgentIdValue("agins_linux_area_un")>Copy <i class="fa-regular fa-clipboard" style=cursor:pointer></i></a></div>'+'<div id=agins_osx_un style=display:none>Om een ​​mesh-agent te verwijderen, downloadt u het onderstaande bestand, klikt u met de rechtermuisknop op het bestand ".mpkg" en klikt u op "Toon pakketinhoud", klikt u vervolgens met de rechtermuisknop op "Uninstall.command" en klikt u op "Openen"<br /><br />')+addHtmlValue("Mesh Agent",'<a class=text-decoration-underline onclick=downloadFile("meshosxagent?id=10005&meshid='+e.split("/")[2]+(urlargs.key?"&key="+urlargs.key:"")+'") title="Universele versie van macOS Mesh Agent">macOS Agent (Universal)</a> <i class="fa-regular fa-clipboard" title="Kopieer macOS agent link naar het klembord" style=cursor:pointer onclick=copyAgentUrl("meshosxagent?id=10005&meshid='+e.split("/")[2]+'",0)></i>',["col-md-4","col-md-8"]))+"</div>"+"<div id=agins_linux_inst style=display:none>Dit is een uitvoerbaar bestand op besturingssystemen met grafische gebruikersinterfaces<br /><br />Apple macOS uitvoerbare bestanden moeten uit quarantaine worden verwijderd om 'xattr -r -d com.apple.quarantine meshagent' te kunnen starten<br /><br />U moet 'chmod +x meshagent' gebruiken en dit bestand uitvoeren.<br /><br />")+addHtmlValue("Mesh Agent",'<a class=text-decoration-underline id=aginsbinlnk name="meshagents?id='+e.split("/")[2]+"&installflags=0"+(urlargs.key?"&key="+urlargs.key:"")+'">MeshAgent</a> <i class="fa-regular fa-clipboard" title="Kopieer de agent URL naar het klembord" style=cursor:pointer onclick=copyAgentUrl("meshagents?id='+e.split("/")[2]+'&installflags=",1)></i>',["col-md-4","col-md-8"]))+addHtmlValue('Opdracht&nbsp;<i class="fa-regular fa-clipboard" title="Kopieer de agent URL naar het klembord" style=cursor:pointer onclick=copyAgentIdValue("aginsbincmd")></i>','<input id=aginsbincmd type=text class="form-control" readonly value=\'wget -O meshagent'+(0!=(2147483648&features)?" --no-check-certificate":"")+' "https://'+i+r+domainUrl+"meshagents?id="+e.split("/")[2].split("$").join("%24").split("@").join("%40")+"' />",["col-md-4 d-flex align-items-center","col-md-8"])+"</div>"),showModal("xxAddAgentModal","idx_dlgOkButton"),new QRCode(Q("agins_qrimage"),{text:serverinfo.magenturl+","+serverinfo.agentCertHash+","+e.split("/")[2],width:180,height:180,colorDark:"#000000",colorLight:"#EEE",correctLevel:QRCode.CorrectLevel.M}),Q("agins_qrimage_a").setAttribute("href",serverinfo.magenturl+","+serverinfo.agentCertHash+","+e.split("/")[2]),0==(8192&features)?(Q("agins_linux_area").value='(wget "https://'+i+r+domainUrl+"meshagents?script=1"+(urlargs.key?"&key="+urlargs.key:"")+'"'+(0!=(2147483648&features)?" --no-check-certificate":"")+' -O ./meshinstall.sh || wget "https://'+i+r+domainUrl+'meshagents?script=1" --no-proxy'+(0!=(2147483648&features)?" --no-check-certificate":"")+" -O ./meshinstall.sh) && chmod 755 ./meshinstall.sh && sudo -E ./meshinstall.sh https://"+i+r+s+" '"+e.split("/")[2]+"' || ./meshinstall.sh https://"+i+r+s+" '"+e.split("/")[2]+"'\r\n",Q("agins_linux_area_un").value='(wget "https://'+i+r+domainUrl+"meshagents?script=1"+(urlargs.key?"&key="+urlargs.key:"")+'"'+(0!=(2147483648&features)?" --no-check-certificate":"")+' -O ./meshinstall.sh || wget "https://'+i+r+domainUrl+'meshagents?script=1" --no-proxy'+(0!=(2147483648&features)?" --no-check-certificate":"")+" -O ./meshinstall.sh) && chmod 755 ./meshinstall.sh && sudo -E ./meshinstall.sh uninstall https://"+i+r+s+" '"+e.split("/")[2]+"' || ./meshinstall.sh uninstall https://"+i+r+s+" '"+e.split("/")[2]+"'\r\n"):(Q("agins_linux_area").value='wget "https://'+i+r+domainUrl+"meshagents?script=1"+(urlargs.key?"&key="+urlargs.key:"")+'" --no-proxy'+(0!=(2147483648&features)?" --no-check-certificate":"")+" -O ./meshinstall.sh && chmod 755 ./meshinstall.sh && sudo -E ./meshinstall.sh https://"+i+r+s+" '"+e.split("/")[2]+"' || ./meshinstall.sh https://"+i+r+s+" '"+e.split("/")[2]+"'\r\n",Q("agins_linux_area_un").value='wget "https://'+i+r+domainUrl+"meshagents?script=1"+(urlargs.key?"&key="+urlargs.key:"")+'" --no-proxy'+(0!=(2147483648&features)?" --no-check-certificate":"")+" -O ./meshinstall.sh && chmod 755 ./meshinstall.sh && sudo -E ./meshinstall.sh uninstall https://"+i+r+s+" '"+e.split("/")[2]+"' || ./meshinstall.sh uninstall https://"+i+r+s+" '"+e.split("/")[2]+"'\r\n"),Q("aginsSelect").focus(),addAgentToMeshClick()}return!1}function setModalContent(e,t,n,o=null){var a=document.getElementById("xxAddAgentModalConf"),i=document.getElementById(e+"Title");if(a&&i){if(i.innerHTML=t,"number"==typeof n){for(var s=1;s<24;s++)QV("dialog"+s,s==n);xxdialogMode=s}else if("string"==typeof n){Q("dialog2").innerHTML=n;for(s=1;s<24;s++)QV("dialog"+s,2==s);xxdialogMode=2}if(o)switch(a.classList.remove("modal-sm","modal-lg","modal-xl"),o){case"small":a.classList.add("modal-sm");break;case"large":a.classList.add("modal-lg");break;case"extra-large":a.classList.add("modal-xl")}else a.classList.remove("modal-sm","modal-lg","modal-xl")}else console.error("Modal elements not found:",e+"Title",e+"Body")}function showModal(t,e,n,o=null,a=null){var i;null==xxModal&&(["idx_dlgOkButton","idx_dlgCancelButton"].forEach(function(e){Q(e).onclick=null,QE(e,!0),QV(e,!0)}),xxModal=new bootstrap.Modal(document.getElementById(t)),i=function(e){xxModal&&(xxModal.dispose(),xxModal=null),0!=xxdialogMode&&(xxdialogMode=0),document.getElementById(t).removeEventListener("hidden.bs.modal",i)},document.getElementById(t).addEventListener("hidden.bs.modal",i)),xxModal.show(),document.getElementById(e).onclick=function(){"function"==typeof n&&n?(xxdialogMode=0,!1!==n(o,a)&&xxModal.hide()):xxModal&&xxModal.hide()}}function copyAgentIdValue(e){copyTextToClip(Q(e).value)}function showNotification(e,t,n,o,a,i,s,r){Swal.fire({position:e,title:t,text:n,icon:o,confirmButtonText:a,timer:i,width:s,showConfirmButton:null!==a})}function copyAgentUrl(e,t){var n=serverinfo.name,n=(-1!=n.indexOf(".")&&0==(2&features)||(n=window.location.hostname),domainUrl.substring(0,domainUrl.length-1),"https://"+n+(443==serverinfo.port?"":":"+serverinfo.port)+domainUrl+e);1==t&&(n+=Q("aginsType").value),n+=urlargs.key?"&key="+urlargs.key:"",5==Q("aginsSelect").value&&(n+="&meshinstall="+Q("aginsSysType").value),7==Q("aginsSelect").value&&(n+="&ac="+Q("asinsType").value),copyTextToClip(n)}function addAgentToMeshClick(){var e=Q("aginsSelect").value;QV("agins_windows",0==e),QV("agins_linux",1==e),QV("agins_osx",2==e),QV("agins_windows_un",3==e),QV("agins_linux_un",4==e),QV("agins_linux_inst",5==e),QV("aginsSysTypeDiv",5==e),QV("agins_qrcode",6==e),QV("agins_assistant",7==e&&4!=Q("asinsType").value),QV("agins_assistant2",7==e&&4==Q("asinsType").value),QV("agins_osx_un",8==e),Q("aginsbinlnk").onclick=function(){downloadFile(Q("aginsbinlnk").name.split("installflags=")[0]+"installflags="+Q("aginsType").value+(urlargs.key?"&key="+urlargs.key:"")+"&meshinstall="+Q("aginsSysType").value)},Q("aginsbincmd").value=Q("aginsbincmd").value.split("&installflags=")[0]+"&installflags="+Q("aginsType").value+(urlargs.key?"&key="+urlargs.key:"")+"&meshinstall="+Q("aginsSysType").value+'"',QV("aginsTypeDiv",0==e||5==e),QV("asinsTypeDiv",7==e),Q("aginsw32lnk").onclick=function(){downloadFile(Q("aginsw32lnk").name.split("installflags=")[0]+"installflags="+Q("aginsType").value+(urlargs.key?"&key="+urlargs.key:""),null,!0)},Q("aginsw64lnk").onclick=function(){downloadFile(Q("aginsw64lnk").name.split("installflags=")[0]+"installflags="+Q("aginsType").value+(urlargs.key?"&key="+urlargs.key:""),null,!0)},Q("aginswa64lnk").onclick=function(){downloadFile(Q("aginswa64lnk").name.split("installflags=")[0]+"installflags="+Q("aginsType").value+(urlargs.key?"&key="+urlargs.key:""),null,!0)},Q("aginsw32unlnk").onclick=function(){downloadFile(Q("aginsw32lnk").name.split("installflags=")[0]+"installflags="+Q("aginsType").value+(urlargs.key?"&key="+urlargs.key:""),null,!0)},Q("aginsw64unlnk").onclick=function(){downloadFile(Q("aginsw64lnk").name.split("installflags=")[0]+"installflags="+Q("aginsType").value+(urlargs.key?"&key="+urlargs.key:""),null,!0)},Q("aginswa64unlnk").onclick=function(){downloadFile(Q("aginswa64lnk").name.split("installflags=")[0]+"installflags="+Q("aginsType").value+(urlargs.key?"&key="+urlargs.key:""),null,!0)},0<debugmode&&(Q("aginswmshlnk").onclick=function(){downloadFile(Q("aginswmshlnk").name.split("installflags=")[0]+"installflags="+Q("aginsType").value+(urlargs.key?"&key="+urlargs.key:""),null,!0)}),Q("asinslnk").onclick=function(){downloadFile(Q("asinslnk").name+"&ac="+Q("asinsType").value,null,!0)},Q("asinslnk2").onclick=function(){downloadFile(Q("asinslnk").name+"&ac="+Q("asinsType").value,null,!0)},7==e&&(QV("agass_img1",Q("asinsType").value<2),QV("agass_img2",2<=Q("asinsType").value))}function validateDeviceToMesh(){QE("idx_dlgOkButton",0<Q("dp1devicename").value.length&&passwordcheck(Q("dp1password").value))}function addDeviceToMeshEx(e,t){var n=Q("dp1username").value,o=(""==n&&(n="admin"),Q("dp1hostname").value);""==o&&(o=Q("dp1devicename").value),meshserver.send({action:"addamtdevice",meshid:t,devicename:Q("dp1devicename").value,hostname:o,amtusername:n,amtpassword:Q("dp1password").value,amttls:Q("dp1tls").value})}function deviceHeaderSet(){0==deviceHeaderId?deviceHeaderId=1:(deviceHeaders["DevxHeader"+deviceHeaderId]=1==deviceHeaderTotal?"1 apparaat":format("{0} Apparaten",deviceHeaderTotal),deviceHeaderId++,deviceHeaderCount={},deviceHeaderTotal=0)}var powerStateStrings=["",'<span title="Apparaat is ingeschakeld.">Ingeschakeld</span>','<span title="Apparaat bevindt zich in slaapstand (S1).">Slapen</span>','<span title="Apparaat bevindt zich in slaapstand (S2).">Slapen</span>','<span title="Apparaat bevindt zich in diepe slaapstand (S3).">Slaapstand</span>','<span title="Apparaat bevindt zich in de slaapstand (S4).">Slaapstand</span>','<span title="Apparaat is uitgeschakeld (S5).">softwarematig uit</span>','<span title="Apparaat is gedetecteerd, maar de status kon niet worden verkregen.">Aanwezig</span>','<span title="Apparaat is uitgeschakeld.">Uit</span>'],powerStateStrings2=["","Apparaat is ingeschakeld","Apparaat bevindt zich in slaapstand (S1)","Apparaat bevindt zich in slaapstand (S2)","Apparaat bevindt zich in diepe slaapstand (S3)","Apparaat is in slaapstand (S4)","Apparaat is uitgeschakeld (S5)","Apparaat is aanwezig, maar de status kan niet worden bepaald","Het apparaat is uitgeschakeld"],powerColorTable=["pwsTransparent","pwsBlack","pwsBlue","pwsBlue2","pwsLightblue","pwsBlueviolet","pwsDarkgreen","pwsLightseagreen","pwsLightseagreen2"];function NodeStateStr(e){var t=[];return 0<e.state&&e.state<powerStatetable.length&&state.push(powerStatetable[e.state]),e.conn&&(0!=(1&e.conn)&&(4==e.mtype?"PDU"==e.porttype?t.push('<span title="Aan/uit-schakelaar is klaar voor gebruik.">Schakelaar</span>'):t.push('<span title="IP-KVM poort is actief en klaar voor gebruik.">IP-KVM</span>'):t.push('<span title="Mesh-agent is verbonden en klaar voor gebruik.">Agent</span>')),0!=(2&e.conn)?t.push('<span title="Intel&reg; AMT CIRA is verbonden en klaar voor gebruik.">CIRA</span>'):0!=(4&e.conn)&&t.push('<span title="Intel&reg; AMT is routeerbaar.">AMT</span>'),0!=(8&e.conn)&&t.push('<span title="Mesh-agent is bereikbaar met een andere agent als relay.">Relay</span>'),0!=(16&e.conn))&&t.push('<span title="MQTT verbinding met het apparaat is actief.">MQTT</span>'),null!=e.pwr&&0!=e.pwr&&t.push(powerStateStrings[e.pwr]),0==t.length?"&nbsp;":t.join(", ")}function PowerStateStr(e){return e<powerStatetable.length?powerStatetable[e]:""}function PowerStateStr2(e){return 0!=e&&e<powerStatetable.length?powerStatetable[e]:"Onbekend"}function updateCollapseAllButton(){var e=0<Object.keys(CollapsedGroups).length;QV("CollapseAllButton",!e),QV("ExpandAllButton",e),QV("CollapseAllButton2",!e),QV("ExpandAllButton2",e)}function selectallButtonFunction(){for(var e=document.getElementsByClassName("DeviceCheckbox"),t=Object.keys(checkedNodeids).length,n=0;n<e.length;n++)e[n].checked=0==t;if(checkedNodeids={},0==t){checkedNodeids={};for(var o=document.getElementsByName("xxdevice"+Q("viewselect").value),n=0;n<o.length;n++)(null==o[n].parentElement.attributes.style||o[n].parentElement.attributes.style.value.indexOf("display")<0)&&(checkedNodeids[o[n].id.substring(3)]=1)}p1updateInfo()}function p1devcheck(e){e.srcElement.checked?checkedNodeids[e.srcElement.value.substring(6)]=1:delete checkedNodeids[e.srcElement.value.substring(6)],p1updateInfo()}function p1updateInfo(){var e=Object.keys(checkedNodeids).length;if(0<e?(QE("GroupActionButton",!0),Q("SelectAllButton").value="Selecteer niets",QV("cxmdesktop",!0)):(QE("GroupActionButton",!1),Q("SelectAllButton").value="Selecteer alles",QV("cxmdesktop",!1)),null!=customui&&customui.devicesbarbuttons)for(var t in customui.devicesbarbuttons)"one"==customui.devicesbarbuttons[t].selection&&QE("cui:"+t,1==e),"many"==customui.devicesbarbuttons[t].selection&&QE("cui:"+t,1<=e)}function groupActionFunction(){var e=[],t=getCheckedDevices(),n=0;if(262144&features&&0==count2factoraAuths())setModalContent("xxAddAgent","Gebruikersaccount beveiliging",'Geen toegang tot deze functie totdat tweefactorauthenticatie is ingeschakeld. Dit is nodig voor extra veiligheid. Ga naar het tabblad "Mijn account" en kijk naar het gedeelte "Accountbeveiliging".'),showModal("xxAddAgentModal","idx_dlgOkButton");else{if(4194304&features)for(var o in t)if(0!=(16&getNodeFromId(t[o]).conn)){e.push({v:103,name:"Verzend MQTT bericht"});break}for(var o in e.push({v:105,name:"Exporteer apparaat informatie",s:!0}),t){var a=getNodeFromId(t[o]),i=GetNodeRights(a);1&i&&0==(2&n)&&(n|=2,e.push({v:102,name:"Verplaatsen naar apparaatgroep"})),0!=(1&a.conn)&&0!=(32768&i)&&0==(1&n)&&(n|=1,e.push({v:104,name:"Deïnstallatie agent"})),64&i&&0==(8&n)&&(n|=8,e.push({v:100,name:"Apparaat wekken"})),262144&i&&0==(4&n)&&(n|=4,e.push({v:4,name:"Slaap apparaten"}),e.push({v:3,name:"Herstart apparaten"}),e.push({v:2,name:"Schakel apparaten uit"})),131072&i&&0==(16&n)&&(n|=16,e.push({v:106,name:"Voer opdrachten uit"})),16384&i&&0==(32&n)&&(n|=32,e.push({v:108,name:"Apparaatmelding"})),4&i&&0==(64&n)&&(n|=64,e.push({v:107,name:"Bewerk tags"})),8&i&&0==(256&n)&&(n|=256,e.push({v:109,name:"Upload bestanden"})),32768&i&&0==(128&n)&&(n|=128,e.push({v:101,name:"Verwijder apparaten"})),null!=a.agent&&16&features2&&4294967295==i&&0==(512&n)&&(n|=512,e.push({v:110,name:"Forceer agent update"}),e.push({v:111,name:"Wis agent core"}),e.push({v:112,name:"Upload standaard serverkern"}))}var s="";for(o in e.sort(nameSort),e)s+="<option value="+e[o].v+(e[o].s?" selected":"")+">"+e[o].name+"</option>";var r="Selecteer een bewerking die op alle geselecteerde apparaten moet worden uitgevoerd. Acties worden alleen uitgevoerd met de juiste rechten.<br /><br />";setModalContent("xxAddAgent","Groepsactie",r+=addHtmlFormFloating("Operatie",'<select id=d2groupop class="form-select">'+s+"</select>")),showModal("xxAddAgentModal","idx_dlgOkButton",groupActionFunctionEx)}}function getCheckedDevices(){return Object.keys(checkedNodeids)}function uncheckAllDevices(){for(var e=document.getElementsByClassName("DeviceCheckbox"),t=0;t<e.length;t++)e[t].checked=!1;checkedNodeids={}}function groupActionFunctionEx(){var e=Q("d2groupop").value;if(100==e)return meshserver.send({action:"wakedevices",nodeids:getCheckedDevices()}),uncheckAllDevices(),!0;if(101==e){var t="";if(0==(l=getCheckedDevices()).length)return;if(1==l.length)t+="Verwijdering van geselecteerd apparaat bevestigen?<br /><br />";else{t+=format("Verwijdering van {0} geselecteerde apparaten bevestigen?<br />",l.length);var n=0,o=0;for(r in l)null!=(d=getNodeFromId(l[r])).conn&&0<d.conn?n++:o++;var a="";1==n?a+=format("1 geselecteerd apparaat is online.<br />",n):1<n&&(a+=format("{0} geselecteerde apparaten zijn online.<br />",n)),1==o?a+=format("1 geselecteerd apparaat is offline.<br />",o):1<o&&(a+=format("{0} geselecteerde apparaten zijn offline.<br />",o)),t+=""!=a?"<div style=padding:8px>"+a+"</div>":"<br />"}setModalContent("xxAddAgent","Apparaten verwijderen",t+='<label><input id=d2check type=checkbox class="form-check-input me-2" onchange=d2groupActionFunctionDelCheck() />Bevestig</label>'),showModal("xxAddAgentModal","idx_dlgOkButton",()=>d2groupActionFunctionDelExec()),QE("idx_dlgOkButton",!1)}else if(102==e)p10showChangeGroupDialog(getCheckedDevices());else if(103==e)p10showSendMqttMsgDialog(getCheckedDevices());else if(104==e)p10showSendUninstallAgentDialog(getCheckedDevices());else if(105==e)p2downloadDeviceInfo();else if(106==e)d2runCommandDialog({nodeids:getCheckedDevices(),title:"Voer opdrachten uit op geselecteerde apparaten.",func:uncheckAllDevices});else if(107==e){var t="Voer een batch-apparaat tag bewerking uit<br /><br />",i=(t=(t+=addHtmlFormFloating("Operatie",'<select id=d2deviceop class="form-select-sm me-2"><option value=1>Voeg tags toe</option><option value=2>Stel tags in</option><option value=3>Verwijder tags</option></select>'))+addHtmlFormFloating("Tags",'<input id=dp10devicevalue class="form-control" maxlength=4096 placeholder="Tag1, Tag2, Tag3" />'),[]),a="";for(r in nodes)if(nodes[r].tags)for(var s in nodes[r].tags)-1==i.indexOf(nodes[r].tags[s])&&i.push(nodes[r].tags[s]);if(0<i.length){for(var r in i.sort(),i)a+='<span style=padding:4px;background-color:#BBB;border-radius:3px;cursor:pointer onclick=showEditNodeValueDialogAddTag("'+encodeURIComponentEx(i[r])+'")>'+EscapeHtml(i[r])+"</span> ";t+="<div style=margin-top:8px;width:370px;line-height:26px;max-height:160px;overflow-y:auto>"+a+"</div>"}setModalContent("xxAddAgent","Berwerk apparaat tags",t),showModal("xxAddAgentModal","idx_dlgOkButton",()=>d2groupActionFunctionTagsExec())}else if(108==e){var t="<div style=margin-bottom:4px>Voer een batchapparaatmelding uit</div>";setModalContent("xxAddAgent","Apparaatmelding",t=(t=(t=(t=(t=(t+='<select id=d2deviceop class="form-select-sm me-2" style=width:100%;margin-bottom:4px><option value=2>Toast melding</option><option value=1>Berichten box</option><option value=3>Alert Box</option></select>')+'<input id=dp2notifyTitle maxlength=256 placeholder="Titel" style=width:100%;box-sizing:border-box;margin-bottom:4px />'+"<textarea id=d2notifyMsg style=width:100%;height:140px;resize:none;overflow-y:scroll;box-sizing:border-box;margin-bottom:4px></textarea>")+"<select style=width:100% id=d2notifyTimeout>"+'<option disabled value="">Only Applicable to Message Box Notifications</option>')+"<option value=2 selected>Toon gedurende 2 Minuten (Standaard)</option>"+"<option value=10>Toon gedurende 10 minuten</option>")+"<option value=30>Toon gedurende 30 Minuten</option>"+"<option value=60>Toon gedurende 60 minuten</option>")+"<option value=0>Toon bericht totdat het door de gebruiker wordt afgewezen</option>"+"</select>"),showModal("xxAddAgentModal","idx_dlgOkButton",()=>d2groupActionFunctionNotifyExec()),Q("d2notifyMsg").focus()}else if(109==e){var l,d,c=!1,u=!1;for(r in l=getCheckedDevices())(d=getNodeFromId(l[r])).agent&&(0<d.agent.id&&d.agent.id<5||34==d.agent.id?c=!0:u=!0);var t="Upload de geselecteerde bestanden naar alle geselecteerde apparaten<br /><br />";t=(t+="<form method=post enctype=multipart/form-data action=uploadfilebatch.ashx target=fileUploadFrame>")+("<input type=hidden name=authCookie value="+authCookie+" /><input type=hidden name=nodeIds value="+l.join(",")+" /><input type=submit id=d2batchUploadSubmit style=display:none />")+'<input type=file name=files id=d2uploadinput class="form-control" multiple=multiple onchange="d2batchUploadValidate()" /><br /><br />',c&&(t+=addHtmlFormFloating("Windows Pad",'<input type=text class="form-control" onchange="d2batchUploadValidate()" onkeyup="d2batchUploadValidate()" name=winpath id=d2winuploadpath placeholder="C:\\temp" value="" />')),u&&(t+=addHtmlFormFloating("Linux Pad",'<input type=text class="form-control" onchange="d2batchUploadValidate()" onkeyup="d2batchUploadValidate()" name=linuxpath id=d2linuxuploadpath placeholder="/tmp" value="" />')),setModalContent("xxAddAgent","Batch bestand uploaden",t=t+'<br /><label><input type=checkbox class="form-check-input me-2" name=createFolder />Map aanmaken als deze niet bestaat?</label><br />'+'<label><input type=checkbox class="form-check-input me-2" name=overwriteFiles />Overschrijven als bestand bestaat?</label></form>'),showModal("xxAddAgentModal","idx_dlgOkButton",()=>d2batchUploadValidateOk()),d2batchUploadValidate()}else if(110==e)setModalContent("xxAddAgent","Forceer agent update",t="Forceer agent update op de geselecteerde apparaten?<br /><br />"),showModal("xxAddAgentModal","idx_dlgOkButton",()=>d2groupActionFunctionAgentUpdateExec());else if(111==e)setModalContent("xxAddAgent","Wis agent core",t="Wis de agent core op de geselecteerde apparaten?<br /><br />"),showModal("xxAddAgentModal","idx_dlgOkButton",()=>d2groupActionFunctionAgentClearCoreExec());else{if(112!=e)return meshserver.send({action:"poweraction",nodeids:getCheckedDevices(),actiontype:parseInt(e)}),uncheckAllDevices(),!0;setModalContent("xxAddAgent","Upload standaard serverkern",t="Upload standaard server core op de geselecteerde apparaten?<br /><br />"),showModal("xxAddAgentModal","idx_dlgOkButton",()=>d2groupActionFunctionAgentDefaultCodeExec())}return!1}function d2batchUploadValidate(){QE("idx_dlgOkButton",!(0==Q("d2uploadinput").files.length||null!=Q("d2winuploadpath")&&""==Q("d2winuploadpath").value||null!=Q("d2linuxuploadpath")&&""==Q("d2linuxuploadpath").value))}function d2batchUploadValidateOk(){Q("d2batchUploadSubmit").click()}function d2groupActionFunctionAgentUpdateExec(){meshserver.send({action:"updateAgents",nodeids:getCheckedDevices()})}function d2groupActionFunctionAgentClearCoreExec(){meshserver.send({action:"uploadagentcore",nodeids:getCheckedDevices(),type:"clear"})}function d2groupActionFunctionAgentDefaultCodeExec(){meshserver.send({action:"uploadagentcore",nodeids:getCheckedDevices(),type:"default"})}function d2groupActionFunctionNotifyExec(){var e=Q("d2deviceop").value,t=Q("dp2notifyTitle").value,n=Q("d2notifyMsg").value,o=getCheckedDevices(),a=parseFloat(Q("d2notifyTimeout").value);if(0!=n.length)if(""==(t=""==t?decodeURIComponent("{{{extitle}}}"):t)&&(t="MeshCentral"),isNaN(a)&&(a=2),1==e)for(var i=0;i<o.length;i++)meshserver.send({action:"msg",type:"messagebox",nodeid:o[i],title:t,msg:n,timeout:6e4*a});else if(2==e)meshserver.send({action:"toast",nodeids:o,title:t,msg:n});else if(3==e)for(i=0;i<o.length;i++)meshserver.send({action:"msg",type:"alertbox",nodeid:o[i],title:t,msg:n})}function d2groupActionFunctionTagsExec(){var e=getCheckedDevices(),t=Q("d2deviceop").value,n=Q("dp10devicevalue").value;if(2==t)for(var o in e)meshserver.send({action:"changedevice",nodeid:e[o],tags:n});else{var a=[];for(o in n=n.split(",")){var i=n[o].trim();0<i.length&&i.length<64&&-1==a.indexOf(i)&&a.push(i)}for(o in e){var s=null,r=!1,l=getNodeFromId(e[o]);null==(s=null!=l.tags?Clone(l.tags):s)&&(s=[]);for(var d,c=0;c<n.length;c++)1==t&&-1==s.indexOf(n[c])&&(s.push(n[c]),r=!0),3==t&&0<=(d=s.indexOf(n[c]))&&(s.splice(d,1),r=!0);r&&meshserver.send({action:"changedevice",nodeid:e[o],tags:s.join(",")})}}}function p2downloadDeviceInfo(){if(!xxdialogMode){var e,t=getCheckedDevices(),n=!1;for(e in t)null!=getNodeFromId(t[e]).intelamt&&(n=!0);var o="Download de lijst met apparaten in een van de onderstaande bestandsindelingen.<br /><br />",o=(o+=addHtmlValue("CSV Formaat","<a href=# style=cursor:pointer onclick='return p2downloadDeviceInfoCSV()'>devicelist.csv</a>"))+addHtmlValue("JSON-indeling","<a href=# style=cursor:pointer onclick='return p2downloadDeviceInfoJSON()'>devicelist.json</a>");n&&(o+=addHtmlValue("Intel&reg; AMT JSON","<a href=# style=cursor:pointer onclick='return p2downloadAmtInfoJSON()'>computerlist.json</a>")),setModalContent("xxAddAgent","Apparaat informatie export",o+='<div style=margin-top:8px><label><input type=checkbox class="form-check-input me-2" id=d2DevInfoDetailsCheck />Voeg apparaatdetails toe</label></div>'),showModal("xxAddAgentModal","idx_dlgOkButton")}}function csvClean(e){return null==e?"":e.split(",").join("")}function p2downloadDeviceInfoCSV(){var e=getCheckedDevices();if(Q("d2DevInfoDetailsCheck").checked){var t=null;try{t=Intl.DateTimeFormat().resolvedOptions().timeZone}catch(e){}meshserver.send({action:"getDeviceDetails",nodeids:e,tz:t,tf:(new Date).getTimezoneOffset(),l:getLang(),type:"csv"})}else{var n,o="id,naam,rnaam,host,ikoon,ip,osdesc,status,groepsnaam,conn,pwr,av,update,firewall,bitlocker,avdetails,tags,lastbootuptime\r\n";for(n in e){var a=getNodeFromId(e[n]);if(o+='"'+a._id.split(",").join("")+'","'+a.name.split(",").join("")+'","'+(a.rname?a.rname.split(",").join(""):"")+'","'+(a.host?a.host.split(",").join(""):"")+'","'+a.icon+'","'+(a.ip||"")+'","'+(a.osdesc?a.osdesc.split(",").join(""):"")+'","'+a.state+'","'+meshes[a.meshid].name.split(",").join("")+'","'+(a.conn||"")+'","'+(a.pwr||"")+'"',"object"==typeof a.wsc?o+=',"'+csvClean(a.wsc.antiVirus)+'","'+csvClean(a.wsc.autoUpdate)+'","'+csvClean(a.wsc.firewall)+'"':o+=",,,","object"==typeof a.volumes){var i="",s=!0;for(d in a.volumes)void 0!==a.volumes[d].protectionStatus&&(s?s=!1:i+="|",i+=d+"/"+a.volumes[d].volumeStatus);o+=',"'+csvClean(i)+'"'}else o+=",";if("object"==typeof a.av){var r="",l=!0;for(d in a.av)"string"==typeof a.av[d].product&&(l?l=!1:r+="|",r+=a.av[d].product+"/"+(a.av[d].enabled?"enabled":"disabled")+"/"+(a.av[d].updated?"updated":"notupdated"));o+=',"'+csvClean(r)+'"'}else o+=",";if("object"==typeof a.tags){var d,c="",u=!0;for(d in a.tags)u?u=!1:c+="|",c+=a.tags[d];o+=',"'+csvClean(c)+'"'}else o+=",";"number"==typeof a.lastbootuptime&&(o+=',"'+a.lastbootuptime+'"'),o+="\r\n"}saveAs(stringToUtf8Blob(o),"devicelist.csv")}return!1}function p2downloadAmtInfoJSON(){var e,t=getCheckedDevices(),n={webappversion:"0.9.0",computers:[]};for(e in t){var o,a=getNodeFromId(t[e]);null!=a.intelamt&&(o={name:a.name,host:a.host,user:a.intelamt.user,pass:"",tls:1==a.intelamt.tls?1:0,ver:a.intelamt.ver,pstate:a.intelamt.state},2==a.intelamt.state&&(o.pmode=1),a.intelamt.realm&&(o.digestrealm=a.intelamt.realm),a.intelamt.hash&&(o.tlscerthash=a.intelamt.hash),n.computers.push(o))}saveAs(new Blob([JSON.stringify(n,null,2)],{type:"application/octet-stream"}),"computerlist.json")}function p2downloadDeviceInfoJSON(){var e=getCheckedDevices();if(Q("d2DevInfoDetailsCheck").checked){var t=null;try{t=Intl.DateTimeFormat().resolvedOptions().timeZone}catch(e){}meshserver.send({action:"getDeviceDetails",nodeids:e,tz:t,tf:(new Date).getTimezoneOffset(),l:getLang(),type:"json"})}else{var n,o=[];for(n in e)o.push(getNodeFromId(e[n]));saveAs(new Blob([JSON.stringify(o,null,2)],{type:"application/octet-stream"}),"devicelist.json")}return!1}function d2groupActionFunctionDelCheck(){QE("idx_dlgOkButton",Q("d2check").checked)}function d2groupActionFunctionDelExec(){meshserver.send({action:"removedevices",nodeids:getCheckedDevices()}),uncheckAllDevices()}function d2runCommandDialog(e){var t,n=!1,o=!1,a=!1;for(t in e.nodeids){var i=getNodeFromId(e.nodeids[t]);i.agent&&(24==(24&GetNodeRights(i))&&(a=!0),0<i.agent.id&&i.agent.id<5?n=!0:o=!0)}if(1==n||1==o||1==a){var s={type:1,runAs:0,source:1,cmd:""};try{s=JSON.parse(getstore("runopt",s))}catch(e){}e.selectedFile&&(r=e.selectedFile.name.toLowerCase(),console.log("filename",r),r.endsWith(".bat")&&(s.type=1),r.endsWith(".ps1")&&(s.type=2),r.endsWith(".sh")&&(s.type=3),r.endsWith(".agentconsole"))&&(s.type=4);var r="";e.title&&(r+=e.title+"<br />"),r+="<select id=d2cmdtype onclick=d2runCommandValidate() style=width:100%;margin-bottom:4px;margin-top:4px class=form-select>",1==n&&(r+="<option value=1"+(1==s.type?" selected":"")+">Windows opdrachtprompt</option><option value=2"+(2==s.type?" selected":"")+">Windows PowerShell</option>"),1==o&&(r+="<option value=3"+(3==s.type?" selected":"")+">Linux/BSD/macOS Command Shell</option>"),1==a&&(r+="<option value=4"+(4==s.type?" selected":"")+">Agent console</option>"),r=r+"</select>"+("<select id=d2cmduser style=width:100%;margin-bottom:4px class=form-select><option value=0"+(0==s.runAs?" selected":"")+">Uitvoeren als agent</option><option value=1"+(1==s.runAs?" selected":"")+">Uitvoeren als gebruiker, agent als er geen gebruiker is</option><option value=2"+(2==s.runAs?" selected":"")+">Moet als gebruiker worden uitgevoerd</option></select>"),null==e.selectedFile&&(r+="<select id=d2cmdsource onclick=d2runCommandValidate() style=width:100%;margin-bottom:4px class=form-select><option value=0"+(0==s.source?" selected":"")+">Opdrachten uit tekstvak</option><option value=1"+(1==s.source?" selected":"")+">Opdrachten uit bestand</option>",8&userinfo.siteadmin&&(r+="<option value=2"+(2==s.source?" selected":"")+">Opdrachten uit een bestand op de server</option>"),r=r+("</select><textarea id=d2runcmd onkeyup=d2runCommandValidate() style=background-color:#fcf3cf;width:100%;height:200px;resize:none;overflow-y:scroll class=form-control>"+(s.cmd?EscapeHtml(decodeURIComponent(s.cmd)):""))+'</textarea><div id=d2runfile style=display:none><input id=d2runfileex class="form-control" type=file onchange=d2runCommandValidate() id=d2localFile name=files onchange=d2runCommandValidate() /></div>',8&userinfo.siteadmin)&&(r+='<div id=d2runsfile style=display:none><div id=d2serveraction valign=bottom><input type=button id=p2FolderUp disabled="disabled" onclick=d3folderup() value="Up" />&nbsp;<span id=p2CurrentFolder></span></div><div id=d2serverfiles></div></div>'),setModalContent("xxAddAgent","Voer opdrachten uit",r),showModal("xxAddAgentModal","idx_dlgOkButton",function(){d2groupActionFunctionRunCommands(3,e)}),null==e.selectedFile&&(Q("d2runcmd").focus(),8&userinfo.siteadmin)&&(d3fileoptions={dialog:2,files:"d2serverfiles",folderup:"p2FolderUp",currentFolder:"p2CurrentFolder",func:null},d3updatefiles()),d2runCommandValidate()}}function d2runCommandValidate(){var e;QV("d2cmduser",Q("d2cmdtype").value<4),null==xxdialogTag.selectedFile?(QV("d2runcmd",0==Q("d2cmdsource").value),QV("d2runfile",1==Q("d2cmdsource").value),QV("d2runsfile",2==Q("d2cmdsource").value),e=!1,0==Q("d2cmdsource").value&&0<Q("d2runcmd").value.length&&(e=!0),1==Q("d2cmdsource").value&&1==Q("d2runfileex").files.length&&(e=!0),2==Q("d2cmdsource").value&&(e=!1),QE("idx_dlgOkButton",e)):QE("idx_dlgOkButton",!0)}function d2groupActionFunctionRunCommands(e,t){var n=3;try{n=parseInt(Q("d2cmdtype").value)}catch(e){}null==t.selectedFile&&putstore("runopt",JSON.stringify({type:n,runAs:parseInt(Q("d2cmduser").value),source:parseInt(Q("d2cmdsource").value),cmd:encodeURIComponent(Q("d2runcmd").value)}));var o,a={action:"runcommands",nodeids:t.nodeids,type:n,runAsUser:parseInt(Q("d2cmduser").value)};t.selectedFile?((o=new FileReader).onload=function(e){a.cmds=e.target.result,meshserver.send(a),t.func&&t.func()},o.readAsText(t.selectedFile)):0==Q("d2cmdsource").value?(a.cmds=Q("d2runcmd").value,meshserver.send(a),t.func&&t.func()):1==Q("d2cmdsource").value?((o=new FileReader).onload=function(e){a.cmds=e.target.result,meshserver.send(a),t.func&&t.func()},o.readAsText(Q("d2runfileex").files[0])):2==Q("d2cmdsource").value&&1==(n=d3getFileSel()).length&&(a.cmdpath=d3filetreelocation.join("/")+"/"+n[0],meshserver.send(a),t.func)&&t.func()}function onSortSelectChange(e){sort=document.getElementById("sortselect").selectedIndex,e||putstore("sort",sort)}var sortCollator=new Intl.Collator(void 0,{numeric:!0,sensitivity:"base"});function nameSort(e,t){e=e.name.toLowerCase(),t=t.name.toLowerCase();return sortCollator.compare(e,t)}function meshSort(e,t){var n=sortCollator.compare(e.meshnamel,t.meshnamel);return 0!=n||0!=(n=sortCollator.compare(e.meshid,t.meshid))?n:1==showRealNames?sortCollator.compare(e.rnamel,t.rnamel):sortCollator.compare(e.namel,t.namel)}function powerSort(e,t){var n=e.pwr||0,o=t.pwr||0;return o<n?-1:n<o?1:n==o?1==showRealNames?sortCollator.compare(e.rnamel,t.rnamel):sortCollator.compare(e.namel,t.namel):void 0}function deviceSort(e,t){return sortCollator.compare(e.namel,t.namel)}function deviceHostSort(e,t){return sortCollator.compare(e.rnamel,t.rnamel)}function lastConnectSort(e,t){var n=e.lastconnect,o=t.lastconnect;return null==n&&(n=99999999999999),null==o&&(o=99999999999999),(n=0<e.conn?99999999999998:n)==(o=0<t.conn?99999999999998:o)?nameSort(e,t):n-o}function onSearchFocus(e){searchFocus=e}function clearDeviceSearch(){Q("KvmSearchInput").value=Q("SearchInput").value="",onOnlineCheckBox(),mainUpdate(1)}function onMapSearchFocus(e){mapSearchFocus=e}function onUserSearchFocus(e){userSearchFocus=e}function onConsoleFocus(e){consoleFocus=e}function parseSearchAndInput(e){var t,n=e.split(" en "),o=null;for(t in n){var a=getDevicesThatMatchFilter(n[t]);if(null==o)o=a;else{var i,s=[];for(i in a)0<=o.indexOf(a[i])&&s.push(a[i]);o=s}}return o}function parseSearchOrInput(e){var t,n=e.split(" of "),o=null;for(t in n){var a=parseSearchAndInput(n[t]);if(null==o)o=a;else for(var i in a)o.indexOf(0<=a[i])&&o.push(a[i])}return o}function getDevicesThatMatchFilter(e){var t=[],n=null,o=null,a=null,i=null,s=null,r=null,l=null,d=null,c=null;if(e.startsWith("gebruiker:".toLowerCase())?n=e.substring("gebruiker:".length):e.startsWith("u:".toLowerCase())?n=e.substring("u:".length):e.startsWith("ip:".toLowerCase())?o=e.substring("ip:".length):e.startsWith("groep:".toLowerCase())?a=e.substring("groep:".length):e.startsWith("g:".toLowerCase())?a=e.substring("g:".length):e.startsWith("tag:".toLowerCase())?i=e.substring("tag:".length):e.startsWith("t:".toLowerCase())?i=e.substring("t:".length):e.startsWith("atag:".toLowerCase())?s=e.substring("atag:".length):e.startsWith("a:".toLowerCase())?s=e.substring("a:".length):e.startsWith("os:".toLowerCase())?l=e.substring("os:".length):e.startsWith("amt:".toLowerCase())?d=e.substring("amt:".length):e.startsWith("aflopend:".toLowerCase())?c=e.substring("aflopend:".length):"wsc:ok"==e?r=1:"wsc:noav"==e?r=2:"wsc:noupdate"==e?r=3:"wsc:nofirewall"==e?r=4:"wsc:any"==e&&(r=5),""==e)for(var u in nodes)t.push(u);else if(null!=o)for(var u in nodes)null!=nodes[u].ip&&0<=nodes[u].ip.toLowerCase().indexOf(o)&&t.push(u);else if(null!=a)for(var u in nodes)0<=meshes[nodes[u].meshid].name.toLowerCase().indexOf(a)&&t.push(u);else if(null!=i){for(var u in nodes)if(null==nodes[u].tags&&""==i)t.push(u);else if(null!=nodes[u].tags)for(var p in nodes[u].tags)if(0<=nodes[u].tags[p].toLowerCase().indexOf(i)){t.push(u);break}}else if(null!=s)for(var u in nodes)(null!=nodes[u].agent&&null==nodes[u].agent.tag&&""==s||null!=nodes[u].agent&&null!=nodes[u].agent.tag&&0<=nodes[u].agent.tag.toLowerCase().indexOf(s))&&t.push(u);else if(null!=n){for(var u in nodes)if(nodes[u].users&&0<nodes[u].users.length)for(var m in nodes[u].users)0<=nodes[u].users[m].toLowerCase().indexOf(n)&&t.push(u)}else if(null!=l)for(var u in nodes)null!=nodes[u].osdesc&&0<=nodes[u].osdesc.toLowerCase().indexOf(l)&&t.push(u);else if(null!=d)for(var u in nodes)null==nodes[u].intelamt||""!=d&&nodes[u].intelamt.state!=d||t.push(u);else if(null!=c)for(var u in nodes)null!=nodes[u].desc&&""!=nodes[u].desc&&(""==c||0<=nodes[u].desc.toLowerCase().indexOf(c))&&t.push(u);else if(null!=r)for(var u in nodes)!nodes[u].wsc||(1==r&&"OK"==nodes[u].wsc.antiVirus&&"OK"==nodes[u].wsc.autoUpdate&&"OK"==nodes[u].wsc.firewall||(2==r||5==r)&&"OK"!=nodes[u].wsc.antiVirus||(3==r||5==r)&&"OK"!=nodes[u].wsc.autoUpdate||(4==r||5==r)&&"OK"!=nodes[u].wsc.firewall)&&t.push(u);else if("*"==e)for(var u in nodes)1==stars[nodes[u]._id]&&t.push(u);else try{var g=e.split(/\s+/).join("|"),v=new RegExp(g);for(u in nodes)32768&features2?268435456&features2?(v.test(nodes[u].name.toLowerCase())||v.test(meshes[nodes[u].meshid].name.toLowerCase())||null!=nodes[u].rnamel&&v.test(nodes[u].rnamel.toLowerCase()))&&t.push(u):(v.test(nodes[u].name.toLowerCase())||null!=nodes[u].rnamel&&v.test(nodes[u].rnamel.toLowerCase()))&&t.push(u):268435456&features2?showRealNames?(null!=nodes[u].rnamel&&v.test(nodes[u].rnamel.toLowerCase())||v.test(meshes[nodes[u].meshid].name.toLowerCase()))&&t.push(u):(v.test(nodes[u].name.toLowerCase())||v.test(meshes[nodes[u].meshid].name.toLowerCase()))&&t.push(u):showRealNames?null!=nodes[u].rnamel&&v.test(nodes[u].rnamel.toLowerCase())&&t.push(u):v.test(nodes[u].name.toLowerCase())&&t.push(u)}catch(e){for(var u in nodes)t.push(u)}return t}function onSearchInputChanged(){var e=Q("SearchInput").value.toLowerCase().trim(),t=(putstore("_search",Q("SearchInput").value),""==e?QC("SearchInput").remove("search"):QC("SearchInput").add("search"),QV("SearchInputClearButton",""!=e),QV("KvmSearchInputClearButton",""!=e),parseSearchOrInput(e));for(o in nodes)nodes[o].v=0<=t.indexOf(o);var n,e=Q("DevFilterSelect").value;if(1==e)for(var o in nodes)null!=nodes[o].conn&&0!=nodes[o].conn||3==nodes[o].mtype||(nodes[o].v=!1);if(2==e)for(var o in nodes)(null==(n=nodes[o]).sessions||null==n.sessions.kvm&&null==n.sessions.terminal&&null==n.sessions.files&&null==n.sessions.tcp&&null==n.sessions.udp)&&(n.v=!1);if(3==e)for(var o in nodes)1!=stars[nodes[o]._id]&&(nodes[o].v=!1);if(4==e)for(var o in nodes)null==nodes[o].intelamt&&(nodes[o].v=!1);if(5==e)for(var o in nodes)null!=nodes[o].conn&&0!=nodes[o].conn&&(nodes[o].v=!1);if(6==e)for(var o in nodes)null!=(n=nodes[o]).sessions&&null!=n.sessions.help||(n.v=!1);if(7==e)for(var o in nodes)null!=(n=nodes[o]).tags&&0!=n.tags.length||(n.v=!1);if(8==e)for(var o in nodes)null!=(n=nodes[o]).tags&&0<n.tags.length&&(n.v=!1)}function newContextMenu(e,t){if(1===t){if(null==currentNode||null==currentNode.agent||3==currentNode.mtype)return!0;if(!(serverinfo.linuxshell&&4<currentNode.agent.id)){t=e.target.nextElementSibling;if(t)for(var n=t.children,o=4<currentNode.agent.id&&!isWindowsNode(currentNode)?"lin":34==currentNode.agent.id?"add":null,a=0;a<n.length;a++)n[a].style.display=o?n[a].classList.contains(o)?"block":"none":n[a].classList.contains("lin")||n[a].classList.contains("ass")?"none":"block"}}}var contextelement=null;function handleContextMenu(e){if(hideContextMenu(),!xxdialogMode){for(var t=null!==window.pageXOffset?window.pageXOffset:(document.documentElement||document.body.parentNode||document.body).scrollLeft,n=null!==window.pageYOffset?window.pageYOffset:(document.documentElement||document.body.parentNode||document.body).scrollTop,o=document.elementFromPoint(e.pageX-t,e.pageY-n);o&&null!=o&&null==o.attributes.cmenu;)o=o.parentElement;if(null==o)return!0;t=o.attributes.cmenu.value;if("devsContentMenu"===t){contextelement=o;var a=document.getElementById("contextMenu"),n=(showContextMenuDiv(a,e.pageX,e.pageY),getNodeFromId((n=(1==Q("viewselect").value?contextelement.children[0].children[0].children[1].children[0]:contextelement.children[1]).attributes.onmouseup.value).substring(12,n.length-18))),i=GetNodeRights(n),s=0!=(16&i),r=4294967295==i||0==(512&i),l=4294967295==i||0==(1024&i);QV("cxdesktop",0!=(1&n.conn)&&4!=n.mtype&&(1==n.mtype||null==n.agent||null==n.agent.caps||0!=(1&n.agent.caps)||n.intelamt&&2==n.intelamt.state)&&(8&i||256&i)&&(4294967295==i||0==(65536&i))),QV("cxterminal",0!=(1&n.conn)&&4!=n.mtype&&(1==n.mtype||null==n.agent||null==n.agent.caps||0!=(2&n.agent.caps)||n.intelamt&&2==n.intelamt.state)&&8&i&&r),QV("cxfiles",4!=n.mtype&&2==n.mtype&&(null==n.agent||null==n.agent.caps||0!=(4&n.agent.caps))&&8&i&&l),QV("cxevents",null!=n.intelamt&&(2==n.intelamt.state||2&n.conn)&&8&i),QV("cxdetails",n.mtype<3),QV("cxwebvnc",(0!=(1&n.conn)||3==n.mtype)&&n.agent&&0!=(8&i)&&0==(536870912&features)),QV("cxwebrdp",(0!=(1&n.conn)||3==n.mtype)&&n.agent&&0!=(8&i)&&0==(1073741824&features)),QV("cxwebssh",512&features2&&(0!=(1&n.conn)||3==n.mtype)&&n.agent&&0!=(8&i)),QV("cxconsole",s&&2==n.mtype&&(null==n.agent||null==n.agent.caps||0!=(8&n.agent.caps))&&8&i),QV("cxrdp",!1),0==(1&n.conn)&&3!=n.mtype||!n.agent||0==(8&i)||0<n.agent.id&&n.agent.id<5&&("win32"!=navigator.platform.toLowerCase()||null!=serverinfo.devicemeshrouterlinks&&0==serverinfo.devicemeshrouterlinks.rdp||QV("cxrdp",!0)),QV("cxmgroupsplit",!0),QV("cxstar",!0)}else{if(null==(a=document.getElementById(t)))return!0;contextelement=o,showContextMenuDiv(a,e.pageX,e.pageY)}return haltEvent(e)}}function showContextMenuDiv(e,t,n){var o=document.documentElement.getBoundingClientRect(),a=o.height,o=o.width;e.style.left=e.style.right=e.style.top=e.style.bottom=null,o/2<t?e.style.right=o-event.pageX+"px":e.style.left=event.pageX+"px",a/2<n?e.style.bottom=a-event.pageY+"px":e.style.top=event.pageY+"px",e.style.display="block"}function cmaction(e,t){var n,o=(1==Q("viewselect").value?contextelement.children[0].children[0].children[1].children[0]:contextelement.children[1]).attributes.onmouseup.value;if(o=o.substring(12,o.length-18),9==e&&(Q("viewselect").value=3,Q("viewselect").onchange(),Q("autoConnectDesktopCheckbox").checked=!0,Q("autoConnectDesktopCheckbox").onclick()),0<e&&e<9&&(n=[0,10,12,11,13,16,17,15,19][e],t&&1==t.shiftKey?safeNewWindow(window.location.origin+"?node="+o.split("/")[2]+"&viewmode="+n+"&hide=16"+(urlargs.key?"&key="+urlargs.key:""),"meshcentral:"+o):(gotoDevice(o,n),t=meshes[currentNode.meshid],1&currentNode.conn&&2==t.mtype&&(11==n&&null==desktop&&1&currentNode.agent.caps&&connectDesktop(null,3),12==n&&null==terminal&&2&currentNode.agent.caps&&connectTerminal(null,1),13==n)&&null==files&&connectFiles(null))),10==e){for(var a=document.getElementsByClassName("DeviceCheckbox"),i=[],s=0;s<a.length;s++)!0===a[s].checked&&i.push(a[s].defaultValue.substring(6));for(s in 0==i.length&&i.push(o),i)null!=stars[i[s]]&&(delete stars[i[s]],delete i[s]);var r=Object.keys(stars).length;for(s in i)r<200&&null==stars[i[s]]&&(stars[i[s]]=1,r++);putstore("stars",JSON.stringify(stars)),updateDeviceViewDevice(o),3==Q("DevFilterSelect").value&&mainUpdate(1)}else 11==e?p10mstsc(o):12==e?p10rfb(o):13==e?p10ssh(o):14==e&&p10MCRouter(o,3)}function cmmeshaction(e){var t=contextelement.attributes.onclick.value.substring(10,contextelement.attributes.onclick.value.length-2),n=document.getElementsByClassName("DeviceCheckbox");if(1==e||2==e){for(var o=0;o<n.length;o++)n[o].attributes&&n[o].attributes.class.value.split(" ")[0]==t&&(n[o].checked=1==e);if(1==e)for(var o in nodes)nodes[o].meshid==t&&1==nodes[o].v&&(checkedNodeids[nodes[o]._id]=1);else if(2==e)for(var o in checkedNodeids){var a=getNodeFromId(o);null!=a&&a.meshid==t&&1==a.v&&delete checkedNodeids[o]}}p1updateInfo()}function cmconnectfilesaction(){connectFiles(null,1,32)}function cmtermaction(e,t){e<100?connectTerminal(null,1,{protocol:e,consent:t}):100==e&&connectTerminal(null,1,{protocol:1,requireLogin:!0,consent:t})}function cmdeskaction(e){1==e&&connectDesktop(null,3,null,72),2==e&&connectDesktop(null,3,null,8),3==e&&connectDesktop(null,3,null,64),10==e&&null!=desktop&&(desktop.sendCtrlMsg('{"ctrlChannel":"102938","type":"autolock","value":true}'),connectDesktop()),11==e&&null!=desktop&&(desktop.sendCtrlMsg('{"ctrlChannel":"102938","type":"autolock","value":false}'),connectDesktop())}function cmaltportaction(e){xxdialogMode||(setModalContent("xxAddAgent","RDP verbinding",'RDP externe verbindings poort:<br /><br /><input type=text placeholder="3389" inputmode="numeric" pattern="[0-9]*" onkeypress="return (event.keyCode == 8) || (event.charCode >= 48 && event.charCode <= 57)" maxlength=5 id=d10rdpport type=text>'),showModal("xxAddAgentModal","idx_dlgOkButton",function(){var e=0<Q("d10rdpport").value.length?parseInt(Q("d10rdpport").value):3389;meshserver.send({action:"changedevice",nodeid:currentNode._id,rdpport:e})}),Q("d10rdpport").focus(),null!=currentNode.rdpport&&(Q("d10rdpport").value=currentNode.rdpport))}function cmsshportaction(e){xxdialogMode||(setModalContent("xxAddAgent","SSH verbinding",'SSH externe verbindingspoort:<br /><br /><input type=text placeholder="22" inputmode="numeric" pattern="[0-9]*" onkeypress="return (event.keyCode == 8) || (event.charCode >= 48 && event.charCode <= 57)" maxlength=5 id=d10sshport type=text>'),showModal("xxAddAgentModal","idx_dlgOkButton",function(){var e=0<Q("d10sshport").value.length?parseInt(Q("d10sshport").value):22;meshserver.send({action:"changedevice",nodeid:currentNode._id,sshport:e})}),Q("d10sshport").focus(),null!=currentNode.sshport&&(Q("d10sshport").value=currentNode.sshport))}function cmrfbportaction(e){xxdialogMode||(setModalContent("xxAddAgent","VNC verbinding",'VNC extrne verbindingspoort:<br /><br /><input type=text placeholder="5900" inputmode="numeric" pattern="[0-9]*" onkeypress="return (event.keyCode == 8) || (event.charCode >= 48 && event.charCode <= 57)" maxlength=5 id=d10rfbport type=text>'),showModal("xxAddAgentModal","idx_dlgOkButton",function(){var e=0<Q("d10rfbport").value.length?parseInt(Q("d10rfbport").value):3389;meshserver.send({action:"changedevice",nodeid:currentNode._id,rfbport:e})}),Q("d10rfbport").focus(),null!=currentNode.rfbport&&(Q("d10rfbport").value=currentNode.rfbport))}function cmhttpportaction(e){xxdialogMode||(setModalContent("xxAddAgent","HTTP verbinding",'HTTP poort voor externe verbinding:<br /><br /><input type=text placeholder="80" inputmode="numeric" pattern="[0-9]*" onkeypress="return (event.keyCode == 8) || (event.charCode >= 48 && event.charCode <= 57)" maxlength=5 id=d10httpport type=text>'),showModal("xxAddAgentModal","idx_dlgOkButton",function(){var e=0<Q("d10httpport").value.length?parseInt(Q("d10httpport").value):80;meshserver.send({action:"changedevice",nodeid:currentNode._id,httpport:e})}),Q("d10httpport").focus(),null!=currentNode.httpport&&(Q("d10httpport").value=currentNode.httpport))}function cmhttpsportaction(e){xxdialogMode||(setModalContent("xxAddAgent","HTTPS verbinding",'HTTPS poort voor externe verbinding:<br /><br /><input type=text placeholder="443" inputmode="numeric" pattern="[0-9]*" onkeypress="return (event.keyCode == 8) || (event.charCode >= 48 && event.charCode <= 57)" maxlength=5 id=d10httpsport type=text>'),showModal("xxAddAgentModal","idx_dlgOkButton",function(){var e=0<Q("d10httpsport").value.length?parseInt(Q("d10httpsport").value):443;meshserver.send({action:"changedevice",nodeid:currentNode._id,httpsport:e})}),Q("d10httpsport").focus(),null!=currentNode.httpsport&&(Q("d10httpsport").value=currentNode.httpsport))}function cmfilesaction(e){var t;xxdialogMode||(t=p13sort_files(p13filetree.dir)[parseInt(contextelement.attributes.fileindex.nodeValue)],1==e?(setModalContent("xxAddAgent","Hernoemen",'<input type=text id=p13renameinput maxlength=64 onkeyup=p13fileNameCheck(event) style=width:100% value="'+t.n+'" />'),showModal("xxAddAgentModal","idx_dlgOkButton",()=>p13renamefileEx(3,{action:"rename",path:p13filetreelocation.join("/"),oldname:t.n})),focusTextBox("p13renameinput"),p13fileNameCheck()):2==e?t.s<=204800?p13downloadfile(encodeURIComponentEx(p13filetreelocation.join("/")+"/"+t.n),encodeURIComponentEx(t.n),t.s,"viewer"):messagebox("Bestandsberwerker","Alleen bestanden kleiner dan 200k kunnen worden bewerkt."):3==e&&(setModalContent("xxAddAgent","Verwijderen","Verwijder item?"),showModal("xxAddAgentModal","idx_dlgOkButton",()=>p13deletefileCm(3,t))))}function cmexpandaction(e){if(1==e)CollapsedGroups={};else{if(0==sort){for(var t in CollapsedGroups={},meshes)CollapsedGroups[t]=!0;for(var t in nodes)null==meshes[nodes[t].meshid]&&(CollapsedGroups[nodes[t].meshid]=!0)}if(1==sort){CollapsedGroups={};for(t=0;t<10;t++)CollapsedGroups["pwr:"+t]=!0}if(3==sort)for(var t in CollapsedGroups={},nodes)if((o=nodes[t]).tags)for(var n in o.tags)CollapsedGroups["tag:"+encodeURIComponentEx(o.tags[n])]=!0;if(4==sort)for(var t in CollapsedGroups={},nodes){var o=nodes[t],a=meshes[o.meshid];if(a){if(CollapsedGroups["tag:"+encodeURIComponentEx(a.name)]=!0,o.tags)for(var n in o.tags)CollapsedGroups["tag:"+encodeURIComponentEx(a.name+" - "+o.tags[n])]=!0}else if(o.tags)for(var n in o.tags)CollapsedGroups["tag:"+encodeURIComponentEx("**INDV*~*DEVS** - "+o.tags[n])]=!0}}putstore("_collapse",JSON.stringify(CollapsedGroups)),updateCollapseAllButton(),mainUpdate(4)}function cmdeskplayeraction(e){xxdialogMode||safeNewWindow(window.location.origin+"{{{domainurl}}}player.htm"+(urlargs.key?"?key="+urlargs.key:""),"meshcentral-deskplayer")}function cmdeskshortcutaction(e){xxdialogMode||deskCustomizeKeys()}function cmdeskpreconfigtypeaction(e){xxdialogMode||(-1==e?deskCustomizeStrings():showDeskTypeEx(e<1e3?serverinfo.preConfiguredRemoteInput[e].value:deskKeyboardStrings[e-1e3].v))}function cmdeskpreconfigscriptaction(e){meshserver.send({action:"runcommands",nodeids:[currentNode._id],presetcmd:e})}function p13deletefileCm(e,t){files.sendText({action:"rm",reqid:1,path:p13filetreelocation.join("/"),delfiles:[t.n],rec:!1}),p13folderup(999)}function hideContextMenu(){QV("contextMenu",!1),QV("meshContextMenu",!1),QV("altPortContextMenu",!1),QV("rfbPortContextMenu",!1),QV("sshPortContextMenu",!1),QV("httpPortContextMenu",!1),QV("httpsPortContextMenu",!1),QV("filesContextMenu",!1),QV("deskPlayerContextMenu",!1),QV("deskKeyShortcutContextMenu",!1),QV("deskPreConfigShortcutContextMenu",!1),QV("deskPreConfigScriptContextMenu",!1),QV("expandAllContextMenu",!1),contextelement=null}var map_cm_popup,map_cm_editMarker,map_cm_clearMarker,map_cm_saveMarker,map_cm_nodemenu_items,contextmenu_items,currentNode,xxmap={map:null,contextmenu:null,activeInteractions:[],showindex:0,markersSource:null,markersLayer:null,mapLayer:null,mapView:null};function updateMapMarkers(e){if(0!=(32768&features)){if(null!=xxmap&&null==xxmap.map)try{loadmap()}catch(e){console.error("loadmap() exception",e)}if(null!=xxmap){var t,n=null;for(t in nodes)try{var o,a,i=map_parseNodeLoc(nodes[t]),s=xxmap.markersSource.getFeatureById(nodes[t]._id);null==i||nodes[t].meshid!=e&&null!=e?s&&xxmap.markersSource.removeFeature(s):(o=i[0],a=i[1],i[2],null==n?n=[o,a,o,a,0]:(o<n[0]&&(n[0]=o),a<n[1]&&(n[1]=a),o>n[2]&&(n[2]=o),a>n[3]&&(n[3]=a)),null==s?(addFeature(nodes[t]),n[4]=1):(updateFeature(nodes[t],s),s.setStyle(markerStyle(nodes[t],i[2]))))}catch(e){console.error("updateMapMarkers() exception",e,JSON.stringify(nodes[t]))}return n}}}function stringToIntHash(e){for(var t=0,n=0;n<e.length;n++)t=(t<<5)-t+e.charCodeAt(n),t|=0;return t}function map_parseNodeLoc(e){var t=null,n=0;return e.iploc&&(t=e.iploc,n=1),e.wifiloc&&(t=e.wifiloc,n=2),e.gpsloc&&(t=e.gpsloc,n=3),e.userloc&&(t=e.userloc,n=4),null==t||"string"!=typeof t?null:(t=t.split(","),1==n?[parseFloat(t[0])+stringToIntHash(e._id.substring(0,20))/1e11,parseFloat(t[1])+stringToIntHash(e._id.substring(20))/1e11,n]:[parseFloat(t[0]),parseFloat(t[1]),n])}function loadmap(){if(0!=(32768&features)&&null!=xxmap)if(0==(32768&features))xxmap=null;else{QV("viewselectmapoption",!0),QV("devViewButton4",!0);try{xxmap.markersSource=new ol.source.Vector,xxmap.markersLayer=new ol.layer.Vector({source:xxmap.markersSource}),xxmap.mapLayer=new ol.layer.Tile({source:new ol.source.OSM}),xxmap.mapView=new ol.View({center:ol.proj.transform([0,0],"EPSG:4326","EPSG:3857"),zoom:2,minZoom:2,maxZoom:20,extent:ol.proj.transformExtent([-1e5,-69.55,1e5,69.55],"EPSG:4326","EPSG:3857")}),xxmap.map=new ol.Map({target:"xdevicesmap",layers:[xxmap.mapLayer,xxmap.markersLayer],view:xxmap.mapView}),xxmap.map.addOverlay(map_cm_popup),xxmap.map.on("click",function(e){var t,e=xxmap.map.forEachFeatureAtPixel(e.pixel,function(e,t){return e});e&&gotoDevice(null!=(t=e.getId())?t:getCorrespondingFeature(e).getId(),10)}),xxmap.map.on("pointermove",function(e){var t,e=xxmap.map.forEachFeatureAtPixel(e.pixel,function(e,t){return e});e?(xxmap.map.getTargetElement().style.cursor="pointer",t=e.getGeometry().getCoordinates(),map_cm_popup.setPosition(t),e.getId()?QH("xmap-info-window",e.get("name")):(t=getCorrespondingFeature(e),QH("xmap-info-window",t.get("name")))):(xxmap.map.getTargetElement().style.cursor="",QH("xmap-info-window",""))});var e=new ContextMenu({width:160,defaultItems:!1,items:contextmenu_items});e.on("open",function(e){var e=xxmap.map.forEachFeatureAtPixel(e.pixel,function(e,t){return e});xxmap.contextmenu.clear(),e?e.getId()?addContextMenuItems(e):(e=getCorrespondingFeature(e))?addContextMenuItems(e):xxmap.contextmenu.extend(contextmenu_items):xxmap.contextmenu.extend(contextmenu_items)}),null==xxmap.contextmenu&&(xxmap.contextmenu=e),xxmap.map.addControl(xxmap.contextmenu)}catch(e){console.log(e),QV("viewselectmapoption",!1),QV("devViewButton4",!1),xxmap=null}}}function addFeature(e,t,n){var o=getModifiedFeature(e._id);o?xxmap.markersSource.addFeature(o):(t||n||(t=(o=map_parseNodeLoc(e))[0],n=o[1]),180<n&&meshserver.send({action:"changedevice",nodeid:e._id,userloc:[t,n=180-n]}),t<90&&-90<t&&n<180&&-180<n&&((o=new ol.Feature({geometry:new ol.geom.Point(ol.proj.transform([n,t],"EPSG:4326","EPSG:3857")),name:e.name,status:e.conn,lat:t,lon:n})).setId(e._id),o.setStyle(markerStyle(e)),xxmap.markersSource.addFeature(o)))}function removeFeature(e){e=xxmap.markersSource.getFeatureById(e._id);e&&xxmap.markersSource.removeFeature(e)}function updateFeature(e,t){e.conn!=t.get("status")&&(t.set("status",e.conn),t.setStyle(markerStyle(e)));var n,o=map_parseNodeLoc(e);null!=o&&(n=o[0],o=o[1],n==t.get("lat")&&o==t.get("lon")||(t.set("lat",n),t.set("lon",o),o=ol.proj.transform([parseFloat(o),parseFloat(n)],"EPSG:4326","EPSG:3857"),t.getGeometry().setCoordinates(o))),e.name!=t.get("name")&&t.set("name",e.name)}function modifyMarkerloc(e){var t,n=e.getId();n&&(e.setStyle(markerStyle(getNodeFromId(e.a),4)),getActiveInteractions(e)||(t=new ol.interaction.Modify({features:new ol.Collection([e]),pixelTolerance:10}),xxmap.activeInteractions.push({featureid:n,feature:e,interaction:t}),xxmap.map.addInteraction(t)))}function saveMarkerloc(e){var t,n=e.getId();n&&(t=getActiveInteractions(e))&&(xxmap.map.removeInteraction(t),removeInteraction(n),t=e.getGeometry().getCoordinates(),180<(e=ol.proj.transform(t,"EPSG:3857","EPSG:4326"))[0]&&(e[0]=180-e[0]),meshserver.send({action:"changedevice",nodeid:n,userloc:[e[1],e[0]]}))}function markerStyle(e,t){null==t&&(t=0,e.iploc&&(t=1),e.wifiloc&&(t=2),e.gpsloc&&(t=3),e.userloc)&&(t=4);e=connStateColor(e);return[new ol.style.Style({image:new ol.style.Icon({color:e,anchor:[.5,1],src:"images/mapmarker"+["","-ip","-wifi","-gps","-user"][t]+".png"})})]}function connStateColor(e){return 1==e.conn||3==e.conn||5==e.conn?"#00ffdd":"#C70039"}function addContextMenuItems(t){getActiveInteractions(t)?(map_cm_saveMarker.data=t,xxmap.contextmenu.push(map_cm_saveMarker)):(map_cm_editMarker.data=t,xxmap.contextmenu.push(map_cm_editMarker),getNodeFromId(t.a).userloc&&(map_cm_clearMarker.data=t,xxmap.contextmenu.push(map_cm_clearMarker))),map_cm_nodemenu_items.forEach(function(e){"Inzoomen tot maat"==e.text||"Uitzoomen naar maat"==e.text?e.data=t:"-"!=e&&(e.data=t.getId())}),xxmap.contextmenu.extend(map_cm_nodemenu_items)}function getActiveInteractions(e){for(var t=e.getId(),n=0;n<xxmap.activeInteractions.length;n++)if(xxmap.activeInteractions[n].featureid==t)return xxmap.activeInteractions[n].interaction;return!1}function getModifiedFeature(e){if(e)for(var t=0;t<xxmap.activeInteractions.length;t++)if(xxmap.activeInteractions[t].featureid==e)return xxmap.activeInteractions[t].feature;return null}function removeInteraction(e){for(var t=-1,n=0;n<xxmap.activeInteractions.length;n++)if(xxmap.activeInteractions[n].featureid===e){t=n;break}0<=t&&xxmap.activeInteractions.splice(t,1)}function getCorrespondingFeature(e){for(var t=e.getGeometry().getCoordinates(),n=0;n<xxmap.activeInteractions.length;n++){var o=xxmap.activeInteractions[n].feature,a=o.getGeometry().getCoordinates();if(a[0].toFixed(5)==t[0].toFixed(5)&&a[1].toFixed(5)==t[1].toFixed(5))return o}return null}function refreshMap(e,t){e&&(xxmap.map.setTarget(null),xxmap.map=null,xxmap.markersSource=null,xxmap.mapView=null,xxmap.mapLayer=null,xxmap.activeInteractions=[]);e=updateMapMarkers();if(null!=e&&(t||1==e[4])){for(var t=(e[0]+e[2])/2,n=(e[1]+e[3])/2,o=Math.max(Math.abs(e[0]-e[2]),Math.abs(e[1]-e[3])),e=xxmap.map.getView(),a=(e.setCenter(ol.proj.transform([n,t],"EPSG:4326","EPSG:3857")),360),i=-2;o<a;)i++,a/=2;e.setZoom(i)}}function placeNode(e){if(!xxdialogMode){var t,n='<div style=margin-bottom:6px><label for=selectnode-search>Zoeken</label>&nbsp&nbsp<input type=text placeholder="Apparaat naam" id="selectnode-search" onchange=onPlaceNodeInputChange() onkeyup=onPlaceNodeInputChange() autocomplete=off style=width:120px></div><div id=placenode style="height:254px;overflow-y:auto;width:100%;margin:12px 1px 4px 1px;"><div id=noNodesMapPlace style=text-align:center;width:100%;display:none>Geen apparaten gevonden.</div>';for(t in nodes)n=(n+="<div class=noselect id="+nodes[t]._id+"-rowid onclick=selectNodeToPlace(event,'"+nodes[t]._id+"') style=background-color:lightgray;margin-bottom:4px;border-radius:2px><input name=PlaceMapDeviceCheckbox id="+nodes[t]._id+'-checkid type=checkbox class="form-check-input me-2" style=width:16px;display:inline />')+"<div class=j"+nodes[t].icon+" style=width:16px;height:16px;margin-top:2px;margin-right:4px;display:inline-block></div><div style=width:16px;display:inline>"+nodes[t].name+"</div></div>";setModalContent("xxAddAgent","Selecteer een apparaat om te plaatsen",n+"</div>"),showModal("xxAddAgentModal","idx_dlgOkButton",()=>placeNodeEx(3,e)),onPlaceNodeInputChange()}}function placeNodeEx(e,t){var n,o,a,i,s=document.getElementsByName("PlaceMapDeviceCheckbox");for(n in s)s[n].checked&&(o=getNodeFromId(s[n].id.substring(0,s[n].id.length-8)))&&(a=xxmap.markersSource.getFeatureById(n),i=[(i=ol.proj.transform(t,"EPSG:3857","EPSG:4326"))[1],i[0]],a&&(a.getGeometry().setCoordinates(t),getActiveInteractions(a))?saveMarkerloc(a):meshserver.send({action:"changedevice",nodeid:o._id,userloc:i}))}function onPlaceNodeInputChange(){updatePlaceNodeTable(Q("selectnode-search").value.trim().toLowerCase())}function updatePlaceNodeTable(e){document.getElementsByName("PlaceMapDeviceCheckbox");var t,n=0;for(t in nodes){var o=0<=nodes[t].namel.indexOf(e)||""==e||null!=nodes[t].rnamel&&0<=nodes[t].rnamel.indexOf(e);o&&n++,QV(nodes[t]._id+"-rowid",o)}QV("noNodesMapPlace",0==n)}function selectNodeToPlace(e,t){"PlaceMapDeviceCheckbox"!=e.target.name&&((e=Q(t+"-checkid")).checked=!e.checked);var n,o=document.getElementsByName("PlaceMapDeviceCheckbox"),a=0;for(n in o)o[n].checked&&a++;QE("idx_dlgOkButton",0<a)}function addMeshOptions(e,t){}function meshOptionRmvMod(e,t){}function meshExists(){for(var e in meshes)if(meshes[e])return!0;return!1}function setMeshView(e){var t=Q("select-mesh");t[t.selectedIndex].value==e&&(t[0].selected=!0,onSelectMeshChange())}function clearMeshOptions(){}function getSearchLocation(){try{var e,t=Q("mapSearchLocation").value.trim();0<t.length&&((e=new XMLHttpRequest).onreadystatechange=function(){4==e.readyState&&200==e.status&&formatSearchData(e.responseText)},e.open("GET","https://nominatim.openstreetmap.org/search?q="+t+"&format=json",!0),e.send())}catch(e){}}function formatSearchData(e){try{QH("xmapSearchResults","");for(var t=JSON.parse(e),n=0,o='<div class="xmapItem">',a=0;a<t.length;a++)t[a].display_name&&t[a].boundingbox[0]&&t[a].boundingbox[1]&&t[a].boundingbox[2]&&t[a].boundingbox[3]&&(n++,o+='<div class="xmapItemSel1" onclick=mapGotoSelectedLocation(this)><div>'+t[a].display_name+"</div><div style=display:none>"+t[a].boundingbox[0]+"!#!"+t[a].boundingbox[1]+"!#!"+t[a].boundingbox[2]+"!#!"+t[a].boundingbox[3]+"</div></div>");o+="</div>",1==n?zoomToExtent([parseFloat(t[0].boundingbox[2]),parseFloat(t[0].boundingbox[0]),parseFloat(t[0].boundingbox[3]),parseFloat(t[0].boundingbox[1])]):(0==n&&(o="<div style=width:200px>Geen locatie gevonden.<div>"),QV("xmapSearchResultsDlg",!0)),QH("xmapSearchResults",o)}catch(e){}}function mapGotoSelectedLocation(e){e=e.children[1].innerHTML.split("!#!");zoomToExtent([parseFloat(e[2]),parseFloat(e[0]),parseFloat(e[3]),parseFloat(e[1])]),mapCloseSearchWindow()}function mapCloseSearchWindow(){QH("xmapSearchResults",""),QV("xmapSearchResultsDlg",!1)}function zoomToLocation(e,t){var n=xxmap.map.getView();n.setCenter(e),n.setZoom(t)}function zoomToFitExtent(){var e;0<xxmap.markersSource.getFeatures().length&&(e=xxmap.markersSource.getExtent(),xxmap.map.getView().fit(e,xxmap.map.getSize()))}function zoomToExtent(e){e=ol.proj.transformExtent(e,ol.proj.get("EPSG:4326"),ol.proj.get("EPSG:3857"));xxmap.map.getView().fit(e,xxmap.map.getSize())}function refreshDevice(e){currentNode&&currentNode._id==e&&gotoDevice(e,xxcurrentView,!0)}32768&features&&(map_cm_popup=new ol.Overlay({element:Q("xmap-info-window"),positioning:"bottom-center",stopEvent:!1}),map_cm_editMarker={text:"Wijzig apparaatlocatie",callback:function(e){modifyMarkerloc(e.data)}},map_cm_clearMarker={text:"Verwijder apparaatlocatie",callback:function(e){meshserver.send({action:"changedevice",nodeid:e.data.a,userloc:[]})}},map_cm_saveMarker={text:"apparaatlocatie opslaan",callback:function(e){saveMarkerloc(e.data)}},map_cm_nodemenu_items=[{text:"Algemene informatie",callback:function(e){null!=e.data&&gotoDevice(e.data,10)}},{text:"Bureaublad",callback:function(e){null!=e.data&&gotoDevice(e.data,11)}},{text:"Terminal",callback:function(e){null!=e.data&&gotoDevice(e.data,12)}},{text:"Intel&reg; AMT",callback:function(e){null!=e.data&&gotoDevice(e.data,14)}},"-",{text:"Inzoomen tot maat",callback:function(e){zoomToLocation(e.data.getGeometry().getCoordinates(),19)}},{text:"Uitzoomen naar maat",callback:function(e){zoomToLocation(e.data.getGeometry().getCoordinates(),2)}}],contextmenu_items=[{text:"Verversen",callback:function(){refreshMap(!0,!0)}},{text:"Zoom in op maat",callback:function(){zoomToFitExtent()}},{text:"Centreer kaart hier",callback:function(e){xxmap.mapView.animate({center:e.coordinate})}},{text:"Plaats hier een apparaat",callback:function(e){placeNode(e.coordinate)}}]);var powerTimelineNode=null,powerTimelineReq=null,powerTimelineUpdate=null,powerTimeline=null,deviceSharesNode=null,deviceSharesReq=null,deviceShares=null;function getCurrentNode(){return currentNode}function gotoDevice(e,t,n,o){if(!o||3!=o.which&&2!=o.button)if(!0!==userinfo.emailVerified&&1==serverinfo.emailcheck&&4294967295!=userinfo.siteadmin)setModalContent("xxAddAgent","Gebruikersaccount beveiliging",'Geen toegang tot deze functie totdat een e-mailadres is geverifieerd. Dit is vereist voor wachtwoordherstel. Ga naar het tabblad "Mijn account" om een e-mailadres te wijzigen en te verifiëren.'),showModal("xxAddAgentModal","idx_dlgOkButton");else if(262144&features&&0==count2factoraAuths())setModalContent("xxAddAgent","Gebruikersaccount beveiliging",'Geen toegang tot deze functie totdat tweefactorauthenticatie is ingeschakeld. Dit is nodig voor extra veiligheid. Ga naar het tabblad "Mijn account" en kijk naar het gedeelte "Accountbeveiliging".'),showModal("xxAddAgentModal","idx_dlgOkButton");else if(!o||1!=o.shiftKey&&2!=o.which&&1!=o.button){var a=getNodeFromId(e);if(null!=a){null!=currentNode&&currentNode._id==a._id&&0!=(1&a.conn)||deviceDetailsStatsClear();var i=meshes[a.meshid],s=GetNodeRights(a),H=null==currentNode||currentNode._id!=e;if(!currentNode||currentNode._id!=a._id||1==n){currentNode=a,QV("deskPreConfigScriptContextMenu1",2==currentNode.mtype&&isWindowsNode(currentNode)),QV("deskPreConfigScriptContextMenu2",2==currentNode.mtype&&!isWindowsNode(currentNode)),QV("p10deviceNotify",null!=currentNode.sessions&&(null!=currentNode.sessions.kvm||null!=currentNode.sessions.terminal||null!=currentNode.sessions.files||null!=currentNode.sessions.tcp||null!=currentNode.sessions.udp)),QV("p10deviceStar",1==stars[currentNode._id]),QV("p10deviceHelp",null!=currentNode.sessions&&null!=currentNode.sessions.help),null!=currentNode.sessions&&null!=currentNode.sessions.msg?(QV("p10deviceMsg",!0),QH("p10deviceMsg",Object.keys(currentNode.sessions.msg).length)):QV("p10deviceMsg",!1),QV("p10deviceBattery",!1),null!=currentNode.sessions&&null!=currentNode.sessions.battery?(f="","ac"==(r=currentNode.sessions.battery).state&&(f="Apparaat is aangesloten"),"dc"==r.state&&(f="Apparaat werkt op batterijen"),d="",w=-1,"number"==typeof r.level&&0<=r.level&&r.level<=100&&(d=r.level+"%",5<(w=Math.floor((r.level+10)/25)+1)&&(lvl=5),"ac"==r.state)&&(100==r.level?w=11:w+=5),0<w&&(Q("p10deviceBattery").title=null!=f?f+", "+d:d,QV("p10deviceBattery",!0),Q("p10deviceBattery").className="deviceBatteryLarge deviceBatteryLarge"+w)):QV("p10deviceBattery",!1);var r=EscapeHtml(a.name),l=(0==r.length&&(r="<i>Geen</i>"),f=r=0==(4&s)||i.flags&&0!=(2&i.flags)?r:'<span tabindex=0 title="Klik hier om de apparaatnaam van de server te bewerken" onclick=showEditNodeValueDialog(0) onkeyup="if (event.key == \'Enter\') showEditNodeValueDialog(0)" role="button">'+r+' <i class="fa-solid fa-pencil fa-2xs"/></i></span>',i&&(r+="<span style=color:#AAA;font-size:small> - "+EscapeHtml(i.name)+"</span>"),QH("p10deviceName",r),QH("p11deviceName",r),QH("p12deviceName",r),QH("p13deviceName",r),QH("p14deviceName",r),QH("p15deviceName","Console - "+r),QH("p16deviceName",r),QH("p17deviceName",r),QH("p19deviceName",r),"<table style=width:100%>"),d=(0!=(8&args.hide)&&(l+="<br />"+addDeviceAttribute("Naam",f)),i&&(l+=addDeviceAttribute('<span title="De naam van de apparaatgroep waartoe deze computer behoort">Groep</span>','<a href=# title="De naam van de apparaatgroep waartoe deze computer behoort" onclick=gotoMesh("'+a.meshid+'") style=cursor:pointer>'+EscapeHtml(meshes[a.meshid].name)+"</a>")),null!=a.rname&&a.name!=a.rname&&(l+=addDeviceAttribute('<span title="De naam van deze computer zoals ingesteld in het besturingssysteem">Besturingssysteem naam</span>','<span title="De naam van deze computer zoals ingesteld in het besturingssysteem">'+EscapeHtml(a.rname)+"</span>")),(0==(1&features)&&4!=a.mtype||3==a.mtype)&&(l+=addDeviceAttribute("Hostnaam",addLinkConditional(a.host?EscapeHtml(a.host):"<i>Geen</i>","showEditNodeValueDialog(1)",4&s))),a.desc?EscapeHtml(a.desc):"<i>Geen</i>");if(l+=addDeviceAttribute("Omschrijving",0!=(4&s)?"<span onclick=showEditNodeValueDialog(2) style=cursor:pointer>"+d+' <i class="fa-solid fa-pencil fa-xs" role="button"></i></span>':d),4==a.mtype&&(null!=a.portnum&&(l+=addDeviceAttribute("Poortnummer",a.portnum)),null!=a.porttype)&&(l+=addDeviceAttribute("Poort type",a.porttype)),null!=a.agent&&null!=a.agent.id&&3==a.mtype?(4==a.agent.id&&(l+=addDeviceAttribute("Apparaatsoort","Windows")),6==a.agent.id&&(l+=addDeviceAttribute("Apparaatsoort","Linux")),29==a.agent.id&&(l+=addDeviceAttribute("Apparaatsoort","macOS"))):null!=a.agent&&null!=a.agent.id&&null!=a.agent.ver&&(k="",k=a.agent.id<=agentsStr.length?agentsStr[a.agent.id]:agentsStr[0],0!=a.agent.ver&&(k+=" v"+a.agent.ver),14==a.agent.id&&(k=a.agent.core),!1===a.agent.root&&0!=(1&a.conn)&&(k+=", Beperkt"),l+=addDeviceAttribute("Mesh Agent",k)),null!=a.intelamt&&(k="",w={0:nobreak("Niet geactiveerd (Pre)"),1:nobreak("Niet geactiveerd (In)"),2:nobreak("Geactiveerd")},null!=a.intelamt.ver&&null==a.intelamt.state?k+="<i>Onbekende staat</i>, v"+EscapeHtml(a.intelamt.ver):null==a.intelamt.ver&&2==a.intelamt.state?k+="<i>Geactiveerd</i>":null==a.intelamt.ver||null==a.intelamt.state?k+="<i>Onbekende versie en staat</i>":(k+=w[a.intelamt.state],2==a.intelamt.state&&a.intelamt.flags&&(2&a.intelamt.flags?k+=' <span title="Intel&reg; AMT wordt geactiveerd in Client Control Mode">CCM</span>':4&a.intelamt.flags&&(k+=' <span title="Intel&reg; AMT wordt geactiveerd in de beheerdersmodus">ACM</span>')),k+=", v"+EscapeHtml(a.intelamt.ver)),2==a.intelamt.state&&(1==a.intelamt.tls&&(k+=', <span title="Intel&reg; AMT is ingesteld met TLS-netwerkbeveiliging">TLS</span>'),r=!1,null==a.intelamt.user||""==a.intelamt.user?0!=(4&s)?(k+=', <i style=color:#FF0000;cursor:pointer title="Bewerk Intel&reg; AMT-gegevens" onclick=editDeviceAmtSettings("'+a._id+'")>Geen referenties</i>',r=!0):k+=", <i style=color:#FF0000>Geen referenties</i>":0!=(1&features2)&&null!=a.intelamt.warn&&(f=null,0!=(1&a.intelamt.warn)&&(f="Ongeldige inloggegevens"),null!=(f=0!=(8&a.intelamt.warn)?"Inloggegevens proberen":f))&&(0!=(4&s)?(k+=', <i style=color:#FF0000;cursor:pointer title="Bewerk Intel&reg; AMT-gegevens" onclick=editDeviceAmtSettings("'+a._id+'")>'+f+"</i>",r=!0):k+=", <i style=color:#FF0000>"+f+"</i>"),k+=" ",r=0!=(4&s)&&0==(1&features2)||r)&&(k+='<img src=images/link4.png height=10 width=10 title="Bewerk Intel&reg; AMT-gegevens" style=cursor:pointer onclick=editDeviceAmtSettings("'+a._id+'")>'),d='<span title="Intel&reg; Manageability Engine">Intel&reg; ME<span>',"number"==typeof a.intelamt.sku&&(0!=(8&a.intelamt.sku)?d='<span title="Intel&reg; Active Management Technology">Intel&reg; AMT<span>':0!=(16&a.intelamt.sku)&&(d='<span title="Standaard beheerbaarheid van Intel&reg;">Intel&reg; SM<span>')),l+=addDeviceAttribute(d,k)),null!=a.agent&&null!=a.agent.tag?l+=addDeviceAttribute("Agent Tag",p=(p=EscapeHtml(a.agent.tag)).startsWith("mailto:")?'<a href="'+EscapeHtml(p)+'">'+EscapeHtml(p.substring(7))+"</a>":p):null!=a.intelamt&&null!=a.intelamt.tag&&(l+=addDeviceAttribute("Intel&reg; AMT Tag",p=(p=EscapeHtml(a.intelamt.tag)).startsWith("mailto:")?'<a href="'+EscapeHtml(p)+'">'+EscapeHtml(p.substring(7))+"</a>":p)),a.osdesc&&(l+=addDeviceAttribute("Besturingssysteem",a.osdesc)),a.wsc&&(u=[],null!=a.wsc.antiVirus&&("OK"==a.wsc.antiVirus?u.push("Anti-virus - <span style=color:green>OK</span>"):u.push("Anti-virus - <span style=color:red>Uitgeschakeld</span>")),null!=a.wsc.autoUpdate&&("OK"==a.wsc.autoUpdate?u.push("Bijwerken - <span style=color:green>OK</span>"):u.push("Bijwerken - <span style=color:red>Uitgeschakeld</span>")),null!=a.wsc.firewall&&("OK"==a.wsc.firewall?u.push("Firewall - <span style=color:green>OK</span>"):u.push("Firewall - <span style=color:red>Uitgeschakeld</span>")),l+=addDeviceAttribute("Windows Beveiliging",u.join(", "))),a.defender&&(u=[],null!=a.defender.RealTimeProtection&&(1==a.defender.RealTimeProtection?u.push("RealTimeProtection - <span style=color:green>Aan</span>"):u.push("RealTimeProtection - <span style=color:red>Uit</span>")),null!=a.defender.TamperProtected&&(1==a.defender.TamperProtected?u.push("Pauzeer bescherming - <span style=color:green>Aan</span>"):u.push("Pauzeer bescherming - <span style=color:red>Uit</span>")),0<u.length)&&(l+=addDeviceAttribute("Windows Defender",u.join(", "))),a.av&&0<a.av.length){var c,u=[];for(g in a.av)a.av[g].product&&(c=EscapeHtml(a.av[g].product),!0!==a.av[g].enabled&&(c+=" - <span style=color:red>Uitgeschakeld</span>"),!0!==a.av[g].updated&&(c+=" - <span style=color:red>Verouderd</span>"),1==a.av[g].enabled&&1==a.av[g].updated&&(c+=" - <span style=color:green>OK</span>"),u.push(c));l+=addDeviceAttribute("Anti-virus",u.join("<br />"))}a.users&&0<a.users.length&&(w=a.users.map(function(e){return addKeyLinkConditional(EscapeHtml(e),"Vergrendeld",a.lusers&&0<=a.lusers.indexOf(e))}).join(", "),l+=addDeviceAttribute(1<a.users.length?"Actieve gebruikers":"Actieve gebruiker",w)),null!=a.agent&&14!=a.agent.id&&3!=a.mtype&&(f=[],r=0,a.consent&&(r=a.consent),serverinfo.consent&&(r|=serverinfo.consent),64&r&&8&r?f.push("Bureaublad vraag en werkbalk"):64&r?f.push("Bureaublad werkbalk"):8&r?f.push("Bureaublad vraag"):1&r&&f.push("Bureaublad melding"),16&r?f.push("Terminal Prompt"):2&r&&f.push("Terminal melding"),32&r?f.push("Bestanden vragen"):4&r&&f.push("Bestanden Melden"),7==r&&(f=["Altijd informeren"]),l+=addDeviceAttribute("Toestemming van gebruiker",addLinkConditional(f=""==(f=(f=56==(56&r)?["Altijd vragen"]:f).join(", "))?"<i>Geen</i>":f,"p20editmeshconsent(3)",1&s)));var d=[],p=(null!=userinfo.notify&&null!=userinfo.notify[a._id]&&(2&(k=userinfo.notify[a._id])&&d.push("Verbinden"),4&k&&d.push("Verbreken"),null!=a.intelamt&&8&k&&d.push("Intel&reg; AMT"),16384&features2&&userinfo.emailVerified&&(x=0,16&k&&x++,32&k&&x++,64&k&&x++,0<x)&&d.push(format("Email ({0})",x)),null!=userinfo.msghandle)&&0!=(33554432&features2)&&(x=0,128&k&&x++,256&k&&x++,512&k&&x++,0<x)&&d.push(format("Berichten ({0})",x)),l+=addDeviceAttribute("Meldingen",addLink(d=""==(d=d.join(", "))?"<i>Geen</i>":d,"p20editDeviceNotify()")),a.conn),m=(p&&1<p&&(w=[],0!=(1&a.conn)&&w.push('<span title="Mesh-agent is verbonden en klaar voor gebruik.">Mesh Agent</span>'),0!=(2&a.conn)?w.push('<span title="Intel&reg; AMT CIRA is verbonden en klaar voor gebruik.">Intel&reg; AMT CIRA</span>'):0!=(4&a.conn)&&w.push('<span title="Intel&reg; AMT is routeerbaar en klaar voor gebruik.">Intel&reg; AMT</span>'),0!=(8&a.conn)&&w.push('<span title="Mesh-agent is bereikbaar met een andere agent als relay.">Mesh Relay</span>'),0!=(16&a.conn)&&w.push('<span title="MQTT verbinding met het apparaat is actief.">MQTT</span>'),l+=addDeviceAttribute("Connectiviteit",w.join(", "))),"<i>Geen</i>");if(null!=a.tags)for(var g in m="",a.tags)m+="<span class=tagSpan>"+EscapeHtml(a.tags[g])+"</span> ";l+=addDeviceAttribute("Tags",0!=(4&s)?"<span onclick=showEditNodeValueDialog(3) style=line-height:26px;cursor:pointer>"+m+' <i class="fa-solid fa-pencil fa-xs" role="button"></i></span>':"<span style=line-height:26px>"+m+"</span>"),null==a.ssh&&null==a.rdp||(u=[],0!=(4&s)?(null!=a.ssh&&u.push("<span onclick=showClearSshDialog(3) style=cursor:pointer>"+(1==a.ssh?"SSH-gebruiker+wachtwoord":2==a.ssh?"SSH-gebruiker+sleutel+wachtwoord":"SSH-gebruiker+sleutel")+' <i class="fa-solid fa-pencil fa-xs" role="button"></i></span>'),null!=a.rdp&&u.push('<span onclick=showClearRdpDialog(3) style=cursor:pointer>RDP <i class="fa-solid fa-pencil fa-xs" role="button"></i></span>')):(null!=a.ssh&&u.push(1==a.ssh?"SSH-gebruiker+wachtwoord":2==a.ssh?"SSH-gebruiker+sleutel+wachtwoord":"SSH-gebruiker+sleutel"),null!=a.rdp&&u.push("RDP")),l+=addDeviceAttribute("Inloggegevens",u.join(", ")));var v=[];for(g in meshes)meshes[g].relayid==a._id&&v.push('<a href=# onclick=gotoMesh("'+meshes[g]._id+'") style=cursor:pointer>'+EscapeHtml(meshes[g].name)+"</a>");if(0<v.length&&(l+=addDeviceAttribute('<span title="Apparaatgroepen waarvoor dit apparaat een relay is">Relay voor</span>',v.join(", "))),l+="</table><br />",0!=(262220&s)&&a.mtype<3&&(null==a.agent||34!=a.agent.id)&&(l+='<input type=button class="btn btn-primary btn-sm me-2" value="Acties" title="Voer power acties uit op het apparaat" onclick=deviceActionFunction() />'),l=(l+='<input type=button class="btn btn-primary btn-sm me-2" value="Notities" title="Bekijk opmerkingen over dit apparaat" onclick=showNotes('+(0==(128&s))+',"'+encodeURIComponentEx(a._id)+'") />')+('<input type=button class="btn btn-primary btn-sm me-2" value="Gebeurtenissenlog" title="Schrijf een gebeurtenis voor dit apparaat" onclick=writeDeviceEvent("'+encodeURIComponentEx(a._id)+'") />'),2==a.mtype&&1&p&&0!=(131072&s)&&(l+='<input type=button class="btn btn-primary btn-sm me-2" cmenu=deskPreConfigScriptContextMenu value="Uitvoeren" title="Voer opdrachten uit op dit apparaat." onclick=runDeviceCmd("'+encodeURIComponentEx(a._id)+'") />'),4!=a.mtype){if((8&s&&1&p&&0!=(16384&s)||1==a.pmt&&0!=(2&features2))&&(l+='<input type=button class="btn btn-primary btn-sm me-2" value="Bericht" title="Geef een tekstbericht weer op het externe apparaat" onclick=deviceMessageFunction() />'),(8&s&&1&p&&0!=(16384&s)||1==a.pmt&&0!=(2&features2))&&(l+='<input type=button class="btn btn-primary btn-sm me-2" value="Chat" title="Open chatvenster op deze computer" onclick=deviceChat(event) />'),null!=serverinfo&&null!=serverinfo.altmessenging&&8&s&&1&p)for(var g in serverinfo.altmessenging){var h=serverinfo.altmessenging[g];null!=h.type&&"device"!=h.type||(l+='<input type=button class="btn btn-primary btn-sm me-2" value="'+EscapeHtml(serverinfo.altmessenging[g].name)+'" onclick=altDeviceChat(event,'+g+") />")}!1!==serverinfo.guestdevicesharing&&null!=a.agent&&3&a.agent.caps&&1&p&&524296==(524296&s)&&(4294967295==s||0==(4096&s))?(l+='<input type=button class="btn btn-primary btn-sm me-2" value="Delen" title="Maak een link om dit apparaat met een gast te delen" onclick=showShareDevice() />',QV("DeskGuestShareButton",!0)):QV("DeskGuestShareButton",!1)}if(4==a.mtype&&1&p&&("PDU"==a.porttype?1==a.pwr?262144&s&&(l+='<input type=button class="btn btn-primary btn-sm me-2" value="Uitschakelen" title="Uitschakelen" onclick=setIpPduState(0) />'):8==a.pwr&&64&s&&(l+='<input type=button class="btn btn-primary btn-sm me-2" value="Inschakelen" title="Inschakelen" onclick=setIpPduState(1) />'):8&s&&(l+='<input type=button class="btn btn-primary btn-sm me-2" value="Extern beheer" title="Extern beheer" onclick=openIpKvmRemoteControl("'+encodeURIComponentEx(a._id)+'") />')),null!=customui&&null!=customui.devicebuttons)for(var g in customui.devicebuttons)(null==customui.devicebuttons[g].showif||null!=i&&customui.devicebuttons[g].showif==i._id||customui.devicebuttons[g].showif==currentNode._id)&&(l+='<input id="cui:'+g+'" type="button" class="btn btn-primary btn-sm me-2" value="'+customui.devicebuttons[g].name+'" onclick=customUIAction(event,"devicebuttons") />');QH("p10html",l),mainUpdate(256);var r=4294967295==s||0==(65536&s),f=4294967295==s||0==(512&s),k=4294967295==s||0==(1024&s),x=4294967295==s||0==(2048&s),l='<div class="p10html3right">';if(0!=(1&s)&&4!=a.mtype&&(l+='&nbsp;<a href=# onclick=p10showChangeGroupDialog(["'+a._id+'"]) title="Verplaats dit apparaat naar een andere apparaatgroep">Verander groep</a>'),0!=(32768&s)&&(l+='&nbsp;<a href=# onclick=p10showDeleteNodeDialog("'+a._id+'") title="Verwijder dit apparaat">Verwijder apparaat</a>'),l+='</div><div class="p10html3left">',a.agent&&3!=a.mtype&&0!=(1048576&s)&&(l+='<a href=# onclick=p10showNodeNetInfoDialog("'+a._id+'") title="Toon apparaat netwerk interface informatie">Interfaces</a>&nbsp;'),32768&features&&null!=xxmap&&(l+='<a href=# onclick=p10showNodeLocationDialog("'+a._id+'") title="Informatie over apparaatlocaties weergeven">Locatie</a>&nbsp;'),null==a.agent||14!=a.agent.id&&34!=a.agent.id){if(4294967295!=userinfo.siteadmin&&0!=(128&userinfo.siteadmin)||f&&0!=(8&s)&&null!=a.agent&&14!=a.agent.id&&(l+='<a href=# onclick=p10showMeshCmdDialog(1,"'+a._id+'") title="Verkeersrouter gebruikt om verbinding te maken met een apparaat via deze server.">MeshCmd</a>&nbsp;'),0!==args.xterm||!a.agent||0==(2&a.agent.caps)||0==(8&s)||4294967295!=s&&0!=(512&s)||(l+='<a href=# onclick=p10openxterm(event,"'+a._id+'") title="Open XTerm terminal">XTerm</a>&nbsp;'),(0!=(1&p)||3==a.mtype)&&a.agent&&0!=(8&s)&&(0!=webRelayPort&&(l=(l+='<a href=# cmenu=httpPortContextMenu onclick=p10WebRouter("'+a._id+'",1,'+(a.httpport||80)+")>HTTP"+(a.httpport&&80!=a.httpport?"/"+a.httpport:"")+"</a>&nbsp;")+'<a href=# cmenu=httpsPortContextMenu onclick=p10WebRouter("'+a._id+'",2,'+(a.httpsport||443)+")>HTTPS"+(a.httpsport&&443!=a.httpsport?"/"+a.httpsport:"")+"</a>&nbsp;"),0<a.agent.id&&a.agent.id<5&&("win32"!=navigator.platform.toLowerCase()||null!=serverinfo.devicemeshrouterlinks&&0==serverinfo.devicemeshrouterlinks.rdp||(l+='<a href=# cmenu=altPortContextMenu id=rdpMCRouterLink onclick=p10MCRouter("'+a._id+'",3) title="Vereist de installatie van MeshCentral Router.">RDP'+(a.rdpport&&3389!=a.rdpport?"/"+a.rdpport:"")+"</a>&nbsp;")),4<a.agent.id&&("win32"!=navigator.platform.toLowerCase()&&"macintel"!=navigator.platform.toLowerCase()||null!=serverinfo.devicemeshrouterlinks&&0==serverinfo.devicemeshrouterlinks.ssh||(l+='<a href=# cmenu=sshPortContextMenu onclick=p10MCRouter("'+a._id+'",4,'+(a.sshport||22)+') title="Vereist de installatie van MeshCentral Router.">SSH'+(a.sshport&&22!=a.sshport?"/"+a.sshport:"")+"</a>&nbsp;"),"win32"!=navigator.platform.toLowerCase()||null!=serverinfo.devicemeshrouterlinks&&0==serverinfo.devicemeshrouterlinks.scp||(l+='<a href=# cmenu=sshPortContextMenu onclick=p10MCRouter("'+a._id+'",5,'+(a.sshport||22)+') title="Vereist de installatie van MeshCentral Router.">SCP'+(a.sshport&&22!=a.sshport?"/"+a.sshport:"")+"</a>&nbsp;")),"win32"==navigator.platform.toLowerCase()||"macintel"==navigator.platform.toLowerCase())&&null!=serverinfo.devicemeshrouterlinks&&Array.isArray(serverinfo.devicemeshrouterlinks.extralinks))for(var g in serverinfo.devicemeshrouterlinks.extralinks){var b=serverinfo.devicemeshrouterlinks.extralinks[g],y='"'+b.protocol+'"';doesDeviceMatchFilterTags(a,b.filter)&&("number"==typeof b.protocol?y=b.protocol:"http"==b.protocol?y=1:"https"==b.protocol?y=2:"rdp"==b.protocol?y=3:"ssh"==b.protocol?y=4:"scp"==b.protocol?y=5:"mcrdesktop"==b.protocol?y=6:"mcrfiles"==b.protocol&&(y=7),6!=y&&7!=y||2==a.mtype)&&(l+='<a href=# onclick=p10MCRouter("'+a._id+'",'+y+","+b.port+(b.ip?',"'+b.ip+'"':",null")+","+(b.localport||0)+') title="Vereist de installatie van MeshCentral Router.">'+b.name+"</a>&nbsp;")}0==(1&p)&&3!=a.mtype||!a.agent||0==(8&s)||0!=(536870912&features)||(l+='<a href=# cmenu=rfbPortContextMenu id=rfbLink onclick=p10rfb("'+a._id+'") title="Start een webgebaseerde VNC-sessie op dit apparaat.">Web-VNC</a>&nbsp;'),0==(1&p)&&3!=a.mtype||!a.agent||0==(8&s)||0!=(1073741824&features)||(l+='<a href=# cmenu=altPortContextMenu id=mstscLink onclick=p10mstsc("'+a._id+'") title="Start een webgebaseerde RDP-sessie op dit apparaat.">Web-RDP</a>&nbsp;'),512&features2&&(0!=(1&p)||3==a.mtype)&&a.agent&&0!=(8&s)&&(l+='<a href=# cmenu=sshPortContextMenu id=sshLink onclick=p10ssh("'+a._id+'") title="Start een webgebaseerde SSH-sessie op dit apparaat.">Web-SSH</a>&nbsp;'),4294967295==s&&4194304&features&&(l+='<a href=# onclick=p10showMqttLoginDialog("'+a._id+'") title="Ontvang MQTT-inloggegevens voor dit apparaat.">MQTT Login</a>&nbsp;')}l+="</div><br>",3==a.mtype?(QH("p10html3",""),QH("p10html5",l)):(QH("p10html3",l),QH("p10html5",""));var d=PowerStateStr(a.state),w="",w=(null!=a.agent&&!1===a.agent.root&&(w=', <span title="De agent wordt op een extern apparaat uitgevoerd met beperkte rechten.">Beperkt</span>'),0!=(1&p)&&(0<d.length&&(d+="<br/>"),4==a.mtype?"PDU"==a.porttype?d+='<span style=font-size:12px title="Schakelpoort verbonden">Schakelpoort verbonden</span>'+w:d+='<span style=font-size:12px title="IP-KVM poort verbonden">IP-KVM poort verbonden</span>'+w:d+='<span style=font-size:12px title="Agent verbonden">Agent verbonden</span>'+w),0!=(2&p)?(0<d.length&&(d+="<br/>"),d+='<span style=font-size:12px title="Intel&reg; AMT verbonden">Intel&reg; AMT verbonden</span>'):0!=(4&p)&&(0<d.length&&(d+="<br/>"),d+='<span style=font-size:12px title="Intel&reg; AMT gedetecteerd">Intel&reg; AMT gedetecteerd</span>'),0!=(16&p)&&(0<d.length&&(d+="<br/>"),d+='<span style=font-size:12px title="MQTT verbonden">MQTT-kanaal verbonden</span>'),""==d&&a.lastconnect?d="<span style=font-size:12px>Laatst gezien<br />"+printDateTime(new Date(a.lastconnect))+"</span>":("PDU"==a.porttype||1<a.pwr&&7!=a.pwr)&&(d+="<br/>"+powerStateStrings[a.pwr]),QH("MainComputerState",d),Q("MainComputerImage").setAttribute("src","images/icons256-"+a.icon+"-1.png"),Q("MainComputerImage").className=a.conn&&0!=a.conn||3==a.mtype?"":"gray",3==a.mtype&&null!=a.agent&&4<a.agent.id&&512&features2&&(a.agent.caps=6),f&&setupTerminal(),k&&setupFiles(),0!=(16&s)),p=(w?setupConsole():15==t&&(t=10),QV("MainDevDesktop",r&&(null==a.agent&&null!=a.intelamt&&("number"!=typeof a.intelamt.sku||0!=(8&a.intelamt.sku))||null!=a.agent&&(null==a.agent.caps||0!=(1&a.agent.caps)||a.intelamt&&2==a.intelamt.state)||3==a.mtype&&(3==a.agent.id||4==a.agent.id))&&(8&s||256&s)),QV("MainDevTerminal",(null==a.agent&&null!=a.intelamt||a.agent&&null==a.agent.caps||a.agent&&0!=(2&a.agent.caps)||a.intelamt&&2==a.intelamt.state)&&8&s&&f),QV("MainDevFiles",null!=a.agent&&null!=a.agent.caps&&0!=(4&a.agent.caps)&&8&s&&k),QV("MainDevInfo",a.mtype<3&&0!=(1048576&s)),QV("MainDevAmt",null!=a.intelamt&&(2==a.intelamt.state||2&a.conn)&&8&s&&x),QV("MainDevConsole",w&&null!=a.agent&&null!=a.agent.caps&&0!=(8&a.agent.caps)&&8&s),QV("MainDevPlugins",!1),QV("p15uploadCore",null!=a.agent&&null!=a.agent.caps&&0!=(16&a.agent.caps)),QH("p15coreName",null!=a.agent&&null!=a.agent.core?a.agent.core:""),null!=a.intelamt&&"number"==typeof a.intelamt.sku&&0!=(16&a.intelamt.sku)?(QH("MainDevAmt","Intel&reg;SM"),QH("p14deviceNamePrefix","Intel&reg; SM")):(QH("MainDevAmt","Intel&reg;AMT"),QH("p14deviceNamePrefix","Intel&reg; AMT")),Q("p14iframe").contentWindow.getCurrentMeshNode()),d=(null!=p&&p._id!=currentNode._id&&Q("p14iframe").contentWindow.disconnect(),0!=(6&a.conn));if(Q("p14iframe").contentWindow.setConnectionState(d),Q("p14iframe").contentWindow.setFrameHeight("650px"),Q("p14iframe").contentWindow.setAuthCallback(updateAmtCredentials),powerTimelineNode!=currentNode._id&&powerTimelineReq!=currentNode._id&&(QH("p10html2",""),powerTimelineReq=currentNode._id,meshserver.send({action:"powertimeline",nodeid:currentNode._id}),meshserver.send({action:"lastconnect",nodeid:currentNode._id}),meshserver.send({action:"getsysinfo",nodeid:currentNode._id}),meshserver.send({action:"getnetworkinfo",nodeid:currentNode._id}),meshserver.send({action:"getNotes",id:currentNode._id}),QH("p17info2","")),deviceSharesNode!=currentNode._id&&deviceSharesReq!=currentNode._id&&(deviceSharesReq=currentNode._id,meshserver.send({action:"deviceShares",nodeid:currentNode._id})),QV("DeskTools",!1),showDeskToolsProcesses(),refreshDeviceEvents(),document.title=currentNode&&10<=xxcurrentView&&xxcurrentView<20?currentNode.name+(i?" - "+i.name:"")+" - "+decodeURIComponent("{{{extitle}}}"):decodeURIComponent("{{{extitle}}}"),H&&(p11clearConsoleMsg(),p12clearConsoleMsg(),p13clearConsoleMsg()),null!=pluginHandler&&(QH("p19headers",""),QH("p19pages",""),pluginHandler.callHook("onDeviceRefreshEnd",e,t,n,o),null!=(r=getstore("_curPluginPage",null)))&&null!=Q("p19ph-"+r)&&pluginHandler.callPluginPage(r,Q("p19ph-"+r)),l="",7&s&&(l+='<button class="btn btn-primary btn-sm me-2" onclick="return p20showAddMeshUserDialog(5)" style=cursor:pointer;margin-right:10px><i class="fa-solid fa-circle-plus"></i> Gebruiker toevoegen</button>',null!=usergroups)){var M=0,S=!1;for(g in usergroups)null==usergroups[g].membershipType&&usergroups[g]._id.split("/")[1]==e.split("/")[1]&&(M++,null==currentNode.links||null==currentNode.links[g])&&(S=!0);0<M&&S&&(l+='<a href=# onclick="return p20showAddMeshUserDialog(6)" style=cursor:pointer;margin-right:10px><i class="fa-solid fa-circle-plus"></i> Gebruikersgroep toevoegen</a>')}l+='<table class="table table-hover" border=0 cellpadding=2 cellspacing=0 width=100%><tbody><tr style=background-color:#AAAAAA;font-weight:bold><th scope=col style=text-align:left;width:430px>Gebruikersautorisaties</th><th scope=col style=text-align:left></th></tr>';var C=1;if(null!=currentNode.links){var A=[];for(g in currentNode.links)(g.startsWith("user/")||g.startsWith("ugrp/"))&&A.push(g);for(g in A.sort(),A){var D="",T="",E=A[g],N=currentNode.links[E].rights,I=EscapeHtml(E.split("/")[2]),T=makeUserDeviceRightsString(N),N=!1;null!=currentNode.links[E].name&&(I=EscapeHtml(currentNode.links[E].name)),E==userinfo._id&&(I=EscapeHtml(userinfo.name)),null!=users&&null!=users[E]&&(I=EscapeHtml(users[E].name)),null!=usergroups&&null!=usergroups[E]&&(I=EscapeHtml(usergroups[E].name),N=!0),0!=(2&s)&&(T=N?(D="<a href=# onclick='return p30removeUserFromNode(event,\""+encodeURIComponentEx(E)+'")\' title="Verwijder gebruikers groepsrechten van deze apparaatgroep" style=cursor:pointer><i class="fa-solid fa-trash text-danger hoverButton"></i></a>','<span style=cursor:pointer onclick=p20showAddMeshUserDialog(6,"'+encodeURIComponentEx(E)+'")>'+T+" <img class=hoverButton style=cursor:pointer src=images/link5.png></span>"):(D="<a href=# onclick='return p30removeUserFromNode(event,\""+encodeURIComponentEx(E)+'")\' title="Gebruikersrechten voor deze apparaatgroep verwijderen" style=cursor:pointer><i class="fa-solid fa-trash text-danger hoverButton"></i></a>','<span style=cursor:pointer onclick=p20showAddMeshUserDialog(5,"'+encodeURIComponentEx(E)+'")>'+T+" <img class=hoverButton style=cursor:pointer src=images/link5.png></span>")),l+="<tr "+(++C%2==0?"style=background-color:#DDD":"")+'><td style=width:30%><div title="'+(N?"Gebruikers Groep":"Gebruiker")+'" class=m'+(N?4:2)+"></div><div>&nbsp;"+(I=null!=users?N?"<a href=# onclick='gotoUserGroup(\""+encodeURIComponentEx(E)+"\");haltEvent(event);'>"+I+"</a>":"<a href=# onclick='gotoUser(\""+encodeURIComponentEx(E)+"\");haltEvent(event);'>"+I+"</a>":I)+"<div></div></div></td><td style=width:70%><div style=float:right>"+D+"</div><div>"+T+"</div></td></tr>"}}if(1==C&&(l+="<tr><td><div style=padding:6px>&nbsp;<i>Geen gebruikers met speciale apparaatrechten</i><div></div></div></td><td></td></tr>"),l+="</tbody></table>",null!=deviceShares&&deviceSharesNode==currentNode._id&&0<deviceShares.length){l+='<br /><table class="table table-hover" border=0 cellpadding=2 cellspacing=0 width=100%><tbody><tr style=background-color:#AAAAAA;font-weight:bold><th scope=col style=text-align:left;width:430px>Actief delen van apparaten</th><th scope=col style=text-align:left></th></tr>';for(C=1,g=0;g<deviceShares.length;g++){var _=deviceShares[g],D="",V=(null!=_.url&&(D+='<a href="'+_.url+'" rel="noreferrer noopener" target=_blank title="Apparaat deel Link" style=cursor:pointer><img src=images/link2.png border=0 height=10 width=10></a> '),D+="<i role=button onclick='return p30removeDeviceSharing(event,\""+encodeURIComponentEx(currentNode._id)+'","'+encodeURIComponentEx(_.publicid)+'","'+encodeURIComponentEx(_.guestName)+'")\' title="Apparaat deling verwijderen" class="fa-fw fa-solid fa-trash text-danger"></i>',""),U=(_.p<=7?V=["","Terminal","Bureaublad","Desktop + Terminal","Bestanden","Terminal + Bestanden","Desktop + Bestanden","Desktop + Terminal + Bestanden"][_.p]:8==_.p?V="HTTP/"+_.port:16==_.p&&(V="HTTPS/"+_.port),V),V=(null!=_.startTime&&null!=_.expireTime&&(U=format("{0}, {1} tot {2}",V,printFlexDateTime(new Date(_.startTime)),printFlexDateTime(new Date(_.expireTime)))),null!=_.startTime&&null!=_.duration&&(U=_.duration<2?format("{0}, {1} voor {2} minuut",V,printFlexDateTime(new Date(_.startTime)),_.duration):format("{0}, {1} voor {2} minuten",V,printFlexDateTime(new Date(_.startTime)),_.duration)),1==_.recurring&&(U+=", Dagelijks terugkerend"),2==_.recurring&&(U+=", Wekelijks terugkerend"),0!=(2&_.p)&&!0===_.viewOnly&&(U+=", Desktop alleen bekijken"),null!=_.consent&&(0==_.consent?U+=", Geen toestemming":(0!=(56&_.consent)&&(U+=", vraag om toestemming"),0!=(64&_.consent)&&(U+=", Werkbalk"))),EscapeHtml(_.guestName));l+="<tr "+(++C%2==0?"style=background-color:#DDD":"")+"><td style=width:30%><div class=m2></div><div>&nbsp;"+(V=_.publicid.startsWith("AS:node/")?"<i>Agent zelfdelend</i>":V)+"<div></div></div></td><td style=width:70%><div style=float:right>"+D+"</div><div>"+U+"</div></td></tr>"}l+="</tbody></table>"}QH("p10html4",l);var B="";if(0==(268435456&features)&&10<=xxcurrentView&&xxcurrentView<=19&&null!=currentNode){for(var g in B="?viewmode="+xxcurrentView+"&gotonode="+currentNode._id.split("/")[2],urlargs)B+="&"+g+"="+urlargs[g];try{window.history.replaceState({},document.title,window.location.pathname+B)}catch(e){}}QV("p11DeskSessionSelector",!1),QH("p11DeskSessionSelector","")}setupDesktop(),go(t=t||10)}}else safeNewWindow(window.location.origin+"?node="+e.split("/")[2]+"&viewmode=10&hide=16"+(urlargs.key?"&key="+urlargs.key:""),"meshcentral:"+e)}function setIpPduState(e){0==e?(setModalContent("xxAddAgent","Power Operation","Perform power off?"),showModal("xxAddAgentModal","idx_dlgOkButton",function(){meshserver.send({action:"poweraction",nodeids:[currentNode._id],actiontype:2})})):(setModalContent("xxAddAgent","Power Operation","Perform power on?"),showModal("xxAddAgentModal","idx_dlgOkButton",function(){meshserver.send({action:"wakedevices",nodeids:[currentNode._id]})}))}function p20editDeviceNotify(){var e,t,n;return xxdialogMode||(e=0,t=16384&features2&&userinfo.emailVerified?1:0,userinfo.notify&&userinfo.notify[currentNode._id]&&(e=userinfo.notify[currentNode._id]),n='<div style="border-bottom: 1px solid #888;margin-bottom:3px">Webpagina meldingen</div><div><label><input id=p20notifyIntelDeviceConnect type=checkbox class="form-check-input me-2" />Apparaat verbonden</label></div><div><label><input id=p20notifyIntelDeviceDisconnect type=checkbox class="form-check-input me-2" />Apparaatverbinding verbroken</label></div>',null!=currentNode.intelamt&&(t+=2,n+='<div><label><input id=p20notifyIntelAmtKvmActions type=checkbox class="form-check-input me-2" />Intel&reg; AMT desktop- en seriële gebeurtenissen</label></div>'),1&t&&(n+='<br /><div style="border-bottom: 1px solid #888;margin-bottom:3px">Email meldingen</div><div><label><input id=p20enotifyIntelDeviceConnect type=checkbox class="form-check-input me-2" />Apparaat verbonden</label></div><div><label><input id=p20enotifyIntelDeviceDisconnect type=checkbox class="form-check-input me-2" />Apparaatverbinding verbroken</label></div><div><label><input id=p20enotifyIntelDeviceHelp type=checkbox class="form-check-input me-2" />Hulpverzoeken</label></div>'),null!=userinfo.msghandle&&0!=(33554432&features2)&&(n+='<br /><div style="border-bottom: 1px solid #888;margin-bottom:3px">Berichten notificaties</div><div><label><input id=p20emsgDeviceConnect type=checkbox class="form-check-input me-2" />Apparaat verbonden</label></div><div><label><input id=p20emsgDeviceDisconnect type=checkbox class="form-check-input me-2" />Apparaatverbinding verbroken</label></div><div><label><input id=p20emsgDeviceHelp type=checkbox class="form-check-input me-2" />Hulpverzoeken</label></div>'),setModalContent("xxAddAgent","Meldingsinstellingen",n),showModal("xxAddAgentModal","idx_dlgOkButton",()=>p20editDeviceNotifyEx(3,t)),Q("p20notifyIntelDeviceConnect").checked=2&e,Q("p20notifyIntelDeviceDisconnect").checked=4&e,2&t&&(Q("p20notifyIntelAmtKvmActions").checked=8&e),1&t&&(Q("p20enotifyIntelDeviceConnect").checked=16&e,Q("p20enotifyIntelDeviceDisconnect").checked=32&e,Q("p20enotifyIntelDeviceHelp").checked=64&e),null!=userinfo.msghandle&&0!=(33554432&features2)&&(Q("p20emsgDeviceConnect").checked=128&e,Q("p20emsgDeviceDisconnect").checked=256&e,Q("p20emsgDeviceHelp").checked=512&e)),!1}function p20editDeviceNotifyEx(e,t){var n=0,n=(n+=Q("p20notifyIntelDeviceConnect").checked?2:0)+(Q("p20notifyIntelDeviceDisconnect").checked?4:0);2&t&&(n+=Q("p20notifyIntelAmtKvmActions").checked?8:0),1&t&&(n=(n=(n+=Q("p20enotifyIntelDeviceConnect").checked?16:0)+(Q("p20enotifyIntelDeviceDisconnect").checked?32:0))+(Q("p20enotifyIntelDeviceHelp").checked?64:0)),null!=userinfo.msghandle&&0!=(33554432&features2)&&(n=(n=(n+=Q("p20emsgDeviceConnect").checked?128:0)+(Q("p20emsgDeviceDisconnect").checked?256:0))+(Q("p20emsgDeviceHelp").checked?512:0)),meshserver.send({action:"changeusernotify",nodeid:currentNode._id,notify:n})}function makeUserDeviceRightsString(e){var t,n;return 57592==e?"Volledige apparaatrechten":(t=[],8&e&&(n=[],256&e&&n.push("Geen input"),512&e&&n.push("Geen terminal"),1024&e&&n.push("Geen bestanden"),2048&e&&n.push("Geen AMT"),4096&e&&n.push("Beperkte invoer"),65536&e&&n.push("Geen bureaublad"),524288&e&&!1!==serverinfo.guestdevicesharing&&n.push("Gast delen"),t.push(0<n.length?"Control ("+n.join(", ")+")":"Controle")),16&e&&t.push("Console"),32&e&&t.push("Serverbestanden"),64&e&&t.push("Wekken"),128&e&&t.push("Notities"),8192&e&&t.push("Beperk gebeurtenissen"),16384&e&&t.push("Chat"),32768&e&&t.push("Deïnstallatie"),131072&e&&t.push("Opdrachten"),262144&e&&t.push("Reset/Uit"),524288&e&&t.push("Delen"),1048576&e&&t.push("Details"),2097152&e&&t.push("Relay"),0==t.length?"Geen rechten":t.join(", "))}function makeDeviceGroupRightsString(e){var t,n;return 4294967295==e?"Volledige rechten":(t=[],1&e&&t.push("Bewerk groep"),2&e&&t.push("Beheer gebruikers"),4&e&&t.push("Beheer apparaten"),8&e&&(n=[],256&e&&n.push("Geen input"),512&e&&n.push("Geen terminal"),1024&e&&n.push("Geen bestanden"),2048&e&&n.push("Geen AMT"),4096&e&&n.push("Beperkte invoer"),65536&e&&n.push("Geen bureaublad"),524288&e&&!1!==serverinfo.guestdevicesharing&&n.push("Gast delen"),t.push(0<n.length?"Control ("+n.join(", ")+")":"Controle")),16&e&&t.push("Console"),32&e&&t.push("Serverbestanden"),64&e&&t.push("Wekken"),128&e&&t.push("Notities"),8192&e&&t.push("Beperk gebeurtenissen"),16384&e&&t.push("Chat"),32768&e&&t.push("Deïnstallatie"),131072&e&&t.push("Opdrachten"),262144&e&&t.push("Reset/Uit"),524288&e&&t.push("Delen"),1048576&e&&t.push("Details"),2097152&e&&t.push("Relay"),0==t.length?"Geen rechten":t.join(", "))}function runDeviceCmd(e){xxdialogMode||d2runCommandDialog({nodeids:[e?decodeURIComponent(e):currentNode._id]})}function writeDeviceEvent(e){xxdialogMode||(setModalContent("xxAddAgent","Apparaatgebeurtenis toevoegen","<textarea id=d2devEvent style=width:100%;height:200px;resize:none;overflow-y:scroll></textarea><span style=font-size:10px>Hiermee wordt een vermelding toegevoegd aan het gebeurtenislogboek van dit apparaat.<span>"),showModal("xxAddAgentModal","idx_dlgOkButton",function(){writeDeviceEventEx(3,e)}),Q("d2devEvent").focus())}function writeDeviceEventEx(e,t){meshserver.send({action:"setDeviceEvent",nodeid:decodeURIComponent(t),msg:encodeURIComponentEx(Q("d2devEvent").value)})}function showNotes(e,t){xxdialogMode||(e="<textarea id=d2devNotes ro="+e+" noteid="+(t=null==t?encodeURIComponentEx("p"+userinfo._id):t)+' readonly class="form-control" style=width:100%;height:200px;resize:none;overflow-y:scroll></textarea>',t.startsWith("node%2F%2F")&&(e+="<span style=font-size:10px>Apparaatgroepnotities kunnen worden bekeken en gewijzigd door andere apparaatgroepbeheerders.<span>"),"true"===showNotesPanel&&(e+=" <span style=font-size:10px><a target=_blank href='https://www.markdownguide.org/cheat-sheet/'>Markdown syntax supported</a></span>"),setModalContent("xxAddAgent","Notities",e),showModal("xxAddAgentModal","idx_dlgOkButton",function(){showNotesEx(2,t)}),meshserver.send({action:"getNotes",id:decodeURIComponent(t)}))}function showNotesEx(e,t){Q("notesPanelArea").innerHTML=marked&&DOMPurify?DOMPurify.sanitize(marked.parse(Q("d2devNotes").value,{breaks:!0}),{USE_PROFILES:{html:!0}}):Q("d2devNotes").value,meshserver.send({action:"setNotes",id:decodeURIComponent(t),notes:encodeURIComponentEx(Q("d2devNotes").value)}),"true"===showNotesPanel&&""!=Q("d2devNotes").value?QV("notesPanel",!0):QV("notesPanel",!1)}function openIpKvmRemoteControl(e){xxdialogMode||safeNewWindow("/ipkvm.ashx/"+(e=decodeURIComponent(e).split("/")[2])+"/","ipkvm:"+e)}function deviceChat(e){var t;xxdialogMode||(t="/messenger?id=meshmessenger/"+encodeURIComponentEx(currentNode._id)+"/"+encodeURIComponentEx(userinfo._id)+"&title="+currentNode.name,""!=serverinfo.domainsuffix&&(t="/"+serverinfo.domainsuffix+t),null!=authCookie&&""!=authCookie&&(t+="&auth="+authCookie),1==currentNode.pmt&&0!=(2&features2)&&(t+="&pmt=1"),e&&1==e.shiftKey?safeNewWindow(t,"meshmessenger:"+currentNode._id):safeNewWindow(t,"meshmessenger:"+currentNode._id,"directories=no,titlebar=no,toolbar=no,location=no,status=no,menubar=no,scrollbars=no,resizable=no,width=400,height=560"),meshserver.send({action:"meshmessenger",nodeid:decodeURIComponent(currentNode._id)}))}function altDeviceChat(e,t){var n,o,a,i,s,r;xxdialogMode||(n=serverinfo.altmessenging[t].url.split("{0}").join(currentNode._id.split("/")[2]).split("{1}").join(currentNode._id.split("/")[2]).split("{2}").join(currentNode._id.split("/")[2]).split("{3}").join(currentNode._id.split("/")[2]),i=o=encodeURIComponentEx(userinfo._id.split("/")[2]),s=a=encodeURIComponentEx(userinfo._id.split("/").join("-")),null!=userinfo.realname&&(i=encodeURIComponentEx(userinfo.realname.split(" ").join("")),s=encodeURIComponentEx(userinfo.realname.split(" ").join("-"))),r=n=n.split("{4}").join(o).split("{5}").join(a).split("{6}").join(i).split("{7}").join(s),"string"==typeof serverinfo.altmessenging[t].localurl&&(r=(r=serverinfo.altmessenging[t].localurl.split("{0}").join(currentNode._id.split("/")[2]).split("{1}").join(currentNode._id.split("/")[2]).split("{2}").join(currentNode._id.split("/")[2]).split("{3}").join(currentNode._id.split("/")[2])).split("{4}").join(o).split("{5}").join(a).split("{6}").join(i).split("{7}").join(s)),""!=n&&meshserver.send({action:"msg",type:"openUrl",nodeid:currentNode._id,url:n}),""!=r&&safeNewWindow(r,"altmessenger:"+currentNode._id,"directories=no,titlebar=no,toolbar=no,location=no,status=no,menubar=no,scrollbars=no,resizable=no,width=400,height=560"))}function deviceToggleBackground(){xxdialogMode||meshserver.send({action:"msg",type:"deskBackground",nodeid:currentNode._id,op:1})}function deviceUrlFunction(){xxdialogMode||(xxdialogButtons=3,setModalContent("xxAddAgent","Open pagina op apparaat",'<input id=d2devurl placeholder="http://server.com" style=width:100%;overflow-y:scroll onkeyup=deviceUrlFunctionValidate() onchange=deviceUrlFunctionValidate()></input>'),showModal("xxAddAgentModal","idx_dlgOkButton",deviceUrlFunctionEx),Q("d2devurl").focus(),deviceUrlFunctionValidate())}function deviceUrlFunctionValidate(){var e=Q("d2devurl").value.toLowerCase();QE("idx_dlgOkButton",e.startsWith("http://")&&7<e.length||e.startsWith("https://")&&8<e.length)}function deviceUrlFunctionEx(){meshserver.send({action:"msg",type:"openUrl",nodeid:currentNode._id,url:Q("d2devurl").value})}function deviceMessageFunction(){xxdialogMode||(xxdialogButtons=3,setModalContent("xxAddAgent","Apparaatbericht","<div style=margin-bottom:4px>Geef een berichtvenster weer op het externe apparaat.</div><textarea id=d2devMessage style=width:100%;height:80px;resize:none;overflow-y:scroll;box-sizing:border-box;margin-bottom:4px></textarea><select style=width:100% id=d2devTimeout><option value=2 selected>Toon gedurende 2 Minuten (Standaard)</option><option value=10>Toon gedurende 10 minuten</option><option value=30>Toon gedurende 30 Minuten</option><option value=60>Toon gedurende 60 minuten</option><option value=0>Toon bericht totdat het door de gebruiker wordt afgewezen</option></select>"),showModal("xxAddAgentModal","idx_dlgOkButton",deviceMessageFunctionEx),Q("d2devMessage").focus())}function deviceMessageFunctionEx(){var e=decodeURIComponent("{{{extitle}}}"),t=parseFloat(Q("d2devTimeout").value);""==e&&(e="MeshCentral"),isNaN(t)&&(t=2),1==currentNode.pmt?meshserver.send({action:"pushmessage",nodeid:currentNode._id,title:e,msg:Q("d2devMessage").value}):meshserver.send({action:"msg",type:"messagebox",nodeid:currentNode._id,title:e,msg:Q("d2devMessage").value,timeout:6e4*t})}function deskClipboardInFunction(){var e;null!=desktop&&3==desktop.State&&(desktop.m.getClipboard?null!=(e=desktop.m.getClipboard())&&null!=navigator.clipboard&&navigator.clipboard.writeText(e).then(function(){}).catch(function(e){console.log(e)}):meshserver.send({action:"msg",type:"getclip",nodeid:currentNode._id,tag:2}))}function deskInputLockFunction(e){xxdialogMode||null==desktop||3!=desktop.State||(setModalContent("xxAddAgent","Externe invoer vergrendeling",1==e?"Muis en toetsenbord van externe gebruiker vergrendelen?":"De muis en het toetsenbord van de externe gebruiker ontgrendelen?"),showModal("xxAddAgentModal","idx_dlgOkButton",function(){try{desktop.m.SendRemoteInputLock(e)}catch(e){}}))}function deskClipboardOutFunction(){if(null!=navigator.clipboard&&null!=navigator.clipboard.readText)try{navigator.clipboard.readText().then(function(e){desktop.m.setClipboard?desktop.m.setClipboard(e):meshserver.send({action:"msg",type:"setclip",nodeid:currentNode._id,data:e})}).catch(function(e){console.log(e)})}catch(e){console.log(e)}return!0}function deskRefreshFunction(){null!=desktop&&3==desktop.State&&desktop.m.SendRefresh()}function deviceToastFunction(){xxdialogMode||(xxdialogButtons=3,setModalContent("xxAddAgent","Apparaatmelding",'<select id=d2deviceop style=width:100%;margin-bottom:4px class=form-select><option value=2>Toast melding</option><option value=1>Berichten box</option><option value=3>Alert Box</option></select><input id=dp2notifyTitle maxlength=256 placeholder="Titel" style=width:100%;box-sizing:border-box;margin-bottom:4px class=form-control/><textarea id=d2notifyMsg style=background-color:#fcf3cf;width:100%;height:140px;resize:none;overflow-y:scroll;box-sizing:border-box;margin-bottom:4px class=form-control></textarea><select style=width:100% id=d2notifyTimeout class=form-select><option disabled value="">Only Applicable to Message Box Notifications</option><option value=2 selected>Toon gedurende 2 Minuten (Standaard)</option><option value=10>Toon gedurende 10 minuten</option><option value=30>Toon gedurende 30 Minuten</option><option value=60>Toon gedurende 60 minuten</option><option value=0>Toon bericht totdat het door de gebruiker wordt afgewezen</option></select>'),showModal("xxAddAgentModal","idx_dlgOkButton",deviceToastFunctionEx),Q("d2notifyMsg").focus())}function deviceToastFunctionEx(){var e=Q("d2deviceop").value,t=Q("dp2notifyTitle").value,n=Q("d2notifyMsg").value,o=parseFloat(Q("d2notifyTimeout").value);0!=n.length&&(""==(t=""==t?decodeURIComponent("{{{extitle}}}"):t)&&(t="MeshCentral"),isNaN(o)&&(o=2),1==e?meshserver.send({action:"msg",type:"messagebox",nodeid:currentNode._id,title:t,msg:n,timeout:6e4*o}):2==e?meshserver.send({action:"toast",nodeids:[currentNode._id],title:t,msg:n}):3==e&&meshserver.send({action:"msg",type:"alertbox",nodeid:currentNode._id,title:t,msg:n}))}function deviceLockFunction(){null==xxdialogMode&&null!=desktop&&1==desktop.contype&&(setModalContent("xxAddAgent","Vergrendel het bureaublad","Bureaublad van gebruiker vergrendelen?"),showModal("xxAddAgentModal","idx_dlgOkButton",function(){null!=desktop&&1==desktop.contype&&desktop.sendCtrlMsg('{"ctrlChannel":"102938","type":"lock"}')}))}function showShareDevice(){if(!xxdialogMode){var e,t=GetNodeRights(currentNode),n="",o="Creëert een link waarmee een gast zonder account dit apparaat voor een beperkte tijd op afstand kan bedienen.<br /><br />",a=(o+=addHtmlFormFloating("Gast naam",'<input id=d2inviteName class="form-control" maxlength=128 type=text onkeyup=showShareDeviceValidate() />'),"<option value=2>Bureaublad</option>"),i=(4294967295!=t&&0!=(256&t)&&(a=""),"<option value=1>Terminal</option>"),s=(4294967295!=t&&0!=(512&t)&&(i=""),"<option value=4>Bestanden</option>"),r=(4294967295!=t&&0!=(1024&t)&&(s=""),"<option value=5>Desktop + Bestanden</option>"),l=(4294967295!=t&&0!=(1280&t)&&(r=""),"<option value=6>Terminal + Bestanden</option>"),d=(4294967295!=t&&0!=(1536&t)&&(l=""),"<option value=7>Desktop + Terminal + Bestanden</option>"),c=(4294967295!=t&&0!=(1792&t)&&(d=""),""),n=(0!=webRelayPort&&(c="<option value=8>HTTP</option><option value=9>HTTPS</option>",4294967295!=t)&&0!=(8&t)&&(c=""),""),u="",p=(1==(1&currentNode.agent.caps)&&(n+=a+"<option value=3>Desktop, Alleen kijken</option>"),2==(2&currentNode.agent.caps)&&(n+=i),4==(4&currentNode.agent.caps)&&(n+=s),5==(5&currentNode.agent.caps)&&(n+=r),6==(6&currentNode.agent.caps)&&(n+=l),7==(7&currentNode.agent.caps)&&(n+=d),o+=addHtmlFormFloating("Type",'<select id=d2shareType class="form-select" onchange=showShareDeviceValidate()>'+(n+=c)+"</select>"),{1:"1 minuut",5:"5 minuten",10:"10 minuten",15:"15 minuten",30:"30 minuten",45:"45 minuten",60:"60 minuten",120:"2 uur",240:"4 uur",480:"8 uur",720:"12 uur",960:"16 uur",1440:"24 uur",2880:"2 dagen",5760:"4 dagen",0:"Ongelimiteerd"});for(e in n="",p)(null==serverinfo.guestdevicesharingmaxtime||0<e&&e<=serverinfo.guestdevicesharingmaxtime)&&(n+="<option value="+e+">"+p[e]+"</option>"),0<e&&e<=720&&(null==serverinfo.guestdevicesharingmaxtime||0<e&&e<=serverinfo.guestdevicesharingmaxtime)&&(u+="<option value="+e+">"+p[e]+"</option>");o=(o=(o=(o=(o=o+addHtmlFormFloating("Geldigheid",'<select id=d2timeRange class="form-select" onchange=showShareDeviceValidate()><option value=0>vanaf nu</option><option value=1>Tijdsbestek</option><option value=2>Dagelijks terugkerend</option><option value=3>Wekelijks terugkerend</option></select>')+"<div id=d2modenow>")+addHtmlFormFloating("Verval datum",'<select id=d2inviteExpire class="form-select">'+n+"</select>")+"</div><div id=d2moderange style=display:none>")+addHtmlFormFloating("Tijdsbestek",'<input id=d2timeRangeSelector class="flatpickr form-select" type="text" placeholder="Selecteer datum & Tijd..." data-id="altinput">')+"</div><div id=d2moderecurring style=display:none>")+addHtmlFormFloating("Start tijd",'<input id=d2timeStartSelector class="flatpickr form-select" type="text" placeholder="Selecteer datum & Tijd..." data-id="altinput">'))+addHtmlFormFloating("Looptijd",'<select id=d2inviteDuration class="form-select">'+u+"</select>")+"</div>",1&currentNode.agent.caps&&(o+="<div id=d2userConsentSelector>"+addHtmlFormFloating("Toestemming van gebruiker",'<select id=d2userConsent class="form-select"><option value=0>Alleen informeren<option value=1>Toestemming vragen</option><option value=2>Geen toestemming</option></select>')+"</div>"),o=(o+="<div id=d2httpPortSelector>"+addHtmlFormFloating("Poort",'<input id=d2httpPort class="form-control" value=80 onkeyup=showShareDeviceValidate()></input>')+"</div>")+("<div id=d2httpsPortSelector>"+addHtmlFormFloating("Poort",'<input id=d2httpsPort class="form-control" value=443 onkeyup=showShareDeviceValidate()></input>')+"</div>"),xxdialogButtons=3,setModalContent("xxAddAgent","Deel apparaat",o),showModal("xxAddAgentModal","idx_dlgOkButton",showShareDeviceEx),showShareDeviceValidate();t=new Date,a=(t.setDate(t.getDate()+1),flatpickr("#d2timeRangeSelector",{mode:"range",enableTime:!0,minDate:new Date,defaultDate:[new Date,t],minuteIncrement:1})),i=flatpickr("#d2timeStartSelector",{enableTime:!0,minDate:new Date,defaultDate:new Date,minuteIncrement:1});xxdialogTag={range:a,start:i}}}function showShareDeviceValidate(){1&currentNode.agent.caps&&QV("d2userConsentSelector",Q("d2shareType").value<8),QV("d2httpPortSelector",8==Q("d2shareType").value),QV("d2httpsPortSelector",9==Q("d2shareType").value),QV("d2modenow",0==Q("d2timeRange").value),QV("d2moderange",1==Q("d2timeRange").value),QV("d2moderecurring",2<=Q("d2timeRange").value);var e,t=!0;8==Q("d2shareType").value&&(e=parseInt(Q("d2httpPort").value),Q("d2httpPort").value!=e||e<1||65535<e)&&(t=!1),9==Q("d2shareType").value&&(e=parseInt(Q("d2httpsPort").value),Q("d2httpsPort").value!=e||e<1||65535<e)&&(t=!1),0==Q("d2inviteName").value.trim().length&&(t=!1),QE("idx_dlgOkButton",t)}function showShareDeviceEx(e,t){var n=0,o=parseInt(Q("d2shareType").value),a=!1;8==o?meshserver.send({action:"createDeviceShareLink",nodeid:currentNode._id,guestname:Q("d2inviteName").value.trim(),p:8,expire:parseInt(Q("d2inviteExpire").value),port:parseInt(Q("d2httpPort").value),consent:0}):9==o?meshserver.send({action:"createDeviceShareLink",nodeid:currentNode._id,guestname:Q("d2inviteName").value.trim(),p:16,expire:parseInt(Q("d2inviteExpire").value),port:parseInt(Q("d2httpsPort").value),consent:0}):(3==o&&(a=!0),1&(o=[0,1,2,2,4,6,5,7][o])&&(n|=2,1&currentNode.agent.caps&&1==Q("d2userConsent").value&&(n|=16),1&currentNode.agent.caps)&&2==Q("d2userConsent").value&&(n=0),2&o&&(n|=65,1&currentNode.agent.caps&&1==Q("d2userConsent").value&&(n|=8),1&currentNode.agent.caps)&&2==Q("d2userConsent").value&&(n=0),4&o&&(n|=4,1&currentNode.agent.caps&&1==Q("d2userConsent").value&&(n|=32),1&currentNode.agent.caps)&&2==Q("d2userConsent").value&&(n=0),0==Q("d2timeRange").value?meshserver.send({action:"createDeviceShareLink",nodeid:currentNode._id,guestname:Q("d2inviteName").value.trim(),p:o,expire:parseInt(Q("d2inviteExpire").value),consent:n,viewOnly:a}):1==Q("d2timeRange").value?meshserver.send({action:"createDeviceShareLink",nodeid:currentNode._id,guestname:Q("d2inviteName").value.trim(),p:o,start:Math.floor(t.range.selectedDates[0].getTime()/1e3),end:Math.floor(t.range.selectedDates[1].getTime()/1e3),consent:n,viewOnly:a}):meshserver.send({action:"createDeviceShareLink",nodeid:currentNode._id,guestname:Q("d2inviteName").value.trim(),p:o,start:Math.floor(t.start.selectedDates[0].getTime()/1e3),expire:parseInt(Q("d2inviteDuration").value),recurring:Q("d2timeRange").value-1,consent:n,viewOnly:a}))}function deviceActionFunction(){var e,t,n,o,a;xxdialogMode||(e=GetNodeRights(currentNode),t=0,n="Selecteer een bewerking die u op dit apparaat wilt uitvoeren.<br /><br />",o="<select id=d2deviceop onchange=deviceActionFunctionValidate() class=form-select>",a="",null!=currentNode.agent&&14==currentNode.agent.id?0!=(1&currentNode.conn)&&0!=(8&e)&&(t++,o+="<option value=400>Flits</option><option value=401>Trillen</option>",a+="<div id=d2devicetimediv>"+addHtmlFormFloating("Tijd","<select id=d2devicetime class=form-select><option value=1000>1 seconde</option><option value=5000>5 seconden</option><option value=10000>10 seconden</option></select>")+"</div>"):(0!=(64&e)&&(t++,o+="<option value=100>Wakker worden</option>"),0!=(1&currentNode.conn)&&0!=(131072&e)&&(t++,o+="<option value=106>Voer opdrachten uit</option>"),0!=currentNode.conn&&0!=(262144&e)&&(t++,o+="<option value=4>Slaapstand</option><option value=3>Herstarten</option><option value=2>Uitzetten</option>"),0!=(16&currentNode.conn)&&(t++,o+="<option value=103>Verzend MQTT bericht</option>"),null!=currentNode.intelamt&&2==currentNode.intelamt.state&&0!=(6&currentNode.conn)&&0!=(262144&e)&&(t++,o+="<option value=310>Intel&reg; AMT Reset</option><option value=308>Intel&reg; AMT Afsluiten</option>",11!=xxcurrentView&&12!=xxcurrentView||(o+="<option value=312>Intel&reg; AMT reset naar de BIOS</option><option value=311>Intel&reg; AMT opstarten naar de BIOS</option><option value=315>Intel&reg; AMT inschakelen op PXE</option><option value=316>Intel&reg; AMT resetten naar PXE</option>")),null!=currentNode.intelamt&&2==currentNode.intelamt.state&&0!=(6&currentNode.conn)&&0!=(64&e)&&(t++,o+="<option value=302>Intel&reg; AMT Opstarten</option>"),(11==xxcurrentView||12==xxcurrentView)&&15<=getNodeAmtVersion(currentNode)&&2==currentNode.intelamt.state&&0!=(6&currentNode.conn)&&4294967295==e&&0==(1024&features)&&(t++,o+="<option value=107>Intel&reg; AMT herstel met één klik</option>"),0!=(1&currentNode.conn)&&0!=(32768&e)&&(t++,o+="<option value=104>Deïnstallatie agent</option>")),n+=addHtmlFormFloating("Operatie",o+="</select>"),xxdialogButtons=0==t?2:3,xxdialogTag=(n=0==t?"Er zijn momenteel geen acties beschikbaar voor dit apparaat.":n)+a,setModalContent("xxAddAgent","Apparaatactie",n),showModal("xxAddAgentModal","idx_dlgOkButton",deviceActionFunctionEx),0<t&&deviceActionFunctionValidate())}function deviceActionFunctionValidate(){var e=Q("d2deviceop").value;try{QV("d2devicetimediv",400==e||401==e)}catch(e){}}function deviceActionFunctionEx(){var e=Q("d2deviceop").value;if(100==e)return meshserver.send({action:"wakedevices",nodeids:[currentNode._id]}),!0;if(103==e)p10showSendMqttMsgDialog([currentNode._id]);else if(104==e)p10showSendUninstallAgentDialog([currentNode._id]);else if(106==e){var t,n=!1,o=!1;currentNode.agent&&(0<currentNode.agent.id&&currentNode.agent.id<5?n=!0:o=!0),1!=n&&1!=o||(t="Voer opdrachten uit op geselecteerde apparaten.<br />",1==n&&(t+="<select id=d2cmdtype style=width:100%;margin-bottom:4px;margin-top:4px><option value=1>Windows opdrachtprompt</option><option value=2>Windows PowerShell</option>",1==o&&(t+="<option value=3>Linux/BSD/macOS Command Shell</option>"),t+="</select>"),setModalContent("xxAddAgent","Voer opdrachten uit",t=t+"<select id=d2cmduser style=width:100%;margin-bottom:4px><option value=0>Uitvoeren als agent</option><option value=1>Uitvoeren als gebruiker, agent als er geen gebruiker is</option><option value=2>Moet als gebruiker worden uitgevoerd</option></select>"+"<textarea id=d2runcmd style=width:100%;height:200px;resize:none;overflow-y:scroll></textarea>"),showModal("xxAddAgentModal","idx_dlgOkButton",()=>deviceRunCmdsFunctionEx()),Q("d2runcmd").focus())}else if(107==e)Q("d3localmodeform").action="oneclickrecovery.ashx",Q("d3auth").value=authCookie,Q("d3filter").value=".efi",Q("d3attrib").value=currentNode._id,setModalContent("xxAddAgent","Intel&reg; AMT herstel met één klik",t),showModal("xxAddAgentModal","idx_dlgOkButton",()=>deviceActionOneClickRecovery()),d3init();else if(302==e)setModalContent("xxAddAgent","Intel&reg; AMT in werking","Uitvoeren Intel&reg; AMT inschakelen?"),showModal("xxAddAgentModal","idx_dlgOkButton",function(){meshserver.send({action:"poweraction",nodeids:[currentNode._id],actiontype:parseInt(e)})});else if(308==e)setModalContent("xxAddAgent","Intel&reg; AMT in werking","Voer Intel&reg; AMT uit?<br><br><b>LET OP: Als er een actieve AMT-sessie is, wordt het uitschakelcommando afgewezen, dus u moet eerst de verbinding met de AMT-sessie verbreken!</b>"),showModal("xxAddAgentModal","idx_dlgOkButton",function(){meshserver.send({action:"poweraction",nodeids:[currentNode._id],actiontype:parseInt(e)})});else if(310==e)setModalContent("xxAddAgent","Intel&reg; AMT in werking","Uitvoeren Intel&reg; AMT reset?"),showModal("xxAddAgentModal","idx_dlgOkButton",function(){meshserver.send({action:"poweraction",nodeids:[currentNode._id],actiontype:parseInt(e)})});else{if(311==e)setModalContent("xxAddAgent","Intel&reg; AMT in werking","Perform Intel&reg; AMT opstarten naar de BIOS?");else{if(312!=e)return 400==e||401==e?meshserver.send({action:"poweraction",nodeids:[currentNode._id],actiontype:parseInt(e),time:parseInt(Q("d2devicetime").value)}):meshserver.send({action:"poweraction",nodeids:[currentNode._id],actiontype:parseInt(e)}),!0;setModalContent("xxAddAgent","Intel&reg; AMT in werking","Perform Intel&reg; AMT resetten naar de BIOS?")}showModal("xxAddAgentModal","idx_dlgOkButton",function(){meshserver.send({action:"poweraction",nodeids:[currentNode._id],actiontype:parseInt(e)+(12==xxcurrentView?2:0)})})}return!1}function deviceActionOneClickRecovery(){var e;1==Q("d3uploadMode").value?Q("d3submit").click():1==(e=d3getFileSel()).length&&meshserver.send({action:"oneclickrecovery",nodeids:[Q("d3attrib").value],type:"diskimage",path:d3filetreelocation.join("/")+"/"+e[0]})}function deviceRunCmdsFunctionEx(){var e=3;try{e=parseInt(Q("d2cmdtype").value)}catch(e){}meshserver.send({action:"runcommands",nodeids:[currentNode._id],type:e,cmds:Q("d2runcmd").value,runAsUser:parseInt(Q("d2cmduser").value)})}function updateAmtCredentials(e){var t=getNodeFromId(currentNode._id);1==e||null==t.intelamt.user||""==t.intelamt.user?editDeviceAmtSettings(currentNode._id,updateAmtCredentialsEx):Q("p14iframe").contentWindow.connectButtonfunctionEx()}function updateAmtCredentialsEx(e,t){Q("p14iframe").contentWindow.connectButtonfunctionEx()}function updateDeviceTimeline(){2==meshserver.State&&null!=powerTimelineNode&&null!=powerTimelineUpdate&&null!=currentNode&&3!=currentNode.mtype&&powerTimelineNode==powerTimelineReq&&currentNode._id==powerTimelineNode&&powerTimelineUpdate<Date.now()&&(powerTimelineUpdate=null,meshserver.send({action:"powertimeline",nodeid:currentNode._id}),meshserver.send({action:"lastconnect",nodeid:currentNode._id}))}function drawDeviceTimeline(){if(!(null==currentNode||xxcurrentView<10||19<xxcurrentView||3==currentNode.mtype||"true"===hidePowerTimeline)){var e=null,t=Date.now(),n=(currentNode._id==powerTimelineNode&&(e=powerTimeline),new Date),o=(n.setHours(0,0,0,0),(n=new Date(n.getTime()-5184e5)).getTime(),[]);if(null!=e&&1<e.length){o.push([0,e[1],e[0]]);for(var a=e[1],i=2;i<e.length;i+=2){var s=e[i],r=t;e.length>i+1&&(r=e[i+1]),o.push([a,a+r,s]),a+=r}}var l="",d=1,c=new Date,u=Q("column_l").offsetWidth-192;c.setHours(0,0,0,0);for(i=0;i<7;i++){var p,m="",g=c.getTime(),v=g+864e5;for(p in o){var h,f,k,x=o[p];1==isTimeBlockInside(g,v,x[0],x[1])&&(k=Math.max(g,x[0]),h=Math.min(Math.min(v,x[1]),t),0<(f=Math.round((h-k)*u/864e5)))&&(k=format("{0} van {1} tot {2}.",powerStateStrings2[x[2]],printTime(new Date(k)),printTime(new Date(h))),m+='<div class="pwState '+powerColor(x[2])+'" title="'+k+'" style="width:'+f+'px;"></div>')}l+="<tr class="+(d%2==0?"altBack":"")+"><td><div>&nbsp;"+printDate(c)+"<div></div></div></td><td><div>"+m+"</div></td></tr>",++d,c=new Date(c.getFullYear(),c.getMonth(),c.getDate()-1)}n="";try{n="&tz="+encodeURIComponentEx(Intl.DateTimeFormat().resolvedOptions().timeZone)}catch(e){}QH("p10html2",'<table class="table table-striped align-middle text-center" cellpadding=2 cellspacing=0><thead><tr><th scope=col style=width:150px>Dag</th><th scope=col>7 dagen stroom status<div class="float-end pe-1"><i role="button" onclick=downloadFile("devicepowerevents.ashx?id='+currentNode._id+"&tf="+(new Date).getTimezoneOffset()+"&l="+encodeURIComponentEx(getLang())+n+(urlargs.key?"&key="+urlargs.key:"")+'",null,true) title="Downloaden Power gebeurtenissen" class="fa-solid fa-download"></i></div></th></tr></thead><tbody>'+l+"</tbody></table>")}}function powerColor(e){return e<powerColorTable.length?powerColorTable[e]:"pwsYellow"}function isTimeBlockInside(e,t,n,o){return n<e&&t<o||e<n&&n<t||e<o&&o<t}function addDeviceAttribute(e,t,n=[]){return`<div class="row mb-1"><div class="${n[0]||"col col-md-2 col-lg-2"}"><b> ${e} </b></div><div class="${n[1]||"col col-md-10 col-lg-10"}"> ${t} </div></div>`}function editDeviceAmtSettings(e,t,n){var o,a,i;xxdialogMode||(o="",a=getNodeFromId(e),i=3,0!=(4&GetNodeRights(a))&&(o=(o+=addHtmlFormFloating("Gebruikersnaam",'<input id=dp10username class="form-control" maxlength=32 autocomplete=nope placeholder="admin" onchange=validateDeviceAmtSettings() onkeyup=validateDeviceAmtSettings() />'))+addHtmlFormFloating("Wachtwoord",'<input id=dp10password type=password class="form-control" autocomplete=nope maxlength=32 onchange=validateDeviceAmtSettings() onkeyup=validateDeviceAmtSettings() />'),0==(1&features2)&&(o+=addHtmlFormFloating("Beveiliging",'<select id=dp10tls class="form-select"><option value=0>Geen TLS beveiliging</option><option value=1>TLS beveiliging vereist</option></select>')),null!=a.intelamt.user&&""!=a.intelamt.user&&(i=7),setModalContent("xxAddAgent","Bewerk Intel&reg; AMT-gegevens",o),showModal("xxAddAgentModal","idx_dlgOkButton",()=>editDeviceAmtSettingsEx(i,{node:a,func:t,arg:n})),null!=a.intelamt.user&&""!=a.intelamt.user?Q("dp10username").value=a.intelamt.user:Q("dp10username").value="admin",0==(1&features2)&&(Q("dp10tls").value=a.intelamt.tls),validateDeviceAmtSettings()))}function validateDeviceAmtSettings(){QE("idx_dlgOkButton",passwordcheck(Q("dp10password").value))}function editDeviceAmtSettingsEx(e,t){var n;2==e?meshserver.send({action:"changedevice",nodeid:t.node._id,intelamt:{user:"",pass:""}}):(""==(e=Q("dp10username").value)&&(e="admin"),n=Q("dp10password").value,e={action:"changedevice",nodeid:t.node._id,intelamt:{user:e=""==n?"":e,pass:n}},0==(1&features2)&&(e.intelamt.tls=parseInt(Q("dp10tls").value)),meshserver.send(e),t.func&&setTimeout(function(){t.func(null,t.arg)},1e3))}function p10showSendMqttMsgDialog(e){var t;return xxdialogMode||(t=addHtmlFormFloating("Onderwerp",'<input id=dp2topic class="form-control" maxlength=64 onchange=p10validateSendMqttMsgDialog() onkeyup=p10validateSendMqttMsgDialog(event,1) />'),setModalContent("xxAddAgent","Verzend MQTT bericht",t+=addHtmlFormFloating("Bericht",'<textarea id=dp2msg class="form-control" maxlength=4096 style=width:100%;height:150px;resize:none onchange=p10validateSendMqttMsgDialog() onkeyup=p10validateSendMqttMsgDialog(event,1)></textarea>')),showModal("xxAddAgentModal","idx_dlgOkButton",()=>p10showSendMqttMsgDialogEx(3,e)),p10validateSendMqttMsgDialog(),Q("dp2topic").focus()),!1}function p10validateSendMqttMsgDialog(){QE("idx_dlgOkButton",0<Q("dp2topic").value.length&&0<Q("dp2msg").value.length)}function p10showSendMqttMsgDialogEx(e,t){meshserver.send({action:"sendmqttmsg",nodeids:t,topic:Q("dp2topic").value,msg:Q("dp2msg").value}),uncheckAllDevices()}function p10showSendUninstallAgentDialog(e){var t;return xxdialogMode||(t="",t=1<e.length?format("Weet u zeker dat u de geselecteerde {0} agenten wilt verwijderen?",e.length):"Weet u zeker dat u de geselecteerde agent wilt verwijderen?",setModalContent("xxAddAgent","Deïnstallatie agent",t=(t+="<br /><br />")+(1<e.length?"Hiermee worden de apparaten niet van de server verwijderd, maar kunnen de apparaten geen verbinding meer maken met de server. Alle externe toegang tot de apparaten gaat verloren. De apparaten moeten zijn aangesloten om deze opdracht te laten werken.":"Hiermee wordt dit apparaat niet van de server verwijderd, maar kan het apparaat geen verbinding meer maken met de server. Alle externe toegang tot het apparaat gaat verloren. Het apparaat moet verbonden zijn om dit commando te laten werken.")+'<br /><br /><label style=color:red><input id=p10check type=checkbox class="form-check-input me-2" onchange=p10validateDeleteNodeDialog() />Bevestig</label>'),showModal("xxAddAgentModal","idx_dlgOkButton",()=>p10showSendUninstallAgentDialogEx(3,e)),p10validateSendUninstallAgentDialog()),!1}function p10validateSendUninstallAgentDialog(){QE("idx_dlgOkButton",Q("p10check").checked)}function p10showSendUninstallAgentDialogEx(e,t){meshserver.send({action:"uninstallagent",nodeids:t}),uncheckAllDevices()}function p10showChangeGroupDialog(e){if(!xxdialogMode){var t=null;if(1==e.length)try{t=meshes[getNodeFromId(e[0]).meshid]._id}catch(e){}var n,o,a='<select id=p10newGroup class="form-select">',i=0,s=[];for(n in meshes){var r=GetMeshRights(n);meshes[n]._id!=t&&4&r&&s.push(meshes[n])}for(n in s.sort(nameSort),s)i++,a+="<option value='"+s[n]._id+"'>"+s[n].name+"</option>";a+="</select>",0<i?(o=1==e.length?"Selecteer een nieuwe groep voor dit apparaat<br /><br />":"Selecteer een nieuwe groep voor geselecteerde apparaten<br /><br />",setModalContent("xxAddAgent","Verander groep",o+=addHtmlFormFloating("Nieuwe apparaatgroep",a)),showModal("xxAddAgentModal","idx_dlgOkButton",()=>p10showChangeGroupDialogEx(3,e))):(setModalContent("xxAddAgent","Verander groep","No other device group of same type exists."),showModal("xxAddAgentModal","idx_dlgOkButton"))}return!1}function p10showChangeGroupDialogEx(e,t){meshserver.send({action:"changeDeviceMesh",nodeids:t,meshid:Q("p10newGroup").value}),uncheckAllDevices()}function p10showDeleteNodeDialog(e){var t;return xxdialogMode||(t=format("Weet u zeker dat u apparaat {0} wilt verwijderen?",EscapeHtml(currentNode.name))+'<br /><br /><label><input id=p10check type=checkbox class="form-check-input me-2" onchange=p10validateDeleteNodeDialog() />Bevestig</label>',xxdialogButtons=3,xxdialogTag=e,setModalContent("xxAddAgent","Verwijder apparaat",t),showModal("xxAddAgentModal","idx_dlgOkButton",()=>p10showDeleteNodeDialogEx(0,e)),p10validateDeleteNodeDialog()),!1}function p10validateDeleteNodeDialog(){QE("idx_dlgOkButton",Q("p10check").checked)}function p10showDeleteNodeDialogEx(e,t){meshserver.send({action:"removedevices",nodeids:[t]})}function p10WebRouter(e,t,n,o){var a=null,i=getNodeFromId(e),s=(3==i.mtype&&(s=meshes[i.meshid])&&s.relayid&&(a=s.relayid,o=i.host),serverinfo.name),i=(-1!=s.indexOf(".")&&0==(2&features)||(s=window.location.hostname),"https://"+(s=""!=webRelayDns?webRelayDns:s)+":"+webRelayPort+"/control-redirect.ashx?n="+e+"&p="+n+"&appid="+t+"&c="+authRelayCookie);return null!=o&&(i+="&addr="+o),null!=a&&(i+="&relayid="+a),safeNewWindow(i,"WebRelay"),!1}function p10MCRouter(e,t,n,o,a){var i=getNodeFromId(e),s=meshes[i.meshid];return 3==t&&null==n&&(n=null!=i.rdpport?i.rdpport:3389),3==i.mtype&&s&&s.relayid&&(e=s.relayid,o=i.host),meshserver.send({action:"getcookie",nodeid:e,tcpport:n,ip:o,tag:"MCRouter",protocol:t,localport:a,name:s?s.name:null}),!1}function p10rfb(e,t){var n=getNodeFromId(e),o=null,a=meshes[n.meshid];null==t&&(t=null!=n.rfbport?n.rfbport:5900),3==n.mtype&&a&&a.relayid&&(e=a.relayid,o=n.host),meshserver.send({action:"getcookie",nodeid:e,tcpport:t,tcpaddr:o,tag:"novnc",name:a?a.name:null})}function p10mstsc(e,t){var n=getNodeFromId(e),o=meshes[n.meshid];null==t&&(t=null!=n.rdpport?n.rdpport:3389),meshserver.send({action:"getcookie",nodeid:e,tcpport:t,tag:"mstsc",name:o?o.name:null})}function p10ssh(e,t){var n=getNodeFromId(e),o=meshes[n.meshid];null==t&&(t=null!=n.sshport?n.sshport:22),meshserver.send({action:"getcookie",nodeid:e,tcpport:t,tag:"ssh",name:o?o.name:null})}var d2map=null;function p10showNodeLocationDialog(){if(null!=xxdialogMode&&"@xxmap"==xxdialogTag)setDialogMode(0);else if(xxdialogMode)return!1;function g(e){var t,n,o,a,i=[],s=["iploc","wifiloc","gpsloc","userloc"],r=null;for(t in s)null!=currentNode[s[t]]&&(o=currentNode[s[t]].split(","),n=parseFloat(o[0]),o=parseFloat(o[1]),n<90)&&-90<n&&o<180&&-180<o&&((a=new ol.Feature({geometry:new ol.geom.Point(ol.proj.fromLonLat([o,n]))})).setStyle(markerStyle(currentNode,parseInt(t)+1)),i.push(a),null==r?r=[n,o,n,o,0]:(n<r[0]&&(r[0]=n),o<r[1]&&(r[1]=o),n>r[2]&&(r[2]=n),o>r[3]&&(r[3]=o)));var l=new ol.source.Vector({features:i}),l=new ol.layer.Vector({source:l}),d=0,c=0,u=8;if(null!=r)for(var c=(r[0]+r[2])/2,d=(r[1]+r[3])/2,p=Math.max(Math.abs(r[0]-r[2]),Math.abs(r[1]-r[3])),m=360,u=-2;p<m;)u++,m/=2;1==i.length&&(u=8),d2map=new ol.Map({target:"d2map",interactions:ol.interaction.defaults({dragPan:!1,mouseWheelZoom:!1}),layers:[new ol.layer.Tile({source:new ol.source.OSM}),l],view:new ol.View({center:ol.proj.fromLonLat([d,c]),zoom:u})}),document.getElementById("xxAddAgentModal").removeEventListener("shown.bs.modal",g)}document.getElementById("xxAddAgentModal").addEventListener("shown.bs.modal",g);return xxdialogTag="@xxmap",setModalContent("xxAddAgent","Apparaat locatie","<div id=d2map style=width:100%;height:300px></div>"),showModal("xxAddAgentModal","idx_dlgOkButton"),!1}function p10showNodeNetInfoDialog(){return xxdialogMode||(xxdialogButtons=1,xxdialogTag="if"+currentNode._id,setModalContent("xxAddAgent","Netwerk Interfaces","<div id=d2netinfo>Laden...</div>"),showModal("xxAddAgentModal","idx_dlgOkButton"),meshserver.send({action:"getnetworkinfo",nodeid:currentNode._id})),!1}function p10showMeshRouterDialog(){var e,t;xxdialogMode||(e="<div>MeshCentral Router is een Windows tool voor het toewijzen van TCP poorten. U kunt RDP bijvoorbeeld via deze server naar een extern apparaat sturen.</div><br />",e=(e+='<div class="row mb-1"><div class="col-md-4"><b>Win32 Executable</b></div><div class="col-md-8"><a style="cursor:pointer" onclick="downloadFile(\'meshagents?meshaction=winrouter'+(urlargs.key?"&key="+urlargs.key:"")+'\',null,true)" class="link-primary">MeshCentralRouter.exe</a></div></div>')+'<div class="row mb-1"><div class="col-md-4"><b>MacOS Installer</b></div><div class="col-md-8"><a style="cursor:pointer" onclick="downloadFile(\'meshagents?meshaction=macrouter'+(urlargs.key?"&key="+urlargs.key:"")+'\',null,true)" class="link-primary">MeshCentralRouter.dmg</a></div></div>',-1!=(t=serverinfo.name).indexOf(".")&&0==(2&features)||(t=window.location.hostname),domainUrl.substring(0,domainUrl.length-1),setModalContent("xxAddAgent","MeshCentral Router",e=(e+='<br /><div class="alert alert-info">Start MeshCentral Router en klik "install" om het startbaar te maken vanuit de browser.</div>')+('<br /><a style=cursor:pointer target="mcrouterframe" rel="noreferrer noopener" href="'+("mcrouter://"+t+(443==serverinfo.port?"":":"+serverinfo.port)+domainUrl+"control.ashx?c="+authCookie+"&t="+serverinfo.tlshash+"&l={{{lang}}}"+(urlargs.key?"&key="+urlargs.key:""))+'"><input type=button style=width:100%;cursor:pointer value="Start MeshCentral Router" class="btn btn-primary btn-block" /></a>')+'<iframe class="d-none" name="mcrouterframe"></iframe>'),showModal("xxAddAgentModal","idx_dlgOkButton",function(){p20showAddMeshUserDialogEx(1,"fileDownload")}))}function p10showMqttLoginDialog(e){meshserver.send({action:"getmqttlogin",nodeid:e})}function p10openxterm(e,t){haltEvent(e);var e="/xterm?nodeid="+encodeURIComponentEx(t)+"&auto=1",n=getNodeFromId(t);if(null!=n)return 0<=[1,2,3,4,21,22].indexOf(n.agent.id)?e+="&os=win":e+="&os=linux",urlargs.key&&(e+="&key="+urlargs.key),safeNewWindow(e,"xterm:"+t),!1}function p10showMeshCmdDialog(e,t){var n;xxdialogMode||(n="",0==e&&(n+="<div>MeshCmd is een opdrachtregelprogramma dat veel verschillende bewerkingen uitvoert. Het actiebestand is optioneel, en kan worden gedownload en bewerkt om serverinformatie en referenties te verstrekken.<br /><br />"),1==e&&(n+='<div>Download "meshcmd" met het actiebestand om verkeer via deze server naar dit apparaat te leiden. Zorg ervoor dat u meshaction.txt bewerkt en uw accountwachtwoord toevoegt of breng de nodige wijzigingen aan.<br /><br />'),n=(n+=addHtmlFormFloating("Besturingssysteem","<select id=aginsSelect onclick=meshCmdOsClick() class=form-select><option value=4>Windows x86 (64bit)</option><option value=3>Windows x86 (32bit)</option><option value=43>Windows ARM (64bit)</option><option value=6>Linux x86 (64bit)</option><option value=5>Linux x86 (32bit)</option><option value=16>macOS x86 (64bit)</option><option value=29>macOS ARM (64bit)</option><option value=25>Linux ARM, Raspberry Pi (32bit)</option><option value=26>Linux ARM, Raspberry Pi (64bit)</option></select>"))+addHtmlValue("MeshCmd",'<a id=meshcmddownloadid onclick=downloadFile("meshagents?meshcmd=3'+(urlargs.key?"&key="+urlargs.key:"")+'") class=link-primary></a>'),0==e&&(n+=addHtmlValue("Actie bestand",'<a onclick=downloadFile("meshagents?meshaction=generic'+(urlargs.key?"&key="+urlargs.key:"")+'") class=link-primary>MeshAction (.txt)</a>')),1==e&&(n+=addHtmlValue("Actie bestand",'<a onclick=downloadFile("meshagents?meshaction=route&nodeid='+t+(urlargs.key?"&key="+urlargs.key:"")+'") class=link-primary>MeshAction (.txt)</a>')),xxdialogButtons=9,xxdialogMode="fileDownload",setModalContent("xxAddAgent","Download MeshCmd",n+="</div>"),showModal("xxAddAgentModal","idx_dlgOkButton"),meshCmdOsClick())}function meshCmdOsClick(){var e=Q("aginsSelect").value,t="";3==e&&(t="MeshCmd (Win x86-32 uitvoerbaar)"),4==e&&(t="MeshCmd (Win x86-64 uitvoerbaar)"),43==e&&(t="MeshCmd (Win ARM-64 uitvoerbaar)"),5==e&&(t="MeshCmd (Linux x86, 32bit)"),6==e&&(t="MeshCmd (Linux x86, 64bit)"),16==e&&(t="MeshCmd (macOS, x86-64bit)"),29==e&&(t="MeshCmd (macOS, ARM-64bit)"),25==e&&(t="MeshCmd (Linux ARM, 32bit)"),26==e&&(t="MeshCmd (Linux ARM, 64bit)"),QH("meshcmddownloadid",t),Q("meshcmddownloadid").onclick=function(){downloadFile("meshagents?meshcmd="+e+(urlargs.key?"&key="+urlargs.key:""))}}function p10showiconselector(){xxdialogMode||0!=(4&GetNodeRights(currentNode))&&(setModalContent("xxAddAgent","Pictogram selectie",'<div style=text-align:center><br /><div tabindex=0 style="display:inline-block;margin:0 10px 0 10px" class=i1 onclick=p10setIcon(1) onkeypress="if (event.key==\'Enter\') p10setIcon(1)"></div><div tabindex=0 style="display:inline-block;margin:0 10px 0 10px" class=i2 onclick=p10setIcon(2) onkeypress="if (event.key==\'Enter\') p10setIcon(2)"></div><div tabindex=0 style="display:inline-block;margin:0 10px 0 10px" class=i3 onclick=p10setIcon(3) onkeypress="if (event.key==\'Enter\') p10setIcon(3)"></div><div tabindex=0 style="display:inline-block;margin:0 10px 0 10px" class=i4 onclick=p10setIcon(4) onkeypress="if (event.key==\'Enter\') p10setIcon(4)"></div><br /><div tabindex=0 style="display:inline-block;margin:0 10px 0 10px" class=i5 onclick=p10setIcon(5) onkeypress="if (event.key==\'Enter\') p10setIcon(5)"></div><div tabindex=0 style="display:inline-block;margin:0 10px 0 10px" class=i6 onclick=p10setIcon(6) onkeypress="if (event.key==\'Enter\') p10setIcon(6)"></div><div tabindex=0 style="display:inline-block;margin:0 10px 0 10px" class=i7 onclick=p10setIcon(7) onkeypress="if (event.key==\'Enter\') p10setIcon(7)"></div><div tabindex=0 style="display:inline-block;margin:0 10px 0 10px" class=i8 onclick=p10setIcon(8) onkeypress="if (event.key==\'Enter\') p10setIcon(8)"></div><br /><br /></div>'),showModal("xxAddAgentModal","idx_dlgOkButton"),QV("id_dialogclose",!0))}function p10setIcon(e){setDialogMode(0),meshserver.send({action:"changedevice",nodeid:currentNode._id,icon:e})}function showClearSshDialog(){setModalContent("xxAddAgent","Bewerk apparaat","Clear SSH credentials?"),showModal("xxAddAgentModal","idx_dlgOkButton",()=>showClearSshDialogEx(3))}function showClearSshDialogEx(e,t){meshserver.send({action:"changedevice",nodeid:currentNode._id,ssh:0})}function showClearRdpDialog(){setModalContent("xxAddAgent","Bewerk apparaat","Clear RDP credentials?"),showModal("xxAddAgentModal","idx_dlgOkButton",()=>showClearRdpDialogEx(3))}function showClearRdpDialogEx(e,t){meshserver.send({action:"changedevice",nodeid:currentNode._id,rdp:0})}var desktopNode,showEditNodeValueDialog_modes=["Apparaat naam","Hostnaam","Omschrijving","Tags"],showEditNodeValueDialog_modes2=["name","host","desc","tags"],showEditNodeValueDialog_modes3=["","","","Tag1, Tag2, Tag3"],showEditNodeValueDialog_modes4=[64,64,64,4096];function showEditNodeValueDialog(e){if(!xxdialogMode){var t="",n="",o=currentNode[showEditNodeValueDialog_modes2[e]];if(null==o&&(o=""),3==e){var t='<select id=dp10devicevalue multiple class="form-control" maxlength='+showEditNodeValueDialog_modes4[e]+" class=form-control>",a=[];for(s in nodes)if(nodes[s].tags)for(var i in nodes[s].tags)-1==a.indexOf(nodes[s].tags[i])&&a.push(nodes[s].tags[i]);if(0<a.length)for(var s in a.sort(),a){EscapeHtml(a[s]);n+=Array.isArray(o)&&-1!==o.indexOf(a[s])?"<option selected=selected>"+EscapeHtml(a[s])+"</option>":"<option>"+EscapeHtml(a[s])+"</option>"}setModalContent("xxAddAgent","Bewerk Tags",t+=n+"</select>"),$("#dp10devicevalue").select2({theme:"bootstrap-5",width:$(this).data("width")?$(this).data("width"):$(this).hasClass("w-100")?"100%":"style",placeholder:showEditNodeValueDialog_modes3[e],closeOnSelect:!1,allowClear:!0,tokenSeparators:[","],tags:!0})}else setModalContent("xxAddAgent","Bewerk apparaat",t=addHtmlFormFloating(showEditNodeValueDialog_modes[e],'<input id=dp10devicevalue class="form-control" maxlength='+showEditNodeValueDialog_modes4[e]+' placeholder="'+showEditNodeValueDialog_modes3[e]+'" onchange=p10editdevicevalueValidate('+e+",event) onkeyup=p10editdevicevalueValidate("+e+",event) class=form-control/>")),Array.isArray(o)&&(o=o.join(", ")),Q("dp10devicevalue").value=o,showModal("xxAddAgentModal","idx_dlgOkButton",function(){showEditNodeValueDialogEx(3,e)});p10editdevicevalueValidate(),showModal("xxAddAgentModal","idx_dlgOkButton",function(){showEditNodeValueDialogEx(3,e)}),Q("dp10devicevalue").focus()}}function showEditNodeValueDialogAddTag(e){var t,n=Q("dp10devicevalue").value.split(","),o=[];for(t in n)o.push(n[t].trim());0<=o.indexOf(e)||(Q("dp10devicevalue").value+=(0==Q("dp10devicevalue").value.length?"":", ")+decodeURIComponent(e),setTimeout(function(){Q("dp10devicevalue").selectionStart=Q("dp10devicevalue").selectionEnd=9e4},0),p10editdevicevalueValidate())}function showEditNodeValueDialogEx(e,t){var n="",o={action:"changedevice",nodeid:currentNode._id};if(3==t){var a,i=$("#dp10devicevalue").select2("data");for(a in i)n+=i[a].text.trim()+", ";o[showEditNodeValueDialog_modes2[t]]=decodeURIComponent(n.slice(0,-2))}else o[showEditNodeValueDialog_modes2[t]]=Q("dp10devicevalue").value;meshserver.send(o)}function p10editdevicevalueValidate(e,t){e=1<e||0<Q("dp10devicevalue").value.length;QE("idx_dlgOkButton",e),null!=t&&1==e&&13==t.keyCode&&dialogclose(1)}function setupDesktop(){var e,t;desktopNode!=currentNode&&null!=desktop&&desktopNode._id!=currentNode._id&&(desktop.Stop(),desktop=desktopNode=null),desktopNode==currentNode&&null!=desktop||(null!=(e=multiDesktop[currentNode._id])?(QH("DeskParent",""),(t=e.m.CanvasId).setAttribute("id","Desk"),t.setAttribute("onmousedown","dmousedown(event)"),t.setAttribute("onmouseup","dmouseup(event)"),t.setAttribute("onmousemove","dmousemove(event)"),t.removeAttribute("onclick"),Q("DeskParent").appendChild(t),(desktop=e).m.SendCompressionLevel&&desktop.m.SendCompressionLevel(desktopsettings.agentencoding,desktopsettings.quality,desktopsettings.scaling,desktopsettings.framerate),desktop.onStateChanged=onDesktopStateChange,desktop.onMetadataChange=function(e){updateMetadata(desktop,"deskmetadata")},0!=(8192&features2)&&(desktop.m.stopInput=!0),desktop&&desktop.m.mouseCursorActive&&desktop.m.mouseCursorActive(!0),QV("DeskInputLockedButton",1==desktop.m.RemoteInputLock),QV("DeskInputUnLockedButton",0==desktop.m.RemoteInputLock),desktop.m.onRemoteInputLockChanged=function(e,t){QV("DeskInputLockedButton",t),QV("DeskInputUnLockedButton",!t)},desktop.m.onKeyboardStateChanged=function(e,t){QS("p11numlock").display=1&t?"inline-block":"none",QS("p11scrolllock").display=2&t?"inline-block":"none",QS("p11capslock").display=4&t?"inline-block":"none"},desktopNode=currentNode,onDesktopStateChange(desktop,desktop.State),delete multiDesktop[currentNode._id]):(null==desktop&&QH("DeskParent",'<canvas id=Desk oncontextmenu="return false" onmousedown=dmousedown(event) onmouseup=dmouseup(event) onmousemove=dmousemove(event)></canvas>'),desktopNode=currentNode),Q("Desk").addEventListener("DOMMouseScroll",function(e){return dmousewheel(e)}),Q("Desk").addEventListener("mousewheel",function(e){return dmousewheel(e)})),desktopNode=currentNode,desktop&&(desktop.m.onDisplayinfo=deskDisplayInfo)(desktop.m,desktop.m.displays,desktop.m.selectedDisplay),updateDesktopButtons(),deskAdjust(),updateMetadata(desktop,"deskmetadata")}function updateDesktopButtons(){var e=0,t=(null!=desktop&&(e=desktop.State),GetNodeRights(currentNode)),n=1==currentNode.agent?1:2,n=(QV("disconnectbutton1span",0!=e),QV("connectbutton1span",0==e&&(8&t||256&t)&&null!=currentNode.agent&&1&currentNode.agent.caps),QV("connectbutton1rspan",0==(1073741824&features)&&0==e&&8&t&&null!=currentNode.agent&&(3==currentNode.agent.id||4==currentNode.agent.id)),1==n?QV("connectbutton1hspan",0==e&&8&t&&null!=currentNode.intelamt&&2==currentNode.intelamt.state):QV("connectbutton1hspan",0==e&&8&t&&null!=currentNode.intelamt&&2==currentNode.intelamt.state&&null!=currentNode.intelamt.ver&&(null==currentNode.intelamt.sku||"number"==typeof currentNode.intelamt.sku&&0!=(8&currentNode.intelamt.sku))),QV("td7amtkvm",!(null==currentNode.intelamt||"number"==typeof currentNode.intelamt.sku&&0!=(16&currentNode.intelamt.sku)||null==currentNode.intelamt.ver&&null!=currentNode.agent||0!=e&&2!=desktop.contype)),QV("td7meshkvm",webRtcDesktop||null!=currentNode.agent&&1&currentNode.agent.caps&&(0==e||1==desktop.contype)),QV("td7rdpkvm",!(null==currentNode.agent||3!=currentNode.agent.id&&4!=currentNode.agent.id||0!=e&&4!=desktop.contype)),0==(8192&features2)&&(null==currentNode.agent||14!=currentNode.agent.id)&&(4294967295==t||0!=(8&t)&&0==(256&t)&&0==(4096&t))),o=0!=(1&currentNode.conn),a=(QE("connectbutton1",o),QE("connectbutton1d",o),QE("connectbutton1r",o||3==currentNode.mtype),QE("connectbutton1rd",o||3==currentNode.mtype),currentNode.rdpport&&3389!=currentNode.rdpport?QH("desktopCustomUpperRight",'<a style="cursor:pointer;line-height:22px" onclick="cmaltportaction(1,event)">'+format("RDP Poort {0}",currentNode.rdpport||3389)+"</a>"):QH("desktopCustomUpperRight",""),0!=(6&currentNode.conn)),a=(QE("connectbutton1h",a),QV("deskFocusBtn",null!=desktop&&2==desktop.contype&&0!=e&&desktopsettings.showfocus),QE("DeskClip",3==e),QV("DeskClip",n&&currentNode.agent&&6144!=(6144&features2)&&11!=currentNode.agent.id&&16!=currentNode.agent.id&&(null==desktop||2!=desktop.contype)&&(1!=desktopsettings.autoclipboard||null==navigator.clipboard||null==navigator.clipboard.readText)),QE("DeskESC",3==e&&4!=desktop.contype),QV("DeskESC",browserfullscreen&&n),QE("DeskType",3==e),QV("DeskType",n),QE("DeskWD",3==e),QV("DeskWD",n),QV("deskkeys",n),QE("deskkeys",null!=desktop),QV("DeskTimer",3==e),QV("DeskLatency",3==e),QS("DeskLatency").display=3==e?"inline-block":"none",desktop&&4==desktop.contype?desktopsettings.rdpautoclipboard:desktopsettings.autoclipboard);QV("DeskClipboardOutButton",o&&n&&null!=desktop&&0==(4096&features2)&&null!=navigator.clipboard&&null!=navigator.clipboard.readText&&(1!=a||null==navigator.clipboard||null==navigator.clipboard.readText)),QV("d7deskAutoClipboardLabel",null!=navigator.clipboard.readText&&0==(4096&features2)),QV("DeskClipboardInButton",o&&n&&null!=desktop&&0==(2048&features2)&&null!=navigator.clipboard&&null!=navigator.clipboard.writeText&&(1!=a||null==navigator.clipboard||null==navigator.clipboard.readText)),3!=e&&(QV("DeskInputLockedButton",!1),QV("DeskInputUnLockedButton",!1),QV("p11numlock",!1),QV("p11scrolllock",!1),QV("p11capslock",!1)),QV("DeskRunButton",0!=(131072&t)&&o),QV("DeskSaveImageButton",3==e&&null!=Q("Desk").toBlob&&0==(1024&features2)),QV("DeskRecordButton",3==e&&null!=Q("Desk").toBlob&&null!=desktop.m.StartRecording&&0==(1024&features2)),QV("DeskChatButton",0!=(16384&t)&&0==browserfullscreen&&currentNode.agent&&o),QV("DeskNotifyButton",0!=(16384&t)&&0==browserfullscreen&&currentNode.agent&&o),QV("DeskLockButton",0!=(16384&t)&&0==browserfullscreen&&currentNode.agent&&currentNode.agent.id<5&&n&&3==e),QV("DeskToolsButton",currentNode.agent&&o),QE("DeskToolsButton",n),QV("DeskOpenWebButton",0==browserfullscreen&&n&&currentNode.agent&&o),QV("DeskBackgroundButton",n&&3==e&&1==desktop.contype&&currentNode.agent&&11!=currentNode.agent.id&&16!=currentNode.agent.id&&o),QV("DeskControlSpan",n),QV("DeskRefreshButton",3==e&&1==desktop.contype),Q("DeskControl").checked=!!(8&t)&&1==getstore("DeskControl",1),QS("DeskControlSpan").color=Q("DeskControl").checked?null:"red",0==o&&QV("DeskTools",!1)}var autoConnectDesktopTimer=null;function autoConnectDesktop(e){autoConnectDesktopTimer=null==autoConnectDesktopTimer?setInterval(function(){connectDesktop(null,1)},1e3):(clearInterval(autoConnectDesktopTimer),null)}var agentConsoleMessages=["","Wachten op toestemming van de gebruiker...","Geweigerd","Kan externe terminalsessie niet starten, {0} ({1})","Time-out","Ongeldige netwerkgegevens ontvangen","Kan weergave niet vastleggen","Protocolonderhandeling mislukt ({0})","NLA niet ondersteund","SSL vereist door server","SSL certificaat niet toegestaan door de server","SSL certificaat niet op de server","Inconsistente vlaggen","Hybride vereist door de server","SSL met gebruikersverificatie vereist door de server"];function formatAgentConsoleMessage(e,t,n){for(null==n&&(n=[]);n.length<3;)n.push("");return(t&&t<agentConsoleMessages.length?EscapeHtml(format(agentConsoleMessages[t],n[0],n[1],n[2])):EscapeHtml(e)).split("\n").join("<br />")+"<br /><br />"}function connectDesktop(e,t,n,o){xxdialogMode||(null!=e&&0!=e.shiftKey&&3==t&&(t=1),QV("p11DeskSessionSelector",!1),p11clearConsoleMsg(),null==desktop?(desktopNode=currentNode,2==t?null==desktopNode.intelamt.user||""==desktopNode.intelamt.user?editDeviceAmtSettings(desktopNode._id,connectDesktop,2):((desktop=CreateAmtRedirect(CreateAmtRemoteDesktop("Desk"),authCookie)).debugmode=debugmode,desktop.onStateChanged=onDesktopStateChange,desktop.m.bpp=1==desktopsettings.encoding||3==desktopsettings.encoding?1:2,desktop.m.useZRLE=desktopsettings.encoding<3,desktop.m.localKeyMap=desktopsettings.localkeymap,desktop.m.ReverseMouseWheel=desktopsettings.kvmrmw,desktop.m.showmouse=desktopsettings.showmouse,desktop.m.onScreenSizeChange=deskAdjust,desktop.m.onKvmData=function(e){if(0==e.length)desktop.m._sentPresence||(desktop.m._sentPresence=!0,desktop.m.sendKvmData(JSON.stringify({action:"present",ver:1})));else{var t=null;try{t=JSON.parse(e)}catch(e){}null!=t&&null!=t.action&&("restart"==t.action?(webRtcDesktopReset(),desktop.m.sendKvmData(JSON.stringify({action:"present",ver:1}))):"present"==t.action&&null==webRtcDesktop?(webRtcDesktop={platform:t.platform},"undefined"!=typeof RTCPeerConnection?webRtcDesktop.webrtc=new RTCPeerConnection(null):"undefined"!=typeof webkitRTCPeerConnection&&(webRtcDesktop.webrtc=new webkitRTCPeerConnection(null)),webRtcDesktop.webchannel=webRtcDesktop.webrtc.createDataChannel("Data kanaal",{}),webRtcDesktop.webchannel.onopen=function(){console.log("WebRTC Data Channel Open"),Q("deskstatus").textContent=StatusStrs[desktop.State]+", Soft-KVM",desktop.m.hold(!0),webRtcDesktop.webRtcActive=!0,webRtcDesktop.softdesktop=CreateKvmDataChannel(webRtcDesktop.webchannel,CreateAgentRemoteDesktop("Desk",Q("id_mainarea")),desktop.m),webRtcDesktop.softdesktop.m.setRotation(desktop.m.rotation),webRtcDesktop.softdesktop.m.onScreenSizeChange=deskAdjust,webRtcDesktop.softdesktop.m.ImageType=webpSupport?4:1,desktopsettings.quality&&(webRtcDesktop.softdesktop.m.CompressionLevel=desktopsettings.quality),desktopsettings.scaling&&(webRtcDesktop.softdesktop.m.ScalingLevel=desktopsettings.scaling),webRtcDesktop.softdesktop.Start()},webRtcDesktop.webchannel.onclose=function(e){console.log("WebRTC Data Channel Closed"),webRtcDesktopReset()},webRtcDesktop.webrtc.onicecandidate=function(e){null==e.candidate?desktop.m.sendKvmData(JSON.stringify({action:"offer",ver:1,sdp:webRtcDesktop.webrtcoffer.sdp})):webRtcDesktop.webrtcoffer.sdp+="a="+e.candidate.candidate+"\r\n"},webRtcDesktop.webrtc.oniceconnectionstatechange=function(){null==webRtcDesktop||null==webRtcDesktop.webrtc||"disconnected"!=webRtcDesktop.webrtc.iceConnectionState&&"failed"!=webRtcDesktop.webrtc.iceConnectionState||webRtcDesktopReset()},webRtcDesktop.webrtc.createOffer(function(e){webRtcDesktop.webrtcoffer=e,webRtcDesktop.webrtc.setLocalDescription(e,function(){},webRtcDesktopReset)},webRtcDesktopReset,{mandatory:{OfferToReceiveAudio:!1,OfferToReceiveVideo:!1}})):"answer"==t.action&&null!=webRtcDesktop&&webRtcDesktop.webrtc.setRemoteDescription(new RTCSessionDescription({type:"answer",sdp:t.sdp}),function(){},webRtcDesktopReset))}},4==desktopNode.conn&&null!=desktopNode.intelamt&&1==desktopNode.intelamt.tls?desktop.Start(desktopNode._id,16995,"*","*",1):desktop.Start(desktopNode._id,16994,"*","*",0),desktop.contype=2):null==t||1==t||3==t&&4<currentNode.agent.id&&null==debugmode?((desktop=CreateAgentRedirect(meshserver,CreateAgentRemoteDesktop("Desk"),serverPublicNamePort,authCookie,authRelayCookie,domainUrl)).m.UseExtendedKeyFlag=desktopNode.agent.id<5,desktop.m.mouseCursorActive(11==xxcurrentView),desktop.debugmode=debugmode,desktop.m.debugmode=debugmode,desktop.attemptWebRTC=attemptWebRTC,desktop.webrtcconfig=webrtcconfiguration,desktop.options={},null!=n&&(desktop.options.tsid=n),null!=o&&(desktop.options.consent=o),1==desktopsettings.autolock&&(desktop.options.autolock=!0),desktop.onStateChanged=onDesktopStateChange,0!=(8192&features2)&&(desktop.m.stopInput=!0),desktop.m.onRemoteInputLockChanged=function(e,t){QV("DeskInputLockedButton",t),QV("DeskInputUnLockedButton",!t)},desktop.m.onKeyboardStateChanged=function(e,t){QS("p11numlock").display=1&t?"inline-block":"none",QS("p11scrolllock").display=2&t?"inline-block":"none",QS("p11capslock").display=4&t?"inline-block":"none"},desktop.onConsoleMessageChange=function(){desktop.consoleMessage?(Q("p11DeskConsoleMsg").innerHTML+=formatAgentConsoleMessage(desktop.consoleMessage,desktop.consoleMessageId,desktop.consoleMessageArgs),QV("p11DeskConsoleMsg",!0),null!=p11DeskConsoleMsgTimer&&clearTimeout(p11DeskConsoleMsgTimer),desktop.consoleMessageTimeout&&(p11DeskConsoleMsgTimer=setTimeout(p11clearConsoleMsg,1e3*desktop.consoleMessageTimeout))):p11clearConsoleMsg()},desktop.onMetadataChange=function(e){updateMetadata(desktop,"deskmetadata")},desktop.m.ImageType=desktopsettings.agentencoding,desktop.m.CompressionLevel=desktopsettings.quality,desktop.m.ScalingLevel=desktopsettings.scaling,desktopsettings.framerate&&(desktop.m.FrameRateTimer=desktopsettings.framerate),desktopsettings.swapmouse&&(desktop.m.SwapMouse=desktopsettings.swapmouse),desktopsettings.rmw&&(desktop.m.ReverseMouseWheel=desktopsettings.rmw),1==desktopsettings.remotekeymap&&(desktop.m.remoteKeyMap=desktopsettings.remotekeymap),desktop.m.onScreenSizeChange=deskAdjust,desktop.Start(desktopNode._id),desktop.latency.callback=function(e){updateSessionTime()},desktop.contype=1):3==t?meshserver.send({action:"msg",type:"userSessions",nodeid:currentNode._id,tag:o}):4==t&&((desktop=CreateRDPDesktop("Desk",domainUrl)).onStateChanged=onDesktopStateChange,desktop.m.onScreenSizeChange=mdeskAdjust,desktop.m.onClipboardChanged=function(e){null!=e&&desktopsettings.rdpautoclipboard&&null!=navigator.clipboard&&navigator.clipboard.writeText(e).then(function(){}).catch(function(e){console.log(e)})},desktopsettings.rdpsmb&&(desktop.m.SwapMouse=desktopsettings.rdpsmb),desktopsettings.rdprmw&&(desktop.m.ReverseMouseWheel=desktopsettings.rdprmw),desktop.Start(desktopNode._id,currentNode.rdpport||3389,n),desktop.contype=4,desktop.onConsoleMessageChange=function(){desktop.consoleMessage?(Q("p11DeskConsoleMsg").innerHTML+=formatAgentConsoleMessage(desktop.consoleMessage,desktop.consoleMessageId,desktop.consoleMessageArgs),QV("p11DeskConsoleMsg",!0),null!=p11DeskConsoleMsgTimer&&clearTimeout(p11DeskConsoleMsgTimer),desktop.consoleMessageTimeout&&(p11DeskConsoleMsgTimer=setTimeout(p11clearConsoleMsg,1e3*desktop.consoleMessageTimeout))):p11clearConsoleMsg()})):(desktop.Stop(),webRtcDesktopReset(),(desktopNode=desktop=null)!=pluginHandler&&pluginHandler.callHook("onDesktopDisconnect")))}function askRdpCredentials(){var e;xxdialogMode||(e="<div>",1==currentNode.rdp?e=e+addHtmlFormFloating("Inloggegevens",'<select id=d2mode class="form-select" onchange=askRdpCredentialsValidate()><option value=1>Serverreferenties gebruiken</option><option value=2>Nieuwe inloggegevens gebruiken</option></select>')+"<div id=d2cred style=display:none>":e+="<div id=d2cred>",e=(e=(e+=addHtmlFormFloating("Domein",'<input type=text id=d2domain class="form-control" maxlength=128 />'))+addHtmlFormFloating("Gebruikersnaam",'<input type=text id=d2user class="form-control" onKeyUp=askRdpCredentialsValidate() maxlength=128 />'))+addHtmlFormFloating("Wachtwoord",'<input type=password id=d2pass class="form-control" maxlength=128 autocomplete=off />'),0==(4194304&features2)&&(e+=addHtmlValue("",'<label><input type="checkbox" class="form-check-input me-2" id=d2savecred>Onthoud inloggegevens</label>')),setModalContent("xxAddAgent","RDP inloggegevens",e=(e=(e=(e=(e+="</div>")+MoreStart())+addHtmlFormFloating("Alt Shell",'<input type=text id=d2altshell class="form-control" maxlength=2048 />'))+addHtmlFormFloating("Werkmap",'<input type=text id=d2workdir class="form-control" maxlength=2048 />'))+MoreEnd()),showModal("xxAddAgentModal","idx_dlgOkButton",()=>askRdpCredentialsEx()))}function askRdpCredentialsValidate(){1==currentNode.rdp&&(QV("d2cred",2==Q("d2mode").value),1==Q("d2mode").value)?QE("idx_dlgOkButton",!0):QE("idx_dlgOkButton",""!=Q("d2user").value)}function askRdpCredentialsEx(){var e,t=null,n=null;desktopsettings.rdpsize?"browser"==desktopsettings.rdpsize?(t=window.innerWidth,n=window.innerHeight):"screen"==desktopsettings.rdpsize?(t=window.screen.width,n=window.screen.height):"canvas"==desktopsettings.rdpsize?(t=Q("DeskParent").offsetWidth,n=Q("DeskParent").offsetHeight):1<=(e=desktopsettings.rdpsize.indexOf("x"))&&(t=parseInt(desktopsettings.rdpsize.substring(0,e)),n=parseInt(desktopsettings.rdpsize.substring(e+1))):(t=Q("DeskParent").offsetWidth,n=Q("DeskParent").offsetHeight),1==currentNode.rdp&&1==Q("d2mode").value?connectDesktop(null,4,{servercred:!0,width:t,height:n,flags:null!=desktopsettings.rdpflags?desktopsettings.rdpflags:47,altshell:Q("d2altshell").value,workdir:Q("d2workdir").value}):(e=!1,0==(4194304&features2)&&(e=Q("d2savecred").checked),connectDesktop(null,4,{domain:Q("d2domain").value,username:Q("d2user").value,password:Q("d2pass").value,savecred:e,width:t,height:n,flags:null!=desktopsettings.rdpflags?desktopsettings.rdpflags:47,altshell:Q("d2altshell").value,workdir:Q("d2workdir").value}))}function updateMetadata(e,t){var n="",o=0;if(e&&3==e.State){if(e.metadata&&e.metadata.users)for(var a in e.metadata.users)o+=e.metadata.users[a];1<o&&(n="<span onclick=showSessionMetadata(1) style=cursor:pointer>"+format(", {0} kijken",o)+"</span>")}QH("deskmetadata",n),e==desktop&&"sessionMetadata1"==xxdialogTag&&showSessionMetadata(1)}function showSessionMetadata(e){if(!xxdialogMode||xxdialogTag=="sessionMetadata"+e){xxdialogMode&&setDialogMode(0);var t=1==e?desktop:null;if(t&&t.metadata){var n="";if(t.metadata.startTime&&(n+=addHtmlValue4("Start tijd",printDateTime(new Date(t.metadata.startTime)))),t.metadata.users)for(var o in t.metadata.users){var a=1==t.metadata.users[o]?"1 verbinding":format("{0} verbindingen",t.metadata.users[o]);n+=addHtmlValue2(getUserName(o),a)}xxdialogTag="sessionMetadata"+e,setModalContent("xxAddAgent","Sessie informatie",n),showModal("xxAddAgentModal","idx_dlgOkButton")}}}function p11clearConsoleMsg(){QH("p11DeskConsoleMsg",""),QV("p11DeskConsoleMsg",!1),p11DeskConsoleMsgTimer&&(clearTimeout(p11DeskConsoleMsgTimer),p11DeskConsoleMsgTimer=null)}function p12clearConsoleMsg(){QH("p12TermConsoleMsg",""),QV("p12TermConsoleMsg",!1),p12TermConsoleMsgTimer&&(clearTimeout(p12TermConsoleMsgTimer),p12TermConsoleMsgTimer=null)}function p13clearConsoleMsg(){QH("p13FilesConsoleMsg",""),QV("p13FilesConsoleMsg",!1),p13FilesConsoleMsgTimer&&(clearTimeout(p13FilesConsoleMsgTimer),p13FilesConsoleMsgTimer=null)}function p12setConsoleMsg(e,t){e?(Q("p12TermConsoleMsg").innerHTML+=e,QV("p12TermConsoleMsg",!0),null!=p12TermConsoleMsgTimer&&clearTimeout(p12TermConsoleMsgTimer),t&&(p12TermConsoleMsgTimer=setTimeout(p12clearConsoleMsg,t))):p12clearConsoleMsg()}function p13setConsoleMsg(e,t){e?(Q("p13FilesConsoleMsg").innerHTML+=e,QV("p13FilesConsoleMsg",!0),null!=p13FilesConsoleMsgTimer&&clearTimeout(p13FilesConsoleMsgTimer),t&&(p13FilesConsoleMsgTimer=setTimeout(p13clearConsoleMsg,t))):p13clearConsoleMsg()}var webRtcDesktop=null;function webRtcDesktopReset(){if(null!=webRtcDesktop){if(null!=webRtcDesktop.softdesktop&&(webRtcDesktop.softdesktop.Stop(),webRtcDesktop.softdesktop=null),null!=webRtcDesktop.webchannel){try{webRtcDesktop.webchannel.close()}catch(e){}webRtcDesktop.webchannel=null}if(null!=webRtcDesktop.webrtc){try{webRtcDesktop.webrtc.close()}catch(e){}webRtcDesktop.webrtc=null}webRtcDesktop=null,desktop&&desktop.m&&(desktop.m.hold(!1),Q("deskstatus").textContent=StatusStrs[desktop.State])}}function onDesktopStateChange(e,t){var n=t,e=(3==n&&2==e.contype&&n++,StatusStrs[n]);switch(null!=desktop&&1==desktop.webRtcActive&&(e+=", WebRTC"),null!=desktop&&3==n&&4==desktop.contype&&(e+=", RDP"),QH("deskstatus",e),t){case 0:null!=desktop&&(null!=desktop.m.recordedData&&deskRecordSession(),desktop.Stop()),desktopNode=desktop=null,QV("DeskFocus",!1),QV("DeskMonitorSelectionSpan",!1),QV("deskRecordIcon",!1),QV("DeskInputLockedButton",!1),QV("DeskInputUnLockedButton",!1),deskFocusBtn.value="All Focus",1==fullscreen&&deskToggleFull(),webRtcDesktopReset(),deskPreferedStickyDisplay=0;break;case 2:break;case 3:desktop&&1==desktop.serverIsRecording&&QV("deskRecordIcon",!0),desktop.startTime=new Date,(deskLastClipboardSent=null)==updateSessionTimer&&(updateSessionTimer=setInterval(updateSessionTime,1e3))}updateDesktopButtons(),deskAdjust(),setTimeout(deskAdjust,50),updateMetadata(desktop,"deskmetadata")}function updateSessionTime(){var e="",t=0;if(desktop&&desktop.startTime){if(desktop.latency&&0<=desktop.latency.current&&(e=format("{0} ms",desktop.latency.current)),t=Math.floor((new Date-desktop.startTime)/1e3),QH("DeskTimer",zeroPad(Math.floor(t/3600),2)+":"+zeroPad(Math.floor(t/60)%60,2)+":"+zeroPad(t%60,2)),QH("DeskLatency",e),(4!=desktop.contype&&!0===desktopsettings.autoclipboard||4==desktop.contype&&!0===desktopsettings.rdpautoclipboard)&&null!=navigator.clipboard&&null!=navigator.clipboard.readText){if("firefox"==Mstsc.browser())return;try{navigator.clipboard.readText().then(function(e){null!=desktop&&null!=e&&deskLastClipboardSent!=e&&(desktop.m.setClipboard?desktop.m.setClipboard(e):(console.log("s3"),meshserver.send({action:"msg",type:"setclip",nodeid:currentNode._id,data:e})),deskLastClipboardSent=e)}).catch(function(e){})}catch(e){console.log(e)}}}else QH("DeskTimer",""),QH("DeskLatency","");t=0,terminal&&terminal.startTime?(terminal.latency&&0<=terminal.latency.current&&(e=format("{0} ms, ",terminal.latency.current)),t=Math.floor((new Date-terminal.startTime)/1e3),QH("TermTimer",e+zeroPad(Math.floor(t/3600),2)+":"+zeroPad(Math.floor(t/60)%60,2)+":"+zeroPad(t%60,2))):QH("TermTimer",""),null==desktop&&null==terminal&&(clearInterval(updateSessionTimer),updateSessionTimer=null)}function showDesktopSettings(){var e;xxdialogMode||(applyDesktopSettings(),updateDesktopButtons(),e=!1,0==(e="none"!=QS("td7meshkvm").display&&0<Q("td7meshkvm").className.indexOf("active")||"none"!=QS("td7rdpkvm").display&&0<Q("td7rdpkvm").className.indexOf("active")||"none"!=QS("td7amtkvm").display&&0<Q("td7amtkvm").className.indexOf("active")?!0:e)&&("none"!=QS("td7meshkvm").display?changeDesktopSettingsTab(null,"d7meshkvm"):"none"!=QS("td7rdpkvm").display?changeDesktopSettingsTab(null,"d7rdpkvm"):"none"!=QS("td7amtkvm").display&&changeDesktopSettingsTab(null,"d7amtkvm")),xxdialogButtons=3,setModalContent("xxAddAgent","Instellingen extern bureaublad",7),showModal("xxAddAgentModal","idx_dlgOkButton",showDesktopSettingsChanged))}function changeDesktopSettingsTab(e,t){for(var n,o=document.getElementsByClassName("tabcontent"),a=0;a<o.length;a++)o[a].style.display="none";for(n=document.getElementsByClassName("tablinks"),a=0;a<n.length;a++)n[a].className=n[a].className.replace(" active","");document.getElementById(t).style.display="block",null!=e?e.currentTarget.className+=" active":document.getElementById("t"+t).className+=" active"}function showDesktopSettingsChanged(){desktopsettings.encoding=d7desktopmode.value,desktopsettings.showfocus=d7showfocus.checked,desktopsettings.showmouse=d7showcursor.checked,desktopsettings.quality=d7bitmapquality.value,desktopsettings.scaling=d7bitmapscaling.value,desktopsettings.framerate=d7framelimiter.value,desktopsettings.agentencoding=d7encoding.value,desktopsettings.swapmouse=d7deskSwapMouse.checked,desktopsettings.rmw=d7deskrmw.checked,desktopsettings.remotekeymap=d7deskRemoteKeyMap.checked,desktopsettings.autoclipboard=d7deskAutoClipboard.checked,desktopsettings.autolock=d7deskAutoLock.checked,desktopsettings.localkeymap=d7localKeyMap.checked,desktopsettings.kvmrmw=d7kvmrmw.checked,desktopsettings.rdpsize=d7rdpsize.value,desktopsettings.rdpsmb=d7rdpsmb.checked,desktopsettings.rdprmw=d7rdprmw.checked,desktopsettings.rdpautoclipboard=d7rdpclip.checked;for(var e=0,t=1;t<10;t++)5!=t&&Q("d7rdp"+t).checked&&(e|=1<<t-1);desktopsettings.rdpflags=e,localStorage.setItem("desktopsettings",JSON.stringify(desktopsettings)),applyDesktopSettings(),updateDesktopButtons(),desktop&&(1==desktop.contype&&(desktop.m.SwapMouse=desktopsettings.swapmouse,desktop.m.ReverseMouseWheel=desktopsettings.rmw,desktop.m.remoteKeyMap=desktopsettings.remotekeymap,0!=desktop.State)&&(desktop.m.SendCompressionLevel(desktopsettings.agentencoding,desktopsettings.quality,desktopsettings.scaling,desktopsettings.framerate),desktop.sendCtrlMsg('{"ctrlChannel":"102938","type":"autolock","value":'+desktopsettings.autolock+"}"),desktop.m.SendRefresh()),2==desktop.contype&&(desktop.m.ReverseMouseWheel=desktopsettings.kvmrmw,0==desktopsettings.showfocus&&(desktop.m.focusmode=0,deskFocusBtn.value="All Focus"),0!=desktop.State)&&(desktop.Stop(),setTimeout(function(){connectDesktop(null,2)},50)),4==desktop.contype)&&(desktop.m.SwapMouse=desktopsettings.rdpsmb,desktop.m.ReverseMouseWheel=desktopsettings.rdprmw)}function applyDesktopSettings(){var e="",t=512&features?[100,90,80,70,60,50,40,30,20,10,5,1]:[60,50,40,30,20,10,5,1];for(n in t)e+="<option value="+t[n]+">"+t[n]+"%</option>";QH("d7bitmapquality",e),d7desktopmode.value=desktopsettings.encoding,d7showfocus.checked=desktopsettings.showfocus,d7showcursor.checked=desktopsettings.showmouse,desktopsettings.agentencoding?d7encoding.value=desktopsettings.agentencoding:desktopsettings.agentencoding=4,d7bitmapquality.value=40,0<=t.indexOf(parseInt(desktopsettings.quality))&&(d7bitmapquality.value=desktopsettings.quality),d7bitmapscaling.value=desktopsettings.scaling,desktopsettings.framerate?d7framelimiter.value=desktopsettings.framerate:d7framelimiter.value=100,null!=desktopsettings.swapmouse&&(d7deskSwapMouse.checked=desktopsettings.swapmouse),null!=desktopsettings.rmw&&(d7deskrmw.checked=desktopsettings.rmw),null!=desktopsettings.remotekeymap&&(d7deskRemoteKeyMap.checked=desktopsettings.remotekeymap),null!=desktopsettings.autoclipboard&&(d7deskAutoClipboard.checked=desktopsettings.autoclipboard),null!=desktopsettings.autolock&&(d7deskAutoLock.checked=desktopsettings.autolock),desktopsettings.localkeymap&&(d7localKeyMap.checked=desktopsettings.localkeymap),desktopsettings.kvmrmw&&(d7kvmrmw.checked=desktopsettings.kvmrmw),QV("deskFocusBtn",null!=desktop&&2==desktop.contype&&0!=desktop.state&&desktopsettings.showfocus),null!=desktopsettings.rdpsize&&(d7rdpsize.value=desktopsettings.rdpsize),null==desktopsettings.rdpflags&&(desktopsettings.rdpflags=47),null!=desktopsettings.rdpsmb&&(d7rdpsmb.checked=desktopsettings.rdpsmb),null!=desktopsettings.rdprmw&&(d7rdprmw.checked=desktopsettings.rdprmw),null!=desktopsettings.rdpautoclipboard&&(d7rdpclip.checked=desktopsettings.rdpautoclipboard);for(var n=1;n<10;n++)5!=n&&(Q("d7rdp"+n).checked=0!=(desktopsettings.rdpflags&1<<n-1))}function enterBrowserFullscreen(e){navigator.keyboard&&navigator.keyboard.lock&&navigator.keyboard.lock(),e.requestFullscreen?e.requestFullscreen():e.msRequestFullscreen?e.msRequestFullscreen():e.mozRequestFullScreen?e.mozRequestFullScreen():e.webkitRequestFullscreen&&e.webkitRequestFullscreen(Element.ALLOW_KEYBOARD_INPUT)}function exitBrowserFullscreen(){document.exitFullscreen?document.exitFullscreen():document.msExitFullscreen?document.msExitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitExitFullscreen&&document.webkitExitFullscreen(),navigator.keyboard&&navigator.keyboard.unlock&&navigator.keyboard.unlock()}function isBrowserFullscreen(){return!!(document.fullscreenElement||document.mozFullScreenElement||document.webkitFullscreenElement||document.msFullscreenElement)}var fullscreen=!1,browserfullscreen=!1;function deskToggleFull(e){var t=!(0===args.xterm||null!=terminal&&null==xterm);(fullscreen=!fullscreen)?(QC("body").add("fulldesk"),QS("deskarea3x").height="100%",QS("deskarea3x")["max-height"]="100%",t?(QS("termTable").position="absolute",QS("termTable").top=QS("termTable").bottom=QS("termTable").left=QS("termTable").right="0"):(QS("termTable").height="100%",QS("termTable")["max-height"]="100%"),1==e.shiftKey&&(enterBrowserFullscreen(Q("container")),browserfullscreen=!0)):(QC("body").remove("fulldesk"),e=args.hide,0==footerBar&&(e|=4),e=(1&e?0:66)+(2&e?0:24)+(4&e?0:45)+(8&e?0:60),QS("deskarea3x").height="calc(100vh - "+(75+e)+"px)",QS("deskarea3x")["max-height"]="calc(100vh - "+(75+e)+"px)",t?(QS("termTable").position=null,QS("termTable").top=QS("termTable").bottom=QS("termTable").left=QS("termTable").right=null):(QS("termTable").height="calc(100vh - "+(75+e)+"px)",QS("termTable")["max-height"]="calc(100vh - "+(75+e)+"px)"),1==browserfullscreen&&(exitBrowserFullscreen(),browserfullscreen=!1)),deskAdjust(),updateDesktopButtons(),adjustPanels(),null!=xterm&&12==xxcurrentView&&(xtermfit.fit(),xterm.focus())}function deskToggleFocus(){desktop.m.focusmode=(desktop.m.focusmode+64)%192,Q("deskFocusBtn").value=["All Focus","Kleine focus","Grote focus"][desktop.m.focusmode/64]}function deskAdjust(){var e=Q("DeskParent").clientHeight,t=Q("DeskParent").clientWidth,n=Q("Desk").height,o=Q("Desk").width;2==deskAspectRatio?(QS("Desk")["margin-top"]=null,QS("Desk").height="100%",QS("Desk").width="100%",QS("DeskParent").overflow="hidden"):1==deskAspectRatio?(QS("Desk")["margin-top"]="0px",QS("Desk").height=n+"px",QS("Desk").width=o+"px",QS("DeskParent").overflow="scroll"):(n/o<e/t?(t=n*t/o+"px",QS("Desk").height=t,QS("Desk").width="100%"):(t=o*e/n+"px",QS("Desk").height=webPageFullScreen||fullscreen?null:"100%",QS("Desk").width=t),QS("Desk")["margin-top"]=null,QS("DeskParent").overflow="hidden")}function mdeskAdjust(e,t,n,o){var a;e&&t&&n&&o&&(3!=(a=Q("viewselect").value)&&5!=a||("Desk"==o.id?deskAdjust():(5==a&&(a=[{x:180,y:101},{x:302,y:169},{x:454,y:255}][Q("sizeselect").selectedIndex],QS(o.id).width=(0!=e.State?t*a.y/n:a.x)+"px"),QS(o.id)["margin-top"]=null,QS(o.id)["margin-bottom"]=null)))}function sendDeskEsc(){null!=desktop&&3==desktop.State&&(2==desktop.contype?desktop.m.sendkey([[65307,1],[65307,0]]):desktop.m.SendKeyMsgKC([[desktop.m.KeyAction.EXDOWN,27],[desktop.m.KeyAction.EXUP,27]]))}function p11fileDragDrop(e){var t;haltEvent(e),QV("p11bigfail",!1),QV("p11bigok",!1),null==xxdialogMode&&null!=desktop&&3==desktop.State&&null!=e.dataTransfer&&0!=e.dataTransfer.files.length&&((t=(e=e.dataTransfer.files[0]).name.toLowerCase()).endsWith(".bat")||t.endsWith(".ps1")||t.endsWith(".sh")||t.endsWith(".agentconsole")?d2runCommandDialog({nodeids:[currentNode._id],selectedFile:e}):t.endsWith(".txt")&&((t=new FileReader).onload=function(e){showDeskType(e.target.result)},t.readAsText(e)))}var p11dragtimer=null;function p11fileDragOver(e){haltEvent(e),null!=p11dragtimer&&(clearTimeout(p11dragtimer),p11dragtimer=null);e=null==xxdialogMode&&null!=desktop&&3==desktop.State;QV("p11bigok",e),QV("p11bigfail",!e)}function p11fileDragLeave(e){haltEvent(e),"Desk"!=e.target.id?(QV("p11bigfail",!1),QV("p11bigok",!1)):p11dragtimer=setTimeout(function(){QV("p11bigfail",!1),QV("p11bigok",!1),p11dragtimer=null},10)}function updateDeskShortcutKeys(){var e,t="",n=parseInt(Q("deskkeys").value);for(e in""==n&&0<deskKeyboardShortcuts.length&&(n=deskKeyboardShortcuts[0]),deskKeyboardShortcuts)t+="<option value="+deskKeyboardShortcuts[e]+(n==deskKeyboardShortcuts[e]?" selected":"")+">"+keyShortcutTotext(deskKeyboardShortcuts[e])+"</option>";QH("deskkeys",t)}var keyStrings={8:"BackSpace",9:"Tab",13:"invoeren",27:"Escape",32:"Spatie",44:"Print Screen",45:"Insert",46:"Del",36:"Home",35:"End",33:"Page Up",34:"Page Down",37:"Links",38:"Omhoog",39:"Rechts",40:"Omlaag",0:"Geen"};function keyShortcutTotext(e){var t=[];return 65536&e&&t.push("Shift"),131072&e&&t.push("Alt"),524288&e&&t.push("Ctrl"),1048576&e&&t.push("Win"),112<=(e&=65535)&&e<=123?t.push("F"+(e-111)):0!=e&&keyStrings[e]?t.push(keyStrings[e]):0!=e&&t.push(String.fromCharCode(e)),t.join(" + ")}function deskCustomizeKeys(){if(!xxdialogMode){var e=(e='<div id=d2shortcuts style="width:100%;height:180px;padding:4px;overflow-y:auto;border:1px solid gray"></div><div style=width:100%;padding:5px>')+'<label><input id=d1kshift type=checkbox class="form-check-input me-2" /> Shift</label><label> <input id=d1kalt type=checkbox class="form-check-input me-2" /> Alt</label><label> <input id=d1kctrl type=checkbox class="form-check-input me-2" /> Ctrl</label> <input id=d1kwin type=checkbox class="form-check-input me-2" /> Win</label>'+" <select id=d2keySelect>";for(t in keyStrings)e+="<option value="+t+">"+keyStrings[t]+"</option>";for(var t=1;t<=12;t++)e+="<option value="+(t+111)+">F"+t+"</option>";for(t=0;t<10;t++)e+="<option value="+(t+48)+">"+t+"</option>";for(t=0;t<26;t++)e+="<option value="+(t+65)+">"+String.fromCharCode(t+65)+"</option>";setModalContent("xxAddAgent","Toetsenbord sneltoetsen aanpassen",e=e+"</select> <input type=button value=Toevoegen onclick=addDeskCustomizeKey() /></div>"+'<div style=width:100%;padding:2px;text-align:center><input type=button value="Herstel standaard toetsenbord sneltoetsen" onclick=restoreDeskCustomizeKey() /></div>'),showModal("xxAddAgentModal","idx_dlgOkButton",()=>deskCustomizeKeysEx()),deskUpdateShortcutList()}}function deskCustomizeKeysEx(){putstore("deskKeyShortcuts",deskKeyboardShortcuts.join(",")),updateDeskShortcutKeys()}function deskUpdateShortcutList(){var e,t="";for(e in deskKeyboardShortcuts){var n=keyShortcutTotext(deskKeyboardShortcuts[e]),o="";e!=deskKeyboardShortcuts.length-1&&(o+='<img width=8 height=8 style=float:right;cursor:pointer;padding:3px src="images/c2.png" onclick=deskCustomizeKeyDown('+deskKeyboardShortcuts[e]+")>"),0!=e&&(o+='<img width=8 height=8 style=float:right;cursor:pointer;padding:3px src="images/c3.png" onclick=deskCustomizeKeyUp('+deskKeyboardShortcuts[e]+")>"),t+='<div style="width:100%;background-color:#AAA;border-radius:4px;margin-bottom:4px;padding:4px;text-align:left;box-sizing:border-box" value='+deskKeyboardShortcuts[e]+">"+n+'<img width=10 height=10 style=float:right;cursor:pointer;padding:2px;margin-left:8px src="images/trash.png" onclick=removeDeskCustomizeKey('+deskKeyboardShortcuts[e]+")>"+o+"</div>"}""==t&&(t="<i>Geen toetsenbord snelkoppelingen gedefinieerd</i>"),QH("d2shortcuts",t)}function deskCustomizeKeyDown(e){var e=deskKeyboardShortcuts.indexOf(e),t=deskKeyboardShortcuts[e+1];deskKeyboardShortcuts[e+1]=deskKeyboardShortcuts[e],deskKeyboardShortcuts[e]=t,deskUpdateShortcutList()}function deskCustomizeKeyUp(e){var e=deskKeyboardShortcuts.indexOf(e),t=deskKeyboardShortcuts[e];deskKeyboardShortcuts[e]=deskKeyboardShortcuts[e-1],deskKeyboardShortcuts[e-1]=t,deskUpdateShortcutList()}function removeDeskCustomizeKey(e){var t,n=[];for(t in deskKeyboardShortcuts)deskKeyboardShortcuts[t]!=e&&n.push(deskKeyboardShortcuts[t]);deskKeyboardShortcuts=n,deskUpdateShortcutList()}function restoreDeskCustomizeKey(){deskKeyboardShortcuts=[],putstore("deskKeyShortcuts",null);var e,t=getstore("deskKeyShortcuts","0x0A002E,0x100000,0x100028,0x100026,0x10004C,0x10004D,0x11004D,0x100052,0x020073,0x080057,0x020009,0x100025,0x100027").split(",");for(e in t)""!=t[e]&&deskKeyboardShortcuts.push(parseInt(t[e]));updateDeskShortcutKeys(),deskUpdateShortcutList()}function addDeskCustomizeKey(){var e=parseInt(Q("d2keySelect").value);Q("d1kshift").checked&&(e|=65536),Q("d1kalt").checked&&(e|=131072),Q("d1kctrl").checked&&(e|=524288),Q("d1kwin").checked&&(e|=1048576),0<e&&-1==deskKeyboardShortcuts.indexOf(e)&&(deskKeyboardShortcuts.push(e),deskUpdateShortcutList())}function deskCustomizeStrings(){var e;xxdialogMode||(e='<div id=d2strings style="width:100%;height:180px;padding:4px;overflow-y:auto;border:1px solid gray"></div><div style=width:100%;padding:5px>',setModalContent("xxAddAgent","Toetsenbord strings aanpassen",e=(e=(e+=addHtmlFormFloating("Naam",'<input type=text id=d2shortcutname class="form-control" maxlength=32 autocomplete=off onkeyup=deskCustomizeStringsUpdate(event) />'))+addHtmlFormFloating("Waarde",'<input type=text id=d2shortcutvalue class="form-control" maxlength=256 autocomplete=off onkeyup=deskCustomizeStringsUpdate(event) />'))+addHtmlFormFloating("",'<input id=d2addbutton type=button value=Toevoegen onclick=addDeskCustomizeString() class="form-control" />')),showModal("xxAddAgentModal","idx_dlgOkButton",()=>deskCustomizeStringsEx()),deskUpdateStringsList(),deskCustomizeStringsUpdate())}function deskCustomizeStringsUpdate(){QE("d2addbutton",""!=Q("d2shortcutname").value&&""!=Q("d2shortcutvalue").value)}function deskCustomizeStringsEx(){putstore("deskStrings",JSON.stringify(deskKeyboardStrings)),updateDesktopStrings()}function deskUpdateStringsList(){var e,t="";for(e in deskKeyboardStrings){var n="";e!=deskKeyboardStrings.length-1&&(n+='<img width=8 height=8 style=float:right;cursor:pointer;padding:3px src="images/c2.png" onclick=deskCustomizeStringDown('+e+")>"),0!=e&&(n+='<img width=8 height=8 style=float:right;cursor:pointer;padding:3px src="images/c3.png" onclick=deskCustomizeStringUp('+e+")>"),t=(t+='<div style="width:100%;background-color:#AAA;border-radius:4px;margin-bottom:4px;padding:4px;text-align:left;box-sizing:border-box" value='+(e+1e3)+"><div><b>"+EscapeHtml(deskKeyboardStrings[e].n)+'</b><img width=10 height=10 style=float:right;cursor:pointer;padding:2px;margin-left:8px src="images/trash.png" onclick=removeDeskCustomizeString('+e+")>"+n+"</div>")+("<div stlye=font-size:x-small>"+EscapeHtml(deskKeyboardStrings[e].v)+"</div>")+"</div>"}""==t&&(t="<i>Geen toetsenbord strings gedefineerd</i>"),QH("d2strings",t)}function deskCustomizeStringDown(e){var t=deskKeyboardStrings[e+1];deskKeyboardStrings[e+1]=deskKeyboardStrings[e],deskKeyboardStrings[e]=t,deskUpdateStringsList()}function deskCustomizeStringUp(e){var t=deskKeyboardStrings[e];deskKeyboardStrings[e]=deskKeyboardStrings[e-1],deskKeyboardStrings[e-1]=t,deskUpdateStringsList()}function removeDeskCustomizeString(e){deskKeyboardStrings.splice(e,1),deskUpdateStringsList()}function addDeskCustomizeString(){Array.isArray(deskKeyboardStrings)||(deskKeyboardStrings=[]);var e=Q("d2shortcutname").value,t=Q("d2shortcutvalue").value;""!=e&&""!=t&&(deskKeyboardStrings.push({n:e,v:t}),deskUpdateStringsList())}function updateDesktopStrings(){var e,t="";for(e in deskKeyboardStrings)t+='<div class="cmtext" onclick="cmdeskpreconfigtypeaction('+(parseInt(e)+1e3)+',event)">'+EscapeHtml(deskKeyboardStrings[e].n)+"</div>";""!=t&&(t+="<hr />"),QH("deskPreConfigShortcutContextMenu2",t)}function deskSendKeys(){if(Q("DeskWD").blur(),!xxdialogMode&&null!=desktop&&3==desktop.State){var e=parseInt(Q("deskkeys").value);if(655406==e)desktop.m.sendcad();else{var t=(16711680&e)>>16,e=65535&e,n=[],o=[],a={8:65288,9:65289,13:65293,27:65307,45:65379,46:65535,36:65360,35:65367,33:65365,34:65366,37:65361,38:65362,39:65363,40:65364,112:65470,113:65471,114:65472,115:65473,116:65474,117:65475,118:65476,119:65477,120:65478,121:65479,122:65480,123:65481};if(2==desktop.contype){1&t&&(n.push([65505,1]),o.push([65505,0])),2&t&&(n.push([65513,1]),o.push([65513,0])),8&t&&(n.push([65507,1]),o.push([65507,0])),16&t&&(n.push([65511,1]),o.push([65511,0])),65<=(e=a[e]?a[e]:e)&&e<=90&&(e+=32),0!=e&&(n.push([e,1]),o.push([e,0])),o.reverse();for(var i=0;i<o.length;i++)n.push(o[i]);desktop.m.sendkey(n)}else{1&t&&(n.push([desktop.m.KeyAction.DOWN,16]),o.push([desktop.m.KeyAction.UP,16])),2&t&&(n.push([desktop.m.KeyAction.EXDOWN,18]),o.push([desktop.m.KeyAction.EXUP,18])),8&t&&(n.push([desktop.m.KeyAction.EXDOWN,17]),o.push([desktop.m.KeyAction.EXUP,17])),16&t&&(n.push([desktop.m.KeyAction.EXDOWN,91]),o.push([desktop.m.KeyAction.EXUP,91])),0!=e&&(n.push([desktop.m.KeyAction.DOWN,e]),o.push([desktop.m.KeyAction.UP,e])),o.reverse();for(i=0;i<o.length;i++)n.push(o[i]);desktop.m.SendKeyMsgKC(n)}}}}function showDeskType(e){var t;xxdialogMode||null==desktop||3!=desktop.State||(Q("DeskType").blur(),t="<div>Voer tekst in en klik op OK om deze op afstand te typen. Zorg ervoor dat u de externe cursor op de juiste positie plaatst voordat u verder gaat.<div>",setModalContent("xxAddAgent","Toetsenbordinvoer op afstand",t+='<textarea id=d2typeText style="margin-top:5px;width:100%;height:184px;resize:none" maxlength=2000>'+(e?EscapeHtml(e):"")+"</textarea>"),showModal("xxAddAgentModal","idx_dlgOkButton",()=>showDeskTypeEx()),Q("d2typeText").focus())}var AmtDeskTypeTimer=null,AmtDeskTypeContent=null,DeskTypeTranslate={39:222,42:106,43:107,44:188,45:189,46:190,47:191,59:186,61:187,91:219,92:220,93:221,96:192,191:111},DeskTypeShiftTranslate={33:49,34:222,35:51,36:52,37:53,38:55,40:57,41:48,58:186,60:188,62:190,63:191,64:50,94:54,95:189,106:56,107:187,123:219,124:220,125:221,126:192};function showDeskTypeEx(e){var t,n=[],o=!1,a=("string"==typeof e?t=e:(t=Q("d2typeText").value,Q("d2typeText").value)).toUpperCase();if(2==desktop.contype){for(var i in t){var s=t.charCodeAt(i);n.push([s,1],[s,0])}AmtDeskTypeContent=n,AmtDeskTypeTimer=setInterval(function(){var e=AmtDeskTypeContent.shift();desktop&&desktop.m.sendkey(e[0],e[1]),null!=desktop&&0!=AmtDeskTypeContent.length||(clearInterval(AmtDeskTypeTimer),AmtDeskTypeContent=null)},10)}else if(4==desktop.contype)desktop.m.SendStringUnicode(t);else if(!0!==desktopsettings.remotekeymap)desktop.m.SendStringUnicode(t);else{for(var i in t){var s=t.charCodeAt(i),r=a.charCodeAt(i);65<=s&&s<=90||97<=s&&s<=122?(s==r&&0==o&&(n.push([desktop.m.KeyAction.DOWN,16]),o=!0),s!=r&&1==o&&(n.push([desktop.m.KeyAction.UP,16]),o=!1)):48<=s&&s<=57?1==o&&(n.push([desktop.m.KeyAction.UP,16]),o=!1):DeskTypeTranslate[s]?(1==o&&(n.push([desktop.m.KeyAction.UP,16]),o=!1),r=DeskTypeTranslate[s]):DeskTypeShiftTranslate[s]&&(0==o&&(n.push([desktop.m.KeyAction.DOWN,16]),o=!0),r=DeskTypeShiftTranslate[s]),n.push([desktop.m.KeyAction.DOWN,r],[desktop.m.KeyAction.UP,r])}1==o&&(n.push([desktop.m.KeyAction.UP,16]),o=!1),desktop.m.SendKeyMsgKC(n)}}function showDeskClip(){var e;xxdialogMode||null==desktop||3!=desktop.State||(Q("DeskClip").blur(),e="",0==(2048&features2)&&(e+='<input id=dlgClipGet type=button value="Klembord ophalen" style=width:160px onclick=showDeskClipGet()>'),0==(4096&features2)&&(e+='<input id=dlgClipSet type=button value="Klembord instellen" style=width:160px onclick=showDeskClipSet()>'),xxdialogTag="clipboard",setModalContent("xxAddAgent","Extern klembord",e=(e+='<div id=dlgClipStatus style="display:inline-block;margin-left:8px" ></div>')+'<textarea id=d2clipText style="width:100%;height:184px;resize:none" maxlength=65535></textarea>'+'<input type=button value="Close" style=width:80px;float:right onclick=dialogclose(0)><div style=height:26px;margin-top:3px><span id=linuxClipWarn style=display:none>Het externe klembord is 60 seconden geldig.</span>&nbsp;</div><div></div>'),showModal("xxAddAgentModal","idx_dlgOkButton"),Q("d2clipText").focus())}function showDeskClipGet(){null!=desktop&&3==desktop.State&&meshserver.send({action:"msg",type:"getclip",nodeid:currentNode._id,tag:1})}function showDeskClipSet(){null!=desktop&&3==desktop.State&&(desktop.m.setClipboard?desktop.m.setClipboard(Q("d2clipText").value):(meshserver.send({action:"msg",type:"setclip",nodeid:currentNode._id,data:Q("d2clipText").value}),QV("linuxClipWarn",currentNode&&currentNode.agent&&4<currentNode.agent.id&&21!=currentNode.agent.id&&22!=currentNode.agent.id&&34!=currentNode.agent.id)))}function sendCAD(){xxdialogMode||null==desktop||3!=desktop.State||desktop.m.sendcad()}function toggleDeskTools(){Q("DeskToolsButton").blur(),xxdialogMode||("none"==QS("DeskTools").display?(QV("DeskTools",!0),Q("DeskTools").nodeid=currentNode._id,QH("DeskToolsProcesses",""),QH("DeskToolsServices",""),QV("deskToolsTopTabService",!1),changeDeskToolTab(0),refreshDeskTools(0),refreshDeskTools(1)):QV("DeskTools",!1))}var deskToolTabSelection=0;function changeDeskToolTab(e){deskToolTabSelection=e,QV("DeskToolsProcessTab",0==e),QV("DeskToolsServiceTab",1==e),QS("deskToolsTopTabProcess").bottom=0==e?"0px":"3px",QS("deskToolsTopTabService").bottom=1==e?"0px":"3px",QS("deskToolsTopTabProcess").color=0==e?"black":"gray",QS("deskToolsTopTabService").color=1==e?"black":"gray"}function refreshDeskTools(e){e=null==e?deskToolTabSelection:e;QV("DeskToolsRefreshButton",!1),setTimeout(refreshDeskToolsEx,500),0==e&&meshserver.send({action:"msg",type:"ps",nodeid:currentNode._id}),1==e&&meshserver.send({action:"msg",type:"services",nodeid:currentNode._id})}function refreshDeskToolsEx(){QV("DeskToolsRefreshButton",!0)}var deskTools={sort:1,ssort:1,msg:null,smsg:null,resizing:!1};function sortProcess(e){deskTools.sort=e,showDeskToolsProcesses(deskTools.msg)}function sortService(e){deskTools.ssort=e,showDeskToolsServices(deskTools.smsg)}function sortProcessPid(e,t){return e.p>t.p?1:e.p<t.p?-1:sortProcessName(e,t)}function sortProcessName(e,t){return e.d>t.d?1:e.d<t.d?-1:0}function showDeskToolsProcesses(e){if(null==(deskTools.msg=e))QH("DeskToolsProcesses","");else if(Q("DeskTools").nodeid==e.nodeid){var t=[],n=null;try{n=JSON.parse(e.value)}catch(e){}if(null!=n){for(var o in n)t.push({p:parseInt(o),c:n[o].cmd,d:n[o].cmd.toLowerCase(),u:n[o].user});0==deskTools.sort?t.sort(sortProcessPid):1==deskTools.sort&&t.sort(sortProcessName);var a,i,s="";for(a in t)0!=t[a].p&&(i=t[a].c,s=(s=(s=(s=(s+="<div onclick=showProcessDetails("+t[a].p+') class="deskToolsBar d-flex">')+'<div class="pe-1 text-start" style=width:50px;>'+EscapeHtml(t[a].p)+"</div>")+'<div style="white-space:nowrap;overflow:hidden;text-overflow:ellipsis;" title="'+EscapeHtml(i)+'">'+i+"</div>")+'<div class="ms-auto">'+(t[a].u?EscapeHtml(t[a].u):""))+'<i class="ps-1 fa-solid fa-trash-can" role="button" title="Stop proces" onclick=\'return stopProcess('+EscapeHtml(t[a].p)+',"'+EscapeHtml(t[a].c)+"\")'></i></div></div>");QH("DeskToolsProcesses",s)}}}function showProcessDetails(e){xxdialogMode||(setModalContent("xxAddAgent",format("Procesdetails, #{0}",e),"Requesting Process Details..."),xxdialogTag="ps|"+currentNode._id+"|"+e,showModal("xxAddAgentModal","idx_dlgOkButton"),meshserver.send({action:"msg",type:"psinfo",nodeid:currentNode._id,pid:e}))}function showDeskToolsServices(e){if(null==(deskTools.smsg=e))QH("DeskToolsProcesses","");else if(Q("DeskTools").nodeid==e.nodeid){QV("deskToolsTopTabService",!0);var t=[],n=null;try{n=JSON.parse(e.value)}catch(e){}if(null!=(deskTools.services=n)){for(var o in n)n[o].status?t.push({p:capitalizeFirstLetter(n[o].status.state.toLowerCase()),d:n[o].displayName,i:o}):n[o].serviceType&&t.push({p:n[o].serviceType,d:n[o].name,i:o});0==deskTools.ssort?t.sort(sortProcessPid):1==deskTools.ssort&&t.sort(sortProcessName);var a,i,s="";for(o in t)0!=t[o].p&&(a=t[o].d,"Stopped"==(i=t[o].p)?i="Gestopt":"Running"==i&&(i="lopende"),s=(s=(s+="<div onclick=showServiceWaitDialog("+t[o].i+") class=deskToolsBar>")+"<div style=width:70px;float:left;padding-right:5px>"+EscapeHtml(i)+"</div>")+'<div style="white-space:nowrap;overflow:hidden;text-overflow:ellipsis" title="'+a+'">'+EscapeHtml(a)+"</div></div>");QH("DeskToolsServices",s)}}}function showServiceDetailsDialog(e){var t,n,o;xxdialogMode&&-1!=xxdialogTag.indexOf("service_")&&(t=xxdialogTag.replace("service_",""),n=e.value?JSON.parse(e.value):deskTools.services[t],e.value&&(n.displayName=deskTools.services[t].displayName),null!=n)&&(e="",n.name&&(e+=addHtmlValue("Naam",n.name)),n.displayName&&(e+=addHtmlValue("Schermnaam",n.displayName)),n.status&&("Stopped"==(o=capitalizeFirstLetter(n.status.state.toLowerCase()))?o="Gestopt":"Running"==o&&(o="lopende"),n.status.state&&(e+=addHtmlValue("Status",o)),n.status.pid&&(e+=addHtmlValue("PID",n.status.pid)),o=[],!0===n.status.isFileSystemDriver&&o.push("Bestandssysteem stuurprogramma"),!0===n.status.isInteractive&&o.push("Interactief"),!0===n.status.isKernelDriver&&o.push("KernelDriver"),!0===n.status.isOwnProcess&&o.push("Eigen proces"),!0===n.status.isSharedProcess&&o.push("Gedeeld proces"),0<o.length)&&(e+=addHtmlValue("Type",o.join(", "))),n.startType&&(e+=addHtmlValue("Start Type",n.startType)),n.user&&(e+=addHtmlValue("Gebruiker",n.user)),n.installedBy&&(e+=addHtmlValue("Geïnstalleerd door",n.installedBy)),n.installedDate&&(e+=addHtmlValue("Installatie datum",printDateTime(new Date(n.installedDate)))),n.failureActions&&(n.failureActions.resetPeriod&&(e+=addHtmlValue("Herstart foutteller na ",(o=(n.failureActions.resetPeriod<86400?0:n.failureActions.resetPeriod)/86400)+" Day"+(1!=o?"s":""))),n.failureActions.actions)&&(n.failureActions.actions[0]&&(e+=addHtmlValue("Eerste fout",n.failureActions.actions[0].type)),n.failureActions.actions[1]&&(e+=addHtmlValue("Tweede fout",n.failureActions.actions[1].type)),n.failureActions.actions[2])&&(e+=addHtmlValue("Vervolgfouten",n.failureActions.actions[2].type)),xxdialogTag="service_"+t,setModalContent("xxAddAgent","Servicegegevens",e+='<br/><div style=float:right;margin-bottom:12px><input type=button value="Sluiten" onclick=showServiceDetailsDialogEx(0,'+t+')></div><div style=margin-bottom:12px><input type=button value="Start" onclick=showServiceDetailsDialogEx(1,'+t+')><input type=button value="Stop" onclick=showServiceDetailsDialogEx(2,'+t+')><input type=button value="Herstarten" onclick=showServiceDetailsDialogEx(3,'+t+")></div>"),showModal("xxAddAgentModal","idx_dlgOkButton"))}function showServiceWaitDialog(e){var t;return xxdialogMode||null!=(t=deskTools.services[e])&&(meshserver.send({action:"msg",type:"service",nodeid:currentNode._id,serviceName:t.name}),xxdialogTag="service_"+e,setModalContent("xxAddAgent","Servicegegevens","Requesting Service Details..."),showModal("xxAddAgentModal","idx_dlgOkButton")),!1}function showServiceDetailsDialogEx(e,t){setDialogMode(0),0!=e&&null!=(t=deskTools.services[t])&&(1==e&&meshserver.send({action:"msg",type:"serviceStart",nodeid:currentNode._id,serviceName:t.name}),2==e&&meshserver.send({action:"msg",type:"serviceStop",nodeid:currentNode._id,serviceName:t.name}),3==e&&meshserver.send({action:"msg",type:"serviceRestart",nodeid:currentNode._id,serviceName:t.name}),setTimeout(function(){refreshDeskTools(1)},1e3))}function toggleKvmControl(){Q("DeskControl").blur(),putstore("DeskControl",Q("DeskControl").checked?1:0),QS("DeskControlSpan").color=Q("DeskControl").checked?null:"red"}function deskRecordSession(){var e;null!=desktop&&(null==desktop.m.recordedData?(Q("DeskRecordButtonImage").style.color="red",desktop.m.StartRecording()):(Q("DeskRecordButtonImage").style.color="",e=new Date,e="Desktop sessie-"+currentNode.name+"-"+e.getFullYear()+"-"+("0"+(e.getMonth()+1)).slice(-2)+"-"+("0"+e.getDate()).slice(-2)+"-"+("0"+e.getHours()).slice(-2)+"-"+("0"+e.getMinutes()).slice(-2),saveAs(data2blob(desktop.m.StopRecording().join("")),e+".mcrec")))}function deskSaveImage(){var e,t;xxdialogMode||null==desktop||3!=desktop.State||(e=new Date,t="Bureaublad-"+currentNode.name+"-"+e.getFullYear()+"-"+("0"+(e.getMonth()+1)).slice(-2)+"-"+("0"+e.getDate()).slice(-2)+"-"+("0"+e.getHours()).slice(-2)+"-"+("0"+e.getMinutes()).slice(-2),Q("Desk").toBlob(function(e){saveAs(e,t+".png")}))}function deskDisplayInfo(e,t,n){var o,a=0,i="";for(o in t){a++;var s=t[o],r=1,s=("All Displays"==s&&(s="Alle schermen",r=2),s.startsWith("Display ")&&(s=format("Scherm {0}",s.substring(8))),"id=DeskMonitorSelectionX"+o+' title="'+EscapeHtml(s)+'" onclick=deskSetDisplay('+o+") role=button");i+=2==r?"<span "+s+' class="fa-layers fa-fw '+(n==o?"":" gray")+'"><i class="fa-solid fa-desktop"></i><i class="fa-solid fa-square" data-fa-transform="shrink-12 left-3 up-3"></i><i class="fa-solid fa-square" data-fa-transform="shrink-12 right-3 up-3"></i></span>':"<i "+s+' class="fa-fw fa-solid fa-desktop '+(n==o?"":" gray")+'"></i>',deskPreferedStickyDisplay==o&&n!=deskPreferedStickyDisplay&&desktop.m.SetDisplay(o),deskPreferedStickyDisplay=-1}QH("DeskMonitorSelectionSpan",i),QV("DeskMonitorSelectionSpan",1<a)}function deskGetDisplayNumbers(e){desktop.m.GetDisplayNumbers()}Q("DeskTools").addEventListener("mousemove",function(e){e=e.clientX-Q("DeskTools").getBoundingClientRect().left;Q("DeskTools").style.cursor=e<5?"col-resize":"default"}),Q("DeskTools").addEventListener("mousedown",function(e){"col-resize"===Q("DeskTools").style.cursor&&(deskTools.resizing=!0,Q("Desk").removeAttribute("onmouseup"),Q("Desk").removeAttribute("onmousedown"),Q("Desk").removeAttribute("onmousemove"))}),document.addEventListener("mouseup",function(){!0===deskTools.resizing&&"col-resize"===Q("DeskTools").style.cursor&&(deskTools.resizing=!1)}),document.addEventListener("mousemove",function(e){deskTools.resizing&&(e=Q("DeskTools").getBoundingClientRect().right-e.clientX)<Q("DeskParent").clientWidth-10&&(Q("DeskTools").style.width=e+"px")});var deskPreferedStickyDisplay=-1;function deskSetDisplay(e){desktop.m.SetDisplay(deskPreferedStickyDisplay=parseInt(e))}var terminalNode,dblClickDetectArgs={t:0,x:0,y:0};function dblClickDetect(e){var t;1==e.buttons&&((t=Date.now())-dblClickDetectArgs.t<250&&Math.abs(e.clientX-dblClickDetectArgs.x)<2&&Math.abs(e.clientY-dblClickDetectArgs.y)<2&&!xxdialogMode&&null!=desktop&&Q("DeskControl").checked&&(null!=webRtcDesktop&&null!=webRtcDesktop.softdesktop?(webRtcDesktop.softdesktop.m.mousedblclick(e),desktop.m.sendKeepAlive()):desktop.m.mousedblclick(e)),dblClickDetectArgs.t=t,dblClickDetectArgs.x=e.clientX,dblClickDetectArgs.y=e.clientY)}function dmousedown(e){setSessionActivity(),e.addx=Q("DeskParent").scrollLeft,e.addy=Q("DeskParent").scrollTop,!xxdialogMode&&null!=desktop&&Q("DeskControl").checked&&(null!=webRtcDesktop&&null!=webRtcDesktop.softdesktop?(webRtcDesktop.softdesktop.m.mousedown(e),desktop.m.sendKeepAlive()):desktop.m.mousedown(e)),dblClickDetect(e)}function dmouseup(e){setSessionActivity(),e.addx=Q("DeskParent").scrollLeft,e.addy=Q("DeskParent").scrollTop,!xxdialogMode&&null!=desktop&&Q("DeskControl").checked&&(null!=webRtcDesktop&&null!=webRtcDesktop.softdesktop?(webRtcDesktop.softdesktop.m.mouseup(e),desktop.m.sendKeepAlive()):desktop.m.mouseup(e))}function dmousemove(e){setSessionActivity(),e.addx=Q("DeskParent").scrollLeft,e.addy=Q("DeskParent").scrollTop,!xxdialogMode&&null!=desktop&&Q("DeskControl").checked?(Q("Desk").style.cursor="",null!=webRtcDesktop&&null!=webRtcDesktop.softdesktop?(webRtcDesktop.softdesktop.m.mousemove(e),desktop.m.sendKeepAlive()):desktop.m.mousemove(e)):xxdialogMode||null==desktop||Q("DeskControl").checked||(Q("Desk").style.cursor="not-allowed")}function dmousewheel(e){return setSessionActivity(),e.addx=Q("DeskParent").scrollLeft,e.addy=Q("DeskParent").scrollTop,!(xxdialogMode||null==desktop||!Q("DeskControl").checked||(null!=webRtcDesktop&&null!=webRtcDesktop.softdesktop?(webRtcDesktop.softdesktop.m.mousewheel(e),desktop.m.sendKeepAlive()):desktop.m.mousewheel&&desktop.m.mousewheel(e),haltEvent(e),0))}function drotate(e){xxdialogMode||null==desktop||(desktop.m.setRotation(desktop.m.rotation+e),deskAdjust(),deskAdjust())}function stopProcess(e,t){return setModalContent("xxAddAgent","Proces controle",format('Stop proces #{0} "{1}"?',e,t)),showModal("xxAddAgentModal","idx_dlgOkButton",()=>stopProcessEx(3,e)),!1}function stopProcessEx(e,t){meshserver.send({action:"msg",type:"pskill",nodeid:currentNode._id,value:t}),setTimeout(refreshDeskTools,300)}function setupTerminal(){terminalNode!=currentNode&&null!=terminal&&terminalNode._id!=currentNode._id&&(terminal.Stop(),terminal=terminalNode=null),terminalNode=currentNode,updateTerminalButtons()}function updateTerminalButtons(){var e=null!=terminal&&0!=terminal.state,t=(3==terminalNode.mtype&&null!=terminalNode.agent&&4<terminalNode.agent.id&&512&features2&&(terminalNode.agent.caps=6),QV("disconnectbutton2span",1==e),QV("connectbutton2span",0==e&&null!=terminalNode.agent&&2&terminalNode.agent.caps&&3!=terminalNode.mtype),QV("connectbutton2sspan",512&features2&&0==e&&null!=terminalNode.agent&&2&terminalNode.agent.caps&&3!=terminalNode.agent.id&&0==(16777216&features2)),1==terminalNode.mtype?(QV("connectbutton2hspan",0==e&&null!=terminalNode.intelamt&&2==terminalNode.intelamt.state),QV("terminalSizeDropDown",0==e&&null!=terminalNode.intelamt&&2==terminalNode.intelamt.state)):(QV("connectbutton2hspan",0==e&&null!=terminalNode.intelamt&&2==terminalNode.intelamt.state&&null!=terminalNode.intelamt.ver),QV("terminalSizeDropDown",0==e&&null!=terminalNode.intelamt&&2==terminalNode.intelamt.state&&null!=terminalNode.intelamt.ver)),QV("termActionsBtn",3!=terminalNode.mtype),1==e&&3!=terminal.contype||null==terminalNode.agent||3==terminalNode.agent.id||4==terminalNode.agent.id?QH("terminalCustomUpperRight",""):QH("terminalCustomUpperRight","<a style=cursor:pointer onclick=cmsshportaction(1,event)>"+format("SSH poort {0}",terminalNode.sshport||22)+"</a>"),0!=(1&terminalNode.conn)||3==terminalNode.mtype),t=(QE("connectbutton2",t),QE("connectbutton2d",t),QE("connectbutton2s",t),QE("connectbutton2sd",t),0!=(6&terminalNode.conn)),t=(QE("connectbutton2h",t),QE("ctrlcbutton",e),QE("ctrlxbutton",e),QE("escbutton",e),QE("bsbutton",e),QE("pastebutton",e),QE("specialkeylist",e),QE("specialkeylistinput",e),QV("terminalSettingsButtons",terminal&&2==terminal.contype),terminal&&(Q("id_ttypebutton").value=terminalEmulations[terminal.m.terminalEmulation],Q("id_tfxkeysbutton").value=fxEmulations[terminal.m.fxEmulation],Q("id_tcrbutton").value="\r\n"==terminal.m.lineFeed?"CR+LF":"LF"),!(0===args.xterm||null!=terminal&&null==xterm));QV("termarea3xdiv",t),QV("Term",!t),QV("bsbutton",!t),QV("pastebutton",!t),QV("devListToolbarViewIcons2",t),QE("termSizeList",null==terminal)}function onTerminalStateChange(e,t){if(terminal==e){var n=t,o=(3==n&&2==e.contype&&n++,StatusStrs[n]);switch(3==n&&(3==e.contype&&(o+=", SSH"),1==e.webRtcActive)&&(o+=", WebRTC"),QH("termstatus",o),t){case 0:if(QH("termtitle",""),QV("termRecordIcon",!1),null==xterm)try{e.m.TermResetScreen(),e.m.TermDraw()}catch(e){}else xterm.dispose(),xterm=xtermfit=null;null!=e&&(e.Stop(),terminal=null);break;case 3:e&&1==e.serverIsRecording&&QV("termRecordIcon",!0),e.startTime=new Date,null==updateSessionTimer&&(updateSessionTimer=setInterval(updateSessionTime,1e3)),null!=xterm&&xterm.focus()}updateTerminalButtons()}}var autoConnectTerminalTimer=null;function autoConnectTerminal(e){autoConnectTerminalTimer=null==autoConnectTerminalTimer?setInterval(connectTerminal,100):(clearInterval(autoConnectTerminalTimer),null)}function CreateRemoteTunnel(e,t){var n={protocol:1};return null!=t&&"number"==typeof t.protocol&&(n.protocol=t.protocol),n.onTunnelUpdate=e,n.xxStateChange=function(e){},n.ProcessBinaryData=function(e){n.onTunnelUpdate(e)},n.ProcessData=function(e){n.onTunnelUpdate(e)},n.terminalEmulation=1,n.fxEmulation=0,n.lineFeed="\r\n",n}function tunnelUpdate(e){null!=xterm&&(xterm.writeUtf8?"string"==typeof e?xterm.writeUtf8(e):xterm.writeUtf8(new Uint8Array(e)):"string"==typeof e?xterm.write(e):xterm.write(new Uint8Array(e)))}function sshTunnelAuthDialog(e,t){function n(e,t){document.getElementById("xxAddAgentModal").removeEventListener("hide.bs.modal",n),connectTerminal()}var o="";e.askkeypass?o+=addHtmlFormFloating("Authenticatie",'<select id=dp2authmethod class="form-select" onchange=sshAuthUpdate(event)><option value=3 selected>Opgeslagen sleutel</option><option value=1>Gebruikersnaam wachtwoord</option><option value=2>Gebruikersnaam en sleutel</option></select>'):o+=addHtmlFormFloating("Authenticatie",'<select id=dp2authmethod class="form-select" onchange=sshAuthUpdate(event)><option value=1 selected>Gebruikersnaam wachtwoord</option><option value=2>Gebruikersnaam en sleutel</option></select>'),o=(o=(o+="<div id=d2userauth style=display:none>")+addHtmlFormFloating("Gebruikersnaam",'<input id=dp2user class="form-control" maxlength=64 autocomplete=off onkeyup=sshAuthUpdate(event) />')+"</div><div id=d2passauth style=display:none>")+addHtmlFormFloating("Wachtwoord",'<input type=password id=dp2pass class="form-control" maxlength=64 autocomplete=off onkeyup=sshAuthUpdate(event) />'),0==(4194304&features2)&&(o+=addHtmlValue("",'<label><input id=dp2keep type=checkbox class="form-check-input me-2">Onthoud inloggegevens</label>')),o=(o=(o+="</div><div id=d2keyauth style=display:none>")+addHtmlValue("Sleutelbestand",'<input type=file id=dp2key class="form-control" maxlength=64 autocomplete=off onchange=sshAuthUpdate(event) /><div id=d2badkey style=font-size:x-small>Het sleutelbestand moet de OpenSSH-indeling hebben.</div>'))+addHtmlFormFloating("Sleutelwachtwoord",'<input type=password id=dp2keypass class="form-control" maxlength=64 autocomplete=off onkeyup=sshAuthUpdate(event) />'),0==(4194304&features2)&&(o=(o+=addHtmlValue("",'<label><input id=dp2keep1 type=checkbox class="form-check-input me-2" onchange=sshAuthUpdate(event)>Onthoud gebruikeruser & sleutel</label>'))+addHtmlValue("",'<label><input id=dp2keep2 type=checkbox class="form-check-input me-2">Onthoud wachtwoord</label>')),o+="</div>",setModalContent("xxAddAgent","Authenticatie",o=e.askkeypass?(o+="<div id=d2keyauth2 style=display:none>")+addHtmlFormFloating("Wachtwoord",'<input type=password id=dp2keypass2 class="form-control" maxlength=64 autocomplete=off onkeyup=sshAuthUpdate(event) />')+"</div>":o);document.getElementById("xxAddAgentModal").addEventListener("hide.bs.modal",n),showModal("xxAddAgentModal","idx_dlgOkButton",()=>{document.getElementById("xxAddAgentModal").removeEventListener("hide.bs.modal",n),t(11,"ssh")}),Q("dp2user").focus(),sshAuthUpdate(),setTimeout(sshAuthUpdate,50)}function sshTunnelUpdate(e){if("string"==typeof e)if("{"==e[0]){var t=JSON.parse(e);switch(t.action){case"sshauth":sshTunnelAuthDialog(t,sshConnectEx);break;case"sshautoauth":terminal.socket.send(JSON.stringify({action:"sshautoauth",cols:xterm.cols,rows:xterm.rows,width:Q("termarea3xdiv").offsetWidth,height:Q("termarea3xdiv").offsetHeight}));break;case"connectionerror":p12setConsoleMsg("verbindingsfout",5e3);break;case"autherror":p12setConsoleMsg("Authenticatiefout",5e3);break;case"sessionerror":p12setConsoleMsg("Sessie verlopen",5e3);break;case"sessiontimeout":p12setConsoleMsg("Sessie timeout",5e3)}}else"~"==e[0]&&(xterm.writeUtf8?xterm.writeUtf8(e.substring(1)):xterm.write(e.substring(1)))}function sshAuthUpdate(e){var t;QV("d2userauth",3!=Q("dp2authmethod").value),QV("d2passauth",1==Q("dp2authmethod").value),QV("d2keyauth",2==Q("dp2authmethod").value),QV("d2keyauth2",3==Q("dp2authmethod").value),1==Q("dp2authmethod").value?QE("idx_dlgOkButton",0<Q("dp2user").value.length&&0<Q("dp2pass").value.length):3==Q("dp2authmethod").value?QE("idx_dlgOkButton",0<Q("dp2keypass2").value.length):(QE("idx_dlgOkButton",!1),0==(4194304&features2)&&QE("dp2keep2",Q("dp2keep1").checked),1==(0<Q("dp2user").value.length&&null!=Q("dp2key").files&&1==Q("dp2key").files.length&&Q("dp2key").files[0].size<8e3)&&((t=new FileReader).onload=function(e){e=0<=e.target.result.indexOf("-----BEGIN OPENSSH PRIVATE KEY-----")&&0<=e.target.result.indexOf("-----END OPENSSH PRIVATE KEY-----")||0<=e.target.result.indexOf("-----BEGIN RSA PRIVATE KEY-----")&&0<=e.target.result.indexOf("-----END RSA PRIVATE KEY-----");QE("idx_dlgOkButton",e),QS("d2badkey").color=e?"#000":"#F00"},t.readAsText(Q("dp2key").files[0]))),e&&13==e.keyCode&&e.target&&1==Q("dp2authmethod").value&&("dp2user"==e.target.id&&Q("dp2pass").focus(),"dp2pass"==e.target.id)&&dialogclose(1)}function sshConnectEx(e){var t,n,o;0==e?null!=terminal&&connectTerminal():(t=0,1==Q("dp2authmethod").value?(0==(4194304&features2)&&(t=Q("dp2keep").checked?1:0),terminal.socket.send(JSON.stringify({action:"sshauth",username:Q("dp2user").value,password:Q("dp2pass").value,keep:t,cols:xterm.cols,rows:xterm.rows,width:Q("termarea3xdiv").offsetWidth,height:Q("termarea3xdiv").offsetHeight}))):3==Q("dp2authmethod").value?terminal.socket.send(JSON.stringify({action:"sshkeyauth",keypass:Q("dp2keypass2").value,cols:xterm.cols,rows:xterm.rows,width:Q("termarea3xdiv").offsetWidth,height:Q("termarea3xdiv").offsetHeight})):(0==(4194304&features2)&&1==(t=Q("dp2keep1").checked?1:0)&&(t+=Q("dp2keep2").checked?1:0),e=new FileReader,n=Q("dp2user").value,o=Q("dp2keypass").value,e.onload=function(e){terminal.socket.send(JSON.stringify({action:"sshauth",username:n,keypass:o,key:e.target.result,keep:t,cols:xterm.cols,rows:xterm.rows,width:Q("termarea3xdiv").offsetWidth,height:Q("termarea3xdiv").offsetHeight}))},e.readAsText(Q("dp2key").files[0])))}function xTermSendResize(){(xtermResizeTimer=null)!=xterm&&null!=terminal&&null!=terminal.sendCtrlMsg&&("sshterminalrelay.ashx"==terminal.urlname?terminal.socket.send(JSON.stringify({action:"resize",cols:xterm.cols,rows:xterm.rows,width:Q("termarea3xdiv").offsetWidth,height:Q("termarea3xdiv").offsetHeight})):terminal.sendCtrlMsg(JSON.stringify({ctrlChannel:"102938",type:"termsize",cols:xterm.cols,rows:xterm.rows})))}function connectTerminal(e,t,n){if(p12clearConsoleMsg(),terminal)"ssh"==xxdialogTag&&setDialogMode(0),terminal.Stop(),terminal=null,fullscreen&&deskToggleFull();else if(2==t){if(null==terminalNode.intelamt.user||""==terminalNode.intelamt.user)return void editDeviceAmtSettings(terminalNode._id,connectTerminal,2);var o={};1==Q("termSizeList").value?(o.cols=80,o.rows=25):2==Q("termSizeList").value&&(o.cols=100,o.rows=30),fullscreen&&deskToggleFull(),QV("termarea3xdiv",!1),QV("Term",!0),(terminal=CreateAmtRedirect(CreateAmtRemoteTerminal("Term",o),authCookie)).debugmode=debugmode,terminal.m.debugmode=debugmode,terminal.m.onTitleChange=function(e,t){QH("termtitle"," - "+EscapeHtml(t))},terminal.onStateChanged=onTerminalStateChange,terminal.Start(terminalNode._id,16994,"*","*",0),terminal.contype=2,Q("id_ttypebutton").value=terminalEmulations[terminal.m.terminalEmulation]}else{o={protocol:null!=n&&"number"==typeof n.protocol?n.protocol:1};n&&n.requireLogin&&(o.requireLogin=!0),n&&n.consent&&(o.consent=n.consent),-1==[1,2,3,4,21,22].indexOf(currentNode.agent.id)&&(1==Q("termSizeList").value?(o.cols=80,o.rows=25,o.xterm=!0):2==Q("termSizeList").value?(o.cols=100,o.rows=30,o.xterm=!0):3==Q("termSizeList").value&&(o.cols=Math.floor((Q("column_l").clientWidth-60)/10),o.rows=Math.floor((Q("column_l").clientHeight-120)/20),o.xterm=!0)),e&&1==e.shiftKey&&(4<currentNode.agent.id?1==o.protocol&&(o.protocol=7):1==o.protocol&&(o.protocol=6)),null!=serverinfo.linuxshell&&4<currentNode.agent.id&&("root"==serverinfo.linuxshell&&(o.protocol=1,delete o.requireLogin),"user"==serverinfo.linuxshell&&(o.protocol=8,delete o.requireLogin),"login"==serverinfo.linuxshell)&&(o.protocol=1,o.requireLogin=!0),0!==args.xterm?(QV("termarea3xdiv",!0),QV("Term",!1),null!=xterm&&xterm.dispose(),xtermfit=new FitAddon.FitAddon,xterm=new Terminal,xtermfit&&xterm.loadAddon(xtermfit),xterm.open(Q("termarea3xdiv")),xterm.onData(function(e){null!=terminal&&("sshterminalrelay.ashx"==terminal.urlname?terminal.socket.send("~"+e):terminal.sendText(e))}),xtermfit&&xtermfit.fit(),xterm.onTitleChange(function(e){QH("termtitle"," - "+EscapeHtml(e))}),xterm.onResize(function(e){xtermResizeTimer&&clearTimeout(xtermResizeTimer),xtermResizeTimer=setTimeout(xTermSendResize,200)}),o.cols=xterm.cols,o.rows=xterm.rows,terminal=CreateAgentRedirect(meshserver,CreateRemoteTunnel(3==t?sshTunnelUpdate:tunnelUpdate,o),serverPublicNamePort,authCookie,authRelayCookie,domainUrl),3==t&&(terminal.urlname="sshterminalrelay.ashx"),terminal.debugmode=debugmode,terminal.m.debugmode=debugmode,(terminal.options=o).requireLogin&&(terminal.options.requireLogin=!0),terminal.Start(terminalNode._id),terminal.onStateChanged=onTerminalStateChange,terminal.contype=t,terminal.attemptWebRTC=!1,terminal.onConsoleMessageChange=function(){p12setConsoleMsg(terminal.consoleMessage?formatAgentConsoleMessage(terminal.consoleMessage,terminal.consoleMessageId,terminal.consoleMessageArgs):null,terminal.consoleMessageTimeout)}):(QV("termarea3xdiv",!1),QV("Term",!0),(terminal=CreateAgentRedirect(meshserver,CreateAmtRemoteTerminal("Term",o),serverPublicNamePort,authCookie,authRelayCookie,domainUrl)).options=o,terminal.debugmode=debugmode,terminal.m.debugmode=debugmode,terminal.m.onTitleChange=function(e,t){QH("termtitle"," - "+EscapeHtml(t))},terminal.m.lineFeed=0<=[1,2,3,4,21,22].indexOf(currentNode.agent.id)?"\r\n":"\r",terminal.attemptWebRTC=!1,terminal.onStateChanged=onTerminalStateChange,terminal.onConsoleMessageChange=function(){p12setConsoleMsg(terminal.consoleMessage?formatAgentConsoleMessage(terminal.consoleMessage,terminal.consoleMessageId,terminal.consoleMessageArgs):null,terminal.consoleMessageTimeout)},terminal.Start(terminalNode._id),terminal.contype=t,terminal.m.terminalEmulation=0,terminal.m.fxEmulation=0,Q("id_ttypebutton").value=terminalEmulations[0])}Q("connectbutton2").blur()}var terminalEmulations=["UTF8 Terminal","Extended ASCII","Intel ASCII"];function termToggleType(){terminal&&!xxdialogMode&&(terminal.m.terminalEmulation=(terminal.m.terminalEmulation+1)%3,Q("id_ttypebutton").value=terminalEmulations[terminal.m.terminalEmulation],Q("id_ttypebutton").blur())}var filesNode,fxEmulations=["Intel (F10 = ESC+[OM)","Alternatief (F10 = ESC + 0)","VT100+ (F10 = ESC+[OY)"];function termToggleFx(){terminal&&!xxdialogMode&&(terminal.m.fxEmulation=(terminal.m.fxEmulation+1)%3,Q("id_tfxkeysbutton").value=fxEmulations[terminal.m.fxEmulation],Q("id_tfxkeysbutton").blur())}function termToggleCr(){terminal&&!xxdialogMode&&("\n"==terminal.m.lineFeed?terminal.m.lineFeed="\r\n":terminal.m.lineFeed="\n",Q("id_tcrbutton").value="\r\n"==terminal.m.lineFeed?"CR+LF":"LF")}function termSendKey(e,t){terminal&&!xxdialogMode&&(null!=xterm?("sshterminalrelay.ashx"==terminal.urlname?terminal.socket.send("~"+String.fromCharCode(e)):terminal.sendText?terminal.sendText(String.fromCharCode(e)):terminal.send(String.fromCharCode(e)),xterm.focus()):null!=terminal&&(terminal.m.TermSendKey(e),Q(t).blur()))}function showTermPasteDialog(){terminal&&!xxdialogMode&&(Q("pastebutton").blur(),setModalContent("xxAddAgent","Plakken",'<textarea id=d2pasteText style="width:100%;height:184px;resize:none"></textarea>'),showModal("xxAddAgentModal","idx_dlgOkButton",()=>showTermPasteDialogEx()),Q("d2pasteText").focus())}function showTermPasteDialogEx(){terminal&&terminal.m.TermSendKeys(Q("d2pasteText").value)}function sendSpecialKey(){null!=xterm?("sshterminalrelay.ashx"==terminal.urlname?terminal.socket.send("~"+String.fromCharCode(Q("specialkeylist").value)):terminal.sendText(String.fromCharCode(Q("specialkeylist").value)),xterm.focus()):null!=terminal&&(terminal.m.TermSendKey(Q("specialkeylist").value),Q("specialkeylist").blur(),Q("specialkeylistinput").blur())}function setupFiles(){filesNode!=currentNode&&null!=files&&filesNode._id!=currentNode._id&&(files.Stop(),files=filesNode=null);var e=0!=(1&(filesNode=currentNode).conn)||3==filesNode.mtype;QE("p13Connect",e),QE("p13Connectdrop",e),QE("p13Connects",e),QE("p13Connectsdrop",e),QV("p13Connectspan",null==files&&2==filesNode.mtype),QV("p13Connectsspan",0!=(512&features2)&&null!=filesNode.agent&&3!=filesNode.agent.id&&4!=filesNode.agent.id&&0==(8388608&features2)),QV("p13Disconnect",null!=files),p13setActions()}function onFilesStateChange(e,t){setSessionActivity(),QV("p13Connectspan",0==t&&2==filesNode.mtype),QV("p13Connectsspan",0==t&&512&features2&&null!=filesNode.agent&&3!=filesNode.agent.id&&4!=filesNode.agent.id&&0==(8388608&features2)),QV("p13Disconnect",0!=t);var n=StatusStrs[t];switch(3==t&&(2==files.contype&&(n+=", SFTP"),1==files.webRtcActive)&&(n+=", WebRTC"),Q("p13Status").textContent=n,t){case 0:QH("p13files",""),p13filetree=null,p13filetreelocation=[],QH("p13currentpath",""),QE("p13FolderUp",!1),QV("filesRecordIcon",!1),p13setActions(),null!=files&&(files.Stop(),files=null),"fileMsgDialog"==xxdialogTag&&setDialogMode(0),null!=uploadFile&&(p13uploadFileTransferDone(),uploadFile=null);break;case 3:if(p13filetreelocation=[],p13targetpath="",files){var o=[];try{o=JSON.parse(getstore("_devFilePaths","[]"))}catch(e){}for(var a=0;a<o.length;a++)o[a].n==currentNode._id&&(p13targetpath=o[a].p);p13filetreelocation=p13targetpath.split("/"),files.sendText({action:"ls",reqid:1,path:p13targetpath}),1==files.serverIsRecording&&QV("filesRecordIcon",!0)}}}function CreateRemoteFiles(e){var t={protocol:5};return t.onFileUpdate=e,t.xxStateChange=function(e){},t.ProcessData=function(e){t.onFileUpdate(e)},t}var autoConnectFilesTimer=null;function autoConnectFiles(e){autoConnectFilesTimer=null==autoConnectFilesTimer?setInterval(connectFiles,100):(clearInterval(autoConnectFilesTimer),null)}function connectFiles(e,t,n){p13clearConsoleMsg(),files?(files.Stop(),files=null):(files=CreateAgentRedirect(meshserver,CreateRemoteFiles(p13gotFiles),serverPublicNamePort,authCookie,authRelayCookie,domainUrl),2==t&&(files.urlname="sshfilesrelay.ashx"),files.contype=t,files.options={consent:n},files.attemptWebRTC=attemptWebRTC,files.webrtcconfig=webrtcconfiguration,files.onStateChanged=onFilesStateChange,files.onConsoleMessageChange=function(){files.consoleMessage?(Q("p13FilesConsoleMsg").innerHTML+=formatAgentConsoleMessage(files.consoleMessage,files.consoleMessageId,files.consoleMessageArgs),QV("p13FilesConsoleMsg",!0),null!=p13FilesConsoleMsgTimer&&clearTimeout(p13FilesConsoleMsgTimer),files.consoleMessageTimeout&&(p13FilesConsoleMsgTimer=setTimeout(p13clearConsoleMsg,1e3*files.consoleMessageTimeout))):p13clearConsoleMsg()},files.Start(filesNode._id)),p13clipboard=p13clipboardFolder=null,p13clipboardCut=0,p13updateClipview()}var p13sortorder,p13filetree=null,p13targetpath=null,p13filetreelocation=[];function p13fileOperationDialogEx(e){0==e&&null!=files&&files.sendText({action:"cancel"})}function p13gotFiles(t){if(0<t.length&&123!=t.charCodeAt(0))p13gotDownloadBinaryData(t);else{try{t=JSON.parse(decode_utf8(t))}catch(e){try{t=JSON.parse(t)}catch(e){return void console.log("Unable to parse: "+t)}}if("download"==t.action)p13gotDownloadCommand(t);else if("findfile"==t.action)xxdialogTag==t.reqid&&(null==t.r?(QE("d2findFilter",!0),QE("filefind_dlgOkButton",!0),xxdialogTag=null,""==Q("d2findResults").innerHTML&&QH("d2findResults","<div style=text-align:center;margin:10px><i>Geen bestanden gevonden</i></div>")):QA("d2findResults","<div style=white-space:nowrap>"+EscapeHtml(t.r)+"</div>"));else if(null!=t.action&&t.action.startsWith("upload"))p13gotUploadData(t);else{switch(t.action){case"sshauth":return void sshTunnelAuthDialog(t,p13sshConnectEx);case"autherror":return void p13setConsoleMsg("Authenticatiefout",5e3);case"connectionerror":return void p13setConsoleMsg("verbindingsfout",5e3);case"sessionerror":return void p13setConsoleMsg("Sessie verlopen",5e3);case"sessiontimeout":return void p13setConsoleMsg("Sessie timeout",5e3)}if("dialogmessage"==t.action)null==t.msg&&"fileMsgDialog"==xxdialogTag?setDialogMode(0):"zipping"!=t.msg||xxdialogMode&&"fileMsgDialog"!=xxdialogTag?"unzipping"!=t.msg||xxdialogMode&&"fileMsgDialog"!=xxdialogTag?"unziperror"!=t.msg||xxdialogMode&&"fileMsgDialog"!=xxdialogTag?"zippingFile"!=t.msg||xxdialogMode&&"fileMsgDialog"!=xxdialogTag||(setModalContent("xxAddAgent","Bestandsbewerking","<div style=margin:10px>"+EscapeHtml(t.file)+"</div><br /><progress value="+EscapeHtml(t.progress)+" style=width:100% max=100 />"),showModal("xxAddAgentModal","idx_dlgOkButton",()=>p13fileOperationDialogEx(10))):(setModalContent("xxAddAgent","Bestandsbewerking","<div style=margin:10px>Fout bij uitpakken</div><br />"+EscapeHtml(t.error)),showModal("xxAddAgentModal","idx_dlgOkButton")):(setModalContent("xxAddAgent","Bestandsbewerking","<div style=margin:10px>Bestand uitpakken...</div>"),showModal("xxAddAgentModal","idx_dlgOkButton")):(setModalContent("xxAddAgent","Bestandsbewerking","<div style=margin:10px>Bestanden comprimeren...</div>"),showModal("xxAddAgentModal","idx_dlgOkButton",()=>p13fileOperationDialogEx(10)));else if("refresh"==t.action)p13folderup(9999);else if(null!=t.path)if(null==t.dir)""!=p13targetpath&&p13folderup();else if(t.path=t.path.replace(/\//g,"\\"),null!=p13filetree&&t.path==p13filetree.path){var e=p13getCheckedNames();p13filetree=t,p13updateFiles(e)}else{for(var n=t.path.replace(/\//g,"\\"),o=p13targetpath.replace(/\//g,"\\");0<n.length&&"\\"==n[0];)n=n.substring(1);for(;0<o.length&&"\\"==o[0];)o=o.substring(1);(n==o||"\\"==t.path&&""==p13targetpath)&&(p13filetree=t,p13updateFiles())}}}}function p13sshConnectEx(e){var t,n,o;0==e?null!=files&&connectFiles():(t=0,1==Q("dp2authmethod").value?(0==(4194304&features2)&&(t=Q("dp2keep").checked?1:0),files.socket.send(JSON.stringify({action:"sshauth",username:Q("dp2user").value,password:Q("dp2pass").value,keep:t}))):3==Q("dp2authmethod").value?files.socket.send(JSON.stringify({action:"sshkeyauth",keypass:Q("dp2keypass2").value})):(0==(4194304&features2)&&1==(t=Q("dp2keep1").checked?1:0)&&(t+=Q("dp2keep2").checked?1:0),e=new FileReader,n=Q("dp2user").value,o=Q("dp2keypass").value,e.onload=function(e){files.socket.send(JSON.stringify({action:"sshauth",username:n,keypass:o,key:e.target.result,keep:t}))},e.readAsText(Q("dp2key").files[0])))}function p13getCheckedNames(){for(var e=[],t=document.getElementsByName("fd"),n=0;n<t.length;n++)t[n].checked&&e.push(p13filetree.dir[t[n].value].n);return e}function p13updateFiles(e){var t="",n="",o='<a href=# style=cursor:pointer onclick="return p13folderup(0)">Root</a>';if(null!=p13filetree){var a=p13filetree.path.split("\\");for(v in p13filetreelocation=[],a)""!=a[v]&&p13filetreelocation.push(a[v]);for(v in p13filetreelocation)o+=' / <a href=# style=cursor:pointer onclick="return p13folderup('+(parseInt(v)+1)+')">'+EscapeHtml(p13filetreelocation[v])+"</a>";var i=p13filetreelocation.join("/"),s=p13sort_files(p13filetree.dir);for(v in s){var r=s[v],l=r.n,d=70<l.length?'<span title="'+EscapeHtml(l)+'">'+EscapeHtml(l.substring(0,70))+"...</span>":EscapeHtml(l),c="",u=(null!=r.d&&(u=new Date(r.d),c=printDateTime(u="number"==typeof r.d?new Date(1e3*r.d):u)+"&nbsp;"),"");if(null!=r.s){var p=["Bytes","KB","MB","GB","TB"];let e=parseInt(Math.floor(Math.log(Math.abs(r.s))/Math.log(1024)),10);var m=Q("p13sizedropdown").options[Q("p13sizedropdown").selectedIndex],u=0==Q("p13sizedropdown").value?0===r.s?"n/a":0===e?r.s+" "+p[e]:(r.s/1024**e).toFixed(2)+" "+p[e]:1==Q("p13sizedropdown").value?getFileSizeStr(r.s):(r.s/2**m.value).toFixed(2)+" "+m.title}p="";r.t<3?(p="<div class=filelist file=999>",p=(p+='<input file=999 style=float:left name=fd class=fcb type=checkbox class="form-check-input me-2" onchange=p13setActions() value=\''+r.nx+'\'>&nbsp;<span style=float:right title=""></span>')+"<span><div class=fileIcon"+("REMOVABLE"==r.dt?5:"CDROM"==r.dt?6:r.t)+' onclick=p13folderset("'+encodeURIComponentEx(r.nx)+'")></div><a href=# style=cursor:pointer onclick=\'return p13folderset("'+encodeURIComponentEx(r.nx)+"\")'>",isWindowsNode(currentNode)&&r.dt&&currentNode.volumes&&currentNode.volumes[d.charAt(0).toUpperCase()]&&currentNode.volumes[d.charAt(0).toUpperCase()].name?p+=currentNode.volumes[d.charAt(0).toUpperCase()].name+" ("+d+")":p+=d,p+="</a></span></div>"):(m=d,0<r.s&&(m=3==filesNode.mtype?"<a href=# style=cursor:pointer onclick=\"return p13downloadfile('"+encodeURIComponentEx(i+"/"+l)+"','"+encodeURIComponentEx(l)+"',"+r.s+')">'+d+"</a>":'<a onclick=downloadFile("devicefile.ashx?c='+authCookie+"&m="+currentNode.meshid.split("/")[2]+"&n="+currentNode._id.split("/")[2]+"&f="+encodeURIComponentEx(i+"/"+l)+'","'+encodeURIComponentEx(l)+'") style=cursor:pointer>'+d+"</a>"),p="<div id=fileEntry cmenu=filesContextMenu fileIndex="+v+' class=filelist file=3><input file=3 style=float:left name=fd class=fcb type=checkbox class="form-check-input me-2" onchange=p13setActions() value=\''+r.nx+"'>&nbsp;<span class=fsize>"+c+"</span><span style=float:right>"+EscapeHtml(u)+"</span><span><div class=fileIcon"+r.t+"></div>"+m+"</span></div>"),r.t<3?t+=p:n+=p}if(QH("p13files",t+n),QH("p13currentpath",o),QE("p13FolderUp",0!=p13filetreelocation.length),null!=e)for(var g=document.getElementsByName("fd"),v=0;v<g.length;v++)0<=e.indexOf(p13filetree.dir[g[v].value].n)&&(g[v].checked=!0);p13setActions()}}function p13openfilefolder(){setModalContent("xxAddAgent","Open bestand/map","Are you sure you want to open this file/folder on the remote devices desktop ?"),showModal("xxAddAgentModal","idx_dlgOkButton",()=>p13openfilefolderEx())}function p13openfilefolderEx(){for(var e="",t=document.getElementsByName("fd"),n=0;n<t.length;n++)t[n].checked&&(e=(isWindowsNode(currentNode)?"":"/")+p13filetreelocation.join(isWindowsNode(currentNode)?"\\":"/")+(isWindowsNode(currentNode)?"\\":"/")+p13filetree.dir[t[n].value].n);""!=e&&files.sendText({action:"open",reqid:1,path:e,dir:1==p13getFileSelDirCount()})}function p13gotofolder(){xxdialogButtons=3,setModalContent("xxAddAgent","Ga naar map",'<input type=text id=p13folderinput style=width:100% placeholder="'+(isWindowsNode(currentNode)?"C:\\":"/var/www")+'" />'),showModal("xxAddAgentModal","idx_dlgOkButton",p13gotofolderEx),focusTextBox("p13folderinput")}function p13gotofolderEx(){p13targetpath=Q("p13folderinput").value.split("\\").join("/"),files&&(p13storeCurrentPath(p13targetpath),files.sendText({action:"ls",reqid:1,path:p13targetpath}))}function p13folderset(e){p13targetpath=joinPaths(p13filetree.path,p13filetree.dir[e].n).split("\\").join("/"),files&&(p13storeCurrentPath(p13targetpath),files.sendText({action:"ls",reqid:1,path:p13targetpath}))}function p13folderup(e){if(null==e)p13filetreelocation.pop();else for(;p13filetreelocation.length>e;)p13filetreelocation.pop();return p13targetpath=p13filetreelocation.join("/"),files&&(p13storeCurrentPath(p13targetpath),files.sendText({action:"ls",reqid:1,path:p13targetpath})),!1}function p13storeCurrentPath(e){var t=[],n=-1;try{t=JSON.parse(getstore("_devFilePaths","[]"))}catch(e){}for(var o=0;o<t.length;o++)t[o].n==currentNode._id&&(n=o);for(0<=n&&t.splice(n,1),t.push({n:currentNode._id,p:e});40<t.length;)t.shift();putstore("_devFilePaths",JSON.stringify(t))}function p13findfile(){var e;xxdialogMode||(e=addHtmlFormFloating("Filter",'<input id=d2findFilter class="form-control" onkeyup=p13findfileValidate() onkeydown=p13findfileDown(event) placeholder="*.txt"></input>'),setModalContent("xxAddAgent","Zoek bestanden",e=(e+='<div id=d2findResults style="width:100%;height:184px;background-color:white;border:1px solid black;padding:3px;overflow:scroll;margin-top:8px"></div>')+"<div style=margin-top:8px><input id=filefind_dlgCancelButton type=button value=Sluiten style=float:right;width:80px;margin-left:5px onclick=p13findfileCancel()>"+"<input id=filefind_dlgOkButton type=submit value=Zoeken style=float:right;width:80px onclick=p13findfileEx()><br /><br /></div>"),showModal("xxAddAgentModal","idx_dlgOkButton"),p13findfileValidate(),Q("d2findFilter").focus())}function p13findfileDown(e){"invoeren"==e.code&&p13findfileEx()}function p13findfileValidate(){QE("filefind_dlgOkButton",0<Q("d2findFilter").value.length)}function p13findfileCancel(){null!=xxdialogTag&&files.sendText({action:"cancelfindfile",reqid:xxdialogTag}),dialogclose(0)}function p13findfileEx(e,t){var n,o,a;0!=Q("d2findFilter").value.length&&(n=0<currentNode.agent.id&&currentNode.agent.id<5||14==currentNode.agent.id||34==currentNode.agent.id,a=p13filetreelocation.join(o=n?"\\":"/")+o,n||(a=o+a),xxdialogTag="find:"+Math.random(),files.sendText({action:"findfile",reqid:xxdialogTag,path:a,filter:Q("d2findFilter").value}),QH("d2findResults",""),QE("d2findFilter",!1),QE("filefind_dlgOkButton",!1))}function p13sort_filename(e,t){return e.ln>t.ln?+p13sortorder:e.ln<t.ln?-1*p13sortorder:0}function p13sort_timestamp(e,t){return e.d>t.d?+p13sortorder:e.d<t.d?-1*p13sortorder:0}function p13sort_bysize(e,t){return e.s==t.s?p13sort_filename(e,t):(e.s-t.s)*p13sortorder}function p13sort_files(e){var t,n=[],o=Q("p13sortdropdown").value;for(t in e)e[t].nx=t,null==e[t].s&&(e[t].s=0),null==e[t].n&&(e[t].n=t),e[t].ln=e[t].n.toLowerCase(),n.push(e[t]);return p13sortorder=1,3<o&&(p13sortorder=-1,o-=3),1==o?n.sort(p13sort_filename):2==o?n.sort(p13sort_bysize):3==o&&n.sort(p13sort_timestamp),n}function p13setActions(){var e,t,n,o,a=null!=currentNode.agent&&14!=currentNode.agent.id;null==p13filetree?(QE("p13DeleteFileButton",!1),QE("p13NewFolderButton",!1),QE("p13UploadButton",!1),QE("p13RenameFileButton",!1),QE("p13ViewFileButton",!1),QE("p13SelectAllButton",!1),Q("p13SelectAllButton").value="Selecteer alles",QE("p13RefreshButton",!1),QE("p13FindButton",!1),QE("p13CutButton",!1),QE("p13CopyButton",!1),QE("p13ZipButton",!1),QE("p13UnZipButton",!1),QE("p13PasteButton",!1),QE("p13GoToFolderButton",!1),QE("p13DownloadButton",!1),QE("p13OpenButton",!1)):(e=p13getFileSelCount(),t=p13getFileCount(),n=p13getFileSelCount(!1),o=0<currentNode.agent.id&&currentNode.agent.id<5||14==currentNode.agent.id||34==currentNode.agent.id,QE("p13DeleteFileButton",0<e&&(0<p13filetreelocation.length||0==o)),QE("p13NewFolderButton",a&&(0<p13filetreelocation.length||0==o)),QE("p13UploadButton",0<p13filetreelocation.length||0==o||14==currentNode.agent.id),QE("p13RenameFileButton",a&&1==e&&(0<p13filetreelocation.length||0==o)),QE("p13ViewFileButton",a&&1==e&&1==n&&(0<p13filetreelocation.length||0==o)),QE("p13SelectAllButton",0<t),Q("p13SelectAllButton").value=0<e?"Selecteer niets":"Selecteer alles",QE("p13RefreshButton",!0),QE("p13FindButton",a&&(0<p13filetreelocation.length||0==o)),QE("p13CutButton",a&&0<e&&e==n&&(0<p13filetreelocation.length||0==o)),QE("p13CopyButton",a&&0<e&&e==n&&(0<p13filetreelocation.length||0==o)),QE("p13ZipButton",a&&0<e&&(0<p13filetreelocation.length||0==o)),QE("p13UnzipButton",a&&1==e&&1==n&&(0<p13filetreelocation.length||0==o)&&p13getFileSelAllowedExt(".zip")),QE("p13PasteButton",a&&(0<p13filetreelocation.length||0==o)&&null!=p13clipboard&&0<p13clipboard.length),QE("p13GoToFolderButton",a),QE("p13OpenButton",a&&1==e),QE("p13DownloadButton",0<e&&e==n&&(0<p13filetreelocation.length||0==o))),1==(null!=files&&0!=files.state)&&2!=files.contype||null==filesNode.agent||3==filesNode.agent.id||4==filesNode.agent.id?QH("filesCustomUpperRight",""):QH("filesCustomUpperRight","<a style=cursor:pointer onclick=cmsshportaction(1,event)>"+format("SSH poort {0}",filesNode.sshport||22)+"</a>"),QV("filesActionsBtn",3!=filesNode.mtype),QV("p13FindButton",3!=filesNode.mtype),QV("p13CutButton",3!=filesNode.mtype),QV("p13CopyButton",3!=filesNode.mtype),QV("p13ZipButton",3!=filesNode.mtype),QV("p13UnzipButton",3!=filesNode.mtype),QV("p13PasteButton",3!=filesNode.mtype)}function p13getFileSelCount(e){for(var t=0,n=document.getElementsByName("fd"),o=0;o<n.length;o++)!n[o].checked||0==e&&"3"!=n[o].attributes.file.value||t++;return t}function p13getFileSelDirCount(){for(var e=0,t=document.getElementsByName("fd"),n=0;n<t.length;n++)t[n].checked&&"999"==t[n].attributes.file.value&&e++;return e}function p13getFileCount(){return document.getElementsByName("fd").length}function p13getFileSelAllowedExt(e){for(var t=document.getElementsByName("fd"),n=0;n<t.length;n++)if(t[n].checked&&!p13filetree.dir[t[n].value].n.endsWith(e))return!1;return!0}function p13selectallfile(){for(var e=0==p13getFileSelCount(),t=document.getElementsByName("fd"),n=0;n<t.length;n++)t[n].checked=e;p13setActions()}function p13createfolder(){setModalContent("xxAddAgent","Nieuwe map","<input type=text id=p13renameinput maxlength=64 onkeyup=p13fileNameCheck(event) style=width:100% />"),showModal("xxAddAgentModal","idx_dlgOkButton",()=>p13createfolderEx()),focusTextBox("p13renameinput"),p13fileNameCheck()}function p13createfolderEx(){files.sendText({action:"mkdir",reqid:1,path:p13filetreelocation.join("/")+"/"+Q("p13renameinput").value}),p13folderup(999)}function p13deletefile(){var e=p13getFileSelCount(),t=0<p13getFileSelDirCount()?'<br /><br /><label><input type=checkbox class="form-check-input me-2" id=p13recdeleteinput>Recursieve verwijdering</label><br>':"<input type=checkbox class=\"form-check-input me-2\" id=p13recdeleteinput style='display:none'>";setModalContent("xxAddAgent","Verwijderen",1<e?format("Verwijder {0} gelecteerde items?",e)+t:"Verwijder geselecteerde item?"+t),showModal("xxAddAgentModal","idx_dlgOkButton",()=>p13deletefileEx())}function p13deletefileEx(){for(var e=[],t=document.getElementsByName("fd"),n=0;n<t.length;n++)t[n].checked&&e.push(p13filetree.dir[t[n].value].n);files.sendText({action:"rm",reqid:1,path:p13filetreelocation.join("/"),delfiles:e,rec:Q("p13recdeleteinput").checked}),p13folderup(999)}function p13renamefile(){for(var e,t=document.getElementsByName("fd"),n=0;n<t.length;n++)t[n].checked&&(e=p13filetree.dir[t[n].value].n);setModalContent("xxAddAgent","Hernoemen",'<input type=text id=p13renameinput maxlength=64 onkeyup=p13fileNameCheck(event) style=width:100% value="'+e+'" />'),showModal("xxAddAgentModal","idx_dlgOkButton",()=>p13renamefileEx(3,{oldname:e})),focusTextBox("p13renameinput"),p13fileNameCheck()}function p13renamefileEx(e,t){t.newname=Q("p13renameinput").value,files.sendText(t),p13folderup(999)}function p13fileNameCheck(e){var t=isFilenameValid(Q("p13renameinput").value);QE("idx_dlgOkButton",t),1==t&&null!=e&&13==e.keyCode&&dialogclose(1)}function p13uploadFile(){setModalContent("xxAddAgent","Upload bestand",'<input type=file name=files id=p13uploadinput class="form-control" multiple=multiple onchange="updateUploadDialogOk(\'p13uploadinput\')" />'),showModal("xxAddAgentModal","idx_dlgOkButton",()=>p13uploadFileEx()),updateUploadDialogOk("p13uploadinput")}function updateUploadDialogOk(e){QE("idx_dlgOkButton",0<Q("p13uploadinput").files.length)}function p13uploadFileEx(){return p13doUploadFiles(Q("p13uploadinput").files),!1}function p13viewfile(){for(var e=document.getElementsByName("fd"),t=0;t<e.length;t++)if(e[t].checked){p13filetree.dir[e[t].value].s<=204800?p13downloadfile(encodeURIComponentEx(p13filetreelocation.join("/")+"/"+p13filetree.dir[e[t].value].n),encodeURIComponentEx(p13filetree.dir[e[t].value].n),p13filetree.dir[e[t].value].s,"viewer"):messagebox("Bestandsberwerker","Alleen bestanden kleiner dan 200k kunnen worden bewerkt.");break}}function p13unzipFile(){for(var e,t,n,o=document.getElementsByName("fd"),a=0;a<o.length;a++)o[a].checked&&(e=isWindowsNode(currentNode)?"\\":"/",t=(isWindowsNode(currentNode)?"":"/")+p13filetreelocation.join(e)+e+p13filetree.dir[o[a].value].n.split(".zip")[0]+e,n=(isWindowsNode(currentNode)?"":"/")+p13filetreelocation.join(e)+e+p13filetree.dir[o[a].value].n);setModalContent("xxAddAgent","Uitpakken naar map",'<input type=text id=p13unzipfolderinput maxlength=64 style=width:100% value="'+t+'" />'),showModal("xxAddAgentModal","idx_dlgOkButton",p13unzipFileEx(3,{action:"unzip",input:n})),focusTextBox("p13unzipfolderinput")}function p13unzipFileEx(e,t){t.dest=Q("p13unzipfolderinput").value,files.sendText(t)}function p13zipFiles(){for(var e=[],t=document.getElementsByName("fd"),n=0;n<t.length;n++)t[n].checked&&e.push(p13filetree.dir[t[n].value].n);setModalContent("xxAddAgent","Zip bestandsnaam",'<input type=text id=p13renameinput maxlength=64 onkeyup=p13fileNameCheck(event) style=width:100% value="" />'),showModal("xxAddAgentModal","idx_dlgOkButton",()=>p13zipFilesEx(3,{action:"zip",path:p13filetreelocation.join("/"),files:e})),focusTextBox("p13renameinput"),p13fileNameCheck()}function p13zipFilesEx(e,t){t.output=Q("p13renameinput").value,t.output.toLowerCase().endsWith(".zip")||(t.output+=".zip"),files.sendText(t)}var p13clipboard=null,p13clipboardFolder=null,p13clipboardCut=0;function p13copyFile(e){var t=document.getElementsByName("fd");p13clipboard=[],p13clipboardCut=e,p13clipboardFolder=p13targetpath;for(var n=0;n<t.length;n++)t[n].checked&&"3"==t[n].attributes.file.value&&p13clipboard.push(p13filetree.dir[t[n].value].n);p13updateClipview()}function p13pasteFile(){var e="";setModalContent("xxAddAgent","Plakken",e=null!=p13clipboard&&0<p13clipboard.length?0==p13clipboardCut?1<p13clipboard.length?format("Bevestig kopiëren van {0} bestanden naar deze locatie?",p13clipboard.length):format("Bevestig kopiëren van 1 bestand naar deze locatie?"):1<p13clipboard.length?format("Verplaatsing van {0} bestanden naar deze locatie bevestigen?",p13clipboard.length):format("Verplaatsing van 1 bestand naar deze locatie bevestigen?"):e),showModal("xxAddAgentModal","idx_dlgOkButton",()=>p13pasteFileEx())}function p13pasteFileEx(){files.sendText({action:0==p13clipboardCut?"copy":"move",reqid:1,scpath:p13clipboardFolder,dspath:p13targetpath,names:p13clipboard}),p13folderup(999),1==p13clipboardCut&&(p13clipboardFolder=p13clipboard=null,p13clipboardCut=0,p13updateClipview())}function p13updateClipview(){var e="";null!=p13clipboard&&0<p13clipboard.length&&(e=0==p13clipboardCut?1<p13clipboard.length?format('{0} items vasthouden voor kopiëren, <a href=# onclick="return p13clearClip()" style=cursor:pointer>Wissen</a>.',p13clipboard.length):format('1 item vasthouden voor kopiëren, <a href=# onclick="return p13clearClip()" style=cursor:pointer>Wissen</a>.'):1<p13clipboard.length?format('{0} items vasthouden voor verplaatsen, <a href=# onclick="return p13clearClip()" style=cursor:pointer>Wissen</a>.',p13clipboard.length):format('1 item vasthouden voor verplaatsen, <a href=# onclick="return p13clearClip()" style=cursor:pointer>Wissen</a>.')),QH("p13bottomstatus",e),p13setActions()}function p13clearClip(){return p13clipboardFolder=p13clipboard=null,p13clipboardCut=0,p13updateClipview(),!1}function p13fileDragDrop(e){if(haltEvent(e),QV("p13bigfail",!1),QV("p13bigok",!1),null!=e.dataTransfer&&0!=e.dataTransfer.files.length&&null!=p13filetree){var t,n=[];for(t in e.dataTransfer.files)null!=e.dataTransfer.files[t].size&&0!=e.dataTransfer.files[t].size&&n.push(e.dataTransfer.files[t]);0!=n.length&&p13doUploadFiles(n)}}var gdownloadFile,p13dragtimer=null;function p13fileDragOver(e){haltEvent(e),null!=p13dragtimer&&(clearTimeout(p13dragtimer),p13dragtimer=null);e=null!=p13filetree;QV("p13bigok",e),QV("p13bigfail",!e)}function p13fileDragLeave(e){haltEvent(e),"p13filetable"!=e.target.id?(QV("p13bigfail",!1),QV("p13bigok",!1)):p13dragtimer=setTimeout(function(){QV("p13bigfail",!1),QV("p13bigok",!1),p13dragtimer=null},10)}function p13downloadfile(e,t,n,o){!xxdialogMode&&files&&(gdownloadFile={path:decodeURIComponent(e),file:decodeURIComponent(t),size:n,tsize:0,data:"",state:0,id:Math.random(),tag:o},files.sendText({action:"download",sub:"start",id:gdownloadFile.id,path:gdownloadFile.path}),setModalContent("xxAddAgent","Download bestand","<div>"+gdownloadFile.file+"</div><br /><progress id=d2progressBar style=width:100% value=0 max="+n+" />"),showModal("xxAddAgentModal","idx_dlgOkButton",()=>p13downloadFileCancel()))}function p13downloadFileCancel(){setDialogMode(0),files.sendText({action:"download",sub:"cancel",id:gdownloadFile.id}),gdownloadFile=null}function p13gotDownloadCommand(e){null!=gdownloadFile&&e.id==gdownloadFile.id&&("start"==e.sub?(gdownloadFile.state=1,files.sendText({action:"download",sub:"startack",id:gdownloadFile.id})):"cancel"==e.sub&&(gdownloadFile=null,setDialogMode(0)))}function p13gotDownloadBinaryData(e){var t;gdownloadFile&&0!=gdownloadFile.state&&(4<e.length&&(gdownloadFile.tsize+=e.length-4,gdownloadFile.data+=e.substring(4),Q("d2progressBar").value=gdownloadFile.tsize),0!=(1&ReadInt(e,0))?"viewer"==gdownloadFile.tag?(setModalContent("xxAddAgent",EscapeHtml(gdownloadFile.file),4,"extra-large"),t=gdownloadFile.file,showModal("xxAddAgentModal","idx_dlgOkButton",()=>p13editSaveBack(3,t)),QV("d4EncodingButton",!0),QV("d4LineBreakButton",!0),Q("d4editorarea").value=1==d4EditEncodingVal?decode_utf8(gdownloadFile.data):gdownloadFile.data,gdownloadFile=null):(saveAs(data2blob(gdownloadFile.data),gdownloadFile.file),gdownloadFile=null,setDialogMode(0)):files.sendText({action:"download",sub:"ack",id:gdownloadFile.id}))}function p13downloadButton(){for(var e,t,n=document.getElementsByName("fd"),o=0;o<n.length;o++)n[o].checked&&(e=p13filetree.dir[n[o].value],t="devicefile.ashx?c="+authCookie,downloadFile(t=(t=(t+="&m="+currentNode.meshid.split("/")[2])+("&n="+currentNode._id.split("/")[2]))+("&f="+encodeURIComponentEx(p13filetreelocation.join("/")+"/"+e.n)),encodeURIComponentEx(e.n)))}var uploadFile,d4EditWrapVal=0,d4EditSizeVal=0,d4EditEncodingVal=0,d4EditLineBreakVal=0;function d4ToggleWrap(e){e||(d4EditWrapVal=++d4EditWrapVal%2),Q("d4WrapButton").value=["Wrap: AAN","Wrap: UIT"][d4EditWrapVal],QS("d4editorarea").overflow=0==d4EditWrapVal?"auto":"scroll",QS("d4editorarea")["white-space"]=0==d4EditWrapVal?null:"pre",putstore("editorWrap",d4EditWrapVal)}function d4ToggleSize(e){e||(d4EditSizeVal=++d4EditSizeVal%4),QS("d4editorarea")["font-size"]=["100%","125%","150%","200%"][d4EditSizeVal],Q("d4SizeButton").value=["Grootte: 150%","Grootte: 150%","Grootte: 150%","Grootte: 200%"][d4EditSizeVal],putstore("editorSize",d4EditSizeVal)}function d4ToggleEncoding(e){e||(d4EditEncodingVal=++d4EditEncodingVal%2,Q("d4editorarea").value=(1==d4EditEncodingVal?decode_utf8:encode_utf8)(Q("d4editorarea").value)),Q("d4EncodingButton").value=["Codering: RAW","Codering: UTF8"][d4EditEncodingVal],putstore("editorEncoding",d4EditEncodingVal)}function d4ToggleLineBreak(e){e||(d4EditLineBreakVal=++d4EditLineBreakVal%3),Q("d4LineBreakButton").value=["Line Break: Windows (CR LF)","Line Break: Linux (LF)","Line Break: Mac (CR)"][d4EditLineBreakVal],putstore("editorLineBreak",d4EditLineBreakVal)}function p13editSaveBack(e,t){var n=Q("d4editorarea").value,n=0===d4EditLineBreakVal?n.replace(/\r?\n|\r/g,"\r\n"):2===d4EditLineBreakVal?n.replace(/\r\n|\n/g,"\r"):n.replace(/\r\n|\r/g,"\n"),n=1==d4EditEncodingVal?(new TextEncoder).encode(n):(new TextEncoder).encode(decode_utf8(n));p13uploadFileContinue(1,[{name:t,size:n.byteLength,type:"text/plain",xdata:n}])}function p13doUploadFiles(e){if(!xxdialogMode){var t=0<currentNode.agent.id&&currentNode.agent.id<5||14==currentNode.agent.id||34==currentNode.agent.id,n=[],o=0;for(a in p13filetree.dir)n.push(t?p13filetree.dir[a].n.toLowerCase():p13filetree.dir[a].n);for(var a=0;a<e.length;a++)t?0<=n.indexOf(e[a].name.toLowerCase())&&o++:0<=n.indexOf(e[a].name)&&o++;0==o?p13uploadFileContinue(1,e):(setModalContent("xxAddAgent","Upload bestand",format(1==o?"Upload overschrijft {0} bestand. Doorgaan?":"Upload overschrijft {0} bestanden. Doorgaan?",o)),showModal("xxAddAgentModal","idx_dlgOkButton",()=>p13uploadFileContinue(3,e)))}}function p13uploadFileContinue(e,t){if((uploadFile={}).xpath=p13filetreelocation.join("/"),uploadFile.xfiles=t,uploadFile.xfilePtr=-1,setModalContent("xxAddAgent","Upload bestand","<div id=p13dfileName>Verbinden...</div><br /><progress id=d2progressBar style=width:100% value=0 max=0 />"),showModal("xxAddAgentModal","idx_dlgCancelButton",()=>p13uploadFileCancel(10)),document.getElementById("idx_dlgOkButton").style.display="none",p13uploadNextFile(),3==e)return!1}let byteToHex=[];for(var n=0;n<=255;++n){var hexOctet=n.toString(16).padStart(2,"0");byteToHex.push(hexOctet)}function arrayBufferToHex(e){return Array.prototype.map.call(new Uint8Array(e),e=>byteToHex[e]).join("")}function performHash(e,t){window.crypto.subtle.digest("SHA-384",e).then(function(e){t(arrayBufferToHex(e))},function(){t(null)})}function performHashOnFile(e,t){var n=new FileReader;n.onerror=function(e){t(null)},n.onload=function(){window.crypto.subtle.digest("SHA-384",n.result).then(function(e){t(arrayBufferToHex(e))},function(){t(null)})},n.readAsArrayBuffer(e)}function p13uploadNextFile(){if(uploadFile.xfilePtr++,uploadFile.xfiles.length>uploadFile.xfilePtr){uploadFile.xptr=0;var t=uploadFile.xfiles[uploadFile.xfilePtr];if(QH("p13dfileName",EscapeHtml(t.name)),Q("d2progressBar").max=t.size,Q("d2progressBar").value=0,null==t.xdata){uploadFile.xfile=t;var e,n=null;for(e in p13filetree.dir)p13filetree.dir[e].n==t.name&&(n=p13filetree.dir[e]);null!=n&&n.s<=uploadFile.xfile.size?performHashOnFile(uploadFile.xfile,function(e){files.sendText(JSON.stringify({action:"uploadhash",reqid:uploadFile.xfilePtr,path:uploadFile.xpath,name:t.name,tag:{h:e.toUpperCase(),s:n.s,skip:n.s==uploadFile.xfile.size}}))}):files.sendText(JSON.stringify({action:"upload",reqid:uploadFile.xfilePtr,path:uploadFile.xpath,name:t.name,size:uploadFile.xfile.size}))}else uploadFile.xdata=t.xdata,files.sendText(JSON.stringify({action:"upload",reqid:uploadFile.xfilePtr,path:uploadFile.xpath,name:t.name,size:uploadFile.xdata.byteLength}))}else p13uploadFileTransferDone()}function p13uploadFileCancel(e,t){null!=uploadFile&&(files.sendText(JSON.stringify({action:"uploadcancel",reqid:uploadFile.xfilePtr})),uploadFile=null),p13uploadFileTransferDone()}function p13uploadFileTransferDone(){uploadFile=null,setDialogMode(0),p13folderup(9999)}function p13gotUploadData(e){if(null!=uploadFile&&parseInt(uploadFile.xfilePtr)==parseInt(e.reqid))switch(e.action){case"uploadstart":p13uploadNextPart(!(uploadFile.xdataPriming=8));break;case"uploadack":p13uploadNextPart(!1);break;case"uploaddone":(uploadFile.xfiles.length>uploadFile.xfilePtr+1?p13uploadNextFile:p13uploadFileTransferDone)();break;case"uploaderror":p13uploadFileCancel();break;case"uploadhash":var t=uploadFile.xfiles[uploadFile.xfilePtr];t&&(e.tag.h===e.hash?e.tag.skip?p13uploadNextFile():(uploadFile.xptr=e.tag.s,files.sendText(JSON.stringify({action:"upload",reqid:uploadFile.xfilePtr,path:uploadFile.xpath,name:t.name,size:uploadFile.xfile.size,append:!0}))):files.sendText(JSON.stringify({action:"upload",reqid:uploadFile.xfilePtr,path:uploadFile.xpath,name:t.name,size:uploadFile.xfile.size,append:!1})))}}function p13uploadNextPart(e){if(uploadFile.xdata){var t=uploadFile.xdata,n=uploadFile.xptr;if(n>=t.byteLength)files.sendText(JSON.stringify({action:"uploaddone",reqid:uploadFile.xfilePtr}));else{if((o=uploadFile.xptr+(attemptWebRTC?16384:65536))>t.byteLength){if(1==e)return;o=t.byteLength}t=new Uint8Array(t.slice(n,o));123==t[0]||0==t[0]?((n=new Uint8Array(o-n+1)).set(t,1),files.send(n)):files.send(t),uploadFile.xptr=o,Q("d2progressBar").value=o}}else if(uploadFile.xfile&&null==uploadFile.xreader&&!(uploadFile.xptr>=uploadFile.xfile.size)){var o;if((o=uploadFile.xptr+(attemptWebRTC?16384:65536))>uploadFile.xfile.size){if(1==e)return;o=uploadFile.xfile.size}uploadFile.xreader=new FileReader,uploadFile.xreader.onerror=function(e){console.log(e)},uploadFile.xreader.onload=function(){var e,t=uploadFile.xreader.result;delete uploadFile.xreader,null!=t&&(123==(e=new Uint8Array(t))[0]||0==e[0]?((t=new Uint8Array(t.byteLength+1)).set(e,1),files.send(t)):files.send(e),uploadFile.xptr=o,Q("d2progressBar").value=o,uploadFile.xptr>=uploadFile.xfile.size?files.sendText(JSON.stringify({action:"uploaddone",reqid:uploadFile.xfilePtr})):0<uploadFile.xdataPriming&&(uploadFile.xdataPriming--,p13uploadNextPart(!0)))},uploadFile.xreader.readAsArrayBuffer(uploadFile.xfile.slice(uploadFile.xptr,o))}}var currentDeviceEvents=null;function deviceEventsUpdate(){var e="",t=null;for(r in currentDeviceEvents){var n=currentDeviceEvents[r],o=new Date(n.time);if(n.msg){null==n.h&&(n.h=Math.random()),printDate(o)!=t&&(null!=t&&(e+="</table>"),e+='<table class="table table-hover p3eventsTable" cellpadding=0 cellspacing=0><tr><td colspan=4 class=DevSt>'+(t=printDate(o))+"</td></tr>");var a,i,s="fa-mobile-screen";if("user"==n.etype&&(s="fa-user"),"server"==n.etype&&(s="fa-server"),null==n.msgid||null==eventsMessageId[n.msgid])a="string"==typeof n.msg?EscapeHtml(n.msg).split("(R)").join("&reg;"):"";else{for(var r in a=eventsMessageId[n.msgid],n.msgArgs){var l=n.msgArgs[r];"string"==typeof l&&0==l.indexOf("DATETIME:")&&(l=printFlexDateTime(new Date(parseInt(l.substring(9))))),a=a.split("{"+r+"}").join(l)}a=EscapeHtml(a).split("(R)").join("&reg;")}n.username&&(i="",n.guestname&&(i=' / <span title="Dit is een gedeelde gastsessie">'+EscapeHtml(n.guestname)+"</span>"),a=2&userinfo.siteadmin&&n.userid?"<a href=# onclick='gotoUser(\""+encodeURIComponentEx(n.userid)+"\");haltEvent(event);'>"+EscapeHtml(n.username)+"</a>"+i+" &rarr; "+a:EscapeHtml(n.username)+i+" &rarr; "+a),"relay"!=n.etype&&"relaylog"!=n.action||(s="fa-arrow-right-arrow-left"),e+="<tr onclick=showEventDetails("+n.h+',1) onmouseover=eventMouseHover(this,1) onmouseout=eventMouseHover(this,0) role="button"><td style=width:18px><i class="fa-solid '+s+'"></i></td><td class=g1>&nbsp;</td><td class=style10>'+printTime(o)+" - "+a+"</td></tr><tr></tr>"}}null!=t&&(e+="</table>"),""==e&&(e="<br><i>Geen gebeurtenissen gevonden</i><br><br>"),QH("p16events",e)}function refreshDeviceEvents(){""!=p16filterevents.value?meshserver.send({action:"events",nodeid:currentNode._id,limit:parseInt(p16limitdropdown.value),filter:p16filterevents.value}):meshserver.send({action:"events",nodeid:currentNode._id,limit:parseInt(p16limitdropdown.value)})}function showEventDetails(e,t){if(xxdialogMode)return!1;var n,o;for(a in 1==t&&(n=currentDeviceEvents),2==t&&(n=events),n=3==t?currentUserEvents:n)if(n[a].h==e){o=n[a];break}if(o){var a,i="<div style=overflow-y:auto;max-height:300px>";for(a in o)"h"!=a&&"_id"!=a&&"ids"!=a&&"domain"!=a&&null!=o[a]&&("object"==typeof o[a]?i+=addHtmlValue3(EscapeHtml(a),EscapeHtml(JSON.stringify(o[a]))):i+=addHtmlValue3(EscapeHtml(a),EscapeHtml(o[a])));setModalContent("xxAddAgent","Gebeurtenis details",i+="</div>"),showModal("xxAddAgentModal","idx_dlgOkButton")}}var deviceDetailsStats=null,deviceDetailsStatsTimer=null,deviceDetailsStatsData=[],deviceDetailsConfig={type:"line",data:{labels:[],datasets:[{label:"CPU",backgroundColor:"rgba(134, 16, 158, .5)",borderColor:"rgb(134, 16, 158)",data:[],fill:!0},{label:"Geheugen",backgroundColor:"rgba(255, 99, 132, .5)",borderColor:"rgb(255, 99, 132)",data:[],fill:!0}]},options:{events:["click"],animation:!1,responsive:!0,maintainAspectRatio:!1,tooltips:{enabled:!1},elements:{line:{cubicInterpolationMode:"monotone"}},scales:{x:{type:"linear",display:!0,title:{display:!1,text:""},min:0,max:100,reverse:!0},y:{type:"linear",display:!0,title:{display:!1,text:""},min:0,max:100}}}};function deskToggleCpuGraph(){("none"==QS("p17graph").display?(QV("p17graph",!0),window.deviceDetailsStatsChart=new Chart(document.getElementById("deviceDetailsStats").getContext("2d"),deviceDetailsConfig),deviceDetailsStatsTimer=setInterval(deviceDetailsStatsTimerFunc,2e3),deviceDetailsStatsTimerFunc):deviceDetailsStatsClear)()}function deviceDetailsStatsClear(){QV("p17graph",!1),null!=window.deviceDetailsStatsChart&&(window.deviceDetailsStatsChart.destroy(),delete window.deviceDetailsStatsChart),null!=deviceDetailsStatsTimer&&(clearInterval(deviceDetailsStatsTimer),deviceDetailsStatsTimer=null),deviceDetailsStatsData=[],deviceDetailsStatsDraw(),QV("extraGraphValues",!1),QH("extraGraphValues","")}function deviceDetailsStatsTimerFunc(){null!=currentNode&&meshserver.send({action:"msg",type:"cpuinfo",nodeid:currentNode._id})}function deviceDetailsStatsDraw(e){for(var t=Date.now()/1e3-100;0<deviceDetailsStatsData.length&&deviceDetailsStatsData[0][0]<t-5;)deviceDetailsStatsData.shift();var n=[],o=[];for(i in deviceDetailsStatsData){var a=deviceDetailsStatsData[i];n.push({x:100-(a[0]-t),y:a[1]}),o.push({x:100-(a[0]-t),y:a[2]})}if(deviceDetailsConfig.data.datasets[0].data=n,deviceDetailsConfig.data.datasets[1].data=o,window.deviceDetailsStatsChart&&window.deviceDetailsStatsChart.update(),null!=e&&Array.isArray(e.thermals)&&0<e.thermals.length){var i,s="&nbsp;";for(i in e.thermals)s+='<div class=thermalSensor title="'+e.thermals[i].InstanceName+'">'+parseFloat(e.thermals[i].CurrentTemperature).toFixed(2)+"&deg;C / "+parseFloat(1.8*e.thermals[i].CurrentTemperature+32).toFixed(2)+"&deg;F</div>";QV("extraGraphValues",!0),QH("extraGraphValues",s)}}var consoleNode,DeviceDetailsHardware=null,DeviceDetailsNetwork=null,DeviceDetailsNodeId=null;function updateDeviceDetails(e,t,n){if(null!=currentNode&&(null==e&&(e=currentNode),currentNode._id==e._id)){DeviceDetailsNodeId!=e._id&&(DeviceDetailsNetwork=DeviceDetailsHardware=null,DeviceDetailsNodeId=e._id),null==(t=DeviceDetailsHardware=null!=t?t:DeviceDetailsHardware)&&(t={}),null==(n=DeviceDetailsNetwork=null!=n?n:DeviceDetailsNetwork)&&(n={});var o,a,i=[],s={},r="";if(e.rname&&(r+=addDetailItem("Naam",EscapeHtml(e.rname),s)),t.windows&&t.windows.osinfo&&t.windows.osinfo.Description&&(r+=addDetailItem("Omschrijving",EscapeHtml(t.windows.osinfo.Description),s)),e.osdesc&&(r+=addDetailItem("Versie",EscapeHtml(e.osdesc),s)),t.windows&&t.windows.osinfo&&((d=t.windows.osinfo).OSArchitecture&&(d.OSArchitecture.startsWith("32")?r+=addDetailItem("Architectuur","32-bits",s):d.OSArchitecture.startsWith("64")?r+=addDetailItem("Architectuur","64-bits",s):r+=addDetailItem("Architectuur",EscapeHtml(d.OSArchitecture),s)),d.LastBootUpTime)&&(a={year:parseInt(d.LastBootUpTime.substring(0,4)),month:parseInt(d.LastBootUpTime.substring(4,6))-1,day:parseInt(d.LastBootUpTime.substring(6,8)),hours:parseInt(d.LastBootUpTime.substring(8,10)),minutes:parseInt(d.LastBootUpTime.substring(10,12)),seconds:parseInt(d.LastBootUpTime.substring(12,14))},r+=addDetailItem("Tijd van laatste opstart",printDateTime(new Date(a.year,a.month,a.day,a.hours,a.minutes,a.seconds)))),t.linux&&t.linux.LastBootUpTime&&(r+=addDetailItem("Tijd van laatste opstart",printDateTime(new Date(t.linux.LastBootUpTime)))),t.darwin&&t.darwin.LastBootUpTime&&(r+=addDetailItem("Tijd van laatste opstart",printDateTime(new Date(1e3*t.darwin.LastBootUpTime)))),""!=r&&i.push({name:"Besturingssysteem",html:r,img:"software64.png"}),e.agent&&(r="",null!=e.agent&&null!=e.agent.id&&null!=e.agent.ver&&(a="",a=e.agent.id<=agentsStr.length?agentsStr[e.agent.id]:agentsStr[0],0!=e.agent.ver&&(a+=" v"+e.agent.ver),r+=addDetailItem("Mesh Agent",a=14==e.agent.id?e.agent.core:a)),0!=(1&e.conn)?r+=addDetailItem("Laatste agentverbinding","Nu verbonden"):e.lastconnect&&(r+=addDetailItem("Laatste agentverbinding",printDateTime(new Date(e.lastconnect)))),e.lastaddr&&(2<(a=e.lastaddr.split(":")).length?r+=addDetailItem("Laatste agentadres",e.lastaddr):isPrivateIP(e.lastaddr)?r+=addDetailItem("Laatste agentadres",a[0]):r+=addDetailItem("Laatste agentadres",'<a href="https://iplocation.com/?ip='+a[0]+'" rel="noreferrer noopener" target="MeshIPLoopup">'+a[0]+"</a>")),null!=t.agentvers&&t.agentvers.compileTime&&(a=Date.parse(t.agentvers.compileTime),r+=addDetailItem("Compileer tijd",isNaN(a)?t.agentvers.compileTime:printDateTime(new Date(a)))),""!=r)&&i.push({name:"Mesh Agent",html:r,img:"meshagent64.png"}),t.mobile&&(r="",t.mobile.brand&&t.mobile.model&&(r+=addDetailItem("Model",EscapeHtml(t.mobile.brand+", "+t.mobile.model),s)),t.mobile.device&&(r+=addDetailItem("Apparaat",EscapeHtml(t.mobile.device),s)),t.mobile.bootloader&&(r+=addDetailItem("Bootloader",EscapeHtml(t.mobile.bootloader),s)),t.mobile.id&&(r+=addDetailItem("Identifier",EscapeHtml(t.mobile.id),s)),t.mobile.host&&(r+=addDetailItem("Hostnaam",EscapeHtml(t.mobile.host),s)),t.mobile.androidapi&&t.mobile.androidrelease&&(r+=addDetailItem("Android Versie",EscapeHtml(t.mobile.androidrelease+", API Level "+t.mobile.androidapi),s)),""!=r)&&i.push({name:"Mobiel apparaat",html:r,img:"mobile64.png"}),null!=n.netif){var l={};for(h in n.netif)"string"==typeof(d=n.netif[h]).mac&&(null==l[d.mac]?(l[d.mac]=d,l[d.mac].ipv4layer=[{v4addr:d.v4addr,v4mask:d.v4mask,v4gateway:d.v4gateway}]):l[d.mac].ipv4layer.push({v4addr:d.v4addr,v4mask:d.v4mask,v4gateway:d.v4gateway}));var r="";for(h in r+='<table class="table table-hover" style=width:100%>',l){var d=l[h];for(p in r=(r+="<tr><td><div class=style10 style=border-radius:5px;padding:8px>")+("<div style=margin-bottom:3px><b>"+EscapeHtml(d.name+(d.dnssuffix?", "+d.dnssuffix:""))+"</b></div>"),d.desc&&(r+=addDetailItem("Omschrijving",EscapeHtml(d.desc).split("(R)").join("&reg;"))),d.mac&&(d.gatewaymac?r+=addDetailItem("MAC Laag",format("MAC: {0}, Gateway: {1}",EscapeHtml(d.mac),EscapeHtml(d.gatewaymac))):d.mac&&(r+=addDetailItem("MAC Laag",format("MAC: {0}",EscapeHtml(d.mac))))),d.ipv4layer){var c=d.ipv4layer[p];c.v4gateway&&c.v4mask?r+=addDetailItem("IPv4 Laag",format("IP: {0}, Mask: {1}, Gateway: {2}",EscapeHtml(c.v4addr),EscapeHtml(c.v4mask),EscapeHtml(c.v4gateway))):c.v4addr&&(r+=addDetailItem("IPv4 Laag",format("IP: {0}",EscapeHtml(c.v4addr))))}r+="</div></td></tr>"}""!=(r+="</table>")&&i.push({name:"Netwerken",html:r,img:"networking64.png"})}if(null!=n.netif2){var r="";for(h in r+='<table class="table table-hover" style=width:100%>',n.netif2){d=n.netif2[h];if(!(0==Array.isArray(d)||d.length<1||null==d[0]||"string"==typeof d[0].mac&&d[0].mac.startsWith("00:00:00:00"))){r+="<tr><td><div class=style10 style=border-radius:5px;padding:8px>";var u="";null!=h&&(u+=h),null!=d[0].fqdn&&""!=d[0].fqdn&&(u+=", "+d[0].fqdn),0<u.length&&(r+="<div style=margin-bottom:3px><b>"+EscapeHtml(u)+"</b></div>"),d.desc&&(r+=addDetailItem("Omschrijving",EscapeHtml(d.desc).split("(R)").join("&reg;"))),"string"==typeof d[0].mac&&(d[0].gatewaymac?r+=addDetailItem("MAC Laag",format("MAC: {0}, Gateway: {1}",EscapeHtml(d[0].mac),EscapeHtml(d[0].gatewaymac))):r+=addDetailItem("MAC Laag",format("MAC: {0}",EscapeHtml(d[0].mac))));for(var p=0;p<d.length;p++){var m=d[p],g=[];m.address&&g.push(format("IP: {0}",EscapeHtml(m.address))),m.netmask&&g.push(format("Mask: {0}",EscapeHtml(m.netmask))),m.gateway&&g.push(format("Gateway: {0}",EscapeHtml(m.gateway))),0<g.length&&("IPv4"==m.family&&(r+=addDetailItem("IPv4 Laag",g.join(", "))),"IPv6"==m.family)&&(r+=addDetailItem("IPv6 Layer",g.join(", ")))}r+="</div></td></tr>"}}t.network&&t.network.dns&&(r=(r+="<tr><td><div class=style10 style=border-radius:5px;padding:8px>")+addDetailItem("<b>DNS Servers</b>",t.network.dns.join(", "))+"</div></td></tr>"),""!=(r+="</table>")&&i.push({name:"Netwerken",html:r,img:"networking64.png"})}if(null!=e.intelamt&&(r="",r+=addDetailItem("Versie",e.intelamt.ver?"v"+EscapeHtml(e.intelamt.ver):"<i>Onbekend</i>",s),a={0:nobreak("Niet geactiveerd"),1:nobreak("Pre-activering"),2:nobreak("Geactiveerd")},o="",2==e.intelamt.state&&e.intelamt.flags&&(2&e.intelamt.flags?o=", Client Control Mode (CCM)":4&e.intelamt.flags&&(o=", Admin Control Mode (ACM)")),""!=(r=(r=(r+=addDetailItem("Provisioning Staat",(e.intelamt.state?a[e.intelamt.state]:"<i>Onbekend</i>")+o,s))+addDetailItem("Beveiliging",1==e.intelamt.tls?"Beveiligd met TLS":"TLS is niet ingesteld",s))+addDetailItem("Beheerdersreferenties",null==e.intelamt.user||""==e.intelamt.user||null!=e.intelamt.warn&&0!=(9&e.intelamt.warn)?"Onbekend":"Bekend",s)))&&("number"==typeof e.intelamt.sku&&0!=(16&e.intelamt.sku)?i.push({name:"Intel&reg; Standaard beheerbaarheid (Intel&reg; SM)",html:r,img:"amt64.png"}):i.push({name:"Intel&reg; Active Management Technology (Intel&reg; AMT)",html:r,img:"amt64.png"})),t.identifiers){var r="",v=t.identifiers;if(v.bios_vendor&&(r+=addDetailItem("Fabrikant",EscapeHtml(v.bios_vendor),s)),v.bios_version&&(r+=addDetailItem("Versie",EscapeHtml(v.bios_version),s)),v.bios_serial&&(r+=addDetailItem("Serie nummer",EscapeHtml(v.bios_serial),s)),v.bios_mode&&(r+=addDetailItem("Mode",EscapeHtml(v.bios_mode),s)),""!=r&&i.push({name:"BIOS",html:r,img:"chip64.png"}),r="",v.board_vendor&&(r+=addDetailItem("Fabrikant",EscapeHtml(v.board_vendor),s)),v.board_name&&(r+=addDetailItem("Naam",EscapeHtml(v.board_name),s)),v.board_serial&&""!=v.board_serial&&(r+=addDetailItem("Serie nummer",EscapeHtml(v.board_serial),s)),v.board_version&&(r+=addDetailItem("Versie",EscapeHtml(v.board_version),s)),v.product_uuid&&(r+=addDetailItem("Identifier",EscapeHtml(v.product_uuid),s)),v.cpu_name&&(r+=addDetailItem("CPU",EscapeHtml(v.cpu_name).split("(TM)").join("&trade;").split("(R)").join("&reg;"),s)),v.gpu_name)for(var h in v.gpu_name)r+=addDetailItem("GPU",EscapeHtml(v.gpu_name[h]).split("(TM)").join("&trade;").split("(R)").join("&reg;"),s);""!=r&&i.push({name:"Moederbord",html:r,img:"motherboard64.png"})}if(t.tpm&&(r="",(a=t.tpm).SpecVersion&&(r+=addDetailItem("SpecVersion",parseFloat(EscapeHtml(a.SpecVersion)).toFixed(1),s)),a.ManufacturerId&&(r+=addDetailItem("ManufacturerId",EscapeHtml(a.ManufacturerId),s)),a.ManufacturerVersion&&(r+=addDetailItem("ManufacturerVersion",EscapeHtml(a.ManufacturerVersion),s)),null!=a.IsActivated&&(r+=addDetailItem("IsActivated",a.IsActivated?"Ja":"Nee",s)),null!=a.IsEnabled&&(r+=addDetailItem("IsEnabled",a.IsEnabled?"Ja":"Nee",s)),null!=a.IsOwned&&(r+=addDetailItem("IsOwned",a.IsOwned?"Ja":"Nee",s)),""!=r)&&i.push({name:"TPM",html:r,img:"tpm64.png"}),t.windows&&t.windows.memory&&0<t.windows.memory.length){r="";for(h in t.windows.memory.sort(function(e,t){return e.BankLabel>t.BankLabel?1:e.BankLabel<t.BankLabel?-1:0}),r+='<table class="table table-hover" style=width:100%>',t.windows.memory){d=t.windows.memory[h];r=(r+="<tr><td><div class=style10 style=border-radius:5px;padding:8px>")+("<div style=margin-bottom:3px><b>"+EscapeHtml(d.BankLabel||d.DeviceLocator||"Unknown")+"</b></div>"),d.Capacity&&d.Speed?r+=addDetailItem("Capaciteit / snelheid",format("{0} Mb, {1} Mhz",d.Capacity/1024/1024,d.Speed),s):d.Capacity&&(r+=addDetailItem("Capaciteit",format("{0} Mb",d.Capacity/1024/1024),s)),d.PartNumber&&(r+=addDetailItem("Onderdeel nummer",EscapeHtml(d.Manufacturer&&"Undefined"!=d.Manufacturer?d.Manufacturer+", ":"")+EscapeHtml(d.PartNumber),s)),r+="</div>"}""!=(r+="</table>")&&i.push({name:"Geheugen",html:r,img:"ram64.png"})}if(t.linux&&t.linux.memory&&0<t.linux.memory.Memory_Device.length){r="";for(h in t.linux.memory.Memory_Device.sort(function(e,t){return e.Locator>t.Locator?1:e.Locator<t.Locator?-1:0}),r+='<table class="table table-hover" style=width:100%>',t.linux.memory.Memory_Device)(d=t.linux.memory.Memory_Device[h]).Size&&"No Module Installed"==d.Size||(r=(r+="<tr><td><div class=style10 style=border-radius:5px;padding:8px>")+"<div style=margin-bottom:3px><b>"+EscapeHtml(d.Locator||"Unknown")+"</b></div>",d.Size&&d.Speed?r+=addDetailItem("Capaciteit / snelheid",format("{0}, {1}",d.Size,d.Speed),s):d.Size&&(r+=addDetailItem("Capaciteit",format("{0}",d.Size),s)),d.PartNumber&&(r+=addDetailItem("Onderdeel nummer",EscapeHtml(d.Manufacturer&&"Undefined"!=d.Manufacturer?d.Manufacturer+", ":"")+EscapeHtml(d.PartNumber),s)),r+="</div>");""!=(r+="</table>")&&i.push({name:"Geheugen",html:r,img:"ram64.png"})}if(t.darwin&&t.darwin.memory&&0<t.darwin.memory.length){r="";for(h in r+='<table class="table table-hover" style=width:100%>',t.darwin.memory)(d=t.darwin.memory[h]).Size&&"No Module Installed"==d.Size||(r=(r+="<tr><td><div class=style10 style=border-radius:5px;padding:8px>")+"<div style=margin-bottom:3px><b>"+EscapeHtml(d.DeviceLocator||"Unknown")+"</b></div>",d.Size&&d.Speed?r+=addDetailItem("Capaciteit / snelheid",format("{0}, {1}",d.Size,d.Speed),s):d.Size&&(r+=addDetailItem("Capaciteit",format("{0}",d.Size),s)),d.PartNumber&&(r+=addDetailItem("Onderdeel nummer",EscapeHtml(d.Manufacturer&&""!=d.Manufacturer?d.Manufacturer+", ":"")+EscapeHtml(d.PartNumber),s)),r+="</div>");""!=(r+="</table>")&&i.push({name:"Geheugen",html:r,img:"ram64.png"})}if(t.identifiers&&t.identifiers.storage_devices){var f,r="";for(h in v.storage_devices.sort(function(e,t){return e.Caption>t.Caption?1:e.Caption<t.Caption?-1:0}),r+="<table style=width:100%>",v.storage_devices)(d=v.storage_devices[h]).Size&&(r=(r+="<tr><td><div class=style10 style=border-radius:5px;padding:8px>")+"<div style=margin-bottom:3px><b>"+EscapeHtml(d.Caption)+"</b></div>",d.Model&&d.Model!=d.Caption&&(r+=addDetailItem("Model",EscapeHtml(d.Model),s)),d.Size&&("string"==typeof d.Size&&parseInt(d.Size)==d.Size&&(d.Size=parseInt(d.Size)),"number"==typeof d.Size&&(r+=addDetailItem("Capaciteit",format("{0} Mb",Math.floor(d.Size/1024/1024)),s)),"string"==typeof d.Size)&&(r+=addDetailItem("Capaciteit",EscapeHtml(d.Size),s)),t.windows&&t.windows.drives&&d.Model&&(f=t.windows.drives.find(e=>e.Model===d.Model))&&f.Status&&(r+=addDetailItem("Status",EscapeHtml(f.Status),s)),r+="</div>");""!=(r+="</table>")&&i.push({name:"Opslag",html:r,img:"storage64.png"})}if(t.windows&&t.windows.volumes){var k,r="";for(h in t.windows.volumes)r=(r+="<tr><td><div class=style10 style=border-radius:5px;padding:8px>")+("<div style=margin-bottom:3px><b>"+h+":"+(null==(d=t.windows.volumes[h]).name||""==d.name?"":" - "+EscapeHtml(d.name))+"</b></div>"),d.size&&(x=["Bytes","KB","MB","GB","TB"],b=0===(p=parseInt(Math.floor(Math.log(Math.abs(d.size))/Math.log(1024)),10))?d.size+" "+x[p]:(d.size/1024**p).toFixed(2)+" "+x[p],r+=addDetailItem("Capaciteit",EscapeHtml(b),s)),d.sizeremaining&&(x=["Bytes","KB","MB","GB","TB"],b=0===(p=parseInt(Math.floor(Math.log(Math.abs(d.sizeremaining))/Math.log(1024)),10))?d.sizeremaining+" "+x[p]:(d.sizeremaining/1024**p).toFixed(2)+" "+x[p],r+=addDetailItem("Resterende capaciteit",EscapeHtml(b),s)),d.type&&(r+=addDetailItem("Bestandssysteem",(""!=(y=1==d.removable?"Verwijderbaar":1==d.cdrom?"CD-ROM":"")?y+" / ":"")+("Unknown"==d.type?"Onbekend":EscapeHtml(d.type)),s)),(d.protectionStatus||d.volumeStatus)&&(k=[],d.protectionStatus&&k.push("Ingeschakeld"),d.volumeStatus&&"FullyDecrypted"==d.volumeStatus&&k.push("Volledig gedecodeerd"),d.volumeStatus&&"EncryptionInProgress"==d.volumeStatus&&k.push("Versleuteling wordt uitgevoerd"),d.volumeStatus&&"FullyEncrypted"==d.volumeStatus&&k.push("Volledig gecodeerd"),k=k.join(" - "),d.recoveryPassword&&(k+=addKeyLink("",'deviceDetailsShowBitlockerInfo("'+encodeURIComponentEx(h)+'","'+encodeURIComponentEx(d.identifier)+'","'+encodeURIComponentEx(d.recoveryPassword)+'")')),r+=addDetailItem("BitLocker",k,s)),r+="</div>";""!=r&&i.push({name:"Opslagvolumes",html:"<table style=width:100%>"+r+"</table>",img:"storage64.png"})}if(t.linux&&t.linux.volumes){var x,b,r="";for(h in t.linux.volumes)(d=t.linux.volumes[h]).mount_point.startsWith("/var/lib/docker/overlay2")||(r=(r+="<tr><td><div class=style10 style=border-radius:5px;padding:8px>")+"<div style=margin-bottom:3px><b>"+d.mount_point+"</b></div>",d.size&&(x=["KB","MB","GB","TB"],b=0===(p=parseInt(Math.floor(Math.log(Math.abs(d.size))/Math.log(1024)),10))?d.size+" "+x[p]:(d.size/1024**p).toFixed(2)+" "+x[p],r+=addDetailItem("Capaciteit",EscapeHtml(b),s)),d.available&&(b=0==Math.abs(d.available)?"0 KB":(x=["KB","MB","GB","TB"],0===(p=parseInt(Math.floor(Math.log(Math.abs(d.available))/Math.log(1024)),10))?d.available+" "+x[p]:(d.available/1024**p).toFixed(2)+" "+x[p]),r+=addDetailItem("Resterende capaciteit",EscapeHtml(b),s)),d.type&&(r+=addDetailItem("Bestandssysteem",(""!=(y=1==d.removable?"Verwijderbaar":1==d.cdrom?"CD-ROM":"")?y+" / ":"")+("Unknown"==d.type?"Onbekend":EscapeHtml(d.type)),s)),r+="</div>");""!=r&&i.push({name:"Opslagvolumes",html:"<table style=width:100%>"+r+"</table>",img:"storage64.png"})}if(t.darwin&&t.darwin.volumes){var y,r="";for(h in t.darwin.volumes)(d=t.darwin.volumes[h]).mount_point.startsWith("/var/lib/docker/overlay2")||(r=(r+="<tr><td><div class=style10 style=border-radius:5px;padding:8px>")+"<div style=margin-bottom:3px><b>"+d.mount_point+"</b></div>",d.size&&(r+=addDetailItem("Capaciteit",EscapeHtml(d.size),s)),d.available&&(r+=addDetailItem("Resterende capaciteit",EscapeHtml(d.available),s)),d.type&&(r+=addDetailItem("Bestandssysteem",(""!=(y=1==d.removable?"Verwijderbaar":1==d.cdrom?"CD-ROM":"")?y+" / ":"")+("Unknown"==d.type?"Onbekend":EscapeHtml(d.type)),s)),r+="</div>");""!=r&&i.push({name:"Opslagvolumes",html:"<table style=width:100%>"+r+"</table>",img:"storage64.png"})}r="";for(h in i)null==i[h].img?r+="<div class=DevSt style=margin-bottom:3px;margin-left:16px><b>"+i[h].name+"</b></div><div style=margin-bottom:10px;margin-left:16px>"+i[h].html+"</div>":r=(r=(r+="<table style=width:100%><tr>")+"<td style=width:64px;vertical-align:top><img src=images/details/"+i[h].img+" border=0 width=64 /></td>")+"<td><div class=DevSt style=margin-bottom:3px;margin-left:16px><b>"+i[h].name+"</b></div><div style=margin-bottom:10px;margin-left:16px>"+i[h].html+"</div></td></tr></table>";""==r?QH("p17info2","Geen informatie over dit apparaat."):QH("p17info2",r)}}function deviceDetailsShowBitlockerInfo(e,t,n){if(xxdialogMode)return!1;t="<div><p>Identifier</p><p style=user-select:text;font-weight:bold>"+(t?decodeURIComponent(t):"Onbekend")+"</p>";t+="<p>Herstelwachtwoord</p><p style=user-select:text;font-weight:bold>"+(n?decodeURIComponent(n):"Onbekend")+"</p></div>",setModalContent("xxAddAgent",decodeURIComponent(e)+": BitLocker informatie",t),showModal("xxAddAgentModal","idx_dlgOkButton")}function agentConsoleHandleKeys(e){var t,n,o;return!(!e.ctrlKey&&!e.altKey)||(t=0,n=Q("p15consoleText"),e.key?13==e.keyCode&&0==consoleFocus?(p15consoleSend(e),t=1):8==e.keyCode&&0==consoleFocus?(o=n.value,n.value=o.substring(0,o.length-1),t=1):27==e.keyCode?(n.value="",t=1):38==e.keyCode||40==e.keyCode?(o=consoleHistory.indexOf(n.value),38==e.keyCode&&consoleHistory.length-1>o?n.value=consoleHistory[o+1]:40==e.keyCode&&0<o?n.value=consoleHistory[o-1]:40==e.keyCode&&0==o&&(n.value=""),t=1):1===e.key.length&&(insertTextAtCursor(n,e.key),t=1):0!=e.charCode&&0==consoleFocus&&(n.value=n.value+String.fromCharCode(e.charCode),t=1),0<t?haltEvent(e):void 0)}function insertTextAtCursor(e,t){var n,o;document.selection?(e.focus(),(sel=document.selection.createRange()).text=t):e.selectionStart||"0"==e.selectionStart?(n=e.selectionStart,o=e.selectionEnd,e.value=e.value.substring(0,n)+t+e.value.substring(o,e.value.length),e.setSelectionRange(o+1,o+1)):e.value+=myValue}var consoleServerText="";function setupConsole(){var e,t;115==xxcurrentView?(e="server"==consoleNode,consoleNode="server",QH("p15deviceName","Mijn server console"),QE("p15consoleText",!0),QH("p15statetext",""),QH("p15coreName",""),QV("p15outputselecttd",!1),0==e&&(QH("p15agentConsoleText",consoleServerText),Q("p15agentConsoleText").scrollTop=Q("p15agentConsoleText").scrollHeight)):(e=consoleNode==currentNode,meshes[(consoleNode=currentNode).meshid],0!=(16&GetNodeRights(currentNode))?(null==consoleNode.consoleText&&(consoleNode.consoleText=""),0==e&&(QH("p15agentConsoleText",consoleNode.consoleText),Q("p15agentConsoleText").scrollTop=Q("p15agentConsoleText").scrollHeight),0==(1&consoleNode.conn)&&consoleNode.conn,e=0!=(1&consoleNode.conn)?"Agent is online":"Agent is offline",0!=(16&consoleNode.conn)&&(e+=", MQTT is online"),QH("p15statetext",e),QE("p15uploadCore",0!=(1&consoleNode.conn)),QV("p15outputselecttd",0!=(16&consoleNode.conn)||1==currentNode.pmt&&0!=(4&features2)),QV("p15outputselect2",0!=(16&consoleNode.conn)),QV("p15outputselect3",1==currentNode.pmt&&0!=(4&features2)),e=Q("p15outputselect").value,0==(16&consoleNode.conn)&&2==e&&(e=1,Q("p15outputselect").value=1),1==currentNode.pmt&&0!=(4&features2)||3!=e||(e=1,Q("p15outputselect").value=1),t=!1,0!=(1&consoleNode.conn)&&1==e&&(t=!0),0!=(16&consoleNode.conn)&&2==e&&(t=!0),1==currentNode.pmt&&0!=(4&features2)&&3==e&&(t=!0),QE("p15consoleText",t)):(QH("p15statetext","Toegang geweigerd"),QE("p15consoleText",!1),QE("p15uploadCore",!1),QV("p15outputselecttd",!1)),QV("devListToolbarViewIcons3",0!=(1&consoleNode.conn)))}function p15consoleClear(){QH("p15agentConsoleText",""),Q("id_p15consoleClear").blur(),115==xxcurrentView?consoleServerText="":consoleNode.consoleText=""}var consoleHistory=[];function p15consoleSend(e){var t;e&&13!=e.keyCode||(e=Q("p15consoleText").value,t="<div style=color:green>&gt; "+EscapeHtml(e)+"<br/></div>",115==xxcurrentView?(consoleServerText+=t,meshserver.send({action:"serverconsole",value:e})):0!=(16&consoleNode.conn)&&2==Q("p15outputselect").value?(t="<div style=color:orange>MQTT&gt; "+EscapeHtml(e)+"<br/></div>",consoleNode.consoleText+=t,meshserver.send({action:"sendmqttmsg",topic:"console",nodeids:[consoleNode._id],msg:e})):1==consoleNode.pmt&&3==Q("p15outputselect").value&&0!=(4&features2)?(t="<div style=color:violet>PUSH&gt; "+EscapeHtml(e)+"<br/></div>",consoleNode.consoleText+=t,meshserver.send({action:"pushconsole",nodeid:consoleNode._id,console:e})):0!=(1&consoleNode.conn)&&(consoleNode.consoleText+=t,meshserver.send({action:"msg",type:"console",nodeid:consoleNode._id,value:e})),Q("p15agentConsoleText").innerHTML+=t,Q("p15agentConsoleText").scrollTop=Q("p15agentConsoleText").scrollHeight,Q("p15consoleText").value="",0<e.length&&(0<=(t=consoleHistory.indexOf(e))&&consoleHistory.splice(t,1),consoleHistory.unshift(e),consoleHistory.splice(10)))}function p15consoleReceive(e,t,n){"serverconsole"===e?(t="<div>"+EscapeHtml(t)+"</div>",consoleServerText+=t,"server"==consoleNode&&(Q("p15agentConsoleText").innerHTML+=t,Q("p15agentConsoleText").scrollTop=Q("p15agentConsoleText").scrollHeight)):(t="MQTT"==n?"<div style=color:red>MQTT&gt; "+EscapeHtml(t)+"<br/></div>":"<div>"+EscapeHtml(t)+"</div>",null==e.consoleText?e.consoleText=t:e.consoleText+=t,consoleNode==e&&(Q("p15agentConsoleText").innerHTML+=t,Q("p15agentConsoleText").scrollTop=Q("p15agentConsoleText").scrollHeight))}function p15downloadConsoleText(){saveAs(new Blob([Q("p15agentConsoleText").innerText],{type:"application/octet-stream"}),"console.txt")}function p15uploadCore(e){xxdialogMode||(1==e.shiftKey?meshserver.send({action:"uploadagentcore",nodeids:[consoleNode._id],type:"default"}):1==e.altKey?meshserver.send({action:"uploadagentcore",nodeids:[consoleNode._id],type:"clear"}):1==e.ctrlKey?p15uploadCore2():(setModalContent("xxAddAgent","Agentactie uitvoeren",addHtmlFormFloating("Actie",'<select id=d3coreMode class="form-select me-2"><option value=1>Upload standaard serverkern</option><option value=2>Maak de kern leeg</option><option value=6>Upload herstelkern</option><option value=7>Upload een kleine core</option><option value=3>Upload een kernbestand</option><option value=4>Softwarematig verbreken agent</option><option value=5>Harde ontkoppeling agent</option><option value=8>Restart agent service</select>')),showModal("xxAddAgentModal","idx_dlgOkButton",p15uploadCoreEx)))}function p15uploadCoreEx(){1==Q("d3coreMode").value?meshserver.send({action:"uploadagentcore",nodeids:[consoleNode._id],type:"default"}):2==Q("d3coreMode").value?meshserver.send({action:"uploadagentcore",nodeids:[consoleNode._id],type:"clear"}):3==Q("d3coreMode").value?p15uploadCore2():4==Q("d3coreMode").value?meshserver.send({action:"agentdisconnect",nodeid:consoleNode._id,disconnectMode:1}):5==Q("d3coreMode").value?meshserver.send({action:"agentdisconnect",nodeid:consoleNode._id,disconnectMode:2}):6==Q("d3coreMode").value?meshserver.send({action:"uploadagentcore",nodeids:[consoleNode._id],type:"recovery"}):7==Q("d3coreMode").value?meshserver.send({action:"uploadagentcore",nodeids:[consoleNode._id],type:"tiny"}):8==Q("d3coreMode").value&&meshserver.send({action:"msg",type:"console",nodeid:consoleNode._id,value:"service restart"})}function p15uploadCore2(){xxdialogMode||(Q("d3localmodeform").action="uploadmeshcorefile.ashx",Q("d3auth").value=authCookie,Q("d3filter").value=".js",Q("d3attrib").value=currentNode._id,setModalContent("xxAddAgent","Upload Mesh Agent Core",""),showModal("xxAddAgentModal","idx_dlgOkButton",()=>p15uploadCoreEx2()),d3init())}function p15uploadCoreEx2(){var e;1==Q("d3uploadMode").value?Q("d3submit").click():1==(e=d3getFileSel()).length&&meshserver.send({action:"uploadagentcore",nodeids:[consoleNode._id],type:"custom",path:d3filetreelocation.join("/")+"/"+e[0]})}function account_viewPreviousLogins(){xxdialogMode||(xxdialogTag="previousLogins",setModalContent("xxAddAgent","Eerdere aanmeldingen","Loading..."),showModal("xxAddAgentModal","idx_dlgOkButton"),meshserver.send({action:"previousLogins"}))}function account_manageImage(e){var t,n,o,a;xxdialogMode||(t=0==e?userinfo:currentUser,setModalContent("xxAddAgent","Beheer accountafbeelding",'<input id=p2file type=file class="form-control" accept="image/*" onchange=account_manageImageEx()><div style=width:100%><canvas id=p2canvas width=256 height=256 style="width:256px;height:256px;margin-left:60px;margin-top:8px;border-radius:16px;background: var(--sub-menu-bg);border: 1px solid #cfcdcd; cursor: pointer;" onclick=account_canvasClick() /></div>'),showModal("xxAddAgentModal","idx_dlgOkButton",account_manageImageEx2),n=Q("p2canvas").getContext("2d"),null==t.accountImageRnd&&(t.accountImageRnd=Math.floor(9999999999*Math.random())),o="",1==e&&(o="&id="+t._id.split("/")[2]),(a=new Image).onload=function(){n.clearRect(0,0,256,256),n.drawImage(a,0,0)},a.src=null!=t.flags&&1&t.flags?"userimage.ashx?rnd="+t.accountImageRnd+o:"images/user-256.png",QE("idx_dlgDeleteButton",null!=t.flags&&1&t.flags),QE("idx_dlgOkButton",!1))}function account_canvasClick(){Q("p2file").click()}function account_manageImageEx(){var e=Q("p2file").files[0],a=new Image;a.onload=function(){var e=0,t=0,n=Math.min(a.width,a.height),o=(a.width>n&&(e=(a.width-n)/2),a.height>n&&(t=(a.height-n)/2),Q("p2canvas").getContext("2d"));o.imageSmoothingEnabled=!0,o.webkitImageSmoothingEnabled=!0,o.mozImageSmoothingEnabled=!0,o.clearRect(0,0,256,256),o.drawImage(a,e,t,n,n,0,0,256,256),QE("idx_dlgOkButton",!0)},a.src=URL.createObjectURL(e)}function account_manageImageEx2(e,t){meshserver.send({action:"updateUserImage",userid:t,image:2==e?0:Q("p2canvas").toDataURL(Q("p2file").files[0].type)})}function account_managePhone(){xxdialogMode||0==(33554432&features)||(null!=userinfo.phone?(setModalContent("xxAddAgent","Telefonische meldingen",'<table style=width:100%><tr><td style=width:56px><img src="images/phone80.png" style=padding:8px>'+("<td style=text-align:center><div style=padding:6px>Geverifieerd telefoonnummer</div><div style=font-size:20px>"+EscapeHtml(userinfo.phone)+"</div>")+'<div style=margin:10px><label><input id=d2delPhone type=checkbox class="form-check-input me-2" onclick=account_managePhoneRemoveValidate() />Verwijder telefoonnummer</label></div>'),showModal("xxAddAgentModal","idx_dlgOkButton",()=>account_managePhoneRemove()),account_managePhoneRemoveValidate):(xxdialogTag="verifyPhone",setModalContent("xxAddAgent","Telefonische meldingen",'<table style=width:100%><tr><td style=width:56px><img src="images/phone80.png" style=padding:8px>'+"<td>Voer uw telefoonnummer in dat geschikt is voor SMS. Na verificatie kan het nummer worden gebruikt voor inlogverificatie en andere meldingen."+'<br /><br /><div style=width:100%;text-align:center>Telefoonnummer <input type=tel pattern="[0-9]" autocomplete="tel" inputmode="tel" maxlength=18 id=d2phoneinput onKeyUp=account_managePhoneValidate() onkeypress="if (event.key==\'Enter\') account_managePhoneValidate(1)"></div></table>'),showModal("xxAddAgentModal","idx_dlgOkButton",()=>account_managePhoneAdd()),Q("d2phoneinput").focus(),account_managePhoneValidate))()}function isPhoneNumber(e){var t=!0;e.startsWith("+")&&(e=e.substring(1));for(var n=0;n<e.length;n++){var o=e.charCodeAt(n);(o<48||57<o)&&32!=o&&45!=o&&46!=o&&(t=!1)}return t&&10<=e.length}function account_managePhoneValidate(e){var t=isPhoneNumber(Q("d2phoneinput").value);QE("idx_dlgOkButton",t),1==e&&t&&dialogclose(1)}function account_managePhoneCodeValidate(e){var t=6==Q("d2phoneCodeInput").value.length&&Q("d2phoneCodeInput").value.match(/[0-9]/);QE("idx_dlgOkButton",t),1==e&&t&&dialogclose(1)}function account_managePhoneConfirm(e,t){meshserver.send({action:"confirmPhone",code:Q("d2phoneCodeInput").value,cookie:t})}function account_managePhoneAdd(){0!=isPhoneNumber(Q("d2phoneinput").value)&&(QE("d2phoneinput",!1),meshserver.send({action:"verifyPhone",phone:Q("d2phoneinput").value}))}function account_managePhoneRemove(){Q("d2delPhone").checked&&meshserver.send({action:"removePhone"})}function account_managePhoneRemoveValidate(){QE("idx_dlgOkButton",Q("d2delPhone").checked)}function account_manageMessaging(){var e,t;xxdialogMode||0==(33554432&features2)||(null!=userinfo.msghandle?(setModalContent("xxAddAgent","Berichten notificaties",e=(e='<table style=width:100%><tr><td style=width:56px><img src="images/messaging40.png" style=padding:8px>')+("<td style=text-align:center><div style=padding:6px>Geverifieerde handeling</div><div style=font-weight:bold>"+EscapeHtml(userinfo.msghandle)+"</div>")+'<div style=margin:10px><label><input id=d2delPhone type=checkbox class="form-check-input me-2" onclick=account_managePhoneRemoveValidate() />Berichtenservice verwijderen</label></div>'),showModal("xxAddAgentModal","idx_dlgOkButton",()=>account_manageMessagingRemove()),account_managePhoneRemoveValidate):(t="<select id=d2serviceselect style=width:160px;margin-left:8px onchange=account_manageMessagingValidate()>",0!=(1&serverinfo.userMsgProviders)&&(t+="<option value=1>Telegram</option>"),0!=(4&serverinfo.userMsgProviders)&&(t+="<option value=4>Discord</option>"),0!=(8&serverinfo.userMsgProviders)&&(t+="<option value=8>XMPP</option>"),0!=(16&serverinfo.userMsgProviders)&&(t+="<option value=16>CallMeBot</option>"),0!=(32&serverinfo.userMsgProviders)&&(t+="<option value=32>Pushover</option>"),0!=(64&serverinfo.userMsgProviders)&&(t+="<option value=64>ntfy</option>"),0!=(128&serverinfo.userMsgProviders)&&(t+="<option value=128>Zulip</option>"),0!=(256&serverinfo.userMsgProviders)&&(t+="<option value=256>Slack</option>"),e=(e='<table style=width:100%><tr><td style=width:56px;vertical-align:top><img src="images/messaging40.png" style=padding:8px>')+"<td>Voer uw berichtenservice en afhandeling in. Na verificatie kan deze server u aanmeldingsverificatie en andere meldingen sturen.<br /><br /><table><tr><td>Service<td>"+(t+="</select>")+"<tr><td>afhandeling<td><input maxlength=1024 style=width:160px;margin-left:8px id=d2handleinput onKeyUp=account_manageMessagingValidate() onkeypress=\"if (event.key=='Enter') account_manageMessagingValidate(1)\"></table>",serverinfo.discordUrl&&(e+="<div id=d2discordurl style=display:none><br /><a href="+serverinfo.discordUrl+' target="_discord">Word lid van deze Discord-server om meldingen te ontvangen.</a></div>'),e+='<div id=d2callmebotinfo style=display:none><br /><a href=https://www.callmebot.com/blog/free-api-signal-send-messages/ target="_callmebot">Signal</a>, <a href=https://www.callmebot.com/blog/free-api-whatsapp-messages/ target="_callmebot">Whatsapp</a>, <a href=https://www.callmebot.com/blog/free-api-facebook-messenger/ target="_callmebot">Facebook</a>, <a href=https://www.callmebot.com/blog/telegram-text-messages/ target="_callmebot">Telegram</a></div><div id=d2pushoverinfo style=display:none><br /><a href=https://pushover.net/ target="_pushover">Informatie op Pushover.net</a></div>',console.log(serverinfo.userMsgNftyUrl),e+='<div id=d2ntfyinfo style=display:none><br /><a href="'+(serverinfo.userMsgNftyUrl||"https://ntfy.sh/")+'" target="_ntfy">Gratis service via ntfy.sh</a></div>',xxdialogTag="VerifyMessaging",setModalContent("xxAddAgent","Berichten notificaties",e+='<div id=d2slackinfo style=display:none><br /><a href=https://api.slack.com/messaging/webhooks target="_slack">Slack Webhook Setup</a></div>'),showModal("xxAddAgentModal","idx_dlgOkButton",account_manageMessagingAdd()),Q("d2handleinput").focus(),account_manageMessagingValidate))()}function account_manageMessagingValidate(e){serverinfo.discordUrl&&QV("d2discordurl",4==Q("d2serviceselect").value),QV("d2callmebotinfo",16==Q("d2serviceselect").value),QV("d2pushoverinfo",32==Q("d2serviceselect").value),QV("d2ntfyinfo",64==Q("d2serviceselect").value),QV("d2slackinfo",256==Q("d2serviceselect").value),4==Q("d2serviceselect").value?Q("d2handleinput").placeholder="Gebruikersnaam:0000":8==Q("d2serviceselect").value?Q("d2handleinput").placeholder="gebruikersnaam@server.nl":16==Q("d2serviceselect").value?Q("d2handleinput").placeholder="https://api.callmebot.com/...":32==Q("d2serviceselect").value?Q("d2handleinput").placeholder="Gebruikerssleutel":64==Q("d2serviceselect").value?Q("d2handleinput").placeholder="Onderwerp":128==Q("d2serviceselect").value?Q("d2handleinput").placeholder="gebruikersnaam@voorbeeld.com":256==Q("d2serviceselect").value?Q("d2handleinput").placeholder="https://hooks.slack.com/...":Q("d2handleinput").placeholder="Gebruikersnaam";var t=0<Q("d2handleinput").value.length;QE("idx_dlgOkButton",t),1==e&&t&&dialogclose(1)}function account_manageMessagingAdd(){0!=Q("d2handleinput").value.length&&(QE("d2handleinput",!1),meshserver.send({action:"verifyMessaging",service:Q("d2serviceselect").value,handle:Q("d2handleinput").value}))}function account_manageMessagingConfirm(e,t){meshserver.send({action:"confirmMessaging",code:Q("d2phoneCodeInput").value,cookie:t})}function account_manageMessagingRemove(){Q("d2delPhone").checked&&meshserver.send({action:"removeMessaging"})}function account_manageAuthEmail(){var e;xxdialogMode||0==(8388608&features)||(setModalContent("xxAddAgent","E-mail authenticatie",'Indien ingeschakeld, krijgt u bij elke login de optie om een login-token voor uw e-mailaccount te ontvangen voor extra veiligheid.<br /><br /><label><input id=email2facheck type=checkbox class="form-check-input me-2" '+((e=1==userinfo.otpekey&&null!=userinfo.email&&1==userinfo.emailVerified)?"checked":"")+"/>Schakel e-mail tweefactorauthenticatie in.</label>"),showModal("xxAddAgentModal","idx_dlgOkButton",function(){e!=Q("email2facheck").checked&&meshserver.send({action:"otpemail",enabled:Q("email2facheck").checked})}))}function account_manageAuthDuo(){xxdialogMode||0==(536870912&features2)||(0==(1==userinfo.otpduo)?(setModalContent("xxAddAgent","Duo authenticatie",'Bevestig het inschakelen van Duo 2FA inlogbeveiliging. Eenmaal ingeschakeld, krijgt u de mogelijkheid om Duo te gebruiken bij het inloggen voor extra veiligheid. Klik op OK om de stappen te doorlopen om Duo in te schakelen.<p style="text-align:center;margin-top:10px"><img src="images/duo-2fa-250.png"></p>'),showModal("xxAddAgentModal","idx_dlgOkButton",function(){window.location.href="/add-duo?rurl="+encodeURIComponentEx(window.location.href)+(urlargs.key?"&key="+urlargs.key:"")})):(setModalContent("xxAddAgent","Duo authenticatie",'<p><label><input id=duo2facheck type=checkbox onclick=account_manageAuthDuoConfirm() /> Bevestig het uitschakelen van 2FA Duo inlogbeveiliging.</label></p><p style="text-align: center"><img src="images/duo-2fa-250-disable.png"></p>'),showModal("xxAddAgentModal","idx_dlgOkButton",function(){meshserver.send({action:"otpduo",enabled:!1})}),QE("idx_dlgOkButton",!1)))}function account_manageAuthDuoConfirm(){QE("idx_dlgOkButton",Q("duo2facheck").checked)}function account_manageAuthApp(){if(!xxdialogMode&&0!=(4096&features))return(1==userinfo.otpsecret?account_removeOtp:account_addOtp)(),!1}function account_addOtp(){xxdialogMode||1==userinfo.otpsecret||0==(4096&features)||(xxdialogTag="otpauth-request",setModalContent("xxAddAgent","Verificatie-app","<div id=d2optinfo>Laden...</div>"),showModal("xxAddAgentModal","idx_dlgOkButton",function(){meshserver.send({action:"otpauth-setup",secret:Q("d2optsecret").attributes.secret.value,token:Q("d2otpauthinput").value})}),meshserver.send({action:"otpauth-request"}))}function account_addOtpCheck(e){var t=6==Q("d2otpauthinput").value.length;QE("idx_dlgOkButton",t),e&&13==e.keyCode&&t&&dialogclose(1)}function account_removeOtp(){xxdialogMode||1!=userinfo.otpsecret||0==(4096&features)||(setModalContent("xxAddAgent","Verificatie-app","Bevestig de verwijdering van de Tweestapsverificatie applicatie?"),showModal("xxAddAgentModal","idx_dlgOkButton",function(){meshserver.send({action:"otpauth-clear"})}))}function account_manageOtp(e){return 2==xxdialogMode&&"otpauth-manage"==xxdialogTag&&dialogclose(0),xxdialogMode||0==(4096&features)||0<count2factoraAuths()&&meshserver.send({action:"otpauth-getpasswords",subaction:e}),!1}function account_managePushAuthDev(){if(!xxdialogMode&&0!=(64&features2)){if(1==userinfo.otpdev)setModalContent("xxAddAgent","Verificatieapparaat","Verwijderen van push-authenticatieapparaat bevestigen?"),showModal("xxAddAgentModal","idx_dlgOkButton",function(){meshserver.send({action:"otpdev-clear"})});else{var e=[];for(n in nodes){var t=nodes[n];null!=t.agent&&14==t.agent.id&&1==t.pmt&&4294967295==GetNodeRights(t)&&e.push(t)}if(0==e.length)setModalContent("xxAddAgent","Verificatieapparaat","In order to use push notification authentication, a mobile device must be setup in your account with full rights."),showModal("xxAddAgentModal","idx_dlgOkButton");else{var n,o="Selecteer een apparaat om te registreren voor verificatie via pushmeldingen. Eenmaal geselecteerd, zal het apparaat om bevestiging vragen.<br /><br />",a='<select id=d2devselect class="form-select">';for(n in e)a+='<option value="'+e[n]._id+'">'+EscapeHtml(e[n].name)+"</option>";setModalContent("xxAddAgent","Verificatieapparaat",o+=addHtmlFormFloating("Apparaat",a+="</select>")),showModal("xxAddAgentModal","idx_dlgOkButton",function(){meshserver.send({action:"otpdev-set",nodeid:Q("d2devselect").value})})}}return!1}}function account_manageHardwareOtp(){return 2==xxdialogMode&&"otpauth-hardware-manage"==xxdialogTag&&dialogclose(0),xxdialogMode||0==(4096&features)||meshserver.send({action:"otp-hkey-get"}),!1}function account_addhkey(e){var t;3==e?(t="Typ de naam van de sleutel die u wilt toevoegen.<br /><br />",t+=addHtmlFormFloating("Sleutelnaam",'<input id=dp1keyname class="form-control" maxlength=20 autocomplete=off placeholder="Mijn sleutel" onkeyup=account_addhkeyValidate(event,2) />')):2==e&&(t="Typ een sleutelnaam, selecteer het vak OTP en druk op de knop op de YubiKey&trade;.<br /><br />",t=(t+=addHtmlFormFloating("Sleutelnaam",'<input id=dp1keyname class="form-control" maxlength=20 autocomplete=off placeholder="Mijn sleutel" onkeyup=account_addhkeyValidate(event,1) />'))+addHtmlFormFloating("YubiKey&trade; OTP",'<input id=dp1key class="form-control" autocomplete=off onkeyup=account_addhkeyValidate(event,2) />')),setModalContent("xxAddAgent","Beveiligingssleutel toevoegen",t),showModal("xxAddAgentModal","idx_dlgOkButton",()=>account_addhkeyEx(3,e)),Q("dp1keyname").focus()}function account_addhkeyValidate(e,t){null!=e&&13==e.keyCode&&(2==t?dialogclose(1):Q("dp1key").focus())}function account_addhkeyEx(e,t){var n=Q("dp1keyname").value;""==n&&(n="MyKey"),2==t?(meshserver.send({action:"otp-hkey-yubikey-add",name:n,otp:Q("dp1key").value}),xxdialogTag="otpauth-hardware-manage",setModalContent("xxAddAgent","Beveiligingssleutel toevoegen","<br />Controleren...<br /><br /><br />"),showModal("xxAddAgentModal","idx_dlgOkButton")):3==t&&meshserver.send({action:"webauthn-startregister",name:n})}function account_removehkey(e){meshserver.send({action:"otp-hkey-remove",index:e}),meshserver.send({action:"otp-hkey-get"})}var currentMesh,filetreelinkpath,loclist={af:"Afrikaans",sq:"Albanees",ar:"Arabisch (Standaard)","ar-dz":"Arabisch (Algerije)","ar-bh":"Arabisch (Bahrein)","ar-eg":"Arabisch (Egypte)","ar-iq":"Arabisch (Irak)","ar-jo":"Arabisch (Jordanië)","ar-kw":"Arabisch (Koeweit)","ar-lb":"Arabisch (Libanon)","ar-ly":"Arabisch (Libië)","ar-ma":"Arabisch (Marokko)","ar-om":"Arabisch (Oman)","ar-qa":"Arabisch (Qatar)","ar-sa":"Arabisch (Saoedi-Arabië)","ar-sy":"Arabisch (Syrië)","ar-tn":"Arabisch (Tunesië)","ar-ae":"Arabisch (Verenigde Arabische Emiraten.)","ar-ye":"Arabisch (Jemen)",an:"Aragonese",hy:"Armeens",as:"Assamees",ast:"Asturische",az:"Azerbeidzjaanse",eu:"Baskisch",bg:"Bulgaars",be:"Wit-Rusland",bn:"Bengalees",bs:"Bosnisch",br:"Breton",my:"Birmaans",ca:"Catalaans",ch:"Chamorro",ce:"Tsjetsjeense",zh:"Chinees","zh-hk":"Chinees (Hong Kong)","zh-cn":"Chinees (PRC)","zh-sg":"Chinees (Singapore)","zh-tw":"Chinees (Taiwan)",cv:"Chuvash",co:"Corsicaans",cr:"Cree",hr:"Kroatisch",cs:"Tsjechisch",da:"Deens",nl:"Nederlands (Standaard)","nl-be":"Nederlands (Belgisch)",en:"Engels","en-au":"Engels (Australië)","en-bz":"Engels (Belize)","en-ca":"Engels (Canada)","en-ie":"Engels (Ierland)","en-jm":"Engels (Jamaica)","en-nz":"Engels (Nieuw Zeeland)","en-ph":"Engels (Filippijnen)","en-za":"Engels (Zuid Africa)","en-tt":"Engels (Trinidad & Tobago)","en-gb":"Engels (Verenigd Koninkrijk)","en-us":"Engels (Verenigde staten van America)","en-zw":"Engels (Zimbabwe)",eo:"Esperanto",et:"Estlands",fo:"Faeroese",fa:"Perzisch (Perzisch)",fj:"Fijian",fi:"Fins",fr:"Frans (standaard)","fr-be":"Frans (België)","fr-ca":"Frans (Canada)","fr-fr":"Frans (Frankrijk)","fr-lu":"Frans (Luxemburg)","fr-mc":"Frans (Monaco)","fr-ch":"Frans (Zwitserland)",fy:"Fries",fur:"Friulian",gd:"Gaelic (Schots)","gd-ie":"Gaelic (Iers)",gl:"Galacian",ka:"Georgisch",de:"Duits (standaard)","de-at":"Duits (Oostenrijk)","de-de":"Duits (duitsland)","de-li":"Duits (Liechtenstein)","de-lu":"Duits (Luxemburg)","de-ch":"Duits (Zwitserland)",el:"Grieks",gu:"Gujurati",ht:"Haïtiaanse",he:"Hebreeuws",hi:"Hindi",hu:"Hongaars",is:"IJslands",id:"Indonesisch",iu:"Inuktitut",ga:"Iers",it:"Italiaans (standaard)","it-ch":"Italiaans (Zwitserland)",ja:"Japans",kn:"Kannada",ks:"kasjmier",kk:"Kazachse",km:"Khmer",ky:"Kirgizisch",tlh:"Klingon",ko:"Koreaans","ko-kp":"Koreaans (Noord-Korea)","ko-kr":"Koreaans (Zuid-Korea)",la:"latijns",lv:"Lets",lt:"Litouws",lb:"Luxemburgs",mk:"FYRO Macedonisch",ms:"Maleis",ml:"Malayalam",mt:"Maltese",mi:"Maori",mr:"Marathi",mo:"Moldavisch ",nv:"Navajo",ng:"Ndonga",ne:"Nepalees",no:"Noors",nb:"Noors (Bokmal)",nn:"Noors (Nynorsk)",oc:"Occitaans",or:"Oriya",om:"Oromo","fa-ir":"Perzisch / Iran",pl:"Pools",pt:"Portugees","pt-br":"Portugees (Brazilië)",pa:"Punjabi","pa-in":"Punjabi (India)","pa-pk":"Punjabi (Pakistan)",qu:"Quechua",rm:"Rhetoromaans",ro:"Roemeense","ro-mo":"Roemeens (Moldavië)",ru:"Russisch","ru-mo":"Russisch (Moldavië)",sz:"Sami (Lapse)",sg:"Sango",sa:"Sanskriet",sc:"Sardijns",sd:"Sindhi",si:"Sinhalees",sr:"Servisch",sk:"Slowaaks",sl:"Sloveens",so:"Somani",sb:"Sorbisch",es:"Spaans","es-ar":"Spaans (Argentinië)","es-bo":"Spaans (Bolivia)","es-cl":"Spaans (Chili)","es-co":"Spaans (Colombia)","es-cr":"Spaans (Costa Rica)","es-do":"Spaans (Dominicaanse Republiek)","es-ec":"Spaans (Ecuador)","es-sv":"Spaans (El Salvador)","es-gt":"Spaans (Guatemala)","es-hn":"Spaans (Honduras)","es-mx":"Spaans (Mexico)","es-ni":"Spaans (Nicaragua)","es-pa":"Spaans (Panama)","es-py":"Spaans (Paraguay)","es-pe":"Spaans (Peru)","es-pr":"Spaans (Puerto Rico)","es-es":"Spaans (Spanje)","es-uy":"Spaans (Uruguay)","es-ve":"Spaans (Venezuela)",sx:"Sutu",sw:"Swahili",sv:"Zweeds","sv-fi":"Zweeds (Finland)","sv-sv":"Zweeds (Zweden)",ta:"Tamil",tt:"Tartaar",te:"Teluga",th:"Thais",tig:"Tigre",ts:"Tsonga",tn:"Tswana",tr:"Turks",tk:"Turkmeens",uk:"Oekraïens",hsb:"Sorbisch",ur:"Urdu",ve:"Venda",vi:"Vietnamees",vo:"Volapuk",wa:"Waals",cy:"Wels",xh:"Xhosa",ji:"Jiddisch",zu:"Zulu"},loclistex={"zh-chs":"Chinees (Vereenvoudigd)","zh-cht":"Chinese (Traditioneel)"};function account_showLocalizationSettings(){if(!xxdialogMode){var e=getstore("loctag",0),t="",n='<select id=d2locselect class="form-select"><option value="*">Browserwaarde gebruiker</option>';for(o in loclist)n+='<option value="'+o+'"'+(e==o?" selected":"")+">"+o+" - "+loclist[o]+"</option>";if(n+="</select>",serverinfo.languages&&0<serverinfo.languages.length){t+="Als u de taal wilt wijzigen, moet de pagina worden ververst.<br /><br />";var o,a='<select id=d2langselect class="form-select"><option value="*">Browserwaarde gebruiker</option>';for(o in serverinfo.languages){var i=serverinfo.languages[o];a+='<option value="'+i+'"'+(userinfo.lang==i?" selected":"")+">"+i+" - "+(loclist[i]||loclistex[i])+"</option>"}t+=addHtmlFormFloating("Taal",a+="</select>")}t+=addHtmlFormFloating("Datum & Tijd",n),4294967295==userinfo.siteadmin&&""==domain&&(t+='<br /><a rel="noreferrer noopener" target="_blank" href="translator.htm">Help bij het vertalen van MeshCentral</a>'),setModalContent("xxAddAgent","Lokalisatie instellingen",t),showModal("xxAddAgentModal","idx_dlgOkButton",account_showLocalizationSettingsEx)}return!1}function account_showLocalizationSettingsEx(){var e=Q("d2langselect"),e=e?e.value:null,e=((e="*"==e&&null==userinfo.lang?userinfo.lang:e)!=userinfo.lang&&meshserver.send({action:"changelang",lang:e}),getstore("loctag",0)),t=Q("d2locselect").value;e!=t&&("*"!=t?args.locale=t:delete args.locale,putstore("loctag",args.locale),mainUpdate(4294967295))}function account_enableNotifications(){return Notification&&Notification.requestPermission().then(function(e){QV("accountEnableNotificationsSpan","granted"!=e),setupServiceWorker()}),!1}function account_createLoginToken(){if(xxdialogMode)return!1;var e,t="",n="Maak een tijdelijke gebruikersnaam en wachtwoord aan die kunnen worden gebruikt als alternatieve login voor uw account. Dit is handig om tools of andere services toegang te geven tot uw account.<br /><br />",o={0:"Ongelimiteerd",1:"1 minuut",5:"5 minuten",10:"10 minuten",15:"15 minuten",30:"30 minuten",45:"45 minuten",60:"60 minuten",120:"2 uur",240:"4 uur",480:"8 uur",720:"12 uur",960:"16 uur",1440:"24 uur",2880:"2 dagen",5760:"4 dagen",10080:"7 dagen"};for(e in o)t+="<option value="+e+">"+o[e]+"</option>";setModalContent("xxAddAgent","Maak een login-token aan",n+'<div class="form-floating mb-3">'+'<input type=text class="boxsize form-control" id=d2tokenName maxlength="100" placeholder="Token naam" onchange=account_createLoginTokenValidate() onkeyup=account_createLoginTokenValidate()>'+"<label for=d2tokenName>Token naam</label>"+"</div>"+addHtmlFormFloating("Verval datum",'<select class="boxsize form-select" id=d2tokenExpire>'+t+"</select>")),showModal("xxAddAgentModal","idx_dlgOkButton",account_createLoginTokenEx),QE("idx_dlgOkButton",!1),Q("d2tokenName").focus()}function account_createLoginTokenValidate(){QE("idx_dlgOkButton",0<Q("d2tokenName").value.length)}function account_createLoginTokenEx(){meshserver.send({action:"createLoginToken",name:Q("d2tokenName").value,expire:parseInt(Q("d2tokenExpire").value)})}function account_showAccountNotifySettings(){var e;return xxdialogMode||(setModalContent("xxAddAgent","Meldingsinstellingen",'<div class="form-check"><label><input id=p2notifyPlayNotifySound class="form-check-input me-2" type=checkbox />Meldingsgeluid</label></div><div class="form-check"><label><input id=p2notifyGroupName class="form-check-input me-2" type=checkbox />Toon apparaatgroepsnaam</label></div><div class="form-check"><label><input id=p2notifyIntelDeviceConnect class="form-check-input me-2" type=checkbox />Apparaat verbonden</label></div><div class="form-check"><label><input id=p2notifyIntelDeviceDisconnect class="form-check-input me-2" type=checkbox />Apparaatverbinding verbroken</label></div><div class="form-check"><label><input id=p2notifyIntelAmtKvmActions class="form-check-input me-2" type=checkbox />Intel&reg; AMT desktop- en seriële gebeurtenissen</label></div>'),showModal("xxAddAgentModal","idx_dlgOkButton",account_showAccountNotifySettingsEx),e=getstore("notifications",0),Q("p2notifyPlayNotifySound").checked=1&e,Q("p2notifyIntelDeviceConnect").checked=2&e,Q("p2notifyIntelDeviceDisconnect").checked=4&e,Q("p2notifyIntelAmtKvmActions").checked=8&e,Q("p2notifyGroupName").checked=16&e),!1}function account_showAccountNotifySettingsEx(){var e=0;putstore("notifications",(e+=Q("p2notifyPlayNotifySound").checked?1:0)+(Q("p2notifyIntelDeviceConnect").checked?2:0)+(Q("p2notifyIntelDeviceDisconnect").checked?4:0)+(Q("p2notifyIntelAmtKvmActions").checked?8:0)+(Q("p2notifyGroupName").checked?16:0))}function account_showVerifyEmail(){return xxdialogMode||1==userinfo.emailVerified||1!=serverinfo.emailcheck||(setModalContent("xxAddAgent","E-mail verificatie","Klik op OK om een verificatiebericht te sturen naar:<br /><div style=padding:8px><b>"+EscapeHtml(userinfo.email)+"</b></div>Wacht enkele minuten om de verificatie te ontvangen."),showModal("xxAddAgentModal","idx_dlgOkButton",()=>account_showVerifyEmailEx())),!1}function account_showVerifyEmailEx(){meshserver.send({action:"verifyemail",email:userinfo.email})}function account_showChangeEmail(){return xxdialogMode||(setModalContent("xxAddAgent","E-mailadres wijzigen",'Wijzig hier het e-mailadres van uw account.<br /><br /><div class="form-floating"><input id=dp2email class="form-control" maxlength=256 onchange=account_validateEmail() onkeyup=account_validateEmail(event) placeholder=Email /> <label for=dp2email>Email</label></div>'),showModal("xxAddAgentModal","idx_dlgOkButton",account_changeEmail),null!=userinfo.email&&(Q("dp2email").value=userinfo.email),account_validateEmail(),Q("dp2email").focus()),!1}function account_validateEmail(e,t){QE("idx_dlgOkButton",validateEmail(Q("dp2email").value)&&Q("dp2email").value!=userinfo.email),null!=e&&13==e.keyCode&&dialogclose(1)}function account_changeEmail(){meshserver.send({action:"changeemail",email:Q("dp2email").value})}function account_showDeleteAccount(){return xxdialogMode||(setModalContent("xxAddAgent","Verwijder account","Om dit account te verwijderen, typt u het accountwachtwoord in beide onderstaande vakken en klikt u op OK.<br /><br />"+"<form method=post>"+"<input type=hidden name=action value=deleteaccount />"+('<input type=hidden name=authcookie value="'+authCookie+'" />')+'<div class="container">'+'<div class="form-floating mb-2">'+'<input type=password class="form-control" id=apassword1 name=apassword1 autocomplete=off placeholder="Password" onchange=account_validateDeleteAccount() onkeyup=account_validateDeleteAccount()>'+'<label for="apassword1">Password</label>'+"</div>"+'<div class="form-floating mb-3">'+'<input type=password class="form-control" id=apassword2 name=apassword2 autocomplete=off placeholder="Confirm Password" onchange=account_validateDeleteAccount() onkeyup=account_validateDeleteAccount()>'+"<label for=apassword2>Confirm Password</label>"+"</div>"+"</div>"+"</form>"),showModal("xxAddAgentModal","idx_dlgOkButton",function(){dialogclose(1)}),account_validateDeleteAccount(),Q("apassword1").focus()),!1}function account_showChangePassword(){if(!xxdialogMode){var e="Wijzig uw wachtwoord door het invoeren van het oude en het nieuwe wachtwoord twee keer in de vakken hieronder.",e=(e=(e=(e=(e=(e=(e=(e+="<br /><br />")+'<div class="container">'+'<div class="form-floating mb-2">')+'<input type=password class="form-control" id=apassword0 name=apassword0 autocomplete=off placeholder="Old password" onchange=account_validateNewPassword() onkeyup=account_validateNewPassword() onkeydown=account_validateNewPassword()>'+"<label for=apassword0>Old password</label>")+"</div>"+'<div class="form-floating mb-2">')+'<input type=password class="form-control" id=apassword1 name=apassword1 autocomplete=off placeholder="New password" onchange=account_validateNewPassword() onkeyup=account_validateNewPassword() onkeydown=account_validateNewPassword()>'+"<label for=apassword1>New password</label>")+"<b><span id=dxPassWarn></span></b>"+"</div>")+'<div class="form-floating mb-2">'+'<input type=password class="form-control" id=apassword2 name=apassword2 autocomplete=off placeholder="Confirm new password" onchange=account_validateNewPassword() onkeyup=account_validateNewPassword() onkeydown=account_validateNewPassword()>')+"<label for=apassword2>Confirm new password</label>"+"</div>";if(65536&features&&(e+='<div class="form-floating mb-2"><input type=text class="form-control" id=apasswordhint name=apasswordhint maxlength=250 autocomplete=off onchange=account_validateNewPassword() onkeyup=account_validateNewPassword() onkeydown=account_validateNewPassword()><label for=apasswordhint>Password hint</label></div>'),e+="</div>",passRequirements){var t,n=[],o=0;for(t in passRequirements)"reset"!=t&&"hint"!=t&&(n.push(t+":"+passRequirements[t]),o++);0<o&&(e+="<br /><span style=font-size:x-small>Vereisten:"+n.join(", ")+".</span>")}setModalContent("xxAddAgent","Verander wachtwoord",e+="<br />"),showModal("xxAddAgentModal","idx_dlgOkButton",account_showChangePasswordEx),Q("apassword0").focus(),account_validateNewPassword()}return!1}function account_showChangePasswordEx(){var e;Q("apassword1").value==Q("apassword2").value&&(e={action:"changepassword",oldpass:Q("apassword0").value,newpass:Q("apassword1").value},65536&features&&(e.hint=Q("apasswordhint").value),meshserver.send(e))}function account_showThemesSwitcher(){var n,e,o,a;return xxdialogMode||(n=getstore("theme")||"default",e=JSON.parse(getstore("lastThemes")||"[]"),o=new Set(e),a='<div class="form-group"><label for="theme-switcher">Select a theme:</label>',a+='<select id="theme-switcher" class="form-select" onchange="account_switchThemeEx()">',0<e.length&&(a+='<optgroup label="Recent Themes"">',e.forEach(function(e){a+=`<option value="${e}"${e===n?" selected":""}>${e.charAt(0).toUpperCase()+e.slice(1)}</option>`}),a+="</optgroup>"),a+='<optgroup label="Alle thema\'s">',[{value:"default",label:"Standaard"},{value:"cerulean",label:"Hemelsblauw"},{value:"cosmo",label:"Cosmo"},{value:"cyborg",label:"Cyborg"},{value:"darkly",label:"Donker"},{value:"flatly",label:"Plat"},{value:"journal",label:"Logging"},{value:"litera",label:"Litera"},{value:"lumen",label:"Lumen"},{value:"lux",label:"Lux"},{value:"materia",label:"Materia"},{value:"minty",label:"Minty"},{value:"morph",label:"Morph"},{value:"pulse",label:"Pulse"},{value:"sandstone",label:"Sandstone"},{value:"simplex",label:"Simplex"},{value:"sketchy",label:"Sketchy"},{value:"solar",label:"Solar"},{value:"spacelab",label:"Spacelab"},{value:"united",label:"United"},{value:"vapor",label:"Vapor"},{value:"yeti",label:"Yeti"},{value:"zephyr",label:"Zephyr"}].forEach(function(e){var t;o.has(e.value)||(t=e.value===n?" selected":"",a+=`<option value="${e.value}"${t}>${e.label}</option>`)}),setModalContent("xxAddAgent","Switch theme",a=a+"</optgroup>"+"</select></div>"),showModal("xxAddAgentModal","idx_dlgOkButton")),!1}function account_switchThemeEx(){let e=document.getElementById("theme-switcher"),t=e.value;var n="default"!=t?encodeURIComponent(t):encodeURIComponent(".."),n=(document.getElementById("theme-stylesheet").href=`styles/themes/${n}/bootstrap-min.css`,putstore("theme",t),JSON.parse(getstore("lastThemes")||"[]"));(n.includes(t)?n=n.filter(e=>e!==t):(4<=n.length&&n.pop(),n)).unshift(t),putstore("lastThemes",JSON.stringify(n))}function account_createMesh(){if(4294967295!=userinfo.siteadmin&&0!=(64&userinfo.siteadmin))setModalContent("xxAddAgent","Nieuwe apparaatgroep","This account does not have the rights to create a new device group."),showModal("xxAddAgentModal","idx_dlgOkButton");else if(!0!==userinfo.emailVerified&&1==serverinfo.emailcheck&&4294967295!=userinfo.siteadmin)setModalContent("xxAddAgent","Gebruikersaccount beveiliging",'Unable to access this feature until a email address is verified. This is required for password recovery. Go to the "My Account" tab to change and verify an email address.'),showModal("xxAddAgentModal","idx_dlgOkButton");else if(262144&features&&0==count2factoraAuths())setModalContent("xxAddAgent","Gebruikersaccount beveiliging",'Unable to access this feature until two-factor authentication is enabled. This is required for extra security. Go to the "My Account" tab and look at the "Account Security" section.'),showModal("xxAddAgentModal","idx_dlgOkButton");else{var e=[];if(0==(2&features))for(var t in nodes){var n=nodes[t];2==n.mtype&&null!=n.agent&&4294967295==GetNodeRights(n)&&e.push(n)}var o="Maak een nieuwe apparaatgroep met behulp van de onderstaande opties.<br /><br />",a="";if(o+=addHtmlFormFloating("Naam",'<input id=dp2meshname maxlength=128 placeholder="Name" class=form-control onchange=account_validateMeshCreate() onkeyup=account_validateMeshCreate(event,1) />'),0==(1&features)&&(a+="<option value=3>Lokale apparaten, geen agent</option>"),0==(2&features)&&0<e.length&&(a+="<option value=103>Geen apparaten doorgestuurd via agent</option>"),65536&features2&&(0==(1&features)&&(a+="<option value=4>IP-KVM / Power device</option>"),0==(2&features))&&0<e.length&&(a+="<option value=104>IP-KVM / Power-apparaat doorgestuurd via agent</option>"),o+=addHtmlFormFloating("Type","<select id=dp2meshtype class=form-select onchange=account_validateMeshCreate() onkeyup=account_validateMeshCreate(event,2) ><option value=2>Beheer met behulp van een software-agent</option><option value=1>Alleen Intel&reg; AMT, geen agent</option>"+a+"</select>"),0<e.length){o+="<div id=d2devrelaydiv style=display:none>",e.sort(nameSort);var i=[];for(t in e)i.push('<option value="'+e[t]._id+'">'+EscapeHtml(e[t].name)+"</option>");o=o+addHtmlFormFloating("Doorstuur apparaat","<select id=d2devrelay onchange=account_validateMeshCreate() onkeyup=account_validateMeshCreate(event,2) class=form-select >"+i.join("")+"</select>")+"</div>"}setModalContent("xxAddAgent","Nieuwe apparaatgroep",o=(o=(o=(o=(o=o+addHtmlFormFloating("Omschrijving","<textarea id=dp2meshdesc maxlength=1024 class=form-control></textarea>")+"<div id=d2ipkvm style=display:none><hr />")+addHtmlFormFloating("Model","<select id=dp2ipkvmmodel onchange=account_validateMeshCreate() onkeyup=account_validateMeshCreate(event,2) class=form-select ><option value=1>Raritan Dominion KX III</option><option value=2>Web Power Switch 7</option></select>"))+addHtmlFormFloating("Hostnaam",'<input id=dp2ipkvmhost maxlength=128 placeholder="Hostname" onchange=account_validateMeshCreate() onkeyup=account_validateMeshCreate(event,1) class=form-control />'))+addHtmlFormFloating("Gebruikersnaam",'<input id=dp2ipkvmuser maxlength=128 placeholder="Username" onchange=account_validateMeshCreate() onkeyup=account_validateMeshCreate(event,1) class=form-control />'))+addHtmlFormFloating("Wachtwoord",'<input id=dp2ipkvmpass type=password placeholder="Password" maxlength=128 onchange=account_validateMeshCreate() onkeyup=account_validateMeshCreate(event,1) class="form-control" />')+"</div>"),showModal("xxAddAgentModal","idx_dlgOkButton",account_createMeshEx),account_validateMeshCreate(),document.getElementById("dp2meshname").focus()}return!1}function account_validateMeshCreate(e,t){var n=parseInt(Q("dp2meshtype").value),t=(1==t&&null!=e&&"invoeren"==e.key&&0<Q("dp2meshname").value.length&&Q("dp2meshtype").focus(),2==t&&null!=e&&"invoeren"==e.key&&Q("dp2meshdesc").focus(),0<Q("dp2meshname").value.length);QV("d2ipkvm",4==n||104==n);try{QV("d2devrelaydiv",100<n)}catch(e){}4==n&&0==Q("dp2ipkvmhost").value.length&&0==Q("dp2ipkvmuser").value.length&&0==Q("dp2ipkvmpass").value.length&&(t=!1),QE("idx_dlgOkButton",t)}function account_createMeshEx(e,t){var n=parseInt(Q("dp2meshtype").value),o={action:"createmesh",meshname:Q("dp2meshname").value,meshtype:n,desc:Q("dp2meshdesc").value};4!=n&&104!=n||(o.kvmmodel=parseInt(Q("dp2ipkvmmodel").value),o.kvmhost=Q("dp2ipkvmhost").value,o.kvmuser=Q("dp2ipkvmuser").value,o.kvmpass=Q("dp2ipkvmpass").value),100<n&&(o.meshtype=n-100,o.relayid=Q("d2devrelay").value),meshserver.send(o)}function account_validateDeleteAccount(){QE("account_dlgOkButton",0<Q("apassword1").value.length&&Q("apassword1").value==Q("apassword2").value)}function account_validateNewPassword(){var e,t="",n=0<Q("apassword0").value.length&&0<Q("apassword1").value.length&&Q("apassword1").value==Q("apassword2").value&&Q("apassword0").value!=Q("apassword1").value;65536&features&&Q("apasswordhint").value==Q("apassword1").value&&(n=!1),""!=Q("apassword1").value&&(null==passRequirements||""==passRequirements?t=80<=(e=checkPasswordStrength(Q("apassword1").value))?"<span style=color:green>Sterk<span>":60<=e?"<span style=color:blue>Goed<span>":"<span style=color:red>Zwak<span>":0==checkPasswordRequirements(Q("apassword1").value,passRequirements)&&(n=!1,t="<span style=color:red>Beleid<span>")),QH("dxPassWarn",t),QE("idx_dlgOkButton",n)}function checkPasswordStrength(e){var t=0,n={},o=0,a={digits:/\d/.test(e),lower:/[a-z]/.test(e),upper:/[A-Z]/.test(e),nonWords:/\W/.test(e)};if(!e)return 0;for(var i,s=0;s<e.length;s++)n[e[s]]=(n[e[s]]||0)+1,t+=5/n[e[s]];for(i in a)o+=1==a[i]?1:0;return parseInt(t+10*(o-1))}function checkPasswordRequirements(e,t){if(null==t||""==t||"object"!=typeof t)return!0;if(t.min&&e.length<t.min)return!1;if(t.max&&e.length>t.max)return!1;for(var n=0,o=0,a=0,i=0,s=0;s<e.length;s++)/\d/.test(e[s])&&n++,/[a-z]/.test(e[s])&&o++,/[A-Z]/.test(e[s])&&a++,/\W/.test(e[s])&&i++;return!(t.numeric&&n<t.numeric||t.lower&&o<t.lower||t.upper&&a<t.upper||t.nonalpha&&i<t.nonalpha)}function updateMeshes(){var e='<div class="row">',t=0,n=0,o=[];for(i in meshes)o.push(meshes[i]);for(i in o.sort(nameSort),o){1<t&&(e+="</tr><tr>",t=0),t++,n++;var a=GetMeshRights(o[i]),s="Gedeeltelijke rechten";4294967295==a?s="Volledige beheerder":0==a&&(s="Geen rechten"),e+=`
                    <div class="col-sm-12 col-md-6 col-lg-4 col-xl-3 mb-2"
                            onclick="gotoMesh('`+o[i]._id+`')"
                            onkeypress="if (event.key=='Enter') gotoMesh('`+o[i]._id+`')"
                            style="cursor:pointer;">
                        <div class="card mb-3">
                            <div class="row g-0">
                                <div class="col-2 parent" style="display: flex; justify-content: center; align-items: center;">
                                    <i class="mi me-1"></i>
                                </div>
                                <div class="col-10 mx-auto" tabindex="0">
                                    <div class="card-body" style=padding:0;>
                                        <h5 class="card-title e1">`+EscapeHtml(o[i].name)+`</h5>
                                        <p class="card-text">`+s+`</p>
                                        <div class="g2"></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    `}e+="</div>",meshcount=n,QH("p2meshes",e),QV("p2noMeshFound",0==n)}function updateLoginTokens(){var e="",t=1;if(null!=loginTokens&&0<loginTokens.length){for(var e=e+'<p><strong>Actieve login-tokens</strong> - <span id="p2createMeshLink1"> <button class="btn btn-primary btn-sm" onclick="return account_createLoginToken()"><i class="fa-fw fa-solid fa-circle-plus"></i> Nieuw</button></span></p>'+'<div style=margin-left:40px><table class="table table-hover table-striped"><tbody><tr class="table-active"><th scope=col style=text-align:left;width:430px>Naam</th><th scope=col style=text-align:left>Gebruikersnaam</th></tr>',n=0;n<loginTokens.length;n++){var o=loginTokens[n],a="<a href=# onclick='return p2removeLoginToken(event,\""+encodeURIComponentEx(o.tokenUser)+'")\' title="Inlogtoken verwijderen" role=button><i class="fa-solid fa-trash text-danger fa-xs"></i></a>',i="";0!=o.expire&&(i=EscapeHtml(format("vervalt op {0}",printDateTime(new Date(o.expire))))+" "),e+="<tr "+(++t%2==0?"style=background-color:#DDD":"")+'><td style=width:30%><i class="fa-fw fa-solid fa-user"></i>&nbsp;'+EscapeHtml(o.name)+"<div></div></div></td><td style=width:70%><div style=float:right>"+i+a+"</div><div>"+EscapeHtml(o.tokenUser)+"</div></td></tr>"}e+="</tbody></table></div><br />",QV("accountCreateLoginTokenSpan",!1)}else QV("accountCreateLoginTokenSpan",128&features2);QH("p2logintokens",e)}function p2removeLoginToken(e,t){if(t=decodeURIComponent(t),null!=loginTokens){for(var n,o=null,a=0;a<loginTokens.length;a++)loginTokens[a].tokenUser==t&&(o=loginTokens[a]);null!=o&&(n="Bevestig de verwijdering van dit inlogtoken?<br /><br />",setModalContent("xxAddAgent","Inlogtoken verwijderen",n=(n+=addHtmlValue("Naam",EscapeHtml(o.name)))+addHtmlValue("Gebruikersnaam",EscapeHtml(o.tokenUser))),showModal("xxAddAgentModal","idx_dlgOkButton",()=>function(e,t){meshserver.send({action:"loginTokens",remove:[t]})}))}}function gotoMesh(e){return currentMesh=meshes[e],p20updateMesh(),go(20),!1}function server_setupGoogleDriveBackup(){if(xxdialogMode||null==miscState.googleDrive)return!1;var e,t=miscState.googleDrive;t.state<3?(e='<img style=float:right src="images/googledrive-48.png" /><div>Stel deze server in om automatisch back-ups naar Google Drive te uploaden. Begin met het maken en invoeren van een Google Drive ClientID en ClientSecret voor uw account.</div><br />',setModalContent("xxAddAgent","Google Drive Backup",e=(e=(e+=addHtmlValue("Inloggegevens",'<a href="https://console.developers.google.com/apis/api/drive.googleapis.com/credentials" rel="noreferrer noopener" target="_blank">Google Drive Console</a>'))+addHtmlFormFloating("Client ID",'<input id=gdclientid class="form-control" placeholder="xxxxxxxx.apps.googleusercontent.com" onkeyup=server_setupGoogleDriveBackupCheck1()></input>'))+addHtmlFormFloating("Client Secret",'<input id=gdclientsecret class="form-control" onkeyup=server_setupGoogleDriveBackupCheck1()></input>')),showModal("xxAddAgentModal","idx_dlgOkButton",()=>server_setupGoogleDriveBackupEx(3,"gd1")),Q("gdclientid").focus(),QE("idx_dlgOkButton",!1)):3==t.state&&(e='<img style=float:right src="images/googledrive-48.png" /><div>Google Drive backup is momenteel aktief</div>',setModalContent("xxAddAgent","Google Drive Backup",e+='<br /><label><input id=gdcheck type=checkbox class="form-check-input me-2" onchange=server_setupGoogleDriveBackupCheck2() />Configuratie verwijderen</label>'),showModal("xxAddAgentModal","idx_dlgOkButton",()=>server_setupGoogleDriveBackupEx(3,"gd0")),QE("idx_dlgOkButton",!1))}function server_setupGoogleDriveBackupCheck1(){QE("idx_dlgOkButton",0<Q("gdclientid").value.length&&0<Q("gdclientsecret").value.length)}function server_setupGoogleDriveBackupCheck2(){QE("idx_dlgOkButton",Q("gdcheck").checked)}function server_setupGoogleDriveBackupCheck3(){QE("idx_dlgOkButton",0<Q("gdcode").value.length)}function server_setupGoogleDriveBackupEx(e,t){"gd0"==t&&meshserver.send({action:"serverBackup",service:"googleDrive",state:0}),"gd1"==t&&meshserver.send({action:"serverBackup",service:"googleDrive",state:1,clientid:Q("gdclientid").value,clientsecret:Q("gdclientsecret").value}),"gd2"==t&&meshserver.send({action:"serverBackup",service:"googleDrive",state:2,code:Q("gdcode").value})}function server_showRestoreDlg(){var e;return xxdialogMode||(e="Herstel de server met een back-up, <span style=color:red>hiermee worden de bestaande servergegevens verwijderd.</span> Doe dit alleen als je weet wat je doet.<br /><br />",setModalContent("xxAddAgent","Server herstellen",e=(e=(e+='<form action="/restoreserver.ashx'+(urlargs.key?"?key="+urlargs.key:"")+'" enctype="multipart/form-data" method="post"><div>')+("<input type=hidden name=auth value="+authCookie+">"))+'<input id=account_dlgFileInput type=file name=datafile class="form-control" accept=".zip,application/octet-stream,application/zip,application/x-zip,application/x-zip-compressed" onchange=account_validateServerRestore()>'+"</div></form>"),showModal("xxAddAgentModal","idx_dlgOkButton"),account_validateServerRestore()),!1}function account_validateServerRestore(){QE("idx_dlgOkButton",1==Q("account_dlgFileInput").files.length)}function server_showVersionDlg(){return xxdialogMode||(xxdialogMode=2,xxdialogTag="MeshCentralServerUpdate",setModalContent("xxAddAgent","MeshCentral Versie","Laden..."),showModal("xxAddAgentModal","idx_dlgOkButton"),meshserver.send({action:"serverversion"})),!1}function server_showVersionDlgUpdate(){var e=Q("d2updateCheck1").checked,t=Q("d2updateCheck2").checked;QE("d2updateCheck1","Onbekend"!=xxdialogTag.stable&&xxdialogTag.current!=xxdialogTag.stable&&0==t),QE("d2updateCheck2","Onbekend"!=xxdialogTag.latest&&xxdialogTag.current!=xxdialogTag.latest&&0==e),QE("idx_dlgOkButton",e&&!t||!e&&t)}function server_showVersionDlgEx(e,t){Q("d2updateCheck1").checked&&meshserver.send({action:"serverupdate",tag:"stable",version:t.stable}),Q("d2updateCheck2").checked&&meshserver.send({action:"serverupdate",tag:"latest",version:t.latest})}function server_showErrorsDlg(){return xxdialogMode||(xxdialogMode=2,xxdialogTag="MeshCentralServerErrors",setModalContent("xxAddAgent","Server Fouten","Laden..."),meshserver.send({action:"servererrors"})),!1}function server_showErrorsDlgUpdate(){QE("idx_dlgOkButton",Q("d2clearErrorsCheck").checked)}function server_showErrorsDlgEx(){meshserver.send({action:"serverclearerrorlog"})}function d2CopyServerErrorsToClip(){saveAs(new Blob([Q("d2ServerErrorsLogPre").innerText],{type:"application/octet-stream"}),"servererrors.txt")}function server_showConfigDlg(){return xxdialogMode||(xxdialogMode=2,xxdialogTag="MeshCentralServerConfig",meshserver.send({action:"serverconfig"})),!1}function d2CopyServerConfigToClip(){saveAs(new Blob([Q("d2ServerConfigPre").innerText],{type:"application/octet-stream"}),"config.json")}function p20updateMesh(){if(null!=currentMesh){var e,t,n=GetMeshRights(currentMesh),o=EscapeHtml(currentMesh.name),a=(0==o.length&&(o="<i>Geen</i>"),0!=(1&n)&&(o='<span role=button tabindex=0 title="Klik hier om de apparaatgroepsnaam te bewerken" onclick=p20editmesh(1) onkeyup="if (event.key == \'Enter\') p20editmesh(1)">'+o+' <i class="fa-solid fa-pencil fa-2xs"></i></span>'),QH("p20meshName",o),QV("MeshSummary",4!=currentMesh.mtype),format("Onbekend #{0}",currentMesh.mtype)),i=(1==currentMesh.mtype&&(a="Alleen Intel&reg; AMT, geen agent"),2==currentMesh.mtype&&(a="Beheerd met behulp van een software-agent"),3==currentMesh.mtype&&(a=null==currentMesh.relayid?"Lokale apparaten, geen agent":"Geen apparaten doorgestuurd via agent"),4==currentMesh.mtype&&(a=null==currentMesh.relayid?"IP-KVM device":"IP-KVM-apparaat doorgestuurd via agent",1==currentMesh.kvm.model)&&(a+=", Raritan KX III"),"");if(0!=(8&args.hide)&&(i+=addHtmlValue("Naam",o)),i=(i+=addHtmlValue("Omschrijving",addLinkConditional(currentMesh.desc&&""!=currentMesh.desc?EscapeHtml(currentMesh.desc):"<i>Geen</i>","p20editmesh(2)",0!=(1&n))))+addHtmlValue("Type",a),3!=currentMesh.mtype&&4!=currentMesh.mtype||null==currentMesh.relayid||(o="<i>Onbekend</i>",i+=addHtmlValue("Doorstuur apparaat",addLinkConditional(o=null!=(a=getNodeFromId(currentMesh.relayid))?EscapeHtml(a.name):o,"p20editmeshrelay()",0!=(1&n)))),4==currentMesh.mtype&&(i=(i+=addHtmlValue("Hostnaam",currentMesh.kvm.host))+addHtmlValue("Gebruikersnaam",currentMesh.kvm.user)),null!=currentMesh.creatorid&&null!=users&&null!=users[currentMesh.creatorid]?i+=addHtmlValue("Maker",'<a href=# onclick=gotoUser("'+encodeURIComponentEx((a=users[currentMesh.creatorid])._id)+'",false,null)>'+EscapeHtml(a.name)+"</a>"):null!=currentMesh.creatorname&&(i+=addHtmlValue("Maker",EscapeHtml(currentMesh.creatorname))),null!=currentMesh.creation&&(i+=addHtmlValue("Aanmaak tijd",printDateTime(new Date(currentMesh.creation)))),3!=currentMesh.mtype&&(e=[],currentMesh.flags&&(1&currentMesh.flags&&e.push("Geautomatiseerde verwijdering"),2&currentMesh.flags&&e.push(4==currentMesh.mtype?"Poort naam synchronisatie":"Hostnaam Sync"),1==serverinfo.devGroupSessionRecording)&&4&currentMesh.flags&&e.push("Sessies opnemen"),"number"==typeof currentMesh.expireDevs&&0<currentMesh.expireDevs&&e.push("Inactief verwijderen"),i+=addHtmlValue("Functies",addLinkConditional(e=""==(e=e.join(", "))?"<i>Geen</i>":e,"p20editmeshfeatures()",1&n))),2==currentMesh.mtype&&(e=[],o=0,currentMesh.consent&&(o=currentMesh.consent),serverinfo.consent&&(o|=serverinfo.consent),64&o&&8&o?e.push("Bureaublad vraag en werkbalk"):64&o?e.push("Bureaublad werkbalk"):8&o?e.push("Bureaublad vraag"):1&o&&e.push("Bureaublad melding"),16&o?e.push("Terminal Prompt"):2&o&&e.push("Terminal melding"),32&o?e.push("Bestanden vragen"):4&o&&e.push("Bestanden Melden"),7==o&&(e=["Altijd informeren"]),i+=addHtmlValue("Toestemming van gebruiker",addLinkConditional(e=""==(e=(e=56==(56&o)?["Altijd vragen"]:e).join(", "))?"<i>Geen</i>":e,"p20editmeshconsent(1)",1&n))),3==currentMesh.mtype||4294967295!=userinfo.siteadmin&&0!=(1024&userinfo.siteadmin)||(a=0,o=[],userinfo.links&&userinfo.links[currentMesh._id]&&userinfo.links[currentMesh._id].notify&&(a|=userinfo.links[currentMesh._id].notify),userinfo.notify&&userinfo.notify[currentMesh._id]&&(a|=userinfo.notify[currentMesh._id]),2&a&&o.push("Verbinden"),4&a&&o.push("Verbreken"),8&a&&o.push("Intel&reg; AMT"),16384&features2&&userinfo.emailVerified&&(t=0,16&a&&t++,32&a&&t++,64&a&&t++,0<t)&&o.push(format("Email ({0})",t)),null!=userinfo.msghandle&&0!=(33554432&features2)&&(t=0,128&a&&t++,256&a&&t++,512&a&&t++,0<t)&&o.push(format("Berichten ({0})",t)),0==o.length&&o.push("<i>Geen</i>"),i+=addHtmlValue("Meldingen",addLink(o.join(", "),"p20editMeshNotify()"))),16777216&features&&2==currentMesh.mtype&&(a=!(e="<i>Geen</i>"),null!=currentMesh.invite&&(a=!0,e=currentMesh.invite.codes.join(", ")),i+=addHtmlValue("Uitnodigingscode",addLinkConditional(e,"p20editmeshInviteCode()",1&n||a))),currentMesh.mtype<3&&0!=(1&features2)&&(t="Geen beleid",currentMesh.amt&&(1==currentMesh.amt.type?t="Deactiveren":2==currentMesh.amt.type?(t="Eenvoudige Client Control Mode (CCM)",2==currentMesh.amt.cirasetup&&(t+=" + CIRA")):3==currentMesh.amt.type?(t="Eenvoudige Admin Control Mode (ACM)",2==currentMesh.amt.cirasetup&&(t+=" + CIRA")):4==currentMesh.amt.type&&(t="Vol automatisch")),i+=addHtmlValue("Intel&reg; AMT",addLinkConditional(t,"p20editMeshAmt()",1&n))),1&n&&(i+='<br><input type=button class="btn btn-primary btn-sm mb-1" value=Notities title="Bekijk opmerkingen over deze apparaatgroep" onclick=showNotes(false,"'+encodeURIComponentEx(currentMesh._id)+'") />'),i+="<br style=clear:both><br>",2&n&&(i+='<button class="btn btn-primary btn-sm me-2 mb-1" onclick="return p20showAddMeshUserDialog()"><i class="fa-solid fa-circle-plus"></i> Gebruikers toevoegen</button>',null!=usergroups)){var s=0,r=!1;for(v in usergroups)null==usergroups[v].membershipType&&usergroups[v]._id.split("/")[1]==currentMesh._id.split("/")[1]&&(s++,null==currentMesh.links||null==currentMesh.links[v])&&(r=!0);0<s&&r&&(i+='<button class="btn btn-primary btn-sm me-2 mb-1" onclick="return p20showAddMeshUserDialog(2)"><i class="fa-solid fa-circle-plus"></i> Gebruikersgroep toevoegen</button>')}1==currentMesh.mtype&&(1&n&&(i+='<button class="btn btn-primary btn-sm me-2 mb-1" title="Importeer Intel&reg; AMT apparaten." onclick=\'return showAmtImport("'+currentMesh._id+'")\'><i class="fa-solid fa-circle-arrow-down"></i> Importeren</button>'),null!=currentMesh.amt)&&0<currentMesh.amt.type&&(i+='<button class="btn btn-primary btn-sm me-2 mb-1" title="Voer Intel&reg; AMT-activering en configuratie uit." onclick=\'return showAmtSetup("'+currentMesh._id+'")\'><i class="fa-solid fa-gear"></i> Setup</button>'),2!=currentMesh.mtype||4294967295!=userinfo.siteadmin&&0!=(4096&userinfo.siteadmin)||(i=(i+='<button class="btn btn-primary btn-sm me-2 mb-1" onclick=\'return addAgentToMesh("'+currentMesh._id+'")\' title="Voeg een nieuwe computer toe aan deze apparaatgroep door de mesh-agent te installeren."><i class="fa-solid fa-circle-plus"></i> Toevoegen agent</button>')+'<button class="btn btn-primary btn-sm me-2 mb-1" onclick=\'return inviteAgentToMesh("'+currentMesh._id+'")\' title="Nodig iemand uit om de mesh-agent in deze apparaatgroep te installeren."><i class="fa-solid fa-user-plus"></i> Uitnodigen</button>'),3!=currentMesh.mtype||4294967295!=userinfo.siteadmin&&0!=(4096&userinfo.siteadmin)||(i+='<button class="btn btn-primary btn-sm me-2 mb-1" onclick=\'return addLocalDeviceToMesh("'+currentMesh._id+'")\' title="Voeg een apparaat toe dat zich op het lokale netwerk bevindt."><i class="fa-solid fa-circle-plus"></i> Apparaat toevoegen</button>'),currentMesh.amt&&2<currentMesh.amt.type&&(4294967295==userinfo.siteadmin||0==(4096&userinfo.siteadmin))&&(i+='<button class="btn btn-primary btn-sm me-2 mb-1" title="Schakel Intel AMT over naar Admin Control Mode (ACM)." onclick=\'return showAmtAcmSetup()\'><i class="fa-solid fa-circle-arrow-down"></i> ACM</button>'),i+='<table class="table table-hover table-striped" cellpadding=2 cellspacing=0><tbody><tr><th scope=col>Gebruikersautorisaties</th><th scope=col></th></tr>';var l=1,d=[];for(v in currentMesh.links){var c=v.split("/")[2];currentMesh.links[v].name&&(c=currentMesh.links[v].name),v==userinfo._id&&(c=userinfo.name),null!=usergroups&&null!=usergroups[v]&&(c=usergroups[v].name),d.push({id:v,name:c,rights:currentMesh.links[v].rights})}for(v in d.sort(function(e,t){return e.name>t.name?1:e.name<t.name?-1:0}),d){var u="",p=makeDeviceGroupRightsString(d[v].rights),m="fa-user",g=(d[v].id==userinfo._id||4294967295!=n&&0==(2&n)||(4294967295!=n&&4294967295==currentMesh.links[d[v].id].rights||(u="<a href=# onclick='return p20deleteUser(event,\""+encodeURIComponentEx(d[v].id)+'")\' title="Gebruikersrechten voor deze apparaatgroep verwijderen"><i role=button class="fa-solid fa-trash text-danger fa-fw fa-xs"></i></a>'),p='<span tabindex=0 style=cursor:pointer onclick=p20viewuser("'+encodeURIComponentEx(d[v].id)+"\") onkeypress=\"if (event.key=='Enter') p20viewuser('"+encodeURIComponentEx(d[v].id)+"')\">"+p+' <i class="fa-fw fa-solid fa-pencil fa-xs"></i></span>'),d[v].id.startsWith("ugrp/")&&(m="fa-users"),EscapeHtml(decodeURIComponent(d[v].name)));null!=usergroups&&d[v].id.startsWith("ugrp/")&&(g="<a tabindex=0 href=# onclick='gotoUserGroup(\""+encodeURIComponentEx(d[v].id)+"\");haltEvent(event);'>"+g+"</a>"),i+="<tr style="+(l%2==0?";background-color:#DDD":"")+'><td style=width:30%><div><i title="Gebruiker" class="fa-solid fa-fw '+m+'"></i>&nbsp;'+(g=null!=users&&d[v].id.startsWith("user/")?"<a tabindex=0 href=# onclick='gotoUser(\""+encodeURIComponentEx(d[v].id)+"\");haltEvent(event);'>"+g+"</a>":g)+"<div></div></div></td><td style=width:70%><div style=float:right>"+u+"</div><div>"+p+"</div></td></tr>",++l}if(i+="</tbody></table>",null!=deviceShares&&deviceSharesNode==currentMesh._id&&0<deviceShares.length){i+='<p></p><table class="table table-hover table-striped" cellpadding=2 cellspacing=0 width=100%><tbody><tr style=background-color:#AAAAAA;font-weight:bold><th scope=col style=text-align:left;width:430px>Actief delen van apparaten</th><th scope=col style=text-align:left><th scope=col style=text-align:left></th></tr>';for(var l=1,v=0;v<deviceShares.length;v++){var h=deviceShares[v],u="",f=(null!=h.url&&(u+='<a href="'+h.url+'" rel="noreferrer noopener" target=_blank title="Apparaat deel Link" style=cursor:pointer><img src=images/link2.png border=0 height=10 width=10></a> '),u+="<a href=# onclick='return p30removeDeviceSharing(event,\""+encodeURIComponentEx(h.nodeid)+'","'+encodeURIComponentEx(h.publicid)+'","'+encodeURIComponentEx(h.guestName)+'")\' title="Apparaat deling verwijderen" style=cursor:pointer><img src=images/trash.png border=0 height=10 width=10></a>',""),k=(h.p<=7?f=["","Terminal","Bureaublad","Desktop + Terminal","Bestanden","Terminal + Bestanden","Desktop + Bestanden","Desktop + Terminal + Bestanden"][h.p]:8==h.p?f="HTTP/"+h.port:16==h.p&&(f="HTTPS/"+h.port),f),f=(null!=h.startTime&&null!=h.expireTime&&(k=format("{0}, {1} tot {2}",f,printFlexDateTime(new Date(h.startTime)),printFlexDateTime(new Date(h.expireTime)))),null!=h.startTime&&null!=h.duration&&(k=h.duration<2?format("{0}, {1} voor {2} minuut",f,printFlexDateTime(new Date(h.startTime)),h.duration):format("{0}, {1} voor {2} minuten",f,printFlexDateTime(new Date(h.startTime)),h.duration)),1==h.recurring&&(k+=", Dagelijks terugkerend"),2==h.recurring&&(k+=", Wekelijks terugkerend"),0!=(2&h.p)&&!0===h.viewOnly&&(k+=", Desktop alleen bekijken"),null!=h.consent&&(0==h.consent?k+=", Geen toestemming":(0!=(56&h.consent)&&(k+=", vraag om toestemming"),0!=(64&h.consent)&&(k+=", Werkbalk"))),EscapeHtml(h.guestName));h.publicid.startsWith("AS:node/")&&(f="<i>Agent zelfdelend</i>"),null!=(b=getNodeFromId(h.nodeid))&&(y=0<b.conn?"":" gray",i+="<tr "+(++l%2==0?"style=background-color:#DDD":"")+"><td style=width:30%>"+("<div onclick='gotoDevice(\""+b._id+'",10);haltEvent(event);\' style=float:left class="j'+b.icon+y+'"></div>&nbsp;<a onclick=\'gotoDevice("'+b._id+"\",10);haltEvent(event);'>"+EscapeHtml(b.name)+"</a>")+"<td style=width:30%><div class=m2></div><div>&nbsp;"+f+"<div></div></div></td><td style=width:70%><div style=float:right>"+u+"</div><div>"+k+"</div></td></tr>")}i+="</tbody></table>"}else deviceSharesNode!=currentMesh._id&&deviceSharesReq!=currentMesh._id&&(deviceSharesReq=currentMesh._id,meshserver.send({action:"deviceMeshShares",meshid:currentMesh._id}));l=0,nodes.sort(deviceSort);var o="",x=(1==currentMesh.mtype&&(o+='<a onclick=meshDownloadDeviceList()><img title="Apparatenlijst downloaden" src="images/link4.png" /></a>',0==(1&features))&&(o+=' <a onclick=meshImportDeviceList()><img title="Apparaatlijst Importeren" src="images/link6.png" /></a>'),'<table class="table table-hover table-striped"><tbody><tr class="class="fw-bold"><th>Apparaten</th><th scope=col class="text-end">'+o+"</th></tr>");for(v in nodes){var b,y=0<(b=nodes[v]).conn?"":" gray";currentMesh._id==b.meshid&&(x+="<tr><td style=width:30%><div onclick='gotoDevice(\""+b._id+'",10);haltEvent(event);\' style=float:left class="j'+b.icon+y+'"></div>&nbsp;<a onclick=\'gotoDevice("'+b._id+"\",10);haltEvent(event);'>"+EscapeHtml(b.name)+"</a></div></div></td><td><div style=float:right>"+PowerStateStr(b.pwr)+"&nbsp;</div><div>"+(b.osdesc?EscapeHtml(b.osdesc):"")+"</div></td></tr>",++l)}0==l&&(x+='<tr><td colspan="2"><i>Geen</i></td></tr>'),x+="</tbody></table>",4294967295==n&&(x+="<div style=font-size:small;text-align:right><span><a href=# onclick=p20showDeleteMeshDialog() style=cursor:pointer>Verwijder groep</a></span></div>"),QH("p20info",i),QH("p20info2",x);var w="";if(0==(268435456&features)&&20<=xxcurrentView&&xxcurrentView<=29&&null!=currentMesh){for(var v in w="?viewmode="+xxcurrentView+"&gotomesh="+currentMesh._id.split("/")[2],urlargs)w+="&"+v+"="+urlargs[v];try{window.history.replaceState({},document.title,window.location.pathname+w)}catch(e){}}}}function meshDownloadDeviceList(){if(!xxdialogMode){var e,t={webappversion:"0.9.0",computers:[]};for(e in nodes){var n,o=nodes[e];currentMesh._id==o.meshid&&null!=o.intelamt&&(n={name:o.name,host:o.host,user:o.intelamt.user,pass:"",tls:1==o.intelamt.tls?1:0,ver:o.intelamt.ver,pstate:o.intelamt.state},2==o.intelamt.state&&(n.pmode=1),o.intelamt.realm&&(n.digestrealm=o.intelamt.realm),o.intelamt.hash&&(n.tlscerthash=o.intelamt.hash),t.computers.push(n))}saveAs(stringToUtf8BlobNoHeader(JSON.stringify(t,null,2)),currentMesh.name+".json")}}function meshImportDeviceList(){xxdialogMode||(setModalContent("xxAddAgent","Importeer Intel&reg; AMT apparaten",'Importeer een lijst van de lokale Intel&reg; AMT apparaten in MeshCommander JSON format.<br /><br /><input type=file id=d4importFile class="form-control" accept=".json" onchange=meshImportDeviceListValidate() />'),showModal("xxAddAgentModal","idx_dlgOkButton",()=>meshImportDeviceListEx()),QE("idx_dlgOkButton",!1))}function meshImportDeviceListValidate(){QE("idx_dlgOkButton",null!=Q("d4importFile").value)}function meshImportDeviceListEx(){var e=new FileReader;e.onload=function(e){var t=null;try{t=JSON.parse(e.target.result)}catch(e){return setModalContent("xxAddAgent","Importeer Intel&reg; AMT apparaten",format("Ongeldig JSON-bestand: {0}.",e)),void showModal("xxAddAgentModal","idx_dlgOkButton")}if("object"==typeof t&&"string"==typeof t.webappversion&&"object"==typeof t.computers&&Array.isArray(t.computers)){var n,o=0;for(n in t.computers){var a,i=t.computers[n];"string"==typeof i.name&&"string"==typeof i.host&&"string"==typeof i.user&&"string"==typeof i.pass&&(a={action:"addamtdevice",meshid:currentMesh._id,devicename:i.name,hostname:i.host,amtusername:i.user,amtpassword:i.pass,amttls:1==i.tls?1:0},"string"==typeof i.ver&&(a.ver=i.ver),"number"==typeof i.pstate&&(a.state=i.pstate),"string"==typeof i.digestrealm&&(a.realm=i.digestrealm),"string"==typeof i.tlscerthash&&(a.hash=i.tlscerthash),meshserver.send(a),o++)}0==o&&setModalContent("xxAddAgent","Gebruikersaccount importeren","Unable to import any device.")}else setModalContent("xxAddAgent","Importeer Intel&reg; AMT apparaten","Invalid JSON file format.");showModal("xxAddAgentModal","idx_dlgOkButton")},e.readAsText(Q("d4importFile").files[0])}function p20editMeshAmt(){xxdialogMode||(setModalContent("xxAddAgent","Intel&reg; AMT beleid",""+addHtmlFormFloating("Type",'<select id=dp20amtpolicy class="form-select" onchange=p20editMeshAmtChange()><option value=0>Geen beleid</option><option value=1>Deactiveren</option><option value=2>Eenvoudige Client Control Mode (CCM)</option>'+(0!=(1048576&features)?"<option value=3>Eenvoudige Admin Control Mode (ACM)</option>":"")+"<option value=4>Vol automatisch</option></select>")+"<div id=dp20amtpolicydiv></div>"),showModal("xxAddAgentModal","idx_dlgOkButton",p20editMeshAmtEx),currentMesh.amt&&(Q("dp20amtpolicy").value=currentMesh.amt.type),p20editMeshAmtChange(),!currentMesh.amt||2!=currentMesh.amt.type&&3!=currentMesh.amt.type||(Q("dp20amtpolicypass").value=currentMesh.amt.password,2!=currentMesh.amt.type&&3!=currentMesh.amt.type||(null!=currentMesh.amt.badpass&&(Q("dp20amtbadpass").value=currentMesh.amt.badpass),3==currentMesh.amt.type&&null!=currentMesh.amt.ccm&&(Q("dp20amtccmmode").value=currentMesh.amt.ccm)),0==(1024&features)&&(Q("dp20amtcira").value=currentMesh.amt.cirasetup)),dp20amtValidatePolicy())}function p20editMeshAmtChange(){var e=Q("dp20amtpolicy").value,t="";2!=e&&3!=e||(t=(t=(t=t+addHtmlFormFloating("Wachtwoord",'<select id=dp20amtpass class="form-select" onchange=dp20amtValidatePolicy() onkeyup=dp20amtValidatePolicy()><option value=0>Willekeurig wachtwoord</option>'+(null!=currentMesh.amt&&1==currentMesh.amt.password?"<option value=1 selected>Behoud huidige wachtwoord</option>":"")+"<option value=2>Selecteer nieuw wachtwoord</option></select>")+"<div id=dp20amtpassdiv style=display:none>")+addHtmlFormFloating("Nieuw wachtwoord*",'<input id=dp20amtpolicypass type=password class="form-control" maxlength=32 placeholder="New password*" onchange=dp20amtValidatePolicy() onkeyup=dp20amtValidatePolicy() autocomplete=off />'))+addHtmlFormFloating("Nieuw wachtwoord*",'<input id=dp20amtpolicypass2 type=password class="form-control" maxlength=32 placeholder="New password*" onchange=dp20amtValidatePolicy() onkeyup=dp20amtValidatePolicy() autocomplete=off />')+"</div>",3==e&&(t+=addHtmlFormFloating("CCM modus",'<select id=dp20amtccmmode class="form-select" onchange=dp20amtValidatePolicy() onkeyup=dp20amtValidatePolicy()><option value=0>Verander niets, behoud CCM indien ingesteld</option><option value=1>Deactiveer CCM indien ingesteld</option><option value=2>Activeer naar CCM, als ACM faalt</option></select>')),t=(t+="<div id=dp20amtbadpassdiv style=display:none>")+addHtmlFormFloating("Onbekend wachtwoord",'<select id=dp20amtbadpass class="form-select"><option value=0>Doe niets</option><option value=1>Indien in CCM, heractiveer Intel&reg; AMT</option></select>')+"</div>",0==(1024&features)&&(t+=addHtmlFormFloating("CIRA setup",'<select id=dp20amtcira class="form-select" title="Gebruiker geïnitieerde externe toegang"><option value=0>Doe niets</option><option value=1>Maak geen verbinding met de server</option><option value=2>Verbinden met de server</option></select>')),t+='<span id=dp10passNotify style="font-size:10px"> * 8-16 karakters, 1 hoofdletter, 1 normale letter, 1 nummeriek, 1 niet alfanumeriek.</span>',2==currentMesh.mtype&&2==e&&(t+='<span style="font-size:10px"> Dit beleid heeft geen invloed op apparaten met Intel&reg; AMT ACM-modus</span>')),0==e&&(t='<div class="row"><div class="col-2"><i class="fa-solid fa-times-circle text-danger" style="padding-right:8px; font-size:60px;"></i></div><div class="col-10">Als dit beleid is geselecteerd, wordt Intel&reg; AMT niet beheerd door deze server. Intel AMT kan nog steeds worden gebruikt door het handmatig te activeren en te configureren.</div></div>'),1==e&&(t='<div class="row"><div class="col-2"><i class="fa-solid fa-times-circle text-danger" style="font-size:60px; padding-right:8px; color:green;"></i></div><div class="col-10">Wanneer dit beleid is geselecteerd, wordt elke Intel&reg; AMT in Client Control Mode (CCM) gedeactiveerd. Bij andere apparaten is CIRA gewist en kunnen ze nog steeds handmatig worden beheerd.</div></div>'),4==e&&(t='<div class="row"><div class="col-2"><i class="fa-solid fa-check-circle text-success" style="font-size:60px; padding-right:8px; color:blue;"></i></div><div class="col-10">Dit is het aanbevolen beleid. Activering en beheer van Intel&reg; AMT is volledig geautomatiseerd en de server zal proberen om optimaal gebruik te maken van hardwarebeheer.</div></div>'),QH("dp20amtpolicydiv",t),setTimeout(dp20amtValidatePolicy,500)}function dp20amtValidatePolicy(){var e,t=!0,n=Q("dp20amtpolicy").value;2!=n&&3!=n||2!=Q("dp20amtpass").value||(t=(e=Q("dp20amtpolicypass").value)===Q("dp20amtpolicypass2").value&&passwordcheck(e)),QE("idx_dlgOkButton",t),2!=n&&3!=n||QV("dp20amtpassdiv",2==Q("dp20amtpass").value),QV("dp10passNotify",(2==n||3==n)&&2==Q("dp20amtpass").value),QV("dp20amtbadpassdiv",2==n||3==n&&1!=Q("dp20amtccmmode").value)}function p20editMeshAmtEx(){var e=parseInt(Q("dp20amtpolicy").value),t={type:e},n=null;2!=e&&3!=e||(0==Q("dp20amtpass").value&&(n=""),1==Q("dp20amtpass").value&&(n=null),2==Q("dp20amtpass").value&&(n=Q("dp20amtpolicypass").value)),2==e?(t={type:e,password:n,badpass:parseInt(Q("dp20amtbadpass").value)}).cirasetup=0==(1024&features)?parseInt(Q("dp20amtcira").value):1:3==e?(t={type:e,password:n,badpass:parseInt(Q("dp20amtbadpass").value),ccm:parseInt(Q("dp20amtccmmode").value)}).cirasetup=0==(1024&features)?parseInt(Q("dp20amtcira").value):1:4==e&&(t={type:e}),meshserver.send({action:"meshamtpolicy",meshid:currentMesh._id,amtpolicy:t})}function p20showDeleteMeshDialog(){var e;return xxdialogMode||(e=format("Weet je zeker dat je groep {0} wilt verwijderen? Als u de apparaatgroep verwijdert, wordt ook alle informatie over apparaten binnen deze groep verwijderd.",EscapeHtml(currentMesh.name))+"<br /><br />",setModalContent("xxAddAgent","Verwijder groep",e+='<label class=form-check-label><input id=p20check type=checkbox class="form-check-input m-2" onchange=p20validateDeleteMeshDialog() />Bevestig</label>'),showModal("xxAddAgentModal","idx_dlgOkButton",function(){p20showDeleteMeshDialogEx(3,"")}),p20validateDeleteMeshDialog()),!1}function p20validateDeleteMeshDialog(){QE("idx_dlgOkButton",Q("p20check").checked)}function p20showDeleteMeshDialogEx(e,t){meshserver.send({action:"deletemesh",meshid:currentMesh._id,meshname:currentMesh.name})}function p20editmeshrelay(){if(!xxdialogMode){var e=[];if(0==(2&features))for(var t in nodes){var n=nodes[t];2==n.mtype&&null!=n.agent&&4294967295==GetNodeRights(n)&&e.push(n)}if(e.sort(nameSort),0==e.length)setModalContent("xxAddAgent","Bewerk apparaatgroep",a="Geen relay apparaten beschikbaar."),showModal("xxAddAgentModal","idx_dlgOkButton");else{var o=[];for(t in e)o.push('<option value="'+e[t]._id+'"'+(currentMesh.relayid==e[t]._id?" selected":"")+">"+EscapeHtml(e[t].name)+"</option>");var a=addHtmlFormFloating("Doorstuur apparaat",'<select id=d2devrelay class="form-select">'+o.join("")+"</select>");setModalContent("xxAddAgent","Bewerk apparaatgroep",a),showModal("xxAddAgentModal","idx_dlgOkButton",p20editmeshrelayEx)}}}function p20editmeshrelayEx(){meshserver.send({action:"editmesh",meshid:currentMesh._id,relayid:Q("d2devrelay").value})}function p20editmesh(e){xxdialogMode||(setModalContent("xxAddAgent","Bewerk apparaatgroep",'<div class="form-floating mb-2"><input type=text class="form-control" id=dp20meshname maxlength=128 placeholder="Naam" onchange=p20editmeshValidate() onkeyup=p20editmeshValidate(event) /><label for=dp20meshname>Naam</label></div><div class="form-floating mb-2"><textarea id=dp20meshdesc class="form-control" maxlength=1024 placeholder="Omschrijving"></textarea><label for=dp20meshdesc>Omschrijving</label></div>'),showModal("xxAddAgentModal","idx_dlgOkButton",p20editmeshEx),Q("dp20meshname").value=currentMesh.name,currentMesh.desc&&(Q("dp20meshdesc").value=currentMesh.desc),p20editmeshValidate(),(2==e?Q("dp20meshdesc"):Q("dp20meshname")).focus())}function p20editmeshEx(){meshserver.send({action:"editmesh",meshid:currentMesh._id,meshname:Q("dp20meshname").value,desc:Q("dp20meshdesc").value})}function p20editmeshValidate(e){QE("idx_dlgOkButton",0<Q("dp20meshname").value.length),e&&"Enter"==e.key&&Q("dp20meshdesc").focus()}function p20editmeshconsent(e){var t,n,o;xxdialogMode||(n=0,o=t="",1==e&&(n=currentMesh.consent||0,o="Toestemming gebruikersgroep bewerken"),2==e&&(n=currentUser.consent||0,o="Gebruikerstoestemming bewerken"),3==e&&(n=currentNode.consent||0,o="Gebruikerstoestemming apparaat bewerken"),4==e&&(n=currentUserGroup.consent||0,o="Bewerk groepsgebruikerstoestemming"),setModalContent("xxAddAgent",o,t=(t=(t=(t=(t=t+'<div style="width:100%;border-bottom:1px solid gray;margin-bottom:5px"><b>Bureaublad</b></div>'+('<div><label for=d20flag1><input type=checkbox id=d20flag1 class="form-check-input me-2" '+(1&n?"checked":"")+">Gebruiker informeren</label></div>"))+('<div><label for=d20flag2><input type=checkbox id=d20flag2 class="form-check-input me-2" '+(8&n?"checked":"")+">Vraag gebruikerstoestemming</label></div>")+('<div><label for=d20flag7><input type=checkbox id=d20flag7 class="form-check-input me-2" '+(64&n?"checked":"")+">Toon verbindingswerkbalk</label></div>"))+'<div style="width:100%;border-bottom:1px solid gray;margin-bottom:5px;margin-top:8px"><b>Terminal</b></div>'+('<div><label for=d20flag3><input type=checkbox id=d20flag3 class="form-check-input me-2" '+(2&n?"checked":"")+">Gebruiker informeren</label></div>"))+('<div><label for=d20flag4><input type=checkbox id=d20flag4 class="form-check-input me-2" '+(16&n?"checked":"")+">Vraag gebruikerstoestemming</label></div>")+'<div style="width:100%;border-bottom:1px solid gray;margin-bottom:5px;margin-top:8px"><b>Bestanden</b></div>')+('<div><label for=d20flag5><input type=checkbox id=d20flag5 class="form-check-input me-2" '+(4&n?"checked":"")+">Gebruiker informeren</label></div>")+('<div><label for=d20flag6><input type=checkbox id=d20flag6 class="form-check-input me-2" '+(32&n?"checked":"")+">Vraag gebruikerstoestemming</label></div>")),xxdialogButtons=3,xxdialogTag=e,showModal("xxAddAgentModal","idx_dlgOkButton",function(){p20editmeshconsentEx(xxdialogButtons,xxdialogTag)}),serverinfo.consent&&(1&serverinfo.consent&&(Q("d20flag1").checked=!0),8&serverinfo.consent&&(Q("d20flag2").checked=!0),2&serverinfo.consent&&(Q("d20flag3").checked=!0),16&serverinfo.consent&&(Q("d20flag4").checked=!0),4&serverinfo.consent&&(Q("d20flag5").checked=!0),32&serverinfo.consent&&(Q("d20flag6").checked=!0),64&serverinfo.consent&&(Q("d20flag7").checked=!0),QE("d20flag1",!(1&serverinfo.consent)),QE("d20flag2",!(8&serverinfo.consent)),QE("d20flag3",!(2&serverinfo.consent)),QE("d20flag4",!(16&serverinfo.consent)),QE("d20flag5",!(4&serverinfo.consent)),QE("d20flag6",!(32&serverinfo.consent)),QE("d20flag7",!(64&serverinfo.consent))))}function p20editmeshconsentEx(e,t){var n=0;Q("d20flag1").checked&&(n+=1),Q("d20flag2").checked&&(n+=8),Q("d20flag3").checked&&(n+=2),Q("d20flag4").checked&&(n+=16),Q("d20flag5").checked&&(n+=4),Q("d20flag6").checked&&(n+=32),Q("d20flag7").checked&&(n+=64),1==t&&meshserver.send({action:"editmesh",meshid:currentMesh._id,consent:n}),2==t&&meshserver.send({action:"edituser",id:currentUser._id,consent:n}),3==t&&meshserver.send({action:"changedevice",nodeid:currentNode._id,consent:n}),4==t&&meshserver.send({action:"editusergroup",ugrpid:currentUserGroup._id,consent:n})}function p20editmeshfeatures(){var e,t,n;xxdialogMode||(e=currentMesh.flags||0,t="",n=0,"number"==typeof currentMesh.expireDevs&&0<currentMesh.expireDevs&&2e3<(n=currentMesh.expireDevs)&&(n=2e3),1==serverinfo.devGroupSessionRecording&&4!=currentMesh.mtype&&(t+='<div class="form-check"><label><input type=checkbox id=d20flag4 class="form-check-input me-2" onchange=p20editmeshfeaturesValidate() '+(4&e?"checked":"")+">Sessies opnemen</label><br></div>"),t=(t=2!=currentMesh.mtype&&4!=currentMesh.mtype?t:t+('<div class="form-check"><label><input type=checkbox id=d20flag2 class="form-check-input me-2" onchange=p20editmeshfeaturesValidate() '+(2&e?"checked":"")+">"+(4==currentMesh.mtype?"Synchroniseer de naam van de server met de poortnaam":"Synchroniseer serverapparaatnaam met hostnaam"))+'</label><br></div><div class="form-check"><label><input type=checkbox id=d20flag1 class="form-check-input me-2" onchange=p20editmeshfeaturesValidate() '+(1&e?"checked":"")+">Verwijder apparaat bij verbreken</label><br></div>")+'<div class="form-check"><label><input type=checkbox id=d20expireDevice class="form-check-input me-2" onchange=p20editmeshfeaturesValidate() '+(0<n?"checked":"")+'>Inactieve apparaten automatisch verwijderen</label><br></div><div style=margin-left:20px id=d20expireDeviceDev>inactieve dagen tot verwijdering <label><input type=number inputmode=numeric class="form-control" onchange=p20editmeshfeaturesValidate() onkeyup=p20editmeshfeaturesValidate() onpaste=p20editmeshfeaturesValidate() onkeydown=p20editmeshfeaturesValidate() maxlength=4 min=1 max=2000 style=width:80px value="'+(0==n?30:n)+'" id=d20expireDeviceDays></label><br></div>',serverinfo.autoremoveinactivedevices&&(1==serverinfo.autoremoveinactivedevices?t+=format("<span style=font-size:x-small;margin-left:6px>Inactieve apparaten worden standaard na 1 dag verwijderd.</span>",serverinfo.autoremoveinactivedevices):t+=format("<span style=font-size:x-small;margin-left:6px>Inactieve apparaten worden standaard na {0} dagen verwijderd.</span>",serverinfo.autoremoveinactivedevices)),setModalContent("xxAddAgent","Functies van apparaatgroep bewerken",t),showModal("xxAddAgentModal","idx_dlgOkButton",p20editmeshfeaturesEx),p20editmeshfeaturesValidate())}function p20editmeshfeaturesValidate(){var e=0,t=!0,e=(2!=currentMesh.mtype&&4!=currentMesh.mtype||!Q("d20flag1").checked||(e+=1),QE("d20expireDevice",0==(1&e)),0==(1&e)&&Q("d20expireDevice").checked);QV("d20expireDeviceDev",e),e&&(e=parseInt(Q("d20expireDeviceDays").value),isNaN(e)||e<1||2e3<e||e!=Q("d20expireDeviceDays").value)&&(t=!1),QE("idx_dlgOkButton",t)}function p20editmeshfeaturesEx(){var e=0,t=(2!=currentMesh.mtype&&4!=currentMesh.mtype||(Q("d20flag1").checked&&(e+=1),Q("d20flag2").checked&&(e+=2)),1==serverinfo.devGroupSessionRecording&&4!=currentMesh.mtype&&Q("d20flag4").checked&&(e+=4),0);0==(1&e)&&Q("d20expireDevice").checked&&(t=parseInt(Q("d20expireDeviceDays").value)),meshserver.send({action:"editmesh",meshid:currentMesh._id,flags:e,expireDevs:t})}function p20showAddMeshUserDialog(e,t){if(!xxdialogMode){var n="";if(null==e||5==e)null==t&&(n+=null==e?"Gebruikers toestaan deze apparaatgroep en apparaten in deze groep te beheren.":"Sta gebruikers toe om dit apparaat te beheren.",524288&features&&(n+=" Gebruikers moeten inloggen bij de server voordat ze kunnen worden toegevoegd aan een apparaatgroep."),n+="<br /><br />"),n=(n+="<div style='position:relative'>")+addHtmlFormFloating("Gebruikers-ID's",'<input id=dp20username maxlength=256 onchange=p20validateAddMeshUserDialog() onkeyup=p20validateAddMeshUserDialog() placeholder="user1, user2, user3" class="form-control" />')+"<div id=dp20usersuggest class=suggestionBox style='top:30px;left:130px;display:none'></div></div><br>";else if(1==e){var o="";if(null==t)for(l in i=getOrderedList(meshes,"name"))null!=currentUser.links&&null!=currentUser.links[i[l]._id]||(o+="<option value="+encodeURIComponentEx(i[l]._id)+">"+EscapeHtml(i[l].name)+"</option>");else o+="<option value="+t+">"+EscapeHtml(meshes[decodeURIComponent(t)].name)+"</option>";n+=addHtmlFormFloating("Apparaat groep","<select onchange=p20validateAddMeshUserDialog() id=dp2groupid class=form-select"+(t?" disabled":"")+">"+o+"</select>")}else if(2==e){if(null==usergroups)return;o="";for(l in a=getOrderedList(usergroups,"name"))currentMesh._id.split("/")[1]!=a[l]._id.split("/")[1]||null!=currentMesh.links&&null!=currentMesh.links[a[l]._id]||(o+="<option value="+encodeURIComponentEx(a[l]._id)+">"+EscapeHtml(a[l].name)+"</option>");n+=addHtmlFormFloating("Gebruikers Groep",'<select onchange=p20validateAddMeshUserDialog() id=dp2groupid class="form-select">'+o+"</select>")}else if(6==e){if(null==usergroups)return;var a,o="";if(null==t)for(l in a=getOrderedList(usergroups,"name"))null!=a[l].membershipType||currentNode._id.split("/")[1]!=a[l]._id.split("/")[1]||null!=currentNode.links&&null!=currentNode.links[a[l]._id]||(o+="<option value="+encodeURIComponentEx(a[l]._id)+">"+EscapeHtml(a[l].name)+"</option>");else o+="<option value="+t+">"+EscapeHtml(usergroups[decodeURIComponent(t)].name)+"</option>";n+=addHtmlFormFloating("Gebruikers Groep","<select onchange=p20validateAddMeshUserDialog() id=dp2groupid "+(t?" disabled":"")+' class="form-select">'+o+"</select>")}else if(3==e){o="";for(l in t=t&&decodeURIComponent(t),i=getOrderedList(meshes,"name"))null==t&&null!=currentUserGroup.links&&null!=currentUserGroup.links[i[l]._id]||(o+="<option value="+encodeURIComponentEx(i[l]._id)+(t==i[l]._id?" selected":" ")+">"+EscapeHtml(i[l].name)+"</option>");n+=addHtmlFormFloating("Apparaat groep","<select onchange=p20validateAddMeshUserDialog("+e+') id=dp2groupid class="form-select">'+o+"</select>")}else if(4==e||7==e){var i,o="",s=null,r=null;for(l in null!=t&&null!=(r=getNodeFromId(decodeURIComponent(t)))&&(s=r.meshid),i=getOrderedList(meshes,"name"))null!=i[l].links[userinfo._id]&&7&i[l].links[userinfo._id].rights&&(null==s&&(s=i[l]._id),o+="<option value="+encodeURIComponentEx(i[l]._id)+(s==i[l]._id?" selected":" ")+">"+EscapeHtml(i[l].name)+"</option>");n+=addHtmlFormFloating("Apparaat groep","<select onchange=p20changeMeshAddMeshUserDialog("+e+') id=dp2meshid class="form-select">'+o+"</select>"),o="";var l,d=getOrderedList(nodes,"name");for(l in d)d[l].meshid==s&&(o+="<option value="+encodeURIComponentEx(d[l]._id)+(r==d[l]?" selected":" ")+">"+EscapeHtml(d[l].name)+"</option>");n+=addHtmlFormFloating("Apparaat","<select onchange=p20validateAddMeshUserDialog("+e+') id=dp2nodeid class="form-select">'+o+"</select>")}else{var c=(e=decodeURIComponent(e)).split("/")[2];users&&users[e]&&(c=users[e].name),usergroups&&usergroups[e]&&(c=usergroups[e].name),userinfo._id==e&&(c=userinfo.name),e.startsWith("ugrp/")?n+=format("Groepsrechten voor {0}.",c)+"<br /><br />":n+=format("Groepsrechten voor gebruiker {0}.",c)+"<br /><br />"}var c=-1,u=4!=e&&5!=e&&6!=e&&7!=e;n+='<div style="height:120px;overflow-y:scroll;border:1px solid var(--sub-menu-color);resize:vertical;padding:8px;border-radius:0.375rem;">',u&&(n+='<label><input type=checkbox class="form-check-input me-2" onchange=p20validateAddMeshUserDialog() id=p20fulladmin>Volledige beheerder</label><br><label><input type=checkbox class="form-check-input me-2" onchange=p20validateAddMeshUserDialog() id=p20editmesh>Bewerk apparaatgroep</label><br><label><input type=checkbox class="form-check-input me-2" onchange=p20validateAddMeshUserDialog() id=p20manageusers>Beheer apparaatgroep gebruikers</label><br><label><input type=checkbox class="form-check-input me-2" onchange=p20validateAddMeshUserDialog() id=p20managecomputers>Beheer apparaatgroep computers</label><br>'),n=(n+='<label><input type=checkbox class="form-check-input me-2" onchange=p20validateAddMeshUserDialog() id=p20remotecontrol>Extern beheer & Relay</label><br>')+'<label><input type=checkbox class="form-check-input me-2" onchange=p20validateAddMeshUserDialog() id=p20remoteview style=margin-left:12px>Alleen extern meekijken</label><br>'+'<label><input type=checkbox class="form-check-input me-2" onchange=p20validateAddMeshUserDialog() id=p20remotelimitedinput style=margin-left:12px>Alleen beperkte invoer</label><br>',!1!==serverinfo.guestdevicesharing&&(n+='<label><input type=checkbox class="form-check-input me-2" onchange=p20validateAddMeshUserDialog() id=p20guestshare style=margin-left:12px>Gastdeling</label><br>'),n=(n=(n=(n=(n=(n=(n=(n=n+'<label><input type=checkbox class="form-check-input me-2" onchange=p20validateAddMeshUserDialog() id=p20nodesktop style=margin-left:12px>Geen bureaublad toegang</label><br>'+'<label><input type=checkbox class="form-check-input me-2" onchange=p20validateAddMeshUserDialog() id=p20noterminal style=margin-left:12px>Geen terminal toegang</label><br>')+'<label><input type=checkbox class="form-check-input me-2" onchange=p20validateAddMeshUserDialog() id=p20nofiles style=margin-left:12px>Geen bestandstoegang</label><br>'+'<label><input type=checkbox class="form-check-input me-2" onchange=p20validateAddMeshUserDialog() id=p20noamt style=margin-left:12px>Geen Intel&reg; AMT</label><br>')+'<label><input type=checkbox class="form-check-input me-2" onchange=p20validateAddMeshUserDialog() id=p20meshagentconsole>Mesh Agent Console</label><br>'+'<label><input type=checkbox class="form-check-input me-2" onchange=p20validateAddMeshUserDialog() id=p20meshserverfiles>Serverbestanden</label><br>')+'<label><input type=checkbox class="form-check-input me-2" onchange=p20validateAddMeshUserDialog() id=p20wakedevices>Apparaat wekken</label><br>'+'<label><input type=checkbox class="form-check-input me-2" onchange=p20validateAddMeshUserDialog() id=p20editnotes>Apparaatnotities bewerken</label><br>')+'<label><input type=checkbox class="form-check-input me-2" onchange=p20validateAddMeshUserDialog() id=p20limitevents>Toon alleen eigen gebeurtenissen</label><br>'+'<label><input type=checkbox class="form-check-input me-2" onchange=p20validateAddMeshUserDialog() id=p20chatnotify>Chat & Melden</label><br>')+'<label><input type=checkbox class="form-check-input me-2" onchange=p20validateAddMeshUserDialog() id=p20uninstall>Verwijder Agent / Verwijder apparaat</label><br>'+'<label><input type=checkbox class="form-check-input me-2" onchange=p20validateAddMeshUserDialog() id=p20commands>Externe opdrachten</label><br>')+'<label><input type=checkbox class="form-check-input me-2" onchange=p20validateAddMeshUserDialog() id=p20resetoff>Reset / uitschakelen</label><br>'+'<label><input type=checkbox class="form-check-input me-2" onchange=p20validateAddMeshUserDialog() id=p20details>Apparaatgegevens</label><br>')+'<label><input type=checkbox class="form-check-input me-2" onchange=p20validateAddMeshUserDialog() id=p20relay>Gebruik als relay</label><br>'+"</div>",null==e?(xxdialogButtons=3,xxdialogTag="",setModalContent("xxAddAgent","Gebruikers toevoegen aan apparaatgroep",n),showModal("xxAddAgentModal","idx_dlgOkButton",function(){p20showAddMeshUserDialogEx(xxdialogButtons,xxdialogTag)}),QE("p20fulladmin",4294967295==GetMeshRights(currentMesh)),Q("dp20username").focus()):1===e?(xxdialogButtons=t?7:3,xxdialogTag=e,setModalContent("xxAddAgent",null==t?"Machtigingen voor apparaatgroep toevoegen":"Bewerk apparaatgroep rechten",n),showModal("xxAddAgentModal","idx_dlgOkButton",function(){p20showAddMeshUserDialogEx(xxdialogButtons,xxdialogTag)}),4294967295==(c=null!=t?meshes[decodeURIComponent(t)].links[currentUser._id].rights:c)&&(Q("p20fulladmin").checked=!0,c=-1)):2===e?(xxdialogButtons=3,xxdialogTag=e,setModalContent("xxAddAgent","Gebruikersgroep toevoegen",n),showModal("xxAddAgentModal","idx_dlgOkButton",function(){p20showAddMeshUserDialogEx(xxdialogButtons,xxdialogTag)}),QE("p20fulladmin",4294967295==GetMeshRights(currentMesh))):3===e?(xxdialogButtons=t?7:3,xxdialogTag=e,setModalContent("xxAddAgent",null==t?"Apparaatgroep toevoegen":"Bewerk apparaatgroep",n),showModal("xxAddAgentModal","idx_dlgOkButton",function(){p20showAddMeshUserDialogEx(xxdialogButtons,xxdialogTag)}),QE("dp2groupid",null==t),4294967295==(c=null!=t?currentUserGroup.links[decodeURIComponent(t)].rights:c)&&(Q("p20fulladmin").checked=!0,c=-1)):4===e?(xxdialogButtons=t?7:3,xxdialogTag=e,setModalContent("xxAddAgent",null==t?"Apparaatrechten toevoegen":"Bewerk apparaatrechten",n),showModal("xxAddAgentModal","idx_dlgOkButton",function(){p20showAddMeshUserDialogEx(xxdialogButtons,xxdialogTag)}),QE("dp2meshid",null==t),QE("dp2nodeid",null==t)):7===e?(xxdialogButtons=t?7:3,xxdialogTag=e,setModalContent("xxAddAgent",null==t?"Apparaatrechten toevoegen":"Bewerk apparaatrechten",n),showModal("xxAddAgentModal","idx_dlgOkButton",function(){p20showAddMeshUserDialogEx(xxdialogButtons,xxdialogTag)}),QE("dp2meshid",null==t),QE("dp2nodeid",null==t),null!=t&&(c=currentUserGroup.links[decodeURIComponent(t)].rights,QE("dp20username",!1))):5===e?(xxdialogButtons=t?7:3,xxdialogTag=e,setModalContent("xxAddAgent",t?"Bewerk gebruikersapparaatrechten":"Gebruikersmachtigingen voor apparaat toevoegen",n),showModal("xxAddAgentModal","idx_dlgOkButton",function(){p20showAddMeshUserDialogEx(xxdialogButtons,xxdialogTag)}),null!=t&&(t=decodeURIComponent(t),null!=users&&null!=users[t]?Q("dp20username").value=users[t].name:Q("dp20username").value=t.split("/")[2],c=currentNode.links[t].rights,QE("dp20username",!1)),Q("dp20username").focus()):6===e?(xxdialogButtons=t?7:3,xxdialogTag=e,setModalContent("xxAddAgent",t?"Gebruikersmachtigingen voor apparaatgroep bewerken":"Gebruikersmachtigingen voor apparaatgroep toevoegen",n),showModal("xxAddAgentModal","idx_dlgOkButton",function(){p20showAddMeshUserDialogEx(xxdialogButtons,xxdialogTag)}),null!=t&&(c=currentNode.links[decodeURIComponent(t)].rights)):(e.startsWith("ugrp/")?(xxdialogButtons=7,xxdialogTag=e,setModalContent("xxAddAgent","Bewerk apparaatgroep rechten",n)):(xxdialogButtons=7,xxdialogTag=e,setModalContent("xxAddAgent","Gebruikersrechten apparaatgroep bewerken",n)),showModal("xxAddAgentModal","idx_dlgOkButton",function(){p20showAddMeshUserDialogEx(xxdialogButtons,xxdialogTag)}),GetMeshRights(currentMesh),4294967295==(c=GetMeshRights(currentMesh,e))&&(Q("p20fulladmin").checked=!0,c=-1),QE("p20fulladmin",4294967295==GetMeshRights(currentMesh))),-1!=c&&(u&&(1&c&&(Q("p20editmesh").checked=!0),2&c&&(Q("p20manageusers").checked=!0),4&c)&&(Q("p20managecomputers").checked=!0),8&c&&(Q("p20remotecontrol").checked=!0,65536&c&&(Q("p20nodesktop").checked=!0),256&c&&(Q("p20remoteview").checked=!0),524288&c&&!1!==serverinfo.guestdevicesharing&&(Q("p20guestshare").checked=!0),512&c&&(Q("p20noterminal").checked=!0),1024&c&&(Q("p20nofiles").checked=!0),2048&c&&(Q("p20noamt").checked=!0),4096&c)&&(Q("p20remotelimitedinput").checked=!0),16&c&&(Q("p20meshagentconsole").checked=!0),32&c&&(Q("p20meshserverfiles").checked=!0),64&c&&(Q("p20wakedevices").checked=!0),128&c&&(Q("p20editnotes").checked=!0),8192&c&&(Q("p20limitevents").checked=!0),16384&c&&(Q("p20chatnotify").checked=!0),32768&c&&(Q("p20uninstall").checked=!0),131072&c&&(Q("p20commands").checked=!0),262144&c&&(Q("p20resetoff").checked=!0),524288&c&&!1!==serverinfo.guestdevicesharing&&(Q("p20guestshare").checked=!0),1048576&c&&(Q("p20details").checked=!0),2097152&c)&&(Q("p20relay").checked=!0),p20validateAddMeshUserDialog(e)}return!1}function p20changeMeshAddMeshUserDialog(e){var t,n="",o=decodeURIComponent(Q("dp2meshid").value);for(t in nodes)nodes[t].meshid==o&&(n+="<option value="+encodeURIComponentEx(nodes[t]._id)+">"+EscapeHtml(nodes[t].name)+"</option>");QH("dp2nodeid",n),p20validateAddMeshUserDialog(e)}function p20setname(e){e=decodeURIComponent(e);var t,n=Q("dp20username").value.split(",");for(t in n)n[t]=n[t].trim();return n[n.length-1]=e,Q("dp20username").value=n.join(", "),p20validateAddMeshUserDialog(),!1}function p20validateAddMeshUserDialog(e){var t,n,o=!0;if(4===e&&(e=0,""!=(t=decodeURIComponent(Q("dp2nodeid").value))&&null!=currentUser.links&&null!=currentUser.links[t]&&(e=currentUser.links[t].rights),Q("p20remotecontrol").checked=0!=(8&e),Q("p20meshagentconsole").checked=0!=(16&e),Q("p20meshserverfiles").checked=0!=(32&e),Q("p20wakedevices").checked=0!=(64&e),Q("p20editnotes").checked=0!=(128&e),Q("p20remoteview").checked=0!=(256&e),Q("p20noterminal").checked=0!=(512&e),Q("p20nofiles").checked=0!=(1024&e),Q("p20noamt").checked=0!=(2048&e),Q("p20remotelimitedinput").checked=0!=(4096&e),Q("p20limitevents").checked=0!=(8192&e),Q("p20chatnotify").checked=0!=(16384&e),Q("p20uninstall").checked=0!=(32768&e),Q("p20nodesktop").checked=0!=(65536&e),Q("p20commands").checked=0!=(131072&e),Q("p20resetoff").checked=0!=(262144&e),!1!==serverinfo.guestdevicesharing&&(Q("p20guestshare").checked=0!=(524288&e)),Q("p20details").checked=0!=(1048576&e),Q("p20relay").checked=0!=(2097152&e),o=""!=t),Q("dp20username")){var a=Q("dp20username").value.split(",");for(c in a){var i=a[c]=a[c].trim();(0==i.length||0<=i.indexOf('"'))&&(o=!1)}var e=!1,s=!1;if(null!=users){var r=a[a.length-1].trim(),l=r.toLowerCase(),d=[];if(0<r.length){for(var c in users){var u=users[c]._id.split("/");if((null==currentMesh||currentMesh.domain==u[1])&&(null==currentNode||currentNode.domain==u[1])){if(u[2]===l){s=!0;break}if(0<=users[c].name.toLowerCase().indexOf(l)&&(d.push([users[c]._id,users[c].name]),8<=d.length))break}}if(0==s&&0<d.length){var p="";for(c in d){var m=d[c][0],g=d[c][1];m.split("/")[2]==g.toLowerCase()?p+="<div class=suggestionBoxItem onclick='p20setname(\""+encodeURIComponentEx(m.split("/")[2])+"\")'>"+EscapeHtml(g)+"</div>":p+="<div class=suggestionBoxItem onclick='p20setname(\""+encodeURIComponentEx(m.split("/")[2])+"\")'><div>"+EscapeHtml(g)+"</div><div class=suggestionBoxSubItem>"+EscapeHtml(m.split("/")[2])+"</div></div>"}QH("dp20usersuggest",p),e=!0}}}QV("dp20usersuggest",e)}QE("idx_dlgOkButton",o),null!=Q("p20fulladmin")?(n=!Q("p20fulladmin").checked,QE("p20editmesh",n),QE("p20manageusers",n),QE("p20managecomputers",n)):n=""!=t,QE("p20remotecontrol",n),QE("p20meshagentconsole",n),QE("p20meshserverfiles",n),QE("p20wakedevices",n),QE("p20editnotes",n),QE("p20limitevents",n),QE("p20remoteview",n&&Q("p20remotecontrol").checked),!1!==serverinfo.guestdevicesharing&&QE("p20guestshare",n&&Q("p20remotecontrol").checked&&(Q("p20remoteview").checked||!Q("p20remotelimitedinput").checked)),QE("p20remotelimitedinput",n&&Q("p20remotecontrol").checked&&!Q("p20remoteview").checked),QE("p20nodesktop",n&&Q("p20remotecontrol").checked),QE("p20noterminal",n&&Q("p20remotecontrol").checked),QE("p20nofiles",n&&Q("p20remotecontrol").checked),QE("p20noamt",n&&Q("p20remotecontrol").checked),QE("p20chatnotify",n),QE("p20uninstall",n),QE("p20commands",n),QE("p20resetoff",n),QE("p20details",n),QE("p20relay",n)}function p20showAddMeshUserDialogEx(e,t){var n,o,a=0;if(null!=Q("p20fulladmin")&&1==Q("p20fulladmin").checked?a=4294967295:(null!=Q("p20fulladmin")&&(1==Q("p20editmesh").checked&&(a+=1),1==Q("p20manageusers").checked&&(a+=2),1==Q("p20managecomputers").checked)&&(a+=4),1==Q("p20remotecontrol").checked&&(a+=8),1==Q("p20meshagentconsole").checked&&(a+=16),1==Q("p20meshserverfiles").checked&&(a+=32),1==Q("p20wakedevices").checked&&(a+=64),1==Q("p20editnotes").checked&&(a+=128),1==Q("p20remoteview").checked&&(a+=256),1==Q("p20nodesktop").checked&&(a+=65536),1==Q("p20noterminal").checked&&(a+=512),1==Q("p20nofiles").checked&&(a+=1024),1==Q("p20noamt").checked&&(a+=2048),1!=Q("p20remotelimitedinput").checked||Q("p20remoteview").checked||(a+=4096),1==Q("p20limitevents").checked&&(a+=8192),1==Q("p20chatnotify").checked&&(a+=16384),1==Q("p20uninstall").checked&&(a+=32768),1==Q("p20commands").checked&&(a+=131072),1==Q("p20resetoff").checked&&(a+=262144),!1===serverinfo.guestdevicesharing||1!=Q("p20guestshare").checked||!Q("p20remoteview").checked&&(Q("p20remoteview").checked||Q("p20remotelimitedinput").checked)||(a+=524288),1==Q("p20details").checked&&(a+=1048576),1==Q("p20relay").checked&&(a+=2097152)),0==(8&a)&&(256&a&&(a-=256),512&a&&(a-=512),1024&a&&(a-=1024),2048&a&&(a-=2048),4096&a&&(a-=4096),65536&a)&&(a-=65536),1===t){var i=decodeURIComponent(Q("dp2groupid").value);null!=(r=meshes[i])&&meshserver.send({action:"addmeshuser",meshid:i,meshname:r.name,userids:[currentUser._id],meshadmin:a,remove:2==e})}else if(2===t){var s=decodeURIComponent(Q("dp2groupid").value);null!=(r=meshes[currentMesh._id])&&meshserver.send({action:"addmeshuser",meshid:currentMesh._id,meshname:currentMesh.name,userid:s,meshadmin:a,remove:2==e})}else if(3===t){var r,i=decodeURIComponent(Q("dp2groupid").value);null!=(r=meshes[i])&&meshserver.send({action:"addmeshuser",meshid:i,meshname:r.name,userids:[currentUserGroup._id],meshadmin:a,remove:2==e})}else if(4===t)null!=(o=getNodeFromId(n=decodeURIComponent(Q("dp2nodeid").value)))&&meshserver.send({action:"adddeviceuser",nodeid:n,nodename:o.name,userids:[currentUser._id],rights:a,remove:2==e});else if(5===t){var l=[];for(c in d=Q("dp20username").value.split(","))l.push(d[c].trim());meshserver.send({action:"adddeviceuser",nodeid:currentNode._id,nodename:currentNode.name,usernames:l,rights:a,remove:2==e})}else if(6===t){s=decodeURIComponent(Q("dp2groupid").value);null!=currentNode&&meshserver.send({action:"adddeviceuser",nodeid:currentNode._id,nodename:currentNode.name,userids:[s],rights:a,remove:2==e})}else if(7===t)null!=(o=getNodeFromId(n=decodeURIComponent(Q("dp2nodeid").value)))&&meshserver.send({action:"adddeviceuser",nodeid:n,nodename:o.name,userids:[currentUserGroup._id],rights:a,remove:2==e});else if(null==t){var d,c,l=[];for(c in d=Q("dp20username").value.split(","))l.push(d[c].trim());meshserver.send({action:"addmeshuser",meshid:currentMesh._id,meshname:currentMesh.name,usernames:l,meshadmin:a,remove:2==e})}else meshserver.send({action:"addmeshuser",meshid:currentMesh._id,meshname:currentMesh.name,userids:[t],meshadmin:a,remove:2==e})}function p20viewuser(e){var t,n,o,a,i,s;xxdialogMode||(t=decodeURIComponent(e),n=GetMeshRights(currentMesh),o=GetMeshRights(currentMesh,t),userinfo._id!=t&&(4294967295==n||0!=(2&n)&&4294967295!=o)?p20showAddMeshUserDialog(e):(e=[],4294967295==o?e.push("Volledige beheerder (met alle rechten)"):(0!=(1&o)&&e.push("Bewerk apparaatgroep"),0!=(2&o)&&e.push("Beheer apparaatgroep gebruikers"),0!=(4&o)&&e.push("Beheer apparaatgroep computers"),0!=(8&o)&&e.push("Extern beheer"),0!=(16&o)&&e.push("Agent console"),0!=(32&o)&&e.push("Serverbestanden"),0!=(64&o)&&e.push("Apparaat wekken"),0!=(128&o)&&e.push("Notities bewerken"),0!=(8&o)&&0!=(256&o)&&e.push("Alleen extern meekijken"),0!=(8&o)&&0!=(65536&o)&&e.push("Geen bureaublad"),0!=(8&o)&&0!=(512&o)&&e.push("Geen terminal"),0!=(8&o)&&0!=(1024&o)&&e.push("Geen bestanden"),0!=(8&o)&&0!=(2048&o)&&e.push("Geen Intel&reg; AMT"),0!=(8&o)&&0!=(4096&o)&&0==(256&o)&&e.push("Beperkte invoer"),0!=(8192&o)&&e.push("Alleen eigen gebeurtenissen"),0!=(16384&o)&&e.push("Chat & Melden"),0!=(32768&o)&&e.push("Deïnstallatie"),0!=(131072&o)&&e.push("Opdrachten"),0!=(262144&o)&&e.push("Reset/Uit"),0!=(524288&o)&&e.push("Delen"),0!=(1048576&o)&&e.push("Details"),0!=(2097152&o)&&e.push("Relay")),0==e.length&&e.push("Geen rechten"),a=t.split("/")[2],users&&users[t]&&(a=users[t].name),userinfo._id==t&&(a=userinfo.name),i=1,s=addHtmlValue("Gebruikersnaam",EscapeHtml(decodeURIComponent(a))),t.split("/")[2]!=a&&(s+=addHtmlValue("GebruikersID",EscapeHtml(t.split("/")[2]))),s+=addHtmlValue("Machtigingen",e.join(", ")),userinfo._id!=t&&(4294967295==n||0!=(2&n)&&4294967295!=o)&&(i+=4),setModalContent("xxAddAgent","Apparaatgroep gebruiker",s),showModal("xxAddAgentModal","idx_dlgOkButton",()=>p20viewuserEx(i,t))))}function p20viewuserEx(e,t){2==e&&(e=t.split("/")[2],users&&users[t]&&(e=users[t].name),usergroups&&usergroups[t]&&(e=usergroups[t].name),userinfo._id==t&&(e=userinfo.name),t.startsWith("user/")&&setModalContent("xxAddAgent","Gebruikersmachtigingen verwijderen",format('Bevestig de verwijdering van rechten voor gebruiker "{0}"?',EscapeHtml(decodeURIComponent(e)))),t.startsWith("ugrp/")&&setModalContent("xxAddAgent","Gebruikersgroepmachtigingen verwijderen",format('Bevestig de verwijdering van rechten voor de gebruikergroep "{0}"?',EscapeHtml(decodeURIComponent(e))),t),showModal("xxAddAgentModal","idx_dlgOkButton",()=>p20viewuserEx2(3,t)))}function p20deleteUser(e,t){return haltEvent(e),p20viewuserEx(2,decodeURIComponent(t)),!1}function p20viewuserEx2(e,t){meshserver.send({action:"removemeshuser",meshid:currentMesh._id,meshname:currentMesh.name,userid:t})}function p20editmeshInviteCode(){if(xxdialogMode)return!1;var e,t=GetMeshRights(currentMesh),n=serverinfo.name;-1!=n.indexOf(".")&&0==(2&features)||(n=window.location.hostname),n=1==serverinfo.https?"https://"+n+(443==serverinfo.port?"":":"+serverinfo.port)+domainUrl+"invite"+(urlargs.key?"?key="+urlargs.key:""):"http://"+n+(80==serverinfo.port?"":":"+serverinfo.port)+domainUrl+"invite"+(urlargs.key?"?key="+urlargs.key:""),1&t?(setModalContent("xxAddAgent","Uitnodigingscode",e=(e=(e=(e=(e="Indien ingeschakeld, kunnen uitnodigingscodes door iedereen worden gebruikt om apparaten toe te voegen aan deze apparaatgroep via de volgende openbare link:<br /><br />")+('<div style=width:100%;text-align:center><a rel="noreferrer noopener" target=_blank href="'+n+'">'+n+"</a></div><br />")+'<div style=margin-bottom:5px><label><input id=agentJoinCheck type=checkbox class="form-check-input me-2" onclick=p20editmeshInviteCodeValidate() />Schakel uitnodigingscodes in</label></div>')+addHtmlFormFloating("Uitnodigingscode",'<input id=agentInviteCode class="form-control" onkeyup=p20editmeshInviteCodeValidate() placeholder="code1, code2, code3" />'))+addHtmlFormFloating("Agents",'<select id=agentType class="form-select" onchange=p20editmeshInviteCodeValidate()><option value=0>Alle beschikbare agents</option><option value=1>Windows MeshAgent</option><option value=2>Linux MeshAgent</option><option value=4>MacOS MeshAgent</option><option value=8>MeshCentral Assistant</option></select>')+"<div id=d2agentInstallTypeDiv>")+addHtmlFormFloating("Installatie type",'<select id=agentInviteType class="form-select"><option value=0>Achtergrond en interactief</option><option value=2>Alleen achtergrond</option><option value=1>Alleen interactief</option></select>')+"</div>"),showModal("xxAddAgentModal","idx_dlgOkButton",p20editmeshInviteCodeEx),null!=currentMesh.invite&&(Q("agentJoinCheck").checked=!0,Q("agentInviteCode").value=currentMesh.invite.codes.join(", "),currentMesh.invite.ag&&(Q("agentType").value=currentMesh.invite.ag),Q("agentInviteType").value=3&currentMesh.invite.flags),p20editmeshInviteCodeValidate()):(e="Uitnodigingscodes kunnen door iedereen worden gebruikt om apparaten toe te voegen aan deze apparaatgroep via de volgende openbare link:<br /><br />",setModalContent("xxAddAgent","Uitnodigingscode",e=(e=(e+='<div style=width:100%;text-align:center><a rel="noreferrer noopener" target=_blank href="'+n+'">'+n+"</a></div><br />")+addHtmlValue("Uitnodigingscode",currentMesh.invite.codes.join(", ")))+addHtmlValue("Installatie type",["Achtergrond en interactief","Alleen interactief","Alleen achtergrond"][3&currentMesh.invite.flags])),showModal("xxAddAgentModal","idx_dlgOkButton"))}function p20editmeshInviteCodeValidate(){var e,t=!0,n=Q("agentInviteCode").value.split(",");for(e in n)n[e]=n[e].trim(),""==n[e]&&(t=!1);QE("agentInviteCode",Q("agentJoinCheck").checked),QE("agentType",Q("agentJoinCheck").checked),QE("agentInviteType",Q("agentJoinCheck").checked),QE("idx_dlgOkButton",0==Q("agentJoinCheck").checked||t),QV("d2agentInstallTypeDiv",parseInt(Q("agentType").value)<2)}function p20editmeshInviteCodeEx(){if(1==Q("agentJoinCheck").checked){var e,t=Q("agentInviteCode").value.split(",");for(e in t)t[e]=t[e].trim();meshserver.send({action:"editmesh",meshid:currentMesh._id,invite:{codes:t,flags:parseInt(Q("agentInviteType").value),ag:parseInt(Q("agentType").value)}})}else meshserver.send({action:"editmesh",meshid:currentMesh._id,invite:"*"})}function p20editMeshNotify(){var e,t,n;return xxdialogMode||(e=0,t=16384&features2&&userinfo.emailVerified,userinfo.links&&userinfo.links[currentMesh._id]&&userinfo.links[currentMesh._id].notify&&(e|=userinfo.links[currentMesh._id].notify),userinfo.notify&&userinfo.notify[currentMesh._id]&&(e|=userinfo.notify[currentMesh._id]),n='<div style="border-bottom: 1px solid #888;margin-bottom:3px">Webpagina meldingen</div><div class="form-check"><label><input id=p20notifyIntelDeviceConnect class="form-check-input me-2" type=checkbox />Apparaat verbonden</label></div><div class="form-check"><label><input id=p20notifyIntelDeviceDisconnect class="form-check-input me-2" type=checkbox />Apparaatverbinding verbroken</label></div>',currentMesh.mtype<3&&(n+='<div class="form-check"><label><input id=p20notifyIntelAmtKvmActions class="form-check-input me-2" type=checkbox />Intel&reg; AMT desktop- en seriële gebeurtenissen</label></div>'),t&&(n+='<br /><div style="border-bottom: 1px solid #888;margin-bottom:3px">Email meldingen</div><div class="form-check"><label><input id=p20enotifyIntelDeviceConnect class="form-check-input me-2" type=checkbox />Apparaat verbonden</label></div><div class="form-check"><label><input id=p20enotifyIntelDeviceDisconnect class="form-check-input me-2" type=checkbox />Apparaatverbinding verbroken</label></div><div class="form-check"><label><input id=p20enotifyIntelDeviceHelp class="form-check-input me-2" type=checkbox />Hulpverzoeken</label></div>'),null!=userinfo.msghandle&&0!=(33554432&features2)&&(n+='<br /><div style="border-bottom: 1px solid #888;margin-bottom:3px">Berichten notificaties</div><div class="form-check"><label><input id=p20emsgDeviceConnect class="form-check-input me-2" type=checkbox />Apparaat verbonden</label></div><div class="form-check"><label><input id=p20emsgDeviceDisconnect class="form-check-input me-2" type=checkbox />Apparaatverbinding verbroken</label></div><div class="form-check"><label><input id=p20emsgDeviceHelp class="form-check-input me-2" type=checkbox />Hulpverzoeken</label></div>'),setModalContent("xxAddAgent","Meldingsinstellingen",n),showModal("xxAddAgentModal","idx_dlgOkButton",p20editMeshNotifyEx),Q("p20notifyIntelDeviceConnect").checked=2&e,Q("p20notifyIntelDeviceDisconnect").checked=4&e,currentMesh.mtype<3&&(Q("p20notifyIntelAmtKvmActions").checked=8&e),t&&(Q("p20enotifyIntelDeviceConnect").checked=16&e,Q("p20enotifyIntelDeviceDisconnect").checked=32&e,Q("p20enotifyIntelDeviceHelp").checked=64&e),null!=userinfo.msghandle&&0!=(33554432&features2)&&(Q("p20emsgDeviceConnect").checked=128&e,Q("p20emsgDeviceDisconnect").checked=256&e,Q("p20emsgDeviceHelp").checked=512&e)),!1}function p20editMeshNotifyEx(e,t){var n=0,n=(n+=Q("p20notifyIntelDeviceConnect").checked?2:0)+(Q("p20notifyIntelDeviceDisconnect").checked?4:0);currentMesh.mtype<3&&(n+=Q("p20notifyIntelAmtKvmActions").checked?8:0),t&&(n=(n=(n+=Q("p20enotifyIntelDeviceConnect").checked?16:0)+(Q("p20enotifyIntelDeviceDisconnect").checked?32:0))+(Q("p20enotifyIntelDeviceHelp").checked?64:0)),null!=userinfo.msghandle&&0!=(33554432&features2)&&(n=(n=(n+=Q("p20emsgDeviceConnect").checked?128:0)+(Q("p20emsgDeviceDisconnect").checked?256:0))+(Q("p20emsgDeviceHelp").checked?512:0)),meshserver.send({action:"changemeshnotify",meshid:currentMesh._id,notify:n})}function setupMeshSummaryStats(){window.meshPowerChart=new Chart(document.getElementById("meshPowerChart").getContext("2d"),{type:"doughnut",data:{datasets:[{data:[0,0],backgroundColor:["#20F","#40D","#60B","#809","#A07","#C05"]}]},options:{shadowColor:"blue",responsive:!0,plugins:{legend:{display:!1}},animation:{animateScale:!0,animateRotate:!0},layout:{padding:{left:10,right:10,top:10,bottom:10}}}}),window.meshOsChart=new Chart(document.getElementById("meshOsChart").getContext("2d"),{type:"doughnut",data:{datasets:[{data:[0,0],backgroundColor:["#20F","#30E","#40D","#50C","#60B","#70A","#809","#908","#A07","#B06","#C05"]}]},options:{responsive:!0,plugins:{legend:{display:!1}},animation:{animateScale:!0,animateRotate:!0},layout:{padding:{left:10,right:10,top:10,bottom:10}}}}),window.meshConnChart=new Chart(document.getElementById("meshConnChart").getContext("2d"),{type:"doughnut",data:{datasets:[{data:[0,0],backgroundColor:["#20F","#40D","#60B","#809","#A07","#C05"]}],labels:["Niet verbonden","Agent","Intel&reg; AMT","Agent + Intel&reg; AMT"]},options:{responsive:!0,plugins:{legend:{display:!1}},animation:{animateScale:!0,animateRotate:!0},layout:{padding:{left:10,right:10,top:10,bottom:10}}}}),window.meshSecurityChart=new Chart(document.getElementById("meshSecurityChart").getContext("2d"),{type:"doughnut",data:{datasets:[{data:[0,0],backgroundColor:["#20F","#40D","#60B","#809","#A07","#C05"]}],labels:["OK","Anti-virus niet actief","Geen automatische update","Firewall niet actief","Meerdere problemen"]},options:{responsive:!0,plugins:{legend:{display:!1}},animation:{animateScale:!0,animateRotate:!0},layout:{padding:{left:10,right:10,top:10,bottom:10}}}})}function p21updateMesh(){if(null!=currentMesh){var e,t=GetMeshRights(currentMesh),n=EscapeHtml(currentMesh.name),o=(0==n.length&&(n="<i>Geen</i>"),0!=(1&t)&&(n='<span tabindex=0 title="Klik hier om de apparaatgroepsnaam te bewerken" onclick=p20editmesh(1) onkeyup="if (event.key == \'Enter\') p20editmesh(1)" role=button>'+n+' <i class="fa-solid fa-pencil fa-2xs"></i></span>'),QH("p21meshName",n),{}),a={},i=[0,0,0,0],s=[0,0,0,0,0],r=!1,l=!1,d=!1,c=!1;for(y in nodes)nodes[y].meshid==currentMesh._id&&(nodes[y].agent&&(r=!0,null==o[nodes[y].agent.id]?o[nodes[y].agent.id]=1:o[nodes[y].agent.id]++),nodes[y].pwr&&(l=!0,null==a[nodes[y].pwr]?a[nodes[y].pwr]=1:a[nodes[y].pwr]++),0==nodes[y].conn?(d=!0,i[0]++):0!=(6&nodes[y].conn)?(d=!0,0!=(1&nodes[y].conn)?i[3]++:i[2]++):0!=(1&nodes[y].conn)&&(d=!0,i[1]++),nodes[y].wsc)&&(c=!0,e=0,"OK"==nodes[y].wsc.antiVirus&&e++,"OK"==nodes[y].wsc.autoUpdate&&e++,"OK"==nodes[y].wsc.firewall&&e++,3==e?s[0]++:e<2?s[4]++:"OK"!=nodes[y].wsc.antiVirus?s[1]++:"OK"!=nodes[y].wsc.autoUpdate?s[2]++:"OK"!=nodes[y].wsc.firewall&&s[3]++);var u=[],p=[],m=[],g=[],v=3==currentMesh.mtype?agentsStrNoAgent:agentsStr;for(y in o)u.push(o[y]),p.push(v[y]);for(y in a)m.push(a[y]),g.push(powerStatetable[y]);window.meshPowerChart.config.data.datasets[0].data=m,window.meshPowerChart.config.data.labels=g,window.meshPowerChart.update(),2<=currentMesh.mtype&&(window.meshOsChart.config.data.datasets[0].data=u,window.meshOsChart.config.data.labels=p,window.meshOsChart.update()),window.meshConnChart.config.data.datasets[0].data=i,window.meshConnChart.update(),window.meshSecurityChart.config.data.datasets[0].data=s,window.meshSecurityChart.update();var h="",f=0;if(0<m.length){var k=[];for(y in a)k.push([powerStatetable[y],a[y]]);for(y in k.sort(function(e,t){return-(e[1]-t[1])}),h+='<table class="table table-hover table-striped" border=0 cellpadding=2 cellspacing=0 width=100%><tbody><tr style=background-color:#AAAAAA;font-weight:bold><th scope=col colspan=2 style=text-align:left;width:430px>Status</th></tr>',k)h+="<tr style="+(++f%2==0?"background-color:#DDD":"")+"><td style=text-align:right;width:60px>"+k[y][1]+" <td> "+k[y][0]+"</tr>";h+="</tbody></table>"}if(0<u.length&&2<=currentMesh.mtype){var f=0,x=[];for(y in o)x.push([v[y],o[y]]);for(y in x.sort(function(e,t){return-(e[1]-t[1])}),h+='<table class="table table-hover table-striped" border=0 cellpadding=2 cellspacing=0 width=100%><tbody><tr style=background-color:#AAAAAA;font-weight:bold><th scope=col colspan=2 style=text-align:left;width:430px>Agent Type</th></tr>',x)h+="<tr style="+(++f%2==0?"background-color:#DDD":"")+"><td style=text-align:right;width:60px>"+x[y][1]+"<td> "+x[y][0]+"</tr>";h+="</tbody></table>"}if(d){for(var b=[],y=f=0;y<4;y++)b.push([["Niet verbonden","Agent","Intel&reg; AMT","Agent + Intel&reg; AMT"][y],i[y]]);b.sort(function(e,t){return-(e[1]-t[1])}),h+='<table class="table table-hover table-striped" border=0 cellpadding=2 cellspacing=0 width=100%><tbody><tr style=background-color:#AAAAAA;font-weight:bold><th scope=col colspan=2 style=text-align:left;width:430px>Connectiviteit</th></tr>';for(y=0;y<4;y++)0<b[y][1]&&(h+="<tr style="+(++f%2==0?"background-color:#DDD":"")+"><td style=text-align:right;width:60px>"+b[y][1]+"<td> "+b[y][0]+"</tr>");h+="</tbody></table>"}if(c){for(var w=[],y=f=0;y<4;y++)w.push([['<img src="images/link2.png" style=cursor:pointer onclick=\'return p21setDevicesFilter("wsc:ok")\' width=10 height=10 /> OK','<img src="images/link2.png" style=cursor:pointer onclick=\'return p21setDevicesFilter("wsc:noav")\' width=10 height=10 /> Anti-virus niet actief','<img src="images/link2.png" style=cursor:pointer onclick=\'return p21setDevicesFilter("wsc:noupdate")\' width=10 height=10 /> Geen automatische update','<img src="images/link2.png" style=cursor:pointer onclick=\'return p21setDevicesFilter("wsc:nofirewall")\' width=10 height=10 /> Firewall niet actief','<img src="images/link2.png" style=cursor:pointer onclick=\'return p21setDevicesFilter("wsc:any")\' width=10 height=10 /> Meerdere problemen'][y],s[y]]);w.sort(function(e,t){return-(e[1]-t[1])}),h+='<table class="table table-hover table-striped" border=0 cellpadding=2 cellspacing=0 width=100%><tbody><tr style=background-color:#AAAAAA;font-weight:bold><th scope=col colspan=2 style=text-align:left;width:430px>Beveiliging</th></tr>';for(y=0;y<4;y++)0<w[y][1]&&(h+="<tr style="+(++f%2==0?"background-color:#DDD":"")+"><td style=text-align:right;width:60px>"+w[y][1]+"<td> "+w[y][0]+"</tr>");h+="</tbody></table>"}""==h&&(h="<i>Geen apparaten in deze apparaatgroep.</i>"),QH("p21info",h);t=(l?1:0)+(2<=currentMesh.mtype&&r?1:0)+(d?1:0)+(c?1:0);QS("meshPowerChartDiv").display=l?"inline-block":"none",QS("meshOsChartDiv").display=2<=currentMesh.mtype&&r?"inline-block":"none",QS("meshConnChartDiv").display=d?"inline-block":"none",QS("meshSecurityChartDiv").display=c?"inline-block":"none",QS("meshPowerChartDiv").width=3<t?"23%":"31%",QS("meshOsChartDiv").width=3<t?"23%":"31%",QS("meshConnChartDiv").width=3<t?"23%":"31%",QS("meshSecurityChartDiv").width=3<t?"23%":"31%"}}function p21setDevicesFilter(e){go(1),Q("KvmSearchInput").value=Q("SearchInput").value=e,mainUpdate(5)}var sortorder,filetreelocation=[];function updateFiles(){if(QV("MainMenuMyFiles",0==(8&features)),0==(8&features)){for(var e,t,n="",o="",a='<a href=# style=cursor:pointer onclick="return p5folderup(0)">Root</a>',i="Root",s=filetree,r=1,l=[],d=filetreelinkpath,c=[],u=document.getElementsByName("fc"),p=0;p<u.length;p++)u[p].checked&&c.push(u[p].value);for(p in filetreelinkpath="",filetreelocation){if(null==s.f||null==s.f[filetreelocation[p]])break;l.push(filetreelocation[p]),i+=" / "+filetreelocation[p],1==r?(e=filetreelocation[p].split("/"),t=window.location.origin+domainUrl+e[0]+"files/"+e[2],filetreelinkpath+=filetreelocation[p]):""!=filetreelinkpath&&(filetreelinkpath+="/"+filetreelocation[p],2<r)&&(t+="/"+filetreelocation[p]),s=s.f[filetreelocation[p]],a+=' / <a href=# style=cursor:pointer onclick="return p5folderup('+r+')">'+EscapeHtml(null!=s.n?s.n:filetreelocation[p])+"</a>",r++}filetreelocation=l;var m=i.toLowerCase().startsWith("root / "+userinfo._id+" / public"),g=p5sort_files(s.f);for(p in g){var v,h,f=g[p],k=f.n,x=70<k.length?'<span title="'+EscapeHtml(k)+'">'+EscapeHtml(k.substring(0,70))+"...</span>":EscapeHtml(k),b="",y=(null!=f.d&&(b=printDateTime(new Date(f.d))+"&nbsp;"),""),w=(null!=f.s&&(y=getFileSizeStr(f.s)),"");w=f.t<3||4==f.t?(v=1==f.t||4==f.t?p5getQuotabar(f):"",'<div class=filelist file=999><input file=999 style=float:left name=fc class="fcb form-check-input me-2" type=checkbox onchange=p5setActions() value="'+EscapeHtml(k)+'">&nbsp;<span style=float:right title="">'+v+"</span><span><div class=fileIcon"+f.t+' onclick=p5folderset("'+encodeURIComponentEx(f.nx)+'")></div><a href=# style=cursor:pointer onclick=\'return p5folderset("'+encodeURIComponentEx(f.nx)+"\")'>"+x+"</a></span></div>"):(k=x,v="",h=urlargs.key?"&key="+urlargs.key:"",m&&(v='<i class="fa-regular fa-copy" style=cursor:pointer title="Openbare link weergeven" onclick=\'return p5showPublicLink("'+t+"/"+encodeURIComponentEx(f.nx)+"?download=1"+h+'")\'></i> <i class="fa-regular fa-copy" title="Kopieer link naar het klembord" style="cursor:pointer" onclick=copyTextToClip2("'+encodeURIComponentEx(t+"/"+encodeURIComponentEx(f.nx)+"?download=1"+h)+'")></i>'),0<f.s&&(k=v+'<a onclick=downloadFile("downloadfile.ashx?link='+encodeURIComponentEx(filetreelinkpath+"/"+f.nx)+'")>'+x+"</a>"),'<div class=filelist file=3><input file=3 style=float:left name=fc class="fcb form-check-input me-2" type=checkbox onchange=p5setActions() value="'+f.nx+'">&nbsp;<span class=fsize>'+b+"</span><span style=float:right>"+y+"</span><span><div class=fileIcon"+f.t+"></div>"+k+"</span></div>"),f.t<3?n+=w:o+=w}if(QH("p5rightOfButtons",p5getQuotabar(s)),QH("p5files",n+o),QH("p5currentpath",a),QE("p5FolderUp",0!=filetreelocation.length),QV("p5PublicShare",m),d==filetreelinkpath)for(u=document.getElementsByName("fc"),p=0;p<u.length;p++)u[p].checked=0<=c.indexOf(u[p].value);p5setActions()}}function getNiceSize(e){return e<=0?"Opslaglimiet overschreden":e<2048?format("{0} resterende bytes",e):e<2097152?format("{0} resterende kilobytes",Math.round(e/1024)):e<2147483648?format("{0} resterende megabytes",Math.round(e/1024/1024)):format("{0} rsterende gigabytes",Math.round(e/1024/1024/1024))}function getNiceSize2(e){return e<=0?"Geen":e<2048?format("{0} b",e):e<2097152?format("{0} Kb",Math.round(e/1024)):e<2147483648?format("{0} Mb",Math.round(e/1024/1024)):format("{0} Gb",Math.round(e/1024/1024/1024))}function getNiceSize3(e){return e<=0?"Geen":e<2048?format("{0} b",e):e<2097152?format("{0} Kb",round(e/1024,1)):e<2147483648?format("{0} Mb",round(e/1024/1024,1)):format("{0} Gb",round(e/1024/1024/1024,1))}function p5getQuotabar(e){for(;1<e.t&&4!=e.t;)e=e.parent;var t,n;return 1!=e.t&&4!=e.t||null==e.maxbytes?"":(t=Math.floor(e.s/1024),n=e.maxbytes-e.s,'<span title="'+(1<e.c?format("{0}k in 1 file. {2}k maximum",t,e.c,Math.floor(e.maxbytes/1024/1024)):format("{0}k in 1 bestand. {1}k maximum",t,Math.floor(e.maxbytes/1024/1024)))+'">'+getNiceSize(n)+" <progress style=height:10px;width:100px value="+e.s+" max="+e.maxbytes+" /></span>")}function p5showPublicLink(e){return setModalContent("xxAddAgent","Publieke link",'<input type=text style=width:350px value="'+e+'" readonly /> <i class="fa-regular fa-copy" title="Kopieer link naar het klembord" style="cursor:pointer" onclick=copyTextToClip2("'+encodeURIComponentEx(e)+'")></i>'),showModal("xxAddAgentModal","idx_dlgOkButton"),!1}function p5sort_filename(e,t){return e.ln>t.ln?+sortorder:e.ln<t.ln?-1*sortorder:0}function p5sort_timestamp(e,t){return e.d>t.d?+sortorder:e.d<t.d?-1*sortorder:0}function p5sort_bysize(e,t){return e.s==t.s?p5sort_filename(e,t):(e.s-t.s)*sortorder}function p5sort_files(e){var t,n=[],o=Q("p5sortdropdown").value;for(t in e)e[t].nx=t,null==e[t].n&&(e[t].n=t),e[t].ln=e[t].n.toLowerCase(),n.push(e[t]);return sortorder=1,3<o&&(sortorder=-1,o-=3),1==o?n.sort(p5sort_filename):2==o?n.sort(p5sort_bysize):3==o&&n.sort(p5sort_timestamp),n}function p5setActions(){var e=getFileSelCount(),t=getFileCount(),n=getFileSelCount(!1);QE("p5DeleteFileButton",0<e&&0<filetreelocation.length),QE("p5ViewFileButton",1==e&&1==n&&0<filetreelocation.length),QE("p5NewFolderButton",0<filetreelocation.length),QE("p5UploadButton",0<filetreelocation.length),QE("p5DownloadButton",0<e&&e==n&&0<filetreelocation.length),QE("p5RenameFileButton",1==e&&0<filetreelocation.length),QE("p5SelectAllButton",0<t),Q("p5SelectAllButton").value=0<e?"Selecteer niets":"Selecteer alles",QE("p5CutButton",0<n&&e==n),QE("p5CopyButton",0<n&&e==n),QE("p5PasteButton",null!=p5clipboard&&0<p5clipboard.length&&0<filetreelocation.length)}function getFileSelCount(e){for(var t=0,n=document.getElementsByName("fc"),o=0;o<n.length;o++)!n[o].checked||0==e&&"3"!=n[o].attributes.file.value||t++;return t}function getFileSelDirCount(){for(var e=0,t=document.getElementsByName("fc"),n=0;n<t.length;n++)t[n].checked&&"999"==t[n].attributes.file.value&&e++;return e}function getFileCount(){return document.getElementsByName("fc").length}function p5selectallfile(){for(var e=0==getFileSelCount(),t=document.getElementsByName("fc"),n=0;n<t.length;n++)t[n].checked=e;p5setActions()}function setupBackPointers(e){if(null!=e.f){var t,n=0,o=0;for(t in e.f)setupBackPointers(e.f[t]),(e.f[t].parent=e).f[t].s&&(n+=e.f[t].s),e.f[t].c&&(o+=e.f[t].c),3==e.f[t].t&&o++;e.s=n,e.c=o}return e}function getFileSizeStr(e){return 1==(e="number"!=typeof e?0:e)?"1 byte":format("{0} bytes",e)}function p5folderup(e){if(null==e)filetreelocation.pop();else for(;filetreelocation.length>e;)filetreelocation.pop();return updateFiles(),!1}function p5folderset(e){return filetreelocation.push(decodeURIComponent(e)),updateFiles(),!1}function p5createfolder(){setModalContent("xxAddAgent","Nieuwe map",'<input type=text id=p5renameinput class="form-control" maxlength=64 onkeyup=p5fileNameCheck(event) />'),showModal("xxAddAgentModal","idx_dlgOkButton",p5createfolderEx),focusTextBox("p5renameinput"),p5fileNameCheck()}function p5createfolderEx(){meshserver.send({action:"fileoperation",fileop:"createfolder",path:filetreelocation,newfolder:Q("p5renameinput").value})}function p5deletefile(){var e=getFileSelCount(),t=0<getFileSelDirCount()?'<br /><br /><label><input type=checkbox class="form-check-input me-2" id=p5recdeleteinput>Recursieve verwijdering</label><br>':"<input type=checkbox id=p5recdeleteinput class=\"form-check-input me-2\" style='display:none'>";setModalContent("xxAddAgent","Verwijderen",1<e?format("Verwijder {0} gelecteerde items?",e)+t:"Verwijder geselecteerde item?"+t),showModal("xxAddAgentModal","idx_dlgOkButton",p5deletefileEx)}function p5deletefileEx(){for(var e=[],t=document.getElementsByName("fc"),n=0;n<t.length;n++)t[n].checked&&e.push(t[n].value);meshserver.send({action:"fileoperation",fileop:"delete",path:filetreelocation,delfiles:e,rec:Q("p5recdeleteinput").checked})}function p5renamefile(){for(var e,t=document.getElementsByName("fc"),n=0;n<t.length;n++)t[n].checked&&(e=t[n].value);setModalContent("xxAddAgent","Hernoemen",'<input type=text id=p5renameinput class="form-control" maxlength=64 onkeyup=p5fileNameCheck(event) value="'+e+'" />'),showModal("xxAddAgentModal","idx_dlgOkButton",p5renamefileEx),focusTextBox("p5renameinput"),p5fileNameCheck()}function p5renamefileEx(e,t){t.newname=Q("p5renameinput").value,meshserver.send(t)}function p5fileNameCheck(e){var t=isFilenameValid(Q("p5renameinput").value);QE("idx_dlgOkButton",t),1==t&&e&&13==e.keyCode&&dialogclose(1)}var isFilenameValid=(()=>{var t=/^[^\\/:\*\?"<>\|]+$/,n=/^\./,o=/^(nul|prn|con|lpt[0-9]|com[0-9])(\.|$)/i;return function(e){return t.test(e)&&!n.test(e)&&!o.test(e)&&"."!=e[0]}})();function p5uploadFile(){setModalContent("xxAddAgent","Upload bestand",'<form method=post enctype=multipart/form-data action=uploadfile.ashx target=fileUploadFrame><input type=text name=link style=display:none id=p5uploadpath value="'+encodeURIComponentEx(filetreelinkpath)+'" /><input type=file name=files id=p5uploadinput class="form-control" multiple=multiple onchange="p5updateUploadDialogOk(\'p5uploadinput\')" /><input type=hidden name=authCookie value='+authCookie+' /><input type=submit id=p5loginSubmit class="btn btn-outline-success mt-2" style="display:none" /><span id=p5confirmOverwriteSpan style=display:none><br/><label><input type=checkbox class="form-check-input me-2" id=p5confirmOverwrite onchange="p5updateUploadDialogOk(\'p5uploadinput\')" />Bevestig overschrijven?</label></span></ >'),showModal("xxAddAgentModal","idx_dlgOkButton",p5uploadFileEx),p5updateUploadDialogOk("p5uploadinput")}function p5uploadFileEx(){Q("p5loginSubmit").click()}function p5GetFileInfo(e){var t,n=filetree;for(t in filetreelocation)null!=n.f&&null!=n.f[filetreelocation[t]]&&(n=n.f[filetreelocation[t]]);return n.f[e]}function p5updateUploadDialogOk(){var e=Q("p5uploadinput").files,t=[];for(i in e)null!=e[i].size&&0!=e[i].size&&t.push(e[i]);var n=filetree,o=[],a=0;for(i in filetreelocation)null!=n.f&&null!=n.f[filetreelocation[i]]&&(n=n.f[filetreelocation[i]]);if(QE("idx_dlgOkButton",0<e.length),0<e.length){if(null!=n.f){for(var i in n.f)o.push(i);for(i=0;i<e.length;i++)0<=o.indexOf(e[i].name)&&a++}QV("p5confirmOverwriteSpan",0<a),0<a?QE("idx_dlgOkButton",Q("p5confirmOverwrite").checked):(Q("p5confirmOverwrite").checked=!1,QE("idx_dlgOkButton",!0))}}function p5viewfile(){for(var e,t=document.getElementsByName("fc"),n=0;n<t.length;n++)if(t[n].checked)return null==(e=p5GetFileInfo(t[n].value))?void 0:void(e.s<=204800?meshserver.send({action:"fileoperation",fileop:"get",path:filetreelocation,file:t[n].value,tag:"edit"}):messagebox("Bestandsberwerker","Alleen bestanden kleiner dan 200k kunnen worden bewerkt."))}var p5clipboard=null,p5clipboardFolder=null,p5clipboardCut=0;function p5copyFile(e){var t=document.getElementsByName("fc");p5clipboard=[],p5clipboardCut=e,p5clipboardFolder=Clone(filetreelocation);for(var n=0;n<t.length;n++)t[n].checked&&"3"==t[n].attributes.file.value&&p5clipboard.push(t[n].value);p5updateClipview()}function p5pasteFile(){var e="";setModalContent("xxAddAgent","Plakken",e=null!=p5clipboard&&0<p5clipboard.length?format("Bevestig {0} van {1} bestand {2} naar deze locatie?",0==p5clipboardCut?"copy":"move",p5clipboard.length,1<p5clipboard.length?"s":""):e),showModal("xxAddAgentModal","idx_dlgOkButton",p5pasteFileEx)}function p5pasteFileEx(){meshserver.send({action:"fileoperation",fileop:0==p5clipboardCut?"copy":"move",scpath:p5clipboardFolder,path:filetreelocation,names:p5clipboard}),p5folderup(999),1==p5clipboardCut&&(p5clipboardFolder=p5clipboard=null,p5clipboardCut=0,p5updateClipview())}function p5updateClipview(){var e="";null!=p5clipboard&&0<p5clipboard.length&&(e=format("Houd {0} item {1} vast voor {2}",p5clipboard.length,1<p5clipboard.length?"s":"",0==p5clipboardCut?"kopiëren":"verplaatsen")+', <a href=# onclick="return p5clearClip()" style=cursor:pointer>Wissen</a>.'),QH("p5bottomstatus",e),p5setActions()}function p5clearClip(){return p5clipboardFolder=p5clipboard=null,p5clipboardCut=0,p5updateClipview(),!1}function p5fileDragDrop(e){if(!xxdialogMode&&(haltEvent(e),QV("bigfail",!1),QV("bigok",!1),null!=e.dataTransfer)){var t=[];for(i in e.dataTransfer.files)null!=e.dataTransfer.files[i].size&&0!=e.dataTransfer.files[i].size&&t.push(e.dataTransfer.files[i]);if(0!=t.length){var n=filetree,o=[],a=0;for(i in filetreelocation)null!=n.f&&null!=n.f[filetreelocation[i]]&&(n=n.f[filetreelocation[i]]);if(null!=n.f){for(var i in n.f)o.push(i);for(i=0;i<e.dataTransfer.files.length;i++)0<=o.indexOf(e.dataTransfer.files[i].name)&&a++}0==a?p5PerformUpload(1,e.dataTransfer.files):(setModalContent("xxAddAgent","Upload bestand",format(1==a?"Upload overschrijft {0} bestand. Doorgaan?":"Upload overschrijft {0} bestanden. Doorgaan?",a)),showModal("xxAddAgentModal","idx_dlgOkButton",()=>p5PerformUpload(3,e.dataTransfer.files)))}}}function p5PerformUpload(e,t){var n=0;p5uploadFile();try{Q("p5uploadinput").files=t}catch(e){n=1}if(0==n&&p5uploadFileEx(),setDialogMode(0),1==n&&0!=filetreelocation.length){for(var o=[],a=[],i=[],s=[],r=t.length,l=0,d=0;d<t.length;d++)l+=t[d].size;if(13e5<l)p5uploadFile();else for(d=0;d<t.length;d++){var c=new FileReader,u=t[d];o.push(u.name),a.push(u.size),i.push(u.type),c.onload=function(e){s.push(e.target.result),0==--r&&(Q("p5fileDragName").value=o.join("*"),Q("p5fileDragSize").value=a.join("*"),Q("p5fileDragType").value=i.join("*"),Q("p5fileDragData").value=s.join("*"),Q("p5fileDragLink").value=encodeURIComponentEx(filetreelinkpath),Q("p5fileDragAuthCookie").value=authCookie,Q("p5loginSubmit2").click())},c.readAsDataURL(u)}}}var p5dragtimer=null;function p5fileDragOver(e){xxdialogMode||(haltEvent(e),null!=p5dragtimer&&(clearTimeout(p5dragtimer),p5dragtimer=null),e=!0,0==filetreelocation.length&&(e=!1),QV("bigok",e),QV("bigfail",!e))}function p5fileDragLeave(e){xxdialogMode||(haltEvent(e),"p5filetable"!=e.target.id?(QV("bigfail",!1),QV("bigok",!1)):p5dragtimer=setTimeout(function(){QV("bigfail",!1),QV("bigok",!1),p5dragtimer=null},10))}function p5downloadButton(){for(var e=document.getElementsByName("fc"),t=0;t<e.length;t++)e[t].checked&&downloadFile("downloadfile.ashx?link="+encodeURIComponentEx(filetreelinkpath+"/"+e[t].value))}var eventsMessageId={1:"Account login",2:"Account uitloggen",3:"Taal gewijzigd van {1} in {2}",4:"Deelgenomen aan desktop multiplex-sessie",5:"Verliet de desktop multiplex-sessie",6:"Desktop multiplex-sessie gestart",7:"Opnamesessie voltooid, {0} seconde(n)",8:"Gesloten desktop multiplex-sessie, {0} seconde(n)",9:'Relay-sessie "{0}" van {1} tot {2} beëindigd, {3} seconde(n)',10:'Beëindigde terminalsessie "{0}" van {1} tot {2}, {3} seconde(n)',11:'Beëindigde desktopsessie "{0}" van {1} tot {2}, {3} seconde(n)',12:'Beëindigde bestandsbeheersessie "{0}" van {1} tot {2}, {3} seconde(n)',13:'Relaysessie "{0}" gestart van {1} tot {2}',14:'Terminal-sessie "{0}" gestart van {1} tot {2}',15:'Bureaubladsessie "{0}" gestart van {1} tot {2}',16:'Bestandsbeheersessie "{0}" gestart van {1} tot {2}',17:'Verwerking console-opdracht: "{0}"',18:'Weergegeven berichtvenster, title = "{0}", message = "{1}"',19:"Doodingsproces {0}",20:"Opening: {0}",21:"Klembordinhoud ophalen, {0} byte(n)",22:"Klembordinhoud instellen, {0} byte(n)",23:"Poging tot activering van Intel (R) AMT ACM-modus",24:"Commando's uitvoeren",25:"Krachtige actie uitvoeren = {0}, gedwongen = {1}",26:'Toastbericht weergeven, title = "{0}", message = "{1}"',27:"Lokale gebruiker heeft verzoek om terminal op afstand geaccepteerd",28:"Lokale gebruiker heeft verzoek om terminal op afstand afgewezen",29:"Remote Desktop Connection gedwongen gesloten door lokale gebruiker",30:"Extern bureaublad starten nadat de lokale gebruiker is geaccepteerd",31:"Verbindingsbalk voor extern bureaublad geactiveerd / bijgewerkt",32:"Verbindingsbalk voor extern bureaublad mislukt of wordt niet ondersteund",33:"Remote Desktop Connection gedwongen gesloten door lokale gebruiker",34:"Kan extern bureaublad niet starten nadat lokale gebruiker is afgewezen",35:"Begon extern bureaublad met toastmelding",36:"Startte extern bureaublad zonder kennisgeving",37:"Verbindingsbalk voor extern bureaublad geactiveerd / bijgewerkt",38:"Verbindingsbalk voor extern bureaublad mislukt of wordt niet ondersteund",39:"Remote Desktop Connection gedwongen gesloten door lokale gebruiker",40:"Externe bestanden starten nadat de lokale gebruiker is geaccepteerd",41:"Kan externe bestanden niet starten nadat de lokale gebruiker is geweigerd",42:"Startte externe bestanden met toastmelding",43:"Startte externe bestanden zonder kennisgeving",44:'Map maken: "{0}"',45:'Verwijderen: "{0}"',46:'Verwijder recursief: "{0}", {1} element(en) verwijderd',47:'Verwijderen: "{0}", {1} element(en) verwijderd',48:'Hernoemen: "{0}" naar "{1}"',49:'Downloaden: "{0}"',50:'Uploaden: "{0}"',51:'Kopieer: "{0}" naar "{1}"',52:'Verplaatsen: "{0}" naar "{1}"',53:"Externe gebruiker van desktop vergrendelen",54:"Agent heeft sessie gesloten met {0}% agent-naar-servercompressie. Verzonden: {1}, gecomprimeerd: {2}",55:"Apparaatgroep gemaakt: {0}",56:"Apparaatgroep hersteld: {0}",57:"Apparaat {0} toegevoegd aan apparaatgroep {1}",58:"Apparaat aangevraagd Intel (R) AMT ACM-activering, FQDN: {0}",59:"Gewijzigd apparaat {0} uit groep {1}: {2}",60:"Apparaatrechten van gebruikers verwijderd voor {0}",61:"Apparaatrechten van gebruikers gewijzigd voor {0}",62:"Gebruiker {0} verwijderd uit gebruikersgroep {1}",63:"Account verwijderd",64:"Account gemaakt, gebruikersnaam is {0}",65:"Account gemaakt, e-mailadres is {0}",66:"Account gewijzigd: {0}",67:"Lidmaatschap gebruikersgroep gewijzigd: {0}",68:"Gebruikersgroep {0} toegevoegd aan apparaatgroep {1}",69:"Gebruikersgroep gemaakt: {0}",70:"Gebruikersgroep {0} verwijderd uit apparaatgroep {1}",71:"Gebruiker {0} toegevoegd aan gebruikersgroep {1}",72:"Gebruiker {0} verwijderd uit gebruikersgroep {1}",73:"Melding van apparaatgroep gewijzigd",74:"Accountwachtwoord gewijzigd: {0}",75:"Accountgegevens gewijzigd",76:"Apparaatgroep gemaakt: {0}",77:"Apparaatgroep verwijderd: {0}",78:"Lidmaatschap van apparaatgroep gewijzigd: {0}",79:"Gebruikersgroep gewijzigd: {0}",80:"Gebruiker {0} toegevoegd aan gebruikersgroep {1}",81:"Apparaatrechten van gebruikers verwijderd voor {0}",82:"Apparaatrechten van gebruikers gewijzigd voor {0}",83:"Gebruiker {0} verwijderd uit apparaatgroep {1}",84:"Apparaat {0} toegevoegd aan apparaatgroep {1}",85:"Verplaatst apparaat {0} naar groep {1}",86:"Apparaatrechten van gebruikers verwijderd voor {0}",87:"Apparaat {0} verwijderd uit apparaatgroep {1}",88:"Ingeschakelde tweefactorauthenticatie voor e-mail",89:"Uitgeschakelde tweefactorauthenticatie voor e-mail",90:"Authenticatie-applicatie toegevoegd",91:"Verificatieapplicatie verwijderd",92:"Nieuwe 2FA-back-upcodes gegenereerd",93:"2FA-back-upcodes gewist",94:"Beveiligingssleutel verwijderd",95:"Beveiligingssleutel toegevoegd",96:"Geverifieerd telefoonnummer van gebruiker {0}",97:"Telefoonnummer van gebruiker {0} verwijderd",98:"Hulp verzoek van, gebruiker: {0}, details: {1}",99:"Commando's uitvoeren als gebruiker",100:"Indien mogelijk commando's uitvoeren als gebruiker",101:"Apparaat delen {0} toegevoegd van {1} tot {2}",102:"Apparaatdeling {0} verwijderd",103:"Batch-upload van {0} bestand (en) naar map {1}",104:'Geautomatiseerde download van agent core dumpbestand: "{0}"',105:'Upload: "{0}", Grootte: {1}',106:'Download: "{0}", Grootte: {1}',107:"Account aanmelding van {0}, {1}, {2}",108:"Gebruikersaanmeldingspoging met onjuiste 2e factor van {0}, {1}, {2}",109:"Gebruikersaanmeldingspoging op vergrendeld account van {0}, {1}, {2}",110:"Ongeldige inlog poging {0}, {1}, {2}",111:"Apparaat verzocht om Intel (R) AMT ACM TLS-activering, FQDN: {0}",112:'Beëindigde messengersessie  "{0}" van {1} naar {2}, {3} second(s)',113:"Verificatie apparaat voor pushmeldingen toegevoegd",114:"Verificatieapparaat voor pushmeldingen verwijderd",115:"Inlogtoken toegevoegd",116:"Inlogtoken verwijderd",117:"Dit is een oude agent versie, overweeg om te updaten.",118:"Deze agent heeft een verouderd certificaat validatiemechanisme, overweeg om te updaten.",119:"Deze agent gebruikt onveilige tunnels, overweeg om te updaten.",120:'Lokale doorstuursessie gestart "{0}", protocol {1} naar {2}',121:'Beëindigde lokale relay sessie "{0}", protocol {1} naar {2}, {3} seconde(n)',122:"Verliet de desktop multiplex sessie na {0} seconde(n).",123:'Verliet de web-SSH sessie na "{1}" {0} seconde(n).',124:'Verliet de web-SFTP sessie na "{1}" {0} seconde(n).',125:'Verliet de desktop multiplex sessie na "{1}" {0} seconde(n).',126:"Web-VNC sessie verlaten na {0} seconde(n).",127:"Weergavenaam account gewijzigd in {0}.",128:"Account aangemaakt, naam is {0}.",129:"Weergavenaam account verwijderd.",130:"Gebruikersmeldingen gewijzigd",131:"Apparaat delen {0} toegevoegd met onbeperkte tijd.",132:"Inschakelen.",133:"Uitschakelen",134:"Geforceerd verbroken desktopsessie van gebruiker {0}",135:"Geforceerd verbroken terminalsessie van gebruiker {0}",136:"Geforceerd verbroken bestandssessie van gebruiker {0}",137:"Geforceerd verbroken routeringssessie van gebruiker {0}",138:"Apparaat delen toegevoegd {0} dagelijks terugkerend.",139:"Apparaat delen toegevoegd {0} wekelijks terugkerend.",140:"Gewijzigd apparaat {0} uit groep {1}: {2}",141:"Intel(r) AMT-beleidswijziging",142:"Apparaatgroep {0} is gewijzigd: {1}",143:'Deelgenomen aan desktop multiplex-sessie "{0}"',144:'Verliet de desktop multiplexsessie "{0}" na {1} seconde(n).',145:'Startte een Desktop multiplexsessie "{0}"',146:'Beëindigde opnamesessie "{0}", {1} seconde(n)',147:'Gesloten desktop multiplexsessie "{0}", {1} seconde(n)',148:'Gestarte Web-SSH sessie "{0}".',149:'Gestarte Web-SFTP sessie "{0}".',150:'Gestarte Web-RDP sessie "{0}".',151:'Gestarte Web-VNC sessie "{0}".',152:'Niet langer een relay voor "{0}".',153:'Is een relay voor "{0}".',154:"Account gewijzigd om te synchroniseren met LDAP gegevens.",155:"Geweigerde gebruikerslogin van {0}, {1}, {2}",156:"Geverifieerd berichtenaccount van gebruiker {0}",157:"Berichtenaccount van gebruiker {0} verwijderd",158:'Waarschuwingsvenster weergeven, title="{0}", message="{1}"',159:"Apparaat is ingeschakeld",160:"Duo twee factorauthenticatie ingeschakeld",161:"Duo twee factorauthenticatie uitgeschakeld"},eventsShortMessageId={1:"Groepsnaam",2:"Omschrijving",3:"vlaggen",4:"Toestemming",5:"Geautomatiseerde verwijdering",6:"Uitnodigingscode",7:"Doorstuur apparaat"};function eventMouseHover(e,t){e.children[1].classList.remove("g1s"),e.children[2].classList.remove("style10s"),1==t&&(e.children[1].classList.add("g1s"),e.children[2].classList.add("style10s"))}function eventsUpdate(){var e="",t=null;for(s in events){var n=events[s],o=new Date(n.time);if(n.msg){null==n.h&&(n.h=Math.random()),printDate(o)!=t&&(null!=t&&(e+="</table>"),e+='<table class="table table-hover p3eventsTable" cellpadding=0 cellspacing=0><tr><td colspan=4 class=DevSt>'+(t=printDate(o))+"</td></tr>");var a,i="fa-mobile-screen";if("ugrp"==n.etype&&(i="fa-users"),"user"==n.etype&&(i="fa-user"),"server"==n.etype&&(i="fa-server"),null==n.msgid||null==eventsMessageId[n.msgid])a="string"==typeof n.msg?EscapeHtml(n.msg).split("(R)").join("&reg;"):"";else{if(a=eventsMessageId[n.msgid],null!=n.msgArgs)for(var s in n.msgArgs){var r=n.msgArgs[s];if(Array.isArray(r)){var l,d=[];for(l in r)"number"==typeof r[l]&&eventsShortMessageId[r[l]]?d.push(eventsShortMessageId[r[l]]):d.push(r[l]);r=d.join(", ")}else"string"==typeof r&&0==r.indexOf("DATETIME:")&&(r=printFlexDateTime(new Date(parseInt(r.substring(9)))));a=a.split("{"+s+"}").join(r)}a=EscapeHtml(a).split("(R)").join("&reg;")}if(n.nodeid){var c=getNodeFromId(n.nodeid);if(null!=c){switch(c.icon){case 1:i="fa-computer";break;case 2:i="fa-laptop";break;case 8:i="fa-laptop-code"}a="<a href=# onclick='gotoDevice(\""+n.nodeid+"\",10);haltEvent(event);'>"+EscapeHtml(c.name)+"</a> &rarr; "+a}}n.username&&(c="",n.guestname&&(c=' / <span title="Dit is een gedeelde gastsessie">'+EscapeHtml(n.guestname)+"</span>"),a=2&userinfo.siteadmin&&n.userid?"<a href=# onclick='gotoUser(\""+encodeURIComponentEx(n.userid)+"\");haltEvent(event);'>"+EscapeHtml(n.username)+"</a>"+c+" &rarr; "+a:EscapeHtml(n.username)+c+" &rarr; "+a),n.remoteaddr&&(a+=" ("+n.remoteaddr+")"),"relay"!=n.etype&&"relaylog"!=n.action||(i="fa-arrow-right-arrow-left"),e+="<tr onclick=showEventDetails("+n.h+',2)  onmouseover=eventMouseHover(this,1) onmouseout=eventMouseHover(this,0) role=button><td style=width:18px><i class="fa-fw fa-solid '+i+'"></i></td><td class=g1>&nbsp;</td><td class=style10>'+printTime(o)+" - "+a+"</td></tr><tr></tr>"}}null!=t&&(e+="</table>"),""==e&&(e="<br><i>Geen gebeurtenissen gevonden</i><br><br>"),QH("p3events",e)}function refreshEvents(){""!=p3filterevents.value?meshserver.send({action:"events",limit:parseInt(p3limitdropdown.value),filter:p3filterevents.value}):meshserver.send({action:"events",limit:parseInt(p3limitdropdown.value)})}function p3showReportDialog(){var e;xxdialogMode||(e="<div style=float:right><img src='images/report60.png' height=74 width=60 style=padding-top:2px /></div><div>",setModalContent("xxAddAgent","Rapport downloaden",e=(e=(e=(e=(e+=addHtmlFormFloating("Rapporttype",'<select id=d2reportType class="form-select" onchange=p3showReportValidation()><option value=1>Alle gebeurtenissen</option>'))+addHtmlFormFloating("Tijdspanne",'<select id=d2reportSpan class="form-select" onchange=p3showReportValidation()><option value=1>Alle beschikbare</option><option value=2>één dag</option></select>'))+("<div id=d2daySelector>"+addHtmlFormFloating("Dag rapport",'<input type=date id=d2reportDay class="form-control" onchange=p3showReportValidation()></input>')+"</div>"))+addHtmlFormFloating("Groeperen op",'<select id=d2reportGroupBy class="form-select" onchange=p3showReportValidation()><option value=1>Geen</option><option value=2>Apparaat groep</option><option value=3>Gebruiker</option>'))+addHtmlFormFloating("Formaat",'<select id=d2reportFormat class="form-select" onchange=p3showReportValidation()><option value=1>CSV</option><option value=2>JSON</option>')+"</div>"),showModal("xxAddAgentModal","idx_dlgOkButton"),p3showReportValidation(),Q("d2reportType").focus())}function p3showReportValidation(){Q("d2reportType").value;var e=Q("d2reportSpan").value,t=Q("d2reportDay").value,n=(Q("d2reportGroupBy").value,Q("d2reportFormat").value,QV("d2daySelector",2==e),!0);2==e&&""==t&&(n=!1),QE("idx_dlgOkButton",n)}function p3showDownloadEventsDialog(e){var t;xxdialogMode||(t="Download de lijst met gebeurtenissen in een van de onderstaande bestandsindelingen.<br /><br />",setModalContent("xxAddAgent","Gebeurtenissenlijst exporteren",t=(t+=addHtmlValue("CSV Formaat",'<a href=# style=cursor:pointer onclick="return p3downloadEventsDialogCSV('+e+')">eventslist.csv</a>'))+addHtmlValue("JSON-indeling",'<a href=# style=cursor:pointer onclick="return p3downloadEventsDialogJSON('+e+')">eventslist.json</a>')),showModal("xxAddAgentModal","idx_dlgOkButton"))}function p3downloadEventsDialogCSV(e){var t,n,o;for(o in 1==e&&(n=currentDeviceEvents),2==e&&(n=events),t="utc, tijd, type, actie, bebruiker, apparaat, bericht\r\n",n=3==e?currentUserEvents:n){var a,i="";n[o].nodeid&&(a=getNodeFromId(n[o].nodeid))&&a.name&&(i=a.name),t+='"'+n[o].time+'","'+printDateTime(new Date(n[o].time))+'","'+n[o].etype+'","'+(null!=n[o].action?n[o].action:"")+'","'+(null!=n[o].username?n[o].username:"")+'","'+EscapeHtml(i)+'","'+(null!=n[o].msg?n[o].msg:"").split(",").join(" -")+'"\r\n'}return saveAs(stringToUtf8Blob(t),"eventslist.csv"),!1}function p3downloadEventsDialogJSON(e){var t,n,o=[];for(n in 1==e&&(t=currentDeviceEvents),2==e&&(t=events),t=3==e?currentUserEvents:t)o.push(events[n]);return saveAs(new Blob([JSON.stringify(o,null,2)],{type:"application/octet-stream"}),"eventslist.json"),!1}function updateUsers(){if(QV("UserNewAccountButton",0==(4&features)&&0==serverinfo.domainauth),null==users||0!=(4&features))QH("p3users","");else{var e=null!=userViewSettings&&userViewSettings.noViewLimit?1e5:100,t=[],n=e,o=0;for(c in users)t.push(users[c]);t.sort(nameSort);for(var a=Q("UserSearchInput").value.toLowerCase(),i=a,s=(a.startsWith("email:")?(a=null,i=i.substring(6)):a.startsWith("name:")?(i=null,a=a.substring(5)):a.startsWith("e:")?(a=null,i=i.substring(2)):a.startsWith("n:")&&(i=null,a=a.substring(2)),'<table class="table table-hover" cellpadding=0 cellspacing=0>'),r=!0,l=(s+="<th>Naam<th style=width:80px>Apparaatgroepen<th style=width:120px>"+nobreak("Laatste toegang")+"<th style=width:120px>Machtigingen",[]),d=document.getElementsByClassName("UserCheckbox"),c=0;c<d.length;c++)d[c].checked&&l.push(d[c].value);for(c in t){var u=t[c],p=null;null!=(p=null!=wssessions?wssessions[u._id]:p)&&(null!=a&&(""==a||0<=u.name.toLowerCase().indexOf(a))||null!=i&&null!=u.email&&0<=u.email.toLowerCase().indexOf(i))&&(0<n?(r&&(s+="<tr><td class=userTableHeader colspan=4>Online gebruikers",r=!1),s+=addUserHtml(u,p),n--):o++)}for(c in r=!0,t){u=t[c],p=null;null==(p=null!=wssessions?wssessions[u._id]:p)&&(null!=a&&(""==a||0<=u.name.toLowerCase().indexOf(a))||null!=i&&null!=u.email&&0<=u.email.toLowerCase().indexOf(i))&&(0<n?(r&&(s+="<tr><td class=userTableHeader colspan=4>Offline gebruikers",r=!1),s+=addUserHtml(u,p),n--):o++)}s+="</table>",1==o?s+="<br />1 gebruiker niet getoond, gebruik de zoekfunctie om gebruikers te vinden...<br />":1<o&&(s+="<br />"+format("{0} meer gebruikers niet getoond, gebruik zoekvak om gebruikers te zoeken ...",o)+"<br />"),n==e&&(s+="<br />Geen gebruikers gevonden<br />"),QH("p3users",s);for(var d=document.getElementsByClassName("UserCheckbox"),m=encodeURIComponentEx(userinfo._id),c=0;c<d.length;c++)d[c].checked=0<=l.indexOf(d[c].value)&&d[c].value!=m;p3updateInfo(),null!=currentUser&&30==xxcurrentView&&gotoUser(encodeURIComponentEx(currentUser._id),!0)}}function addUserHtml(e,t){var n="",o=" gray",a="",i=e._id!=userinfo._id,s="",r="",t=(null!=t?(o="",i&&(a='<span style=float:right;margin-top:1px;margin-right:4px title=Chat><a href=# onclick=userChat(event,"'+encodeURIComponentEx(e._id)+'","'+encodeURIComponentEx(e.name)+"\")><img src='images/icon-chat.png' height=16 width=16 style=padding-top:2px /></a></span>",a+="<span style=float:right;margin-top:1px;margin-left:4px;margin-right:4px title=Notify><a href=# onclick='return showUserAlertDialog(event,\""+encodeURIComponentEx(e._id)+"\")'><img src='images/icon-notify.png' height=16 width=16 style=padding-top:2px /></a></span>"),s+=nobreak(1==t?"1 sessie":format("{0} sessies",t))):e.access?s+='<span title="'+format("Laatste toegang: {0}",printDateTime(new Date(1e3*e.access)))+'">'+printDate(new Date(1e3*e.access))+"</span>":e.login&&(s+='<span title="'+format("Laatste inlog: {0}",printDateTime(new Date(1e3*e.login)))+'">'+printDate(new Date(1e3*e.login))+"</span>"),i&&(r+="<a href=# style=cursor:pointer onclick='return showUserAdminDialog(event,\""+encodeURIComponentEx(e._id)+"\")'>"),null!=e.siteadmin&&0!=(32&e.siteadmin)&&4294967295!=e.siteadmin&&(r+="Vergrendeld,&nbsp;"),r+="<span title='Serverrechten'>",4294966047&e.siteadmin),l=(null==e.siteadmin||0==t?r+="Gebruiker":8==t?r+="Gebruiker + bestanden":4294967295==e.siteadmin?r+="Beheerder":r+=0!=(2&t)?"Beheerder":"Gedeeltelijk",null!=e.siteadmin&&4294967295!=e.siteadmin&&0!=(1216&e.siteadmin)&&(r+="*"),r+="</span>",i&&(r+="</a>"),0);if(e.links)for(var d in e.links)d.startsWith("mesh/")&&l++;var t=EscapeHtml(e.name),i="";return 1==serverinfo.emailcheck&&(i=1!=e.emailVerified?' <b style=color:red title="E-mail is niet geverifieerd">&#x2717;</b>':' <b style=color:green title="Email is geverifieerd">&#x2713</b>'),null!=e.email&&(0==(2097152&features)||e.email.toLowerCase()!=e.name.toLowerCase()?t+=', <a href="mailto:'+EscapeHtml(e.email)+'">'+EscapeHtml(e.email)+"</a>"+i:t+=' <a href="mailto:'+EscapeHtml(e.email)+'"><img src="images/mail12.png" height=9 width=12 title="Stuur e-mail naar de gebruiker" style="margin-top:2px" /></a>'+i),null!=serverinfo.crossDomain&&""!=(i=e._id.split("/")[1])&&(t+=", <span style=color:#26F>"+i+"</span>"),(0<e.otpsecret||0<e.otphkeys||1==e.otpekey&&8388608&features||1==e.otpduo||null!=e.phone&&67108864&features)&&(t+=' <i class="fa-solid fa-key" title="Tweestapsverificatie ingeschakeld" style="margin-top:2px"></i>'),null!=e.phone&&(t+=' <i class="fa-solid fa-mobile-screen" title="Geverifieerd telefoonnummer" style="margin-top:2px"></i>'),null!=e.siteadmin&&0!=(32&e.siteadmin)&&4294967295!=e.siteadmin&&(t+=' <img src="images/padlock12.png" height=12 width=8 title="Account is uitgeschakeld" style="margin-top:2px" />'),null!=e.msghandle&&33554432&features2&&(t+=' <i class="fa-solid fa-comment fa-xs" title="Geverifieerd berichtenaccount" style="margin-top:2px" />'),n+("<tr tabindex=0 onkeypress=\"if (event.key=='Enter') gotoUser('"+encodeURIComponentEx(e._id)+"')\"><td>")+"<div>"+('<div class=baricon><input class="UserCheckbox form-check-input me-2" value='+encodeURIComponentEx(e._id)+" onclick=p3updateInfo() type=checkbox"+(e._id==userinfo._id?" disabled":"")+'></div><div style=cursor:pointer onclick=gotoUser("'+encodeURIComponentEx(e._id)+'",false,event)>')+('<div class=baricon><i class="fa-fw fa-solid fa-user '+o+'"></i></div>')+"<div>"+("<div><span style=line-height:24px>"+t+"</span>"+a+"</div></div><td style=text-align:center>"+l+"<td style=text-align:center>"+s+"<td style=text-align:center>"+r)}function p3updateInfo(){for(var e=document.getElementsByClassName("UserCheckbox"),t=0,n=0;n<e.length;n++)!0===e[n].checked&&t++;QE("UsersGroupActionButton",0<t),Q("UsersSelectAllButton").value=0<t?"Selecteer niets":"Selecteer alles"}function p3usersSelectallButtonFunction(){for(var e=encodeURIComponentEx(userinfo._id),t=document.getElementsByClassName("UserCheckbox"),n=0,o=0;o<t.length;o++)!0===t[o].checked&&n++;for(o=0;o<t.length;o++)t[o].checked=0==n&&t[o].value!=e;p3updateInfo()}function p3usersGroupActionFunction(){for(var e,t,n=document.getElementsByClassName("UserCheckbox"),o=0,a=0;a<n.length;a++)!0===n[a].checked&&o++;0!=o&&(e="",serverinfo.emailcheck&&(e+="<option value=4>E-mail valideren</option><option value=5>E-mail ongeldig maken</option>"),t="Selecteer een bewerking die u op alle geselecteerde gebruikers wilt uitvoeren.<br /><br />",setModalContent("xxAddAgent","Groepsactie",t+=addHtmlFormFloating("Operatie","<select id=d3groupop class=form-select><option value=1>Account vergrendelen</option><option value=2>Account ontgrendelen</option>"+e+"<option value=3>Verwijder account</option></select>")),showModal("xxAddAgentModal","idx_dlgOkButton",p3usersGroupActionFunctionEx))}function p3usersGroupActionFunctionEx(){for(var e=document.getElementsByClassName("UserCheckbox"),t=[],n=0;n<e.length;n++)!0===e[n].checked&&t.push(decodeURIComponent(e[n].value));var o,a,i=Q("d3groupop").value;if(1==i)for(var n in t)0==(32&(o=null==(a=users[t[n]]).siteadmin?0:a.siteadmin))&&(o+=32,meshserver.send({action:"edituser",id:a._id,siteadmin:o}));else if(2==i)for(var n in t)0!=(32&(o=null==(a=users[t[n]]).siteadmin?0:a.siteadmin))&&(o-=32,meshserver.send({action:"edituser",id:a._id,siteadmin:o}));else if(3==i)QE("idx_dlgOkButton",!1);else if(4==i)for(var n in t)!0!==(a=users[t[n]]).emailVerified&&meshserver.send({action:"edituser",id:a._id,emailVerified:!0});else if(5==i)for(var n in t)!0===(a=users[t[n]]).emailVerified&&meshserver.send({action:"edituser",id:a._id,emailVerified:!1})}function p3usersGroupActionFunctionDelCheck(){QE("idx_dlgOkButton",Q("d3check").checked)}function p3groupActionFunctionDelExec(e){for(var t=document.getElementsByClassName("UserCheckbox"),n=[],o=0;o<t.length;o++)!0===t[o].checked&&n.push(decodeURIComponent(t[o].value));for(o in n){var a=users[n[o]];meshserver.send({action:"deleteuser",userid:a._id,username:a.name})}}function userMouseHover(e,t){var n=e.children[0].children[0].children[1];n.children[1].classList.remove("g1s"),n.children[2].classList.remove("g2s"),e.children[0].children[0].classList.remove("sbar"),1==t&&(n.children[1].classList.add("g1s"),n.children[2].classList.add("g2s"),e.children[0].children[0].classList.add("sbar"))}function userMouseHover2(e,t){var n=e.children[0].children[0];n.children[2].classList.remove("g1s"),n.children[3].classList.remove("g2s"),e.children[0].children[0].classList.remove("sbar"),1==t&&(n.children[2].classList.add("g1s"),n.children[3].classList.add("g2s"),e.children[0].children[0].classList.add("sbar"))}function userChat(e,t,n){if(!xxdialogMode)return haltEvent(e),e="/messenger?id=meshmessenger/"+t+"/"+encodeURIComponentEx(userinfo._id)+"&title="+n,null!=authCookie&&""!=authCookie&&(e+="&auth="+authCookie),urlargs.key&&(e+="&key="+urlargs.key),safeNewWindow(e,"meshmessenger:"+t),meshserver.send({action:"meshmessenger",userid:decodeURIComponent(t)}),!1}function altUserChat(e,t,n,o){var a,i,s,r,l;if(!xxdialogMode)return haltEvent(e),e=serverinfo.altmessenging[o].url,s=a=encodeURIComponentEx((l=decodeURIComponent(t)).split("/")[2]),r=i=encodeURIComponentEx(l.split("/").join("-")),null!=(l=users[l])&&null!=l.realname&&(s=encodeURIComponentEx(l.realname.split(" ").join("")),r=encodeURIComponentEx(l.realname.split(" ").join("-"))),e=e.split("{0}").join(a).split("{1}").join(i).split("{2}").join(s).split("{3}").join(r),urlargs.key&&(e+="&key="+urlargs.key),safeNewWindow(e,"altmessenger:"+t),meshserver.send({action:"notifyuser",userid:decodeURIComponent(t),msg:serverinfo.altmessenging[o].name,msgid:11,url:e}),!1}function showSendSMS(e){xxdialogMode||(setModalContent("xxAddAgent","verstuur SMS","<textarea id=d2smsText maxlength=160 style=width:100%;height:100px;resize:none onKeyUp=showSendSMSValidate()></textarea><span style=font-size:10px><span>"),showModal("xxAddAgentModal","idx_dlgOkButton",()=>showSendSMSEx(3,e)),Q("d2smsText").focus(),showSendSMSValidate())}function showSendSMSValidate(){QE("idx_dlgOkButton",0<Q("d2smsText").value.length)}function showSendSMSEx(e,t){0<Q("d2smsText").value.length&&meshserver.send({action:"smsuser",userid:decodeURIComponent(t),msg:Q("d2smsText").value})}function showSendMessage(e){xxdialogMode||(setModalContent("xxAddAgent","Bericht versturen","<textarea id=d2smsText maxlength=160 style=width:100%;height:100px;resize:none onKeyUp=showSendSMSValidate()></textarea><span style=font-size:10px><span>"),showModal("xxAddAgentModal","idx_dlgOkButton",()=>showSendMessageEx(3,e)),Q("d2smsText").focus(),showSendSMSValidate())}function showSendMessageEx(e,t){0<Q("d2smsText").value.length&&meshserver.send({action:"msguser",userid:decodeURIComponent(t),msg:Q("d2smsText").value})}function showSendEmail(e){xxdialogMode||(setModalContent("xxAddAgent","E-mail verzenden",'<input id=d2emailSubject style=width:100% placeholder="Onderwerp"></input><textarea id=d2emailText maxlength=10000 style="width:100%;height:200px;resize:none;overflow-y:auto" onKeyUp=showSendEmailValidate()></textarea>'),showModal("xxAddAgentModal","idx_dlgOkButton",()=>showSendEmailEx(3,e)),Q("d2emailSubject").focus(),showSendEmailValidate())}function showSendEmailValidate(){QE("idx_dlgOkButton",0<Q("d2emailSubject").value.length&&0<Q("d2emailText").value.length)}function showSendEmailEx(e,t){0<Q("d2emailText").value.length&&meshserver.send({action:"emailuser",userid:decodeURIComponent(t),subject:Q("d2emailSubject").value,msg:Q("d2emailText").value})}function showUserAlertDialog(e,t){if(!xxdialogMode)return haltEvent(e),setModalContent("xxAddAgent",format("Melden {0}",EscapeHtml(users[decodeURIComponent(t)].name)),'<div style=margin-bottom:6px>Stuur een tekstbericht naar deze gebruiker.</div><textarea id=d2notifyText maxlength=2048 style="width:100%;height:184px;resize:none"></textarea><select style=width:100% id=broadcastMessageMaxTime><option value=0>Toon bericht totdat het door de gebruiker wordt afgewezen</option><option value=10>Toon gedurende 10 seconden</option><option value=60>Toon gedurende 1 minuut</option><option value=300>Toon gedurende 5 minuten</option></select>'),showModal("xxAddAgentModal","idx_dlgOkButton",()=>showUserAlertDialogEx(3,t)),Q("d2notifyText").focus(),!1}function showUserAlertDialogEx(e,t){meshserver.send({action:"notifyuser",userid:decodeURIComponent(t),msg:Q("d2notifyText").value,maxtime:parseInt(Q("broadcastMessageMaxTime").value)})}function onUsersViewSettings(){var e;xxdialogMode||(e="",setModalContent("xxAddAgent","Kijkende gebruikers",e+='<label><input id=d2c1 type=checkbox class="form-check-input me-2"'+((userViewSettings=null==userViewSettings?{}:userViewSettings).noViewLimit?"":" checked")+">Alleen de eerste 100 gebruikers weergeven</label><br />"),showModal("xxAddAgentModal","idx_dlgOkButton",onUsersViewSettingsEx))}function onUsersViewSettingsEx(){userViewSettings.noViewLimit=!Q("d2c1").checked,putstore("_usersViewSettings",JSON.stringify(userViewSettings)),mainUpdate(16384)}function p4batchAccountCreate(){xxdialogMode||(setModalContent("xxAddAgent","Gebruikersaccount importeren",'Maak meerdere accounts tegelijk aan door een JSON of een CSV bestand te importeren<br /><br />Het JSON bestandsformaat is als volgt:<br /><pre>[\r\n {"user":"x1","pass":"x","email":"x1@x"},\r\n {"user":"x2","pass":"x","resetNextLogin":true}\r\n]</pre><br />Het CSV bestandsformaat is als volgt:<br /><pre>user,pass,email,resetNextLogin\r\nx1,x,x1@x,\r\nx2,x,,true\r\n</pre><br /><input type=file id=d4importFile class="form-control" accept=".json,.csv" onchange=p4batchAccountCreateValidate() />'),showModal("xxAddAgentModal","idx_dlgOkButton",p4batchAccountCreateEx))}function p4batchAccountCreateValidate(){QE("idx_dlgOkButton",null!=Q("d4importFile").value)}function p4batchAccountCreateEx(){var e=new FileReader;e.onload=function(e){var t=null;if(Q("d4importFile").value.endsWith(".csv")){var n=e.target.result.split("\n"),o=n[0].trim().split(","),a=[];for(let e=1;e<n.length;e++){var i=n[e].trim();if(""!==i){var s=i.split(",");let t=!1;for(let e=0;e<s.length;e++)if(""!==s[e].trim()){t=!0;break}if(t){var r={};for(let e=0;e<o.length;e++){var l=s[e].trim();""!==o[e].trim()&&""!==l&&(r[o[e]]="waar"===l.toLowerCase()||l)}a.push(r)}}}if(null!=(t=a)&&Array.isArray(t)){var d=!0;for(c in t)("string"!=typeof t[c].user||t[c].user.length<1||64<t[c].user.length)&&(d=!1),("string"!=typeof t[c].pass||t[c].pass.length<1||256<t[c].pass.length)&&(d=!1),0==checkPasswordRequirements(t[c].pass,passRequirements)&&(d=!1),null!=t[c].email&&("string"!=typeof t[c].email||t[c].email.length<1||128<t[c].email.length)&&(d=!1);0==d?setModalContent("xxAddAgent","Gebruikersaccount importeren","Ongeldig CSV bestandsformaat."):meshserver.send({action:"adduserbatch",users:t})}else setModalContent("xxAddAgent","Gebruikersaccount importeren","Ongeldig CSV bestandsformaat.")}else{try{t=JSON.parse(e.target.result)}catch(e){return setModalContent("xxAddAgent","Gebruikersaccount importeren",format("Ongeldig JSON-bestand: {0}.",e)),void showModal("xxAddAgentModal","idx_dlgOkButton")}if(null!=t&&Array.isArray(t)){var c,d=!0;for(c in t)("string"!=typeof t[c].user||t[c].user.length<1||64<t[c].user.length)&&(d=!1),("string"!=typeof t[c].pass||t[c].pass.length<1||256<t[c].pass.length)&&(d=!1),0==checkPasswordRequirements(t[c].pass,passRequirements)&&(d=!1),null!=t[c].email&&("string"!=typeof t[c].email||t[c].email.length<1||128<t[c].email.length)&&(d=!1);0==d?setModalContent("xxAddAgent","Gebruikersaccount importeren","Ongeldige JSON-bestandsindeling."):meshserver.send({action:"adduserbatch",users:t})}else setModalContent("xxAddAgent","Gebruikersaccount importeren","Ongeldige JSON-bestandsindeling.");showModal("xxAddAgentModal","idx_dlgOkButton")}},e.readAsText(Q("d4importFile").files[0])}function p4downloadUserInfo(){var e;xxdialogMode||(e="Download de lijst met gebruikers in een van de onderstaande bestandsindelingen.<br /><br />",setModalContent("xxAddAgent","Gebruikerslijst exporteren",e=(e+=addHtmlValue("CSV Formaat","<a href=# style=cursor:pointer onclick='return p4downloadUserInfoCSV()'>userlist.csv</a>"))+addHtmlValue("JSON-indeling","<a href=# style=cursor:pointer onclick='return p4downloadUserInfoJSON()'>userlist.json</a>")),showModal("xxAddAgentModal","idx_dlgOkButton"))}function p4downloadUserInfoCSV(){var e,t="id,naam,email,aangemaakt,laaste login,groeps,authfactors,siteadmin,useradmin,geblokkeerd\r\n";for(e in users){var n=!1,o=[];(0<users[e].otpsecret||0<users[e].otphkeys)&&(n=!0,0<users[e].otpsecret&&o.push("AuthApp"),0<users[e].otphkeys&&o.push("SecurityKey"),0<users[e].otpkeys)&&o.push("BackupCodes"),t=(t=(t=(t+='"'+users[e]._id+'","'+users[e].name+'","'+(users[e].email||"")+'","'+(users[e].creation?new Date(1e3*users[e].creation):"")+'","'+(users[e].login?new Date(1e3*users[e].login):"")+'","'+(users[e].groups?users[e].groups.join(","):"")+'","'+(n?o.join(","):"")+'"')+(","+(4294967295==users[e].siteadmin?"1":"0")))+(","+(0!=(2&users[e].siteadmin)?"1":"0")))+(","+(0!=(32&users[e].siteadmin)?"1":"0"))+"\r\n"}return saveAs(stringToUtf8Blob(t),"userlist.csv"),!1}function p4downloadUserInfoJSON(){var e,t=[];for(e in users)t.push(users[e]);return saveAs(new Blob([JSON.stringify(t,null,2)],{type:"application/octet-stream"}),"userlist.json"),!1}function showUserBroadcastDialog(e){xxdialogMode||(setModalContent("xxAddAgent","Bericht uitzenden",'<div style=margin-bottom:6px>Verzend een bericht naar alle verbonden gebruikers.</div><textarea id=broadcastMessage class="form-control mb-2" style="width:100%;height:184px;resize:none" value="" maxlength=2048 /></textarea><select style=width:100% class="form-select" id=broadcastMessageMaxTime><option value=0>Toon bericht totdat het door de gebruiker wordt afgewezen</option><option value=10>Toon gedurende 10 seconden</option><option value=60>Toon gedurende 1 minuut</option><option value=300>Toon gedurende 5 minuten</option></select>'),showModal("xxAddAgentModal","idx_dlgOkButton",function(){showUserBroadcastDialogEx(3,e?decodeURIComponent(e):null)}),Q("broadcastMessage").focus())}function showUserBroadcastDialogEx(e,t){meshserver.send({action:"userbroadcast",msg:Q("broadcastMessage").value,target:t,maxtime:parseInt(Q("broadcastMessageMaxTime").value)})}function showCreateNewAccountDialog(){if(!xxdialogMode){var e="";if(serverinfo.crossDomain){var t='<select class="form-select" id=p4domain>';for(n in serverinfo.crossDomain)t+="<option value="+n+">"+(""==serverinfo.crossDomain[n]?"Standaard":EscapeHtml(serverinfo.crossDomain[n]))+"</option>";e+=addHtmlFormFloating("Domein",t+="</select>")}if(0==(2097152&features)&&(e+=addHtmlFormFloating("<span id=p4hname>Gebruikersnaam</span>",'<input id=p4name class="form-control" maxlength=64 autocomplete=username onchange=showCreateNewAccountDialogValidate() onkeyup=showCreateNewAccountDialogValidate() />')),e=(e=(e=(e=e+addHtmlFormFloating("<span id=p4hemail>E-mail",'<input id=p4email type=email class="form-control" maxlength=256 autocomplete="email" inputmode="email" onchange=showCreateNewAccountDialogValidate() onkeyup=showCreateNewAccountDialogValidate() />')+"")+addHtmlFormFloating("<span id=p4hp1>Wachtwoord</span>",'<input id=p4pass1 type=password class="form-control" maxlength=256 autocomplete="new-password" onchange=showCreateNewAccountDialogValidate() onkeyup=showCreateNewAccountDialogValidate() />'))+addHtmlFormFloating("<span id=p4hp2>Bevestig wachtwoord</span>",'<input id=p4pass2 type=password class="form-control" maxlength=256 autocomplete="new-password" onchange=showCreateNewAccountDialogValidate() onkeyup=showCreateNewAccountDialogValidate() />')+'<div><label><input id=p4randomPassword onchange=showCreateNewAccountDialogValidate() type=checkbox class="form-check-input me-2" />Randomiseer het wachtwoord.</label></div>')+'<div><label><input id=p4removeEvents onchange=showCreateNewAccountDialogValidate() type=checkbox class="form-check-input me-2" />Verwijder alle eerdere gebeurtenissen voor dit gebruikers-ID.</label></div>'+'<div><label><input id=p4resetNextLogin onchange=showCreateNewAccountDialogValidate() type=checkbox class="form-check-input me-2" />Forceer wachtwoord wijziging bij de volgende aanmelding.</label></div>',serverinfo.emailcheck&&(e+='<div><label><input id=p4verifiedEmail onchange=showCreateNewAccountDialogValidate() type=checkbox class="form-check-input me-2" />E-mail is geverifieerd.</label></div><div><label><input id=p4invitationEmail type=checkbox class="form-check-input me-2" title=E-mail geverifieerd en geforceerd opnieuw instellen van wachtwoord vereist. />Verzend uitnodigingsmail.</label></div>'),passRequirements){var n,o=[],a=0;for(n in passRequirements)"reset"!=n&&"hint"!=n&&(o.push(n+":"+passRequirements[n]),a++);0<a&&(e+="<div style=font-size:x-small;padding:6px>"+format("Vereisten: {0}.",o.join(", "))+"</div>")}setModalContent("xxAddAgent","Account aanmaken",e),showModal("xxAddAgentModal","idx_dlgOkButton",showCreateNewAccountDialogEx),showCreateNewAccountDialogValidate(),(0==(2097152&features)?Q("p4name"):Q("p4email")).focus()}}function showCreateNewAccountDialogValidate(){var e=validateEmail(Q("p4email").value),t=!0,n=0<Q("p4pass1").value.length&&Q("p4pass1").value==Q("p4pass2").value&&checkPasswordRequirements(Q("p4pass1").value,passRequirements),t=(0==(2097152&features)&&(t=!Q("p4name")||0<Q("p4name").value.length&&-1==Q("p4name").value.indexOf(" "),QS("p4hname").color=t?"black":"#7b241c"),QS("p4hemail").color=e?"black":"#7b241c",serverinfo.emailcheck&&(QE("p4verifiedEmail",e),QE("p4invitationEmail",e&&Q("p4resetNextLogin").checked&&Q("p4verifiedEmail").checked),0==e&&(Q("p4verifiedEmail").checked=!1),0!=Q("p4resetNextLogin").checked&&0!=Q("p4verifiedEmail").checked||(Q("p4invitationEmail").checked=!1)),QE("p4pass1",!Q("p4randomPassword").checked),QE("p4pass2",!Q("p4randomPassword").checked),QS("p4hp1").color=n||Q("p4randomPassword").checked?"black":"#7b241c",QS("p4hp2").color=n||Q("p4randomPassword").checked?"black":"#7b241c",t&e);0==Q("p4randomPassword").checked&&(t&=n),QE("idx_dlgOkButton",t)}function showCreateNewAccountDialogEx(){var e={action:"adduser",username:(0==(2097152&features)?Q("p4name"):Q("p4email")).value,email:Q("p4email").value,pass:Q("p4pass1").value,resetNextLogin:Q("p4resetNextLogin").checked,randomPassword:Q("p4randomPassword").checked,removeEvents:Q("p4removeEvents").checked};serverinfo.emailcheck&&(e.emailVerified=Q("p4verifiedEmail").checked,e.emailInvitation=Q("p4invitationEmail").checked),serverinfo.crossDomain&&(e.domain=serverinfo.crossDomain[parseInt(Q("p4domain").value)]),meshserver.send(e)}function showUserGroupDialog(e,t){var n,o,a;if(!xxdialogMode)return haltEvent(e),t=decodeURIComponent(t),o="",a="Voer een door komma's gescheiden lijst met beheerdersnamen in.<br /><br />",setModalContent("xxAddAgent","Administratieve gebieden",a+=`<div class="form-floating mb-2"><input id=dp4usergroups value="${o=null!=(n=users[t.toLowerCase()]).groups?n.groups.join(", "):o}" class="form-control" placeholder="Name1, Name2, Name3" maxlength=256 onchange=p4validateUserGroups() onkeyup=p4validateUserGroups() /><label for=dp4usergroups>Realms</label></div>`),showModal("xxAddAgentModal","idx_dlgOkButton",function(){showUserGroupDialogEx(e,n)}),focusTextBox("dp4usergroups"),p4validateUserGroups(),!1}function p4validateUserGroups(){var e,t=Q("dp4usergroups").value,n=0,o=t.indexOf('"')+t.indexOf("/")+t.indexOf(">")+t.indexOf("<")+t.indexOf("'"),a=t.split(",");for(e in a)0==a[e].trim().length&&n++;QE("idx_dlgOkButton",""==t||-5==o&&n<1)}function showUserGroupDialogEx(e,t){var n,o=Q("dp4usergroups").value.split(","),a=[];for(n in o){var i=o[n].trim();0<i.length&&a.push(i)}meshserver.send({action:"edituser",id:t._id,groups:a})}function showUserAdminDialog(e,t){if(!xxdialogMode){haltEvent(e),t=decodeURIComponent(t);var n,o=users[t];if(null!=o)return n=userinfo._id==o._id,(e="")!=(e=(e=(e=(e=(e+='<div class="d-inline-flex align-items-center"><label class="form-label me-2"><input type=checkbox onchange=showUserAdminDialogValidate() class="form-check-input me-2" id=ua_fileaccess>Serverbestanden</label>, <input type=number class="me-1 form-control" onchange=showUserAdminDialogValidate() maxlength=10 id=ua_fileaccessquota>k max, blank voor standaard</div><br><hr/>')+'<label><input type=checkbox onchange=showUserAdminDialogValidate() class="form-check-input me-2" id=ua_fulladmin>Volledige beheerder</label><br>'+'<label><input type=checkbox onchange=showUserAdminDialogValidate() class="form-check-input me-2" id=ua_serverbackup>Server Back-up</label><br>')+'<label><input type=checkbox onchange=showUserAdminDialogValidate() class="form-check-input me-2" id=ua_serverrestore>Server herstellen</label><br>'+'<label><input type=checkbox onchange=showUserAdminDialogValidate() class="form-check-input me-2" id=ua_serverupdate>Serverupdates</label><br></div>')+'<div id=d2MngUsr><label><input type=checkbox onchange=showUserAdminDialogValidate() class="form-check-input me-2" id=ua_manageusers>Beheer gebruikers</label><br></div>'+'<div id=d2MngGrp><label><input type=checkbox onchange=showUserAdminDialogValidate() class="form-check-input me-2" id=ua_manageusergroups>Beheer gebruikersgroepen.</label><br></div>')+'<div id=d2MngRec><label><input type=checkbox onchange=showUserAdminDialogValidate() class="form-check-input me-2" id=ua_managerecordings>Beheeer opnames</label><br></div>'+'<div id=d2AllEvnt><label><input type=checkbox onchange=showUserAdminDialogValidate() class="form-check-input me-2" id=ua_allevents>Bekijk alle gebeurtenissen</label><br></div>')&&(e+="<hr/>"),setModalContent("xxAddAgent","Serverrechten",e=(e=(e=(e="<div><div id=d2AdminPermissions>"+e)+'<label><input type=checkbox onchange=showUserAdminDialogValidate() class="form-check-input me-2" id=ua_lockedaccount>Account vergrendelen</label><br>'+'<label><input type=checkbox onchange=showUserAdminDialogValidate() class="form-check-input me-2" id=ua_nonewgroups>Geen nieuwe apparaatgroepen</label><br>')+'<label><input type=checkbox onchange=showUserAdminDialogValidate() class="form-check-input me-2" id=ua_nonewdevices>Geen nieuwe apparaten</label><br>'+'<label><input type=checkbox onchange=showUserAdminDialogValidate() class="form-check-input me-2" id=ua_nomeshcmd>Geen Tools (MeshCmd/Router)</label><br>')+'<label><input type=checkbox onchange=showUserAdminDialogValidate() class="form-check-input me-2" id=ua_locksettings>Vergrendel accountinstellingen</label><br>'+"</div>"),showModal("xxAddAgentModal","idx_dlgOkButton",function(){showUserAdminDialogEx(2+(n?0:1),o)}),o.siteadmin&&0!=o.siteadmin&&(Q("ua_fulladmin").checked=4294967295==o.siteadmin,Q("ua_serverbackup").checked=4294967295!=o.siteadmin&&0!=(1&o.siteadmin),Q("ua_serverrestore").checked=4294967295!=o.siteadmin&&0!=(4&o.siteadmin),Q("ua_fileaccess").checked=4294967295!=o.siteadmin&&0!=(8&o.siteadmin),Q("ua_serverupdate").checked=4294967295!=o.siteadmin&&0!=(16&o.siteadmin),Q("ua_lockedaccount").checked=4294967295!=o.siteadmin&&0!=(32&o.siteadmin),Q("ua_nonewgroups").checked=4294967295!=o.siteadmin&&0!=(64&o.siteadmin),Q("ua_nomeshcmd").checked=4294967295!=o.siteadmin&&0!=(128&o.siteadmin),Q("ua_locksettings").checked=4294967295!=o.siteadmin&&0!=(1024&o.siteadmin),Q("ua_nonewdevices").checked=4294967295!=o.siteadmin&&0!=(4096&o.siteadmin)),0!=(2&userinfo.siteadmin)&&(Q("ua_manageusers").checked=4294967295!=o.siteadmin&&0!=(2&o.siteadmin),QE("ua_manageusers",!n&&2&userinfo.siteadmin)),0!=(256&userinfo.siteadmin)&&(Q("ua_manageusergroups").checked=4294967295!=o.siteadmin&&0!=(256&o.siteadmin),QE("ua_manageusergroups",!n&&256&userinfo.siteadmin)),0!=(512&userinfo.siteadmin)&&(Q("ua_managerecordings").checked=4294967295!=o.siteadmin&&0!=(512&o.siteadmin),QE("ua_managerecordings",!n&&512&userinfo.siteadmin)),0!=(2048&userinfo.siteadmin)&&(Q("ua_allevents").checked=4294967295!=o.siteadmin&&0!=(2048&o.siteadmin),QE("ua_allevents",!n&&2048&userinfo.siteadmin)),QE("ua_fulladmin",!n&&4294967295==userinfo.siteadmin),QE("ua_serverbackup",!n&&4294967295==userinfo.siteadmin),QE("ua_serverrestore",!n&&4294967295==userinfo.siteadmin),QE("ua_fileaccess",!n&&4294967295==userinfo.siteadmin),QE("ua_fileaccessquota",!n&&4294967295==userinfo.siteadmin),QE("ua_serverupdate",!n&&4294967295==userinfo.siteadmin),QV("d2AdminPermissions",4294967295==userinfo.siteadmin),QV("d2MngUsr",0!=(2&userinfo.siteadmin)),QV("d2MngGrp",0!=(256&userinfo.siteadmin)),QV("d2MngRec",0!=(512&userinfo.siteadmin)),QE("ua_lockedaccount",!n&&2&userinfo.siteadmin&&4294967295!=o.siteadmin&&userinfo._id!=o._id),QE("ua_nonewgroups",!n&&2&userinfo.siteadmin&&4294967295!=o.siteadmin&&userinfo._id!=o._id),QE("ua_nomeshcmd",!n&&2&userinfo.siteadmin&&4294967295!=o.siteadmin&&userinfo._id!=o._id),QE("ua_nonewdevices",!n&&2&userinfo.siteadmin&&4294967295!=o.siteadmin&&userinfo._id!=o._id),QE("ua_locksettings",!n&&2&userinfo.siteadmin&&4294967295!=o.siteadmin&&userinfo._id!=o._id),Q("ua_fileaccessquota").value=null!=o.quota?o.quota/1024:"",showUserAdminDialogValidate(),!1}}function showUserAdminDialogValidate(){4294967295==userinfo.siteadmin&&(QE("ua_serverbackup",!Q("ua_fulladmin").checked),QE("ua_manageusers",!Q("ua_fulladmin").checked),QE("ua_serverrestore",!Q("ua_fulladmin").checked),QE("ua_fileaccess",!Q("ua_fulladmin").checked),QE("ua_serverupdate",!Q("ua_fulladmin").checked),QE("ua_lockedaccount",!Q("ua_fulladmin").checked),QE("ua_nonewgroups",!Q("ua_fulladmin").checked),QE("ua_nomeshcmd",!Q("ua_fulladmin").checked),QE("ua_nonewdevices",!Q("ua_fulladmin").checked),QE("ua_manageusergroups",!Q("ua_fulladmin").checked),QE("ua_managerecordings",!Q("ua_fulladmin").checked),QE("ua_allevents",!Q("ua_fulladmin").checked),QE("ua_locksettings",!Q("ua_fulladmin").checked),QE("ua_fileaccessquota",Q("ua_fileaccess").checked&&!Q("ua_fulladmin").checked))}function showUserAdminDialogEx(e,t){var n=0,o=parseInt(Q("ua_fileaccessquota").value),t=(1==Q("ua_fulladmin").checked?n=4294967295:(1==Q("ua_serverbackup").checked&&(n+=1),1==Q("ua_manageusers").checked&&(n+=2),1==Q("ua_serverrestore").checked&&(n+=4),1==Q("ua_fileaccess").checked&&(n+=8),1==Q("ua_serverupdate").checked&&(n+=16),1==Q("ua_lockedaccount").checked&&(n+=32),1==Q("ua_nonewgroups").checked&&(n+=64),1==Q("ua_nomeshcmd").checked&&(n+=128),1==Q("ua_manageusergroups").checked&&(n+=256),1==Q("ua_managerecordings").checked&&(n+=512),1==Q("ua_locksettings").checked&&(n+=1024),1==Q("ua_allevents").checked&&(n+=2048),1==Q("ua_nonewdevices").checked&&(n+=4096)),{action:"edituser",id:t._id,siteadmin:n});0==isNaN(o)&&(t.quota=1024*o),meshserver.send(t)}function onUserSearchInputChanged(){mainUpdate(16384)}function updateUserGroups(){QV("p50userGroupOps",0!=(256&userinfo.siteadmin));var e=[],t="";if(usergroups)for(var n in usergroups)e.push(usergroups[n]);e.sort(nameSort);for(var o=[],a=document.getElementsByClassName("UserGroupCheckbox"),n=0;n<a.length;n++)a[n].checked&&o.push(a[n].value);if(0==e.length)t+="<br />Geen groepen gevonden.<br />",QV("DuplicateUserGroupButton",!1);else{for(var n in t=t+'<table class="table table-hover p3usersTable" cellpadding=0 cellspacing=0>'+"<th>Naam<th style=width:80px>Gebruikers<th style=width:80px>Apparaatgroepen<th style=width:80px>Apparaten",e)t+=addUserGroupHtml(e[n]);t+="</table>",QV("DuplicateUserGroupButton",!0)}QH("p50groups",t);for(a=document.getElementsByClassName("UserGroupCheckbox"),n=0;n<a.length;n++)a[n].checked=0<=o.indexOf(a[n].value);p50updateInfo(),null!=currentUserGroup&&51==xxcurrentView&&gotoUserGroup(encodeURIComponentEx(currentUserGroup._id),!0)}function addUserGroupHtml(e){var t=0,n=0,o=0;if(e.links)for(var a in e.links)a.startsWith("user/")&&t++,a.startsWith("mesh/")&&n++,a.startsWith("node/")&&o++;var i=EscapeHtml(e.name),s=(null!=serverinfo.crossDomain&&""!=(s=e._id.split("/")[1])&&(i+=", <span style=color:#26F>"+EscapeHtml(s)+"</span>"),"<tr tabindex=0 onkeypress=\"if (event.key=='Enter') gotoUserGroup('"+encodeURIComponentEx(e._id)+"')\"><td style=cursor:pointer>");return(s+="<div style=width:100%>")+('<div class=baricon><input class="form-check-input me-2 UserGroupCheckbox" value='+encodeURIComponentEx(e._id)+" onclick=p50updateInfo() type=checkbox></div>")+('<div class=baricon onclick=gotoUserGroup("'+encodeURIComponentEx(e._id)+'")><i class="fa-solid fa-users"></i></div>')+('<div onclick=gotoUserGroup("'+encodeURIComponentEx(e._id)+'")></div><div onclick=gotoUserGroup("'+encodeURIComponentEx(e._id)+'")></div>')+('<div style=line-height:24px onclick=gotoUserGroup("'+encodeURIComponentEx(e._id)+'")><span style=font-size:16px>'+i+"</span></div></div><td style=text-align:center>"+t+"<td style=text-align:center>"+n+"<td style=text-align:center>"+o)}function p50updateInfo(){for(var e=document.getElementsByClassName("UserGroupCheckbox"),t=0,n=0;n<e.length;n++)!0===e[n].checked&&t++;QE("UsersGroupsGroupActionButton",0<t),Q("UsersGroupsSelectAllButton").value=0<t?"Selecteer niets":"Selecteer alles"}function p50usersSelectallButtonFunction(){for(var e=encodeURIComponentEx(userinfo._id),t=document.getElementsByClassName("UserGroupCheckbox"),n=0,o=0;o<t.length;o++)!0===t[o].checked&&n++;for(o=0;o<t.length;o++)t[o].checked=0==n&&t[o].value!=e;p50updateInfo()}function p50usersGroupActionFunction(){for(var e,t=document.getElementsByClassName("UserGroupCheckbox"),n=0,o=0;o<t.length;o++)!0===t[o].checked&&n++;0!=n&&(e="Selecteer een bewerking die u op alle geselecteerde gebruikers wilt uitvoeren.<br /><br />",e+=addHtmlFormFloating("Operatie","<select id=d50groupop class=form-select><option value=1>Verwijder groep</option></select>"),xxdialogButtons=3,setModalContent("xxAddAgent","Groepsactie",e),showModal("xxAddAgentModal","idx_dlgOkButton",p50usersGroupActionFunctionEx))}function p50usersGroupActionFunctionEx(){for(var e=document.getElementsByClassName("UserGroupCheckbox"),t=[],n=0;n<e.length;n++)!0===e[n].checked&&t.push(decodeURIComponent(e[n].value));1==Q("d50groupop").value&&(setModalContent("xxAddAgent","Gebruikersgroepen verwijderen",'Bevestig verwijdering geselecteerde gebruikersgroep(en)?<br /><br /><label><input id=d3check type=checkbox class="form-check-input me-2" onchange=p50usersGroupActionFunctionDelCheck() />Bevestig</label>'),document.getElementById("idx_dlgOkButton").onclick=function(){p50groupActionFunctionDelExec(3)})}function p50usersGroupActionFunctionDelCheck(){QE("idx_dlgOkButton",Q("d3check").checked)}function p50groupActionFunctionDelExec(e){for(var t=document.getElementsByClassName("UserGroupCheckbox"),n=0;n<t.length;n++)!0===t[n].checked&&meshserver.send({action:"deleteusergroup",ugrpid:decodeURIComponent(t[n].value)})}function showCreateUserGroupDialog(e){if(!xxdialogMode){var t="",n="";if(2==e){if(usergroups)for(var o in usergroups)n+="<option value="+encodeURIComponentEx(o)+">"+EscapeHtml(usergroups[o].name)+"</option>";t+=addHtmlFormFloating("Gebruikers Groep",'<select id=dp4groupid class="form-select">'+n+"</select>")}if(1==e&&serverinfo.crossDomain){n='<select id=p4domain class="form-select">';for(o in serverinfo.crossDomain)n+="<option value="+o+">"+(""==serverinfo.crossDomain[o]?"Standaard":EscapeHtml(serverinfo.crossDomain[o]))+"</option>";t+=addHtmlFormFloating("Domein",n+="</select>")}t=(t+=addHtmlFormFloating("Naam","<input id=p4name class=form-control maxlength=64 onchange=showCreateUserGroupDialogValidate() onkeyup=showCreateUserGroupDialogValidate() />"))+addHtmlFormFloating("Omschrijving",'<textarea id=p4desc class=form-control value="" maxlength=1024 /></textarea>'),setModalContent("xxAddAgent",1==e?"Maak een gebruikersgroep.":"Dupliceer gebruikers groep",t),showModal("xxAddAgentModal","idx_dlgOkButton",function(){showCreateUserGroupDialogEx(3,e)}),showCreateUserGroupDialogValidate(),Q("p4name").focus()}}function showCreateUserGroupDialogValidate(){QE("idx_dlgOkButton",0<Q("p4name").value.length)}function showCreateUserGroupDialogEx(e,t){var n={action:"createusergroup",name:Q("p4name").value,desc:Q("p4desc").value};2==t&&(n.clone=decodeURIComponent(Q("dp4groupid").value)),1==t&&serverinfo.crossDomain&&(n.domain=serverinfo.crossDomain[parseInt(Q("p4domain").value)]),meshserver.send(n)}var currentUserGroup=null;function gotoUserGroup(e,t){if(!xxdialogMode||t){t=currentUserGroup=usergroups?usergroups[decodeURIComponent(e)]:null;if(null==t)51==xxcurrentView&&go(50);else{var e=EscapeHtml(t.name),n=(0==e.length&&(e="<i>Geen</i>"),null==currentUserGroup.membershipType&&0!=(256&userinfo.siteadmin)&&(e='<span role=button tabindex=0 title="Klik hier om de gebruikersgroepsnaam te bewerken" onclick=p51editgroup(1) onkeyup="if (event.key == \'Enter\') p51editgroup(1)">'+e+'  <i class="fa-solid fa-pencil fa-2xs"/></i></span>'),QH("p51groupName",e),0),o=0,a=0;if(t.links)for(var i in t.links)i.startsWith("user/")&&n++,i.startsWith("mesh/")&&o++,i.startsWith("node/")&&a++;var s,r=null==(r=t.desc)||""==r?"<i>Geen<i>":EscapeHtml(r),l="<div style=min-height:80px><table style=width:100%>",r=(0!=(8&args.hide)&&(l+="<br />"+addDeviceAttribute("Naam",e)),null==serverinfo.crossDomain&&0==debugmode||(l=(l+=addDeviceAttribute("Domein",""!=(e=t._id.split("/")[1])?EscapeHtml(e):"<i>Standaard</i>"))+addDeviceAttribute("Groepsidentificatie",EscapeHtml(t._id))),null!=currentUserGroup.membershipType&&(l+=addDeviceAttribute("Groepstype",EscapeHtml(currentUserGroup.membershipType))),0!=(256&userinfo.siteadmin)?l+=addDeviceAttribute("Omschrijving","<span role=button onclick=p51editgroup(2,"+(null!=currentUserGroup.membershipType)+")>"+r+' <i class="fa-solid fa-pencil fa-xs"/></i></span>'):l+=addDeviceAttribute("Omschrijving",r),1==serverinfo.userGroupsSessionRecording&&(e=[],t.flags&&2&t.flags&&e.push("Sessies opnemen"),l+=addDeviceAttribute("Functies",addLink(e=""==(e=e.join(", "))?"<i>Geen</i>":e,"p51edituserGroupFeatures()"))),[]),e=0,d=(t.consent&&(e=t.consent),serverinfo.consent&&(e|=serverinfo.consent),64&e&&8&e?r.push("Bureaublad vraag en werkbalk"):64&e?r.push("Bureaublad werkbalk"):8&e?r.push("Bureaublad vraag"):1&e&&r.push("Bureaublad melding"),16&e?r.push("Terminal Prompt"):2&e&&r.push("Terminal melding"),32&e?r.push("Bestanden vragen"):4&e&&r.push("Bestanden Melden"),7==e&&(r=["Altijd informeren"]),l=(l=(l=(l+=addDeviceAttribute("Toestemming van gebruiker",addLinkConditional(r=""==(r=(r=56==(56&e)?["Altijd vragen"]:r).join(", "))?"<i>Geen</i>":r,"p20editmeshconsent(4)",!0)))+addDeviceAttribute("Gebruikers",n))+addDeviceAttribute("Apparaatgroepen",o))+addDeviceAttribute("Apparaten",a)+"</table></div><br />",0!=(256&userinfo.siteadmin)&&(l+='<input type=button class="btn btn-primary btn-sm" value="Bericht verzending" title="Stuur een bericht naar alle gebruikers in deze groep." onclick=showUserBroadcastDialog("'+encodeURIComponentEx(t._id)+'") />'),QH("p51group",l),l="<br />",null==currentUserGroup.membershipType&&0!=(256&userinfo.siteadmin)&&(l+='<button class="btn btn-primary btn-sm me-2 mb-1" onclick="return p51showAddUserDialog()"><i class="fa-solid fa-circle-plus"></i> Gebruikers toevoegen</button>'),l+='<table class="table table-hover"><tbody><tr class="table-active"><th scope=col>Groeps leden</th><th scope=col></th></tr>',1),c=[];for(i in currentUserGroup.links)0!=i.startsWith("user/")&&(s=i.split("/")[2],currentUserGroup.links[i].name&&(s=currentUserGroup.links[i].name),i==userinfo._id&&(s=userinfo.name),c.push({id:i,name:s,rights:currentUserGroup.links[i].rights}));for(i in c.sort(function(e,t){return e.name>t.name?1:e.name<t.name?-1:0}),c){var u="",p=(null==currentUserGroup.membershipType&&(u="<a href=# onclick='return p51deleteUser(event,\""+encodeURIComponentEx(c[i].id)+'")\' title="Gebruikersrechten voor deze apparaatgroep verwijderen" style=cursor:pointer><img src=images/trash.png border=0 height=10 width=10></a>'),EscapeHtml(decodeURIComponent(c[i].name)));l+="<tr "+(d%2==0?"style=background-color:#DDD":"")+'><td><i class="fa-solid fa-user fa-fw" title="Gebruiker"></i>&nbsp;'+(p=null!=users?"<a href=# onclick='gotoUser(\""+encodeURIComponentEx(c[i].id)+"\");haltEvent(event);'>"+p+"</a>":p)+"</td><td><div style=float:right>"+u+"</div></td></tr>",++d}1==d&&(l+="<tr><td><div style=padding:6px>&nbsp;<i>Geen leden</i><div></div></div></td><td></td></tr>"),l+="</tbody></table><br />";var d=1,m=0,g=!1;for(i in meshes)currentUserGroup._id.split("/")[1]==meshes[i]._id.split("/")[1]&&(m++,null==currentUserGroup.links||null==currentUserGroup.links[i])&&(g=!0);if(0<m&&g&&(l+='<button class="btn btn-primary btn-sm me-2 mb-1"onclick="return p20showAddMeshUserDialog(3)"><i class="fa-solid fa-circle-plus"></i> Apparaatgroep toevoegen</button>'),l+='<table class="table table-hover"><tbody><tr class="table-active"><th scope=col>Gemeenschappelijke apparaatgroepen</th><th scope=col></th></tr>',currentUserGroup.links){var v=[];for(i in currentUserGroup.links)i.startsWith("mesh/")&&null!=meshes[i]&&v.push(meshes[i]);for(i in v=getOrderedList(v,"name")){var h=0,f=v[i],u="",k=makeDeviceGroupRightsString(currentUserGroup.links[f._id].rights),x=(userinfo.links&&null!=userinfo.links[f._id]&&null!=userinfo.links[f._id].rights&&(h=userinfo.links[f._id].rights),"<i>Onbekende apparaatgroep</i>");f&&(x="<a href=# onclick='gotoMesh(\""+f._id+"\");haltEvent(event);'>"+f.name+"</a>"),0!=(2&h)&&(u="<a href=# onclick='return p51removeMeshFromUserGroup(event,\""+encodeURIComponentEx(f._id)+'")\' title="Verwijder gebruikers groepsrechten van deze apparaatgroep" style=cursor:pointer><i class="fa-solid fa-trash text-danger hoverButton"></i></a>',k='<span style=cursor:pointer onclick=p20showAddMeshUserDialog(3,"'+encodeURIComponentEx(f._id)+'")>'+k+" <img class=hoverButton style=cursor:pointer src=images/link5.png></span>"),l+="<tr "+(++d%2==0?"style=background-color:#DDD":"")+'><td style=width:30%><div title="Apparaat groep" class=m99></div><div>&nbsp;'+x+"<div></div></div></td><td style=width:70%><div style=float:right>"+u+"</div><div>"+k+"</div></td></tr>"}}if(1==d&&(l+="<tr><td><div style=padding:6px>&nbsp;<i>Geen gemeenschappelijke apparaatgroepen</i><div></div></div></td><td></td></tr>"),d=1,l=l+"</tbody></table>"+"<br />",currentUserGroup._id.split("/")[1]==userinfo._id.split("/")[1]&&(l+='<button class="btn btn-primary btn-sm me-2 mb-1" onclick="return p20showAddMeshUserDialog(7)"><i class="fa-solid fa-circle-plus"></i> Apparaat toevoegen</button>'),l+='<table class="table table-hover"><tbody><tr class="table-active"><th scope=col>Gemeenschappelijke apparaten</th><th scope=col></th></tr>',currentUserGroup.links){var b=[];for(i in currentUserGroup.links)i.startsWith("node/")&&null!=(y=getNodeFromId(i))&&b.push(y);for(i in b=getOrderedList(b,"name")){var y=b[i],u="",k=makeUserDeviceRightsString(currentUserGroup.links[y._id].rights),h=GetNodeRights(y),w="<i>Onbekend apparaat</i>";y&&(w="<a href=# onclick='gotoDevice(\""+y._id+"\");haltEvent(event);'>"+y.name+"</a>"),0!=(2&h)&&(u="<a href=# onclick='return p51removeDeviceFromUserGroup(event,\""+encodeURIComponentEx(y._id)+'")\' title="Gebruikersrechten voor dit apparaat verwijderen" style=cursor:pointer><img src=images/trash.png border=0 height=10 width=10></a>',k='<span style=cursor:pointer onclick=p20showAddMeshUserDialog(7,"'+encodeURIComponentEx(y._id)+'")>'+k+" <img class=hoverButton style=cursor:pointer src=images/link5.png></span>"),l+="<tr "+(++d%2==0?"style=background-color:#DDD":"")+'><td style=width:30%><div title="Apparaat groep" class=m99></div><div>&nbsp;'+w+"<div></div></div></td><td style=width:70%><div style=float:right>"+u+"</div><div>"+k+"</div></td></tr>"}}1==d&&(l+="<tr><td><div style=padding:6px>&nbsp;<i>Geen gemeenschappelijke apparaten</i><div></div></div></td><td></td></tr>"),l+="</tbody></table>",null!=currentUserGroup.membershipType&&0!=n||0==(256&userinfo.siteadmin)||(l+="<div style=font-size:small;text-align:right><span><a href=# onclick=p51showDeleteUserGroupDialog() style=cursor:pointer>Verwijder de gebruikersgroep</a></span></div>"),QH("p51group2",l),go(51);var M="";if(0==(268435456&features)&&51<=xxcurrentView&&xxcurrentView<=59&&null!=currentUserGroup){for(var i in M="?viewmode="+xxcurrentView+"&gotougrp="+(serverinfo.crossDomain?currentUserGroup._id:currentUserGroup._id.split("/")[2]),urlargs)M+="&"+i+"="+urlargs[i];try{window.history.replaceState({},document.title,window.location.pathname+M)}catch(e){}}}}}function p51edituserGroupFeatures(){var e,t;xxdialogMode||(e=currentUserGroup.flags||0,t="",1==serverinfo.userGroupsSessionRecording&&(t+='<div><label><input type=checkbox class="form-check-input me-2" id=d51flag1 '+(2&e?"checked":"")+">Sessies opnemen</label><br></div>"),xxdialogButtons=3,setModalContent("xxAddAgent","Functies van gebruikersgroepen bewerken",t),showModal("xxAddAgentModal","idx_dlgOkButton",p51edituserGroupFeaturesEx))}function p51edituserGroupFeaturesEx(){var e=0;1==serverinfo.userGroupsSessionRecording&&Q("d51flag1").checked&&(e+=2),meshserver.send({action:"editusergroup",ugrpid:currentUserGroup._id,flags:e})}function p51removeDeviceFromUserGroup(e,t){var n;xxdialogMode||null!=(n=getNodeFromId(decodeURIComponent(t)))&&(setModalContent("xxAddAgent","Apparaatmachtigingen verwijderen",format('Bevestig verwijdering van toegangsrechten voor apparaat "{0}"?',n.name)),showModal("xxAddAgentModal","idx_dlgOkButton",()=>p51removeDeviceFromUserGroupEx(3,n._id)))}function p51removeDeviceFromUserGroupEx(e,t){meshserver.send({action:"adddeviceuser",nodeid:t,userids:[currentUserGroup._id],rights:0,remove:!0})}function p51removeMeshFromUserGroup(e,t){var n;xxdialogMode||null!=(n=meshes[decodeURIComponent(t)])&&(setModalContent("xxAddAgent","Apparaatgroepmachtigingen verwijderen",format('Bevestig verwijdering van toegangsrechten voor apparaatgroep "{0}"?',n.name)),showModal("xxAddAgentModal","idx_dlgOkButton",()=>p51removeMeshFromUserGroupEx(3,n._id)))}function p51editgroup(e,t){xxdialogMode||(t=addHtmlFormFloating("Naam",'<input id=dp51name class="form-control" maxlength=32 onchange=p51editgroupValidate() onkeyup=p51editgroupValidate(event) '+(t?"readonly disabled":"")+"/>"),t+=addHtmlFormFloating("Omschrijving",'<textarea id=dp51desc class="form-control" maxlength=1024 style=width:100%;resize:none></textarea>'),xxdialogButtons=3,setModalContent("xxAddAgent","Bewerk de gebruikersgroep",t),showModal("xxAddAgentModal","idx_dlgOkButton",p51editgroupEx),Q("dp51name").value=currentUserGroup.name,currentUserGroup.desc&&(Q("dp51desc").value=currentUserGroup.desc),p51editgroupValidate(),(2==e?Q("dp51desc"):Q("dp51name")).focus())}function p51editgroupEx(){meshserver.send({action:"editusergroup",ugrpid:currentUserGroup._id,name:Q("dp51name").value,desc:Q("dp51desc").value})}function p51editgroupValidate(e){QE("idx_dlgOkButton",0<Q("dp51name").value.length),e&&"Enter"==e.key&&Q("dp51desc").focus()}function p51showDeleteUserGroupDialog(){var e;return xxdialogMode||(e=format("Verwijder gebruikersgroep {0}?",EscapeHtml(currentUserGroup.name))+"<br /><br />",xxdialogButtons=3,setModalContent("xxAddAgent","Verwijder de gebruikersgroep",e+='<label><input id=p51check type=checkbox class="form-check-input me-2" onchange=p51validateDeleteGroupDialog() />Bevestig</label>'),showModal("xxAddAgentModal","idx_dlgOkButton",function(){p51showDeleteUserGroupDialogEx(xxdialogButtons,xxdialogTag)}),p51validateDeleteGroupDialog()),!1}function p51validateDeleteGroupDialog(){QE("idx_dlgOkButton",Q("p51check").checked)}function p51showDeleteUserGroupDialogEx(e,t){meshserver.send({action:"deleteusergroup",ugrpid:currentUserGroup._id})}function p51deleteUser(e,t){return haltEvent(e),p51viewuserEx(2,decodeURIComponent(t)),!1}function p51viewuserEx(e,t){2==e&&(e=t.split("/")[2],users&&users[t]&&(e=users[t].name),userinfo._id==t&&(e=userinfo.name),setModalContent("xxAddAgent","Gebruikerslidmaatschap verwijderen",format('Bevestig lidmaatschap verwijderen van gebruiker "{0}"?',EscapeHtml(decodeURIComponent(e)))),showModal("xxAddAgentModal","idx_dlgOkButton",p51viewuserEx2(3,t)))}function p51viewuserEx2(e,t){meshserver.send({action:"removeuserfromusergroup",ugrpid:currentUserGroup._id,userid:t})}function p51showAddUserDialog(){var e;return xxdialogMode||(e="Gebruikers toestaan deze apparaatgroep en apparaten in deze groep te beheren.",524288&features&&(e+=" Gebruikers moeten inloggen bij de server voordat ze kunnen worden toegevoegd aan een apparaatgroep."),setModalContent("xxAddAgent","Voeg gebruikers toe aan de gebruikersgroep",e=(e=(e+="<br /><br /><div style='position:relative'>")+addHtmlFormFloating("Gebruikers-ID's",'<input id=dp51username maxlength=32 class="form-control" onchange=p51validateAddUserDialog() onkeyup=p51validateAddUserDialog() placeholder="user1, user2, user3" />'))+"<div id=dp51usersuggest class=suggestionBox style='top:30px;left:130px;display:none'></div>"+"</div><br>"),showModal("xxAddAgentModal","idx_dlgOkButton",function(){p51showAddUserDialogEx(3,xxdialogTag)}),Q("dp51username").focus(),p51validateAddUserDialog()),!1}function p51setname(e){e=decodeURIComponent(e);var t,n=Q("dp51username").value.split(",");for(t in n)n[t]=n[t].trim();return n[n.length-1]=e,Q("dp51username").value=n.join(", "),p51validateAddUserDialog(),!1}function p51validateAddUserDialog(){var e=!0;if(Q("dp51username")){var t=Q("dp51username").value.split(",");for(l in t){var n=t[l]=t[l].trim();(0==n.length||0<=n.indexOf('"'))&&(e=!1)}var o=!1,a=!1;if(null!=users){var i=t[t.length-1].trim(),s=i.toLowerCase(),r=[];if(0<i.length){for(var l in users){var d=users[l]._id.split("/");if(currentUserGroup.domain==d[1]&&d[2]===s){a=!0;break}if(0<=users[l].name.toLowerCase().indexOf(s)&&currentUserGroup.domain==d[1]&&(r.push([users[l]._id,users[l].name]),8<=r.length))break}if(0==a&&0<r.length){var c="";for(l in r){var u=r[l][0],p=r[l][1];u.split("/")[2]==p.toLowerCase()?c+="<div class=suggestionBoxItem onclick='p51setname(\""+encodeURIComponentEx(u.split("/")[2])+"\")'>"+EscapeHtml(p)+"</div>":c+="<div class=suggestionBoxItem onclick='p51setname(\""+encodeURIComponentEx(u.split("/")[2])+"\")'><div>"+EscapeHtml(p)+"</div><div class=suggestionBoxSubItem>"+EscapeHtml(u.split("/")[2])+"</div></div>"}QH("dp51usersuggest",c),o=!0}}}QV("dp51usersuggest",o)}QE("idx_dlgOkButton",e)}function p51showAddUserDialogEx(e,t){if(null==t){var n,o=Q("dp51username").value.split(","),a=[];for(n in o)a.push(o[n].trim());meshserver.send({action:"addusertousergroup",ugrpid:currentUserGroup._id,usernames:a})}else meshserver.send({action:"addusertousergroup",ugrpid:currentUserGroup._id,usernames:[t.split("/")[2]]})}var currentUser=null;function gotoUser(e,t,n){if((!xxdialogMode||t)&&(null==n||null==n.originalTarget||null==n.originalTarget.href)){var o=currentUser=users[decodeURIComponent(e)];if(null==o)go(4);else{QH("p30userName",EscapeHtml(o.name)),QH("p31userName",EscapeHtml(o.name));var t=o._id==userinfo._id,n=0,e=(null!=wssessions&&wssessions[o._id]&&(n=wssessions[o._id]),null!=o.flags&&1&o.flags?(QV("MainUserImage",!1),QV("MainUserImageEx",!0),null==o.accountImageRnd&&(o.accountImageRnd=Math.floor(9999999999*Math.random())),Q("MainUserImageEx").src="userimage.ashx?id="+o._id.split("/")[2]+"&rnd="+o.accountImageRnd):(Q("MainUserImage").classList.remove("gray"),0==n&&Q("MainUserImage").classList.add("gray"),QV("MainUserImage",!0),QV("MainUserImageEx",!1)),o._id.split("/")[2]),e=(e.startsWith("~twitter:")?(QV("p30userAuthServiceLogo",!0),Q("p30userAuthServiceLogo").src="images/login/twitter64.png"):e.startsWith("~google:")?(QV("p30userAuthServiceLogo",!0),Q("p30userAuthServiceLogo").src="images/login/google64.png"):e.startsWith("~github:")?(QV("p30userAuthServiceLogo",!0),Q("p30userAuthServiceLogo").src="images/login/github64.png"):e.startsWith("~azure:")?(QV("p30userAuthServiceLogo",!0),Q("p30userAuthServiceLogo").src="images/login/azure64.png"):e.startsWith("~oidc:")?(QV("p30userAuthServiceLogo",!0),Q("p30userAuthServiceLogo").src="images/login/oidc64.png"):e.startsWith("~jumpcloud:")?(QV("p30userAuthServiceLogo",!0),Q("p30userAuthServiceLogo").src="images/login/jumpcloud64.png"):e.startsWith("~intel:")?(QV("p30userAuthServiceLogo",!0),Q("p30userAuthServiceLogo").src="images/login/intel64.png"):e.startsWith("~:")?(QV("p30userAuthServiceLogo",!0),Q("p30userAuthServiceLogo").src="images/login/generic64.png"):QV("p30userAuthServiceLogo",!1),[]),a="",i=(null!=o.siteadmin&&0!=(32&o.siteadmin)&&4294967295!=o.siteadmin&&(a='<img src="images/padlock12.png" height=12 width=8 title="Account is uitgeschakeld" style="margin-top:2px" /> ',e.push("Vergrendeld account")),null==o.siteadmin||0==(4294966047&o.siteadmin)?e.push("Geen server rechten"):8==o.siteadmin?e.push("Toegang tot de server bestanden"):4294967295==o.siteadmin?e.push("Volledige beheerder"):e.push("Gedeeltelijke rechten"),null!=o.siteadmin&&4294967295!=o.siteadmin&&0!=(1216&o.siteadmin)&&e.push("Beperkingen"),"<div style=min-height:80px><table style=width:100%>"),s=(0!=(8&args.hide)&&(i+="<br />"+addDeviceAttribute("Naam",o.name)),o.email?EscapeHtml(o.email):"<i>Niet ingesteld</i>"),r="",l=o.realname?EscapeHtml(o.realname):"<i>Niet ingesteld</i>",d=(serverinfo.emailcheck&&(r=1==o.emailVerified?'<b style=color:green;cursor:pointer title="Email is geverifieerd">&#x2713</b> ':'<b style=color:red;cursor:pointer title="E-mail is niet geverifieerd">&#x2717;</b> '),serverinfo.crossDomain||0!=debugmode?i=(i+=addDeviceAttribute("Domein",""!=(d=o._id.split("/")[1])?EscapeHtml(d):"<i>Standaard</i>"))+addDeviceAttribute("GebruikersID",EscapeHtml(o._id)):o.name.toLowerCase()!=o._id.split("/")[2]&&(i+=addDeviceAttribute("GebruikersID",EscapeHtml(o._id.split("/")[2]))),""),r=(o.email&&(d=' <a href="mailto:'+EscapeHtml(o.email)+'" \'><i class="fa-solid fa-arrow-up-right-from-square fa-xs"></i></a>'),i=4294967295!=o.siteadmin||4294967295==userinfo.siteadmin?(i+=addDeviceAttribute("E-mail",'<span role=button onclick=p30showUserEmailChangeDialog(event,"'+encodeURIComponentEx(o._id)+'")>'+r+s+d+' <i class="fa-solid fa-pencil fa-xs"></i></span>'))+addDeviceAttribute("Echte naam",'<span role=button onclick=p30showUserRealNameChangeDialog(event,"'+encodeURIComponentEx(o._id)+'")>'+l+' <i class="fa-solid fa-pencil fa-xs"></i></span>'):(i+=addDeviceAttribute("E-mail",r+s+d))+addDeviceAttribute("Echte naam",l),(33554432&features||null!=o.phone)&&(i+=addDeviceAttribute("Telefoonnummer","<span role=button onclick=p30editPhone()>"+(o.phone||"<i>Geen</i>")+' <i class="fa-solid fa-pencil fa-xs"></i></span>')),(33554432&features2||null!=o.msghandle)&&(i+=addDeviceAttribute("Berichten",'<span role=button onclick=p30editMessaging()><i class="fa-solid fa-comment fa-xs" title="Berichten ingeschakeld" style="margin-top:2px"></i> '+(o.msghandle||"<i>Geen</i>")+' <i class="fa-solid fa-pencil fa-xs"></i></span>')),[]),c=(1==serverinfo.usersSessionRecording&&o.flags&&2&o.flags&&r.push("Sessies opnemen"),o.removeRights&&(0!=(8&o.removeRights)?r.push("geen afstandsbediening"):(0!=(65536&o.removeRights)?r.push("Geen bureaublad"):0!=(256&o.removeRights)&&r.push("Alleen bureaubladweergave"),0!=(512&o.removeRights)&&r.push("Geen terminal"),0!=(1024&o.removeRights)&&r.push("Geen bestanden")),0!=(16&o.removeRights)&&r.push("Geen console"),0!=(32768&o.removeRights)&&r.push("Geen de-installatie"),0!=(131072&o.removeRights)&&r.push("Geen externe opdrachten"),0!=(64&o.removeRights)&&r.push("Niet starten"),0!=(262144&o.removeRights))&&r.push("Geen herstart/uitschakelen"),i=(i+=addDeviceAttribute("Functies",addLink(r=""==(r=r.join(", "))?"<i>Geen</i>":r,"p20edituserfeatures()")))+addDeviceAttribute("Serverrechten","<span role=button onclick='return showUserAdminDialog(event,\""+encodeURIComponentEx(o._id)+"\")'>"+a+e.join(", ")+' <i class="fa-solid fa-pencil fa-xs"></i></span>'),o.quota&&(i+=addDeviceAttribute("Serverquotum",EscapeHtml(parseInt(o.quota)/1024)+" k")),i+=addDeviceAttribute("Aangemaakt",printDateTime(new Date(1e3*o.creation))),o.login&&(i+=addDeviceAttribute("Laatste inlog",printDateTime(new Date(1e3*o.login)))),-1==o.passchange?i+=addDeviceAttribute("Wachtwoord","Wordt bij de volgende aanmelding gewijzigd."):o.passchange&&(i+=addDeviceAttribute("Wachtwoord",format("Laatst gewijzigd: {0}",printDateTime(new Date(1e3*o.passchange))))),0),s="<i>Geen<i>";if(o.links){for(var u in o.links)u.startsWith("mesh/")&&c++;1==c?s="1 groep":1<c&&(s=format("{0} groepen",c))}if(i+=addDeviceAttribute("Apparaatgroepen",s),4294967295==userinfo.siteadmin||2&userinfo.siteadmin){var p="<i>Geen</i>";if(o.groups)for(var u in p="",o.groups)p+='<span class="tagSpan">'+EscapeHtml(o.groups[u])+"</span>";i+=addDeviceAttribute("Beheerdersgebied",addLinkConditional(p,'showUserGroupDialog(event,"'+encodeURIComponentEx(o._id)+'")',4294967295==userinfo.siteadmin||null==userinfo.groups&&userinfo._id!=o._id&&4294967295!=o.siteadmin))}d=[],l=0,r=(o.consent&&(l=o.consent),serverinfo.consent&&(l|=serverinfo.consent),64&l&&8&l?d.push("Bureaublad vraag en werkbalk"):64&l?d.push("Bureaublad werkbalk"):8&l?d.push("Bureaublad vraag"):1&l&&d.push("Bureaublad melding"),16&l?d.push("Terminal Prompt"):2&l&&d.push("Terminal melding"),32&l?d.push("Bestanden vragen"):4&l&&d.push("Bestanden Melden"),7==l&&(d=["Altijd informeren"]),i+=addDeviceAttribute("Toestemming van gebruiker",addLinkConditional(d=""==(d=(d=56==(56&l)?["Altijd vragen"]:d).join(", "))?"<i>Geen</i>":d,"p20editmeshconsent(2)",!0)),0);if((0<o.otpsecret||0<o.otphkeys||0<o.otpekey||0<o.otpduo)&&(r=1,a=[],0<o.otpsecret&&a.push("Verificatie-app"),0<o.otphkeys&&a.push("Veiligheidssleutel"),0<o.otpekey&&a.push("E-mail"),0<o.otpduo&&a.push("Duo"),0<o.otpkeys&&a.push("Back-up codes"),0<o.otpdev&&a.push("Apparaat Push"),null!=o.phone&&67108864&features&&a.push("SMS"),null!=o.msghandle&&67108864&features2&&a.push("Berichten"),i+=addDeviceAttribute("Beveiliging",'<i class="fa-solid fa-key" title="Tweestapsverificatie ingeschakeld" style="margin-top:2px"></i> '+a.join(", "))),i=(i+="</table></div><br />")+('<input type=button class="btn btn-primary btn-sm me-1" value="Notities" title="Bekijk opmerkingen over deze gebruiker" onclick=showNotes(false,"'+encodeURIComponentEx(o._id)+'") />'),o.phone&&33554432&features&&(i+='<input type=button class="btn btn-primary btn-sm me-1" value="SMS" title="Stuur een SMS bericht naar deze gebruiker" onclick=showSendSMS("'+encodeURIComponentEx(o._id)+'") />'),o.msghandle&&33554432&features2&&(i+='<input type=button class="btn btn-primary btn-sm me-1" value="Bericht" title="Stuur een bericht naar deze gebruiker" onclick=showSendMessage("'+encodeURIComponentEx(o._id)+'") />'),"string"==typeof o.email&&!0===o.emailVerified&&64&features&&(i+='<input type=button class="btn btn-primary btn-sm me-1" value="E-mail" title="Stuur een e-mailbericht naar deze gebruiker" onclick=showSendEmail("'+encodeURIComponentEx(o._id)+'") />'),!t&&(0<n||8&features2&&o.webpush)&&(i=(i+='<input type=button class="btn btn-primary btn-sm me-1" value="Melden" title="Stuur gebruikersmelding" onclick=showUserAlertDialog(event,"'+encodeURIComponentEx(o._id)+'") />')+'<input type=button class="btn btn-primary btn-sm me-1" value="Chat" title="Chat" onclick=userChat(event,"'+encodeURIComponentEx(o._id)+'","'+encodeURIComponentEx(o.name)+'") />',0<n)&&null!=serverinfo&&null!=serverinfo.altmessenging)for(var u in serverinfo.altmessenging){var m=serverinfo.altmessenging[u];null!=m.type&&"user"!=m.type||(i+='<input type=button class="btn btn-primary btn-sm me-1" value="'+EscapeHtml(m.name)+'" onclick=altUserChat(event,"'+encodeURIComponentEx(o._id)+'","'+encodeURIComponentEx(o.name)+'",'+u+") />")}QH("p30html",i),drawUserPermissions();var e=null!=userinfo.siteadmin&&2&userinfo.siteadmin&&4294967295!=o.siteadmin||4294967295==userinfo.siteadmin,g=(i="<div style=float:right;font-size:small>",e&&userinfo._id!=o._id&&(i+="<a href=# style=cursor:pointer onclick='return p30showDeleteUserDialog()' title=\"Verwijder deze gebruiker\">Verwijder gebruiker</a>"),i+="</div><div style=font-size:small>",e&&0==(524288&features)&&"~"!=o._id.split("/")[2][0]&&(i=i+"<a href=# style=cursor:pointer onclick='return p30showUserChangePassDialog("+r+')\' title="Wijzig het wachtwoord voor deze gebruiker">Verander wachtwoord</a> <a href=# style=cursor:pointer onclick=\'return p30viewPreviousLogins()\' title="Bekijk eerdere aanmeldingen voor deze gebruiker">Eerdere aanmeldingen</a>'),i+="</div><br>",QH("p30html3",i),i="",1==n?i="1 actieve sessie":1<n&&(i=format("{0} actieve sessies",n)),QH("MainUserState",i),go(30),QH("p31events",""),refreshUsersEvents(),"");if(0==(268435456&features)&&30<=xxcurrentView&&xxcurrentView<=39&&null!=currentUser){for(var u in g="?viewmode="+xxcurrentView+"&gotouser="+(serverinfo.crossDomain?currentUser._id:currentUser._id.split("/")[2]),urlargs)g+="&"+u+"="+urlargs[u];try{window.history.replaceState({},document.title,window.location.pathname+g)}catch(e){}}}}}function p30editPhone(){var e;xxdialogMode||(e=(e='<table style=width:100%><tr><td style=width:56px><img src="images/phone80.png" style=padding:8px>')+'<td style=width:100%;text-align:center>SMS geschikt telefoonnummer voor deze gebruiker.<br />Leeg laten voor geen.<br /><br /><div style=width:100%;text-align:center>Telefoonnummer <input type=tel pattern="[0-9]" autocomplete="tel" value="'+(currentUser.phone||"")+'" inputmode="tel" maxlength=18 id=d2phoneinput onKeyUp=p30editPhoneValidate() onkeypress="if (event.key==\'Enter\') p30editPhoneValidate(1)"></div></table>',xxdialogButtons=3,xxdialogTag="verifyPhone",setModalContent("xxAddAgent","Telefonische meldingen",e),showModal("xxAddAgentModal","idx_dlgOkButton",p30editPhoneEx),Q("d2phoneinput").focus(),p30editPhoneValidate())}function p30editMessaging(){var e,t;xxdialogMode||(t="<select id=d2serviceselect style=width:160px;margin-left:8px onchange=p30editMessagingValidate()><option value=0>Geen</option>",0!=(1&serverinfo.userMsgProviders)&&(t+="<option value=1>Telegram</option>"),0!=(4&serverinfo.userMsgProviders)&&(t+="<option value=4>Discord</option>"),0!=(8&serverinfo.userMsgProviders)&&(t+="<option value=8>XMPP</option>"),0!=(16&serverinfo.userMsgProviders)&&(t+="<option value=16>CallMeBot</option>"),0!=(32&serverinfo.userMsgProviders)&&(t+="<option value=32>Pushover</option>"),0!=(64&serverinfo.userMsgProviders)&&(t+="<option value=64>ntfy</option>"),0!=(128&serverinfo.userMsgProviders)&&(t+="<option value=128>Zulip</option>"),0!=(256&serverinfo.userMsgProviders)&&(t+="<option value=256>Slack</option>"),e=(e='<table style=width:100%><tr><td style=width:56px;vertical-align:top><img src="images/messaging40.png" style=padding:8px>')+"<td style=width:100%>Berichtenaccount voor deze gebruiker.<table style=margin-top:12px><tr><td>Service<td>"+(t+="</select>")+"<tr><td>afhandeling<td><input maxlength=1024 style=width:160px;margin-left:8px id=d2handleinput onKeyUp=p30editMessagingValidate() onkeypress=\"if (event.key=='Enter') p30editMessagingValidate(1)\"></table>",serverinfo.discordUrl&&(e+="<div id=d2discordurl style=display:none><br /><a href="+serverinfo.discordUrl+' target="_discord">Word lid van deze Discord-server om meldingen te ontvangen.</a></div>'),e=(e+='<div id=d2callmebotinfo style=display:none><br /><a href=https://www.callmebot.com/blog/free-api-signal-send-messages/ target="_callmebot">Signal</a>, <a href=https://www.callmebot.com/blog/free-api-whatsapp-messages/ target="_callmebot">Whatsapp</a>, <a href=https://www.callmebot.com/blog/free-api-facebook-messenger/ target="_callmebot">Facebook</a>, <a href=https://www.callmebot.com/blog/telegram-text-messages/ target="_callmebot">Telegram</a></div>')+'<div id=d2pushoverinfo style=display:none><br /><a href=https://pushover.net/ target="_pushover">Informatie op Pushover.net</a></div><div id=d2ntfyinfo style=display:none><br /><a href="'+(serverinfo.userMsgNftyUrl||"https://ntfy.sh/")+'" target="_ntfy">Gratis service via ntfy.sh</a></div>',xxdialogButtons=3,xxdialogTag="verifyMessaging",setModalContent("xxAddAgent","Berichten notificaties",e+='<div id=d2slackinfo style=display:none><br /><a href=https://api.slack.com/messaging/webhooks target="_slack">Slack Webhook Setup</a></div>'),showModal("xxAddAgentModal","idx_dlgOkButton",p30editMessagingEx),Q("d2handleinput").focus(),currentUser.msghandle&&(currentUser.msghandle.startsWith("telegram:")&&0!=(1&serverinfo.userMsgProviders)&&(Q("d2serviceselect").value=1,Q("d2handleinput").value=currentUser.msghandle.substring(10)),currentUser.msghandle.startsWith("discord:")&&0!=(4&serverinfo.userMsgProviders)&&(Q("d2serviceselect").value=4,Q("d2handleinput").value=currentUser.msghandle.substring(8)),currentUser.msghandle.startsWith("xmpp:")&&0!=(8&serverinfo.userMsgProviders)&&(Q("d2serviceselect").value=8,Q("d2handleinput").value=currentUser.msghandle.substring(5)),currentUser.msghandle.startsWith("callmebot:")&&0!=(16&serverinfo.userMsgProviders)&&(Q("d2serviceselect").value=16,"signal"==(t=currentUser.msghandle.substring(10).split("|"))[0]&&3==t.length&&(Q("d2handleinput").value="https://api.callmebot.com/signal/send.php?phone="+decodeURIComponent(t[1])+"&apikey="+decodeURIComponent(t[2])),"whatsapp"==t[0]&&3==t.length&&(Q("d2handleinput").value="https://api.callmebot.com/whatsapp.php?phone="+decodeURIComponent(t[1])+"&apikey="+decodeURIComponent(t[2])),"facebook"==t[0])&&2==t.length&&(Q("d2handleinput").value="https://api.callmebot.com/facebook/send.php?apikey="+decodeURIComponent(t[1])),currentUser.msghandle.startsWith("pushover:")&&0!=(32&serverinfo.userMsgProviders)&&(Q("d2serviceselect").value=32,Q("d2handleinput").value=currentUser.msghandle.substring(9)),currentUser.msghandle.startsWith("ntfy:")&&0!=(64&serverinfo.userMsgProviders)&&(Q("d2serviceselect").value=64,Q("d2handleinput").value=currentUser.msghandle.substring(5)),currentUser.msghandle.startsWith("zulip:")&&0!=(128&serverinfo.userMsgProviders)&&(Q("d2serviceselect").value=128,Q("d2handleinput").value=currentUser.msghandle.substring(6)),currentUser.msghandle.startsWith("slack:"))&&0!=(256&serverinfo.userMsgProviders)&&(Q("d2serviceselect").value=256,Q("d2handleinput").value=currentUser.msghandle.substring(6)),p30editMessagingValidate())}function p30editMessagingValidate(e){QE("d2handleinput",0!=Q("d2serviceselect").value),serverinfo.discordUrl&&QV("d2discordurl",4==Q("d2serviceselect").value),QV("d2callmebotinfo",16==Q("d2serviceselect").value),QV("d2pushoverinfo",32==Q("d2serviceselect").value),QV("d2ntfyinfo",64==Q("d2serviceselect").value),QV("d2slackinfo",256==Q("d2serviceselect").value),0==Q("d2serviceselect").value?Q("d2handleinput").placeholder="":4==Q("d2serviceselect").value?Q("d2handleinput").placeholder="Gebruikersnaam:0000":8==Q("d2serviceselect").value?Q("d2handleinput").placeholder="gebruikersnaam@server.nl":16==Q("d2serviceselect").value?Q("d2handleinput").placeholder="https://api.callmebot.com/...":32==Q("d2serviceselect").value?Q("d2handleinput").placeholder="Gebruikerssleutel":64==Q("d2serviceselect").value?Q("d2handleinput").placeholder="Onderwerp":128==Q("d2serviceselect").value?Q("d2handleinput").placeholder="gebruikersnaam@voorbeeld.com":256==Q("d2serviceselect").value?Q("d2handleinput").placeholder="https://hooks.slack.com/...":Q("d2handleinput").placeholder="Gebruikersnaam",1==e&&dialogclose(1)}function p30editMessagingEx(){var e=null;""==Q("d2handleinput").value||0==Q("d2serviceselect").value?e="":1==Q("d2serviceselect").value?e="telegram:@"+Q("d2handleinput").value:4==Q("d2serviceselect").value?e="discord:"+Q("d2handleinput").value:8==Q("d2serviceselect").value?e="xmpp:"+Q("d2handleinput").value:16==Q("d2serviceselect").value?e="callmebot:"+Q("d2handleinput").value:32==Q("d2serviceselect").value?e="pushover:"+Q("d2handleinput").value:64==Q("d2serviceselect").value?e="ntfy:"+Q("d2handleinput").value:128==Q("d2serviceselect").value?e="zulip:"+Q("d2handleinput").value:256==Q("d2serviceselect").value&&(e="slack:"+Q("d2handleinput").value),null!=e&&meshserver.send({action:"edituser",id:currentUser._id,msghandle:e})}function p20edituserfeatures(){var e,t,n;xxdialogMode||(e=currentUser.flags||0,t=currentUser.removeRights||0,n=n="",1==serverinfo.usersSessionRecording&&(n+='<div><label><input type=checkbox id=d20flag1 class="form-check-input me-2" onchange=p20edituserfeaturesValidate() '+(2&e?"checked":"")+">Sessies opnemen</label><br></div>"),setModalContent("xxAddAgent","Gebruikersfuncties bewerken",n=(n=(n=(n=(n=n+('<div><label><input type=checkbox id=d20flag7 class="form-check-input me-2" onchange=p20edituserfeaturesValidate() '+(8&t?"checked":"")+">geen afstandsbediening</label><br></div>")+('<div style=margin-left:8px><label><input type=checkbox id=d20flag2 class="form-check-input me-2" onchange=p20edituserfeaturesValidate() '+(65536&t?"checked":"")+">Geen bureaublad toegang</label><br></div>"))+('<div style=margin-left:16px><label><input type=checkbox id=d20flag3 class="form-check-input me-2" onchange=p20edituserfeaturesValidate() '+(256&t?"checked":"")+">Alleen extern meekijken</label><br></div>")+('<div style=margin-left:8px><label><input type=checkbox id=d20flag4 class="form-check-input me-2" onchange=p20edituserfeaturesValidate() '+(512&t?"checked":"")+">Geen terminal toegang</label><br></div>"))+('<div style=margin-left:8px><label><input type=checkbox id=d20flag5 class="form-check-input me-2" onchange=p20edituserfeaturesValidate() '+(1024&t?"checked":"")+">Geen bestandstoegang</label><br></div>")+('<div><label><input type=checkbox id=d20flag6 class="form-check-input me-2" onchange=p20edituserfeaturesValidate() '+(16&t?"checked":"")+">Geen agentconsole</label><br></div>"))+('<div><label><input type=checkbox id=d20flag8 class="form-check-input me-2" onchange=p20edituserfeaturesValidate() '+(32768&t?"checked":"")+">Geen de-installatie</label><br></div>")+('<div><label><input type=checkbox id=d20flag9 class="form-check-input me-2" onchange=p20edituserfeaturesValidate() '+(131072&t?"checked":"")+">Geen externe opdrachten</label><br></div>"))+('<div><label><input type=checkbox id=d20flag10 class="form-check-input me-2" onchange=p20edituserfeaturesValidate() '+(64&t?"checked":"")+">Niet starten</label><br></div>")+('<div><label><input type=checkbox id=d20flag11 class="form-check-input me-2" onchange=p20edituserfeaturesValidate() '+(262144&t?"checked":"")+">Geen herstart/uitschakelen</label><br></div>")),showModal("xxAddAgentModal","idx_dlgOkButton",p20edituserfeaturesEx),p20edituserfeaturesValidate())}function p20edituserfeaturesValidate(){QE("d20flag2",!Q("d20flag7").checked),QE("d20flag3",!Q("d20flag7").checked&&!Q("d20flag2").checked),QE("d20flag4",!Q("d20flag7").checked),QE("d20flag5",!Q("d20flag7").checked)}function p20edituserfeaturesEx(){var e=1&(currentUser.flags||0),t=(1==serverinfo.usersSessionRecording&&Q("d20flag1").checked&&(e+=2),0);Q("d20flag7").checked?t+=8:(Q("d20flag2").checked?t+=65536:Q("d20flag3").checked&&(t+=256),Q("d20flag4").checked&&(t+=512),Q("d20flag5").checked&&(t+=1024)),Q("d20flag6").checked&&(t+=16),Q("d20flag8").checked&&(t+=32768),Q("d20flag9").checked&&(t+=131072),Q("d20flag10").checked&&(t+=64),Q("d20flag11").checked&&(t+=262144),meshserver.send({action:"edituser",id:currentUser._id,flags:e,removeRights:t})}function p30editPhoneValidate(e){var t=""==Q("d2phoneinput").value||isPhoneNumber(Q("d2phoneinput").value);QE("idx_dlgOkButton",t),1==e&&t&&dialogclose(1)}function p30editPhoneEx(){meshserver.send({action:"edituser",id:currentUser._id,phone:Q("d2phoneinput").value})}function p30showUserRealNameChangeDialog(e){return xxdialogMode||(xxdialogButtons=3,setModalContent("xxAddAgent",format("Verander echte naam voor {0}",EscapeHtml(currentUser.name)),'<div class="form-floating mb-2"><input id=dp30realname class="form-control" placeholder="Real Name" maxlength=256 /><label for=dp30realname>Real Name</label></div>'),showModal("xxAddAgentModal","idx_dlgOkButton",p30showUserRealNameChangeDialogEx),Q("dp30realname").focus(),Q("dp30realname").value=currentUser.realname||""),!1}function p30showUserRealNameChangeDialogEx(){meshserver.send({action:"edituser",id:currentUser._id,realname:Q("dp30realname").value})}function p30showUserEmailChangeDialog(e){var t;return xxdialogMode||(t="",t+='<div class="form-floating mb-2"><input id=dp30email class="form-control" maxlength=32 onchange=p30validateEmail() onkeyup=p30validateEmail() placeholder=Email /><label for=dp30email>Email</label></div>',serverinfo.emailcheck&&(t+=addHtmlFormFloating("Status",'<select id=dp30verified class="form-control" onchange=p30validateEmail()><option value=0>niet geverifieerd</option><option value=1>Geverifieerd</option></select>')),setModalContent("xxAddAgent",format("Verander e-mail voor {0}",EscapeHtml(currentUser.name)),t),xxdialogButtons=3,showModal("xxAddAgentModal","idx_dlgOkButton",p30showUserEmailChangeDialogEx),Q("dp30email").focus(),Q("dp30email").value=currentUser.email||"",serverinfo.emailcheck&&(Q("dp30verified").value=currentUser.emailVerified?1:0),p30validateEmail()),!1}function p30validateEmail(){var e=Q("dp30email").value,t=e.split("@"),t=0==e.length||2==t.length&&0<t[0].length&&1<t[1].split(".").length&&2<t[1].length&&e.length<1024&&(e!=userinfo.email||1==serverinfo.emailcheck&&Q("dp30verified").value!=(userinfo.emailVerified?1:0));QE("idx_dlgOkButton",t)}function p30showUserEmailChangeDialogEx(){var e={action:"edituser",id:currentUser._id,email:Q("dp30email").value};serverinfo.emailcheck&&(e.emailVerified=1==Q("dp30verified").value),meshserver.send(e)}function p30viewPreviousLogins(){xxdialogMode||(setModalContent("xxAddAgent","Eerdere aanmeldingen","Loading..."),meshserver.send({action:"previousLogins",userid:currentUser._id}))}function p30showUserChangePassDialog(e){if(!xxdialogMode){var t=(t="")+'<div class="form-floating mb-2"><input id=p4pass1 type=password class="form-control" maxlength=256 onchange=p30showUserChangePassDialogValidate(1) onkeyup=p30showUserChangePassDialogValidate(1) placeholder=Password></input><label for=p4pass1>Password</label></div>'+'<div class="form-floating mb-2"><input id=p4pass2 type=password class="form-control" maxlength=256 onchange=p30showUserChangePassDialogValidate(1) onkeyup=p30showUserChangePassDialogValidate(1) placeholder=Password></input><label for=p4pass2>Confirm Password</label></div>';if(65536&features&&(t+='<div class="form-floating mb-2"><input id=p4hint type=text class="form-control" maxlength=256 placeholder="Password hint"></input><label for=p4hint>Password hint</label></div>'),passRequirements){var n,o=[],a=0;for(n in passRequirements)"reset"!=n&&"hint"!=n&&(o.push(n+":"+passRequirements[n]),a++);0<a&&(t+="<div style=font-size:x-small;padding:6px>"+format("Vereisten: {0}.",o.join(", "))+"</div>")}t+='<div><label><input id=p4resetNextLogin class="form-check-input me-2" type=checkbox />Forceer wachtwoord wijziging bij de volgende aanmelding.</label></div>',1==e&&(t+='<div><label><input id=p4twoFactorRemove class="form-check-input me-2" type=checkbox />Verwijder alle Tweestapsverificatie.</label></div>'),setModalContent("xxAddAgent",format("Verander wachtwoord voor {0}",EscapeHtml(currentUser.name)),t),showModal("xxAddAgentModal","idx_dlgOkButton",function(){p30showUserChangePassDialogEx(3,e)}),p30showUserChangePassDialogValidate(),Q("p4pass1").focus(),-1==currentUser.passchange&&(Q("p4resetNextLogin").checked=!0)}}function p30showUserChangePassDialogValidate(){var e=!0;""==Q("p4pass1").value&&""==Q("p4pass2").value||(Q("p4pass1").value!=Q("p4pass2").value||passRequirements&&0==checkPasswordRequirements(Q("p4pass1").value,passRequirements))&&(e=!1),QE("idx_dlgOkButton",e)}function p30showUserChangePassDialogEx(e,t){var n=!1;1==t&&1==Q("p4twoFactorRemove").checked&&(n=!0),Q("p4pass1").value==Q("p4pass2").value&&(t={action:"changeuserpass",userid:currentUser._id,pass:Q("p4pass1").value,removeMultiFactor:n,resetNextLogin:Q("p4resetNextLogin").checked},65536&features&&(t.hint=Q("p4hint").value),meshserver.send(t))}function p30showDeleteUserDialog(){xxdialogMode||(setModalContent("xxAddAgent",format("Verwijder gebruiker {0}",EscapeHtml(currentUser.name)),format("Verwijdering van gebruiker {0} bevestigen?",EscapeHtml(currentUser.name))+'<br /><br /><label><input id=p10check type=checkbox class="form-check-input me-2" onchange=p10validateDeleteNodeDialog() />Bevestig</label>'),showModal("xxAddAgentModal","idx_dlgOkButton",p30showDeleteUserDialogEx),p10validateDeleteNodeDialog())}function p30showDeleteUserDialogEx(){meshserver.send({action:"deleteuser",userid:currentUser._id,username:currentUser.name})}function drawUserPermissions(){var e=1,t="",n=0,o=!1;for(h in meshes)meshes[h]._id.split("/")[1]==currentUser._id.split("/")[1]&&(n++,null==currentUser.links||null==currentUser.links[h])&&(o=!0);if(0<n&&o&&(t+='<button class="btn btn-primary btn-sm me-2 mb-1" onclick="return p20showAddMeshUserDialog(1)"><i class="fa-solid fa-circle-plus"></i> Apparaatgroep toevoegen</button>'),t+='<table class="table table-hover"><tbody><tr class="table-active"><th scope=col>Gemeenschappelijke apparaatgroepen</th><th scope=col></th></tr>',currentUser.links){var a=[];for(h in currentUser.links)h.startsWith("mesh/")&&null!=meshes[h]&&a.push(meshes[h]);for(h in a=getOrderedList(a,"name")){var i,s=0,r=a[h],l="",d=makeDeviceGroupRightsString(g=currentUser.links[r._id].rights);null!=r&&(userinfo.links&&null!=userinfo.links[r._id]&&null!=userinfo.links[r._id].rights&&(s=userinfo.links[r._id].rights),i="<i>Onbekende apparaatgroep</i>",r&&(i="<a href=# onclick='gotoMesh(\""+r._id+"\");haltEvent(event);'>"+EscapeHtml(r.name)+"</a>"),currentUser._id!=userinfo._id&&0!=(2&s)&&(l="<a href=# onclick='return p30removeMeshFromUser(event,\""+encodeURIComponentEx(r._id)+'")\' title="Gebruikersrechten voor deze apparaatgroep verwijderen" style=cursor:pointer><img src=images/trash.png border=0 height=10 width=10></a>',d='<span style=cursor:pointer onclick=p20showAddMeshUserDialog(1,"'+encodeURIComponentEx(r._id)+'")>'+d+" <img class=hoverButton style=cursor:pointer src=images/link5.png></span>"),t+="<tr "+(++e%2==0?"style=background-color:#DDD":"")+'><td style=width:30%><div title="Apparaat groep" class=m99></div><div>&nbsp;'+i+"<div></div></div></td><td style=width:70%><div style=float:right>"+l+"</div><div>"+d+"</div></td></tr>")}}if(1==e&&(t+="<tr><td><div style=padding:6px>&nbsp;<i>Geen gemeenschappelijke apparaatgroepen</i><div></div></div></td><td></td></tr>"),t+="</tbody></table>",null!=usergroups){if(e=1,t+="<br />",0!=(256&userinfo.siteadmin)){var c=0,u=!1;for(h in usergroups)null==usergroups[h].membershipType&&usergroups[h]._id.split("/")[1]==currentUser._id.split("/")[1]&&(c++,null==currentUser.links||null==currentUser.links[h])&&(u=!0);0<c&&u&&(t+='<button class="btn btn-primary btn-sm me-2 mb-1" onclick="return p30showAddUserGroupDialog()"><i class="fa-solid fa-circle-plus"></i> Gebruikersgroep toevoegen</button>')}if(t+='<table class="table table-hover"><tbody><tr class="table-active"><th scope=col>Gebruikersgroeps lidmaatschap</th><th scope=col></th></tr>',currentUser.links){var p=[];for(h in currentUser.links)h.startsWith("ugrp/")&&null!=usergroups[h]&&p.push(usergroups[h]);for(h in p=getOrderedList(p,"name")){var m=p[h],g=currentUser.links[p[h]._id].rights,l="",v="<i>Onbekende gebruikersgroep</i>";t+="<tr "+(++e%2==0?"style=background-color:#DDD":"")+'><td><div title="Gebruikers Groep" class=m4></div><div>&nbsp;'+(v=null!=m&&(v=EscapeHtml(m.name),null!=usergroups)?"<a href=# onclick='gotoUserGroup(\""+encodeURIComponentEx(p[h]._id)+"\");haltEvent(event);'>"+v+"</a>":v)+"<div></div></div></td><td><div style=float:right>"+(l=null==m.membershipType&&0!=(256&userinfo.siteadmin)?"<a href=# onclick='return p30RemoveUserGroup(event,\""+encodeURIComponentEx(p[h]._id)+'")\' title="Verwijder de groepslidmaatschap" style=cursor:pointer><i class="fa-solid fa-trash text-danger hoverButton"></i></a>':l)+"</div></td></tr>"}}1==e&&(t+="<tr><td><div style=padding:6px>&nbsp;<i>Geen gebruikersgroep lidmaatschap</i><div></div></div></td><td></td></tr>"),t+="</tbody></table>"}if(e=1,t+="<br />",currentUser._id.split("/")[1]==userinfo._id.split("/")[1]&&(t+='<button class="btn btn-primary btn-sm me-2 mb-1" onclick="return p20showAddMeshUserDialog(4)"><i class="fa-solid fa-circle-plus"></i> Apparaat toevoegen</button>'),t+='<table class="table table-hover"><tbody><tr class="table-active"><th scope=col>Gemeenschappelijke apparaten</th><th scope=col></th></tr>',currentUser.links){var h,f=[];for(h in currentUser.links)h.startsWith("node/")&&null!=(k=getNodeFromId(h))&&f.push(k);for(h in f.sort(nameSort),f){var k=f[h],g=currentUser.links[k._id].rights,l="",s=GetNodeRights(k),x=(userinfo.links&&null!=userinfo.links[h]&&null!=userinfo.links[h].rights&&(s=userinfo.links[h].rights),k?EscapeHtml(k.name):"<i>Onbekend apparaat</i>");0!=(2&s)&&(l="<a href=# onclick='return p30removeNodeFromUser(event,\""+encodeURIComponentEx(k._id)+'")\' title="Gebruikersrechten voor deze apparaatgroep verwijderen" style=cursor:pointer><img src=images/trash.png border=0 height=10 width=10></a>',d='<span style=cursor:pointer onclick=p20showAddMeshUserDialog(4,"'+encodeURIComponentEx(k._id)+'")>'+makeUserDeviceRightsString(g)+" <img class=hoverButton style=cursor:pointer src=images/link5.png></span>"),x="<a href=# onclick='gotoDevice(\""+k._id+"\",10);haltEvent(event);'>"+x+"</a>",t+="<tr "+(++e%2==0?"style=background-color:#DDD":"")+'><td style=width:30%><div title="Apparaat" class=si'+k.icon+"></div><div>&nbsp;"+x+"<div></div></div></td><td style=width:70%><div style=float:right>"+l+"</div><div>"+d+"</div></td></tr>"}}1==e&&(t+="<tr><td><div style=padding:6px>&nbsp;<i>Geen gemeenschappelijke apparaten</i><div></div></div></td><td></td></tr>"),t+="</tbody></table>",QH("p30html2",t)}function p30removeDeviceSharing(e,t,n,o){xxdialogMode||(setModalContent("xxAddAgent","Verwijder apparaat deling",format('Bevestig de verwijdering van apparaatdeling "{0}"?',decodeURIComponent(o))),showModal("xxAddAgentModal","idx_dlgOkButton",function(e,t){meshserver.send({action:"removeDeviceShare",nodeid:t[0],publicid:t[1]})},3,[decodeURIComponent(t),decodeURIComponent(n)]))}function p30removeNodeFromUser(e,t){xxdialogMode||(setModalContent("xxAddAgent","Apparaatmachtigingen verwijderen",format('Bevestig verwijdering van toegangsrechten voor apparaat "{0}"?',(t=getNodeFromId(decodeURIComponent(t))).name)),showModal("xxAddAgentModal","idx_dlgOkButton",function(e,t){meshserver.send({action:"adddeviceuser",nodeid:t._id,nodename:t.name,userids:[currentUser._id],rights:0,remove:!0})},3,t))}function p30removeUserFromNode(e,n){var t,o;xxdialogMode||(t=null,o="",n=decodeURIComponent(n),xxdialogButtons=3,xxdialogTag=t,n.startsWith("user/")?(setModalContent("xxAddAgent","Gebruikersmachtigingen verwijderen",(o=users&&null!=(t=users[n])?t.name:o)?format('Bevestig verwijdering van toegangsrechten voor gebruiker "{0}"?',o):"Verwijdering van toegangsrechten bevestigen?"),showModal("xxAddAgentModal","idx_dlgOkButton",function(e,t){meshserver.send({action:"adddeviceuser",nodeid:currentNode._id,nodename:currentNode.name,userids:[n],rights:0,remove:!0})})):n.startsWith("ugrp/")&&(setModalContent("xxAddAgent","Gebruikersgroepmachtigingen verwijderen",(o=usergroups&&null!=(t=usergroups[n])?t.name:o)?format('Bevestig verwijdering van toegangsrechten voor gebruikergroep "{0}"?',o):"Verwijdering van toegangsrechten bevestigen?"),showModal("xxAddAgentModal","idx_dlgOkButton",function(e,t){meshserver.send({action:"adddeviceuser",nodeid:currentNode._id,nodename:currentNode.name,userids:[n],rights:0,remove:!0})})))}function p30RemoveUserGroup(e,t){var n;xxdialogMode||null==usergroups||(n=decodeURIComponent(t),setModalContent("xxAddAgent","Lidmaatschap van gebruikersgroep verwijderen",format('Bevestig lidmaatschap verwijdering van gebruikergroep "{0}"?',null!=(t=usergroups[n])?EscapeHtml(t.name):"<i>Onbekend</i>")),showModal("xxAddAgentModal","idx_dlgOkButton",function(){p30RemoveUserGroupEx(3,n)}))}function p30RemoveUserGroupEx(e,t){meshserver.send({action:"removeuserfromusergroup",ugrpid:t,userid:currentUser._id})}function p30showAddUserGroupDialog(){if(!xxdialogMode&&null!=usergroups){var e,t="";for(e in usergroups)null!=usergroups[e].membershipType||usergroups[e]._id.split("/")[1]!=currentUser._id.split("/")[1]||null!=currentUser.links&&null!=currentUser.links[e]||(t+="<option value="+encodeURIComponentEx(e)+">"+EscapeHtml(usergroups[e].name)+"</option>");var n=addHtmlFormFloating("Gebruikers Groep",'<select id=dp2groupid class="form-select">'+t+"</select>");return xxdialogButtons=3,setModalContent("xxAddAgent","Lidmaatschap toevoegen",n),showModal("xxAddAgentModal","idx_dlgOkButton",p30showAddUserGroupDialogEx),Q("dp2groupid").focus(),!1}}function p30showAddUserGroupDialogEx(){meshserver.send({action:"addusertousergroup",ugrpid:decodeURIComponent(Q("dp2groupid").value),usernames:[currentUser._id.split("/")[2]]})}function p30removeMeshFromUser(e,t){var n;xxdialogMode||null!=(n=meshes[decodeURIComponent(t)])&&(setModalContent("xxAddAgent","Apparaatgroepmachtigingen verwijderen",format('Bevestig verwijdering van toegangsrechten voor apparaatgroep "{0}"?',n.name)),showModal("xxAddAgentModal","idx_dlgOkButton",function(){p30removeMeshFromUserEx(3,n._id)}))}function p30removeMeshFromUserEx(e,t){meshserver.send({action:"removemeshuser",meshid:t,userid:currentUser._id})}var currentUserEvents=null;function userEventsUpdate(){if(null!=currentUser){var e="",t=null;for(r in currentUserEvents){var n=currentUserEvents[r],o=new Date(n.time);if(n.msg){null==n.h&&(n.h=Math.random()),printDate(o)!=t&&(null!=t&&(e+="</table>"),e+='<table class="table table-hover p3eventsTable" cellpadding=0 cellspacing=0><tr><td colspan=4 class=DevSt>'+(t=printDate(o))+"</td></tr>");var a,i,s="fa-mobile-screen";if("user"==n.etype&&(s="fa-user"),"server"==n.etype&&(s="fa-server"),null==n.msgid||null==eventsMessageId[n.msgid])a="string"==typeof n.msg?EscapeHtml(n.msg).split("(R)").join("&reg;"):"";else{for(var r in a=eventsMessageId[n.msgid],n.msgArgs){var l=n.msgArgs[r];"string"==typeof l&&0==l.indexOf("DATETIME:")&&(l=printFlexDateTime(new Date(parseInt(l.substring(9))))),a=a.split("{"+r+"}").join(l)}a=EscapeHtml(a).split("(R)").join("&reg;")}n.nodeid&&null!=(i=getNodeFromId(n.nodeid))&&(s="si"+i.icon,a="<a href=# onclick='gotoDevice(\""+n.nodeid+"\",10);haltEvent(event);'>"+EscapeHtml(i.name)+"</a> &rarr; "+a),n.username&&n.username!=currentUser.name?(i="",n.guestname&&(i=' / <span title="Dit is een gedeelde gastsessie">'+EscapeHtml(n.guestname)+"</span>"),a=2&userinfo.siteadmin&&n.userid?"<a href=# onclick='gotoUser(\""+encodeURIComponentEx(n.userid)+"\");haltEvent(event);'>"+EscapeHtml(n.username)+"</a>"+i+" &rarr; "+a:EscapeHtml(n.guestname)+" &rarr; "+a):n.guestname&&(a='<span title="Dit is een gedeelde gastsessie">'+EscapeHtml(n.guestname)+"</span> &rarr; "+a),"relay"!=n.etype&&"relaylog"!=n.action||(s="fa-arrow-right-arrow-left"),e+="<tr onclick=showEventDetails("+n.h+',3)  onmouseover=eventMouseHover(this,1) onmouseout=eventMouseHover(this,0) style=cursor:pointer><td style=width:18px><i class="fa-solid '+s+'"></i></td><td class=g1>&nbsp;</td><td class=style10>'+printTime(o)+" - "+a+"</td></tr><tr></tr>"}}null!=t&&(e+="</table>"),""==e&&(e="<br><i>Geen gebeurtenissen gevonden</i><br><br>"),QH("p31events",e)}}function refreshUsersEvents(){""!=p31filterevents.value?meshserver.send({action:"events",limit:parseInt(p31limitdropdown.value),userid:currentUser._id,filter:p31filterevents.value}):meshserver.send({action:"events",limit:parseInt(p31limitdropdown.value),userid:currentUser._id})}var d3filetreelinkpath,p52recordings=null;function updateRecordings(){for(var e=[],t=document.getElementsByClassName("RecordingCheckbox"),n="",o=0;o<t.length;o++)t[o].checked&&e.push(t[o].value);if(null==p52recordings)n+="<div style=width:100%;text-align:center;margin-top:20px><i>Laden...</i></div>";else if("number"==typeof p52recordings)n+=1==p52recordings?"<div style=width:100%;text-align:center;margin-top:20px><i>Server kan niet lezen uit de opnamemap.</i></div>":2==p52recordings?"<div style=width:100%;text-align:center;margin-top:20px><i>Server kan geen opnamen uit de database halen.</i></div>":"<div style=width:100%;text-align:center;margin-top:20px><i>Er is een onbekende fout opgetreden.</i></div>";else if(0==p52recordings.length)n+="<div style=width:100%;text-align:center;margin-top:20px><i>Geen opnames.</i></div>";else{if(n=(n+='<table class="table table-hover" cellpadding=0 cellspacing=0><thead class="text-center"><tr>')+("<th>Sessie</th><th style=width:110px>"+nobreak("Start tijd")+"</th><th style=width:110px>Looptijd</th><th style=width:110px>Grootte</th></tr></thead><tbody>"),null!=p52recordings){var a=null;for(o in p52recordings){var i=p52recordings[o],s=printDate(new Date(i.time));s!=a&&(n+="<tr><td class=userTableHeader colspan=4>"+(a=s)),n+=addRecordingHtml(o,i)}}n+="</tbody></table>"}QH("p52recordings",n);for(t=document.getElementsByClassName("RecordingCheckbox"),o=0;o<t.length;o++)t[o].checked=0<=e.indexOf(t[o].value);p52updateInfo()}function addRecordingHtml(e,t){var n="",o=(t.lengthTime&&(n=pad2(Math.floor(t.lengthTime/3600))+":"+pad2(Math.floor(t.lengthTime%3600/60))+":"+pad2(Math.floor(t.lengthTime%60))),printTime(new Date(t.time))),a=(t.sessionStart&&(o=printTime(new Date(t.sessionStart))),""),i=(t.size&&(a=format("{0} Kb",Math.round(t.size/1024))),"<i>Onbekend</i>"),s=(t.name&&t.meshname&&(i=null!=meshes[t.meshid]?"<a href=# onclick='gotoMesh(\""+t.meshid+"\")'>"+EscapeHtml(t.meshname)+"</a> - <a href=# onclick='gotoDevice(\""+t.nodeid+"\",10)'>"+EscapeHtml(t.name)+"</a>":EscapeHtml(t.meshname)+" - "+EscapeHtml(t.name)),null!=t.userids&&0<t.userids.length&&(1<t.userids.length?i+=" - "+format("{0} users",t.userids.length):i+=(s=null)!=(s=null!=users?users[t.userids[0]]:s)?" - <a href=# onclick='gotoUser(\""+encodeURIComponentEx(t.userids[0])+"\")'>"+EscapeHtml(s.name)+"</a>":" - "+EscapeHtml(t.userids[0].split("/")[2])),1==t.protocol&&(i+=" - Terminal sessie"),2==t.protocol&&(i+=" - Desktop sessie"),5==t.protocol&&(i+=" - Bestandsoverdracht"),100==t.protocol&&(i+=" - Intel&reg; AMT WSMAN"),101==t.protocol&&(i+=" - Intel&reg; AMT omleiding"),200==t.protocol&&(i+=" - Messenger"),""),r="fa-circle-xmark text-danger",t=(1==t.present&&(r="fa-circle-check text-success",s='<div style=cursor:pointer;float:right><a onclick=downloadFile("recordings.ashx?file='+encodeURIComponentEx(t.filename)+'")><i class="fa-fw fa-solid fa-download fa-sm" title="Download Recording"></i></a>&nbsp;</div>',s+='<div style=cursor:pointer;float:right><a href="player.htm?stream='+encodeURIComponentEx(t.filename)+'") rel="noreferrer noopener" target="mcplay-'+encodeURIComponentEx(t.filename)+'"><i class="fa-fw fa-solid fa-play fa-sm" title="Play Recording"></i></a>&nbsp;</div>'),"<tr tabindex=0 onmouseover=userMouseHover2(this,1) onmouseout=userMouseHover2(this,0) onkeypress=\"if (event.key=='Enter') showRecordingDialog(event,'"+e+"')\"><td style=cursor:pointer>");return(t+="<div class=bar style=width:100%>")+"<div></div>"+('<div class=baricon onclick=showRecordingDialog(event,"'+e+'")><i class="fa-fw fa-solid '+r+'"></i></div>')+('<div class=g1 onclick=showRecordingDialog(event,"'+e+'")></div><div class=g2 onclick=showRecordingDialog("'+e+'")></div>')+('<div style=line-height:24px onclick=showRecordingDialog(event,"'+e+'")>'+s+"<div style=font-size:16px>"+i+"</div></div></div><td style=text-align:center>"+o+"<td style=text-align:center>"+n+"<td style=text-align:center>"+a)}function showRecordingDialog(e,t){if(!xxdialogMode&&"IMG"!=e.target.tagName&&"A"!=e.target.tagName){var n=p52recordings[t],o="";if(n.protocol&&(e="Onbekend",1==n.protocol&&(e="Terminal"),2==n.protocol&&(e="Bureaublad"),5==n.protocol&&(e="Bestanden"),100==n.protocol&&(e="Intel&reg; AMT WSMAN"),o+=addHtmlValue4("Protocol",e=101==n.protocol?"Intel&reg; AMT omleiding":e)),o+=addHtmlValue4("Status",1==n.present?"Aanwezig op de server":"Niet op de server"),n.name&&(o+=addHtmlValue4("Apparaat naam",EscapeHtml(n.name))),n.meshname&&(o+=addHtmlValue4("Apparaat groep",EscapeHtml(n.meshname))),n.size&&(o+=addHtmlValue4("Grootte",format("{0} bytes",n.size))),n.startTime&&(o+=addHtmlValue4("Start tijd",printTime(new Date(n.startTime)))),n.time&&(o+=addHtmlValue4("Eindtijd",printTime(new Date(n.time)))),n.lengthTime&&(o+=addHtmlValue4("Looptijd",pad2(Math.floor(n.lengthTime/3600))+":"+pad2(Math.floor(n.lengthTime%3600/60))+":"+pad2(Math.floor(n.lengthTime%60)))),1==n.multiplex&&(o+=addHtmlValue4("Multiplexor","Ingeschakeld")),n.userids)for(var t in n.userids)o+=addHtmlValue4("Gebruiker",n.userids[t].split("/")[2]);xxdialogButtons=9,setModalContent("xxAddAgent","Opname details",o),showModal("xxAddAgentModal","idx_dlgOkButton",null)}}function refreshRecodings(){meshserver.send({action:"recordings",limit:1e3})}function openRecodringPlayer(){xxdialogMode||safeNewWindow(window.location.origin+"{{{domainurl}}}player.htm","meshcentral-deskplayer")}function p52updateInfo(){for(var e=document.getElementsByClassName("RecordingCheckbox"),t=0;t<e.length;t++)!0===e[t].checked&&0}function d3init(){d3fileoptions={dialog:1,filter:"d3filter",files:"d3serverfiles",folderup:"p3FolderUp",currentFolder:"p3CurrentFolder",func:d3setActions},Q("d3localFile").value="",Q("d3localFile").accept=Q("d3filter").value,d3modechange()}function d3modechange(){var e=Q("d3uploadMode").value;QV("d3localmode",1==e),QV("d3servermode",2==e),(1==e?d3setActions:d3updatefiles)()}var d3filetreelocation=[],d3fileoptions=null;function d3updatefiles(){if(null!=d3fileoptions&&("d3filter"!=d3fileoptions.filter||1!=Q("d3uploadMode").value)){for(var e,t="",n="",o=filetree,a=1,i="",s=[],r=[],l=document.getElementsByName("fc"),d=0;d<l.length;d++)l[d].checked&&r.push(l[d].value);for(d in d3filetreelinkpath="",d3filetreelocation){if(null==o.f||null==o.f[d3filetreelocation[d]])break;s.push(d3filetreelocation[d]),1==a?(e=d3filetreelocation[d].split("/"),window.location.origin,e[0],d3filetreelocation[d]===userinfo._id?d3filetreelinkpath+="self":d3filetreelinkpath+=e[0]+"/"+e[2]):""!=d3filetreelinkpath&&(d3filetreelinkpath+="/"+d3filetreelocation[d],2<a)&&d3filetreelocation[d],i=(o=o.f[d3filetreelocation[d]]).n,a++}d3filetreelocation=s;var c=p5sort_files(o.f),u="";for(d in d3fileoptions.filter&&(u=Q(d3fileoptions.filter).value),c){var p,m,g=c[d],v=g.n;3==g.t&&""!=u&&0==g.nx.toLowerCase().endsWith(u)||(v=70<v.length?'<span title="'+EscapeHtml(v)+'">'+EscapeHtml(v.substring(0,70))+"...</span>":EscapeHtml(v),p="",null!=g.s&&(p=getFileSizeStr(g.s)),m="",m=3!=g.t?'<div class=filelist file=999><span style=float:right title=""></span><span><div class=fileIcon'+g.t+' onclick=d3folderset("'+encodeURIComponentEx(g.nx)+'")></div>&nbsp;<a href=# style=cursor:pointer onclick=\'return d3folderset("'+encodeURIComponentEx(g.nx)+"\")'>"+v+"</a></span></div>":(v=v,'<div class=filelist file=3><input style=float:left name=fcx class="fcb form-check-input me-2" type=checkbox onchange=d3setActions() value="'+g.nx+'">&nbsp;<span style=float:right>'+EscapeHtml(p)+"</span><span><div class=fileIcon"+g.t+"></div>"+v+"</span></div>"),g.t<3?t+=m:n+=m)}d3fileoptions.currentFolder&&QH(d3fileoptions.currentFolder,i),QH(d3fileoptions.files,t+n),QE(d3fileoptions.folderup,0<d3filetreelocation.length),d3fileoptions.func&&d3fileoptions.func()}}function d3folderset(e){return d3filetreelocation.push(decodeURIComponent(e)),d3updatefiles(),!1}function d3folderup(e){if(null==e)d3filetreelocation.pop();else for(;d3filetreelocation.length>e;)d3filetreelocation.pop();d3updatefiles()}function d3getFileSel(){for(var e=[],t=document.getElementsByName("fcx"),n=0;n<t.length;n++)t[n].checked&&e.push(t[n].value);return e}function d3setActions(){1==d3fileoptions.dialog?1==Q("d3uploadMode").value?QE("idx_dlgOkButton",0<Q("d3localFile").value.length):QE("idx_dlgOkButton",1==d3getFileSel().length):2==d3fileoptions.dialog&&QE("idx_dlgOkButton",1==d3getFileSel().length)}var reportCSV=null;function generateReportDialog(){if(!xxdialogMode){var e="",t="",n=JSON.parse(getstore("_ReportSettings","{}")),o={1:"Externe Sessies",2:"Gebruik van gebruikersverkeer",3:"Gebruikersaanmeldingen"};for(a in 4294967295==userinfo.siteadmin&&(o[4]="Database vermeldingen"),o)e+="<option value="+a+(n.type==a?" selected":"")+">"+o[a]+"</option>";t=t+addHtmlFormFloating("Type",'<select id=d2reportType class="form-select" onchange=generateReportDialogValidate()>'+e+"</select>")+"<div id=d2GroupByDiv style=display:none>",e="";for(a in o={1:"Gebruiker",2:"Apparaat",3:"Dag"})e+="<option value="+a+(n.groupBy==a?" selected":"")+">"+o[a]+"</option>";for(a in t=(t+=addHtmlFormFloating("Groeperen op",'<select id=d2groupBy class="form-select" onchange=generateReportDialogValidate()>'+e+"</select>"))+"</div>"+"<div id=d2GroupByDiv2 style=display:none>",e="",o={1:"Gebruiker",3:"Dag"})e+="<option value="+a+(n.groupBy2==a?" selected":"")+">"+o[a]+"</option>";t=(t+=addHtmlFormFloating("Groeperen op",'<select id=d2groupBy2 class="form-select" onchange=generateReportDialogValidate()>'+e+"</select>"))+"</div>"+"<div id=d2DeviceGroupDiv style=display:none>",e="<option value=0"+(0==n.devGroup?" selected":"")+">Alles</option>";var a,i=getOrderedList(meshes,"name");for(a in i)e+="<option value="+encodeURIComponentEx(i[a]._id)+(n.devGroup==i[a]._id?" selected":"")+">"+EscapeHtml(i[a].name)+"</option>";for(a in t=(t+=addHtmlFormFloating("Apparaat groep",'<select onchange=generateReportDialogValidate() id=d2groupId class="form-select">'+e+"</select>"))+"</div>"+"<div id=d2timeBackDiv style=display:none>",e="",null==n.timeRange&&(n.timeRange=1),o={1:"Laaste dag",7:"Laaste 7 dagen",30:"Laatste 30 dagen",0:"Tijdsbestek"})e+="<option value="+a+(n.timeRange==a?" selected":"")+">"+o[a]+"</option>";setModalContent("xxAddAgent","Genereer rapport",t=(t=(t=(t=(t+=addHtmlFormFloating("Tijd",'<select id=d2timeRange class="form-select" onchange=generateReportDialogValidate()>'+e+"</select>"))+"</div>"+"<div id=d2timeRangeDiv style=display:none>")+addHtmlFormFloating("Tijdsbestek",'<input id=d2timeRangeSelector class="flatpickr form-control" type="text" placeholder="Selecteer datum & Tijd..." data-id="altinput">'))+"</div>"+"<div id=d2showTrafficDiv style=display:none>")+addHtmlValue("",'<div style=width:250px><label><input type=checkbox class="form-check-input me-2" id=d2showTraffic '+(n.showTraffic?"checked":"")+">Toon verkeer</label><div>")+"</div>"),showModal("xxAddAgentModal","idx_dlgOkButton",generateReportDialogEx),generateReportDialogValidate();t=new Date,t=(t.setDate(t.getDate()-7),flatpickr("#d2timeRangeSelector",{mode:"range",enableTime:!0,maxDate:new Date,defaultDate:[t,new Date],minuteIncrement:1}));xxdialogTag=t}}function generateReportDialogValidate(){QV("d2timeRangeDiv",0==Q("d2timeRange").value),QV("d2timeBackDiv",4!=Q("d2reportType").value),QV("d2GroupByDiv",1==Q("d2reportType").value),QV("d2GroupByDiv2",3==Q("d2reportType").value),QV("d2DeviceGroupDiv",1==Q("d2reportType").value),QV("d2showTrafficDiv",1==Q("d2reportType").value)}function generateReportDialogEx(e,t){var n,o=0==Q("d2timeRange").value?(n=Math.floor(t.selectedDates[1].getTime()/1e3),Math.floor(t.selectedDates[0].getTime()/1e3)):(n=Math.floor(new Date/1e3),o=new Date,Math.floor(o.setDate(o.getDate()-Q("d2timeRange").value)/1e3)),t=null;try{t=Intl.DateTimeFormat().resolvedOptions().timeZone}catch(e){}var a=decodeURIComponent(Q("d2groupId").value),i=(0==a&&(a=null),putstore("_ReportSettings",JSON.stringify({type:parseInt(Q("d2reportType").value),groupBy:parseInt(Q("d2groupBy").value),groupBy2:parseInt(Q("d2groupBy2").value),timeRange:parseInt(Q("d2timeRange").value),devGroup:a,showTraffic:Q("d2showTraffic").checked})),parseInt(Q("d2groupBy").value));3==Q("d2reportType").value&&(i=parseInt(Q("d2groupBy2").value)),meshserver.send({action:"report",type:parseInt(Q("d2reportType").value),groupBy:i,start:o,end:n,tz:t,tf:(new Date).getTimezoneOffset(),l:getLang(),devGroup:a,showTraffic:Q("d2showTraffic").checked})}function renderReport(e){var t={time:"Tijd",device:"Apparaat",session:"Sessie",user:"Gebruiker",devgroup:"Apparaat groep",guest:"Gast",length:"Duur",bytesin:"Bytes in",bytesout:"Bytes uit",os:"Besturingssysteem",ip:"IP-adres",browser:"Browser",msg:"Bericht",twofactor:"2e factor"},n='<table class="table table-hover">',o=null,a=[];if(0==Object.keys(e.groups).length)reportCSV=null,QV("p60downloadReportDiv",!1),n+="<tr><td style=text-align:center;padding-top:32px>Rapport heeft geen vermeldingen geretourneerd.</tr></td>";else{for(var i in reportCSV='"Groep"',n+="<tr>",e.columns){var s=null!=t[e.columns[i].title]?t[e.columns[i].title]:EscapeHtml(e.columns[i].title),r="";e.columns[i].align?r+=";text-align:"+EscapeHtml(e.columns[i].align):r+=";text-align:left",0!=i||"datetime"!=e.columns[i].format&&"time"!=e.columns[i].format||(r+=";width:1%"),n+="<th style="+r+">"+s+"</th>",reportCSV+=',"'+csvClean(s)+'"'}for(var i in n+="</tr>",reportCSV+="\r\n",e.groups)for(var l in n=(n+="<tr style=height:8px></tr>")+("<tr><td colspan="+e.columns.length+' style="border-bottom:1pt solid black"><b>'),0!=i&&(n+=renderReportFormat(i,e.groupFormat)),n+="</b></td></tr>",e.groups[i].entries){var d,c=e.groups[i].entries[l];for(d in n+="<tr>",reportCSV+=0!=i?'"'+csvClean(renderReportFormatCSV(i,e.groupFormat))+'"':'""',e.columns){var u,p,r="";null!=e.columns[d].format&&(r="white-space:nowrap;"),e.columns[d].align&&(r="text-align:"+EscapeHtml(e.columns[d].align)),null!=c[e.columns[d].id]?(n+='<td style="'+r+'">'+renderReportFormat(c[e.columns[d].id],e.columns[d].format)+"</td>",reportCSV+=',"'+csvClean(renderReportFormatCSV(c[e.columns[d].id],e.columns[d].format))+'"'):(n+="<td></td>",reportCSV+=","),null!=e.columns[d].sumBy&&(u=c[e.columns[d].sumBy],!0===e.columns[d].sumBy&&(u=!0),p=c[e.columns[d].id],o=e.columns[d].sumBy,null!=p)&&(-1==a.indexOf(u)&&a.push(u),null==e.columns[d].subtotals&&(e.columns[d].subtotals={},e.columns[d].totals={}),null==e.columns[d].subtotals[u]?e.columns[d].subtotals[u]=p:e.columns[d].subtotals[u]+=p,null==e.columns[d].totals[u]?e.columns[d].totals[u]=p:e.columns[d].totals[u]+=p)}n+="</tr>",reportCSV+="\r\n"}if(null!=o){var m=-1;if(!0===o)m=99999;else for(var i in e.columns)e.columns[i].id==o&&(m=i);if(0<=m){a.sort();var g=!0;for(l in n+="<tr style=height:8px></tr>",a){for(var i in n+="<tr>",e.columns)i==m?(r="",e.columns[d].align&&(r+=";text-align:"+EscapeHtml(e.columns[d].align)),g&&(r+=";border-top:1pt solid #777"),n+='<td style="color:#777'+r+'">'+renderReportFormat(a[l],e.columns[i].format)):null!=e.columns[i].totals?(r="",e.columns[d].align&&(r+=";text-align:"+EscapeHtml(e.columns[d].align)),g&&(r+=";border-top:1pt solid #777"),n+='<td style="color:#777'+r+'">'+renderReportFormat(e.columns[i].totals[a[l]],e.columns[i].format)):n+="<td></td>";n+="</tr>",g=!1}}}QV("p60downloadReportDiv",!0)}n+="</table>",QH("p60report",n)}function renderReportFormat(e,t){if(null==e)return"";if("datetime"==t)return printDateTime(new Date(e));if("time"==t)return printTime(new Date(e));if("protocol"==t)return 1==e?"Terminal":2==e?"Bureaublad":5==e?"Bestanden":100==e?"AMT-WSMAN":101==e?"AMT-Redir":200==e?"Messenger":201==e?"Web-RDP":202==e?"Web-SSH":203==e?"Web-SFTP":204==e?"Web-VNC":"Onbekend ("+e+")";if("seconds"==t)return s=e%60,i=60&Math.floor(e/60),a=Math.floor(e/3600),zeroPad(a,2)+":"+zeroPad(i,2)+":"+zeroPad(s,2);if("node"==t)return null!=(o=getNodeFromId(e))?"<div onclick='gotoDevice(\""+o._id+'",10);haltEvent(event);\' style=float:left;margin-right:4px class="j'+o.icon+'"></div>'+EscapeHtml(o.name):"<i>Onbekend</i>";if("mesh"==t)return null!=(n=meshes[e])?"<div onclick='gotoMesh(\""+n._id+'",10);haltEvent(event);\' style=float:left;margin-right:4px;cursor:pointer class="m99"></div>'+EscapeHtml(n.name):"<i>Onbekend</i>";if("nodemesh"==t){var n,o,a=null,i=null,s=e.split("/"),r="<table><tr>";if(3<=s.length&&(a=s[0]+"/"+s[1]+"/"+s[2]),null!=(i=6<=s.length?s[3]+"/"+s[4]+"/"+s[5]:i)){if(null==(n=meshes[i]))return"<i>Onbekend</i>";r+="<td><div onclick='gotoMesh(\""+n._id+'",10);haltEvent(event);\' style=float:left;margin-right:4px;cursor:pointer class="m99"></div>'+EscapeHtml(n.name)+"&nbsp;&nbsp;&nbsp;</td>"}return null==(o=getNodeFromId(a))?"<i>Onbekend</i>":r=r+("<td><div onclick='gotoDevice(\""+o._id+'",10);haltEvent(event);\' style=float:left;margin-right:4px class="j'+o.icon+'"></div>'+EscapeHtml(o.name)+"</td>")+"</tr></table>"}if("user"==t)return s=null,e==userinfo._id?s=userinfo:null!=users&&(s=users[e]),null!=s?(i=s.name,null!=s.realname&&(i+=", "+s.realname),"<div onclick='gotoUser(\""+s._id+'",10);haltEvent(event);\' style=float:left;margin-right:4px;cursor:pointer><i class="fa-solid fa-user-circle"></i></div>'+EscapeHtml(i)):"<i>Onbekende gebruiker</i>";if("msg"==t){if(107==e)return'<div style=float:left;margin-right:4px;cursor:pointer><i class="fa-solid fa-check-circle text-success"></i></div>Geslaagde inlog';if(108==e)return'<div style=float:left;margin-right:4px;cursor:pointer class="NotifyIconTiny2"></div>Incorrecte 2de factor';if(109==e)return'<div style=float:left;margin-right:4px;cursor:pointer class="NotifyIconTiny4"></div>Vergrendeld account';if(110==e)return'<div style=float:left;margin-right:4px;cursor:pointer><i class="fa-solid fa-exclamation-triangle text-warning"></i></div>Invalid login attempt'}if("2fa"==t){if(""==e)return"Geen";if("backup"==e)return"Back-up codes";if("fido"==e)return"FIDO sleutel";if("sms"==e)return"SMS bericht";if("hwotp"==e)return"Hardware OTP";if("messenger"==e)return"Berichten";if("push"==e)return"Push Notificatie";if("otp"==e)return"Eenmalig wachtwoord";if("cookie"==e)return"Onthoud apparaat";if("tokenlogin"==e)return"Inlogtoken";if("ipaddr"==e)return"IP-adres";if("sso"==e)return"Eenmalig inloggen"}return"records"==t?null!=(n={node:"Apparaat vermelding",mesh:"Apparaatgroep vermelding",user:"Gebruikers vermeldingen",sysinfo:"Apparaatinformatie vermeldingen",iploc:"IP locatiegegevens vermeldingen",note:"Tekst notities vermeldingen",ifinfo:"Netwerkinterface informatie vermeldingen",cfile:"Configuratiebestand vermeldingen",lastconnect:"Laatste verbindingstijd vermeldingen",power:"Apparaat aan/uit vermeldingen",events:"Gebeurtenis vermeldingen",serverstats:"Server statistieken vermeldingen",ugrp:"Gebruikersgroep vermeldingen",deviceshare:"Apparaten delings vermeldingen",logintoken:"Token vermeldingen voor accountaanmelding",smbios:"Apparaat SMBIOS vermelding",pmt:"Apparaat Push Notificatie vermelding",meshcentral:"Apparaat, gebruikers, groepen en andere vermeldingen"})[e]?n[e]:e:EscapeHtml(e)}function renderReportFormatCSV(e,t){if("datetime"==t)return printDateTime(new Date(e));if("time"==t)return printTime(new Date(e));if("protocol"==t)return 1==e?"Terminal":2==e?"Bureaublad":5==e?"Bestanden":"Onbekend";if("node"==t){var n=getNodeFromId(e);if(null!=n)return n.name}if("mesh"==t){n=meshes[e];if(null!=n)return n.name}var o;if("user"==t)return n=null,e==userinfo._id?n=userinfo:null!=users&&(n=users[e]),null!=n?(o=n.name,null!=n.realname&&(o+=" - "+n.realname),o):"Onbekende gebruiker";if("msg"==t){if(107==e)return"Geslaagde inlog";if(108==e)return"Incorrecte 2de factor";if(109==e)return"Vergrendeld account";if(110==e)return"Invalid login attempt"}return"records"==t?renderReportFormat(e,t):""+e}function p60downloadReport(){xxdialogMode||null==reportCSV||saveAs(stringToUtf8Blob(reportCSV),"Report.csv")}var notifications=[];function clickNotificationIcon(e){1==e?QV("notifiyBox",!0):0==e?QV("notifiyBox",!1):QV("notifiyBox","none"==QS("notifiyBox").display),drawNotifications()}function setNotificationCount(e){parseInt(Q("notificationCount").innerHTML)!=e&&(QH("notificationCount",e),QS("notificationCount")["background-color"]=0==e?"lightblue":"orange",QV("notificationCount",0<e))}function drawNotifications(){var e=getstore("notifications",0),t="";if(0==notifications.length)t="<div style=margin:5px>Er zijn momenteel geen meldingen</div>";else for(var n in notifications){var o,n=notifications[n],a="",i=new Date(n.time),s=0;null!=n.title&&(a="<b>"+EscapeHtml(n.title)+"</b>: "),null!=n.nodeid&&null!=(o=getNodeFromId(n.nodeid))&&(s=o.icon,a=16&e?"<b>"+EscapeHtml(meshes[o.meshid].name)+" / "+EscapeHtml(o.name)+"</b>: ":"<b>"+EscapeHtml(o.name)+"</b>: "),t+='<div title="'+format("Heeft plaatsgevonden op {0}",printDateTime(i))+'" id="notifyx'+n.id+'" class=notification style="cursor:pointer;border-top:1px solid '+(""==t?"transparent":"orange")+'">',s&&(t+="<div class=j"+s+' onclick="notificationSelected('+n.id+')" style=margin:5px;float:left></div>'),t+='<div onclick="notificationDelete('+n.id+')" class=unselectable title="Wis deze melding" style=margin:5px;float:right;color:orange><b>X</b></div><div onclick="notificationSelected('+n.id+')" style=margin:5px>'+a+EscapeHtml(n.text)+"</div><div style=margin-left:5px;margin-bottom:5px;color:gray;font-size:10px>"+printDateTime(i)+"</div></div>"}var r="";1<notifications.length&&(r='<div id="notifyRemoveAll" onclick="deleteAllNotifications()" style="cursor:pointer;border-top:1px solid orange;margin:5px;color:orange;text-align:right;padding-right:3px">Wis alle meldingen</div>'),QH("notifiyBox",'<div class=customScroll style="max-height:170px;overflow-y:auto;margin:5px">'+t+r+"</div>")}function notificationSelected(e,t){var n,o=-1;for(n in notifications)notifications[n].id==e&&(o=n);-1!=o&&(notificationSelectedEx(notifications[o],e),t)&&notifications[o]&&(notifications[o].notification&&(notifications[o].notification.close(),delete notifications[o].notification),notificationDelete(e))}function notificationSelectedEx(e,t){null!=e.nodeid?"desktop"==e.tag?gotoDevice(e.nodeid,12):"terminal"==e.tag?gotoDevice(e.nodeid,11):"files"==e.tag?gotoDevice(e.nodeid,13):"intelamt"==e.tag?gotoDevice(e.nodeid,14):"console"==e.tag?gotoDevice(e.nodeid,15):gotoDevice(e.nodeid,10):"backupcodes"!=e.tag||xxdialogMode?null!=e.tag&&e.tag.startsWith("meshmessenger/")?(safeNewWindow("/messenger?id="+e.tag+"&title="+encodeURIComponentEx(e.username),e.tag.split("/")[2]),notificationDelete(t)):null!=e.url&&(safeNewWindow(e.url),notificationDelete(t)):(go(2),account_manageOtp(0),notificationDelete(t))}function notificationDelete(e){var t=-1,n=Q("notifyx"+e);if(null!=n){for(var o in notifications)notifications[o].id==e&&(t=o);-1!=t&&(meshserver.send({action:"intersession",subaction:"removeNotify",id:e}),notifications[t].notification&&(notifications[t].notification.close(),delete notifications[t].notification),notifications.splice(t,1),n.parentNode.removeChild(n),setNotificationCount(notifications.length),0==notifications.length&&QV("notifiyBox",!1),1==notifications.length&&QV("notifyRemoveAll",!1),0<notifications.length)&&0==t&&(n=notifications[0],QS("notifyx"+n.id)["border-top"]="1px solid transparent")}}function addNotification(e){if("number"==typeof e.titleid)try{e.title=[null,"Nieuw account","Server limiet","Beveiligingswaarschuwing","Account instellingen","Apparaat groep","Uitnodigingscode"][e.titleid]}catch(e){}if("number"==typeof e.msgid)try{e.text=[null,"Toestemming geweigerd","Ongeldige gebruikersnaam","Ongeldig wachtwoord","Ongeldig email","Ongeldig domein","Ongeldige sitemachtigingen","Gebruiker bestaat al","Kan geen gebruiker toevoegen in deze modus","Validatie uitzondering","Gebruikersaccount limiet bereikt.","Chatverzoek, klik hier om te accepteren.","Er zijn {0} mislukte inlogpogingen voor dit account sinds de laatste keer inloggen.","E-mailadres kan niet worden gewijzigd, een ander account gebruikt al: {0}.","E-mail verzonden.","Gebruiker {0} niet gevonden.","Gebruikers {0} niet gevonden.","Fout, kan niet wijzigen naar eerder gebruikt wachtwoord.","Fout, het is niet mogelijk om naar algemeen gebruikt wachtwoord te veranderen.","Fout, wachtwoord niet gewijzigd.","Wachtwoord gewijzigd.","Huidig wachtwoord is niet correct.",'Fout, uitnodigingscode "{0}" al in gebruik.',"SMS gateway niet ingeschakeld","Geen gebruikersbeheerrechten","Ongeldig SMS bericht","Geen telefoonnummer voor deze gebruiker","SMS succesvol verzonden.","SMS fout","SMS fout: {0}",'Email domein "{0}" is niet toegestaan. Alleen ({1}) is toegestaan',"Ongeldig bericht","Bericht succesvol verzonden","Bericht fout","Bericht fout: {0}"][e.msgid],Array.isArray(e.args)&&(e.text=format(e.text,e.args[0],e.args[1],e.args[2],e.args[3],e.args[4],e.args[5]))}catch(e){}null==e.time&&(e.time=Date.now()),null==e.id&&(e.id=Math.random()),notifications.unshift(e),setNotificationCount(notifications.length),clickNotificationIcon(!0);var t,n,o=getstore("notifications",0),a=(1&o&&Q("chimes").play(),null);Notification&&"granted"==Notification.permission&&(t=e.text.split("&reg;").join("").split("<b>").join("").split("</b>").join("").split("<br />").join("\r\n"),e.nodeid?(n=getNodeFromId(e.nodeid))&&(a=16&o?new Notification(decodeURIComponent("{{{extitle}}}")+" - "+meshes[n.meshid].name+" - "+n.name,{tag:e.tag,body:t,icon:"/images/notify/icons128-"+n.icon+".png"}):new Notification(decodeURIComponent("{{{extitle}}}")+" - "+n.name,{tag:e.tag,body:t,icon:"/images/notify/icons128-"+n.icon+".png"})):(null==e.icon&&(e.icon=0),o=null==(o=e.title)?"":" - "+e.title,a=new Notification(decodeURIComponent("{{{extitle}}}")+o,{tag:e.tag,body:t,icon:"/images/notify/icons128-"+e.icon+".png"})),a.id=e.id,a.xtag=e.tag,a.url=e.url,a.nodeid=e.nodeid,a.username=e.username,a.onclick=function(e){notificationSelected(e.target.id,!0)},e.notification=a),"number"==typeof e.maxtime&&0<e.maxtime&&((n=function e(){notificationDelete(e.xid)}).xid=e.id,setTimeout(n,1e3*e.maxtime))}function deleteAllNotifications(){notifications=[],setNotificationCount(0),drawNotifications(),QV("notifiyBox",!1)}function setupGeneralServerStats(){window.serverStatCpu&&window.serverStatCpu.destroy(),window.serverStatMemory&&window.serverStatMemory.destroy(),window.serverStatCpu=new Chart(document.getElementById("serverCpuChart").getContext("2d"),{type:"doughnut",data:{datasets:[{data:[0,0],backgroundColor:["#AAAAAA","#00AA00"]}],labels:["Gebruikt","Vrij"]},options:{events:[],responsive:!0,plugins:{legend:{display:!1}},animation:{animateScale:!0,animateRotate:!0},width:"40px"}}),window.serverStatMemory=new Chart(document.getElementById("serverMemoryChart").getContext("2d"),{type:"doughnut",data:{datasets:[{data:[0,0],backgroundColor:["#AAAAAA","#00AA00"]}],labels:["Gebruikt","Vrij"]},options:{events:[],responsive:!0,plugins:{legend:{display:!1}},animation:{animateScale:!0,animateRotate:!0},width:"40px"}})}var lastServerStats=null;function updateGeneralServerStats(e){if(null!=e?lastServerStats=e:e=lastServerStats,null!=e){var t,n={ServerState:"Server Status",AgentErrorCounters:"Agent fout tellers",UnknownGroup:"Onbekende groep",InvalidPKCSsignature:"Onjuiste PKCS handtekening",InvalidRSAsignature:"Ongeldige RSA handtekening",InvalidJSON:"Onjuiste JSON",UnknownAction:"Onbekende actie",BadWebCertificate:"Onjuist webcertificaat",BadSignature:"Ongeldige handtening",MaxSessionsReached:"Max Sessies bereikt",UnknownDeviceGroup:"Onbekende apparaatgroep",InvalidDeviceGroupType:"Ongeldige apparaatgroep type",DuplicateAgent:"Dubbele agent",ConnectedIntelAMT:"Verbonden Intel&reg; AMT",RelayErrors:"Doorstuurfout",UserAccounts:"Gebruikersaccounts",DeviceGroups:"Apparaatgroepen",AgentSessions:"Agent Sessies",ConnectedUsers:"Verbonden gebruikers",UsersSessions:"gebruikers Sessies",RelaySessions:"Doorstuur Sessies",RelayCount:"Relay geteld"},o=(setupGeneralServerStats(),"object"==typeof e.cpuavg&&(t=Math.min(e.cpuavg[0],1),window.serverStatCpu.config.data.datasets[0].data=[t,1-t],QH("serverCpuChartText",'<div style=margin-bottom:5px>CPU gebruik</div><div><b title="CPU-belasting in de laatste minuut">'+Math.round(100*e.cpuavg[0])/100+'</b>, <b title="CPU-belasting in de afgelopen 5 minuten">'+Math.round(100*e.cpuavg[1])/100+'</b>, <b title="CPU-belasting in de afgelopen 15 minuten">'+Math.round(100*e.cpuavg[2])/100+"</b></div>"),QS("serverCpuChartView").display="inline-block",window.serverStatCpu.update()),"number"==typeof e.totalmem&&"number"==typeof e.availablemem?(window.serverStatMemory.config.data.datasets[0].data=[e.totalmem-e.availablemem,e.availablemem],QH("serverMemoryChartText","<div style=margin-bottom:5px>Beschikbaar geheugen</div><div><b>"+getNiceSize3(e.availablemem)+"</b> vrij, <b>"+getNiceSize3(e.totalmem)+"</b> totaal</div>"),QS("serverMemoryChartView").display="inline-block",window.serverStatMemory.update()):"number"==typeof e.totalmem&&"number"==typeof e.freemem&&(window.serverStatMemory.config.data.datasets[0].data=[e.totalmem-e.freemem,e.freemem],QH("serverMemoryChartText","<div style=margin-bottom:5px>Geheugen</div><div><b>"+getNiceSize3(e.freemem)+"</b> vrij, <b>"+getNiceSize3(e.totalmem)+"</b> totaal</div>"),QS("serverMemoryChartView").display="inline-block",window.serverStatMemory.update()),"<div style=width:100% cellpadding=0 cellspacing=0>");if("object"==typeof e.values)for(var a in e.values)for(var i in o+="<div class=userTableHeader style=margin-bottom:4px;width:200px>"+(n[a]||a)+"</div>",e.values[a])o+='<div style=display:inline-block class="me-2"><table class=serverStateTableCell><tr><td></td><td><span>'+(n[i]||i)+"</span><span style=float:right>"+e.values[a][i]+"</span></td><td></td></tr></table></div>";o+="</div>",QH("serverStatsTable",o)}}var serverTimelineStats=null,serverTimelineConfig={type:"line",data:{labels:[],datasets:[{label:"",backgroundColor:"rgba(255, 99, 132, .5)",borderColor:"rgb(255, 99, 132)",data:[],fill:!0}]},options:{animation:!1,responsive:!0,maintainAspectRatio:!1,elements:{line:{cubicInterpolationMode:"monotone"}},scales:{x:{type:"time",time:{tooltipFormat:"ll HH:mm"},display:!0,title:{display:!1,text:""}},y:{type:"linear",display:!0,title:{display:!0,text:""},stacked:!0}}}};function refreshServerTimelineStats(e){null!=meshserver&&2==meshserver.State&&meshserver.send({action:"servertimelinestats",hours:720})}function pastDate(e){var t=new Date;return t.setTime(t.getTime()-36e5*e),t}function setServerTimelineStats(e){serverTimelineStats=e,updateServerTimelineStats()}function addServerTimelineStats(e){var t;null!=serverTimelineStats&&((t=null)!=Q("p40server").value&&""==(t=decodeURIComponent(Q("p40server").value))&&(t=null),e.s==t)&&(serverTimelineStats.push(e),0==(t=Q("p40type").value)?(serverTimelineConfig.data.datasets[0].data.push({x:e.time,y:e.conn.ca}),serverTimelineConfig.data.datasets[1].data.push({x:e.time,y:e.conn.cu}),serverTimelineConfig.data.datasets[2].data.push({x:e.time,y:e.conn.us}),serverTimelineConfig.data.datasets[3].data.push({x:e.time,y:e.conn.rs}),null!=e.conn.am&&serverTimelineConfig.data.datasets[4].data.push({x:e.time,y:e.conn.am})):1==t?(serverTimelineConfig.data.datasets[0].data.push({x:e.time,y:e.mem.external/1048576}),serverTimelineConfig.data.datasets[1].data.push({x:e.time,y:e.mem.heapUsed/1048576}),serverTimelineConfig.data.datasets[2].data.push({x:e.time,y:e.mem.heapTotal/1048576}),serverTimelineConfig.data.datasets[3].data.push({x:e.time,y:e.mem.rss/1048576})):3==t||4==t?updateServerTimelineStats():5==t&&"object"==typeof e.cpu&&"number"==typeof e.cpu[0]&&serverTimelineConfig.data.datasets[0].data.push({x:e.time,y:e.cpu[0]}),updateServerTimelineHours())}function updateServerTimelineHours(){serverTimelineConfig.options.scales.y.type=Q("p40log").checked?"logarithmic":"linear",serverTimelineConfig.options.scales.x.min=pastDate(Q("p40time").value),window.serverMainStats.update()}function setupServerTimelineStats(){window.serverMainStats=new Chart(document.getElementById("serverMainStats").getContext("2d"),serverTimelineConfig)}let trafficSeriesNames=["Agent","CIRA","AMT-OS","HTTP","Relay","Terminal","Bureaublad","Bestanden","WebRDP","WebSSH","WebVNC","Desktop Multiplex"],seriesColors=[[158,151,16],[16,84,158],[255,99,132],[39,158,16],[134,16,158],[0,148,255],[255,216,0],[255,127,237],[109,213,255],[89,94,255],[179,104,255],[179,104,255]];function seriesColor1(e){return"rgba("+(seriesColors[e][0]+(255-seriesColors[e][0])/1.5)+","+(seriesColors[e][1]+(255-seriesColors[e][1])/1.5)+","+(seriesColors[e][2]+(255-seriesColors[e][2])/1.5)+")"}function seriesColor2(e){return"rgba("+seriesColors[e][0]+","+seriesColors[e][1]+","+seriesColors[e][2]+")"}function updateServerTimelineStats(){if(null!=serverTimelineStats){var e=Q("p40type").value,t=pastDate(Q("p40time").value),n=[],o=null,a=!1,i=!0;if(null!=Q("p40server").value&&(""==(o=decodeURIComponent(Q("p40server").value))&&(o=null),i=!1),serverTimelineConfig.options.scales.x.min=t,serverTimelineConfig.options.scales.y.stacked=3==e||4==e,0==e){serverTimelineConfig.options.scales.y.title.text="Aantal verbindingen";for(var s={labels:[pastDate(0),t],datasets:[{label:"Agents",data:[],backgroundColor:"rgba(158, 151, 16, .1)",borderColor:"rgb(158, 151, 16)",fill:!0},{label:"Gebruikers",data:[],backgroundColor:"rgba(16, 84, 158, .1)",borderColor:"rgb(16, 84, 158)",fill:!0},{label:"Gebruikerssessie",data:[],backgroundColor:"rgba(255, 99, 132, .1)",borderColor:"rgb(255, 99, 132)",fill:!0},{label:"Doorstuur Sessies",data:[],backgroundColor:"rgba(39, 158, 16, .1)",borderColor:"rgb(39, 158, 16)",fill:!0},{label:"Intel AMT",data:[],backgroundColor:"rgba(134, 16, 158, .1)",borderColor:"rgb(134, 16, 158)",fill:!0}]},r=0;r<serverTimelineStats.length;r++){new Date(serverTimelineStats[r].time);null!=serverTimelineStats[r].s&&-1==n.indexOf(serverTimelineStats[r].s)&&(n.push(serverTimelineStats[r].s),i)&&(o=serverTimelineStats[r].s,i=!1),null==serverTimelineStats[r].s&&(a=!0),serverTimelineStats[r].s==o&&(1==serverTimelineStats[r].first&&(s.datasets[0].data.push({x:serverTimelineStats[r].time-1,y:NaN}),s.datasets[1].data.push({x:serverTimelineStats[r].time-1,y:NaN}),s.datasets[2].data.push({x:serverTimelineStats[r].time-1,y:NaN}),s.datasets[3].data.push({x:serverTimelineStats[r].time-1,y:NaN}),s.datasets[4].data.push({x:serverTimelineStats[r].time-1,y:NaN})),serverTimelineStats[r].conn&&(s.datasets[0].data.push({x:serverTimelineStats[r].time,y:serverTimelineStats[r].conn.ca}),s.datasets[1].data.push({x:serverTimelineStats[r].time,y:serverTimelineStats[r].conn.cu}),s.datasets[2].data.push({x:serverTimelineStats[r].time,y:serverTimelineStats[r].conn.us}),s.datasets[3].data.push({x:serverTimelineStats[r].time,y:serverTimelineStats[r].conn.rs}),null!=serverTimelineStats[r].conn.am))&&s.datasets[4].data.push({x:serverTimelineStats[r].time,y:serverTimelineStats[r].conn.am})}}else if(1==e){serverTimelineConfig.options.scales.y.title.text="Megabytes",s={labels:[pastDate(0),t],datasets:[{label:"Extern",data:[],backgroundColor:"rgba(158, 151, 16, .1)",borderColor:"rgb(158, 151, 16)",fill:!0},{label:"Heap gebruikt",data:[],backgroundColor:"rgba(16, 84, 158, .1)",borderColor:"rgb(16, 84, 158)",fill:!0},{label:"Heap Totaal",data:[],backgroundColor:"rgba(255, 99, 132, .1)",borderColor:"rgb(255, 99, 132)",fill:!0},{label:"RSS",data:[],backgroundColor:"rgba(39, 158, 16, .1)",borderColor:"rgb(39, 158, 16)",fill:!0}]};for(r=0;r<serverTimelineStats.length;r++)null!=serverTimelineStats[r].s&&-1==n.indexOf(serverTimelineStats[r].s)&&(n.push(serverTimelineStats[r].s),i)&&(o=serverTimelineStats[r].s,i=!1),null==serverTimelineStats[r].s&&(a=!0),serverTimelineStats[r].s==o&&(1==serverTimelineStats[r].first&&(s.datasets[0].data.push({x:serverTimelineStats[r].time-1,y:NaN}),s.datasets[1].data.push({x:serverTimelineStats[r].time-1,y:NaN}),s.datasets[2].data.push({x:serverTimelineStats[r].time-1,y:NaN}),s.datasets[3].data.push({x:serverTimelineStats[r].time-1,y:NaN})),s.datasets[0].data.push({x:serverTimelineStats[r].time,y:serverTimelineStats[r].mem.external/1048576}),s.datasets[1].data.push({x:serverTimelineStats[r].time,y:serverTimelineStats[r].mem.heapUsed/1048576}),s.datasets[2].data.push({x:serverTimelineStats[r].time,y:serverTimelineStats[r].mem.heapTotal/1048576}),s.datasets[3].data.push({x:serverTimelineStats[r].time,y:serverTimelineStats[r].mem.rss/1048576}))}else if(3==e||4==e){serverTimelineConfig.options.scales.y.title.text="Megabytes",s={labels:[pastDate(0),t],datasets:[]};for(var l=0,r=0;r<serverTimelineStats.length;r++)null!=serverTimelineStats[r].traffic&&(null!=serverTimelineStats[r].s&&-1==n.indexOf(serverTimelineStats[r].s)&&(n.push(serverTimelineStats[r].s),i)&&(o=serverTimelineStats[r].s,i=!1),null==serverTimelineStats[r].s&&(a=!0),serverTimelineStats[r].s==o)&&serverTimelineStats[r].traffic&&(0<serverTimelineStats[r].traffic.AgentCtrlIn&&(l|=1),0<serverTimelineStats[r].traffic.CIRAIn&&(l|=2),0<serverTimelineStats[r].traffic.LMSIn&&(l|=4),0<serverTimelineStats[r].traffic.httpIn&&(l|=8),serverTimelineStats[r].traffic.relayIn&&(0<serverTimelineStats[r].traffic.relayIn[0]&&(l|=16),0<serverTimelineStats[r].traffic.relayIn[1]&&(l|=32),0<serverTimelineStats[r].traffic.relayIn[2]&&(l|=64),0<serverTimelineStats[r].traffic.relayIn[5]&&(l|=128),0<serverTimelineStats[r].traffic.relayIn[10]&&(l|=256),0<serverTimelineStats[r].traffic.relayIn[11]&&(l|=512),0<serverTimelineStats[r].traffic.relayIn[12])&&(l|=1024),serverTimelineStats[r].traffic.desktopMultiplex)&&0<serverTimelineStats[r].traffic.desktopMultiplex.in&&(l|=2048);for(r=0;r<13;r++)l&1<<r&&s.datasets.push({label:trafficSeriesNames[r],data:[],backgroundColor:seriesColor1(r),borderColor:seriesColor2(r),fill:!0,steppedLine:!0});for(r=0;r<serverTimelineStats.length;r++)if(null!=serverTimelineStats[r].traffic&&(null!=serverTimelineStats[r].s&&-1==n.indexOf(serverTimelineStats[r].s)&&(n.push(serverTimelineStats[r].s),i)&&(o=serverTimelineStats[r].s,i=!1),null==serverTimelineStats[r].s&&(a=!0),serverTimelineStats[r].s==o)){if(1==serverTimelineStats[r].first)for(var d=1;d<61440;d<<=1)l&d&&s.datasets[0].data.push({x:serverTimelineStats[r].time-1,y:NaN});var c=0;3==e?(1&l&&s.datasets[c++].data.push({x:serverTimelineStats[r].time,y:serverTimelineStats[r].traffic.AgentCtrlIn?serverTimelineStats[r].traffic.AgentCtrlIn/1048576:0}),2&l&&s.datasets[c++].data.push({x:serverTimelineStats[r].time,y:serverTimelineStats[r].traffic.CIRAIn?serverTimelineStats[r].traffic.CIRAIn/1048576:0}),4&l&&s.datasets[c++].data.push({x:serverTimelineStats[r].time,y:serverTimelineStats[r].traffic.LMSIn?serverTimelineStats[r].traffic.LMSIn/1048576:0}),8&l&&s.datasets[c++].data.push({x:serverTimelineStats[r].time,y:serverTimelineStats[r].traffic.httpIn?serverTimelineStats[r].traffic.httpIn/1048576:0}),16&l&&s.datasets[c++].data.push({x:serverTimelineStats[r].time,y:serverTimelineStats[r].traffic.relayIn&&serverTimelineStats[r].traffic.relayIn[0]?serverTimelineStats[r].traffic.relayIn[0]/1048576:0}),32&l&&s.datasets[c++].data.push({x:serverTimelineStats[r].time,y:serverTimelineStats[r].traffic.relayIn&&serverTimelineStats[r].traffic.relayIn[1]?serverTimelineStats[r].traffic.relayIn[1]/1048576:0}),64&l&&s.datasets[c++].data.push({x:serverTimelineStats[r].time,y:serverTimelineStats[r].traffic.relayIn&&serverTimelineStats[r].traffic.relayIn[2]?serverTimelineStats[r].traffic.relayIn[2]/1048576:0}),128&l&&s.datasets[c++].data.push({x:serverTimelineStats[r].time,y:serverTimelineStats[r].traffic.relayIn&&serverTimelineStats[r].traffic.relayIn[5]?serverTimelineStats[r].traffic.relayIn[5]/1048576:0}),256&l&&s.datasets[c++].data.push({x:serverTimelineStats[r].time,y:serverTimelineStats[r].traffic.relayIn&&serverTimelineStats[r].traffic.relayIn[10]?serverTimelineStats[r].traffic.relayIn[10]/1048576:0}),512&l&&s.datasets[c++].data.push({x:serverTimelineStats[r].time,y:serverTimelineStats[r].traffic.relayIn&&serverTimelineStats[r].traffic.relayIn[11]?serverTimelineStats[r].traffic.relayIn[11]/1048576:0}),1024&l&&s.datasets[c++].data.push({x:serverTimelineStats[r].time,y:serverTimelineStats[r].traffic.relayIn&&serverTimelineStats[r].traffic.relayIn[12]?serverTimelineStats[r].traffic.relayIn[12]/1048576:0}),2048&l&&s.datasets[c++].data.push({x:serverTimelineStats[r].time,y:serverTimelineStats[r].traffic.desktopMultiplex&&serverTimelineStats[r].traffic.desktopMultiplex.in?serverTimelineStats[r].traffic.desktopMultiplex.in/1048576:0})):4==e&&(1&l&&s.datasets[c++].data.push({x:serverTimelineStats[r].time,y:serverTimelineStats[r].traffic.AgentCtrlOut?serverTimelineStats[r].traffic.AgentCtrlOut/1048576:0}),2&l&&s.datasets[c++].data.push({x:serverTimelineStats[r].time,y:serverTimelineStats[r].traffic.CIRAOut?serverTimelineStats[r].traffic.CIRAOut/1048576:0}),4&l&&s.datasets[c++].data.push({x:serverTimelineStats[r].time,y:serverTimelineStats[r].traffic.LMSOut?serverTimelineStats[r].traffic.LMSOut/1048576:0}),8&l&&s.datasets[c++].data.push({x:serverTimelineStats[r].time,y:serverTimelineStats[r].traffic.httpOut?serverTimelineStats[r].traffic.httpOut/1048576:0}),16&l&&s.datasets[c++].data.push({x:serverTimelineStats[r].time,y:serverTimelineStats[r].traffic.relayOut&&serverTimelineStats[r].traffic.relayOut[0]?serverTimelineStats[r].traffic.relayOut[0]/1048576:0}),32&l&&s.datasets[c++].data.push({x:serverTimelineStats[r].time,y:serverTimelineStats[r].traffic.relayOut&&serverTimelineStats[r].traffic.relayOut[1]?serverTimelineStats[r].traffic.relayOut[1]/1048576:0}),64&l&&s.datasets[c++].data.push({x:serverTimelineStats[r].time,y:serverTimelineStats[r].traffic.relayOut&&serverTimelineStats[r].traffic.relayOut[2]?serverTimelineStats[r].traffic.relayOut[2]/1048576:0}),128&l&&s.datasets[c++].data.push({x:serverTimelineStats[r].time,y:serverTimelineStats[r].traffic.relayOut&&serverTimelineStats[r].traffic.relayOut[5]?serverTimelineStats[r].traffic.relayOut[5]/1048576:0}),256&l&&s.datasets[c++].data.push({x:serverTimelineStats[r].time,y:serverTimelineStats[r].traffic.relayOut&&serverTimelineStats[r].traffic.relayOut[10]?serverTimelineStats[r].traffic.relayOut[10]/1048576:0}),512&l&&s.datasets[c++].data.push({x:serverTimelineStats[r].time,y:serverTimelineStats[r].traffic.relayOut&&serverTimelineStats[r].traffic.relayOut[11]?serverTimelineStats[r].traffic.relayOut[11]/1048576:0}),1024&l&&s.datasets[c++].data.push({x:serverTimelineStats[r].time,y:serverTimelineStats[r].traffic.relayOut&&serverTimelineStats[r].traffic.relayOut[12]?serverTimelineStats[r].traffic.relayOut[12]/1048576:0}),2048&l)&&s.datasets[c++].data.push({x:serverTimelineStats[r].time,y:serverTimelineStats[r].traffic.desktopMultiplex&&serverTimelineStats[r].traffic.desktopMultiplex.out?serverTimelineStats[r].traffic.desktopMultiplex.out/1048576:0})}}else if(5==e){serverTimelineConfig.options.scales.y.title.text="Gebruik",s={labels:[pastDate(0),t],datasets:[{label:"CPU",data:[],backgroundColor:"rgba(158, 151, 16, .1)",borderColor:"rgb(158, 151, 16)",fill:!0}]};for(r=0;r<serverTimelineStats.length;r++)"object"==typeof serverTimelineStats[r].cpu&&"number"==typeof serverTimelineStats[r].cpu[0]&&(null!=serverTimelineStats[r].s&&-1==n.indexOf(serverTimelineStats[r].s)&&(n.push(serverTimelineStats[r].s),i)&&(o=serverTimelineStats[r].s,i=!1),null==serverTimelineStats[r].s&&(a=!0),serverTimelineStats[r].s==o)&&(1==serverTimelineStats[r].first&&s.datasets[0].data.push({x:serverTimelineStats[r].time-1,y:NaN}),s.datasets[0].data.push({x:serverTimelineStats[r].time,y:serverTimelineStats[r].cpu[0]}))}if(serverTimelineConfig.data=s,window.serverMainStats.update(),0<n.length){for(var u="",r=0;r<n.length;r++)u+='<option value="'+encodeURIComponentEx(n[r])+'"'+(o==n[r]?" selected":"")+">"+EscapeHtml(n[r])+"</option>";a&&(u+='<option value=""'+(null==o?" selected":"")+">Null</option>"),QH("p40server",u)}QV("p40server",0<n.length)}}function p40downloadEvents(){for(var e="tijd, conn.agent, conn.gebruikers, conn.gebruikerssessies, conn.relaysessie, conn.intelamt, mem.extern, mem.heapused, mem.heaptotaal, mem.rss\r\n",t=0;t<serverTimelineStats.length;t++)serverTimelineStats[t].conn&&serverTimelineStats[t].mem&&(e+=new Date(serverTimelineStats[t].time)+", "+serverTimelineStats[t].conn.ca+", "+serverTimelineStats[t].conn.cu+", "+serverTimelineStats[t].conn.us+", "+serverTimelineStats[t].conn.rs+", "+(serverTimelineStats[t].conn.am||"")+", "+serverTimelineStats[t].mem.external+", "+serverTimelineStats[t].mem.heapUsed+", "+serverTimelineStats[t].mem.heapTotal+", "+serverTimelineStats[t].mem.rss+"\r\n");saveAs(stringToUtf8Blob(e),"ServerStats.csv")}var xxdialogMode,xxdialogFunc,xxdialogButtons,xxdialogTag,serverTrace=[],serverTraceSources=[];function displayServerTrace(){var e,t="",n=parseInt(Q("p41limitdropdown").value);for(e in serverTrace.length>n&&serverTrace.splice(n),serverTrace){var o,a=[];for(o in serverTrace[e].args)"object"==typeof serverTrace[e].args[o]?a.push(JSON.stringify(serverTrace[e].args[o])):a.push(serverTrace[e].args[o]);t+="<div class=traceEvent onclick=showTraceEvent("+e+")>"+EscapeHtml(new Date(serverTrace[e].time).toLocaleTimeString())+" - <b>"+EscapeHtml(serverTrace[e].source.toUpperCase())+"</b>: "+EscapeHtml(a.join(", "))+"</div>"}QH("p41events",t)}function showTraceEvent(e){var t=serverTrace[e],n="";if(!xxdialogMode&&null!=t){for(var e in t.args)"object"==typeof t.args[e]?n+=EscapeHtml(JSON.stringify(t.args[e]))+"<br /><br />":n+=EscapeHtml(t.args[e])+"<br /><br />";xxdialogButtons=1,setModalContent("xxAddAgent","Server Tracing Event","<div class=selecttext style=max-height:300px;overflow-y:auto>"+n+"</div>"),showModal("xxAddAgentModal","idx_dlgOkButton",null)}}function clearServerTracing(){serverTrace=[],displayServerTrace()}function setServerTracing(){var e='<div style="max-height:200px;overflow-y:auto">';setModalContent("xxAddAgent","Server traceren",(e+='<div style="width:100%;border-bottom:1px solid gray;margin-bottom:5px;margin-top:5px"><b>Core Server</b></div>')+('<div><label><input type=checkbox class="form-check-input me-2" id=p41c1 '+(0<=serverTraceSources.indexOf("cookie")?"checked":"")+">Cookie encoder</label></div>")+('<div><label><input type=checkbox class="form-check-input me-2" id=p41c2 '+(0<=serverTraceSources.indexOf("dispatch")?"checked":"")+">Bericht Dispatcher</label></div>")+('<div><label><input type=checkbox class="form-check-input me-2" id=p41c3 '+(0<=serverTraceSources.indexOf("main")?"checked":"")+">Hoofdserver berichten</label></div>")+('<div><label><input type=checkbox class="form-check-input me-2" id=p41c4 '+(0<=serverTraceSources.indexOf("peer")?"checked":"")+">MeshCentral Server Peering</label></div>")+('<div><label><input type=checkbox class="form-check-input me-2" id=p41c15 '+(0<=serverTraceSources.indexOf("agent")?"checked":"")+">MeshAgent verkeer</label></div>")+('<div><label><input type=checkbox class="form-check-input me-2" id=p41c14 '+(0<=serverTraceSources.indexOf("agentupdate")?"checked":"")+">MeshAgent update</label></div>")+('<div><label><input type=checkbox class="form-check-input me-2" id=p41c16 '+(0<=serverTraceSources.indexOf("cert")?"checked":"")+">Server Certificaat</label></div>")+('<div><label><input type=checkbox class="form-check-input me-2" id=p41c17 '+(0<=serverTraceSources.indexOf("db")?"checked":"")+">Server Database</label></div>")+('<div><label><input type=checkbox class="form-check-input me-2" id=p41c18 '+(0<=serverTraceSources.indexOf("email")?"checked":"")+">Email/SMS/Push verkeer</label></div>")+'<div style="width:100%;border-bottom:1px solid gray;margin-bottom:5px;margin-top:5px"><b>Webserver</b></div>'+('<div><label><input type=checkbox class="form-check-input me-2" id=p41c5 '+(0<=serverTraceSources.indexOf("web")?"checked":"")+">Webserver</label></div>")+('<div><label><input type=checkbox class="form-check-input me-2" id=p41c6 '+(0<=serverTraceSources.indexOf("webrequest")?"checked":"")+">Webserver Verzoeken</label></div>")+('<div><label><input type=checkbox class="form-check-input me-2" id=p41c7 '+(0<=serverTraceSources.indexOf("relay")?"checked":"")+">Web Socket Relay</label></div>")+('<div><label><input type=checkbox class="form-check-input me-2" id=p41c20 '+(0<=serverTraceSources.indexOf("httpheaders")?"checked":"")+">Webserver HTTP Headers</label></div>")+('<div><label><input type=checkbox class="form-check-input me-2" id=p41c21 '+(0<=serverTraceSources.indexOf("authlog")?"checked":"")+">Gebruikersauthenticatielogboek</label></div>")+'<div style="width:100%;border-bottom:1px solid gray;margin-bottom:5px;margin-top:5px"><b>Intel&reg; AMT</b></div>'+('<div><label><input type=checkbox class="form-check-input me-2" id=p41c19 '+(0<=serverTraceSources.indexOf("amt")?"checked":"")+">Intel AMT beheerder</label></div>")+('<div><label><input type=checkbox class="form-check-input me-2" id=p41c9 '+(0<=serverTraceSources.indexOf("webrelay")?"checked":"")+">Verbindings Relay</label></div>")+('<div><label><input type=checkbox class="form-check-input me-2" id=p41c10 '+(0<=serverTraceSources.indexOf("mps")?"checked":"")+">CIRA Server</label></div>")+('<div><label><input type=checkbox class="form-check-input me-2" id=p41c11 '+(0<=serverTraceSources.indexOf("mpscmd")?"checked":"")+">CIRA Server opdrachten</label></div>")+"</div>"),showModal("xxAddAgentModal","idx_dlgOkButton",setServerTracingEx)}function setServerTracingEx(){for(var e=[],t=["cookie","dispatch","main","peer","web","webrequest","relay","webrelaydata","webrelay","mps","mpscmd","swarm","swarmcmd","agentupdate","agent","cert","db","email","amt","httpheaders","authlog"],n=1;n<22;n++)try{Q("p41c"+n).checked&&e.push(t[n-1])}catch(e){}meshserver.send({action:"traceinfo",traceSources:e})}function p41downloadServerTrace(){var e,t="tijd, bron, bericht\r\n";for(e in serverTrace)t+='"'+new Date(serverTrace[e].time).toLocaleTimeString()+'","'+serverTrace[e].source+'","'+serverTrace[e].args.join(", ")+'"\r\n';return saveAs(stringToUtf8Blob(t),"servertrace.csv"),!1}function setupServiceWorker(){0!=(8&features2)&&"string"==typeof serverinfo.vapidpublickey&&null!=Notification&&"granted"==Notification.permission&&"serviceWorker"in navigator&&navigator.serviceWorker.register("serviceworker.js").then(function(e){navigator.serviceWorker.ready.then(function(e){e.pushManager.subscribe({applicationServerKey:urlBase64ToUint8Array(serverinfo.vapidpublickey),userVisibleOnly:!0}).then(function(e){meshserver.send({action:"webpush",sub:e})}).catch(function(e){console.error("Worker: Unable to subscribe to push",e)})})}).catch(function(e){console.log("Worker: Registration failed",e)})}var xxcurrentView=-1;function setDialogMode(e,t,n,o,a,i){setSessionActivity(),QV("uiMenu",!1),xxdialogMode=e,xxdialogFunc=o,xxdialogButtons=n,xxdialogTag=i,QV("id_dialogclose",2&n||8&n),QV("idx_dlgDeleteButton",4&n),QV("idx_dlgButtonBar",7&n),QV("idx_dlgMoreButtons",16&n),t&&QH("xxAddAgentTitle",t);for(var s=1;s<24;s++)QV("dialog"+s,s==e);QV("dialog",e),a&&(2==e?QH("id_dialogOptions",a):QH("id_dialogMessage",a)),0==e&&xxModal&&xxModal.hide(),MoreToggle(!1)}function dialogclose(e){setSessionActivity(),(8&xxdialogButtons||e)&&xxdialogFunc&&xxdialogFunc(e,xxdialogTag)}function center(){setSessionActivity(),11==xxcurrentView?deskAdjust():10==xxcurrentView?mainUpdate(256):1==xxcurrentView&&mainUpdate(4)}function messagebox(e,t){setSessionActivity(),QH("id_dialogMessage",t),setDialogMode(1,e,1)}function statusbox(e,t){setSessionActivity(),QH("id_dialogMessage",t),setDialogMode(1,e)}var backStack=[];function goBack(){setSessionActivity(),xxdialogMode||0==goBackStack.length||(fullscreen&&deskToggleFull(),go(goBackStack.pop()),goBackStack.pop())}function goForward(e){xxdialogMode||(backStack.push(e),goStack())}function goStack(){if(0==backStack.length)go(2);else{var e=backStack[backStack.length-1],t=e.split("/")[0];if("node"==t&&(setupDeviceMenu(0),gotoDevice(e)),"mesh"==t&&gotoMesh(e),"devices"==t&&go(1),"account"==t&&go(2),"events"==t&&go(3),"users"==t&&go(4),"files"==t){if(262144&features&&!(1==userinfo.otpsecret||0<userinfo.otphkeys||0<userinfo.otpkeys||8388608&features&&1==userinfo.otpekey))return void setDialogMode(2,"Gebruikersaccount beveiliging",1,null,'Kan deze functie niet gebruiken totdat twee-factor authenticatie is ingeschakeld. Dit is vereist voor extra beveiliging. Ga naar "Mijn account" en kijk naar de sectie "Accountbeveiliging".');go(5)}"server"==t&&go(6)}}function go(e,t){if((!t||3!=t.which&&2!=t.button)&&(262144&features&&0==count2factoraAuths()&&2<e&&(e=2,setModalContent("xxAddAgent","Gebruikersaccount beveiliging",'Unable to access this feature until two - factor authentication is enabled.This is required for extra security.Go to the "My Account" tab and look at the "Account Security" section.'),showModal("xxAddAgentModal","idx_dlgOkButton")),null!=pluginHandler&&pluginHandler.callHook("goPageStart",e,t),setSessionActivity(),!xxdialogMode))if(QV("uiMenu",!1),!t||1!=t.shiftKey&&2!=t.which&&1!=t.button||15==e||""!="{{{currentNode}}}".toLowerCase()){if(xxcurrentView!=e){xxcurrentView<0||e<10?goBackStack=[]:50!=xxcurrentView&&Math.floor(xxcurrentView/10)==Math.floor(e/10)||goBackStack.push(xxcurrentView),11==xxcurrentView&&null!=desktop&&null!=desktop.m.recordedData&&deskRecordSession(),(4==e&&null!=userinfo&&0==(2&userinfo.siteadmin)||0!=(4&features))&&(e=52),17==xxcurrentView&&deviceDetailsStatsClear();for(var n=0;n<61;n++)QV("p"+n,n==e);if(xxcurrentView=e,fullscreen&&deskToggleFull(),0==(268435456&features)&&0<xxcurrentView){var o="";for(n in 10<=xxcurrentView&&xxcurrentView<=19?null!=currentNode&&(o="?viewmode="+xxcurrentView+"&gotonode="+currentNode._id.split("/")[2]):20<=xxcurrentView&&xxcurrentView<=29?null!=currentMesh&&(o="?viewmode="+xxcurrentView+"&gotomesh="+currentMesh._id.split("/")[2]):30<=xxcurrentView&&xxcurrentView<=39?null!=currentUser&&(o="?viewmode="+xxcurrentView+"&gotouser="+(serverinfo.crossDomain?currentUser._id:currentUser._id.split("/")[2])):51<=xxcurrentView&&xxcurrentView<=51?null!=currentUserGroup&&null!=currentUserGroup._id&&(o="?viewmode="+xxcurrentView+"&gotougrp="+(serverinfo.crossDomain?currentUserGroup._id:currentUserGroup._id.split("/")[2])):1<xxcurrentView&&(o="?viewmode="+xxcurrentView),urlargs)o+=(""==o?"?":"&")+n+"="+urlargs[n];try{window.history.replaceState({},document.title,window.location.pathname+o)}catch(e){}}var a=["MainMenuMyDevices","MainMenuMyAccount","MainMenuMyEvents","MainMenuMyFiles","MainMenuMyUsers","MainMenuMyServer"];for(n in a)QC(a[n]).remove("fullselect"),QC(a[n]).remove("semiselect");var i=["LeftMenuMyDevices","LeftMenuMyAccount","LeftMenuMyEvents","LeftMenuMyFiles","LeftMenuMyUsers","LeftMenuMyServer"];for(n in i)QC(i[n]).remove("lbbuttonsel"),QC(i[n]).remove("lbbuttonsel2");var s=e<9?"fullselect":"semiselect",r=e<9||115==e||40==e||41==e||42==e?"lbbuttonsel2":"lbbuttonsel",l=0,d=(0<goBackStack.length&&(l=goBackStack[goBackStack.length-1]),1==e||1==l||0==l&&10<=e&&e<20?(QC("MainMenuMyDevices").add(s),QC("LeftMenuMyDevices").add(r)):2==e||2==l||0==l&&20<=e&&e<30?(QC("MainMenuMyAccount").add(s),QC("LeftMenuMyAccount").add(r)):3==e||60==e?(QC("MainMenuMyEvents").add(s),QC("LeftMenuMyEvents").add(r)):4==e||30<=e&&e<40||50==e||51==e||52==e?(QC("MainMenuMyUsers").add(s),QC("LeftMenuMyUsers").add(r)):5==e?(QC("MainMenuMyFiles").add(s),QC("LeftMenuMyFiles").add(r)):(6==e||115==e||40<=e&&e<50)&&(QC("MainMenuMyServer").add(s),QC("LeftMenuMyServer").add(r)),QV("ServerPlugins",null!=pluginHandler),webPageStackMenu&&10<=e?QC("column_l").add("room4submenu"):QC("column_l").remove("room4submenu"),QV("topbar",0!=e),0==e&&webPageFullScreen&&QC("body").add("arg_hide"),QV("MainSubMenuSpan",10<=e&&e<20),QV("UserDummyMenuSpan",51==e||e<10&&6!=e&&webPageFullScreen),QV("MeshSubMenuSpan",20<=e&&e<30),QV("UserSubMenuSpan",30<=e&&e<40),QV("ServerSubMenuSpan",6==e||115==e||40==e||41==e||42==e||43==e),QV("UsersSubMenuSpan",4==e||50==e||52==e),QV("EventsSubMenuSpan",3==e||60==e),{3:"EventsLive",4:"UsersGeneral",10:"MainDev",11:"MainDevDesktop",12:"MainDevTerminal",13:"MainDevFiles",14:"MainDevAmt",15:"MainDevConsole",16:"MainDevEvents",17:"MainDevInfo",19:"MainDevPlugins",20:"MeshGeneral",21:"MeshSummary",30:"UserGeneral",31:"UserEvents",6:"ServerGeneral",40:"ServerStats",41:"ServerTrace",42:"ServerPlugins",50:"UsersGroups",52:"UsersRecordings",60:"EventsReport",115:"ServerConsole"});for(n in d)QC(d[n]).remove("style3x"),QC(d[n]).remove("style3sel"),QC(d[n]).add(e==n?"style3sel":"style3x");11==e&&deskAdjust(),115==e&&QV("p15",!0),QV("p15uploadCore",115!=e),QV("p15BackButton",115!=e&&0==(32&args.hide)&&""=="{{currentNode}}".toLowerCase()),15!=e&&115!=e||setupConsole(),1==e&&mainUpdate(4),2==e&&Notification&&QV("accountEnableNotificationsSpan","granted"!=Notification.permission),40==e&&null==serverTimelineStats&&refreshServerTimelineStats(),42==e&&refreshPluginLatest(),21==e&&p21updateMesh(),52==e&&(null==p52recordings&&refreshRecodings(),updateRecordings()),12==e&&null!=xtermfit&&(xtermfit.fit(),xterm.focus()),document.title=currentNode&&10<=e&&e<20?currentNode.name+(meshes[currentNode.meshid]?" - "+meshes[currentNode.meshid].name:"")+" - "+decodeURIComponent("{{{extitle}}}"):decodeURIComponent("{{{extitle}}}"),null!=pluginHandler&&pluginHandler.callHook("goPageEnd",e,t),QS("column_l").overflow=0<=[11,12].indexOf(e)?"hidden":null}}else 10<=e&&e<=19?currentNode&&safeNewWindow(window.location.origin+"{{{domainurl}}}?gotonode="+currentNode._id.split("/")[2]+"&viewmode="+e+"&hide=16"+(urlargs.key?"&key="+urlargs.key:""),"meshcentral:"+currentNode._id):20<=e&&e<=29?currentMesh&&safeNewWindow(window.location.origin+"{{{domainurl}}}?gotomesh="+currentMesh._id.split("/")[2]+"&viewmode="+e+"&hide=16"+(urlargs.key?"&key="+urlargs.key:""),"meshcentral:"+currentMesh._id):30<=e&&e<=39?currentUser&&safeNewWindow(window.location.origin+"{{{domainurl}}}?gotouser="+(serverinfo.crossDomain?currentUser._id:currentUser._id.split("/")[2])+"&viewmode="+e+"&hide=16"+(urlargs.key?"&key="+urlargs.key:""),"meshcentral:"+currentUser._id):50<=e&&e<=59?currentUserGroup&&safeNewWindow(window.location.origin+"{{{domainurl}}}?gotougrp="+(serverinfo.crossDomain?currentUserGroup._id:currentUserGroup._id.split("/")[2])+"&viewmode="+e+"&hide=16"+(urlargs.key?"&key="+urlargs.key:""),"meshcentral:"+currentUserGroup._id):safeNewWindow(window.location.origin+"{{{domainurl}}}?viewmode="+e+"&hide=0"+(urlargs.key?"&key="+urlargs.key:""),"meshcentral:"+e)}function updatePluginList(e){if(null!=pluginHandler){if(Array.isArray(e)&&e.forEach(function(e){updatePluginList(e)}),QV("pluginNoneNotice",0==installedPluginList.length),installedPluginList.length){if(null!=e&&(null==installedPluginList.version_info&&(installedPluginList.version_info=[]),installedPluginList.version_info[e.id]=e),(n=Q("p42tbl").querySelectorAll(".p42tblRow")).length)for(var t in Object.values(n))n[t].parentNode.removeChild(n[t]);var s={0:{text:"Disabled",color:"858483"},1:{text:"Installed",color:"00aa00"}},r={0:{install:"Install",delete:"Delete"},1:{disable:"Disable",upgrade:"Upgrade"}},l=Q("p42tbl");installedPluginList.forEach(function(e){var t,n=[],o=(1==e.hasAdminPanel&&e.status?e.nameHtml="<a onclick=\"return goPlugin('"+e.shortName+"', '"+e.name.replace(/'/g,"\\'")+"');\">"+EscapeHtml(e.name)+"</a>":e.nameHtml=EscapeHtml(e.name),e.statusText=s[e.status].text,e.statusColor=s[e.status].color,null==e.versionHistoryUrl&&n.push("downgrade"),e.status||(e.version=" - "),e.upgradeAvail="Controleren...",null!=installedPluginList.version_info&&null!=installedPluginList.version_info[e._id]&&(!(a=installedPluginList.version_info[e._id]).hasUpdate&&(n.push("upgrade"),e.status)?e.upgradeAvail="Bijgewerkt":e.upgradeAvail='<a title="Bekijk aanpassingen log" rel="noreferrer noopener" target="_blank" href="'+a.changelogUrl+'">'+a.version+"</a>",a.meshCentralCompat||(e.upgradeAvail+=" [ <span onclick=\"return setModalContent('xxAddAgent', 'Compatibility Issue', 'This plugin version is not compatible with your MeshCentral installation, please upgrade MeshCentral first.');showModal('xxAddAgentModal', 'idx_dlgOkButton');\" title=\"Versie is niet compatibel, upgrade eerst uw MeshCentral installatie\" style=\"cursor: pointer; color:red;\"> ! </span> ]",n.push("install"),n.push("upgrade"))),e.actions="<select onchange=\"return pluginAction(this,'"+e._id+'\');"><option value=""> --</option>',Object.entries(r[e.status]));for(t in o)-1===n.indexOf(o[t][0])&&(e.actions+='<option value="'+o[t][0]+'">'+o[t][1]+"</option>");e.actions+="</select>";var a="<td><img style=margin-top:3px src=images/plugin24.png></td><td class=gradTable1>&nbsp;</td><td class=gradTable2>"+e.nameHtml+"</td><td class=gradTable2>"+EscapeHtml(e.description)+'</td><td class=gradTable2 style=text-align:center><a href="'+EscapeHtml(e.homepage)+'" rel="noreferrer noopener" target="_blank">Home</a></td><td class=gradTable2 style=text-align:center>'+EscapeHtml(e.version)+'</td><td style=text-align:center class="pluginUpgradeAvailable gradTable2">'+e.upgradeAvail+'</td><td class=gradTable2 style="text-align:center;color:#'+e.statusColor+'">'+e.statusText+'</td><td class="pluginAction gradTable2" style=text-align:center>'+e.actions+"</td><td class=gradTable3>&nbsp;</td>",i=l.insertRow(-1);i.innerHTML=a,i.classList.add("p42tblRow"),i.setAttribute("data-id",e._id),i.setAttribute("id","pluginRow-"+e._id)})}else{var n=Q("p42tbl").querySelectorAll(".p42tblRow");for(t in Object.values(n))n[t].parentNode.removeChild(n[t])}null==e&&refreshPluginLatest()}}function refreshPluginLatest(){null!=pluginHandler&&meshserver.send({action:"pluginLatestCheck"})}function distributeCore(){null!=pluginHandler&&(meshserver.send({action:"distributeCore",nodes:nodes}),QV("pluginRestartNotice",!1))}function pluginActionEx(){if(null!=pluginHandler){var e=Q("lastPluginAct").value,t=Q("lastPluginId").value,n=Q("lastPluginVersion").value;switch(e){case"upgrade":case"install":meshserver.send({action:"installplugin",id:t,version_only:!1});break;case"downgrade":Q("lastPluginVersion").querySelectorAll("option").forEach(function(e){e.value==n&&(pVers=e.text)}),meshserver.send({action:"installplugin",id:t,version_only:{name:pVers,url:n}});break;case"delete":meshserver.send({action:"removeplugin",id:t});break;case"disable":meshserver.send({action:"disableplugin",id:t})}QV("pluginRestartNotice",!0)}}function pluginAction(e,t){if(null!=pluginHandler){if("downgrade"==e.value)meshserver.send({action:"getpluginversions",id:t});else{var n,o=null;for(n in installedPluginList)installedPluginList[n]._id==t&&(o=installedPluginList[n]);setModalContent("xxAddAgent","Plugin Actie",format("Weet u zeker dat u de plug-in {0} wilt gebruiken: {1}",e.value,o.name)+'<input id="lastPluginAct" type="hidden" value="'+e.value+'" /><input id="lastPluginId" type="hidden" value="'+t+'" /><input id="lastPluginVersion" type="hidden" value="" />'),showModal("xxAddAgentModal","idx_dlgOkButton",()=>pluginActionEx())}e.value=""}}function goPlugin(e,t){null!=pluginHandler&&(null==e?Q("p43iframe").src="":(QH("p43title",t),Q("p43iframe").src="/pluginadmin.ashx?pin="+e,go(43)))}function removeUserRights(e,t){var n;return t==userinfo._id&&null!=userinfo.removeRights&&((n=t=0)!=(8&userinfo.removeRights)&&(n+=8),0!=(65536&userinfo.removeRights)&&(t+=65536),0!=(256&userinfo.removeRights)&&(t+=256),0!=(512&userinfo.removeRights)&&(t+=512),0!=(1024&userinfo.removeRights)&&(t+=1024),0!=(16&userinfo.removeRights)&&(n+=16),0!=(32768&userinfo.removeRights)&&(n+=32768),0!=(131072&userinfo.removeRights)&&(n+=131072),0!=(64&userinfo.removeRights)&&(n+=64),0!=(262144&userinfo.removeRights)&&(n+=262144),e=4294967295!=e?(e|t)&4294967295-n:((e=2015471)|t)&4294967295-n),e}function GetMeshRights(e,t){if(null==e)return 0;if(null==t&&(t=userinfo._id),null==(e="string"==typeof e?meshes[e]:e)||null==e.links)return 0;if(serverinfo.manageAllDeviceGroups&&t==userinfo._id)return removeUserRights(4294967295,t);var n=0,o=e.links[t];if(null!=o){if(4294967295==o.rights)return removeUserRights(4294967295,t);n=o.rights}var a=null;if(t==userinfo._id?a=userinfo:null!=users&&(a=users[t]),null!=a)for(var i in a.links)if(i.startsWith("ugrp/")&&null!=(o=e.links[i])){if(4294967295==o.rights)return removeUserRights(4294967295,t);n|=o.rights}return removeUserRights(n,t)}function IsMeshViewable(e,t){if(null!=e&&(null==t&&(t=userinfo._id),null!=(e="string"==typeof e?meshes[e]:e))&&null!=e.links){if(null!=e.links[t])return!0;if(serverinfo.manageAllDeviceGroups&&t==userinfo._id)return!0;var n=null;if(t==userinfo._id?n=userinfo:null!=users&&(n=users[t]),null!=n)for(var o in n.links)if(o.startsWith("ugrp/")&&null!=e.links[o])return!0}return!1}function GetNodeRights(e,t){if(null==e)return 0;if(null==t&&(t=userinfo._id),"string"==typeof e&&null==(e=getNodeFromId(e)))return 0;var n=GetMeshRights(e.meshid,t);if(4294967295!=n&&(null!=e.links&&null!=e.links[t]&&(n|=e.links[t].rights),null!=e.links)&&null!=userinfo.links)for(var o in e.links)o.startsWith("ugrp/")&&null!=userinfo.links[o]&&null!=e.links[o].rights&&(n|=e.links[o].rights);return removeUserRights(n,t)}function IsNodeViewable(e,t){if(null!=e&&(null==t&&(t=userinfo._id),"string"!=typeof e||null!=(e=getNodeFromId(e)))){if(IsMeshViewable(e.meshid,t))return!0;if(null!=e.links&&null!=e.links[t])return!0;if(null!=e.links&&null!=userinfo.links)for(var n in e.links)if(n.startsWith("ugrp/")&&null!=userinfo.links[n]&&null!=e.links[n].rights)return!0}return!1}if("undefined"==typeof TextEncoder){window.TextEncoder=function(){},TextEncoder.prototype.encode=function(e){for(var t,n=e.length,o=-1,a="undefined"==typeof Uint8Array?new Array(1.5*n):new Uint8Array(3*n),i=0,s=0;s!==n;){if(i=e.charCodeAt(s),s+=1,55296<=i&&i<=56319){if(s===n){a[o+=1]=239,a[o+=1]=191,a[o+=1]=189;break}if(!(56320<=(t=e.charCodeAt(s))&&t<=57343)){a[o+=1]=239,a[o+=1]=191,a[o+=1]=189;continue}if(s+=1,65535<(i=1024*(i-55296)+t-56320+65536)){a[o+=1]=240|i>>>18,a[o+=1]=128|i>>>12&63,a[o+=1]=128|i>>>6&63,a[o+=1]=128|63&i;continue}}i<=127?a[o+=1]=0|i:(i<=2047?a[o+=1]=192|i>>>6:(a[o+=1]=224|i>>>12,a[o+=1]=128|i>>>6&63),a[o+=1]=128|63&i)}return"undefined"!=typeof Uint8Array?a.subarray(0,o+1):(a.length=o+1,a)},TextEncoder.prototype.toString=function(){return"[object TextEncoder]"};try{Object.defineProperty(TextEncoder.prototype,"encoding",{get:function(){if(TextEncoder.prototype.isPrototypeOf(this))return"utf-8";throw TypeError("Illegal invocation")}})}catch(e){TextEncoder.prototype.encoding="utf-8"}"undefined"!=typeof Symbol&&(TextEncoder.prototype[Symbol.toStringTag]="TextEncoder")}function urlBase64ToUint8Array(e){for(var e=(e+"=".repeat((4-e.length%4)%4)).replace(/-/g,"+").replace(/_/g,"/"),t=atob(e),n=new Uint8Array(t.length),o=0;o<t.length;++o)n[o]=t.charCodeAt(o);return n}function joinPaths(){var e,t=[];for(e in arguments){var n=arguments[e];if(null!=n&&""!=n){for(;n.endsWith("/")||n.endsWith("\\");)n=n.substring(0,n.length-1);for(;n.startsWith("/")||n.startsWith("\\");)n=n.substring(1);t.push(n)}}return t.join("/")}function putstore(e,t){try{if("undefined"==typeof localStorage||localStorage.getItem(e)==t)return;null==t?localStorage.removeItem(e):localStorage.setItem(e,t)}catch(e){}if("_"!=e[0]){var n={};try{for(var o=0,a=localStorage.length;o<a;++o){var i=localStorage.key(o);"_"!=i[0]&&(n[i]=localStorage.getItem(i),"desktopsettings"!=i)&&"stars"!=i&&"deskKeyShortcuts"!=i&&"deskStrings"!=i&&"cmdopt"!=i&&"string"==typeof n[i]&&64<n[i].length&&delete n[i]}}catch(e){}meshserver.send({action:"userWebState",state:JSON.stringify(n)})}}function stringToUtf8Blob(e){var t=(new TextEncoder).encode(e),n=new Uint8Array(3+t.length);n[0]=239,n[1]=187,n[2]=191;for(var o=0;o<t.length;o++)n[o+3]=t[o];return new Blob([n],{type:"application/octet-stream"})}function stringToUtf8BlobNoHeader(e){return new Blob([(new TextEncoder).encode(e)],{type:"application/octet-stream"})}function multiTranslate(e){var t=e.indexOf("]|");return e.substring(t+2)}function getLang(){return null!=navigator.languages?navigator.languages[0]:navigator.language}function getNodeAmtVersion(e){return null==e||null==e.intelamt||"string"!=typeof e.intelamt.ver||(e=e.intelamt.ver.split(".")).length<2?0:parseInt(e[0])+parseInt(e[1])/100}function getstore(e,t){try{var n;return"undefined"==typeof localStorage?t:null==(n=localStorage.getItem(e))?t:n}catch(e){return t}}function addLink(e,t){return'<span tabindex=0 role="button" onclick=\''+t+"' onkeypress=\"if (event.key=='Enter') {"+t+'} ">'+e+' <i class="fa-solid fa-pencil fa-xs"></i></span>'}function addLinkConditional(e,t,n){return n?addLink(e,t):e}function addKeyLink(e,t){return"<span tabindex=0 role=button onclick="+t+" onkeypress=\"if (event.key=='Enter') { "+t+' } ">'+e+' <i class="fa-solid fa-key"></i></span>'}function addKeyLinkConditional(e,t,n){return n?"<span title='"+t+"'>"+e+' <i class="fa-solid fa-key"></i></span>':e}function haltEvent(e){return e.preventDefault&&e.preventDefault(),e.stopPropagation&&e.stopPropagation(),!1}function addOption(e,t,n){var o=document.createElement("option");o.text=t,o.value=n,Q(e).add(o)}function passwordcheck(e){return 7<e.length&&/\d/.test(e)&&/[a-z]/.test(e)&&/[A-Z]/.test(e)&&/\W/.test(e)}function methodcheck(e){return!(!e||null==e||!e.Body||"SUCCESS"==e.Body.ReturnValueStr||(messagebox("Oproepfout",e.Header.Method+": "+e.Body.ReturnValueStr.replace("_"," ")),0))}function TableStart(){return"<table cellpadding=0 cellspacing=0 style=width:100%;border-radius:8px><tr><td width=200px><p><td>"}function TableStart2(){return"<table cellpadding=0 cellspacing=0 style=width:100%;border-radius:8px><tr><td><p><td>"}function TableEntry(e,t){return"<tr><td><p>"+e+"<td>"+t}function FullTable(e,t){var n=TableStart();for(i in e)i&&e[i]&&(n+=TableEntry(i,e[i]));return n+TableEnd(t)}function TableEnd(e){return"<tr><td colspan=2><p>"+(e||"")+"</table>"}function AddButton(e,t){return'<input type=button value="'+e+'" onclick="'+t+'" style=margin:4px>'}function AddButton2(e,t){return'<input type=button value="'+e+'" onclick="'+t+'">'}function AddRefreshButton(e){return'<input type=button name=refreshbtn value=Refresh onclick="refreshButtons(false);'+e+'" style=margin:4px '+(0==refreshButtonsState?"disabled":"")+">"}function MoreStart(){return"<div id=idx_dlgMoreButtons3 style=display:none><hr>"}function MoreEnd(){return"</div>"}function MoreToggle(e){QV("idx_dlgMoreButtons1",!e),QV("idx_dlgMoreButtons2",e),QV("idx_dlgMoreButtons3",e)}function getSelectedOptions(e){for(var t,n=[],o=0,a=e.options.length;o<a;o++)(t=e.options[o]).selected&&n.push(t.value);return n}function getInstance(e,t){for(var n in e)if(e[n].InstanceID==t)return e[n];return null}function getItem(e,t,n){for(var o in e)if(e[o][t]==n)return e[o];return null}function guidToStr(e){return e.substring(6,8)+e.substring(4,6)+e.substring(2,4)+e.substring(0,2)+"-"+e.substring(10,12)+e.substring(8,10)+"-"+e.substring(14,16)+e.substring(12,14)+"-"+e.substring(16,20)+"-"+e.substring(20)}function getUrlVars(){for(var e,t=[],n=window.location.href.slice(window.location.href.indexOf("?")+1).split("&"),o=0;o<n.length;o++)0<(e=n[o].indexOf("="))&&(t[n[o].substring(0,e)]=n[o].substring(e+1,n[o].length));return t}function addHtmlValue(e,t,n=[]){return`<div class="row mb-1"><div class="${n[0]||"col col-md-2 col-lg-2"}"><b>${e}</b></div><div class="${n[1]||"col col-md-10 col-lg-10"}">${t}</div></div>`}function addHtmlFormFloating(e,t,n=[]){return`<div class="row mb-1"><div class="form-floating mb-3 ${n[0]||"col-md-12"}">${t}<label class="${n[1]||"ms-2"}">${e}</label></div></div>`}function addHtmlValue2(e,t){return"<div><div style=display:inline-block;float:right>"+t+"</div><div style=display:inline-block>"+e+"</div></div>"}function addHtmlValue3(e,t){return"<div><b>"+e+"</b></div><div style=margin-left:16px>"+t+"</div>"}function addHtmlValue4(e,t){return"<table style=width:100%><td style=width:120px>"+e+"<td style=text-align:right><b>"+t+"</b></table>"}function addHtmlValue5(e,t){return"<div style=padding:4px><div style=display:inline-block;float:right><b>"+t+"</b></div><div style=display:inline-block>"+e+"</div></div>"}function focusTextBox(e){setTimeout(function(){Q(e).selectionStart=Q(e).selectionEnd=65535,Q(e).focus()},0)}function validateEmail(e){return/^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/.test(e)}function isPrivateIP(e){return e.startsWith("10.")||e.startsWith("172.16.")||e.startsWith("192.168.")}function u2fSupported(){return window.u2f&&(0<navigator.userAgent.indexOf("Chrome/")||0<navigator.userAgent.indexOf("Firefox/")||0<navigator.userAgent.indexOf("Opera/")||0<navigator.userAgent.indexOf("Safari/"))}function findOne(t,e){return null!=t&&null!=e&&e.some(function(e){return 0<=t.indexOf(e)})}function copyTextToClip(e){var t,n=document.createElement("DIV");n.textContent=e,document.body.appendChild(n),e=n,document.selection?((t=document.body.createTextRange()).moveToElementText(e),t.select()):window.getSelection&&((t=document.createRange()).selectNode(e),window.getSelection().removeAllRanges(),window.getSelection().addRange(t)),document.execCommand("copy"),n.remove()}function copyTextToClip2(e){var t,n=document.createElement("DIV");n.textContent=decodeURIComponent(e),document.body.appendChild(n),e=n,document.selection?((t=document.body.createTextRange()).moveToElementText(e),t.select()):window.getSelection&&((t=document.createRange()).selectNode(e),window.getSelection().removeAllRanges(),window.getSelection().addRange(t)),document.execCommand("copy"),n.remove()}function capitalizeFirstLetter(e){return e.charAt(0).toUpperCase()+e.slice(1)}function printDate(e){return e.toLocaleDateString(args.locale)}function printTime(e){return e.toLocaleTimeString(args.locale)}function printDateTime(e){return e.toLocaleString(args.locale)}function printFlexDateTime(e){return(printDate(new Date)==printDate(e)?printTime:printDateTime)(e)}function addDetailItem(e,t,n,o=[]){return`<div class="row mb-1"><div class="${o[0]||"col-md-8"}"> ${nobreak(e)} </div><div class="${o[1]||"col-md-4 text-end"}"> ${t} </div></div>`}function format(e){var n=Array.prototype.slice.call(arguments,1);return e.replace(/{(\d+)}/g,function(e,t){return void 0!==n[t]?n[t]:e})}function addTextLink(e,t,n){var o=t.toLowerCase().indexOf(e.toLowerCase());return-1==o?t:t.substring(0,o)+'<a href="'+n+'">'+e+"</a>"+t.substring(o+e.length)}function getOrderedList(e,n){var t,o=[];for(t in e)o.push(e[t]);return o.sort(function(e,t){e=e[n].toLowerCase(),t=t[n].toLowerCase();return t<e?1:e<t?-1:0}),o}function capitalizeFirstLetter(e){return e.charAt(0).toUpperCase()+e.slice(1)}function nobreak(e){return e.split(" ").join("&nbsp;")}function pad2(e){e="00"+e;return e.substr(e.length-2)}function encodeURIComponentEx(e){return encodeURIComponent(e).replace(/'/g,"%27")}function getUserName(e){var t=e.split("/"),n=t[0]+"/"+t[1]+"/"+t[2],o="";if(4==t.length&&t[3].startsWith("guest:")&&(o=" - "+decode_utf8(atob(t[3].substring(6)))),users&&null!=users[n])return null!=users[n].realname?users[n].realname+o:users[n].name+o;if(currentNode&&currentNode.links&&currentNode.links[e]&&null!=currentNode.links[e].name)return currentNode.links[e].name+o;if(e==userinfo._id)return userinfo.name+o;if(nodes)for(var a in nodes)if(nodes[a].links)for(var i in nodes[a].links)if(nodes[a].links[i].name&&i==e)return nodes[a].links[i].name+o;return t[2]+o}function round(e,t){t=Math.pow(10,t||0);return Math.round(e*t)/t}function safeNewWindow(e,t){e=window.open(e,t,"noopener,noreferrer");e&&(e.opener=null)}function isWindowsNode(e){return 2==e.mtype&&null!=e.agent&&null!=e.agent.id&&0<=[1,2,3,4,21,22,34,42,43].indexOf(e.agent.id)}function downloadFile(e,t,n){var o=document.createElement("a");o.setAttribute("href",e),o.setAttribute("rel","noreferrer noopener"),o.setAttribute("target","fileDownloadFrame"),o.setAttribute("download",decodeURIComponent(t||"")),document.body.appendChild(o),o.click(),document.body.removeChild(o),n&&setDialogMode(0)}function dialogBoxDrag(){var t=Q("xxAddAgentModal"),n=0,o=0,a=0,i=0;function s(e){(e=e||window.event).preventDefault(),n=a-e.clientX,o=i-e.clientY,a=e.clientX,i=e.clientY,t.style.top=t.offsetTop-o+"px",t.style.left=t.offsetLeft-n+"px"}function r(){document.onmouseup=null,document.onmousemove=null}Q("dialogHeader").onmousedown=function(e){(e=e||window.event).preventDefault(),a=e.clientX,i=e.clientY,document.onmouseup=r,document.onmousemove=s}}window.addEventListener("beforeunload",function(e){(null!=desktop&&11==xxcurrentView||null!=terminal&&12==xxcurrentView)&&(e.preventDefault(),e.returnValue="")})</script>