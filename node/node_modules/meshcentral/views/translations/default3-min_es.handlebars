<!doctypehtml><html lang=es dir=ltr xmlns=http://www.w3.org/1999/xhtml><meta http-equiv=X-UA-Compatible content="IE=edge"><meta http-equiv=Content-Type content="text/html;charset=utf-8"><meta name=viewport content="user-scalable=1,initial-scale=1,minimum-scale=1,maximum-scale=1"><meta name=apple-mobile-web-app-capable content=yes><meta name=format-detection content="telephone=no"><meta name=robots content=noindex,nofollow><link rel=manifest href={{{domainurl}}}manifest.json><link type=image/x-icon href={{{domainurl}}}favicon.ico rel="shortcut icon"><link keeplink=1 type=text/css href=styles/style-bootstrap.css media=screen rel=stylesheet title=CSS><link type=text/css href=styles/ol.css media=screen rel=stylesheet title=CSS><link type=text/css href=styles/ol3-contextmenu.min.css media=screen rel=stylesheet title=CSS><link type=text/css href=styles/xterm.css media=screen rel=stylesheet title=CSS><link type=text/css href=styles/flatpickr.min.css media=screen rel=stylesheet title=CSS><link id=theme-stylesheet href=styles/bootstrap{{{min}}}.css rel=stylesheet title=CSS><link href=styles/sweetalert2.min.css rel=stylesheet title=CSS><link href=styles/select2.min.css rel=stylesheet title=CSS><link href=styles/select2-bootstrap-5-theme.min.css rel=stylesheet title=CSS><link rel=apple-touch-icon href=/favicon-303x303.png><script src=scripts/common-0.0.1{{{min}}}.js></script><script src=scripts/meshcentral{{{min}}}.js></script><script src=scripts/amt-0.2.0{{{min}}}.js></script><script src=scripts/amt-wsman-0.2.0{{{min}}}.js></script><script src=scripts/amt-desktop-0.0.2{{{min}}}.js></script><script src=scripts/amt-terminal-0.0.2{{{min}}}.js></script><script src=scripts/zlib{{{min}}}.js></script><script src=scripts/zlib-inflate{{{min}}}.js></script><script src=scripts/zlib-adler32{{{min}}}.js></script><script src=scripts/zlib-crc32{{{min}}}.js></script><script src=scripts/amt-redir-ws-0.1.0{{{min}}}.js></script><script src=scripts/amt-wsman-ws-0.2.0{{{min}}}.js></script><script src=scripts/agent-redir-ws-0.1.1{{{min}}}.js></script><script src=scripts/agent-redir-rtc-0.1.0{{{min}}}.js></script><script src=scripts/agent-desktop-0.0.2{{{min}}}.js></script><script src=scripts/agent-rdp-0.0.1{{{min}}}.js></script><script src=scripts/qrcode.min.js></script><script src=scripts/xterm{{{min}}}.js></script><script src=scripts/xterm-addon-fit{{{min}}}.js></script><script src=scripts/flatpickr.js></script><script src=mstsc/mstsc.js></script><script src=mstsc/keyboard.js></script><script src=mstsc/rle.js></script><script src=mstsc/client.js></script><script src=mstsc/canvas.js></script><script src=scripts/jquery{{{min}}}.js></script><script src=scripts/bootstrap{{{min}}}.js></script><script src=scripts/fontawesome/all.min.js></script><script src=scripts/sweetalert2.all.min.js></script><script src=scripts/select2.full.min.js></script><script src=scripts/themes/theme-switcher.js></script><script keeplink=1 src=scripts/u2f-api{{{min}}}.js></script><script keeplink=1 src=scripts/charts{{{min}}}.js></script><script keeplink=1 src=scripts/moment{{min}}.js></script><script keeplink=1 src=scripts/chartjs-adapter-moment{{{min}}}.js></script><script keeplink=1 src=scripts/filesaver.min.js></script><script keeplink=1 src=scripts/ol{{{min}}}.js></script><script keeplink=1 src=scripts/ol3-contextmenu{{{min}}}.js></script><script keeplink=1 src=scripts/purify{{{min}}}.js></script><script keeplink=1 src=scripts/marked{{{min}}}.js></script><title>{{{title}}}</title><body id=body oncontextmenu=handleContextMenu(event) style=display:none;min-width:495px onload='"undefined"!=typeof startup&&startup()'><div id=contextMenu class="contextMenu noselect"style=display:none><div id=cxinfo class=cmtext onclick=cmaction(1,event)><b>Información</b></div><div id=cxdesktop class=cmtext onclick=cmaction(3,event)>Escritorio</div><div id=cxterminal class=cmtext onclick=cmaction(2,event)>Terminal</div><div id=cxfiles class=cmtext onclick=cmaction(4,event)>Archivos</div><div id=cxevents class=cmtext onclick=cmaction(5,event)>Eventos</div><div id=cxdetails class=cmtext onclick=cmaction(6,event)>Detalles</div><div id=cxconsole class=cmtext onclick=cmaction(7,event)>Consola</div><div id=cxwebrdp class=cmtext onclick=cmaction(11,event)>Web-RDP</div><div id=cxwebvnc class=cmtext onclick=cmaction(12,event)>Web-VNC</div><div id=cxwebssh class=cmtext onclick=cmaction(13,event)>Web-SSH</div><div id=cxrdp class=cmtext onclick=cmaction(14,event)>RDP</div><div id=cxplugins class=cmtext onclick=cmaction(8,event) style=display:none>Plugins</div><hr id=cxmgroupsplit><div id=cxstar class=cmtext onclick=cmaction(10,event) style=display:none>Alternar Favorito</div><div id=cxmdesktop class=cmtext onclick=cmaction(9,event) style=display:none>Multi-escritorio</div></div><div id=meshContextMenu class="contextMenu noselect"style=display:none;min-width:0><div id=cxselectall class=cmtext onclick=cmmeshaction(1,event)>Seleccionar Todo</div><div id=cxselectnone class=cmtext onclick=cmmeshaction(2,event)>No seleccionar nada</div></div><div id=altPortContextMenu class="contextMenu noselect"style=display:none;min-width:0><div class=cmtext onclick=cmaltportaction(1,event)>Alternar Puerto</div></div><div id=sshPortContextMenu class="contextMenu noselect"style=display:none;min-width:0><div class=cmtext onclick=cmsshportaction(1,event)>Alternar Puerto</div></div><div id=rfbPortContextMenu class="contextMenu noselect"style=display:none;min-width:0><div class=cmtext onclick=cmrfbportaction(1,event)>Alternar Puerto</div></div><div id=httpPortContextMenu class="contextMenu noselect"style=display:none;min-width:0><div class=cmtext onclick=cmhttpportaction(1,event)>Alternar Puerto</div></div><div id=httpsPortContextMenu class="contextMenu noselect"style=display:none;min-width:0><div class=cmtext onclick=cmhttpsportaction(1,event)>Alternar Puerto</div></div><div id=filesContextMenu class="contextMenu noselect"style=display:none;min-width:0><div class=cmtext onclick=cmfilesaction(1,event)>Renombrar</div><div class=cmtext onclick=cmfilesaction(2,event)>Editar</div><div class=cmtext onclick=cmfilesaction(3,event)>Eliminar</div></div><div id=expandAllContextMenu class="contextMenu noselect"style=display:none;min-width:0><div class=cmtext onclick=cmexpandaction(1,event)>Expandir Todo</div><div class=cmtext onclick=cmexpandaction(2,event)>Desplegar todo</div></div><div id=deskPlayerContextMenu class="contextMenu noselect"style=display:none;min-width:0><div class=cmtext onclick=cmdeskplayeraction(1,event)>Abrir Reproductor...</div></div><div id=deskKeyShortcutContextMenu class="contextMenu noselect"style=display:none;min-width:0><div class=cmtext onclick=cmdeskshortcutaction(1,event)>Personalizar ...</div></div><div id=deskPreConfigShortcutContextMenu class="contextMenu noselect"style="display:none;min-width:0;max-height:calc(80% - 50px);overflow-y:auto"><span id=deskPreConfigShortcutContextMenu1></span> <span id=deskPreConfigShortcutContextMenu2></span><div class=cmtext onclick=cmdeskpreconfigtypeaction(-1,event)>Personalizar ...</div></div><div id=deskPreConfigScriptContextMenu class="contextMenu noselect"style="display:none;min-width:0;max-height:calc(80% - 50px);overflow-y:auto"><span id=deskPreConfigScriptContextMenu1></span> <span id=deskPreConfigScriptContextMenu2></span></div><div id=container><div id=notifiyBox class=notifiyBox style=display:none></div><div id=masthead class=noselect><div style=float:left>{{{titlehtml}}}</div><div class=title onclick=go(1,event)>{{{title1}}}</div><div class=title2>{{{title2}}}</div><div style=float:right><div id=notificationCount onclick=clickNotificationIcon() class=unselectable style=display:none title="Haz clic para ver las notificaciones actuales">0</div></div><p id=logoutControl><span id=logoutControlSpan class=logoncontrolspan></span><span id=idleTimeoutNotify style=color:#ff0></span></p><img id=topMenuIcon class=noselect style=position:absolute;right:0;top:10px;color:#c8c8c8;font-size:44px;margin-right:8px;cursor:pointer;display:none onclick=topMenu() src=/images/3bars-30.png width=30 height=30><div class=textnewui id=textnewui onmouseup=toggleBootstrapUIMode() onkeypress='"Enter"==event.key&&toggleBootstrapUIMode()'><b>Try the new MeshCentral UI</b></div></div><div class="sidebar flex-column"id=page_leftbar><div style=height:24px></div><nav class="nav flex-column"><a class="nav-link active text-center text-white lbbuttonsel"id=LeftMenuMyDevices href=# data-target=general onmouseup=go(1,event) onkeypress='"Enter"==event.key&&go(1)'><i class="fa-solid fa-computer me-2"></i></a> <a class="nav-link text-center text-white"id=LeftMenuMyAccount href=# data-target=account onmouseup=go(2,event) onkeypress='"Enter"==event.key&&go(2)'><i class="fa-solid fa-user-gear me-2"></i></a> <a class="nav-link text-center text-white"id=LeftMenuMyEvents href=# data-target=events onmouseup=go(3,event) onkeypress='"Enter"==event.key&&go(3)'><i class="fa-solid fa-calendar-alt me-2"></i></a> <a class="nav-link text-center text-white"id=LeftMenuMyFiles href=# data-target=files onmouseup=go(5,event) onkeypress='"Enter"==event.key&&go(5)'><i class="fa-solid fa-folder-open me-2"></i></a> <a class="nav-link text-center text-white"id=LeftMenuMyUsers href=# data-target=users onmouseup=go(4,event) onkeypress='"Enter"==event.key&&go(4)'><i class="fa-solid fa-users me-2"></i></a> <a class="nav-link text-center text-white"id=LeftMenuMyServer href=# data-target=server onmouseup=go(6,event) onkeypress='"Enter"==event.key&&go(6)'><i class="fa-solid fa-server me-2"></i></a></nav></div><div id=topbar class=noselect><div><div style=position:relative><span id=logoutControlSpan2></span><div tabindex=0 id=uiMenuButton title="Selección de interfaz de usuario"onclick=showUserInterfaceSelectMenu() onkeypress='"Enter"==event.key&&showUserInterfaceSelectMenu()'>♦<div id=uiMenu style=display:none><table><tr><td><div tabindex=0 id=uiViewButton1 class=uiSelector onclick=userInterfaceSelectMenu(1) title="Interfaz de barra izquierda"onkeypress='"Enter"==event.key&&userInterfaceSelectMenu(1)'><div class=uiSelector1></div></div><div tabindex=0 id=uiViewButton2 class=uiSelector onclick=userInterfaceSelectMenu(2) title="Interfaz de barra superior"onkeypress='"Enter"==event.key&&userInterfaceSelectMenu(2)'><div class=uiSelector2></div></div><div tabindex=0 id=uiViewButton3 class=uiSelector onclick=userInterfaceSelectMenu(3) title="Interfaz de ancho fijo"onkeypress='"Enter"==event.key&&userInterfaceSelectMenu(3)'><div class=uiSelector3></div></div><div tabindex=0 id=uiViewButton7 class=uiSelector onclick=toggleBootstrapUIMode() title="Toggle Modern UI"onkeypress='"Enter"==event.key&&toggleBootstrapUIMode()'><div class=uiSelector7></div></div><td><div tabindex=0 id=uiViewButton6 class=uiSelector onclick=showNotes(!1) title="Notas Personales"onkeypress='"Enter"==event.key&&showNotes(!1)'><div class=uiSelector6></div></div><div tabindex=0 id=uiViewButton4 class=uiSelector onclick=toggleNightMode() title="Alternar modo nocturno"onkeypress='"Enter"==event.key&&toggleNightMode()'><div class=uiSelector4></div></div><div tabindex=0 id=uiViewButton5 class=uiSelector onclick=toggleFooterBarMode() title="Alternar barra del pie de página"onkeypress='"Enter"==event.key&&toggleFooterBarMode()'><div class=uiSelector5></div></div><div class=uiSelector_end>&nbsp;</div></table></div></div><table id=MainMenuSpan cellpadding=0 cellspacing=0 class=style1><tr><td tabindex=0 id=MainMenuMyDevices class="topbar_td style3x"onmouseup=go(1,event) onkeypress='"Enter"==event.key&&go(1)'>Mis Dispositivos<td tabindex=0 id=MainMenuMyAccount class="topbar_td style3x"onmouseup=go(2,event) onkeypress='"Enter"==event.key&&go(2)'>Mi Cuenta<td tabindex=0 id=MainMenuMyEvents class="topbar_td style3x"onmouseup=go(3,event) onkeypress='"Enter"==event.key&&go(3)'>Mis Eventos<td tabindex=0 id=MainMenuMyFiles class="topbar_td style3x"onmouseup=go(5,event) onkeypress='"Enter"==event.key&&go(5)'>Mis Archivos<td tabindex=0 id=MainMenuMyUsers class="topbar_td style3x"onmouseup=go(4,event) onkeypress='"Enter"==event.key&&go(4)'>Mis Usuarios<td tabindex=0 id=MainMenuMyServer class="topbar_td style3x"onmouseup=go(6,event) onkeypress='"Enter"==event.key&&go(6)'>Mi Servidor<td class="topbar_td_end style3">&nbsp;</table><div id=MainSubMenuSpan style=display:none><table id=MainSubMenu cellpadding=0 cellspacing=0 class=style1><tr><td tabindex=0 id=MainDev class="topbar_td style3x"onmouseup=go(10,event) onkeypress='"Enter"==event.key&&go(10)'>General<td tabindex=0 id=MainDevDesktop class="topbar_td style3x"onmouseup=go(11,event) onkeypress='"Enter"==event.key&&go(11)'>Escritorio<td tabindex=0 id=MainDevTerminal class="topbar_td style3x"onmouseup=go(12,event) onkeypress='"Enter"==event.key&&go(12)'>Terminal<td tabindex=0 id=MainDevFiles class="topbar_td style3x"onmouseup=go(13,event) onkeypress='"Enter"==event.key&&go(13)'>Archivos<td tabindex=0 id=MainDevEvents class="topbar_td style3x"onmouseup=go(16,event) onkeypress='"Enter"==event.key&&go(16)'>Eventos<td tabindex=0 id=MainDevInfo class="topbar_td style3x"onmouseup=go(17,event) onkeypress='"Enter"==event.key&&go(17)'>Detalles<td tabindex=0 id=MainDevAmt class="topbar_td style3x"onmouseup=go(14,event) onkeypress='"Enter"==event.key&&go(14)'>Intel®AMT<td tabindex=0 id=MainDevConsole class="topbar_td style3x"onmouseup=go(15,event) onkeypress='"Enter"==event.key&&go(15)'>Consola<td tabindex=0 id=MainDevPlugins class="topbar_td style3x"onmouseup=go(19,event) onkeypress='"Enter"==event.key&&go(19)'>Plugins<td class="topbar_td_end style3">&nbsp;</table></div><div id=MeshSubMenuSpan style=display:none><table id=MeshSubMenu cellpadding=0 cellspacing=0 class=style1><tr><td tabindex=0 id=MeshGeneral class="topbar_td style3x"onmouseup=go(20,event) onkeypress='"Enter"==event.key&&go(20)'>General<td tabindex=0 id=MeshSummary class="topbar_td style3x"onmouseup=go(21,event) onkeypress='"Enter"==event.key&&go(21)'>Resumen<td class="topbar_td_end style3">&nbsp;</table></div><div id=EventsSubMenuSpan style=display:none><div id=EventsSubMenu class=style1><div class="row d-flex"><div class="col flex-grow-0 flex-shrink-0"><div tabindex=0 id=EventsLive class="topbar_td style3x"onmouseup=go(3,event) onkeypress='"Enter"==event.key&&go(3)'>Eventos</div></div><div class="col flex-grow-0 flex-shrink-0"><div tabindex=0 id=EventsReport class="topbar_td style3x"onmouseup=go(60,event) onkeypress='"Enter"==event.key&&go(60)'>Informes</div></div><div class="col flex-grow-0 flex-shrink-0"><div class=style3>&nbsp;</div></div></div></div></div><div id=UserSubMenuSpan style=display:none><table id=UserSubMenu cellpadding=0 cellspacing=0 class=style1><tr><td tabindex=0 id=UserGeneral class="topbar_td style3x"onmouseup=go(30,event) onkeypress='"Enter"==event.key&&go(30)'>General<td tabindex=0 id=UserEvents class="topbar_td style3x"onmouseup=go(31,event) onkeypress='"Enter"==event.key&&go(31)'>Eventos<td class="topbar_td_end style3">&nbsp;</table></div><div id=UsersSubMenuSpan style=display:none><table id=UsersSubMenu cellpadding=0 cellspacing=0 class=style1><tr><td tabindex=0 id=UsersGeneral class="topbar_td style3x"onmouseup=go(4,event) onkeypress='"Enter"==event.key&&go(4)'>Usuarios<td tabindex=0 id=UsersGroups class="topbar_td style3x"onmouseup=go(50,event) onkeypress='"Enter"==event.key&&go(50)'>Grupos<td tabindex=0 id=UsersRecordings class="topbar_td style3x"onmouseup=go(52,event) onkeypress='"Enter"==event.key&&go(52)'>Grabaciones<td class="topbar_td_end style3">&nbsp;</table></div><div id=ServerSubMenuSpan style=display:none><table id=ServerSubMenu cellpadding=0 cellspacing=0 class=style1><tr><td tabindex=0 id=ServerGeneral class="topbar_td style3x"onmouseup=go(6,event) onkeypress='"Enter"==event.key&&go(6)'>General<td tabindex=0 id=ServerStats class="topbar_td style3x"onmouseup=go(40,event) onkeypress='"Enter"==event.key&&go(40)'>Estadísticas<td tabindex=0 id=ServerConsole class="topbar_td style3x"onmouseup=go(115,event) onkeypress='"Enter"==event.key&&go(115)'>Consola<td tabindex=0 id=ServerTrace class="topbar_td style3x"onmouseup=go(41,event) onkeypress='"Enter"==event.key&&go(41)'>Seguimiento<td tabindex=0 id=ServerPlugins class="topbar_td style3x"onmouseup=go(42,event) onkeypress='"Enter"==event.key&&go(42)'>Plugins<td class="topbar_td_end style3">&nbsp;</table></div><div id=UserDummyMenuSpan><table id=UserDummyMenu cellpadding=0 cellspacing=0 class=style1><tr><td class=style3>&nbsp;</table></div></div></div></div><div id=column_l class=pt-3><div id=p0 style=display:none><div id=p0message><span id=p0span>Servidor desconectado</span>,<href onclick=reload() style=cursor:pointer><u>haz clic para reconectar</u></href>.</div></div><div id=p1 style=display:none><div id=p1title class="d-flex justify-content-between align-items-center"><div><h1>Mis Dispositivos</h1></div><div style=display:none id=devListToolbarViewIcons><div id=devViewPageState style=float:left;line-height:32px;height:32px;font-size:16px;display:none></div><div tabindex=0 id=devViewPageButton1 class=viewSelector onclick=onDeviceViewPageChange(1) onkeypress='"Enter"==event.key&&onDeviceViewPageChange(1)'title="Primera pagina"style=display:none><div class=viewSelector9></div></div><div tabindex=0 id=devViewPageButton2 class=viewSelector onclick=onDeviceViewPageChange(2) onkeypress='"Enter"==event.key&&onDeviceViewPageChange(2)'title="Pagina anterior"style=display:none><div class=viewSelector10></div></div><div tabindex=0 id=devViewPageButton3 class=viewSelector onclick=onDeviceViewPageChange(3) onkeypress='"Enter"==event.key&&onDeviceViewPageChange(3)'title="Siguiente Pagina"style=display:none><div class=viewSelector11></div></div><div tabindex=0 id=devViewPageButton4 class=viewSelector onclick=onDeviceViewPageChange(4) onkeypress='"Enter"==event.key&&onDeviceViewPageChange(4)'title="Ultima Pagina"style=display:none;margin-right:12px><div class=viewSelector8></div></div><span role=button tabindex=0 id=devViewButton1 class="fa-layers fa-fw fa-xl"onclick=onDeviceViewChange(1) onkeypress='"Enter"==event.key&&onDeviceViewChange(1)'title=Columnas><i class="fa-solid fa-bars"data-fa-transform="shrink-8 right-4 up-2"></i> <i class="fa-solid fa-bars"data-fa-transform="shrink-8 left-4 up-2"></i> <i class="fa-solid fa-bars"data-fa-transform="shrink-8 right-4 down-3"></i> <i class="fa-solid fa-bars"data-fa-transform="shrink-8 left-4 down-3"></i> </span><span role=button tabindex=0 id=devViewButton2 class="fa-layers fa-fw fa-xl"onclick=onDeviceViewChange(2) onkeypress='"Enter"==event.key&&onDeviceViewChange(2)'title=Lista><i class="fa-solid fa-bars"></i> </span><span role=button tabindex=0 id=devViewButton3 class="fa-layers fa-fw fa-xl"onclick=onDeviceViewChange(3) onkeypress='"Enter"==event.key&&onDeviceViewChange(3)'title=Escritorios><i class="fa-solid fa-square"data-fa-transform="shrink-9 up-4 left-4"></i> <i class="fa-solid fa-square"data-fa-transform="shrink-9 up-4 right-4"></i> <i class="fa-solid fa-square"data-fa-transform="shrink-9 down-4 left-4"></i> <i class="fa-solid fa-square"data-fa-transform="shrink-9 down-4 right-4"></i> </span><span role=button tabindex=0 id=devViewButton5 class="fa-layers fa-fw fa-xl"onclick=onDeviceViewChange(5) onkeypress='"Enter"==event.key&&onDeviceViewChange(5)'title=Escritorios><i class="fa-solid fa-square"data-fa-transform="shrink-10 up-4 left-6"></i> <i class="fa-solid fa-square"data-fa-transform="shrink-10 up-4 right-1"></i> <i class="fa-solid fa-square"data-fa-transform="shrink-10 up-4 right-5"></i> <i class="fa-solid fa-square"data-fa-transform="shrink-10 down-4 left-1"></i> <i class="fa-solid fa-square"data-fa-transform="shrink-10 down-4 left-5"></i> <i class="fa-solid fa-square"data-fa-transform="shrink-10 down-4 right-6"></i> </span><span role=button tabindex=0 id=devViewButton4 class="fa-layers fa-fw fa-xl"onclick=onDeviceViewChange(4) onkeypress='"Enter"==event.key&&onDeviceViewChange(4)'title=Mapa style=display:none><i class="fa-solid fa-map-location-dot"></i></span></div></div><div id=devListToolbarSpan class="noselect d-flex align-items-center p-1"><div id=devListToolbar class="d-flex align-items-center visually-hidden"><span class="fa-layers fa-fw me-1"role=button style=display:none title="Desplegar todo"id=CollapseAllButton onclick=cmexpandaction(2)><i class="fa-solid fa-chevron-up"data-fa-transform=down-6></i> <i class="fa-solid fa-chevron-down"data-fa-transform=up-6></i> </span><span class="fa-layers fa-fw me-1"role=button style=display:none title="Expandir Todo"id=ExpandAllButton onclick=cmexpandaction(1)><i class="fa-solid fa-chevron-up"data-fa-transform=up-6></i> <i class="fa-solid fa-chevron-down"data-fa-transform=down-6></i> </span><input type=button class="btn btn-primary me-1 btn-sm"id=SelectAllButton onclick=selectallButtonFunction() value="Seleccionar Todo"> <input type=button class="btn btn-primary me-1 btn-sm"id=GroupActionButton disabled value="Acción de Grupo"onclick=groupActionFunction()> <input type=button class="btn btn-primary me-1 btn-sm"id=ScrollToTopButton onclick=onDevicesScroll(!0) value="Scroll To Top"> <input id=SearchInput class="form-control-sm me-1 btn-sm"placeholder=Filtrar onchange=onDeviceSearchChanged(event) onclick=onDeviceSearchChanged(event) onkeyup=onDeviceSearchChanged(event) onfocus=onSearchFocus(1) onblur=onSearchFocus(0) title="Filtro: usuario:xxx o u:xxx ip:xxx grupo:xxx o g:xxx etiqueta:xxx o t: xxx atag:xxx o a:xxx os:xxx amt:xxx desc:xxx wsc:ok wsc:noav wsc: noupdate wsc:nofirewall wsc:cualquiera"> <span id=SearchInputClearButton style=display:none;position:relative><span class="fa-layers fa-fw"role=button onclick=clearDeviceSearch() style=position:absolute;left:-25px;top:-15px><i class="fa-solid fa-circle"style=color:var(--bs-secondary-bg)></i> <i class="fa-solid fa-xmark"style=color:var(--bs-body-color)></i> </span></span><select class="form-select-sm me-1"id=DevFilterSelect onchange=onOnlineCheckBox(event) title="Filtro de dispositivo"><option value=0 selected>Todos<option value=1>En línea<option value=5>Desconectado<option value=2>Sesiones<option value=3>Destacado<option value=4>Intel® AMT<option value=6>Ayuda<option value=7>Etiquetado<option value=8>Sin etiquetar</select><div class=form-check title="Mostrar el nombre del sistema operativo de los dispositivos"><input class="form-check-input me-1"type=checkbox id=RealNameCheckBox onclick=onRealNameCheckBox()><label class=form-check-label for=RealNameCheckBox>Nombre del Sistema Operativo</label></div><label style=display:none><input type=checkbox id=OnlineCheckBox class="form-check-input me-2"onclick=onOnlineCheckBox(event)><span title="Solo mostrar dispositivos que están en línea">En línea</span></label> <span id=devsCustomUIBar></span></div><div id=kvmListToolbar class="d-flex align-items-center style14 visually-hidden"><span class="fa-layers fa-fw me-1"role=button style=display:none title="Desplegar todo"id=CollapseAllButton2 onclick=cmexpandaction(2)><i class="fa-solid fa-chevron-up"data-fa-transform=down-6></i> <i class="fa-solid fa-chevron-down"data-fa-transform=up-6></i> </span><span class="fa-layers fa-fw me-1"role=button style=display:none title="Expandir Todo"id=ExpandAllButton2 onclick=cmexpandaction(1)><i class="fa-solid fa-chevron-up"data-fa-transform=up-6></i> <i class="fa-solid fa-chevron-down"data-fa-transform=down-6></i> </span><input type=button class="btn btn-primary me-1 btn-sm"onclick=connectAllKvmFunction() value="Conectar Todos"> <input type=button class="btn btn-primary me-1 btn-sm"onclick=disconnectAllKvmFunction() value="Desconectar Todos"> <input type=button class="btn btn-primary me-1 btn-sm"onclick=onDevicesScroll(!0) value="Scroll To Top"><div class="form-check me-1"title="Conexión automática"><input class="form-check-input me-1"type=checkbox id=autoConnectDesktopCheckbox onclick=autoConnectDesktops(event)><label class=form-check-label for=autoConnectDesktopCheckbox>Automático</label></div><input type=button class="btn btn-primary me-1 btn-sm"onclick=showMultiDesktopSettings() value=Opciones> <input id=KvmSearchInput class="form-control-sm me-1"placeholder=Filtrar onchange=onDeviceSearchChanged(event) onclick=onDeviceSearchChanged(event) onkeyup=onDeviceSearchChanged(event) onfocus=onSearchFocus(1) onblur=onSearchFocus(0) title="Filtro: usuario:xxx o u:xxx ip:xxx grupo:xxx o g:xxx etiqueta:xxx o t: xxx atag:xxx o a:xxx os:xxx amt:xxx desc:xxx wsc:ok wsc:noav wsc: noupdate wsc:nofirewall wsc:cualquiera"> <span id=KvmSearchInputClearButton style=display:none;position:relative><span class="fa-layers fa-fw"role=button onclick=clearDeviceSearch() style=position:absolute;left:-25px;top:-15px><i class="fa-solid fa-circle"style=color:var(--bs-secondary-bg)></i> <i class="fa-solid fa-xmark"style=color:var(--bs-body-color)></i></span></span></div><div id=devMapToolbar class="d-flex align-items-center style14 visually-hidden"><input class="form-control-sm me-1"type=search id=mapSearchLocation placeholder="Ubicación de Búsqueda"onfocus=onMapSearchFocus(1) onblur=onMapSearchFocus(0)> <input class="btn btn-primary me-1 btn-sm"type=button value=Buscar title="Buscar ubicación"onclick=getSearchLocation()> <input class="btn btn-primary me-1 btn-sm"type=button id=refreshmap title="Restablecer vista del mapa"value=Reiniciar onclick=refreshMap(!1,!0)></div><div class="d-flex align-items-center ms-auto"><div style=display:none id=devListToolbarView>Ver <select id=viewselect onchange=onDeviceViewChange()><option value=1>Columnas<option value=2>Lista<option value=3>Anchura Fija de Escritorios<option id=viewselectmapoption value=4 style=display:none>Mapa<option value=5>Escritorios</select></div><div style=display:none id=devListToolbarSize>Tamaño <select id=sizeselect class="form-select-sm me-2"onchange=onDeviceViewChange()><option value=0>Pequeño<option value=1>Medio<option value=2>Grande</select> &nbsp;</div><div style=display:none id=devListToolbarSort>Ordenar por <select id=sortselect class="form-select-sm me-2"onchange=mainUpdate(6)><option>Grupo<option>Encendido<option>Dispositivo<option>Etiquetas<option>Etiquetas de Grupo<option>Ultima vez visto</select> &nbsp;</div><i class="fa-solid fa-gear"role=button id=devListToolbarSettings onclick=onDeviceViewSettings()></i></div></div><div id=NoMeshesPanel style=display:none><table><tr><td valign=top style=width:50px><img src=images/info.png loading=lazy width=47 height=48><td><div id=getStarted1>Para empezar, <a href=# onclick="return account_createMesh()"><strong>haz clic aquí para crear un grupo de dispositivos</strong></a>.</div><div id=getStarted2>No hay grupos de dispositivos.</div></table></div><div id=xdevices class=noselect style=display:none onscroll=onDevicesScroll(!1)></div><div id=xdevicesmap style=display:none><div id=xmapSearchResultsDlg style=display:none><div id=xmapSearchResultsBck><div id=xmapSearchClose onclick=mapCloseSearchWindow()><b>X</b></div><div style=padding:5px>Resultados de Ubicación</div><div style=width:100%;margin:6px></div></div><div id=xmapSearchResults style=margin:6px></div></div></div><div id=xmap-info-window></div></div><div id=p2 style=display:none><div id=p2title><h1>Mi Cuenta</h1></div><div id=p2info style=overflow-y:auto><div id=p2AccountImageFrame><img id=p2AccountImage alt=""loading=lazy width=128 height=128 onclick=account_manageImage(0) src=images/user-256.png><div><a href=# onclick=account_manageImage(0)>Cambiar imágen</a></div></div><div id=p2AccountSecurity style=display:none><p><strong>Seguridad de la cuenta</strong><div style=margin-left:25px><div id=managePhoneNumber1><div class=p2AccountActions><span id=authPhoneNumberCheck><strong>✓</strong></span></div><span><a href=# onclick="return account_managePhone()">Administrar número de teléfono</a><br></span></div><div id=manageEmail2FA><div class=p2AccountActions><span id=authEmailSetupCheck><strong>✓</strong></span></div><span><a href=# onclick="return account_manageAuthEmail()">Administrar autenticación por correo electrónico</a><br></span></div><div id=manageAuthApp><div class=p2AccountActions><span id=authAppSetupCheck><strong>✓</strong></span></div><span><a href=# onclick="return account_manageAuthApp()">Administrar la aplicación de autenticación</a><br></span></div><div id=manageDuoApp><div class=p2AccountActions><span id=authDuoSetupCheck><strong>✓</strong></span></div><span><a href=# onclick="return account_manageAuthDuo()">Manage Duo authentication</a><br></span></div><div id=manageHardwareOtp><div class=p2AccountActions><span id=authKeySetupCheck><strong>✓</strong></span></div><span><a href=# onclick="return account_manageHardwareOtp(0)">Administrar claves de seguridad</a><br></span></div><div id=managePushAuthDev><div class=p2AccountActions><span id=authPushAuthDevCheck><strong>✓</strong></span></div><span><a href=# onclick="return account_managePushAuthDev()">Gestionar la autenticación push</a><br></span></div><div id=manageMessaging1><div class=p2AccountActions><span id=authMessagingCheck><strong>✓</strong></span></div><span><a href=# onclick="return account_manageMessaging()">Administrar mensajes</a><br></span></div><div id=manageOtp><div class=p2AccountActions><span id=authCodesSetupCheck><strong>✓</strong></span></div><span><a href=# onclick="return account_manageOtp(0)">Administrar códigos de respaldo</a><br></span></div><div class=p2AccountActions></div><span><a href=# onclick="return account_viewPreviousLogins()">Ver inicios de sesión anteriores</a><br></span></div></div><div id=p2AccountActions><p><strong>Acciones de la cuenta</strong><p class=mL><span id=managePhoneNumber2 style=display:none><a href=# onclick="return account_managePhone()">Administrar número de teléfono</a><br></span><span id=manageMessaging2 style=display:none><a href=# onclick="return account_manageMessaging()">Administrar mensajes</a><br></span><span id=verifyEmailId style=display:none><a href=# onclick="return account_showVerifyEmail()">Verificar correo electrónico</a><br></span><span id=accountEnableNotificationsSpan style=display:none><a href=# onclick="return account_enableNotifications()">Habilitar notificaciones web</a><br></span><a href=# onclick="return account_showLocalizationSettings()">Opciones de Hora e Idioma</a><br><a href=# onclick="return account_showAccountNotifySettings()">Opciones de Notificación</a><br><span id=p2AccountPassActions><span id=accountChangeEmailAddressSpan style=display:none><a href=# onclick="return account_showChangeEmail()">Cambiar dirección de correo electrónico</a><br></span><a href=# onclick="return account_showChangePassword()">Cambiar contraseña</a><span id=p2nextPasswordUpdateTime></span><br><a href=# onclick="return account_showDeleteAccount()">Eliminar cuenta</a><br></span><span id=accountCreateLoginTokenSpan style=display:none><a href=# onclick="return account_createLoginToken()">Crear token de inicio de sesión</a><br></span><a href=# onclick="return account_showThemesSwitcher()">Switch theme</a><br></p><br style=clear:both></div><div id=p2logintokens></div><strong>Grupos de Dispositivos</strong> <span id=p2createMeshLink1>- <button class="btn btn-primary btn-sm"onclick="return account_createMesh()"><i class="fa-fw fa-solid fa-circle-plus"></i> Nuevo</button></span><br><br><div id=p2meshes></div><div id=p2noMeshFound style=display:none>No hay grupos de dispositivos.<span id=p2createMeshLink2> <a href=# onclick="return account_createMesh()"><strong>¡Comienza aquí!</strong></a></span></div><br style=clear:both></div></div><div id=p3 style=display:none><div id=p3title><h1>Mis Eventos</h1></div><table class=pTable><tr><td class="auto-style1 d-flex justify-content-end p-1"><div class="d-flex align-items-center"><label for=p3filterevents class=me-1>Filtrar</label> <select id=p3filterevents class="form-select-sm me-2"onchange=refreshEvents()><option notransval=1 value="">All Logs<option notransval=1 value=agentlog>Agent Logs<option notransval=1 value=relaylog>Relay Logs<option notransval=1 value=manual>Manual Logs<option notransval=1 value=runcommands>Run Command Logs<option notransval=1 value=batchupload>Batch Upload Logs<option notransval=1 value=changenode>Change Node Logs<option notransval=1 value=removenode>Remove Node Logs</select> <label for=p3limitdropdown class=me-1>Mostrar</label> <select id=p3limitdropdown class="form-select-sm me-2"onchange=refreshEvents()><option notransval=1 value=60>Últimos 60<option notransval=1 value=120>Últimos 120<option notransval=1 value=250>Últimos 250<option notransval=1 value=500>Últimos 500<option notransval=1 value=1000>Últimos 1000<option notransval=1 value="">Sin límite</select> <a href=# onclick=p3showDownloadEventsDialog(2)><i class="fa-solid fa-download"title="Descargar Eventos"></i></a></div></table><div id=p3events></div></div><div id=p4 style=display:none><div id=p4title><h1>Mis Usuarios</h1></div><table class=pTable><tr><td class="style14 d-flex align-items-center flex-wrap p-1"><div class="d-flex align-items-center"><input type=button id=UsersSelectAllButton class="btn btn-primary btn-sm me-1"onclick=p3usersSelectallButtonFunction() value="Seleccionar Todo"> <input type=button id=UsersGroupActionButton class="btn btn-primary btn-sm me-1"disabled value="Acción de Grupo"onclick=p3usersGroupActionFunction()> <input id=UserNewAccountButton class="btn btn-primary btn-sm me-1"type=button onclick=showCreateNewAccountDialog() value="Nueva Cuenta..."><div class="d-inline-flex align-items-center"><input id=UserSearchInput type=search class="form-control-sm me-1"placeholder=Filtrar onchange=onUserSearchInputChanged() onkeyup=onUserSearchInputChanged() autocomplete=off onfocus=onUserSearchFocus(1) onblur=onUserSearchFocus(0)></div></div><div class="d-flex align-items-center ms-auto"><input type=button class="btn btn-primary btn-sm me-2"onclick=showUserBroadcastDialog() style=margin-right:6px value=Broadcast> <a href=# onclick=p4downloadUserInfo()><i role=button class="fa-solid fa-download me-2"title="Descargar información del usuario"></i></a> <a href=# onclick=p4batchAccountCreate()><i role=button id=p4UserBatchCreate style=display:none title="Creación por lote de cuentas de usuario"class="fa-solid fa-upload me-1"></i></a> <i style=cursor:pointer;margin-top:3px;margin-left:6px id=usersListToolbarSettings class="fa-solid fa-cog"title=Opciones onclick=onUsersViewSettings()></i></div></table><div id=p3users></div></div><div id=p5 style=display:none><div id=p5title><h1>Mis Archivos</h1></div><table id=p5toolbar class=table cellpadding=0 cellspacing=0><tr><td id=p5filehead valign=bottom class="d-flex align-items-center"><div id=p5rightOfButtons class="d-flex align-items-center"></div><div class="m-1 d-flex align-items-center"><input type=button id=p5FolderUp class="btn btn-primary btn-sm me-1"disabled onclick="return p5folderup()"value=Subir> <input type=button id=p5SelectAllButton class="btn btn-primary btn-sm me-1"disabled onclick=p5selectallfile() value="Seleccionar Todo"> <input type=button id=p5RenameFileButton class="btn btn-primary btn-sm me-1"disabled value=Renombrar onclick=p5renamefile()> <input type=button id=p5DeleteFileButton class="btn btn-primary btn-sm me-1"disabled value=Eliminar onclick=p5deletefile()> <input type=button id=p5ViewFileButton class="btn btn-primary btn-sm me-1"disabled value=Editar onclick=p5viewfile()> <input type=button id=p5NewFolderButton class="btn btn-primary btn-sm me-1"disabled value="Nueva Carpeta"onclick=p5createfolder()> <input type=button id=p5UploadButton class="btn btn-primary btn-sm me-1"disabled value="Subir Archivo"onclick=p5uploadFile()> <input type=button id=p5DownloadButton class="btn btn-primary btn-sm me-1"disabled value=Descargar onclick=p5downloadButton()> <input type=button id=p5CutButton class="btn btn-primary btn-sm me-1"disabled value=Cortar onclick=p5copyFile(1)> <input type=button id=p5CopyButton class="btn btn-primary btn-sm me-1"disabled value=Copiar onclick=p5copyFile(0)> <input type=button id=p5PasteButton class="btn btn-primary btn-sm me-1"disabled value=Pegar onclick=p5pasteFile()></div><tr><td id=p5filesubhead class="d-flex align-items-center"><div class="d-flex align-items-center">&nbsp;&nbsp;<span id=p5currentpath></span></div><div style=float:right class="d-flex align-items-center ms-auto"><select id=p5sortdropdown class="form-select-sm me-1"onchange=updateFiles()><option value=1 selected>Orden: ascendente, por nombre<option value=2>Orden: ascendente, por tamaño<option value=3>Orden: ascendente, por fecha<option value=4>Orden: Descendente, por nombre<option value=5>Orden: Descendente, por tamaño<option value=6>Orden: Descendente, por fecha</select></div></table><div id=p5filetable><div id=p5PublicShare><div>Estos archivos se comparten públicamente, haz clic en "enlace" para obtener la URL pública.</div></div><div id=bigok style=display:none><b>✓</b></div><div id=bigfail style=display:none><b>✗</b></div><span id=p5files></span></div><table id=p5toolbarBottom class="table table-hover"style=width:100% cellpadding=0 cellspacing=0><tr><td class=style6>&nbsp;<span id=p5bottomstatus></span></table></div><div id=p6 style=display:none><div id=p6info style=overflow-y:auto><div id=p6title><img id=MainMeshImage src=serverpic.ashx><h1>Mi Servidor</h1></div><div id=p2ServerActions><p><strong>Acciones del Servidor</strong><div style=margin-left:25px><div id=p2ServerActionsBackup><div class=p2AccountActions><span style=display:none><strong>✓</strong></span></div><a id=p6backuplink href={{{domainurl}}}backup.zip rel="noreferrer noopener"target=_blank>Descargar copia de seguridad del servidor</a></div><div id=p2ServerActionsRestore><div class=p2AccountActions><span style=display:none><strong>✓</strong></span></div><a href=# onclick="return server_showRestoreDlg()">Restaurar servidor con copia de seguridad</a></div><div id=p2ServerActionsGoogleBackup style=display:none><div class=p2AccountActions><span id=p2ServerActionsGoogleBackupCheck style=display:none><strong>✓</strong></span></div><span><a href=# onclick="return server_setupGoogleDriveBackup()">Resguardo en Google Drive</a><br></span></div><div id=p2ServerActionsVersion><div class=p2AccountActions><span style=display:none><strong>✓</strong></span></div><a href=# onclick="return server_showVersionDlg()">Verificar la versión del servidor</a></div><div id=p2ServerActionsErrors><div class=p2AccountActions><span style=display:none><strong>✓</strong></span></div><a href=# onclick="return server_showErrorsDlg()">Mostrar registro de errores del servidor</a></div><div id=p2ServerActionsConfig><div class=p2AccountActions><span style=display:none><strong>✓</strong></span></div><a href=# onclick="return server_showConfigDlg()">Show server configuration</a></div></div><br></div><strong>Estadísticas del Servidor</strong><br><br><div id=serverStats><div id=serverCpuChartView style=display:none><div class=chartViewCanvas style=height:40px;text-align:center><canvas id=serverCpuChart style=display:inline-block></canvas></div><div class=chartViewText id=serverCpuChartText></div></div><div id=serverMemoryChartView style=display:none><div class=chartViewCanvas style=height:40px;text-align:center><canvas id=serverMemoryChart style=display:inline-block></canvas></div><div class=chartViewText id=serverMemoryChartText></div></div><br><br><div id=serverStatsTable></div></div><div id=serverWarningsDiv style=display:none><br><strong>Advertencias del Servidor</strong><br><br><div id=serverCertWarnings></div><div id=serverWarnings></div></div></div></div><div id=p10 style=display:none><div id=p10title class="d-flex align-items-center"><div id=p10BackButton class=pe-2><i class="fa-solid fa-square-caret-left fa-2xl"role=button tabindex=0 onclick=goBack() title=Atrás onkeypress='"Enter"==event.key&&goBack()'></i></div><div class="fs-4 fw-bold">General - <span id=p10deviceName></span></div></div><div id=p10info style=overflow-y:auto class=pt-3><table style=width:100% cellpadding=0 cellspacing=0><tr><td style=width:auto valign=top><div id=p10html></div><td style=width:100px;display:none id=notesPanel valign=top><table><thead><tr><th>Notas<tbody><tr><td><div id=notesPanelArea style=width:300px;height:200px;resize:none;overflow-y:scroll></div></table><td style=width:20px><td style=width:200px;vertical-align:top;position:relative valign=top><div class=deviceNotifyLargeDot><div id=p10deviceMsg onclick=showDeviceMessages(null,null,event) class=deviceNotifyDotSub></div><i title=Destacado role=button class="fa-solid fa-star"id=p10deviceStar onclick=showDeviceSessions(null,null,event) data-fa-transform=shrink-5 data-fa-mask="fa-solid fa-circle"></i> <i title="Lista de sesiones remotas activas en esta computadora."role=button class="fa-solid fa-arrow-right-arrow-left"id=p10deviceNotify onclick=showDeviceSessions(null,null,event) data-fa-transform=shrink-5 data-fa-mask="fa-solid fa-circle"></i> <i title="Ayuda Solicitada"role=button class="fa-solid fa-question"id=p10deviceHelp onclick=showDeviceHelpRequests(null,null,event) data-fa-transform=shrink-5 data-fa-mask="fa-solid fa-circle"></i></div><div id=p10deviceBattery class="deviceBatteryLarge deviceBatteryLarge1"></div><a href=# onclick=p10showiconselector()><img id=MainComputerImage></a><div id=MainComputerState></div></table><br><div id=p10html2></div><div id=p10html3></div><div id=p10html4></div><div id=p10html5></div></div></div><div id=p11 class=noselect style=display:none><div id=p11title class="d-flex align-items-center"><div id=p11BackButton class=pe-2><i class="fa-solid fa-2xl fa-square-caret-left"role=button tabindex=0 onclick=goBack() title=Atrás onkeypress='"Enter"==event.key&&goBack()'></i></div><div class="fs-4 fw-bold">Escritorio - <span id=p11deviceName></span></div><div id=devListToolbarViewIcons class=ms-auto><i class="fa-solid fa-xl fa-maximize fa-border"role=button onclick=deskToggleFull(event) title="Pantalla Completa. Mantenga presionada la tecla Mayús para que el navegador ocupe toda la pantalla."></i></div></div><div id=p11warning onclick=showFeaturesDlg()><div class=icon2></div><div class=warningbox>El puerto de redirección o la función KVM están deshabilitados<span id=p11warninga>, haga click aquí para habilitarlo.</span></div></div><div id=p11warning2 onclick=showPowerActionDlg()><div class=icon2></div><div class=warningbox>La computadora remota no está encendida, haz clic aquí para enviar el comando de encendido.</div></div><div style=position:absolute;right:16px;margin-top:-14px;font-size:x-small;color:#000><div id=p11capslock style=display:inline-block;margin-left:1px;border-radius:5px;background-color:#a3ffb8;padding:2px>TAPAS</div><div id=p11scrolllock style=display:inline-block;margin-left:1px;border-radius:5px;background-color:#a3ffb8;padding:2px>DESPLAZARSE</div><div id=p11numlock style=display:inline-block;margin-left:1px;border-radius:5px;background-color:#a3ffb8;padding:2px>NÚMERO</div></div><div id=deskarea0 cellpadding=0 cellspacing=0><div id=deskarea1 class="areaHead d-flex flex-wrap"><div class="d-flex align-items-center"><input type=button class="btn btn-primary btn-sm me-1"id=autoconnectbutton1 value=AutoConectar onclick=autoConnectDesktop(event) onkeypress=return!1 onkeydown=return!1 style=display:none;margin-right:4px><div class="btn-group dropdown-center me-1"id=connectbutton1span><button type=button class="btn btn btn-primary btn-sm"id=connectbutton1 title="Conéctese usando el escritorio remoto de MeshAgent"onclick=connectDesktop(event,3) onkeypress=return!1 onkeydown=return!1 disabled>Conectar</button> <button type=button class="btn btn-primary btn-sm dropdown-toggle dropdown-toggle-split"id=connectbutton1d data-bs-toggle=dropdown aria-expanded=false><span class=visually-hidden>Toggle Dropdown</span></button><ul class=dropdown-menu><li><a class=dropdown-item onclick=cmdeskaction(1,event)>Pedir Consentimiento + Barra</a><li><a class=dropdown-item onclick=cmdeskaction(2,event)>Pedir Consentimiento</a><li><a class=dropdown-item onclick=cmdeskaction(3,event)>Barra de Privacidad</a></ul></div><div class="btn-group dropdown-center me-1"id=connectbutton1rspan><button type=button class="btn btn btn-primary btn-sm"id=connectbutton1r title="Conéctate usando RDP"onclick=askRdpCredentials() onkeypress=return!1 onkeydown=return!1 disabled>Conexión RDP</button> <button type=button class="btn btn-primary btn-sm dropdown-toggle dropdown-toggle-split"id=connectbutton1rd data-bs-toggle=dropdown aria-expanded=false><span class=visually-hidden>Toggle Dropdown</span></button><ul class=dropdown-menu><li><a class=dropdown-item onclick=cmaltportaction(1,event)>Alternar Puerto</a></ul></div><span id=connectbutton1hspan><button class="btn btn-primary btn-sm me-1"type=button id=connectbutton1h title="Conéctese usando hardware KVM"onclick=connectDesktop(event,2) onkeypress=return!1 onkeydown=return!1 disabled>Conectar al HW</button></span><div class="btn-group dropdown-center me-1"id=disconnectbutton1span><button type=button class="btn btn btn-primary btn-sm"id=disconnectbutton1 title="Conéctese usando el escritorio remoto de MeshAgent"onclick=connectDesktop(event,0) onkeypress=return!1 onkeydown=return!1>Desconectar</button> <button type=button class="btn btn-primary btn-sm dropdown-toggle dropdown-toggle-split"id=diconnectbutton1d data-bs-toggle=dropdown aria-expanded=false><span class=visually-hidden>Toggle Dropdown</span></button><ul class=dropdown-menu><li><a class=dropdown-item onclick=cmdeskaction(10,event)>Desconectar y bloquear</a><li><a class=dropdown-item onclick=cmdeskaction(11,event)>Desconectar</a></ul></div><span id=deskstatus style=line-height:22px>Desconectado</span><span id=deskmetadata></span></div><div class="d-flex align-items-center ms-auto"><div id=desktopCustomUiButtons style=float:left></div><div id=desktopCustomUpperRight style=float:left;margin-right:6px></div><input type=button class="btn btn-primary btn-sm"title="Cambiar el estado de energía de la máquina remota"onkeypress=return!1 onkeydown=return!1 value="Acciones de Encendido..."onclick=showPowerActionDlg() style=display:none> <input id=deskActionsBtn type=button class="btn btn-primary btn-sm me-1"title="Realizar acciones de energía en el dispositivo"onkeypress=return!1 onkeydown=return!1 value=Acciones onclick=deviceActionFunction()> <input id=deskActionsSettings type=button class="btn btn-primary btn-sm me-1"value=Opciones title="Editar configuraciones de escritorio remoto"onkeypress=return!1 onkeydown=return!1 onclick=showDesktopSettings()> <input id=deskFocusBtn type=button title="Alternar el modo de enfoque, cuando está activo solo se actualiza la región alrededor del mouse"onkeypress=return!1 onkeydown=return!1 value="Enfocar Todo"onclick=deskToggleFocus() style=margin-right:3px;display:none><div id=deskRecordIcon class=deskareaicon title="El servidor está grabando esta sesión"style=display:none;background-color:red;width:12px;height:12px;border-radius:6px;margin-top:5px></div><div class=deskareaicon title="Gira a la Derecha"onclick=drotate(1)><i class="fa-solid fa-rotate-right"></i></div><div class=deskareaicon title="Girar a la Izquierda"onclick=drotate(-1)><i class="fa-solid fa-rotate-left"></i></div><div class=deskareaicon title="Alternar Modo de Vista"onclick=toggleAspectRatio(1)>⇲</div><div id=idx_deskFullBtn2 onclick=deskToggleFull(event) style=float:right>&nbsp;✖</div></div></div><div id=deskarea3x><div id=p11bigok style=display:none><b>✓</b></div><div id=p11bigfail style=display:none><b>✗</b></div><div id=DeskFocus oncontextmenu=return!1 onmousedown=dmousedown(event) onmouseup=dmouseup(event) onmousemove=dmousemove(event)></div><div id=DeskParent><canvas id=Desk width=640 height=480 oncontextmenu=return!1 onmousedown=dmousedown(event) onmouseup=dmouseup(event) onmousemove=dmousemove(event) onmousewheel=dmousewheel(event)></canvas></div><div id=DeskTools><div id=deskToolsAreaTop><a id=DeskToolsRefreshButton class=link-underline-primary style=right:2px onclick=refreshDeskTools()>Actualizar</a><div id=deskToolsTopTabProcess class=deskToolsTopTab onclick=changeDeskToolTab(0) style=left:0;bottom:0>Procesos</div><div id=deskToolsTopTabService class=deskToolsTopTab onclick=changeDeskToolTab(1) style=display:none;left:90px;color:gray>Servicios</div></div><div id=deskToolsArea><div id=DeskToolsProcessTab><div id=deskToolsHeader><a class=colmn1 title="Ordenar por id de proceso"onclick=sortProcess(0)>PID</a> <a class=colmn2 title="Orden: ascendente, por nombre"onclick=sortProcess(1)>Nombre</a></div><div id=DeskToolsProcesses></div></div><div id=DeskToolsServiceTab style=display:none><div id=deskToolsServiceHeader><a class=colmn1 style=width:70px title="Ordenar por estado"onclick=sortService(0)>Estado</a> <a class=colmn2 title="Orden: ascendente, por nombre"onclick=sortService(1)>Nombre</a></div><div id=DeskToolsServices></div></div></div></div><div id=p11DeskConsoleMsg style=display:none;text-align:left;cursor:pointer;position:absolute;left:30px;top:17px;color:#ff0;background-color:rgba(0,0,0,.6);padding:10px;border-radius:5px;text-align:left onclick=p11clearConsoleMsg()></div><div id=p11DeskSessionSelector style=display:none;position:absolute;left:30px;top:17px;right:30px;bottom:17px;overflow-y:auto></div></div><div id=deskarea4 class="areaFoot d-flex flex-wrap"><div class="d-flex align-items-center"><select id=deskkeys class="form-select-sm me-1"cmenu=deskKeyShortcutContextMenu></select> <input id=DeskWD type=button class="btn btn-primary btn-sm me-1"value=Enviar onkeypress=return!1 onkeydown=return!1 onclick=deskSendKeys()> <input id=DeskESC style=display:none type=button class="btn btn-primary btn-sm me-1"value=ESC onkeypress=return!1 onkeydown=return!1 onclick=sendDeskEsc()> <input id=DeskClip type=button class="btn btn-primary btn-sm me-1"value=Portapapeles onkeypress=return!1 onkeydown=return!1 onclick=showDeskClip()> <input id=DeskType class="btn btn-primary btn-sm me-1"cmenu=deskPreConfigShortcutContextMenu type=button value=Tipo onkeypress=return!1 onkeydown=return!1 onclick=showDeskType()><div id=DeskControlSpan title="Alternar control de mouse y teclado de forma remota"class=form-check><input id=DeskControl type=checkbox class=form-check-input onkeypress=return!1 onkeydown=return!1 onclick=toggleKvmControl()><label class=form-check-label for=DeskControl>Controlar mouse y teclado de forma remota</label></div>&nbsp;</div><div class="d-flex ms-auto align-items-center"><span id=DeskMonitorSelectionSpan></span> <span id=DeskLatency style=width:70px class=text-center title="Latencia de Sesión de Escritorio"></span> <span id=DeskTimer style=width:70px class=text-center title="Tiempo de sesión"></span> <input id=DeskToolsButton type=button class="btn btn-primary btn-sm mx-1"value=Herramientas title="Alternar vista de herramientas"onkeypress=return!1 onkeydown=return!1 onclick=toggleDeskTools()> <span id=DeskGuestShareButton title="Compartir el dispositivo con un invitado"role=button><i class="fa-solid fa-fw fa-share-nodes"id=DeskInputUnLockedButtonImage onclick=showShareDevice()></i> </span><span id=DeskInputUnLockedButton title="La entrada remota está desbloqueada"role=button><i class="fa-solid fa-fw fa-keyboard"onclick=deskInputLockFunction(1)></i> </span><span id=DeskInputLockedButton title="La entrada remota está bloqueada"role=button><i class="fa-solid fa-fw fa-keyboard"style=color:red onclick=deskInputLockFunction(0)></i> </span><span id=DeskRefreshButton title="Actualizar el escritorio"role=button><i class="fa-solid fa-fw fa-rotate"onclick=deskRefreshFunction()></i> </span><span id=DeskClipboardOutButton title="Cargar Portapapeles local a dispositivo remoto"role=button><i class="fa-solid fa-fw fa-up-long"data-fa-transform="shrink-9 down-4"data-fa-mask="fa-solid fa-clipboard"onclick=deskClipboardOutFunction()></i> </span><span id=DeskClipboardInButton title="Descargar portapapeles remoto a portapapeles local"style=display:none role=button><i class="fa-solid fa-fw fa-down-long"data-fa-transform="shrink-9 down-4"data-fa-mask="fa-solid fa-clipboard"onclick=deskClipboardInFunction()></i> </span><span id=DeskRecordButton cmenu=deskPlayerContextMenu title="Grabar sesión de escritorio remoto en archivo"style=display:none role=button><i class="fa-solid fa-fw fa-video"onclick=deskRecordSession() id=DeskRecordButtonImage></i> </span><span id=DeskSaveImageButton title="Guardar una captura de pantalla del escritorio remoto"role=button><i class="fa-solid fa-fw fa-camera"onclick=deskSaveImage()></i> </span><span id=DeskBackgroundButton title="Alternar fondo de escritorio remoto"role=button><i class="fa-solid fa-fw fa-image"onclick=deviceToggleBackground(event) id=DeskBackgroundButtonImage></i> </span><span id=DeskOpenWebButton title="Abre una dirección web en la computadora remota"role=button><i class="fa-solid fa-fw fa-globe"onclick=deviceUrlFunction()></i> </span><span id=DeskLockButton title="Bloquear la computadora remota"role=button><i class="fa-solid fa-fw fa-lock"onclick=deviceLockFunction()></i> </span><span id=DeskNotifyButton title="Mostrar una notificación en la computadora remota"role=button><i class="fa-solid fa-fw fa-bell"onclick=deviceToastFunction()></i> </span><span id=DeskChatButton class=deskarea title="Abrir ventana de chat en esta computadora"role=button><i class="fa-solid fa-fw fa-message"onclick=deviceChat(event)></i> </span><span id=DeskRunButton cmenu=deskPreConfigScriptContextMenu class=deskarea title="Ejecutar un Script en esta computadora"role=button><i class="fa-solid fa-fw fa-play"onclick=runDeviceCmd()></i></span></div></div></div></div><div id=p12 style=display:none><div id=p12title class="d-flex align-items-center"><div id=p12BackButton class=pe-2><i class="fa-solid fa-square-caret-left fa-2xl"role=button tabindex=0 onclick=goBack() title=Atrás onkeypress='"Enter"==event.key&&goBack()'></i></div><div class="fs-4 fw-bold">Terminal - <span id=p12deviceName></span></div><div id=devListToolbarViewIcons2 class=ms-auto><i class="fa-solid fa-xl fa-maximize fa-border"role=button onclick=deskToggleFull(event) title="Pantalla Completa. Mantenga presionada la tecla Mayús para que el navegador ocupe toda la pantalla."></i></div></div><div id=p12warning onclick=showFeaturesDlg()><div class=icon2></div><div class=warningbox>El puerto de redirección o la función KVM están deshabilitados<span id=p12warninga>, haga click aquí para habilitarlo.</span></div></div><div id=p12warning2 onclick=showPowerActionDlg()><div class=icon2></div><div class=warningbox>La computadora remota no está encendida, haz clic aquí para enviar el comando de encendido.</div></div><div id=termTable style=position:relative><table style=width:100% cellpadding=0 cellspacing=0><tr><td class="areaHead d-flex flex-wrap"><div class="d-flex align-items-center"><button type=button id=autoconnectbutton2 class="btn btn-primary btn-sm me-1"onclick=autoConnectTerminal(event) onkeypress=return!1 onkeydown=return!1 style=display:none><i class="fa-solid fa-play"></i> AutoConectar</button><div class="btn-group dropdown-center me-1"id=connectbutton2span><button type=button class="btn btn btn-primary btn-sm"id=connectbutton2 title="Conéctese usando el escritorio remoto de MeshAgent"onclick=connectTerminal(event,1) onkeypress=return!1 onkeydown=return!1 disabled>Conectar</button> <button type=button class="btn btn-primary btn-sm dropdown-toggle dropdown-toggle-split"id=connectbutton2d data-bs-toggle=dropdown aria-expanded=false onclick=newContextMenu(event,1)><span class=visually-hidden>Toggle Dropdown</span></button><ul class=dropdown-menu><li><a class=dropdown-item onclick=cmtermaction(1,0,event)><b>Administrar Shell</b></a><li><a class=dropdown-item onclick=cmtermaction(6,0,event)>Administrar Powershell</a><li><a class=dropdown-item onclick=cmtermaction(8,0,event)>Shell del Usuario</a><li><a class=dropdown-item onclick=cmtermaction(9,0,event)>Usuario PowerShell</a><li><a class=dropdown-item onclick=cmtermaction(1,16,event)>Pregunte a la consola de administración</a><li><a class=dropdown-item onclick=cmtermaction(6,16,event)>Pregunte al administrador de PowerShell</a><li><a class=dropdown-item onclick=cmtermaction(8,16,event)>Preguntar usuario Shell</a><li><a class=dropdown-item onclick=cmtermaction(9,16,event)>Preguntar al usuario PowerShell</a><li class=ass><a class=dropdown-item onclick=cmtermaction(8,0,event)><b>Shell del Usuario</b></a><li class=ass><a class=dropdown-item onclick=cmtermaction(9,0,event)>Usuario PowerShell</a><li class=lin><a class=dropdown-item onclick=cmtermaction(1,0,event)><b>Shell Root</b></a><li class=lin><a class=dropdown-item onclick=cmtermaction(8,0,event)>Shell del Usuario</a><li class=lin><a class=dropdown-item onclick=cmtermaction(100,0,event)>Shell de inicio de sesión</a></ul></div><div class="btn-group dropdown-center me-1"id=connectbutton2sspan><button type=button class="btn btn btn-primary btn-sm"id=connectbutton2s title="Conéctese usando el escritorio remoto de MeshAgent"onclick=connectTerminal(event,3) onkeypress=return!1 onkeydown=return!1 disabled>Conexión SSH</button> <button type=button class="btn btn-primary btn-sm dropdown-toggle dropdown-toggle-split"id=connectbutton2sd data-bs-toggle=dropdown aria-expanded=false><span class=visually-hidden>Toggle Dropdown</span></button><ul class=dropdown-menu><li><a class=dropdown-item onclick=cmsshportaction(1,event)>Alternar Puerto</a></ul></div><span id=connectbutton2hspan><button type=button class="btn btn-primary btn-sm me-1"id=connectbutton2h title="Conéctate mediante hardware KVM Intel® AMT"onclick=connectTerminal(event,2) onkeypress=return!1 onkeydown=return!1 disabled>Conectar al HW</button></span> <span id=disconnectbutton2span><button type=button class="btn btn-primary btn-sm me-1"id=disconnectbutton2 onclick=connectTerminal(event,0) onkeypress=return!1 onkeydown=return!1>Desconectar</button></span> <span id=termstatus style=line-height:22px>Desconectado</span><span id=termtitle></span></div><div class="d-flex align-items-center ms-auto"><div id=idx_termFullBtn2 onclick=deskToggleFull(event) style=float:right>&nbsp;✖</div><div id=termRecordIcon class=deskareaicon title="El servidor está grabando esta sesión"style=display:none;background-color:red;width:12px;height:12px;border-radius:6px;margin-top:5px;margin-left:5px></div><input id=termActionsBtn type=button title="Realizar acciones de energía en el dispositivo"onkeypress=return!1 onkeydown=return!1 value=Acciones class="btn btn-primary me-1 btn-sm"onclick=deviceActionFunction()><div id=terminalCustomUpperRight style=float:left;margin-right:6px></div><div id=terminalCustomUiButtons style=float:left></div></div><tr><td id=termarea3x><div id=termarea3xdiv style=width:100%;height:100%;text-align:left></div><pre id=Term></pre><tr><td class="areaFoot d-flex flex-wrap"><div class="d-flex align-items-center"><input type=button onkeypress=return!1 onkeydown=return!1 class="btn btn-primary btn-sm me-1"id=ctrlcbutton value=Ctl-C onclick='termSendKey(3,"ctrlcbutton")'> <input type=button onkeypress=return!1 onkeydown=return!1 class="btn btn-primary btn-sm me-1"id=ctrlxbutton value=Ctl-X onclick='termSendKey(24,"ctrlxbutton")'> <input type=button onkeypress=return!1 onkeydown=return!1 class="btn btn-primary me-1 btn-sm"id=escbutton value=ESC onclick='termSendKey(27,"escbutton")'> <input type=button onkeypress=return!1 onkeydown=return!1 class="btn btn-primary me-1 btn-sm"id=bsbutton value=Retroceso onclick='termSendKey(8,"bsbutton")'style=display:none> <input type=button onkeypress=return!1 onkeydown=return!1 class="btn btn-primary me-1 btn-sm"id=pastebutton value=Pegar title="Pegar texto en la terminal"onclick=showTermPasteDialog() style=display:none></div><div class="d-flex align-items-center ms-auto"><span id=TermTimer title="Tiempo de sesión"></span>&nbsp; <span id=terminalSettingsButtons style=display:none><input id=id_tcrbutton type=button onkeypress=return!1 onkeydown=return!1 class="btn btn-primary me-1 btn-sm"value=CR+LF title="Alternar lo que enviará la tecla Enter"onclick=termToggleCr()> <input id=id_tfxkeysbutton type=button onkeypress=return!1 onkeydown=return!1 class="btn btn-primary me-1 btn-sm"value="Intel (F10 = ESC+[OM)"title="Alternar el tipo de emulación con las teclas F1 a F10"onclick=termToggleFx()> <input id=id_ttypebutton type=button onkeypress=return!1 onkeydown=return!1 class="btn btn-primary me-1 btn-sm"value="Ascii extendido"title="Alternar el tipo de emulación de terminal"onclick=termToggleType()> </span><span id=terminalSizeDropDown style=display:none><select id=termSizeList onkeypress=return!1 class="form-select-sm me-1"><option value=1>80x25<option value=2>100x30</select> </span><select id=specialkeylist class="form-select-sm me-1"onkeypress=return!1></select> <input id=specialkeylistinput type=button onkeypress=return!1 class="btn btn-primary btn-sm me-1"value=Enviar title="Enviar la clave especial seleccionada"onclick=sendSpecialKey()></div></table><div id=p12TermConsoleMsg style=display:none;text-align:left;cursor:pointer;position:absolute;left:30px;top:45px;color:#ff0;background-color:rgba(0,0,0,.6);padding:10px;border-radius:5px onclick=p12clearConsoleMsg()></div></div></div><div id=p13 style=display:none><div id=p13title class="d-flex align-items-center"><div id=p13BackButton class=pe-2><i class="fa-solid fa-square-caret-left fa-2xl"role=button tabindex=0 onclick=goBack() title=Atrás onkeypress='"Enter"==event.key&&goBack()'></i></div><div class="fs-4 fw-bold">Archivos - <span id=p13deviceName></span></div></div><table id=p13toolbar cellpadding=0 cellspacing=0><tr><td class="areaHead d-flex flex-wrap"><div class="d-flex align-items-center"><button id=p13AutoConnect onclick=autoConnectFiles(event) class="btn btn-primary btn-sm me-1"type=button style=display:none><i class="fa-solid fa-play"></i> AutoConectar</button><div class="btn-group dropdown-center me-1"id=p13Connectspan><button type=button class="btn btn btn-primary btn-sm"id=p13Connect title="Conéctese usando el escritorio remoto de MeshAgent"onclick=connectFiles(event,1) onkeypress=return!1 onkeydown=return!1 disabled>Conectar</button> <button type=button class="btn btn-primary btn-sm dropdown-toggle dropdown-toggle-split"id=p13Connectdrop data-bs-toggle=dropdown aria-expanded=false><span class=visually-hidden>Toggle Dropdown</span></button><ul class=dropdown-menu><li><a class=dropdown-item onclick=cmconnectfilesaction()>Pedir Consentimiento</a></ul></div><button id=p13Disconnect class="btn btn-primary btn-sm me-1"onclick=connectFiles(event) type=button>Desconectar</button><div class="btn-group dropdown-center me-1"id=p13Connectsspan><button type=button class="btn btn btn-primary btn-sm"id=p13Connects title="Conéctese usando el escritorio remoto de MeshAgent"onclick=connectFiles(event,2) onkeypress=return!1 onkeydown=return!1 disabled>Conexión SFTP</button> <button type=button class="btn btn-primary btn-sm dropdown-toggle dropdown-toggle-split"id=p13Connectsdrop data-bs-toggle=dropdown aria-expanded=false><span class=visually-hidden>Toggle Dropdown</span></button><ul class=dropdown-menu><li><a class=dropdown-item onclick=cmsshportaction(1,event)>Alternar Puerto</a></ul></div><span id=p13Status>Desconectado</span></div><div class="d-flex align-items-center ms-auto"><input id=filesActionsBtn class="btn btn-primary me-1 btn-sm"type=button title="Realizar acciones de energía en el dispositivo"value=Acciones onclick=deviceActionFunction()><div id=filesRecordIcon class=deskareaicon title="El servidor está grabando esta sesión"style=display:none;background-color:red;width:12px;height:12px;border-radius:6px;margin-top:5px;margin-left:5px></div><div id=filesCustomUpperRight style=float:left;margin-right:6px></div><div id=filesCustomUiButtons style=float:left></div></div><tr><td class="areaHead2 d-flex align-items-center flex-wrap"valign=bottom><div id=p13rightOfButtons class="toright2 d-flex align-items-center"></div><div class="d-flex align-items-center"><input type=button disabled id=p13FolderUp class="btn btn-primary me-1 btn-sm"value=Subir onclick=p13folderup()> <input type=button disabled id=p13SelectAllButton class="btn btn-primary me-1 btn-sm"value="Seleccionar Todo"onclick=p13selectallfile()> <input type=button disabled id=p13RenameFileButton class="btn btn-primary me-1 btn-sm"value=Renombrar onclick=p13renamefile()> <input type=button disabled id=p13DeleteFileButton class="btn btn-primary me-1 btn-sm"value=Eliminar onclick=p13deletefile()> <input type=button disabled id=p13ViewFileButton class="btn btn-primary me-1 btn-sm"value=Editar onclick=p13viewfile()> <input type=button disabled id=p13NewFolderButton class="btn btn-primary me-1 btn-sm"value="Nueva Carpeta"onclick=p13createfolder()> <input type=button disabled id=p13UploadButton class="btn btn-primary me-1 btn-sm"value="Subir Archivo"onclick=p13uploadFile()> <input type=button disabled id=p13DownloadButton class="btn btn-primary me-1 btn-sm"value=Descargar onclick=p13downloadButton()> <input type=button disabled id=p13CutButton class="btn btn-primary me-1 btn-sm"value=Cortar onclick=p13copyFile(1)> <input type=button disabled id=p13CopyButton class="btn btn-primary me-1 btn-sm"value=Copiar onclick=p13copyFile(0)> <input type=button disabled id=p13PasteButton class="btn btn-primary me-1 btn-sm"value=Pegar onclick=p13pasteFile()> <input type=button disabled id=p13ZipButton class="btn btn-primary me-1 btn-sm"value="Comprimir en Zip"onclick=p13zipFiles()> <input type=button disabled id=p13UnzipButton class="btn btn-primary me-1 btn-sm"value=Unzip onclick=p13unzipFile()> <input type=button disabled id=p13RefreshButton class="btn btn-primary me-1 btn-sm"value=Actualizar onclick=p13folderup(9999)> <input type=button disabled id=p13FindButton class="btn btn-primary me-1 btn-sm"value=Encontrar onclick=p13findfile()> <input type=button disabled id=p13GoToFolderButton class="btn btn-primary me-1 btn-sm"value=GoTo onclick=p13gotofolder()> <input type=button disabled id=p13OpenButton class="btn btn-primary me-1 btn-sm"value=Open onclick=p13openfilefolder()></div><tr><td class=areaHead3><div class=toright2><select id=p13sizedropdown class="form-select-sm me-2"onchange=p13updateFiles()><option value=0 selected>Human Readable<option value=1 title=Bytes>Bytes<option value=10 title=KB>Kilobytes<option value=20 title=MB>Megabytes<option value=30 title=GB>Gigabyte</select> <select id=p13sortdropdown class="form-select-sm me-2"onchange=p13updateFiles()><option value=1 selected>Orden: ascendente, por nombre<option value=2>Orden: ascendente, por tamaño<option value=3>Orden: ascendente, por fecha<option value=4>Orden: Descendente, por nombre<option value=5>Orden: Descendente, por tamaño<option value=6>Orden: Descendente, por fecha</select></div><div>&nbsp;&nbsp;<span id=p13currentpath></span></div></table><div id=p13FilesConsoleMsg style=display:none;text-align:left;cursor:pointer;position:absolute;left:30px;top:165px;color:#ff0;background-color:rgba(0,0,0,.6);padding:10px;border-radius:5px onclick=p13clearConsoleMsg()></div><div id=p13filetable><div id=p13bigok style=display:none><b>✓</b></div><div id=p13bigfail style=display:none><b>✗</b></div><span id=p13files></span></div><table id=p13toolbarBottom cellpadding=0 cellspacing=0><tr><td class=style6>&nbsp;<span id=p13bottomstatus></span></table></div><div id=p14 style=display:none><div id=p14title class="d-flex align-items-center"><div id=p14BackButton class=pe-2><i class="fa-solid fa-square-caret-left fa-2xl"role=button tabindex=0 onclick=goBack() title=Atrás onkeypress='"Enter"==event.key&&goBack()'></i></div><div class="fs-4 fw-bold"><span id=p14deviceNamePrefix>Intel® AMT</span> - <span id=p14deviceName></span></div><div id=devListToolbarViewIcons class=ms-auto><i class="fa-solid fa-xl fa-maximize fa-border"role=button onclick=deskToggleFull(event) title="Pantalla Completa. Mantenga presionada la tecla Mayús para que el navegador ocupe toda la pantalla."></i></div></div><iframe id=p14iframe src={{{domainurl}}}commander.ashx></iframe></div><div id=p15 style=display:none><div id=p15title class="d-flex align-items-center"><div id=p15BackButton class=pe-2><i class="fa-solid fa-square-caret-left fa-2xl"role=button tabindex=0 onclick=goBack() title=Atrás onkeypress='"Enter"==event.key&&goBack()'></i></div><div class="fs-4 fw-bold"><span id=p15deviceName></span></div></div><table id=consoleTable cellpadding=0 cellspacing=0><tr><td class="areaHead d-flex flex-wrap"><div id=p15statetext class="d-flex align-items-center"></div><div class="d-flex align-items-center ms-auto"><div id=p15coreName class=me-1 title="Información sobre el núcleo actual que se ejecuta en este agente"></div><input type=button id=p15uploadCore class="btn btn-primary me-1 btn-sm"value="Acción del Agente"onclick=p15uploadCore(event) title="Cambiar el módulo de código del agente JavaScript"> <i onclick=p15downloadConsoleText() title="Descargar texto de consola"class="fa-solid fa-download me-1"></i></div><tr><td><div class=areaProgress><div id=consoleprogressbar></div></div><tr><td id=p15agentConsole><pre id=p15agentConsoleText></pre><tr><td class=areaFoot><table style=width:100%><tr><td style=width:99%><input id=p15consoleText class=form-control onkeyup=p15consoleSend(event) onfocus=onConsoleFocus(1) onblur=onConsoleFocus(0)><td>&nbsp;<td id=p15outputselecttd><select id=p15outputselect onchange=setupConsole()><option id=p15outputselect1 value=1>Agente<option id=p15outputselect3 value=3>Empujar<option id=p15outputselect2 value=2>MQTT</select><td style=width:1%><input id=id_p15consoleClear type=button class="btn btn-primary bottombutton"value=Eliminar onclick=p15consoleClear()></table></table></div><div id=p16 style=display:none><div id=p16title class="d-flex align-items-center"><div id=p16BackButton class=pe-2><i class="fa-solid fa-square-caret-left fa-2xl"role=button tabindex=0 onclick=goBack() title=Atrás onkeypress='"Enter"==event.key&&goBack()'></i></div><div class="fs-4 fw-bold">Eventos - <span id=p16deviceName></span></div></div><table class=pTable><tr><td class="auto-style1 d-flex justify-content-end p-1"><div class="d-flex align-items-center"><label class=me-1 for=p16filterevents>Filtrar</label> <select id=p16filterevents class="form-control-sm me-2"onchange=refreshDeviceEvents()><option notransval=1 value="">All Logs<option notransval=1 value=agentlog>Agent Logs<option notransval=1 value=relaylog>Relay Logs<option notransval=1 value=manual>Manual Logs<option notransval=1 value=runcommands>Run Command Logs<option notransval=1 value=batchupload>Batch Upload Logs<option notransval=1 value=changenode>Change Node Logs<option notransval=1 value=removenode>Remove Node Logs</select> <label class=me-1 for=p16limitdropdown>Mostrar</label> <select id=p16limitdropdown class="form-control-sm me-2"onchange=refreshDeviceEvents()><option notransval=1 value=60>Últimos 60<option notransval=1 value=120>Últimos 120<option notransval=1 value=250>Últimos 250<option notransval=1 value=500>Últimos 500<option notransval=1 value=1000>Últimos 1000</select> <i onclick=p3showDownloadEventsDialog(1) class="fa-solid fa-download"title="Descargar Eventos"style=cursor:pointer></i></div></table><div id=p16events></div></div><div id=p17 style=display:none><div id=p17title class="d-flex align-items-center"><div id=p17BackButton class=pe-2><i class="fa-solid fa-square-caret-left fa-2xl"role=button tabindex=0 onclick=goBack() title=Atrás onkeypress='"Enter"==event.key&&goBack()'></i></div><div class="fs-4 fw-bold">Detalles - <span id=p17deviceName></span></div><div id=devListToolbarViewIcons3 class=ms-auto><i class="fa-solid fa-chart-line fa-xl fa-border"role=button onclick=deskToggleCpuGraph(event) title="Muestra el uso de la CPU y la memoria del dispositivo."></i></div></div><div id=p17info class="ps-0 pb-5 overflow-y-auto container-fluid"><div id=p17graph style=width:100%><table style=width:100%><tr><td style=width:64px;vertical-align:top><img src=images/details/graph64.png border=0 width=64><td><div class=DevSt style=margin-bottom:3px;margin-left:16px><b>Gráfico en vivo</b></div><div style="margin-bottom:10px;margin-left:16px;height:240px;width:calc(100% - 16px);position:relative"><canvas id=deviceDetailsStats style=position:absolute;top:0;left:0;right:0;bottom:0></canvas></div><div id=extraGraphValues style=display:none;margin-left:30px;margin-bottom:15px></div></table></div><div id=p17info2></div></div></div><div id=p19 style=display:none><div id=p19title><div id=p19BackButton style=float:left><div class=backButton tabindex=0 onclick=goBack() title=Atrás onkeypress='"Enter"==event.key&&goBack()'><div class=backButtonEx></div></div></div><h1>Plugins - <span id=p19deviceName></span></h1></div><div id=p19headers></div><div id=p19pages></div></div><div id=p20 style=display:none><div id=p20main style=overflow-y:auto><div id=p20title class="d-flex align-items-center"><div id=p20BackButton class=pe-2><i class="fa-solid fa-square-caret-left fa-2xl"role=button tabindex=0 onclick=goBack() title=Atrás onkeypress='"Enter"==event.key&&goBack()'></i></div><div class="fs-4 fw-bold">General - <span id=p20meshName></span></div></div><picture id=MainMeshImage style=border-width:0;height:200px;width:200px;float:right><source type=image/webp width=200 height=200 srcset=images/webp/mesh-256.webp><img alt=""width=200 height=200 src=images/mesh-256.png></picture><p id=p20info><p id=p20info2></div></div><div id=p21 style=display:none><div id=p21title class="d-flex align-items-center"><div id=p21BackButton class=pe-2><i class="fa-solid fa-square-caret-left fa-2xl"role=button tabindex=0 onclick=goBack() title=Atrás onkeypress='"Enter"==event.key&&goBack()'></i></div><div class="fs-4 fw-bold">Resumen - <span id=p21meshName></span></div></div><div id=p21main style=overflow-y:auto><div style=width:100%><div style=display:table;width:93%><div id=meshPowerChartDiv style=width:23%;display:inline-block;text-align:center;max-width:250px><div style=margin:10px;font-size:16px>Estados de Encendido</div><canvas id=meshPowerChart style=width:250px;height:250px></canvas></div><div id=meshOsChartDiv style=width:23%;display:inline-block;text-align:center;max-width:250px><div style=margin:10px;font-size:16px>Tipos de Agente</div><canvas id=meshOsChart style=width:250px;height:250px></canvas></div><div id=meshConnChartDiv style=width:23%;display:inline-block;text-align:center;max-width:250px><div style=margin:10px;font-size:16px>Conectividad</div><canvas id=meshConnChart style=width:250px;height:250px></canvas></div><div id=meshSecurityChartDiv style=width:23%;display:inline-block;text-align:center;max-width:250px><div style=margin:10px;font-size:16px>Seguridad</div><canvas id=meshSecurityChart style=width:250px;height:250px></canvas></div></div></div><p id=p21info style=overflow-y:auto></div></div><div id=p30 style=display:none><div id=p30title class="d-flex align-items-center"><div id=p30BackButton class=pe-2><i class="fa-solid fa-square-caret-left fa-2xl"role=button tabindex=0 onclick=goBack() title=Atrás onkeypress='"Enter"==event.key&&goBack()'></i></div><div class="fs-4 fw-bold">General - <span id=p30userName></span></div></div><div id=p30info style=overflow-y:auto><div class=row><div class=col><div id=p30html></div></div><div class=col-auto style=width:20px></div><div class=col-auto style=width:200px;position:relative><img id=p30userAuthServiceLogo loading=lazy style=display:none class=userAuthStrategyLogo width=64 height=64><picture id=MainUserImage style=display:none;border-width:0;height:200px;width:200px;float:right onclick=account_manageImage(1)><source type=image/webp width=200 height=200 srcset=images/webp/user-256.webp><img alt=""width=200 height=200 src=images/user-256.png></picture><img id=MainUserImageEx alt=""width=200 height=200 src=images/user-256.png onclick=account_manageImage(1)><div style=width:100%;text-align:center><strong><span id=MainUserState></span></strong></div></div></div><br><div id=p30html2></div><div id=p30html3></div></div></div><div id=p31 style=display:none><div id=p31title class="d-flex align-items-center"><div id=p31BackButton class=pe-2><i class="fa-solid fa-square-caret-left fa-2xl"role=button tabindex=0 onclick=goBack() title=Atrás onkeypress='"Enter"==event.key&&goBack()'></i></div><div class="fs-4 fw-bold">Eventos - <span id=p31userName></span></div></div>{{!-- --}} {{!-- --}}<table class=pTable><tr><td class=h1><td class="auto-style1 d-flex justify-content-end p-1"><div class="d-flex align-items-center"><label for=p31filterevents class=me-1>Filtrar</label> <select id=p31filterevents class="form-select-sm me-2"onchange=refreshUsersEvents()><option notransval=1 value="">All Logs<option notransval=1 value=agentlog>Agent Logs<option notransval=1 value=relaylog>Relay Logs<option notransval=1 value=manual>Manual Logs<option notransval=1 value=runcommands>Run Command Logs<option notransval=1 value=batchupload>Batch Upload Logs<option notransval=1 value=changenode>Change Node Logs<option notransval=1 value=removenode>Remove Node Logs</select> <label for=p31limitdropdown class=me-1>Mostrar</label> <select id=p31limitdropdown class="form-select-sm me-2"onchange=refreshUsersEvents()><option notransval=1 value=60>Últimos 60<option notransval=1 value=120>Últimos 120<option notransval=1 value=250>Últimos 250<option notransval=1 value=500>Últimos 500<option notransval=1 value=1000>Últimos 1000<option notransval=1 value="">Sin límite</select> <a href=# onclick=p3showDownloadEventsDialog(3)><i class="fa-solid fa-download"role=button title="Descargar Eventos"></i></a></div><td class=h2></table><div id=p31events></div></div><div id=p40 style=display:none><div id=p40title><h1>Mis Estadísticas del Servidor</h1></div><div class="areaHead d-flex align-items-center flex-wrap p-1"><div class="d-flex align-items-center"><input value=Actualizar type=button class="btn btn-primary btn-sm me-2"onclick=refreshServerTimelineStats()><div class=form-check><input class="form-check-input me-1"type=checkbox id=p40log onclick=updateServerTimelineHours()><label class=form-check-label for=p40log>Log-X</label></div></div><div class="toright2 d-flex align-items-center ms-auto"><select id=p40server style=display:none onchange=updateServerTimelineStats()></select> <select id=p40type class="form-select-sm me-1"onchange=updateServerTimelineStats()><option value=0>Conexiones<option value=1>Memoria<option value=5>CPU<option value=3>Tráfico entrante<option value=4>Tráfico Saliente</select> <select id=p40time class="form-select-sm me-1"onchange=updateServerTimelineHours()><option value=3>Últimas 3 horas<option value=8>Últimas 8 horas<option value=24>Último día<option value=168>La semana pasada<option value=720>Últimos 30 días</select> <i class="fa-solid fa-download"title="Descargar puntos de datos (.csv)"style=cursor:pointer onclick=p40downloadEvents()></i></div></div><canvas id=serverMainStats></canvas></div><div id=p41 style=display:none><div id=p41title><h1>Mi Seguimiento del Servidor</h1></div><div class="areaHead d-flex align-items-center flex-wrap p-1"><div class="d-flex align-items-center"><input value=Rastreo type=button class="btn btn-primary btn-sm me-1"onclick=setServerTracing()> <span id=p41traceStatus>Ninguno</span></div><div class="toright2 d-flex align-items-center ms-auto"><label for=p41limitdropdown class=me-1>Mostrar</label> <select id=p41limitdropdown class="form-select-sm me-1"onchange=displayServerTrace()><option value=100>Últimos 100<option value=250>Últimos 250<option value=500>Últimos 500<option value=1000>Últimos 1000</select> <input value=Eliminar type=button class="btn btn-primary btn-sm me-1"onclick=clearServerTracing()> <i class="fa-solid fa-download"title="Descargar trace (.csv)"style=cursor:pointer onclick=p41downloadServerTrace()></i></div></div><div id=p41events></div></div><div id=p42 style=display:none><h1>Mis Plugins de Servidor</h1><div class=areaHead><div class=toright2></div><div><input value="Descargar Plugin"type=button onclick="return pluginHandler.addPluginDlg()"></div></div><div id=pluginRestartNotice class=areaHead style=background-color:gold;display:none><div class=toright2><input value="Actualizar Núcleos de Agente"type=button onclick="return distributeCore(),!1"></div><div style=padding:2px><div style=padding:2px><b>Aviso:</b> Se han modificado los plugins, esto puede requerir la actualización del núcleo del agente.</div></div></div><table id=p42tbl><tr class=DevSt><th style=width:26px><th style=width:10px><th class=chName>Nombre<th class=chDescription>Descripción<th class=chSite style=text-align:center>Enlace<th class=chVersion style=text-align:center>Versión<th class=chUpgradeAvail style=text-align:center>Última<th class=chStatus style=text-align:center>Estado<th class=chAction style=text-align:center>Acción<th style=width:10px></table><div id=pluginNoneNotice style=width:100%;text-align:center;padding-top:10px;display:none><i>No hay plugins en el servidor.</i></div></div><div id=p43 style=display:none><div id=p43BackButton><div class=backButton tabindex=0 onmouseup=go(42) title=Atrás onkeypress='"Enter"==event.key&&go(42)'><div class=backButtonEx></div></div></div><h1>Mis Plugins de Servidor - <span id=p43title></span></h1><iframe id=p43iframe frameborder=0 style="width:100%;height:calc(100vh - 245px);max-height:calc(100vh - 245px)"></iframe></div><div id=p50 style=display:none><div id=p50title><h1>Mis Grupos de Usuarios</h1></div><table class=pTable><tr><td class="style14 d-flex align-items-center flex-wrap p-1"><div id=p50userGroupOps class="d-flex align-items-center"><input type=button id=UsersGroupsSelectAllButton class="btn btn-primary btn-sm me-1"onclick=p50usersSelectallButtonFunction() value="Seleccionar Todo"> <input type=button id=UsersGroupsGroupActionButton class="btn btn-primary btn-sm me-1"disabled value="Acción de Grupo"onclick=p50usersGroupActionFunction()> <input id=NewUserGroupButton type=button class="btn btn-primary btn-sm me-1"onclick=showCreateUserGroupDialog(1) value="Nuevo Grupo..."> <input id=DuplicateUserGroupButton type=button class="btn btn-primary btn-sm me-1"style=display:none onclick=showCreateUserGroupDialog(2) value="Duplicar Grupo..."></div></table><div id=p50groups></div></div><div id=p51 style=display:none><div id=p51title class="d-flex align-items-center"><div id=p51BackButton class=pe-2><i class="fa-solid fa-square-caret-left fa-2xl"role=button tabindex=0 onclick=goBack() title=Atrás onkeypress='"Enter"==event.key&&goBack()'></i></div><div class="fs-4 fw-bold">Grupo de Usuarios - <span id=p51groupName></span></div></div><div id=p51info style=overflow-y:auto><div class=row><div class=col><div id=p51group></div></div><div class=col-auto style=width:20px></div><div class=col-auto style=width:200px><picture id=MainUserImage style=border-width:0;height:200px;width:200px;float:right><source type=image/webp width=200 height=200 srcset=images/webp/group-256.webp><img alt=""width=200 height=200 src=images/group-256.png></picture><div style=width:100%;text-align:center><strong><span id=MainUserState></span></strong></div></div></div><div id=p51group2></div><br></div></div><div id=p52 style=display:none><div id=p52title><h1>Mis Grabaciones de Usuarios</h1></div><table class=pTable><tr><td class="style14 d-flex align-items-center flex-wrap p-1"><div class="d-flex align-items-center"><input type=button class="btn btn-primary btn-sm"onclick=refreshRecodings() value=Actualizar></div><div class="d-flex align-items-center ms-auto"><input type=button class="btn btn-primary btn-sm"onclick=openRecodringPlayer() value="Abrir Reproductor..."></div></table><div id=p52recordings style=overflow-y:auto></div></div><div id=p60 style=display:none><div id=p60title><h1>Mis informes</h1></div>{{!-- --}} {{!-- --}}<table class=pTable><tr><td class=h1><td class=style14><div style=float:right;line-height:22px><a id=p60downloadReportDiv style=display:none href=# onclick=p60downloadReport()><i class="fa-solid fa-download"title="Descargar Reporte"></i></a>&nbsp;</div><div><button class="btn btn-primary btn-sm me-2 m-1"onclick=generateReportDialog()><i class="fa-regular fa-file-alt"></i> Generar informe...</button></div><td class=h2></table><div id=p60report style=overflow-y:auto></div></div><br id=column_l_bottomgap></div><div id=footer><div class=footer1>{{{footer}}}</div><div class=footer2 style=display:none><div class=row><div class="col-md-6 d-flex gap-2"></div><div class=col-md-6><a id=verifyEmailId2 style=display:none href=# onclick=account_showVerifyEmail()>Verificar Correo Electrónico</a> &nbsp;<a id=termsLinkFooter href=terms>Términos y Privacidad</a></div></div></div></div><div class="modal fade"id=xxAddAgentModal tabindex=-1 aria-hidden=true><div class="modal-dialog modal-dialog-centered"id=xxAddAgentModalConf><div class=modal-content><div class=modal-header id=dialogHeader><h5 class="modal-title text-white"id=xxAddAgentTitle></h5><button type=button class=btn-close data-bs-dismiss=modal aria-label=Close></button></div><div class=modal-body id=xxAddAgentBody><div id=dialog1><div id=id_dialogMessage></div></div><div id=dialog2><div id=id_dialogOptions></div></div><div id=dialog3><div id=d3upload><div>Selección de Archivo</div><select id=d3uploadMode onchange=d3modechange()><option value=1>Carga local de archivos<option value=2>Seleccionar un archivo del servidor</select></div><div id=d3localmode style=display:none><div>Cargar Archivo</div><form id=d3localmodeform method=post enctype=multipart/form-data action=uploadfile.ashx target=fileUploadFrame><input id=d3auth name=auth style=display:none> <input id=d3filter name=filter style=display:none> <input id=d3attrib name=attrib style=display:none> <input type=file id=d3localFile name=files onchange=d3setActions()> <input type=submit id=d3submit style=display:none></form></div><div id=d3servermode><div id=d3serveraction valign=bottom><input type=button id=p3FolderUp disabled onclick=d3folderup() value=Subir>&nbsp;<span id=p3CurrentFolder></span></div><div id=d3serverfiles></div></div></div><div id=dialog4><input id=d4WrapButton class="btn btn-primary me-1 mb-1"type=button value=Envoltura onclick=d4ToggleWrap()> <input id=d4SizeButton class="btn btn-primary me-1 mb-1"type=button value=Pequeño onclick=d4ToggleSize()> <input id=d4EncodingButton class="btn btn-primary me-1 mb-1"type=button value=Crudo onclick=d4ToggleEncoding()> <input id=d4LineBreakButton class="btn btn-primary me-1 mb-1"type=button value=Windows onclick=d4ToggleLineBreak()> <textarea id=d4editorarea autocomplete=off style="height:calc(100vh - 286px);width:100%;overflow:scroll;resize:none;white-space:pre"></textarea></div><div id=dialog7><div class=dtab><button id=td7meshkvm class=tablinks onclick='changeDesktopSettingsTab(event,"d7meshkvm")'>Agente</button> <button id=td7rdpkvm class=tablinks onclick='changeDesktopSettingsTab(event,"d7rdpkvm")'>RDP</button> <button id=td7amtkvm class=tablinks onclick='changeDesktopSettingsTab(event,"d7amtkvm")'>Intel® AMT</button></div><div id=d7meshkvm class=tabcontent><div style=margin-top:8px><div>Calidad</div><select id=d7bitmapquality dir=rtl></select></div><div><div>Escala</div><select id=d7bitmapscaling dir=rtl><option selected value=1024>100%<option value=896>87.5%<option value=768>75%<option value=640>62.5%<option value=512>50%<option value=384>37.5%<option value=256>25%<option value=128>12.5%</select></div><div><div>Cuadros por segundo</div><select id=d7framelimiter dir=rtl><option selected value=50>Rápido<option value=100>Medio<option value=400>Lento<option value=1000>Muy lento</select></div><div><div>Codificación</div><select id=d7encoding dir=rtl><option value=1>JPEG<option value=2>PNG<option value=3>TIFF<option selected value=4>WEBP</select></div><div id=d7desktopOtherSettings><div>Otros Ajustes</div><div id=d7otherset2 style=display:block><label style=display:block><input type=checkbox id=d7deskSwapMouse>Cambiar Botones del Mouse</label> <label style=display:block><input type=checkbox id=d7deskrmw>Rueda inversa del ratón</label> <label style=display:block><input type=checkbox id=d7deskRemoteKeyMap>Usar Mapa de Teclado Remoto</label> <label style=display:block id=d7deskAutoClipboardLabel><input type=checkbox id=d7deskAutoClipboard>Portapapeles Automático</label> <label style=display:block id=d7deskAutoLockLabel><input type=checkbox id=d7deskAutoLock>Bloquear al desconectar</label></div></div></div><div id=d7amtkvm class=tabcontent><div style=margin-top:8px><div>Codificación de Imagen</div><select id=d7desktopmode><option value=1>RLE8, Más Rápido<option value=2>RLE16, Recomendado<option value=3>RAW8, Lento<option value=4>RAW16, Muy Lento</select></div><div><div>Otros Ajustes</div><div id=d7otherset style=display:block><label style=display:block><input type=checkbox id=d7showfocus>Mostrar Herramienta de Enfoque</label> <label style=display:block><input type=checkbox id=d7showcursor>Mostrar Cursor del Mouse Local</label> <label style=display:block><input type=checkbox id=d7localKeyMap>Mapa de Teclado Local</label> <label style=display:block><input type=checkbox id=d7kvmrmw>Rueda inversa del ratón</label></div></div></div><div id=d7rdpkvm class=tabcontent><div style=margin-top:8px><div>tamaño de la pantalla</div><select id=d7rdpsize><option notransval=1 value=canvas>Tamaño del lienzo<option notransval=1 value=browser>Tamaño del navegador<option notransval=1 value=screen>Tamaño de pantalla<option notransval=1 value=640x480>640x480<option notransval=1 value=1024x768>1024x768<option notransval=1 value=1280x800>1280x800<option notransval=1 value=1440x900>1440x900<option notransval=1 value=1600x900>1600x900<option notransval=1 value=1680x1050>1680x1050<option notransval=1 value=1920x1080>1920x1080</select></div><div><div>Opciones</div><div id=d7rdpflags style=display:block><label style=display:block><input type=checkbox id=d7rdp1>Desactivar fondo de pantalla</label> <label style=display:block><input type=checkbox id=d7rdp2>Desactivar arrastre de ventana completa</label> <label style=display:block><input type=checkbox id=d7rdp3>Desactivar animaciones de menú</label> <label style=display:block><input type=checkbox id=d7rdp4>Deshabilitar tematización</label> <label style=display:block><input type=checkbox id=d7rdp6>Deshabilitar la sombra del cursor</label> <label style=display:block><input type=checkbox id=d7rdp7>Deshabilitar la configuración del cursor</label> <label style=display:block><input type=checkbox id=d7rdp8>Habilitar suavizado de fuentes</label> <label style=display:block><input type=checkbox id=d7rdp9>Habilitar composición de escritorio</label> <label style=display:block><input type=checkbox id=d7rdpclip>Portapapeles Automático</label> <label style=display:block><input type=checkbox id=d7rdpsmb>Cambiar Botones del Mouse</label> <label style=display:block><input type=checkbox id=d7rdprmw>Rueda inversa del ratón</label></div></div></div></div></div><div class=modal-footer><button type=button class="btn btn-primary"data-bs-dismiss=modal id=idx_dlgCancelButton>Cancelar</button> <button type=button class="btn btn-outline-success"id=idx_dlgOkButton>OK</button> <button type=button class="btn btn-outline-danger"id=idx_dlgDeleteButton style=display:none>Eliminar</button></div></div></div></div><iframe name=fileUploadFrame style=display:none></iframe><form style=display:none method=post action=uploadfile.ashx enctype=multipart/form-data target=fileUploadFrame><input id=p5fileDragName name=name><input id=p5fileDragAuthCookie name=auth><input id=p5fileDragSize name=size><input id=p5fileDragType name=type><input id=p5fileDragData name=data><input id=p5fileDragLink name=link class="btn btn-outline-success"><input type=submit id=p5loginSubmit2 style=display:none class="btn btn-outline-success"></form><form style=display:none method=post action=uploadnodefile.ashx enctype=multipart/form-data target=fileUploadFrame><input id=p13fileDragName name=name class="btn btn-outline-success"><input id=p13fileDragSize name=size class="btn btn-outline-success"><input id=p13fileDragType name=type class="btn btn-outline-success"><input id=p13fileDragData name=data class="btn btn-outline-success"><input id=p13fileDragLink name=link class="btn btn-outline-success"><input type=submit id=p13loginSubmit2 style=display:none class="btn btn-outline-success"></form><div id=topMenu style="z-index:1000;background-color:#fff;box-shadow:0 0 15px #666;font-family:Arial,Helvetica,sans-serif;border-radius:0 0 5px 5px;position:fixed;top:50px;right:5px;width:170px;display:none"><div style="padding:12px;border-top:1px solid gray;color:#000;cursor:pointer"onclick=topMenu(1)>Mis Dispositivos</div><div style="padding:12px;border-top:1px solid gray;color:#000;cursor:pointer"onclick=topMenu(2)>Mi Cuenta</div><div style="padding:12px;border-top:1px solid gray;color:#000;cursor:pointer"onclick=topMenu(3)>Mis Eventos</div><div style="padding:12px;border-top:1px solid gray;color:#000;cursor:pointer"onclick=topMenu(5)>Mis Archivos</div><div style="padding:12px;border-top:1px solid gray;color:#000;cursor:pointer"onclick=topMenu(4)>Mis Usuarios</div><div style="padding:12px;border-top:1px solid gray;color:#000;cursor:pointer"onclick=topMenu(6)>Mi Servidor</div><div id=logoutMenuOption><a id=logoutMenuOptionRef href=/logout><div style="padding:12px;border-top:1px solid gray;color:#000;cursor:pointer">Cerrar sesión</div></a></div></div><audio id=chimes><source src=sounds/chimes.mp3 type=audio/mp3></audio><iframe style=display:none name=fileDownloadFrame></iframe></div><script>var i,args,urlargs,random="{{{randomlength}}}",webState="{{{webstate}}}";for(i in webState=null!=(webState=""!=webState?JSON.parse(decodeURIComponent(webState)):webState)&&"object"==typeof webState?webState:{})if("desktopsettings"!=i)try{localStorage.setItem(i,webState[i])}catch(e){}if(!webState.loctag)try{localStorage.removeItem("loctag")}catch(e){}var desktop,terminal,files,autoReconnect=!0,powerStatetable=["","Encendido","Suspender","Suspender","Suspender","Hibernando","Apagar","Presente"],StatusStrs=["Desconectado","Conectando....","Configurar...","Conectado","Intel&reg; AMT Conectado"],agentsStr=["Desconocido","Consola Windows 32bits","Consola Windows 64bits","Servicio Windows 32bits","Servicio Windows 64bits","Linux 32bit","Linux 64bit","MIPS","XENx86","Android","Linux ARM","macOS x86-32bit","Android x86","PogoPlug ARM","Android","Linux Poky x86-32bit","macOS x86-64bit","ChromeOS","Linux Poky x86-64bit","Linux NoKVM x86-32bit","Linux NoKVM x86-64bit","Consola MinCore de Windows","Servicio MinCore de Windows","NodeJS","ARM-Linaro","ARMv6l / ARMv7l","ARMv8 64bits","ARMv6l / ARMv7l / Sin KVM","MIPS24KC (OpenWRT)","Procesadores Apple","FreeBSD x86-64","Desconocido","Linux ARM 64 bit (glibc/2.24 NOKVM)","Alpine Linux x86 64 Bit (MUSL)","Asistente (Windows)","Armada370 - ARM32 / HF (libc / 2.26)","OpenWRT x86-64","OpenBSD x86-64","Desconocido","Desconocido","MIPSEL24KC (OpenWRT)","ARMADA/CORTEX-A53/MUSL (OpenWRT)","Consola Windows ARM 64bit","Servicio Windows ARM 64bit"],agentsStrNoAgent=["","","","","Windows","","Linux","","","","","","","","","","","","","","","","","","","","","","","Apple"],sort=0,searchFocus=0,mapSearchFocus=0,userSearchFocus=0,consoleFocus=0,showRealNames=!1,meshserver=null,meshes={},loginTokens={},meshcount=0,nodes=null,usergroups=null,filetree={},userinfo=null,serverinfo=null,events=[],users=null,wssessions=null,stars={},nodeShortIdent=0,desktopsettings={encoding:2,showfocus:!1,showmouse:!0,showcad:!0,quality:40,scaling:1024,framerate:50,localkeymap:!1,swapmouse:!1,remotekeymap:!1,autoclipboard:!1,autolock:!1,agentencoding:4},multidesktopsettings={quality:20,scaling:128,framerate:1e3,agentencoding:4},debugLevel=parseInt("{{{debuglevel}}}"),features=parseInt("{{{features}}}"),features2=parseInt("{{{features2}}}"),sessionTime=parseInt("{{{sessiontime}}}"),webRelayPort=parseInt("{{{webRelayPort}}}"),webRelayDns="{{{webRelayDns}}}",hidePowerTimeline="{{{hidePowerTimeline}}}",showNotesPanel="{{{showNotesPanel}}}",sessionRefreshTimer=null,domain="{{{domain}}}",domainUrl="{{{domainurl}}}",authCookie="{{{authCookie}}}",authRelayCookie="{{{authRelayCookie}}}",logoutControls=JSON.parse(decodeURIComponent("{{{logoutControls}}}")),authCookieRenewTimer=null,multiDesktop={},serverPublicNamePort="{{{serverDnsName}}}:{{{serverPublicPort}}}",amtScanResults=null,debugmode=0,windowsBrowser=detectWindowsBrowser(),attemptWebRTC=0!=(128&features),webrtcconfiguration="{{{webrtcconfig}}}";if(""==webrtcconfiguration)webrtcconfiguration=null;else try{webrtcconfiguration=JSON.parse(decodeURIComponent(webrtcconfiguration))}catch(e){console.log('Invalid WebRTC config: "'+webrtcconfiguration+'".'),webrtcconfiguration=null}var passRequirements="{{{passRequirements}}}";""!=passRequirements&&(passRequirements=JSON.parse(decodeURIComponent(passRequirements)));var customui=""!=(customui="{{{customui}}}")?JSON.parse(decodeURIComponent(customui)):null,deskAspectRatio=0;try{deskAspectRatio=parseInt(getstore("deskAspectRatio","0"))}catch(e){}var uiMode=parseInt(getstore("uiMode",1)),webPageStackMenu=!1,webPageFullScreen=!0,nightMode=setNightMode(),footerBar="1"==getstore("footerBar","1"),sessionActivity=Date.now(),updateSessionTimer=null,pluginHandlerBuilder={{{pluginHandler}}},pluginHandler=null,installedPluginList=(null!=pluginHandlerBuilder&&(pluginHandler=new pluginHandlerBuilder),null),goBackStack=[],CollapsedGroups={};try{CollapsedGroups=JSON.parse(getstore("_collapse","{}"))}catch(e){}var deviceViewSettings={};try{deviceViewSettings=JSON.parse(getstore("_deviceViewSettings","{}"))}catch(e){}var userViewSettings={};try{userViewSettings=JSON.parse(getstore("_usersViewSettings","{}"))}catch(e){}var xterm=null,xtermfit=null,xtermResizeTimer=null,miscState={},checkedNodeids={},deskKeyboardShortcuts=[],deskKeyboardStrings=[],deskLastClipboardSent=null,requestedLastConnects=!1,devicePagingState=null,p11DeskConsoleMsgTimer=null,p12TermConsoleMsgTimer=null,p13FilesConsoleMsgTimer=null,webpSupport=!1;function startup(){if(0==(32&features)){var e=null;try{e=top.location.toString().toLowerCase()}catch(e){}if(top!=self&&(null==e||0==top.active))return void(top.location=self.location)}null!=(urlargs=parseUriArgs()).key&&(urlargs.key=""+urlargs.key),urlargs.key&&0==isAlphaNumeric(urlargs.key)&&delete urlargs.key,urlargs.locale&&0==isAlphaNumeric(urlargs.locale)&&delete urlargs.locale,delete urlargs.user,delete urlargs.pass,delete urlargs.viewmode,delete urlargs.gotonode,delete urlargs.gotodevicename,delete urlargs.gotodeviceip,delete urlargs.gotomesh,delete urlargs.gotouser,delete urlargs.gotougrp,urlargs.key&&(Q("termsLinkFooter").href+="?key="+urlargs.key),(args=parseUriArgs()).key&&0==isAlphaNumeric(args.key)&&delete args.key,args.locale&&0==isAlphaNumeric(args.locale)&&delete args.locale,args.locale||null!=(n=getstore("loctag",0))&&"*"!=n&&(args.locale=n),debugmode=args.debug,null!=args.webrtc&&(attemptWebRTC=1==args.webrtc),QV("p13AutoConnect",debugmode),QV("autoconnectbutton2",debugmode),QV("autoconnectbutton1",debugmode),nightMode&&(document.documentElement.setAttribute("data-bs-theme","dark"),QC("body").add("night"),QS("body")["background-color"]="#000"),toggleFullScreen();try{stars=JSON.parse(getstore("stars","{}"))}catch(e){}var e=0,t=parseInt("{{{hide}}}"),t=((t||args.hide)&&(args.hide&&(e=parseInt(args.hide)),t)&&(e|=t),args.hide=e,QV("uiViewButton5",!(4&args.hide)),adjustPanels(),"");logoutControls&&(null!=logoutControls.name&&(t='<span onmouseup=go(2) CLASS="LogoffLinkColor" style="cursor:pointer">'+format("Bienvenido {0}.",logoutControls.name)+"</span>"),null!=logoutControls.logoutUrl)&&(t+=format(' <a href="'+logoutControls.logoutUrl+'" CLASS="LogoffLinkColor">Cerrar sesión</a>')),1&args.hide?QH("logoutControlSpan2",t):QH("logoutControlSpan",t),document.onclick=function(e){hideContextMenu()},document.onkeypress=ondockeypress,document.onkeydown=ondockeydown,document.onkeyup=ondockeyup,window.addEventListener("blur",ondocblur,!1),window.onresize=function(){hideContextMenu(),mainUpdate(512),browserfullscreen=isBrowserFullscreen(),QV("DeskESC",browserfullscreen),null!=xtermfit&&12==xxcurrentView&&xtermfit.fit()},setTimeout(function(){urlargs.filter&&(Q("SearchInput").value=urlargs.filter,Q("KvmSearchInput").value=urlargs.filter),mainUpdate(512)},200),DOMPurify&&DOMPurify.addHook("afterSanitizeAttributes",function(e){"target"in e&&(e.setAttribute("target","_blank"),e.setAttribute("rel","noopener noreferrer")),e.hasAttribute("target")||!e.hasAttribute("xlink:href")&&!e.hasAttribute("href")||e.setAttribute("xlink:show","new")}),QV("textnewui",0!=(1073741824&features2)),(meshserver=MeshServerCreateControl(domainUrl)).onStateChanged=onStateChanged,meshserver.onMessage=onMessage,meshserver.trace=args.trace,meshserver.Start(),Q("sortselect").selectedIndex=sort=getstore("sort",0),Q("sizeselect").selectedIndex=getstore("viewsize",1),Q("KvmSearchInput").value=Q("SearchInput").value=getstore("_search",""),showRealNames=1==getstore("showRealNames",0),Q("RealNameCheckBox").checked=showRealNames,Q("DevFilterSelect").value=getstore("devFilterSelect",0),Q("viewselect").value=getstore("deviceView",1),Q("DeskControl").checked=1==getstore("DeskControl",1),QV("accountChangeEmailAddressSpan",0==(2097152&features)),mainUpdate(3);for(var o=1;o<5;o++)Q("devViewButton"+o).classList.remove("viewSelectorSel");Q("devViewButton"+Q("viewselect").value).classList.add("viewSelectorSel"),Q("p5filetable").addEventListener("drop",p5fileDragDrop,!1),Q("p5filetable").addEventListener("dragover",p5fileDragOver,!1),Q("p5filetable").addEventListener("dragleave",p5fileDragLeave,!1),Q("deskarea0").addEventListener("drop",p11fileDragDrop,!1),Q("deskarea0").addEventListener("dragover",p11fileDragOver,!1),Q("deskarea0").addEventListener("dragleave",p11fileDragLeave,!1),Q("p13filetable").addEventListener("drop",p13fileDragDrop,!1),Q("p13filetable").addEventListener("dragover",p13fileDragOver,!1),Q("p13filetable").addEventListener("dragleave",p13fileDragLeave,!1),setInterval(updateDeviceTimeline,12e4);e=null;try{e=localStorage.getItem("desktopsettings")}catch(e){}null!=e&&(desktopsettings=JSON.parse(e)),e=null;try{e=localStorage.getItem("multidesktopsettings")}catch(e){}null!=e&&(multidesktopsettings=JSON.parse(e)),applyDesktopSettings();for(var n="",i=1;i<27;i++)n+="<option value='"+i+"'>Ctrl-"+String.fromCharCode(64+i)+" ("+i+")</option>";QH("specialkeylist",n),setupGeneralServerStats(),setupServerTimelineStats(),userInterfaceSelectMenu(),setupMeshSummaryStats(),QV("p4UserBatchCreate",0==(524288&features)),d4EditWrapVal=Number(getstore("editorWrap",0)),d4EditSizeVal=Number(getstore("editorSize",0)),d4EditEncodingVal=Number(getstore("editorEncoding",0)),d4EditLineBreakVal=Number(getstore("editorLineBreak",0)),d4ToggleWrap(!0),d4ToggleSize(!0),d4ToggleEncoding(!0),d4ToggleLineBreak(!0),null!=pluginHandler&&pluginHandler.callHook("onWebUIStartupEnd"),-1==["en","ko","ja","zh-chs","zh-cht"].indexOf("{{{lang}}}")&&""!="{{{lang}}}".toLowerCase()&&QC("body").add("nonenglish");var a=document.getElementsByClassName("topbar_td");for(r in a)a[r].innerHTML&&(a[r].innerHTML=a[r].innerHTML.split(" ").join("&nbsp;"));if(null!=customui){if(customui.devicesbarbuttons){n="";for(r in customui.devicesbarbuttons){var s="one"==customui.devicesbarbuttons[r].selection||"many"==customui.devicesbarbuttons[r].selection?"disabled":"";n+='<input id="cui:'+r+'" type="button" value="'+customui.devicesbarbuttons[r].name+'" '+s+' onclick=customUIAction(event,"devicesbarbuttons") />'}QH("devsCustomUIBar",n)}if(customui.desktopbuttons){n="";for(r in customui.desktopbuttons)n+='<input id="cui:'+r+'" type="button" value="'+customui.desktopbuttons[r].name+'" style="float:left" onclick=customUIAction(event,"desktopbuttons") />';QH("desktopCustomUiButtons",n)}if(customui.terminalbuttons){n="";for(r in customui.terminalbuttons)n+='<input id="cui:'+r+'" type="button" value="'+customui.terminalbuttons[r].name+'" style="float:left" onclick=customUIAction(event,"terminalbuttons") />';QH("terminalCustomUiButtons",n)}if(customui.filesbuttons){n="";for(r in customui.filesbuttons)n+='<input id="cui:'+r+'" type="button" value="'+customui.filesbuttons[r].name+'" style="float:left" onclick=customUIAction(event,"filesbuttons") />';QH("filesCustomUiButtons",n)}}10<=sessionTime&&(sessionRefreshTimer=setTimeout(refreshCookieSession,Math.round(6e4*sessionTime*.8))),deskKeyboardShortcuts=[];var r,l=getstore("deskKeyShortcuts","0x0A002E,0x100000,0x100028,0x100026,0x10004C,0x10004D,0x11004D,0x100052,0x020073,0x080057,0x020009,0x100025,0x100027").split(",");for(r in l)""!=l[r]&&deskKeyboardShortcuts.push(parseInt(l[r]));updateDeskShortcutKeys();try{deskKeyboardStrings=JSON.parse(getstore("deskStrings","[]"))}catch(e){}updateDesktopStrings(),updateCollapseAllButton(),dialogBoxDrag(),urlargs.key&&(Q("p6backuplink").href+="?key="+urlargs.key),QV("uiViewButton4",0==(3145728&features2)),Q("DeskType").value=multiTranslate("[KeyboardTyping]|Tipo"),QV("ScrollToTopButton",0!=(134217728&features2))}function refreshCookieSession(){var e=null;try{e=new XDomainRequest}catch(e){}(e=e||new XMLHttpRequest).open("GET",window.location.origin+domainUrl+"refresh.ashx"),e.timeout=15e3,e.onload=function(){sessionRefreshTimer=setTimeout(refreshCookieSession,Math.round(6e4*sessionTime*.8))},e.onerror=e.ontimeout=function(){sessionRefreshTimer=null},e.send()}function customUIAction(e,t){e=e.srcElement.id;if(0!=e.startsWith("cui:")){var o=customui[t][e.substring(4)];if(null!=o){if("devicesbarbuttons"==t){for(var n=document.getElementsByClassName("DeviceCheckbox"),i=[],a=0;a<n.length;a++)!0===n[a].checked&&i.push(n[a].defaultValue.substring(6));if("string"==typeof o.action&&("event"==o.action&&meshserver.send({action:"uicustomevent",section:t,element:e.substring(4),selectedDevices:i,logmsg:o.logmsg}),o.action.startsWith("dialog:")&&showCustomUiDialog(o.action.substring(7),{section:t,element:e.substring(4),selectedDevices:i}),o.deselectdevices)){for(a=0;a<n.length;a++)n[a].checked=!1;checkedNodeids={},p1updateInfo()}}"devicebuttons"!=t&&"desktopbuttons"!=t&&"terminalbuttons"!=t&&"filesbuttons"!=t||(i=[currentNode._id],"string"==typeof o.action&&("event"==o.action&&meshserver.send({action:"uicustomevent",section:t,element:e.substring(4),selectedDevices:i,logmsg:o.logmsg}),o.action.startsWith("dialog:"))&&showCustomUiDialog(o.action.substring(7),{section:t,element:e.substring(4),selectedDevices:i}))}}}function showCustomUiDialog(e,t){if(null!=customui&&null!=customui.dialogs&&"object"==typeof customui.dialogs[e]){var o="",n=customui.dialogs[e];if("string"==typeof n.text&&(o+="<div style=margin-bottom:8px>"+n.text+"</div>"),"number"==typeof n.buttons&&n.buttons,"object"==typeof n.elements)for(var i in n.elements){var a=n.elements[i];if("text"==a.type&&(o+=addHtmlFormFloating(a.name,"<input id=cui:"+i+" class=form-control autocomplete=off />")),"textarea"==a.type&&(null==a.name?o+="<textarea id=cui:"+i+" style=width:356px;resize:none;height:100px autocomplete=off></textarea>":o+=addHtmlFormFloating(a.name,"<textarea id=cui:"+i+" style=width:230px;resize:none;height:100px autocomplete=off></textarea>")),"droplist"==a.type){var s,r="";for(s in a.options)r+='<option value="'+s+'">'+EscapeHtml(a.options[s])+"</option>";o+=addHtmlFormFloating(a.name,'<select id="cui:'+i+'" class=form-select autocomplete=off />'+r+"</select>")}}setModalContent("xxAddAgent",n.title,o),showModal("xxAddAgentModal","idx_dlgOkButton",{action:"uicustomevent",section:"dialogs",element:e,src:t,values:{},logmsg:n.logmsg})}}function showCustomUiDialogEx(e,t){if(1==e){var o=customui.dialogs[t.element];if("object"==typeof o.elements)for(var n in o.elements){var i=o.elements[n];"droplist"!=i.type&&"textarea"!=i.type&&"text"!=i.type||(t.values[n]=Q("cui:"+n).value)}if(meshserver.send(t),o.deselectdevices){for(var a=document.getElementsByClassName("DeviceCheckbox"),n=0;n<a.length;n++)a[n].checked=!1;checkedNodeids={},p1updateInfo()}}}function adjustPanels(){var e=args.hide,e=(0==footerBar&&(e|=4),QV("masthead",!(1&e)),QV("topbar",!(2&e)),QV("footer",!(4&e)),QV("p1title",!(8&e)),QV("p2title",!(8&e)),QV("p3title",!(8&e)),QV("p4title",!(8&e)),QV("p5title",!(8&e)),QV("p6title",!(8&e)),QV("p10title",!(8&e)),QV("p11title",!(8&e)),QV("p12title",!(8&e)),QV("p13title",!(8&e)),QV("p14title",!(8&e)),QV("p15title",!(8&e)),QV("p16title",!(8&e)),QV("p17title",!(8&e)),QV("p20title",!(8&e)),QV("p21title",!(8&e)),QV("p30title",!(8&e)),QV("p31title",!(8&e)),QV("p40title",!(8&e)),QV("p41title",!(8&e)),QV("p50title",!(8&e)),QV("p51title",!(8&e)),footerBar?QC("body").remove("nofooter"):QC("body").add("nofooter"),0!=args.hide&&(2==uiMode?(QS("container")["grid-template-rows"]=(1&e?"0":"66")+"px fit-content(48px) auto "+(4&e?"0":"45")+"px",QS("container")["-ms-grid-rows"]=(1&e?"0":"66")+"px fit-content(48px) auto "+(4&e?"0":"45")+"px"):(QS("container")["grid-template-rows"]=(1&e?"0":"66")+"px "+(2&e?"0":"24")+"px auto "+(4&e?"0":"45")+"px",QS("container")["-ms-grid-rows"]=(1&e?"0":"66")+"px "+(2&e?"0":"24")+"px auto "+(4&e?"0":"45")+"px")),(1&e?0:66)+(2&e?0:24)+(4&e?0:45)+(8&e?0:60)),t=1<uiMode?24:0,o=(QS("p2info").height="calc(100vh - "+(20+e+t)+"px)",QS("p2info")["max-height"]="calc(100vh - "+(20+e+t)+"px)",QS("p3users")["max-height"]="calc(100vh - "+(50+e)+"px)",QS("p50groups")["max-height"]="calc(100vh - "+(50+e)+"px)",QS("p3events").height="calc(100vh - "+(50+e)+"px)",QS("p5filetable").height="calc(100vh - "+(99+e)+"px)",QS("p13filetable").height="calc(100vh - "+(127+e+t)+"px)",QS("serverMainStats").height="calc(100vh - "+(50+e+t)+"px)",QS("serverMainStats")["max-height"]="calc(100vh - "+(50+e+t)+"px)",QS("xdevices")["max-height"]="calc(100vh - "+(46+e)+"px)",QS("xdevicesmap")["max-height"]="calc(100vh - "+(46+e)+"px)",QS("p15agentConsole").height="calc(100vh - "+(84+e+t)+"px)",QS("p15agentConsole")["max-height"]="calc(100vh - "+(84+e+t)+"px)",QS("p15agentConsoleText").height="calc(100vh - "+(81+e+t)+"px)",QS("p15agentConsoleText")["max-height"]="calc(100vh - "+(81+e+t)+"px)",!(0===args.xterm||null!=terminal&&null==xterm));fullscreen?(QS("deskarea3x").height=null,QS("deskarea3x")["max-height"]=null,QS("p14iframe").height=null,QS("p14iframe")["max-height"]=null,o&&(QS("termarea3x").height="calc(100vh - 55px)",QS("termarea3xdiv").height="calc(100vh - 55px)",QS("termarea3x")["max-width"]="calc(1px)")):(QS("deskarea3x").height="calc(100vh - "+(74+e+t)+"px)",QS("deskarea3x")["max-height"]="calc(100vh - "+(74+e+t)+"px)",QS("p14iframe").height="calc(100vh - "+(23+e+t)+"px)",QS("p14iframe")["max-height"]="calc(100vh - "+(23+e+t)+"px)",o&&(QS("termarea3x").height="calc(100vh - "+(74+e+t)+"px)",QS("termarea3xdiv").height="calc(100vh - "+(74+e+t)+"px)",QS("termarea3x")["max-width"]="calc(1px)")),QS("p43iframe").height="calc(100vh - "+(84+e)+"px)",QS("p43iframe")["max-height"]="calc(100vh - "+(84+e)+"px)",QS("p6info").height="calc(100vh - "+(e-50+t)+"px)",QS("p6info")["max-height"]="calc(100vh - "+(e-50+t)+"px)",QS("p10info").height="calc(100vh - "+(20+e+t)+"px)",QS("p10info")["max-height"]="calc(100vh - "+(20+e+t)+"px)",QS("p17info").height="calc(100vh - "+(20+e+t)+"px)",QS("p17info")["max-height"]="calc(100vh - "+(20+e+t)+"px)",QS("p20main").height="calc(100vh - "+(e-50+t)+"px)",QS("p20main")["max-height"]="calc(100vh - "+(e-50+t)+"px)",QS("p21main").height="calc(100vh - "+(20+e+t)+"px)",QS("p21main")["max-height"]="calc(100vh - "+(20+e+t)+"px)",QS("p30info").height="calc(100vh - "+(20+e+t)+"px)",QS("p30info")["max-height"]="calc(100vh - "+(20+e+t)+"px)",QS("p51info").height="calc(100vh - "+(20+e+t)+"px)",QS("p51info")["max-height"]="calc(100vh - "+(20+e+t)+"px)",QS("p16events").height="calc(100vh - "+(50+e+t)+"px)",QS("p16events")["max-height"]="calc(100vh - "+(50+e+t)+"px)",QS("p31events").height="calc(100vh - "+(50+e+t)+"px)",QS("p31events")["max-height"]="calc(100vh - "+(50+e+t)+"px)",QS("p41events").height="calc(100vh - "+(48+e+t)+"px)",QS("p41events")["max-height"]="calc(100vh - "+(48+e+t)+"px)",QS("p52recordings").height="calc(100vh - "+(48+e+t)+"px)",QS("p52recordings")["max-height"]="calc(100vh - "+(48+e+t)+"px)",QS("p60report").height="calc(100vh - "+(48+e+t)+"px)",QS("p60report")["max-height"]="calc(100vh - "+(48+e+t)+"px)",(32&args.hide||""!="{{currentNode}}".toLowerCase())&&(QV("p10BackButton",!1),QV("p11BackButton",!1),QV("p12BackButton",!1),QV("p13BackButton",!1),QV("p14BackButton",!1),QV("p15BackButton",!1),QV("p16BackButton",!1),QV("p17BackButton",!1)),p1updateInfo()}function toggleAspectRatio(e){1===e&&putstore("deskAspectRatio",deskAspectRatio=(deskAspectRatio+1)%3),deskAdjust()}function toggleStackMenu(e){1==webPageFullScreen&&(1===e&&putstore("webPageStackMenu",webPageStackMenu=!webPageStackMenu),0==webPageStackMenu?QC("body").remove("menu_stack"):(QC("body").add("menu_stack"),10<=xxcurrentView&&QC("column_l").remove("room4submenu")),deskAdjust())}function showUserInterfaceSelectMenu(){if(!xxdialogMode){Q("uiViewButton1").classList.remove("uiSelectorSel"),Q("uiViewButton2").classList.remove("uiSelectorSel"),Q("uiViewButton3").classList.remove("uiSelectorSel"),Q("uiViewButton4").classList.remove("uiSelectorSel"),Q("uiViewButton5").classList.remove("uiSelectorSel");try{Q("uiViewButton"+uiMode).classList.add("uiSelectorSel")}catch(e){}QV("uiMenu","none"==QS("uiMenu").display),nightMode&&Q("uiViewButton4").classList.add("uiSelectorSel"),footerBar&&Q("uiViewButton5").classList.add("uiSelectorSel")}}function userInterfaceSelectMenu(e){e&&putstore("uiMode",uiMode=e),webPageFullScreen=uiMode<3,webPageStackMenu=1<uiMode,toggleFullScreen(0),toggleStackMenu(0),webPageStackMenu&&10<=xxcurrentView?QC("column_l").add("room4submenu"):QC("column_l").remove("room4submenu"),adjustPanels()}function toggleNightMode(){var e;xxdialogMode||(e=getstore("nightMode","0"),xxdialogButtons=3,setModalContent("xxAddAgent","Modo Nocturno","<input type=radio id=night0 name=nightmoderadio value=0 "+(0==e?"checked":"")+"><label for=night0>Predeterminado del navegador</label><br>"+("<input type=radio id=night2 name=nightmoderadio value=2 "+(2==e?"checked":"")+"><label for=night2>Modo de luz</label><br>")+("<input type=radio id=night1 name=nightmoderadio value=1 "+(1==e?"checked":"")+"><label for=night1>Modo Oscuro</label><br>")),showModal("xxAddAgentModal","idx_dlgOkButton",toggleNightModeEx),QV("uiMenu",!1))}function toggleNightModeEx(){var e="0";Q("night1").checked&&(e="1"),putstore("nightMode",e=Q("night2").checked?"2":e),setNightMode()}function setNightMode(){var e=getstore("nightMode","0");return nightMode=!1,0!=(1048576&features2)&&(e="1"),"1"==(e=0!=(2097152&features2)?"2":e)?nightMode=!0:"0"==e&&window.matchMedia&&(nightMode=window.matchMedia("(prefers-color-scheme: dark)").matches),nightMode?(document.documentElement.setAttribute("data-bs-theme","dark"),QC("body").add("night"),QS("body")["background-color"]="#000"):(document.documentElement.setAttribute("data-bs-theme","light"),QC("body").remove("night"),QS("body")["background-color"]="#d3d9d6"),nightMode}function toggleFooterBarMode(){putstore("footerBar",(footerBar=!footerBar)?"1":"0"),QS("container")["grid-template-rows"]=null,QS("container")["-ms-grid-rows"]=null,adjustPanels()}function toggleFullScreen(e){var t=document.getElementById("page_leftbar");1===e&&putstore("webPageFullScreen",webPageFullScreen=!webPageFullScreen),0==webPageFullScreen?(QC("body").remove("menu_stack"),QC("body").remove("fullscreen"),QC("body").remove("arg_hide"),10<=xxcurrentView&&QC("column_l").add("room4submenu"),QV("UserDummyMenuSpan",!1),t.classList.add("d-none")):(QC("body").add("fullscreen"),16&args.hide&&QC("body").add("arg_hide"),QV("page_leftbar",!(16&args.hide)),QV("MainMenuSpan",!(16&args.hide)),10<=xxcurrentView&&QC("column_l").remove("room4submenu"),QV("UserDummyMenuSpan",xxcurrentView<10&&webPageFullScreen),t.classList.remove("d-none")),mainUpdate(512),QV("body",!0)}function saveUserInterfaceMode(){var e=3;Q("ui0").checked&&(e=2),getstore("uiViewMode",3)!=e&&(putstore("uiViewMode",e),(e=new URL(window.location.href)).searchParams.has("sitestyle")&&(e.searchParams.delete("sitestyle"),window.history.replaceState({},document.title,e.toString())),reload())}function toggleBootstrapUIMode(){var e,t;xxdialogMode||(t="<div class=form-check><input type=radio class=form-check-input id=ui0 name=uiradio value=2 "+(2==(e=getstore("uiViewMode",3))?"checked":"")+"><label class=form-check-label for=ui0>Classic</label></div>",setModalContent("xxAddAgent","User Interface",t+="<div class=form-check><input type=radio class=form-check-input id=ui1 name=uiradio value=3 "+(3==e?"checked":"")+"><label class=form-check-label for=ui1>Modern</label></div>"),showModal("xxAddAgentModal","idx_dlgOkButton",saveUserInterfaceMode),QV("uiMenu",!1))}function getNodeFromId(e){if(null!=nodes)for(var t in nodes)if(nodes[t]._id==e)return nodes[t];return null}function reload(){var e=window.location.href;(e=e.endsWith("/#")?e.substring(0,e.length-2):e).endsWith("#")&&(e=e.substring(0,e.length-1)),window.location.href=e}function onStateChanged(e,t,o,n){0==t?(setDialogMode(0),go(0),deviceShares=powerTimelineUpdate=powerTimelineNode=powerTimelineReq=powerTimeline=null,deleteAllNotifications(),hideContextMenu(),QV("verifyEmailId2",!1),QV("logoutControl",!1),"noauth"==n?QH("p0span","No se puede realizar la autenticación"):"invalidorigin"==n?QH("p0span","Invalid origin in HTTP request"):(2==o?autoReconnect&&setTimeout(serverPoll,5e3):QH("p0span","No se puede conectar al web socket"),null!=authCookieRenewTimer&&(clearInterval(authCookieRenewTimer),authCookieRenewTimer=null))):2==t&&(meshserver.send({action:"usergroups"}),meshserver.send({action:"meshes"}),meshserver.send({action:"nodes",id:"{{currentNode}}",skip:null==devicePagingState?0:devicePagingState.skip}),meshserver.send({action:"loginTokens"}),null!=pluginHandler&&meshserver.send({action:"plugins"}),""=="{{currentNode}}".toLowerCase()&&meshserver.send({action:"files"}),""=="{{viewmode}}".toLowerCase()&&go(1),authCookieRenewTimer=setInterval(function(){meshserver.send({action:"authcookie"})},18e5),40==xxcurrentView)&&refreshServerTimelineStats()}function serverPoll(){var e=null;try{e=new XDomainRequest}catch(e){}(e=e||new XMLHttpRequest).open("HEAD",window.location.href),e.timeout=15e3,e.onload=function(){e.status<500?reload():setTimeout(serverPoll,1e4)},e.onerror=e.ontimeout=function(){setTimeout(serverPoll,1e4)},e.send()}function detectWindowsBrowser(){var e=window.navigator.userAgent.toUpperCase();return 0<=e.indexOf("WINDOWS")||0<=e.indexOf("WIN32")||0<=e.indexOf("WIN64")}function updateSiteAdmin(){var e=parseInt("{{{serverfeatures}}}"),t=userinfo.siteadmin,o=4294967295!=t&&0!=(1024&t)||0!=(256&features2);QV("p2AccountSecurity",0==(4&features)&&0==serverinfo.domainauth&&0!=(4096&features)&&0==o),QV("p2AccountActions",!o),QV("managePhoneNumber1",33554432&features&&67108864&features&&1!=serverinfo.lock2factor),QV("managePhoneNumber2",33554432&features&&!(67108864&features)&&1!=serverinfo.lock2factor),QV("manageMessaging1",33554432&features2&&67108864&features2&&1!=serverinfo.lock2factor),QV("manageMessaging2",33554432&features2&&!(67108864&features2)&&1!=serverinfo.lock2factor),QV("manageEmail2FA",8388608&features&&1!=serverinfo.lock2factor),QV("p2AccountPassActions",0==(4&features)&&0==serverinfo.domainauth&&null!=userinfo&&0==userinfo._id.split("/")[2].startsWith("~")),QV("accountCreateLoginTokenSpan",128&features2),QV("p2AccountImageFrame",!o),QV("p2ServerActions",21&t&&0!=(143&e)),QV("LeftMenuMyServer",21&t&&0!=(64&e)),QV("MainMenuMyServer",21&t),QV("p2ServerActionsBackup",1&t&&0!=(1&e)),QV("p2ServerActionsRestore",4&t&&0!=(2&e)),QV("p2ServerActionsVersion",16&t&&0!=(4&e)),QV("p2ServerActionsErrors",16&t&&0!=(8&e)),QV("p2ServerActionsConfig",16&t&&0!=(128&e)),QV("MainMenuMyFiles",8&t),QV("LeftMenuMyFiles",8&t),0==(8&t)&&5==xxcurrentView&&(setDialogMode(0),go(1)),null!=currentNode&&gotoDevice(currentNode._id,xxcurrentView,!0),null!=userinfo.flags&&1&userinfo.flags?(null==userinfo.accountImageRnd&&(userinfo.accountImageRnd=Math.floor(9999999999*Math.random())),Q("p2AccountImage").src="userimage.ashx?rnd="+userinfo.accountImageRnd):Q("p2AccountImage").src="images/user-256.png",0!=(2&userinfo.siteadmin)?(null==users&&meshserver.send({action:"users"}),null==wssessions&&meshserver.send({action:"wssessioncount"}),mainUpdate(24576)):(wssessions=users=null,mainUpdate(16384),(4==xxcurrentView||30<=xxcurrentView&&xxcurrentView<40)&&(setDialogMode(0),go(1),currentUser=null)),meshserver.send({action:"events",limit:parseInt(p3limitdropdown.value)}),QV("ServerConsole",4294967295===userinfo.siteadmin&&0!=(16&e)),QV("ServerTrace",4294967295===userinfo.siteadmin&&0!=(32&e)),115==xxcurrentView&&4294967295!=userinfo.siteadmin&&go(6),6==xxcurrentView&&0==(21&userinfo.siteadmin)&&go(1),0!=(21&t)&&meshserver.send({action:"serverstats",interval:1e4})}check_webp_feature("lossy",function(e,t){(webpSupport=t)||(d7encoding.options[1].disabled=!0,d7encoding.value=1)}),window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").addEventListener("change",setNightMode);var updateNaggleTimer=null,updateNaggleFlags=0;function mainUpdate(e){updateNaggleFlags|=e,null==updateNaggleTimer&&(updateNaggleTimer=setTimeout(function(){512&updateNaggleFlags&&center(),1&updateNaggleFlags&&onSearchInputChanged(),2&updateNaggleFlags&&onSortSelectChange(!1),128&updateNaggleFlags&&updateMeshes(),4&updateNaggleFlags&&(updateDevices(),updateDeviceDetails(),21==xxcurrentView)&&p21updateMesh(),8&updateNaggleFlags&&drawNotifications(),16&updateNaggleFlags&&32768&features&&updateMapMarkers(),32&updateNaggleFlags&&eventsUpdate(),64&updateNaggleFlags&&32768&features&&refreshMap(!1,!0),256&updateNaggleFlags&&drawDeviceTimeline(),1024&updateNaggleFlags&&deviceEventsUpdate(),2048&updateNaggleFlags&&userEventsUpdate(),4096&updateNaggleFlags&&p20updateMesh(),8192&updateNaggleFlags&&updateUserGroups(),16384&updateNaggleFlags&&updateUsers(),32768&updateNaggleFlags&&updateRecordings(),65536&updateNaggleFlags&&updateLoginTokens(),updateNaggleTimer=null,updateNaggleFlags=0,gotoStartViewPage()},150))}function count2factoraAuths(){var e;return null==userinfo?-1:(e=0,1==userinfo.otpsecret&&e++,0<userinfo.otphkeys&&(e+=userinfo.otphkeys),8388608&features&&1==userinfo.otpekey&&e++,33554432&features&&67108864&features&&null!=userinfo.phone&&e++,33554432&features2&&67108864&features2&&null!=userinfo.msghandle&&e++,0<e&&0<userinfo.otpkeys&&0==(262144&features2)&&e++,e)}var backupCodesWarningDone=!1;function updateSelf(){var e,t=count2factoraAuths(),o=4294967295!=userinfo.siteadmin&&0!=(1024&userinfo.siteadmin),o=(QV("verifyEmailId",!0!==userinfo.emailVerified&&null!=userinfo.email&&1==serverinfo.emailcheck),QV("verifyEmailId2",!0!==userinfo.emailVerified&&null!=userinfo.email&&1==serverinfo.emailcheck&&0==o),QV("manageOtp",1!=serverinfo.lock2factor&&0<t&&0==(262144&features2)),QV("authPhoneNumberCheck",null!=userinfo.phone),QV("authMessagingCheck",null!=userinfo.msghandle),QV("authEmailSetupCheck",1==userinfo.otpekey&&null!=userinfo.email&&1==userinfo.emailVerified),QV("authDuoSetupCheck",1==userinfo.otpduo&&0!=(536870912&features2)),QV("authAppSetupCheck",1==userinfo.otpsecret),QV("manageAuthApp",1!=serverinfo.lock2factor&&(1==userinfo.otpsecret||0==(131072&features2))),QV("manageDuoApp",1!=serverinfo.lock2factor&&0!=(536870912&features2)),QV("authKeySetupCheck",0<userinfo.otphkeys),QV("authPushAuthDevCheck",0<userinfo.otpdev&&0!=(64&features2)),QV("authCodesSetupCheck",0<userinfo.otpkeys),QV("managePushAuthDev",1!=serverinfo.lock2factor&&64&features2&&0<t),QV("manageHardwareOtp",1!=serverinfo.lock2factor),mainUpdate(4228),0==backupCodesWarningDone&&1==t&&0==(524288&features2)&&(addNotification({text:"Agregar códigos de respaldo de dos factores. Si se pierde el factor actual, no hay forma de recuperar esta cuenta.",title:"Autenticación de dos factores",tag:"backupcodes"}),backupCodesWarningDone=!0),4294967295==userinfo.siteadmin||0==(64&userinfo.siteadmin));QV("p2createMeshLink1",o),QV("p2createMeshLink2",o),QV("getStarted1",o),QV("getStarted2",!o),"number"==typeof userinfo.passchange&&(-1==userinfo.passchange?QH("p2nextPasswordUpdateTime"," - Reiniciar en el proximo inicio de sesión."):null!=passRequirements&&"number"==typeof passRequirements.reset&&((t=userinfo.passchange+86400*passRequirements.reset-Math.floor(Date.now()/1e3))<0?QH("p2nextPasswordUpdateTime"," - Reiniciar en el proximo inicio de sesión."):t<3600?(o=Math.floor(t/60),QH("p2nextPasswordUpdateTime",format(1==o?" - Reiniciar en 1 minuto.":" - Reiniciar en {0} minutos.",o))):t<86400?(e=Math.floor(t/3600),QH("p2nextPasswordUpdateTime",format(1==e?" - Reiniciar en 1 hora.":" - Reiniciar en {0} horas.",e))):(o=Math.floor(t/86400),QH("p2nextPasswordUpdateTime",format(1==e?" - Reiniciar en 1 dia.":" - Reiniciar en {0} dias.",o))))),QV("MainMenuMyUsers",null!=users&&0==(4&features)||0!=(512&userinfo.siteadmin)&&0!=(134217728&features)),QV("LeftMenuMyUsers",null!=users&&0==(4&features)||0!=(512&userinfo.siteadmin)&&0!=(134217728&features)),QV("UsersGeneral",null!=users&&0==(4&features)),QV("UsersGroups",null!=users&&0==(4&features)),QV("UsersRecordings",0!=(512&userinfo.siteadmin)&&0!=(134217728&features))}function setSessionActivity(){sessionActivity=Date.now(),QH("idleTimeoutNotify","")}function checkIdleSessionTimeout(){var e=Date.now()-sessionActivity;e>serverinfo.timeout?(null!=desktop&&(desktop.Stop(),webRtcDesktopReset(),(desktopNode=desktop=null)!=pluginHandler)&&pluginHandler.callHook("onDesktopDisconnect"),null!=terminal&&(terminal.Stop(),terminal=null),null!=files&&(files.Stop(),files=null),serverinfo.logoutOnIdleSessionTimeout&&(window.location.href="logout")):(e=Math.round((serverinfo.timeout-e)/1e3))<=60?QH("idleTimeoutNotify","<br />"+format(1==e?"1 segundo hasta desconectar":"{0} segundos hasta desconectar",e)):(e=Math.round(e/60))<=5&&QH("idleTimeoutNotify","<br />"+format(1==e?"1 minuto hasta desconectar":"{0} minutos hasta desconectar",e))}function onMessage(H,o){switch(o.action){case"trace":serverTrace.unshift(o),displayServerTrace();break;case"intersession":"removeNotify"==o.subaction&&notificationDelete(o.id);break;case"traceinfo":"object"==typeof o.traceSources&&(null!=o.traceSources&&0<o.traceSources.length?(serverTraceSources=o.traceSources,QH("p41traceStatus",EscapeHtml(o.traceSources.join(", ")))):(serverTraceSources=[],QH("p41traceStatus","Ninguno")));break;case"serverstats":updateGeneralServerStats(o);break;case"serverwarnings":if(null!=o.warnings&&0<o.warnings.length){var F={1:"",2:"Faltan parámetros WebDAV.",3:'Opción de configuración desconocida "{0}".',4:"Desactivada la compresión WebSocket, esta característica no funciona en NodeJS v11.11 a v12.15 y v13.2",5:"No se puede cargar el certificado raíz TLS Intel AMT para el dominio por defecto.",6:"No se puede cargar el certificado raíz TLS Intel AMT para el dominio {0}.",7:"Los FQDN locales de CIRA no se usan cuando el servidor está en modo LAN-only o WAN-only.",8:"No puede haber más de 4 FQDN locales de CIRA. Valor ignorado.",9:"Se ha omitido la comprobación hash del agente, esto es inseguro.",10:"Falta la dirección de correo de Let's Encrypt.",11:"Nombres de host Let's Encrypt no válido.",12:"Nombres Let's Encrypt no válidos, no pueden contener un *.",13:"No se puede configurar el módulo Let's Encrypt.",14:"Nombres Let's Encrypt no válidos, no se puede resolver: {0}",15:"Dirección de correo Let's Encrypt no válida, no se puede resolver: {0}",16:"No se puede cargar la lista de direcciones IPv6 de proxy de confianza Cloudfare.",17:"El servidor SendGrid tiene un uso limitado en modo LAN.",18:"El servidor SMTP tiene un uso limitado en modo LAN.",19:"La puerta de enlace SMS tiene un uso limitado en modo LAN.",20:'"LoginCookieEncryptionKey" no válido en config.json.',21:"La ruta de la copia de seguridad no se puede configurar dentro de la carpeta meshcentral-data, la configuración de la copia de seguridad se ignora.",22:"No se pudo firmar el agente {0}: {1}",23:"No se puede cargar el archivo del icono del agente: {0}.",24:"No se puede cargar el archivo del Logo del agente: {0}.",25:"Esta versión de NodeJS no es compatible con OpenID.",26:"Esta versión de NodeJS no es compatible con Discord.js.",27:"Firebase now requires a service account JSON file, Firebase disabled."},e="";for(r in o.warnings)"string"==typeof(t=o.warnings[r])?e+="<div style=color:red;padding-bottom:6px><b>ADVERTENCIA: "+t+"</b></div>":(null==(i=F[t.id])?i=t.msg:null!=t.args&&(i=format(i,...t.args)),e+="<div style=color:red;padding-bottom:6px><b>ADVERTENCIA: "+i+"</b></div>");QH("serverWarnings",e),QV("serverWarningsDiv",!0)}break;case"servertimelinestats":setServerTimelineStats(o.events);break;case"authcookie":authCookie=o.cookie,authRelayCookie=o.rcookie;break;case"serverinfo":if((serverinfo=o.serverinfo).timeout&&(setInterval(checkIdleSessionTimeout,1e4),checkIdleSessionTimeout()),1==debugmode&&console.log("Server time: ",printDateTime(new Date(serverinfo.serverTime))),setupServiceWorker(),null!=serverinfo.certExpire&&0<=(c=Math.floor((serverinfo.certExpire-Date.now())/864e5))&&c<20&&(QH("serverCertWarnings","<div style=color:red;padding-bottom:6px><b>ADVERTENCIA: "+format("El certificado vence en {0} día (s)",c)+"</b></div>"),QV("serverWarningsDiv",!0),addNotification({text:format("El certificado vence en {0} día (s)",c)})),serverinfo.preConfiguredRemoteInput){e="";for(r in serverinfo.preConfiguredRemoteInput)e+='<div class="cmtext" onclick="cmdeskpreconfigtypeaction('+r+',event)">'+EscapeHtml(serverinfo.preConfiguredRemoteInput[r].name)+"</div>";""!=e&&(e+="<hr />"),QH("deskPreConfigShortcutContextMenu1",e)}if(serverinfo.preConfiguredScripts){var e="",t="";for(r in serverinfo.preConfiguredScripts){var n=serverinfo.preConfiguredScripts[r],i='<div class="cmtext" onclick="cmdeskpreconfigscriptaction('+r+',event)">'+EscapeHtml(serverinfo.preConfiguredScripts[r].name)+"</div>";3!=n.type&&(e+=i),3<=n.type&&(t+=i)}QH("deskPreConfigScriptContextMenu1",e),QH("deskPreConfigScriptContextMenu2",t)}break;case"userinfo":userinfo=o.userinfo,updateSiteAdmin(),updateSelf();break;case"users":for(var a in users={},o.users)users[o.users[a]._id]=o.users[a];null!=currentUser&&(currentUser=users[currentUser._id]),mainUpdate(16384),updateSelf();break;case"wssessioncount":wssessions=o.wssessions,mainUpdate(16384);break;case"meshes":for(var a in meshes={},o.meshes)meshes[o.meshes[a]._id]=o.meshes[a];null!=currentMesh&&(currentMesh=meshes[currentMesh._id]),mainUpdate(132);break;case"usergroups":var s=0;if(Array.isArray(o.ugroups))for(var r in usergroups={},o.ugroups)s++,usergroups[o.ugroups[r]._id]=o.ugroups[r];else for(var r in usergroups=o.ugroups,o.ugroups)s++,o.ugroups[r]._id=r;0==s&&(usergroups=null),mainUpdate(8192);break;case"files":filetree=setupBackPointers(o.filetree),updateFiles(),d3updatefiles();break;case"nodes":for(var a in nodes=[],o.nodes)for(var l in o.nodes[a])null==o.nodes[a][l]._id?console.log("Invalid node ("+l+"): "+JSON.stringify(o.nodes)):(null==o.nodes[a][l].name&&(o.nodes[a][l].name="???"),o.nodes[a][l].namel=o.nodes[a][l].name.toLowerCase(),o.nodes[a][l].rname?o.nodes[a][l].rnamel=o.nodes[a][l].rname.toLowerCase():o.nodes[a][l].rnamel=o.nodes[a][l].namel,o.nodes[a][l].meshnamel=meshes[a]?meshes[a].name.toLowerCase():"*",o.nodes[a][l].meshid=a,o.nodes[a][l].state=o.nodes[a][l].state||0,o.nodes[a][l].icon||(o.nodes[a][l].icon=1),o.nodes[a][l].ident=++nodeShortIdent,nodes.push(o.nodes[a][l]));for(var r in stars)null==getNodeFromId(r)&&delete stars[r];null!=currentNode&&0==IsNodeViewable(currentNode)&&(currentNode=null,go(1)),null!=currentNode&&(null!=(currentNode=getNodeFromId(currentNode._id))?gotoDevice(currentNode._id,xxcurrentView,!0):go(1)),devicePagingState=null==o.totalcount?null:{total:o.totalcount,skip:o.skip,limit:o.limit},updateDevicePageState(),mainUpdate(71);break;case"powertimeline":if(o.nodeid==powerTimelineReq){for(var r in powerTimelineNode=o.nodeid,powerTimeline=o.timeline,powerTimelineUpdate=Date.now()+3e5,powerTimeline)r%2==1&&(powerTimeline[r]=1e3*powerTimeline[r]);currentNode._id==o.nodeid&&mainUpdate(256)}break;case"deviceShares":o.nodeid==deviceSharesReq&&(deviceSharesNode=o.nodeid,deviceShares=o.deviceShares,null!=currentNode&&currentNode._id==o.nodeid)&&gotoDevice(currentNode._id,xxcurrentView,!0);break;case"deviceMeshShares":o.meshid==deviceSharesReq&&(deviceSharesNode=o.meshid,deviceShares=o.deviceShares,null!=currentMesh&&currentMesh._id==o.meshid)&&p20updateMesh();break;case"getsysinfo":o.nodeid==powerTimelineReq&&(!0===o.noinfo?updateDeviceDetails(getNodeFromId(o.nodeid)):updateDeviceDetails(getNodeFromId(o.nodeid),o.hardware));break;case"lastconnect":null!=(E=getNodeFromId(o.nodeid))&&(E.lastconnect=o.time,E.lastaddr=o.addr,currentNode._id==E._id)&&""==Q("MainComputerState").innerHTML&&null!=E.lastconnect&&QH("MainComputerState","<span>Visto por última vez:<br />"+printDateTime(new Date(E.lastconnect))+"</span>");break;case"lastconnects":var B=Object.keys(o.lastconnects);for(r in B){var O=B[r];null!=(E=getNodeFromId(O))&&(E.lastconnect=o.lastconnects[O])}mainUpdate(4);case"msg":if(null!=o.nodeid){var d=-1;if(null!=nodes)for(var r in nodes)if(nodes[r]._id==o.nodeid){d=r;break}if(-1!=d)if("cpuinfo"===o.type&&null!=currentNode&&currentNode._id==o.nodeid){var c=Date.now()/1e3,u=0,p=0;"number"==typeof o.cpu.total&&(u=o.cpu.total),"number"==typeof o.memory.percentConsumed&&(p=o.memory.percentConsumed),deviceDetailsStatsData.push([c,u,p]),deviceDetailsStatsDraw(o)}else if("console"===o.type)p15consoleReceive(nodes[d],o.value,o.source);else if("notify"===o.type){if(0==(8&(l=getstore("notifications",0)))&&null!=o.amtMessage)break;l={text:o.value,title:o.title,icon:o.icon,titleid:o.titleid,msgid:o.msgid,args:o.args};null!=o.id&&(l.id=o.id),null!=o.nodeid&&(l.nodeid=o.nodeid),null!=o.tag&&(l.tag=o.tag),null!=o.url&&(l.url=o.url),null!=o.username&&(l.username=o.username),"number"==typeof o.maxtime&&(l.maxtime=o.maxtime),addNotification(l)}else if("ps"===o.type)showDeskToolsProcesses(o);else if("services"===o.type)showDeskToolsServices(o);else if("service"===o.type)showServiceDetailsDialog(o);else if("getclip"===o.type&&null!=currentNode&&currentNode._id==o.nodeid)1==o.tag&&"clipboard"===xxdialogTag?Q("d2clipText").value=o.data:2===o.tag&&null!=navigator.clipboard&&navigator.clipboard.writeText(o.data).then(function(){}).catch(function(e){console.log(e)});else if("setclip"===o.type&&"clipboard"===xxdialogTag&&null!=currentNode&&currentNode._id==o.nodeid)QH("dlgClipStatus",o.success?"<span style=color:green>Exitoso</span>":"<span style=color:red>Falló</span>"),setTimeout(function(){try{QH("dlgClipStatus","")}catch(e){}},2e3);else if("userSessions"===o.type&&null!=currentNode&&currentNode._id===o.nodeid&&null==desktop){var m=[];if(null!=o.data)for(var r in o.data)"Active"!=o.data[r].State&&"Connected"!=o.data[r].State&&"Console"!=o.data[r].StationName&&3!=debugmode||m.push(o.data[r]);if(0===m.length)connectDesktop(null,1,null,o.tag);else if(1===m.length)connectDesktop(null,1,m[0].SessionId,o.tag);else{var e="",g="{{{userSessionsSort}}}";for(r in m.sort(function(e,t){return e[g]?t[g]?e[g]<t[g]?-1:t[g]<e[g]?1:0:1:-1}),m)e+='<div style="text-align:left;cursor:pointer;background-color:gray;margin:5px;padding:5px;border-radius:5px" onclick=connectDesktop(event,1,'+m[r].SessionId+","+o.tag+")>"+m[r].State+(m[r].StationName?", "+m[r].StationName:""),m[r].Username&&(m[r].Domain?e+=" - "+m[r].Domain+"/"+m[r].Username:e+=" - "+m[r].Username),e+="</div>";QH("p11DeskSessionSelector",e),QV("p11DeskSessionSelector",!0)}}else"psinfo"===o.type?xxdialogTag==="ps|"+o.nodeid+"|"+o.pid&&(e="<div style=max-height:200px;overflow-y:auto>","object"==typeof o.value&&0<Object.keys(o.value).length?(o.value=jsonToCamel(o.value),!o.value.cmd&&o.value.path&&(o.value.cmd=o.value.path),!o.value.processUser&&o.value.userName&&(o.value.processUser=o.value.userName.split("\\")[1]),!o.value.processDomain&&o.value.userName&&(o.value.processDomain=o.value.userName.split("\\")[0]),o.value.processName&&(e+="<div style=padding:4px><div style=padding-bottom:4px>Nombre del Proceso</div><div style=word-wrap:break-word;padding-left:6px><b>"+o.value.processName+"</b></div></div>"),o.value.machineName&&(e+=addHtmlValue5("Nombre de la Máquina",o.value.machineName)),o.value.cmd&&(e+="<div style=padding:4px><div style=padding-bottom:4px>Línea de Comandos</div><div style=word-wrap:break-word;padding-left:6px><b>"+o.value.cmd+"</b></div></div>"),o.value.mainWindowTitle&&(e+="<div style=padding:4px><div style=padding-bottom:4px>Título de Windows</div><div style=word-wrap:break-word;padding-left:6px><b>"+o.value.mainWindowTitle+"</b></div></div>"),o.value.processUser&&(e+=addHtmlValue5("Usuario",o.value.processUser)),o.value.processDomain&&(e+=addHtmlValue5("Dominio",o.value.processDomain)),o.value.startTime&&(e+=addHtmlValue5("Tiempo de Inicio",o.value.startTime)),e+="<hr />",o.value.PriorityBoostEnabled&&(e+=addHtmlValue5("Aumento de Prioridad",o.value.PriorityBoostEnabled?"Habilitado":"Deshabilitado")),o.value.sessionId&&(e+=addHtmlValue5("ID de la Sesión",o.value.sessionId)),o.value.handleCount&&(e+=addHtmlValue5("Número de Manejadores",o.value.handleCount)),o.value.privilegedProcessorTime&&(e+=addHtmlValue5("Tiempo de Procesador Privilegiado",format("{0} segundos",o.value.privilegedProcessorTime))),o.value.totalProcessorTime&&(e+=addHtmlValue5("Tiempo Total del Procesador",format("{0} segundos",o.value.totalProcessorTime))),o.value.userProcessorTime&&(e+=addHtmlValue5("Tiempo de Procesador de Usuario",format("{0} segundos",o.value.userProcessorTime))),o.value.nonpagedSystemMemorySize&&(e+=addHtmlValue5("Memoria No Paginada",getNiceSize2(o.value.nonpagedSystemMemorySize))),o.value.pagedMemorySize&&(e+=addHtmlValue5("Memoria Paginada",getNiceSize2(o.value.pagedMemorySize))),o.value.privateMemorySize&&(e+=addHtmlValue5("Memoria Privada",getNiceSize2(o.value.privateMemorySize))),o.value.virtualMemorySize&&(e+=addHtmlValue5("Memoria Virtual",getNiceSize2(o.value.virtualMemorySize))),o.value.workingSet&&(e+=addHtmlValue5("Conjunto de Trabajo",getNiceSize2(o.value.workingSet))),o.value.peakWorkingSet&&(e+=addHtmlValue5("Conjunto de Trabajo Máximo",getNiceSize2(o.value.peakWorkingSet))),o.value.peakPagedMemorySize&&(e+=addHtmlValue5("Memoria Paginada Máxima",getNiceSize2(o.value.peakPagedMemorySize))),o.value.peakVirtualMemorySize&&(e+=addHtmlValue5("Memoria Virtual Máxima",getNiceSize2(o.value.peakVirtualMemorySize)))):e+="No se proporcionó información",e+="</div>",QH("id_dialogOptions",e)):"deskBackground"===o.type&&(""!=o.data?Q("DeskBackgroundButtonImage").style.color="":Q("DeskBackgroundButtonImage").style.color="red")}else"notify"===o.type&&(l={text:o.value,title:o.title,icon:o.icon,titleid:o.titleid,msgid:o.msgid,args:o.args},null!=o.id&&(l.id=o.id),null!=o.tag&&(l.tag=o.tag),null!=o.url&&(l.url=o.url),null!=o.username&&(l.username=o.username),"number"==typeof o.maxtime&&(l.maxtime=o.maxtime),addNotification(l));break;case"getnetworkinfo":if(currentNode._id!=o.nodeid)return;if(updateDeviceDetails(getNodeFromId(o.nodeid),null,o),2==xxdialogMode&&xxdialogTag=="if"+o.nodeid){var e="<div class=dialogText>";if(currentNode.lastconnect&&(e+=addHtmlValue2("Última conexión del agente",printDateTime(new Date(currentNode.lastconnect)))),currentNode.lastaddr&&(2<(c=currentNode.lastaddr.split(":")).length?e+=addHtmlValue2("Última dirección IP del agente",currentNode.lastaddr+' <i class="fa-fw fa-regular fa-clipboard fa-sm" role=button title="Copiar dirección al portapapeles" onclick=copyTextToClip2("'+encodeURIComponentEx(currentNode.lastaddr)+'")></i>'):isPrivateIP(currentNode.lastaddr)?e+=addHtmlValue2("Última dirección IP del agente",c[0]+' <i class="fa-fw fa-regular fa-clipboard fa-sm" role=button title="Copiar dirección al portapapeles" onclick=copyTextToClip2("'+encodeURIComponentEx(c[0])+'")></i>'):e+=addHtmlValue2("Última dirección IP del agente",'<a href="https://iplocation.com/?ip='+c[0]+'" rel="noreferrer noopener" target="MeshIPLoopup">'+c[0]+'</a> <i class="fa-fw fa-regular fa-clipboard fa-sm" role=button title="Copiar dirección al portapapeles" onclick=copyTextToClip2("'+encodeURIComponentEx(c[0])+'")></i>')),null!=o.updateTime&&(e+=addHtmlValue2("Última actualización de interfaces",printDateTime(new Date(o.updateTime)))),null!=o.netif)for(var r in o.netif)e+="<hr />",(v=o.netif[r]).name&&(e+=addHtmlValue2("Nombre","<b>"+EscapeHtml(v.name)+"</b>")),v.desc&&(e+=addHtmlValue2("Descripción",EscapeHtml(v.desc).replace("(R)","&reg;").replace("(r)","&reg;"))),v.dnssuffix&&(e+=addHtmlValue2("Sufijo DNS",EscapeHtml(v.dnssuffix)+' <i class="fa-fw fa-regular fa-clipboard fa-sm" role=button title="Copiar nombre al portapapeles" onclick=copyTextToClip2("'+encodeURIComponentEx(v.dnssuffix)+'")></i>')),v.mac&&(e+=addHtmlValue2("Dirección MAC",'<a href="https://maclookup.app/search/result?mac='+v.mac.substring(0,6)+'" rel="noreferrer noopener" target="MeshMACLoopup">'+EscapeHtml(v.mac.toLowerCase())+'</a> <i class="fa-fw fa-regular fa-clipboard fa-sm" role=button title="Copiar Direccion MAC al portapapeles" onclick=copyTextToClip2("'+encodeURIComponentEx(v.mac.toLowerCase())+'")></i>')),v.v4addr&&(e+=addHtmlValue2("Dirección IPv4",EscapeHtml(v.v4addr)+' <i class="fa-fw fa-regular fa-clipboard fa-sm" role=button title="Copiar dirección al portapapeles" onclick=copyTextToClip2("'+encodeURIComponentEx(v.v4addr)+'")></i>')),v.v4mask&&(e+=addHtmlValue2("Máscara IPv4",EscapeHtml(v.v4mask)+' <i class="fa-fw fa-regular fa-clipboard fa-sm" role=button title="Copiar dirección al portapapeles" onclick=copyTextToClip2("'+encodeURIComponentEx(v.v4mask)+'")></i>')),v.v4gateway&&(e+=addHtmlValue2("Puerta de Enlace IPv4",EscapeHtml(v.v4gateway)+' <i class="fa-fw fa-regular fa-clipboard fa-sm" role=button title="Copiar dirección al portapapeles" onclick=copyTextToClip2("'+encodeURIComponentEx(v.v4gateway)+'")></i>')),v.gatewaymac&&(e+=addHtmlValue2("MAC de la Puerta de Enlace",'<a href="https://maclookup.app/search/result?mac='+v.gatewaymac.substring(0,6)+'" rel="noreferrer noopener" target="MeshMACLoopup">'+EscapeHtml(v.gatewaymac.toLowerCase())+'</a> <i class="fa-fw fa-regular fa-clipboard fa-sm" role=button title="Copiar Direccion MAC al portapapeles" onclick=copyTextToClip2("'+encodeURIComponentEx(v.gatewaymac.toLowerCase())+'")></i>'));else if(null!=o.netif2)for(var r in o.netif2){var v=o.netif2[r];if(!(0==Array.isArray(v)||v.length<1||null==v[0]||"string"==typeof v[0].mac&&v[0].mac.startsWith("00:00:00:00"))){e=(e+="<hr />")+addHtmlValue2("Nombre","<b>"+EscapeHtml(r)+"</b>"),"string"==typeof v[0].mac&&(e+=addHtmlValue2("Dirección MAC",'<a href="https://maclookup.app/search/result?mac='+v[0].mac.split(":").join("").substring(0,6)+'" rel="noreferrer noopener" target="MeshMACLoopup">'+EscapeHtml(v[0].mac.toLowerCase())+'</a> <i class="fa-fw fa-regular fa-clipboard fa-sm" role=button title="Copiar Direccion MAC al portapapeles" onclick=copyTextToClip2("'+encodeURIComponentEx(v[0].mac.toLowerCase())+'")></i>')),v[0].fqdn&&(e+=addHtmlValue2("FQDN",v[0].fqdn));for(var h=0;h<v.length;h++){var f=v[h];"IPv6"==f.family?(f.address&&(e+=addHtmlValue2("Dirección IPv6",EscapeHtml(f.address)+' <i class="fa-fw fa-regular fa-clipboard fa-sm" role=button title="Copiar dirección al portapapeles" onclick=copyTextToClip2("'+encodeURIComponentEx(f.address)+'")></i>')),f.netmask&&(e+=addHtmlValue2("Máscara IPv6",EscapeHtml(f.netmask)+' <i class="fa-fw fa-regular fa-clipboard fa-sm" role=button title="Copiar dirección al portapapeles" onclick=copyTextToClip2("'+encodeURIComponentEx(f.netmask)+'")></i>')),f.gateway&&(e+=addHtmlValue2("Puerta de Enlace IPv6",EscapeHtml(f.gateway)+' <i class="fa-fw fa-regular fa-clipboard fa-sm" role=button title="Copiar dirección al portapapeles" onclick=copyTextToClip2("'+encodeURIComponentEx(f.gateway)+'")></i>'))):"IPv4"==f.family&&(f.address&&(e+=addHtmlValue2("Dirección IPv4",EscapeHtml(f.address)+' <i class="fa-fw fa-regular fa-clipboard fa-sm" role=button title="Copiar dirección al portapapeles" onclick=copyTextToClip2("'+encodeURIComponentEx(f.address)+'")></i>')),f.netmask&&(e+=addHtmlValue2("Máscara IPv4",EscapeHtml(f.netmask)+' <i class="fa-fw fa-regular fa-clipboard fa-sm" role=button title="Copiar dirección al portapapeles" onclick=copyTextToClip2("'+encodeURIComponentEx(f.netmask)+'")></i>')),f.gateway)&&(e+=addHtmlValue2("Puerta de Enlace IPv4",EscapeHtml(f.gateway)+' <i class="fa-fw fa-regular fa-clipboard fa-sm" role=button title="Copiar dirección al portapapeles" onclick=copyTextToClip2("'+encodeURIComponentEx(f.gateway)+'")></i>'))}}}else e+="<hr />No hay información de interfaz de red disponible para este dispositivo.";e+="</div>",QH("d2netinfo",e)}break;case"serverversion":2==xxdialogMode&&"MeshCentralServerUpdate"==xxdialogTag&&(e="<div class=dialogText>",o.tags.current||(o.tags.current="Desconocido"),o.tags.stable||(o.tags.stable="Desconocido"),o.tags.latest||(o.tags.latest="Desconocido"),e=(e=(e=e+addHtmlValue2("Versión Actual","<b>"+EscapeHtml(o.tags.current)+"</b>")+"<hr />")+addHtmlValue2('<label><input id=d2updateCheck1 type=checkbox class="form-check-input me-2" onclick=server_showVersionDlgUpdate()'+("Desconocido"==o.tags.stable||o.tags.current==o.tags.stable||0==(2048&features)?" disabled":"")+" /> Versión Estable</label>","<b>"+EscapeHtml(o.tags.stable)+"</b>"))+addHtmlValue2('<label><input id=d2updateCheck2 type=checkbox class="form-check-input me-2" onclick=server_showVersionDlgUpdate()'+("Desconocido"==o.tags.latest||o.tags.current==o.tags.latest||0==(2048&features)?" disabled":"")+" /> Última Versión</label>","<b>"+EscapeHtml(o.tags.latest)+"</b>")+"</div>",o.tags.current==o.tags.latest&&o.tags.current==o.tags.stable||0==(2048&features)?(setModalContent("xxAddAgent","Versión de MeshCentral",e),showModal("xxAddAgentModal","idx_dlgOkButton")):(xxdialogTag=o.tags,setModalContent("xxAddAgent","Versión de MeshCentral",e+="<hr />Marca y haz clíc en Aceptar para iniciar la actualización automática del servidor."),showModal("xxAddAgentModal","idx_dlgOkButton",function(){server_showVersionDlgEx(2,o.tags)}),server_showVersionDlgUpdate()));break;case"servererrors":2==xxdialogMode&&"MeshCentralServerErrors"==xxdialogTag&&(null==o.data?(setModalContent("xxAddAgent","Server Errors","El servidor no tiene registro de errores."),showModal("xxAddAgentModal","idx_dlgOkButton")):(setModalContent("xxAddAgent","Errores del Servidor MeshCentral",e=(e='<div class="dialogText dialogTextLog"><pre id=d2ServerErrorsLogPre>'+EscapeHtml(o.data)+"</pre></div>")+'<br /><div style=float:right><i role=button class="fa-fw fa-solid fa-download fa-sm" title="Descargar registro de errores" onclick=d2CopyServerErrorsToClip()></i></div>'+'<div><label><input id=d2clearErrorsCheck type=checkbox class="form-check-input me-2" onclick=server_showErrorsDlgUpdate() /> Marca y haz clic en Aceptar para borrar el registro de errores.</label></div>'),showModal("xxAddAgentModal","idx_dlgOkButton",server_showErrorsDlgEx),server_showErrorsDlgUpdate()));break;case"serverconfig":2==xxdialogMode&&"MeshCentralServerConfig"==xxdialogTag&&(null==o.data?setModalContent("xxAddAgent","Server Configuration","Server has no config file.","extra-large"):(setModalContent("xxAddAgent","Server Configuration",4,"extra-large"),QV("d4EncodingButton",!1),QV("d4LineBreakButton",!1),Q("d4editorarea").value=o.data,Q("d4editorarea").setAttribute("readonly","readonly")),showModal("xxAddAgentModal","idx_dlgOkButton"));break;case"serverconsole":p15consoleReceive("serverconsole",o.value);break;case"events":null!=o.nodeid&&null!=currentNode&&o.nodeid==currentNode._id?(currentDeviceEvents=o.events,mainUpdate(1024)):null!=o.userid&&null!=currentUser&&o.userid==currentUser._id?(currentUserEvents=o.events,mainUpdate(2048)):(events=o.events,mainUpdate(32));break;case"recordings":p52recordings=o.events,null!=o.error&&(p52recordings=o.error),updateRecordings();break;case"getcookie":"MCRouter"==o.tag?(-1!=(_=serverinfo.name).indexOf(".")&&0==(2&features)||(_=window.location.hostname),domainUrl.substring(0,domainUrl.length-1),U="mcrouter://"+_+(443==serverinfo.port?"":":"+serverinfo.port)+domainUrl+"control.ashx?c="+authCookie+"&t="+serverinfo.tlshash+"&l={{{lang}}}"+(urlargs.key?"&key="+urlargs.key:""),null!=o.nodeid&&(U+="&nodeid="+o.nodeid),null!=o.tcpport&&(U+="&protocol=1&remoteport="+o.tcpport),o.localRelay&&(U+="&local=1"),o.localport&&(U+="&localport="+o.localport),null!=o.name&&(U+="&name="+encodeURIComponentEx(o.name)),null!=o.ip&&(U+="&remoteip="+o.ip),downloadFile(U+="&appid="+o.protocol+"&autoexit=1","")):"novnc"==o.tag?(u=window.location.origin+domainUrl+"novnc/vnc.html?ws=wss%3A%2F%2F"+window.location.host+encodeURIComponentEx(domainUrl)+(o.localRelay?"local":"mesh")+"relay.ashx%3Fauth%3D"+o.cookie+"&show_dot=1"+(urlargs.key?"&key="+urlargs.key:"")+"&l={{{lang}}}",null!=(E=getNodeFromId(o.nodeid))&&(u+="&name="+encodeURIComponentEx(E.name)),safeNewWindow(u,"mcnovnc/"+o.nodeid)):"mstsc"==o.tag?(p=window.location.origin+domainUrl+"mstsc.html?ws="+o.cookie+(urlargs.key?"&key="+urlargs.key:""),null!=(E=getNodeFromId(o.nodeid))&&(p+="&name="+encodeURIComponentEx(E.name)),o.localRelay&&(p+="&local=1"),safeNewWindow(p,"mcmstsc/"+o.nodeid)):"ssh"==o.tag&&(c=window.location.origin+domainUrl+"ssh.html?ws="+o.cookie+(urlargs.key?"&key="+urlargs.key:""),null!=(E=getNodeFromId(o.nodeid))&&(c+="&name="+encodeURIComponentEx(E.name)),o.localRelay&&(c+="&local=1"),safeNewWindow(c,"mcssh/"+o.nodeid));break;case"getNotes":(l=Q("d2devNotes"))&&o.id==decodeURIComponent(l.attributes.noteid.value)?(o.notes?QH("d2devNotes",decodeURIComponent(o.notes)):QH("d2devNotes",""),0==("true"==l.attributes.ro.value)&&(l.removeAttribute("readonly"),QE("idx_dlgOkButton",!0),QV("idx_dlgOkButton",!0),focusTextBox("d2devNotes"))):(Q("notesPanelArea").innerHTML=o.notes&&marked&&DOMPurify?DOMPurify.sanitize(marked.parse(decodeURIComponent(o.notes),{breaks:!0}),{USE_PROFILES:{html:!0}}):"","true"===showNotesPanel&&o.notes?QV("notesPanel",!0):QV("notesPanel",!1));break;case"otpauth-request":2==xxdialogMode&&"otpauth-request"==xxdialogTag&&(null!=o.err?(u=["","2FA está bloqueado","Los códigos de respaldo están bloqueados","Token de inicio de sesión en uso","OTP 2FA no permitido","La cuenta esta bloqueada","No se puede cargar OTPLIB"],0<o.err&&o.err<u.length?QH("d2optinfo",u[o.err]):QH("d2optinfo",format("Error n.º {0}",o.err))):(52==(p=o.secret).length?p=p.split(/(.............)/).filter(Boolean).join(" "):32==p.length&&(p=(p=p.split(/(....)/).filter(Boolean).join(" ")).substring(0,20)+"<br/>"+p.substring(20)),QH("d2optinfo","<table style=width:380px><tr><td style=vertical-align:top>"+format('Instalar <a href="https://play.google.com/store/apps/details?id=com.google.android.apps.authenticator2" rel="noreferrer noopener" target=_blank>Google Authenticator</a> o una aplicación compatible y escanea el código de barras, usa <a href="{0}" rel="noreferrer noopener" target=_blank> este enlace </a> o ingresa el secreto. Luego, ingresa el token actual de 6 dígitos a continuación para activar el inicio de sesión en 2 pasos.',o.url)+'<br /><br />Secret <img src=images/link4.png height=10 width=10 title="Copy Secret to clipboard" style=cursor:pointer onclick=d2CopySecretToClip()><br /><tt id=d2optsecret secret="'+o.secret+'" style=font-size:12px>'+p+'</tt><br /><br /></td><td style=width:1px;vertical-align:top><a href="'+o.url+'" rel="noreferrer noopener" target=_blank><div id="qrcode"></div></a></td><tr><td colspan=2 style="text-align:center;border-top:1px solid black"><br />Ingresa el token aquí para iniciar sesión en 2 pasos: <input type=text autocomplete="one-time-code" inputmode="numeric" pattern="[0-9]*" onkeypress="return (event.keyCode == 8) || (event.charCode >= 48 && event.charCode <= 57)" onkeyup=account_addOtpCheck(event) onkeydown=account_addOtpCheck() maxlength=6 id=d2otpauthinput type=text></td></table>'),new QRCode(Q("qrcode"),{text:o.url,width:128,height:128,colorDark:"#000000",colorLight:"#EEE",correctLevel:QRCode.CorrectLevel.H}),QV("idx_dlgOkButton",!0),QE("idx_dlgOkButton",!1),Q("d2otpauthinput").focus()));break;case"otpauth-setup":if(xxdialogMode)return;setModalContent("xxAddAgent","Aplicación de Autenticación",o.success?"<b style=color:green>Activación de la Aplicación de Autenticación exitosa.</b> Ahora necesitarás un token válido para iniciar sesión nuevamente.":"<b style=color:red>La activación de inicio de sesión en 2 pasos falló.</b> Borra el secreto de la aplicación e intenta nuevamente. Sólo tienes unos minutos para ingresar el código adecuado."),showModal("xxAddAgentModal","idx_dlgOkButton");break;case"otpauth-clear":if(xxdialogMode)return;setModalContent("xxAddAgent","Aplicación de Autenticación",o.success?"<b>Aplicación de Autenticación eliminada.</b> Puedes reactivar esta función en cualquier momento.":"<b style=color:red>La eliminación de activación de inicio de sesión en 2 pasos falló.</b> Intentar nuevamente."),showModal("xxAddAgentModal","idx_dlgOkButton");break;case"otpauth-getpasswords":if(xxdialogMode)return;e="Los tokens únicos se pueden usar como autenticación secundaria. Genera un conjunto, imprímelos y guárdalos en un lugar seguro.";if(e+='<div style="border-radius:6px;border: 2px dashed #888;width:100%;margin-top:8px"><div style="padding:8px;font-family:Arial, Helvetica, sans-serif;font-size:20px;font-weight:bold"><table class=selecttext style=width:100%;text-align:center>',o.passwords){var h=0,x="";for(r in o.passwords){++h%2&&(e+="<tr>");for(var k=""+o.passwords[r].p;k.length<8;)k="0"+k;!0===o.passwords[r].u?(e+="<td>"+k.substring(0,4)+"&nbsp;"+k.substring(4),""!=x&&(x+=" "),x+=k):e+="<td><strike style=color:#BBB>"+k.substring(0,4)+"&nbsp;"+k.substring(4)}}else e+="<tr><td>No hay Tokens Activos";e=(e+="</table></div></div><br />")+"<div>"+'<input type=button value="Generar Nuevos Tokens" onclick="account_manageOtp(1);"></input>',null!=o.passwords&&(e=(e+='<input type=button value="Borrar Tokens" onclick="account_manageOtp(2);"></input>')+'&nbsp;<img src=images/link4.png height=10 width=10 title="Copiar códigos válidos al portapapeles" style=cursor:pointer onclick=copyTextToClip2("'+encodeURIComponentEx(x)+'")>'),setModalContent("xxAddAgent","Administrar Códigos de Respaldo",e+="</div><br />"),showModal("xxAddAgentModal","idx_dlgOkButton");break;case"otp-hkey-get":if(xxdialogMode&&"otpauth-hardware-manage"!=xxdialogTag)return;var P='<div style="border-radius:6px;border:2px solid #CCC;background-color:#BBB;width:100%;box-sizing:border-box;margin-bottom:6px"><div style="margin:3px;font-family:Arial, Helvetica, sans-serif;font-size:16px;font-weight:bold"><table style=width:100%;text-align:left>',L="</table></div></div>",e='<a href="https://www.yubico.com/" rel="noreferrer noopener" target="_blank">Las claves de Hardware</a> son usadas como segundo factor de autenticación.';if(e+='<div style="max-height:150px;overflow-y:auto;overflow-x:hidden;margin-top:6px;margin-bottom:6px">',o.keys&&0<o.keys.length)for(var r in o.keys){var z=o.keys[r];e+=P+'<tr style=margin:5px><td style=width:30px><img width=24 height=18 src="images/hardware-key-'+(V=2==z.type?"OTP":"WebAuthn")+'-24.png" style=margin-top:4px><td style=width:250px>'+z.name+'<td><input type=button value="Remover" onclick=account_removehkey('+z.i+")></input>"+L}else e+=P+"<tr style=text-align:center><td>No hay Claves Configuradas"+L;e=e+"</div>"+"<div>";c="number"==typeof userinfo.otphkeys?userinfo.otphkeys:0;"number"!=typeof serverinfo.maxfidokeys||serverinfo.maxfidokeys>c?(0!=(131072&features)&&(e+='<input id=d2addkey3 type=button value="Agregar llave" onclick="account_addhkey(3);"></input>'),0!=(16384&features)&&(e+='<input id=d2addkey2 type=button value="Agregar YubiKey&reg; OTP" onclick="account_addhkey(2);"></input>')):e+="Número máximo de claves alcanzado.",setModalContent("xxAddAgent","Administrar Claves de Seguridad",e+="</div><br />"),showModal("xxAddAgentModal","idx_dlgOkButton"),0==u2fSupported()&&QE("d2addkey1",!1);break;case"otp-hkey-yubikey-add":o.result?meshserver.send({action:"otp-hkey-get"}):(setModalContent("xxAddAgent","Agregar Llave de Seguridad","<br />Error, no se puede agregar la llave.<br /><br />"),showModal("xxAddAgentModal","idx_dlgOkButton"));break;case"otp-hkey-setup-response":if(xxdialogMode&&"otpauth-hardware-manage"!=xxdialogTag)return;1==o.result?meshserver.send({action:"otp-hkey-get"}):(setModalContent("xxAddAgent","Agregar Llave de Seguridad","<br />Error, no se puede agregar la llave.<br /><br />"),showModal("xxAddAgentModal","idx_dlgOkButton"));break;case"webauthn-startregister":if(xxdialogMode&&"otpauth-hardware-manage"!=xxdialogTag)return;setModalContent("xxAddAgent","Agregar Llave de Seguridad",e='Presione la tecla ahora.<br /><br /><div style=width:100%;text-align:center><img width=120 height=117 src="images/hardware-keypress-120.png" /></div><input id=dp1keyname style=display:none value='+o.name+" />");u=o.request;o.request.challenge=Uint8Array.from(atob(o.request.challenge),function(e){return e.charCodeAt(0)}),o.request.user.id=Uint8Array.from(atob(o.request.user.id),function(e){return e.charCodeAt(0)}),navigator.credentials.create({publicKey:u}).then(function(e){meshserver.send({action:"webauthn-endregister",response:{rawId:btoa(String.fromCharCode.apply(null,new Uint8Array(e.rawId))),response:{attestationObject:btoa(String.fromCharCode.apply(null,new Uint8Array(e.response.attestationObject))),clientDataJSON:btoa(String.fromCharCode.apply(null,new Uint8Array(e.response.clientDataJSON)))},type:e.type}}),setDialogMode(0)},function(e){console.log("ERROR: "+e),setModalContent("xxAddAgent","Agregar Llave de Seguridad","ERROR: "+e)}),showModal("xxAddAgentModal","idx_dlgOkButton");break;case"verifyPhone":if(xxdialogMode&&"verifyPhone"!=xxdialogTag)return;setModalContent("xxAddAgent","Notificaciones Telefónicas",e=(e='<table><tr><td><img src="images/phone80.png" style=padding:8px>')+"<td>Revisa tu teléfono e ingresa el código de verificación."+'<br /><br /><div style=width:100%;text-align:center>Código de verificación: <input type=tel pattern="[0-9]" inputmode="number" maxlength=6 id=d2phoneCodeInput onKeyUp=account_managePhoneCodeValidate() onkeypress="if (event.key==\'Enter\') account_managePhoneCodeValidate(1)"></div></table>'),showModal("xxAddAgentModal","idx_dlgOkButton",()=>account_managePhoneConfirm(3,o.cookie)),Q("d2phoneCodeInput").focus(),account_managePhoneCodeValidate();break;case"verifyMessaging":if(xxdialogMode&&"verifyMessaging"!=xxdialogTag)return;setModalContent("xxAddAgent","Notificaciones de Mensajería",e=(e='<table><tr><td><img src="images/messaging40.png" style=padding:8px>')+"<td>Revisa tu aplicacion de mensajes e introduce el codigo de verificacion."+'<br /><br /><div style=width:100%;text-align:center>Código de verificación: <input type=tel pattern="[0-9]" inputmode="number" maxlength=6 id=d2phoneCodeInput onKeyUp=account_managePhoneCodeValidate() onkeypress="if (event.key==\'Enter\') account_managePhoneCodeValidate(1)"></div></table>'),showModal("xxAddAgentModal","idx_dlgOkButton",()=>account_manageMessagingConfirm(3,o.cookie)),Q("d2phoneCodeInput").focus(),account_managePhoneCodeValidate();break;case"fileoperation":setModalContent("xxAddAgent",EscapeHtml(o.file),4,"extra-large"),showModal("xxAddAgentModal","idx_dlgOkButton",()=>{var e,t;e=o,t=Q("d4editorarea").value,t=0===d4EditLineBreakVal?t.replace(/\r?\n|\r/g,"\r\n"):2===d4EditLineBreakVal?t.replace(/\r\n|\n/g,"\r"):t.replace(/\r\n|\r/g,"\n"),t=1==d4EditEncodingVal?encode_utf8(t):t,meshserver.send({action:"fileoperation",fileop:"set",path:e.path,file:e.file,data:btoa(t)})}),QV("d4EncodingButton",!0),QV("d4LineBreakButton",!0),Q("d4editorarea").value=1==d4EditEncodingVal?decode_utf8(atob(o.data)):atob(o.data);break;case"event":if(!o.event.nolog){if(currentNode&&o.event.nodeid==currentNode._id&&null!=currentDeviceEvents&&(o.event.action==p16filterevents.value||""==p16filterevents.value)){if(null!=currentDeviceEvents){currentDeviceEvents.unshift(o.event);for(var b=parseInt(p16limitdropdown.value);currentDeviceEvents.length>b;)currentDeviceEvents.pop()}mainUpdate(1024)}if(currentUser&&o.event.userid==currentUser._id&&(o.event.action==p31filterevents.value||""==p31filterevents.value)){if(null!=currentUserEvents){currentUserEvents.unshift(o.event);for(b=parseInt(p31limitdropdown.value);currentUserEvents.length>b;)currentUserEvents.pop()}mainUpdate(2048)}if(o.event.action==p3filterevents.value||""==p3filterevents.value){if(null!=events){events.unshift(o.event);for(b=parseInt(p3limitdropdown.value);events.length>b;)events.pop()}mainUpdate(32)}}if(!o.event.noact)switch(o.event.action){case"serverinfochange":null!=o.event.lock2factor&&(serverinfo.lock2factor=o.event.lock2factor,updateSelf(),updateSiteAdmin());break;case"deviceShareUpdate":o.event.nodeid==deviceSharesReq&&(deviceSharesNode=o.event.nodeid,deviceShares=o.event.deviceShares,currentNode._id==deviceSharesNode)&&gotoDevice(currentNode._id,xxcurrentView,!0);break;case"agentlog":98==o.event.msgid&&0<GetNodeRights(o.event.nodeid)&&(l=getNodeFromId(o.event.nodeid),addNotification({text:format("Ayuda solicitada a {0}: {1}",o.event.msgArgs[0],o.event.msgArgs[1]),title:l.name,icon:l.icon,nodeid:o.event.nodeid}));break;case"recording":null!=p52recordings&&"object"==typeof p52recordings&&(p52recordings.unshift(o.event),o.event.present=1,updateRecordings());break;case"userWebState":try{if(null!=localStorage){var y=localStorage.getItem("showRealNames"),w=localStorage.getItem("uiMode"),G=localStorage.getItem("sort"),C=localStorage.getItem("loctag"),j=localStorage.getItem("nightMode"),W=localStorage.getItem("footerBar"),M=JSON.parse(o.event.state);for(r in M)localStorage.setItem(r,M[r]);if(null!=M.showRealNames&&M.showRealNames!=y&&(showRealNames=Q("RealNameCheckBox").checked="1"==M.showRealNames,mainUpdate(6)),null!=M.uiMode&&M.uiMode!=w&&userInterfaceSelectMenu(parseInt(M.uiMode)),null!=M.sort&&M.sort!=G&&(document.getElementById("sortselect").selectedIndex=sort=parseInt(M.sort),mainUpdate(6)),null!=M.loctag&&M.loctag!=C&&(null!=M.loctag?args.locale=M.loctag:delete args.locale,mainUpdate(4294967295)),null!=M.nightMode&&M.nightMode!=j&&(putstore("nightMode",M.nightMode),setNightMode()),null!=M.footerBar&&M.footerBar!=W&&(footerBar="1"==M.footerBar,QS("container")["grid-template-rows"]=null,QS("container")["-ms-grid-rows"]=null,adjustPanels()),null!=M.stars&&M.stars!=JSON.stringify(stars)&&(stars=JSON.parse(M.stars),3==Q("DevFilterSelect").value?mainUpdate(5):mainUpdate(4),currentNode)&&refreshDevice(currentNode._id),null!=M.deskKeyShortcuts){deskKeyboardShortcuts=[];var q=M.deskKeyShortcuts.split(",");for(r in q)""!=q[r]&&deskKeyboardShortcuts.push(parseInt(q[r]));updateDeskShortcutKeys()}if(null!=M.deskStrings){n=null;try{n=JSON.parse(M.deskStrings)}catch(e){}Array.isArray(n)&&(deskKeyboardStrings=n,updateDesktopStrings())}}}catch(e){}break;case"servertimelinestats":addServerTimelineStats(o.event.data);break;case"accountcreate":case"accountchange":if("object"!=typeof o.event.account||null==o.event.account)return void console.log(o.event);userinfo._id==o.event.account._id&&(y=o.event.account.siteadmin||0,w=userinfo.siteadmin||0,G=o.event.account.removeRights||0,C=userinfo.removeRights||0,(o.event.account.quota!=userinfo.quota||0==(8&userinfo.siteadmin)&&0!=(8&o.event.account.siteadmin))&&meshserver.send({action:"files"}),j=userinfo.groups,userinfo=o.event.account,w==y&&C==G&&1!=o.event.accountImageChange||(1==o.event.accountImageChange&&(userinfo.accountImageRnd=Math.floor(9999999999*Math.random())),updateSiteAdmin()),updateSelf(),0!=(2&userinfo.siteadmin)&&(W=userinfo.groups||[],(j||[]).join(",")!=W.join(","))&&(users=wssessions=null,meshserver.send({action:"users"}),meshserver.send({action:"wssessioncount"})),o.event.nodeListChange==userinfo._id)&&meshserver.send({action:"nodes",skip:null==devicePagingState?0:devicePagingState.skip}),currentNode&&refreshDevice(currentNode._id),null!=users&&(null==userinfo.groups||0==userinfo.groups.length||1==findOne(o.event.account.groups,userinfo.groups)?users[o.event.account._id]=o.event.account:delete users[o.event.account._id],mainUpdate(16388));break;case"accountremove":null!=users&&(delete users[o.event.userid],mainUpdate(16384));break;case"createusergroup":case"usergroupchange":w=(usergroups=null==usergroups?{}:usergroups)[o.event.ugrpid];null==w?usergroups[o.event.ugrpid]={_id:o.event.ugrpid,name:o.event.name,desc:o.event.desc,domain:o.event.domain,links:o.event.links}:(w.name=o.event.name,o.event.desc?w.desc=o.event.desc:delete w.desc,o.event.links?w.links=o.event.links:delete w.links,o.event.flags?w.flags=o.event.flags:delete w.flags,"number"==typeof o.event.consent&&(w.consent=o.event.consent)),mainUpdate(28672),meshserver.send({action:"meshes"}),meshserver.send({action:"nodes",skip:null==devicePagingState?0:devicePagingState.skip});break;case"deleteusergroup":if(null!=usergroups&&null!=usergroups[o.event.ugrpid]){delete usergroups[o.event.ugrpid];var S=0;for(r in usergroups)S++;0==S&&(usergroups=null),mainUpdate(24576)}break;case"createmesh":null!=meshes[o.event.meshid]||!serverinfo.manageAllDeviceGroups&&null==o.event.mesh.links[userinfo._id]||(meshes[o.event.meshid]=o.event.mesh,mainUpdate(24708),meshserver.send({action:"files"}));break;case"meshchange":if(null==meshes[o.event.meshid]){var A=!1;for(r in null!=o.event.links[userinfo._id]&&(A=!0),null!=userinfo.links[o.event.meshid]&&(A=!0),userinfo.links)r.startsWith("ugrp/")&&null!=o.event.links[r]&&(A=!0);A&&(meshes[o.event.meshid]={_id:o.event.meshid,name:o.event.name,mtype:o.event.mtype,desc:o.event.desc,links:o.event.links,amt:o.event.amt,invite:o.event.invite,expireDevs:o.event.expireDevs,relayid:o.event.relayid},meshserver.send({action:"nodes",skip:null==devicePagingState?0:devicePagingState.skip}))}else{if(null!=o.event.name)for(var r in meshes[o.event.meshid].name=o.event.name,nodes)nodes[r].meshid==o.event.meshid&&(nodes[r].meshnamel=o.event.name.toLowerCase());if(null!=o.event.desc&&(meshes[o.event.meshid].desc=o.event.desc),null!=o.event.flags&&(meshes[o.event.meshid].flags=o.event.flags),null!=o.event.consent&&(meshes[o.event.meshid].consent=o.event.consent),o.event.links&&(meshes[o.event.meshid].links=o.event.links),o.event.amt&&(meshes[o.event.meshid].amt=o.event.amt),null!=o.event.invite?meshes[o.event.meshid].invite=o.event.invite:delete meshes[o.event.meshid].invite,null!=o.event.expireDevs&&(0<o.event.expireDevs?meshes[o.event.meshid].expireDevs=o.event.expireDevs:delete meshes[o.event.meshid].expireDevs),null!=o.event.relayid&&(meshes[o.event.meshid].relayid=o.event.relayid),0==IsMeshViewable(o.event.meshid)){20==xxcurrentView&&currentMesh==meshes[o.event.meshid]&&go(2),delete meshes[o.event.meshid];var D=[];for(r in nodes)(nodes[r].meshid!=o.event.meshid||null!=userinfo.links&&null!=userinfo.links[nodes[r]._id])&&D.push(nodes[r]);nodes=D,10<=xxcurrentView&&xxcurrentView<20&&currentNode&&!IsNodeViewable(currentNode)&&(setDialogMode(0),go(1))}}mainUpdate(24708),currentNode&&!IsNodeViewable(currentNode)&&(currentNode=null,10<=xxcurrentView)&&xxcurrentView<20&&go(1),20==xxcurrentView&&currentMesh._id==o.event.meshid&&mainUpdate(4096);break;case"deletemesh":meshes[o.event.meshid]&&(delete meshes[o.event.meshid],mainUpdate(128),meshserver.send({action:"files"}));D=[];if(null!=nodes)for(var r in nodes)nodes[r].meshid!=o.event.meshid&&D.push(nodes[r]);nodes=D,mainUpdate(24580),20<=xxcurrentView&&xxcurrentView<30&&currentMesh._id==o.event.meshid&&(setDialogMode(0),go(2)),10<=xxcurrentView&&xxcurrentView<20&&currentNode&&!IsNodeViewable(currentNode)&&(setDialogMode(0),go(1));break;case"addnode":var E=o.event.node;meshes[E.meshid]&&null==getNodeFromId(E._id)&&(E.namel=E.name.toLowerCase(),E.rname?E.rnamel=E.rname.toLowerCase():E.rnamel=E.namel,E.meshnamel=meshes[E.meshid]?meshes[E.meshid].name.toLowerCase():"*",E.state=0,E.icon||(E.icon=1),E.ident=++nodeShortIdent,nodes.push(E),mainUpdate(23),20==xxcurrentView)&&null!=currentMesh&&currentMesh._id==E.meshid&&mainUpdate(4096);break;case"removenode":d=-1;for(r in nodes)if(nodes[r]._id==o.event.nodeid){d=r;break}-1!=d&&(E=nodes[d],currentNode==E&&(10<=xxcurrentView&&xxcurrentView<20&&(setDialogMode(0),go(1)),currentNode=null),nodes.splice(d,1),mainUpdate(20),20==xxcurrentView)&&null!=currentMesh&&currentMesh._id==E.meshid&&mainUpdate(4096);break;case"changenode":d=-1;for(r in nodes)if(nodes[r]._id==o.event.nodeid){d=r;break}if(-1!=d){if((E=nodes[d]).name=o.event.node.name,E.rname=o.event.node.rname,E.lusers=o.event.node.lusers,E.users=o.event.node.users,E.host=o.event.node.host,E.desc=o.event.node.desc,E.ip=o.event.node.ip,E.osdesc=o.event.node.osdesc,E.publicip=o.event.node.publicip,E.iploc=o.event.node.iploc,E.wifiloc=o.event.node.wifiloc,E.gpsloc=o.event.node.gpsloc,E.tags=o.event.node.tags,E.ssh=o.event.node.ssh,E.rdp=o.event.node.rdp,E.userloc=o.event.node.userloc,E.rdpport=o.event.node.rdpport,E.rfbport=o.event.node.rfbport,E.sshport=o.event.node.sshport,E.httpport=o.event.node.httpport,E.httpsport=o.event.node.httpsport,E.consent=o.event.node.consent,E.pmt=o.event.node.pmt,null!=o.event.node.links?E.links=o.event.node.links:delete E.links,null!=o.event.node.agent&&(null==E.agent&&(E.agent={}),null!=o.event.node.agent.ver&&(E.agent.ver=o.event.node.agent.ver),null!=o.event.node.agent.id&&(E.agent.id=o.event.node.agent.id),null!=o.event.node.agent.caps&&(E.agent.caps=o.event.node.agent.caps),null!=o.event.node.agent.root&&(E.agent.root=o.event.node.agent.root),null!=o.event.node.agent.core?E.agent.core=o.event.node.agent.core:E.agent.core&&delete E.agent.core,E.agent.tag=o.event.node.agent.tag),null!=o.event.node.intelamt&&(null==E.intelamt&&(E.intelamt={}),null!=o.event.node.intelamt.state&&(E.intelamt.state=o.event.node.intelamt.state),null!=o.event.node.intelamt.host&&(E.intelamt.user=o.event.node.intelamt.host),null!=o.event.node.intelamt.user?E.intelamt.user=o.event.node.intelamt.user:delete E.intelamt.user,null!=o.event.node.intelamt.tls&&(E.intelamt.tls=o.event.node.intelamt.tls),null!=o.event.node.intelamt.ver&&(E.intelamt.ver=o.event.node.intelamt.ver),null!=o.event.node.intelamt.tag&&(E.intelamt.tag=o.event.node.intelamt.tag),null!=o.event.node.intelamt.uuid&&(E.intelamt.uuid=o.event.node.intelamt.uuid),null!=o.event.node.intelamt.realm&&(E.intelamt.realm=o.event.node.intelamt.realm),null!=o.event.node.intelamt.flags&&(E.intelamt.flags=o.event.node.intelamt.flags),null!=o.event.node.intelamt.warn?E.intelamt.warn=o.event.node.intelamt.warn:delete E.intelamt.warn),null!=o.event.node.av&&(E.av=o.event.node.av),null!=o.event.node.wsc&&(E.wsc=o.event.node.wsc),null!=o.event.node.volumes&&(E.volumes=o.event.node.volumes),E.namel=E.name.toLowerCase(),E.rname?E.rnamel=E.rname.toLowerCase():E.rnamel=E.namel,o.event.node.icon&&(E.icon=o.event.node.icon),o.event.node.meshid!=E.meshid)if(null!=meshes[o.event.node.meshid]||null!=userinfo.links&&null!=userinfo.links[E._id])E.meshid=o.event.node.meshid,E.meshnamel=meshes[o.event.node.meshid]?meshes[o.event.node.meshid].name.toLowerCase():"*",mainUpdate(7);else{null!=currentNode&&currentNode._id==E._id&&10<=xxcurrentView&&xxcurrentView<20&&!IsNodeViewable(currentNode)&&(currentNode=null,setDialogMode(0),go(1));d=-1;for(r in nodes)if(nodes[r]._id==o.event.nodeid){d=r;break}nodes.splice(d,1),mainUpdate(20)}updateDeviceViewDevice(E),mainUpdate(26),refreshDevice(E._id),20==xxcurrentView&&null!=currentMesh&&currentMesh._id==E.meshid&&mainUpdate(4096),currentNode==E&&null!=xxdialogMode&&"@xxmap"==xxdialogTag&&p10showNodeLocationDialog()}break;case"nodemeshchange":d=-1;for(r in nodes)if(nodes[r]._id==o.event.nodeid){d=r;break}if(-1!=d){E=nodes[d];null!=meshes[o.event.newMeshId]||null!=userinfo.links&&null!=userinfo.links[E._id]?(E.meshid=o.event.newMeshId,E.meshnamel=meshes[o.event.newMeshId]?meshes[o.event.newMeshId].name.toLowerCase():"*",mainUpdate(7)):(null!=currentNode&&currentNode._id==E._id&&10<=xxcurrentView&&xxcurrentView<20&&!IsNodeViewable(currentNode)&&(currentNode=null,setDialogMode(0),go(1)),nodes.splice(d,1),mainUpdate(20)),refreshDevice(o.event.nodeid)}else{E=o.event.node;if(!meshes[E.meshid])break;E.namel=E.name.toLowerCase(),E.rname?E.rnamel=E.rname.toLowerCase():E.rnamel=E.namel,E.meshnamel=meshes[E.meshid]?meshes[E.meshid].name.toLowerCase():"*",E.state=0,E.icon||(E.icon=1),E.ident=++nodeShortIdent,nodes.push(E),mainUpdate(23)}break;case"nodeconnect":var T,d=-1;for(r in nodes)if(nodes[r]._id==o.event.nodeid){d=r;break}-1!=d&&(E=nodes[d],l=getstore("notifications",0),o.event.meshid&&userinfo.links&&userinfo.links[o.event.meshid]&&userinfo.links[o.event.meshid].notify&&(l|=userinfo.links[o.event.meshid].notify),null!=userinfo.notify&&(null!=userinfo.notify[o.event.meshid]&&(l|=userinfo.notify[o.event.meshid]),null!=userinfo.notify[o.event.nodeid])&&(l|=userinfo.notify[o.event.nodeid]),2&l&&(y="Agente conectado",null!=E.agent&&!1===E.agent.root&&(y="Agente conectado con permisos limitados"),T={title:E.name,icon:E.icon,nodeid:E._id,id:o.event.id},0==(1&E.conn)&&0!=(1&o.event.conn)&&(T.text=y,addNotification(T)),0==(2&E.conn)&&0!=(2&o.event.conn)&&(T.text="Intel AMT detectado",addNotification(T)),0==(4&E.conn)&&0!=(4&o.event.conn)&&(T.text="Intel AMT CIRA conectado",addNotification(T)),0==(16&E.conn))&&0!=(16&o.event.conn)&&(T.text="MQTT conectado",addNotification(T)),4&l&&(T={title:E.name,icon:E.icon,nodeid:E._id,id:o.event.id},0!=(1&E.conn)&&0==(1&o.event.conn)&&(T.text="Agente desconectado",addNotification(T)),0!=(2&E.conn)&&0==(2&o.event.conn)&&(T.text="Intel AMT no detectado",addNotification(T)),0!=(4&E.conn)&&0==(4&o.event.conn)&&(T.text="Intel AMT CIRA desconectado",addNotification(T)),0!=(16&E.conn))&&0==(16&o.event.conn)&&(T.text="MQTT desconectado",addNotification(T)),E.conn=o.event.conn,E.pwr=o.event.pwr,E.lastconnect=Date.now(),0==(1&E.conn)&&delete E.sessions,1==(C=Q("DevFilterSelect").value)||5==C?mainUpdate(21):(updateDeviceViewDevice(E),mainUpdate(17)),refreshDevice(E._id),20==xxcurrentView)&&null!=currentMesh&&currentMesh._id==E.meshid&&mainUpdate(4096);break;case"wssessioncount":null!=wssessions&&(0==o.event.count&&wssessions[o.event.userid]?delete wssessions[o.event.userid]:wssessions[o.event.userid]=o.event.count,mainUpdate(16384));break;case"login":null!=users&&users[o.event.userid]&&(users[o.event.userid].login=Math.floor(new Date(o.event.time).getTime()/1e3));break;case"scanamtdevice":if(null==xxdialogMode||!Q("dp1range")||xxdialogTag!="AMTSCAN:"+o.event.range)return;e="";if(null==o.event.results)e="<div style=width:100%;text-align:center;margin-top:12px>No se puede escanear este rango de direcciones.</div><div style=width:100%;text-align:center;margin-top:12px;color:gray;line-height:1.5>Valores de rango de IP de muestra<br />192.168.0.100<br />192.168.1.0/24<br />192.167.0.1-192.168.0.100</div>";else{for(var r in amtScanResults=o.event.results,o.event.results){var N=o.event.results[r],I=N.hostname,I=(20<(I="host"==N.hosttype?capitalizeFirstLetter(I.split(".")[0]):I).length&&(I=I.substring(0,20)+"..."),'<b title="'+EscapeHtml(N.hostname)+'">'+EscapeHtml(I)+"</b> - v"+N.ver);2==N.state?1==N.tls?I+=" con TLS.":I+=" sin TLS.":I+=" not activated.",e+='<div style=width:100%;margin-bottom:2px;background-color:lightgray><div style=padding:4px><div style=display:inline-block;margin-right:5px><input class="DevScanCheckbox form-check-input me-2" name=dp1checkbox tag="'+EscapeHtml(r)+'" type=checkbox onclick=addAmtScanToMeshCheckbox() /></div><div class=j1 style=display:inline-block></div><div style=display:inline-block;margin-left:5px;overflow-x:auto;white-space:nowrap>'+I+"</div></div></div>"}""==e&&(e="<div style=width:100%;text-align:center;margin-top:12px>La búsqueda no arrojó resultados.</div><div style=width:100%;text-align:center;margin-top:12px;color:gray;line-height:1.5>Valores de rango de IP de muestra<br />192.168.0.100<br />192.168.1.0/24<br />192.167.0.1-192.168.0.100</div>")}QH("dp1results",e),QE("dp1range",!0),QE("dp1rangebutton",!0),QE("d2scanSelectButton",!0);break;case"notify":l={text:o.event.value,title:o.event.title,icon:o.event.icon,titleid:o.titleid,msgid:o.msgid,args:o.args};null!=o.id&&(l.id=o.id),null!=o.event.tag&&(l.tag=o.event.tag),"number"==typeof o.maxtime&&(l.maxtime=o.maxtime),addNotification(l);break;case"traceinfo":"object"==typeof o.event.traceSources&&(null!=o.event.traceSources&&0<o.event.traceSources.length?(serverTraceSources=o.event.traceSources,QH("p41traceStatus",EscapeHtml(o.event.traceSources.join(", ")))):(serverTraceSources=[],QH("p41traceStatus","Ninguno")));break;case"sysinfohash":null!=currentNode&&o.event.nodeid==powerTimelineReq&&meshserver.send({action:"getsysinfo",nodeid:o.event.nodeid});break;case"ifchange":null!=currentNode&&currentNode._id==o.event.nodeid&&meshserver.send({action:"getnetworkinfo",nodeid:currentNode._id});break;case"devicesessions":if(null!=(E=getNodeFromId(o.event.nodeid))){if(E.sessions=o.event.sessions,null!=E.sessions){for(var r in E.sessions)0==Object.keys(E.sessions[r]).length&&delete E.sessions[r];0==Object.keys(E.sessions).length&&delete E.sessions}updateDeviceViewDevice(E),null!=currentNode&&currentNode._id==o.event.nodeid&&gotoDevice(currentNode._id,xxcurrentView,!0),xxdialogTag=="SESSIONS-"+o.event.nodeid&&showDeviceSessions(o.event.nodeid,!0),xxdialogTag=="MESSAGES-"+o.event.nodeid&&showDeviceMessages(o.event.nodeid,!0),xxdialogTag=="HELPREQ-"+o.event.nodeid&&showDeviceHelpRequests(o.event.nodeid,!0),2!=Q("DevFilterSelect").value&&6!=Q("DevFilterSelect").value||mainUpdate(1)}break;case"loginTokenChanged":if(o.event.userid!=userinfo._id)return;loginTokens=o.event.loginTokens,mainUpdate(65536);break;case"loginTokenAdded":if(o.event.userid!=userinfo._id)return;(loginTokens=null==loginTokens?[]:loginTokens).push(o.event.newToken),mainUpdate(65536);break;case"stopped":break;case"updatePluginList":installedPluginList=o.event.list,updatePluginList();break;case"pluginStateChange":null!=pluginHandler&&pluginHandler.refreshPluginHandler();break;case"plugin":if(null!=pluginHandler)try{pluginHandler[o.event.plugin][o.event.pluginaction](o)}catch(e){console.log("PluginHandler no pudo enviar el mensaje de evento:",e)}}break;case"createInviteLink":var _,U;xxdialogTag==o.meshid&&(-1!=(_=serverinfo.name).indexOf(".")&&0==(2&features)||(_=window.location.hostname),domainUrl.substring(0,domainUrl.length-1),U=1==serverinfo.https?"https://"+_+(443==serverinfo.port?"":":"+serverinfo.port)+domainUrl+"agentinvite?c="+o.cookie+(urlargs.key?"&key="+urlargs.key:""):"http://"+_+(80==serverinfo.port?"":":"+serverinfo.port)+domainUrl+"agentinvite?c="+o.cookie+(urlargs.key?"&key="+urlargs.key:""),Q("agentInvitationLink").href=U,p=format(1==o.expire?"1 hora":"{0} horas",o.expire),24==o.expire&&(p="1 dia"),168==o.expire&&(p="1 semana"),5040==o.expire&&(p="1 mes"),0==o.expire&&(p="Ilimitado"),QH("agentInvitationLink",format("Enlace de Invitación ({0})",p)),QV("agentInvitationLinkDiv",!0));break;case"createDeviceShareLink":var V;xxdialogTag||(e="",null!=(E=getNodeFromId(o.nodeid))&&(e=(e=(e+=addHtmlValue("Dispositivo",E.name))+addHtmlValue("Nombre de Invitado",o.guestname))+addHtmlValue("Entrada del Ssuario",o.viewOnly?"No permitido, solo vista":"Permitido"),o.start&&o.expire&&(o.recurring?(e+=addHtmlValue("Tiempo de Inicio",printDateTime(new Date(o.start))),o.expire<2?e+=addHtmlValue("Duración",format("{0} minuto",o.expire)):e+=addHtmlValue("Duración",format("{0} minutos",o.expire))):e=(e+=addHtmlValue("Tiempo de Inicio",printDateTime(new Date(o.start))))+addHtmlValue("Tiempo de Expiración",printDateTime(new Date(o.expire)))),1==o.recurring&&(e+=addHtmlValue("Periódico","A diario")),2==o.recurring&&(e+=addHtmlValue("Periódico","Semanalmente")),t=[],7&o.consent&&t.push("Notificar"),56&o.consent&&t.push("Solicitar"),64&o.consent&&t.push("Barra de privacidad"),0==t.length&&t.push("Ninguno"),e+=addHtmlValue("Consentimiento del Usuario",t.join(", ")),V="",o.p<=7?V=["","Enlace de Terminal Remota","Enlace de Escritorio Remoto","Escritorio Remoto + enlace de terminal","Enlace de Archivos Remotos","Terminal Remota + Enlace de Archivos","Escritorio Remoto + Enlace de Archivos","Escritorio Remoto + Terminal + Enlace de archivos"][o.p]:8==o.p?V=format("HTTP/{0} link",o.port):16==o.p&&(V=format("HTTPS/{0}",o.port)),setModalContent("xxAddAgent","Compartir Dispositivo",e+='<div id=agentInvitationLinkDiv style="text-align:center;font-size:large;margin:16px"><a href="'+o.url+'" id=agentInvitationLink rel="noreferrer noopener" target="_blank" style=cursor:pointer>'+V+'</a> <i class="fa-regular fa-copy" title="Copiar enlance al portapapeles" style=cursor:pointer onclick=d2CopyInviteToClip()></i></div></div>'),showModal("xxAddAgentModal","idx_dlgOkButton")));break;case"getmqttlogin":if(null==currentNode||currentNode._id!=o.nodeid||null!=xxdialogMode)return;e="Esta configuración se puede utilizar para conectar MQTT para este dispositivo.<br /><br />";delete o.action,delete o.nodeid,setModalContent("xxAddAgent","Credenciales MQTT",e+="<textarea readonly=readonly style=width:100%;resize:none;height:100px;overflow:auto;font-size:12px readonly>"+JSON.stringify(o)+"</textarea>"),showModal("xxAddAgentModal","idx_dlgOkButton");break;case"stopped":autoReconnect=!1,QH("p0span",o.msg);break;case"updatePluginList":installedPluginList=o.list,updatePluginList();break;case"pluginVersionsAvailable":null!=pluginHandler&&updatePluginList(o.list);break;case"downgradePluginVersions":var K='<select id="lastPluginVersion">';o.info.versionList.forEach(function(e){K+='<option value="'+e.zipball_url+'">'+e.name+"</option>"}),K+="</select>",setModalContent("xxAddAgent","Acción de Plugin",format("Select the version to downgrade the plugin: {0}",o.info.name)+"<hr />"+K+"<hr />Ten en cuenta que no se recomienda bajar de versión. Solo hazlo en caso de que una actualización reciente haya roto algo.NaN"+o.info.id+'" />'),showModal("xxAddAgentModal","idx_dlgOkButton",pluginActionEx);break;case"serverBackup":"googleDrive"==o.service&&(QV("p2ServerActionsGoogleBackup",0<o.state),QV("p2ServerActionsGoogleBackupCheck",2<o.state),miscState.googleDrive={state:o.state},2==o.state)&&(e='<img style=float:right src="images/googledrive-48.png" /><div>Navega a la siguiente URL, confirma el acceso y copie nuevamente el código token.</div><br />',setModalContent("xxAddAgent","Resguardo en Google Drive",e=(e+=addHtmlValue("Activación",'<a href="'+o.url+'" rel="noreferrer noopener" target="_blank">Browse to this URL</a>'))+addHtmlFormFloating("Código","<input id=gdcode onkeyup=server_setupGoogleDriveBackupCheck3() class=form-control></input>")),showModal("xxAddAgentModal","idx_dlgOkButton",()=>server_setupGoogleDriveBackupEx(3,"gd2")),Q("gdcode").focus(),QE("idx_dlgOkButton",!1));break;case"pluginError":setModalContent("xxAddAgent","Error en el Plugin",o.msg),showModal("xxAddAgentModal","idx_dlgOkButton");break;case"plugin":if(null!=pluginHandler&&"string"==typeof o.plugin)try{pluginHandler[o.plugin][o.method](H,o)}catch(e){console.log("Error loading plugin handler ("+e+")")}break;case"amtsetupbin":saveAs(new Blob([Uint8Array.from(atob(o.file),function(e){return e.charCodeAt(0)})],{type:"application/octet-stream"}),"setup.bin");break;case"previousLogins":null!=o.userid&&o.userid;var e="",S="BBB",R="";if(0==o.events.length)e+="No previous login.";else{for(var r in e+="<div style=max-height:260px;overflow-y:scroll;overflow-x:hidden><table>",o.events)107==(a=o.events[r].m)?(a="Inicio de sesión válido",S="BBD1BB",R="",null!=o.events[r].tn&&(a=format("Token: {0}",o.events[r].tn),S="88D188")):108==a?(a="2FA no válido",S="DD9DC3",R="x"):109==a?(a="Cuenta bloqueada",S="E1BBBB",R="x"):110==a&&(a="Contraseña no válida",S="E1BBBB",R="x"),e+="<tr><td><img src=images/user-32"+R+'.png height=32 width=32 style=float:left srcset="images/user-64'+R+'.png 2x"><td><div style=width:300px;background-color:#'+S+";border-radius:6px;margin-bottom:4px;padding:4px><div>"+printDateTime(new Date(o.events[r].t))+", <b>"+EscapeHtml(a)+"</b></div><div style=font-size:x-small>"+EscapeHtml(o.events[r].a.join(", "))+"</div></div></tr>";e+="</table></div>"}setModalContent("xxAddAgent","Inicios de Sesión Anteriores",e),showModal("xxAddAgentModal","idx_dlgOkButton");break;case"getDeviceDetails":saveAs(new Blob([o.data],{type:"application/octet-stream"}),"lista de dispositivos."+o.type);break;case"createLoginToken":if(xxdialogMode)return;e="Toma nota de este nombre de usuario y contraseña, la contraseña no se puede volver a mostrar.<br /><br />";e+=addHtmlValue("Nombre",EscapeHtml(o.name)),0!=o.expire&&(e+=addHtmlValue("Expirar",EscapeHtml(printDateTime(new Date(o.expire))))),setModalContent("xxAddAgent","Crear Token de Inicio de Sesión",e=(e+=addHtmlValue("Nombre de Usuario",'<i class="fa-regular fa-copy" title="Copiar enlance al portapapeles" style="margin:9px;cursor:pointer;float:right" onclick=copyTextToClip2("'+encodeURIComponentEx(o.tokenUser)+'")></i><div class=selecttext style=width:230px;padding:5px;background-color:orange;border-radius:5px;font-size:15px>'+EscapeHtml(o.tokenUser)+"</div>"))+addHtmlValue("Contraseña",'<i class="fa-regular fa-copy" title="Copiar enlance al portapapeles" style="margin:9px;cursor:pointer;float:right" onclick=copyTextToClip2("'+encodeURIComponentEx(o.tokenPass)+'")></i><div class=selecttext style=width:230px;padding:5px;background-color:orange;border-radius:5px;font-size:15px>'+EscapeHtml(o.tokenPass)+"</div>")),showModal("xxAddAgentModal","idx_dlgOkButton");break;case"loginTokens":loginTokens=o.loginTokens,mainUpdate(65536);break;case"report":renderReport(o.data)}}function gotoStartViewPage(){var e=parseInt("{{viewmode}}");if(-1==xxcurrentView){if(""!="{{currentNode}}".toLowerCase()){if(null==getNodeFromId("{{currentNode}}"))return;gotoDevice("{{currentNode}}",e)}else if(null!=args.gotonode){if(96==args.gotonode.length&&(args.gotonode=btoa(hex2rstr(args.gotonode)).split("+").join("@").split("/").join("$")),null==getNodeFromId("node/"+domain+"/"+args.gotonode))return;gotoDevice("node/"+domain+"/"+args.gotonode,e),goBackStack.push(1)}else if(null!=args.gotodevicename){var t=null;if(null!=nodes)for(var o in nodes)nodes[o].name==args.gotodevicename&&(t=nodes[o]._id);t&&(gotoDevice(t,e),goBackStack.push(1))}else if(null!=args.gotodeviceip){t=null;if(null!=nodes)for(var o in nodes)nodes[o].ip==args.gotodeviceip&&(t=nodes[o]._id);t&&(gotoDevice(t,e),goBackStack.push(1))}else if(null!=args.gotomesh){if(null==meshes["mesh/"+domain+"/"+args.gotomesh])return;gotoMesh("mesh/"+domain+"/"+args.gotomesh),go(e),goBackStack.push(2)}else if(null!=args.gotouser){var n=args.gotouser;if(args.gotouser.indexOf("/")<0&&(n="user/"+domain+"/"+args.gotouser),null==users||null==users[n])return;gotoUser(encodeURIComponentEx(n)),go(e),goBackStack.push(4)}else if(null!=args.gotougrp){n=args.gotougrp;if(args.gotougrp.indexOf("/")<0&&(n="ugrp/"+domain+"/"+args.gotougrp),null==usergroups||null==usergroups[n])return;gotoUserGroup(n),go(e),goBackStack.push(50)}else isNaN(e)?(setDialogMode(0),go(1)):go(e);delete args.gotonode,delete args.gotomesh,delete args.gotouser,delete args.gotougrp}}function topMenu(e){null!=xxdialogMode&&0!=xxdialogMode&&999!=xxdialogMode||(void 0===e?1==("none"==QS("topMenu").display)?0!=xxdialogMode&&null!=xxdialogMode||(QV("topMenu",!0),xxdialogMode=999):(QV("topMenu",!1),xxdialogMode=0):(QV("topMenu",!1),xxdialogMode=0,1==e&&goForward("devices"),2==e&&goForward("account"),3==e&&goForward("events"),4==e&&goForward("users"),5==e&&goForward("files"),6==e&&goForward("server")))}function onRealNameCheckBox(){putstore("showRealNames",(showRealNames=Q("RealNameCheckBox").checked)?1:0),mainUpdate(7)}function onOnlineCheckBox(e){putstore("devFilterSelect",Q("DevFilterSelect").value),onDeviceSearchChanged(e)}function updateDevicePageState(){var e,t;null==devicePagingState||devicePagingState.total<=devicePagingState.limit?(QV("devViewPageState",!1),QV("devViewPageButton1",!1),QV("devViewPageButton2",!1),QV("devViewPageButton3",!1),QV("devViewPageButton4",!1)):(e=Math.floor((devicePagingState.skip+devicePagingState.limit)/devicePagingState.limit),t=Math.ceil(devicePagingState.total/devicePagingState.limit),QV("devViewPageState",!0),QV("devViewPageButton1",!0),QV("devViewPageButton2",!0),QV("devViewPageButton3",!0),QV("devViewPageButton4",!0),QH("devViewPageState",e+"/"+t))}function onDeviceViewPageChange(e){if(null!=devicePagingState){var t=Math.floor((devicePagingState.skip+devicePagingState.limit)/devicePagingState.limit),o=Math.ceil(devicePagingState.total/devicePagingState.limit);switch(e){case 1:1<t&&meshserver.send({action:"nodes",skip:0});break;case 2:1<t&&meshserver.send({action:"nodes",skip:(t-2)*devicePagingState.limit});break;case 3:t<o&&meshserver.send({action:"nodes",skip:t*devicePagingState.limit});break;case 4:t<o&&meshserver.send({action:"nodes",skip:(o-1)*devicePagingState.limit})}}}function onDeviceViewChange(e){null!=e&&(Q("viewselect").value=e);for(var t=1;t<6;t++)Q("devViewButton"+t).classList.remove("viewSelectorSel");Q("devViewButton"+Q("viewselect").value).classList.add("viewSelectorSel"),putstore("deviceView",Q("viewselect").value),putstore("viewsize",Q("sizeselect").value),mainUpdate(4),setTimeout(function(){mainUpdate(512)},200)}function onDeviceViewSettings(){var e;xxdialogMode||(null==deviceViewSettings&&(deviceViewSettings={}),Array.isArray(deviceViewSettings.devsCols)||(deviceViewSettings.devsCols=["user","ip","conn"]),e="",setModalContent("xxAddAgent","Columnas de vista de dispositivo",e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e+='<label><input id=d2c8 type=checkbox class="form-check-input me-2"'+(0<=deviceViewSettings.devsCols.indexOf("agtype")?" checked":"")+">Tipo de agente</label><br />")+('<label><input id=d2c9 type=checkbox class="form-check-input me-2"'+(0<=deviceViewSettings.devsCols.indexOf("agver")?" checked":"")+">Versión del agente</label><br />"))+('<label><input id=d2c6 type=checkbox class="form-check-input me-2"'+(0<=deviceViewSettings.devsCols.indexOf("desc")?" checked":"")+">Descripción del aparato</label><br />"))+('<label><input id=d2c5 type=checkbox class="form-check-input me-2"'+(0<=deviceViewSettings.devsCols.indexOf("os")?" checked":"")+">Sistema Operativo</label><br />"))+('<label><input id=d2c10 type=checkbox class="form-check-input me-2"'+(0<=deviceViewSettings.devsCols.indexOf("tags")?" checked":"")+">Etiquetas</label><br />"))+('<label><input id=d2c11 type=checkbox class="form-check-input me-2"'+(0<=deviceViewSettings.devsCols.indexOf("windowsav")?" checked":"")+">Windows AV</label><br />"))+('<label><input id=d2c12 type=checkbox class="form-check-input me-2"'+(0<=deviceViewSettings.devsCols.indexOf("windowsupdate")?" checked":"")+">Windows Update</label><br />"))+('<label><input id=d2c13 type=checkbox class="form-check-input me-2"'+(0<=deviceViewSettings.devsCols.indexOf("windowsfirewall")?" checked":"")+">Windows Firewall</label><br />"))+('<label><input id=d2c14 type=checkbox class="form-check-input me-2"'+(0<=deviceViewSettings.devsCols.indexOf("lastbootuptime")?" checked":"")+">Last Boot Up Time</label><br />"))+('<label><input id=d2c1 type=checkbox class="form-check-input me-2"'+(0<=deviceViewSettings.devsCols.indexOf("links")?" checked":"")+">Enlaces de enrutador MeshCentral</label><br />"))+('<label><input id=d2c2 type=checkbox class="form-check-input me-2"'+(0<=deviceViewSettings.devsCols.indexOf("user")?" checked":"")+">Usuarios Conectados</label><br />"))+('<label><input id=d2c3 type=checkbox class="form-check-input me-2"'+(0<=deviceViewSettings.devsCols.indexOf("ip")?" checked":"")+">Dirección IP del agente</label><br />"))+('<label><input id=d2c4 type=checkbox class="form-check-input me-2"'+(0<=deviceViewSettings.devsCols.indexOf("conn")?" checked":"")+">Conectividad del servidor</label><br />"))+('<label><input id=d2c7 type=checkbox class="form-check-input me-2"'+(0<=deviceViewSettings.devsCols.indexOf("lastseen")?" checked":"")+">Ultima vez visto</label><br />"))+('<label><input id=d2c15 type=checkbox class="form-check-input me-2"'+(0<=deviceViewSettings.devsCols.indexOf("amthost")?" checked":"")+">Intel&reg; AMT hostname</label><br />"))+('<label><input id=d2c17 type=checkbox class="form-check-input me-2"'+(0<=deviceViewSettings.devsCols.indexOf("amtstate")?" checked":"")+">Intel&reg; AMT state</label><br />")),showModal("xxAddAgentModal","idx_dlgOkButton",()=>onDeviceViewSettingsEx()))}function onDeviceViewSettingsEx(){var e=[];Q("d2c1").checked&&e.push("links"),Q("d2c2").checked&&e.push("user"),Q("d2c3").checked&&e.push("ip"),Q("d2c4").checked&&e.push("conn"),Q("d2c5").checked&&e.push("os"),Q("d2c6").checked&&e.push("desc"),Q("d2c7").checked&&e.push("lastseen"),Q("d2c8").checked&&e.push("agtype"),Q("d2c9").checked&&e.push("agver"),Q("d2c10").checked&&e.push("tags"),Q("d2c11").checked&&e.push("windowsav"),Q("d2c12").checked&&e.push("windowsupdate"),Q("d2c13").checked&&e.push("windowsfirewall"),Q("d2c14").checked&&e.push("lastbootuptime"),Q("d2c15").checked&&e.push("amthost"),Q("d2c17").checked&&e.push("amtstate"),deviceViewSettings.devsCols=e,putstore("_deviceViewSettings",JSON.stringify(deviceViewSettings)),mainUpdate(4)}function ondockeypress(e){if(!document.querySelector(".modal.show")){if(setSessionActivity(),!xxdialogMode&&11==xxcurrentView&&desktop&&Q("DeskControl").checked){if(null!=currentNode){var t=GetNodeRights(currentNode);if(0==(0==(8192&features2)&&(4294967295==t||0!=(8&t)&&0==(256&t))))return!1;t=4294967295!=t&&0!=(8&t)&&0==(256&t)&&0!=(4096&t);if(1==t&&(1==e.altKey||1==e.ctrlKey||e.keyCode<32&&8!=e.keyCode&&13!=e.keyCode||90<e.keyCode))return!1}return desktop.m.handleKeys(e)}if(!xxdialogMode&&12==xxcurrentView&&terminal&&3==terminal.State&&null==xterm)return terminal.m.TermHandleKeys(e);if(!xxdialogMode&&(15==xxcurrentView||115==xxcurrentView))return agentConsoleHandleKeys(e);if(!xxdialogMode&&4==xxcurrentView){if(1==e.ctrlKey||1==e.altKey||1==e.metaKey)return;var o=0;if(e.key?(1===e.key.length&&0==userSearchFocus&&(Q("UserSearchInput").value=Q("UserSearchInput").value+e.key,o=1),8==e.keyCode&&0==userSearchFocus&&(n=Q("UserSearchInput").value,Q("UserSearchInput").value=n.substring(0,n.length-1),o=1),27==e.keyCode&&(Q("UserSearchInput").value="",o=1)):0!=e.charCode&&0==userSearchFocus&&(Q("UserSearchInput").value=Q("UserSearchInput").value+String.fromCharCode(e.charCode),o=1),0<o)return 1==o&&onUserSearchInputChanged(),haltEvent(e)}if(!xxdialogMode&&1==xxcurrentView)if(1==e.ctrlKey&&96==e.charCode)showRealNames=!showRealNames,putstore("showRealNames",(Q("RealNameCheckBox").value=showRealNames)?1:0),mainUpdate(6);else if(1!=e.ctrlKey&&1!=e.altKey&&1!=e.metaKey){if(Q("viewselect").value<4){var n,o=0;if(e.key?(1===e.key.length&&0==searchFocus&&(Q("KvmSearchInput").value=Q("SearchInput").value=Q("SearchInput").value+e.key,o=1),8==e.keyCode&&0==searchFocus&&(n=Q("SearchInput").value,Q("KvmSearchInput").value=Q("SearchInput").value=n.substring(0,n.length-1),o=1),27==e.keyCode&&(Q("KvmSearchInput").value=Q("SearchInput").value="",o=1)):0!=e.charCode&&0==searchFocus&&(Q("KvmSearchInput").value=Q("SearchInput").value=Q("SearchInput").value+String.fromCharCode(e.charCode),o=1),0<o)return 1==o&&mainUpdate(5),haltEvent(e)}4==Q("viewselect").value&&(e.key?(1===e.key.length&&0==mapSearchFocus&&(Q("mapSearchLocation").value=Q("mapSearchLocation").value+e.key,o=1),27==e.keyCode&&(Q("mapSearchLocation").value="",mapCloseSearchWindow(),o=1),13==e.keyCode&&getSearchLocation()):0!=e.charCode&&0==mapSearchFocus&&(Q("mapSearchLocation").value=Q("mapSearchLocation").value+String.fromCharCode(e.charCode)))}}}function ondockeydown(e){if(setSessionActivity(),!xxdialogMode&&11==xxcurrentView&&desktop&&Q("DeskControl").checked){if(null!=currentNode){var t=GetNodeRights(currentNode);if(0==(0==(8192&features2)&&(4294967295==t||0!=(8&t)&&0==(256&t))))return!1;t=4294967295!=t&&0!=(8&t)&&0==(256&t)&&0!=(4096&t);if(1==t&&(1==e.altKey||1==e.ctrlKey||e.keyCode<32&&8!=e.keyCode&&13!=e.keyCode||90<e.keyCode))return!1}return desktop.m.handleKeyDown(e)}if(!xxdialogMode&&12==xxcurrentView&&terminal&&3==terminal.State&&null==xterm&&(terminal.m.TermHandleKeyDown(e),37<=e.keyCode)&&e.keyCode<=40&&haltEvent(e),!xxdialogMode&&13==xxcurrentView&&116==e.keyCode&&null!=p13filetree)return haltEvent(e),!1;if(!xxdialogMode&&(15==xxcurrentView||115==xxcurrentView))return agentConsoleHandleKeys(e);if(!xxdialogMode&&4==xxcurrentView&&(8===e.keyCode&&0==userSearchFocus&&(o=Q("UserSearchInput").value,Q("UserSearchInput").value=o.substring(0,o.length-1),n=1),27===e.keyCode&&(Q("UserSearchInput").value="",n=1),0<n))return 1==n&&mainUpdate(5),haltEvent(e);if(!xxdialogMode&&1==xxcurrentView&&1!=e.ctrlKey&&1!=e.altKey&&1!=e.metaKey){var o,n=0;if(Q("viewselect").value<4)if(8===e.keyCode&&0==searchFocus&&(o=Q("SearchInput").value,Q("KvmSearchInput").value=Q("SearchInput").value=o.substring(0,o.length-1),n=1),27===e.keyCode&&(Q("KvmSearchInput").value=Q("SearchInput").value="",n=1),0<n)return 1==n&&mainUpdate(5),haltEvent(e);4==Q("viewselect").value&&(8===e.keyCode&&0==mapSearchFocus&&(o=Q("mapSearchLocation").value,Q("mapSearchLocation").value=o.substring(0,o.length-1),n=1),27===e.keyCode)&&(Q("mapSearchLocation").value="",mapCloseSearchWindow())}}function ondockeyup(e){if(setSessionActivity(),!xxdialogMode&&11==xxcurrentView&&desktop&&Q("DeskControl").checked){if(null!=currentNode){var t=GetNodeRights(currentNode);if(0==(0==(8192&features2)&&(4294967295==t||0!=(8&t)&&0==(256&t))))return!1;t=4294967295!=t&&0!=(8&t)&&0==(256&t)&&0!=(4096&t);if(1==t&&(1==e.altKey||1==e.ctrlKey||e.keyCode<32&&8!=e.keyCode&&13!=e.keyCode||90<e.keyCode))return!1}return desktop.m.handleKeyUp(e)}return!xxdialogMode&&12==xxcurrentView&&terminal&&3==terminal.State&&null==xterm?terminal.m.TermHandleKeyUp(e):xxdialogMode||13!=xxcurrentView||116!=e.keyCode||null==p13filetree?xxdialogMode||4!=xxcurrentView||(8!==e.keyCode||0!=searchFocus)&&27!==e.keyCode?(xxdialogMode&&27==e.keyCode&&dialogclose(0),1!=e.shiftKey||27!=e.keyCode?!xxdialogMode&&0==xxcurrentView&&1!=e.ctrlKey&&1!=e.altKey&&1!=e.metaKey&&(Q("viewselect").value<4&&(8===e.keyCode&&0==searchFocus||27===e.keyCode)||4==Q("viewselect").value&&(8===e.keyCode&&0==mapSearchFocus||27===e.keyCode))?haltEvent(e):void 0:(dialogclose(0),Q("KvmSearchInput").value=Q("SearchInput").value="",mainUpdate(5),null!=desktop&&connectDesktop(),null!=terminal&&connectTerminal(),null!=files&&connectFiles(),void go(1))):haltEvent(e):(p13folderup(9999),haltEvent(e),!1)}function ondocblur(){if(!xxdialogMode&&11==xxcurrentView&&desktop&&Q("DeskControl").checked&&desktop.m.handleReleaseKeys)return desktop.m.handleReleaseKeys()}function devGrpMouseHover(e,t){setSessionActivity();Q("viewselect").value;e=e.children[1].children[1];e.children[0].classList.remove("g1s"),e.children[1].classList.remove("e2s"),e.children[2].classList.remove("g2s"),1==t&&(e.children[0].classList.add("g1s"),e.children[1].classList.add("e2s"),e.children[2].classList.add("g2s"))}function devMouseHover(e,t){setSessionActivity();var o,n=Q("viewselect").value;1==n?((o=e.children[0].children[0].children[1].children[0].children[0].children[0]).children[1].classList.remove("g1s"),o.children[2].classList.remove("e2s"),o.children[3].classList.remove("g2s"),1==t&&(o.children[1].classList.add("g1s"),o.children[2].classList.add("e2s"),o.children[3].classList.add("g2s"))):2==n&&((o=e).children[2].classList.remove("g1s"),o.children[4].classList.remove("e2s"),o.children[3].classList.remove("g2s"),1==t)&&(o.children[2].classList.add("g1s"),o.children[4].classList.add("e2s"),o.children[3].classList.add("g2s"))}var deviceHeaderCount,deviceHeaderId=0,deviceHeaderTotal=0,deviceHeadersTitles={},deviceHeaders={},oldviewmode=0;function updateDevices(){if(null!=nodes&&1==xxcurrentView){var e="",t=0,o=null,n={},i=Q("viewselect").value,a={},s={};if(QV("xdevices",4!=i),QV("xdevicesmap",4==i),QVH("devListToolbar",i<3),QVH("kvmListToolbar",3==i||5==i),QVH("devMapToolbar",4==i),QV("devListToolbarSize",3==i||5==i),QV("devListToolbarSettings",2==i),QV("NoMeshesPanel",0==nodes.length&&0==meshcount),QV("devListToolbarViewIcons",0<nodes.length),QV("devListToolbarSort",0<nodes.length&&4!=i),0==nodes.length&&(i=1,sort=0),4==i)setTimeout(function(){null!=xxmap.map&&xxmap.map.updateSize()},200);else{deviceHeaderCount={},deviceHeaders={},deviceHeadersTitles={};var r=[],l=((deviceHeaderTotal=deviceHeaderId=0)==sort?nodes.sort(meshSort):1==sort?nodes.sort(powerSort):2==sort?1==showRealNames?nodes.sort(deviceHostSort):nodes.sort(deviceSort):5==sort&&(deviceViewSettings&&deviceViewSettings.devsCols&&0<=deviceViewSettings.devsCols.indexOf("lastseen")||(0==requestedLastConnects&&(requestedLastConnects=!0,meshserver.send({action:"lastconnects"})),null==deviceViewSettings&&(deviceViewSettings={}),Array.isArray(deviceViewSettings.devsCols)?deviceViewSettings.devsCols.push("lastseen"):deviceViewSettings.devsCols=["user","ip","conn","lastseen"]),nodes.sort(lastConnectSort)),Q("column_l").clientWidth-60),d=Math.floor(l/301),d=301+Math.floor((l-301*d)/d),c=4;for(w in deviceViewSettings&&deviceViewSettings.devsCols&&(c=deviceViewSettings.devsCols.length+1,0<=deviceViewSettings.devsCols.indexOf("desc"))&&c--,nodes){var u=nodes[w];if(0!=u.v){var p,m,g=meshes[u.meshid],v=GetNodeRights(u);if(0==sort?(meshes[u.meshid]?u.meshid:"*")!=o&&(1!=i&&3!=i&&5!=i||null==o||(e+="</div>"),deviceHeaderSet(),p="",2==i&&(e+="<tr><td colspan="+c+">"),meshes[u.meshid]&&1==meshes[u.meshid].mtype&&(p="<span class=devHeaderx>, solo Intel&reg; AMT</span>"),meshes[u.meshid]&&3==meshes[u.meshid].mtype&&(p=meshes[u.meshid].relayid?"<span class=devHeaderx>, Dispositivos retransmitidos</span>":"<span class=devHeaderx>, Dispositivos locales</span>"),1==i&&null!=o&&(2==t&&(e+="<td><div style=width:301px></div></td>"),""!=e)&&(e+="</tr></table>"),2==i&&(e+="<div>"),e=(e+="<div class=DevSt style=width:100%;padding-top:4px><span style=float:right>")+"<span id=DevxHeader"+deviceHeaderId+" class=devHeaderx></span>"+p+"</span>",1!=i&&2!=i&&3!=i&&5!=i||(x=CollapsedGroups[u.meshid],e+='<i role="button" cmenu=expandAllContextMenu onclick=toggleCollapseGroup("'+deviceHeaderId+'","'+u.meshid+'",'+i+') class="fa-fw fa-solid '+(!0===x?"fa-chevron-right":"fa-chevron-down")+'" id="DevxColImg'+deviceHeaderId+'"></i>'),o=meshes[u.meshid]?(e+='<span id=MxMESH cmenu=meshContextMenu tabindex=0 style=cursor:pointer onclick=gotoMesh("'+u.meshid+"\") onkeypress=\"if (event.key=='Enter') gotoMesh('"+u.meshid+"')\">"+EscapeHtml(meshes[u.meshid].name)+"</span>"+getMeshActions(g,v)+"</div>",u.meshid):(e+="<span id=MxMESH><i>Dispositivos Individuales</i></span></div>","*"),2==i&&(e+="</div>"),t=0,(n[o]=1)!=i&&3!=i&&5!=i||(e+="<div id=DevxCol"+deviceHeaderId+(!0===x?" style=display:none":"")+">")):1==sort?(p=u.pwr||0)!==o&&(1!=i&&3!=i&&5!=i||null==o||(e+="</div>"),deviceHeaderSet(),1==i&&null!==o&&(2==t&&(e+="<td><div style=width:301px></div></td>"),""!=e)&&(e+="</tr></table>"),2==i&&(e+="<tr><td colspan="+c+">"),e+="<div class=DevSt style=width:100%;padding-top:4px><span id=DevxHeader"+deviceHeaderId+" class=devHeaderx style=float:right></span>",1!=i&&2!=i&&3!=i&&5!=i||(x=CollapsedGroups["pwr:"+p],e+='<i role="button" cmenu=expandAllContextMenu onclick=toggleCollapseGroup("'+deviceHeaderId+'","pwr:'+p+'",'+i+') class="fa-fw fa-solid '+(!0===x?"fa-chevron-right":"fa-chevron-down")+'" id="DevxColImg'+deviceHeaderId+'"></i>'),e+="<span>"+PowerStateStr2(u.pwr)+"</span></div>",o=p,t=0,1!=i&&3!=i&&5!=i||(e+="<div id=DevxCol"+deviceHeaderId+(!0===x?" style=display:none":"")+">")):2!=sort&&5!=sort||null==o&&(o="1"),1==i?e+="<div name=xxdevice1 id=xv1"+u._id+" style=display:inline-block;position:relative;width:"+d+"px;height:50px;padding-top:1px;padding-bottom:1px></div>":2==i?(m=u.meshid,1==sort?m="pwr:"+(u.pwr||0):3!=sort&&4!=sort||(m="tag:**xx**xx*TaG*xx**xx**"),e+="<tr name=xxdevice2 colname=DevxCol"+m+" style=height:20px"+((x=3!=sort&4!=sort&CollapsedGroups[m])?";display:none":"")+" id=xv2"+u._id+"></tr>"):(3==i||5==i)&&1&u.conn&&0!=(8&v||256&v)&&u.agent&&0!=(1&u.agent.caps)&&(0!=Object.keys(checkedNodeids).length&&!checkedNodeids[u._id]||(e+=updateDeviceViewHtml(i,null,u),r.push(u._id))),(3==sort||4==sort)&&""!=e){if(u.tags)for(var h in u.tags){var f=u.tags[h],x=(4==sort&&(f=g?g.name+" - "+u.tags[h]:"**INDV*~*DEVS** - "+u.tags[h]),CollapsedGroups["tag:"+encodeURIComponentEx(f)]),k=e.replace("**xx**xx*TaG*xx**xx**",encodeURIComponentEx(f)+(x?" style=display:none":""));if(null==a[f]?(a[f]=k,s[f]=1):(a[f]+=k,s[f]+=1),3==i||5==i)break}else 4!=sort||null==g||null!=u.tags&&0!=u.tags.length||(f=g.name,x=CollapsedGroups["tag:"+encodeURIComponentEx(f)],k=e.replace("**xx**xx*TaG*xx**xx**",encodeURIComponentEx(f)+(x?" style=display:none":"")),null==a[f]?(a[f]=k,s[f]=1):(a[f]+=k,s[f]+=1));e=""}deviceHeaderTotal++,void 0===deviceHeaderCount[u.state]?deviceHeaderCount[u.state]=1:deviceHeaderCount[u.state]++}}if(1==i&&null!=o&&(e+="</div>"),32<=r.length&&(Q("autoConnectDesktopCheckbox").checked=!1),QE("autoConnectDesktopCheckbox",r.length<32),3==sort||4==sort){var b=[],y=0;for(w in a)b.push(w);for(h in b.sort(function(e,t){return sortCollator.compare(e.toLowerCase(),t.toLowerCase())}),b){var w=b[h];e=2==i?(e+="<tr><td colspan="+c+"><div class=DevSt style=width:100%;padding-top:4px>",x=CollapsedGroups["tag:"+encodeURIComponentEx(w)],(e+='<i role="button" cmenu=expandAllContextMenu onclick=toggleCollapseGroup("'+y+'","tag:'+encodeURIComponentEx(w)+'",2) class="fa-fw fa-solid '+(!0===x?"fa-chevron-right":"fa-chevron-down")+'" id="DevxColImg'+y+'"></i>')+"<span class=devHeaderx style=float:right>"+s[w]+" node"+(1<s[w]?"s":"")+"</span><span>"+EscapeHtml(w).split("|").join(" &rarr; ").split("**INDV*~*DEVS**").join("<i>Dispositivos Individuales</i>")+"</span></div>"+a[w]):(e+="<div class=DevSt style=width:100%;padding-top:4px><span class=devHeaderx style=float:right>"+format(1<s[w]?"{0} nodes":"{0} node",s[w])+"</span>",x=CollapsedGroups["tag:"+encodeURIComponentEx(w)],(e=(e+='<i role="button" cmenu=expandAllContextMenu onclick=toggleCollapseGroup("'+y+'","tag:'+encodeURIComponentEx(w)+'") class="fa-fw fa-solid '+(!0===x?"fa-chevron-right":"fa-chevron-down")+'" id="DevxColImg'+y+'"></i>')+"<span>"+EscapeHtml(w).split("|").join(" &rarr; ").split("**INDV*~*DEVS**").join("<i>Dispositivos Individuales</i>")+"</span></div>")+"<div id=DevxCol"+y+(!0===x?" style=display:none":"")+">"+a[w]+"</div>"),y++}}var C=!1;if(""==e&&0<nodes.length&&(""!=Q("SearchInput").value||0!=Q("DevFilterSelect").value)&&(C=!0,e=3==sort?'<div style="margin:30px">No se incluyen dispositivos en ningún grupo, haga clic en un "Grupo" de dispositivos para agregarlos a un grupo.</div>':'<div style="margin:30px">No hay dispositivos que coincidan con esta búsqueda. <a onclick=clearDeviceSearch()>Borrar filtro de búsqueda</a></div>'),1==i&&2==t&&(e+="<td><div style=width:301px></div></td>"),0==sort&&""==Q("SearchInput").value&&0==Q("DevFilterSelect").value&&i<3){var M=deviceHeaderId,S=[];for(w in meshes)S.push(meshes[w]);for(w in S.sort(nameSort),S){var A=S[w],v=GetMeshRights(A);null==n[A._id]&&(""!=o&&""!=e&&(e+="</tr></table>"),e+="<table style=width:100%;padding-top:4px cellpadding=0 cellspacing=0><tr><td colspan=3 class=DevSt>",M++,x=CollapsedGroups[A._id],e=(e=(e+='<i role="button" cmenu=expandAllContextMenu onclick=toggleCollapseGroup("'+M+'","'+A._id+'") class="fa-fw fa-solid '+(!0===x?"fa-chevron-right":"fa-chevron-down")+'" id="DevxColImg'+M+'"></i>')+'<span id=MxMESH style=cursor:pointer onclick=gotoMesh("'+A._id+'")>'+EscapeHtml(A.name)+"</span><span>")+getMeshActions(A,v)+"</span></td></tr><tr>",1==A.mtype?(e+="<td><div style=padding:10px><i>No hay dispositivos Intel&reg; AMT en este grupo de dispositivos",0==(4&v)||4294967295!=userinfo.siteadmin&&0!=(4096&userinfo.siteadmin)||(e+=", <a href=# style=cursor:pointer onclick='return addDeviceToMesh(\""+A._id+"\")'>agregar uno</a>")):2==A.mtype?(e=e+"<td><div id=DevxCol"+M+(!0===x?" style=display:none":"")+"><div style=padding:10px><i>No hay dispositivos en este grupo de dispositivos",0==(4&v)||4294967295!=userinfo.siteadmin&&0!=(4096&userinfo.siteadmin)||(e+=", <a href=# style=cursor:pointer onclick='return addAgentToMesh(\""+A._id+"\")'>agregar uno</a>")):3==A.mtype?(e=e+"<td><div id=DevxCol"+M+(!0===x?" style=display:none":"")+"><div style=padding:10px><i>No hay dispositivos locales en este grupo de dispositivos",0==(4&v)||4294967295!=userinfo.siteadmin&&0!=(4096&userinfo.siteadmin)||(e+=", <a href=# style=cursor:pointer onclick='return addLocalDeviceToMesh(\""+A._id+"\")'>agregar uno</a>")):4==A.mtype&&(e=e+"<td><div id=DevxCol"+M+(!0===x?" style=display:none":"")+"><div style=padding:10px><i>No hay dispositivos en este grupo de dispositivos"),e+=".</i></div></td></div>",o=A._id,0)}}for(w in""!=e&&0==C?(e+="</table>",2==i&&(C="",null==deviceViewSettings&&(deviceViewSettings={}),Array.isArray(deviceViewSettings.devsCols)||(deviceViewSettings.devsCols=["user","ip","conn"]),0<=deviceViewSettings.devsCols.indexOf("agtype")&&(C+="<th style=width:100px>Tipo de agente"),0<=deviceViewSettings.devsCols.indexOf("agver")&&(C+="<th style=width:100px>Versión del agente"),0<=deviceViewSettings.devsCols.indexOf("os")&&(C+="<th style=width:160px>SO"),0<=deviceViewSettings.devsCols.indexOf("tags")&&(C+="<th style=width:120px>Etiquetas"),0<=deviceViewSettings.devsCols.indexOf("windowsav")&&(C+="<th style=width:100px>Windows AV"),0<=deviceViewSettings.devsCols.indexOf("windowsupdate")&&(C+="<th style=width:120px>Windows Update"),0<=deviceViewSettings.devsCols.indexOf("windowsfirewall")&&(C+="<th style=width:120px>Windows Firewall"),0<=deviceViewSettings.devsCols.indexOf("lastbootuptime")&&(C+="<th style=width:120px>Last Boot Up Time"),0<=deviceViewSettings.devsCols.indexOf("links")&&(C+="<th style=width:120px>Enlaces"),0<=deviceViewSettings.devsCols.indexOf("user")&&(C+="<th style=width:120px>Usuario"),0<=deviceViewSettings.devsCols.indexOf("ip")&&(C+="<th style=width:120px>Dirección"),0<=deviceViewSettings.devsCols.indexOf("conn")&&(C+="<th style=width:100px>Conectividad"),0<=deviceViewSettings.devsCols.indexOf("amthost")&&(C+="<th style=width:100px>AMT Host"),0<=deviceViewSettings.devsCols.indexOf("amtstate")&&(C+="<th style=width:100px>AMT State"),0<=deviceViewSettings.devsCols.indexOf("lastseen")&&(C+="<th style=width:120px>Ultima vez visto",0==requestedLastConnects)&&(requestedLastConnects=!0,meshserver.send({action:"lastconnects"})),e="<table style=width:100%;margin-top:4px cellpadding=0 cellspacing=0><th>"+C+e+"</tr></table><div style=height:1px></div>")):(e+="</table>",3==sort&&(e='<div style="margin:10px"><i>No se encontraron dispositivos con etiquetas.</i></div>')),e+="<div style=border-top-style:solid;border-top-width:1px;border-top-color:#DDDDDD;cursor:pointer;font-size:small;margin-top:4px>",i<3&&0==sort&&0<Object.keys(meshes).length&&(4294967295==userinfo.siteadmin||0==(64&userinfo.siteadmin))&&(e+='<a href=# onclick="return account_createMesh()" title="Crear un nuevo grupo de dispositivos." style=cursor:pointer>Agregar Grupo de Dispositivos</a>&nbsp'),4294967295!=userinfo.siteadmin&&0!=(128&userinfo.siteadmin)||(e+="<a href=# onclick='return p10showMeshCmdDialog(0)' style=cursor:pointer title=\"Descargar MeshCmd, una herramienta de línea de comandos que realiza muchas funciones.\">MeshCmd</a>&nbsp","win32"!=navigator.platform.toLowerCase()&&"macintel"!=navigator.platform.toLowerCase())||(e+="<a href=# onclick='return p10showMeshRouterDialog()' style=cursor:pointer title=\"Descargar MeshCentral Router, una herramienta de mapeo de puertos TCP.\">Router</a>&nbsp"),e+="</div><div style=height:60px></div>",QH("xdevices",e),deviceHeaderSet(),deviceHeaders)QH(w,deviceHeaders[w]);for(w in deviceHeadersTitles)Q(w).title=deviceHeadersTitles[w];if(p1updateInfo(),3!=i&&5!=i||1!=xxcurrentView)disconnectAllKvmFunction(),Q("autoConnectDesktopCheckbox").checked=!1;else{var D,E=[{x:180,y:101},{x:302,y:169},{x:454,y:255}][Q("sizeselect").selectedIndex];for(w in 3==i&&(C=E.x+2,l=l-5,D=Math.floor(l/C),D=C+Math.floor((l-D*C)/D),E.y=E.y*(D/E.x),E.x=D),multiDesktop)multiDesktop[w].xxdelete=!0;for(w in r){var T=r[w],N=T.split("/")[2],I=multiDesktop[T];if(null!=I){var _=5==i?I.m.width*E.y/I.m.height:E.x;I.m.CanvasId.setAttribute("style","background-color:black;width:"+_+"px;height:"+E.y+"px"),Q("xkvmid_"+N).appendChild(I.m.CanvasId),delete I.xxdelete,QH("skvmid_"+N,["Desconectado","Conectando....","Configurar...","",""][null==I.m.State?I.m.state:I.m.State])}else{u=getNodeFromId(T);if(desktopNode==u&&null!=desktop){var t=desktop.m.CanvasId,_=5==i?desktop.m.width*E.y/desktop.m.height:E.x;t.setAttribute("id","kvmid_"+N),t.setAttribute("style","background-color:black;width:"+_+"px;height:"+E.y+"px"),t.setAttribute("onclick","toggleKvmDevice('"+T+"')"),t.removeAttribute("onmousedown"),t.removeAttribute("onmouseup"),t.removeAttribute("onmousemove"),Q("xkvmid_"+N).appendChild(t),QH("skvmid_"+N,["Desconectado","Conectando....","Configurar...","",""][null==desktop.m.State?desktop.m.state:desktop.m.State]),desktop.m.SendCompressionLevel&&desktop.m.SendCompressionLevel(multidesktopsettings.agentencoding,multidesktopsettings.quality,multidesktopsettings.scaling,multidesktopsettings.framerate),desktop.shortid=N,desktop.onStateChanged=onMultiDesktopStateChange,desktop.m.onRemoteInputLockChanged=null,desktop.m.onKeyboardStateChanged=null,multiDesktop[T]=desktop,desktop=desktopNode=currentNode=null,QH("DeskParent",'<canvas id="Desk" oncontextmenu="return false" onmousedown=dmousedown(event) onmouseup=dmouseup(event) onmousemove=dmousemove(event)></canvas>')}else{(t=document.createElement("canvas")).setAttribute("id","kvmid_"+N),t.setAttribute("width",640),t.setAttribute("height",480),t.setAttribute("oncontextmenu","return false"),t.setAttribute("style","background-color:black;width:"+E.x+"px;height:"+E.y+"px"),t.setAttribute("onclick","toggleKvmDevice('"+T+"')");try{Q("xkvmid_"+N).appendChild(t)}catch(e){}1==Q("autoConnectDesktopCheckbox").checked&&setTimeout(function(){connectMultiDesktop(u,1)},100)}}}for(w in multiDesktop)1==multiDesktop[w].xxdelete?(multiDesktop[w].Stop(),delete multiDesktop[w]):debugmode&&multiDesktop[w].m&&multiDesktop[w].m.onScreenSizeChange&&mdeskAdjust(multiDesktop[w].m,multiDesktop[w].m.ScreenWidth,multiDesktop[w].m.ScreenHeight,multiDesktop[w].m.CanvasId);deskAdjust()}}oldviewmode=i,onDevicesScrollEx()}}var xxModal,onDevicesTouchActive=!1,onDevicesScrollnagleTimer=null;function onDevicesScroll(e){(e=void 0===e?!1:e)&&(Q("xdevices").scrollTop=0),null!=onDevicesScrollnagleTimer||onDevicesTouchActive||(onDevicesScrollnagleTimer=setTimeout(onDevicesScrollEx,250))}function onDeviceTouch(e){onDevicesTouchActive!=e&&0==(onDevicesTouchActive=e)&&onDevicesScrollEx()}function onDevicesScrollEx(){null!=onDevicesScrollnagleTimer&&(clearTimeout(onDevicesScrollnagleTimer),onDevicesScrollnagleTimer=null);for(var e,t=Q("xdevices").scrollTop-200,o=Q("xdevices").scrollTop+Q("xdevices").clientHeight+200,n=Q("viewselect").value,i=document.getElementsByName("xxdevice"+n),a=0;a<i.length;a++)i[a].offsetTop>=t&&i[a].offsetTop<o&&null!=(e=getNodeFromId(i[a].id.substring(3)))?updateDeviceViewHtml(n,i[a],e):i[a].innerHTML=""}function updateDeviceViewDevice(e){var t,o=Q("viewselect").value;1!=o&&2!=o?mainUpdate(4):null!=(e="string"==typeof e?getNodeFromId(e):e)&&null!=(t=Q("xv"+o+e._id))&&""!=t.innerHTML&&updateDeviceViewHtml(o,t,e)}function updateDeviceViewHtml(e,t,o){var n=EscapeHtml(o.name),i=(0==n.length&&(n="<i>Ninguno</i>"),null!=o.rname&&0<o.rname.length&&(n+=" / "+EscapeHtml(o.rname)),EscapeHtml(o.name));if(0==(i=1==showRealNames&&null!=o.rname?EscapeHtml(o.rname):i).length&&(i="<i>Ninguno</i>"),1==e&&"none"==t.parentNode.style.display||2==e&&"none"==t.style.display)t.innerHTML="";else{var a="",s="",r=(1==stars[o._id]&&(s+=2==e?"<img class=deviceNotifySmallDotSub src=images/icon-star-notify-10.png width=10 height=10>":"<img class=deviceNotifyDotSub src=images/icon-star-notify-16.png width=16 height=16>"),null!=o.sessions&&(null!=o.sessions.msg&&(s+=2==e?"<div onclick=showDeviceMessages('"+o._id+'\',null,event) style="width:10;height:10" class=deviceNotifySmallDotSub></div>':"<div onclick=showDeviceMessages('"+o._id+'\',null,event) style="width:16;height:16" class=deviceNotifyDotSub>'+Object.keys(o.sessions.msg).length+"</div>"),null==o.sessions.kvm&&null==o.sessions.terminal&&null==o.sessions.files&&null==o.sessions.tcp&&null==o.sessions.udp||(s+=2==e?"<img onclick=showDeviceSessions('"+o._id+"',null,event) class=deviceNotifySmallDotSub src=images/icon-relay-notify10.png width=10 height=10>":"<img onclick=showDeviceSessions('"+o._id+"',null,event) class=deviceNotifyDotSub src=images/icon-relay-notify.png width=16 height=16>"),null!=o.sessions.help&&(s+=2==e?"<img onclick=showDeviceHelpRequests('"+o._id+"',null,event) class=deviceNotifySmallDotSub src=images/icon-help-notify-10.png width=10 height=10>":"<img onclick=showDeviceHelpRequests('"+o._id+"',null,event) class=deviceNotifyDotSub src=images/icon-help-notify-16.png width=16 height=16>"),null!=o.sessions.battery)&&1==e&&(l="","ac"==(r=o.sessions.battery).state&&(l="El dispositivo está enchufado"),"dc"==r.state&&(l="El dispositivo funciona con batería"),c="",d=-1,"number"==typeof r.level&&0<=r.level&&r.level<=100&&(c=r.level+"%",5<(d=Math.floor((r.level+10)/25)+1)&&(lvl=5),"ac"==r.state)&&(100==r.level?d=11:d+=5),0<d)&&(a+='<div class="deviceBatterySmall deviceBatterySmall'+d+'" title="'+(null!=l?l+", "+c:c)+'"></div>'),""!=s&&(a+=2==e?"<div class=deviceNotifySmallDot>"+s+"</div>":"<div class=deviceNotifyDot>"+s+"</div>"),o.icon);if(o.conn&&0!=o.conn||3==o.mtype||(r+=" gray"),1==e)t.innerHTML='<table id=devs cmenu=devsContentMenu onmouseover=devMouseHover(this,1) onmouseout=devMouseHover(this,0) style=width:100%;height:100%><tr><td style=width:22px><input class="'+o.meshid+' DeviceCheckbox form-check-input me-2" onchange=p1devcheck(event) value=devid_'+o._id+" type=checkbox "+(checkedNodeids[o._id]?" checked":"")+"></td><td><table onmouseup=gotoDevice('"+o._id+"',null,null,event) border=0 cellspacing=0 style=width:100%;height:100%;cursor:pointer><tr><td style=width:50px tabindex=0 onkeypress=\"if (event.key=='Enter') gotoDevice('"+o._id+'\',null,null,event)"><div class="i'+r+'" style=width:50px></div></td><td class=g1t></td><td class=e2t><div class=e1t style=width:'+(t.clientWidth-120)+'px title="'+n+'">'+i+"</div><div>"+NodeStateStr(o)+"</div></td><td class=g2t></td></tr></table></td></tr></table>"+a;else if(2==e){var l,d=[],c=(o.conn&&(0!=(1&o.conn)&&(4==o.mtype?"PDU"==o.porttype?d.push('<span title="El puerto del conmutador está listo para usarse.">Cambiar</span>'):d.push('<span title="El puerto IP-KVM está conectado y listo para usar.">IP-KVM</span>'):d.push('<span title="El Agente Mesh está conectado y listo para ser utilizado.">Agente</span>')),0!=(2&o.conn)?d.push('<span title="Intel&reg; AMT CIRA está conectado y listo para usar.">CIRA</span>'):0!=(4&o.conn)&&d.push('<span title="Intel&reg; AMT es enrutable.">AMT</span>'),0!=(8&o.conn)&&d.push('<span title="Se puede alcanzar al Agente Mesh utilizando otro agente en modo Relay.">Relé</span>'),0!=(16&o.conn))&&d.push('<span title="La conexión MQTT al dispositivo está activa.">MQTT</span>'),3==o.mtype&&((l=meshes[o.meshid])&&l.relayid?d.push('<span title="Conexión de red local a través de un agente de retransmisión.">Relé</span>'):d.push('<span title="Conexión de red local.">Local</span>')),o.desc&&0<=deviceViewSettings.devsCols.indexOf("desc")&&(i='<div class="flex-grow-1">'+i+"</div><div style=float:right"+(1==stars[o._id]?";padding-right:15px":"")+">"+EscapeHtml(o.desc)+"</div>"),o.meshid),u=(1==sort?c="pwr:"+(o.pwr||0):3!=sort&&4!=sort||(c="tag:**xx**xx*TaG*xx**xx**"),CollapsedGroups[c],"<td style=position:relative><div id=devs cmenu=devsContentMenu class=bar18 tabindex=0 onmouseover=devMouseHover(this,1) onmouseout=devMouseHover(this,0) style=height:18px;width:100%;font-size:medium onkeypress=\"if (event.key=='Enter') gotoDevice('"+o._id+"',null,null,event)\">");if(u=(u=(u+='<div class=deviceBarCheckbox><input class="'+o.meshid+' DeviceCheckbox form-check-input me-2" value=devid_'+o._id+" type=checkbox onchange=p1devcheck(event) "+(checkedNodeids[o._id]?" checked":"")+"></div>")+("<div class=deviceBarIcon onmouseup=gotoDevice('"+o._id+"',null,null,event)><div class=\"j"+r+'" style=width:16px;margin-top:1px;margin-left:2px;height:16px></div></div>'))+"<div class=g1 style=height:18px;float:left></div><div class=g2 style=height:18px;float:right></div>"+('<div class="style10 d-flex align-items-center" style=cursor:pointer;font-size:14px;max-height:18px;text-overflow:ellipsis;overflow:hidden;white-space:nowrap title="'+n+"\" onmouseup=gotoDevice('"+o._id+"',null,null,event)>"+i+"</div></div>"+a+"</td>"),null==deviceViewSettings&&(deviceViewSettings={}),Array.isArray(deviceViewSettings.devsCols)||(deviceViewSettings.devsCols=["user","ip","conn"]),0<=deviceViewSettings.devsCols.indexOf("agtype")&&(u+='<td style=text-align:center;font-size:x-small;padding-left:4px;padding-right:4px title="'+EscapeHtml(3!=o.mtype&&o.agent&&o.agent.id&&o.agent.id<=agentsStr.length?agentsStr[o.agent.id]:"")+'">'+EscapeHtml(3!=o.mtype&&o.agent&&o.agent.id&&o.agent.id<=agentsStr.length?agentsStr[o.agent.id]:"").replace(",","<br />")),0<=deviceViewSettings.devsCols.indexOf("agver")&&(u+='<td style=text-align:center;font-size:x-small;padding-left:4px;padding-right:4px title="'+EscapeHtml(o.agent&&o.agent.core?o.agent.core:"")+'">'+EscapeHtml(o.agent&&o.agent.core?o.agent.core:"").replace(",","<br />")),0<=deviceViewSettings.devsCols.indexOf("os")&&(3==o.mtype?(s="",4==o.agent.id&&(s="Windows"),6==o.agent.id&&(s="Linux"),29==o.agent.id&&(s="MacOS"),u+='<td style=text-align:center;font-size:x-small title="'+EscapeHtml(s)+'">'+EscapeHtml(s)):u+='<td style=text-align:center;font-size:x-small title="'+EscapeHtml(o.osdesc||"")+'">'+EscapeHtml(o.osdesc||"")),0<=deviceViewSettings.devsCols.indexOf("tags")){u+="<td style=text-align:center;font-size:x-small>";var p="";if(null!=o.tags)for(var m in o.tags)p+="<span class=tagSpan>"+EscapeHtml(o.tags[m])+"</span> ";u+="<span style=line-height:20px>"+p+"</span>"}0<=deviceViewSettings.devsCols.indexOf("windowsav")&&(u+="<td style=text-align:center>"+(o.wsc&&null!=o.wsc.antiVirus?"OK"==o.wsc.antiVirus?"<span style=color:green>OK</span>":"<span style=color:red>MALO</span>":"")),0<=deviceViewSettings.devsCols.indexOf("windowsupdate")&&(u+="<td style=text-align:center>"+(o.wsc&&null!=o.wsc.autoUpdate?"OK"==o.wsc.autoUpdate?"<span style=color:green>OK</span>":"<span style=color:red>MALO</span>":"")),0<=deviceViewSettings.devsCols.indexOf("windowsfirewall")&&(u+="<td style=text-align:center>"+(o.wsc&&null!=o.wsc.firewall?"OK"==o.wsc.firewall?"<span style=color:green>OK</span>":"<span style=color:red>MALO</span>":"")),0<=deviceViewSettings.devsCols.indexOf("lastbootuptime")&&(u+="<td style=text-align:center;font-size:x-small>"+(null!=o.lastbootuptime?printDateTime(new Date(o.lastbootuptime)):"")),0<=deviceViewSettings.devsCols.indexOf("links")&&(u+="<td style=text-align:center;font-size:x-small>"+getShortRouterLinks(o)),0<=deviceViewSettings.devsCols.indexOf("user")&&(u+="<td style=text-align:center>"+getUserShortStr(o)),0<=deviceViewSettings.devsCols.indexOf("ip")&&(l="",3==o.mtype?l=o.host:o.ip&&(l=o.ip),u+="<td style=text-align:center>"+l),0<=deviceViewSettings.devsCols.indexOf("conn")&&(u+="<td style=text-align:center>"+d.join("&nbsp;+&nbsp;")),0<=deviceViewSettings.devsCols.indexOf("lastseen")&&(u+="<td style=text-align:center;font-size:x-small>",0<o.conn?u+="Conectado":null!=o.lastconnect&&(u+=printDateTime(new Date(o.lastconnect)))),0<=deviceViewSettings.devsCols.indexOf("amthost")&&(u+="<td style=text-align:center>"+(null==o.intelamt||null==o.intelamt.host?"":EscapeHtml(o.intelamt.host))),0<=deviceViewSettings.devsCols.indexOf("amtstate")&&(c="",o.intelamt&&(0==o.intelamt.state&&(c=' <span title="Intel&reg; AMT is not activated">Pre</span>'),1==o.intelamt.state&&(c=' <span title="Intel&reg; AMT is in activation mode">In</span>'),2==o.intelamt.state)&&o.intelamt.flags&&(2&o.intelamt.flags?c=' <span title="Intel&reg; AMT está activado en Modo de Control de Cliente (CCM)">CCM</span>':4&o.intelamt.flags&&(c+=' <span title="Intel&reg; AMT esta activado en Admin Control Mode (ACM)">ACM</span>')),u+="<td style=text-align:center>"+c),t.innerHTML=u}else if(3==e||5==e)return u="<div id=devs cmenu=devsContentMenu style=display:inline-block;position:relative;margin:1px;background-color:lightgray;border-radius:5px;position:relative><div tabindex=0 style=padding:3px;cursor:pointer onmouseup=gotoDevice('"+o._id+"',11,null,event) onkeypress=\"if (event.key=='Enter') gotoDevice('"+o._id+"',11,null,event)\">"+a,(u+='<div class="j'+r+'" style=width:16px;float:left></div>&nbsp;'+i+"</div>")+"<span onmouseup=gotoDevice('"+o._id+"',null,null,event)></span><div id=xkvmid_"+o._id.split("/")[2]+"><div id=skvmid_"+o._id.split("/")[2]+' tabindex=0 style="position:absolute;color:white;left:5px;top:27px;text-shadow:0px 0px 5px #000;z-index:10;cursor:default" onclick=toggleKvmDevice(\''+o._id+"') onkeypress=\"if (event.key=='Enter') toggleKvmDevice('"+o._id+"')\">Desconectado</div></div></div>"}}function getShortRouterLinks(e){var t="",o=GetNodeRights(e);if((0!=(1&e.conn)||3==e.mtype)&&e.agent&&0!=(8&o)&&14!=e.agent.id&&(0!=webRelayPort&&(t=(t+='<a href=# onclick=p10WebRouter("'+e._id+'",1,'+(e.httpport||80)+")>HTTP"+(e.httpport&&80!=e.httpport?"/"+e.httpport:"")+"</a>&nbsp;")+'<a href=# onclick=p10WebRouter("'+e._id+'",2,'+(e.httpsport||443)+")>HTTPS"+(e.httspport&&443!=e.httpsport?"/"+e.httpsport:"")+"</a>&nbsp;"),0<e.agent.id&&e.agent.id<5&&("win32"!=navigator.platform.toLowerCase()||null!=serverinfo.devicemeshrouterlinks&&0==serverinfo.devicemeshrouterlinks.rdp||(t+='<a href=# cmenu=altPortContextMenu id=rdpMCRouterLink onclick=p10MCRouter("'+e._id+'",3)>RDP</a>&nbsp;')),4<e.agent.id&&("win32"!=navigator.platform.toLowerCase()&&"macintel"!=navigator.platform.toLowerCase()||null!=serverinfo.devicemeshrouterlinks&&0==serverinfo.devicemeshrouterlinks.ssh||(t+='<a href=# onclick=p10MCRouter("'+e._id+'",4,'+(e.sshport||22)+")>SSH</a>&nbsp;"),"win32"!=navigator.platform.toLowerCase()||null!=serverinfo.devicemeshrouterlinks&&0==serverinfo.devicemeshrouterlinks.scp||(t+='<a href=# onclick=p10MCRouter("'+e._id+'",5,'+(e.sshport||22)+")>SCP</a>&nbsp;")),"win32"==navigator.platform.toLowerCase()||"macintel"==navigator.platform.toLowerCase())&&null!=serverinfo.devicemeshrouterlinks&&Array.isArray(serverinfo.devicemeshrouterlinks.extralinks))for(var n in serverinfo.devicemeshrouterlinks.extralinks){var n=serverinfo.devicemeshrouterlinks.extralinks[n],i='"'+n.protocol+'"';doesDeviceMatchFilterTags(e,n.filter)&&(3!=e.mtype||"mcrdesktop"!=n.protocol&&"mcrfiles"!=n.protocol)&&("number"==typeof n.protocol?i=n.protocol:"http"==n.protocol?i=1:"https"==n.protocol?i=2:"rdp"==n.protocol?i=3:"ssh"==n.protocol?i=4:"scp"==n.protocol?i=5:"mcrdesktop"==n.protocol?i=6:"mcrfiles"==n.protocol&&(i=7),t+='<a href=# onclick=p10MCRouter("'+e._id+'",'+i+","+n.port+(n.ip?',"'+n.ip+'"':",null")+","+(n.localport||0)+")>"+n.name+"</a>&nbsp;")}return t}function doesDeviceMatchFilterTags(e,t){if(null==t)return!0;if(Array.isArray(t)){if(0<=t.indexOf(e.meshid))return!0;if(0<=t.indexOf(e._id))return!0;if(Array.isArray(e.tags))for(var o in e.tags)if(0<=t.indexOf("tag:"+e.tags[o]))return!0}return!1}function showDeviceHelpRequests(e,t,o){if(o&&haltEvent(o),!xxdialogMode||t){var n=null,i="";if(null==(n=null==e?currentNode:getNodeFromId(e))||null==n.sessions)setDialogMode(0);else{if(null!=n.sessions.help)for(var a in n.sessions.help)i+='<div style="background-color:#CCC;padding:6px;border-radius:6px"><a style="float:right" onclick=closeDeviceHelpRequest("'+encodeURIComponentEx(a)+'","'+encodeURIComponentEx(n._id)+'")>Descartar</a><div style=margin-bottom:6px><b>'+EscapeHtml(a)+"</b></div><div style=margin-bottom:6px>"+EscapeHtml(n.sessions.help[a])+"</div></div>";""!=i&&(xxdialogTag="HELPREQ-"+n._id,setModalContent("xxAddAgent","Solicitudes de Ayuda - "+EscapeHtml(n.name),i),showModal("xxAddAgentModal","idx_dlgOkButton"))}}return!1}function closeDeviceHelpRequest(e,t){setDialogMode(0),meshserver.send({action:"msg",type:"localapp",nodeid:decodeURIComponent(t),appid:decodeURIComponent(e),value:{cmd:"cancelhelp"}})}function showDeviceSessions(e,t,o){if(o&&haltEvent(o),!xxdialogMode||t){var n=null,i="";if(null==(n=null==e?currentNode:getNodeFromId(e))||null==n.sessions)setDialogMode(0);else{for(var a in n.sessions)if("kvm"==a&&null==n.sessions.multidesk)for(var s in i+="<u>Escritorio Remoto</u>",n.sessions.kvm)s.startsWith("user/")?(r="",s!=userinfo._id&&4294967295!=GetNodeRights(n)||(r=' <i role=button onclick=\'return endDeviceSession("kvm", "'+encodeURIComponentEx(n._id)+'", "'+encodeURIComponentEx(s)+'")\' title="Desconectar esta sesión" class="fa-fw fa-solid fa-trash text-danger" ></i>'),i+=addHtmlValue2(getUserName(s),(1==n.sessions.kvm[s]?"1 sesión":nobreak(format("{0} sesiones",n.sessions.kvm[s])))+r)):"busy"==s&&(i+=addHtmlValue2("El dispositivo está ocupado",1==n.sessions.kvm[s]?"1 sesión":nobreak(format("{0} sesiones",n.sessions.kvm[s]))));else if("multidesk"==a)for(var s in i+="<u>Escritorio Remoto</u>",n.sessions.multidesk){var r="";s!=userinfo._id&&4294967295!=GetNodeRights(n)||(r=' <i role=button onclick=\'return endDeviceSession("multidesk", "'+encodeURIComponentEx(n._id)+'", "'+encodeURIComponentEx(s)+'")\' title="Desconectar esta sesión" class="fa-fw fa-solid fa-trash text-danger"></i>'),i+=addHtmlValue2(getUserName(s),(1==n.sessions.multidesk[s]?"1 sesión":nobreak(format("{0} sesiones",n.sessions.multidesk[s])))+r)}else if("terminal"==a)for(var s in i+="<u>Terminal</u>",n.sessions.terminal){r="";s!=userinfo._id&&4294967295!=GetNodeRights(n)||(r=' <i role=button onclick=\'return endDeviceSession("terminal", "'+encodeURIComponentEx(n._id)+'", "'+encodeURIComponentEx(s)+'")\' title="Desconectar esta sesión" class="fa-fw fa-solid fa-trash text-danger"></i>'),i+=addHtmlValue2(getUserName(s),(1==n.sessions.terminal[s]?"1 sesión":nobreak(format("{0} sesiones",n.sessions.terminal[s])))+r)}else if("files"==a)for(var s in i+="<u>Archivos</u>",n.sessions.files){r="";s!=userinfo._id&&4294967295!=GetNodeRights(n)||(r=' <i role=button onclick=\'return endDeviceSession("files", "'+encodeURIComponentEx(n._id)+'", "'+encodeURIComponentEx(s)+'")\' title="Desconectar esta sesión" class="fa-fw fa-solid fa-trash text-danger"></i>'),i+=addHtmlValue2(getUserName(s),(1==n.sessions.files[s]?"1 sesión":nobreak(format("{0} sesiones",n.sessions.files[s])))+r)}else if("tcp"==a)for(var s in i+="<u>Enrutamiento TCP</u>",n.sessions.tcp){r="";s!=userinfo._id&&4294967295!=GetNodeRights(n)||(r=' <i role=button onclick=\'return endDeviceSession("tcp", "'+encodeURIComponentEx(n._id)+'", "'+encodeURIComponentEx(s)+'")\' title="Desconectar esta sesión" class="fa-fw fa-solid fa-trash text-danger"></i>'),i+=addHtmlValue2(getUserName(s),(1==n.sessions.tcp[s]?"1 sesión":nobreak(format("{0} sesiones",n.sessions.tcp[s])))+r)}else if("udp"==a)for(var s in i+="<u>Enrutamiento UDP</u>",n.sessions.udp){r="";s!=userinfo._id&&4294967295!=GetNodeRights(n)||(r=' <i role=button onclick=\'return endDeviceSession("udp", "'+encodeURIComponentEx(n._id)+'", "'+encodeURIComponentEx(s)+'")\' title="Desconectar esta sesión" class="fa-fw fa-solid fa-trash text-danger"></i>'),i+=addHtmlValue2(getUserName(s),(1==n.sessions.udp[s]?"1 sesión":nobreak(format("{0} sesiones",n.sessions.udp[s])))+r)}""!=i?(xxdialogTag="SESSIONS-"+n._id,setModalContent("xxAddAgent","Sesiones - "+EscapeHtml(n.name),i),showModal("xxAddAgentModal","idx_dlgOkButton")):setDialogMode(0)}}return!1}function endDeviceSession(e,t,o){var o=decodeURIComponent(o).split("/"),n=o[0]+"/"+o[1]+"/"+o[2],i=null;4==o.length&&o[3].startsWith("guest:")&&(i=atob(o[3].substring(6))),"multidesk"==e?meshserver.send({action:"endDesktopMultiplex",nodeid:decodeURIComponent(t),xuserid:n,guestname:i,guestname:i}):meshserver.send({action:"msg",type:"endtunnel",nodeid:decodeURIComponent(t),xuserid:n,guestname:i,guestname:i,protocol:e})}function showDeviceMessages(e,t,o){if(o&&haltEvent(o),!xxdialogMode||t){var n=null,i="<div style=max-height:200px;overflow-y:auto>",a=0;if(null==(n=null==e?currentNode:getNodeFromId(e))||null==n.sessions||null==n.sessions.msg)setDialogMode(0);else{for(var s in n.sessions.msg){var r=s,l=5;"string"==typeof n.sessions.msg[s].msg&&(r=n.sessions.msg[s].msg),"number"==typeof n.sessions.msg[s].msgid&&null!=eventsMessageId[n.sessions.msg[s].msgid]&&(r=eventsMessageId[n.sessions.msg[s].msgid]),i+="<table style=width:96%><td style=width:24px><div class=NotifyIconSmall"+(l=(l="number"==typeof n.sessions.msg[s].icon?n.sessions.msg[s].icon:l)<1||9<l?5:l)+'></div><td><div style="border-radius:5px;background-color:#BBB;width:100%;padding:8px">'+EscapeHtml(r)+"</div></table>",a++}i+="</div>",0<a&&(xxdialogTag="MESSAGES-"+n._id,setModalContent("xxAddAgent","Mensajes del Agente - "+EscapeHtml(n.name),i),showModal("xxAddAgentModal","idx_dlgOkButton"))}}return!1}function toggleCollapseGroup(e,t,o){if(2==o){var n=document.getElementsByName("xxdevice2");if(0==n.length)return;for(var i,a=[],s=0;s<n.length;s++)n[s].attributes.colname.value.substring(7)==t&&a.push(n[s]);(i="none"==a[0].style.display)?delete CollapsedGroups[t]:CollapsedGroups[t]=!0;for(s=0;s<a.length;s++)a[s].style.display=i?"":"none"}else(i="none"==QS("DevxCol"+e).display)?delete CollapsedGroups[t]:CollapsedGroups[t]=!0,QV("DevxCol"+e,i);i?(QC("DevxColImg"+e).remove("fa-chevron-right"),QC("DevxColImg"+e).add("fa-chevron-down")):(QC("DevxColImg"+e).remove("fa-chevron-down"),QC("DevxColImg"+e).add("fa-chevron-right")),putstore("_collapse",JSON.stringify(CollapsedGroups)),updateCollapseAllButton(),onDevicesScrollEx(),onDevicesScrollEx()}function toggleKvmDevice(e){var t=GetNodeRights(e="string"==typeof e?getNodeFromId(e):e);(8&t||256&t)&&1&e.conn&&connectMultiDesktop(e,1)}function getUserShortStr(e){var t,o;return null!=e&&null!=e.users&&Array.isArray(e.users)&&0!=e.users.length?1<e.users.length?'<span title="'+EscapeHtml(e.users.join(", "))+'">'+nobreak(format("{0} usuarios",e.users.length))+"</span>":(0<(o=(t=e=e.users[0]).indexOf("\\"))&&(t=e.substring(o+1)),15<(t=EscapeHtml(t)).length&&(t=t.substring(0,14)+"&#8230;"),'<span title="'+EscapeHtml(e)+'">'+t+"</span>"):""}function autoConnectDesktops(){1==Q("autoConnectDesktopCheckbox").checked&&connectAllKvmFunction()}function connectAllKvmFunction(e){if(xxdialogMode)return!1;if(!0!==e){var o,t=0;for(a in nodes){var n=nodes[a],i=nodes[a]._id;null!=multiDesktop[i]||0!=Object.keys(checkedNodeids).length&&!checkedNodeids[i]||(8&(i=GetNodeRights(n))||256&i)&&1&n.conn&&1==n.v&&t++}if(8<t)return setModalContent("xxAddAgent","Conectar Todos",format("¿Estás seguro de que desea conectarse a {0} dispositivos?",t)),o=function(e,t){document.getElementById("xxAddAgentModal").removeEventListener("hide.bs.modal",o),Q("autoConnectDesktopCheckbox").checked=!1},document.getElementById("xxAddAgentModal").addEventListener("hide.bs.modal",o),void showModal("xxAddAgentModal","idx_dlgOkButton",()=>{document.getElementById("xxAddAgentModal").removeEventListener("hide.bs.modal",o),connectAllKvmFunction(!0)})}for(var a in nodes)1!=nodes[a].v||null!=multiDesktop[nodes[a]._id]||0!=Object.keys(checkedNodeids).length&&!checkedNodeids[nodes[a]._id]||toggleKvmDevice(nodes[a]._id)}function disconnectAllKvmFunction(){if(xxdialogMode)return!1;for(var e in multiDesktop)multiDesktop[e].Stop();multiDesktop={}}function onMultiDesktopStateChange(e,t){try{QH("skvmid_"+e.shortid,["Desconectado","Conectando....","Configurar...","",""][t])}catch(e){}}function onDeviceSearchChanged(e){var t=new URL(window.location.href);if(null==e||"SearchInput"!=e.target.id&&"KvmSearchInput"!=e.target.id?null!=e&&"DevFilterSelect"==e.target.id||(t.searchParams.delete("filter"),urlargs.filter&&delete urlargs.filter):("SearchInput"==e.target.id?Q("KvmSearchInput").value=Q("SearchInput").value:Q("SearchInput").value=Q("KvmSearchInput").value,""!=e.target.value?(t.searchParams.set("filter",e.target.value),urlargs.filter&&(urlargs.filter=e.target.value)):(t.searchParams.delete("filter"),urlargs.filter&&delete urlargs.filter)),0==(268435456&features)&&0<xxcurrentView)try{window.history.replaceState({},document.title,decodeURIComponent(t.toString()))}catch(e){}mainUpdate(5)}function showMultiDesktopSettings(){QV("td7amtkvm",!1),QV("td7meshkvm",!0),QV("td7rdpkvm",!1),QV("d7desktopOtherSettings",!1),d7bitmapquality.value=multidesktopsettings.quality,d7bitmapscaling.value=multidesktopsettings.scaling,d7encoding.value=multidesktopsettings.agentencoding,multidesktopsettings.framerate?d7framelimiter.value=multidesktopsettings.framerate:d7framelimiter.value=100,setModalContent("xxAddAgent","Opciones de Escritorio Remoto",x),showModal("xxAddAgentModal","idx_dlgOkButton",()=>showMultiDesktopSettingsChanged())}function showMultiDesktopSettingsChanged(){for(var e in multidesktopsettings.quality=d7bitmapquality.value,multidesktopsettings.scaling=d7bitmapscaling.value,multidesktopsettings.framerate=d7framelimiter.value,multidesktopsettings.agentencoding=d7encoding.value,localStorage.setItem("multidesktopsettings",JSON.stringify(multidesktopsettings)),multiDesktop)multiDesktop[e].m.SendCompressionLevel(multidesktopsettings.agentencoding,multidesktopsettings.quality,multidesktopsettings.scaling,multidesktopsettings.framerate)}function connectMultiDesktop(e,t){var o=e._id,n=o.split("/")[2],i=multiDesktop[o];null==i?null!=Q("kvmid_"+n)&&(2==t?null!=e.intelamt.user&&""!=e.intelamt.user&&((i=CreateAmtRedirect(CreateAmtRemoteDesktop("kvmid_"+n),authCookie)).shortid=n,i.onStateChanged=onMultiDesktopStateChange,i.m.bpp=1,i.m.useZRLE=!0,i.m.showmouse=!0,i.m.onKvmData=function(e){console.log("KVM Data received in multi-desktop mode, this is not supported.")},i.m.onScreenSizeChange=mdeskAdjust,i.Start(o,16994,"*","*",0),i.contype=2,multiDesktop[o]=i):1==t&&((i=CreateAgentRedirect(meshserver,CreateAgentRemoteDesktop("kvmid_"+n),serverPublicNamePort,authCookie,authRelayCookie,domainUrl)).m.UseExtendedKeyFlag=e.agent.id<5,i.m.mouseCursorActive(11==xxcurrentView),i.shortid=n,i.attemptWebRTC=attemptWebRTC,i.webrtcconfig=webrtcconfiguration,i.onStateChanged=onMultiDesktopStateChange,i.m.ImageType=multidesktopsettings.agentencoding,i.m.CompressionLevel=multidesktopsettings.quality,i.m.ScalingLevel=multidesktopsettings.scaling,multidesktopsettings.framerate&&(i.m.FrameRateTimer=multidesktopsettings.framerate),multidesktopsettings.swapmouse&&(i.m.SwapMouse=multidesktopsettings.swapmouse),multidesktopsettings.rmw&&(i.m.ReverseMouseWheel=multidesktopsettings.rmw),1==multidesktopsettings.remotekeymap&&(i.m.remoteKeyMap=multidesktopsettings.remotekeymap),i.m.onScreenSizeChange=mdeskAdjust,i.Start(o),i.contype=1,multiDesktop[o]=i)):(i.Stop(),delete multiDesktop[o])}function getMeshActions(e,t){return 0==(4&t)?"":(t="",1==e.mtype&&(0==(1&features)&&(t=(t+=' <a href=# role="button" title="Agrega una nueva computadora Intel&reg; AMT localizada en la red Local." onclick=\'return addDeviceToMesh("'+e._id+"\")'>Agregar Local</a>")+' <a href=# role="button" title="Agrega una nueva computadora Intel&reg; AMT escaneando la red Local." onclick=\'return addAmtScanToMesh("'+e._id+"\")'>Escanear Red</a>"),e.amt)&&0<e.amt.type&&(t+=' <a href=# role="button" title="Realizar la activación y configuración de Intel&reg; AMT." onclick=\'return showAmtSetup("'+e._id+"\")'>Preparar</a>"),2!=e.mtype||4294967295!=userinfo.siteadmin&&0!=(4096&userinfo.siteadmin)||(t+=' <a href=# role="button" title="Agrega una nueva computadora a este grupo de dispositivos instalando el Agente Mesh." onclick=\'return addAgentToMesh("'+e._id+"\")'>Agregar Agente</a>",0==(2&features)&&(t+=' <a href=# role="button" title="Invita a alguien a instalar el Agente Mesh en este grupo de dispositivos." onclick=\'return inviteAgentToMesh("'+e._id+"\")'>Invitar</a>")),3==e.mtype&&(t+=' <a href=# role="button" title="Agrega un dispositivo ubicado en la red local." onclick=\'return addLocalDeviceToMesh("'+e._id+"\")'>Agregar Dispositivo</a>"),t)}function addLocalDeviceToMesh(e){if(xxdialogMode)return!1;var t=meshes[e],t=format('Agrega un dispositivo local al grupo de dispositivos "{0}".',EscapeHtml(t.name))+"<br /><br />";setModalContent("xxAddAgent","Agregar dispositivo local",(t+=addHtmlFormFloating("Nombre del Dispositivo","<input id=dp1devicename class=form-control maxlength=32 autocomplete=off onchange=validateLocalDeviceToMesh() onkeyup=validateLocalDeviceToMesh() />"))+addHtmlFormFloating("Nombre de Host",'<input id=dp1hostname class=form-control maxlength=32 autocomplete=off placeholder="Igual que el nombre del dispositivo" onchange=validateLocalDeviceToMesh() onkeyup=validateLocalDeviceToMesh() />')+addHtmlFormFloating("Tipo","<select id=dp1type class=form-select><option value=4>Windows (RDP)</option><option value=6>Linux (SSH / SCP / VNC)</option><option value=29>macOS (SSH / SCP / VNC)</option></select>")),showModal("xxAddAgentModal","idx_dlgOkButton",()=>addLocalDeviceToMeshEx(3,e)),validateLocalDeviceToMesh(),Q("dp1devicename").focus()}function validateLocalDeviceToMesh(){QE("idx_dlgOkButton",0<Q("dp1devicename").value.length)}function addLocalDeviceToMeshEx(e,t){var o=Q("dp1hostname").value;""==o&&(o=Q("dp1devicename").value),meshserver.send({action:"addlocaldevice",meshid:t,devicename:Q("dp1devicename").value,hostname:o,type:parseInt(Q("dp1type").value)})}function addDeviceToMesh(e){var t;return xxdialogMode||(t=meshes[e],t=format('Agrega un nuevo dispositivo Intel&reg; AMT al grupo de dispositivos "{0}".',EscapeHtml(t.name))+"<br /><br />",setModalContent("xxAddAgent","Agregar dispositivo Intel&reg; AMT",t=(t=(t=(t=(t+=addHtmlFormFloating("Nombre del Dispositivo",'<input id=dp1devicename class="form-control" maxlength=32 autocomplete=off onchange=validateDeviceToMesh() onkeyup=validateDeviceToMesh() />'))+addHtmlFormFloating("Nombre de Host",'<input id=dp1hostname class="form-control" maxlength=32 autocomplete=off placeholder="Igual que el nombre del dispositivo" onchange=validateDeviceToMesh() onkeyup=validateDeviceToMesh() />'))+addHtmlFormFloating("Nombre de Usuario",'<input id=dp1username class="form-control" maxlength=32 autocomplete=off placeholder="administrador" onchange=validateDeviceToMesh() onkeyup=validateDeviceToMesh() />'))+addHtmlFormFloating("Contraseña",'<input id=dp1password type=password class="form-control" autocomplete=off maxlength=32 onchange=validateDeviceToMesh() onkeyup=validateDeviceToMesh() />'))+addHtmlFormFloating("Seguridad",'<select id=dp1tls class="form-select"><option value=0>Sin Seguridad TLS</option><option value=1>Seguridad TLS requerida</option></select>')),showModal("xxAddAgentModal","idx_dlgOkButton",()=>addDeviceToMeshEx(3,e)),validateDeviceToMesh(),Q("dp1devicename").focus()),!1}function showAmtImport(e){xxdialogMode||(setModalContent("xxAddAgent","Importacion de dispositivos Intel&reg; AMT.",'Crea muchos dispositivos Intel&reg; AMT al mismo tiempo importando un archivo JSON con el siguiente formato:<br /><pre>[\r\n  {\r\n    "fqdn":"mycomputer.com",\r\n    "uuid":"xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx",\r\n    "version":"12.0.1",\r\n    "username":"admin",\r\n    "password":"password",\r\n    "tls":true\r\n  }\r\n]</pre><input type=file id=d4importFile class="form-control" accept=".json" onchange=showAmtImportValidate() />'),showModal("xxAddAgentModal","idx_dlgOkButton",()=>showAmtImportEx(3,e)),QE("idx_dlgOkButton",!1))}function showAmtImportValidate(){QE("idx_dlgOkButton",null!=Q("d4importFile").value)}function showAmtImportEx(e,o){var t=new FileReader;t.onload=function(e){var t=null;try{t=JSON.parse(e.target.result)}catch(e){return setModalContent("xxAddAgent","Importacion de dispositivos Intel&reg; AMT.",format("Archivo JSON inválido: {0}.",e)),void showModal("xxAddAgentModal","idx_dlgOkButton")}null!=t?meshserver.send({action:"importamtdevices",meshid:o,amtdevices:t}):(setModalContent("xxAddAgent","Importacion de dispositivos Intel&reg; AMT.","Formato de Archivo JSON no válido."),showModal("xxAddAgentModal","idx_dlgOkButton"))},t.readAsText(Q("d4importFile").files[0])}function showAmtSetup(e){var t,o;return xxdialogMode||(t=serverinfo.name,o=meshes[e],-1!=t.indexOf(".")&&0==(2&features)||(t=window.location.hostname),domainUrl.substring(0,domainUrl.length-1),t=1==serverinfo.https?"wss://"+t+(443==serverinfo.port?"":":"+serverinfo.port)+domainUrl:"ws://"+t+(80==serverinfo.port?"":":"+serverinfo.port)+domainUrl,o=format('Agrega, activa y configura Intel&reg; AMT en el grupo "{0}" ejecutando periódicamente MeshCmd como administrador en el dispositivo remoto.',EscapeHtml(o.name))+"<br /><br />",o+="<textarea readonly=readonly style=width:100%;resize:none;height:100px;overflow:auto;font-size:12px readonly>meshcmd amtconfig --url "+t+"apf.ashx --id '"+e.split("/")[2]+"' --serverhttpshash "+serverinfo.tlshash+"</textarea>",null!=serverinfo.amtAcmFqdn&&(o+="<div style=margin-top:8px>Para la activación de ACM, Intel&reg; AMT deberá configurarse con el siguiente FQDN de confianza: <b>"+serverinfo.amtAcmFqdn.join(", ")+"</b></div>"),setModalContent("xxAddAgent","Configuración de Intel&reg; AMT",o),showModal("xxAddAgentModal","idx_dlgOkButton"),Q("idx_dlgOkButton").focus()),!1}function showAmtAcmSetup(){if(xxdialogMode)return!1;var e="<table><tr><td><img src=images/usbkey70.png height=70 width=31 style=margin-left:4px;margin-right:8px><td><div>Active Intel&reg; AMT en el modo de control de administrador (ACM) mediante una llave USB formateada FAT. Coloque setup.bin en él e inicie una o más computadoras con esta clave.</div><div style=margin-top:6px>Comienza ingresando la contraseña MBEx nueva y anterior.</div></table>",e=(e=(e+=addHtmlFormFloating("Contraseña Anterior",'<input id=dp1password0 type=password class="form-control" autocomplete=off maxlength=32 onchange=validateAmtAcmSetupEx() onkeyup=validateAmtAcmSetupEx() />'))+addHtmlFormFloating("Nueva Contraseña*",'<input id=dp1password1 type=password class="form-control" autocomplete=off maxlength=32 onchange=validateAmtAcmSetupEx() onkeyup=validateAmtAcmSetupEx() />'))+addHtmlFormFloating("Nueva Contraseña*",'<input id=dp1password2 type=password class="form-control" autocomplete=off maxlength=32 onchange=validateAmtAcmSetupEx() onkeyup=validateAmtAcmSetupEx() />');32&features2&&1==currentMesh.mtype&&serverinfo.amtProvServerMeshId==currentMesh._id&&(e+='<label><input id=dp1lanprov type=checkbox class="form-check-input me-2" /> Úselo para la activación de LAN completa.</label>'),setModalContent("xxAddAgent","Intel&reg; AMT ACM",e+='<div><span id=dp10passNotify style="font-size:10px"> * 8-16 caracteres, 1 superior, 1 inferior, 1 numérico, 1 no alfanumérico.</span></div>'),showModal("xxAddAgentModal","idx_dlgOkButton",showAmtAcmSetupEx),Q("dp1password0").focus(),validateAmtAcmSetupEx()}function validateAmtAcmSetupEx(){var e=Q("dp1password0").value,t=Q("dp1password1").value,o=Q("dp1password2").value,n=!0;"admin"!=e&&0==checkPasswordRequirements(e,{min:8,max:16,numeric:1,lower:1,upper:1,nonalpha:1})&&(n=!1),t==o&&0!=checkPasswordRequirements(t,{min:8,max:16,numeric:1,lower:1,upper:1,nonalpha:1})||(n=!1),QE("idx_dlgOkButton",n)}function showAmtAcmSetupEx(){meshserver.send({action:"amtsetupbin",oldmebxpass:Q("dp1password0").value,newmebxpass:Q("dp1password1").value,baremetal:32&features2&&Q("dp1lanprov").checked})}function addAmtScanToMesh(e){return xxdialogMode||(setModalContent("xxAddAgent","Escanear en busca de dispositivos Intel&reg; AMT","Ingresa un rango de direcciones IP para buscar dispositivos Intel&reg; AMT.<br /><br />"+addHtmlValue("Rango de IP",'<table style=width:250px><tr><td style=width:99%><input id=dp1range style=width:100% list=iprangelist value="192.168.1.0/24" onkeyup=addAmtScanToMeshKeyUp(event) /><td style=width:1%><input id=dp1rangebutton type=button value="Escanear" onclick=addAmtScanToMeshButton()></input></tr></table>')+'<div id=dp1results style="width:100%;height:200px;background-color:white;border:1px gray solid;overflow-y:scroll"></div>'+('<input type=hidden id=amtScanMeshId value="'+(xxdialogTag=e)+'" />')+'<div style="padding:10px;margin-bottom:5px"><input id="idx_dlgCancelButton2" type="button" value="Cancelar" style="" onclick="dialogclose(0)" /><input id="idx_dlgOkButton2" type="button" value="OK" style="" onclick="dialogclose(1)" /><div><input id="d2scanSelectButton" type="button" value="Seleccionar Todo" onclick="scanSelectAll()" /></div></div>'),showModal("xxAddAgentModal","idx_dlgOkButton",addAmtScanToMeshEx),QE("idx_dlgOkButton2",!1),QE("d2scanSelectButton",!1),QH("dp1results","<div style=width:100%;text-align:center;margin-top:12px;color:gray;line-height:1.5>Valores de rango de IP de muestra<br />192.168.0.100<br />192.168.1.0/24<br />192.167.0.1-192.168.0.100</div>"),focusTextBox("dp1range"),addAmtScanToMeshKeyUp()),!1}function scanSelectAll(){for(var e=document.getElementsByClassName("DevScanCheckbox"),t=0;t<e.length;t++)e[t].checked=!0;addAmtScanToMeshCheckbox()}function addAmtScanToMeshKeyUp(e){QE("dp1rangebutton",3<Q("dp1range").value.split(".").length),e&&13==e.keyCode&&(haltEvent(e),addAmtScanToMeshButton())}function addAmtScanToMeshEx(e){for(var t,o,n=document.getElementsByClassName("DevScanCheckbox"),i=0;i<n.length;i++)n[i].checked&&(t=n[i].getAttribute("tag"),o=(t=amtScanResults[t]).hostname,"host"==t.hosttype&&(o=capitalizeFirstLetter(o.split(".")[0])),meshserver.send({action:"addamtdevice",meshid:Q("amtScanMeshId").value,devicename:o,hostname:t.hostname,amtusername:"",amtpassword:"",amttls:t.tls}))}function addAmtScanToMeshButton(){var e=Q("dp1range").value.trim(),t=e.split(" ");""!=(e=(e=1<t.length?t[t.length-1]:e).trim())&&(QE("dp1range",!1),QE("dp1rangebutton",!1),QH("dp1results","<div style=width:100%;text-align:center;margin-top:20px>Escaneando...</div><div style=width:100%;text-align:center;margin-top:6px;color:#666>"+e+"</div>"),xxdialogTag="AMTSCAN:"+e,meshserver.send({action:"scanamtdevice",range:e}))}function addAmtScanToMeshCheckbox(){for(var e=document.getElementsByClassName("DevScanCheckbox"),t=0,o=0;o<e.length;o++)e[o].checked&&t++;QE("idx_dlgOkButton2",0<t)}function checkEmail(e){var e=e.split("@"),t=2==e.length&&0<e[0].length&&1<e[1].split(".").length&&2<e[1].length;if(1==t){var o,n=e[1].split(".");for(o in n)0==n[o].length&&(t=!1)}return t}function inviteAgentToMesh(e){var t,o;return xxdialogMode||(t="",o=meshes[e],64&features&&(t=(t=(t=(t=(t=(t=(t=(t+=addHtmlFormFloating("Tipo de Invitación","<select id=d2InviteType onchange=d2ChangedInviteType() class=form-select><option value=0>Enlace de invitación</option><option value=1>Invitación por correo electrónico</option></select>")+"<hr />")+"<div id=emailInviteDiv style=display:none>"+format('Invita a alguien a instalar el Agente Mesh. Se enviará un correo electrónico con el enlace a la instalación del agente de mesh para el grupo de dispositivos "{0}".',EscapeHtml(o.name))+"<br /><br />")+addHtmlFormFloating("Nombre (opcional)",'<input id=agentInviteName value="" placeholder="Name (optional)" class="form-control" maxlength=64 />'))+addHtmlFormFloating("Correo electrónico",'<input id=agentInviteEmail placeholder="ejemplo@email.com" class="form-control" onkeyup=validateAgentInvite() />'))+addHtmlFormFloating("Sistema Operativo","<select id=agentInviteNameOs onchange=d2ChangedInviteType() class=form-select><option value=4>Enviar enlace de instalación</option><option value=0 selected>Cualquiera soportado</option><option value=1>Sólo Windows</option><option value=3>Sólo Apple macOS</option><option value=2>Solo Linux</option><option value=5>Asistente MeshCentral</option></select>")+"<div id=d2agentexpirediv>")+addHtmlFormFloating("Expiración del Enlace","<select id=agentInviteExpire class=form-select><option value=1>1 hora</option><option value=8>8 horas</option><option value=24>1 dia</option><option value=168>1 semana</option><option value=5040>1 mes</option><option value=0>Ilimitado</option></select>")+"</div><div id=d2agentInstallTypeDiv2>")+addHtmlFormFloating("Tipo de Instalación","<select id=agentInviteType class=form-select><option value=0>Segundo plano e interactivo</option><option value=2>Segundo plano solamente</option><option value=1>Sólo Interactivo</option></select>")+"</div>")+addHtmlFormFloating("Mensaje (opcional)",'<textarea id="agentInviteMessage" class="form-control" style="height:100px;resize:none;" maxlength="1024"></textarea>')+"</div>"),t=(t=(t=(t+="<div id=urlInviteDiv>"+format('Invita a alguien a instalar el Agente Mesh compartiendo un enlace de invitación. Este enlace le indica al usuario las instrucciones de instalación para el grupo de dispositivos "{0}". El enlace es público y no se necesita una cuenta para este servidor.',EscapeHtml(o.name))+"<br /><br />")+addHtmlFormFloating("Expiración del Enlace","<select id=d2inviteExpire class=form-select onchange=d2RequestInvitationLink()><option value=1>1 hora</option><option value=8>8 horas</option><option value=24>1 dia</option><option value=168>1 semana</option><option value=5040>1 mes</option><option value=0>Ilimitado</option></select>"))+addHtmlFormFloating("Agentes","<select id=d2agentType class=form-select onchange=d2ChangedInviteType()><option value=0>Todos los agentes disponibles</option><option value=1>Agente de malla de Windows</option><option value=2>Agente de malla de Linux</option><option value=4>Agente de malla de macOS</option><option value=8>Asistente MeshCentral</option><option value=16>Android MeshAgent</option></select>")+"<div id=d2agentInstallTypeDiv>")+addHtmlFormFloating("Tipo de Instalación","<select id=d2agentInviteType class=form-select onchange=d2RequestInvitationLink()><option value=0>Segundo plano e interactivo</option><option value=2>Segundo plano solamente</option><option value=1>Sólo Interactivo</option></select>"),xxdialogTag=e,setModalContent("xxAddAgent","Invitar",t=t+"</div>"+'<div id=agentInvitationLinkDiv style="text-align:center;font-size:large;margin:16px;display:none"><a href=# id=agentInvitationLink rel="noreferrer noopener" target="_blank" style=cursor:pointer></a> <img src=images/link4.png height=10 width=10 title="Copiar enlance al portapapeles" style=cursor:pointer onclick=d2CopyInviteToClip()></div></div>'),showModal("xxAddAgentModal","idx_dlgOkButton",function(){performAgentInvite(3,e)}),(64&features?(Q("d2InviteType").focus(),d2ChangedInviteType):(Q("d2inviteExpire").focus(),validateAgentInvite))(),d2RequestInvitationLink()),!1}function d2RequestInvitationLink(){meshserver.send({action:"createInviteLink",meshid:xxdialogTag,expire:parseInt(Q("d2inviteExpire").value),flags:parseInt(Q("d2agentInviteType").value),agents:parseInt(Q("d2agentType").value)})}function d2ChangedInviteType(){64&features&&(QV("urlInviteDiv",0==Q("d2InviteType").value),QV("d2agentexpirediv",4==Q("agentInviteNameOs").value),QV("d2agentInstallTypeDiv2",Q("agentInviteNameOs").value<2),QV("emailInviteDiv",1==Q("d2InviteType").value)),QV("d2agentInstallTypeDiv",parseInt(Q("d2agentType").value)<2),validateAgentInvite(),d2RequestInvitationLink()}function d2CopyInviteToClip(){copyTextToClip(Q("agentInvitationLink").href)}function d2CopySecretToClip(){copyTextToClip(Q("d2optsecret").getAttribute("secret"))}function validateAgentInvite(){64&features&&1==Q("d2InviteType").value?(QE("idx_dlgOkButton",checkEmail(Q("agentInviteEmail").value)),QV("idx_dlgCancelButton",!0)):(QE("idx_dlgOkButton",!0),QV("idx_dlgCancelButton",!1))}function performAgentInvite(e,t){64&features&&1==Q("d2InviteType").value&&meshserver.send({action:"inviteAgent",meshid:t,email:Q("agentInviteEmail").value,name:Q("agentInviteName").value,os:Q("agentInviteNameOs").value,flags:Q("agentInviteType").value,msg:Q("agentInviteMessage").value,expire:parseInt(Q("agentInviteExpire").value)})}function addAgentToMesh(e){if(!xxdialogMode){var t,o=meshes[e],n="",i="",a="<select id=aginsSelect onchange=addAgentToMeshClick() class=form-select><option value=0>Windows</option><option value=1>Linux / BSD</option><option value=5>Instalador Binario para Linux / BSD / macOS</option><option value=2>Apple macOS</option>",a=(0==(2&features)&&(a+="<option value=6>Dispositivo móvil</option>"),n+=addHtmlFormFloating("Sistema Operativo",a=a+"<option value=7>Asistente MeshCentral</option>"+"<option value=3>Windows (DesInstalar)</option><option value=4>Linux / BSD (DesInstalar)</option><option value=8>Apple macOS (UnInstall)</option></select>"),serverinfo.name),s=(-1!=a.indexOf(".")&&0==(2&features)||(a=window.location.hostname),domainUrl.substring(0,domainUrl.length-1)),r="",r=1==serverinfo.https?443==serverinfo.port?"":":"+serverinfo.port:80==serverinfo.port?"":":"+serverinfo.port,l=[6,5,10005,25,26,28,30,32,36,37,40,41,16,29],d={6:"Linux x86-64",5:"Linux x86-32",10005:"Apple OSX Universal",25:"Linux ARM-HF, Rasberry Pi",26:"Linux ARM64-HF",28:"Linux MIPS24KC (OpenWRT)",30:"FreeBSD x86-64",32:"Linux ARM 64 bit (glibc/2.24 NOKVM)",36:"OpenWRT x86-64",37:"OpenBSD x86-64",40:"Linux MIPSEL24KC (OpenWRT)",41:"ARMADA/CORTEX-A53/MUSL (OpenWRT)",16:"Apple macOS x86-64",29:"Apple macOS ARM-64"};for(t in l)i+='<option value="'+l[t]+'">'+d[l[t]]+"</option>";n=(n=(n=(n=(n+='<div id="aginsSysTypeDiv">')+addHtmlFormFloating("Tipo de Sistema",'<select id="aginsSysType" onchange="addAgentToMeshClick()"  class="form-select">'+i+"</select>"))+"</div>"+'<div id="aginsTypeDiv">')+addHtmlFormFloating("Tipo de Instalación",'<select id="aginsType" onchange="addAgentToMeshClick()" class="form-select"><option value="0">Segundo plano & interactivo</option><option value="2">Segundo plano solamente</option><option value="1">Sólo Interactivo</option></select>')+'</div><div id="asinsTypeDiv">')+addHtmlFormFloating("Tipo de Instalación",'<select id="asinsType" onchange="addAgentToMeshClick()" class="form-select"><option value="2">Aplicación, Conectar a petición del usuario</option><option value="3">Aplicación, Siempre Conectada</option><option value="0">Bandeja del Sistema, Conectar con el consentimiento del usuario</option><option value="1">Bandeja del Sistema, Siempre conectada</option><option value="4">Bandeja del Sistema, Solo Monitoriear</option></select>')+"</div><hr>",o.name.split("\\").join("").split("/").join("").split(":").join("").split("*").join("").split("?").join("").split('"').join("").split("<").join("").split(">").join("").split("|").join("").split(" ").join("").split("'").join("");n=(n=(n=(n+="<div id=agins_windows>"+format('Para agregar una nueva computadora al grupo de dispositivos "{0}", descarga el agente MeshCentral e instálalo en la computadora a administrar. Este agente tiene la información del servidor y grupo de dispositivos incrustada dentro de él.',EscapeHtml(o.name))+"<br /><br />")+addHtmlValue("Agente Mesh",'<a class=text-decoration-underline id=aginsw32lnk name="meshagents?id=3&meshid='+e.split("/")[2]+"&installflags=0"+(urlargs.key?"&key="+urlargs.key:"")+'" title="version x86 32bit del MeshAgent">Windows x86-32 (.exe)</a> <i class="fa-regular fa-clipboard" title="Copiar el URL del agente x86 32bit a la papelera" style=cursor:pointer onclick=copyAgentUrl("meshagents?id=3&meshid='+e.split("/")[2]+'&installflags=",1)></i>',["col-md-4","col-md-8"]))+addHtmlValue("Agente Mesh",'<a class=text-decoration-underline id=aginsw64lnk name="meshagents?id=4&meshid='+e.split("/")[2]+"&installflags=0"+(urlargs.key?"&key="+urlargs.key:"")+'" title="version x86 64bit del MeshAgent">Windows x86-64 (.exe)</a> <i class="fa-regular fa-clipboard" title="Copiar el URL del agente Windows x86 64bit a la papelera" style=cursor:pointer onclick=copyAgentUrl("meshagents?id=4&meshid='+e.split("/")[2]+'&installflags=",1)></i>',["col-md-4","col-md-8"]))+addHtmlValue("Agente Mesh",'<a class=text-decoration-underline id=aginswa64lnk name="meshagents?id=43&meshid='+e.split("/")[2]+"&installflags=0"+(urlargs.key?"&key="+urlargs.key:"")+'" title="Version ARM 64bit de el MeshAgent">Windows ARM-64 (.exe)</a> <i class="fa-regular fa-clipboard" title="Copiar el URL del agente Windows ARM 64bit a la papelera" style=cursor:pointer onclick=copyAgentUrl("meshagents?id=43&meshid='+e.split("/")[2]+'&installflags=",1)></i>',["col-md-4","col-md-8"]),0<debugmode&&(n+=addHtmlValue("Archivo de Opciones",'<a id=aginswmshlnk name="meshsettings?id='+e.split("/")[2]+"&installflags=0"+(urlargs.key?"&key="+urlargs.key:"")+'">'+format("{0} opciones (.msh)",EscapeHtml(o.name))+"</a>")),setModalContent("xxAddAgent","Agregar Mesh Agent",n=(n=(n=(n=(n=(n=(n=(n=(n=(n=(n=(n=(n=(n=(n=(n=(n=(n=(n=(n=(n=(n=(n=(n=(n+="</div>")+("<div id=agins_linux style=display:none>"+format('Para agregar una computadora a "{0}" ejecuta el siguiente comando. Se necesitarán credenciales de root.',EscapeHtml(o.name))+"<br />"))+"<textarea id=agins_linux_area rows=2 cols=20 readonly=readonly style=border-radius:4px;padding:6px;margin-top:4px;margin-bottom:4px;border:0;width:100%;resize:none;height:160px;overflow:auto;font-size:12px class=form-control></textarea>"+'<div style=font-size:x-small;float:right>* Para BSD, ejecute primero "pkg install wget sudo bash".</div><a style=text-decoration:none title="Copiar al portapapeles" onclick=copyAgentIdValue("agins_linux_area")>Copiar <i class="fa-regular fa-clipboard" style=cursor:pointer></i></a></div>')+("<div id=agins_osx style=display:none>"+format('Para agregar una nueva computadora al grupo de dispositivos "{0}", descarga el agente de malla e instálalo en la computadora a administrar. Este instalador del agente tiene la información del servidor y grupo de dispositivos incrustada dentro de él.',EscapeHtml(o.name))+"<br /><br />"))+addHtmlValue("Agente Mesh",'<a class=text-decoration-underline onclick=downloadFile("meshosxagent?id=16&meshid='+e.split("/")[2]+(urlargs.key?"&key="+urlargs.key:"")+'") title="x86-64bit version of macOS Mesh Agent">macOS x86-64bit</a> <i class="fa-regular fa-clipboard" title="Copiar URL del Agente para macOS al portapapeles" style=cursor:pointer onclick=copyAgentUrl("meshosxagent?id=16&meshid='+e.split("/")[2]+'",0)></i>',["col-md-4","col-md-8"]))+addHtmlValue("Agente Mesh",'<a class=text-decoration-underline onclick=downloadFile("meshosxagent?id=29&meshid='+e.split("/")[2]+(urlargs.key?"&key="+urlargs.key:"")+'") title="ARM 64bit version of macOS Mesh Agent">macOS ARM (64bit)</a> <i class="fa-regular fa-clipboard" title="Copiar URL del Agente para macOS al portapapeles" style=cursor:pointer onclick=copyAgentUrl("meshosxagent?id=29&meshid='+e.split("/")[2]+'",0)></i>',["col-md-4","col-md-8"]))+addHtmlValue("Agente Mesh",'<a class=text-decoration-underline onclick=downloadFile("meshosxagent?id=10005&meshid='+e.split("/")[2]+(urlargs.key?"&key="+urlargs.key:"")+'") title="Universal version of macOS Mesh Agent">macOS (Universal)</a> <i class="fa-regular fa-clipboard" title="Copiar URL del Agente para macOS al portapapeles" style=cursor:pointer onclick=copyAgentUrl("meshosxagent?id=10005&meshid='+e.split("/")[2]+'",0)></i>',["col-md-4","col-md-8"])+"</div>")+('<div id=agins_qrcode style=display:none;min-height:180px><a id=agins_qrimage_a rel="noreferrer noopener" target=_blank><div id=agins_qrimage style=float:right;margin-left:10px;width:180px;height:180px;cursor:pointer></div></a><div>'+format('Para agregar un dispositivo móvil al grupo "{0}", descarga la aplicación MeshAgent y escana éste código QR.',EscapeHtml(o.name))+"</div>"))+"<table style=width:180px>"+'<tr><td style=text-align:center><a title="Google Play Store"rel="noreferrer noopener" target=_blank href="https://play.google.com/store/apps/details?id=com.meshcentral.agent2"><img style=cursor:pointer src="images/google-play-140.png" width=140 srcset="images/google-play-280.png 2x" /></a></td></tr>')+'<tr><td style=text-align:center><a title="Amazon App Store" rel="noreferrer noopener" target=_blank href="https://www.amazon.co.uk/gp/product/B097Z4Q7SK/"><img style=cursor:pointer src="images/amazon-appstore-140.png"  width=140 srcset="images/amazon-appstore-280.png 2x" /></a></td></tr>'+"</table>")+addHtmlValue("Android APK",'<a class=text-decoration-underline onclick=downloadFile("meshagents?id=14'+(urlargs.key?"&key="+urlargs.key:"")+'",null,true) title="APK version of the MeshAgent">APK</a> <i class="fa-regular fa-clipboard" title="Copiar URL al portapapeles" style=cursor:pointer onclick=copyAgentUrl("meshagents?id=14&meshid='+e.split("/")[2]+(urlargs.key?"&key="+urlargs.key:"")+'")></i>')+"</div>")+("<div id=agins_assistant style=display:none><table><tr><td style=vertical-align:top><div>"+format('El Asistente de MeshCentral es una herramienta de Windows que los usuarios pueden utilizar para solicitar ayuda. Usa el enlace de abajo para descargar la versión que se conectará con el Grupo de Dispositivos "{0}".',EscapeHtml(o.name))+"</div><div></div><br />"))+('<a class=text-decoration-underline id=asinslnk name="meshagents?id=10006&meshid='+e.split("/")[2]+(urlargs.key?"&key="+urlargs.key:"")+'" title="Asistente MeshCentral para Windows">Asistente para Windows (.exe)</a> <i class="fa-regular fa-clipboard" title="Copiar URL al portapapeles" style=cursor:pointer onclick=copyAgentUrl("meshagents?id=10006&meshid='+e.split("/")[2]+(urlargs.key?"&key="+urlargs.key:"")+'")></i>'))+'</td><td><img id=agass_img1 src=images/assistant-100.png width=74 height=100 srcset="images/assistant-200.png 2x"><img id=agass_img2 src=images/assistant2-100.png width=74 height=100 srcset="images/assistant2-200.png 2x"></td></tr></table></div>'+"<div id=agins_assistant2 style=display:none><table><tr><td style=vertical-align:top><div>El Asistente de MeshCentral es una herramienta de Windows que los usuarios pueden utilizar para solicitar ayuda. Usa el enlace de abajo para descargar la versión que monitoreará el agente en modo background.</div><div></div><br />")+('<a class=text-decoration-underline id=asinslnk2 name="meshagents?id=10006&meshid='+e.split("/")[2]+(urlargs.key?"&key="+urlargs.key:"")+'" title="Asistente MeshCentral para Windows">Asistente para Windows (.exe)</a> <i class="fa-regular fa-clipboard" title="Copiar URL al portapapeles" style=cursor:pointer onclick=copyAgentUrl("meshagents?id=10006&meshid='+e.split("/")[2]+(urlargs.key?"&key="+urlargs.key:"")+'")></i>'))+'</td><td><img src=images/assistant-100.png width=74 height=100 srcset="images/assistant-200.png 2x"></td></tr></table></div>'+'<div id=agins_windows_un style=display:none>Para eliminar un Agente Mesh, descarga el archivo a continuación, ejecútalo y haz clic en "desinstalar".<br /><br />')+addHtmlValue("Agente Mesh",'<a class=text-decoration-underline id=aginsw32unlnk name="meshagents?id=3&meshid='+e.split("/")[2]+"&installflags=0"+(urlargs.key?"&key="+urlargs.key:"")+'" title="version x86 32bit del MeshAgent">Windows x86-32 (.exe)</a> <i class="fa-regular fa-clipboard" title="Copiar el URL del agente x86 32bit a la papelera" style=cursor:pointer onclick=copyAgentUrl("meshagents?id=3&meshid='+e.split("/")[2]+'&installflags=",1)></i>',["col-md-4","col-md-8"]))+addHtmlValue("Agente Mesh",'<a class=text-decoration-underline id=aginsw64unlnk name="meshagents?id=4&meshid='+e.split("/")[2]+"&installflags=0"+(urlargs.key?"&key="+urlargs.key:"")+'" title="version x86 64bit del MeshAgent">Windows x86-64 (.exe)</a> <i class="fa-regular fa-clipboard" title="Copiar el URL del agente Windows x86 64bit a la papelera" style=cursor:pointer onclick=copyAgentUrl("meshagents?id=4&meshid='+e.split("/")[2]+'&installflags=",1)></i>',["col-md-4","col-md-8"]))+addHtmlValue("Agente Mesh",'<a class=text-decoration-underline id=aginswa64unlnk name="meshagents?id=43&meshid='+e.split("/")[2]+"&installflags=0"+(urlargs.key?"&key="+urlargs.key:"")+'" title="Version ARM 64bit de el MeshAgent">Windows ARM-64 (.exe)</a> <i class="fa-regular fa-clipboard" title="Copiar el URL del agente Windows ARM 64bit a la papelera" style=cursor:pointer onclick=copyAgentUrl("meshagents?id=43&meshid='+e.split("/")[2]+'&installflags=",1)></i>',["col-md-4","col-md-8"])+"</div>")+"<div id=agins_linux_un style=display:none>Para eliminar un Agente Mesh, ejecuta el siguiente comando. Se necesitarán credenciales de root.<br />"+"<textarea id=agins_linux_area_un rows=2 cols=20 readonly=readonly style=border-radius:4px;padding:6px;margin-top:4px;margin-bottom:4px;border:0;width:100%;resize:none;height:160px;overflow:auto;font-size:12px  class=form-control></textarea>")+'<a style=text-decoration:none title="Copiar al portapapeles" onclick=copyAgentIdValue("agins_linux_area_un")>Copy <i class="fa-regular fa-clipboard" style=cursor:pointer></i></a></div>'+'<div id=agins_osx_un style=display:none>To remove a mesh agent, download the file below, right click on the ".mpkg" file and click "Show Package Contents", then right click on "Uninstall.command" and click "Open"<br /><br />')+addHtmlValue("Agente Mesh",'<a class=text-decoration-underline onclick=downloadFile("meshosxagent?id=10005&meshid='+e.split("/")[2]+(urlargs.key?"&key="+urlargs.key:"")+'") title="Universal version of macOS Mesh Agent">macOS Agent (Universal)</a> <i class="fa-regular fa-clipboard" title="Copiar URL del Agente para macOS al portapapeles" style=cursor:pointer onclick=copyAgentUrl("meshosxagent?id=10005&meshid='+e.split("/")[2]+'",0)></i>',["col-md-4","col-md-8"]))+"</div>"+"<div id=agins_linux_inst style=display:none>This is a executable on OS's with graphical user interfaces<br /><br />Apple macOS executables will need to be removed from quarantine to run 'xattr -r -d com.apple.quarantine meshagent'<br /><br />You need to 'chmod +x meshagent' and run this file<br /><br />")+addHtmlValue("Agente Mesh",'<a class=text-decoration-underline id=aginsbinlnk name="meshagents?id='+e.split("/")[2]+"&installflags=0"+(urlargs.key?"&key="+urlargs.key:"")+'">meshagent</a> <i class="fa-regular fa-clipboard" title="Copiar la URL del agente en el portapapeles" style=cursor:pointer onclick=copyAgentUrl("meshagents?id='+e.split("/")[2]+'&installflags=",1)></i>',["col-md-4","col-md-8"]))+addHtmlValue('Comando&nbsp;<i class="fa-regular fa-clipboard" title="Copiar la URL del agente en el portapapeles" style=cursor:pointer onclick=copyAgentIdValue("aginsbincmd")></i>','<input id=aginsbincmd type=text class="form-control" readonly value=\'wget -O meshagent'+(0!=(2147483648&features)?" --no-check-certificate":"")+' "https://'+a+r+domainUrl+"meshagents?id="+e.split("/")[2].split("$").join("%24").split("@").join("%40")+"' />",["col-md-4 d-flex align-items-center","col-md-8"])+"</div>"),showModal("xxAddAgentModal","idx_dlgOkButton"),new QRCode(Q("agins_qrimage"),{text:serverinfo.magenturl+","+serverinfo.agentCertHash+","+e.split("/")[2],width:180,height:180,colorDark:"#000000",colorLight:"#EEE",correctLevel:QRCode.CorrectLevel.M}),Q("agins_qrimage_a").setAttribute("href",serverinfo.magenturl+","+serverinfo.agentCertHash+","+e.split("/")[2]),0==(8192&features)?(Q("agins_linux_area").value='(wget "https://'+a+r+domainUrl+"meshagents?script=1"+(urlargs.key?"&key="+urlargs.key:"")+'"'+(0!=(2147483648&features)?" --no-check-certificate":"")+' -O ./meshinstall.sh || wget "https://'+a+r+domainUrl+'meshagents?script=1" --no-proxy'+(0!=(2147483648&features)?" --no-check-certificate":"")+" -O ./meshinstall.sh) && chmod 755 ./meshinstall.sh && sudo -E ./meshinstall.sh https://"+a+r+s+" '"+e.split("/")[2]+"' || ./meshinstall.sh https://"+a+r+s+" '"+e.split("/")[2]+"'\r\n",Q("agins_linux_area_un").value='(wget "https://'+a+r+domainUrl+"meshagents?script=1"+(urlargs.key?"&key="+urlargs.key:"")+'"'+(0!=(2147483648&features)?" --no-check-certificate":"")+' -O ./meshinstall.sh || wget "https://'+a+r+domainUrl+'meshagents?script=1" --no-proxy'+(0!=(2147483648&features)?" --no-check-certificate":"")+" -O ./meshinstall.sh) && chmod 755 ./meshinstall.sh && sudo -E ./meshinstall.sh uninstall https://"+a+r+s+" '"+e.split("/")[2]+"' || ./meshinstall.sh uninstall https://"+a+r+s+" '"+e.split("/")[2]+"'\r\n"):(Q("agins_linux_area").value='wget "https://'+a+r+domainUrl+"meshagents?script=1"+(urlargs.key?"&key="+urlargs.key:"")+'" --no-proxy'+(0!=(2147483648&features)?" --no-check-certificate":"")+" -O ./meshinstall.sh && chmod 755 ./meshinstall.sh && sudo -E ./meshinstall.sh https://"+a+r+s+" '"+e.split("/")[2]+"' || ./meshinstall.sh https://"+a+r+s+" '"+e.split("/")[2]+"'\r\n",Q("agins_linux_area_un").value='wget "https://'+a+r+domainUrl+"meshagents?script=1"+(urlargs.key?"&key="+urlargs.key:"")+'" --no-proxy'+(0!=(2147483648&features)?" --no-check-certificate":"")+" -O ./meshinstall.sh && chmod 755 ./meshinstall.sh && sudo -E ./meshinstall.sh uninstall https://"+a+r+s+" '"+e.split("/")[2]+"' || ./meshinstall.sh uninstall https://"+a+r+s+" '"+e.split("/")[2]+"'\r\n"),Q("aginsSelect").focus(),addAgentToMeshClick()}return!1}function setModalContent(e,t,o,n=null){var i=document.getElementById("xxAddAgentModalConf"),a=document.getElementById(e+"Title");if(i&&a){if(a.innerHTML=t,"number"==typeof o){for(var s=1;s<24;s++)QV("dialog"+s,s==o);xxdialogMode=s}else if("string"==typeof o){Q("dialog2").innerHTML=o;for(s=1;s<24;s++)QV("dialog"+s,2==s);xxdialogMode=2}if(n)switch(i.classList.remove("modal-sm","modal-lg","modal-xl"),n){case"small":i.classList.add("modal-sm");break;case"large":i.classList.add("modal-lg");break;case"extra-large":i.classList.add("modal-xl")}else i.classList.remove("modal-sm","modal-lg","modal-xl")}else console.error("Modal elements not found:",e+"Title",e+"Body")}function showModal(t,e,o,n=null,i=null){var a;null==xxModal&&(["idx_dlgOkButton","idx_dlgCancelButton"].forEach(function(e){Q(e).onclick=null,QE(e,!0),QV(e,!0)}),xxModal=new bootstrap.Modal(document.getElementById(t)),a=function(e){xxModal&&(xxModal.dispose(),xxModal=null),0!=xxdialogMode&&(xxdialogMode=0),document.getElementById(t).removeEventListener("hidden.bs.modal",a)},document.getElementById(t).addEventListener("hidden.bs.modal",a)),xxModal.show(),document.getElementById(e).onclick=function(){"function"==typeof o&&o?(xxdialogMode=0,!1!==o(n,i)&&xxModal.hide()):xxModal&&xxModal.hide()}}function copyAgentIdValue(e){copyTextToClip(Q(e).value)}function showNotification(e,t,o,n,i,a,s,r){Swal.fire({position:e,title:t,text:o,icon:n,confirmButtonText:i,timer:a,width:s,showConfirmButton:null!==i})}function copyAgentUrl(e,t){var o=serverinfo.name,o=(-1!=o.indexOf(".")&&0==(2&features)||(o=window.location.hostname),domainUrl.substring(0,domainUrl.length-1),"https://"+o+(443==serverinfo.port?"":":"+serverinfo.port)+domainUrl+e);1==t&&(o+=Q("aginsType").value),o+=urlargs.key?"&key="+urlargs.key:"",5==Q("aginsSelect").value&&(o+="&meshinstall="+Q("aginsSysType").value),7==Q("aginsSelect").value&&(o+="&ac="+Q("asinsType").value),copyTextToClip(o)}function addAgentToMeshClick(){var e=Q("aginsSelect").value;QV("agins_windows",0==e),QV("agins_linux",1==e),QV("agins_osx",2==e),QV("agins_windows_un",3==e),QV("agins_linux_un",4==e),QV("agins_linux_inst",5==e),QV("aginsSysTypeDiv",5==e),QV("agins_qrcode",6==e),QV("agins_assistant",7==e&&4!=Q("asinsType").value),QV("agins_assistant2",7==e&&4==Q("asinsType").value),QV("agins_osx_un",8==e),Q("aginsbinlnk").onclick=function(){downloadFile(Q("aginsbinlnk").name.split("installflags=")[0]+"installflags="+Q("aginsType").value+(urlargs.key?"&key="+urlargs.key:"")+"&meshinstall="+Q("aginsSysType").value)},Q("aginsbincmd").value=Q("aginsbincmd").value.split("&installflags=")[0]+"&installflags="+Q("aginsType").value+(urlargs.key?"&key="+urlargs.key:"")+"&meshinstall="+Q("aginsSysType").value+'"',QV("aginsTypeDiv",0==e||5==e),QV("asinsTypeDiv",7==e),Q("aginsw32lnk").onclick=function(){downloadFile(Q("aginsw32lnk").name.split("installflags=")[0]+"installflags="+Q("aginsType").value+(urlargs.key?"&key="+urlargs.key:""),null,!0)},Q("aginsw64lnk").onclick=function(){downloadFile(Q("aginsw64lnk").name.split("installflags=")[0]+"installflags="+Q("aginsType").value+(urlargs.key?"&key="+urlargs.key:""),null,!0)},Q("aginswa64lnk").onclick=function(){downloadFile(Q("aginswa64lnk").name.split("installflags=")[0]+"installflags="+Q("aginsType").value+(urlargs.key?"&key="+urlargs.key:""),null,!0)},Q("aginsw32unlnk").onclick=function(){downloadFile(Q("aginsw32lnk").name.split("installflags=")[0]+"installflags="+Q("aginsType").value+(urlargs.key?"&key="+urlargs.key:""),null,!0)},Q("aginsw64unlnk").onclick=function(){downloadFile(Q("aginsw64lnk").name.split("installflags=")[0]+"installflags="+Q("aginsType").value+(urlargs.key?"&key="+urlargs.key:""),null,!0)},Q("aginswa64unlnk").onclick=function(){downloadFile(Q("aginswa64lnk").name.split("installflags=")[0]+"installflags="+Q("aginsType").value+(urlargs.key?"&key="+urlargs.key:""),null,!0)},0<debugmode&&(Q("aginswmshlnk").onclick=function(){downloadFile(Q("aginswmshlnk").name.split("installflags=")[0]+"installflags="+Q("aginsType").value+(urlargs.key?"&key="+urlargs.key:""),null,!0)}),Q("asinslnk").onclick=function(){downloadFile(Q("asinslnk").name+"&ac="+Q("asinsType").value,null,!0)},Q("asinslnk2").onclick=function(){downloadFile(Q("asinslnk").name+"&ac="+Q("asinsType").value,null,!0)},7==e&&(QV("agass_img1",Q("asinsType").value<2),QV("agass_img2",2<=Q("asinsType").value))}function validateDeviceToMesh(){QE("idx_dlgOkButton",0<Q("dp1devicename").value.length&&passwordcheck(Q("dp1password").value))}function addDeviceToMeshEx(e,t){var o=Q("dp1username").value,n=(""==o&&(o="admin"),Q("dp1hostname").value);""==n&&(n=Q("dp1devicename").value),meshserver.send({action:"addamtdevice",meshid:t,devicename:Q("dp1devicename").value,hostname:n,amtusername:o,amtpassword:Q("dp1password").value,amttls:Q("dp1tls").value})}function deviceHeaderSet(){0==deviceHeaderId?deviceHeaderId=1:(deviceHeaders["DevxHeader"+deviceHeaderId]=1==deviceHeaderTotal?"1 nodo":format("{0} nodos",deviceHeaderTotal),deviceHeaderId++,deviceHeaderCount={},deviceHeaderTotal=0)}var powerStateStrings=["",'<span title="El dispositivo está encendido.">Encendido</span>','<span title="El dispositivo está en estado de suspensión (S1).">Suspendiendo</span>','<span title="El dispositivo está en estado de suspensión (S2).">Suspendiendo</span>','<span title="El dispositivo está en estado de reposo (S3).">Estado de Reposo</span>','<span title="El dispositivo está en estado de hibernacion (S4).">Hibernando</span>','<span title="El dispositivo está apagado (S5).">Soft-Off</span>','<span title="El dispositivo se detectó pero no se pudo obtener el estado de alimentación.">Presente</span>','<span title="El dispositivo está apagado.">Apagado</span>'],powerStateStrings2=["","El dispositivo está conectado","El dispositivo está en estado de suspensión (S1)","El dispositivo está en estado de suspensión (S2)","El dispositivo está en estado de reposo (S3)","El dispositivo está hibernando (S4)","El dispositivo está en estado de apagado (S5)","El dispositivo está presente, pero no se puede determinar el estado de energía","El dispositivo está apagado"],powerColorTable=["pwsTransparent","pwsBlack","pwsBlue","pwsBlue2","pwsLightblue","pwsBlueviolet","pwsDarkgreen","pwsLightseagreen","pwsLightseagreen2"];function NodeStateStr(e){var t=[];return 0<e.state&&e.state<powerStatetable.length&&state.push(powerStatetable[e.state]),e.conn&&(0!=(1&e.conn)&&(4==e.mtype?"PDU"==e.porttype?t.push('<span title="El interruptor de encendido está listo para usar.">Cambiar</span>'):t.push('<span title="El puerto IP-KVM está activo y listo para usar.">IP-KVM</span>'):t.push('<span title="El Agente Mesh está conectado y listo para ser utilizado.">Agente</span>')),0!=(2&e.conn)?t.push('<span title="Intel&reg; AMT CIRA está conectado y listo para usar.">CIRA</span>'):0!=(4&e.conn)&&t.push('<span title="Intel&reg; AMT es enrutable.">AMT</span>'),0!=(8&e.conn)&&t.push('<span title="Se puede alcanzar al Agente Mesh utilizando otro agente en modo Relay.">Relé</span>'),0!=(16&e.conn))&&t.push('<span title="La conexión MQTT al dispositivo está activa.">MQTT</span>'),null!=e.pwr&&0!=e.pwr&&t.push(powerStateStrings[e.pwr]),0==t.length?"&nbsp;":t.join(", ")}function PowerStateStr(e){return e<powerStatetable.length?powerStatetable[e]:""}function PowerStateStr2(e){return 0!=e&&e<powerStatetable.length?powerStatetable[e]:"Desconocido"}function updateCollapseAllButton(){var e=0<Object.keys(CollapsedGroups).length;QV("CollapseAllButton",!e),QV("ExpandAllButton",e),QV("CollapseAllButton2",!e),QV("ExpandAllButton2",e)}function selectallButtonFunction(){for(var e=document.getElementsByClassName("DeviceCheckbox"),t=Object.keys(checkedNodeids).length,o=0;o<e.length;o++)e[o].checked=0==t;if(checkedNodeids={},0==t){checkedNodeids={};for(var n=document.getElementsByName("xxdevice"+Q("viewselect").value),o=0;o<n.length;o++)(null==n[o].parentElement.attributes.style||n[o].parentElement.attributes.style.value.indexOf("display")<0)&&(checkedNodeids[n[o].id.substring(3)]=1)}p1updateInfo()}function p1devcheck(e){e.srcElement.checked?checkedNodeids[e.srcElement.value.substring(6)]=1:delete checkedNodeids[e.srcElement.value.substring(6)],p1updateInfo()}function p1updateInfo(){var e=Object.keys(checkedNodeids).length;if(0<e?(QE("GroupActionButton",!0),Q("SelectAllButton").value="No seleccionar nada",QV("cxmdesktop",!0)):(QE("GroupActionButton",!1),Q("SelectAllButton").value="Seleccionar Todo",QV("cxmdesktop",!1)),null!=customui&&customui.devicesbarbuttons)for(var t in customui.devicesbarbuttons)"one"==customui.devicesbarbuttons[t].selection&&QE("cui:"+t,1==e),"many"==customui.devicesbarbuttons[t].selection&&QE("cui:"+t,1<=e)}function groupActionFunction(){var e=[],t=getCheckedDevices(),o=0;if(262144&features&&0==count2factoraAuths())setModalContent("xxAddAgent","Seguridad de la Cuenta",'No se puede acceder a esta función hasta que se habilite la autenticación de dos factores. Esto es necesario para mayor seguridad. Ve a la pestaña "Mi cuenta" y revisa la sección "Seguridad de la cuenta".'),showModal("xxAddAgentModal","idx_dlgOkButton");else{if(4194304&features)for(var n in t)if(0!=(16&getNodeFromId(t[n]).conn)){e.push({v:103,name:"Enviar Mensaje MQTT"});break}for(var n in e.push({v:105,name:"Exportar información de dispositivos",s:!0}),t){var i=getNodeFromId(t[n]),a=GetNodeRights(i);1&a&&0==(2&o)&&(o|=2,e.push({v:102,name:"Mover al grupo de dispositivos"})),0!=(1&i.conn)&&0!=(32768&a)&&0==(1&o)&&(o|=1,e.push({v:104,name:"Desinstalar Agente"})),64&a&&0==(8&o)&&(o|=8,e.push({v:100,name:"Despertar dispositivos"})),262144&a&&0==(4&o)&&(o|=4,e.push({v:4,name:"Suspender dispositivos"}),e.push({v:3,name:"Reiniciar dispositivos"}),e.push({v:2,name:"Apagar dispositivos"})),131072&a&&0==(16&o)&&(o|=16,e.push({v:106,name:"Ejecutar comandos"})),16384&a&&0==(32&o)&&(o|=32,e.push({v:108,name:"Notificar dispositivo"})),4&a&&0==(64&o)&&(o|=64,e.push({v:107,name:"Editar etiquetas"})),8&a&&0==(256&o)&&(o|=256,e.push({v:109,name:"Subir archivos"})),32768&a&&0==(128&o)&&(o|=128,e.push({v:101,name:"Eliminar dispositivos"})),null!=i.agent&&16&features2&&4294967295==a&&0==(512&o)&&(o|=512,e.push({v:110,name:"Forzar actualización del agente"}),e.push({v:111,name:"Borrar núcleo del agente"}),e.push({v:112,name:"Cargar el archivo de núcleo predeterminado"}))}var s="";for(n in e.sort(nameSort),e)s+="<option value="+e[n].v+(e[n].s?" selected":"")+">"+e[n].name+"</option>";var r="Selecciona una operación para realizar en todos los dispositivos seleccionados. Las acciones se realizarán solo con los derechos correspondientes.<br /><br />";setModalContent("xxAddAgent","Acción de Grupo",r+=addHtmlFormFloating("Operación",'<select id=d2groupop class="form-select">'+s+"</select>")),showModal("xxAddAgentModal","idx_dlgOkButton",groupActionFunctionEx)}}function getCheckedDevices(){return Object.keys(checkedNodeids)}function uncheckAllDevices(){for(var e=document.getElementsByClassName("DeviceCheckbox"),t=0;t<e.length;t++)e[t].checked=!1;checkedNodeids={}}function groupActionFunctionEx(){var e=Q("d2groupop").value;if(100==e)return meshserver.send({action:"wakedevices",nodeids:getCheckedDevices()}),uncheckAllDevices(),!0;if(101==e){var t="";if(0==(l=getCheckedDevices()).length)return;if(1==l.length)t+="¿Confirmar la eliminación del dispositivo seleccionado?<br /><br />";else{t+=format("¿Confirmar la eliminación de los {0} dispositivos seleccionados?<br />",l.length);var o=0,n=0;for(r in l)null!=(d=getNodeFromId(l[r])).conn&&0<d.conn?o++:n++;var i="";1==o?i+=format("1 dispositivo seleccionado está en línea.<br />",o):1<o&&(i+=format("{0} dispositivos seleccionados están en línea.<br />",o)),1==n?i+=format("1 dispositivo seleccionado está fuera de línea.<br />",n):1<n&&(i+=format("{0} dispositivos seleccionados están sin conexión.<br />",n)),t+=""!=i?"<div style=padding:8px>"+i+"</div>":"<br />"}setModalContent("xxAddAgent","Eliminar dispositivos",t+='<label><input id=d2check type=checkbox class="form-check-input me-2" onchange=d2groupActionFunctionDelCheck() />Confirmar</label>'),showModal("xxAddAgentModal","idx_dlgOkButton",()=>d2groupActionFunctionDelExec()),QE("idx_dlgOkButton",!1)}else if(102==e)p10showChangeGroupDialog(getCheckedDevices());else if(103==e)p10showSendMqttMsgDialog(getCheckedDevices());else if(104==e)p10showSendUninstallAgentDialog(getCheckedDevices());else if(105==e)p2downloadDeviceInfo();else if(106==e)d2runCommandDialog({nodeids:getCheckedDevices(),title:"Ejecutar comandos en los dispositivos seleccionados.",func:uncheckAllDevices});else if(107==e){var t="Realizar operación de etiquetado de dispositivos por lotes<br /><br />",a=(t=(t+=addHtmlFormFloating("Operación",'<select id=d2deviceop class="form-select-sm me-2"><option value=1>Agregar etiquetas</option><option value=2>Establecer etiquetas</option><option value=3>Remover etiquetas</option></select>'))+addHtmlFormFloating("Etiquetas",'<input id=dp10devicevalue class="form-control" maxlength=4096 placeholder="Etiqueta1, Etiqueta2, Etiqueta3" />'),[]),i="";for(r in nodes)if(nodes[r].tags)for(var s in nodes[r].tags)-1==a.indexOf(nodes[r].tags[s])&&a.push(nodes[r].tags[s]);if(0<a.length){for(var r in a.sort(),a)i+='<span style=padding:4px;background-color:#BBB;border-radius:3px;cursor:pointer onclick=showEditNodeValueDialogAddTag("'+encodeURIComponentEx(a[r])+'")>'+EscapeHtml(a[r])+"</span> ";t+="<div style=margin-top:8px;width:370px;line-height:26px;max-height:160px;overflow-y:auto>"+i+"</div>"}setModalContent("xxAddAgent","Editar Etiquetas del Dispositivo",t),showModal("xxAddAgentModal","idx_dlgOkButton",()=>d2groupActionFunctionTagsExec())}else if(108==e){var t="<div style=margin-bottom:4px>Realizar notificaciones de dispositivos por lotes</div>";setModalContent("xxAddAgent","Notificar Dispositivo",t=(t=(t=(t=(t=(t+='<select id=d2deviceop class="form-select-sm me-2" style=width:100%;margin-bottom:4px><option value=2>Notificación Emergente Temporal</option><option value=1>Cuadro de Mensaje</option><option value=3>Alert Box</option></select>')+'<input id=dp2notifyTitle maxlength=256 placeholder="Título" style=width:100%;box-sizing:border-box;margin-bottom:4px />'+"<textarea id=d2notifyMsg style=width:100%;height:140px;resize:none;overflow-y:scroll;box-sizing:border-box;margin-bottom:4px></textarea>")+"<select style=width:100% id=d2notifyTimeout>"+'<option disabled value="">Only Applicable to Message Box Notifications</option>')+"<option value=2 selected>Show for 2 Minutes (Default)</option>"+"<option value=10>Show for 10 minutes</option>")+"<option value=30>Show for 30 minutes</option>"+"<option value=60>Show for 60 minutes</option>")+"<option value=0>Mostrar mensaje hasta que el usuario lo descarte</option>"+"</select>"),showModal("xxAddAgentModal","idx_dlgOkButton",()=>d2groupActionFunctionNotifyExec()),Q("d2notifyMsg").focus()}else if(109==e){var l,d,c=!1,u=!1;for(r in l=getCheckedDevices())(d=getNodeFromId(l[r])).agent&&(0<d.agent.id&&d.agent.id<5||34==d.agent.id?c=!0:u=!0);var t="Cargar archivos seleccionados a todos los dispositivos seleccionados<br /><br />";t=(t+="<form method=post enctype=multipart/form-data action=uploadfilebatch.ashx target=fileUploadFrame>")+("<input type=hidden name=authCookie value="+authCookie+" /><input type=hidden name=nodeIds value="+l.join(",")+" /><input type=submit id=d2batchUploadSubmit style=display:none />")+'<input type=file name=files id=d2uploadinput class="form-control" multiple=multiple onchange="d2batchUploadValidate()" /><br /><br />',c&&(t+=addHtmlFormFloating("Ruta de Windows",'<input type=text class="form-control" onchange="d2batchUploadValidate()" onkeyup="d2batchUploadValidate()" name=winpath id=d2winuploadpath placeholder="C:\\temp" value="" />')),u&&(t+=addHtmlFormFloating("Ruta de Linux",'<input type=text class="form-control" onchange="d2batchUploadValidate()" onkeyup="d2batchUploadValidate()" name=linuxpath id=d2linuxuploadpath placeholder="/tmp" value="" />')),setModalContent("xxAddAgent","Carga de archivos por lotes",t=t+'<br /><label><input type=checkbox class="form-check-input me-2" name=createFolder />¿Crear carpeta si no existe?</label><br />'+'<label><input type=checkbox class="form-check-input me-2" name=overwriteFiles />¿Sobrescribir si el archivo existe?</label></form>'),showModal("xxAddAgentModal","idx_dlgOkButton",()=>d2batchUploadValidateOk()),d2batchUploadValidate()}else if(110==e)setModalContent("xxAddAgent","Forzar actualización del agente",t="¿Forzar la actualización del agente en los dispositivos seleccionados?<br /><br />"),showModal("xxAddAgentModal","idx_dlgOkButton",()=>d2groupActionFunctionAgentUpdateExec());else if(111==e)setModalContent("xxAddAgent","Borrar núcleo del agente",t="¿Borrar el núcleo del agente en los dispositivos seleccionados?<br /><br />"),showModal("xxAddAgentModal","idx_dlgOkButton",()=>d2groupActionFunctionAgentClearCoreExec());else{if(112!=e)return meshserver.send({action:"poweraction",nodeids:getCheckedDevices(),actiontype:parseInt(e)}),uncheckAllDevices(),!0;setModalContent("xxAddAgent","Cargar el archivo de núcleo predeterminado",t="¿Cargar el núcleo del servidor predeterminado en los dispositivos seleccionados?<br /><br />"),showModal("xxAddAgentModal","idx_dlgOkButton",()=>d2groupActionFunctionAgentDefaultCodeExec())}return!1}function d2batchUploadValidate(){QE("idx_dlgOkButton",!(0==Q("d2uploadinput").files.length||null!=Q("d2winuploadpath")&&""==Q("d2winuploadpath").value||null!=Q("d2linuxuploadpath")&&""==Q("d2linuxuploadpath").value))}function d2batchUploadValidateOk(){Q("d2batchUploadSubmit").click()}function d2groupActionFunctionAgentUpdateExec(){meshserver.send({action:"updateAgents",nodeids:getCheckedDevices()})}function d2groupActionFunctionAgentClearCoreExec(){meshserver.send({action:"uploadagentcore",nodeids:getCheckedDevices(),type:"clear"})}function d2groupActionFunctionAgentDefaultCodeExec(){meshserver.send({action:"uploadagentcore",nodeids:getCheckedDevices(),type:"default"})}function d2groupActionFunctionNotifyExec(){var e=Q("d2deviceop").value,t=Q("dp2notifyTitle").value,o=Q("d2notifyMsg").value,n=getCheckedDevices(),i=parseFloat(Q("d2notifyTimeout").value);if(0!=o.length)if(""==(t=""==t?decodeURIComponent("{{{extitle}}}"):t)&&(t="MeshCentral"),isNaN(i)&&(i=2),1==e)for(var a=0;a<n.length;a++)meshserver.send({action:"msg",type:"messagebox",nodeid:n[a],title:t,msg:o,timeout:6e4*i});else if(2==e)meshserver.send({action:"toast",nodeids:n,title:t,msg:o});else if(3==e)for(a=0;a<n.length;a++)meshserver.send({action:"msg",type:"alertbox",nodeid:n[a],title:t,msg:o})}function d2groupActionFunctionTagsExec(){var e=getCheckedDevices(),t=Q("d2deviceop").value,o=Q("dp10devicevalue").value;if(2==t)for(var n in e)meshserver.send({action:"changedevice",nodeid:e[n],tags:o});else{var i=[];for(n in o=o.split(",")){var a=o[n].trim();0<a.length&&a.length<64&&-1==i.indexOf(a)&&i.push(a)}for(n in e){var s=null,r=!1,l=getNodeFromId(e[n]);null==(s=null!=l.tags?Clone(l.tags):s)&&(s=[]);for(var d,c=0;c<o.length;c++)1==t&&-1==s.indexOf(o[c])&&(s.push(o[c]),r=!0),3==t&&0<=(d=s.indexOf(o[c]))&&(s.splice(d,1),r=!0);r&&meshserver.send({action:"changedevice",nodeid:e[n],tags:s.join(",")})}}}function p2downloadDeviceInfo(){if(!xxdialogMode){var e,t=getCheckedDevices(),o=!1;for(e in t)null!=getNodeFromId(t[e]).intelamt&&(o=!0);var n="Descargar la lista de dispositivos con uno de los formatos de archivo a continuación.<br /><br />",n=(n+=addHtmlValue("Formato CSV","<a href=# style=cursor:pointer onclick='return p2downloadDeviceInfoCSV()'>devicelist.csv</a>"))+addHtmlValue("Formato JSON","<a href=# style=cursor:pointer onclick='return p2downloadDeviceInfoJSON()'>devicelist.json</a>");o&&(n+=addHtmlValue("Intel&reg; AMT JSON","<a href=# style=cursor:pointer onclick='return p2downloadAmtInfoJSON()'>computerlist.json</a>")),setModalContent("xxAddAgent","Exportar Información de Dispositivos",n+='<div style=margin-top:8px><label><input type=checkbox class="form-check-input me-2" id=d2DevInfoDetailsCheck />Incluir detalles del dispositivo</label></div>'),showModal("xxAddAgentModal","idx_dlgOkButton")}}function csvClean(e){return null==e?"":e.split(",").join("")}function p2downloadDeviceInfoCSV(){var e=getCheckedDevices();if(Q("d2DevInfoDetailsCheck").checked){var t=null;try{t=Intl.DateTimeFormat().resolvedOptions().timeZone}catch(e){}meshserver.send({action:"getDeviceDetails",nodeids:e,tz:t,tf:(new Date).getTimezoneOffset(),l:getLang(),type:"csv"})}else{var o,n="id,name,rname,host,icon,ip,osdesc,state,groupname,conn,pwr,av,update,firewall,bitlocker,avdetails,tags,lastbootuptime\r\n";for(o in e){var i=getNodeFromId(e[o]);if(n+='"'+i._id.split(",").join("")+'","'+i.name.split(",").join("")+'","'+(i.rname?i.rname.split(",").join(""):"")+'","'+(i.host?i.host.split(",").join(""):"")+'","'+i.icon+'","'+(i.ip||"")+'","'+(i.osdesc?i.osdesc.split(",").join(""):"")+'","'+i.state+'","'+meshes[i.meshid].name.split(",").join("")+'","'+(i.conn||"")+'","'+(i.pwr||"")+'"',"object"==typeof i.wsc?n+=',"'+csvClean(i.wsc.antiVirus)+'","'+csvClean(i.wsc.autoUpdate)+'","'+csvClean(i.wsc.firewall)+'"':n+=",,,","object"==typeof i.volumes){var a="",s=!0;for(d in i.volumes)void 0!==i.volumes[d].protectionStatus&&(s?s=!1:a+="|",a+=d+"/"+i.volumes[d].volumeStatus);n+=',"'+csvClean(a)+'"'}else n+=",";if("object"==typeof i.av){var r="",l=!0;for(d in i.av)"string"==typeof i.av[d].product&&(l?l=!1:r+="|",r+=i.av[d].product+"/"+(i.av[d].enabled?"enabled":"disabled")+"/"+(i.av[d].updated?"updated":"notupdated"));n+=',"'+csvClean(r)+'"'}else n+=",";if("object"==typeof i.tags){var d,c="",u=!0;for(d in i.tags)u?u=!1:c+="|",c+=i.tags[d];n+=',"'+csvClean(c)+'"'}else n+=",";"number"==typeof i.lastbootuptime&&(n+=',"'+i.lastbootuptime+'"'),n+="\r\n"}saveAs(stringToUtf8Blob(n),"devicelist.csv")}return!1}function p2downloadAmtInfoJSON(){var e,t=getCheckedDevices(),o={webappversion:"0.9.0",computers:[]};for(e in t){var n,i=getNodeFromId(t[e]);null!=i.intelamt&&(n={name:i.name,host:i.host,user:i.intelamt.user,pass:"",tls:1==i.intelamt.tls?1:0,ver:i.intelamt.ver,pstate:i.intelamt.state},2==i.intelamt.state&&(n.pmode=1),i.intelamt.realm&&(n.digestrealm=i.intelamt.realm),i.intelamt.hash&&(n.tlscerthash=i.intelamt.hash),o.computers.push(n))}saveAs(new Blob([JSON.stringify(o,null,2)],{type:"application/octet-stream"}),"computerlist.json")}function p2downloadDeviceInfoJSON(){var e=getCheckedDevices();if(Q("d2DevInfoDetailsCheck").checked){var t=null;try{t=Intl.DateTimeFormat().resolvedOptions().timeZone}catch(e){}meshserver.send({action:"getDeviceDetails",nodeids:e,tz:t,tf:(new Date).getTimezoneOffset(),l:getLang(),type:"json"})}else{var o,n=[];for(o in e)n.push(getNodeFromId(e[o]));saveAs(new Blob([JSON.stringify(n,null,2)],{type:"application/octet-stream"}),"devicelist.json")}return!1}function d2groupActionFunctionDelCheck(){QE("idx_dlgOkButton",Q("d2check").checked)}function d2groupActionFunctionDelExec(){meshserver.send({action:"removedevices",nodeids:getCheckedDevices()}),uncheckAllDevices()}function d2runCommandDialog(e){var t,o=!1,n=!1,i=!1;for(t in e.nodeids){var a=getNodeFromId(e.nodeids[t]);a.agent&&(24==(24&GetNodeRights(a))&&(i=!0),0<a.agent.id&&a.agent.id<5?o=!0:n=!0)}if(1==o||1==n||1==i){var s={type:1,runAs:0,source:1,cmd:""};try{s=JSON.parse(getstore("runopt",s))}catch(e){}e.selectedFile&&(r=e.selectedFile.name.toLowerCase(),console.log("filename",r),r.endsWith(".bat")&&(s.type=1),r.endsWith(".ps1")&&(s.type=2),r.endsWith(".sh")&&(s.type=3),r.endsWith(".agentconsole"))&&(s.type=4);var r="";e.title&&(r+=e.title+"<br />"),r+="<select id=d2cmdtype onclick=d2runCommandValidate() style=width:100%;margin-bottom:4px;margin-top:4px class=form-select>",1==o&&(r+="<option value=1"+(1==s.type?" selected":"")+">Línea de Comandos de Windows</option><option value=2"+(2==s.type?" selected":"")+">Windows PowerShell</option>"),1==n&&(r+="<option value=3"+(3==s.type?" selected":"")+">Shell de comandos Linux/BSD/macOS</option>"),1==i&&(r+="<option value=4"+(4==s.type?" selected":"")+">Consola de Agente</option>"),r=r+"</select>"+("<select id=d2cmduser style=width:100%;margin-bottom:4px class=form-select><option value=0"+(0==s.runAs?" selected":"")+">Ejecutar como agente</option><option value=1"+(1==s.runAs?" selected":"")+">Ejecutar como usuario, agente si no hay usuario</option><option value=2"+(2==s.runAs?" selected":"")+">Debe ejecutarse como usuario</option></select>"),null==e.selectedFile&&(r+="<select id=d2cmdsource onclick=d2runCommandValidate() style=width:100%;margin-bottom:4px class=form-select><option value=0"+(0==s.source?" selected":"")+">Comandos desde caja de texto</option><option value=1"+(1==s.source?" selected":"")+">Comandos desde un archivo</option>",8&userinfo.siteadmin&&(r+="<option value=2"+(2==s.source?" selected":"")+">Comandos desde un archivo en el servidor</option>"),r=r+("</select><textarea id=d2runcmd onkeyup=d2runCommandValidate() style=background-color:#fcf3cf;width:100%;height:200px;resize:none;overflow-y:scroll class=form-control>"+(s.cmd?EscapeHtml(decodeURIComponent(s.cmd)):""))+'</textarea><div id=d2runfile style=display:none><input id=d2runfileex class="form-control" type=file onchange=d2runCommandValidate() id=d2localFile name=files onchange=d2runCommandValidate() /></div>',8&userinfo.siteadmin)&&(r+='<div id=d2runsfile style=display:none><div id=d2serveraction valign=bottom><input type=button id=p2FolderUp disabled="disabled" onclick=d3folderup() value="Up" />&nbsp;<span id=p2CurrentFolder></span></div><div id=d2serverfiles></div></div>'),setModalContent("xxAddAgent","Ejecutar Comandos",r),showModal("xxAddAgentModal","idx_dlgOkButton",function(){d2groupActionFunctionRunCommands(3,e)}),null==e.selectedFile&&(Q("d2runcmd").focus(),8&userinfo.siteadmin)&&(d3fileoptions={dialog:2,files:"d2serverfiles",folderup:"p2FolderUp",currentFolder:"p2CurrentFolder",func:null},d3updatefiles()),d2runCommandValidate()}}function d2runCommandValidate(){var e;QV("d2cmduser",Q("d2cmdtype").value<4),null==xxdialogTag.selectedFile?(QV("d2runcmd",0==Q("d2cmdsource").value),QV("d2runfile",1==Q("d2cmdsource").value),QV("d2runsfile",2==Q("d2cmdsource").value),e=!1,0==Q("d2cmdsource").value&&0<Q("d2runcmd").value.length&&(e=!0),1==Q("d2cmdsource").value&&1==Q("d2runfileex").files.length&&(e=!0),2==Q("d2cmdsource").value&&(e=!1),QE("idx_dlgOkButton",e)):QE("idx_dlgOkButton",!0)}function d2groupActionFunctionRunCommands(e,t){var o=3;try{o=parseInt(Q("d2cmdtype").value)}catch(e){}null==t.selectedFile&&putstore("runopt",JSON.stringify({type:o,runAs:parseInt(Q("d2cmduser").value),source:parseInt(Q("d2cmdsource").value),cmd:encodeURIComponent(Q("d2runcmd").value)}));var n,i={action:"runcommands",nodeids:t.nodeids,type:o,runAsUser:parseInt(Q("d2cmduser").value)};t.selectedFile?((n=new FileReader).onload=function(e){i.cmds=e.target.result,meshserver.send(i),t.func&&t.func()},n.readAsText(t.selectedFile)):0==Q("d2cmdsource").value?(i.cmds=Q("d2runcmd").value,meshserver.send(i),t.func&&t.func()):1==Q("d2cmdsource").value?((n=new FileReader).onload=function(e){i.cmds=e.target.result,meshserver.send(i),t.func&&t.func()},n.readAsText(Q("d2runfileex").files[0])):2==Q("d2cmdsource").value&&1==(o=d3getFileSel()).length&&(i.cmdpath=d3filetreelocation.join("/")+"/"+o[0],meshserver.send(i),t.func)&&t.func()}function onSortSelectChange(e){sort=document.getElementById("sortselect").selectedIndex,e||putstore("sort",sort)}var sortCollator=new Intl.Collator(void 0,{numeric:!0,sensitivity:"base"});function nameSort(e,t){e=e.name.toLowerCase(),t=t.name.toLowerCase();return sortCollator.compare(e,t)}function meshSort(e,t){var o=sortCollator.compare(e.meshnamel,t.meshnamel);return 0!=o||0!=(o=sortCollator.compare(e.meshid,t.meshid))?o:1==showRealNames?sortCollator.compare(e.rnamel,t.rnamel):sortCollator.compare(e.namel,t.namel)}function powerSort(e,t){var o=e.pwr||0,n=t.pwr||0;return n<o?-1:o<n?1:o==n?1==showRealNames?sortCollator.compare(e.rnamel,t.rnamel):sortCollator.compare(e.namel,t.namel):void 0}function deviceSort(e,t){return sortCollator.compare(e.namel,t.namel)}function deviceHostSort(e,t){return sortCollator.compare(e.rnamel,t.rnamel)}function lastConnectSort(e,t){var o=e.lastconnect,n=t.lastconnect;return null==o&&(o=99999999999999),null==n&&(n=99999999999999),(o=0<e.conn?99999999999998:o)==(n=0<t.conn?99999999999998:n)?nameSort(e,t):o-n}function onSearchFocus(e){searchFocus=e}function clearDeviceSearch(){Q("KvmSearchInput").value=Q("SearchInput").value="",onOnlineCheckBox(),mainUpdate(1)}function onMapSearchFocus(e){mapSearchFocus=e}function onUserSearchFocus(e){userSearchFocus=e}function onConsoleFocus(e){consoleFocus=e}function parseSearchAndInput(e){var t,o=e.split(" y "),n=null;for(t in o){var i=getDevicesThatMatchFilter(o[t]);if(null==n)n=i;else{var a,s=[];for(a in i)0<=n.indexOf(i[a])&&s.push(i[a]);n=s}}return n}function parseSearchOrInput(e){var t,o=e.split(" o "),n=null;for(t in o){var i=parseSearchAndInput(o[t]);if(null==n)n=i;else for(var a in i)n.indexOf(0<=i[a])&&n.push(i[a])}return n}function getDevicesThatMatchFilter(e){var t=[],o=null,n=null,i=null,a=null,s=null,r=null,l=null,d=null,c=null;if(e.startsWith("usuario:".toLowerCase())?o=e.substring("usuario:".length):e.startsWith("u:".toLowerCase())?o=e.substring("u:".length):e.startsWith("ip:".toLowerCase())?n=e.substring("ip:".length):e.startsWith("grupo:".toLowerCase())?i=e.substring("grupo:".length):e.startsWith("g:".toLowerCase())?i=e.substring("g:".length):e.startsWith("etiqueta:".toLowerCase())?a=e.substring("etiqueta:".length):e.startsWith("t:".toLowerCase())?a=e.substring("t:".length):e.startsWith("atag:".toLowerCase())?s=e.substring("atag:".length):e.startsWith("a:".toLowerCase())?s=e.substring("a:".length):e.startsWith("os:".toLowerCase())?l=e.substring("os:".length):e.startsWith("amt:".toLowerCase())?d=e.substring("amt:".length):e.startsWith("desc:".toLowerCase())?c=e.substring("desc:".length):"wsc:ok"==e?r=1:"wsc:noav"==e?r=2:"wsc:noupdate"==e?r=3:"wsc:nofirewall"==e?r=4:"wsc:any"==e&&(r=5),""==e)for(var u in nodes)t.push(u);else if(null!=n)for(var u in nodes)null!=nodes[u].ip&&0<=nodes[u].ip.toLowerCase().indexOf(n)&&t.push(u);else if(null!=i)for(var u in nodes)0<=meshes[nodes[u].meshid].name.toLowerCase().indexOf(i)&&t.push(u);else if(null!=a){for(var u in nodes)if(null==nodes[u].tags&&""==a)t.push(u);else if(null!=nodes[u].tags)for(var p in nodes[u].tags)if(0<=nodes[u].tags[p].toLowerCase().indexOf(a)){t.push(u);break}}else if(null!=s)for(var u in nodes)(null!=nodes[u].agent&&null==nodes[u].agent.tag&&""==s||null!=nodes[u].agent&&null!=nodes[u].agent.tag&&0<=nodes[u].agent.tag.toLowerCase().indexOf(s))&&t.push(u);else if(null!=o){for(var u in nodes)if(nodes[u].users&&0<nodes[u].users.length)for(var m in nodes[u].users)0<=nodes[u].users[m].toLowerCase().indexOf(o)&&t.push(u)}else if(null!=l)for(var u in nodes)null!=nodes[u].osdesc&&0<=nodes[u].osdesc.toLowerCase().indexOf(l)&&t.push(u);else if(null!=d)for(var u in nodes)null==nodes[u].intelamt||""!=d&&nodes[u].intelamt.state!=d||t.push(u);else if(null!=c)for(var u in nodes)null!=nodes[u].desc&&""!=nodes[u].desc&&(""==c||0<=nodes[u].desc.toLowerCase().indexOf(c))&&t.push(u);else if(null!=r)for(var u in nodes)!nodes[u].wsc||(1==r&&"OK"==nodes[u].wsc.antiVirus&&"OK"==nodes[u].wsc.autoUpdate&&"OK"==nodes[u].wsc.firewall||(2==r||5==r)&&"OK"!=nodes[u].wsc.antiVirus||(3==r||5==r)&&"OK"!=nodes[u].wsc.autoUpdate||(4==r||5==r)&&"OK"!=nodes[u].wsc.firewall)&&t.push(u);else if("*"==e)for(var u in nodes)1==stars[nodes[u]._id]&&t.push(u);else try{var g=e.split(/\s+/).join("|"),v=new RegExp(g);for(u in nodes)32768&features2?268435456&features2?(v.test(nodes[u].name.toLowerCase())||v.test(meshes[nodes[u].meshid].name.toLowerCase())||null!=nodes[u].rnamel&&v.test(nodes[u].rnamel.toLowerCase()))&&t.push(u):(v.test(nodes[u].name.toLowerCase())||null!=nodes[u].rnamel&&v.test(nodes[u].rnamel.toLowerCase()))&&t.push(u):268435456&features2?showRealNames?(null!=nodes[u].rnamel&&v.test(nodes[u].rnamel.toLowerCase())||v.test(meshes[nodes[u].meshid].name.toLowerCase()))&&t.push(u):(v.test(nodes[u].name.toLowerCase())||v.test(meshes[nodes[u].meshid].name.toLowerCase()))&&t.push(u):showRealNames?null!=nodes[u].rnamel&&v.test(nodes[u].rnamel.toLowerCase())&&t.push(u):v.test(nodes[u].name.toLowerCase())&&t.push(u)}catch(e){for(var u in nodes)t.push(u)}return t}function onSearchInputChanged(){var e=Q("SearchInput").value.toLowerCase().trim(),t=(putstore("_search",Q("SearchInput").value),""==e?QC("SearchInput").remove("search"):QC("SearchInput").add("search"),QV("SearchInputClearButton",""!=e),QV("KvmSearchInputClearButton",""!=e),parseSearchOrInput(e));for(n in nodes)nodes[n].v=0<=t.indexOf(n);var o,e=Q("DevFilterSelect").value;if(1==e)for(var n in nodes)null!=nodes[n].conn&&0!=nodes[n].conn||3==nodes[n].mtype||(nodes[n].v=!1);if(2==e)for(var n in nodes)(null==(o=nodes[n]).sessions||null==o.sessions.kvm&&null==o.sessions.terminal&&null==o.sessions.files&&null==o.sessions.tcp&&null==o.sessions.udp)&&(o.v=!1);if(3==e)for(var n in nodes)1!=stars[nodes[n]._id]&&(nodes[n].v=!1);if(4==e)for(var n in nodes)null==nodes[n].intelamt&&(nodes[n].v=!1);if(5==e)for(var n in nodes)null!=nodes[n].conn&&0!=nodes[n].conn&&(nodes[n].v=!1);if(6==e)for(var n in nodes)null!=(o=nodes[n]).sessions&&null!=o.sessions.help||(o.v=!1);if(7==e)for(var n in nodes)null!=(o=nodes[n]).tags&&0!=o.tags.length||(o.v=!1);if(8==e)for(var n in nodes)null!=(o=nodes[n]).tags&&0<o.tags.length&&(o.v=!1)}function newContextMenu(e,t){if(1===t){if(null==currentNode||null==currentNode.agent||3==currentNode.mtype)return!0;if(!(serverinfo.linuxshell&&4<currentNode.agent.id)){t=e.target.nextElementSibling;if(t)for(var o=t.children,n=4<currentNode.agent.id&&!isWindowsNode(currentNode)?"lin":34==currentNode.agent.id?"add":null,i=0;i<o.length;i++)o[i].style.display=n?o[i].classList.contains(n)?"block":"none":o[i].classList.contains("lin")||o[i].classList.contains("ass")?"none":"block"}}}var contextelement=null;function handleContextMenu(e){if(hideContextMenu(),!xxdialogMode){for(var t=null!==window.pageXOffset?window.pageXOffset:(document.documentElement||document.body.parentNode||document.body).scrollLeft,o=null!==window.pageYOffset?window.pageYOffset:(document.documentElement||document.body.parentNode||document.body).scrollTop,n=document.elementFromPoint(e.pageX-t,e.pageY-o);n&&null!=n&&null==n.attributes.cmenu;)n=n.parentElement;if(null==n)return!0;t=n.attributes.cmenu.value;if("devsContentMenu"===t){contextelement=n;var i=document.getElementById("contextMenu"),o=(showContextMenuDiv(i,e.pageX,e.pageY),getNodeFromId((o=(1==Q("viewselect").value?contextelement.children[0].children[0].children[1].children[0]:contextelement.children[1]).attributes.onmouseup.value).substring(12,o.length-18))),a=GetNodeRights(o),s=0!=(16&a),r=4294967295==a||0==(512&a),l=4294967295==a||0==(1024&a);QV("cxdesktop",0!=(1&o.conn)&&4!=o.mtype&&(1==o.mtype||null==o.agent||null==o.agent.caps||0!=(1&o.agent.caps)||o.intelamt&&2==o.intelamt.state)&&(8&a||256&a)&&(4294967295==a||0==(65536&a))),QV("cxterminal",0!=(1&o.conn)&&4!=o.mtype&&(1==o.mtype||null==o.agent||null==o.agent.caps||0!=(2&o.agent.caps)||o.intelamt&&2==o.intelamt.state)&&8&a&&r),QV("cxfiles",4!=o.mtype&&2==o.mtype&&(null==o.agent||null==o.agent.caps||0!=(4&o.agent.caps))&&8&a&&l),QV("cxevents",null!=o.intelamt&&(2==o.intelamt.state||2&o.conn)&&8&a),QV("cxdetails",o.mtype<3),QV("cxwebvnc",(0!=(1&o.conn)||3==o.mtype)&&o.agent&&0!=(8&a)&&0==(536870912&features)),QV("cxwebrdp",(0!=(1&o.conn)||3==o.mtype)&&o.agent&&0!=(8&a)&&0==(1073741824&features)),QV("cxwebssh",512&features2&&(0!=(1&o.conn)||3==o.mtype)&&o.agent&&0!=(8&a)),QV("cxconsole",s&&2==o.mtype&&(null==o.agent||null==o.agent.caps||0!=(8&o.agent.caps))&&8&a),QV("cxrdp",!1),0==(1&o.conn)&&3!=o.mtype||!o.agent||0==(8&a)||0<o.agent.id&&o.agent.id<5&&("win32"!=navigator.platform.toLowerCase()||null!=serverinfo.devicemeshrouterlinks&&0==serverinfo.devicemeshrouterlinks.rdp||QV("cxrdp",!0)),QV("cxmgroupsplit",!0),QV("cxstar",!0)}else{if(null==(i=document.getElementById(t)))return!0;contextelement=n,showContextMenuDiv(i,e.pageX,e.pageY)}return haltEvent(e)}}function showContextMenuDiv(e,t,o){var n=document.documentElement.getBoundingClientRect(),i=n.height,n=n.width;e.style.left=e.style.right=e.style.top=e.style.bottom=null,n/2<t?e.style.right=n-event.pageX+"px":e.style.left=event.pageX+"px",i/2<o?e.style.bottom=i-event.pageY+"px":e.style.top=event.pageY+"px",e.style.display="block"}function cmaction(e,t){var o,n=(1==Q("viewselect").value?contextelement.children[0].children[0].children[1].children[0]:contextelement.children[1]).attributes.onmouseup.value;if(n=n.substring(12,n.length-18),9==e&&(Q("viewselect").value=3,Q("viewselect").onchange(),Q("autoConnectDesktopCheckbox").checked=!0,Q("autoConnectDesktopCheckbox").onclick()),0<e&&e<9&&(o=[0,10,12,11,13,16,17,15,19][e],t&&1==t.shiftKey?safeNewWindow(window.location.origin+"?node="+n.split("/")[2]+"&viewmode="+o+"&hide=16"+(urlargs.key?"&key="+urlargs.key:""),"meshcentral:"+n):(gotoDevice(n,o),t=meshes[currentNode.meshid],1&currentNode.conn&&2==t.mtype&&(11==o&&null==desktop&&1&currentNode.agent.caps&&connectDesktop(null,3),12==o&&null==terminal&&2&currentNode.agent.caps&&connectTerminal(null,1),13==o)&&null==files&&connectFiles(null))),10==e){for(var i=document.getElementsByClassName("DeviceCheckbox"),a=[],s=0;s<i.length;s++)!0===i[s].checked&&a.push(i[s].defaultValue.substring(6));for(s in 0==a.length&&a.push(n),a)null!=stars[a[s]]&&(delete stars[a[s]],delete a[s]);var r=Object.keys(stars).length;for(s in a)r<200&&null==stars[a[s]]&&(stars[a[s]]=1,r++);putstore("stars",JSON.stringify(stars)),updateDeviceViewDevice(n),3==Q("DevFilterSelect").value&&mainUpdate(1)}else 11==e?p10mstsc(n):12==e?p10rfb(n):13==e?p10ssh(n):14==e&&p10MCRouter(n,3)}function cmmeshaction(e){var t=contextelement.attributes.onclick.value.substring(10,contextelement.attributes.onclick.value.length-2),o=document.getElementsByClassName("DeviceCheckbox");if(1==e||2==e){for(var n=0;n<o.length;n++)o[n].attributes&&o[n].attributes.class.value.split(" ")[0]==t&&(o[n].checked=1==e);if(1==e)for(var n in nodes)nodes[n].meshid==t&&1==nodes[n].v&&(checkedNodeids[nodes[n]._id]=1);else if(2==e)for(var n in checkedNodeids){var i=getNodeFromId(n);null!=i&&i.meshid==t&&1==i.v&&delete checkedNodeids[n]}}p1updateInfo()}function cmconnectfilesaction(){connectFiles(null,1,32)}function cmtermaction(e,t){e<100?connectTerminal(null,1,{protocol:e,consent:t}):100==e&&connectTerminal(null,1,{protocol:1,requireLogin:!0,consent:t})}function cmdeskaction(e){1==e&&connectDesktop(null,3,null,72),2==e&&connectDesktop(null,3,null,8),3==e&&connectDesktop(null,3,null,64),10==e&&null!=desktop&&(desktop.sendCtrlMsg('{"ctrlChannel":"102938","type":"autolock","value":true}'),connectDesktop()),11==e&&null!=desktop&&(desktop.sendCtrlMsg('{"ctrlChannel":"102938","type":"autolock","value":false}'),connectDesktop())}function cmaltportaction(e){xxdialogMode||(setModalContent("xxAddAgent","Conexión RDP",'Puerto de conexión remoto RDP:<br /><br /><input type=text placeholder="3389" inputmode="numeric" pattern="[0-9]*" onkeypress="return (event.keyCode == 8) || (event.charCode >= 48 && event.charCode <= 57)" maxlength=5 id=d10rdpport type=text>'),showModal("xxAddAgentModal","idx_dlgOkButton",function(){var e=0<Q("d10rdpport").value.length?parseInt(Q("d10rdpport").value):3389;meshserver.send({action:"changedevice",nodeid:currentNode._id,rdpport:e})}),Q("d10rdpport").focus(),null!=currentNode.rdpport&&(Q("d10rdpport").value=currentNode.rdpport))}function cmsshportaction(e){xxdialogMode||(setModalContent("xxAddAgent","Conexión SSH",'Puerto de conexión remota SSH:<br /><br /><input type=text placeholder="22" inputmode="numeric" pattern="[0-9]*" onkeypress="return (event.keyCode == 8) || (event.charCode >= 48 && event.charCode <= 57)" maxlength=5 id=d10sshport type=text>'),showModal("xxAddAgentModal","idx_dlgOkButton",function(){var e=0<Q("d10sshport").value.length?parseInt(Q("d10sshport").value):22;meshserver.send({action:"changedevice",nodeid:currentNode._id,sshport:e})}),Q("d10sshport").focus(),null!=currentNode.sshport&&(Q("d10sshport").value=currentNode.sshport))}function cmrfbportaction(e){xxdialogMode||(setModalContent("xxAddAgent","Conexión VNC",'Puerto de conexión remota VNC:<br /><br /><input type=text placeholder="5900" inputmode="numeric" pattern="[0-9]*" onkeypress="return (event.keyCode == 8) || (event.charCode >= 48 && event.charCode <= 57)" maxlength=5 id=d10rfbport type=text>'),showModal("xxAddAgentModal","idx_dlgOkButton",function(){var e=0<Q("d10rfbport").value.length?parseInt(Q("d10rfbport").value):3389;meshserver.send({action:"changedevice",nodeid:currentNode._id,rfbport:e})}),Q("d10rfbport").focus(),null!=currentNode.rfbport&&(Q("d10rfbport").value=currentNode.rfbport))}function cmhttpportaction(e){xxdialogMode||(setModalContent("xxAddAgent","Conexión HTTP",'Puerto de conexión remota HTTP:<br /><br /><input type=text placeholder="80" inputmode="numeric" pattern="[0-9]*" onkeypress="return (event.keyCode == 8) || (event.charCode >= 48 && event.charCode <= 57)" maxlength=5 id=d10httpport type=text>'),showModal("xxAddAgentModal","idx_dlgOkButton",function(){var e=0<Q("d10httpport").value.length?parseInt(Q("d10httpport").value):80;meshserver.send({action:"changedevice",nodeid:currentNode._id,httpport:e})}),Q("d10httpport").focus(),null!=currentNode.httpport&&(Q("d10httpport").value=currentNode.httpport))}function cmhttpsportaction(e){xxdialogMode||(setModalContent("xxAddAgent","Conexión HTTPS",'Puerto de conexión remota HTTPS:<br /><br /><input type=text placeholder="443" inputmode="numeric" pattern="[0-9]*" onkeypress="return (event.keyCode == 8) || (event.charCode >= 48 && event.charCode <= 57)" maxlength=5 id=d10httpsport type=text>'),showModal("xxAddAgentModal","idx_dlgOkButton",function(){var e=0<Q("d10httpsport").value.length?parseInt(Q("d10httpsport").value):443;meshserver.send({action:"changedevice",nodeid:currentNode._id,httpsport:e})}),Q("d10httpsport").focus(),null!=currentNode.httpsport&&(Q("d10httpsport").value=currentNode.httpsport))}function cmfilesaction(e){var t;xxdialogMode||(t=p13sort_files(p13filetree.dir)[parseInt(contextelement.attributes.fileindex.nodeValue)],1==e?(setModalContent("xxAddAgent","Renombrar",'<input type=text id=p13renameinput maxlength=64 onkeyup=p13fileNameCheck(event) style=width:100% value="'+t.n+'" />'),showModal("xxAddAgentModal","idx_dlgOkButton",()=>p13renamefileEx(3,{action:"rename",path:p13filetreelocation.join("/"),oldname:t.n})),focusTextBox("p13renameinput"),p13fileNameCheck()):2==e?t.s<=204800?p13downloadfile(encodeURIComponentEx(p13filetreelocation.join("/")+"/"+t.n),encodeURIComponentEx(t.n),t.s,"viewer"):messagebox("Editor de Archivos","Solo se pueden editar archivos de menos de 200k."):3==e&&(setModalContent("xxAddAgent","Eliminar","¿Eliminar elemento?"),showModal("xxAddAgentModal","idx_dlgOkButton",()=>p13deletefileCm(3,t))))}function cmexpandaction(e){if(1==e)CollapsedGroups={};else{if(0==sort){for(var t in CollapsedGroups={},meshes)CollapsedGroups[t]=!0;for(var t in nodes)null==meshes[nodes[t].meshid]&&(CollapsedGroups[nodes[t].meshid]=!0)}if(1==sort){CollapsedGroups={};for(t=0;t<10;t++)CollapsedGroups["pwr:"+t]=!0}if(3==sort)for(var t in CollapsedGroups={},nodes)if((n=nodes[t]).tags)for(var o in n.tags)CollapsedGroups["tag:"+encodeURIComponentEx(n.tags[o])]=!0;if(4==sort)for(var t in CollapsedGroups={},nodes){var n=nodes[t],i=meshes[n.meshid];if(i){if(CollapsedGroups["tag:"+encodeURIComponentEx(i.name)]=!0,n.tags)for(var o in n.tags)CollapsedGroups["tag:"+encodeURIComponentEx(i.name+" - "+n.tags[o])]=!0}else if(n.tags)for(var o in n.tags)CollapsedGroups["tag:"+encodeURIComponentEx("**INDV*~*DEVS** - "+n.tags[o])]=!0}}putstore("_collapse",JSON.stringify(CollapsedGroups)),updateCollapseAllButton(),mainUpdate(4)}function cmdeskplayeraction(e){xxdialogMode||safeNewWindow(window.location.origin+"{{{domainurl}}}player.htm"+(urlargs.key?"?key="+urlargs.key:""),"meshcentral-deskplayer")}function cmdeskshortcutaction(e){xxdialogMode||deskCustomizeKeys()}function cmdeskpreconfigtypeaction(e){xxdialogMode||(-1==e?deskCustomizeStrings():showDeskTypeEx(e<1e3?serverinfo.preConfiguredRemoteInput[e].value:deskKeyboardStrings[e-1e3].v))}function cmdeskpreconfigscriptaction(e){meshserver.send({action:"runcommands",nodeids:[currentNode._id],presetcmd:e})}function p13deletefileCm(e,t){files.sendText({action:"rm",reqid:1,path:p13filetreelocation.join("/"),delfiles:[t.n],rec:!1}),p13folderup(999)}function hideContextMenu(){QV("contextMenu",!1),QV("meshContextMenu",!1),QV("altPortContextMenu",!1),QV("rfbPortContextMenu",!1),QV("sshPortContextMenu",!1),QV("httpPortContextMenu",!1),QV("httpsPortContextMenu",!1),QV("filesContextMenu",!1),QV("deskPlayerContextMenu",!1),QV("deskKeyShortcutContextMenu",!1),QV("deskPreConfigShortcutContextMenu",!1),QV("deskPreConfigScriptContextMenu",!1),QV("expandAllContextMenu",!1),contextelement=null}var map_cm_popup,map_cm_editMarker,map_cm_clearMarker,map_cm_saveMarker,map_cm_nodemenu_items,contextmenu_items,currentNode,xxmap={map:null,contextmenu:null,activeInteractions:[],showindex:0,markersSource:null,markersLayer:null,mapLayer:null,mapView:null};function updateMapMarkers(e){if(0!=(32768&features)){if(null!=xxmap&&null==xxmap.map)try{loadmap()}catch(e){console.error("loadmap() exception",e)}if(null!=xxmap){var t,o=null;for(t in nodes)try{var n,i,a=map_parseNodeLoc(nodes[t]),s=xxmap.markersSource.getFeatureById(nodes[t]._id);null==a||nodes[t].meshid!=e&&null!=e?s&&xxmap.markersSource.removeFeature(s):(n=a[0],i=a[1],a[2],null==o?o=[n,i,n,i,0]:(n<o[0]&&(o[0]=n),i<o[1]&&(o[1]=i),n>o[2]&&(o[2]=n),i>o[3]&&(o[3]=i)),null==s?(addFeature(nodes[t]),o[4]=1):(updateFeature(nodes[t],s),s.setStyle(markerStyle(nodes[t],a[2]))))}catch(e){console.error("updateMapMarkers() exception",e,JSON.stringify(nodes[t]))}return o}}}function stringToIntHash(e){for(var t=0,o=0;o<e.length;o++)t=(t<<5)-t+e.charCodeAt(o),t|=0;return t}function map_parseNodeLoc(e){var t=null,o=0;return e.iploc&&(t=e.iploc,o=1),e.wifiloc&&(t=e.wifiloc,o=2),e.gpsloc&&(t=e.gpsloc,o=3),e.userloc&&(t=e.userloc,o=4),null==t||"string"!=typeof t?null:(t=t.split(","),1==o?[parseFloat(t[0])+stringToIntHash(e._id.substring(0,20))/1e11,parseFloat(t[1])+stringToIntHash(e._id.substring(20))/1e11,o]:[parseFloat(t[0]),parseFloat(t[1]),o])}function loadmap(){if(0!=(32768&features)&&null!=xxmap)if(0==(32768&features))xxmap=null;else{QV("viewselectmapoption",!0),QV("devViewButton4",!0);try{xxmap.markersSource=new ol.source.Vector,xxmap.markersLayer=new ol.layer.Vector({source:xxmap.markersSource}),xxmap.mapLayer=new ol.layer.Tile({source:new ol.source.OSM}),xxmap.mapView=new ol.View({center:ol.proj.transform([0,0],"EPSG:4326","EPSG:3857"),zoom:2,minZoom:2,maxZoom:20,extent:ol.proj.transformExtent([-1e5,-69.55,1e5,69.55],"EPSG:4326","EPSG:3857")}),xxmap.map=new ol.Map({target:"xdevicesmap",layers:[xxmap.mapLayer,xxmap.markersLayer],view:xxmap.mapView}),xxmap.map.addOverlay(map_cm_popup),xxmap.map.on("click",function(e){var t,e=xxmap.map.forEachFeatureAtPixel(e.pixel,function(e,t){return e});e&&gotoDevice(null!=(t=e.getId())?t:getCorrespondingFeature(e).getId(),10)}),xxmap.map.on("pointermove",function(e){var t,e=xxmap.map.forEachFeatureAtPixel(e.pixel,function(e,t){return e});e?(xxmap.map.getTargetElement().style.cursor="pointer",t=e.getGeometry().getCoordinates(),map_cm_popup.setPosition(t),e.getId()?QH("xmap-info-window",e.get("name")):(t=getCorrespondingFeature(e),QH("xmap-info-window",t.get("name")))):(xxmap.map.getTargetElement().style.cursor="",QH("xmap-info-window",""))});var e=new ContextMenu({width:160,defaultItems:!1,items:contextmenu_items});e.on("open",function(e){var e=xxmap.map.forEachFeatureAtPixel(e.pixel,function(e,t){return e});xxmap.contextmenu.clear(),e?e.getId()?addContextMenuItems(e):(e=getCorrespondingFeature(e))?addContextMenuItems(e):xxmap.contextmenu.extend(contextmenu_items):xxmap.contextmenu.extend(contextmenu_items)}),null==xxmap.contextmenu&&(xxmap.contextmenu=e),xxmap.map.addControl(xxmap.contextmenu)}catch(e){console.log(e),QV("viewselectmapoption",!1),QV("devViewButton4",!1),xxmap=null}}}function addFeature(e,t,o){var n=getModifiedFeature(e._id);n?xxmap.markersSource.addFeature(n):(t||o||(t=(n=map_parseNodeLoc(e))[0],o=n[1]),180<o&&meshserver.send({action:"changedevice",nodeid:e._id,userloc:[t,o=180-o]}),t<90&&-90<t&&o<180&&-180<o&&((n=new ol.Feature({geometry:new ol.geom.Point(ol.proj.transform([o,t],"EPSG:4326","EPSG:3857")),name:e.name,status:e.conn,lat:t,lon:o})).setId(e._id),n.setStyle(markerStyle(e)),xxmap.markersSource.addFeature(n)))}function removeFeature(e){e=xxmap.markersSource.getFeatureById(e._id);e&&xxmap.markersSource.removeFeature(e)}function updateFeature(e,t){e.conn!=t.get("status")&&(t.set("status",e.conn),t.setStyle(markerStyle(e)));var o,n=map_parseNodeLoc(e);null!=n&&(o=n[0],n=n[1],o==t.get("lat")&&n==t.get("lon")||(t.set("lat",o),t.set("lon",n),n=ol.proj.transform([parseFloat(n),parseFloat(o)],"EPSG:4326","EPSG:3857"),t.getGeometry().setCoordinates(n))),e.name!=t.get("name")&&t.set("name",e.name)}function modifyMarkerloc(e){var t,o=e.getId();o&&(e.setStyle(markerStyle(getNodeFromId(e.a),4)),getActiveInteractions(e)||(t=new ol.interaction.Modify({features:new ol.Collection([e]),pixelTolerance:10}),xxmap.activeInteractions.push({featureid:o,feature:e,interaction:t}),xxmap.map.addInteraction(t)))}function saveMarkerloc(e){var t,o=e.getId();o&&(t=getActiveInteractions(e))&&(xxmap.map.removeInteraction(t),removeInteraction(o),t=e.getGeometry().getCoordinates(),180<(e=ol.proj.transform(t,"EPSG:3857","EPSG:4326"))[0]&&(e[0]=180-e[0]),meshserver.send({action:"changedevice",nodeid:o,userloc:[e[1],e[0]]}))}function markerStyle(e,t){null==t&&(t=0,e.iploc&&(t=1),e.wifiloc&&(t=2),e.gpsloc&&(t=3),e.userloc)&&(t=4);e=connStateColor(e);return[new ol.style.Style({image:new ol.style.Icon({color:e,anchor:[.5,1],src:"images/mapmarker"+["","-ip","-wifi","-gps","-user"][t]+".png"})})]}function connStateColor(e){return 1==e.conn||3==e.conn||5==e.conn?"#00ffdd":"#C70039"}function addContextMenuItems(t){getActiveInteractions(t)?(map_cm_saveMarker.data=t,xxmap.contextmenu.push(map_cm_saveMarker)):(map_cm_editMarker.data=t,xxmap.contextmenu.push(map_cm_editMarker),getNodeFromId(t.a).userloc&&(map_cm_clearMarker.data=t,xxmap.contextmenu.push(map_cm_clearMarker))),map_cm_nodemenu_items.forEach(function(e){"Acercar a medida"==e.text||"Alejar a medida"==e.text?e.data=t:"-"!=e&&(e.data=t.getId())}),xxmap.contextmenu.extend(map_cm_nodemenu_items)}function getActiveInteractions(e){for(var t=e.getId(),o=0;o<xxmap.activeInteractions.length;o++)if(xxmap.activeInteractions[o].featureid==t)return xxmap.activeInteractions[o].interaction;return!1}function getModifiedFeature(e){if(e)for(var t=0;t<xxmap.activeInteractions.length;t++)if(xxmap.activeInteractions[t].featureid==e)return xxmap.activeInteractions[t].feature;return null}function removeInteraction(e){for(var t=-1,o=0;o<xxmap.activeInteractions.length;o++)if(xxmap.activeInteractions[o].featureid===e){t=o;break}0<=t&&xxmap.activeInteractions.splice(t,1)}function getCorrespondingFeature(e){for(var t=e.getGeometry().getCoordinates(),o=0;o<xxmap.activeInteractions.length;o++){var n=xxmap.activeInteractions[o].feature,i=n.getGeometry().getCoordinates();if(i[0].toFixed(5)==t[0].toFixed(5)&&i[1].toFixed(5)==t[1].toFixed(5))return n}return null}function refreshMap(e,t){e&&(xxmap.map.setTarget(null),xxmap.map=null,xxmap.markersSource=null,xxmap.mapView=null,xxmap.mapLayer=null,xxmap.activeInteractions=[]);e=updateMapMarkers();if(null!=e&&(t||1==e[4])){for(var t=(e[0]+e[2])/2,o=(e[1]+e[3])/2,n=Math.max(Math.abs(e[0]-e[2]),Math.abs(e[1]-e[3])),e=xxmap.map.getView(),i=(e.setCenter(ol.proj.transform([o,t],"EPSG:4326","EPSG:3857")),360),a=-2;n<i;)a++,i/=2;e.setZoom(a)}}function placeNode(e){if(!xxdialogMode){var t,o='<div style=margin-bottom:6px><label for=selectnode-search>Buscar</label>&nbsp&nbsp<input type=text placeholder="Nombre del dispositivo" id="selectnode-search" onchange=onPlaceNodeInputChange() onkeyup=onPlaceNodeInputChange() autocomplete=off style=width:120px></div><div id=placenode style="height:254px;overflow-y:auto;width:100%;margin:12px 1px 4px 1px;"><div id=noNodesMapPlace style=text-align:center;width:100%;display:none>No se encontraron dispositivos.</div>';for(t in nodes)o=(o+="<div class=noselect id="+nodes[t]._id+"-rowid onclick=selectNodeToPlace(event,'"+nodes[t]._id+"') style=background-color:lightgray;margin-bottom:4px;border-radius:2px><input name=PlaceMapDeviceCheckbox id="+nodes[t]._id+'-checkid type=checkbox class="form-check-input me-2" style=width:16px;display:inline />')+"<div class=j"+nodes[t].icon+" style=width:16px;height:16px;margin-top:2px;margin-right:4px;display:inline-block></div><div style=width:16px;display:inline>"+nodes[t].name+"</div></div>";setModalContent("xxAddAgent","Selecciona un nodo para colocar",o+"</div>"),showModal("xxAddAgentModal","idx_dlgOkButton",()=>placeNodeEx(3,e)),onPlaceNodeInputChange()}}function placeNodeEx(e,t){var o,n,i,a,s=document.getElementsByName("PlaceMapDeviceCheckbox");for(o in s)s[o].checked&&(n=getNodeFromId(s[o].id.substring(0,s[o].id.length-8)))&&(i=xxmap.markersSource.getFeatureById(o),a=[(a=ol.proj.transform(t,"EPSG:3857","EPSG:4326"))[1],a[0]],i&&(i.getGeometry().setCoordinates(t),getActiveInteractions(i))?saveMarkerloc(i):meshserver.send({action:"changedevice",nodeid:n._id,userloc:a}))}function onPlaceNodeInputChange(){updatePlaceNodeTable(Q("selectnode-search").value.trim().toLowerCase())}function updatePlaceNodeTable(e){document.getElementsByName("PlaceMapDeviceCheckbox");var t,o=0;for(t in nodes){var n=0<=nodes[t].namel.indexOf(e)||""==e||null!=nodes[t].rnamel&&0<=nodes[t].rnamel.indexOf(e);n&&o++,QV(nodes[t]._id+"-rowid",n)}QV("noNodesMapPlace",0==o)}function selectNodeToPlace(e,t){"PlaceMapDeviceCheckbox"!=e.target.name&&((e=Q(t+"-checkid")).checked=!e.checked);var o,n=document.getElementsByName("PlaceMapDeviceCheckbox"),i=0;for(o in n)n[o].checked&&i++;QE("idx_dlgOkButton",0<i)}function addMeshOptions(e,t){}function meshOptionRmvMod(e,t){}function meshExists(){for(var e in meshes)if(meshes[e])return!0;return!1}function setMeshView(e){var t=Q("select-mesh");t[t.selectedIndex].value==e&&(t[0].selected=!0,onSelectMeshChange())}function clearMeshOptions(){}function getSearchLocation(){try{var e,t=Q("mapSearchLocation").value.trim();0<t.length&&((e=new XMLHttpRequest).onreadystatechange=function(){4==e.readyState&&200==e.status&&formatSearchData(e.responseText)},e.open("GET","https://nominatim.openstreetmap.org/search?q="+t+"&format=json",!0),e.send())}catch(e){}}function formatSearchData(e){try{QH("xmapSearchResults","");for(var t=JSON.parse(e),o=0,n='<div class="xmapItem">',i=0;i<t.length;i++)t[i].display_name&&t[i].boundingbox[0]&&t[i].boundingbox[1]&&t[i].boundingbox[2]&&t[i].boundingbox[3]&&(o++,n+='<div class="xmapItemSel1" onclick=mapGotoSelectedLocation(this)><div>'+t[i].display_name+"</div><div style=display:none>"+t[i].boundingbox[0]+"!#!"+t[i].boundingbox[1]+"!#!"+t[i].boundingbox[2]+"!#!"+t[i].boundingbox[3]+"</div></div>");n+="</div>",1==o?zoomToExtent([parseFloat(t[0].boundingbox[2]),parseFloat(t[0].boundingbox[0]),parseFloat(t[0].boundingbox[3]),parseFloat(t[0].boundingbox[1])]):(0==o&&(n="<div style=width:200px>No se ha encontrado ninguna ubicación.<div>"),QV("xmapSearchResultsDlg",!0)),QH("xmapSearchResults",n)}catch(e){}}function mapGotoSelectedLocation(e){e=e.children[1].innerHTML.split("!#!");zoomToExtent([parseFloat(e[2]),parseFloat(e[0]),parseFloat(e[3]),parseFloat(e[1])]),mapCloseSearchWindow()}function mapCloseSearchWindow(){QH("xmapSearchResults",""),QV("xmapSearchResultsDlg",!1)}function zoomToLocation(e,t){var o=xxmap.map.getView();o.setCenter(e),o.setZoom(t)}function zoomToFitExtent(){var e;0<xxmap.markersSource.getFeatures().length&&(e=xxmap.markersSource.getExtent(),xxmap.map.getView().fit(e,xxmap.map.getSize()))}function zoomToExtent(e){e=ol.proj.transformExtent(e,ol.proj.get("EPSG:4326"),ol.proj.get("EPSG:3857"));xxmap.map.getView().fit(e,xxmap.map.getSize())}function refreshDevice(e){currentNode&&currentNode._id==e&&gotoDevice(e,xxcurrentView,!0)}32768&features&&(map_cm_popup=new ol.Overlay({element:Q("xmap-info-window"),positioning:"bottom-center",stopEvent:!1}),map_cm_editMarker={text:"Modificar ubicación del nodo",callback:function(e){modifyMarkerloc(e.data)}},map_cm_clearMarker={text:"Remover ubicación del nodo",callback:function(e){meshserver.send({action:"changedevice",nodeid:e.data.a,userloc:[]})}},map_cm_saveMarker={text:"Guardar ubicación del nodo",callback:function(e){saveMarkerloc(e.data)}},map_cm_nodemenu_items=[{text:"Información general",callback:function(e){null!=e.data&&gotoDevice(e.data,10)}},{text:"Escritorio",callback:function(e){null!=e.data&&gotoDevice(e.data,11)}},{text:"Terminal",callback:function(e){null!=e.data&&gotoDevice(e.data,12)}},{text:"Intel&reg; AMT",callback:function(e){null!=e.data&&gotoDevice(e.data,14)}},"-",{text:"Acercar a medida",callback:function(e){zoomToLocation(e.data.getGeometry().getCoordinates(),19)}},{text:"Alejar a medida",callback:function(e){zoomToLocation(e.data.getGeometry().getCoordinates(),2)}}],contextmenu_items=[{text:"Actualizar",callback:function(){refreshMap(!0,!0)}},{text:"Zoom para adaptarse a la extensión",callback:function(){zoomToFitExtent()}},{text:"Centrar mapa aquí",callback:function(e){xxmap.mapView.animate({center:e.coordinate})}},{text:"Coloca el nodo aquí",callback:function(e){placeNode(e.coordinate)}}]);var powerTimelineNode=null,powerTimelineReq=null,powerTimelineUpdate=null,powerTimeline=null,deviceSharesNode=null,deviceSharesReq=null,deviceShares=null;function getCurrentNode(){return currentNode}function gotoDevice(e,t,o,n){if(!n||3!=n.which&&2!=n.button)if(!0!==userinfo.emailVerified&&1==serverinfo.emailcheck&&4294967295!=userinfo.siteadmin)setModalContent("xxAddAgent","Seguridad de la Cuenta",'No se puede acceder a esta función hasta que se verifique una dirección de correo electrónico. Esto es necesario para recuperar la contraseña. Ve a la pestaña "Mi cuenta" para cambiar y verificar una dirección de correo electrónico.'),showModal("xxAddAgentModal","idx_dlgOkButton");else if(262144&features&&0==count2factoraAuths())setModalContent("xxAddAgent","Seguridad de la Cuenta",'No se puede acceder a esta función hasta que se habilite la autenticación de dos factores. Esto es necesario para mayor seguridad. Ve a la pestaña "Mi cuenta" y revisa la sección "Seguridad de la cuenta".'),showModal("xxAddAgentModal","idx_dlgOkButton");else if(!n||1!=n.shiftKey&&2!=n.which&&1!=n.button){var i=getNodeFromId(e);if(null!=i){null!=currentNode&&currentNode._id==i._id&&0!=(1&i.conn)||deviceDetailsStatsClear();var a=meshes[i.meshid],s=GetNodeRights(i),H=null==currentNode||currentNode._id!=e;if(!currentNode||currentNode._id!=i._id||1==o){currentNode=i,QV("deskPreConfigScriptContextMenu1",2==currentNode.mtype&&isWindowsNode(currentNode)),QV("deskPreConfigScriptContextMenu2",2==currentNode.mtype&&!isWindowsNode(currentNode)),QV("p10deviceNotify",null!=currentNode.sessions&&(null!=currentNode.sessions.kvm||null!=currentNode.sessions.terminal||null!=currentNode.sessions.files||null!=currentNode.sessions.tcp||null!=currentNode.sessions.udp)),QV("p10deviceStar",1==stars[currentNode._id]),QV("p10deviceHelp",null!=currentNode.sessions&&null!=currentNode.sessions.help),null!=currentNode.sessions&&null!=currentNode.sessions.msg?(QV("p10deviceMsg",!0),QH("p10deviceMsg",Object.keys(currentNode.sessions.msg).length)):QV("p10deviceMsg",!1),QV("p10deviceBattery",!1),null!=currentNode.sessions&&null!=currentNode.sessions.battery?(f="","ac"==(r=currentNode.sessions.battery).state&&(f="El dispositivo está enchufado"),"dc"==r.state&&(f="El dispositivo funciona con batería"),d="",w=-1,"number"==typeof r.level&&0<=r.level&&r.level<=100&&(d=r.level+"%",5<(w=Math.floor((r.level+10)/25)+1)&&(lvl=5),"ac"==r.state)&&(100==r.level?w=11:w+=5),0<w&&(Q("p10deviceBattery").title=null!=f?f+", "+d:d,QV("p10deviceBattery",!0),Q("p10deviceBattery").className="deviceBatteryLarge deviceBatteryLarge"+w)):QV("p10deviceBattery",!1);var r=EscapeHtml(i.name),l=(0==r.length&&(r="<i>Ninguno</i>"),f=r=0==(4&s)||a.flags&&0!=(2&a.flags)?r:'<span tabindex=0 title="Haz clic aquí para editar el nombre del dispositivo del lado del servidor" onclick=showEditNodeValueDialog(0) onkeyup="if (event.key == \'Enter\') showEditNodeValueDialog(0)" role="button">'+r+' <i class="fa-solid fa-pencil fa-2xs"/></i></span>',a&&(r+="<span style=color:#AAA;font-size:small> - "+EscapeHtml(a.name)+"</span>"),QH("p10deviceName",r),QH("p11deviceName",r),QH("p12deviceName",r),QH("p13deviceName",r),QH("p14deviceName",r),QH("p15deviceName","Consola -"+r),QH("p16deviceName",r),QH("p17deviceName",r),QH("p19deviceName",r),"<table style=width:100%>"),d=(0!=(8&args.hide)&&(l+="<br />"+addDeviceAttribute("Nombre",f)),a&&(l+=addDeviceAttribute('<span title="El nombre del grupo de dispositivos al que pertenece esta computadora.">Grupo</span>','<a href=# title="El nombre del grupo de dispositivos al que pertenece esta computadora" onclick=gotoMesh("'+i.meshid+'") style=cursor:pointer>'+EscapeHtml(meshes[i.meshid].name)+"</a>")),null!=i.rname&&i.name!=i.rname&&(l+=addDeviceAttribute('<span title="El nombre de esta computadora como se establece en el sistema operativo">Nombre del Sistema Operativo</span>','<span title="El nombre de esta computadora como se establece en el sistema operativo">'+EscapeHtml(i.rname)+"</span>")),(0==(1&features)&&4!=i.mtype||3==i.mtype)&&(l+=addDeviceAttribute("Nombre de Host",addLinkConditional(i.host?EscapeHtml(i.host):"<i>Ninguno</i>","showEditNodeValueDialog(1)",4&s))),i.desc?EscapeHtml(i.desc):"<i>Ninguno</i>");if(l+=addDeviceAttribute("Descripción",0!=(4&s)?"<span onclick=showEditNodeValueDialog(2) style=cursor:pointer>"+d+' <i class="fa-solid fa-pencil fa-xs" role="button"></i></span>':d),4==i.mtype&&(null!=i.portnum&&(l+=addDeviceAttribute("Número de puerto",i.portnum)),null!=i.porttype)&&(l+=addDeviceAttribute("Tipo de puerto",i.porttype)),null!=i.agent&&null!=i.agent.id&&3==i.mtype?(4==i.agent.id&&(l+=addDeviceAttribute("Tipo de dispositivo","Windows")),6==i.agent.id&&(l+=addDeviceAttribute("Tipo de dispositivo","Linux")),29==i.agent.id&&(l+=addDeviceAttribute("Tipo de dispositivo","macOS"))):null!=i.agent&&null!=i.agent.id&&null!=i.agent.ver&&(x="",x=i.agent.id<=agentsStr.length?agentsStr[i.agent.id]:agentsStr[0],0!=i.agent.ver&&(x+=" v"+i.agent.ver),14==i.agent.id&&(x=i.agent.core),!1===i.agent.root&&0!=(1&i.conn)&&(x+=", Restringido"),l+=addDeviceAttribute("Agente Mesh",x)),null!=i.intelamt&&(x="",w={0:nobreak("No Activada (Pre)"),1:nobreak("No Activada (entrada)"),2:nobreak("Activado")},null!=i.intelamt.ver&&null==i.intelamt.state?x+="<i>Estado Desconocido</i>, v"+EscapeHtml(i.intelamt.ver):null==i.intelamt.ver&&2==i.intelamt.state?x+="<i>Activado</i>":null==i.intelamt.ver||null==i.intelamt.state?x+="<i>Versión y Estado Desconocidos</i>":(x+=w[i.intelamt.state],2==i.intelamt.state&&i.intelamt.flags&&(2&i.intelamt.flags?x+=' <span title="Intel&reg; AMT está activado en Modo de Control de Cliente (CCM)">CCM</span>':4&i.intelamt.flags&&(x+=' <span title="Intel&reg; AMT esta activado en Admin Control Mode (ACM)">ACM</span>')),x+=", v"+EscapeHtml(i.intelamt.ver)),2==i.intelamt.state&&(1==i.intelamt.tls&&(x+=', <span title="Intel&reg; AMT está configurado con seguridad de red TLS">TLS</span>'),r=!1,null==i.intelamt.user||""==i.intelamt.user?0!=(4&s)?(x+=', <i style=color:#FF0000;cursor:pointer title="Editar Credenciales de Intel&reg; AMT" onclick=editDeviceAmtSettings("'+i._id+'")>Sin Credenciales</i>',r=!0):x+=", <i style=color:#FF0000>Sin Credenciales</i>":0!=(1&features2)&&null!=i.intelamt.warn&&(f=null,0!=(1&i.intelamt.warn)&&(f="Credenciales No Válidas"),null!=(f=0!=(8&i.intelamt.warn)?"Probar Credenciales":f))&&(0!=(4&s)?(x+=', <i style=color:#FF0000;cursor:pointer title="Editar Credenciales de Intel&reg; AMT" onclick=editDeviceAmtSettings("'+i._id+'")>'+f+"</i>",r=!0):x+=", <i style=color:#FF0000>"+f+"</i>"),x+=" ",r=0!=(4&s)&&0==(1&features2)||r)&&(x+='<img src=images/link4.png height=10 width=10 title="Editar Credenciales de Intel&reg; AMT" style=cursor:pointer onclick=editDeviceAmtSettings("'+i._id+'")>'),d='<span title="Intel&reg; Manageability Engine">Intel&reg; ME<span>',"number"==typeof i.intelamt.sku&&(0!=(8&i.intelamt.sku)?d='<span title="Intel&reg; Active Management Technology">Intel&reg; AMT<span>':0!=(16&i.intelamt.sku)&&(d='<span title="Intel&reg; Standard Manageability">Intel&reg; SM<span>')),l+=addDeviceAttribute(d,x)),null!=i.agent&&null!=i.agent.tag?l+=addDeviceAttribute("Etiqueta del Agente",p=(p=EscapeHtml(i.agent.tag)).startsWith("mailto:")?'<a href="'+EscapeHtml(p)+'">'+EscapeHtml(p.substring(7))+"</a>":p):null!=i.intelamt&&null!=i.intelamt.tag&&(l+=addDeviceAttribute("Etiqueta de Intel&reg; AMT",p=(p=EscapeHtml(i.intelamt.tag)).startsWith("mailto:")?'<a href="'+EscapeHtml(p)+'">'+EscapeHtml(p.substring(7))+"</a>":p)),i.osdesc&&(l+=addDeviceAttribute("Sistema Operativo",i.osdesc)),i.wsc&&(u=[],null!=i.wsc.antiVirus&&("OK"==i.wsc.antiVirus?u.push("AV - <span style=color:green>OK</span>"):u.push("AV - <span style=color:red>MALO</span>")),null!=i.wsc.autoUpdate&&("OK"==i.wsc.autoUpdate?u.push("Actualizar - <span style=color:green>OK</span>"):u.push("Actualizar - <span style=color:red>MALO</span>")),null!=i.wsc.firewall&&("OK"==i.wsc.firewall?u.push("Cortafuegos - <span style=color:green>OK</span>"):u.push("Cortafuegos - <span style=color:red>MALO</span>")),l+=addDeviceAttribute("Seguridad de Windows",u.join(", "))),i.defender&&(u=[],null!=i.defender.RealTimeProtection&&(1==i.defender.RealTimeProtection?u.push("RealTimeProtection - <span style=color:green>On</span>"):u.push("RealTimeProtection - <span style=color:red>Apagado</span>")),null!=i.defender.TamperProtected&&(1==i.defender.TamperProtected?u.push("TamperProtection - <span style=color:green>On</span>"):u.push("TamperProtection - <span style=color:red>Apagado</span>")),0<u.length)&&(l+=addDeviceAttribute("Windows Defender",u.join(", "))),i.av&&0<i.av.length){var c,u=[];for(g in i.av)i.av[g].product&&(c=EscapeHtml(i.av[g].product),!0!==i.av[g].enabled&&(c+=" - <span style=color:red>Deshabilitado</span>"),!0!==i.av[g].updated&&(c+=" - <span style=color:red>Desactualizado</span>"),1==i.av[g].enabled&&1==i.av[g].updated&&(c+=" - <span style=color:green>OK</span>"),u.push(c));l+=addDeviceAttribute("Antivirus",u.join("<br />"))}i.users&&0<i.users.length&&(w=i.users.map(function(e){return addKeyLinkConditional(EscapeHtml(e),"Bloqueada",i.lusers&&0<=i.lusers.indexOf(e))}).join(", "),l+=addDeviceAttribute(1<i.users.length?"Usuarios activos":"Usuario activo",w)),null!=i.agent&&14!=i.agent.id&&3!=i.mtype&&(f=[],r=0,i.consent&&(r=i.consent),serverinfo.consent&&(r|=serverinfo.consent),64&r&&8&r?f.push("Mensaje de Escritorio + Barra de Herramientas"):64&r?f.push("Barra de Herramientas de Escritorio"):8&r?f.push("Mensaje de Escritorio"):1&r&&f.push("Notificación de Escritorio"),16&r?f.push("Mensaje en Terminal"):2&r&&f.push("Notificación de Terminal"),32&r?f.push("Solicitud de Archivos"):4&r&&f.push("Notificación de Archivos"),7==r&&(f=["Siempre Notificar"]),l+=addDeviceAttribute("Consentimiento del Usuario",addLinkConditional(f=""==(f=(f=56==(56&r)?["Siempre Preguntar"]:f).join(", "))?"<i>Ninguno</i>":f,"p20editmeshconsent(3)",1&s)));var d=[],p=(null!=userinfo.notify&&null!=userinfo.notify[i._id]&&(2&(x=userinfo.notify[i._id])&&d.push("Conectar"),4&x&&d.push("Desconectar"),null!=i.intelamt&&8&x&&d.push("Intel&reg; AMT"),16384&features2&&userinfo.emailVerified&&(k=0,16&x&&k++,32&x&&k++,64&x&&k++,0<k)&&d.push(format("Correo Electronico ({0})",k)),null!=userinfo.msghandle)&&0!=(33554432&features2)&&(k=0,128&x&&k++,256&x&&k++,512&x&&k++,0<k)&&d.push(format("Mensajería ({0})",k)),l+=addDeviceAttribute("Notificaciones",addLink(d=""==(d=d.join(", "))?"<i>Ninguno</i>":d,"p20editDeviceNotify()")),i.conn),m=(p&&1<p&&(w=[],0!=(1&i.conn)&&w.push('<span title="El Agente Mesh está conectado y listo para ser utilizado.">Agente Mesh</span>'),0!=(2&i.conn)?w.push('<span title="Intel&reg; AMT CIRA está conectado y listo para usar.">Intel&reg; AMT CIRA</span>'):0!=(4&i.conn)&&w.push('<span title="Intel&reg; AMT es enrutable y está listo para usar.">Intel&reg; AMT</span>'),0!=(8&i.conn)&&w.push('<span title="Se puede alcanzar al Agente Mesh utilizando otro agente en modo Relay.">Relé de Mesh</span>'),0!=(16&i.conn)&&w.push('<span title="La conexión MQTT al dispositivo está activa.">MQTT</span>'),l+=addDeviceAttribute("Conectividad",w.join(", "))),"<i>Ninguno</i>");if(null!=i.tags)for(var g in m="",i.tags)m+="<span class=tagSpan>"+EscapeHtml(i.tags[g])+"</span> ";l+=addDeviceAttribute("Etiquetas",0!=(4&s)?"<span onclick=showEditNodeValueDialog(3) style=line-height:26px;cursor:pointer>"+m+' <i class="fa-solid fa-pencil fa-xs" role="button"></i></span>':"<span style=line-height:26px>"+m+"</span>"),null==i.ssh&&null==i.rdp||(u=[],0!=(4&s)?(null!=i.ssh&&u.push("<span onclick=showClearSshDialog(3) style=cursor:pointer>"+(1==i.ssh?"SSH-Usuario+Pass":2==i.ssh?"SSH-Usuario+Clave+Pasar":"SSH-Usuario+Clave")+' <i class="fa-solid fa-pencil fa-xs" role="button"></i></span>'),null!=i.rdp&&u.push('<span onclick=showClearRdpDialog(3) style=cursor:pointer>RDP <i class="fa-solid fa-pencil fa-xs" role="button"></i></span>')):(null!=i.ssh&&u.push(1==i.ssh?"SSH-Usuario+Pass":2==i.ssh?"SSH-Usuario+Clave+Pasar":"SSH-Usuario+Clave"),null!=i.rdp&&u.push("RDP")),l+=addDeviceAttribute("Credenciales",u.join(", ")));var v=[];for(g in meshes)meshes[g].relayid==i._id&&v.push('<a href=# onclick=gotoMesh("'+meshes[g]._id+'") style=cursor:pointer>'+EscapeHtml(meshes[g].name)+"</a>");if(0<v.length&&(l+=addDeviceAttribute('<span title="Grupos de dispositivos este dispositivo es un relé para">Relé para</span>',v.join(", "))),l+="</table><br />",0!=(262220&s)&&i.mtype<3&&(null==i.agent||34!=i.agent.id)&&(l+='<input type=button class="btn btn-primary btn-sm me-2" value="Acciones" title="Realizar acciones de energía en el dispositivo" onclick=deviceActionFunction() />'),l=(l+='<input type=button class="btn btn-primary btn-sm me-2" value="Notas" title="Ver notas sobre este dispositivo" onclick=showNotes('+(0==(128&s))+',"'+encodeURIComponentEx(i._id)+'") />')+('<input type=button class="btn btn-primary btn-sm me-2" value="Registrar Evento" title="Escribe un evento para este dispositivo" onclick=writeDeviceEvent("'+encodeURIComponentEx(i._id)+'") />'),2==i.mtype&&1&p&&0!=(131072&s)&&(l+='<input type=button class="btn btn-primary btn-sm me-2" cmenu=deskPreConfigScriptContextMenu value="Ejecutar" title="Ejecutar comandos en este dispositivo." onclick=runDeviceCmd("'+encodeURIComponentEx(i._id)+'") />'),4!=i.mtype){if((8&s&&1&p&&0!=(16384&s)||1==i.pmt&&0!=(2&features2))&&(l+='<input type=button class="btn btn-primary btn-sm me-2" value="Mensaje" title="Mostrar un mensaje de texto en el dispositivo remoto" onclick=deviceMessageFunction() />'),(8&s&&1&p&&0!=(16384&s)||1==i.pmt&&0!=(2&features2))&&(l+='<input type=button class="btn btn-primary btn-sm me-2" value="Chat" title="Abrir ventana de chat en esta computadora" onclick=deviceChat(event) />'),null!=serverinfo&&null!=serverinfo.altmessenging&&8&s&&1&p)for(var g in serverinfo.altmessenging){var h=serverinfo.altmessenging[g];null!=h.type&&"device"!=h.type||(l+='<input type=button class="btn btn-primary btn-sm me-2" value="'+EscapeHtml(serverinfo.altmessenging[g].name)+'" onclick=altDeviceChat(event,'+g+") />")}!1!==serverinfo.guestdevicesharing&&null!=i.agent&&3&i.agent.caps&&1&p&&524296==(524296&s)&&(4294967295==s||0==(4096&s))?(l+='<input type=button class="btn btn-primary btn-sm me-2" value="Compartir" title="Crear un enlace para compartir este dispositivo con un invitado" onclick=showShareDevice() />',QV("DeskGuestShareButton",!0)):QV("DeskGuestShareButton",!1)}if(4==i.mtype&&1&p&&("PDU"==i.porttype?1==i.pwr?262144&s&&(l+='<input type=button class="btn btn-primary btn-sm me-2" value="Apagar" title="Apagar" onclick=setIpPduState(0) />'):8==i.pwr&&64&s&&(l+='<input type=button class="btn btn-primary btn-sm me-2" value="Encender" title="Encender" onclick=setIpPduState(1) />'):8&s&&(l+='<input type=button class="btn btn-primary btn-sm me-2" value="Control Remoto" title="Control Remoto" onclick=openIpKvmRemoteControl("'+encodeURIComponentEx(i._id)+'") />')),null!=customui&&null!=customui.devicebuttons)for(var g in customui.devicebuttons)(null==customui.devicebuttons[g].showif||null!=a&&customui.devicebuttons[g].showif==a._id||customui.devicebuttons[g].showif==currentNode._id)&&(l+='<input id="cui:'+g+'" type="button" class="btn btn-primary btn-sm me-2" value="'+customui.devicebuttons[g].name+'" onclick=customUIAction(event,"devicebuttons") />');QH("p10html",l),mainUpdate(256);var r=4294967295==s||0==(65536&s),f=4294967295==s||0==(512&s),x=4294967295==s||0==(1024&s),k=4294967295==s||0==(2048&s),l='<div class="p10html3right">';if(0!=(1&s)&&4!=i.mtype&&(l+='&nbsp;<a href=# onclick=p10showChangeGroupDialog(["'+i._id+'"]) title="Mover este dispositivo a un grupo de dispositivos diferente">Cambiar Grupo de Dispositivos</a>'),0!=(32768&s)&&(l+='&nbsp;<a href=# onclick=p10showDeleteNodeDialog("'+i._id+'") title="Remover este dispositivo">Eliminar Dispositivo</a>'),l+='</div><div class="p10html3left">',i.agent&&3!=i.mtype&&0!=(1048576&s)&&(l+='<a href=# onclick=p10showNodeNetInfoDialog("'+i._id+'") title="Mostrar información de la interfaz de red del dispositivo">Interfaces</a>&nbsp;'),32768&features&&null!=xxmap&&(l+='<a href=# onclick=p10showNodeLocationDialog("'+i._id+'") title="Mostrar información de ubicaciones del dispositivo">Ubicación</a>&nbsp;'),null==i.agent||14!=i.agent.id&&34!=i.agent.id){if(4294967295!=userinfo.siteadmin&&0!=(128&userinfo.siteadmin)||f&&0!=(8&s)&&null!=i.agent&&14!=i.agent.id&&(l+='<a href=# onclick=p10showMeshCmdDialog(1,"'+i._id+'") title="Enrutador de tráfico utilizado para conectarse a un dispositivo a través de este servidor.">MeshCmd</a>&nbsp;'),0!==args.xterm||!i.agent||0==(2&i.agent.caps)||0==(8&s)||4294967295!=s&&0!=(512&s)||(l+='<a href=# onclick=p10openxterm(event,"'+i._id+'") title="Abrir Terminal XTerm">XTerm</a>&nbsp;'),(0!=(1&p)||3==i.mtype)&&i.agent&&0!=(8&s)&&(0!=webRelayPort&&(l=(l+='<a href=# cmenu=httpPortContextMenu onclick=p10WebRouter("'+i._id+'",1,'+(i.httpport||80)+")>HTTP"+(i.httpport&&80!=i.httpport?"/"+i.httpport:"")+"</a>&nbsp;")+'<a href=# cmenu=httpsPortContextMenu onclick=p10WebRouter("'+i._id+'",2,'+(i.httpsport||443)+")>HTTPS"+(i.httpsport&&443!=i.httpsport?"/"+i.httpsport:"")+"</a>&nbsp;"),0<i.agent.id&&i.agent.id<5&&("win32"!=navigator.platform.toLowerCase()||null!=serverinfo.devicemeshrouterlinks&&0==serverinfo.devicemeshrouterlinks.rdp||(l+='<a href=# cmenu=altPortContextMenu id=rdpMCRouterLink onclick=p10MCRouter("'+i._id+'",3) title="Requiere la instalación de MeshCentral Router.">RDP'+(i.rdpport&&3389!=i.rdpport?"/"+i.rdpport:"")+"</a>&nbsp;")),4<i.agent.id&&("win32"!=navigator.platform.toLowerCase()&&"macintel"!=navigator.platform.toLowerCase()||null!=serverinfo.devicemeshrouterlinks&&0==serverinfo.devicemeshrouterlinks.ssh||(l+='<a href=# cmenu=sshPortContextMenu onclick=p10MCRouter("'+i._id+'",4,'+(i.sshport||22)+') title="Requiere la instalación de MeshCentral Router.">SSH'+(i.sshport&&22!=i.sshport?"/"+i.sshport:"")+"</a>&nbsp;"),"win32"!=navigator.platform.toLowerCase()||null!=serverinfo.devicemeshrouterlinks&&0==serverinfo.devicemeshrouterlinks.scp||(l+='<a href=# cmenu=sshPortContextMenu onclick=p10MCRouter("'+i._id+'",5,'+(i.sshport||22)+') title="Requiere la instalación de MeshCentral Router.">SCP'+(i.sshport&&22!=i.sshport?"/"+i.sshport:"")+"</a>&nbsp;")),"win32"==navigator.platform.toLowerCase()||"macintel"==navigator.platform.toLowerCase())&&null!=serverinfo.devicemeshrouterlinks&&Array.isArray(serverinfo.devicemeshrouterlinks.extralinks))for(var g in serverinfo.devicemeshrouterlinks.extralinks){var b=serverinfo.devicemeshrouterlinks.extralinks[g],y='"'+b.protocol+'"';doesDeviceMatchFilterTags(i,b.filter)&&("number"==typeof b.protocol?y=b.protocol:"http"==b.protocol?y=1:"https"==b.protocol?y=2:"rdp"==b.protocol?y=3:"ssh"==b.protocol?y=4:"scp"==b.protocol?y=5:"mcrdesktop"==b.protocol?y=6:"mcrfiles"==b.protocol&&(y=7),6!=y&&7!=y||2==i.mtype)&&(l+='<a href=# onclick=p10MCRouter("'+i._id+'",'+y+","+b.port+(b.ip?',"'+b.ip+'"':",null")+","+(b.localport||0)+') title="Requiere la instalación de MeshCentral Router.">'+b.name+"</a>&nbsp;")}0==(1&p)&&3!=i.mtype||!i.agent||0==(8&s)||0!=(536870912&features)||(l+='<a href=# cmenu=rfbPortContextMenu id=rfbLink onclick=p10rfb("'+i._id+'") title="Inicia una sesión VNC basada en web en este dispositivo.">Web-VNC</a>&nbsp;'),0==(1&p)&&3!=i.mtype||!i.agent||0==(8&s)||0!=(1073741824&features)||(l+='<a href=# cmenu=altPortContextMenu id=mstscLink onclick=p10mstsc("'+i._id+'") title="Ejecutar sesión de RDP basada en el navegador para este dispositivo.">Web-RDP</a>&nbsp;'),512&features2&&(0!=(1&p)||3==i.mtype)&&i.agent&&0!=(8&s)&&(l+='<a href=# cmenu=sshPortContextMenu id=sshLink onclick=p10ssh("'+i._id+'") title="Inicia una sesión SSH basada en web en este dispositivo.">Web-SSH</a>&nbsp;'),4294967295==s&&4194304&features&&(l+='<a href=# onclick=p10showMqttLoginDialog("'+i._id+'") title="Obtener las credenciales de inicio de sesión MQTT para este dispositivo.">Inicio de Sesión MQTT</a>&nbsp;')}l+="</div><br>",3==i.mtype?(QH("p10html3",""),QH("p10html5",l)):(QH("p10html3",l),QH("p10html5",""));var d=PowerStateStr(i.state),w="",w=(null!=i.agent&&!1===i.agent.root&&(w=', <span title="El agente se ejecuta en un dispositivo remoto con privilegios reducidos.">Restringido</span>'),0!=(1&p)&&(0<d.length&&(d+="<br/>"),4==i.mtype?"PDU"==i.porttype?d+='<span style=font-size:12px title="Puerto de conmutador conectado">Puerto de conmutador conectado</span>'+w:d+='<span style=font-size:12px title="Puerto IP-KVM conectado">Puerto IP-KVM conectado</span>'+w:d+='<span style=font-size:12px title="Agente conectado">Agente conectado</span>'+w),0!=(2&p)?(0<d.length&&(d+="<br/>"),d+='<span style=font-size:12px title="Intel&reg; AMT conectado">Intel&reg; AMT conectado</span>'):0!=(4&p)&&(0<d.length&&(d+="<br/>"),d+='<span style=font-size:12px title="Intel&reg; AMT detectado">Intel&reg; AMT detectado</span>'),0!=(16&p)&&(0<d.length&&(d+="<br/>"),d+='<span style=font-size:12px title="MQTT conectado">Canal MQTT conectado</span>'),""==d&&i.lastconnect?d="<span style=font-size:12px>Visto por última vez:<br />"+printDateTime(new Date(i.lastconnect))+"</span>":("PDU"==i.porttype||1<i.pwr&&7!=i.pwr)&&(d+="<br/>"+powerStateStrings[i.pwr]),QH("MainComputerState",d),Q("MainComputerImage").setAttribute("src","images/icons256-"+i.icon+"-1.png"),Q("MainComputerImage").className=i.conn&&0!=i.conn||3==i.mtype?"":"gray",3==i.mtype&&null!=i.agent&&4<i.agent.id&&512&features2&&(i.agent.caps=6),f&&setupTerminal(),x&&setupFiles(),0!=(16&s)),p=(w?setupConsole():15==t&&(t=10),QV("MainDevDesktop",r&&(null==i.agent&&null!=i.intelamt&&("number"!=typeof i.intelamt.sku||0!=(8&i.intelamt.sku))||null!=i.agent&&(null==i.agent.caps||0!=(1&i.agent.caps)||i.intelamt&&2==i.intelamt.state)||3==i.mtype&&(3==i.agent.id||4==i.agent.id))&&(8&s||256&s)),QV("MainDevTerminal",(null==i.agent&&null!=i.intelamt||i.agent&&null==i.agent.caps||i.agent&&0!=(2&i.agent.caps)||i.intelamt&&2==i.intelamt.state)&&8&s&&f),QV("MainDevFiles",null!=i.agent&&null!=i.agent.caps&&0!=(4&i.agent.caps)&&8&s&&x),QV("MainDevInfo",i.mtype<3&&0!=(1048576&s)),QV("MainDevAmt",null!=i.intelamt&&(2==i.intelamt.state||2&i.conn)&&8&s&&k),QV("MainDevConsole",w&&null!=i.agent&&null!=i.agent.caps&&0!=(8&i.agent.caps)&&8&s),QV("MainDevPlugins",!1),QV("p15uploadCore",null!=i.agent&&null!=i.agent.caps&&0!=(16&i.agent.caps)),QH("p15coreName",null!=i.agent&&null!=i.agent.core?i.agent.core:""),null!=i.intelamt&&"number"==typeof i.intelamt.sku&&0!=(16&i.intelamt.sku)?(QH("MainDevAmt","Intel&reg;SM"),QH("p14deviceNamePrefix","Intel&reg; SM")):(QH("MainDevAmt","Intel&reg;AMT"),QH("p14deviceNamePrefix","Intel&reg; AMT")),Q("p14iframe").contentWindow.getCurrentMeshNode()),d=(null!=p&&p._id!=currentNode._id&&Q("p14iframe").contentWindow.disconnect(),0!=(6&i.conn));if(Q("p14iframe").contentWindow.setConnectionState(d),Q("p14iframe").contentWindow.setFrameHeight("650px"),Q("p14iframe").contentWindow.setAuthCallback(updateAmtCredentials),powerTimelineNode!=currentNode._id&&powerTimelineReq!=currentNode._id&&(QH("p10html2",""),powerTimelineReq=currentNode._id,meshserver.send({action:"powertimeline",nodeid:currentNode._id}),meshserver.send({action:"lastconnect",nodeid:currentNode._id}),meshserver.send({action:"getsysinfo",nodeid:currentNode._id}),meshserver.send({action:"getnetworkinfo",nodeid:currentNode._id}),meshserver.send({action:"getNotes",id:currentNode._id}),QH("p17info2","")),deviceSharesNode!=currentNode._id&&deviceSharesReq!=currentNode._id&&(deviceSharesReq=currentNode._id,meshserver.send({action:"deviceShares",nodeid:currentNode._id})),QV("DeskTools",!1),showDeskToolsProcesses(),refreshDeviceEvents(),document.title=currentNode&&10<=xxcurrentView&&xxcurrentView<20?currentNode.name+(a?" - "+a.name:"")+" - "+decodeURIComponent("{{{extitle}}}"):decodeURIComponent("{{{extitle}}}"),H&&(p11clearConsoleMsg(),p12clearConsoleMsg(),p13clearConsoleMsg()),null!=pluginHandler&&(QH("p19headers",""),QH("p19pages",""),pluginHandler.callHook("onDeviceRefreshEnd",e,t,o,n),null!=(r=getstore("_curPluginPage",null)))&&null!=Q("p19ph-"+r)&&pluginHandler.callPluginPage(r,Q("p19ph-"+r)),l="",7&s&&(l+='<button class="btn btn-primary btn-sm me-2" onclick="return p20showAddMeshUserDialog(5)" style=cursor:pointer;margin-right:10px><i class="fa-solid fa-circle-plus"></i> Agregar Usuario</button>',null!=usergroups)){var C=0,M=!1;for(g in usergroups)null==usergroups[g].membershipType&&usergroups[g]._id.split("/")[1]==e.split("/")[1]&&(C++,null==currentNode.links||null==currentNode.links[g])&&(M=!0);0<C&&M&&(l+='<a href=# onclick="return p20showAddMeshUserDialog(6)" style=cursor:pointer;margin-right:10px><i class="fa-solid fa-circle-plus"></i> Agregar Grupo de Usuarios</a>')}l+='<table class="table table-hover" border=0 cellpadding=2 cellspacing=0 width=100%><tbody><tr style=background-color:#AAAAAA;font-weight:bold><th scope=col style=text-align:left;width:430px>Autorizaciones de Usuario</th><th scope=col style=text-align:left></th></tr>';var S=1;if(null!=currentNode.links){var A=[];for(g in currentNode.links)(g.startsWith("user/")||g.startsWith("ugrp/"))&&A.push(g);for(g in A.sort(),A){var D="",E="",T=A[g],N=currentNode.links[T].rights,I=EscapeHtml(T.split("/")[2]),E=makeUserDeviceRightsString(N),N=!1;null!=currentNode.links[T].name&&(I=EscapeHtml(currentNode.links[T].name)),T==userinfo._id&&(I=EscapeHtml(userinfo.name)),null!=users&&null!=users[T]&&(I=EscapeHtml(users[T].name)),null!=usergroups&&null!=usergroups[T]&&(I=EscapeHtml(usergroups[T].name),N=!0),0!=(2&s)&&(E=N?(D="<a href=# onclick='return p30removeUserFromNode(event,\""+encodeURIComponentEx(T)+'")\' title="Remover los permisos del grupo de usuarios a este grupo de dispositivos" style=cursor:pointer><i class="fa-solid fa-trash text-danger hoverButton"></i></a>','<span style=cursor:pointer onclick=p20showAddMeshUserDialog(6,"'+encodeURIComponentEx(T)+'")>'+E+" <img class=hoverButton style=cursor:pointer src=images/link5.png></span>"):(D="<a href=# onclick='return p30removeUserFromNode(event,\""+encodeURIComponentEx(T)+'")\' title="Remover permisos de usuario de este grupo de dispositivos" style=cursor:pointer><i class="fa-solid fa-trash text-danger hoverButton"></i></a>','<span style=cursor:pointer onclick=p20showAddMeshUserDialog(5,"'+encodeURIComponentEx(T)+'")>'+E+" <img class=hoverButton style=cursor:pointer src=images/link5.png></span>")),l+="<tr "+(++S%2==0?"style=background-color:#DDD":"")+'><td style=width:30%><div title="'+(N?"Grupo de Usuarios":"Usuario")+'" class=m'+(N?4:2)+"></div><div>&nbsp;"+(I=null!=users?N?"<a href=# onclick='gotoUserGroup(\""+encodeURIComponentEx(T)+"\");haltEvent(event);'>"+I+"</a>":"<a href=# onclick='gotoUser(\""+encodeURIComponentEx(T)+"\");haltEvent(event);'>"+I+"</a>":I)+"<div></div></div></td><td style=width:70%><div style=float:right>"+D+"</div><div>"+E+"</div></td></tr>"}}if(1==S&&(l+="<tr><td><div style=padding:6px>&nbsp;<i>No hay usuarios con permisos especiales para el dispositivo</i><div></div></div></td><td></td></tr>"),l+="</tbody></table>",null!=deviceShares&&deviceSharesNode==currentNode._id&&0<deviceShares.length){l+='<br /><table class="table table-hover" border=0 cellpadding=2 cellspacing=0 width=100%><tbody><tr style=background-color:#AAAAAA;font-weight:bold><th scope=col style=text-align:left;width:430px>Compartir dispositivo activo</th><th scope=col style=text-align:left></th></tr>';for(S=1,g=0;g<deviceShares.length;g++){var _=deviceShares[g],D="",U=(null!=_.url&&(D+='<a href="'+_.url+'" rel="noreferrer noopener" target=_blank title="Enlace para compartir dispositivo" style=cursor:pointer><img src=images/link2.png border=0 height=10 width=10></a> '),D+="<i role=button onclick='return p30removeDeviceSharing(event,\""+encodeURIComponentEx(currentNode._id)+'","'+encodeURIComponentEx(_.publicid)+'","'+encodeURIComponentEx(_.guestName)+'")\' title="Eliminar dispositivo compartido" class="fa-fw fa-solid fa-trash text-danger"></i>',""),V=(_.p<=7?U=["","Terminal","Escritorio","Escritorio + Terminal","Archivos","Terminal + Archivos","Escritorio + Archivos","Escritorio + Terminal + Archivos"][_.p]:8==_.p?U="HTTP/"+_.port:16==_.p&&(U="HTTPS/"+_.port),U),U=(null!=_.startTime&&null!=_.expireTime&&(V=format("{0}, {1} a {2}",U,printFlexDateTime(new Date(_.startTime)),printFlexDateTime(new Date(_.expireTime)))),null!=_.startTime&&null!=_.duration&&(V=_.duration<2?format("{0}, {1} por {2} minuto",U,printFlexDateTime(new Date(_.startTime)),_.duration):format("{0}, {1} durante {2} minutos",U,printFlexDateTime(new Date(_.startTime)),_.duration)),1==_.recurring&&(V+=", Recurrente diariamente"),2==_.recurring&&(V+=", Recurrente semanalmente"),0!=(2&_.p)&&!0===_.viewOnly&&(V+=", Ver solo escritorio"),null!=_.consent&&(0==_.consent?V+=", Sin consentimiento":(0!=(56&_.consent)&&(V+=", Solicitud de consentimiento"),0!=(64&_.consent)&&(V+=", Barra de herramientas"))),EscapeHtml(_.guestName));l+="<tr "+(++S%2==0?"style=background-color:#DDD":"")+"><td style=width:30%><div class=m2></div><div>&nbsp;"+(U=_.publicid.startsWith("AS:node/")?"<i>Autocompartido del agente</i>":U)+"<div></div></div></td><td style=width:70%><div style=float:right>"+D+"</div><div>"+V+"</div></td></tr>"}l+="</tbody></table>"}QH("p10html4",l);var R="";if(0==(268435456&features)&&10<=xxcurrentView&&xxcurrentView<=19&&null!=currentNode){for(var g in R="?viewmode="+xxcurrentView+"&gotonode="+currentNode._id.split("/")[2],urlargs)R+="&"+g+"="+urlargs[g];try{window.history.replaceState({},document.title,window.location.pathname+R)}catch(e){}}QV("p11DeskSessionSelector",!1),QH("p11DeskSessionSelector","")}setupDesktop(),go(t=t||10)}}else safeNewWindow(window.location.origin+"?node="+e.split("/")[2]+"&viewmode=10&hide=16"+(urlargs.key?"&key="+urlargs.key:""),"meshcentral:"+e)}function setIpPduState(e){0==e?(setModalContent("xxAddAgent","Operación de energía","Perform power off?"),showModal("xxAddAgentModal","idx_dlgOkButton",function(){meshserver.send({action:"poweraction",nodeids:[currentNode._id],actiontype:2})})):(setModalContent("xxAddAgent","Operación de energía","Perform power on?"),showModal("xxAddAgentModal","idx_dlgOkButton",function(){meshserver.send({action:"wakedevices",nodeids:[currentNode._id]})}))}function p20editDeviceNotify(){var e,t,o;return xxdialogMode||(e=0,t=16384&features2&&userinfo.emailVerified?1:0,userinfo.notify&&userinfo.notify[currentNode._id]&&(e=userinfo.notify[currentNode._id]),o='<div style="border-bottom: 1px solid #888;margin-bottom:3px">Notificaciones de página web</div><div><label><input id=p20notifyIntelDeviceConnect type=checkbox class="form-check-input me-2" />Conexiones de dispositivo</label></div><div><label><input id=p20notifyIntelDeviceDisconnect type=checkbox class="form-check-input me-2" />Desconexiones de dispositivo</label></div>',null!=currentNode.intelamt&&(t+=2,o+='<div><label><input id=p20notifyIntelAmtKvmActions type=checkbox class="form-check-input me-2" />Eventos de escritorio y serial de Intel&reg; AMT</label></div>'),1&t&&(o+='<br /><div style="border-bottom: 1px solid #888;margin-bottom:3px">Notificaciones por correo electrónico</div><div><label><input id=p20enotifyIntelDeviceConnect type=checkbox class="form-check-input me-2" />Conexiones de dispositivo</label></div><div><label><input id=p20enotifyIntelDeviceDisconnect type=checkbox class="form-check-input me-2" />Desconexiones de dispositivo</label></div><div><label><input id=p20enotifyIntelDeviceHelp type=checkbox class="form-check-input me-2" />Solicitudes de ayuda</label></div>'),null!=userinfo.msghandle&&0!=(33554432&features2)&&(o+='<br /><div style="border-bottom: 1px solid #888;margin-bottom:3px">Notificaciones de Mensajería</div><div><label><input id=p20emsgDeviceConnect type=checkbox class="form-check-input me-2" />Conexiones de dispositivo</label></div><div><label><input id=p20emsgDeviceDisconnect type=checkbox class="form-check-input me-2" />Desconexiones de dispositivo</label></div><div><label><input id=p20emsgDeviceHelp type=checkbox class="form-check-input me-2" />Solicitudes de ayuda</label></div>'),setModalContent("xxAddAgent","Opciones de Notificación",o),showModal("xxAddAgentModal","idx_dlgOkButton",()=>p20editDeviceNotifyEx(3,t)),Q("p20notifyIntelDeviceConnect").checked=2&e,Q("p20notifyIntelDeviceDisconnect").checked=4&e,2&t&&(Q("p20notifyIntelAmtKvmActions").checked=8&e),1&t&&(Q("p20enotifyIntelDeviceConnect").checked=16&e,Q("p20enotifyIntelDeviceDisconnect").checked=32&e,Q("p20enotifyIntelDeviceHelp").checked=64&e),null!=userinfo.msghandle&&0!=(33554432&features2)&&(Q("p20emsgDeviceConnect").checked=128&e,Q("p20emsgDeviceDisconnect").checked=256&e,Q("p20emsgDeviceHelp").checked=512&e)),!1}function p20editDeviceNotifyEx(e,t){var o=0,o=(o+=Q("p20notifyIntelDeviceConnect").checked?2:0)+(Q("p20notifyIntelDeviceDisconnect").checked?4:0);2&t&&(o+=Q("p20notifyIntelAmtKvmActions").checked?8:0),1&t&&(o=(o=(o+=Q("p20enotifyIntelDeviceConnect").checked?16:0)+(Q("p20enotifyIntelDeviceDisconnect").checked?32:0))+(Q("p20enotifyIntelDeviceHelp").checked?64:0)),null!=userinfo.msghandle&&0!=(33554432&features2)&&(o=(o=(o+=Q("p20emsgDeviceConnect").checked?128:0)+(Q("p20emsgDeviceDisconnect").checked?256:0))+(Q("p20emsgDeviceHelp").checked?512:0)),meshserver.send({action:"changeusernotify",nodeid:currentNode._id,notify:o})}function makeUserDeviceRightsString(e){var t,o;return 57592==e?"Todos los Permisos en el Dispositivo":(t=[],8&e&&(o=[],256&e&&o.push("Sin Entrada"),512&e&&o.push("Sin Terminal"),1024&e&&o.push("Sin Archivos"),2048&e&&o.push("Sin AMT"),4096&e&&o.push("Entrada Limitada"),65536&e&&o.push("Sin Escritorio"),524288&e&&!1!==serverinfo.guestdevicesharing&&o.push("Invitado Compartir"),t.push(0<o.length?"Control ("+o.join(", ")+")":"Control")),16&e&&t.push("Consola"),32&e&&t.push("Archivos del Servidor"),64&e&&t.push("Despertar"),128&e&&t.push("Notas"),8192&e&&t.push("Limitar Eventos"),16384&e&&t.push("Chat"),32768&e&&t.push("Desinstalar"),131072&e&&t.push("Comandos"),262144&e&&t.push("Reset/Apagado"),524288&e&&t.push("Intercambio"),1048576&e&&t.push("Detalles"),2097152&e&&t.push("Relé"),0==t.length?"Sin Permisos":t.join(", "))}function makeDeviceGroupRightsString(e){var t,o;return 4294967295==e?"Todos los Permisos":(t=[],1&e&&t.push("Editar Grupo"),2&e&&t.push("Administrar Usuarios"),4&e&&t.push("Administrar Dispositivos"),8&e&&(o=[],256&e&&o.push("Sin Entrada"),512&e&&o.push("Sin Terminal"),1024&e&&o.push("Sin Archivos"),2048&e&&o.push("Sin AMT"),4096&e&&o.push("Entrada Limitada"),65536&e&&o.push("Sin Escritorio"),524288&e&&!1!==serverinfo.guestdevicesharing&&o.push("Invitado Compartir"),t.push(0<o.length?"Control ("+o.join(", ")+")":"Control")),16&e&&t.push("Consola"),32&e&&t.push("Archivos del Servidor"),64&e&&t.push("Despertar"),128&e&&t.push("Notas"),8192&e&&t.push("Limitar Eventos"),16384&e&&t.push("Chat"),32768&e&&t.push("Desinstalar"),131072&e&&t.push("Comandos"),262144&e&&t.push("Reset/Apagado"),524288&e&&t.push("Intercambio"),1048576&e&&t.push("Detalles"),2097152&e&&t.push("Relé"),0==t.length?"Sin Permisos":t.join(", "))}function runDeviceCmd(e){xxdialogMode||d2runCommandDialog({nodeids:[e?decodeURIComponent(e):currentNode._id]})}function writeDeviceEvent(e){xxdialogMode||(setModalContent("xxAddAgent","Agregar Evento del Dispositivo","<textarea id=d2devEvent style=width:100%;height:200px;resize:none;overflow-y:scroll></textarea><span style=font-size:10px>Esto agregará una entrada al registro de eventos de este dispositivo.<span>"),showModal("xxAddAgentModal","idx_dlgOkButton",function(){writeDeviceEventEx(3,e)}),Q("d2devEvent").focus())}function writeDeviceEventEx(e,t){meshserver.send({action:"setDeviceEvent",nodeid:decodeURIComponent(t),msg:encodeURIComponentEx(Q("d2devEvent").value)})}function showNotes(e,t){xxdialogMode||(e="<textarea id=d2devNotes ro="+e+" noteid="+(t=null==t?encodeURIComponentEx("p"+userinfo._id):t)+' readonly class="form-control" style=width:100%;height:200px;resize:none;overflow-y:scroll></textarea>',t.startsWith("node%2F%2F")&&(e+="<span style=font-size:10px>Las notas del grupo de dispositivos pueden ser vistas y modificadas por otros administradores de grupos de dispositivos.<span>"),"true"===showNotesPanel&&(e+=" <span style=font-size:10px><a target=_blank href='https://www.markdownguide.org/cheat-sheet/'>Markdown syntax supported</a></span>"),setModalContent("xxAddAgent","Notas",e),showModal("xxAddAgentModal","idx_dlgOkButton",function(){showNotesEx(2,t)}),meshserver.send({action:"getNotes",id:decodeURIComponent(t)}))}function showNotesEx(e,t){Q("notesPanelArea").innerHTML=marked&&DOMPurify?DOMPurify.sanitize(marked.parse(Q("d2devNotes").value,{breaks:!0}),{USE_PROFILES:{html:!0}}):Q("d2devNotes").value,meshserver.send({action:"setNotes",id:decodeURIComponent(t),notes:encodeURIComponentEx(Q("d2devNotes").value)}),"true"===showNotesPanel&&""!=Q("d2devNotes").value?QV("notesPanel",!0):QV("notesPanel",!1)}function openIpKvmRemoteControl(e){xxdialogMode||safeNewWindow("/ipkvm.ashx/"+(e=decodeURIComponent(e).split("/")[2])+"/","ipkvm:"+e)}function deviceChat(e){var t;xxdialogMode||(t="/messenger?id=meshmessenger/"+encodeURIComponentEx(currentNode._id)+"/"+encodeURIComponentEx(userinfo._id)+"&title="+currentNode.name,""!=serverinfo.domainsuffix&&(t="/"+serverinfo.domainsuffix+t),null!=authCookie&&""!=authCookie&&(t+="&auth="+authCookie),1==currentNode.pmt&&0!=(2&features2)&&(t+="&pmt=1"),e&&1==e.shiftKey?safeNewWindow(t,"meshmessenger:"+currentNode._id):safeNewWindow(t,"meshmessenger:"+currentNode._id,"directories=no,titlebar=no,toolbar=no,location=no,status=no,menubar=no,scrollbars=no,resizable=no,width=400,height=560"),meshserver.send({action:"meshmessenger",nodeid:decodeURIComponent(currentNode._id)}))}function altDeviceChat(e,t){var o,n,i,a,s,r;xxdialogMode||(o=serverinfo.altmessenging[t].url.split("{0}").join(currentNode._id.split("/")[2]).split("{1}").join(currentNode._id.split("/")[2]).split("{2}").join(currentNode._id.split("/")[2]).split("{3}").join(currentNode._id.split("/")[2]),a=n=encodeURIComponentEx(userinfo._id.split("/")[2]),s=i=encodeURIComponentEx(userinfo._id.split("/").join("-")),null!=userinfo.realname&&(a=encodeURIComponentEx(userinfo.realname.split(" ").join("")),s=encodeURIComponentEx(userinfo.realname.split(" ").join("-"))),r=o=o.split("{4}").join(n).split("{5}").join(i).split("{6}").join(a).split("{7}").join(s),"string"==typeof serverinfo.altmessenging[t].localurl&&(r=(r=serverinfo.altmessenging[t].localurl.split("{0}").join(currentNode._id.split("/")[2]).split("{1}").join(currentNode._id.split("/")[2]).split("{2}").join(currentNode._id.split("/")[2]).split("{3}").join(currentNode._id.split("/")[2])).split("{4}").join(n).split("{5}").join(i).split("{6}").join(a).split("{7}").join(s)),""!=o&&meshserver.send({action:"msg",type:"openUrl",nodeid:currentNode._id,url:o}),""!=r&&safeNewWindow(r,"altmessenger:"+currentNode._id,"directories=no,titlebar=no,toolbar=no,location=no,status=no,menubar=no,scrollbars=no,resizable=no,width=400,height=560"))}function deviceToggleBackground(){xxdialogMode||meshserver.send({action:"msg",type:"deskBackground",nodeid:currentNode._id,op:1})}function deviceUrlFunction(){xxdialogMode||(xxdialogButtons=3,setModalContent("xxAddAgent","Abrir Página en Dispositivo",'<input id=d2devurl placeholder="http://server.com" style=width:100%;overflow-y:scroll onkeyup=deviceUrlFunctionValidate() onchange=deviceUrlFunctionValidate()></input>'),showModal("xxAddAgentModal","idx_dlgOkButton",deviceUrlFunctionEx),Q("d2devurl").focus(),deviceUrlFunctionValidate())}function deviceUrlFunctionValidate(){var e=Q("d2devurl").value.toLowerCase();QE("idx_dlgOkButton",e.startsWith("http://")&&7<e.length||e.startsWith("https://")&&8<e.length)}function deviceUrlFunctionEx(){meshserver.send({action:"msg",type:"openUrl",nodeid:currentNode._id,url:Q("d2devurl").value})}function deviceMessageFunction(){xxdialogMode||(xxdialogButtons=3,setModalContent("xxAddAgent","Mensaje del dispositivo","<div style=margin-bottom:4px>Mostrar un cuadro de mensaje en el dispositivo remoto.</div><textarea id=d2devMessage style=width:100%;height:80px;resize:none;overflow-y:scroll;box-sizing:border-box;margin-bottom:4px></textarea><select style=width:100% id=d2devTimeout><option value=2 selected>Show for 2 Minutes (Default)</option><option value=10>Show for 10 minutes</option><option value=30>Show for 30 minutes</option><option value=60>Show for 60 minutes</option><option value=0>Mostrar mensaje hasta que el usuario lo descarte</option></select>"),showModal("xxAddAgentModal","idx_dlgOkButton",deviceMessageFunctionEx),Q("d2devMessage").focus())}function deviceMessageFunctionEx(){var e=decodeURIComponent("{{{extitle}}}"),t=parseFloat(Q("d2devTimeout").value);""==e&&(e="MeshCentral"),isNaN(t)&&(t=2),1==currentNode.pmt?meshserver.send({action:"pushmessage",nodeid:currentNode._id,title:e,msg:Q("d2devMessage").value}):meshserver.send({action:"msg",type:"messagebox",nodeid:currentNode._id,title:e,msg:Q("d2devMessage").value,timeout:6e4*t})}function deskClipboardInFunction(){var e;null!=desktop&&3==desktop.State&&(desktop.m.getClipboard?null!=(e=desktop.m.getClipboard())&&null!=navigator.clipboard&&navigator.clipboard.writeText(e).then(function(){}).catch(function(e){console.log(e)}):meshserver.send({action:"msg",type:"getclip",nodeid:currentNode._id,tag:2}))}function deskInputLockFunction(e){xxdialogMode||null==desktop||3!=desktop.State||(setModalContent("xxAddAgent","Bloqueo de Entrada Remota",1==e?"¿Bloquear el mouse y el teclado del usuario remoto?":"¿Desbloquear el mouse y el teclado del usuario remoto?"),showModal("xxAddAgentModal","idx_dlgOkButton",function(){try{desktop.m.SendRemoteInputLock(e)}catch(e){}}))}function deskClipboardOutFunction(){if(null!=navigator.clipboard&&null!=navigator.clipboard.readText)try{navigator.clipboard.readText().then(function(e){desktop.m.setClipboard?desktop.m.setClipboard(e):meshserver.send({action:"msg",type:"setclip",nodeid:currentNode._id,data:e})}).catch(function(e){console.log(e)})}catch(e){console.log(e)}return!0}function deskRefreshFunction(){null!=desktop&&3==desktop.State&&desktop.m.SendRefresh()}function deviceToastFunction(){xxdialogMode||(xxdialogButtons=3,setModalContent("xxAddAgent","Notificar Dispositivo",'<select id=d2deviceop style=width:100%;margin-bottom:4px class=form-select><option value=2>Notificación Emergente Temporal</option><option value=1>Cuadro de Mensaje</option><option value=3>Alert Box</option></select><input id=dp2notifyTitle maxlength=256 placeholder="Título" style=width:100%;box-sizing:border-box;margin-bottom:4px class=form-control/><textarea id=d2notifyMsg style=background-color:#fcf3cf;width:100%;height:140px;resize:none;overflow-y:scroll;box-sizing:border-box;margin-bottom:4px class=form-control></textarea><select style=width:100% id=d2notifyTimeout class=form-select><option disabled value="">Only Applicable to Message Box Notifications</option><option value=2 selected>Show for 2 Minutes (Default)</option><option value=10>Show for 10 minutes</option><option value=30>Show for 30 minutes</option><option value=60>Show for 60 minutes</option><option value=0>Mostrar mensaje hasta que el usuario lo descarte</option></select>'),showModal("xxAddAgentModal","idx_dlgOkButton",deviceToastFunctionEx),Q("d2notifyMsg").focus())}function deviceToastFunctionEx(){var e=Q("d2deviceop").value,t=Q("dp2notifyTitle").value,o=Q("d2notifyMsg").value,n=parseFloat(Q("d2notifyTimeout").value);0!=o.length&&(""==(t=""==t?decodeURIComponent("{{{extitle}}}"):t)&&(t="MeshCentral"),isNaN(n)&&(n=2),1==e?meshserver.send({action:"msg",type:"messagebox",nodeid:currentNode._id,title:t,msg:o,timeout:6e4*n}):2==e?meshserver.send({action:"toast",nodeids:[currentNode._id],title:t,msg:o}):3==e&&meshserver.send({action:"msg",type:"alertbox",nodeid:currentNode._id,title:t,msg:o}))}function deviceLockFunction(){null==xxdialogMode&&null!=desktop&&1==desktop.contype&&(setModalContent("xxAddAgent","Bloquear Escritorio","¿Bloquear el escritorio del usuario?"),showModal("xxAddAgentModal","idx_dlgOkButton",function(){null!=desktop&&1==desktop.contype&&desktop.sendCtrlMsg('{"ctrlChannel":"102938","type":"lock"}')}))}function showShareDevice(){if(!xxdialogMode){var e,t=GetNodeRights(currentNode),o="",n="Crea un enlace que permite a un invitado sin una cuenta controlar remotamente este dispositivo por un tiempo limitado.<br /><br />",i=(n+=addHtmlFormFloating("Nombre de Invitado",'<input id=d2inviteName class="form-control" maxlength=128 type=text onkeyup=showShareDeviceValidate() />'),"<option value=2>Escritorio</option>"),a=(4294967295!=t&&0!=(256&t)&&(i=""),"<option value=1>Terminal</option>"),s=(4294967295!=t&&0!=(512&t)&&(a=""),"<option value=4>Archivos</option>"),r=(4294967295!=t&&0!=(1024&t)&&(s=""),"<option value=5>Escritorio + Archivos</option>"),l=(4294967295!=t&&0!=(1280&t)&&(r=""),"<option value=6>Terminal + Archivos</option>"),d=(4294967295!=t&&0!=(1536&t)&&(l=""),"<option value=7>Escritorio + Terminal + Archivos</option>"),c=(4294967295!=t&&0!=(1792&t)&&(d=""),""),o=(0!=webRelayPort&&(c="<option value=8>HTTP</option><option value=9>HTTPS</option>",4294967295!=t)&&0!=(8&t)&&(c=""),""),u="",p=(1==(1&currentNode.agent.caps)&&(o+=i+"<option value=3>Escritorio, Solo vista</option>"),2==(2&currentNode.agent.caps)&&(o+=a),4==(4&currentNode.agent.caps)&&(o+=s),5==(5&currentNode.agent.caps)&&(o+=r),6==(6&currentNode.agent.caps)&&(o+=l),7==(7&currentNode.agent.caps)&&(o+=d),n+=addHtmlFormFloating("Tipo",'<select id=d2shareType class="form-select" onchange=showShareDeviceValidate()>'+(o+=c)+"</select>"),{1:"1 minuto",5:"5 minutos",10:"10 minutos",15:"15 minutos",30:"30 minutos",45:"45 minutos",60:"60 minutos",120:"2 horas",240:"4 horas",480:"8 horas",720:"12 horas",960:"16 horas",1440:"24 horas",2880:"2 días",5760:"4 dias",0:"Ilimitado"});for(e in o="",p)(null==serverinfo.guestdevicesharingmaxtime||0<e&&e<=serverinfo.guestdevicesharingmaxtime)&&(o+="<option value="+e+">"+p[e]+"</option>"),0<e&&e<=720&&(null==serverinfo.guestdevicesharingmaxtime||0<e&&e<=serverinfo.guestdevicesharingmaxtime)&&(u+="<option value="+e+">"+p[e]+"</option>");n=(n=(n=(n=(n=n+addHtmlFormFloating("Validez",'<select id=d2timeRange class="form-select" onchange=showShareDeviceValidate()><option value=0>Comenzando ahora</option><option value=1>Intervalo de tiempo</option><option value=2>Recurrente diariamente</option><option value=3>Semanal recurrente</option></select>')+"<div id=d2modenow>")+addHtmlFormFloating("Tiempo de Expiración",'<select id=d2inviteExpire class="form-select">'+o+"</select>")+"</div><div id=d2moderange style=display:none>")+addHtmlFormFloating("Intervalo de Tiempo",'<input id=d2timeRangeSelector class="flatpickr form-select" type="text" placeholder="Seleccionad fecha y hora..." data-id="altinput">')+"</div><div id=d2moderecurring style=display:none>")+addHtmlFormFloating("Tiempo de Inicio",'<input id=d2timeStartSelector class="flatpickr form-select" type="text" placeholder="Seleccionad fecha y hora..." data-id="altinput">'))+addHtmlFormFloating("Duración",'<select id=d2inviteDuration class="form-select">'+u+"</select>")+"</div>",1&currentNode.agent.caps&&(n+="<div id=d2userConsentSelector>"+addHtmlFormFloating("Consentimiento del Usuario",'<select id=d2userConsent class="form-select"><option value=0>Sólo Notificar<option value=1>Solicitar consentimiento</option><option value=2>No Consent</option></select>')+"</div>"),n=(n+="<div id=d2httpPortSelector>"+addHtmlFormFloating("Puerto",'<input id=d2httpPort class="form-control" value=80 onkeyup=showShareDeviceValidate()></input>')+"</div>")+("<div id=d2httpsPortSelector>"+addHtmlFormFloating("Puerto",'<input id=d2httpsPort class="form-control" value=443 onkeyup=showShareDeviceValidate()></input>')+"</div>"),xxdialogButtons=3,setModalContent("xxAddAgent","Compartir Dispositivo",n),showModal("xxAddAgentModal","idx_dlgOkButton",showShareDeviceEx),showShareDeviceValidate();t=new Date,i=(t.setDate(t.getDate()+1),flatpickr("#d2timeRangeSelector",{mode:"range",enableTime:!0,minDate:new Date,defaultDate:[new Date,t],minuteIncrement:1})),a=flatpickr("#d2timeStartSelector",{enableTime:!0,minDate:new Date,defaultDate:new Date,minuteIncrement:1});xxdialogTag={range:i,start:a}}}function showShareDeviceValidate(){1&currentNode.agent.caps&&QV("d2userConsentSelector",Q("d2shareType").value<8),QV("d2httpPortSelector",8==Q("d2shareType").value),QV("d2httpsPortSelector",9==Q("d2shareType").value),QV("d2modenow",0==Q("d2timeRange").value),QV("d2moderange",1==Q("d2timeRange").value),QV("d2moderecurring",2<=Q("d2timeRange").value);var e,t=!0;8==Q("d2shareType").value&&(e=parseInt(Q("d2httpPort").value),Q("d2httpPort").value!=e||e<1||65535<e)&&(t=!1),9==Q("d2shareType").value&&(e=parseInt(Q("d2httpsPort").value),Q("d2httpsPort").value!=e||e<1||65535<e)&&(t=!1),0==Q("d2inviteName").value.trim().length&&(t=!1),QE("idx_dlgOkButton",t)}function showShareDeviceEx(e,t){var o=0,n=parseInt(Q("d2shareType").value),i=!1;8==n?meshserver.send({action:"createDeviceShareLink",nodeid:currentNode._id,guestname:Q("d2inviteName").value.trim(),p:8,expire:parseInt(Q("d2inviteExpire").value),port:parseInt(Q("d2httpPort").value),consent:0}):9==n?meshserver.send({action:"createDeviceShareLink",nodeid:currentNode._id,guestname:Q("d2inviteName").value.trim(),p:16,expire:parseInt(Q("d2inviteExpire").value),port:parseInt(Q("d2httpsPort").value),consent:0}):(3==n&&(i=!0),1&(n=[0,1,2,2,4,6,5,7][n])&&(o|=2,1&currentNode.agent.caps&&1==Q("d2userConsent").value&&(o|=16),1&currentNode.agent.caps)&&2==Q("d2userConsent").value&&(o=0),2&n&&(o|=65,1&currentNode.agent.caps&&1==Q("d2userConsent").value&&(o|=8),1&currentNode.agent.caps)&&2==Q("d2userConsent").value&&(o=0),4&n&&(o|=4,1&currentNode.agent.caps&&1==Q("d2userConsent").value&&(o|=32),1&currentNode.agent.caps)&&2==Q("d2userConsent").value&&(o=0),0==Q("d2timeRange").value?meshserver.send({action:"createDeviceShareLink",nodeid:currentNode._id,guestname:Q("d2inviteName").value.trim(),p:n,expire:parseInt(Q("d2inviteExpire").value),consent:o,viewOnly:i}):1==Q("d2timeRange").value?meshserver.send({action:"createDeviceShareLink",nodeid:currentNode._id,guestname:Q("d2inviteName").value.trim(),p:n,start:Math.floor(t.range.selectedDates[0].getTime()/1e3),end:Math.floor(t.range.selectedDates[1].getTime()/1e3),consent:o,viewOnly:i}):meshserver.send({action:"createDeviceShareLink",nodeid:currentNode._id,guestname:Q("d2inviteName").value.trim(),p:n,start:Math.floor(t.start.selectedDates[0].getTime()/1e3),expire:parseInt(Q("d2inviteDuration").value),recurring:Q("d2timeRange").value-1,consent:o,viewOnly:i}))}function deviceActionFunction(){var e,t,o,n,i;xxdialogMode||(e=GetNodeRights(currentNode),t=0,o="Selecciona una operación para realizar en este dispositivo.<br /><br />",n="<select id=d2deviceop onchange=deviceActionFunctionValidate() class=form-select>",i="",null!=currentNode.agent&&14==currentNode.agent.id?0!=(1&currentNode.conn)&&0!=(8&e)&&(t++,n+="<option value=400>Destello</option><option value=401>Vibrar</option>",i+="<div id=d2devicetimediv>"+addHtmlFormFloating("Tiempo","<select id=d2devicetime class=form-select><option value=1000>1 segundo</option><option value=5000>5 segundos</option><option value=10000>10 segundos</option></select>")+"</div>"):(0!=(64&e)&&(t++,n+="<option value=100>Despertar</option>"),0!=(1&currentNode.conn)&&0!=(131072&e)&&(t++,n+="<option value=106>Ejecutar Comandos</option>"),0!=currentNode.conn&&0!=(262144&e)&&(t++,n+="<option value=4>Suspender</option><option value=3>Reiniciar</option><option value=2>Apagar</option>"),0!=(16&currentNode.conn)&&(t++,n+="<option value=103>Enviar Mensaje MQTT</option>"),null!=currentNode.intelamt&&2==currentNode.intelamt.state&&0!=(6&currentNode.conn)&&0!=(262144&e)&&(t++,n+="<option value=310>Restablecimiento de Intel&reg; AMT</option><option value=308>Apagado de Intel&reg; AMT</option>",11!=xxcurrentView&&12!=xxcurrentView||(n+="<option value=312>Intel&reg; AMT Reinicio a BIOS</option><option value=311>Intel&reg; AMT Encender a BIOS</option><option value=315>Intel&reg; AMT Power on to PXE</option><option value=316>Intel&reg; AMT Reset to PXE</option>")),null!=currentNode.intelamt&&2==currentNode.intelamt.state&&0!=(6&currentNode.conn)&&0!=(64&e)&&(t++,n+="<option value=302>Encendido de Intel&reg; AMT</option>"),(11==xxcurrentView||12==xxcurrentView)&&15<=getNodeAmtVersion(currentNode)&&2==currentNode.intelamt.state&&0!=(6&currentNode.conn)&&4294967295==e&&0==(1024&features)&&(t++,n+="<option value=107>Recuperación Intel&reg; AMT en un clic</option>"),0!=(1&currentNode.conn)&&0!=(32768&e)&&(t++,n+="<option value=104>Desinstalar Agente</option>")),o+=addHtmlFormFloating("Operación",n+="</select>"),xxdialogButtons=0==t?2:3,xxdialogTag=(o=0==t?"Actualmente no hay acciones disponibles para este dispositivo.":o)+i,setModalContent("xxAddAgent","Acción del Dispositivo",o),showModal("xxAddAgentModal","idx_dlgOkButton",deviceActionFunctionEx),0<t&&deviceActionFunctionValidate())}function deviceActionFunctionValidate(){var e=Q("d2deviceop").value;try{QV("d2devicetimediv",400==e||401==e)}catch(e){}}function deviceActionFunctionEx(){var e=Q("d2deviceop").value;if(100==e)return meshserver.send({action:"wakedevices",nodeids:[currentNode._id]}),!0;if(103==e)p10showSendMqttMsgDialog([currentNode._id]);else if(104==e)p10showSendUninstallAgentDialog([currentNode._id]);else if(106==e){var t,o=!1,n=!1;currentNode.agent&&(0<currentNode.agent.id&&currentNode.agent.id<5?o=!0:n=!0),1!=o&&1!=n||(t="Ejecutar comandos en los dispositivos seleccionados.<br />",1==o&&(t+="<select id=d2cmdtype style=width:100%;margin-bottom:4px;margin-top:4px><option value=1>Línea de Comandos de Windows</option><option value=2>Windows PowerShell</option>",1==n&&(t+="<option value=3>Shell de comandos Linux/BSD/macOS</option>"),t+="</select>"),setModalContent("xxAddAgent","Ejecutar Comandos",t=t+"<select id=d2cmduser style=width:100%;margin-bottom:4px><option value=0>Ejecutar como agente</option><option value=1>Ejecutar como usuario, agente si no hay usuario</option><option value=2>Debe ejecutarse como usuario</option></select>"+"<textarea id=d2runcmd style=width:100%;height:200px;resize:none;overflow-y:scroll></textarea>"),showModal("xxAddAgentModal","idx_dlgOkButton",()=>deviceRunCmdsFunctionEx()),Q("d2runcmd").focus())}else if(107==e)Q("d3localmodeform").action="oneclickrecovery.ashx",Q("d3auth").value=authCookie,Q("d3filter").value=".efi",Q("d3attrib").value=currentNode._id,setModalContent("xxAddAgent","Recuperación Intel&reg; AMT en un clic",t),showModal("xxAddAgentModal","idx_dlgOkButton",()=>deviceActionOneClickRecovery()),d3init();else if(302==e)setModalContent("xxAddAgent","Operación de energía Intel&reg; AMT","¿Realizar el encendido de Intel&reg; AMT?"),showModal("xxAddAgentModal","idx_dlgOkButton",function(){meshserver.send({action:"poweraction",nodeids:[currentNode._id],actiontype:parseInt(e)})});else if(308==e)setModalContent("xxAddAgent","Operación de energía Intel&reg; AMT","Perform Intel&reg; AMT power off?<br><br><b>NOTE: If there is an active AMT session, then power off command will be rejected, so you must disconnect from the AMT session first!</b>"),showModal("xxAddAgentModal","idx_dlgOkButton",function(){meshserver.send({action:"poweraction",nodeids:[currentNode._id],actiontype:parseInt(e)})});else if(310==e)setModalContent("xxAddAgent","Operación de energía Intel&reg; AMT","¿Realizar reinicio de Intel&reg; AMT?"),showModal("xxAddAgentModal","idx_dlgOkButton",function(){meshserver.send({action:"poweraction",nodeids:[currentNode._id],actiontype:parseInt(e)})});else{if(311==e)setModalContent("xxAddAgent","Operación de energía Intel&reg; AMT","Ejecutar accion de Encendido Intel&reg; AMT en BIOS?");else{if(312!=e)return 400==e||401==e?meshserver.send({action:"poweraction",nodeids:[currentNode._id],actiontype:parseInt(e),time:parseInt(Q("d2devicetime").value)}):meshserver.send({action:"poweraction",nodeids:[currentNode._id],actiontype:parseInt(e)}),!0;setModalContent("xxAddAgent","Operación de energía Intel&reg; AMT","Ejecutar accion de Reinicio Intel&reg; AMT en BIOS?")}showModal("xxAddAgentModal","idx_dlgOkButton",function(){meshserver.send({action:"poweraction",nodeids:[currentNode._id],actiontype:parseInt(e)+(12==xxcurrentView?2:0)})})}return!1}function deviceActionOneClickRecovery(){var e;1==Q("d3uploadMode").value?Q("d3submit").click():1==(e=d3getFileSel()).length&&meshserver.send({action:"oneclickrecovery",nodeids:[Q("d3attrib").value],type:"diskimage",path:d3filetreelocation.join("/")+"/"+e[0]})}function deviceRunCmdsFunctionEx(){var e=3;try{e=parseInt(Q("d2cmdtype").value)}catch(e){}meshserver.send({action:"runcommands",nodeids:[currentNode._id],type:e,cmds:Q("d2runcmd").value,runAsUser:parseInt(Q("d2cmduser").value)})}function updateAmtCredentials(e){var t=getNodeFromId(currentNode._id);1==e||null==t.intelamt.user||""==t.intelamt.user?editDeviceAmtSettings(currentNode._id,updateAmtCredentialsEx):Q("p14iframe").contentWindow.connectButtonfunctionEx()}function updateAmtCredentialsEx(e,t){Q("p14iframe").contentWindow.connectButtonfunctionEx()}function updateDeviceTimeline(){2==meshserver.State&&null!=powerTimelineNode&&null!=powerTimelineUpdate&&null!=currentNode&&3!=currentNode.mtype&&powerTimelineNode==powerTimelineReq&&currentNode._id==powerTimelineNode&&powerTimelineUpdate<Date.now()&&(powerTimelineUpdate=null,meshserver.send({action:"powertimeline",nodeid:currentNode._id}),meshserver.send({action:"lastconnect",nodeid:currentNode._id}))}function drawDeviceTimeline(){if(!(null==currentNode||xxcurrentView<10||19<xxcurrentView||3==currentNode.mtype||"true"===hidePowerTimeline)){var e=null,t=Date.now(),o=(currentNode._id==powerTimelineNode&&(e=powerTimeline),new Date),n=(o.setHours(0,0,0,0),(o=new Date(o.getTime()-5184e5)).getTime(),[]);if(null!=e&&1<e.length){n.push([0,e[1],e[0]]);for(var i=e[1],a=2;a<e.length;a+=2){var s=e[a],r=t;e.length>a+1&&(r=e[a+1]),n.push([i,i+r,s]),i+=r}}var l="",d=1,c=new Date,u=Q("column_l").offsetWidth-192;c.setHours(0,0,0,0);for(a=0;a<7;a++){var p,m="",g=c.getTime(),v=g+864e5;for(p in n){var h,f,x,k=n[p];1==isTimeBlockInside(g,v,k[0],k[1])&&(x=Math.max(g,k[0]),h=Math.min(Math.min(v,k[1]),t),0<(f=Math.round((h-x)*u/864e5)))&&(x=format("{0} de {1} a {2}.",powerStateStrings2[k[2]],printTime(new Date(x)),printTime(new Date(h))),m+='<div class="pwState '+powerColor(k[2])+'" title="'+x+'" style="width:'+f+'px;"></div>')}l+="<tr class="+(d%2==0?"altBack":"")+"><td><div>&nbsp;"+printDate(c)+"<div></div></div></td><td><div>"+m+"</div></td></tr>",++d,c=new Date(c.getFullYear(),c.getMonth(),c.getDate()-1)}o="";try{o="&tz="+encodeURIComponentEx(Intl.DateTimeFormat().resolvedOptions().timeZone)}catch(e){}QH("p10html2",'<table class="table table-striped align-middle text-center" cellpadding=2 cellspacing=0><thead><tr><th scope=col style=width:150px>Día</th><th scope=col>Estado de energía de los últimos 7 días<div class="float-end pe-1"><i role="button" onclick=downloadFile("devicepowerevents.ashx?id='+currentNode._id+"&tf="+(new Date).getTimezoneOffset()+"&l="+encodeURIComponentEx(getLang())+o+(urlargs.key?"&key="+urlargs.key:"")+'",null,true) title="Descargar eventos de encendido" class="fa-solid fa-download"></i></div></th></tr></thead><tbody>'+l+"</tbody></table>")}}function powerColor(e){return e<powerColorTable.length?powerColorTable[e]:"pwsYellow"}function isTimeBlockInside(e,t,o,n){return o<e&&t<n||e<o&&o<t||e<n&&n<t}function addDeviceAttribute(e,t,o=[]){return`<div class="row mb-1"><div class="${o[0]||"col col-md-2 col-lg-2"}"><b> ${e} </b></div><div class="${o[1]||"col col-md-10 col-lg-10"}"> ${t} </div></div>`}function editDeviceAmtSettings(e,t,o){var n,i,a;xxdialogMode||(n="",i=getNodeFromId(e),a=3,0!=(4&GetNodeRights(i))&&(n=(n+=addHtmlFormFloating("Nombre de Usuario",'<input id=dp10username class="form-control" maxlength=32 autocomplete=nope placeholder="admin" onchange=validateDeviceAmtSettings() onkeyup=validateDeviceAmtSettings() />'))+addHtmlFormFloating("Contraseña",'<input id=dp10password type=password class="form-control" autocomplete=nope maxlength=32 onchange=validateDeviceAmtSettings() onkeyup=validateDeviceAmtSettings() />'),0==(1&features2)&&(n+=addHtmlFormFloating("Seguridad",'<select id=dp10tls class="form-select"><option value=0>Sin Seguridad TLS</option><option value=1>Seguridad TLS requerida</option></select>')),null!=i.intelamt.user&&""!=i.intelamt.user&&(a=7),setModalContent("xxAddAgent","Editar Credenciales de Intel&reg; AMT",n),showModal("xxAddAgentModal","idx_dlgOkButton",()=>editDeviceAmtSettingsEx(a,{node:i,func:t,arg:o})),null!=i.intelamt.user&&""!=i.intelamt.user?Q("dp10username").value=i.intelamt.user:Q("dp10username").value="admin",0==(1&features2)&&(Q("dp10tls").value=i.intelamt.tls),validateDeviceAmtSettings()))}function validateDeviceAmtSettings(){QE("idx_dlgOkButton",passwordcheck(Q("dp10password").value))}function editDeviceAmtSettingsEx(e,t){var o;2==e?meshserver.send({action:"changedevice",nodeid:t.node._id,intelamt:{user:"",pass:""}}):(""==(e=Q("dp10username").value)&&(e="admin"),o=Q("dp10password").value,e={action:"changedevice",nodeid:t.node._id,intelamt:{user:e=""==o?"":e,pass:o}},0==(1&features2)&&(e.intelamt.tls=parseInt(Q("dp10tls").value)),meshserver.send(e),t.func&&setTimeout(function(){t.func(null,t.arg)},1e3))}function p10showSendMqttMsgDialog(e){var t;return xxdialogMode||(t=addHtmlFormFloating("Tema",'<input id=dp2topic class="form-control" maxlength=64 onchange=p10validateSendMqttMsgDialog() onkeyup=p10validateSendMqttMsgDialog(event,1) />'),setModalContent("xxAddAgent","Enviar mensaje MQTT",t+=addHtmlFormFloating("Mensaje",'<textarea id=dp2msg class="form-control" maxlength=4096 style=width:100%;height:150px;resize:none onchange=p10validateSendMqttMsgDialog() onkeyup=p10validateSendMqttMsgDialog(event,1)></textarea>')),showModal("xxAddAgentModal","idx_dlgOkButton",()=>p10showSendMqttMsgDialogEx(3,e)),p10validateSendMqttMsgDialog(),Q("dp2topic").focus()),!1}function p10validateSendMqttMsgDialog(){QE("idx_dlgOkButton",0<Q("dp2topic").value.length&&0<Q("dp2msg").value.length)}function p10showSendMqttMsgDialogEx(e,t){meshserver.send({action:"sendmqttmsg",nodeids:t,topic:Q("dp2topic").value,msg:Q("dp2msg").value}),uncheckAllDevices()}function p10showSendUninstallAgentDialog(e){var t;return xxdialogMode||(t="",t=1<e.length?format("¿Está seguro de que desea desinstalar los {0} agentes seleccionados?",e.length):"¿Estás seguro de que desea desinstalar el agente seleccionado?",setModalContent("xxAddAgent","Desinstalar agente",t=(t+="<br /><br />")+(1<e.length?"Esto no eliminará los dispositivos del servidor, pero los dispositivos ya no podrán conectarse al servidor. Se perderá todo el acceso remoto a los dispositivos. Los dispositivos deben estar conectados para que este comando funcione.":"Esto no eliminará este dispositivo del servidor, pero el dispositivo ya no podrá conectarse al servidor. Se perderá todo el acceso remoto al dispositivo. El dispositivo debe estar conectado para que este comando funcione.")+'<br /><br /><label style=color:red><input id=p10check type=checkbox class="form-check-input me-2" onchange=p10validateDeleteNodeDialog() />Confirmar</label>'),showModal("xxAddAgentModal","idx_dlgOkButton",()=>p10showSendUninstallAgentDialogEx(3,e)),p10validateSendUninstallAgentDialog()),!1}function p10validateSendUninstallAgentDialog(){QE("idx_dlgOkButton",Q("p10check").checked)}function p10showSendUninstallAgentDialogEx(e,t){meshserver.send({action:"uninstallagent",nodeids:t}),uncheckAllDevices()}function p10showChangeGroupDialog(e){if(!xxdialogMode){var t=null;if(1==e.length)try{t=meshes[getNodeFromId(e[0]).meshid]._id}catch(e){}var o,n,i='<select id=p10newGroup class="form-select">',a=0,s=[];for(o in meshes){var r=GetMeshRights(o);meshes[o]._id!=t&&4&r&&s.push(meshes[o])}for(o in s.sort(nameSort),s)a++,i+="<option value='"+s[o]._id+"'>"+s[o].name+"</option>";i+="</select>",0<a?(n=1==e.length?"Selecciona un nuevo grupo para este dispositivo<br /><br />":"Selecciona un nuevo grupo para los dispositivos seleccionados<br /><br />",setModalContent("xxAddAgent","Cambiar Grupo de Dispositivos",n+=addHtmlFormFloating("Nuevo Grupo de Dispositivos",i)),showModal("xxAddAgentModal","idx_dlgOkButton",()=>p10showChangeGroupDialogEx(3,e))):(setModalContent("xxAddAgent","Cambiar Grupo de Dispositivos","No other device group of same type exists."),showModal("xxAddAgentModal","idx_dlgOkButton"))}return!1}function p10showChangeGroupDialogEx(e,t){meshserver.send({action:"changeDeviceMesh",nodeids:t,meshid:Q("p10newGroup").value}),uncheckAllDevices()}function p10showDeleteNodeDialog(e){var t;return xxdialogMode||(t=format("¿Estás seguro de que desea eliminar el nodo {0}?",EscapeHtml(currentNode.name))+'<br /><br /><label><input id=p10check type=checkbox class="form-check-input me-2" onchange=p10validateDeleteNodeDialog() />Confirmar</label>',xxdialogButtons=3,xxdialogTag=e,setModalContent("xxAddAgent","Eliminar Nodo",t),showModal("xxAddAgentModal","idx_dlgOkButton",()=>p10showDeleteNodeDialogEx(0,e)),p10validateDeleteNodeDialog()),!1}function p10validateDeleteNodeDialog(){QE("idx_dlgOkButton",Q("p10check").checked)}function p10showDeleteNodeDialogEx(e,t){meshserver.send({action:"removedevices",nodeids:[t]})}function p10WebRouter(e,t,o,n){var i=null,a=getNodeFromId(e),s=(3==a.mtype&&(s=meshes[a.meshid])&&s.relayid&&(i=s.relayid,n=a.host),serverinfo.name),a=(-1!=s.indexOf(".")&&0==(2&features)||(s=window.location.hostname),"https://"+(s=""!=webRelayDns?webRelayDns:s)+":"+webRelayPort+"/control-redirect.ashx?n="+e+"&p="+o+"&appid="+t+"&c="+authRelayCookie);return null!=n&&(a+="&addr="+n),null!=i&&(a+="&relayid="+i),safeNewWindow(a,"WebRelay"),!1}function p10MCRouter(e,t,o,n,i){var a=getNodeFromId(e),s=meshes[a.meshid];return 3==t&&null==o&&(o=null!=a.rdpport?a.rdpport:3389),3==a.mtype&&s&&s.relayid&&(e=s.relayid,n=a.host),meshserver.send({action:"getcookie",nodeid:e,tcpport:o,ip:n,tag:"MCRouter",protocol:t,localport:i,name:s?s.name:null}),!1}function p10rfb(e,t){var o=getNodeFromId(e),n=null,i=meshes[o.meshid];null==t&&(t=null!=o.rfbport?o.rfbport:5900),3==o.mtype&&i&&i.relayid&&(e=i.relayid,n=o.host),meshserver.send({action:"getcookie",nodeid:e,tcpport:t,tcpaddr:n,tag:"novnc",name:i?i.name:null})}function p10mstsc(e,t){var o=getNodeFromId(e),n=meshes[o.meshid];null==t&&(t=null!=o.rdpport?o.rdpport:3389),meshserver.send({action:"getcookie",nodeid:e,tcpport:t,tag:"mstsc",name:n?n.name:null})}function p10ssh(e,t){var o=getNodeFromId(e),n=meshes[o.meshid];null==t&&(t=null!=o.sshport?o.sshport:22),meshserver.send({action:"getcookie",nodeid:e,tcpport:t,tag:"ssh",name:n?n.name:null})}var d2map=null;function p10showNodeLocationDialog(){if(null!=xxdialogMode&&"@xxmap"==xxdialogTag)setDialogMode(0);else if(xxdialogMode)return!1;function g(e){var t,o,n,i,a=[],s=["iploc","wifiloc","gpsloc","userloc"],r=null;for(t in s)null!=currentNode[s[t]]&&(n=currentNode[s[t]].split(","),o=parseFloat(n[0]),n=parseFloat(n[1]),o<90)&&-90<o&&n<180&&-180<n&&((i=new ol.Feature({geometry:new ol.geom.Point(ol.proj.fromLonLat([n,o]))})).setStyle(markerStyle(currentNode,parseInt(t)+1)),a.push(i),null==r?r=[o,n,o,n,0]:(o<r[0]&&(r[0]=o),n<r[1]&&(r[1]=n),o>r[2]&&(r[2]=o),n>r[3]&&(r[3]=n)));var l=new ol.source.Vector({features:a}),l=new ol.layer.Vector({source:l}),d=0,c=0,u=8;if(null!=r)for(var c=(r[0]+r[2])/2,d=(r[1]+r[3])/2,p=Math.max(Math.abs(r[0]-r[2]),Math.abs(r[1]-r[3])),m=360,u=-2;p<m;)u++,m/=2;1==a.length&&(u=8),d2map=new ol.Map({target:"d2map",interactions:ol.interaction.defaults({dragPan:!1,mouseWheelZoom:!1}),layers:[new ol.layer.Tile({source:new ol.source.OSM}),l],view:new ol.View({center:ol.proj.fromLonLat([d,c]),zoom:u})}),document.getElementById("xxAddAgentModal").removeEventListener("shown.bs.modal",g)}document.getElementById("xxAddAgentModal").addEventListener("shown.bs.modal",g);return xxdialogTag="@xxmap",setModalContent("xxAddAgent","Ubicación del Dispositivo","<div id=d2map style=width:100%;height:300px></div>"),showModal("xxAddAgentModal","idx_dlgOkButton"),!1}function p10showNodeNetInfoDialog(){return xxdialogMode||(xxdialogButtons=1,xxdialogTag="if"+currentNode._id,setModalContent("xxAddAgent","Interfaces de Red","<div id=d2netinfo>Cargando...</div>"),showModal("xxAddAgentModal","idx_dlgOkButton"),meshserver.send({action:"getnetworkinfo",nodeid:currentNode._id})),!1}function p10showMeshRouterDialog(){var e,t;xxdialogMode||(e="<div>MeshCentral Router es una herramienta de Windows para la asignación de puertos TCP. Puede, por ejemplo, RDP en un dispositivo remoto a través de este servidor.</div><br />",e=(e+='<div class="row mb-1"><div class="col-md-4"><b>Win32 Executable</b></div><div class="col-md-8"><a style="cursor:pointer" onclick="downloadFile(\'meshagents?meshaction=winrouter'+(urlargs.key?"&key="+urlargs.key:"")+'\',null,true)" class="link-primary">MeshCentralRouter.exe</a></div></div>')+'<div class="row mb-1"><div class="col-md-4"><b>MacOS Installer</b></div><div class="col-md-8"><a style="cursor:pointer" onclick="downloadFile(\'meshagents?meshaction=macrouter'+(urlargs.key?"&key="+urlargs.key:"")+'\',null,true)" class="link-primary">MeshCentralRouter.dmg</a></div></div>',-1!=(t=serverinfo.name).indexOf(".")&&0==(2&features)||(t=window.location.hostname),domainUrl.substring(0,domainUrl.length-1),setModalContent("xxAddAgent","Router de MeshCentral ",e=(e+='<br /><div class="alert alert-info">Ejecute MeshCentral Router y haz clic en "instalar" para que se pueda iniciar desde el navegador.</div>')+('<br /><a style=cursor:pointer target="mcrouterframe" rel="noreferrer noopener" href="'+("mcrouter://"+t+(443==serverinfo.port?"":":"+serverinfo.port)+domainUrl+"control.ashx?c="+authCookie+"&t="+serverinfo.tlshash+"&l={{{lang}}}"+(urlargs.key?"&key="+urlargs.key:""))+'"><input type=button style=width:100%;cursor:pointer value="Ejecutar MeshCentral Router" class="btn btn-primary btn-block" /></a>')+'<iframe class="d-none" name="mcrouterframe"></iframe>'),showModal("xxAddAgentModal","idx_dlgOkButton",function(){p20showAddMeshUserDialogEx(1,"fileDownload")}))}function p10showMqttLoginDialog(e){meshserver.send({action:"getmqttlogin",nodeid:e})}function p10openxterm(e,t){haltEvent(e);var e="/xterm?nodeid="+encodeURIComponentEx(t)+"&auto=1",o=getNodeFromId(t);if(null!=o)return 0<=[1,2,3,4,21,22].indexOf(o.agent.id)?e+="&os=win":e+="&os=linux",urlargs.key&&(e+="&key="+urlargs.key),safeNewWindow(e,"xterm:"+t),!1}function p10showMeshCmdDialog(e,t){var o;xxdialogMode||(o="",0==e&&(o+="<div>MeshCmd es una herramienta de línea de comandos que realiza muchas operaciones diferentes. El archivo de acción se puede descargar y editar opcionalmente para proporcionar información del servidor y credenciales.<br /><br />"),1==e&&(o+='<div>Descarga "meshcmd" con un archivo de acción para enrutar el tráfico a través de este servidor a este dispositivo. Asegúrate de editar meshaction.txt y agregar la contraseña de su cuenta o realiza los cambios necesarios.<br /><br />'),o=(o+=addHtmlFormFloating("Sistema Operativo","<select id=aginsSelect onclick=meshCmdOsClick() class=form-select><option value=4>Windows x86 (64bit)</option><option value=3>Windows x86 (32bit)</option><option value=43>Windows ARM (64bit)</option><option value=6>Linux x86 (64bit)</option><option value=5>Linux x86 (32bit)</option><option value=16>macOS x86 (64bit)</option><option value=29>macOS ARM (64bit)</option><option value=25>Linux ARM, Raspberry Pi (32bit)</option><option value=26>Linux ARM, Raspberry Pi (64bit)</option></select>"))+addHtmlValue("MeshCmd",'<a id=meshcmddownloadid onclick=downloadFile("meshagents?meshcmd=3'+(urlargs.key?"&key="+urlargs.key:"")+'") class=link-primary></a>'),0==e&&(o+=addHtmlValue("Archivo de acción",'<a onclick=downloadFile("meshagents?meshaction=generic'+(urlargs.key?"&key="+urlargs.key:"")+'") class=link-primary>MeshAction (.txt)</a>')),1==e&&(o+=addHtmlValue("Archivo de acción",'<a onclick=downloadFile("meshagents?meshaction=route&nodeid='+t+(urlargs.key?"&key="+urlargs.key:"")+'") class=link-primary>MeshAction (.txt)</a>')),xxdialogButtons=9,xxdialogMode="fileDownload",setModalContent("xxAddAgent","Descargar MeshCmd",o+="</div>"),showModal("xxAddAgentModal","idx_dlgOkButton"),meshCmdOsClick())}function meshCmdOsClick(){var e=Q("aginsSelect").value,t="";3==e&&(t="MeshCmd (ejecutable Win x86-32)"),4==e&&(t="MeshCmd (ejecutable Win x86-64)"),43==e&&(t="MeshCmd (ejecutable Win ARM-64)"),5==e&&(t="MeshCmd (Linux x86, 32bit)"),6==e&&(t="MeshCmd (Linux x86, 64bit)"),16==e&&(t="MeshCmd (macOS, x86-64bit)"),29==e&&(t="MeshCmd (macOS, ARM-64bit)"),25==e&&(t="MeshCmd (Linux ARM, 32bit)"),26==e&&(t="MeshCmd (Linux ARM, 64bit)"),QH("meshcmddownloadid",t),Q("meshcmddownloadid").onclick=function(){downloadFile("meshagents?meshcmd="+e+(urlargs.key?"&key="+urlargs.key:""))}}function p10showiconselector(){xxdialogMode||0!=(4&GetNodeRights(currentNode))&&(setModalContent("xxAddAgent","Selección de Icono",'<div style=text-align:center><br /><div tabindex=0 style="display:inline-block;margin:0 10px 0 10px" class=i1 onclick=p10setIcon(1) onkeypress="if (event.key==\'Enter\') p10setIcon(1)"></div><div tabindex=0 style="display:inline-block;margin:0 10px 0 10px" class=i2 onclick=p10setIcon(2) onkeypress="if (event.key==\'Enter\') p10setIcon(2)"></div><div tabindex=0 style="display:inline-block;margin:0 10px 0 10px" class=i3 onclick=p10setIcon(3) onkeypress="if (event.key==\'Enter\') p10setIcon(3)"></div><div tabindex=0 style="display:inline-block;margin:0 10px 0 10px" class=i4 onclick=p10setIcon(4) onkeypress="if (event.key==\'Enter\') p10setIcon(4)"></div><br /><div tabindex=0 style="display:inline-block;margin:0 10px 0 10px" class=i5 onclick=p10setIcon(5) onkeypress="if (event.key==\'Enter\') p10setIcon(5)"></div><div tabindex=0 style="display:inline-block;margin:0 10px 0 10px" class=i6 onclick=p10setIcon(6) onkeypress="if (event.key==\'Enter\') p10setIcon(6)"></div><div tabindex=0 style="display:inline-block;margin:0 10px 0 10px" class=i7 onclick=p10setIcon(7) onkeypress="if (event.key==\'Enter\') p10setIcon(7)"></div><div tabindex=0 style="display:inline-block;margin:0 10px 0 10px" class=i8 onclick=p10setIcon(8) onkeypress="if (event.key==\'Enter\') p10setIcon(8)"></div><br /><br /></div>'),showModal("xxAddAgentModal","idx_dlgOkButton"),QV("id_dialogclose",!0))}function p10setIcon(e){setDialogMode(0),meshserver.send({action:"changedevice",nodeid:currentNode._id,icon:e})}function showClearSshDialog(){setModalContent("xxAddAgent","Editar Dispositivo","Clear SSH credentials?"),showModal("xxAddAgentModal","idx_dlgOkButton",()=>showClearSshDialogEx(3))}function showClearSshDialogEx(e,t){meshserver.send({action:"changedevice",nodeid:currentNode._id,ssh:0})}function showClearRdpDialog(){setModalContent("xxAddAgent","Editar Dispositivo","Clear RDP credentials?"),showModal("xxAddAgentModal","idx_dlgOkButton",()=>showClearRdpDialogEx(3))}function showClearRdpDialogEx(e,t){meshserver.send({action:"changedevice",nodeid:currentNode._id,rdp:0})}var desktopNode,showEditNodeValueDialog_modes=["Nombre del Dispositivo","Nombre de Host","Descripción","Etiquetas"],showEditNodeValueDialog_modes2=["name","host","desc","tags"],showEditNodeValueDialog_modes3=["","","","Etiqueta1, Etiqueta2, Etiqueta3"],showEditNodeValueDialog_modes4=[64,64,64,4096];function showEditNodeValueDialog(e){if(!xxdialogMode){var t="",o="",n=currentNode[showEditNodeValueDialog_modes2[e]];if(null==n&&(n=""),3==e){var t='<select id=dp10devicevalue multiple class="form-control" maxlength='+showEditNodeValueDialog_modes4[e]+" class=form-control>",i=[];for(s in nodes)if(nodes[s].tags)for(var a in nodes[s].tags)-1==i.indexOf(nodes[s].tags[a])&&i.push(nodes[s].tags[a]);if(0<i.length)for(var s in i.sort(),i){EscapeHtml(i[s]);o+=Array.isArray(n)&&-1!==n.indexOf(i[s])?"<option selected=selected>"+EscapeHtml(i[s])+"</option>":"<option>"+EscapeHtml(i[s])+"</option>"}setModalContent("xxAddAgent","Edit Tags",t+=o+"</select>"),$("#dp10devicevalue").select2({theme:"bootstrap-5",width:$(this).data("width")?$(this).data("width"):$(this).hasClass("w-100")?"100%":"style",placeholder:showEditNodeValueDialog_modes3[e],closeOnSelect:!1,allowClear:!0,tokenSeparators:[","],tags:!0})}else setModalContent("xxAddAgent","Editar Dispositivo",t=addHtmlFormFloating(showEditNodeValueDialog_modes[e],'<input id=dp10devicevalue class="form-control" maxlength='+showEditNodeValueDialog_modes4[e]+' placeholder="'+showEditNodeValueDialog_modes3[e]+'" onchange=p10editdevicevalueValidate('+e+",event) onkeyup=p10editdevicevalueValidate("+e+",event) class=form-control/>")),Array.isArray(n)&&(n=n.join(", ")),Q("dp10devicevalue").value=n,showModal("xxAddAgentModal","idx_dlgOkButton",function(){showEditNodeValueDialogEx(3,e)});p10editdevicevalueValidate(),showModal("xxAddAgentModal","idx_dlgOkButton",function(){showEditNodeValueDialogEx(3,e)}),Q("dp10devicevalue").focus()}}function showEditNodeValueDialogAddTag(e){var t,o=Q("dp10devicevalue").value.split(","),n=[];for(t in o)n.push(o[t].trim());0<=n.indexOf(e)||(Q("dp10devicevalue").value+=(0==Q("dp10devicevalue").value.length?"":", ")+decodeURIComponent(e),setTimeout(function(){Q("dp10devicevalue").selectionStart=Q("dp10devicevalue").selectionEnd=9e4},0),p10editdevicevalueValidate())}function showEditNodeValueDialogEx(e,t){var o="",n={action:"changedevice",nodeid:currentNode._id};if(3==t){var i,a=$("#dp10devicevalue").select2("data");for(i in a)o+=a[i].text.trim()+", ";n[showEditNodeValueDialog_modes2[t]]=decodeURIComponent(o.slice(0,-2))}else n[showEditNodeValueDialog_modes2[t]]=Q("dp10devicevalue").value;meshserver.send(n)}function p10editdevicevalueValidate(e,t){e=1<e||0<Q("dp10devicevalue").value.length;QE("idx_dlgOkButton",e),null!=t&&1==e&&13==t.keyCode&&dialogclose(1)}function setupDesktop(){var e,t;desktopNode!=currentNode&&null!=desktop&&desktopNode._id!=currentNode._id&&(desktop.Stop(),desktop=desktopNode=null),desktopNode==currentNode&&null!=desktop||(null!=(e=multiDesktop[currentNode._id])?(QH("DeskParent",""),(t=e.m.CanvasId).setAttribute("id","Desk"),t.setAttribute("onmousedown","dmousedown(event)"),t.setAttribute("onmouseup","dmouseup(event)"),t.setAttribute("onmousemove","dmousemove(event)"),t.removeAttribute("onclick"),Q("DeskParent").appendChild(t),(desktop=e).m.SendCompressionLevel&&desktop.m.SendCompressionLevel(desktopsettings.agentencoding,desktopsettings.quality,desktopsettings.scaling,desktopsettings.framerate),desktop.onStateChanged=onDesktopStateChange,desktop.onMetadataChange=function(e){updateMetadata(desktop,"deskmetadata")},0!=(8192&features2)&&(desktop.m.stopInput=!0),desktop&&desktop.m.mouseCursorActive&&desktop.m.mouseCursorActive(!0),QV("DeskInputLockedButton",1==desktop.m.RemoteInputLock),QV("DeskInputUnLockedButton",0==desktop.m.RemoteInputLock),desktop.m.onRemoteInputLockChanged=function(e,t){QV("DeskInputLockedButton",t),QV("DeskInputUnLockedButton",!t)},desktop.m.onKeyboardStateChanged=function(e,t){QS("p11numlock").display=1&t?"inline-block":"none",QS("p11scrolllock").display=2&t?"inline-block":"none",QS("p11capslock").display=4&t?"inline-block":"none"},desktopNode=currentNode,onDesktopStateChange(desktop,desktop.State),delete multiDesktop[currentNode._id]):(null==desktop&&QH("DeskParent",'<canvas id=Desk oncontextmenu="return false" onmousedown=dmousedown(event) onmouseup=dmouseup(event) onmousemove=dmousemove(event)></canvas>'),desktopNode=currentNode),Q("Desk").addEventListener("DOMMouseScroll",function(e){return dmousewheel(e)}),Q("Desk").addEventListener("mousewheel",function(e){return dmousewheel(e)})),desktopNode=currentNode,desktop&&(desktop.m.onDisplayinfo=deskDisplayInfo)(desktop.m,desktop.m.displays,desktop.m.selectedDisplay),updateDesktopButtons(),deskAdjust(),updateMetadata(desktop,"deskmetadata")}function updateDesktopButtons(){var e=0,t=(null!=desktop&&(e=desktop.State),GetNodeRights(currentNode)),o=1==currentNode.agent?1:2,o=(QV("disconnectbutton1span",0!=e),QV("connectbutton1span",0==e&&(8&t||256&t)&&null!=currentNode.agent&&1&currentNode.agent.caps),QV("connectbutton1rspan",0==(1073741824&features)&&0==e&&8&t&&null!=currentNode.agent&&(3==currentNode.agent.id||4==currentNode.agent.id)),1==o?QV("connectbutton1hspan",0==e&&8&t&&null!=currentNode.intelamt&&2==currentNode.intelamt.state):QV("connectbutton1hspan",0==e&&8&t&&null!=currentNode.intelamt&&2==currentNode.intelamt.state&&null!=currentNode.intelamt.ver&&(null==currentNode.intelamt.sku||"number"==typeof currentNode.intelamt.sku&&0!=(8&currentNode.intelamt.sku))),QV("td7amtkvm",!(null==currentNode.intelamt||"number"==typeof currentNode.intelamt.sku&&0!=(16&currentNode.intelamt.sku)||null==currentNode.intelamt.ver&&null!=currentNode.agent||0!=e&&2!=desktop.contype)),QV("td7meshkvm",webRtcDesktop||null!=currentNode.agent&&1&currentNode.agent.caps&&(0==e||1==desktop.contype)),QV("td7rdpkvm",!(null==currentNode.agent||3!=currentNode.agent.id&&4!=currentNode.agent.id||0!=e&&4!=desktop.contype)),0==(8192&features2)&&(null==currentNode.agent||14!=currentNode.agent.id)&&(4294967295==t||0!=(8&t)&&0==(256&t)&&0==(4096&t))),n=0!=(1&currentNode.conn),i=(QE("connectbutton1",n),QE("connectbutton1d",n),QE("connectbutton1r",n||3==currentNode.mtype),QE("connectbutton1rd",n||3==currentNode.mtype),currentNode.rdpport&&3389!=currentNode.rdpport?QH("desktopCustomUpperRight",'<a style="cursor:pointer;line-height:22px" onclick="cmaltportaction(1,event)">'+format("RDP Port {0}",currentNode.rdpport||3389)+"</a>"):QH("desktopCustomUpperRight",""),0!=(6&currentNode.conn)),i=(QE("connectbutton1h",i),QV("deskFocusBtn",null!=desktop&&2==desktop.contype&&0!=e&&desktopsettings.showfocus),QE("DeskClip",3==e),QV("DeskClip",o&&currentNode.agent&&6144!=(6144&features2)&&11!=currentNode.agent.id&&16!=currentNode.agent.id&&(null==desktop||2!=desktop.contype)&&(1!=desktopsettings.autoclipboard||null==navigator.clipboard||null==navigator.clipboard.readText)),QE("DeskESC",3==e&&4!=desktop.contype),QV("DeskESC",browserfullscreen&&o),QE("DeskType",3==e),QV("DeskType",o),QE("DeskWD",3==e),QV("DeskWD",o),QV("deskkeys",o),QE("deskkeys",null!=desktop),QV("DeskTimer",3==e),QV("DeskLatency",3==e),QS("DeskLatency").display=3==e?"inline-block":"none",desktop&&4==desktop.contype?desktopsettings.rdpautoclipboard:desktopsettings.autoclipboard);QV("DeskClipboardOutButton",n&&o&&null!=desktop&&0==(4096&features2)&&null!=navigator.clipboard&&null!=navigator.clipboard.readText&&(1!=i||null==navigator.clipboard||null==navigator.clipboard.readText)),QV("d7deskAutoClipboardLabel",null!=navigator.clipboard.readText&&0==(4096&features2)),QV("DeskClipboardInButton",n&&o&&null!=desktop&&0==(2048&features2)&&null!=navigator.clipboard&&null!=navigator.clipboard.writeText&&(1!=i||null==navigator.clipboard||null==navigator.clipboard.readText)),3!=e&&(QV("DeskInputLockedButton",!1),QV("DeskInputUnLockedButton",!1),QV("p11numlock",!1),QV("p11scrolllock",!1),QV("p11capslock",!1)),QV("DeskRunButton",0!=(131072&t)&&n),QV("DeskSaveImageButton",3==e&&null!=Q("Desk").toBlob&&0==(1024&features2)),QV("DeskRecordButton",3==e&&null!=Q("Desk").toBlob&&null!=desktop.m.StartRecording&&0==(1024&features2)),QV("DeskChatButton",0!=(16384&t)&&0==browserfullscreen&&currentNode.agent&&n),QV("DeskNotifyButton",0!=(16384&t)&&0==browserfullscreen&&currentNode.agent&&n),QV("DeskLockButton",0!=(16384&t)&&0==browserfullscreen&&currentNode.agent&&currentNode.agent.id<5&&o&&3==e),QV("DeskToolsButton",currentNode.agent&&n),QE("DeskToolsButton",o),QV("DeskOpenWebButton",0==browserfullscreen&&o&&currentNode.agent&&n),QV("DeskBackgroundButton",o&&3==e&&1==desktop.contype&&currentNode.agent&&11!=currentNode.agent.id&&16!=currentNode.agent.id&&n),QV("DeskControlSpan",o),QV("DeskRefreshButton",3==e&&1==desktop.contype),Q("DeskControl").checked=!!(8&t)&&1==getstore("DeskControl",1),QS("DeskControlSpan").color=Q("DeskControl").checked?null:"red",0==n&&QV("DeskTools",!1)}var autoConnectDesktopTimer=null;function autoConnectDesktop(e){autoConnectDesktopTimer=null==autoConnectDesktopTimer?setInterval(function(){connectDesktop(null,1)},1e3):(clearInterval(autoConnectDesktopTimer),null)}var agentConsoleMessages=["","Esperando a que el usuario otorgue acceso...","Denegado","Error al iniciar sesión de terminal remota, {0} ({1})","Timeout","Se recibieron datos de red inválidos","No se puede capturar la pantalla","Negociación de protocolo fallida ({0})","NLA no compatible","SSL requerido por el servidor","SSL no permitido por el servidor","Certificado SSL no en el servidor","Banderas inconsistentes","Híbrido requerido por el servidor","SSL con autenticación de usuario requerida por el servidor"];function formatAgentConsoleMessage(e,t,o){for(null==o&&(o=[]);o.length<3;)o.push("");return(t&&t<agentConsoleMessages.length?EscapeHtml(format(agentConsoleMessages[t],o[0],o[1],o[2])):EscapeHtml(e)).split("\n").join("<br />")+"<br /><br />"}function connectDesktop(e,t,o,n){xxdialogMode||(null!=e&&0!=e.shiftKey&&3==t&&(t=1),QV("p11DeskSessionSelector",!1),p11clearConsoleMsg(),null==desktop?(desktopNode=currentNode,2==t?null==desktopNode.intelamt.user||""==desktopNode.intelamt.user?editDeviceAmtSettings(desktopNode._id,connectDesktop,2):((desktop=CreateAmtRedirect(CreateAmtRemoteDesktop("Desk"),authCookie)).debugmode=debugmode,desktop.onStateChanged=onDesktopStateChange,desktop.m.bpp=1==desktopsettings.encoding||3==desktopsettings.encoding?1:2,desktop.m.useZRLE=desktopsettings.encoding<3,desktop.m.localKeyMap=desktopsettings.localkeymap,desktop.m.ReverseMouseWheel=desktopsettings.kvmrmw,desktop.m.showmouse=desktopsettings.showmouse,desktop.m.onScreenSizeChange=deskAdjust,desktop.m.onKvmData=function(e){if(0==e.length)desktop.m._sentPresence||(desktop.m._sentPresence=!0,desktop.m.sendKvmData(JSON.stringify({action:"present",ver:1})));else{var t=null;try{t=JSON.parse(e)}catch(e){}null!=t&&null!=t.action&&("restart"==t.action?(webRtcDesktopReset(),desktop.m.sendKvmData(JSON.stringify({action:"present",ver:1}))):"present"==t.action&&null==webRtcDesktop?(webRtcDesktop={platform:t.platform},"undefined"!=typeof RTCPeerConnection?webRtcDesktop.webrtc=new RTCPeerConnection(null):"undefined"!=typeof webkitRTCPeerConnection&&(webRtcDesktop.webrtc=new webkitRTCPeerConnection(null)),webRtcDesktop.webchannel=webRtcDesktop.webrtc.createDataChannel("Canal de Datos",{}),webRtcDesktop.webchannel.onopen=function(){console.log("WebRTC Data Channel Open"),Q("deskstatus").textContent=StatusStrs[desktop.State]+", Soft-KVM",desktop.m.hold(!0),webRtcDesktop.webRtcActive=!0,webRtcDesktop.softdesktop=CreateKvmDataChannel(webRtcDesktop.webchannel,CreateAgentRemoteDesktop("Desk",Q("id_mainarea")),desktop.m),webRtcDesktop.softdesktop.m.setRotation(desktop.m.rotation),webRtcDesktop.softdesktop.m.onScreenSizeChange=deskAdjust,webRtcDesktop.softdesktop.m.ImageType=webpSupport?4:1,desktopsettings.quality&&(webRtcDesktop.softdesktop.m.CompressionLevel=desktopsettings.quality),desktopsettings.scaling&&(webRtcDesktop.softdesktop.m.ScalingLevel=desktopsettings.scaling),webRtcDesktop.softdesktop.Start()},webRtcDesktop.webchannel.onclose=function(e){console.log("WebRTC Data Channel Closed"),webRtcDesktopReset()},webRtcDesktop.webrtc.onicecandidate=function(e){null==e.candidate?desktop.m.sendKvmData(JSON.stringify({action:"offer",ver:1,sdp:webRtcDesktop.webrtcoffer.sdp})):webRtcDesktop.webrtcoffer.sdp+="a="+e.candidate.candidate+"\r\n"},webRtcDesktop.webrtc.oniceconnectionstatechange=function(){null==webRtcDesktop||null==webRtcDesktop.webrtc||"disconnected"!=webRtcDesktop.webrtc.iceConnectionState&&"failed"!=webRtcDesktop.webrtc.iceConnectionState||webRtcDesktopReset()},webRtcDesktop.webrtc.createOffer(function(e){webRtcDesktop.webrtcoffer=e,webRtcDesktop.webrtc.setLocalDescription(e,function(){},webRtcDesktopReset)},webRtcDesktopReset,{mandatory:{OfferToReceiveAudio:!1,OfferToReceiveVideo:!1}})):"answer"==t.action&&null!=webRtcDesktop&&webRtcDesktop.webrtc.setRemoteDescription(new RTCSessionDescription({type:"answer",sdp:t.sdp}),function(){},webRtcDesktopReset))}},4==desktopNode.conn&&null!=desktopNode.intelamt&&1==desktopNode.intelamt.tls?desktop.Start(desktopNode._id,16995,"*","*",1):desktop.Start(desktopNode._id,16994,"*","*",0),desktop.contype=2):null==t||1==t||3==t&&4<currentNode.agent.id&&null==debugmode?((desktop=CreateAgentRedirect(meshserver,CreateAgentRemoteDesktop("Desk"),serverPublicNamePort,authCookie,authRelayCookie,domainUrl)).m.UseExtendedKeyFlag=desktopNode.agent.id<5,desktop.m.mouseCursorActive(11==xxcurrentView),desktop.debugmode=debugmode,desktop.m.debugmode=debugmode,desktop.attemptWebRTC=attemptWebRTC,desktop.webrtcconfig=webrtcconfiguration,desktop.options={},null!=o&&(desktop.options.tsid=o),null!=n&&(desktop.options.consent=n),1==desktopsettings.autolock&&(desktop.options.autolock=!0),desktop.onStateChanged=onDesktopStateChange,0!=(8192&features2)&&(desktop.m.stopInput=!0),desktop.m.onRemoteInputLockChanged=function(e,t){QV("DeskInputLockedButton",t),QV("DeskInputUnLockedButton",!t)},desktop.m.onKeyboardStateChanged=function(e,t){QS("p11numlock").display=1&t?"inline-block":"none",QS("p11scrolllock").display=2&t?"inline-block":"none",QS("p11capslock").display=4&t?"inline-block":"none"},desktop.onConsoleMessageChange=function(){desktop.consoleMessage?(Q("p11DeskConsoleMsg").innerHTML+=formatAgentConsoleMessage(desktop.consoleMessage,desktop.consoleMessageId,desktop.consoleMessageArgs),QV("p11DeskConsoleMsg",!0),null!=p11DeskConsoleMsgTimer&&clearTimeout(p11DeskConsoleMsgTimer),desktop.consoleMessageTimeout&&(p11DeskConsoleMsgTimer=setTimeout(p11clearConsoleMsg,1e3*desktop.consoleMessageTimeout))):p11clearConsoleMsg()},desktop.onMetadataChange=function(e){updateMetadata(desktop,"deskmetadata")},desktop.m.ImageType=desktopsettings.agentencoding,desktop.m.CompressionLevel=desktopsettings.quality,desktop.m.ScalingLevel=desktopsettings.scaling,desktopsettings.framerate&&(desktop.m.FrameRateTimer=desktopsettings.framerate),desktopsettings.swapmouse&&(desktop.m.SwapMouse=desktopsettings.swapmouse),desktopsettings.rmw&&(desktop.m.ReverseMouseWheel=desktopsettings.rmw),1==desktopsettings.remotekeymap&&(desktop.m.remoteKeyMap=desktopsettings.remotekeymap),desktop.m.onScreenSizeChange=deskAdjust,desktop.Start(desktopNode._id),desktop.latency.callback=function(e){updateSessionTime()},desktop.contype=1):3==t?meshserver.send({action:"msg",type:"userSessions",nodeid:currentNode._id,tag:n}):4==t&&((desktop=CreateRDPDesktop("Desk",domainUrl)).onStateChanged=onDesktopStateChange,desktop.m.onScreenSizeChange=mdeskAdjust,desktop.m.onClipboardChanged=function(e){null!=e&&desktopsettings.rdpautoclipboard&&null!=navigator.clipboard&&navigator.clipboard.writeText(e).then(function(){}).catch(function(e){console.log(e)})},desktopsettings.rdpsmb&&(desktop.m.SwapMouse=desktopsettings.rdpsmb),desktopsettings.rdprmw&&(desktop.m.ReverseMouseWheel=desktopsettings.rdprmw),desktop.Start(desktopNode._id,currentNode.rdpport||3389,o),desktop.contype=4,desktop.onConsoleMessageChange=function(){desktop.consoleMessage?(Q("p11DeskConsoleMsg").innerHTML+=formatAgentConsoleMessage(desktop.consoleMessage,desktop.consoleMessageId,desktop.consoleMessageArgs),QV("p11DeskConsoleMsg",!0),null!=p11DeskConsoleMsgTimer&&clearTimeout(p11DeskConsoleMsgTimer),desktop.consoleMessageTimeout&&(p11DeskConsoleMsgTimer=setTimeout(p11clearConsoleMsg,1e3*desktop.consoleMessageTimeout))):p11clearConsoleMsg()})):(desktop.Stop(),webRtcDesktopReset(),(desktopNode=desktop=null)!=pluginHandler&&pluginHandler.callHook("onDesktopDisconnect")))}function askRdpCredentials(){var e;xxdialogMode||(e="<div>",1==currentNode.rdp?e=e+addHtmlFormFloating("Credenciales",'<select id=d2mode class="form-select" onchange=askRdpCredentialsValidate()><option value=1>Usar credenciales del servidor</option><option value=2>Usar nuevas credenciales</option></select>')+"<div id=d2cred style=display:none>":e+="<div id=d2cred>",e=(e=(e+=addHtmlFormFloating("Dominio",'<input type=text id=d2domain class="form-control" maxlength=128 />'))+addHtmlFormFloating("Nombre de Usuario",'<input type=text id=d2user class="form-control" onKeyUp=askRdpCredentialsValidate() maxlength=128 />'))+addHtmlFormFloating("Contraseña",'<input type=password id=d2pass class="form-control" maxlength=128 autocomplete=off />'),0==(4194304&features2)&&(e+=addHtmlValue("",'<label><input type="checkbox" class="form-check-input me-2" id=d2savecred>Recuerda credenciales</label>')),setModalContent("xxAddAgent","Credenciales RDP",e=(e=(e=(e=(e+="</div>")+MoreStart())+addHtmlFormFloating("Alt Shell",'<input type=text id=d2altshell class="form-control" maxlength=2048 />'))+addHtmlFormFloating("Dirección de trabajo",'<input type=text id=d2workdir class="form-control" maxlength=2048 />'))+MoreEnd()),showModal("xxAddAgentModal","idx_dlgOkButton",()=>askRdpCredentialsEx()))}function askRdpCredentialsValidate(){1==currentNode.rdp&&(QV("d2cred",2==Q("d2mode").value),1==Q("d2mode").value)?QE("idx_dlgOkButton",!0):QE("idx_dlgOkButton",""!=Q("d2user").value)}function askRdpCredentialsEx(){var e,t=null,o=null;desktopsettings.rdpsize?"browser"==desktopsettings.rdpsize?(t=window.innerWidth,o=window.innerHeight):"screen"==desktopsettings.rdpsize?(t=window.screen.width,o=window.screen.height):"canvas"==desktopsettings.rdpsize?(t=Q("DeskParent").offsetWidth,o=Q("DeskParent").offsetHeight):1<=(e=desktopsettings.rdpsize.indexOf("x"))&&(t=parseInt(desktopsettings.rdpsize.substring(0,e)),o=parseInt(desktopsettings.rdpsize.substring(e+1))):(t=Q("DeskParent").offsetWidth,o=Q("DeskParent").offsetHeight),1==currentNode.rdp&&1==Q("d2mode").value?connectDesktop(null,4,{servercred:!0,width:t,height:o,flags:null!=desktopsettings.rdpflags?desktopsettings.rdpflags:47,altshell:Q("d2altshell").value,workdir:Q("d2workdir").value}):(e=!1,0==(4194304&features2)&&(e=Q("d2savecred").checked),connectDesktop(null,4,{domain:Q("d2domain").value,username:Q("d2user").value,password:Q("d2pass").value,savecred:e,width:t,height:o,flags:null!=desktopsettings.rdpflags?desktopsettings.rdpflags:47,altshell:Q("d2altshell").value,workdir:Q("d2workdir").value}))}function updateMetadata(e,t){var o="",n=0;if(e&&3==e.State){if(e.metadata&&e.metadata.users)for(var i in e.metadata.users)n+=e.metadata.users[i];1<n&&(o="<span onclick=showSessionMetadata(1) style=cursor:pointer>"+format(", {0} viendo",n)+"</span>")}QH("deskmetadata",o),e==desktop&&"sessionMetadata1"==xxdialogTag&&showSessionMetadata(1)}function showSessionMetadata(e){if(!xxdialogMode||xxdialogTag=="sessionMetadata"+e){xxdialogMode&&setDialogMode(0);var t=1==e?desktop:null;if(t&&t.metadata){var o="";if(t.metadata.startTime&&(o+=addHtmlValue4("Tiempo de Inicio",printDateTime(new Date(t.metadata.startTime)))),t.metadata.users)for(var n in t.metadata.users){var i=1==t.metadata.users[n]?"1 conexión":format("{0} conexiones",t.metadata.users[n]);o+=addHtmlValue2(getUserName(n),i)}xxdialogTag="sessionMetadata"+e,setModalContent("xxAddAgent","Información de la Sesión",o),showModal("xxAddAgentModal","idx_dlgOkButton")}}}function p11clearConsoleMsg(){QH("p11DeskConsoleMsg",""),QV("p11DeskConsoleMsg",!1),p11DeskConsoleMsgTimer&&(clearTimeout(p11DeskConsoleMsgTimer),p11DeskConsoleMsgTimer=null)}function p12clearConsoleMsg(){QH("p12TermConsoleMsg",""),QV("p12TermConsoleMsg",!1),p12TermConsoleMsgTimer&&(clearTimeout(p12TermConsoleMsgTimer),p12TermConsoleMsgTimer=null)}function p13clearConsoleMsg(){QH("p13FilesConsoleMsg",""),QV("p13FilesConsoleMsg",!1),p13FilesConsoleMsgTimer&&(clearTimeout(p13FilesConsoleMsgTimer),p13FilesConsoleMsgTimer=null)}function p12setConsoleMsg(e,t){e?(Q("p12TermConsoleMsg").innerHTML+=e,QV("p12TermConsoleMsg",!0),null!=p12TermConsoleMsgTimer&&clearTimeout(p12TermConsoleMsgTimer),t&&(p12TermConsoleMsgTimer=setTimeout(p12clearConsoleMsg,t))):p12clearConsoleMsg()}function p13setConsoleMsg(e,t){e?(Q("p13FilesConsoleMsg").innerHTML+=e,QV("p13FilesConsoleMsg",!0),null!=p13FilesConsoleMsgTimer&&clearTimeout(p13FilesConsoleMsgTimer),t&&(p13FilesConsoleMsgTimer=setTimeout(p13clearConsoleMsg,t))):p13clearConsoleMsg()}var webRtcDesktop=null;function webRtcDesktopReset(){if(null!=webRtcDesktop){if(null!=webRtcDesktop.softdesktop&&(webRtcDesktop.softdesktop.Stop(),webRtcDesktop.softdesktop=null),null!=webRtcDesktop.webchannel){try{webRtcDesktop.webchannel.close()}catch(e){}webRtcDesktop.webchannel=null}if(null!=webRtcDesktop.webrtc){try{webRtcDesktop.webrtc.close()}catch(e){}webRtcDesktop.webrtc=null}webRtcDesktop=null,desktop&&desktop.m&&(desktop.m.hold(!1),Q("deskstatus").textContent=StatusStrs[desktop.State])}}function onDesktopStateChange(e,t){var o=t,e=(3==o&&2==e.contype&&o++,StatusStrs[o]);switch(null!=desktop&&1==desktop.webRtcActive&&(e+=", WebRTC"),null!=desktop&&3==o&&4==desktop.contype&&(e+=", RDP"),QH("deskstatus",e),t){case 0:null!=desktop&&(null!=desktop.m.recordedData&&deskRecordSession(),desktop.Stop()),desktopNode=desktop=null,QV("DeskFocus",!1),QV("DeskMonitorSelectionSpan",!1),QV("deskRecordIcon",!1),QV("DeskInputLockedButton",!1),QV("DeskInputUnLockedButton",!1),deskFocusBtn.value="Todos se Centran",1==fullscreen&&deskToggleFull(),webRtcDesktopReset(),deskPreferedStickyDisplay=0;break;case 2:break;case 3:desktop&&1==desktop.serverIsRecording&&QV("deskRecordIcon",!0),desktop.startTime=new Date,(deskLastClipboardSent=null)==updateSessionTimer&&(updateSessionTimer=setInterval(updateSessionTime,1e3))}updateDesktopButtons(),deskAdjust(),setTimeout(deskAdjust,50),updateMetadata(desktop,"deskmetadata")}function updateSessionTime(){var e="",t=0;if(desktop&&desktop.startTime){if(desktop.latency&&0<=desktop.latency.current&&(e=format("{0} ms",desktop.latency.current)),t=Math.floor((new Date-desktop.startTime)/1e3),QH("DeskTimer",zeroPad(Math.floor(t/3600),2)+":"+zeroPad(Math.floor(t/60)%60,2)+":"+zeroPad(t%60,2)),QH("DeskLatency",e),(4!=desktop.contype&&!0===desktopsettings.autoclipboard||4==desktop.contype&&!0===desktopsettings.rdpautoclipboard)&&null!=navigator.clipboard&&null!=navigator.clipboard.readText){if("firefox"==Mstsc.browser())return;try{navigator.clipboard.readText().then(function(e){null!=desktop&&null!=e&&deskLastClipboardSent!=e&&(desktop.m.setClipboard?desktop.m.setClipboard(e):(console.log("s3"),meshserver.send({action:"msg",type:"setclip",nodeid:currentNode._id,data:e})),deskLastClipboardSent=e)}).catch(function(e){})}catch(e){console.log(e)}}}else QH("DeskTimer",""),QH("DeskLatency","");t=0,terminal&&terminal.startTime?(terminal.latency&&0<=terminal.latency.current&&(e=format("{0} ms, ",terminal.latency.current)),t=Math.floor((new Date-terminal.startTime)/1e3),QH("TermTimer",e+zeroPad(Math.floor(t/3600),2)+":"+zeroPad(Math.floor(t/60)%60,2)+":"+zeroPad(t%60,2))):QH("TermTimer",""),null==desktop&&null==terminal&&(clearInterval(updateSessionTimer),updateSessionTimer=null)}function showDesktopSettings(){var e;xxdialogMode||(applyDesktopSettings(),updateDesktopButtons(),e=!1,0==(e="none"!=QS("td7meshkvm").display&&0<Q("td7meshkvm").className.indexOf("active")||"none"!=QS("td7rdpkvm").display&&0<Q("td7rdpkvm").className.indexOf("active")||"none"!=QS("td7amtkvm").display&&0<Q("td7amtkvm").className.indexOf("active")?!0:e)&&("none"!=QS("td7meshkvm").display?changeDesktopSettingsTab(null,"d7meshkvm"):"none"!=QS("td7rdpkvm").display?changeDesktopSettingsTab(null,"d7rdpkvm"):"none"!=QS("td7amtkvm").display&&changeDesktopSettingsTab(null,"d7amtkvm")),xxdialogButtons=3,setModalContent("xxAddAgent","Opciones de Escritorio Remoto",7),showModal("xxAddAgentModal","idx_dlgOkButton",showDesktopSettingsChanged))}function changeDesktopSettingsTab(e,t){for(var o,n=document.getElementsByClassName("tabcontent"),i=0;i<n.length;i++)n[i].style.display="none";for(o=document.getElementsByClassName("tablinks"),i=0;i<o.length;i++)o[i].className=o[i].className.replace(" active","");document.getElementById(t).style.display="block",null!=e?e.currentTarget.className+=" active":document.getElementById("t"+t).className+=" active"}function showDesktopSettingsChanged(){desktopsettings.encoding=d7desktopmode.value,desktopsettings.showfocus=d7showfocus.checked,desktopsettings.showmouse=d7showcursor.checked,desktopsettings.quality=d7bitmapquality.value,desktopsettings.scaling=d7bitmapscaling.value,desktopsettings.framerate=d7framelimiter.value,desktopsettings.agentencoding=d7encoding.value,desktopsettings.swapmouse=d7deskSwapMouse.checked,desktopsettings.rmw=d7deskrmw.checked,desktopsettings.remotekeymap=d7deskRemoteKeyMap.checked,desktopsettings.autoclipboard=d7deskAutoClipboard.checked,desktopsettings.autolock=d7deskAutoLock.checked,desktopsettings.localkeymap=d7localKeyMap.checked,desktopsettings.kvmrmw=d7kvmrmw.checked,desktopsettings.rdpsize=d7rdpsize.value,desktopsettings.rdpsmb=d7rdpsmb.checked,desktopsettings.rdprmw=d7rdprmw.checked,desktopsettings.rdpautoclipboard=d7rdpclip.checked;for(var e=0,t=1;t<10;t++)5!=t&&Q("d7rdp"+t).checked&&(e|=1<<t-1);desktopsettings.rdpflags=e,localStorage.setItem("desktopsettings",JSON.stringify(desktopsettings)),applyDesktopSettings(),updateDesktopButtons(),desktop&&(1==desktop.contype&&(desktop.m.SwapMouse=desktopsettings.swapmouse,desktop.m.ReverseMouseWheel=desktopsettings.rmw,desktop.m.remoteKeyMap=desktopsettings.remotekeymap,0!=desktop.State)&&(desktop.m.SendCompressionLevel(desktopsettings.agentencoding,desktopsettings.quality,desktopsettings.scaling,desktopsettings.framerate),desktop.sendCtrlMsg('{"ctrlChannel":"102938","type":"autolock","value":'+desktopsettings.autolock+"}"),desktop.m.SendRefresh()),2==desktop.contype&&(desktop.m.ReverseMouseWheel=desktopsettings.kvmrmw,0==desktopsettings.showfocus&&(desktop.m.focusmode=0,deskFocusBtn.value="Todos se Centran"),0!=desktop.State)&&(desktop.Stop(),setTimeout(function(){connectDesktop(null,2)},50)),4==desktop.contype)&&(desktop.m.SwapMouse=desktopsettings.rdpsmb,desktop.m.ReverseMouseWheel=desktopsettings.rdprmw)}function applyDesktopSettings(){var e="",t=512&features?[100,90,80,70,60,50,40,30,20,10,5,1]:[60,50,40,30,20,10,5,1];for(o in t)e+="<option value="+t[o]+">"+t[o]+"%</option>";QH("d7bitmapquality",e),d7desktopmode.value=desktopsettings.encoding,d7showfocus.checked=desktopsettings.showfocus,d7showcursor.checked=desktopsettings.showmouse,desktopsettings.agentencoding?d7encoding.value=desktopsettings.agentencoding:desktopsettings.agentencoding=4,d7bitmapquality.value=40,0<=t.indexOf(parseInt(desktopsettings.quality))&&(d7bitmapquality.value=desktopsettings.quality),d7bitmapscaling.value=desktopsettings.scaling,desktopsettings.framerate?d7framelimiter.value=desktopsettings.framerate:d7framelimiter.value=100,null!=desktopsettings.swapmouse&&(d7deskSwapMouse.checked=desktopsettings.swapmouse),null!=desktopsettings.rmw&&(d7deskrmw.checked=desktopsettings.rmw),null!=desktopsettings.remotekeymap&&(d7deskRemoteKeyMap.checked=desktopsettings.remotekeymap),null!=desktopsettings.autoclipboard&&(d7deskAutoClipboard.checked=desktopsettings.autoclipboard),null!=desktopsettings.autolock&&(d7deskAutoLock.checked=desktopsettings.autolock),desktopsettings.localkeymap&&(d7localKeyMap.checked=desktopsettings.localkeymap),desktopsettings.kvmrmw&&(d7kvmrmw.checked=desktopsettings.kvmrmw),QV("deskFocusBtn",null!=desktop&&2==desktop.contype&&0!=desktop.state&&desktopsettings.showfocus),null!=desktopsettings.rdpsize&&(d7rdpsize.value=desktopsettings.rdpsize),null==desktopsettings.rdpflags&&(desktopsettings.rdpflags=47),null!=desktopsettings.rdpsmb&&(d7rdpsmb.checked=desktopsettings.rdpsmb),null!=desktopsettings.rdprmw&&(d7rdprmw.checked=desktopsettings.rdprmw),null!=desktopsettings.rdpautoclipboard&&(d7rdpclip.checked=desktopsettings.rdpautoclipboard);for(var o=1;o<10;o++)5!=o&&(Q("d7rdp"+o).checked=0!=(desktopsettings.rdpflags&1<<o-1))}function enterBrowserFullscreen(e){navigator.keyboard&&navigator.keyboard.lock&&navigator.keyboard.lock(),e.requestFullscreen?e.requestFullscreen():e.msRequestFullscreen?e.msRequestFullscreen():e.mozRequestFullScreen?e.mozRequestFullScreen():e.webkitRequestFullscreen&&e.webkitRequestFullscreen(Element.ALLOW_KEYBOARD_INPUT)}function exitBrowserFullscreen(){document.exitFullscreen?document.exitFullscreen():document.msExitFullscreen?document.msExitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitExitFullscreen&&document.webkitExitFullscreen(),navigator.keyboard&&navigator.keyboard.unlock&&navigator.keyboard.unlock()}function isBrowserFullscreen(){return!!(document.fullscreenElement||document.mozFullScreenElement||document.webkitFullscreenElement||document.msFullscreenElement)}var fullscreen=!1,browserfullscreen=!1;function deskToggleFull(e){var t=!(0===args.xterm||null!=terminal&&null==xterm);(fullscreen=!fullscreen)?(QC("body").add("fulldesk"),QS("deskarea3x").height="100%",QS("deskarea3x")["max-height"]="100%",t?(QS("termTable").position="absolute",QS("termTable").top=QS("termTable").bottom=QS("termTable").left=QS("termTable").right="0"):(QS("termTable").height="100%",QS("termTable")["max-height"]="100%"),1==e.shiftKey&&(enterBrowserFullscreen(Q("container")),browserfullscreen=!0)):(QC("body").remove("fulldesk"),e=args.hide,0==footerBar&&(e|=4),e=(1&e?0:66)+(2&e?0:24)+(4&e?0:45)+(8&e?0:60),QS("deskarea3x").height="calc(100vh - "+(75+e)+"px)",QS("deskarea3x")["max-height"]="calc(100vh - "+(75+e)+"px)",t?(QS("termTable").position=null,QS("termTable").top=QS("termTable").bottom=QS("termTable").left=QS("termTable").right=null):(QS("termTable").height="calc(100vh - "+(75+e)+"px)",QS("termTable")["max-height"]="calc(100vh - "+(75+e)+"px)"),1==browserfullscreen&&(exitBrowserFullscreen(),browserfullscreen=!1)),deskAdjust(),updateDesktopButtons(),adjustPanels(),null!=xterm&&12==xxcurrentView&&(xtermfit.fit(),xterm.focus())}function deskToggleFocus(){desktop.m.focusmode=(desktop.m.focusmode+64)%192,Q("deskFocusBtn").value=["Todos se Centran","Enfoque Pequeño","Gran Enfoque"][desktop.m.focusmode/64]}function deskAdjust(){var e=Q("DeskParent").clientHeight,t=Q("DeskParent").clientWidth,o=Q("Desk").height,n=Q("Desk").width;2==deskAspectRatio?(QS("Desk")["margin-top"]=null,QS("Desk").height="100%",QS("Desk").width="100%",QS("DeskParent").overflow="hidden"):1==deskAspectRatio?(QS("Desk")["margin-top"]="0px",QS("Desk").height=o+"px",QS("Desk").width=n+"px",QS("DeskParent").overflow="scroll"):(o/n<e/t?(t=o*t/n+"px",QS("Desk").height=t,QS("Desk").width="100%"):(t=n*e/o+"px",QS("Desk").height=webPageFullScreen||fullscreen?null:"100%",QS("Desk").width=t),QS("Desk")["margin-top"]=null,QS("DeskParent").overflow="hidden")}function mdeskAdjust(e,t,o,n){var i;e&&t&&o&&n&&(3!=(i=Q("viewselect").value)&&5!=i||("Desk"==n.id?deskAdjust():(5==i&&(i=[{x:180,y:101},{x:302,y:169},{x:454,y:255}][Q("sizeselect").selectedIndex],QS(n.id).width=(0!=e.State?t*i.y/o:i.x)+"px"),QS(n.id)["margin-top"]=null,QS(n.id)["margin-bottom"]=null)))}function sendDeskEsc(){null!=desktop&&3==desktop.State&&(2==desktop.contype?desktop.m.sendkey([[65307,1],[65307,0]]):desktop.m.SendKeyMsgKC([[desktop.m.KeyAction.EXDOWN,27],[desktop.m.KeyAction.EXUP,27]]))}function p11fileDragDrop(e){var t;haltEvent(e),QV("p11bigfail",!1),QV("p11bigok",!1),null==xxdialogMode&&null!=desktop&&3==desktop.State&&null!=e.dataTransfer&&0!=e.dataTransfer.files.length&&((t=(e=e.dataTransfer.files[0]).name.toLowerCase()).endsWith(".bat")||t.endsWith(".ps1")||t.endsWith(".sh")||t.endsWith(".agentconsole")?d2runCommandDialog({nodeids:[currentNode._id],selectedFile:e}):t.endsWith(".txt")&&((t=new FileReader).onload=function(e){showDeskType(e.target.result)},t.readAsText(e)))}var p11dragtimer=null;function p11fileDragOver(e){haltEvent(e),null!=p11dragtimer&&(clearTimeout(p11dragtimer),p11dragtimer=null);e=null==xxdialogMode&&null!=desktop&&3==desktop.State;QV("p11bigok",e),QV("p11bigfail",!e)}function p11fileDragLeave(e){haltEvent(e),"Desk"!=e.target.id?(QV("p11bigfail",!1),QV("p11bigok",!1)):p11dragtimer=setTimeout(function(){QV("p11bigfail",!1),QV("p11bigok",!1),p11dragtimer=null},10)}function updateDeskShortcutKeys(){var e,t="",o=parseInt(Q("deskkeys").value);for(e in""==o&&0<deskKeyboardShortcuts.length&&(o=deskKeyboardShortcuts[0]),deskKeyboardShortcuts)t+="<option value="+deskKeyboardShortcuts[e]+(o==deskKeyboardShortcuts[e]?" selected":"")+">"+keyShortcutTotext(deskKeyboardShortcuts[e])+"</option>";QH("deskkeys",t)}var keyStrings={8:"Retroceso",9:"Tab",13:"Enter",27:"Escape",32:"Espacio",44:"Imprimir Pantalla",45:"Insertar",46:"Del",36:"Casa",35:"Final",33:"Página Arriba",34:"Página Abajo",37:"Izquierda",38:"Subir",39:"Derecha",40:"Abajo",0:"Ninguno"};function keyShortcutTotext(e){var t=[];return 65536&e&&t.push("Cambiar"),131072&e&&t.push("Alt"),524288&e&&t.push("Ctrl"),1048576&e&&t.push("Win"),112<=(e&=65535)&&e<=123?t.push("F"+(e-111)):0!=e&&keyStrings[e]?t.push(keyStrings[e]):0!=e&&t.push(String.fromCharCode(e)),t.join(" + ")}function deskCustomizeKeys(){if(!xxdialogMode){var e=(e='<div id=d2shortcuts style="width:100%;height:180px;padding:4px;overflow-y:auto;border:1px solid gray"></div><div style=width:100%;padding:5px>')+'<label><input id=d1kshift type=checkbox class="form-check-input me-2" /> Cambiar</label><label> <input id=d1kalt type=checkbox class="form-check-input me-2" /> Alt</label><label> <input id=d1kctrl type=checkbox class="form-check-input me-2" /> Ctrl</label> <input id=d1kwin type=checkbox class="form-check-input me-2" /> Win</label>'+" <select id=d2keySelect>";for(t in keyStrings)e+="<option value="+t+">"+keyStrings[t]+"</option>";for(var t=1;t<=12;t++)e+="<option value="+(t+111)+">F"+t+"</option>";for(t=0;t<10;t++)e+="<option value="+(t+48)+">"+t+"</option>";for(t=0;t<26;t++)e+="<option value="+(t+65)+">"+String.fromCharCode(t+65)+"</option>";setModalContent("xxAddAgent","Personalización de atajos de teclado",e=e+"</select> <input type=button value=Agregar onclick=addDeskCustomizeKey() /></div>"+'<div style=width:100%;padding:2px;text-align:center><input type=button value="Restore Default Keyboard Shortcuts" onclick=restoreDeskCustomizeKey() /></div>'),showModal("xxAddAgentModal","idx_dlgOkButton",()=>deskCustomizeKeysEx()),deskUpdateShortcutList()}}function deskCustomizeKeysEx(){putstore("deskKeyShortcuts",deskKeyboardShortcuts.join(",")),updateDeskShortcutKeys()}function deskUpdateShortcutList(){var e,t="";for(e in deskKeyboardShortcuts){var o=keyShortcutTotext(deskKeyboardShortcuts[e]),n="";e!=deskKeyboardShortcuts.length-1&&(n+='<img width=8 height=8 style=float:right;cursor:pointer;padding:3px src="images/c2.png" onclick=deskCustomizeKeyDown('+deskKeyboardShortcuts[e]+")>"),0!=e&&(n+='<img width=8 height=8 style=float:right;cursor:pointer;padding:3px src="images/c3.png" onclick=deskCustomizeKeyUp('+deskKeyboardShortcuts[e]+")>"),t+='<div style="width:100%;background-color:#AAA;border-radius:4px;margin-bottom:4px;padding:4px;text-align:left;box-sizing:border-box" value='+deskKeyboardShortcuts[e]+">"+o+'<img width=10 height=10 style=float:right;cursor:pointer;padding:2px;margin-left:8px src="images/trash.png" onclick=removeDeskCustomizeKey('+deskKeyboardShortcuts[e]+")>"+n+"</div>"}""==t&&(t="<i>No se han definido atajos de teclado</i>"),QH("d2shortcuts",t)}function deskCustomizeKeyDown(e){var e=deskKeyboardShortcuts.indexOf(e),t=deskKeyboardShortcuts[e+1];deskKeyboardShortcuts[e+1]=deskKeyboardShortcuts[e],deskKeyboardShortcuts[e]=t,deskUpdateShortcutList()}function deskCustomizeKeyUp(e){var e=deskKeyboardShortcuts.indexOf(e),t=deskKeyboardShortcuts[e];deskKeyboardShortcuts[e]=deskKeyboardShortcuts[e-1],deskKeyboardShortcuts[e-1]=t,deskUpdateShortcutList()}function removeDeskCustomizeKey(e){var t,o=[];for(t in deskKeyboardShortcuts)deskKeyboardShortcuts[t]!=e&&o.push(deskKeyboardShortcuts[t]);deskKeyboardShortcuts=o,deskUpdateShortcutList()}function restoreDeskCustomizeKey(){deskKeyboardShortcuts=[],putstore("deskKeyShortcuts",null);var e,t=getstore("deskKeyShortcuts","0x0A002E,0x100000,0x100028,0x100026,0x10004C,0x10004D,0x11004D,0x100052,0x020073,0x080057,0x020009,0x100025,0x100027").split(",");for(e in t)""!=t[e]&&deskKeyboardShortcuts.push(parseInt(t[e]));updateDeskShortcutKeys(),deskUpdateShortcutList()}function addDeskCustomizeKey(){var e=parseInt(Q("d2keySelect").value);Q("d1kshift").checked&&(e|=65536),Q("d1kalt").checked&&(e|=131072),Q("d1kctrl").checked&&(e|=524288),Q("d1kwin").checked&&(e|=1048576),0<e&&-1==deskKeyboardShortcuts.indexOf(e)&&(deskKeyboardShortcuts.push(e),deskUpdateShortcutList())}function deskCustomizeStrings(){var e;xxdialogMode||(e='<div id=d2strings style="width:100%;height:180px;padding:4px;overflow-y:auto;border:1px solid gray"></div><div style=width:100%;padding:5px>',setModalContent("xxAddAgent","Personalización de cuerdas de teclado",e=(e=(e+=addHtmlFormFloating("Nombre",'<input type=text id=d2shortcutname class="form-control" maxlength=32 autocomplete=off onkeyup=deskCustomizeStringsUpdate(event) />'))+addHtmlFormFloating("Valor",'<input type=text id=d2shortcutvalue class="form-control" maxlength=256 autocomplete=off onkeyup=deskCustomizeStringsUpdate(event) />'))+addHtmlFormFloating("",'<input id=d2addbutton type=button value=Agregar onclick=addDeskCustomizeString() class="form-control" />')),showModal("xxAddAgentModal","idx_dlgOkButton",()=>deskCustomizeStringsEx()),deskUpdateStringsList(),deskCustomizeStringsUpdate())}function deskCustomizeStringsUpdate(){QE("d2addbutton",""!=Q("d2shortcutname").value&&""!=Q("d2shortcutvalue").value)}function deskCustomizeStringsEx(){putstore("deskStrings",JSON.stringify(deskKeyboardStrings)),updateDesktopStrings()}function deskUpdateStringsList(){var e,t="";for(e in deskKeyboardStrings){var o="";e!=deskKeyboardStrings.length-1&&(o+='<img width=8 height=8 style=float:right;cursor:pointer;padding:3px src="images/c2.png" onclick=deskCustomizeStringDown('+e+")>"),0!=e&&(o+='<img width=8 height=8 style=float:right;cursor:pointer;padding:3px src="images/c3.png" onclick=deskCustomizeStringUp('+e+")>"),t=(t+='<div style="width:100%;background-color:#AAA;border-radius:4px;margin-bottom:4px;padding:4px;text-align:left;box-sizing:border-box" value='+(e+1e3)+"><div><b>"+EscapeHtml(deskKeyboardStrings[e].n)+'</b><img width=10 height=10 style=float:right;cursor:pointer;padding:2px;margin-left:8px src="images/trash.png" onclick=removeDeskCustomizeString('+e+")>"+o+"</div>")+("<div stlye=font-size:x-small>"+EscapeHtml(deskKeyboardStrings[e].v)+"</div>")+"</div>"}""==t&&(t="<i>No hay cadenas de teclado definidas</i>"),QH("d2strings",t)}function deskCustomizeStringDown(e){var t=deskKeyboardStrings[e+1];deskKeyboardStrings[e+1]=deskKeyboardStrings[e],deskKeyboardStrings[e]=t,deskUpdateStringsList()}function deskCustomizeStringUp(e){var t=deskKeyboardStrings[e];deskKeyboardStrings[e]=deskKeyboardStrings[e-1],deskKeyboardStrings[e-1]=t,deskUpdateStringsList()}function removeDeskCustomizeString(e){deskKeyboardStrings.splice(e,1),deskUpdateStringsList()}function addDeskCustomizeString(){Array.isArray(deskKeyboardStrings)||(deskKeyboardStrings=[]);var e=Q("d2shortcutname").value,t=Q("d2shortcutvalue").value;""!=e&&""!=t&&(deskKeyboardStrings.push({n:e,v:t}),deskUpdateStringsList())}function updateDesktopStrings(){var e,t="";for(e in deskKeyboardStrings)t+='<div class="cmtext" onclick="cmdeskpreconfigtypeaction('+(parseInt(e)+1e3)+',event)">'+EscapeHtml(deskKeyboardStrings[e].n)+"</div>";""!=t&&(t+="<hr />"),QH("deskPreConfigShortcutContextMenu2",t)}function deskSendKeys(){if(Q("DeskWD").blur(),!xxdialogMode&&null!=desktop&&3==desktop.State){var e=parseInt(Q("deskkeys").value);if(655406==e)desktop.m.sendcad();else{var t=(16711680&e)>>16,e=65535&e,o=[],n=[],i={8:65288,9:65289,13:65293,27:65307,45:65379,46:65535,36:65360,35:65367,33:65365,34:65366,37:65361,38:65362,39:65363,40:65364,112:65470,113:65471,114:65472,115:65473,116:65474,117:65475,118:65476,119:65477,120:65478,121:65479,122:65480,123:65481};if(2==desktop.contype){1&t&&(o.push([65505,1]),n.push([65505,0])),2&t&&(o.push([65513,1]),n.push([65513,0])),8&t&&(o.push([65507,1]),n.push([65507,0])),16&t&&(o.push([65511,1]),n.push([65511,0])),65<=(e=i[e]?i[e]:e)&&e<=90&&(e+=32),0!=e&&(o.push([e,1]),n.push([e,0])),n.reverse();for(var a=0;a<n.length;a++)o.push(n[a]);desktop.m.sendkey(o)}else{1&t&&(o.push([desktop.m.KeyAction.DOWN,16]),n.push([desktop.m.KeyAction.UP,16])),2&t&&(o.push([desktop.m.KeyAction.EXDOWN,18]),n.push([desktop.m.KeyAction.EXUP,18])),8&t&&(o.push([desktop.m.KeyAction.EXDOWN,17]),n.push([desktop.m.KeyAction.EXUP,17])),16&t&&(o.push([desktop.m.KeyAction.EXDOWN,91]),n.push([desktop.m.KeyAction.EXUP,91])),0!=e&&(o.push([desktop.m.KeyAction.DOWN,e]),n.push([desktop.m.KeyAction.UP,e])),n.reverse();for(a=0;a<n.length;a++)o.push(n[a]);desktop.m.SendKeyMsgKC(o)}}}}function showDeskType(e){var t;xxdialogMode||null==desktop||3!=desktop.State||(Q("DeskType").blur(),t="<div>Ingresa el texto y haz clic en Aceptar para escribirlo de forma remota. Asegúrate de colocar el cursor remoto en la posición correcta antes de continuar.<div>",setModalContent("xxAddAgent","Entrada Remota de Teclado",t+='<textarea id=d2typeText style="margin-top:5px;width:100%;height:184px;resize:none" maxlength=2000>'+(e?EscapeHtml(e):"")+"</textarea>"),showModal("xxAddAgentModal","idx_dlgOkButton",()=>showDeskTypeEx()),Q("d2typeText").focus())}var AmtDeskTypeTimer=null,AmtDeskTypeContent=null,DeskTypeTranslate={39:222,42:106,43:107,44:188,45:189,46:190,47:191,59:186,61:187,91:219,92:220,93:221,96:192,191:111},DeskTypeShiftTranslate={33:49,34:222,35:51,36:52,37:53,38:55,40:57,41:48,58:186,60:188,62:190,63:191,64:50,94:54,95:189,106:56,107:187,123:219,124:220,125:221,126:192};function showDeskTypeEx(e){var t,o=[],n=!1,i=("string"==typeof e?t=e:(t=Q("d2typeText").value,Q("d2typeText").value)).toUpperCase();if(2==desktop.contype){for(var a in t){var s=t.charCodeAt(a);o.push([s,1],[s,0])}AmtDeskTypeContent=o,AmtDeskTypeTimer=setInterval(function(){var e=AmtDeskTypeContent.shift();desktop&&desktop.m.sendkey(e[0],e[1]),null!=desktop&&0!=AmtDeskTypeContent.length||(clearInterval(AmtDeskTypeTimer),AmtDeskTypeContent=null)},10)}else if(4==desktop.contype)desktop.m.SendStringUnicode(t);else if(!0!==desktopsettings.remotekeymap)desktop.m.SendStringUnicode(t);else{for(var a in t){var s=t.charCodeAt(a),r=i.charCodeAt(a);65<=s&&s<=90||97<=s&&s<=122?(s==r&&0==n&&(o.push([desktop.m.KeyAction.DOWN,16]),n=!0),s!=r&&1==n&&(o.push([desktop.m.KeyAction.UP,16]),n=!1)):48<=s&&s<=57?1==n&&(o.push([desktop.m.KeyAction.UP,16]),n=!1):DeskTypeTranslate[s]?(1==n&&(o.push([desktop.m.KeyAction.UP,16]),n=!1),r=DeskTypeTranslate[s]):DeskTypeShiftTranslate[s]&&(0==n&&(o.push([desktop.m.KeyAction.DOWN,16]),n=!0),r=DeskTypeShiftTranslate[s]),o.push([desktop.m.KeyAction.DOWN,r],[desktop.m.KeyAction.UP,r])}1==n&&(o.push([desktop.m.KeyAction.UP,16]),n=!1),desktop.m.SendKeyMsgKC(o)}}function showDeskClip(){var e;xxdialogMode||null==desktop||3!=desktop.State||(Q("DeskClip").blur(),e="",0==(2048&features2)&&(e+='<input id=dlgClipGet type=button value="Obtener portapapeles" style=width:160px onclick=showDeskClipGet()>'),0==(4096&features2)&&(e+='<input id=dlgClipSet type=button value="Asignar portapapeles" style=width:160px onclick=showDeskClipSet()>'),xxdialogTag="clipboard",setModalContent("xxAddAgent","Portapapeles Remoto",e=(e+='<div id=dlgClipStatus style="display:inline-block;margin-left:8px" ></div>')+'<textarea id=d2clipText style="width:100%;height:184px;resize:none" maxlength=65535></textarea>'+'<input type=button value="Close" style=width:80px;float:right onclick=dialogclose(0)><div style=height:26px;margin-top:3px><span id=linuxClipWarn style=display:none>El portapapeles remoto es válido por 60 segundos.</span>&nbsp;</div><div></div>'),showModal("xxAddAgentModal","idx_dlgOkButton"),Q("d2clipText").focus())}function showDeskClipGet(){null!=desktop&&3==desktop.State&&meshserver.send({action:"msg",type:"getclip",nodeid:currentNode._id,tag:1})}function showDeskClipSet(){null!=desktop&&3==desktop.State&&(desktop.m.setClipboard?desktop.m.setClipboard(Q("d2clipText").value):(meshserver.send({action:"msg",type:"setclip",nodeid:currentNode._id,data:Q("d2clipText").value}),QV("linuxClipWarn",currentNode&&currentNode.agent&&4<currentNode.agent.id&&21!=currentNode.agent.id&&22!=currentNode.agent.id&&34!=currentNode.agent.id)))}function sendCAD(){xxdialogMode||null==desktop||3!=desktop.State||desktop.m.sendcad()}function toggleDeskTools(){Q("DeskToolsButton").blur(),xxdialogMode||("none"==QS("DeskTools").display?(QV("DeskTools",!0),Q("DeskTools").nodeid=currentNode._id,QH("DeskToolsProcesses",""),QH("DeskToolsServices",""),QV("deskToolsTopTabService",!1),changeDeskToolTab(0),refreshDeskTools(0),refreshDeskTools(1)):QV("DeskTools",!1))}var deskToolTabSelection=0;function changeDeskToolTab(e){deskToolTabSelection=e,QV("DeskToolsProcessTab",0==e),QV("DeskToolsServiceTab",1==e),QS("deskToolsTopTabProcess").bottom=0==e?"0px":"3px",QS("deskToolsTopTabService").bottom=1==e?"0px":"3px",QS("deskToolsTopTabProcess").color=0==e?"black":"gray",QS("deskToolsTopTabService").color=1==e?"black":"gray"}function refreshDeskTools(e){e=null==e?deskToolTabSelection:e;QV("DeskToolsRefreshButton",!1),setTimeout(refreshDeskToolsEx,500),0==e&&meshserver.send({action:"msg",type:"ps",nodeid:currentNode._id}),1==e&&meshserver.send({action:"msg",type:"services",nodeid:currentNode._id})}function refreshDeskToolsEx(){QV("DeskToolsRefreshButton",!0)}var deskTools={sort:1,ssort:1,msg:null,smsg:null,resizing:!1};function sortProcess(e){deskTools.sort=e,showDeskToolsProcesses(deskTools.msg)}function sortService(e){deskTools.ssort=e,showDeskToolsServices(deskTools.smsg)}function sortProcessPid(e,t){return e.p>t.p?1:e.p<t.p?-1:sortProcessName(e,t)}function sortProcessName(e,t){return e.d>t.d?1:e.d<t.d?-1:0}function showDeskToolsProcesses(e){if(null==(deskTools.msg=e))QH("DeskToolsProcesses","");else if(Q("DeskTools").nodeid==e.nodeid){var t=[],o=null;try{o=JSON.parse(e.value)}catch(e){}if(null!=o){for(var n in o)t.push({p:parseInt(n),c:o[n].cmd,d:o[n].cmd.toLowerCase(),u:o[n].user});0==deskTools.sort?t.sort(sortProcessPid):1==deskTools.sort&&t.sort(sortProcessName);var i,a,s="";for(i in t)0!=t[i].p&&(a=t[i].c,s=(s=(s=(s=(s+="<div onclick=showProcessDetails("+t[i].p+') class="deskToolsBar d-flex">')+'<div class="pe-1 text-start" style=width:50px;>'+EscapeHtml(t[i].p)+"</div>")+'<div style="white-space:nowrap;overflow:hidden;text-overflow:ellipsis;" title="'+EscapeHtml(a)+'">'+a+"</div>")+'<div class="ms-auto">'+(t[i].u?EscapeHtml(t[i].u):""))+'<i class="ps-1 fa-solid fa-trash-can" role="button" title="Detener proceso" onclick=\'return stopProcess('+EscapeHtml(t[i].p)+',"'+EscapeHtml(t[i].c)+"\")'></i></div></div>");QH("DeskToolsProcesses",s)}}}function showProcessDetails(e){xxdialogMode||(setModalContent("xxAddAgent",format("Detalles del Proceso, #{0}",e),"Requesting Process Details..."),xxdialogTag="ps|"+currentNode._id+"|"+e,showModal("xxAddAgentModal","idx_dlgOkButton"),meshserver.send({action:"msg",type:"psinfo",nodeid:currentNode._id,pid:e}))}function showDeskToolsServices(e){if(null==(deskTools.smsg=e))QH("DeskToolsProcesses","");else if(Q("DeskTools").nodeid==e.nodeid){QV("deskToolsTopTabService",!0);var t=[],o=null;try{o=JSON.parse(e.value)}catch(e){}if(null!=(deskTools.services=o)){for(var n in o)o[n].status?t.push({p:capitalizeFirstLetter(o[n].status.state.toLowerCase()),d:o[n].displayName,i:n}):o[n].serviceType&&t.push({p:o[n].serviceType,d:o[n].name,i:n});0==deskTools.ssort?t.sort(sortProcessPid):1==deskTools.ssort&&t.sort(sortProcessName);var i,a,s="";for(n in t)0!=t[n].p&&(i=t[n].d,"Stopped"==(a=t[n].p)?a="Detenido":"Running"==a&&(a="Ejecutando"),s=(s=(s+="<div onclick=showServiceWaitDialog("+t[n].i+") class=deskToolsBar>")+"<div style=width:70px;float:left;padding-right:5px>"+EscapeHtml(a)+"</div>")+'<div style="white-space:nowrap;overflow:hidden;text-overflow:ellipsis" title="'+i+'">'+EscapeHtml(i)+"</div></div>");QH("DeskToolsServices",s)}}}function showServiceDetailsDialog(e){var t,o,n;xxdialogMode&&-1!=xxdialogTag.indexOf("service_")&&(t=xxdialogTag.replace("service_",""),o=e.value?JSON.parse(e.value):deskTools.services[t],e.value&&(o.displayName=deskTools.services[t].displayName),null!=o)&&(e="",o.name&&(e+=addHtmlValue("Nombre",o.name)),o.displayName&&(e+=addHtmlValue("Nombre para mostrar",o.displayName)),o.status&&("Stopped"==(n=capitalizeFirstLetter(o.status.state.toLowerCase()))?n="Detenido":"Running"==n&&(n="Ejecutando"),o.status.state&&(e+=addHtmlValue("Estado",n)),o.status.pid&&(e+=addHtmlValue("PID",o.status.pid)),n=[],!0===o.status.isFileSystemDriver&&n.push("FileSystemDriver"),!0===o.status.isInteractive&&n.push("Interactivo"),!0===o.status.isKernelDriver&&n.push("KernelDriver"),!0===o.status.isOwnProcess&&n.push("Tomar Proceso"),!0===o.status.isSharedProcess&&n.push("Procesos Compartidos"),0<n.length)&&(e+=addHtmlValue("Tipo",n.join(", "))),o.startType&&(e+=addHtmlValue("Start Type",o.startType)),o.user&&(e+=addHtmlValue("Usuario",o.user)),o.installedBy&&(e+=addHtmlValue("Installed By",o.installedBy)),o.installedDate&&(e+=addHtmlValue("Installed Date",printDateTime(new Date(o.installedDate)))),o.failureActions&&(o.failureActions.resetPeriod&&(e+=addHtmlValue("Restart Fail Count After ",(n=(o.failureActions.resetPeriod<86400?0:o.failureActions.resetPeriod)/86400)+" Day"+(1!=n?"s":""))),o.failureActions.actions)&&(o.failureActions.actions[0]&&(e+=addHtmlValue("First Failure",o.failureActions.actions[0].type)),o.failureActions.actions[1]&&(e+=addHtmlValue("Second Failure",o.failureActions.actions[1].type)),o.failureActions.actions[2])&&(e+=addHtmlValue("Subsequent Failures",o.failureActions.actions[2].type)),xxdialogTag="service_"+t,setModalContent("xxAddAgent","Detalles del Servicio",e+='<br/><div style=float:right;margin-bottom:12px><input type=button value="Cerrar" onclick=showServiceDetailsDialogEx(0,'+t+')></div><div style=margin-bottom:12px><input type=button value="Iniciar" onclick=showServiceDetailsDialogEx(1,'+t+')><input type=button value="Detener" onclick=showServiceDetailsDialogEx(2,'+t+')><input type=button value="Reiniciar" onclick=showServiceDetailsDialogEx(3,'+t+")></div>"),showModal("xxAddAgentModal","idx_dlgOkButton"))}function showServiceWaitDialog(e){var t;return xxdialogMode||null!=(t=deskTools.services[e])&&(meshserver.send({action:"msg",type:"service",nodeid:currentNode._id,serviceName:t.name}),xxdialogTag="service_"+e,setModalContent("xxAddAgent","Detalles del Servicio","Requesting Service Details..."),showModal("xxAddAgentModal","idx_dlgOkButton")),!1}function showServiceDetailsDialogEx(e,t){setDialogMode(0),0!=e&&null!=(t=deskTools.services[t])&&(1==e&&meshserver.send({action:"msg",type:"serviceStart",nodeid:currentNode._id,serviceName:t.name}),2==e&&meshserver.send({action:"msg",type:"serviceStop",nodeid:currentNode._id,serviceName:t.name}),3==e&&meshserver.send({action:"msg",type:"serviceRestart",nodeid:currentNode._id,serviceName:t.name}),setTimeout(function(){refreshDeskTools(1)},1e3))}function toggleKvmControl(){Q("DeskControl").blur(),putstore("DeskControl",Q("DeskControl").checked?1:0),QS("DeskControlSpan").color=Q("DeskControl").checked?null:"red"}function deskRecordSession(){var e;null!=desktop&&(null==desktop.m.recordedData?(Q("DeskRecordButtonImage").style.color="red",desktop.m.StartRecording()):(Q("DeskRecordButtonImage").style.color="",e=new Date,e="Sesión de Escritorio-"+currentNode.name+"-"+e.getFullYear()+"-"+("0"+(e.getMonth()+1)).slice(-2)+"-"+("0"+e.getDate()).slice(-2)+"-"+("0"+e.getHours()).slice(-2)+"-"+("0"+e.getMinutes()).slice(-2),saveAs(data2blob(desktop.m.StopRecording().join("")),e+".mcrec")))}function deskSaveImage(){var e,t;xxdialogMode||null==desktop||3!=desktop.State||(e=new Date,t="Escritorio-"+currentNode.name+"-"+e.getFullYear()+"-"+("0"+(e.getMonth()+1)).slice(-2)+"-"+("0"+e.getDate()).slice(-2)+"-"+("0"+e.getHours()).slice(-2)+"-"+("0"+e.getMinutes()).slice(-2),Q("Desk").toBlob(function(e){saveAs(e,t+".png")}))}function deskDisplayInfo(e,t,o){var n,i=0,a="";for(n in t){i++;var s=t[n],r=1,s=("All Displays"==s&&(s="Todas las Pantallas",r=2),s.startsWith("Display ")&&(s=format("Mostrar {0}",s.substring(8))),"id=DeskMonitorSelectionX"+n+' title="'+EscapeHtml(s)+'" onclick=deskSetDisplay('+n+") role=button");a+=2==r?"<span "+s+' class="fa-layers fa-fw '+(o==n?"":" gray")+'"><i class="fa-solid fa-desktop"></i><i class="fa-solid fa-square" data-fa-transform="shrink-12 left-3 up-3"></i><i class="fa-solid fa-square" data-fa-transform="shrink-12 right-3 up-3"></i></span>':"<i "+s+' class="fa-fw fa-solid fa-desktop '+(o==n?"":" gray")+'"></i>',deskPreferedStickyDisplay==n&&o!=deskPreferedStickyDisplay&&desktop.m.SetDisplay(n),deskPreferedStickyDisplay=-1}QH("DeskMonitorSelectionSpan",a),QV("DeskMonitorSelectionSpan",1<i)}function deskGetDisplayNumbers(e){desktop.m.GetDisplayNumbers()}Q("DeskTools").addEventListener("mousemove",function(e){e=e.clientX-Q("DeskTools").getBoundingClientRect().left;Q("DeskTools").style.cursor=e<5?"col-resize":"default"}),Q("DeskTools").addEventListener("mousedown",function(e){"col-resize"===Q("DeskTools").style.cursor&&(deskTools.resizing=!0,Q("Desk").removeAttribute("onmouseup"),Q("Desk").removeAttribute("onmousedown"),Q("Desk").removeAttribute("onmousemove"))}),document.addEventListener("mouseup",function(){!0===deskTools.resizing&&"col-resize"===Q("DeskTools").style.cursor&&(deskTools.resizing=!1)}),document.addEventListener("mousemove",function(e){deskTools.resizing&&(e=Q("DeskTools").getBoundingClientRect().right-e.clientX)<Q("DeskParent").clientWidth-10&&(Q("DeskTools").style.width=e+"px")});var deskPreferedStickyDisplay=-1;function deskSetDisplay(e){desktop.m.SetDisplay(deskPreferedStickyDisplay=parseInt(e))}var terminalNode,dblClickDetectArgs={t:0,x:0,y:0};function dblClickDetect(e){var t;1==e.buttons&&((t=Date.now())-dblClickDetectArgs.t<250&&Math.abs(e.clientX-dblClickDetectArgs.x)<2&&Math.abs(e.clientY-dblClickDetectArgs.y)<2&&!xxdialogMode&&null!=desktop&&Q("DeskControl").checked&&(null!=webRtcDesktop&&null!=webRtcDesktop.softdesktop?(webRtcDesktop.softdesktop.m.mousedblclick(e),desktop.m.sendKeepAlive()):desktop.m.mousedblclick(e)),dblClickDetectArgs.t=t,dblClickDetectArgs.x=e.clientX,dblClickDetectArgs.y=e.clientY)}function dmousedown(e){setSessionActivity(),e.addx=Q("DeskParent").scrollLeft,e.addy=Q("DeskParent").scrollTop,!xxdialogMode&&null!=desktop&&Q("DeskControl").checked&&(null!=webRtcDesktop&&null!=webRtcDesktop.softdesktop?(webRtcDesktop.softdesktop.m.mousedown(e),desktop.m.sendKeepAlive()):desktop.m.mousedown(e)),dblClickDetect(e)}function dmouseup(e){setSessionActivity(),e.addx=Q("DeskParent").scrollLeft,e.addy=Q("DeskParent").scrollTop,!xxdialogMode&&null!=desktop&&Q("DeskControl").checked&&(null!=webRtcDesktop&&null!=webRtcDesktop.softdesktop?(webRtcDesktop.softdesktop.m.mouseup(e),desktop.m.sendKeepAlive()):desktop.m.mouseup(e))}function dmousemove(e){setSessionActivity(),e.addx=Q("DeskParent").scrollLeft,e.addy=Q("DeskParent").scrollTop,!xxdialogMode&&null!=desktop&&Q("DeskControl").checked?(Q("Desk").style.cursor="",null!=webRtcDesktop&&null!=webRtcDesktop.softdesktop?(webRtcDesktop.softdesktop.m.mousemove(e),desktop.m.sendKeepAlive()):desktop.m.mousemove(e)):xxdialogMode||null==desktop||Q("DeskControl").checked||(Q("Desk").style.cursor="not-allowed")}function dmousewheel(e){return setSessionActivity(),e.addx=Q("DeskParent").scrollLeft,e.addy=Q("DeskParent").scrollTop,!(xxdialogMode||null==desktop||!Q("DeskControl").checked||(null!=webRtcDesktop&&null!=webRtcDesktop.softdesktop?(webRtcDesktop.softdesktop.m.mousewheel(e),desktop.m.sendKeepAlive()):desktop.m.mousewheel&&desktop.m.mousewheel(e),haltEvent(e),0))}function drotate(e){xxdialogMode||null==desktop||(desktop.m.setRotation(desktop.m.rotation+e),deskAdjust(),deskAdjust())}function stopProcess(e,t){return setModalContent("xxAddAgent","Control de Proceso",format('Detener proceso #{0} "{1}"?',e,t)),showModal("xxAddAgentModal","idx_dlgOkButton",()=>stopProcessEx(3,e)),!1}function stopProcessEx(e,t){meshserver.send({action:"msg",type:"pskill",nodeid:currentNode._id,value:t}),setTimeout(refreshDeskTools,300)}function setupTerminal(){terminalNode!=currentNode&&null!=terminal&&terminalNode._id!=currentNode._id&&(terminal.Stop(),terminal=terminalNode=null),terminalNode=currentNode,updateTerminalButtons()}function updateTerminalButtons(){var e=null!=terminal&&0!=terminal.state,t=(3==terminalNode.mtype&&null!=terminalNode.agent&&4<terminalNode.agent.id&&512&features2&&(terminalNode.agent.caps=6),QV("disconnectbutton2span",1==e),QV("connectbutton2span",0==e&&null!=terminalNode.agent&&2&terminalNode.agent.caps&&3!=terminalNode.mtype),QV("connectbutton2sspan",512&features2&&0==e&&null!=terminalNode.agent&&2&terminalNode.agent.caps&&3!=terminalNode.agent.id&&0==(16777216&features2)),1==terminalNode.mtype?(QV("connectbutton2hspan",0==e&&null!=terminalNode.intelamt&&2==terminalNode.intelamt.state),QV("terminalSizeDropDown",0==e&&null!=terminalNode.intelamt&&2==terminalNode.intelamt.state)):(QV("connectbutton2hspan",0==e&&null!=terminalNode.intelamt&&2==terminalNode.intelamt.state&&null!=terminalNode.intelamt.ver),QV("terminalSizeDropDown",0==e&&null!=terminalNode.intelamt&&2==terminalNode.intelamt.state&&null!=terminalNode.intelamt.ver)),QV("termActionsBtn",3!=terminalNode.mtype),1==e&&3!=terminal.contype||null==terminalNode.agent||3==terminalNode.agent.id||4==terminalNode.agent.id?QH("terminalCustomUpperRight",""):QH("terminalCustomUpperRight","<a style=cursor:pointer onclick=cmsshportaction(1,event)>"+format("Puerto SSH {0}",terminalNode.sshport||22)+"</a>"),0!=(1&terminalNode.conn)||3==terminalNode.mtype),t=(QE("connectbutton2",t),QE("connectbutton2d",t),QE("connectbutton2s",t),QE("connectbutton2sd",t),0!=(6&terminalNode.conn)),t=(QE("connectbutton2h",t),QE("ctrlcbutton",e),QE("ctrlxbutton",e),QE("escbutton",e),QE("bsbutton",e),QE("pastebutton",e),QE("specialkeylist",e),QE("specialkeylistinput",e),QV("terminalSettingsButtons",terminal&&2==terminal.contype),terminal&&(Q("id_ttypebutton").value=terminalEmulations[terminal.m.terminalEmulation],Q("id_tfxkeysbutton").value=fxEmulations[terminal.m.fxEmulation],Q("id_tcrbutton").value="\r\n"==terminal.m.lineFeed?"CR+LF":"LF"),!(0===args.xterm||null!=terminal&&null==xterm));QV("termarea3xdiv",t),QV("Term",!t),QV("bsbutton",!t),QV("pastebutton",!t),QV("devListToolbarViewIcons2",t),QE("termSizeList",null==terminal)}function onTerminalStateChange(e,t){if(terminal==e){var o=t,n=(3==o&&2==e.contype&&o++,StatusStrs[o]);switch(3==o&&(3==e.contype&&(n+=", SSH"),1==e.webRtcActive)&&(n+=", WebRTC"),QH("termstatus",n),t){case 0:if(QH("termtitle",""),QV("termRecordIcon",!1),null==xterm)try{e.m.TermResetScreen(),e.m.TermDraw()}catch(e){}else xterm.dispose(),xterm=xtermfit=null;null!=e&&(e.Stop(),terminal=null);break;case 3:e&&1==e.serverIsRecording&&QV("termRecordIcon",!0),e.startTime=new Date,null==updateSessionTimer&&(updateSessionTimer=setInterval(updateSessionTime,1e3)),null!=xterm&&xterm.focus()}updateTerminalButtons()}}var autoConnectTerminalTimer=null;function autoConnectTerminal(e){autoConnectTerminalTimer=null==autoConnectTerminalTimer?setInterval(connectTerminal,100):(clearInterval(autoConnectTerminalTimer),null)}function CreateRemoteTunnel(e,t){var o={protocol:1};return null!=t&&"number"==typeof t.protocol&&(o.protocol=t.protocol),o.onTunnelUpdate=e,o.xxStateChange=function(e){},o.ProcessBinaryData=function(e){o.onTunnelUpdate(e)},o.ProcessData=function(e){o.onTunnelUpdate(e)},o.terminalEmulation=1,o.fxEmulation=0,o.lineFeed="\r\n",o}function tunnelUpdate(e){null!=xterm&&(xterm.writeUtf8?"string"==typeof e?xterm.writeUtf8(e):xterm.writeUtf8(new Uint8Array(e)):"string"==typeof e?xterm.write(e):xterm.write(new Uint8Array(e)))}function sshTunnelAuthDialog(e,t){function o(e,t){document.getElementById("xxAddAgentModal").removeEventListener("hide.bs.modal",o),connectTerminal()}var n="";e.askkeypass?n+=addHtmlFormFloating("Autenticación",'<select id=dp2authmethod class="form-select" onchange=sshAuthUpdate(event)><option value=3 selected>Clave almacenada</option><option value=1>Usuario Contraseña</option><option value=2>Nombre de usuario y clave</option></select>'):n+=addHtmlFormFloating("Autenticación",'<select id=dp2authmethod class="form-select" onchange=sshAuthUpdate(event)><option value=1 selected>Usuario Contraseña</option><option value=2>Nombre de usuario y clave</option></select>'),n=(n=(n+="<div id=d2userauth style=display:none>")+addHtmlFormFloating("Nombre de Usuario",'<input id=dp2user class="form-control" maxlength=64 autocomplete=off onkeyup=sshAuthUpdate(event) />')+"</div><div id=d2passauth style=display:none>")+addHtmlFormFloating("Contraseña",'<input type=password id=dp2pass class="form-control" maxlength=64 autocomplete=off onkeyup=sshAuthUpdate(event) />'),0==(4194304&features2)&&(n+=addHtmlValue("",'<label><input id=dp2keep type=checkbox class="form-check-input me-2">Recuerda credenciales</label>')),n=(n=(n+="</div><div id=d2keyauth style=display:none>")+addHtmlValue("Archivo de clave",'<input type=file id=dp2key class="form-control" maxlength=64 autocomplete=off onchange=sshAuthUpdate(event) /><div id=d2badkey style=font-size:x-small>El archivo de clave debe estar en formato OpenSSH.</div>'))+addHtmlFormFloating("Contraseña clave",'<input type=password id=dp2keypass class="form-control" maxlength=64 autocomplete=off onkeyup=sshAuthUpdate(event) />'),0==(4194304&features2)&&(n=(n+=addHtmlValue("",'<label><input id=dp2keep1 type=checkbox class="form-check-input me-2" onchange=sshAuthUpdate(event)>Recordar usuario y clave</label>'))+addHtmlValue("",'<label><input id=dp2keep2 type=checkbox class="form-check-input me-2">Recordar contraseña</label>')),n+="</div>",setModalContent("xxAddAgent","Autenticación",n=e.askkeypass?(n+="<div id=d2keyauth2 style=display:none>")+addHtmlFormFloating("Contraseña",'<input type=password id=dp2keypass2 class="form-control" maxlength=64 autocomplete=off onkeyup=sshAuthUpdate(event) />')+"</div>":n);document.getElementById("xxAddAgentModal").addEventListener("hide.bs.modal",o),showModal("xxAddAgentModal","idx_dlgOkButton",()=>{document.getElementById("xxAddAgentModal").removeEventListener("hide.bs.modal",o),t(11,"ssh")}),Q("dp2user").focus(),sshAuthUpdate(),setTimeout(sshAuthUpdate,50)}function sshTunnelUpdate(e){if("string"==typeof e)if("{"==e[0]){var t=JSON.parse(e);switch(t.action){case"sshauth":sshTunnelAuthDialog(t,sshConnectEx);break;case"sshautoauth":terminal.socket.send(JSON.stringify({action:"sshautoauth",cols:xterm.cols,rows:xterm.rows,width:Q("termarea3xdiv").offsetWidth,height:Q("termarea3xdiv").offsetHeight}));break;case"connectionerror":p12setConsoleMsg("Error de Conexión",5e3);break;case"autherror":p12setConsoleMsg("Error de Autenticación",5e3);break;case"sessionerror":p12setConsoleMsg("Sesión expirada",5e3);break;case"sessiontimeout":p12setConsoleMsg("Hora de término de la sesión",5e3)}}else"~"==e[0]&&(xterm.writeUtf8?xterm.writeUtf8(e.substring(1)):xterm.write(e.substring(1)))}function sshAuthUpdate(e){var t;QV("d2userauth",3!=Q("dp2authmethod").value),QV("d2passauth",1==Q("dp2authmethod").value),QV("d2keyauth",2==Q("dp2authmethod").value),QV("d2keyauth2",3==Q("dp2authmethod").value),1==Q("dp2authmethod").value?QE("idx_dlgOkButton",0<Q("dp2user").value.length&&0<Q("dp2pass").value.length):3==Q("dp2authmethod").value?QE("idx_dlgOkButton",0<Q("dp2keypass2").value.length):(QE("idx_dlgOkButton",!1),0==(4194304&features2)&&QE("dp2keep2",Q("dp2keep1").checked),1==(0<Q("dp2user").value.length&&null!=Q("dp2key").files&&1==Q("dp2key").files.length&&Q("dp2key").files[0].size<8e3)&&((t=new FileReader).onload=function(e){e=0<=e.target.result.indexOf("-----BEGIN OPENSSH PRIVATE KEY-----")&&0<=e.target.result.indexOf("-----END OPENSSH PRIVATE KEY-----")||0<=e.target.result.indexOf("-----BEGIN RSA PRIVATE KEY-----")&&0<=e.target.result.indexOf("-----END RSA PRIVATE KEY-----");QE("idx_dlgOkButton",e),QS("d2badkey").color=e?"#000":"#F00"},t.readAsText(Q("dp2key").files[0]))),e&&13==e.keyCode&&e.target&&1==Q("dp2authmethod").value&&("dp2user"==e.target.id&&Q("dp2pass").focus(),"dp2pass"==e.target.id)&&dialogclose(1)}function sshConnectEx(e){var t,o,n;0==e?null!=terminal&&connectTerminal():(t=0,1==Q("dp2authmethod").value?(0==(4194304&features2)&&(t=Q("dp2keep").checked?1:0),terminal.socket.send(JSON.stringify({action:"sshauth",username:Q("dp2user").value,password:Q("dp2pass").value,keep:t,cols:xterm.cols,rows:xterm.rows,width:Q("termarea3xdiv").offsetWidth,height:Q("termarea3xdiv").offsetHeight}))):3==Q("dp2authmethod").value?terminal.socket.send(JSON.stringify({action:"sshkeyauth",keypass:Q("dp2keypass2").value,cols:xterm.cols,rows:xterm.rows,width:Q("termarea3xdiv").offsetWidth,height:Q("termarea3xdiv").offsetHeight})):(0==(4194304&features2)&&1==(t=Q("dp2keep1").checked?1:0)&&(t+=Q("dp2keep2").checked?1:0),e=new FileReader,o=Q("dp2user").value,n=Q("dp2keypass").value,e.onload=function(e){terminal.socket.send(JSON.stringify({action:"sshauth",username:o,keypass:n,key:e.target.result,keep:t,cols:xterm.cols,rows:xterm.rows,width:Q("termarea3xdiv").offsetWidth,height:Q("termarea3xdiv").offsetHeight}))},e.readAsText(Q("dp2key").files[0])))}function xTermSendResize(){(xtermResizeTimer=null)!=xterm&&null!=terminal&&null!=terminal.sendCtrlMsg&&("sshterminalrelay.ashx"==terminal.urlname?terminal.socket.send(JSON.stringify({action:"resize",cols:xterm.cols,rows:xterm.rows,width:Q("termarea3xdiv").offsetWidth,height:Q("termarea3xdiv").offsetHeight})):terminal.sendCtrlMsg(JSON.stringify({ctrlChannel:"102938",type:"termsize",cols:xterm.cols,rows:xterm.rows})))}function connectTerminal(e,t,o){if(p12clearConsoleMsg(),terminal)"ssh"==xxdialogTag&&setDialogMode(0),terminal.Stop(),terminal=null,fullscreen&&deskToggleFull();else if(2==t){if(null==terminalNode.intelamt.user||""==terminalNode.intelamt.user)return void editDeviceAmtSettings(terminalNode._id,connectTerminal,2);var n={};1==Q("termSizeList").value?(n.cols=80,n.rows=25):2==Q("termSizeList").value&&(n.cols=100,n.rows=30),fullscreen&&deskToggleFull(),QV("termarea3xdiv",!1),QV("Term",!0),(terminal=CreateAmtRedirect(CreateAmtRemoteTerminal("Term",n),authCookie)).debugmode=debugmode,terminal.m.debugmode=debugmode,terminal.m.onTitleChange=function(e,t){QH("termtitle"," - "+EscapeHtml(t))},terminal.onStateChanged=onTerminalStateChange,terminal.Start(terminalNode._id,16994,"*","*",0),terminal.contype=2,Q("id_ttypebutton").value=terminalEmulations[terminal.m.terminalEmulation]}else{n={protocol:null!=o&&"number"==typeof o.protocol?o.protocol:1};o&&o.requireLogin&&(n.requireLogin=!0),o&&o.consent&&(n.consent=o.consent),-1==[1,2,3,4,21,22].indexOf(currentNode.agent.id)&&(1==Q("termSizeList").value?(n.cols=80,n.rows=25,n.xterm=!0):2==Q("termSizeList").value?(n.cols=100,n.rows=30,n.xterm=!0):3==Q("termSizeList").value&&(n.cols=Math.floor((Q("column_l").clientWidth-60)/10),n.rows=Math.floor((Q("column_l").clientHeight-120)/20),n.xterm=!0)),e&&1==e.shiftKey&&(4<currentNode.agent.id?1==n.protocol&&(n.protocol=7):1==n.protocol&&(n.protocol=6)),null!=serverinfo.linuxshell&&4<currentNode.agent.id&&("root"==serverinfo.linuxshell&&(n.protocol=1,delete n.requireLogin),"user"==serverinfo.linuxshell&&(n.protocol=8,delete n.requireLogin),"login"==serverinfo.linuxshell)&&(n.protocol=1,n.requireLogin=!0),0!==args.xterm?(QV("termarea3xdiv",!0),QV("Term",!1),null!=xterm&&xterm.dispose(),xtermfit=new FitAddon.FitAddon,xterm=new Terminal,xtermfit&&xterm.loadAddon(xtermfit),xterm.open(Q("termarea3xdiv")),xterm.onData(function(e){null!=terminal&&("sshterminalrelay.ashx"==terminal.urlname?terminal.socket.send("~"+e):terminal.sendText(e))}),xtermfit&&xtermfit.fit(),xterm.onTitleChange(function(e){QH("termtitle"," - "+EscapeHtml(e))}),xterm.onResize(function(e){xtermResizeTimer&&clearTimeout(xtermResizeTimer),xtermResizeTimer=setTimeout(xTermSendResize,200)}),n.cols=xterm.cols,n.rows=xterm.rows,terminal=CreateAgentRedirect(meshserver,CreateRemoteTunnel(3==t?sshTunnelUpdate:tunnelUpdate,n),serverPublicNamePort,authCookie,authRelayCookie,domainUrl),3==t&&(terminal.urlname="sshterminalrelay.ashx"),terminal.debugmode=debugmode,terminal.m.debugmode=debugmode,(terminal.options=n).requireLogin&&(terminal.options.requireLogin=!0),terminal.Start(terminalNode._id),terminal.onStateChanged=onTerminalStateChange,terminal.contype=t,terminal.attemptWebRTC=!1,terminal.onConsoleMessageChange=function(){p12setConsoleMsg(terminal.consoleMessage?formatAgentConsoleMessage(terminal.consoleMessage,terminal.consoleMessageId,terminal.consoleMessageArgs):null,terminal.consoleMessageTimeout)}):(QV("termarea3xdiv",!1),QV("Term",!0),(terminal=CreateAgentRedirect(meshserver,CreateAmtRemoteTerminal("Term",n),serverPublicNamePort,authCookie,authRelayCookie,domainUrl)).options=n,terminal.debugmode=debugmode,terminal.m.debugmode=debugmode,terminal.m.onTitleChange=function(e,t){QH("termtitle"," - "+EscapeHtml(t))},terminal.m.lineFeed=0<=[1,2,3,4,21,22].indexOf(currentNode.agent.id)?"\r\n":"\r",terminal.attemptWebRTC=!1,terminal.onStateChanged=onTerminalStateChange,terminal.onConsoleMessageChange=function(){p12setConsoleMsg(terminal.consoleMessage?formatAgentConsoleMessage(terminal.consoleMessage,terminal.consoleMessageId,terminal.consoleMessageArgs):null,terminal.consoleMessageTimeout)},terminal.Start(terminalNode._id),terminal.contype=t,terminal.m.terminalEmulation=0,terminal.m.fxEmulation=0,Q("id_ttypebutton").value=terminalEmulations[0])}Q("connectbutton2").blur()}var terminalEmulations=["Terminal UTF8","ASCII extendido","Intel ASCII"];function termToggleType(){terminal&&!xxdialogMode&&(terminal.m.terminalEmulation=(terminal.m.terminalEmulation+1)%3,Q("id_ttypebutton").value=terminalEmulations[terminal.m.terminalEmulation],Q("id_ttypebutton").blur())}var filesNode,fxEmulations=["Intel (F10 = ESC+[OM)","Alternar (F10 = ESC+0)","VT100+ (F10 = ESC+[OY)"];function termToggleFx(){terminal&&!xxdialogMode&&(terminal.m.fxEmulation=(terminal.m.fxEmulation+1)%3,Q("id_tfxkeysbutton").value=fxEmulations[terminal.m.fxEmulation],Q("id_tfxkeysbutton").blur())}function termToggleCr(){terminal&&!xxdialogMode&&("\n"==terminal.m.lineFeed?terminal.m.lineFeed="\r\n":terminal.m.lineFeed="\n",Q("id_tcrbutton").value="\r\n"==terminal.m.lineFeed?"CR+LF":"LF")}function termSendKey(e,t){terminal&&!xxdialogMode&&(null!=xterm?("sshterminalrelay.ashx"==terminal.urlname?terminal.socket.send("~"+String.fromCharCode(e)):terminal.sendText?terminal.sendText(String.fromCharCode(e)):terminal.send(String.fromCharCode(e)),xterm.focus()):null!=terminal&&(terminal.m.TermSendKey(e),Q(t).blur()))}function showTermPasteDialog(){terminal&&!xxdialogMode&&(Q("pastebutton").blur(),setModalContent("xxAddAgent","Pegar",'<textarea id=d2pasteText style="width:100%;height:184px;resize:none"></textarea>'),showModal("xxAddAgentModal","idx_dlgOkButton",()=>showTermPasteDialogEx()),Q("d2pasteText").focus())}function showTermPasteDialogEx(){terminal&&terminal.m.TermSendKeys(Q("d2pasteText").value)}function sendSpecialKey(){null!=xterm?("sshterminalrelay.ashx"==terminal.urlname?terminal.socket.send("~"+String.fromCharCode(Q("specialkeylist").value)):terminal.sendText(String.fromCharCode(Q("specialkeylist").value)),xterm.focus()):null!=terminal&&(terminal.m.TermSendKey(Q("specialkeylist").value),Q("specialkeylist").blur(),Q("specialkeylistinput").blur())}function setupFiles(){filesNode!=currentNode&&null!=files&&filesNode._id!=currentNode._id&&(files.Stop(),files=filesNode=null);var e=0!=(1&(filesNode=currentNode).conn)||3==filesNode.mtype;QE("p13Connect",e),QE("p13Connectdrop",e),QE("p13Connects",e),QE("p13Connectsdrop",e),QV("p13Connectspan",null==files&&2==filesNode.mtype),QV("p13Connectsspan",0!=(512&features2)&&null!=filesNode.agent&&3!=filesNode.agent.id&&4!=filesNode.agent.id&&0==(8388608&features2)),QV("p13Disconnect",null!=files),p13setActions()}function onFilesStateChange(e,t){setSessionActivity(),QV("p13Connectspan",0==t&&2==filesNode.mtype),QV("p13Connectsspan",0==t&&512&features2&&null!=filesNode.agent&&3!=filesNode.agent.id&&4!=filesNode.agent.id&&0==(8388608&features2)),QV("p13Disconnect",0!=t);var o=StatusStrs[t];switch(3==t&&(2==files.contype&&(o+=", SFTP"),1==files.webRtcActive)&&(o+=", WebRTC"),Q("p13Status").textContent=o,t){case 0:QH("p13files",""),p13filetree=null,p13filetreelocation=[],QH("p13currentpath",""),QE("p13FolderUp",!1),QV("filesRecordIcon",!1),p13setActions(),null!=files&&(files.Stop(),files=null),"fileMsgDialog"==xxdialogTag&&setDialogMode(0),null!=uploadFile&&(p13uploadFileTransferDone(),uploadFile=null);break;case 3:if(p13filetreelocation=[],p13targetpath="",files){var n=[];try{n=JSON.parse(getstore("_devFilePaths","[]"))}catch(e){}for(var i=0;i<n.length;i++)n[i].n==currentNode._id&&(p13targetpath=n[i].p);p13filetreelocation=p13targetpath.split("/"),files.sendText({action:"ls",reqid:1,path:p13targetpath}),1==files.serverIsRecording&&QV("filesRecordIcon",!0)}}}function CreateRemoteFiles(e){var t={protocol:5};return t.onFileUpdate=e,t.xxStateChange=function(e){},t.ProcessData=function(e){t.onFileUpdate(e)},t}var autoConnectFilesTimer=null;function autoConnectFiles(e){autoConnectFilesTimer=null==autoConnectFilesTimer?setInterval(connectFiles,100):(clearInterval(autoConnectFilesTimer),null)}function connectFiles(e,t,o){p13clearConsoleMsg(),files?(files.Stop(),files=null):(files=CreateAgentRedirect(meshserver,CreateRemoteFiles(p13gotFiles),serverPublicNamePort,authCookie,authRelayCookie,domainUrl),2==t&&(files.urlname="sshfilesrelay.ashx"),files.contype=t,files.options={consent:o},files.attemptWebRTC=attemptWebRTC,files.webrtcconfig=webrtcconfiguration,files.onStateChanged=onFilesStateChange,files.onConsoleMessageChange=function(){files.consoleMessage?(Q("p13FilesConsoleMsg").innerHTML+=formatAgentConsoleMessage(files.consoleMessage,files.consoleMessageId,files.consoleMessageArgs),QV("p13FilesConsoleMsg",!0),null!=p13FilesConsoleMsgTimer&&clearTimeout(p13FilesConsoleMsgTimer),files.consoleMessageTimeout&&(p13FilesConsoleMsgTimer=setTimeout(p13clearConsoleMsg,1e3*files.consoleMessageTimeout))):p13clearConsoleMsg()},files.Start(filesNode._id)),p13clipboard=p13clipboardFolder=null,p13clipboardCut=0,p13updateClipview()}var p13sortorder,p13filetree=null,p13targetpath=null,p13filetreelocation=[];function p13fileOperationDialogEx(e){0==e&&null!=files&&files.sendText({action:"cancel"})}function p13gotFiles(t){if(0<t.length&&123!=t.charCodeAt(0))p13gotDownloadBinaryData(t);else{try{t=JSON.parse(decode_utf8(t))}catch(e){try{t=JSON.parse(t)}catch(e){return void console.log("Unable to parse: "+t)}}if("download"==t.action)p13gotDownloadCommand(t);else if("findfile"==t.action)xxdialogTag==t.reqid&&(null==t.r?(QE("d2findFilter",!0),QE("filefind_dlgOkButton",!0),xxdialogTag=null,""==Q("d2findResults").innerHTML&&QH("d2findResults","<div style=text-align:center;margin:10px><i>No se encontraron archivos</i></div>")):QA("d2findResults","<div style=white-space:nowrap>"+EscapeHtml(t.r)+"</div>"));else if(null!=t.action&&t.action.startsWith("upload"))p13gotUploadData(t);else{switch(t.action){case"sshauth":return void sshTunnelAuthDialog(t,p13sshConnectEx);case"autherror":return void p13setConsoleMsg("Error de Autenticación",5e3);case"connectionerror":return void p13setConsoleMsg("Error de Conexión",5e3);case"sessionerror":return void p13setConsoleMsg("Sesión expirada",5e3);case"sessiontimeout":return void p13setConsoleMsg("Hora de término de la sesión",5e3)}if("dialogmessage"==t.action)null==t.msg&&"fileMsgDialog"==xxdialogTag?setDialogMode(0):"zipping"!=t.msg||xxdialogMode&&"fileMsgDialog"!=xxdialogTag?"unzipping"!=t.msg||xxdialogMode&&"fileMsgDialog"!=xxdialogTag?"unziperror"!=t.msg||xxdialogMode&&"fileMsgDialog"!=xxdialogTag?"zippingFile"!=t.msg||xxdialogMode&&"fileMsgDialog"!=xxdialogTag||(setModalContent("xxAddAgent","Operación de Archivo","<div style=margin:10px>"+EscapeHtml(t.file)+"</div><br /><progress value="+EscapeHtml(t.progress)+" style=width:100% max=100 />"),showModal("xxAddAgentModal","idx_dlgOkButton",()=>p13fileOperationDialogEx(10))):(setModalContent("xxAddAgent","Operación de Archivo","<div style=margin:10px>Unzipping Error</div><br />"+EscapeHtml(t.error)),showModal("xxAddAgentModal","idx_dlgOkButton")):(setModalContent("xxAddAgent","Operación de Archivo","<div style=margin:10px>Unzipping file...</div>"),showModal("xxAddAgentModal","idx_dlgOkButton")):(setModalContent("xxAddAgent","Operación de Archivo","<div style=margin:10px>Comprimiendo archivos...</div>"),showModal("xxAddAgentModal","idx_dlgOkButton",()=>p13fileOperationDialogEx(10)));else if("refresh"==t.action)p13folderup(9999);else if(null!=t.path)if(null==t.dir)""!=p13targetpath&&p13folderup();else if(t.path=t.path.replace(/\//g,"\\"),null!=p13filetree&&t.path==p13filetree.path){var e=p13getCheckedNames();p13filetree=t,p13updateFiles(e)}else{for(var o=t.path.replace(/\//g,"\\"),n=p13targetpath.replace(/\//g,"\\");0<o.length&&"\\"==o[0];)o=o.substring(1);for(;0<n.length&&"\\"==n[0];)n=n.substring(1);(o==n||"\\"==t.path&&""==p13targetpath)&&(p13filetree=t,p13updateFiles())}}}}function p13sshConnectEx(e){var t,o,n;0==e?null!=files&&connectFiles():(t=0,1==Q("dp2authmethod").value?(0==(4194304&features2)&&(t=Q("dp2keep").checked?1:0),files.socket.send(JSON.stringify({action:"sshauth",username:Q("dp2user").value,password:Q("dp2pass").value,keep:t}))):3==Q("dp2authmethod").value?files.socket.send(JSON.stringify({action:"sshkeyauth",keypass:Q("dp2keypass2").value})):(0==(4194304&features2)&&1==(t=Q("dp2keep1").checked?1:0)&&(t+=Q("dp2keep2").checked?1:0),e=new FileReader,o=Q("dp2user").value,n=Q("dp2keypass").value,e.onload=function(e){files.socket.send(JSON.stringify({action:"sshauth",username:o,keypass:n,key:e.target.result,keep:t}))},e.readAsText(Q("dp2key").files[0])))}function p13getCheckedNames(){for(var e=[],t=document.getElementsByName("fd"),o=0;o<t.length;o++)t[o].checked&&e.push(p13filetree.dir[t[o].value].n);return e}function p13updateFiles(e){var t="",o="",n='<a href=# style=cursor:pointer onclick="return p13folderup(0)">Raíz</a>';if(null!=p13filetree){var i=p13filetree.path.split("\\");for(v in p13filetreelocation=[],i)""!=i[v]&&p13filetreelocation.push(i[v]);for(v in p13filetreelocation)n+=' / <a href=# style=cursor:pointer onclick="return p13folderup('+(parseInt(v)+1)+')">'+EscapeHtml(p13filetreelocation[v])+"</a>";var a=p13filetreelocation.join("/"),s=p13sort_files(p13filetree.dir);for(v in s){var r=s[v],l=r.n,d=70<l.length?'<span title="'+EscapeHtml(l)+'">'+EscapeHtml(l.substring(0,70))+"...</span>":EscapeHtml(l),c="",u=(null!=r.d&&(u=new Date(r.d),c=printDateTime(u="number"==typeof r.d?new Date(1e3*r.d):u)+"&nbsp;"),"");if(null!=r.s){var p=["Bytes","KB","MB","GB","TB"];let e=parseInt(Math.floor(Math.log(Math.abs(r.s))/Math.log(1024)),10);var m=Q("p13sizedropdown").options[Q("p13sizedropdown").selectedIndex],u=0==Q("p13sizedropdown").value?0===r.s?"n/a":0===e?r.s+" "+p[e]:(r.s/1024**e).toFixed(2)+" "+p[e]:1==Q("p13sizedropdown").value?getFileSizeStr(r.s):(r.s/2**m.value).toFixed(2)+" "+m.title}p="";r.t<3?(p="<div class=filelist file=999>",p=(p+='<input file=999 style=float:left name=fd class=fcb type=checkbox class="form-check-input me-2" onchange=p13setActions() value=\''+r.nx+'\'>&nbsp;<span style=float:right title=""></span>')+"<span><div class=fileIcon"+("REMOVABLE"==r.dt?5:"CDROM"==r.dt?6:r.t)+' onclick=p13folderset("'+encodeURIComponentEx(r.nx)+'")></div><a href=# style=cursor:pointer onclick=\'return p13folderset("'+encodeURIComponentEx(r.nx)+"\")'>",isWindowsNode(currentNode)&&r.dt&&currentNode.volumes&&currentNode.volumes[d.charAt(0).toUpperCase()]&&currentNode.volumes[d.charAt(0).toUpperCase()].name?p+=currentNode.volumes[d.charAt(0).toUpperCase()].name+" ("+d+")":p+=d,p+="</a></span></div>"):(m=d,0<r.s&&(m=3==filesNode.mtype?"<a href=# style=cursor:pointer onclick=\"return p13downloadfile('"+encodeURIComponentEx(a+"/"+l)+"','"+encodeURIComponentEx(l)+"',"+r.s+')">'+d+"</a>":'<a onclick=downloadFile("devicefile.ashx?c='+authCookie+"&m="+currentNode.meshid.split("/")[2]+"&n="+currentNode._id.split("/")[2]+"&f="+encodeURIComponentEx(a+"/"+l)+'","'+encodeURIComponentEx(l)+'") style=cursor:pointer>'+d+"</a>"),p="<div id=fileEntry cmenu=filesContextMenu fileIndex="+v+' class=filelist file=3><input file=3 style=float:left name=fd class=fcb type=checkbox class="form-check-input me-2" onchange=p13setActions() value=\''+r.nx+"'>&nbsp;<span class=fsize>"+c+"</span><span style=float:right>"+EscapeHtml(u)+"</span><span><div class=fileIcon"+r.t+"></div>"+m+"</span></div>"),r.t<3?t+=p:o+=p}if(QH("p13files",t+o),QH("p13currentpath",n),QE("p13FolderUp",0!=p13filetreelocation.length),null!=e)for(var g=document.getElementsByName("fd"),v=0;v<g.length;v++)0<=e.indexOf(p13filetree.dir[g[v].value].n)&&(g[v].checked=!0);p13setActions()}}function p13openfilefolder(){setModalContent("xxAddAgent","Open File/Folder","Are you sure you want to open this file/folder on the remote devices desktop ?"),showModal("xxAddAgentModal","idx_dlgOkButton",()=>p13openfilefolderEx())}function p13openfilefolderEx(){for(var e="",t=document.getElementsByName("fd"),o=0;o<t.length;o++)t[o].checked&&(e=(isWindowsNode(currentNode)?"":"/")+p13filetreelocation.join(isWindowsNode(currentNode)?"\\":"/")+(isWindowsNode(currentNode)?"\\":"/")+p13filetree.dir[t[o].value].n);""!=e&&files.sendText({action:"open",reqid:1,path:e,dir:1==p13getFileSelDirCount()})}function p13gotofolder(){xxdialogButtons=3,setModalContent("xxAddAgent","Go To Folder",'<input type=text id=p13folderinput style=width:100% placeholder="'+(isWindowsNode(currentNode)?"C:\\":"/var/www")+'" />'),showModal("xxAddAgentModal","idx_dlgOkButton",p13gotofolderEx),focusTextBox("p13folderinput")}function p13gotofolderEx(){p13targetpath=Q("p13folderinput").value.split("\\").join("/"),files&&(p13storeCurrentPath(p13targetpath),files.sendText({action:"ls",reqid:1,path:p13targetpath}))}function p13folderset(e){p13targetpath=joinPaths(p13filetree.path,p13filetree.dir[e].n).split("\\").join("/"),files&&(p13storeCurrentPath(p13targetpath),files.sendText({action:"ls",reqid:1,path:p13targetpath}))}function p13folderup(e){if(null==e)p13filetreelocation.pop();else for(;p13filetreelocation.length>e;)p13filetreelocation.pop();return p13targetpath=p13filetreelocation.join("/"),files&&(p13storeCurrentPath(p13targetpath),files.sendText({action:"ls",reqid:1,path:p13targetpath})),!1}function p13storeCurrentPath(e){var t=[],o=-1;try{t=JSON.parse(getstore("_devFilePaths","[]"))}catch(e){}for(var n=0;n<t.length;n++)t[n].n==currentNode._id&&(o=n);for(0<=o&&t.splice(o,1),t.push({n:currentNode._id,p:e});40<t.length;)t.shift();putstore("_devFilePaths",JSON.stringify(t))}function p13findfile(){var e;xxdialogMode||(e=addHtmlFormFloating("Filtrar",'<input id=d2findFilter class="form-control" onkeyup=p13findfileValidate() onkeydown=p13findfileDown(event) placeholder="*.txt"></input>'),setModalContent("xxAddAgent","Buscar Archivos",e=(e+='<div id=d2findResults style="width:100%;height:184px;background-color:white;border:1px solid black;padding:3px;overflow:scroll;margin-top:8px"></div>')+"<div style=margin-top:8px><input id=filefind_dlgCancelButton type=button value=Cerrar style=float:right;width:80px;margin-left:5px onclick=p13findfileCancel()>"+"<input id=filefind_dlgOkButton type=submit value=Buscar style=float:right;width:80px onclick=p13findfileEx()><br /><br /></div>"),showModal("xxAddAgentModal","idx_dlgOkButton"),p13findfileValidate(),Q("d2findFilter").focus())}function p13findfileDown(e){"Enter"==e.code&&p13findfileEx()}function p13findfileValidate(){QE("filefind_dlgOkButton",0<Q("d2findFilter").value.length)}function p13findfileCancel(){null!=xxdialogTag&&files.sendText({action:"cancelfindfile",reqid:xxdialogTag}),dialogclose(0)}function p13findfileEx(e,t){var o,n,i;0!=Q("d2findFilter").value.length&&(o=0<currentNode.agent.id&&currentNode.agent.id<5||14==currentNode.agent.id||34==currentNode.agent.id,i=p13filetreelocation.join(n=o?"\\":"/")+n,o||(i=n+i),xxdialogTag="find:"+Math.random(),files.sendText({action:"findfile",reqid:xxdialogTag,path:i,filter:Q("d2findFilter").value}),QH("d2findResults",""),QE("d2findFilter",!1),QE("filefind_dlgOkButton",!1))}function p13sort_filename(e,t){return e.ln>t.ln?+p13sortorder:e.ln<t.ln?-1*p13sortorder:0}function p13sort_timestamp(e,t){return e.d>t.d?+p13sortorder:e.d<t.d?-1*p13sortorder:0}function p13sort_bysize(e,t){return e.s==t.s?p13sort_filename(e,t):(e.s-t.s)*p13sortorder}function p13sort_files(e){var t,o=[],n=Q("p13sortdropdown").value;for(t in e)e[t].nx=t,null==e[t].s&&(e[t].s=0),null==e[t].n&&(e[t].n=t),e[t].ln=e[t].n.toLowerCase(),o.push(e[t]);return p13sortorder=1,3<n&&(p13sortorder=-1,n-=3),1==n?o.sort(p13sort_filename):2==n?o.sort(p13sort_bysize):3==n&&o.sort(p13sort_timestamp),o}function p13setActions(){var e,t,o,n,i=null!=currentNode.agent&&14!=currentNode.agent.id;null==p13filetree?(QE("p13DeleteFileButton",!1),QE("p13NewFolderButton",!1),QE("p13UploadButton",!1),QE("p13RenameFileButton",!1),QE("p13ViewFileButton",!1),QE("p13SelectAllButton",!1),Q("p13SelectAllButton").value="Seleccionar Todo",QE("p13RefreshButton",!1),QE("p13FindButton",!1),QE("p13CutButton",!1),QE("p13CopyButton",!1),QE("p13ZipButton",!1),QE("p13UnZipButton",!1),QE("p13PasteButton",!1),QE("p13GoToFolderButton",!1),QE("p13DownloadButton",!1),QE("p13OpenButton",!1)):(e=p13getFileSelCount(),t=p13getFileCount(),o=p13getFileSelCount(!1),n=0<currentNode.agent.id&&currentNode.agent.id<5||14==currentNode.agent.id||34==currentNode.agent.id,QE("p13DeleteFileButton",0<e&&(0<p13filetreelocation.length||0==n)),QE("p13NewFolderButton",i&&(0<p13filetreelocation.length||0==n)),QE("p13UploadButton",0<p13filetreelocation.length||0==n||14==currentNode.agent.id),QE("p13RenameFileButton",i&&1==e&&(0<p13filetreelocation.length||0==n)),QE("p13ViewFileButton",i&&1==e&&1==o&&(0<p13filetreelocation.length||0==n)),QE("p13SelectAllButton",0<t),Q("p13SelectAllButton").value=0<e?"No seleccionar nada":"Seleccionar Todo",QE("p13RefreshButton",!0),QE("p13FindButton",i&&(0<p13filetreelocation.length||0==n)),QE("p13CutButton",i&&0<e&&e==o&&(0<p13filetreelocation.length||0==n)),QE("p13CopyButton",i&&0<e&&e==o&&(0<p13filetreelocation.length||0==n)),QE("p13ZipButton",i&&0<e&&(0<p13filetreelocation.length||0==n)),QE("p13UnzipButton",i&&1==e&&1==o&&(0<p13filetreelocation.length||0==n)&&p13getFileSelAllowedExt(".zip")),QE("p13PasteButton",i&&(0<p13filetreelocation.length||0==n)&&null!=p13clipboard&&0<p13clipboard.length),QE("p13GoToFolderButton",i),QE("p13OpenButton",i&&1==e),QE("p13DownloadButton",0<e&&e==o&&(0<p13filetreelocation.length||0==n))),1==(null!=files&&0!=files.state)&&2!=files.contype||null==filesNode.agent||3==filesNode.agent.id||4==filesNode.agent.id?QH("filesCustomUpperRight",""):QH("filesCustomUpperRight","<a style=cursor:pointer onclick=cmsshportaction(1,event)>"+format("Puerto SSH {0}",filesNode.sshport||22)+"</a>"),QV("filesActionsBtn",3!=filesNode.mtype),QV("p13FindButton",3!=filesNode.mtype),QV("p13CutButton",3!=filesNode.mtype),QV("p13CopyButton",3!=filesNode.mtype),QV("p13ZipButton",3!=filesNode.mtype),QV("p13UnzipButton",3!=filesNode.mtype),QV("p13PasteButton",3!=filesNode.mtype)}function p13getFileSelCount(e){for(var t=0,o=document.getElementsByName("fd"),n=0;n<o.length;n++)!o[n].checked||0==e&&"3"!=o[n].attributes.file.value||t++;return t}function p13getFileSelDirCount(){for(var e=0,t=document.getElementsByName("fd"),o=0;o<t.length;o++)t[o].checked&&"999"==t[o].attributes.file.value&&e++;return e}function p13getFileCount(){return document.getElementsByName("fd").length}function p13getFileSelAllowedExt(e){for(var t=document.getElementsByName("fd"),o=0;o<t.length;o++)if(t[o].checked&&!p13filetree.dir[t[o].value].n.endsWith(e))return!1;return!0}function p13selectallfile(){for(var e=0==p13getFileSelCount(),t=document.getElementsByName("fd"),o=0;o<t.length;o++)t[o].checked=e;p13setActions()}function p13createfolder(){setModalContent("xxAddAgent","Nueva Carpeta","<input type=text id=p13renameinput maxlength=64 onkeyup=p13fileNameCheck(event) style=width:100% />"),showModal("xxAddAgentModal","idx_dlgOkButton",()=>p13createfolderEx()),focusTextBox("p13renameinput"),p13fileNameCheck()}function p13createfolderEx(){files.sendText({action:"mkdir",reqid:1,path:p13filetreelocation.join("/")+"/"+Q("p13renameinput").value}),p13folderup(999)}function p13deletefile(){var e=p13getFileSelCount(),t=0<p13getFileSelDirCount()?'<br /><br /><label><input type=checkbox class="form-check-input me-2" id=p13recdeleteinput>Eliminado recursivo</label><br>':"<input type=checkbox class=\"form-check-input me-2\" id=p13recdeleteinput style='display:none'>";setModalContent("xxAddAgent","Eliminar",1<e?format("¿Eliminar {0} elementos seleccionados?",e)+t:"¿Eliminar elemento seleccionado?"+t),showModal("xxAddAgentModal","idx_dlgOkButton",()=>p13deletefileEx())}function p13deletefileEx(){for(var e=[],t=document.getElementsByName("fd"),o=0;o<t.length;o++)t[o].checked&&e.push(p13filetree.dir[t[o].value].n);files.sendText({action:"rm",reqid:1,path:p13filetreelocation.join("/"),delfiles:e,rec:Q("p13recdeleteinput").checked}),p13folderup(999)}function p13renamefile(){for(var e,t=document.getElementsByName("fd"),o=0;o<t.length;o++)t[o].checked&&(e=p13filetree.dir[t[o].value].n);setModalContent("xxAddAgent","Renombrar",'<input type=text id=p13renameinput maxlength=64 onkeyup=p13fileNameCheck(event) style=width:100% value="'+e+'" />'),showModal("xxAddAgentModal","idx_dlgOkButton",()=>p13renamefileEx(3,{oldname:e})),focusTextBox("p13renameinput"),p13fileNameCheck()}function p13renamefileEx(e,t){t.newname=Q("p13renameinput").value,files.sendText(t),p13folderup(999)}function p13fileNameCheck(e){var t=isFilenameValid(Q("p13renameinput").value);QE("idx_dlgOkButton",t),1==t&&null!=e&&13==e.keyCode&&dialogclose(1)}function p13uploadFile(){setModalContent("xxAddAgent","Cargar Archivo",'<input type=file name=files id=p13uploadinput class="form-control" multiple=multiple onchange="updateUploadDialogOk(\'p13uploadinput\')" />'),showModal("xxAddAgentModal","idx_dlgOkButton",()=>p13uploadFileEx()),updateUploadDialogOk("p13uploadinput")}function updateUploadDialogOk(e){QE("idx_dlgOkButton",0<Q("p13uploadinput").files.length)}function p13uploadFileEx(){return p13doUploadFiles(Q("p13uploadinput").files),!1}function p13viewfile(){for(var e=document.getElementsByName("fd"),t=0;t<e.length;t++)if(e[t].checked){p13filetree.dir[e[t].value].s<=204800?p13downloadfile(encodeURIComponentEx(p13filetreelocation.join("/")+"/"+p13filetree.dir[e[t].value].n),encodeURIComponentEx(p13filetree.dir[e[t].value].n),p13filetree.dir[e[t].value].s,"viewer"):messagebox("Editor de Archivos","Solo se pueden editar archivos de menos de 200k.");break}}function p13unzipFile(){for(var e,t,o,n=document.getElementsByName("fd"),i=0;i<n.length;i++)n[i].checked&&(e=isWindowsNode(currentNode)?"\\":"/",t=(isWindowsNode(currentNode)?"":"/")+p13filetreelocation.join(e)+e+p13filetree.dir[n[i].value].n.split(".zip")[0]+e,o=(isWindowsNode(currentNode)?"":"/")+p13filetreelocation.join(e)+e+p13filetree.dir[n[i].value].n);setModalContent("xxAddAgent","Unzip To Folder",'<input type=text id=p13unzipfolderinput maxlength=64 style=width:100% value="'+t+'" />'),showModal("xxAddAgentModal","idx_dlgOkButton",p13unzipFileEx(3,{action:"unzip",input:o})),focusTextBox("p13unzipfolderinput")}function p13unzipFileEx(e,t){t.dest=Q("p13unzipfolderinput").value,files.sendText(t)}function p13zipFiles(){for(var e=[],t=document.getElementsByName("fd"),o=0;o<t.length;o++)t[o].checked&&e.push(p13filetree.dir[t[o].value].n);setModalContent("xxAddAgent","Nombre de Archivo ZIP",'<input type=text id=p13renameinput maxlength=64 onkeyup=p13fileNameCheck(event) style=width:100% value="" />'),showModal("xxAddAgentModal","idx_dlgOkButton",()=>p13zipFilesEx(3,{action:"zip",path:p13filetreelocation.join("/"),files:e})),focusTextBox("p13renameinput"),p13fileNameCheck()}function p13zipFilesEx(e,t){t.output=Q("p13renameinput").value,t.output.toLowerCase().endsWith(".zip")||(t.output+=".zip"),files.sendText(t)}var p13clipboard=null,p13clipboardFolder=null,p13clipboardCut=0;function p13copyFile(e){var t=document.getElementsByName("fd");p13clipboard=[],p13clipboardCut=e,p13clipboardFolder=p13targetpath;for(var o=0;o<t.length;o++)t[o].checked&&"3"==t[o].attributes.file.value&&p13clipboard.push(p13filetree.dir[t[o].value].n);p13updateClipview()}function p13pasteFile(){var e="";setModalContent("xxAddAgent","Pegar",e=null!=p13clipboard&&0<p13clipboard.length?0==p13clipboardCut?1<p13clipboard.length?format("¿Confirmar la copia de {1} entradas a esta ubicación?",p13clipboard.length):format("¿Confirmar la copia de 1 entrada a esta ubicación?"):1<p13clipboard.length?format("¿Confirmar el movimiento de {1} entradas a esta ubicación?",p13clipboard.length):format("¿Confirmar el movimiento de 1 entrada a esta ubicación?"):e),showModal("xxAddAgentModal","idx_dlgOkButton",()=>p13pasteFileEx())}function p13pasteFileEx(){files.sendText({action:0==p13clipboardCut?"copy":"move",reqid:1,scpath:p13clipboardFolder,dspath:p13targetpath,names:p13clipboard}),p13folderup(999),1==p13clipboardCut&&(p13clipboardFolder=p13clipboard=null,p13clipboardCut=0,p13updateClipview())}function p13updateClipview(){var e="";null!=p13clipboard&&0<p13clipboard.length&&(e=0==p13clipboardCut?1<p13clipboard.length?format('Manteniendo {0} entradas para copiar, <a href=# onclick="return p13clearClip()" style=cursor:pointer>Eliminar</a>.',p13clipboard.length):format('Manteniendo 1 entrada para copiar, <a href=# onclick="return p13clearClip()" style=cursor:pointer>Eliminar</a>.'):1<p13clipboard.length?format('Manteniendo {0} entradas para mover, <a href=# onclick="return p13clearClip()" style=cursor:pointer>Eliminar</a>.',p13clipboard.length):format('Manteniendo 1 entrada para mover, <a href=# onclick="return p13clearClip()" style=cursor:pointer>Eliminar</a>.')),QH("p13bottomstatus",e),p13setActions()}function p13clearClip(){return p13clipboardFolder=p13clipboard=null,p13clipboardCut=0,p13updateClipview(),!1}function p13fileDragDrop(e){if(haltEvent(e),QV("p13bigfail",!1),QV("p13bigok",!1),null!=e.dataTransfer&&0!=e.dataTransfer.files.length&&null!=p13filetree){var t,o=[];for(t in e.dataTransfer.files)null!=e.dataTransfer.files[t].size&&0!=e.dataTransfer.files[t].size&&o.push(e.dataTransfer.files[t]);0!=o.length&&p13doUploadFiles(o)}}var gdownloadFile,p13dragtimer=null;function p13fileDragOver(e){haltEvent(e),null!=p13dragtimer&&(clearTimeout(p13dragtimer),p13dragtimer=null);e=null!=p13filetree;QV("p13bigok",e),QV("p13bigfail",!e)}function p13fileDragLeave(e){haltEvent(e),"p13filetable"!=e.target.id?(QV("p13bigfail",!1),QV("p13bigok",!1)):p13dragtimer=setTimeout(function(){QV("p13bigfail",!1),QV("p13bigok",!1),p13dragtimer=null},10)}function p13downloadfile(e,t,o,n){!xxdialogMode&&files&&(gdownloadFile={path:decodeURIComponent(e),file:decodeURIComponent(t),size:o,tsize:0,data:"",state:0,id:Math.random(),tag:n},files.sendText({action:"download",sub:"start",id:gdownloadFile.id,path:gdownloadFile.path}),setModalContent("xxAddAgent","Descargar Archivo","<div>"+gdownloadFile.file+"</div><br /><progress id=d2progressBar style=width:100% value=0 max="+o+" />"),showModal("xxAddAgentModal","idx_dlgOkButton",()=>p13downloadFileCancel()))}function p13downloadFileCancel(){setDialogMode(0),files.sendText({action:"download",sub:"cancel",id:gdownloadFile.id}),gdownloadFile=null}function p13gotDownloadCommand(e){null!=gdownloadFile&&e.id==gdownloadFile.id&&("start"==e.sub?(gdownloadFile.state=1,files.sendText({action:"download",sub:"startack",id:gdownloadFile.id})):"cancel"==e.sub&&(gdownloadFile=null,setDialogMode(0)))}function p13gotDownloadBinaryData(e){var t;gdownloadFile&&0!=gdownloadFile.state&&(4<e.length&&(gdownloadFile.tsize+=e.length-4,gdownloadFile.data+=e.substring(4),Q("d2progressBar").value=gdownloadFile.tsize),0!=(1&ReadInt(e,0))?"viewer"==gdownloadFile.tag?(setModalContent("xxAddAgent",EscapeHtml(gdownloadFile.file),4,"extra-large"),t=gdownloadFile.file,showModal("xxAddAgentModal","idx_dlgOkButton",()=>p13editSaveBack(3,t)),QV("d4EncodingButton",!0),QV("d4LineBreakButton",!0),Q("d4editorarea").value=1==d4EditEncodingVal?decode_utf8(gdownloadFile.data):gdownloadFile.data,gdownloadFile=null):(saveAs(data2blob(gdownloadFile.data),gdownloadFile.file),gdownloadFile=null,setDialogMode(0)):files.sendText({action:"download",sub:"ack",id:gdownloadFile.id}))}function p13downloadButton(){for(var e,t,o=document.getElementsByName("fd"),n=0;n<o.length;n++)o[n].checked&&(e=p13filetree.dir[o[n].value],t="devicefile.ashx?c="+authCookie,downloadFile(t=(t=(t+="&m="+currentNode.meshid.split("/")[2])+("&n="+currentNode._id.split("/")[2]))+("&f="+encodeURIComponentEx(p13filetreelocation.join("/")+"/"+e.n)),encodeURIComponentEx(e.n)))}var uploadFile,d4EditWrapVal=0,d4EditSizeVal=0,d4EditEncodingVal=0,d4EditLineBreakVal=0;function d4ToggleWrap(e){e||(d4EditWrapVal=++d4EditWrapVal%2),Q("d4WrapButton").value=["Envoltura: ON","Envoltura: OFF"][d4EditWrapVal],QS("d4editorarea").overflow=0==d4EditWrapVal?"auto":"scroll",QS("d4editorarea")["white-space"]=0==d4EditWrapVal?null:"pre",putstore("editorWrap",d4EditWrapVal)}function d4ToggleSize(e){e||(d4EditSizeVal=++d4EditSizeVal%4),QS("d4editorarea")["font-size"]=["100%","125%","150%","200%"][d4EditSizeVal],Q("d4SizeButton").value=["Tamaño: 100%","Tamaño: 125%","Tamaño: 150%","Tamaño: 200%"][d4EditSizeVal],putstore("editorSize",d4EditSizeVal)}function d4ToggleEncoding(e){e||(d4EditEncodingVal=++d4EditEncodingVal%2,Q("d4editorarea").value=(1==d4EditEncodingVal?decode_utf8:encode_utf8)(Q("d4editorarea").value)),Q("d4EncodingButton").value=["Codificación: RAW","Codificación: UTF8"][d4EditEncodingVal],putstore("editorEncoding",d4EditEncodingVal)}function d4ToggleLineBreak(e){e||(d4EditLineBreakVal=++d4EditLineBreakVal%3),Q("d4LineBreakButton").value=["Line Break: Windows (CR LF)","Line Break: Linux (LF)","Line Break: Mac (CR)"][d4EditLineBreakVal],putstore("editorLineBreak",d4EditLineBreakVal)}function p13editSaveBack(e,t){var o=Q("d4editorarea").value,o=0===d4EditLineBreakVal?o.replace(/\r?\n|\r/g,"\r\n"):2===d4EditLineBreakVal?o.replace(/\r\n|\n/g,"\r"):o.replace(/\r\n|\r/g,"\n"),o=1==d4EditEncodingVal?(new TextEncoder).encode(o):(new TextEncoder).encode(decode_utf8(o));p13uploadFileContinue(1,[{name:t,size:o.byteLength,type:"text/plain",xdata:o}])}function p13doUploadFiles(e){if(!xxdialogMode){var t=0<currentNode.agent.id&&currentNode.agent.id<5||14==currentNode.agent.id||34==currentNode.agent.id,o=[],n=0;for(i in p13filetree.dir)o.push(t?p13filetree.dir[i].n.toLowerCase():p13filetree.dir[i].n);for(var i=0;i<e.length;i++)t?0<=o.indexOf(e[i].name.toLowerCase())&&n++:0<=o.indexOf(e[i].name)&&n++;0==n?p13uploadFileContinue(1,e):(setModalContent("xxAddAgent","Cargar Archivo",format(1==n?"La carga sobrescribirá 1 archivo. ¿Continuar?":"La carga sobrescribirá {0} archivos. ¿Continuar?",n)),showModal("xxAddAgentModal","idx_dlgOkButton",()=>p13uploadFileContinue(3,e)))}}function p13uploadFileContinue(e,t){if((uploadFile={}).xpath=p13filetreelocation.join("/"),uploadFile.xfiles=t,uploadFile.xfilePtr=-1,setModalContent("xxAddAgent","Cargar Archivo","<div id=p13dfileName>Conectando....</div><br /><progress id=d2progressBar style=width:100% value=0 max=0 />"),showModal("xxAddAgentModal","idx_dlgCancelButton",()=>p13uploadFileCancel(10)),document.getElementById("idx_dlgOkButton").style.display="none",p13uploadNextFile(),3==e)return!1}let byteToHex=[];for(var n=0;n<=255;++n){var hexOctet=n.toString(16).padStart(2,"0");byteToHex.push(hexOctet)}function arrayBufferToHex(e){return Array.prototype.map.call(new Uint8Array(e),e=>byteToHex[e]).join("")}function performHash(e,t){window.crypto.subtle.digest("SHA-384",e).then(function(e){t(arrayBufferToHex(e))},function(){t(null)})}function performHashOnFile(e,t){var o=new FileReader;o.onerror=function(e){t(null)},o.onload=function(){window.crypto.subtle.digest("SHA-384",o.result).then(function(e){t(arrayBufferToHex(e))},function(){t(null)})},o.readAsArrayBuffer(e)}function p13uploadNextFile(){if(uploadFile.xfilePtr++,uploadFile.xfiles.length>uploadFile.xfilePtr){uploadFile.xptr=0;var t=uploadFile.xfiles[uploadFile.xfilePtr];if(QH("p13dfileName",EscapeHtml(t.name)),Q("d2progressBar").max=t.size,Q("d2progressBar").value=0,null==t.xdata){uploadFile.xfile=t;var e,o=null;for(e in p13filetree.dir)p13filetree.dir[e].n==t.name&&(o=p13filetree.dir[e]);null!=o&&o.s<=uploadFile.xfile.size?performHashOnFile(uploadFile.xfile,function(e){files.sendText(JSON.stringify({action:"uploadhash",reqid:uploadFile.xfilePtr,path:uploadFile.xpath,name:t.name,tag:{h:e.toUpperCase(),s:o.s,skip:o.s==uploadFile.xfile.size}}))}):files.sendText(JSON.stringify({action:"upload",reqid:uploadFile.xfilePtr,path:uploadFile.xpath,name:t.name,size:uploadFile.xfile.size}))}else uploadFile.xdata=t.xdata,files.sendText(JSON.stringify({action:"upload",reqid:uploadFile.xfilePtr,path:uploadFile.xpath,name:t.name,size:uploadFile.xdata.byteLength}))}else p13uploadFileTransferDone()}function p13uploadFileCancel(e,t){null!=uploadFile&&(files.sendText(JSON.stringify({action:"uploadcancel",reqid:uploadFile.xfilePtr})),uploadFile=null),p13uploadFileTransferDone()}function p13uploadFileTransferDone(){uploadFile=null,setDialogMode(0),p13folderup(9999)}function p13gotUploadData(e){if(null!=uploadFile&&parseInt(uploadFile.xfilePtr)==parseInt(e.reqid))switch(e.action){case"uploadstart":p13uploadNextPart(!(uploadFile.xdataPriming=8));break;case"uploadack":p13uploadNextPart(!1);break;case"uploaddone":(uploadFile.xfiles.length>uploadFile.xfilePtr+1?p13uploadNextFile:p13uploadFileTransferDone)();break;case"uploaderror":p13uploadFileCancel();break;case"uploadhash":var t=uploadFile.xfiles[uploadFile.xfilePtr];t&&(e.tag.h===e.hash?e.tag.skip?p13uploadNextFile():(uploadFile.xptr=e.tag.s,files.sendText(JSON.stringify({action:"upload",reqid:uploadFile.xfilePtr,path:uploadFile.xpath,name:t.name,size:uploadFile.xfile.size,append:!0}))):files.sendText(JSON.stringify({action:"upload",reqid:uploadFile.xfilePtr,path:uploadFile.xpath,name:t.name,size:uploadFile.xfile.size,append:!1})))}}function p13uploadNextPart(e){if(uploadFile.xdata){var t=uploadFile.xdata,o=uploadFile.xptr;if(o>=t.byteLength)files.sendText(JSON.stringify({action:"uploaddone",reqid:uploadFile.xfilePtr}));else{if((n=uploadFile.xptr+(attemptWebRTC?16384:65536))>t.byteLength){if(1==e)return;n=t.byteLength}t=new Uint8Array(t.slice(o,n));123==t[0]||0==t[0]?((o=new Uint8Array(n-o+1)).set(t,1),files.send(o)):files.send(t),uploadFile.xptr=n,Q("d2progressBar").value=n}}else if(uploadFile.xfile&&null==uploadFile.xreader&&!(uploadFile.xptr>=uploadFile.xfile.size)){var n;if((n=uploadFile.xptr+(attemptWebRTC?16384:65536))>uploadFile.xfile.size){if(1==e)return;n=uploadFile.xfile.size}uploadFile.xreader=new FileReader,uploadFile.xreader.onerror=function(e){console.log(e)},uploadFile.xreader.onload=function(){var e,t=uploadFile.xreader.result;delete uploadFile.xreader,null!=t&&(123==(e=new Uint8Array(t))[0]||0==e[0]?((t=new Uint8Array(t.byteLength+1)).set(e,1),files.send(t)):files.send(e),uploadFile.xptr=n,Q("d2progressBar").value=n,uploadFile.xptr>=uploadFile.xfile.size?files.sendText(JSON.stringify({action:"uploaddone",reqid:uploadFile.xfilePtr})):0<uploadFile.xdataPriming&&(uploadFile.xdataPriming--,p13uploadNextPart(!0)))},uploadFile.xreader.readAsArrayBuffer(uploadFile.xfile.slice(uploadFile.xptr,n))}}var currentDeviceEvents=null;function deviceEventsUpdate(){var e="",t=null;for(r in currentDeviceEvents){var o=currentDeviceEvents[r],n=new Date(o.time);if(o.msg){null==o.h&&(o.h=Math.random()),printDate(n)!=t&&(null!=t&&(e+="</table>"),e+='<table class="table table-hover p3eventsTable" cellpadding=0 cellspacing=0><tr><td colspan=4 class=DevSt>'+(t=printDate(n))+"</td></tr>");var i,a,s="fa-mobile-screen";if("user"==o.etype&&(s="fa-user"),"server"==o.etype&&(s="fa-server"),null==o.msgid||null==eventsMessageId[o.msgid])i="string"==typeof o.msg?EscapeHtml(o.msg).split("(R)").join("&reg;"):"";else{for(var r in i=eventsMessageId[o.msgid],o.msgArgs){var l=o.msgArgs[r];"string"==typeof l&&0==l.indexOf("DATETIME:")&&(l=printFlexDateTime(new Date(parseInt(l.substring(9))))),i=i.split("{"+r+"}").join(l)}i=EscapeHtml(i).split("(R)").join("&reg;")}o.username&&(a="",o.guestname&&(a=' / <span title="Esta es una sesión para compartir con invitados">'+EscapeHtml(o.guestname)+"</span>"),i=2&userinfo.siteadmin&&o.userid?"<a href=# onclick='gotoUser(\""+encodeURIComponentEx(o.userid)+"\");haltEvent(event);'>"+EscapeHtml(o.username)+"</a>"+a+" &rarr; "+i:EscapeHtml(o.username)+a+" &rarr; "+i),"relay"!=o.etype&&"relaylog"!=o.action||(s="fa-arrow-right-arrow-left"),e+="<tr onclick=showEventDetails("+o.h+',1) onmouseover=eventMouseHover(this,1) onmouseout=eventMouseHover(this,0) role="button"><td style=width:18px><i class="fa-solid '+s+'"></i></td><td class=g1>&nbsp;</td><td class=style10>'+printTime(n)+" - "+i+"</td></tr><tr></tr>"}}null!=t&&(e+="</table>"),""==e&&(e="<br><i>No se Encontraron Eventos</i><br><br>"),QH("p16events",e)}function refreshDeviceEvents(){""!=p16filterevents.value?meshserver.send({action:"events",nodeid:currentNode._id,limit:parseInt(p16limitdropdown.value),filter:p16filterevents.value}):meshserver.send({action:"events",nodeid:currentNode._id,limit:parseInt(p16limitdropdown.value)})}function showEventDetails(e,t){if(xxdialogMode)return!1;var o,n;for(i in 1==t&&(o=currentDeviceEvents),2==t&&(o=events),o=3==t?currentUserEvents:o)if(o[i].h==e){n=o[i];break}if(n){var i,a="<div style=overflow-y:auto;max-height:300px>";for(i in n)"h"!=i&&"_id"!=i&&"ids"!=i&&"domain"!=i&&null!=n[i]&&("object"==typeof n[i]?a+=addHtmlValue3(EscapeHtml(i),EscapeHtml(JSON.stringify(n[i]))):a+=addHtmlValue3(EscapeHtml(i),EscapeHtml(n[i])));setModalContent("xxAddAgent","Detalles del Evento",a+="</div>"),showModal("xxAddAgentModal","idx_dlgOkButton")}}var deviceDetailsStats=null,deviceDetailsStatsTimer=null,deviceDetailsStatsData=[],deviceDetailsConfig={type:"line",data:{labels:[],datasets:[{label:"CPU",backgroundColor:"rgba(134, 16, 158, .5)",borderColor:"rgb(134, 16, 158)",data:[],fill:!0},{label:"Memoria",backgroundColor:"rgba(255, 99, 132, .5)",borderColor:"rgb(255, 99, 132)",data:[],fill:!0}]},options:{events:["click"],animation:!1,responsive:!0,maintainAspectRatio:!1,tooltips:{enabled:!1},elements:{line:{cubicInterpolationMode:"monotone"}},scales:{x:{type:"linear",display:!0,title:{display:!1,text:""},min:0,max:100,reverse:!0},y:{type:"linear",display:!0,title:{display:!1,text:""},min:0,max:100}}}};function deskToggleCpuGraph(){("none"==QS("p17graph").display?(QV("p17graph",!0),window.deviceDetailsStatsChart=new Chart(document.getElementById("deviceDetailsStats").getContext("2d"),deviceDetailsConfig),deviceDetailsStatsTimer=setInterval(deviceDetailsStatsTimerFunc,2e3),deviceDetailsStatsTimerFunc):deviceDetailsStatsClear)()}function deviceDetailsStatsClear(){QV("p17graph",!1),null!=window.deviceDetailsStatsChart&&(window.deviceDetailsStatsChart.destroy(),delete window.deviceDetailsStatsChart),null!=deviceDetailsStatsTimer&&(clearInterval(deviceDetailsStatsTimer),deviceDetailsStatsTimer=null),deviceDetailsStatsData=[],deviceDetailsStatsDraw(),QV("extraGraphValues",!1),QH("extraGraphValues","")}function deviceDetailsStatsTimerFunc(){null!=currentNode&&meshserver.send({action:"msg",type:"cpuinfo",nodeid:currentNode._id})}function deviceDetailsStatsDraw(e){for(var t=Date.now()/1e3-100;0<deviceDetailsStatsData.length&&deviceDetailsStatsData[0][0]<t-5;)deviceDetailsStatsData.shift();var o=[],n=[];for(a in deviceDetailsStatsData){var i=deviceDetailsStatsData[a];o.push({x:100-(i[0]-t),y:i[1]}),n.push({x:100-(i[0]-t),y:i[2]})}if(deviceDetailsConfig.data.datasets[0].data=o,deviceDetailsConfig.data.datasets[1].data=n,window.deviceDetailsStatsChart&&window.deviceDetailsStatsChart.update(),null!=e&&Array.isArray(e.thermals)&&0<e.thermals.length){var a,s="&nbsp;";for(a in e.thermals)s+='<div class=thermalSensor title="'+e.thermals[a].InstanceName+'">'+parseFloat(e.thermals[a].CurrentTemperature).toFixed(2)+"&deg;C / "+parseFloat(1.8*e.thermals[a].CurrentTemperature+32).toFixed(2)+"&deg;F</div>";QV("extraGraphValues",!0),QH("extraGraphValues",s)}}var consoleNode,DeviceDetailsHardware=null,DeviceDetailsNetwork=null,DeviceDetailsNodeId=null;function updateDeviceDetails(e,t,o){if(null!=currentNode&&(null==e&&(e=currentNode),currentNode._id==e._id)){DeviceDetailsNodeId!=e._id&&(DeviceDetailsNetwork=DeviceDetailsHardware=null,DeviceDetailsNodeId=e._id),null==(t=DeviceDetailsHardware=null!=t?t:DeviceDetailsHardware)&&(t={}),null==(o=DeviceDetailsNetwork=null!=o?o:DeviceDetailsNetwork)&&(o={});var n,i,a=[],s={},r="";if(e.rname&&(r+=addDetailItem("Nombre",EscapeHtml(e.rname),s)),t.windows&&t.windows.osinfo&&t.windows.osinfo.Description&&(r+=addDetailItem("Descripción",EscapeHtml(t.windows.osinfo.Description),s)),e.osdesc&&(r+=addDetailItem("Versión",EscapeHtml(e.osdesc),s)),t.windows&&t.windows.osinfo&&((d=t.windows.osinfo).OSArchitecture&&(d.OSArchitecture.startsWith("32")?r+=addDetailItem("Arquitectura","32 bits",s):d.OSArchitecture.startsWith("64")?r+=addDetailItem("Arquitectura","64 bits",s):r+=addDetailItem("Arquitectura",EscapeHtml(d.OSArchitecture),s)),d.LastBootUpTime)&&(i={year:parseInt(d.LastBootUpTime.substring(0,4)),month:parseInt(d.LastBootUpTime.substring(4,6))-1,day:parseInt(d.LastBootUpTime.substring(6,8)),hours:parseInt(d.LastBootUpTime.substring(8,10)),minutes:parseInt(d.LastBootUpTime.substring(10,12)),seconds:parseInt(d.LastBootUpTime.substring(12,14))},r+=addDetailItem("Last Boot Up Time",printDateTime(new Date(i.year,i.month,i.day,i.hours,i.minutes,i.seconds)))),t.linux&&t.linux.LastBootUpTime&&(r+=addDetailItem("Last Boot Up Time",printDateTime(new Date(t.linux.LastBootUpTime)))),t.darwin&&t.darwin.LastBootUpTime&&(r+=addDetailItem("Last Boot Up Time",printDateTime(new Date(1e3*t.darwin.LastBootUpTime)))),""!=r&&a.push({name:"Sistema Operativo",html:r,img:"software64.png"}),e.agent&&(r="",null!=e.agent&&null!=e.agent.id&&null!=e.agent.ver&&(i="",i=e.agent.id<=agentsStr.length?agentsStr[e.agent.id]:agentsStr[0],0!=e.agent.ver&&(i+=" v"+e.agent.ver),r+=addDetailItem("Agente Mesh",i=14==e.agent.id?e.agent.core:i)),0!=(1&e.conn)?r+=addDetailItem("Última conexión del agente","Conectado ahora"):e.lastconnect&&(r+=addDetailItem("Última conexión del agente",printDateTime(new Date(e.lastconnect)))),e.lastaddr&&(2<(i=e.lastaddr.split(":")).length?r+=addDetailItem("Última dirección IP del agente",e.lastaddr):isPrivateIP(e.lastaddr)?r+=addDetailItem("Última dirección IP del agente",i[0]):r+=addDetailItem("Última dirección IP del agente",'<a href="https://iplocation.com/?ip='+i[0]+'" rel="noreferrer noopener" target="MeshIPLoopup">'+i[0]+"</a>")),null!=t.agentvers&&t.agentvers.compileTime&&(i=Date.parse(t.agentvers.compileTime),r+=addDetailItem("Fecha de compilación",isNaN(i)?t.agentvers.compileTime:printDateTime(new Date(i)))),""!=r)&&a.push({name:"Agente Mesh",html:r,img:"meshagent64.png"}),t.mobile&&(r="",t.mobile.brand&&t.mobile.model&&(r+=addDetailItem("Modelo",EscapeHtml(t.mobile.brand+", "+t.mobile.model),s)),t.mobile.device&&(r+=addDetailItem("Dispositivo",EscapeHtml(t.mobile.device),s)),t.mobile.bootloader&&(r+=addDetailItem("Bootloader",EscapeHtml(t.mobile.bootloader),s)),t.mobile.id&&(r+=addDetailItem("Identificador",EscapeHtml(t.mobile.id),s)),t.mobile.host&&(r+=addDetailItem("Nombre de Host",EscapeHtml(t.mobile.host),s)),t.mobile.androidapi&&t.mobile.androidrelease&&(r+=addDetailItem("Android Version",EscapeHtml(t.mobile.androidrelease+", API Level "+t.mobile.androidapi),s)),""!=r)&&a.push({name:"Dispositivo móvil",html:r,img:"mobile64.png"}),null!=o.netif){var l={};for(h in o.netif)"string"==typeof(d=o.netif[h]).mac&&(null==l[d.mac]?(l[d.mac]=d,l[d.mac].ipv4layer=[{v4addr:d.v4addr,v4mask:d.v4mask,v4gateway:d.v4gateway}]):l[d.mac].ipv4layer.push({v4addr:d.v4addr,v4mask:d.v4mask,v4gateway:d.v4gateway}));var r="";for(h in r+='<table class="table table-hover" style=width:100%>',l){var d=l[h];for(p in r=(r+="<tr><td><div class=style10 style=border-radius:5px;padding:8px>")+("<div style=margin-bottom:3px><b>"+EscapeHtml(d.name+(d.dnssuffix?", "+d.dnssuffix:""))+"</b></div>"),d.desc&&(r+=addDetailItem("Descripción",EscapeHtml(d.desc).split("(R)").join("&reg;"))),d.mac&&(d.gatewaymac?r+=addDetailItem("Capa MAC",format("MAC: {0}, Puerta de Enlace: {1}",EscapeHtml(d.mac),EscapeHtml(d.gatewaymac))):d.mac&&(r+=addDetailItem("Capa MAC",format("MAC: {0}",EscapeHtml(d.mac))))),d.ipv4layer){var c=d.ipv4layer[p];c.v4gateway&&c.v4mask?r+=addDetailItem("Capa IPv4",format("IP: {0}, Máscara: {1}, Puerta de enlace: {2}",EscapeHtml(c.v4addr),EscapeHtml(c.v4mask),EscapeHtml(c.v4gateway))):c.v4addr&&(r+=addDetailItem("Capa IPv4",format("IP: {0}",EscapeHtml(c.v4addr))))}r+="</div></td></tr>"}""!=(r+="</table>")&&a.push({name:"Redes",html:r,img:"networking64.png"})}if(null!=o.netif2){var r="";for(h in r+='<table class="table table-hover" style=width:100%>',o.netif2){d=o.netif2[h];if(!(0==Array.isArray(d)||d.length<1||null==d[0]||"string"==typeof d[0].mac&&d[0].mac.startsWith("00:00:00:00"))){r+="<tr><td><div class=style10 style=border-radius:5px;padding:8px>";var u="";null!=h&&(u+=h),null!=d[0].fqdn&&""!=d[0].fqdn&&(u+=", "+d[0].fqdn),0<u.length&&(r+="<div style=margin-bottom:3px><b>"+EscapeHtml(u)+"</b></div>"),d.desc&&(r+=addDetailItem("Descripción",EscapeHtml(d.desc).split("(R)").join("&reg;"))),"string"==typeof d[0].mac&&(d[0].gatewaymac?r+=addDetailItem("Capa MAC",format("MAC: {0}, Puerta de Enlace: {1}",EscapeHtml(d[0].mac),EscapeHtml(d[0].gatewaymac))):r+=addDetailItem("Capa MAC",format("MAC: {0}",EscapeHtml(d[0].mac))));for(var p=0;p<d.length;p++){var m=d[p],g=[];m.address&&g.push(format("IP: {0}",EscapeHtml(m.address))),m.netmask&&g.push(format("Máscara: {0}",EscapeHtml(m.netmask))),m.gateway&&g.push(format("Puerta de enlace: {0}",EscapeHtml(m.gateway))),0<g.length&&("IPv4"==m.family&&(r+=addDetailItem("Capa IPv4",g.join(", "))),"IPv6"==m.family)&&(r+=addDetailItem("Capa IPv6",g.join(", ")))}r+="</div></td></tr>"}}t.network&&t.network.dns&&(r=(r+="<tr><td><div class=style10 style=border-radius:5px;padding:8px>")+addDetailItem("<b>DNS Servers</b>",t.network.dns.join(", "))+"</div></td></tr>"),""!=(r+="</table>")&&a.push({name:"Redes",html:r,img:"networking64.png"})}if(null!=e.intelamt&&(r="",r+=addDetailItem("Versión",e.intelamt.ver?"v"+EscapeHtml(e.intelamt.ver):"<i>Desconocido</i>",s),i={0:nobreak("No Activada"),1:nobreak("Preactivación"),2:nobreak("Activado")},n="",2==e.intelamt.state&&e.intelamt.flags&&(2&e.intelamt.flags?n=", Modo de Control de Cliente (CCM)":4&e.intelamt.flags&&(n=", Modo de Control de Administrador (ACM)")),""!=(r=(r=(r+=addDetailItem("Estado de Aprovisionamiento",(e.intelamt.state?i[e.intelamt.state]:"<i>Desconocido</i>")+n,s))+addDetailItem("Seguridad",1==e.intelamt.tls?"Asergurado usando TLS":"TLS no esta configurado",s))+addDetailItem("Credenciales del Administrador",null==e.intelamt.user||""==e.intelamt.user||null!=e.intelamt.warn&&0!=(9&e.intelamt.warn)?"No Conocido":"Conocido",s)))&&("number"==typeof e.intelamt.sku&&0!=(16&e.intelamt.sku)?a.push({name:"Capacidad de gestión estándar de Intel&reg; (Intel&reg; SM)",html:r,img:"amt64.png"}):a.push({name:"Intel&reg; Active Management Technology (Intel&reg; AMT)",html:r,img:"amt64.png"})),t.identifiers){var r="",v=t.identifiers;if(v.bios_vendor&&(r+=addDetailItem("Fabricante",EscapeHtml(v.bios_vendor),s)),v.bios_version&&(r+=addDetailItem("Versión",EscapeHtml(v.bios_version),s)),v.bios_serial&&(r+=addDetailItem("Número de Serie",EscapeHtml(v.bios_serial),s)),v.bios_mode&&(r+=addDetailItem("Mode",EscapeHtml(v.bios_mode),s)),""!=r&&a.push({name:"BIOS",html:r,img:"chip64.png"}),r="",v.board_vendor&&(r+=addDetailItem("Fabricante",EscapeHtml(v.board_vendor),s)),v.board_name&&(r+=addDetailItem("Nombre",EscapeHtml(v.board_name),s)),v.board_serial&&""!=v.board_serial&&(r+=addDetailItem("Número de Serie",EscapeHtml(v.board_serial),s)),v.board_version&&(r+=addDetailItem("Versión",EscapeHtml(v.board_version),s)),v.product_uuid&&(r+=addDetailItem("Identificador",EscapeHtml(v.product_uuid),s)),v.cpu_name&&(r+=addDetailItem("CPU",EscapeHtml(v.cpu_name).split("(TM)").join("&trade;").split("(R)").join("&reg;"),s)),v.gpu_name)for(var h in v.gpu_name)r+=addDetailItem("GPU",EscapeHtml(v.gpu_name[h]).split("(TM)").join("&trade;").split("(R)").join("&reg;"),s);""!=r&&a.push({name:"Placa Madre",html:r,img:"motherboard64.png"})}if(t.tpm&&(r="",(i=t.tpm).SpecVersion&&(r+=addDetailItem("SpecVersion",parseFloat(EscapeHtml(i.SpecVersion)).toFixed(1),s)),i.ManufacturerId&&(r+=addDetailItem("ManufacturerId",EscapeHtml(i.ManufacturerId),s)),i.ManufacturerVersion&&(r+=addDetailItem("ManufacturerVersion",EscapeHtml(i.ManufacturerVersion),s)),null!=i.IsActivated&&(r+=addDetailItem("IsActivated",i.IsActivated?"Yes":"No",s)),null!=i.IsEnabled&&(r+=addDetailItem("IsEnabled",i.IsEnabled?"Yes":"No",s)),null!=i.IsOwned&&(r+=addDetailItem("IsOwned",i.IsOwned?"Yes":"No",s)),""!=r)&&a.push({name:"TPM",html:r,img:"tpm64.png"}),t.windows&&t.windows.memory&&0<t.windows.memory.length){r="";for(h in t.windows.memory.sort(function(e,t){return e.BankLabel>t.BankLabel?1:e.BankLabel<t.BankLabel?-1:0}),r+='<table class="table table-hover" style=width:100%>',t.windows.memory){d=t.windows.memory[h];r=(r+="<tr><td><div class=style10 style=border-radius:5px;padding:8px>")+("<div style=margin-bottom:3px><b>"+EscapeHtml(d.BankLabel||d.DeviceLocator||"Unknown")+"</b></div>"),d.Capacity&&d.Speed?r+=addDetailItem("Capacidad / Velocidad",format("{0} Mb, {1} Mhz",d.Capacity/1024/1024,d.Speed),s):d.Capacity&&(r+=addDetailItem("Capacidad",format("{0} Mb",d.Capacity/1024/1024),s)),d.PartNumber&&(r+=addDetailItem("Numero de Parte",EscapeHtml(d.Manufacturer&&"Undefined"!=d.Manufacturer?d.Manufacturer+", ":"")+EscapeHtml(d.PartNumber),s)),r+="</div>"}""!=(r+="</table>")&&a.push({name:"Memoria",html:r,img:"ram64.png"})}if(t.linux&&t.linux.memory&&0<t.linux.memory.Memory_Device.length){r="";for(h in t.linux.memory.Memory_Device.sort(function(e,t){return e.Locator>t.Locator?1:e.Locator<t.Locator?-1:0}),r+='<table class="table table-hover" style=width:100%>',t.linux.memory.Memory_Device)(d=t.linux.memory.Memory_Device[h]).Size&&"No Module Installed"==d.Size||(r=(r+="<tr><td><div class=style10 style=border-radius:5px;padding:8px>")+"<div style=margin-bottom:3px><b>"+EscapeHtml(d.Locator||"Unknown")+"</b></div>",d.Size&&d.Speed?r+=addDetailItem("Capacidad / Velocidad",format("{0}, {1}",d.Size,d.Speed),s):d.Size&&(r+=addDetailItem("Capacidad",format("{0}",d.Size),s)),d.PartNumber&&(r+=addDetailItem("Numero de Parte",EscapeHtml(d.Manufacturer&&"Undefined"!=d.Manufacturer?d.Manufacturer+", ":"")+EscapeHtml(d.PartNumber),s)),r+="</div>");""!=(r+="</table>")&&a.push({name:"Memoria",html:r,img:"ram64.png"})}if(t.darwin&&t.darwin.memory&&0<t.darwin.memory.length){r="";for(h in r+='<table class="table table-hover" style=width:100%>',t.darwin.memory)(d=t.darwin.memory[h]).Size&&"No Module Installed"==d.Size||(r=(r+="<tr><td><div class=style10 style=border-radius:5px;padding:8px>")+"<div style=margin-bottom:3px><b>"+EscapeHtml(d.DeviceLocator||"Unknown")+"</b></div>",d.Size&&d.Speed?r+=addDetailItem("Capacidad / Velocidad",format("{0}, {1}",d.Size,d.Speed),s):d.Size&&(r+=addDetailItem("Capacidad",format("{0}",d.Size),s)),d.PartNumber&&(r+=addDetailItem("Numero de Parte",EscapeHtml(d.Manufacturer&&""!=d.Manufacturer?d.Manufacturer+", ":"")+EscapeHtml(d.PartNumber),s)),r+="</div>");""!=(r+="</table>")&&a.push({name:"Memoria",html:r,img:"ram64.png"})}if(t.identifiers&&t.identifiers.storage_devices){var f,r="";for(h in v.storage_devices.sort(function(e,t){return e.Caption>t.Caption?1:e.Caption<t.Caption?-1:0}),r+="<table style=width:100%>",v.storage_devices)(d=v.storage_devices[h]).Size&&(r=(r+="<tr><td><div class=style10 style=border-radius:5px;padding:8px>")+"<div style=margin-bottom:3px><b>"+EscapeHtml(d.Caption)+"</b></div>",d.Model&&d.Model!=d.Caption&&(r+=addDetailItem("Modelo",EscapeHtml(d.Model),s)),d.Size&&("string"==typeof d.Size&&parseInt(d.Size)==d.Size&&(d.Size=parseInt(d.Size)),"number"==typeof d.Size&&(r+=addDetailItem("Capacidad",format("{0} Mb",Math.floor(d.Size/1024/1024)),s)),"string"==typeof d.Size)&&(r+=addDetailItem("Capacidad",EscapeHtml(d.Size),s)),t.windows&&t.windows.drives&&d.Model&&(f=t.windows.drives.find(e=>e.Model===d.Model))&&f.Status&&(r+=addDetailItem("Estado",EscapeHtml(f.Status),s)),r+="</div>");""!=(r+="</table>")&&a.push({name:"Almacenamiento",html:r,img:"storage64.png"})}if(t.windows&&t.windows.volumes){var x,r="";for(h in t.windows.volumes)r=(r+="<tr><td><div class=style10 style=border-radius:5px;padding:8px>")+("<div style=margin-bottom:3px><b>"+h+":"+(null==(d=t.windows.volumes[h]).name||""==d.name?"":" - "+EscapeHtml(d.name))+"</b></div>"),d.size&&(k=["Bytes","KB","MB","GB","TB"],b=0===(p=parseInt(Math.floor(Math.log(Math.abs(d.size))/Math.log(1024)),10))?d.size+" "+k[p]:(d.size/1024**p).toFixed(2)+" "+k[p],r+=addDetailItem("Capacidad",EscapeHtml(b),s)),d.sizeremaining&&(k=["Bytes","KB","MB","GB","TB"],b=0===(p=parseInt(Math.floor(Math.log(Math.abs(d.sizeremaining))/Math.log(1024)),10))?d.sizeremaining+" "+k[p]:(d.sizeremaining/1024**p).toFixed(2)+" "+k[p],r+=addDetailItem("Capacity Remaining",EscapeHtml(b),s)),d.type&&(r+=addDetailItem("File System",(""!=(y=1==d.removable?"Removable":1==d.cdrom?"CD-ROM":"")?y+" / ":"")+("Unknown"==d.type?"Desconocido":EscapeHtml(d.type)),s)),(d.protectionStatus||d.volumeStatus)&&(x=[],d.protectionStatus&&x.push("Habilitado"),d.volumeStatus&&"FullyDecrypted"==d.volumeStatus&&x.push("Fully Decrypted"),d.volumeStatus&&"EncryptionInProgress"==d.volumeStatus&&x.push("Encryption In Progress"),d.volumeStatus&&"FullyEncrypted"==d.volumeStatus&&x.push("Fully Encrypted"),x=x.join(" - "),d.recoveryPassword&&(x+=addKeyLink("",'deviceDetailsShowBitlockerInfo("'+encodeURIComponentEx(h)+'","'+encodeURIComponentEx(d.identifier)+'","'+encodeURIComponentEx(d.recoveryPassword)+'")')),r+=addDetailItem("BitLocker",x,s)),r+="</div>";""!=r&&a.push({name:"Storage Volumes",html:"<table style=width:100%>"+r+"</table>",img:"storage64.png"})}if(t.linux&&t.linux.volumes){var k,b,r="";for(h in t.linux.volumes)(d=t.linux.volumes[h]).mount_point.startsWith("/var/lib/docker/overlay2")||(r=(r+="<tr><td><div class=style10 style=border-radius:5px;padding:8px>")+"<div style=margin-bottom:3px><b>"+d.mount_point+"</b></div>",d.size&&(k=["KB","MB","GB","TB"],b=0===(p=parseInt(Math.floor(Math.log(Math.abs(d.size))/Math.log(1024)),10))?d.size+" "+k[p]:(d.size/1024**p).toFixed(2)+" "+k[p],r+=addDetailItem("Capacidad",EscapeHtml(b),s)),d.available&&(b=0==Math.abs(d.available)?"0 KB":(k=["KB","MB","GB","TB"],0===(p=parseInt(Math.floor(Math.log(Math.abs(d.available))/Math.log(1024)),10))?d.available+" "+k[p]:(d.available/1024**p).toFixed(2)+" "+k[p]),r+=addDetailItem("Capacity Remaining",EscapeHtml(b),s)),d.type&&(r+=addDetailItem("File System",(""!=(y=1==d.removable?"Removable":1==d.cdrom?"CD-ROM":"")?y+" / ":"")+("Unknown"==d.type?"Desconocido":EscapeHtml(d.type)),s)),r+="</div>");""!=r&&a.push({name:"Storage Volumes",html:"<table style=width:100%>"+r+"</table>",img:"storage64.png"})}if(t.darwin&&t.darwin.volumes){var y,r="";for(h in t.darwin.volumes)(d=t.darwin.volumes[h]).mount_point.startsWith("/var/lib/docker/overlay2")||(r=(r+="<tr><td><div class=style10 style=border-radius:5px;padding:8px>")+"<div style=margin-bottom:3px><b>"+d.mount_point+"</b></div>",d.size&&(r+=addDetailItem("Capacidad",EscapeHtml(d.size),s)),d.available&&(r+=addDetailItem("Capacity Remaining",EscapeHtml(d.available),s)),d.type&&(r+=addDetailItem("File System",(""!=(y=1==d.removable?"Removable":1==d.cdrom?"CD-ROM":"")?y+" / ":"")+("Unknown"==d.type?"Desconocido":EscapeHtml(d.type)),s)),r+="</div>");""!=r&&a.push({name:"Storage Volumes",html:"<table style=width:100%>"+r+"</table>",img:"storage64.png"})}r="";for(h in a)null==a[h].img?r+="<div class=DevSt style=margin-bottom:3px;margin-left:16px><b>"+a[h].name+"</b></div><div style=margin-bottom:10px;margin-left:16px>"+a[h].html+"</div>":r=(r=(r+="<table style=width:100%><tr>")+"<td style=width:64px;vertical-align:top><img src=images/details/"+a[h].img+" border=0 width=64 /></td>")+"<td><div class=DevSt style=margin-bottom:3px;margin-left:16px><b>"+a[h].name+"</b></div><div style=margin-bottom:10px;margin-left:16px>"+a[h].html+"</div></td></tr></table>";""==r?QH("p17info2","No hay información para este dispositivo."):QH("p17info2",r)}}function deviceDetailsShowBitlockerInfo(e,t,o){if(xxdialogMode)return!1;t="<div><p>Identificador</p><p style=user-select:text;font-weight:bold>"+(t?decodeURIComponent(t):"Desconocido")+"</p>";t+="<p>Recovery Password</p><p style=user-select:text;font-weight:bold>"+(o?decodeURIComponent(o):"Desconocido")+"</p></div>",setModalContent("xxAddAgent",decodeURIComponent(e)+": BitLocker Information",t),showModal("xxAddAgentModal","idx_dlgOkButton")}function agentConsoleHandleKeys(e){var t,o,n;return!(!e.ctrlKey&&!e.altKey)||(t=0,o=Q("p15consoleText"),e.key?13==e.keyCode&&0==consoleFocus?(p15consoleSend(e),t=1):8==e.keyCode&&0==consoleFocus?(n=o.value,o.value=n.substring(0,n.length-1),t=1):27==e.keyCode?(o.value="",t=1):38==e.keyCode||40==e.keyCode?(n=consoleHistory.indexOf(o.value),38==e.keyCode&&consoleHistory.length-1>n?o.value=consoleHistory[n+1]:40==e.keyCode&&0<n?o.value=consoleHistory[n-1]:40==e.keyCode&&0==n&&(o.value=""),t=1):1===e.key.length&&(insertTextAtCursor(o,e.key),t=1):0!=e.charCode&&0==consoleFocus&&(o.value=o.value+String.fromCharCode(e.charCode),t=1),0<t?haltEvent(e):void 0)}function insertTextAtCursor(e,t){var o,n;document.selection?(e.focus(),(sel=document.selection.createRange()).text=t):e.selectionStart||"0"==e.selectionStart?(o=e.selectionStart,n=e.selectionEnd,e.value=e.value.substring(0,o)+t+e.value.substring(n,e.value.length),e.setSelectionRange(n+1,n+1)):e.value+=myValue}var consoleServerText="";function setupConsole(){var e,t;115==xxcurrentView?(e="server"==consoleNode,consoleNode="server",QH("p15deviceName","Mi Consola de Servidor"),QE("p15consoleText",!0),QH("p15statetext",""),QH("p15coreName",""),QV("p15outputselecttd",!1),0==e&&(QH("p15agentConsoleText",consoleServerText),Q("p15agentConsoleText").scrollTop=Q("p15agentConsoleText").scrollHeight)):(e=consoleNode==currentNode,meshes[(consoleNode=currentNode).meshid],0!=(16&GetNodeRights(currentNode))?(null==consoleNode.consoleText&&(consoleNode.consoleText=""),0==e&&(QH("p15agentConsoleText",consoleNode.consoleText),Q("p15agentConsoleText").scrollTop=Q("p15agentConsoleText").scrollHeight),0==(1&consoleNode.conn)&&consoleNode.conn,e=0!=(1&consoleNode.conn)?"Agente desconectado":"Agente conectado",0!=(16&consoleNode.conn)&&(e+=", MQQT esta en línea"),QH("p15statetext",e),QE("p15uploadCore",0!=(1&consoleNode.conn)),QV("p15outputselecttd",0!=(16&consoleNode.conn)||1==currentNode.pmt&&0!=(4&features2)),QV("p15outputselect2",0!=(16&consoleNode.conn)),QV("p15outputselect3",1==currentNode.pmt&&0!=(4&features2)),e=Q("p15outputselect").value,0==(16&consoleNode.conn)&&2==e&&(e=1,Q("p15outputselect").value=1),1==currentNode.pmt&&0!=(4&features2)||3!=e||(e=1,Q("p15outputselect").value=1),t=!1,0!=(1&consoleNode.conn)&&1==e&&(t=!0),0!=(16&consoleNode.conn)&&2==e&&(t=!0),1==currentNode.pmt&&0!=(4&features2)&&3==e&&(t=!0),QE("p15consoleText",t)):(QH("p15statetext","Acceso Denegado"),QE("p15consoleText",!1),QE("p15uploadCore",!1),QV("p15outputselecttd",!1)),QV("devListToolbarViewIcons3",0!=(1&consoleNode.conn)))}function p15consoleClear(){QH("p15agentConsoleText",""),Q("id_p15consoleClear").blur(),115==xxcurrentView?consoleServerText="":consoleNode.consoleText=""}var consoleHistory=[];function p15consoleSend(e){var t;e&&13!=e.keyCode||(e=Q("p15consoleText").value,t="<div style=color:green>&gt; "+EscapeHtml(e)+"<br/></div>",115==xxcurrentView?(consoleServerText+=t,meshserver.send({action:"serverconsole",value:e})):0!=(16&consoleNode.conn)&&2==Q("p15outputselect").value?(t="<div style=color:orange>MQTT&gt; "+EscapeHtml(e)+"<br/></div>",consoleNode.consoleText+=t,meshserver.send({action:"sendmqttmsg",topic:"console",nodeids:[consoleNode._id],msg:e})):1==consoleNode.pmt&&3==Q("p15outputselect").value&&0!=(4&features2)?(t="<div style=color:violet>EMPUJAR&gt; "+EscapeHtml(e)+"<br/></div>",consoleNode.consoleText+=t,meshserver.send({action:"pushconsole",nodeid:consoleNode._id,console:e})):0!=(1&consoleNode.conn)&&(consoleNode.consoleText+=t,meshserver.send({action:"msg",type:"console",nodeid:consoleNode._id,value:e})),Q("p15agentConsoleText").innerHTML+=t,Q("p15agentConsoleText").scrollTop=Q("p15agentConsoleText").scrollHeight,Q("p15consoleText").value="",0<e.length&&(0<=(t=consoleHistory.indexOf(e))&&consoleHistory.splice(t,1),consoleHistory.unshift(e),consoleHistory.splice(10)))}function p15consoleReceive(e,t,o){"serverconsole"===e?(t="<div>"+EscapeHtml(t)+"</div>",consoleServerText+=t,"server"==consoleNode&&(Q("p15agentConsoleText").innerHTML+=t,Q("p15agentConsoleText").scrollTop=Q("p15agentConsoleText").scrollHeight)):(t="MQTT"==o?"<div style=color:red>MQTT&gt; "+EscapeHtml(t)+"<br/></div>":"<div>"+EscapeHtml(t)+"</div>",null==e.consoleText?e.consoleText=t:e.consoleText+=t,consoleNode==e&&(Q("p15agentConsoleText").innerHTML+=t,Q("p15agentConsoleText").scrollTop=Q("p15agentConsoleText").scrollHeight))}function p15downloadConsoleText(){saveAs(new Blob([Q("p15agentConsoleText").innerText],{type:"application/octet-stream"}),"console.txt")}function p15uploadCore(e){xxdialogMode||(1==e.shiftKey?meshserver.send({action:"uploadagentcore",nodeids:[consoleNode._id],type:"default"}):1==e.altKey?meshserver.send({action:"uploadagentcore",nodeids:[consoleNode._id],type:"clear"}):1==e.ctrlKey?p15uploadCore2():(setModalContent("xxAddAgent","Realizar Acción en el Agente",addHtmlFormFloating("Acción",'<select id=d3coreMode class="form-select me-2"><option value=1>Cargar el archivo de núcleo predeterminado</option><option value=2>Borrar el núcleo</option><option value=6>Cargar núcleo de recuperación</option><option value=7>Sube un pequeño núcleo</option><option value=3>Cargar un archivo de núcleo</option><option value=4>Agente de desconexión por Soft</option><option value=5>Agente (Desconexión dura)</option><option value=8>Restart agent service</select>')),showModal("xxAddAgentModal","idx_dlgOkButton",p15uploadCoreEx)))}function p15uploadCoreEx(){1==Q("d3coreMode").value?meshserver.send({action:"uploadagentcore",nodeids:[consoleNode._id],type:"default"}):2==Q("d3coreMode").value?meshserver.send({action:"uploadagentcore",nodeids:[consoleNode._id],type:"clear"}):3==Q("d3coreMode").value?p15uploadCore2():4==Q("d3coreMode").value?meshserver.send({action:"agentdisconnect",nodeid:consoleNode._id,disconnectMode:1}):5==Q("d3coreMode").value?meshserver.send({action:"agentdisconnect",nodeid:consoleNode._id,disconnectMode:2}):6==Q("d3coreMode").value?meshserver.send({action:"uploadagentcore",nodeids:[consoleNode._id],type:"recovery"}):7==Q("d3coreMode").value?meshserver.send({action:"uploadagentcore",nodeids:[consoleNode._id],type:"tiny"}):8==Q("d3coreMode").value&&meshserver.send({action:"msg",type:"console",nodeid:consoleNode._id,value:"service restart"})}function p15uploadCore2(){xxdialogMode||(Q("d3localmodeform").action="uploadmeshcorefile.ashx",Q("d3auth").value=authCookie,Q("d3filter").value=".js",Q("d3attrib").value=currentNode._id,setModalContent("xxAddAgent","Cargar Núcleo de Agente Mesh",""),showModal("xxAddAgentModal","idx_dlgOkButton",()=>p15uploadCoreEx2()),d3init())}function p15uploadCoreEx2(){var e;1==Q("d3uploadMode").value?Q("d3submit").click():1==(e=d3getFileSel()).length&&meshserver.send({action:"uploadagentcore",nodeids:[consoleNode._id],type:"custom",path:d3filetreelocation.join("/")+"/"+e[0]})}function account_viewPreviousLogins(){xxdialogMode||(xxdialogTag="previousLogins",setModalContent("xxAddAgent","Inicios de Sesión Anteriores","Loading..."),showModal("xxAddAgentModal","idx_dlgOkButton"),meshserver.send({action:"previousLogins"}))}function account_manageImage(e){var t,o,n,i;xxdialogMode||(t=0==e?userinfo:currentUser,setModalContent("xxAddAgent","Administrar Imagen de Cuenta",'<input id=p2file type=file class="form-control" accept="image/*" onchange=account_manageImageEx()><div style=width:100%><canvas id=p2canvas width=256 height=256 style="width:256px;height:256px;margin-left:60px;margin-top:8px;border-radius:16px;background: var(--sub-menu-bg);border: 1px solid #cfcdcd; cursor: pointer;" onclick=account_canvasClick() /></div>'),showModal("xxAddAgentModal","idx_dlgOkButton",account_manageImageEx2),o=Q("p2canvas").getContext("2d"),null==t.accountImageRnd&&(t.accountImageRnd=Math.floor(9999999999*Math.random())),n="",1==e&&(n="&id="+t._id.split("/")[2]),(i=new Image).onload=function(){o.clearRect(0,0,256,256),o.drawImage(i,0,0)},i.src=null!=t.flags&&1&t.flags?"userimage.ashx?rnd="+t.accountImageRnd+n:"images/user-256.png",QE("idx_dlgDeleteButton",null!=t.flags&&1&t.flags),QE("idx_dlgOkButton",!1))}function account_canvasClick(){Q("p2file").click()}function account_manageImageEx(){var e=Q("p2file").files[0],i=new Image;i.onload=function(){var e=0,t=0,o=Math.min(i.width,i.height),n=(i.width>o&&(e=(i.width-o)/2),i.height>o&&(t=(i.height-o)/2),Q("p2canvas").getContext("2d"));n.imageSmoothingEnabled=!0,n.webkitImageSmoothingEnabled=!0,n.mozImageSmoothingEnabled=!0,n.clearRect(0,0,256,256),n.drawImage(i,e,t,o,o,0,0,256,256),QE("idx_dlgOkButton",!0)},i.src=URL.createObjectURL(e)}function account_manageImageEx2(e,t){meshserver.send({action:"updateUserImage",userid:t,image:2==e?0:Q("p2canvas").toDataURL(Q("p2file").files[0].type)})}function account_managePhone(){xxdialogMode||0==(33554432&features)||(null!=userinfo.phone?(setModalContent("xxAddAgent","Notificaciones Telefónicas",'<table style=width:100%><tr><td style=width:56px><img src="images/phone80.png" style=padding:8px>'+("<td style=text-align:center><div style=padding:6px>Número de teléfono verificado</div><div style=font-size:20px>"+EscapeHtml(userinfo.phone)+"</div>")+'<div style=margin:10px><label><input id=d2delPhone type=checkbox class="form-check-input me-2" onclick=account_managePhoneRemoveValidate() />Remover número de teléfono</label></div>'),showModal("xxAddAgentModal","idx_dlgOkButton",()=>account_managePhoneRemove()),account_managePhoneRemoveValidate):(xxdialogTag="verifyPhone",setModalContent("xxAddAgent","Notificaciones Telefónicas",'<table style=width:100%><tr><td style=width:56px><img src="images/phone80.png" style=padding:8px>'+"<td>Ingresa tu número de teléfono con capacidad para SMS. Una vez verificado, el número puede usarse para la verificación de inicio de sesión y otras notificaciones."+'<br /><br /><div style=width:100%;text-align:center>Número de teléfono: <input type=tel pattern="[0-9]" autocomplete="tel" inputmode="tel" maxlength=18 id=d2phoneinput onKeyUp=account_managePhoneValidate() onkeypress="if (event.key==\'Enter\') account_managePhoneValidate(1)"></div></table>'),showModal("xxAddAgentModal","idx_dlgOkButton",()=>account_managePhoneAdd()),Q("d2phoneinput").focus(),account_managePhoneValidate))()}function isPhoneNumber(e){var t=!0;e.startsWith("+")&&(e=e.substring(1));for(var o=0;o<e.length;o++){var n=e.charCodeAt(o);(n<48||57<n)&&32!=n&&45!=n&&46!=n&&(t=!1)}return t&&10<=e.length}function account_managePhoneValidate(e){var t=isPhoneNumber(Q("d2phoneinput").value);QE("idx_dlgOkButton",t),1==e&&t&&dialogclose(1)}function account_managePhoneCodeValidate(e){var t=6==Q("d2phoneCodeInput").value.length&&Q("d2phoneCodeInput").value.match(/[0-9]/);QE("idx_dlgOkButton",t),1==e&&t&&dialogclose(1)}function account_managePhoneConfirm(e,t){meshserver.send({action:"confirmPhone",code:Q("d2phoneCodeInput").value,cookie:t})}function account_managePhoneAdd(){0!=isPhoneNumber(Q("d2phoneinput").value)&&(QE("d2phoneinput",!1),meshserver.send({action:"verifyPhone",phone:Q("d2phoneinput").value}))}function account_managePhoneRemove(){Q("d2delPhone").checked&&meshserver.send({action:"removePhone"})}function account_managePhoneRemoveValidate(){QE("idx_dlgOkButton",Q("d2delPhone").checked)}function account_manageMessaging(){var e,t;xxdialogMode||0==(33554432&features2)||(null!=userinfo.msghandle?(setModalContent("xxAddAgent","Notificaciones de Mensajería",e=(e='<table style=width:100%><tr><td style=width:56px><img src="images/messaging40.png" style=padding:8px>')+("<td style=text-align:center><div style=padding:6px>Usuario Verificado</div><div style=font-weight:bold>"+EscapeHtml(userinfo.msghandle)+"</div>")+'<div style=margin:10px><label><input id=d2delPhone type=checkbox class="form-check-input me-2" onclick=account_managePhoneRemoveValidate() />Remover mensajes</label></div>'),showModal("xxAddAgentModal","idx_dlgOkButton",()=>account_manageMessagingRemove()),account_managePhoneRemoveValidate):(t="<select id=d2serviceselect style=width:160px;margin-left:8px onchange=account_manageMessagingValidate()>",0!=(1&serverinfo.userMsgProviders)&&(t+="<option value=1>Telegram</option>"),0!=(4&serverinfo.userMsgProviders)&&(t+="<option value=4>Discord</option>"),0!=(8&serverinfo.userMsgProviders)&&(t+="<option value=8>XMPP</option>"),0!=(16&serverinfo.userMsgProviders)&&(t+="<option value=16>CallMeBot</option>"),0!=(32&serverinfo.userMsgProviders)&&(t+="<option value=32>Pushover</option>"),0!=(64&serverinfo.userMsgProviders)&&(t+="<option value=64>ntfy</option>"),0!=(128&serverinfo.userMsgProviders)&&(t+="<option value=128>Zulip</option>"),0!=(256&serverinfo.userMsgProviders)&&(t+="<option value=256>Slack</option>"),e=(e='<table style=width:100%><tr><td style=width:56px;vertical-align:top><img src="images/messaging40.png" style=padding:8px>')+"<td>Ingresa a tu servicio de mensajería y Usuario. Una vez verificado, este servidor puede enviarle verificación de inicio de sesión y otras notificaciones.<br /><br /><table><tr><td>Servicio<td>"+(t+="</select>")+"<tr><td>Usuario<td><input maxlength=1024 style=width:160px;margin-left:8px id=d2handleinput onKeyUp=account_manageMessagingValidate() onkeypress=\"if (event.key=='Enter') account_manageMessagingValidate(1)\"></table>",serverinfo.discordUrl&&(e+="<div id=d2discordurl style=display:none><br /><a href="+serverinfo.discordUrl+' target="_discord">Unete a este canal de Discord para recibir notificaciones.</a></div>'),e+='<div id=d2callmebotinfo style=display:none><br /><a href=https://www.callmebot.com/blog/free-api-signal-send-messages/ target="_callmebot">Signal</a>, <a href=https://www.callmebot.com/blog/free-api-whatsapp-messages/ target="_callmebot">Whatsapp</a>, <a href=https://www.callmebot.com/blog/free-api-facebook-messenger/ target="_callmebot">Facebook</a>, <a href=https://www.callmebot.com/blog/telegram-text-messages/ target="_callmebot">Telegram</a></div><div id=d2pushoverinfo style=display:none><br /><a href=https://pushover.net/ target="_pushover">Informacion en Pushover.net</a></div>',console.log(serverinfo.userMsgNftyUrl),e+='<div id=d2ntfyinfo style=display:none><br /><a href="'+(serverinfo.userMsgNftyUrl||"https://ntfy.sh/")+'" target="_ntfy">Servicio gratuito en ntfy.sh</a></div>',xxdialogTag="VerifyMessaging",setModalContent("xxAddAgent","Notificaciones de Mensajería",e+='<div id=d2slackinfo style=display:none><br /><a href=https://api.slack.com/messaging/webhooks target="_slack">Slack Webhook Setup</a></div>'),showModal("xxAddAgentModal","idx_dlgOkButton",account_manageMessagingAdd()),Q("d2handleinput").focus(),account_manageMessagingValidate))()}function account_manageMessagingValidate(e){serverinfo.discordUrl&&QV("d2discordurl",4==Q("d2serviceselect").value),QV("d2callmebotinfo",16==Q("d2serviceselect").value),QV("d2pushoverinfo",32==Q("d2serviceselect").value),QV("d2ntfyinfo",64==Q("d2serviceselect").value),QV("d2slackinfo",256==Q("d2serviceselect").value),4==Q("d2serviceselect").value?Q("d2handleinput").placeholder="Usuario:0000":8==Q("d2serviceselect").value?Q("d2handleinput").placeholder="nombredeusuario@servidor.com":16==Q("d2serviceselect").value?Q("d2handleinput").placeholder="https://api.callmebot.com/...":32==Q("d2serviceselect").value?Q("d2handleinput").placeholder="Clave de usuario":64==Q("d2serviceselect").value?Q("d2handleinput").placeholder="Tema":128==Q("d2serviceselect").value?Q("d2handleinput").placeholder="nombredeusuario@ejemplo.com":256==Q("d2serviceselect").value?Q("d2handleinput").placeholder="https://hooks.slack.com/...":Q("d2handleinput").placeholder="Nombre de Usuario";var t=0<Q("d2handleinput").value.length;QE("idx_dlgOkButton",t),1==e&&t&&dialogclose(1)}function account_manageMessagingAdd(){0!=Q("d2handleinput").value.length&&(QE("d2handleinput",!1),meshserver.send({action:"verifyMessaging",service:Q("d2serviceselect").value,handle:Q("d2handleinput").value}))}function account_manageMessagingConfirm(e,t){meshserver.send({action:"confirmMessaging",code:Q("d2phoneCodeInput").value,cookie:t})}function account_manageMessagingRemove(){Q("d2delPhone").checked&&meshserver.send({action:"removeMessaging"})}function account_manageAuthEmail(){var e;xxdialogMode||0==(8388608&features)||(setModalContent("xxAddAgent","Autenticación de Correo Electrónico",'Cuando esté habilitado, en cada inicio de sesión, se le dará la opción de recibir un token de inicio de sesión en su cuenta de correo electrónico para mayor seguridad.<br /><br /><label><input id=email2facheck type=checkbox class="form-check-input me-2" '+((e=1==userinfo.otpekey&&null!=userinfo.email&&1==userinfo.emailVerified)?"checked":"")+"/>Habilitar autenticación de dos factores por correo electrónico.</label>"),showModal("xxAddAgentModal","idx_dlgOkButton",function(){e!=Q("email2facheck").checked&&meshserver.send({action:"otpemail",enabled:Q("email2facheck").checked})}))}function account_manageAuthDuo(){xxdialogMode||0==(536870912&features2)||(0==(1==userinfo.otpduo)?(setModalContent("xxAddAgent","Duo Authentication",'Confirm enabling of Duo 2FA login security. Once enabled you will be given the option to use Duo at login for added security. Click ok to go thru the steps to enable Duo.<p style="text-align:center;margin-top:10px"><img src="images/duo-2fa-250.png"></p>'),showModal("xxAddAgentModal","idx_dlgOkButton",function(){window.location.href="/add-duo?rurl="+encodeURIComponentEx(window.location.href)+(urlargs.key?"&key="+urlargs.key:"")})):(setModalContent("xxAddAgent","Duo Authentication",'<p><label><input id=duo2facheck type=checkbox onclick=account_manageAuthDuoConfirm() /> Confirm disabling 2FA Duo login security.</label></p><p style="text-align: center"><img src="images/duo-2fa-250-disable.png"></p>'),showModal("xxAddAgentModal","idx_dlgOkButton",function(){meshserver.send({action:"otpduo",enabled:!1})}),QE("idx_dlgOkButton",!1)))}function account_manageAuthDuoConfirm(){QE("idx_dlgOkButton",Q("duo2facheck").checked)}function account_manageAuthApp(){if(!xxdialogMode&&0!=(4096&features))return(1==userinfo.otpsecret?account_removeOtp:account_addOtp)(),!1}function account_addOtp(){xxdialogMode||1==userinfo.otpsecret||0==(4096&features)||(xxdialogTag="otpauth-request",setModalContent("xxAddAgent","Aplicación de Autenticación","<div id=d2optinfo>Cargando...</div>"),showModal("xxAddAgentModal","idx_dlgOkButton",function(){meshserver.send({action:"otpauth-setup",secret:Q("d2optsecret").attributes.secret.value,token:Q("d2otpauthinput").value})}),meshserver.send({action:"otpauth-request"}))}function account_addOtpCheck(e){var t=6==Q("d2otpauthinput").value.length;QE("idx_dlgOkButton",t),e&&13==e.keyCode&&t&&dialogclose(1)}function account_removeOtp(){xxdialogMode||1!=userinfo.otpsecret||0==(4096&features)||(setModalContent("xxAddAgent","Aplicación de Autenticación","¿Confirmar la eliminación del inicio de sesión usando autenticación de 2 pasos?"),showModal("xxAddAgentModal","idx_dlgOkButton",function(){meshserver.send({action:"otpauth-clear"})}))}function account_manageOtp(e){return 2==xxdialogMode&&"otpauth-manage"==xxdialogTag&&dialogclose(0),xxdialogMode||0==(4096&features)||0<count2factoraAuths()&&meshserver.send({action:"otpauth-getpasswords",subaction:e}),!1}function account_managePushAuthDev(){if(!xxdialogMode&&0!=(64&features2)){if(1==userinfo.otpdev)setModalContent("xxAddAgent","Dispositivo de Autenticación","¿Confirmar la eliminación del dispositivo de autenticación push?"),showModal("xxAddAgentModal","idx_dlgOkButton",function(){meshserver.send({action:"otpdev-clear"})});else{var e=[];for(o in nodes){var t=nodes[o];null!=t.agent&&14==t.agent.id&&1==t.pmt&&4294967295==GetNodeRights(t)&&e.push(t)}if(0==e.length)setModalContent("xxAddAgent","Dispositivo de Autenticación","In order to use push notification authentication, a mobile device must be setup in your account with full rights."),showModal("xxAddAgentModal","idx_dlgOkButton");else{var o,n="Selecciona un dispositivo para registrarse para la autenticación de notificaciones push. Una vez seleccionado, el dispositivo solicitará confirmación.<br /><br />",i='<select id=d2devselect class="form-select">';for(o in e)i+='<option value="'+e[o]._id+'">'+EscapeHtml(e[o].name)+"</option>";setModalContent("xxAddAgent","Dispositivo de Autenticación",n+=addHtmlFormFloating("Dispositivo",i+="</select>")),showModal("xxAddAgentModal","idx_dlgOkButton",function(){meshserver.send({action:"otpdev-set",nodeid:Q("d2devselect").value})})}}return!1}}function account_manageHardwareOtp(){return 2==xxdialogMode&&"otpauth-hardware-manage"==xxdialogTag&&dialogclose(0),xxdialogMode||0==(4096&features)||meshserver.send({action:"otp-hkey-get"}),!1}function account_addhkey(e){var t;3==e?(t="Escribe el nombre de la clave para agregar.<br /><br />",t+=addHtmlFormFloating("Nombre de la Llave",'<input id=dp1keyname class="form-control" maxlength=20 autocomplete=off placeholder="Mi Llave" onkeyup=account_addhkeyValidate(event,2) />')):2==e&&(t="Escribe la clave, selecciona el cuadro OTP y presiona el botón en YubiKey&trade;.<br /><br />",t=(t+=addHtmlFormFloating("Nombre de la Llave",'<input id=dp1keyname class="form-control" maxlength=20 autocomplete=off placeholder="Mi Llave" onkeyup=account_addhkeyValidate(event,1) />'))+addHtmlFormFloating("YubiKey&trade; OTP",'<input id=dp1key class="form-control" autocomplete=off onkeyup=account_addhkeyValidate(event,2) />')),setModalContent("xxAddAgent","Agregar Llave de Seguridad",t),showModal("xxAddAgentModal","idx_dlgOkButton",()=>account_addhkeyEx(3,e)),Q("dp1keyname").focus()}function account_addhkeyValidate(e,t){null!=e&&13==e.keyCode&&(2==t?dialogclose(1):Q("dp1key").focus())}function account_addhkeyEx(e,t){var o=Q("dp1keyname").value;""==o&&(o="MyKey"),2==t?(meshserver.send({action:"otp-hkey-yubikey-add",name:o,otp:Q("dp1key").value}),xxdialogTag="otpauth-hardware-manage",setModalContent("xxAddAgent","Agregar Llave de Seguridad","<br />Comprobando...<br /><br /><br />"),showModal("xxAddAgentModal","idx_dlgOkButton")):3==t&&meshserver.send({action:"webauthn-startregister",name:o})}function account_removehkey(e){meshserver.send({action:"otp-hkey-remove",index:e}),meshserver.send({action:"otp-hkey-get"})}var currentMesh,filetreelinkpath,loclist={af:"Afrikaans",sq:"Albanés",ar:"Árabe (estándar)","ar-dz":"Árabe (Algeria)","ar-bh":"Árabe (Bahrain)","ar-eg":"Arabe (Egipto)","ar-iq":"Arabe (Irak)","ar-jo":"Árabe (Jordania)","ar-kw":"Árabe (Kuwait)","ar-lb":"Árabe (Líbano)","ar-ly":"Árabe (Libia)","ar-ma":"Árabe (Marruecos)","ar-om":"Árabe (Omán)","ar-qa":"Árabe (Qatar)","ar-sa":"Árabe (Arabia Saudita)","ar-sy":"Árabe (Siria)","ar-tn":"Árabe (Túnez)","ar-ae":"Árabe (U.A.E.)","ar-ye":"Árabe (Yemen)",an:"Aragonés",hy:"Armenio",as:"Asamés",ast:"Asturiano",az:"Azerbaiyano",eu:"Vasco",bg:"Búlgaro",be:"Bielorruso",bn:"Bengalí",bs:"Bosnio",br:"Bretón",my:"Birmano",ca:"Catalan",ch:"Chamorro",ce:"Checheno",zh:"Chino","zh-hk":"Chino (Hong Kong)","zh-cn":"Chino (PRC)","zh-sg":"Chino (Singapur)","zh-tw":"Chino (Taiwán)",cv:"Chuvash",co:"Corso",cr:"Cree",hr:"Croata",cs:"Checo",da:"Danés",nl:"Holandés (estándar)","nl-be":"Holandés (belga)",en:"Inglés","en-au":"Inglés (Australia)","en-bz":"Inglés (belice)","en-ca":"Inglés (Canadá)","en-ie":"Inglés (Irlanda)","en-jm":"Inglés (Jamaica)","en-nz":"Inglés (Nueva Zelanda)","en-ph":"Inglés (Filipinas)","en-za":"Inglés (Sudáfrica)","en-tt":"Inglés (Trinidad y Tobago)","en-gb":"Inglés (Reino Unido)","en-us":"Inglés (Estados Unidos)","en-zw":"Inglés (Zimbabwe)",eo:"Esperanto",et:"Estonio",fo:"Faeroese",fa:"Farsi (Persa)",fj:"Fiyiano",fi:"Finlandés",fr:"Francés (estándar)","fr-be":"Francés (Bélgica)","fr-ca":"Francés (Canadá)","fr-fr":"Francés (Francia)","fr-lu":"Francés (Luxemburgo)","fr-mc":"Francés (Mónaco)","fr-ch":"Francés (Suiza)",fy:"Friso",fur:"Friuliano",gd:"Gaélico (Escocés)","gd-ie":"Gaélico (Irlandés)",gl:"Gallego",ka:"Georgiano",de:"Alemán (Estándar)","de-at":"Alemán (Austria)","de-de":"Alemán (Alemania)","de-li":"Alemán (Liechtenstein)","de-lu":"Alemán (Luxemburgo)","de-ch":"Alemán (Suiza)",el:"Griego",gu:"Gujarati",ht:"Haitiano",he:"Hebreo",hi:"Hindi",hu:"Hungaro",is:"Islandés",id:"Indonesio",iu:"Inuktitut",ga:"Irlandesa",it:"Italiano (estándar)","it-ch":"Italiano (Suiza)",ja:"Japones",kn:"Kannada",ks:"Cachemira",kk:"Kazajo",km:"Jemer",ky:"Kirghiz",tlh:"Klingon",ko:"Coreano","ko-kp":"Coreano (Corea del Norte)","ko-kr":"Coreano (Corea del Sur)",la:"Latin",lv:"Letona",lt:"Lituano",lb:"Luxemburgués",mk:"Macedonio Macedonia",ms:"Malayo",ml:"Malayalam",mt:"Maltés",mi:"Maori",mr:"Marathi",mo:"Moldavo",nv:"Navajo",ng:"Ndonga",ne:"Nepali",no:"Noruego",nb:"Noruego (Bokmal)",nn:"Noruego (Nynorsk)",oc:"Occitano",or:"Oriya",om:"Oromo","fa-ir":"Persa / Irán",pl:"Polaco",pt:"Portugues","pt-br":"Portugues (Brazil)",pa:"Punjabi","pa-in":"Punjabi (India)","pa-pk":"Punjabi (Pakistan)",qu:"Quechua",rm:"Retorrománico",ro:"Rumano","ro-mo":"Rumano (Moldavia)",ru:"Ruso","ru-mo":"Ruso (Moldavia)",sz:"Sami (Lapona)",sg:"Sango",sa:"Sánscrito",sc:"Sardo",sd:"Sindhi",si:"Cingalés",sr:"Serbio",sk:"Eslovaco",sl:"Esloveno",so:"Somani",sb:"Sorbio",es:"Español","es-ar":"Español (Argentina)","es-bo":"Español (Bolivia)","es-cl":"Español (Chile)","es-co":"Español (Colombia)","es-cr":"Español (Costa Rica)","es-do":"Español (República Dominicana)","es-ec":"Español (Ecuador)","es-sv":"Español (El Salvador)","es-gt":"Español (Guatemala)","es-hn":"Español (Honduras)","es-mx":"Español (Mexico)","es-ni":"Español (Nicaragua)","es-pa":"Español (Panama)","es-py":"Español (Paraguay)","es-pe":"Español (Peru)","es-pr":"Español (Puerto Rico)","es-es":"Español (España)","es-uy":"Español (Uruguay)","es-ve":"Español (Venezuela)",sx:"Sutu",sw:"Swahili",sv:"Sueco","sv-fi":"Sueco (Finlandia)","sv-sv":"Sueco (Suecia)",ta:"Tamil",tt:"Tatar",te:"Teluga",th:"Tailandés",tig:"Tigre",ts:"Tsonga",tn:"Tswana",tr:"Turco",tk:"Turcomanos",uk:"Ucraniano",hsb:"Sorbio superior",ur:"Urdu",ve:"Venda",vi:"Vietnamita",vo:"Volapük",wa:"Valón",cy:"Galés",xh:"Xhosa",ji:"Yiddish",zu:"Zulu"},loclistex={"zh-chs":"Chino (simplificado)","zh-cht":"Chino tradicional)"};function account_showLocalizationSettings(){if(!xxdialogMode){var e=getstore("loctag",0),t="",o='<select id=d2locselect class="form-select"><option value="*">Valor del navegador del usuario</option>';for(n in loclist)o+='<option value="'+n+'"'+(e==n?" selected":"")+">"+n+" - "+loclist[n]+"</option>";if(o+="</select>",serverinfo.languages&&0<serverinfo.languages.length){t+="Cambiar el idioma requerirá una actualización de la página.<br /><br />";var n,i='<select id=d2langselect class="form-select"><option value="*">Valor del navegador del usuario</option>';for(n in serverinfo.languages){var a=serverinfo.languages[n];i+='<option value="'+a+'"'+(userinfo.lang==a?" selected":"")+">"+a+" - "+(loclist[a]||loclistex[a])+"</option>"}t+=addHtmlFormFloating("Idioma",i+="</select>")}t+=addHtmlFormFloating("Fecha & Hora",o),4294967295==userinfo.siteadmin&&""==domain&&(t+='<br /><a rel="noreferrer noopener" target="_blank" href="translator.htm">Ayuda a traducir MeshCentral</a>'),setModalContent("xxAddAgent","Opciones de Hora e Idioma",t),showModal("xxAddAgentModal","idx_dlgOkButton",account_showLocalizationSettingsEx)}return!1}function account_showLocalizationSettingsEx(){var e=Q("d2langselect"),e=e?e.value:null,e=((e="*"==e&&null==userinfo.lang?userinfo.lang:e)!=userinfo.lang&&meshserver.send({action:"changelang",lang:e}),getstore("loctag",0)),t=Q("d2locselect").value;e!=t&&("*"!=t?args.locale=t:delete args.locale,putstore("loctag",args.locale),mainUpdate(4294967295))}function account_enableNotifications(){return Notification&&Notification.requestPermission().then(function(e){QV("accountEnableNotificationsSpan","granted"!=e),setupServiceWorker()}),!1}function account_createLoginToken(){if(xxdialogMode)return!1;var e,t="",o="Crea un nombre de usuario y una contraseña temporales que se puedan utilizar como inicio de sesión alternativo a tu cuenta. Esto es útil para permitir que otras herramientas u otros servicios accedan a tu cuenta.<br /><br />",n={0:"Ilimitado",1:"1 minuto",5:"5 minutos",10:"10 minutos",15:"15 minutos",30:"30 minutos",45:"45 minutos",60:"60 minutos",120:"2 horas",240:"4 horas",480:"8 horas",720:"12 horas",960:"16 horas",1440:"24 horas",2880:"2 días",5760:"4 dias",10080:"7 días"};for(e in n)t+="<option value="+e+">"+n[e]+"</option>";setModalContent("xxAddAgent","Crear Token de Inicio de Sesión",o+'<div class="form-floating mb-3">'+'<input type=text class="boxsize form-control" id=d2tokenName maxlength="100" placeholder="Nombre del token" onchange=account_createLoginTokenValidate() onkeyup=account_createLoginTokenValidate()>'+"<label for=d2tokenName>Nombre del token</label>"+"</div>"+addHtmlFormFloating("Tiempo de Expiración",'<select class="boxsize form-select" id=d2tokenExpire>'+t+"</select>")),showModal("xxAddAgentModal","idx_dlgOkButton",account_createLoginTokenEx),QE("idx_dlgOkButton",!1),Q("d2tokenName").focus()}function account_createLoginTokenValidate(){QE("idx_dlgOkButton",0<Q("d2tokenName").value.length)}function account_createLoginTokenEx(){meshserver.send({action:"createLoginToken",name:Q("d2tokenName").value,expire:parseInt(Q("d2tokenExpire").value)})}function account_showAccountNotifySettings(){var e;return xxdialogMode||(setModalContent("xxAddAgent","Opciones de Notificación",'<div class="form-check"><label><input id=p2notifyPlayNotifySound class="form-check-input me-2" type=checkbox />Sonido de notificación</label></div><div class="form-check"><label><input id=p2notifyGroupName class="form-check-input me-2" type=checkbox />Mostrar el nombre del grupo de dispositivos.</label></div><div class="form-check"><label><input id=p2notifyIntelDeviceConnect class="form-check-input me-2" type=checkbox />Conexiones de dispositivo</label></div><div class="form-check"><label><input id=p2notifyIntelDeviceDisconnect class="form-check-input me-2" type=checkbox />Desconexiones de dispositivo</label></div><div class="form-check"><label><input id=p2notifyIntelAmtKvmActions class="form-check-input me-2" type=checkbox />Eventos de escritorio y serial de Intel&reg; AMT</label></div>'),showModal("xxAddAgentModal","idx_dlgOkButton",account_showAccountNotifySettingsEx),e=getstore("notifications",0),Q("p2notifyPlayNotifySound").checked=1&e,Q("p2notifyIntelDeviceConnect").checked=2&e,Q("p2notifyIntelDeviceDisconnect").checked=4&e,Q("p2notifyIntelAmtKvmActions").checked=8&e,Q("p2notifyGroupName").checked=16&e),!1}function account_showAccountNotifySettingsEx(){var e=0;putstore("notifications",(e+=Q("p2notifyPlayNotifySound").checked?1:0)+(Q("p2notifyIntelDeviceConnect").checked?2:0)+(Q("p2notifyIntelDeviceDisconnect").checked?4:0)+(Q("p2notifyIntelAmtKvmActions").checked?8:0)+(Q("p2notifyGroupName").checked?16:0))}function account_showVerifyEmail(){return xxdialogMode||1==userinfo.emailVerified||1!=serverinfo.emailcheck||(setModalContent("xxAddAgent","Verificación de Correo Electrónico","Haz clic en Aceptar para enviar un correo de verificación a:<br /><div style=padding:8px><b>"+EscapeHtml(userinfo.email)+"</b></div>Espera unos minutos para recibir la verificación."),showModal("xxAddAgentModal","idx_dlgOkButton",()=>account_showVerifyEmailEx())),!1}function account_showVerifyEmailEx(){meshserver.send({action:"verifyemail",email:userinfo.email})}function account_showChangeEmail(){return xxdialogMode||(setModalContent("xxAddAgent","Cambio de Dirección de Correo Electrónico",'Cambia la dirección de correo electrónico de su cuenta aquí.<br /><br /><div class="form-floating"><input id=dp2email class="form-control" maxlength=256 onchange=account_validateEmail() onkeyup=account_validateEmail(event) placeholder=Email /> <label for=dp2email>Email</label></div>'),showModal("xxAddAgentModal","idx_dlgOkButton",account_changeEmail),null!=userinfo.email&&(Q("dp2email").value=userinfo.email),account_validateEmail(),Q("dp2email").focus()),!1}function account_validateEmail(e,t){QE("idx_dlgOkButton",validateEmail(Q("dp2email").value)&&Q("dp2email").value!=userinfo.email),null!=e&&13==e.keyCode&&dialogclose(1)}function account_changeEmail(){meshserver.send({action:"changeemail",email:Q("dp2email").value})}function account_showDeleteAccount(){return xxdialogMode||(setModalContent("xxAddAgent","Eliminar Cuenta","Para eliminar esta cuenta, escribe la contraseña de la cuenta en los dos cuadros a continuación y presiona Aceptar.<br /><br />"+"<form method=post>"+"<input type=hidden name=action value=deleteaccount />"+('<input type=hidden name=authcookie value="'+authCookie+'" />')+'<div class="container">'+'<div class="form-floating mb-2">'+'<input type=password class="form-control" id=apassword1 name=apassword1 autocomplete=off placeholder="Password" onchange=account_validateDeleteAccount() onkeyup=account_validateDeleteAccount()>'+'<label for="apassword1">Password</label>'+"</div>"+'<div class="form-floating mb-3">'+'<input type=password class="form-control" id=apassword2 name=apassword2 autocomplete=off placeholder="Confirm Password" onchange=account_validateDeleteAccount() onkeyup=account_validateDeleteAccount()>'+"<label for=apassword2>Confirm Password</label>"+"</div>"+"</div>"+"</form>"),showModal("xxAddAgentModal","idx_dlgOkButton",function(){dialogclose(1)}),account_validateDeleteAccount(),Q("apassword1").focus()),!1}function account_showChangePassword(){if(!xxdialogMode){var e="Cambia la contraseña de tu cuenta ingresando la contraseña anterior y la contraseña nueva dos veces en los siguientes cuadros.",e=(e=(e=(e=(e=(e=(e=(e+="<br /><br />")+'<div class="container">'+'<div class="form-floating mb-2">')+'<input type=password class="form-control" id=apassword0 name=apassword0 autocomplete=off placeholder="Old password" onchange=account_validateNewPassword() onkeyup=account_validateNewPassword() onkeydown=account_validateNewPassword()>'+"<label for=apassword0>Old password</label>")+"</div>"+'<div class="form-floating mb-2">')+'<input type=password class="form-control" id=apassword1 name=apassword1 autocomplete=off placeholder="New password" onchange=account_validateNewPassword() onkeyup=account_validateNewPassword() onkeydown=account_validateNewPassword()>'+"<label for=apassword1>New password</label>")+"<b><span id=dxPassWarn></span></b>"+"</div>")+'<div class="form-floating mb-2">'+'<input type=password class="form-control" id=apassword2 name=apassword2 autocomplete=off placeholder="Confirm new password" onchange=account_validateNewPassword() onkeyup=account_validateNewPassword() onkeydown=account_validateNewPassword()>')+"<label for=apassword2>Confirm new password</label>"+"</div>";if(65536&features&&(e+='<div class="form-floating mb-2"><input type=text class="form-control" id=apasswordhint name=apasswordhint maxlength=250 autocomplete=off onchange=account_validateNewPassword() onkeyup=account_validateNewPassword() onkeydown=account_validateNewPassword()><label for=apasswordhint>Password hint</label></div>'),e+="</div>",passRequirements){var t,o=[],n=0;for(t in passRequirements)"reset"!=t&&"hint"!=t&&(o.push(t+":"+passRequirements[t]),n++);0<n&&(e+="<br /><span style=font-size:x-small>Requerimientos: "+o.join(", ")+".</span>")}setModalContent("xxAddAgent","Cambiar Contraseña",e+="<br />"),showModal("xxAddAgentModal","idx_dlgOkButton",account_showChangePasswordEx),Q("apassword0").focus(),account_validateNewPassword()}return!1}function account_showChangePasswordEx(){var e;Q("apassword1").value==Q("apassword2").value&&(e={action:"changepassword",oldpass:Q("apassword0").value,newpass:Q("apassword1").value},65536&features&&(e.hint=Q("apasswordhint").value),meshserver.send(e))}function account_showThemesSwitcher(){var o,e,n,i;return xxdialogMode||(o=getstore("theme")||"default",e=JSON.parse(getstore("lastThemes")||"[]"),n=new Set(e),i='<div class="form-group"><label for="theme-switcher">Select a theme:</label>',i+='<select id="theme-switcher" class="form-select" onchange="account_switchThemeEx()">',0<e.length&&(i+='<optgroup label="Recent Themes"">',e.forEach(function(e){i+=`<option value="${e}"${e===o?" selected":""}>${e.charAt(0).toUpperCase()+e.slice(1)}</option>`}),i+="</optgroup>"),i+='<optgroup label="All Themes">',[{value:"default",label:"Por Defecto"},{value:"cerulean",label:"Cerulean"},{value:"cosmo",label:"Cosmo"},{value:"cyborg",label:"Cyborg"},{value:"darkly",label:"Darkly"},{value:"flatly",label:"Flatly"},{value:"journal",label:"Journal"},{value:"litera",label:"Litera"},{value:"lumen",label:"Lumen"},{value:"lux",label:"Lux"},{value:"materia",label:"Materia"},{value:"minty",label:"Minty"},{value:"morph",label:"Morph"},{value:"pulse",label:"Pulse"},{value:"sandstone",label:"Sandstone"},{value:"simplex",label:"Simplex"},{value:"sketchy",label:"Sketchy"},{value:"solar",label:"Solar"},{value:"spacelab",label:"Spacelab"},{value:"united",label:"United"},{value:"vapor",label:"Vapor"},{value:"yeti",label:"Yeti"},{value:"zephyr",label:"Zephyr"}].forEach(function(e){var t;n.has(e.value)||(t=e.value===o?" selected":"",i+=`<option value="${e.value}"${t}>${e.label}</option>`)}),setModalContent("xxAddAgent","Switch theme",i=i+"</optgroup>"+"</select></div>"),showModal("xxAddAgentModal","idx_dlgOkButton")),!1}function account_switchThemeEx(){let e=document.getElementById("theme-switcher"),t=e.value;var o="default"!=t?encodeURIComponent(t):encodeURIComponent(".."),o=(document.getElementById("theme-stylesheet").href=`styles/themes/${o}/bootstrap-min.css`,putstore("theme",t),JSON.parse(getstore("lastThemes")||"[]"));(o.includes(t)?o=o.filter(e=>e!==t):(4<=o.length&&o.pop(),o)).unshift(t),putstore("lastThemes",JSON.stringify(o))}function account_createMesh(){if(4294967295!=userinfo.siteadmin&&0!=(64&userinfo.siteadmin))setModalContent("xxAddAgent","Nuevo Grupo de Dispositivos","This account does not have the rights to create a new device group."),showModal("xxAddAgentModal","idx_dlgOkButton");else if(!0!==userinfo.emailVerified&&1==serverinfo.emailcheck&&4294967295!=userinfo.siteadmin)setModalContent("xxAddAgent","Seguridad de la Cuenta",'Unable to access this feature until a email address is verified. This is required for password recovery. Go to the "My Account" tab to change and verify an email address.'),showModal("xxAddAgentModal","idx_dlgOkButton");else if(262144&features&&0==count2factoraAuths())setModalContent("xxAddAgent","Seguridad de la Cuenta",'Unable to access this feature until two-factor authentication is enabled. This is required for extra security. Go to the "My Account" tab and look at the "Account Security" section.'),showModal("xxAddAgentModal","idx_dlgOkButton");else{var e=[];if(0==(2&features))for(var t in nodes){var o=nodes[t];2==o.mtype&&null!=o.agent&&4294967295==GetNodeRights(o)&&e.push(o)}var n="Crear un nuevo grupo de dispositivos utilizando las siguientes opciones.<br /><br />",i="";if(n+=addHtmlFormFloating("Nombre",'<input id=dp2meshname maxlength=128 placeholder="Name" class=form-control onchange=account_validateMeshCreate() onkeyup=account_validateMeshCreate(event,1) />'),0==(1&features)&&(i+="<option value=3>Dispositivos locales, sin agente</option>"),0==(2&features)&&0<e.length&&(i+="<option value=103>No hay dispositivos de agente retransmitidos a través del agente</option>"),65536&features2&&(0==(1&features)&&(i+="<option value=4>IP-KVM / Dispositivo de alimentación</option>"),0==(2&features))&&0<e.length&&(i+="<option value=104>IP-KVM / Dispositivo de alimentación retransmitido a través de un agente</option>"),n+=addHtmlFormFloating("Tipo","<select id=dp2meshtype class=form-select onchange=account_validateMeshCreate() onkeyup=account_validateMeshCreate(event,2) ><option value=2>Administrar usando un agente de software</option><option value=1>Sólo Intel&reg; AMT, sin agente</option>"+i+"</select>"),0<e.length){n+="<div id=d2devrelaydiv style=display:none>",e.sort(nameSort);var a=[];for(t in e)a.push('<option value="'+e[t]._id+'">'+EscapeHtml(e[t].name)+"</option>");n=n+addHtmlFormFloating("Dispositivo de Retransmisión","<select id=d2devrelay onchange=account_validateMeshCreate() onkeyup=account_validateMeshCreate(event,2) class=form-select >"+a.join("")+"</select>")+"</div>"}setModalContent("xxAddAgent","Nuevo Grupo de Dispositivos",n=(n=(n=(n=(n=n+addHtmlFormFloating("Descripción","<textarea id=dp2meshdesc maxlength=1024 class=form-control></textarea>")+"<div id=d2ipkvm style=display:none><hr />")+addHtmlFormFloating("Modelo","<select id=dp2ipkvmmodel onchange=account_validateMeshCreate() onkeyup=account_validateMeshCreate(event,2) class=form-select ><option value=1>Raritan Dominio KX III</option><option value=2>Interruptor de encendido web 7</option></select>"))+addHtmlFormFloating("Nombre de Host",'<input id=dp2ipkvmhost maxlength=128 placeholder="Hostname" onchange=account_validateMeshCreate() onkeyup=account_validateMeshCreate(event,1) class=form-control />'))+addHtmlFormFloating("Nombre de Usuario",'<input id=dp2ipkvmuser maxlength=128 placeholder="Username" onchange=account_validateMeshCreate() onkeyup=account_validateMeshCreate(event,1) class=form-control />'))+addHtmlFormFloating("Contraseña",'<input id=dp2ipkvmpass type=password placeholder="Password" maxlength=128 onchange=account_validateMeshCreate() onkeyup=account_validateMeshCreate(event,1) class="form-control" />')+"</div>"),showModal("xxAddAgentModal","idx_dlgOkButton",account_createMeshEx),account_validateMeshCreate(),document.getElementById("dp2meshname").focus()}return!1}function account_validateMeshCreate(e,t){var o=parseInt(Q("dp2meshtype").value),t=(1==t&&null!=e&&"Enter"==e.key&&0<Q("dp2meshname").value.length&&Q("dp2meshtype").focus(),2==t&&null!=e&&"Enter"==e.key&&Q("dp2meshdesc").focus(),0<Q("dp2meshname").value.length);QV("d2ipkvm",4==o||104==o);try{QV("d2devrelaydiv",100<o)}catch(e){}4==o&&0==Q("dp2ipkvmhost").value.length&&0==Q("dp2ipkvmuser").value.length&&0==Q("dp2ipkvmpass").value.length&&(t=!1),QE("idx_dlgOkButton",t)}function account_createMeshEx(e,t){var o=parseInt(Q("dp2meshtype").value),n={action:"createmesh",meshname:Q("dp2meshname").value,meshtype:o,desc:Q("dp2meshdesc").value};4!=o&&104!=o||(n.kvmmodel=parseInt(Q("dp2ipkvmmodel").value),n.kvmhost=Q("dp2ipkvmhost").value,n.kvmuser=Q("dp2ipkvmuser").value,n.kvmpass=Q("dp2ipkvmpass").value),100<o&&(n.meshtype=o-100,n.relayid=Q("d2devrelay").value),meshserver.send(n)}function account_validateDeleteAccount(){QE("account_dlgOkButton",0<Q("apassword1").value.length&&Q("apassword1").value==Q("apassword2").value)}function account_validateNewPassword(){var e,t="",o=0<Q("apassword0").value.length&&0<Q("apassword1").value.length&&Q("apassword1").value==Q("apassword2").value&&Q("apassword0").value!=Q("apassword1").value;65536&features&&Q("apasswordhint").value==Q("apassword1").value&&(o=!1),""!=Q("apassword1").value&&(null==passRequirements||""==passRequirements?t=80<=(e=checkPasswordStrength(Q("apassword1").value))?"<span style=color:green>Fuerte<span>":60<=e?"<span style=color:blue>Bueno<span>":"<span style=color:red>Débil<span>":0==checkPasswordRequirements(Q("apassword1").value,passRequirements)&&(o=!1,t="<span style=color:red>Política<span>")),QH("dxPassWarn",t),QE("idx_dlgOkButton",o)}function checkPasswordStrength(e){var t=0,o={},n=0,i={digits:/\d/.test(e),lower:/[a-z]/.test(e),upper:/[A-Z]/.test(e),nonWords:/\W/.test(e)};if(!e)return 0;for(var a,s=0;s<e.length;s++)o[e[s]]=(o[e[s]]||0)+1,t+=5/o[e[s]];for(a in i)n+=1==i[a]?1:0;return parseInt(t+10*(n-1))}function checkPasswordRequirements(e,t){if(null==t||""==t||"object"!=typeof t)return!0;if(t.min&&e.length<t.min)return!1;if(t.max&&e.length>t.max)return!1;for(var o=0,n=0,i=0,a=0,s=0;s<e.length;s++)/\d/.test(e[s])&&o++,/[a-z]/.test(e[s])&&n++,/[A-Z]/.test(e[s])&&i++,/\W/.test(e[s])&&a++;return!(t.numeric&&o<t.numeric||t.lower&&n<t.lower||t.upper&&i<t.upper||t.nonalpha&&a<t.nonalpha)}function updateMeshes(){var e='<div class="row">',t=0,o=0,n=[];for(i in meshes)n.push(meshes[i]);for(i in n.sort(nameSort),n){1<t&&(e+="</tr><tr>",t=0),t++,o++;var a=GetMeshRights(n[i]),s="Permisos Parciales";4294967295==a?s="Administrador Total":0==a&&(s="Sin Permisos"),e+=`
                    <div class="col-sm-12 col-md-6 col-lg-4 col-xl-3 mb-2"
                            onclick="gotoMesh('`+n[i]._id+`')"
                            onkeypress="if (event.key=='Enter') gotoMesh('`+n[i]._id+`')"
                            style="cursor:pointer;">
                        <div class="card mb-3">
                            <div class="row g-0">
                                <div class="col-2 parent" style="display: flex; justify-content: center; align-items: center;">
                                    <i class="mi me-1"></i>
                                </div>
                                <div class="col-10 mx-auto" tabindex="0">
                                    <div class="card-body" style=padding:0;>
                                        <h5 class="card-title e1">`+EscapeHtml(n[i].name)+`</h5>
                                        <p class="card-text">`+s+`</p>
                                        <div class="g2"></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    `}e+="</div>",meshcount=o,QH("p2meshes",e),QV("p2noMeshFound",0==o)}function updateLoginTokens(){var e="",t=1;if(null!=loginTokens&&0<loginTokens.length){for(var e=e+'<p><strong>Tokens de inicio de sesión activos</strong> - <span id="p2createMeshLink1"> <button class="btn btn-primary btn-sm" onclick="return account_createLoginToken()"><i class="fa-fw fa-solid fa-circle-plus"></i> Nuevo</button></span></p>'+'<div style=margin-left:40px><table class="table table-hover table-striped"><tbody><tr class="table-active"><th scope=col style=text-align:left;width:430px>Nombre</th><th scope=col style=text-align:left>Nombre de Usuario</th></tr>',o=0;o<loginTokens.length;o++){var n=loginTokens[o],i="<a href=# onclick='return p2removeLoginToken(event,\""+encodeURIComponentEx(n.tokenUser)+'")\' title="Quitar el token de inicio de sesión" role=button><i class="fa-solid fa-trash text-danger fa-xs"></i></a>',a="";0!=n.expire&&(a=EscapeHtml(format("Caduca el {0}",printDateTime(new Date(n.expire))))+" "),e+="<tr "+(++t%2==0?"style=background-color:#DDD":"")+'><td style=width:30%><i class="fa-fw fa-solid fa-user"></i>&nbsp;'+EscapeHtml(n.name)+"<div></div></div></td><td style=width:70%><div style=float:right>"+a+i+"</div><div>"+EscapeHtml(n.tokenUser)+"</div></td></tr>"}e+="</tbody></table></div><br />",QV("accountCreateLoginTokenSpan",!1)}else QV("accountCreateLoginTokenSpan",128&features2);QH("p2logintokens",e)}function p2removeLoginToken(e,t){if(t=decodeURIComponent(t),null!=loginTokens){for(var o,n=null,i=0;i<loginTokens.length;i++)loginTokens[i].tokenUser==t&&(n=loginTokens[i]);null!=n&&(o="¿Confirmar la eliminación de este token de inicio de sesión?<br /><br />",setModalContent("xxAddAgent","Eliminar Token de Inicio de Sesión",o=(o+=addHtmlValue("Nombre",EscapeHtml(n.name)))+addHtmlValue("Nombre de Usuario",EscapeHtml(n.tokenUser))),showModal("xxAddAgentModal","idx_dlgOkButton",()=>function(e,t){meshserver.send({action:"loginTokens",remove:[t]})}))}}function gotoMesh(e){return currentMesh=meshes[e],p20updateMesh(),go(20),!1}function server_setupGoogleDriveBackup(){if(xxdialogMode||null==miscState.googleDrive)return!1;var e,t=miscState.googleDrive;t.state<3?(e='<img style=float:right src="images/googledrive-48.png" /><div>Configura este servidor para que automáticamente cargue las copias de seguridad a Google Drive. Empieza creando e ingresando un ID de Cliente de Google Drive y un Secreto de Cliente para tu cuenta.</div><br />',setModalContent("xxAddAgent","Resguardo en Google Drive",e=(e=(e+=addHtmlValue("Credenciales",'<a href="https://console.developers.google.com/apis/api/drive.googleapis.com/credentials" rel="noreferrer noopener" target="_blank">Consola de Google Drive</a>'))+addHtmlFormFloating("ID del Cliente",'<input id=gdclientid class="form-control" placeholder="xxxxxxxx.apps.googleusercontent.com" onkeyup=server_setupGoogleDriveBackupCheck1()></input>'))+addHtmlFormFloating("Secreto del Cliente",'<input id=gdclientsecret class="form-control" onkeyup=server_setupGoogleDriveBackupCheck1()></input>')),showModal("xxAddAgentModal","idx_dlgOkButton",()=>server_setupGoogleDriveBackupEx(3,"gd1")),Q("gdclientid").focus(),QE("idx_dlgOkButton",!1)):3==t.state&&(e='<img style=float:right src="images/googledrive-48.png" /><div>El resguardo en Google Drive está actualmente activo.</div>',setModalContent("xxAddAgent","Resguardo en Google Drive",e+='<br /><label><input id=gdcheck type=checkbox class="form-check-input me-2" onchange=server_setupGoogleDriveBackupCheck2() />Remover Configuración</label>'),showModal("xxAddAgentModal","idx_dlgOkButton",()=>server_setupGoogleDriveBackupEx(3,"gd0")),QE("idx_dlgOkButton",!1))}function server_setupGoogleDriveBackupCheck1(){QE("idx_dlgOkButton",0<Q("gdclientid").value.length&&0<Q("gdclientsecret").value.length)}function server_setupGoogleDriveBackupCheck2(){QE("idx_dlgOkButton",Q("gdcheck").checked)}function server_setupGoogleDriveBackupCheck3(){QE("idx_dlgOkButton",0<Q("gdcode").value.length)}function server_setupGoogleDriveBackupEx(e,t){"gd0"==t&&meshserver.send({action:"serverBackup",service:"googleDrive",state:0}),"gd1"==t&&meshserver.send({action:"serverBackup",service:"googleDrive",state:1,clientid:Q("gdclientid").value,clientsecret:Q("gdclientsecret").value}),"gd2"==t&&meshserver.send({action:"serverBackup",service:"googleDrive",state:2,code:Q("gdcode").value})}function server_showRestoreDlg(){var e;return xxdialogMode||(e="Restaura el servidor utilizando una copia de seguridad, <span style=color:red>esto eliminará los datos del servidor existentes.</span> Sólo haz esto si sabes lo que estás haciendo.<br /><br />",setModalContent("xxAddAgent","Restaurar Servidor",e=(e=(e+='<form action="/restoreserver.ashx'+(urlargs.key?"?key="+urlargs.key:"")+'" enctype="multipart/form-data" method="post"><div>')+("<input type=hidden name=auth value="+authCookie+">"))+'<input id=account_dlgFileInput type=file name=datafile class="form-control" accept=".zip,application/octet-stream,application/zip,application/x-zip,application/x-zip-compressed" onchange=account_validateServerRestore()>'+"</div></form>"),showModal("xxAddAgentModal","idx_dlgOkButton"),account_validateServerRestore()),!1}function account_validateServerRestore(){QE("idx_dlgOkButton",1==Q("account_dlgFileInput").files.length)}function server_showVersionDlg(){return xxdialogMode||(xxdialogMode=2,xxdialogTag="MeshCentralServerUpdate",setModalContent("xxAddAgent","Versión de MeshCentral","Cargando..."),showModal("xxAddAgentModal","idx_dlgOkButton"),meshserver.send({action:"serverversion"})),!1}function server_showVersionDlgUpdate(){var e=Q("d2updateCheck1").checked,t=Q("d2updateCheck2").checked;QE("d2updateCheck1","Desconocido"!=xxdialogTag.stable&&xxdialogTag.current!=xxdialogTag.stable&&0==t),QE("d2updateCheck2","Desconocido"!=xxdialogTag.latest&&xxdialogTag.current!=xxdialogTag.latest&&0==e),QE("idx_dlgOkButton",e&&!t||!e&&t)}function server_showVersionDlgEx(e,t){Q("d2updateCheck1").checked&&meshserver.send({action:"serverupdate",tag:"stable",version:t.stable}),Q("d2updateCheck2").checked&&meshserver.send({action:"serverupdate",tag:"latest",version:t.latest})}function server_showErrorsDlg(){return xxdialogMode||(xxdialogMode=2,xxdialogTag="MeshCentralServerErrors",setModalContent("xxAddAgent","Server Errors","Cargando..."),meshserver.send({action:"servererrors"})),!1}function server_showErrorsDlgUpdate(){QE("idx_dlgOkButton",Q("d2clearErrorsCheck").checked)}function server_showErrorsDlgEx(){meshserver.send({action:"serverclearerrorlog"})}function d2CopyServerErrorsToClip(){saveAs(new Blob([Q("d2ServerErrorsLogPre").innerText],{type:"application/octet-stream"}),"servererrors.txt")}function server_showConfigDlg(){return xxdialogMode||(xxdialogMode=2,xxdialogTag="MeshCentralServerConfig",meshserver.send({action:"serverconfig"})),!1}function d2CopyServerConfigToClip(){saveAs(new Blob([Q("d2ServerConfigPre").innerText],{type:"application/octet-stream"}),"config.json")}function p20updateMesh(){if(null!=currentMesh){var e,t,o=GetMeshRights(currentMesh),n=EscapeHtml(currentMesh.name),i=(0==n.length&&(n="<i>Ninguno</i>"),0!=(1&o)&&(n='<span role=button tabindex=0 title="Haz clic aquí para editar el nombre del grupo de dispositivos" onclick=p20editmesh(1) onkeyup="if (event.key == \'Enter\') p20editmesh(1)">'+n+' <i class="fa-solid fa-pencil fa-2xs"></i></span>'),QH("p20meshName",n),QV("MeshSummary",4!=currentMesh.mtype),format("#{0} desconocido",currentMesh.mtype)),a=(1==currentMesh.mtype&&(i="Sólo Intel&reg; AMT, sin agente"),2==currentMesh.mtype&&(i="Administrado usando un agente de software"),3==currentMesh.mtype&&(i=null==currentMesh.relayid?"Dispositivos locales, sin agente":"No hay dispositivos de agente retransmitidos a través del agente"),4==currentMesh.mtype&&(i=null==currentMesh.relayid?"Dispositivo IP-KVM":"Dispositivo IP-KVM retransmitido a través del agente",1==currentMesh.kvm.model)&&(i+=", Raritan KX III"),"");if(0!=(8&args.hide)&&(a+=addHtmlValue("Nombre",n)),a=(a+=addHtmlValue("Descripción",addLinkConditional(currentMesh.desc&&""!=currentMesh.desc?EscapeHtml(currentMesh.desc):"<i>Ninguno</i>","p20editmesh(2)",0!=(1&o))))+addHtmlValue("Tipo",i),3!=currentMesh.mtype&&4!=currentMesh.mtype||null==currentMesh.relayid||(n="<i>Desconocido</i>",a+=addHtmlValue("Dispositivo de Retransmisión",addLinkConditional(n=null!=(i=getNodeFromId(currentMesh.relayid))?EscapeHtml(i.name):n,"p20editmeshrelay()",0!=(1&o)))),4==currentMesh.mtype&&(a=(a+=addHtmlValue("Nombre de Host",currentMesh.kvm.host))+addHtmlValue("Nombre de Usuario",currentMesh.kvm.user)),null!=currentMesh.creatorid&&null!=users&&null!=users[currentMesh.creatorid]?a+=addHtmlValue("Creado por",'<a href=# onclick=gotoUser("'+encodeURIComponentEx((i=users[currentMesh.creatorid])._id)+'",false,null)>'+EscapeHtml(i.name)+"</a>"):null!=currentMesh.creatorname&&(a+=addHtmlValue("Creado por",EscapeHtml(currentMesh.creatorname))),null!=currentMesh.creation&&(a+=addHtmlValue("Fecha de Creación",printDateTime(new Date(currentMesh.creation)))),3!=currentMesh.mtype&&(e=[],currentMesh.flags&&(1&currentMesh.flags&&e.push("Auto-Remover"),2&currentMesh.flags&&e.push(4==currentMesh.mtype?"Sincronización de nombre de puerto":"Sincronización de Nombre de Host"),1==serverinfo.devGroupSessionRecording)&&4&currentMesh.flags&&e.push("Grabar Sesiones"),"number"==typeof currentMesh.expireDevs&&0<currentMesh.expireDevs&&e.push("Eliminar inactivo"),a+=addHtmlValue("Caracteristicas",addLinkConditional(e=""==(e=e.join(", "))?"<i>Ninguno</i>":e,"p20editmeshfeatures()",1&o))),2==currentMesh.mtype&&(e=[],n=0,currentMesh.consent&&(n=currentMesh.consent),serverinfo.consent&&(n|=serverinfo.consent),64&n&&8&n?e.push("Mensaje de Escritorio + Barra de Herramientas"):64&n?e.push("Barra de Herramientas de Escritorio"):8&n?e.push("Mensaje de Escritorio"):1&n&&e.push("Notificación de Escritorio"),16&n?e.push("Mensaje en Terminal"):2&n&&e.push("Notificación de Terminal"),32&n?e.push("Solicitud de Archivos"):4&n&&e.push("Notificación de Archivos"),7==n&&(e=["Siempre Notificar"]),a+=addHtmlValue("Consentimiento del Usuario",addLinkConditional(e=""==(e=(e=56==(56&n)?["Siempre Preguntar"]:e).join(", "))?"<i>Ninguno</i>":e,"p20editmeshconsent(1)",1&o))),3==currentMesh.mtype||4294967295!=userinfo.siteadmin&&0!=(1024&userinfo.siteadmin)||(i=0,n=[],userinfo.links&&userinfo.links[currentMesh._id]&&userinfo.links[currentMesh._id].notify&&(i|=userinfo.links[currentMesh._id].notify),userinfo.notify&&userinfo.notify[currentMesh._id]&&(i|=userinfo.notify[currentMesh._id]),2&i&&n.push("Conectar"),4&i&&n.push("Desconectar"),8&i&&n.push("Intel&reg; AMT"),16384&features2&&userinfo.emailVerified&&(t=0,16&i&&t++,32&i&&t++,64&i&&t++,0<t)&&n.push(format("Correo Electronico ({0})",t)),null!=userinfo.msghandle&&0!=(33554432&features2)&&(t=0,128&i&&t++,256&i&&t++,512&i&&t++,0<t)&&n.push(format("Mensajería ({0})",t)),0==n.length&&n.push("<i>Ninguno</i>"),a+=addHtmlValue("Notificaciones",addLink(n.join(", "),"p20editMeshNotify()"))),16777216&features&&2==currentMesh.mtype&&(i=!(e="<i>Ninguno</i>"),null!=currentMesh.invite&&(i=!0,e=currentMesh.invite.codes.join(", ")),a+=addHtmlValue("Códigos de Invitación",addLinkConditional(e,"p20editmeshInviteCode()",1&o||i))),currentMesh.mtype<3&&0!=(1&features2)&&(t="Ninguna Política",currentMesh.amt&&(1==currentMesh.amt.type?t="Desactivar":2==currentMesh.amt.type?(t="Modo de Control de Cliente (CCM) simple",2==currentMesh.amt.cirasetup&&(t+=" + CIRA")):3==currentMesh.amt.type?(t="Modo de Control de Administrador (ACM) simple",2==currentMesh.amt.cirasetup&&(t+=" + CIRA")):4==currentMesh.amt.type&&(t="Completamente automatico")),a+=addHtmlValue("Intel&reg; AMT",addLinkConditional(t,"p20editMeshAmt()",1&o))),1&o&&(a+='<br><input type=button class="btn btn-primary btn-sm mb-1" value=Notas title="Ver notas sobre este grupo de dispositivos" onclick=showNotes(false,"'+encodeURIComponentEx(currentMesh._id)+'") />'),a+="<br style=clear:both><br>",2&o&&(a+='<button class="btn btn-primary btn-sm me-2 mb-1" onclick="return p20showAddMeshUserDialog()"><i class="fa-solid fa-circle-plus"></i> Agregar Usuarios</button>',null!=usergroups)){var s=0,r=!1;for(v in usergroups)null==usergroups[v].membershipType&&usergroups[v]._id.split("/")[1]==currentMesh._id.split("/")[1]&&(s++,null==currentMesh.links||null==currentMesh.links[v])&&(r=!0);0<s&&r&&(a+='<button class="btn btn-primary btn-sm me-2 mb-1" onclick="return p20showAddMeshUserDialog(2)"><i class="fa-solid fa-circle-plus"></i> Agregar Grupo de Usuarios</button>')}1==currentMesh.mtype&&(1&o&&(a+='<button class="btn btn-primary btn-sm me-2 mb-1" title="Importar dispositivos Intel&reg; AMT." onclick=\'return showAmtImport("'+currentMesh._id+'")\'><i class="fa-solid fa-circle-arrow-down"></i> Importar</button>'),null!=currentMesh.amt)&&0<currentMesh.amt.type&&(a+='<button class="btn btn-primary btn-sm me-2 mb-1" title="Realizar la activación y configuración de Intel&reg; AMT." onclick=\'return showAmtSetup("'+currentMesh._id+'")\'><i class="fa-solid fa-gear"></i> Preparar</button>'),2!=currentMesh.mtype||4294967295!=userinfo.siteadmin&&0!=(4096&userinfo.siteadmin)||(a=(a+='<button class="btn btn-primary btn-sm me-2 mb-1" onclick=\'return addAgentToMesh("'+currentMesh._id+'")\' title="Agrega una nueva computadora a este grupo de dispositivos instalando el Agente Mesh."><i class="fa-solid fa-circle-plus"></i> Agregar Agente</button>')+'<button class="btn btn-primary btn-sm me-2 mb-1" onclick=\'return inviteAgentToMesh("'+currentMesh._id+'")\' title="Invita a alguien a instalar el Agente Mesh en este grupo de dispositivos."><i class="fa-solid fa-user-plus"></i> Invitar</button>'),3!=currentMesh.mtype||4294967295!=userinfo.siteadmin&&0!=(4096&userinfo.siteadmin)||(a+='<button class="btn btn-primary btn-sm me-2 mb-1" onclick=\'return addLocalDeviceToMesh("'+currentMesh._id+'")\' title="Agrega un dispositivo ubicado en la red local."><i class="fa-solid fa-circle-plus"></i> Agregar Dispositivo</button>'),currentMesh.amt&&2<currentMesh.amt.type&&(4294967295==userinfo.siteadmin||0==(4096&userinfo.siteadmin))&&(a+='<button class="btn btn-primary btn-sm me-2 mb-1" title="Cambiar Intel AMT al Modo de Control de Administrador (ACM)." onclick=\'return showAmtAcmSetup()\'><i class="fa-solid fa-circle-arrow-down"></i> ACM</button>'),a+='<table class="table table-hover table-striped" cellpadding=2 cellspacing=0><tbody><tr><th scope=col>Autorizaciones de Usuario</th><th scope=col></th></tr>';var l=1,d=[];for(v in currentMesh.links){var c=v.split("/")[2];currentMesh.links[v].name&&(c=currentMesh.links[v].name),v==userinfo._id&&(c=userinfo.name),null!=usergroups&&null!=usergroups[v]&&(c=usergroups[v].name),d.push({id:v,name:c,rights:currentMesh.links[v].rights})}for(v in d.sort(function(e,t){return e.name>t.name?1:e.name<t.name?-1:0}),d){var u="",p=makeDeviceGroupRightsString(d[v].rights),m="fa-user",g=(d[v].id==userinfo._id||4294967295!=o&&0==(2&o)||(4294967295!=o&&4294967295==currentMesh.links[d[v].id].rights||(u="<a href=# onclick='return p20deleteUser(event,\""+encodeURIComponentEx(d[v].id)+'")\' title="Remover permisos de usuario de este grupo de dispositivos"><i role=button class="fa-solid fa-trash text-danger fa-fw fa-xs"></i></a>'),p='<span tabindex=0 style=cursor:pointer onclick=p20viewuser("'+encodeURIComponentEx(d[v].id)+"\") onkeypress=\"if (event.key=='Enter') p20viewuser('"+encodeURIComponentEx(d[v].id)+"')\">"+p+' <i class="fa-fw fa-solid fa-pencil fa-xs"></i></span>'),d[v].id.startsWith("ugrp/")&&(m="fa-users"),EscapeHtml(decodeURIComponent(d[v].name)));null!=usergroups&&d[v].id.startsWith("ugrp/")&&(g="<a tabindex=0 href=# onclick='gotoUserGroup(\""+encodeURIComponentEx(d[v].id)+"\");haltEvent(event);'>"+g+"</a>"),a+="<tr style="+(l%2==0?";background-color:#DDD":"")+'><td style=width:30%><div><i title="Usuario" class="fa-solid fa-fw '+m+'"></i>&nbsp;'+(g=null!=users&&d[v].id.startsWith("user/")?"<a tabindex=0 href=# onclick='gotoUser(\""+encodeURIComponentEx(d[v].id)+"\");haltEvent(event);'>"+g+"</a>":g)+"<div></div></div></td><td style=width:70%><div style=float:right>"+u+"</div><div>"+p+"</div></td></tr>",++l}if(a+="</tbody></table>",null!=deviceShares&&deviceSharesNode==currentMesh._id&&0<deviceShares.length){a+='<p></p><table class="table table-hover table-striped" cellpadding=2 cellspacing=0 width=100%><tbody><tr style=background-color:#AAAAAA;font-weight:bold><th scope=col style=text-align:left;width:430px>Compartir dispositivo activo</th><th scope=col style=text-align:left><th scope=col style=text-align:left></th></tr>';for(var l=1,v=0;v<deviceShares.length;v++){var h=deviceShares[v],u="",f=(null!=h.url&&(u+='<a href="'+h.url+'" rel="noreferrer noopener" target=_blank title="Enlace para compartir dispositivo" style=cursor:pointer><img src=images/link2.png border=0 height=10 width=10></a> '),u+="<a href=# onclick='return p30removeDeviceSharing(event,\""+encodeURIComponentEx(h.nodeid)+'","'+encodeURIComponentEx(h.publicid)+'","'+encodeURIComponentEx(h.guestName)+'")\' title="Eliminar dispositivo compartido" style=cursor:pointer><img src=images/trash.png border=0 height=10 width=10></a>',""),x=(h.p<=7?f=["","Terminal","Escritorio","Escritorio + Terminal","Archivos","Terminal + Archivos","Escritorio + Archivos","Escritorio + Terminal + Archivos"][h.p]:8==h.p?f="HTTP/"+h.port:16==h.p&&(f="HTTPS/"+h.port),f),f=(null!=h.startTime&&null!=h.expireTime&&(x=format("{0}, {1} a {2}",f,printFlexDateTime(new Date(h.startTime)),printFlexDateTime(new Date(h.expireTime)))),null!=h.startTime&&null!=h.duration&&(x=h.duration<2?format("{0}, {1} por {2} minuto",f,printFlexDateTime(new Date(h.startTime)),h.duration):format("{0}, {1} durante {2} minutos",f,printFlexDateTime(new Date(h.startTime)),h.duration)),1==h.recurring&&(x+=", Recurrente diariamente"),2==h.recurring&&(x+=", Recurrente semanalmente"),0!=(2&h.p)&&!0===h.viewOnly&&(x+=", Ver solo escritorio"),null!=h.consent&&(0==h.consent?x+=", Sin consentimiento":(0!=(56&h.consent)&&(x+=", Solicitud de consentimiento"),0!=(64&h.consent)&&(x+=", Barra de herramientas"))),EscapeHtml(h.guestName));h.publicid.startsWith("AS:node/")&&(f="<i>Autocompartido del agente</i>"),null!=(b=getNodeFromId(h.nodeid))&&(y=0<b.conn?"":" gray",a+="<tr "+(++l%2==0?"style=background-color:#DDD":"")+"><td style=width:30%>"+("<div onclick='gotoDevice(\""+b._id+'",10);haltEvent(event);\' style=float:left class="j'+b.icon+y+'"></div>&nbsp;<a onclick=\'gotoDevice("'+b._id+"\",10);haltEvent(event);'>"+EscapeHtml(b.name)+"</a>")+"<td style=width:30%><div class=m2></div><div>&nbsp;"+f+"<div></div></div></td><td style=width:70%><div style=float:right>"+u+"</div><div>"+x+"</div></td></tr>")}a+="</tbody></table>"}else deviceSharesNode!=currentMesh._id&&deviceSharesReq!=currentMesh._id&&(deviceSharesReq=currentMesh._id,meshserver.send({action:"deviceMeshShares",meshid:currentMesh._id}));l=0,nodes.sort(deviceSort);var n="",k=(1==currentMesh.mtype&&(n+='<a onclick=meshDownloadDeviceList()><img title="Descargar lista de dispositivos" src="images/link4.png" /></a>',0==(1&features))&&(n+=' <a onclick=meshImportDeviceList()><img title="Importar lista de dispositivos" src="images/link6.png" /></a>'),'<table class="table table-hover table-striped"><tbody><tr class="class="fw-bold"><th>Dispositivos</th><th scope=col class="text-end">'+n+"</th></tr>");for(v in nodes){var b,y=0<(b=nodes[v]).conn?"":" gray";currentMesh._id==b.meshid&&(k+="<tr><td style=width:30%><div onclick='gotoDevice(\""+b._id+'",10);haltEvent(event);\' style=float:left class="j'+b.icon+y+'"></div>&nbsp;<a onclick=\'gotoDevice("'+b._id+"\",10);haltEvent(event);'>"+EscapeHtml(b.name)+"</a></div></div></td><td><div style=float:right>"+PowerStateStr(b.pwr)+"&nbsp;</div><div>"+(b.osdesc?EscapeHtml(b.osdesc):"")+"</div></td></tr>",++l)}0==l&&(k+='<tr><td colspan="2"><i>Ninguno</i></td></tr>'),k+="</tbody></table>",4294967295==o&&(k+="<div style=font-size:small;text-align:right><span><a href=# onclick=p20showDeleteMeshDialog() style=cursor:pointer>Eliminar Grupo de Dispositivos</a></span></div>"),QH("p20info",a),QH("p20info2",k);var w="";if(0==(268435456&features)&&20<=xxcurrentView&&xxcurrentView<=29&&null!=currentMesh){for(var v in w="?viewmode="+xxcurrentView+"&gotomesh="+currentMesh._id.split("/")[2],urlargs)w+="&"+v+"="+urlargs[v];try{window.history.replaceState({},document.title,window.location.pathname+w)}catch(e){}}}}function meshDownloadDeviceList(){if(!xxdialogMode){var e,t={webappversion:"0.9.0",computers:[]};for(e in nodes){var o,n=nodes[e];currentMesh._id==n.meshid&&null!=n.intelamt&&(o={name:n.name,host:n.host,user:n.intelamt.user,pass:"",tls:1==n.intelamt.tls?1:0,ver:n.intelamt.ver,pstate:n.intelamt.state},2==n.intelamt.state&&(o.pmode=1),n.intelamt.realm&&(o.digestrealm=n.intelamt.realm),n.intelamt.hash&&(o.tlscerthash=n.intelamt.hash),t.computers.push(o))}saveAs(stringToUtf8BlobNoHeader(JSON.stringify(t,null,2)),currentMesh.name+".json")}}function meshImportDeviceList(){xxdialogMode||(setModalContent("xxAddAgent","Importar dispositivos Intel&reg; AMT",'Importa una lista local de dispositivos con Intel&reg; AMT en el formato MeshCommander JSON.<br /><br /><input type=file id=d4importFile class="form-control" accept=".json" onchange=meshImportDeviceListValidate() />'),showModal("xxAddAgentModal","idx_dlgOkButton",()=>meshImportDeviceListEx()),QE("idx_dlgOkButton",!1))}function meshImportDeviceListValidate(){QE("idx_dlgOkButton",null!=Q("d4importFile").value)}function meshImportDeviceListEx(){var e=new FileReader;e.onload=function(e){var t=null;try{t=JSON.parse(e.target.result)}catch(e){return setModalContent("xxAddAgent","Importar dispositivos Intel&reg; AMT",format("Archivo JSON inválido: {0}.",e)),void showModal("xxAddAgentModal","idx_dlgOkButton")}if("object"==typeof t&&"string"==typeof t.webappversion&&"object"==typeof t.computers&&Array.isArray(t.computers)){var o,n=0;for(o in t.computers){var i,a=t.computers[o];"string"==typeof a.name&&"string"==typeof a.host&&"string"==typeof a.user&&"string"==typeof a.pass&&(i={action:"addamtdevice",meshid:currentMesh._id,devicename:a.name,hostname:a.host,amtusername:a.user,amtpassword:a.pass,amttls:1==a.tls?1:0},"string"==typeof a.ver&&(i.ver=a.ver),"number"==typeof a.pstate&&(i.state=a.pstate),"string"==typeof a.digestrealm&&(i.realm=a.digestrealm),"string"==typeof a.tlscerthash&&(i.hash=a.tlscerthash),meshserver.send(i),n++)}0==n&&setModalContent("xxAddAgent","Importar Cuenta de Usuario","Unable to import any device.")}else setModalContent("xxAddAgent","Importar dispositivos Intel&reg; AMT","Invalid JSON file format.");showModal("xxAddAgentModal","idx_dlgOkButton")},e.readAsText(Q("d4importFile").files[0])}function p20editMeshAmt(){xxdialogMode||(setModalContent("xxAddAgent","Política de Intel&reg; AMT",""+addHtmlFormFloating("Tipo",'<select id=dp20amtpolicy class="form-select" onchange=p20editMeshAmtChange()><option value=0>Ninguna Política</option><option value=1>Desactivar</option><option value=2>Modo de Control de Cliente (CCM) simple</option>'+(0!=(1048576&features)?"<option value=3>Modo de Control de Administrador (ACM) simple</option>":"")+"<option value=4>Completamente automatico</option></select>")+"<div id=dp20amtpolicydiv></div>"),showModal("xxAddAgentModal","idx_dlgOkButton",p20editMeshAmtEx),currentMesh.amt&&(Q("dp20amtpolicy").value=currentMesh.amt.type),p20editMeshAmtChange(),!currentMesh.amt||2!=currentMesh.amt.type&&3!=currentMesh.amt.type||(Q("dp20amtpolicypass").value=currentMesh.amt.password,2!=currentMesh.amt.type&&3!=currentMesh.amt.type||(null!=currentMesh.amt.badpass&&(Q("dp20amtbadpass").value=currentMesh.amt.badpass),3==currentMesh.amt.type&&null!=currentMesh.amt.ccm&&(Q("dp20amtccmmode").value=currentMesh.amt.ccm)),0==(1024&features)&&(Q("dp20amtcira").value=currentMesh.amt.cirasetup)),dp20amtValidatePolicy())}function p20editMeshAmtChange(){var e=Q("dp20amtpolicy").value,t="";2!=e&&3!=e||(t=(t=(t=t+addHtmlFormFloating("Contraseña",'<select id=dp20amtpass class="form-select" onchange=dp20amtValidatePolicy() onkeyup=dp20amtValidatePolicy()><option value=0>Contraseña Aleatoria</option>'+(null!=currentMesh.amt&&1==currentMesh.amt.password?"<option value=1 selected>Mantener la contraseña existente</option>":"")+"<option value=2>Seleccionar nueva contraseña</option></select>")+"<div id=dp20amtpassdiv style=display:none>")+addHtmlFormFloating("Nueva contraseña*",'<input id=dp20amtpolicypass type=password class="form-control" maxlength=32 placeholder="New password*" onchange=dp20amtValidatePolicy() onkeyup=dp20amtValidatePolicy() autocomplete=off />'))+addHtmlFormFloating("Nueva contraseña*",'<input id=dp20amtpolicypass2 type=password class="form-control" maxlength=32 placeholder="New password*" onchange=dp20amtValidatePolicy() onkeyup=dp20amtValidatePolicy() autocomplete=off />')+"</div>",3==e&&(t+=addHtmlFormFloating("Modo CCM",'<select id=dp20amtccmmode class="form-select" onchange=dp20amtValidatePolicy() onkeyup=dp20amtValidatePolicy()><option value=0>No cambie, mantenga CCM si está configurado</option><option value=1>Desactivar CCM si está configurado</option><option value=2>Activar a CCM, si ACM falla</option></select>')),t=(t+="<div id=dp20amtbadpassdiv style=display:none>")+addHtmlFormFloating("Contraseña desconocida",'<select id=dp20amtbadpass class="form-select"><option value=0>No hacer nada</option><option value=1>Si está en CCM, reactivar Intel&reg; AMT</option></select>')+"</div>",0==(1024&features)&&(t+=addHtmlFormFloating("Configuración de CIRA",'<select id=dp20amtcira class="form-select" title="Acceso Remoto Iniciado por el Cliente (CIRA)"><option value=0>No hacer nada</option><option value=1>No conectar al servidor</option><option value=2>Conectar al servidor</option></select>')),t+='<span id=dp10passNotify style="font-size:10px"> * 8-16 caracteres, 1 superior, 1 inferior, 1 numérico, 1 no alfanumérico.</span>',2==currentMesh.mtype&&2==e&&(t+='<span style="font-size:10px"> Esta política no afectará a los dispositivos con Intel&reg; AMT en modo ACM.</span>')),0==e&&(t='<div class="row"><div class="col-2"><i class="fa-solid fa-times-circle text-danger" style="padding-right:8px; font-size:60px;"></i></div><div class="col-10">Cuando se selecciona esta política, este servidor no administra Intel&reg; AMT. Intel AMT todavía se puede utilizar activándolo y configurándolo manualmente.</div></div>'),1==e&&(t='<div class="row"><div class="col-2"><i class="fa-solid fa-times-circle text-danger" style="font-size:60px; padding-right:8px; color:green;"></i></div><div class="col-10">Cuando se selecciona esta política, se desactivará cualquier Intel&reg; AMT en el modo de control de cliente (CCM). Otros dispositivos tendrán CIRA borrado y aún se pueden administrar manualmente.</div></div>'),4==e&&(t='<div class="row"><div class="col-2"><i class="fa-solid fa-check-circle text-success" style="font-size:60px; padding-right:8px; color:blue;"></i></div><div class="col-10">Esta es la política recomendada. La activación y administración de Intel&reg; AMT está completamente automatizada y el servidor intentará hacer el mejor uso posible de la administración de hardware.</div></div>'),QH("dp20amtpolicydiv",t),setTimeout(dp20amtValidatePolicy,500)}function dp20amtValidatePolicy(){var e,t=!0,o=Q("dp20amtpolicy").value;2!=o&&3!=o||2!=Q("dp20amtpass").value||(t=(e=Q("dp20amtpolicypass").value)===Q("dp20amtpolicypass2").value&&passwordcheck(e)),QE("idx_dlgOkButton",t),2!=o&&3!=o||QV("dp20amtpassdiv",2==Q("dp20amtpass").value),QV("dp10passNotify",(2==o||3==o)&&2==Q("dp20amtpass").value),QV("dp20amtbadpassdiv",2==o||3==o&&1!=Q("dp20amtccmmode").value)}function p20editMeshAmtEx(){var e=parseInt(Q("dp20amtpolicy").value),t={type:e},o=null;2!=e&&3!=e||(0==Q("dp20amtpass").value&&(o=""),1==Q("dp20amtpass").value&&(o=null),2==Q("dp20amtpass").value&&(o=Q("dp20amtpolicypass").value)),2==e?(t={type:e,password:o,badpass:parseInt(Q("dp20amtbadpass").value)}).cirasetup=0==(1024&features)?parseInt(Q("dp20amtcira").value):1:3==e?(t={type:e,password:o,badpass:parseInt(Q("dp20amtbadpass").value),ccm:parseInt(Q("dp20amtccmmode").value)}).cirasetup=0==(1024&features)?parseInt(Q("dp20amtcira").value):1:4==e&&(t={type:e}),meshserver.send({action:"meshamtpolicy",meshid:currentMesh._id,amtpolicy:t})}function p20showDeleteMeshDialog(){var e;return xxdialogMode||(e=format("¿Estás seguro de que desea eliminar el grupo {0}? Al eliminar el grupo de dispositivos también se eliminará toda la información sobre los dispositivos dentro de este grupo.",EscapeHtml(currentMesh.name))+"<br /><br />",setModalContent("xxAddAgent","Eliminar Grupo de Dispositivos",e+='<label class=form-check-label><input id=p20check type=checkbox class="form-check-input m-2" onchange=p20validateDeleteMeshDialog() />Confirmar</label>'),showModal("xxAddAgentModal","idx_dlgOkButton",function(){p20showDeleteMeshDialogEx(3,"")}),p20validateDeleteMeshDialog()),!1}function p20validateDeleteMeshDialog(){QE("idx_dlgOkButton",Q("p20check").checked)}function p20showDeleteMeshDialogEx(e,t){meshserver.send({action:"deletemesh",meshid:currentMesh._id,meshname:currentMesh.name})}function p20editmeshrelay(){if(!xxdialogMode){var e=[];if(0==(2&features))for(var t in nodes){var o=nodes[t];2==o.mtype&&null!=o.agent&&4294967295==GetNodeRights(o)&&e.push(o)}if(e.sort(nameSort),0==e.length)setModalContent("xxAddAgent","Editar Grupo de Dispositivos",i="No hay dispositivos de relé disponibles."),showModal("xxAddAgentModal","idx_dlgOkButton");else{var n=[];for(t in e)n.push('<option value="'+e[t]._id+'"'+(currentMesh.relayid==e[t]._id?" selected":"")+">"+EscapeHtml(e[t].name)+"</option>");var i=addHtmlFormFloating("Dispositivo de Retransmisión",'<select id=d2devrelay class="form-select">'+n.join("")+"</select>");setModalContent("xxAddAgent","Editar Grupo de Dispositivos",i),showModal("xxAddAgentModal","idx_dlgOkButton",p20editmeshrelayEx)}}}function p20editmeshrelayEx(){meshserver.send({action:"editmesh",meshid:currentMesh._id,relayid:Q("d2devrelay").value})}function p20editmesh(e){xxdialogMode||(setModalContent("xxAddAgent","Editar Grupo de Dispositivos",'<div class="form-floating mb-2"><input type=text class="form-control" id=dp20meshname maxlength=128 placeholder="Nombre" onchange=p20editmeshValidate() onkeyup=p20editmeshValidate(event) /><label for=dp20meshname>Nombre</label></div><div class="form-floating mb-2"><textarea id=dp20meshdesc class="form-control" maxlength=1024 placeholder="Descripción"></textarea><label for=dp20meshdesc>Descripción</label></div>'),showModal("xxAddAgentModal","idx_dlgOkButton",p20editmeshEx),Q("dp20meshname").value=currentMesh.name,currentMesh.desc&&(Q("dp20meshdesc").value=currentMesh.desc),p20editmeshValidate(),(2==e?Q("dp20meshdesc"):Q("dp20meshname")).focus())}function p20editmeshEx(){meshserver.send({action:"editmesh",meshid:currentMesh._id,meshname:Q("dp20meshname").value,desc:Q("dp20meshdesc").value})}function p20editmeshValidate(e){QE("idx_dlgOkButton",0<Q("dp20meshname").value.length),e&&"Enter"==e.key&&Q("dp20meshdesc").focus()}function p20editmeshconsent(e){var t,o,n;xxdialogMode||(o=0,n=t="",1==e&&(o=currentMesh.consent||0,n="Editar Consentimiento del Usuario del Grupo de Dispositivos"),2==e&&(o=currentUser.consent||0,n="Editar Consentimiento del Usuario"),3==e&&(o=currentNode.consent||0,n="Editar Consentimiento del Usuario del Dispositivo"),4==e&&(o=currentUserGroup.consent||0,n="Editar el consentimiento del usuario del grupo de usuarios"),setModalContent("xxAddAgent",n,t=(t=(t=(t=(t=t+'<div style="width:100%;border-bottom:1px solid gray;margin-bottom:5px"><b>Escritorio</b></div>'+('<div><label for=d20flag1><input type=checkbox id=d20flag1 class="form-check-input me-2" '+(1&o?"checked":"")+">Notificar al usuario</label></div>"))+('<div><label for=d20flag2><input type=checkbox id=d20flag2 class="form-check-input me-2" '+(8&o?"checked":"")+">Solicitar consentimiento del usuario</label></div>")+('<div><label for=d20flag7><input type=checkbox id=d20flag7 class="form-check-input me-2" '+(64&o?"checked":"")+">Mostrar barra de herramientas de conexión</label></div>"))+'<div style="width:100%;border-bottom:1px solid gray;margin-bottom:5px;margin-top:8px"><b>Terminal</b></div>'+('<div><label for=d20flag3><input type=checkbox id=d20flag3 class="form-check-input me-2" '+(2&o?"checked":"")+">Notificar al usuario</label></div>"))+('<div><label for=d20flag4><input type=checkbox id=d20flag4 class="form-check-input me-2" '+(16&o?"checked":"")+">Solicitar consentimiento del usuario</label></div>")+'<div style="width:100%;border-bottom:1px solid gray;margin-bottom:5px;margin-top:8px"><b>Archivos</b></div>')+('<div><label for=d20flag5><input type=checkbox id=d20flag5 class="form-check-input me-2" '+(4&o?"checked":"")+">Notificar al usuario</label></div>")+('<div><label for=d20flag6><input type=checkbox id=d20flag6 class="form-check-input me-2" '+(32&o?"checked":"")+">Solicitar consentimiento del usuario</label></div>")),xxdialogButtons=3,xxdialogTag=e,showModal("xxAddAgentModal","idx_dlgOkButton",function(){p20editmeshconsentEx(xxdialogButtons,xxdialogTag)}),serverinfo.consent&&(1&serverinfo.consent&&(Q("d20flag1").checked=!0),8&serverinfo.consent&&(Q("d20flag2").checked=!0),2&serverinfo.consent&&(Q("d20flag3").checked=!0),16&serverinfo.consent&&(Q("d20flag4").checked=!0),4&serverinfo.consent&&(Q("d20flag5").checked=!0),32&serverinfo.consent&&(Q("d20flag6").checked=!0),64&serverinfo.consent&&(Q("d20flag7").checked=!0),QE("d20flag1",!(1&serverinfo.consent)),QE("d20flag2",!(8&serverinfo.consent)),QE("d20flag3",!(2&serverinfo.consent)),QE("d20flag4",!(16&serverinfo.consent)),QE("d20flag5",!(4&serverinfo.consent)),QE("d20flag6",!(32&serverinfo.consent)),QE("d20flag7",!(64&serverinfo.consent))))}function p20editmeshconsentEx(e,t){var o=0;Q("d20flag1").checked&&(o+=1),Q("d20flag2").checked&&(o+=8),Q("d20flag3").checked&&(o+=2),Q("d20flag4").checked&&(o+=16),Q("d20flag5").checked&&(o+=4),Q("d20flag6").checked&&(o+=32),Q("d20flag7").checked&&(o+=64),1==t&&meshserver.send({action:"editmesh",meshid:currentMesh._id,consent:o}),2==t&&meshserver.send({action:"edituser",id:currentUser._id,consent:o}),3==t&&meshserver.send({action:"changedevice",nodeid:currentNode._id,consent:o}),4==t&&meshserver.send({action:"editusergroup",ugrpid:currentUserGroup._id,consent:o})}function p20editmeshfeatures(){var e,t,o;xxdialogMode||(e=currentMesh.flags||0,t="",o=0,"number"==typeof currentMesh.expireDevs&&0<currentMesh.expireDevs&&2e3<(o=currentMesh.expireDevs)&&(o=2e3),1==serverinfo.devGroupSessionRecording&&4!=currentMesh.mtype&&(t+='<div class="form-check"><label><input type=checkbox id=d20flag4 class="form-check-input me-2" onchange=p20editmeshfeaturesValidate() '+(4&e?"checked":"")+">Grabar sesiones</label><br></div>"),t=(t=2!=currentMesh.mtype&&4!=currentMesh.mtype?t:t+('<div class="form-check"><label><input type=checkbox id=d20flag2 class="form-check-input me-2" onchange=p20editmeshfeaturesValidate() '+(2&e?"checked":"")+">"+(4==currentMesh.mtype?"Sincronizar el nombre del dispositivo del servidor con el nombre del puerto":"Sincronizar el nombre del dispositivo del servidor con el nombre del host"))+'</label><br></div><div class="form-check"><label><input type=checkbox id=d20flag1 class="form-check-input me-2" onchange=p20editmeshfeaturesValidate() '+(1&e?"checked":"")+">Remover el dispositivo al desconectar</label><br></div>")+'<div class="form-check"><label><input type=checkbox id=d20expireDevice class="form-check-input me-2" onchange=p20editmeshfeaturesValidate() '+(0<o?"checked":"")+'>Eliminar automáticamente los dispositivos inactivos</label><br></div><div style=margin-left:20px id=d20expireDeviceDev>Desactivar días hasta la eliminación <label><input type=number inputmode=numeric class="form-control" onchange=p20editmeshfeaturesValidate() onkeyup=p20editmeshfeaturesValidate() onpaste=p20editmeshfeaturesValidate() onkeydown=p20editmeshfeaturesValidate() maxlength=4 min=1 max=2000 style=width:80px value="'+(0==o?30:o)+'" id=d20expireDeviceDays></label><br></div>',serverinfo.autoremoveinactivedevices&&(1==serverinfo.autoremoveinactivedevices?t+=format("<span style=font-size:x-small;margin-left:6px>De forma predeterminada, los dispositivos inactivos se eliminarán después de 1 día.</span>",serverinfo.autoremoveinactivedevices):t+=format("<span style=font-size:x-small;margin-left:6px>De forma predeterminada, los dispositivos inactivos se eliminarán después de {0} días.</span>",serverinfo.autoremoveinactivedevices)),setModalContent("xxAddAgent","Editar Características del Grupo de Dispositivos",t),showModal("xxAddAgentModal","idx_dlgOkButton",p20editmeshfeaturesEx),p20editmeshfeaturesValidate())}function p20editmeshfeaturesValidate(){var e=0,t=!0,e=(2!=currentMesh.mtype&&4!=currentMesh.mtype||!Q("d20flag1").checked||(e+=1),QE("d20expireDevice",0==(1&e)),0==(1&e)&&Q("d20expireDevice").checked);QV("d20expireDeviceDev",e),e&&(e=parseInt(Q("d20expireDeviceDays").value),isNaN(e)||e<1||2e3<e||e!=Q("d20expireDeviceDays").value)&&(t=!1),QE("idx_dlgOkButton",t)}function p20editmeshfeaturesEx(){var e=0,t=(2!=currentMesh.mtype&&4!=currentMesh.mtype||(Q("d20flag1").checked&&(e+=1),Q("d20flag2").checked&&(e+=2)),1==serverinfo.devGroupSessionRecording&&4!=currentMesh.mtype&&Q("d20flag4").checked&&(e+=4),0);0==(1&e)&&Q("d20expireDevice").checked&&(t=parseInt(Q("d20expireDeviceDays").value)),meshserver.send({action:"editmesh",meshid:currentMesh._id,flags:e,expireDevs:t})}function p20showAddMeshUserDialog(e,t){if(!xxdialogMode){var o="";if(null==e||5==e)null==t&&(o+=null==e?"Permitir a los usuarios administrar este grupo de dispositivos y los dispositivos en este grupo.":"Permitir a los usuarios administrar este dispositivo.",524288&features&&(o+=" Los usuarios deben iniciar sesión en este servidor una vez antes de poder ser añadidos a un grupo de dispositivos."),o+="<br /><br />"),o=(o+="<div style='position:relative'>")+addHtmlFormFloating("Identificadores de Usuario",'<input id=dp20username maxlength=256 onchange=p20validateAddMeshUserDialog() onkeyup=p20validateAddMeshUserDialog() placeholder="user1, user2, user3" class="form-control" />')+"<div id=dp20usersuggest class=suggestionBox style='top:30px;left:130px;display:none'></div></div><br>";else if(1==e){var n="";if(null==t)for(l in a=getOrderedList(meshes,"name"))null!=currentUser.links&&null!=currentUser.links[a[l]._id]||(n+="<option value="+encodeURIComponentEx(a[l]._id)+">"+EscapeHtml(a[l].name)+"</option>");else n+="<option value="+t+">"+EscapeHtml(meshes[decodeURIComponent(t)].name)+"</option>";o+=addHtmlFormFloating("Grupo de Dispositivos","<select onchange=p20validateAddMeshUserDialog() id=dp2groupid class=form-select"+(t?" disabled":"")+">"+n+"</select>")}else if(2==e){if(null==usergroups)return;n="";for(l in i=getOrderedList(usergroups,"name"))currentMesh._id.split("/")[1]!=i[l]._id.split("/")[1]||null!=currentMesh.links&&null!=currentMesh.links[i[l]._id]||(n+="<option value="+encodeURIComponentEx(i[l]._id)+">"+EscapeHtml(i[l].name)+"</option>");o+=addHtmlFormFloating("Grupo de Usuarios",'<select onchange=p20validateAddMeshUserDialog() id=dp2groupid class="form-select">'+n+"</select>")}else if(6==e){if(null==usergroups)return;var i,n="";if(null==t)for(l in i=getOrderedList(usergroups,"name"))null!=i[l].membershipType||currentNode._id.split("/")[1]!=i[l]._id.split("/")[1]||null!=currentNode.links&&null!=currentNode.links[i[l]._id]||(n+="<option value="+encodeURIComponentEx(i[l]._id)+">"+EscapeHtml(i[l].name)+"</option>");else n+="<option value="+t+">"+EscapeHtml(usergroups[decodeURIComponent(t)].name)+"</option>";o+=addHtmlFormFloating("Grupo de Usuarios","<select onchange=p20validateAddMeshUserDialog() id=dp2groupid "+(t?" disabled":"")+' class="form-select">'+n+"</select>")}else if(3==e){n="";for(l in t=t&&decodeURIComponent(t),a=getOrderedList(meshes,"name"))null==t&&null!=currentUserGroup.links&&null!=currentUserGroup.links[a[l]._id]||(n+="<option value="+encodeURIComponentEx(a[l]._id)+(t==a[l]._id?" selected":" ")+">"+EscapeHtml(a[l].name)+"</option>");o+=addHtmlFormFloating("Grupo de Dispositivos","<select onchange=p20validateAddMeshUserDialog("+e+') id=dp2groupid class="form-select">'+n+"</select>")}else if(4==e||7==e){var a,n="",s=null,r=null;for(l in null!=t&&null!=(r=getNodeFromId(decodeURIComponent(t)))&&(s=r.meshid),a=getOrderedList(meshes,"name"))null!=a[l].links[userinfo._id]&&7&a[l].links[userinfo._id].rights&&(null==s&&(s=a[l]._id),n+="<option value="+encodeURIComponentEx(a[l]._id)+(s==a[l]._id?" selected":" ")+">"+EscapeHtml(a[l].name)+"</option>");o+=addHtmlFormFloating("Grupo de Dispositivos","<select onchange=p20changeMeshAddMeshUserDialog("+e+') id=dp2meshid class="form-select">'+n+"</select>"),n="";var l,d=getOrderedList(nodes,"name");for(l in d)d[l].meshid==s&&(n+="<option value="+encodeURIComponentEx(d[l]._id)+(r==d[l]?" selected":" ")+">"+EscapeHtml(d[l].name)+"</option>");o+=addHtmlFormFloating("Dispositivo","<select onchange=p20validateAddMeshUserDialog("+e+') id=dp2nodeid class="form-select">'+n+"</select>")}else{var c=(e=decodeURIComponent(e)).split("/")[2];users&&users[e]&&(c=users[e].name),usergroups&&usergroups[e]&&(c=usergroups[e].name),userinfo._id==e&&(c=userinfo.name),e.startsWith("ugrp/")?o+=format("Permisos de grupo para {0}.",c)+"<br /><br />":o+=format("Permisos de grupo para el usuario {0}.",c)+"<br /><br />"}var c=-1,u=4!=e&&5!=e&&6!=e&&7!=e;o+='<div style="height:120px;overflow-y:scroll;border:1px solid var(--sub-menu-color);resize:vertical;padding:8px;border-radius:0.375rem;">',u&&(o+='<label><input type=checkbox class="form-check-input me-2" onchange=p20validateAddMeshUserDialog() id=p20fulladmin>Administrador Total</label><br><label><input type=checkbox class="form-check-input me-2" onchange=p20validateAddMeshUserDialog() id=p20editmesh>Editar Grupo de Dispositivos</label><br><label><input type=checkbox class="form-check-input me-2" onchange=p20validateAddMeshUserDialog() id=p20manageusers>Administrar Usuarios del Grupo de Dispositivos</label><br><label><input type=checkbox class="form-check-input me-2" onchange=p20validateAddMeshUserDialog() id=p20managecomputers>Administrar Computadoras del Grupo de Dispositivos</label><br>'),o=(o+='<label><input type=checkbox class="form-check-input me-2" onchange=p20validateAddMeshUserDialog() id=p20remotecontrol>Control Remoto y Relay</label><br>')+'<label><input type=checkbox class="form-check-input me-2" onchange=p20validateAddMeshUserDialog() id=p20remoteview style=margin-left:12px>Sólo Vista Remota</label><br>'+'<label><input type=checkbox class="form-check-input me-2" onchange=p20validateAddMeshUserDialog() id=p20remotelimitedinput style=margin-left:12px>Sólo Entrada Limitada</label><br>',!1!==serverinfo.guestdevicesharing&&(o+='<label><input type=checkbox class="form-check-input me-2" onchange=p20validateAddMeshUserDialog() id=p20guestshare style=margin-left:12px>Compartir como invitado</label><br>'),o=(o=(o=(o=(o=(o=(o=(o=o+'<label><input type=checkbox class="form-check-input me-2" onchange=p20validateAddMeshUserDialog() id=p20nodesktop style=margin-left:12px>Sin Acceso al Escritorio</label><br>'+'<label><input type=checkbox class="form-check-input me-2" onchange=p20validateAddMeshUserDialog() id=p20noterminal style=margin-left:12px>Sin Acceso a la Terminal</label><br>')+'<label><input type=checkbox class="form-check-input me-2" onchange=p20validateAddMeshUserDialog() id=p20nofiles style=margin-left:12px>Sin Acceso a Archivos</label><br>'+'<label><input type=checkbox class="form-check-input me-2" onchange=p20validateAddMeshUserDialog() id=p20noamt style=margin-left:12px>Sin Intel&reg; AMT</label><br>')+'<label><input type=checkbox class="form-check-input me-2" onchange=p20validateAddMeshUserDialog() id=p20meshagentconsole>Consola del Agente Mesh</label><br>'+'<label><input type=checkbox class="form-check-input me-2" onchange=p20validateAddMeshUserDialog() id=p20meshserverfiles>Archivos del Servidor</label><br>')+'<label><input type=checkbox class="form-check-input me-2" onchange=p20validateAddMeshUserDialog() id=p20wakedevices>Despertar Dispositivos</label><br>'+'<label><input type=checkbox class="form-check-input me-2" onchange=p20validateAddMeshUserDialog() id=p20editnotes>Editar Notas del Dispositivo</label><br>')+'<label><input type=checkbox class="form-check-input me-2" onchange=p20validateAddMeshUserDialog() id=p20limitevents>Mostrar Solo Eventos Propios</label><br>'+'<label><input type=checkbox class="form-check-input me-2" onchange=p20validateAddMeshUserDialog() id=p20chatnotify>Chatear & Notificar</label><br>')+'<label><input type=checkbox class="form-check-input me-2" onchange=p20validateAddMeshUserDialog() id=p20uninstall>Desinstalar Agente / Eliminar Dispositivo</label><br>'+'<label><input type=checkbox class="form-check-input me-2" onchange=p20validateAddMeshUserDialog() id=p20commands>Comandos Remotos</label><br>')+'<label><input type=checkbox class="form-check-input me-2" onchange=p20validateAddMeshUserDialog() id=p20resetoff>Reiniciar / Apagar</label><br>'+'<label><input type=checkbox class="form-check-input me-2" onchange=p20validateAddMeshUserDialog() id=p20details>Detalles del dispositivo</label><br>')+'<label><input type=checkbox class="form-check-input me-2" onchange=p20validateAddMeshUserDialog() id=p20relay>Usar como Relay</label><br>'+"</div>",null==e?(xxdialogButtons=3,xxdialogTag="",setModalContent("xxAddAgent","Agregar Usuarios al Grupo de Dispositivos",o),showModal("xxAddAgentModal","idx_dlgOkButton",function(){p20showAddMeshUserDialogEx(xxdialogButtons,xxdialogTag)}),QE("p20fulladmin",4294967295==GetMeshRights(currentMesh)),Q("dp20username").focus()):1===e?(xxdialogButtons=t?7:3,xxdialogTag=e,setModalContent("xxAddAgent",null==t?"Agregar Permisos de Grupo de Dispositivos":"Editar Permisos del Grupo de Dispositivos",o),showModal("xxAddAgentModal","idx_dlgOkButton",function(){p20showAddMeshUserDialogEx(xxdialogButtons,xxdialogTag)}),4294967295==(c=null!=t?meshes[decodeURIComponent(t)].links[currentUser._id].rights:c)&&(Q("p20fulladmin").checked=!0,c=-1)):2===e?(xxdialogButtons=3,xxdialogTag=e,setModalContent("xxAddAgent","Agregar Grupo de Usuarios",o),showModal("xxAddAgentModal","idx_dlgOkButton",function(){p20showAddMeshUserDialogEx(xxdialogButtons,xxdialogTag)}),QE("p20fulladmin",4294967295==GetMeshRights(currentMesh))):3===e?(xxdialogButtons=t?7:3,xxdialogTag=e,setModalContent("xxAddAgent",null==t?"Agregar Grupo de Dispositivos":"Editar Grupo de Dispositivos",o),showModal("xxAddAgentModal","idx_dlgOkButton",function(){p20showAddMeshUserDialogEx(xxdialogButtons,xxdialogTag)}),QE("dp2groupid",null==t),4294967295==(c=null!=t?currentUserGroup.links[decodeURIComponent(t)].rights:c)&&(Q("p20fulladmin").checked=!0,c=-1)):4===e?(xxdialogButtons=t?7:3,xxdialogTag=e,setModalContent("xxAddAgent",null==t?"Agregar Permisos de Dispositivo":"Editar Permisos del Dispositivo",o),showModal("xxAddAgentModal","idx_dlgOkButton",function(){p20showAddMeshUserDialogEx(xxdialogButtons,xxdialogTag)}),QE("dp2meshid",null==t),QE("dp2nodeid",null==t)):7===e?(xxdialogButtons=t?7:3,xxdialogTag=e,setModalContent("xxAddAgent",null==t?"Agregar Permisos de Dispositivo":"Editar Permisos del Dispositivo",o),showModal("xxAddAgentModal","idx_dlgOkButton",function(){p20showAddMeshUserDialogEx(xxdialogButtons,xxdialogTag)}),QE("dp2meshid",null==t),QE("dp2nodeid",null==t),null!=t&&(c=currentUserGroup.links[decodeURIComponent(t)].rights,QE("dp20username",!1))):5===e?(xxdialogButtons=t?7:3,xxdialogTag=e,setModalContent("xxAddAgent",t?"Editar Permisos de Dispositivo de Usuario":"Agregar Permisos del Usuario del Dispositivo",o),showModal("xxAddAgentModal","idx_dlgOkButton",function(){p20showAddMeshUserDialogEx(xxdialogButtons,xxdialogTag)}),null!=t&&(t=decodeURIComponent(t),null!=users&&null!=users[t]?Q("dp20username").value=users[t].name:Q("dp20username").value=t.split("/")[2],c=currentNode.links[t].rights,QE("dp20username",!1)),Q("dp20username").focus()):6===e?(xxdialogButtons=t?7:3,xxdialogTag=e,setModalContent("xxAddAgent",t?"Editar Permisos de Dispositivo de Grupo de Usuarios":"Agregar Permisos del Grupo de Usuarios del Dispositivo",o),showModal("xxAddAgentModal","idx_dlgOkButton",function(){p20showAddMeshUserDialogEx(xxdialogButtons,xxdialogTag)}),null!=t&&(c=currentNode.links[decodeURIComponent(t)].rights)):(e.startsWith("ugrp/")?(xxdialogButtons=7,xxdialogTag=e,setModalContent("xxAddAgent","Editar Permisos del Grupo de Dispositivos",o)):(xxdialogButtons=7,xxdialogTag=e,setModalContent("xxAddAgent","Editar Permisos de Grupo de Dispositivos de Usuario",o)),showModal("xxAddAgentModal","idx_dlgOkButton",function(){p20showAddMeshUserDialogEx(xxdialogButtons,xxdialogTag)}),GetMeshRights(currentMesh),4294967295==(c=GetMeshRights(currentMesh,e))&&(Q("p20fulladmin").checked=!0,c=-1),QE("p20fulladmin",4294967295==GetMeshRights(currentMesh))),-1!=c&&(u&&(1&c&&(Q("p20editmesh").checked=!0),2&c&&(Q("p20manageusers").checked=!0),4&c)&&(Q("p20managecomputers").checked=!0),8&c&&(Q("p20remotecontrol").checked=!0,65536&c&&(Q("p20nodesktop").checked=!0),256&c&&(Q("p20remoteview").checked=!0),524288&c&&!1!==serverinfo.guestdevicesharing&&(Q("p20guestshare").checked=!0),512&c&&(Q("p20noterminal").checked=!0),1024&c&&(Q("p20nofiles").checked=!0),2048&c&&(Q("p20noamt").checked=!0),4096&c)&&(Q("p20remotelimitedinput").checked=!0),16&c&&(Q("p20meshagentconsole").checked=!0),32&c&&(Q("p20meshserverfiles").checked=!0),64&c&&(Q("p20wakedevices").checked=!0),128&c&&(Q("p20editnotes").checked=!0),8192&c&&(Q("p20limitevents").checked=!0),16384&c&&(Q("p20chatnotify").checked=!0),32768&c&&(Q("p20uninstall").checked=!0),131072&c&&(Q("p20commands").checked=!0),262144&c&&(Q("p20resetoff").checked=!0),524288&c&&!1!==serverinfo.guestdevicesharing&&(Q("p20guestshare").checked=!0),1048576&c&&(Q("p20details").checked=!0),2097152&c)&&(Q("p20relay").checked=!0),p20validateAddMeshUserDialog(e)}return!1}function p20changeMeshAddMeshUserDialog(e){var t,o="",n=decodeURIComponent(Q("dp2meshid").value);for(t in nodes)nodes[t].meshid==n&&(o+="<option value="+encodeURIComponentEx(nodes[t]._id)+">"+EscapeHtml(nodes[t].name)+"</option>");QH("dp2nodeid",o),p20validateAddMeshUserDialog(e)}function p20setname(e){e=decodeURIComponent(e);var t,o=Q("dp20username").value.split(",");for(t in o)o[t]=o[t].trim();return o[o.length-1]=e,Q("dp20username").value=o.join(", "),p20validateAddMeshUserDialog(),!1}function p20validateAddMeshUserDialog(e){var t,o,n=!0;if(4===e&&(e=0,""!=(t=decodeURIComponent(Q("dp2nodeid").value))&&null!=currentUser.links&&null!=currentUser.links[t]&&(e=currentUser.links[t].rights),Q("p20remotecontrol").checked=0!=(8&e),Q("p20meshagentconsole").checked=0!=(16&e),Q("p20meshserverfiles").checked=0!=(32&e),Q("p20wakedevices").checked=0!=(64&e),Q("p20editnotes").checked=0!=(128&e),Q("p20remoteview").checked=0!=(256&e),Q("p20noterminal").checked=0!=(512&e),Q("p20nofiles").checked=0!=(1024&e),Q("p20noamt").checked=0!=(2048&e),Q("p20remotelimitedinput").checked=0!=(4096&e),Q("p20limitevents").checked=0!=(8192&e),Q("p20chatnotify").checked=0!=(16384&e),Q("p20uninstall").checked=0!=(32768&e),Q("p20nodesktop").checked=0!=(65536&e),Q("p20commands").checked=0!=(131072&e),Q("p20resetoff").checked=0!=(262144&e),!1!==serverinfo.guestdevicesharing&&(Q("p20guestshare").checked=0!=(524288&e)),Q("p20details").checked=0!=(1048576&e),Q("p20relay").checked=0!=(2097152&e),n=""!=t),Q("dp20username")){var i=Q("dp20username").value.split(",");for(c in i){var a=i[c]=i[c].trim();(0==a.length||0<=a.indexOf('"'))&&(n=!1)}var e=!1,s=!1;if(null!=users){var r=i[i.length-1].trim(),l=r.toLowerCase(),d=[];if(0<r.length){for(var c in users){var u=users[c]._id.split("/");if((null==currentMesh||currentMesh.domain==u[1])&&(null==currentNode||currentNode.domain==u[1])){if(u[2]===l){s=!0;break}if(0<=users[c].name.toLowerCase().indexOf(l)&&(d.push([users[c]._id,users[c].name]),8<=d.length))break}}if(0==s&&0<d.length){var p="";for(c in d){var m=d[c][0],g=d[c][1];m.split("/")[2]==g.toLowerCase()?p+="<div class=suggestionBoxItem onclick='p20setname(\""+encodeURIComponentEx(m.split("/")[2])+"\")'>"+EscapeHtml(g)+"</div>":p+="<div class=suggestionBoxItem onclick='p20setname(\""+encodeURIComponentEx(m.split("/")[2])+"\")'><div>"+EscapeHtml(g)+"</div><div class=suggestionBoxSubItem>"+EscapeHtml(m.split("/")[2])+"</div></div>"}QH("dp20usersuggest",p),e=!0}}}QV("dp20usersuggest",e)}QE("idx_dlgOkButton",n),null!=Q("p20fulladmin")?(o=!Q("p20fulladmin").checked,QE("p20editmesh",o),QE("p20manageusers",o),QE("p20managecomputers",o)):o=""!=t,QE("p20remotecontrol",o),QE("p20meshagentconsole",o),QE("p20meshserverfiles",o),QE("p20wakedevices",o),QE("p20editnotes",o),QE("p20limitevents",o),QE("p20remoteview",o&&Q("p20remotecontrol").checked),!1!==serverinfo.guestdevicesharing&&QE("p20guestshare",o&&Q("p20remotecontrol").checked&&(Q("p20remoteview").checked||!Q("p20remotelimitedinput").checked)),QE("p20remotelimitedinput",o&&Q("p20remotecontrol").checked&&!Q("p20remoteview").checked),QE("p20nodesktop",o&&Q("p20remotecontrol").checked),QE("p20noterminal",o&&Q("p20remotecontrol").checked),QE("p20nofiles",o&&Q("p20remotecontrol").checked),QE("p20noamt",o&&Q("p20remotecontrol").checked),QE("p20chatnotify",o),QE("p20uninstall",o),QE("p20commands",o),QE("p20resetoff",o),QE("p20details",o),QE("p20relay",o)}function p20showAddMeshUserDialogEx(e,t){var o,n,i=0;if(null!=Q("p20fulladmin")&&1==Q("p20fulladmin").checked?i=4294967295:(null!=Q("p20fulladmin")&&(1==Q("p20editmesh").checked&&(i+=1),1==Q("p20manageusers").checked&&(i+=2),1==Q("p20managecomputers").checked)&&(i+=4),1==Q("p20remotecontrol").checked&&(i+=8),1==Q("p20meshagentconsole").checked&&(i+=16),1==Q("p20meshserverfiles").checked&&(i+=32),1==Q("p20wakedevices").checked&&(i+=64),1==Q("p20editnotes").checked&&(i+=128),1==Q("p20remoteview").checked&&(i+=256),1==Q("p20nodesktop").checked&&(i+=65536),1==Q("p20noterminal").checked&&(i+=512),1==Q("p20nofiles").checked&&(i+=1024),1==Q("p20noamt").checked&&(i+=2048),1!=Q("p20remotelimitedinput").checked||Q("p20remoteview").checked||(i+=4096),1==Q("p20limitevents").checked&&(i+=8192),1==Q("p20chatnotify").checked&&(i+=16384),1==Q("p20uninstall").checked&&(i+=32768),1==Q("p20commands").checked&&(i+=131072),1==Q("p20resetoff").checked&&(i+=262144),!1===serverinfo.guestdevicesharing||1!=Q("p20guestshare").checked||!Q("p20remoteview").checked&&(Q("p20remoteview").checked||Q("p20remotelimitedinput").checked)||(i+=524288),1==Q("p20details").checked&&(i+=1048576),1==Q("p20relay").checked&&(i+=2097152)),0==(8&i)&&(256&i&&(i-=256),512&i&&(i-=512),1024&i&&(i-=1024),2048&i&&(i-=2048),4096&i&&(i-=4096),65536&i)&&(i-=65536),1===t){var a=decodeURIComponent(Q("dp2groupid").value);null!=(r=meshes[a])&&meshserver.send({action:"addmeshuser",meshid:a,meshname:r.name,userids:[currentUser._id],meshadmin:i,remove:2==e})}else if(2===t){var s=decodeURIComponent(Q("dp2groupid").value);null!=(r=meshes[currentMesh._id])&&meshserver.send({action:"addmeshuser",meshid:currentMesh._id,meshname:currentMesh.name,userid:s,meshadmin:i,remove:2==e})}else if(3===t){var r,a=decodeURIComponent(Q("dp2groupid").value);null!=(r=meshes[a])&&meshserver.send({action:"addmeshuser",meshid:a,meshname:r.name,userids:[currentUserGroup._id],meshadmin:i,remove:2==e})}else if(4===t)null!=(n=getNodeFromId(o=decodeURIComponent(Q("dp2nodeid").value)))&&meshserver.send({action:"adddeviceuser",nodeid:o,nodename:n.name,userids:[currentUser._id],rights:i,remove:2==e});else if(5===t){var l=[];for(c in d=Q("dp20username").value.split(","))l.push(d[c].trim());meshserver.send({action:"adddeviceuser",nodeid:currentNode._id,nodename:currentNode.name,usernames:l,rights:i,remove:2==e})}else if(6===t){s=decodeURIComponent(Q("dp2groupid").value);null!=currentNode&&meshserver.send({action:"adddeviceuser",nodeid:currentNode._id,nodename:currentNode.name,userids:[s],rights:i,remove:2==e})}else if(7===t)null!=(n=getNodeFromId(o=decodeURIComponent(Q("dp2nodeid").value)))&&meshserver.send({action:"adddeviceuser",nodeid:o,nodename:n.name,userids:[currentUserGroup._id],rights:i,remove:2==e});else if(null==t){var d,c,l=[];for(c in d=Q("dp20username").value.split(","))l.push(d[c].trim());meshserver.send({action:"addmeshuser",meshid:currentMesh._id,meshname:currentMesh.name,usernames:l,meshadmin:i,remove:2==e})}else meshserver.send({action:"addmeshuser",meshid:currentMesh._id,meshname:currentMesh.name,userids:[t],meshadmin:i,remove:2==e})}function p20viewuser(e){var t,o,n,i,a,s;xxdialogMode||(t=decodeURIComponent(e),o=GetMeshRights(currentMesh),n=GetMeshRights(currentMesh,t),userinfo._id!=t&&(4294967295==o||0!=(2&o)&&4294967295!=n)?p20showAddMeshUserDialog(e):(e=[],4294967295==n?e.push("Administrador Total (todos los permisos)"):(0!=(1&n)&&e.push("Editar Grupo de Dispositivos"),0!=(2&n)&&e.push("Administrar Usuarios del Grupo de Dispositivos"),0!=(4&n)&&e.push("Administrar Computadoras del Grupo de Dispositivos"),0!=(8&n)&&e.push("Control Remoto"),0!=(16&n)&&e.push("Consola de Agente"),0!=(32&n)&&e.push("Archivos del Servidor"),0!=(64&n)&&e.push("Despertar Dispositivos"),0!=(128&n)&&e.push("Editar Notas"),0!=(8&n)&&0!=(256&n)&&e.push("Sólo Vista Remota"),0!=(8&n)&&0!=(65536&n)&&e.push("Sin Escritorio"),0!=(8&n)&&0!=(512&n)&&e.push("Sin Terminal"),0!=(8&n)&&0!=(1024&n)&&e.push("Sin Archivos"),0!=(8&n)&&0!=(2048&n)&&e.push("Sin Intel&reg; AMT"),0!=(8&n)&&0!=(4096&n)&&0==(256&n)&&e.push("Entrada Limitada"),0!=(8192&n)&&e.push("Sólo Eventos Propios"),0!=(16384&n)&&e.push("Chatear & Notificar"),0!=(32768&n)&&e.push("Desinstalar"),0!=(131072&n)&&e.push("Comandos"),0!=(262144&n)&&e.push("Reset/Apagado"),0!=(524288&n)&&e.push("Intercambio"),0!=(1048576&n)&&e.push("Detalles"),0!=(2097152&n)&&e.push("Relé")),0==e.length&&e.push("Sin Permisos"),i=t.split("/")[2],users&&users[t]&&(i=users[t].name),userinfo._id==t&&(i=userinfo.name),a=1,s=addHtmlValue("Nombre de Usuario",EscapeHtml(decodeURIComponent(i))),t.split("/")[2]!=i&&(s+=addHtmlValue("Identificador de Usuario",EscapeHtml(t.split("/")[2]))),s+=addHtmlValue("Permisos",e.join(", ")),userinfo._id!=t&&(4294967295==o||0!=(2&o)&&4294967295!=n)&&(a+=4),setModalContent("xxAddAgent","Usuario de Grupo de Dispositivos",s),showModal("xxAddAgentModal","idx_dlgOkButton",()=>p20viewuserEx(a,t))))}function p20viewuserEx(e,t){2==e&&(e=t.split("/")[2],users&&users[t]&&(e=users[t].name),usergroups&&usergroups[t]&&(e=usergroups[t].name),userinfo._id==t&&(e=userinfo.name),t.startsWith("user/")&&setModalContent("xxAddAgent","Remover Permisos de Usuario",format('¿Confirmar la eliminación de los permisos del usuario "{0}"?',EscapeHtml(decodeURIComponent(e)))),t.startsWith("ugrp/")&&setModalContent("xxAddAgent","Remover Permisos de Grupo de Usuarios",format('¿Confirmar la eliminación de los permisos para el grupo de usuarios "{0}"?',EscapeHtml(decodeURIComponent(e))),t),showModal("xxAddAgentModal","idx_dlgOkButton",()=>p20viewuserEx2(3,t)))}function p20deleteUser(e,t){return haltEvent(e),p20viewuserEx(2,decodeURIComponent(t)),!1}function p20viewuserEx2(e,t){meshserver.send({action:"removemeshuser",meshid:currentMesh._id,meshname:currentMesh.name,userid:t})}function p20editmeshInviteCode(){if(xxdialogMode)return!1;var e,t=GetMeshRights(currentMesh),o=serverinfo.name;-1!=o.indexOf(".")&&0==(2&features)||(o=window.location.hostname),o=1==serverinfo.https?"https://"+o+(443==serverinfo.port?"":":"+serverinfo.port)+domainUrl+"invite"+(urlargs.key?"?key="+urlargs.key:""):"http://"+o+(80==serverinfo.port?"":":"+serverinfo.port)+domainUrl+"invite"+(urlargs.key?"?key="+urlargs.key:""),1&t?(setModalContent("xxAddAgent","Códigos de Invitación",e=(e=(e=(e=(e="Cuando está habilitado, cualquiera puede usar códigos de invitación para unir dispositivos a este grupo de dispositivos mediante el siguiente enlace público:<br /><br />")+('<div style=width:100%;text-align:center><a rel="noreferrer noopener" target=_blank href="'+o+'">'+o+"</a></div><br />")+'<div style=margin-bottom:5px><label><input id=agentJoinCheck type=checkbox class="form-check-input me-2" onclick=p20editmeshInviteCodeValidate() />Habilitar Códigos de Invitación</label></div>')+addHtmlFormFloating("Códigos de Invitación",'<input id=agentInviteCode class="form-control" onkeyup=p20editmeshInviteCodeValidate() placeholder="code1, code2, code3" />'))+addHtmlFormFloating("Agentes",'<select id=agentType class="form-select" onchange=p20editmeshInviteCodeValidate()><option value=0>Todos los agentes disponibles</option><option value=1>Agente de malla de Windows</option><option value=2>Agente de malla de Linux</option><option value=4>Agente de malla de macOS</option><option value=8>Asistente MeshCentral</option></select>')+"<div id=d2agentInstallTypeDiv>")+addHtmlFormFloating("Tipo de Instalación",'<select id=agentInviteType class="form-select"><option value=0>Segundo plano e interactivo</option><option value=2>Segundo plano solamente</option><option value=1>Sólo Interactivo</option></select>')+"</div>"),showModal("xxAddAgentModal","idx_dlgOkButton",p20editmeshInviteCodeEx),null!=currentMesh.invite&&(Q("agentJoinCheck").checked=!0,Q("agentInviteCode").value=currentMesh.invite.codes.join(", "),currentMesh.invite.ag&&(Q("agentType").value=currentMesh.invite.ag),Q("agentInviteType").value=3&currentMesh.invite.flags),p20editmeshInviteCodeValidate()):(e="Los códigos de invitación pueden ser usados por cualquiera para unir dispositivos a este grupo de dispositivos usando el siguiente enlace público:<br /><br />",setModalContent("xxAddAgent","Códigos de Invitación",e=(e=(e+='<div style=width:100%;text-align:center><a rel="noreferrer noopener" target=_blank href="'+o+'">'+o+"</a></div><br />")+addHtmlValue("Códigos de Invitación",currentMesh.invite.codes.join(", ")))+addHtmlValue("Tipo de Instalación",["Segundo plano e interactivo","Sólo Interactivo","Segundo plano solamente"][3&currentMesh.invite.flags])),showModal("xxAddAgentModal","idx_dlgOkButton"))}function p20editmeshInviteCodeValidate(){var e,t=!0,o=Q("agentInviteCode").value.split(",");for(e in o)o[e]=o[e].trim(),""==o[e]&&(t=!1);QE("agentInviteCode",Q("agentJoinCheck").checked),QE("agentType",Q("agentJoinCheck").checked),QE("agentInviteType",Q("agentJoinCheck").checked),QE("idx_dlgOkButton",0==Q("agentJoinCheck").checked||t),QV("d2agentInstallTypeDiv",parseInt(Q("agentType").value)<2)}function p20editmeshInviteCodeEx(){if(1==Q("agentJoinCheck").checked){var e,t=Q("agentInviteCode").value.split(",");for(e in t)t[e]=t[e].trim();meshserver.send({action:"editmesh",meshid:currentMesh._id,invite:{codes:t,flags:parseInt(Q("agentInviteType").value),ag:parseInt(Q("agentType").value)}})}else meshserver.send({action:"editmesh",meshid:currentMesh._id,invite:"*"})}function p20editMeshNotify(){var e,t,o;return xxdialogMode||(e=0,t=16384&features2&&userinfo.emailVerified,userinfo.links&&userinfo.links[currentMesh._id]&&userinfo.links[currentMesh._id].notify&&(e|=userinfo.links[currentMesh._id].notify),userinfo.notify&&userinfo.notify[currentMesh._id]&&(e|=userinfo.notify[currentMesh._id]),o='<div style="border-bottom: 1px solid #888;margin-bottom:3px">Notificaciones de página web</div><div class="form-check"><label><input id=p20notifyIntelDeviceConnect class="form-check-input me-2" type=checkbox />Conexiones de dispositivo</label></div><div class="form-check"><label><input id=p20notifyIntelDeviceDisconnect class="form-check-input me-2" type=checkbox />Desconexiones de dispositivo</label></div>',currentMesh.mtype<3&&(o+='<div class="form-check"><label><input id=p20notifyIntelAmtKvmActions class="form-check-input me-2" type=checkbox />Eventos de escritorio y serial de Intel&reg; AMT</label></div>'),t&&(o+='<br /><div style="border-bottom: 1px solid #888;margin-bottom:3px">Notificaciones por correo electrónico</div><div class="form-check"><label><input id=p20enotifyIntelDeviceConnect class="form-check-input me-2" type=checkbox />Conexiones de dispositivo</label></div><div class="form-check"><label><input id=p20enotifyIntelDeviceDisconnect class="form-check-input me-2" type=checkbox />Desconexiones de dispositivo</label></div><div class="form-check"><label><input id=p20enotifyIntelDeviceHelp class="form-check-input me-2" type=checkbox />Solicitudes de ayuda</label></div>'),null!=userinfo.msghandle&&0!=(33554432&features2)&&(o+='<br /><div style="border-bottom: 1px solid #888;margin-bottom:3px">Notificaciones de Mensajería</div><div class="form-check"><label><input id=p20emsgDeviceConnect class="form-check-input me-2" type=checkbox />Conexiones de dispositivo</label></div><div class="form-check"><label><input id=p20emsgDeviceDisconnect class="form-check-input me-2" type=checkbox />Desconexiones de dispositivo</label></div><div class="form-check"><label><input id=p20emsgDeviceHelp class="form-check-input me-2" type=checkbox />Solicitudes de ayuda</label></div>'),setModalContent("xxAddAgent","Opciones de Notificación",o),showModal("xxAddAgentModal","idx_dlgOkButton",p20editMeshNotifyEx),Q("p20notifyIntelDeviceConnect").checked=2&e,Q("p20notifyIntelDeviceDisconnect").checked=4&e,currentMesh.mtype<3&&(Q("p20notifyIntelAmtKvmActions").checked=8&e),t&&(Q("p20enotifyIntelDeviceConnect").checked=16&e,Q("p20enotifyIntelDeviceDisconnect").checked=32&e,Q("p20enotifyIntelDeviceHelp").checked=64&e),null!=userinfo.msghandle&&0!=(33554432&features2)&&(Q("p20emsgDeviceConnect").checked=128&e,Q("p20emsgDeviceDisconnect").checked=256&e,Q("p20emsgDeviceHelp").checked=512&e)),!1}function p20editMeshNotifyEx(e,t){var o=0,o=(o+=Q("p20notifyIntelDeviceConnect").checked?2:0)+(Q("p20notifyIntelDeviceDisconnect").checked?4:0);currentMesh.mtype<3&&(o+=Q("p20notifyIntelAmtKvmActions").checked?8:0),t&&(o=(o=(o+=Q("p20enotifyIntelDeviceConnect").checked?16:0)+(Q("p20enotifyIntelDeviceDisconnect").checked?32:0))+(Q("p20enotifyIntelDeviceHelp").checked?64:0)),null!=userinfo.msghandle&&0!=(33554432&features2)&&(o=(o=(o+=Q("p20emsgDeviceConnect").checked?128:0)+(Q("p20emsgDeviceDisconnect").checked?256:0))+(Q("p20emsgDeviceHelp").checked?512:0)),meshserver.send({action:"changemeshnotify",meshid:currentMesh._id,notify:o})}function setupMeshSummaryStats(){window.meshPowerChart=new Chart(document.getElementById("meshPowerChart").getContext("2d"),{type:"doughnut",data:{datasets:[{data:[0,0],backgroundColor:["#20F","#40D","#60B","#809","#A07","#C05"]}]},options:{shadowColor:"blue",responsive:!0,plugins:{legend:{display:!1}},animation:{animateScale:!0,animateRotate:!0},layout:{padding:{left:10,right:10,top:10,bottom:10}}}}),window.meshOsChart=new Chart(document.getElementById("meshOsChart").getContext("2d"),{type:"doughnut",data:{datasets:[{data:[0,0],backgroundColor:["#20F","#30E","#40D","#50C","#60B","#70A","#809","#908","#A07","#B06","#C05"]}]},options:{responsive:!0,plugins:{legend:{display:!1}},animation:{animateScale:!0,animateRotate:!0},layout:{padding:{left:10,right:10,top:10,bottom:10}}}}),window.meshConnChart=new Chart(document.getElementById("meshConnChart").getContext("2d"),{type:"doughnut",data:{datasets:[{data:[0,0],backgroundColor:["#20F","#40D","#60B","#809","#A07","#C05"]}],labels:["No Conectado","Agente","Intel&reg; AMT","Agente + Intel&reg; AMT"]},options:{responsive:!0,plugins:{legend:{display:!1}},animation:{animateScale:!0,animateRotate:!0},layout:{padding:{left:10,right:10,top:10,bottom:10}}}}),window.meshSecurityChart=new Chart(document.getElementById("meshSecurityChart").getContext("2d"),{type:"doughnut",data:{datasets:[{data:[0,0],backgroundColor:["#20F","#40D","#60B","#809","#A07","#C05"]}],labels:["OK","Antivirus inactivo","Sin actualización automática","Cortafuegos no activo","Múltiples Problemas"]},options:{responsive:!0,plugins:{legend:{display:!1}},animation:{animateScale:!0,animateRotate:!0},layout:{padding:{left:10,right:10,top:10,bottom:10}}}})}function p21updateMesh(){if(null!=currentMesh){var e,t=GetMeshRights(currentMesh),o=EscapeHtml(currentMesh.name),n=(0==o.length&&(o="<i>Ninguno</i>"),0!=(1&t)&&(o='<span tabindex=0 title="Haz clic aquí para editar el nombre del grupo de dispositivos" onclick=p20editmesh(1) onkeyup="if (event.key == \'Enter\') p20editmesh(1)" role=button>'+o+' <i class="fa-solid fa-pencil fa-2xs"></i></span>'),QH("p21meshName",o),{}),i={},a=[0,0,0,0],s=[0,0,0,0,0],r=!1,l=!1,d=!1,c=!1;for(y in nodes)nodes[y].meshid==currentMesh._id&&(nodes[y].agent&&(r=!0,null==n[nodes[y].agent.id]?n[nodes[y].agent.id]=1:n[nodes[y].agent.id]++),nodes[y].pwr&&(l=!0,null==i[nodes[y].pwr]?i[nodes[y].pwr]=1:i[nodes[y].pwr]++),0==nodes[y].conn?(d=!0,a[0]++):0!=(6&nodes[y].conn)?(d=!0,0!=(1&nodes[y].conn)?a[3]++:a[2]++):0!=(1&nodes[y].conn)&&(d=!0,a[1]++),nodes[y].wsc)&&(c=!0,e=0,"OK"==nodes[y].wsc.antiVirus&&e++,"OK"==nodes[y].wsc.autoUpdate&&e++,"OK"==nodes[y].wsc.firewall&&e++,3==e?s[0]++:e<2?s[4]++:"OK"!=nodes[y].wsc.antiVirus?s[1]++:"OK"!=nodes[y].wsc.autoUpdate?s[2]++:"OK"!=nodes[y].wsc.firewall&&s[3]++);var u=[],p=[],m=[],g=[],v=3==currentMesh.mtype?agentsStrNoAgent:agentsStr;for(y in n)u.push(n[y]),p.push(v[y]);for(y in i)m.push(i[y]),g.push(powerStatetable[y]);window.meshPowerChart.config.data.datasets[0].data=m,window.meshPowerChart.config.data.labels=g,window.meshPowerChart.update(),2<=currentMesh.mtype&&(window.meshOsChart.config.data.datasets[0].data=u,window.meshOsChart.config.data.labels=p,window.meshOsChart.update()),window.meshConnChart.config.data.datasets[0].data=a,window.meshConnChart.update(),window.meshSecurityChart.config.data.datasets[0].data=s,window.meshSecurityChart.update();var h="",f=0;if(0<m.length){var x=[];for(y in i)x.push([powerStatetable[y],i[y]]);for(y in x.sort(function(e,t){return-(e[1]-t[1])}),h+='<table class="table table-hover table-striped" border=0 cellpadding=2 cellspacing=0 width=100%><tbody><tr style=background-color:#AAAAAA;font-weight:bold><th scope=col colspan=2 style=text-align:left;width:430px>Estados de Encendido</th></tr>',x)h+="<tr style="+(++f%2==0?"background-color:#DDD":"")+"><td style=text-align:right;width:60px>"+x[y][1]+" <td> "+x[y][0]+"</tr>";h+="</tbody></table>"}if(0<u.length&&2<=currentMesh.mtype){var f=0,k=[];for(y in n)k.push([v[y],n[y]]);for(y in k.sort(function(e,t){return-(e[1]-t[1])}),h+='<table class="table table-hover table-striped" border=0 cellpadding=2 cellspacing=0 width=100%><tbody><tr style=background-color:#AAAAAA;font-weight:bold><th scope=col colspan=2 style=text-align:left;width:430px>Tipos de Agente</th></tr>',k)h+="<tr style="+(++f%2==0?"background-color:#DDD":"")+"><td style=text-align:right;width:60px>"+k[y][1]+"<td> "+k[y][0]+"</tr>";h+="</tbody></table>"}if(d){for(var b=[],y=f=0;y<4;y++)b.push([["No Conectado","Agente","Intel&reg; AMT","Agente + Intel&reg; AMT"][y],a[y]]);b.sort(function(e,t){return-(e[1]-t[1])}),h+='<table class="table table-hover table-striped" border=0 cellpadding=2 cellspacing=0 width=100%><tbody><tr style=background-color:#AAAAAA;font-weight:bold><th scope=col colspan=2 style=text-align:left;width:430px>Conectividad</th></tr>';for(y=0;y<4;y++)0<b[y][1]&&(h+="<tr style="+(++f%2==0?"background-color:#DDD":"")+"><td style=text-align:right;width:60px>"+b[y][1]+"<td> "+b[y][0]+"</tr>");h+="</tbody></table>"}if(c){for(var w=[],y=f=0;y<4;y++)w.push([['<img src="images/link2.png" style=cursor:pointer onclick=\'return p21setDevicesFilter("wsc:ok")\' width=10 height=10 /> OK','<img src="images/link2.png" style=cursor:pointer onclick=\'return p21setDevicesFilter("wsc:noav")\' width=10 height=10 /> Antivirus inactivo','<img src="images/link2.png" style=cursor:pointer onclick=\'return p21setDevicesFilter("wsc:noupdate")\' width=10 height=10 /> Sin actualización automática','<img src="images/link2.png" style=cursor:pointer onclick=\'return p21setDevicesFilter("wsc:nofirewall")\' width=10 height=10 /> Cortafuegos no activo','<img src="images/link2.png" style=cursor:pointer onclick=\'return p21setDevicesFilter("wsc:any")\' width=10 height=10 /> Múltiples Problemas'][y],s[y]]);w.sort(function(e,t){return-(e[1]-t[1])}),h+='<table class="table table-hover table-striped" border=0 cellpadding=2 cellspacing=0 width=100%><tbody><tr style=background-color:#AAAAAA;font-weight:bold><th scope=col colspan=2 style=text-align:left;width:430px>Seguridad</th></tr>';for(y=0;y<4;y++)0<w[y][1]&&(h+="<tr style="+(++f%2==0?"background-color:#DDD":"")+"><td style=text-align:right;width:60px>"+w[y][1]+"<td> "+w[y][0]+"</tr>");h+="</tbody></table>"}""==h&&(h="<i>No hay dispositivos en este grupo de dispositivos.</i>"),QH("p21info",h);t=(l?1:0)+(2<=currentMesh.mtype&&r?1:0)+(d?1:0)+(c?1:0);QS("meshPowerChartDiv").display=l?"inline-block":"none",QS("meshOsChartDiv").display=2<=currentMesh.mtype&&r?"inline-block":"none",QS("meshConnChartDiv").display=d?"inline-block":"none",QS("meshSecurityChartDiv").display=c?"inline-block":"none",QS("meshPowerChartDiv").width=3<t?"23%":"31%",QS("meshOsChartDiv").width=3<t?"23%":"31%",QS("meshConnChartDiv").width=3<t?"23%":"31%",QS("meshSecurityChartDiv").width=3<t?"23%":"31%"}}function p21setDevicesFilter(e){go(1),Q("KvmSearchInput").value=Q("SearchInput").value=e,mainUpdate(5)}var sortorder,filetreelocation=[];function updateFiles(){if(QV("MainMenuMyFiles",0==(8&features)),0==(8&features)){for(var e,t,o="",n="",i='<a href=# style=cursor:pointer onclick="return p5folderup(0)">Raíz</a>',a="Root",s=filetree,r=1,l=[],d=filetreelinkpath,c=[],u=document.getElementsByName("fc"),p=0;p<u.length;p++)u[p].checked&&c.push(u[p].value);for(p in filetreelinkpath="",filetreelocation){if(null==s.f||null==s.f[filetreelocation[p]])break;l.push(filetreelocation[p]),a+=" / "+filetreelocation[p],1==r?(e=filetreelocation[p].split("/"),t=window.location.origin+domainUrl+e[0]+"files/"+e[2],filetreelinkpath+=filetreelocation[p]):""!=filetreelinkpath&&(filetreelinkpath+="/"+filetreelocation[p],2<r)&&(t+="/"+filetreelocation[p]),s=s.f[filetreelocation[p]],i+=' / <a href=# style=cursor:pointer onclick="return p5folderup('+r+')">'+EscapeHtml(null!=s.n?s.n:filetreelocation[p])+"</a>",r++}filetreelocation=l;var m=a.toLowerCase().startsWith("root / "+userinfo._id+" / public"),g=p5sort_files(s.f);for(p in g){var v,h,f=g[p],x=f.n,k=70<x.length?'<span title="'+EscapeHtml(x)+'">'+EscapeHtml(x.substring(0,70))+"...</span>":EscapeHtml(x),b="",y=(null!=f.d&&(b=printDateTime(new Date(f.d))+"&nbsp;"),""),w=(null!=f.s&&(y=getFileSizeStr(f.s)),"");w=f.t<3||4==f.t?(v=1==f.t||4==f.t?p5getQuotabar(f):"",'<div class=filelist file=999><input file=999 style=float:left name=fc class="fcb form-check-input me-2" type=checkbox onchange=p5setActions() value="'+EscapeHtml(x)+'">&nbsp;<span style=float:right title="">'+v+"</span><span><div class=fileIcon"+f.t+' onclick=p5folderset("'+encodeURIComponentEx(f.nx)+'")></div><a href=# style=cursor:pointer onclick=\'return p5folderset("'+encodeURIComponentEx(f.nx)+"\")'>"+k+"</a></span></div>"):(x=k,v="",h=urlargs.key?"&key="+urlargs.key:"",m&&(v='<i class="fa-regular fa-copy" style=cursor:pointer title="Mostrar enlace público" onclick=\'return p5showPublicLink("'+t+"/"+encodeURIComponentEx(f.nx)+"?download=1"+h+'")\'></i> <i class="fa-regular fa-copy" title="Copiar enlance al portapapeles" style="cursor:pointer" onclick=copyTextToClip2("'+encodeURIComponentEx(t+"/"+encodeURIComponentEx(f.nx)+"?download=1"+h)+'")></i>'),0<f.s&&(x=v+'<a onclick=downloadFile("downloadfile.ashx?link='+encodeURIComponentEx(filetreelinkpath+"/"+f.nx)+'")>'+k+"</a>"),'<div class=filelist file=3><input file=3 style=float:left name=fc class="fcb form-check-input me-2" type=checkbox onchange=p5setActions() value="'+f.nx+'">&nbsp;<span class=fsize>'+b+"</span><span style=float:right>"+y+"</span><span><div class=fileIcon"+f.t+"></div>"+x+"</span></div>"),f.t<3?o+=w:n+=w}if(QH("p5rightOfButtons",p5getQuotabar(s)),QH("p5files",o+n),QH("p5currentpath",i),QE("p5FolderUp",0!=filetreelocation.length),QV("p5PublicShare",m),d==filetreelinkpath)for(u=document.getElementsByName("fc"),p=0;p<u.length;p++)u[p].checked=0<=c.indexOf(u[p].value);p5setActions()}}function getNiceSize(e){return e<=0?"El límite de almacenamiento se excede":e<2048?format("{0} bytes restantes",e):e<2097152?format("{0} kilobytes restantes",Math.round(e/1024)):e<2147483648?format("{0} megabytes restantes",Math.round(e/1024/1024)):format("{0} gigabytes restantes",Math.round(e/1024/1024/1024))}function getNiceSize2(e){return e<=0?"Ninguno":e<2048?format("{0} b",e):e<2097152?format("{0} Kb",Math.round(e/1024)):e<2147483648?format("{0} Mb",Math.round(e/1024/1024)):format("{0} Gb",Math.round(e/1024/1024/1024))}function getNiceSize3(e){return e<=0?"Ninguno":e<2048?format("{0} b",e):e<2097152?format("{0} Kb",round(e/1024,1)):e<2147483648?format("{0} Mb",round(e/1024/1024,1)):format("{0} Gb",round(e/1024/1024/1024,1))}function p5getQuotabar(e){for(;1<e.t&&4!=e.t;)e=e.parent;var t,o;return 1!=e.t&&4!=e.t||null==e.maxbytes?"":(t=Math.floor(e.s/1024),o=e.maxbytes-e.s,'<span title="'+(1<e.c?format("{0}k en {1} archivos. {2}k máximo",t,e.c,Math.floor(e.maxbytes/1024/1024)):format("{0}k en 1 archivo. {1}k máximo",t,Math.floor(e.maxbytes/1024/1024)))+'">'+getNiceSize(o)+" <progress style=height:10px;width:100px value="+e.s+" max="+e.maxbytes+" /></span>")}function p5showPublicLink(e){return setModalContent("xxAddAgent","Enlace Público",'<input type=text style=width:350px value="'+e+'" readonly /> <i class="fa-regular fa-copy" title="Copiar enlance al portapapeles" style="cursor:pointer" onclick=copyTextToClip2("'+encodeURIComponentEx(e)+'")></i>'),showModal("xxAddAgentModal","idx_dlgOkButton"),!1}function p5sort_filename(e,t){return e.ln>t.ln?+sortorder:e.ln<t.ln?-1*sortorder:0}function p5sort_timestamp(e,t){return e.d>t.d?+sortorder:e.d<t.d?-1*sortorder:0}function p5sort_bysize(e,t){return e.s==t.s?p5sort_filename(e,t):(e.s-t.s)*sortorder}function p5sort_files(e){var t,o=[],n=Q("p5sortdropdown").value;for(t in e)e[t].nx=t,null==e[t].n&&(e[t].n=t),e[t].ln=e[t].n.toLowerCase(),o.push(e[t]);return sortorder=1,3<n&&(sortorder=-1,n-=3),1==n?o.sort(p5sort_filename):2==n?o.sort(p5sort_bysize):3==n&&o.sort(p5sort_timestamp),o}function p5setActions(){var e=getFileSelCount(),t=getFileCount(),o=getFileSelCount(!1);QE("p5DeleteFileButton",0<e&&0<filetreelocation.length),QE("p5ViewFileButton",1==e&&1==o&&0<filetreelocation.length),QE("p5NewFolderButton",0<filetreelocation.length),QE("p5UploadButton",0<filetreelocation.length),QE("p5DownloadButton",0<e&&e==o&&0<filetreelocation.length),QE("p5RenameFileButton",1==e&&0<filetreelocation.length),QE("p5SelectAllButton",0<t),Q("p5SelectAllButton").value=0<e?"No seleccionar nada":"Seleccionar Todo",QE("p5CutButton",0<o&&e==o),QE("p5CopyButton",0<o&&e==o),QE("p5PasteButton",null!=p5clipboard&&0<p5clipboard.length&&0<filetreelocation.length)}function getFileSelCount(e){for(var t=0,o=document.getElementsByName("fc"),n=0;n<o.length;n++)!o[n].checked||0==e&&"3"!=o[n].attributes.file.value||t++;return t}function getFileSelDirCount(){for(var e=0,t=document.getElementsByName("fc"),o=0;o<t.length;o++)t[o].checked&&"999"==t[o].attributes.file.value&&e++;return e}function getFileCount(){return document.getElementsByName("fc").length}function p5selectallfile(){for(var e=0==getFileSelCount(),t=document.getElementsByName("fc"),o=0;o<t.length;o++)t[o].checked=e;p5setActions()}function setupBackPointers(e){if(null!=e.f){var t,o=0,n=0;for(t in e.f)setupBackPointers(e.f[t]),(e.f[t].parent=e).f[t].s&&(o+=e.f[t].s),e.f[t].c&&(n+=e.f[t].c),3==e.f[t].t&&n++;e.s=o,e.c=n}return e}function getFileSizeStr(e){return 1==(e="number"!=typeof e?0:e)?"1 byte":format("{0} bytes",e)}function p5folderup(e){if(null==e)filetreelocation.pop();else for(;filetreelocation.length>e;)filetreelocation.pop();return updateFiles(),!1}function p5folderset(e){return filetreelocation.push(decodeURIComponent(e)),updateFiles(),!1}function p5createfolder(){setModalContent("xxAddAgent","Nueva Carpeta",'<input type=text id=p5renameinput class="form-control" maxlength=64 onkeyup=p5fileNameCheck(event) />'),showModal("xxAddAgentModal","idx_dlgOkButton",p5createfolderEx),focusTextBox("p5renameinput"),p5fileNameCheck()}function p5createfolderEx(){meshserver.send({action:"fileoperation",fileop:"createfolder",path:filetreelocation,newfolder:Q("p5renameinput").value})}function p5deletefile(){var e=getFileSelCount(),t=0<getFileSelDirCount()?'<br /><br /><label><input type=checkbox class="form-check-input me-2" id=p5recdeleteinput>Eliminado recursivo</label><br>':"<input type=checkbox id=p5recdeleteinput class=\"form-check-input me-2\" style='display:none'>";setModalContent("xxAddAgent","Eliminar",1<e?format("¿Eliminar {0} elementos seleccionados?",e)+t:"¿Eliminar elemento seleccionado?"+t),showModal("xxAddAgentModal","idx_dlgOkButton",p5deletefileEx)}function p5deletefileEx(){for(var e=[],t=document.getElementsByName("fc"),o=0;o<t.length;o++)t[o].checked&&e.push(t[o].value);meshserver.send({action:"fileoperation",fileop:"delete",path:filetreelocation,delfiles:e,rec:Q("p5recdeleteinput").checked})}function p5renamefile(){for(var e,t=document.getElementsByName("fc"),o=0;o<t.length;o++)t[o].checked&&(e=t[o].value);setModalContent("xxAddAgent","Renombrar",'<input type=text id=p5renameinput class="form-control" maxlength=64 onkeyup=p5fileNameCheck(event) value="'+e+'" />'),showModal("xxAddAgentModal","idx_dlgOkButton",p5renamefileEx),focusTextBox("p5renameinput"),p5fileNameCheck()}function p5renamefileEx(e,t){t.newname=Q("p5renameinput").value,meshserver.send(t)}function p5fileNameCheck(e){var t=isFilenameValid(Q("p5renameinput").value);QE("idx_dlgOkButton",t),1==t&&e&&13==e.keyCode&&dialogclose(1)}var isFilenameValid=(()=>{var t=/^[^\\/:\*\?"<>\|]+$/,o=/^\./,n=/^(nul|prn|con|lpt[0-9]|com[0-9])(\.|$)/i;return function(e){return t.test(e)&&!o.test(e)&&!n.test(e)&&"."!=e[0]}})();function p5uploadFile(){setModalContent("xxAddAgent","Cargar Archivo",'<form method=post enctype=multipart/form-data action=uploadfile.ashx target=fileUploadFrame><input type=text name=link style=display:none id=p5uploadpath value="'+encodeURIComponentEx(filetreelinkpath)+'" /><input type=file name=files id=p5uploadinput class="form-control" multiple=multiple onchange="p5updateUploadDialogOk(\'p5uploadinput\')" /><input type=hidden name=authCookie value='+authCookie+' /><input type=submit id=p5loginSubmit class="btn btn-outline-success mt-2" style="display:none" /><span id=p5confirmOverwriteSpan style=display:none><br/><label><input type=checkbox class="form-check-input me-2" id=p5confirmOverwrite onchange="p5updateUploadDialogOk(\'p5uploadinput\')" />¿Confirmar sobrescritura?</label></span></ >'),showModal("xxAddAgentModal","idx_dlgOkButton",p5uploadFileEx),p5updateUploadDialogOk("p5uploadinput")}function p5uploadFileEx(){Q("p5loginSubmit").click()}function p5GetFileInfo(e){var t,o=filetree;for(t in filetreelocation)null!=o.f&&null!=o.f[filetreelocation[t]]&&(o=o.f[filetreelocation[t]]);return o.f[e]}function p5updateUploadDialogOk(){var e=Q("p5uploadinput").files,t=[];for(a in e)null!=e[a].size&&0!=e[a].size&&t.push(e[a]);var o=filetree,n=[],i=0;for(a in filetreelocation)null!=o.f&&null!=o.f[filetreelocation[a]]&&(o=o.f[filetreelocation[a]]);if(QE("idx_dlgOkButton",0<e.length),0<e.length){if(null!=o.f){for(var a in o.f)n.push(a);for(a=0;a<e.length;a++)0<=n.indexOf(e[a].name)&&i++}QV("p5confirmOverwriteSpan",0<i),0<i?QE("idx_dlgOkButton",Q("p5confirmOverwrite").checked):(Q("p5confirmOverwrite").checked=!1,QE("idx_dlgOkButton",!0))}}function p5viewfile(){for(var e,t=document.getElementsByName("fc"),o=0;o<t.length;o++)if(t[o].checked)return null==(e=p5GetFileInfo(t[o].value))?void 0:void(e.s<=204800?meshserver.send({action:"fileoperation",fileop:"get",path:filetreelocation,file:t[o].value,tag:"edit"}):messagebox("Editor de Archivos","Solo se pueden editar archivos de menos de 200k."))}var p5clipboard=null,p5clipboardFolder=null,p5clipboardCut=0;function p5copyFile(e){var t=document.getElementsByName("fc");p5clipboard=[],p5clipboardCut=e,p5clipboardFolder=Clone(filetreelocation);for(var o=0;o<t.length;o++)t[o].checked&&"3"==t[o].attributes.file.value&&p5clipboard.push(t[o].value);p5updateClipview()}function p5pasteFile(){var e="";setModalContent("xxAddAgent","Pegar",e=null!=p5clipboard&&0<p5clipboard.length?format("¿Confirmar {0} de {1} entrada{2} a esta ubicación?",0==p5clipboardCut?"copy":"move",p5clipboard.length,1<p5clipboard.length?"s":""):e),showModal("xxAddAgentModal","idx_dlgOkButton",p5pasteFileEx)}function p5pasteFileEx(){meshserver.send({action:"fileoperation",fileop:0==p5clipboardCut?"copy":"move",scpath:p5clipboardFolder,path:filetreelocation,names:p5clipboard}),p5folderup(999),1==p5clipboardCut&&(p5clipboardFolder=p5clipboard=null,p5clipboardCut=0,p5updateClipview())}function p5updateClipview(){var e="";null!=p5clipboard&&0<p5clipboard.length&&(e=format("Manteniendo {0} entrada{1} para {2}",p5clipboard.length,1<p5clipboard.length?"s":"",0==p5clipboardCut?"copiar":"mover")+', <a href=# onclick="return p5clearClip()" style=cursor:pointer>Eliminar</a>.'),QH("p5bottomstatus",e),p5setActions()}function p5clearClip(){return p5clipboardFolder=p5clipboard=null,p5clipboardCut=0,p5updateClipview(),!1}function p5fileDragDrop(e){if(!xxdialogMode&&(haltEvent(e),QV("bigfail",!1),QV("bigok",!1),null!=e.dataTransfer)){var t=[];for(a in e.dataTransfer.files)null!=e.dataTransfer.files[a].size&&0!=e.dataTransfer.files[a].size&&t.push(e.dataTransfer.files[a]);if(0!=t.length){var o=filetree,n=[],i=0;for(a in filetreelocation)null!=o.f&&null!=o.f[filetreelocation[a]]&&(o=o.f[filetreelocation[a]]);if(null!=o.f){for(var a in o.f)n.push(a);for(a=0;a<e.dataTransfer.files.length;a++)0<=n.indexOf(e.dataTransfer.files[a].name)&&i++}0==i?p5PerformUpload(1,e.dataTransfer.files):(setModalContent("xxAddAgent","Cargar Archivo",format(1==i?"La carga sobrescribirá 1 archivo. ¿Continuar?":"La carga sobrescribirá {0} archivos. ¿Continuar?",i)),showModal("xxAddAgentModal","idx_dlgOkButton",()=>p5PerformUpload(3,e.dataTransfer.files)))}}}function p5PerformUpload(e,t){var o=0;p5uploadFile();try{Q("p5uploadinput").files=t}catch(e){o=1}if(0==o&&p5uploadFileEx(),setDialogMode(0),1==o&&0!=filetreelocation.length){for(var n=[],i=[],a=[],s=[],r=t.length,l=0,d=0;d<t.length;d++)l+=t[d].size;if(13e5<l)p5uploadFile();else for(d=0;d<t.length;d++){var c=new FileReader,u=t[d];n.push(u.name),i.push(u.size),a.push(u.type),c.onload=function(e){s.push(e.target.result),0==--r&&(Q("p5fileDragName").value=n.join("*"),Q("p5fileDragSize").value=i.join("*"),Q("p5fileDragType").value=a.join("*"),Q("p5fileDragData").value=s.join("*"),Q("p5fileDragLink").value=encodeURIComponentEx(filetreelinkpath),Q("p5fileDragAuthCookie").value=authCookie,Q("p5loginSubmit2").click())},c.readAsDataURL(u)}}}var p5dragtimer=null;function p5fileDragOver(e){xxdialogMode||(haltEvent(e),null!=p5dragtimer&&(clearTimeout(p5dragtimer),p5dragtimer=null),e=!0,0==filetreelocation.length&&(e=!1),QV("bigok",e),QV("bigfail",!e))}function p5fileDragLeave(e){xxdialogMode||(haltEvent(e),"p5filetable"!=e.target.id?(QV("bigfail",!1),QV("bigok",!1)):p5dragtimer=setTimeout(function(){QV("bigfail",!1),QV("bigok",!1),p5dragtimer=null},10))}function p5downloadButton(){for(var e=document.getElementsByName("fc"),t=0;t<e.length;t++)e[t].checked&&downloadFile("downloadfile.ashx?link="+encodeURIComponentEx(filetreelinkpath+"/"+e[t].value))}var eventsMessageId={1:"Cuenta de Ingreso",2:"Cerrar sesión de cuenta",3:"Idioma cambiado de {1} a {2}",4:"Se unió a la sesión multiplex de escritorio",5:"Dejó la sesión multiplex de escritorio",6:"Sesión multiplex de escritorio iniciada",7:"Grabación de la sesión finalizada, {0} segundo(s)",8:"Sesión multiplex de escritorio cerrada, {0} segundo(s)",9:'Sesión de relay finalizada "{0}" de {1} a {2}, {3} segundo(s)',10:'Sesión de terminal finalizada "{0}" de {1} a {2}, {3} segundo(s)',11:'Sesión de escritorio finalizada "{0}" de {1} a {2}, {3} segundo(s)',12:'Sesión de gestión de archivos finalizada "{0}" de {1} a {2}, {3} segundo(s)',13:'Sesión de retransmisión iniciada "{0}" de {1} a {2}',14:'Sesión de terminal iniciada "{0}" de {1} a {2}',15:'Sesión de escritorio iniciada "{0}" de {1} a {2}',16:'Sesión de administración de archivos iniciada "{0}" de {1} a {2}',17:'Procesando comando de consola: "{0}"',18:'Mostrando cuadro de mensaje, título = "{0}", mensaje = "{1}"',19:"Finalización del proceso {0}",20:"Apertura: {0}",21:"Obteniendo contenido del portapapeles, {0} byte(s)",22:"Configuración del contenido del portapapeles, {0} byte(s)",23:"Intentando la activación del modo Intel (R) AMT ACM",24:"Ejecutando comandos",25:"Realizando acción de energía = {0}, forzado = {1}",26:'Mostrando mensaje de brindis, título = "{0}", mensaje = "{1}"',27:"Solicitud de terminal remota aceptada por el usuario local",28:"Solicitud de terminal remota rechazada por el usuario local",29:"Conexión de escritorio remoto cerrada con fuerza por el usuario local",30:"Iniciar el escritorio remoto después de que el usuario local aceptó",31:"Barra de Conexión de Escritorio Remoto Activada/Actualizada",32:"La barra de conexión de escritorio remoto falla o no es compatible",33:"Conexión de escritorio remoto cerrada con fuerza por el usuario local",34:"No se pudo iniciar el escritorio remoto después de que el usuario local rechazó",35:"Escritorio remoto iniciado con notificación flotante (Toast)",36:"Escritorio remoto iniciado sin notificación",37:"Barra de Conexión de Escritorio Remoto Activada/Actualizada",38:"La Barra de Conexión de Escritorio Remoto Falló o no es Compatible",39:"Conexión de escritorio remoto cerrada con fuerza por el usuario local",40:"Iniciar archivos remotos después de que el usuario local aceptó",41:"Error al iniciar archivos remotos después de que el usuario local rechazó",42:"Archivos remotos iniciados con notificación de tributos",43:"Archivos remotos iniciados sin notificación",44:'Crear carpeta: "{0}"',45:'Eliminar: "{0}"',46:'Eliminar recursivo: "{0}", {1} elemento(s) eliminado',47:'Eliminar: "{0}", {1} elemento(s) eliminado',48:'Cambiar Nombre: "{0}" a "{1}"',49:'Descargar: "{0}"',50:'Subir: "{0}"',51:'Copiar: "{0}" a "{1}"',52:'Mover: "{0}" a "{1}"',53:"Bloquear al usuario remoto fuera del escritorio",54:"El agente cerró la sesión con {0}% de compresión de agente a servidor. Enviado: {1}, comprimido: {2}",55:"Grupo de dispositivos creado: {0}",56:"Grupo de dispositivos recuperado: {0}",57:"Dispositivo agregado {0} al grupo de dispositivos {1}",58:"Dispositivo solicitado activación de Intel (R) AMT ACM, FQDN: {0}",59:"Dispositivo cambiado {0} del grupo {1}: {2}",60:"Derechos de dispositivo de usuario eliminados para {0}",61:"Derechos de dispositivo de usuario modificados para {0}",62:"Usuario eliminado {0} del grupo de usuarios {1}",63:"Cuenta eliminada",64:"Cuenta creada, el nombre de usuario es {0}",65:"Cuenta creada, el correo electrónico es {0}",66:"Cuenta cambiada: {0}",67:"La membresía del grupo de usuarios cambió: {0}",68:"Se agregó el grupo de usuarios {0} al grupo de dispositivos {1}",69:"Grupo de usuarios creado: {0}",70:"Se quitó el grupo de usuarios {0} del grupo de dispositivos {1}",71:"Usuario agregado {0} al grupo de usuarios {1}",72:"Usuario eliminado {0} del grupo de usuarios {1}",73:"La notificación del grupo de dispositivos cambió",74:"Se cambió la contraseña de la cuenta: {0}",75:"Credenciales de cuenta cambiadas",76:"Grupo de dispositivos creado: {0}",77:"Grupo de dispositivos eliminado: {0}",78:"La membresía del grupo de dispositivos cambió: {0}",79:"El grupo de usuarios cambió: {0}",80:"Usuario agregado {0} al grupo de usuarios {1}",81:"Derechos de dispositivo de usuario eliminados para {0}",82:"Derechos de dispositivo de usuario modificados para {0}",83:"Se eliminó al usuario {0} del grupo de dispositivos {1}",84:"Dispositivo agregado {0} al grupo de dispositivos {1}",85:"Se movió el dispositivo {0} al grupo {1}",86:"Derechos de dispositivo de usuario eliminados para {0}",87:"Dispositivo eliminado {0} del grupo de dispositivos {1}",88:"Autenticación de correo electrónico de dos factores habilitada",89:"Autenticación de dos factores de correo electrónico deshabilitada",90:"Aplicación de autenticación agregada",91:"Aplicación de autenticación eliminada",92:"Se generaron nuevos códigos de respaldo 2FA",93:"Códigos de seguridad 2FA borrados",94:"Llave de seguridad eliminada",95:"Llave de seguridad agregada",96:"Número de teléfono verificado del usuario {0}",97:"Número de teléfono eliminado del usuario {0}",98:"Ayuda Solicitada, usuario: {0}, detalles: {1}",99:"Ejecutando comandos como usuario",100:"Ejecutar comandos como usuario si es posible",101:"Se agregó el recurso compartido de dispositivo {0} de {1} a {2}",102:"Compartir dispositivo eliminado {0}",103:"Carga por lotes de {0} archivo (s) a la carpeta {1}",104:'Descarga automatizada del archivo de volcado del núcleo del agente: "{0}"',105:'Subir: "{0}", Tamaño: {1}',106:'Descarga: "{0}", Tamaño: {1}',107:"Acceso a la cuenta de {0}, {1}, {2}",108:"Intento de inicio de sesión del usuario con un segundo factor incorrecto de {0}, {1}, {2}",109:"Intento de inicio de sesión del usuario en una cuenta bloqueada de {0}, {1}, {2}",110:"Intento de inicio de sesión de usuario no válido de {0}, {1}, {2}",111:"Dispositivo solicitado activación Intel (R) AMT ACM TLS, FQDN: {0}",112:'Sesión de mensajería finalizada "{0}" de {1} a {2}, {3} segundo (s)',113:"Dispositivo de autenticación de notificaciones push agregado",114:"Dispositivo de autenticación de notificaciones push eliminado",115:"Token de inicio de sesión agregado",116:"Token de inicio de sesión eliminado",117:"Esta es una versión antigua del agente, considera actualizar.",118:"Este agente tiene un mecanismo de validación de certificados obsoleto, considera la posibilidad de actualizarlo.",119:"Este agente está utilizando túneles inseguros, considera actualizar.",120:'Sesión de relé local iniciada "{0}", protocolo {1} a {2}',121:'Sesión de relay local finalizada "{0}", protocolo {1} a {2}, {3} segundo(s)',122:"Abandonar la sesión de escritorio multiplexada tras {0} segundo(s).",123:'Salió de la sesión Web-SSH "{1}" después de {0} segundo(s).',124:'Salió de la sesión Web-SFTP "{1}" después de {0} segundo(s).',125:'Salió de la sesión Web-RDP "{1}" después de {0} segundo(s).',126:"Abandonar la sesión Web-VNC tras {0} segundo(s).",127:"Cambiado el nombre visible de la cuenta a {0}.",128:"Cuenta creada, el nombre es {0}.",129:"Eliminado el nombre visible de la cuenta.",130:"Han cambiado las notificaciones del usuario",131:"Dispositivo compartido {0} agregado con tiempo ilimitado.",132:"Encender.",133:"Apagar.",134:"Sesión de escritorio desconectada a la fuerza del usuario {0}",135:"Sesión de terminal desconectada a la fuerza del usuario {0}",136:"Sesión de archivos desconectada a la fuerza del usuario {0}",137:"Sesión de enrutamiento desconectada a la fuerza del usuario {0}",138:"Dispositivo compartido compartido {0} recurrente diariamente.",139:"Dispositivo compartido {0} recurrente semanalmente.",140:"Dispositivo cambiado {0} del grupo {1}: {2}",141:"Cambio de política de Intel(r) AMT",142:"Se cambió el grupo de dispositivos {0}: {1}",143:'Se unió a la sesión múltiplex de escritorio "{0}"',144:'Salió de la sesión multiplex de escritorio "{0}" después de {1} segundo(s).',145:'Sesión múltiplex de escritorio iniciada "{0}"',146:'Sesión de grabación finalizada "{0}", {1} segundo(s)',147:'Sesión múltiplex de escritorio cerrada "{0}", {1} segundo(s)',148:'Sesión Web-SSH iniciada "{0}".',149:'Sesión de Web-SFTP iniciada "{0}".',150:'Sesión Web-RDP iniciada "{0}".',151:'Sesión Web-VNC iniciada "{0}".',152:'Ya no es un repetidor para "{0}".',153:'Es un relé para "{0}".',154:"La cuenta cambio a ser actualizada con los datos de LDAP.",155:"Se denego el inicio de sesion de {0}, {1}, {2}",156:"Se verifico la cuenta de Mensajes de {0}",157:"Removio cuenta de mensajes del usuario {0}",158:'Displaying alert box, title="{0}", message="{1}"',159:"Device Powered On",160:"Enabled Duo two-factor authentication",161:"Disabled Duo two-factor authentication"},eventsShortMessageId={1:"Nombre del grupo",2:"Descripción",3:"Banderas",4:"Consentimiento",5:"Auto-Remover",6:"Codigo de invitacion",7:"dispositivo de retransmisión"};function eventMouseHover(e,t){e.children[1].classList.remove("g1s"),e.children[2].classList.remove("style10s"),1==t&&(e.children[1].classList.add("g1s"),e.children[2].classList.add("style10s"))}function eventsUpdate(){var e="",t=null;for(s in events){var o=events[s],n=new Date(o.time);if(o.msg){null==o.h&&(o.h=Math.random()),printDate(n)!=t&&(null!=t&&(e+="</table>"),e+='<table class="table table-hover p3eventsTable" cellpadding=0 cellspacing=0><tr><td colspan=4 class=DevSt>'+(t=printDate(n))+"</td></tr>");var i,a="fa-mobile-screen";if("ugrp"==o.etype&&(a="fa-users"),"user"==o.etype&&(a="fa-user"),"server"==o.etype&&(a="fa-server"),null==o.msgid||null==eventsMessageId[o.msgid])i="string"==typeof o.msg?EscapeHtml(o.msg).split("(R)").join("&reg;"):"";else{if(i=eventsMessageId[o.msgid],null!=o.msgArgs)for(var s in o.msgArgs){var r=o.msgArgs[s];if(Array.isArray(r)){var l,d=[];for(l in r)"number"==typeof r[l]&&eventsShortMessageId[r[l]]?d.push(eventsShortMessageId[r[l]]):d.push(r[l]);r=d.join(", ")}else"string"==typeof r&&0==r.indexOf("DATETIME:")&&(r=printFlexDateTime(new Date(parseInt(r.substring(9)))));i=i.split("{"+s+"}").join(r)}i=EscapeHtml(i).split("(R)").join("&reg;")}if(o.nodeid){var c=getNodeFromId(o.nodeid);if(null!=c){switch(c.icon){case 1:a="fa-computer";break;case 2:a="fa-laptop";break;case 8:a="fa-laptop-code"}i="<a href=# onclick='gotoDevice(\""+o.nodeid+"\",10);haltEvent(event);'>"+EscapeHtml(c.name)+"</a> &rarr; "+i}}o.username&&(c="",o.guestname&&(c=' / <span title="Esta es una sesión para compartir con invitados">'+EscapeHtml(o.guestname)+"</span>"),i=2&userinfo.siteadmin&&o.userid?"<a href=# onclick='gotoUser(\""+encodeURIComponentEx(o.userid)+"\");haltEvent(event);'>"+EscapeHtml(o.username)+"</a>"+c+" &rarr; "+i:EscapeHtml(o.username)+c+" &rarr; "+i),o.remoteaddr&&(i+=" ("+o.remoteaddr+")"),"relay"!=o.etype&&"relaylog"!=o.action||(a="fa-arrow-right-arrow-left"),e+="<tr onclick=showEventDetails("+o.h+',2)  onmouseover=eventMouseHover(this,1) onmouseout=eventMouseHover(this,0) role=button><td style=width:18px><i class="fa-fw fa-solid '+a+'"></i></td><td class=g1>&nbsp;</td><td class=style10>'+printTime(n)+" - "+i+"</td></tr><tr></tr>"}}null!=t&&(e+="</table>"),""==e&&(e="<br><i>No se Encontraron Eventos</i><br><br>"),QH("p3events",e)}function refreshEvents(){""!=p3filterevents.value?meshserver.send({action:"events",limit:parseInt(p3limitdropdown.value),filter:p3filterevents.value}):meshserver.send({action:"events",limit:parseInt(p3limitdropdown.value)})}function p3showReportDialog(){var e;xxdialogMode||(e="<div style=float:right><img src='images/report60.png' height=74 width=60 style=padding-top:2px /></div><div>",setModalContent("xxAddAgent","Descargar Reporte",e=(e=(e=(e=(e+=addHtmlFormFloating("Tipo de Reporte",'<select id=d2reportType class="form-select" onchange=p3showReportValidation()><option value=1>Todos los Eventos</option>'))+addHtmlFormFloating("Espacio de Tiempo",'<select id=d2reportSpan class="form-select" onchange=p3showReportValidation()><option value=1>Todo Disponible</option><option value=2>Un Día</option></select>'))+("<div id=d2daySelector>"+addHtmlFormFloating("Reporte del Día",'<input type=date id=d2reportDay class="form-control" onchange=p3showReportValidation()></input>')+"</div>"))+addHtmlFormFloating("Agrupar Por",'<select id=d2reportGroupBy class="form-select" onchange=p3showReportValidation()><option value=1>Ninguno</option><option value=2>Grupo de Dispositivos</option><option value=3>Usuario</option>'))+addHtmlFormFloating("Formato",'<select id=d2reportFormat class="form-select" onchange=p3showReportValidation()><option value=1>CSV</option><option value=2>JSON</option>')+"</div>"),showModal("xxAddAgentModal","idx_dlgOkButton"),p3showReportValidation(),Q("d2reportType").focus())}function p3showReportValidation(){Q("d2reportType").value;var e=Q("d2reportSpan").value,t=Q("d2reportDay").value,o=(Q("d2reportGroupBy").value,Q("d2reportFormat").value,QV("d2daySelector",2==e),!0);2==e&&""==t&&(o=!1),QE("idx_dlgOkButton",o)}function p3showDownloadEventsDialog(e){var t;xxdialogMode||(t="Descargar la lista de eventos con uno de los formatos de archivo a continuación.<br /><br />",setModalContent("xxAddAgent","Exportar Lista de Eventos",t=(t+=addHtmlValue("Formato CSV",'<a href=# style=cursor:pointer onclick="return p3downloadEventsDialogCSV('+e+')">eventslist.csv</a>'))+addHtmlValue("Formato JSON",'<a href=# style=cursor:pointer onclick="return p3downloadEventsDialogJSON('+e+')">eventslist.json</a>')),showModal("xxAddAgentModal","idx_dlgOkButton"))}function p3downloadEventsDialogCSV(e){var t,o,n;for(n in 1==e&&(o=currentDeviceEvents),2==e&&(o=events),t="utc, time, type, action, user, device, message\r\n",o=3==e?currentUserEvents:o){var i,a="";o[n].nodeid&&(i=getNodeFromId(o[n].nodeid))&&i.name&&(a=i.name),t+='"'+o[n].time+'","'+printDateTime(new Date(o[n].time))+'","'+o[n].etype+'","'+(null!=o[n].action?o[n].action:"")+'","'+(null!=o[n].username?o[n].username:"")+'","'+EscapeHtml(a)+'","'+(null!=o[n].msg?o[n].msg:"").split(",").join(" -")+'"\r\n'}return saveAs(stringToUtf8Blob(t),"eventslist.csv"),!1}function p3downloadEventsDialogJSON(e){var t,o,n=[];for(o in 1==e&&(t=currentDeviceEvents),2==e&&(t=events),t=3==e?currentUserEvents:t)n.push(events[o]);return saveAs(new Blob([JSON.stringify(n,null,2)],{type:"application/octet-stream"}),"eventslist.json"),!1}function updateUsers(){if(QV("UserNewAccountButton",0==(4&features)&&0==serverinfo.domainauth),null==users||0!=(4&features))QH("p3users","");else{var e=null!=userViewSettings&&userViewSettings.noViewLimit?1e5:100,t=[],o=e,n=0;for(c in users)t.push(users[c]);t.sort(nameSort);for(var i=Q("UserSearchInput").value.toLowerCase(),a=i,s=(i.startsWith("email:")?(i=null,a=a.substring(6)):i.startsWith("name:")?(a=null,i=i.substring(5)):i.startsWith("e:")?(i=null,a=a.substring(2)):i.startsWith("n:")&&(a=null,i=i.substring(2)),'<table class="table table-hover" cellpadding=0 cellspacing=0>'),r=!0,l=(s+="<th>Nombre<th style=width:80px>Grupos de Dispositivos<th style=width:120px>"+nobreak("Último Acceso")+"<th style=width:120px>Permisos",[]),d=document.getElementsByClassName("UserCheckbox"),c=0;c<d.length;c++)d[c].checked&&l.push(d[c].value);for(c in t){var u=t[c],p=null;null!=(p=null!=wssessions?wssessions[u._id]:p)&&(null!=i&&(""==i||0<=u.name.toLowerCase().indexOf(i))||null!=a&&null!=u.email&&0<=u.email.toLowerCase().indexOf(a))&&(0<o?(r&&(s+="<tr><td class=userTableHeader colspan=4>Usuarios en Línea",r=!1),s+=addUserHtml(u,p),o--):n++)}for(c in r=!0,t){u=t[c],p=null;null==(p=null!=wssessions?wssessions[u._id]:p)&&(null!=i&&(""==i||0<=u.name.toLowerCase().indexOf(i))||null!=a&&null!=u.email&&0<=u.email.toLowerCase().indexOf(a))&&(0<o?(r&&(s+="<tr><td class=userTableHeader colspan=4>Usuarios Desconectados",r=!1),s+=addUserHtml(u,p),o--):n++)}s+="</table>",1==n?s+="<br />1 usuario adicional no se está mostrando, usa el cuadro de búsqueda para localizar usuarios...<br />":1<n&&(s+="<br />"+format("{0} usuarios adicionales no mostrados, usa el cuadro de búsqueda para encontrar los usuarios...",n)+"<br />"),o==e&&(s+="<br />No se encontraron usuarios.<br />"),QH("p3users",s);for(var d=document.getElementsByClassName("UserCheckbox"),m=encodeURIComponentEx(userinfo._id),c=0;c<d.length;c++)d[c].checked=0<=l.indexOf(d[c].value)&&d[c].value!=m;p3updateInfo(),null!=currentUser&&30==xxcurrentView&&gotoUser(encodeURIComponentEx(currentUser._id),!0)}}function addUserHtml(e,t){var o="",n=" gray",i="",a=e._id!=userinfo._id,s="",r="",t=(null!=t?(n="",a&&(i='<span style=float:right;margin-top:1px;margin-right:4px title=Chat><a href=# onclick=userChat(event,"'+encodeURIComponentEx(e._id)+'","'+encodeURIComponentEx(e.name)+"\")><img src='images/icon-chat.png' height=16 width=16 style=padding-top:2px /></a></span>",i+="<span style=float:right;margin-top:1px;margin-left:4px;margin-right:4px title=Notify><a href=# onclick='return showUserAlertDialog(event,\""+encodeURIComponentEx(e._id)+"\")'><img src='images/icon-notify.png' height=16 width=16 style=padding-top:2px /></a></span>"),s+=nobreak(1==t?"1 sesión":format("{0} sesiones",t))):e.access?s+='<span title="'+format("Último acceso: {0}",printDateTime(new Date(1e3*e.access)))+'">'+printDate(new Date(1e3*e.access))+"</span>":e.login&&(s+='<span title="'+format("Último ingreso: {0}",printDateTime(new Date(1e3*e.login)))+'">'+printDate(new Date(1e3*e.login))+"</span>"),a&&(r+="<a href=# style=cursor:pointer onclick='return showUserAdminDialog(event,\""+encodeURIComponentEx(e._id)+"\")'>"),null!=e.siteadmin&&0!=(32&e.siteadmin)&&4294967295!=e.siteadmin&&(r+="Bloqueada,&nbsp;"),r+="<span title='Permisos en el Servidor'>",4294966047&e.siteadmin),l=(null==e.siteadmin||0==t?r+="Usuario":8==t?r+="Usuario + Archivos":4294967295==e.siteadmin?r+="Administrador":r+=0!=(2&t)?"Gestor":"Parcial",null!=e.siteadmin&&4294967295!=e.siteadmin&&0!=(1216&e.siteadmin)&&(r+="*"),r+="</span>",a&&(r+="</a>"),0);if(e.links)for(var d in e.links)d.startsWith("mesh/")&&l++;var t=EscapeHtml(e.name),a="";return 1==serverinfo.emailcheck&&(a=1!=e.emailVerified?' <b style=color:red title="Correo electrónico no verificado">&#x2717;</b>':' <b style=color:green title="El correo electrónico está verificado">&#x2713</b>'),null!=e.email&&(0==(2097152&features)||e.email.toLowerCase()!=e.name.toLowerCase()?t+=', <a href="mailto:'+EscapeHtml(e.email)+'">'+EscapeHtml(e.email)+"</a>"+a:t+=' <a href="mailto:'+EscapeHtml(e.email)+'"><img src="images/mail12.png" height=9 width=12 title="Enviar correo electrónico al usuario" style="margin-top:2px" /></a>'+a),null!=serverinfo.crossDomain&&""!=(a=e._id.split("/")[1])&&(t+=", <span style=color:#26F>"+a+"</span>"),(0<e.otpsecret||0<e.otphkeys||1==e.otpekey&&8388608&features||1==e.otpduo||null!=e.phone&&67108864&features)&&(t+=' <i class="fa-solid fa-key" title="Segundo factor de autenticación habilitado" style="margin-top:2px"></i>'),null!=e.phone&&(t+=' <i class="fa-solid fa-mobile-screen" title="Número de teléfono verificado" style="margin-top:2px"></i>'),null!=e.siteadmin&&0!=(32&e.siteadmin)&&4294967295!=e.siteadmin&&(t+=' <img src="images/padlock12.png" height=12 width=8 title="La cuenta esta bloqueada" style="margin-top:2px" />'),null!=e.msghandle&&33554432&features2&&(t+=' <i class="fa-solid fa-comment fa-xs" title="Cuenta de mensajes Verificada" style="margin-top:2px" />'),o+("<tr tabindex=0 onkeypress=\"if (event.key=='Enter') gotoUser('"+encodeURIComponentEx(e._id)+"')\"><td>")+"<div>"+('<div class=baricon><input class="UserCheckbox form-check-input me-2" value='+encodeURIComponentEx(e._id)+" onclick=p3updateInfo() type=checkbox"+(e._id==userinfo._id?" disabled":"")+'></div><div style=cursor:pointer onclick=gotoUser("'+encodeURIComponentEx(e._id)+'",false,event)>')+('<div class=baricon><i class="fa-fw fa-solid fa-user '+n+'"></i></div>')+"<div>"+("<div><span style=line-height:24px>"+t+"</span>"+i+"</div></div><td style=text-align:center>"+l+"<td style=text-align:center>"+s+"<td style=text-align:center>"+r)}function p3updateInfo(){for(var e=document.getElementsByClassName("UserCheckbox"),t=0,o=0;o<e.length;o++)!0===e[o].checked&&t++;QE("UsersGroupActionButton",0<t),Q("UsersSelectAllButton").value=0<t?"No seleccionar nada":"Seleccionar Todo"}function p3usersSelectallButtonFunction(){for(var e=encodeURIComponentEx(userinfo._id),t=document.getElementsByClassName("UserCheckbox"),o=0,n=0;n<t.length;n++)!0===t[n].checked&&o++;for(n=0;n<t.length;n++)t[n].checked=0==o&&t[n].value!=e;p3updateInfo()}function p3usersGroupActionFunction(){for(var e,t,o=document.getElementsByClassName("UserCheckbox"),n=0,i=0;i<o.length;i++)!0===o[i].checked&&n++;0!=n&&(e="",serverinfo.emailcheck&&(e+="<option value=4>Validar Correo Electrónico</option><option value=5>Invalidar Correo Electrónico</option>"),t="Selecciona una operación para realizar en todos los usuarios seleccionados.<br /><br />",setModalContent("xxAddAgent","Acción de Grupo",t+=addHtmlFormFloating("Operación","<select id=d3groupop class=form-select><option value=1>Bloquear cuenta</option><option value=2>Desbloquear cuenta</option>"+e+"<option value=3>Eliminar cuenta</option></select>")),showModal("xxAddAgentModal","idx_dlgOkButton",p3usersGroupActionFunctionEx))}function p3usersGroupActionFunctionEx(){for(var e=document.getElementsByClassName("UserCheckbox"),t=[],o=0;o<e.length;o++)!0===e[o].checked&&t.push(decodeURIComponent(e[o].value));var n,i,a=Q("d3groupop").value;if(1==a)for(var o in t)0==(32&(n=null==(i=users[t[o]]).siteadmin?0:i.siteadmin))&&(n+=32,meshserver.send({action:"edituser",id:i._id,siteadmin:n}));else if(2==a)for(var o in t)0!=(32&(n=null==(i=users[t[o]]).siteadmin?0:i.siteadmin))&&(n-=32,meshserver.send({action:"edituser",id:i._id,siteadmin:n}));else if(3==a)QE("idx_dlgOkButton",!1);else if(4==a)for(var o in t)!0!==(i=users[t[o]]).emailVerified&&meshserver.send({action:"edituser",id:i._id,emailVerified:!0});else if(5==a)for(var o in t)!0===(i=users[t[o]]).emailVerified&&meshserver.send({action:"edituser",id:i._id,emailVerified:!1})}function p3usersGroupActionFunctionDelCheck(){QE("idx_dlgOkButton",Q("d3check").checked)}function p3groupActionFunctionDelExec(e){for(var t=document.getElementsByClassName("UserCheckbox"),o=[],n=0;n<t.length;n++)!0===t[n].checked&&o.push(decodeURIComponent(t[n].value));for(n in o){var i=users[o[n]];meshserver.send({action:"deleteuser",userid:i._id,username:i.name})}}function userMouseHover(e,t){var o=e.children[0].children[0].children[1];o.children[1].classList.remove("g1s"),o.children[2].classList.remove("g2s"),e.children[0].children[0].classList.remove("sbar"),1==t&&(o.children[1].classList.add("g1s"),o.children[2].classList.add("g2s"),e.children[0].children[0].classList.add("sbar"))}function userMouseHover2(e,t){var o=e.children[0].children[0];o.children[2].classList.remove("g1s"),o.children[3].classList.remove("g2s"),e.children[0].children[0].classList.remove("sbar"),1==t&&(o.children[2].classList.add("g1s"),o.children[3].classList.add("g2s"),e.children[0].children[0].classList.add("sbar"))}function userChat(e,t,o){if(!xxdialogMode)return haltEvent(e),e="/messenger?id=meshmessenger/"+t+"/"+encodeURIComponentEx(userinfo._id)+"&title="+o,null!=authCookie&&""!=authCookie&&(e+="&auth="+authCookie),urlargs.key&&(e+="&key="+urlargs.key),safeNewWindow(e,"meshmessenger:"+t),meshserver.send({action:"meshmessenger",userid:decodeURIComponent(t)}),!1}function altUserChat(e,t,o,n){var i,a,s,r,l;if(!xxdialogMode)return haltEvent(e),e=serverinfo.altmessenging[n].url,s=i=encodeURIComponentEx((l=decodeURIComponent(t)).split("/")[2]),r=a=encodeURIComponentEx(l.split("/").join("-")),null!=(l=users[l])&&null!=l.realname&&(s=encodeURIComponentEx(l.realname.split(" ").join("")),r=encodeURIComponentEx(l.realname.split(" ").join("-"))),e=e.split("{0}").join(i).split("{1}").join(a).split("{2}").join(s).split("{3}").join(r),urlargs.key&&(e+="&key="+urlargs.key),safeNewWindow(e,"altmessenger:"+t),meshserver.send({action:"notifyuser",userid:decodeURIComponent(t),msg:serverinfo.altmessenging[n].name,msgid:11,url:e}),!1}function showSendSMS(e){xxdialogMode||(setModalContent("xxAddAgent","Enviar SMS","<textarea id=d2smsText maxlength=160 style=width:100%;height:100px;resize:none onKeyUp=showSendSMSValidate()></textarea><span style=font-size:10px><span>"),showModal("xxAddAgentModal","idx_dlgOkButton",()=>showSendSMSEx(3,e)),Q("d2smsText").focus(),showSendSMSValidate())}function showSendSMSValidate(){QE("idx_dlgOkButton",0<Q("d2smsText").value.length)}function showSendSMSEx(e,t){0<Q("d2smsText").value.length&&meshserver.send({action:"smsuser",userid:decodeURIComponent(t),msg:Q("d2smsText").value})}function showSendMessage(e){xxdialogMode||(setModalContent("xxAddAgent","Enviar Mensaje","<textarea id=d2smsText maxlength=160 style=width:100%;height:100px;resize:none onKeyUp=showSendSMSValidate()></textarea><span style=font-size:10px><span>"),showModal("xxAddAgentModal","idx_dlgOkButton",()=>showSendMessageEx(3,e)),Q("d2smsText").focus(),showSendSMSValidate())}function showSendMessageEx(e,t){0<Q("d2smsText").value.length&&meshserver.send({action:"msguser",userid:decodeURIComponent(t),msg:Q("d2smsText").value})}function showSendEmail(e){xxdialogMode||(setModalContent("xxAddAgent","Enviar Correo Electrónico",'<input id=d2emailSubject style=width:100% placeholder="Asunto"></input><textarea id=d2emailText maxlength=10000 style="width:100%;height:200px;resize:none;overflow-y:auto" onKeyUp=showSendEmailValidate()></textarea>'),showModal("xxAddAgentModal","idx_dlgOkButton",()=>showSendEmailEx(3,e)),Q("d2emailSubject").focus(),showSendEmailValidate())}function showSendEmailValidate(){QE("idx_dlgOkButton",0<Q("d2emailSubject").value.length&&0<Q("d2emailText").value.length)}function showSendEmailEx(e,t){0<Q("d2emailText").value.length&&meshserver.send({action:"emailuser",userid:decodeURIComponent(t),subject:Q("d2emailSubject").value,msg:Q("d2emailText").value})}function showUserAlertDialog(e,t){if(!xxdialogMode)return haltEvent(e),setModalContent("xxAddAgent",format("Notificar  {0}",EscapeHtml(users[decodeURIComponent(t)].name)),'<div style=margin-bottom:6px>Enviar un mensaje de texto a este usuario.</div><textarea id=d2notifyText maxlength=2048 style="width:100%;height:184px;resize:none"></textarea><select style=width:100% id=broadcastMessageMaxTime><option value=0>Mostrar mensaje hasta que el usuario lo descarte</option><option value=10>Mostrar por 10 segundos</option><option value=60>Mostrar por 1 minuto</option><option value=300>Mostrar por 5 minutos</option></select>'),showModal("xxAddAgentModal","idx_dlgOkButton",()=>showUserAlertDialogEx(3,t)),Q("d2notifyText").focus(),!1}function showUserAlertDialogEx(e,t){meshserver.send({action:"notifyuser",userid:decodeURIComponent(t),msg:Q("d2notifyText").value,maxtime:parseInt(Q("broadcastMessageMaxTime").value)})}function onUsersViewSettings(){var e;xxdialogMode||(e="",setModalContent("xxAddAgent","Vista de usuarios",e+='<label><input id=d2c1 type=checkbox class="form-check-input me-2"'+((userViewSettings=null==userViewSettings?{}:userViewSettings).noViewLimit?"":" checked")+">Mostrar solo los primeros 100 usuarios</label><br />"),showModal("xxAddAgentModal","idx_dlgOkButton",onUsersViewSettingsEx))}function onUsersViewSettingsEx(){userViewSettings.noViewLimit=!Q("d2c1").checked,putstore("_usersViewSettings",JSON.stringify(userViewSettings)),mainUpdate(16384)}function p4batchAccountCreate(){xxdialogMode||(setModalContent("xxAddAgent","Importar Cuenta de Usuario",'Create many accounts at once by importing a JSON or CSV file<br /><br />JSON file format is as follows:<br /><pre>[\r\n {"user":"x1","pass":"x","email":"x1@x"},\r\n {"user":"x2","pass":"x","resetNextLogin":true}\r\n]</pre><br />CSV file format is as follows:<br /><pre>user,pass,email,resetNextLogin\r\nx1,x,x1@x,\r\nx2,x,,true\r\n</pre><br /><input type=file id=d4importFile class="form-control" accept=".json,.csv" onchange=p4batchAccountCreateValidate() />'),showModal("xxAddAgentModal","idx_dlgOkButton",p4batchAccountCreateEx))}function p4batchAccountCreateValidate(){QE("idx_dlgOkButton",null!=Q("d4importFile").value)}function p4batchAccountCreateEx(){var e=new FileReader;e.onload=function(e){var t=null;if(Q("d4importFile").value.endsWith(".csv")){var o=e.target.result.split("\n"),n=o[0].trim().split(","),i=[];for(let e=1;e<o.length;e++){var a=o[e].trim();if(""!==a){var s=a.split(",");let t=!1;for(let e=0;e<s.length;e++)if(""!==s[e].trim()){t=!0;break}if(t){var r={};for(let e=0;e<n.length;e++){var l=s[e].trim();""!==n[e].trim()&&""!==l&&(r[n[e]]="true"===l.toLowerCase()||l)}i.push(r)}}}if(null!=(t=i)&&Array.isArray(t)){var d=!0;for(c in t)("string"!=typeof t[c].user||t[c].user.length<1||64<t[c].user.length)&&(d=!1),("string"!=typeof t[c].pass||t[c].pass.length<1||256<t[c].pass.length)&&(d=!1),0==checkPasswordRequirements(t[c].pass,passRequirements)&&(d=!1),null!=t[c].email&&("string"!=typeof t[c].email||t[c].email.length<1||128<t[c].email.length)&&(d=!1);0==d?setModalContent("xxAddAgent","Importar Cuenta de Usuario","Invalid CSV file format."):meshserver.send({action:"adduserbatch",users:t})}else setModalContent("xxAddAgent","Importar Cuenta de Usuario","Invalid CSV file format.")}else{try{t=JSON.parse(e.target.result)}catch(e){return setModalContent("xxAddAgent","Importar Cuenta de Usuario",format("Archivo JSON inválido: {0}.",e)),void showModal("xxAddAgentModal","idx_dlgOkButton")}if(null!=t&&Array.isArray(t)){var c,d=!0;for(c in t)("string"!=typeof t[c].user||t[c].user.length<1||64<t[c].user.length)&&(d=!1),("string"!=typeof t[c].pass||t[c].pass.length<1||256<t[c].pass.length)&&(d=!1),0==checkPasswordRequirements(t[c].pass,passRequirements)&&(d=!1),null!=t[c].email&&("string"!=typeof t[c].email||t[c].email.length<1||128<t[c].email.length)&&(d=!1);0==d?setModalContent("xxAddAgent","Importar Cuenta de Usuario","Formato de Archivo JSON no válido."):meshserver.send({action:"adduserbatch",users:t})}else setModalContent("xxAddAgent","Importar Cuenta de Usuario","Formato de Archivo JSON no válido.");showModal("xxAddAgentModal","idx_dlgOkButton")}},e.readAsText(Q("d4importFile").files[0])}function p4downloadUserInfo(){var e;xxdialogMode||(e="Descargar la lista de usuarios con uno de los formatos de archivo a continuación.<br /><br />",setModalContent("xxAddAgent","Exportar Lista de Usuarios",e=(e+=addHtmlValue("Formato CSV","<a href=# style=cursor:pointer onclick='return p4downloadUserInfoCSV()'>userlist.csv</a>"))+addHtmlValue("Formato JSON","<a href=# style=cursor:pointer onclick='return p4downloadUserInfoJSON()'>userlist.json</a>")),showModal("xxAddAgentModal","idx_dlgOkButton"))}function p4downloadUserInfoCSV(){var e,t="id,nombre,correo electrónico,creación,último inicio de sesión,grupos,factores de autenticación,administrador del sitio,administrador de usuarios,bloqueado\r\n";for(e in users){var o=!1,n=[];(0<users[e].otpsecret||0<users[e].otphkeys)&&(o=!0,0<users[e].otpsecret&&n.push("AuthApp"),0<users[e].otphkeys&&n.push("SecurityKey"),0<users[e].otpkeys)&&n.push("BackupCodes"),t=(t=(t=(t+='"'+users[e]._id+'","'+users[e].name+'","'+(users[e].email||"")+'","'+(users[e].creation?new Date(1e3*users[e].creation):"")+'","'+(users[e].login?new Date(1e3*users[e].login):"")+'","'+(users[e].groups?users[e].groups.join(","):"")+'","'+(o?n.join(","):"")+'"')+(","+(4294967295==users[e].siteadmin?"1":"0")))+(","+(0!=(2&users[e].siteadmin)?"1":"0")))+(","+(0!=(32&users[e].siteadmin)?"1":"0"))+"\r\n"}return saveAs(stringToUtf8Blob(t),"userlist.csv"),!1}function p4downloadUserInfoJSON(){var e,t=[];for(e in users)t.push(users[e]);return saveAs(new Blob([JSON.stringify(t,null,2)],{type:"application/octet-stream"}),"userlist.json"),!1}function showUserBroadcastDialog(e){xxdialogMode||(setModalContent("xxAddAgent","Mensaje de Broadcast",'<div style=margin-bottom:6px>Mensaje de Broadcast a todos los usuarios conectados.</div><textarea id=broadcastMessage class="form-control mb-2" style="width:100%;height:184px;resize:none" value="" maxlength=2048 /></textarea><select style=width:100% class="form-select" id=broadcastMessageMaxTime><option value=0>Mostrar mensaje hasta que el usuario lo descarte</option><option value=10>Mostrar por 10 segundos</option><option value=60>Mostrar por 1 minuto</option><option value=300>Mostrar por 5 minutos</option></select>'),showModal("xxAddAgentModal","idx_dlgOkButton",function(){showUserBroadcastDialogEx(3,e?decodeURIComponent(e):null)}),Q("broadcastMessage").focus())}function showUserBroadcastDialogEx(e,t){meshserver.send({action:"userbroadcast",msg:Q("broadcastMessage").value,target:t,maxtime:parseInt(Q("broadcastMessageMaxTime").value)})}function showCreateNewAccountDialog(){if(!xxdialogMode){var e="";if(serverinfo.crossDomain){var t='<select class="form-select" id=p4domain>';for(o in serverinfo.crossDomain)t+="<option value="+o+">"+(""==serverinfo.crossDomain[o]?"Por Defecto":EscapeHtml(serverinfo.crossDomain[o]))+"</option>";e+=addHtmlFormFloating("Dominio",t+="</select>")}if(0==(2097152&features)&&(e+=addHtmlFormFloating("<span id=p4hname>Nombre de Usuario</span>",'<input id=p4name class="form-control" maxlength=64 autocomplete=username onchange=showCreateNewAccountDialogValidate() onkeyup=showCreateNewAccountDialogValidate() />')),e=(e=(e=(e=e+addHtmlFormFloating("<span id=p4hemail>Correo electrónico",'<input id=p4email type=email class="form-control" maxlength=256 autocomplete="email" inputmode="email" onchange=showCreateNewAccountDialogValidate() onkeyup=showCreateNewAccountDialogValidate() />')+"")+addHtmlFormFloating("<span id=p4hp1>Contraseña</span>",'<input id=p4pass1 type=password class="form-control" maxlength=256 autocomplete="new-password" onchange=showCreateNewAccountDialogValidate() onkeyup=showCreateNewAccountDialogValidate() />'))+addHtmlFormFloating("<span id=p4hp2>Confirm Password</span>",'<input id=p4pass2 type=password class="form-control" maxlength=256 autocomplete="new-password" onchange=showCreateNewAccountDialogValidate() onkeyup=showCreateNewAccountDialogValidate() />')+'<div><label><input id=p4randomPassword onchange=showCreateNewAccountDialogValidate() type=checkbox class="form-check-input me-2" />Hacer Contraseña Aleatoria.</label></div>')+'<div><label><input id=p4removeEvents onchange=showCreateNewAccountDialogValidate() type=checkbox class="form-check-input me-2" />Remover todos los eventos anteriores para este ID de usuario.</label></div>'+'<div><label><input id=p4resetNextLogin onchange=showCreateNewAccountDialogValidate() type=checkbox class="form-check-input me-2" />Forzar restablecimiento de contraseña en el próximo inicio de sesión.</label></div>',serverinfo.emailcheck&&(e+='<div><label><input id=p4verifiedEmail onchange=showCreateNewAccountDialogValidate() type=checkbox class="form-check-input me-2" />Correo electrónico verificado.</label></div><div><label><input id=p4invitationEmail type=checkbox class="form-check-input me-2" title=Correo electrónico verificado y restablecimiento de contraseña forzado requerido. />Enviar correo electrónico de invitación.</label></div>'),passRequirements){var o,n=[],i=0;for(o in passRequirements)"reset"!=o&&"hint"!=o&&(n.push(o+":"+passRequirements[o]),i++);0<i&&(e+="<div style=font-size:x-small;padding:6px>"+format("Requerimientos: {0}.",n.join(", "))+"</div>")}setModalContent("xxAddAgent","Crear Cuenta",e),showModal("xxAddAgentModal","idx_dlgOkButton",showCreateNewAccountDialogEx),showCreateNewAccountDialogValidate(),(0==(2097152&features)?Q("p4name"):Q("p4email")).focus()}}function showCreateNewAccountDialogValidate(){var e=validateEmail(Q("p4email").value),t=!0,o=0<Q("p4pass1").value.length&&Q("p4pass1").value==Q("p4pass2").value&&checkPasswordRequirements(Q("p4pass1").value,passRequirements),t=(0==(2097152&features)&&(t=!Q("p4name")||0<Q("p4name").value.length&&-1==Q("p4name").value.indexOf(" "),QS("p4hname").color=t?"black":"#7b241c"),QS("p4hemail").color=e?"black":"#7b241c",serverinfo.emailcheck&&(QE("p4verifiedEmail",e),QE("p4invitationEmail",e&&Q("p4resetNextLogin").checked&&Q("p4verifiedEmail").checked),0==e&&(Q("p4verifiedEmail").checked=!1),0!=Q("p4resetNextLogin").checked&&0!=Q("p4verifiedEmail").checked||(Q("p4invitationEmail").checked=!1)),QE("p4pass1",!Q("p4randomPassword").checked),QE("p4pass2",!Q("p4randomPassword").checked),QS("p4hp1").color=o||Q("p4randomPassword").checked?"black":"#7b241c",QS("p4hp2").color=o||Q("p4randomPassword").checked?"black":"#7b241c",t&e);0==Q("p4randomPassword").checked&&(t&=o),QE("idx_dlgOkButton",t)}function showCreateNewAccountDialogEx(){var e={action:"adduser",username:(0==(2097152&features)?Q("p4name"):Q("p4email")).value,email:Q("p4email").value,pass:Q("p4pass1").value,resetNextLogin:Q("p4resetNextLogin").checked,randomPassword:Q("p4randomPassword").checked,removeEvents:Q("p4removeEvents").checked};serverinfo.emailcheck&&(e.emailVerified=Q("p4verifiedEmail").checked,e.emailInvitation=Q("p4invitationEmail").checked),serverinfo.crossDomain&&(e.domain=serverinfo.crossDomain[parseInt(Q("p4domain").value)]),meshserver.send(e)}function showUserGroupDialog(e,t){var o,n,i;if(!xxdialogMode)return haltEvent(e),t=decodeURIComponent(t),n="",i="Ingresa una lista separada por comas de nombres de reinos administrativos.<br /><br />",setModalContent("xxAddAgent","Reinos Administrativos",i+=`<div class="form-floating mb-2"><input id=dp4usergroups value="${n=null!=(o=users[t.toLowerCase()]).groups?o.groups.join(", "):n}" class="form-control" placeholder="Name1, Name2, Name3" maxlength=256 onchange=p4validateUserGroups() onkeyup=p4validateUserGroups() /><label for=dp4usergroups>Realms</label></div>`),showModal("xxAddAgentModal","idx_dlgOkButton",function(){showUserGroupDialogEx(e,o)}),focusTextBox("dp4usergroups"),p4validateUserGroups(),!1}function p4validateUserGroups(){var e,t=Q("dp4usergroups").value,o=0,n=t.indexOf('"')+t.indexOf("/")+t.indexOf(">")+t.indexOf("<")+t.indexOf("'"),i=t.split(",");for(e in i)0==i[e].trim().length&&o++;QE("idx_dlgOkButton",""==t||-5==n&&o<1)}function showUserGroupDialogEx(e,t){var o,n=Q("dp4usergroups").value.split(","),i=[];for(o in n){var a=n[o].trim();0<a.length&&i.push(a)}meshserver.send({action:"edituser",id:t._id,groups:i})}function showUserAdminDialog(e,t){if(!xxdialogMode){haltEvent(e),t=decodeURIComponent(t);var o,n=users[t];if(null!=n)return o=userinfo._id==n._id,(e="")!=(e=(e=(e=(e=(e+='<div class="d-inline-flex align-items-center"><label class="form-label me-2"><input type=checkbox onchange=showUserAdminDialogValidate() class="form-check-input me-2" id=ua_fileaccess>Archivos del Servidor</label>, <input type=number class="me-1 form-control" onchange=showUserAdminDialogValidate() maxlength=10 id=ua_fileaccessquota>k máximo, en blanco por defecto</div><br><hr/>')+'<label><input type=checkbox onchange=showUserAdminDialogValidate() class="form-check-input me-2" id=ua_fulladmin>Administrador Total</label><br>'+'<label><input type=checkbox onchange=showUserAdminDialogValidate() class="form-check-input me-2" id=ua_serverbackup>Realizar Copias de Seguridad del Servidor</label><br>')+'<label><input type=checkbox onchange=showUserAdminDialogValidate() class="form-check-input me-2" id=ua_serverrestore>Restaurar el Servidor con una Copia de Seguridad</label><br>'+'<label><input type=checkbox onchange=showUserAdminDialogValidate() class="form-check-input me-2" id=ua_serverupdate>Realizar Actualizaciones del Servidor</label><br></div>')+'<div id=d2MngUsr><label><input type=checkbox onchange=showUserAdminDialogValidate() class="form-check-input me-2" id=ua_manageusers>Administrar Usuarios</label><br></div>'+'<div id=d2MngGrp><label><input type=checkbox onchange=showUserAdminDialogValidate() class="form-check-input me-2" id=ua_manageusergroups>Administrar Grupos de Usuarios</label><br></div>')+'<div id=d2MngRec><label><input type=checkbox onchange=showUserAdminDialogValidate() class="form-check-input me-2" id=ua_managerecordings>Administrar Grabaciones</label><br></div>'+'<div id=d2AllEvnt><label><input type=checkbox onchange=showUserAdminDialogValidate() class="form-check-input me-2" id=ua_allevents>Ver Todos los Eventos</label><br></div>')&&(e+="<hr/>"),setModalContent("xxAddAgent","Permisos en el Servidor",e=(e=(e=(e="<div><div id=d2AdminPermissions>"+e)+'<label><input type=checkbox onchange=showUserAdminDialogValidate() class="form-check-input me-2" id=ua_lockedaccount>Bloquear Cuenta</label><br>'+'<label><input type=checkbox onchange=showUserAdminDialogValidate() class="form-check-input me-2" id=ua_nonewgroups>No hay Nuevos Groups de Dispositivos</label><br>')+'<label><input type=checkbox onchange=showUserAdminDialogValidate() class="form-check-input me-2" id=ua_nonewdevices>No hay nuevos dispositivos</label><br>'+'<label><input type=checkbox onchange=showUserAdminDialogValidate() class="form-check-input me-2" id=ua_nomeshcmd>Sin Herramientas (MeshCmd/Router)</label><br>')+'<label><input type=checkbox onchange=showUserAdminDialogValidate() class="form-check-input me-2" id=ua_locksettings>Bloquear Opciones de la Cuenta</label><br>'+"</div>"),showModal("xxAddAgentModal","idx_dlgOkButton",function(){showUserAdminDialogEx(2+(o?0:1),n)}),n.siteadmin&&0!=n.siteadmin&&(Q("ua_fulladmin").checked=4294967295==n.siteadmin,Q("ua_serverbackup").checked=4294967295!=n.siteadmin&&0!=(1&n.siteadmin),Q("ua_serverrestore").checked=4294967295!=n.siteadmin&&0!=(4&n.siteadmin),Q("ua_fileaccess").checked=4294967295!=n.siteadmin&&0!=(8&n.siteadmin),Q("ua_serverupdate").checked=4294967295!=n.siteadmin&&0!=(16&n.siteadmin),Q("ua_lockedaccount").checked=4294967295!=n.siteadmin&&0!=(32&n.siteadmin),Q("ua_nonewgroups").checked=4294967295!=n.siteadmin&&0!=(64&n.siteadmin),Q("ua_nomeshcmd").checked=4294967295!=n.siteadmin&&0!=(128&n.siteadmin),Q("ua_locksettings").checked=4294967295!=n.siteadmin&&0!=(1024&n.siteadmin),Q("ua_nonewdevices").checked=4294967295!=n.siteadmin&&0!=(4096&n.siteadmin)),0!=(2&userinfo.siteadmin)&&(Q("ua_manageusers").checked=4294967295!=n.siteadmin&&0!=(2&n.siteadmin),QE("ua_manageusers",!o&&2&userinfo.siteadmin)),0!=(256&userinfo.siteadmin)&&(Q("ua_manageusergroups").checked=4294967295!=n.siteadmin&&0!=(256&n.siteadmin),QE("ua_manageusergroups",!o&&256&userinfo.siteadmin)),0!=(512&userinfo.siteadmin)&&(Q("ua_managerecordings").checked=4294967295!=n.siteadmin&&0!=(512&n.siteadmin),QE("ua_managerecordings",!o&&512&userinfo.siteadmin)),0!=(2048&userinfo.siteadmin)&&(Q("ua_allevents").checked=4294967295!=n.siteadmin&&0!=(2048&n.siteadmin),QE("ua_allevents",!o&&2048&userinfo.siteadmin)),QE("ua_fulladmin",!o&&4294967295==userinfo.siteadmin),QE("ua_serverbackup",!o&&4294967295==userinfo.siteadmin),QE("ua_serverrestore",!o&&4294967295==userinfo.siteadmin),QE("ua_fileaccess",!o&&4294967295==userinfo.siteadmin),QE("ua_fileaccessquota",!o&&4294967295==userinfo.siteadmin),QE("ua_serverupdate",!o&&4294967295==userinfo.siteadmin),QV("d2AdminPermissions",4294967295==userinfo.siteadmin),QV("d2MngUsr",0!=(2&userinfo.siteadmin)),QV("d2MngGrp",0!=(256&userinfo.siteadmin)),QV("d2MngRec",0!=(512&userinfo.siteadmin)),QE("ua_lockedaccount",!o&&2&userinfo.siteadmin&&4294967295!=n.siteadmin&&userinfo._id!=n._id),QE("ua_nonewgroups",!o&&2&userinfo.siteadmin&&4294967295!=n.siteadmin&&userinfo._id!=n._id),QE("ua_nomeshcmd",!o&&2&userinfo.siteadmin&&4294967295!=n.siteadmin&&userinfo._id!=n._id),QE("ua_nonewdevices",!o&&2&userinfo.siteadmin&&4294967295!=n.siteadmin&&userinfo._id!=n._id),QE("ua_locksettings",!o&&2&userinfo.siteadmin&&4294967295!=n.siteadmin&&userinfo._id!=n._id),Q("ua_fileaccessquota").value=null!=n.quota?n.quota/1024:"",showUserAdminDialogValidate(),!1}}function showUserAdminDialogValidate(){4294967295==userinfo.siteadmin&&(QE("ua_serverbackup",!Q("ua_fulladmin").checked),QE("ua_manageusers",!Q("ua_fulladmin").checked),QE("ua_serverrestore",!Q("ua_fulladmin").checked),QE("ua_fileaccess",!Q("ua_fulladmin").checked),QE("ua_serverupdate",!Q("ua_fulladmin").checked),QE("ua_lockedaccount",!Q("ua_fulladmin").checked),QE("ua_nonewgroups",!Q("ua_fulladmin").checked),QE("ua_nomeshcmd",!Q("ua_fulladmin").checked),QE("ua_nonewdevices",!Q("ua_fulladmin").checked),QE("ua_manageusergroups",!Q("ua_fulladmin").checked),QE("ua_managerecordings",!Q("ua_fulladmin").checked),QE("ua_allevents",!Q("ua_fulladmin").checked),QE("ua_locksettings",!Q("ua_fulladmin").checked),QE("ua_fileaccessquota",Q("ua_fileaccess").checked&&!Q("ua_fulladmin").checked))}function showUserAdminDialogEx(e,t){var o=0,n=parseInt(Q("ua_fileaccessquota").value),t=(1==Q("ua_fulladmin").checked?o=4294967295:(1==Q("ua_serverbackup").checked&&(o+=1),1==Q("ua_manageusers").checked&&(o+=2),1==Q("ua_serverrestore").checked&&(o+=4),1==Q("ua_fileaccess").checked&&(o+=8),1==Q("ua_serverupdate").checked&&(o+=16),1==Q("ua_lockedaccount").checked&&(o+=32),1==Q("ua_nonewgroups").checked&&(o+=64),1==Q("ua_nomeshcmd").checked&&(o+=128),1==Q("ua_manageusergroups").checked&&(o+=256),1==Q("ua_managerecordings").checked&&(o+=512),1==Q("ua_locksettings").checked&&(o+=1024),1==Q("ua_allevents").checked&&(o+=2048),1==Q("ua_nonewdevices").checked&&(o+=4096)),{action:"edituser",id:t._id,siteadmin:o});0==isNaN(n)&&(t.quota=1024*n),meshserver.send(t)}function onUserSearchInputChanged(){mainUpdate(16384)}function updateUserGroups(){QV("p50userGroupOps",0!=(256&userinfo.siteadmin));var e=[],t="";if(usergroups)for(var o in usergroups)e.push(usergroups[o]);e.sort(nameSort);for(var n=[],i=document.getElementsByClassName("UserGroupCheckbox"),o=0;o<i.length;o++)i[o].checked&&n.push(i[o].value);if(0==e.length)t+="<br />No se encontraron grupos.<br />",QV("DuplicateUserGroupButton",!1);else{for(var o in t=t+'<table class="table table-hover p3usersTable" cellpadding=0 cellspacing=0>'+"<th>Nombre<th style=width:80px>Usuarios<th style=width:80px>Grupos de Dispositivos<th style=width:80px>Dispositivos",e)t+=addUserGroupHtml(e[o]);t+="</table>",QV("DuplicateUserGroupButton",!0)}QH("p50groups",t);for(i=document.getElementsByClassName("UserGroupCheckbox"),o=0;o<i.length;o++)i[o].checked=0<=n.indexOf(i[o].value);p50updateInfo(),null!=currentUserGroup&&51==xxcurrentView&&gotoUserGroup(encodeURIComponentEx(currentUserGroup._id),!0)}function addUserGroupHtml(e){var t=0,o=0,n=0;if(e.links)for(var i in e.links)i.startsWith("user/")&&t++,i.startsWith("mesh/")&&o++,i.startsWith("node/")&&n++;var a=EscapeHtml(e.name),s=(null!=serverinfo.crossDomain&&""!=(s=e._id.split("/")[1])&&(a+=", <span style=color:#26F>"+EscapeHtml(s)+"</span>"),"<tr tabindex=0 onkeypress=\"if (event.key=='Enter') gotoUserGroup('"+encodeURIComponentEx(e._id)+"')\"><td style=cursor:pointer>");return(s+="<div style=width:100%>")+('<div class=baricon><input class="form-check-input me-2 UserGroupCheckbox" value='+encodeURIComponentEx(e._id)+" onclick=p50updateInfo() type=checkbox></div>")+('<div class=baricon onclick=gotoUserGroup("'+encodeURIComponentEx(e._id)+'")><i class="fa-solid fa-users"></i></div>')+('<div onclick=gotoUserGroup("'+encodeURIComponentEx(e._id)+'")></div><div onclick=gotoUserGroup("'+encodeURIComponentEx(e._id)+'")></div>')+('<div style=line-height:24px onclick=gotoUserGroup("'+encodeURIComponentEx(e._id)+'")><span style=font-size:16px>'+a+"</span></div></div><td style=text-align:center>"+t+"<td style=text-align:center>"+o+"<td style=text-align:center>"+n)}function p50updateInfo(){for(var e=document.getElementsByClassName("UserGroupCheckbox"),t=0,o=0;o<e.length;o++)!0===e[o].checked&&t++;QE("UsersGroupsGroupActionButton",0<t),Q("UsersGroupsSelectAllButton").value=0<t?"No seleccionar nada":"Seleccionar Todo"}function p50usersSelectallButtonFunction(){for(var e=encodeURIComponentEx(userinfo._id),t=document.getElementsByClassName("UserGroupCheckbox"),o=0,n=0;n<t.length;n++)!0===t[n].checked&&o++;for(n=0;n<t.length;n++)t[n].checked=0==o&&t[n].value!=e;p50updateInfo()}function p50usersGroupActionFunction(){for(var e,t=document.getElementsByClassName("UserGroupCheckbox"),o=0,n=0;n<t.length;n++)!0===t[n].checked&&o++;0!=o&&(e="Selecciona una operación para realizar en todos los usuarios seleccionados.<br /><br />",e+=addHtmlFormFloating("Operación","<select id=d50groupop class=form-select><option value=1>Eliminar grupo de usuarios</option></select>"),xxdialogButtons=3,setModalContent("xxAddAgent","Acción de Grupo",e),showModal("xxAddAgentModal","idx_dlgOkButton",p50usersGroupActionFunctionEx))}function p50usersGroupActionFunctionEx(){for(var e=document.getElementsByClassName("UserGroupCheckbox"),t=[],o=0;o<e.length;o++)!0===e[o].checked&&t.push(decodeURIComponent(e[o].value));1==Q("d50groupop").value&&(setModalContent("xxAddAgent","Eliminar Grupos de Usuarios",'¿Confirmar la eliminación de grupos de usuarios seleccionados?<br /><br /><label><input id=d3check type=checkbox class="form-check-input me-2" onchange=p50usersGroupActionFunctionDelCheck() />Confirmar</label>'),document.getElementById("idx_dlgOkButton").onclick=function(){p50groupActionFunctionDelExec(3)})}function p50usersGroupActionFunctionDelCheck(){QE("idx_dlgOkButton",Q("d3check").checked)}function p50groupActionFunctionDelExec(e){for(var t=document.getElementsByClassName("UserGroupCheckbox"),o=0;o<t.length;o++)!0===t[o].checked&&meshserver.send({action:"deleteusergroup",ugrpid:decodeURIComponent(t[o].value)})}function showCreateUserGroupDialog(e){if(!xxdialogMode){var t="",o="";if(2==e){if(usergroups)for(var n in usergroups)o+="<option value="+encodeURIComponentEx(n)+">"+EscapeHtml(usergroups[n].name)+"</option>";t+=addHtmlFormFloating("Grupo de Usuarios",'<select id=dp4groupid class="form-select">'+o+"</select>")}if(1==e&&serverinfo.crossDomain){o='<select id=p4domain class="form-select">';for(n in serverinfo.crossDomain)o+="<option value="+n+">"+(""==serverinfo.crossDomain[n]?"Por Defecto":EscapeHtml(serverinfo.crossDomain[n]))+"</option>";t+=addHtmlFormFloating("Dominio",o+="</select>")}t=(t+=addHtmlFormFloating("Nombre","<input id=p4name class=form-control maxlength=64 onchange=showCreateUserGroupDialogValidate() onkeyup=showCreateUserGroupDialogValidate() />"))+addHtmlFormFloating("Descripción",'<textarea id=p4desc class=form-control value="" maxlength=1024 /></textarea>'),setModalContent("xxAddAgent",1==e?"Crear Grupo de Usuarios":"Duplicar Grupo de Usuarios",t),showModal("xxAddAgentModal","idx_dlgOkButton",function(){showCreateUserGroupDialogEx(3,e)}),showCreateUserGroupDialogValidate(),Q("p4name").focus()}}function showCreateUserGroupDialogValidate(){QE("idx_dlgOkButton",0<Q("p4name").value.length)}function showCreateUserGroupDialogEx(e,t){var o={action:"createusergroup",name:Q("p4name").value,desc:Q("p4desc").value};2==t&&(o.clone=decodeURIComponent(Q("dp4groupid").value)),1==t&&serverinfo.crossDomain&&(o.domain=serverinfo.crossDomain[parseInt(Q("p4domain").value)]),meshserver.send(o)}var currentUserGroup=null;function gotoUserGroup(e,t){if(!xxdialogMode||t){t=currentUserGroup=usergroups?usergroups[decodeURIComponent(e)]:null;if(null==t)51==xxcurrentView&&go(50);else{var e=EscapeHtml(t.name),o=(0==e.length&&(e="<i>Ninguno</i>"),null==currentUserGroup.membershipType&&0!=(256&userinfo.siteadmin)&&(e='<span role=button tabindex=0 title="Haz clic aquí para editar el nombre del grupo de usuarios" onclick=p51editgroup(1) onkeyup="if (event.key == \'Enter\') p51editgroup(1)">'+e+'  <i class="fa-solid fa-pencil fa-2xs"/></i></span>'),QH("p51groupName",e),0),n=0,i=0;if(t.links)for(var a in t.links)a.startsWith("user/")&&o++,a.startsWith("mesh/")&&n++,a.startsWith("node/")&&i++;var s,r=null==(r=t.desc)||""==r?"<i>Ninguno<i>":EscapeHtml(r),l="<div style=min-height:80px><table style=width:100%>",r=(0!=(8&args.hide)&&(l+="<br />"+addDeviceAttribute("Nombre",e)),null==serverinfo.crossDomain&&0==debugmode||(l=(l+=addDeviceAttribute("Dominio",""!=(e=t._id.split("/")[1])?EscapeHtml(e):"<i>Por Defecto</i>"))+addDeviceAttribute("Identificador del Grupo",EscapeHtml(t._id))),null!=currentUserGroup.membershipType&&(l+=addDeviceAttribute("Tipo de grupo",EscapeHtml(currentUserGroup.membershipType))),0!=(256&userinfo.siteadmin)?l+=addDeviceAttribute("Descripción","<span role=button onclick=p51editgroup(2,"+(null!=currentUserGroup.membershipType)+")>"+r+' <i class="fa-solid fa-pencil fa-xs"/></i></span>'):l+=addDeviceAttribute("Descripción",r),1==serverinfo.userGroupsSessionRecording&&(e=[],t.flags&&2&t.flags&&e.push("Grabar Sesiones"),l+=addDeviceAttribute("Caracteristicas",addLink(e=""==(e=e.join(", "))?"<i>Ninguno</i>":e,"p51edituserGroupFeatures()"))),[]),e=0,d=(t.consent&&(e=t.consent),serverinfo.consent&&(e|=serverinfo.consent),64&e&&8&e?r.push("Mensaje de Escritorio + Barra de Herramientas"):64&e?r.push("Barra de Herramientas de Escritorio"):8&e?r.push("Mensaje de Escritorio"):1&e&&r.push("Notificación de Escritorio"),16&e?r.push("Mensaje en Terminal"):2&e&&r.push("Notificación de Terminal"),32&e?r.push("Solicitud de Archivos"):4&e&&r.push("Notificación de Archivos"),7==e&&(r=["Siempre Notificar"]),l=(l=(l=(l+=addDeviceAttribute("Consentimiento del Usuario",addLinkConditional(r=""==(r=(r=56==(56&e)?["Siempre Preguntar"]:r).join(", "))?"<i>Ninguno</i>":r,"p20editmeshconsent(4)",!0)))+addDeviceAttribute("Usuarios",o))+addDeviceAttribute("Grupos de Dispositivos",n))+addDeviceAttribute("Dispositivos",i)+"</table></div><br />",0!=(256&userinfo.siteadmin)&&(l+='<input type=button class="btn btn-primary btn-sm" value="Broadcast" title="Enviar un mensaje a todos los usuarios de este grupo." onclick=showUserBroadcastDialog("'+encodeURIComponentEx(t._id)+'") />'),QH("p51group",l),l="<br />",null==currentUserGroup.membershipType&&0!=(256&userinfo.siteadmin)&&(l+='<button class="btn btn-primary btn-sm me-2 mb-1" onclick="return p51showAddUserDialog()"><i class="fa-solid fa-circle-plus"></i> Agregar Usuarios</button>'),l+='<table class="table table-hover"><tbody><tr class="table-active"><th scope=col>Miembros del Grupo</th><th scope=col></th></tr>',1),c=[];for(a in currentUserGroup.links)0!=a.startsWith("user/")&&(s=a.split("/")[2],currentUserGroup.links[a].name&&(s=currentUserGroup.links[a].name),a==userinfo._id&&(s=userinfo.name),c.push({id:a,name:s,rights:currentUserGroup.links[a].rights}));for(a in c.sort(function(e,t){return e.name>t.name?1:e.name<t.name?-1:0}),c){var u="",p=(null==currentUserGroup.membershipType&&(u="<a href=# onclick='return p51deleteUser(event,\""+encodeURIComponentEx(c[a].id)+'")\' title="Remover permisos de usuario de este grupo de dispositivos" style=cursor:pointer><img src=images/trash.png border=0 height=10 width=10></a>'),EscapeHtml(decodeURIComponent(c[a].name)));l+="<tr "+(d%2==0?"style=background-color:#DDD":"")+'><td><i class="fa-solid fa-user fa-fw" title="Usuario"></i>&nbsp;'+(p=null!=users?"<a href=# onclick='gotoUser(\""+encodeURIComponentEx(c[a].id)+"\");haltEvent(event);'>"+p+"</a>":p)+"</td><td><div style=float:right>"+u+"</div></td></tr>",++d}1==d&&(l+="<tr><td><div style=padding:6px>&nbsp;<i>Sin Miembros</i><div></div></div></td><td></td></tr>"),l+="</tbody></table><br />";var d=1,m=0,g=!1;for(a in meshes)currentUserGroup._id.split("/")[1]==meshes[a]._id.split("/")[1]&&(m++,null==currentUserGroup.links||null==currentUserGroup.links[a])&&(g=!0);if(0<m&&g&&(l+='<button class="btn btn-primary btn-sm me-2 mb-1"onclick="return p20showAddMeshUserDialog(3)"><i class="fa-solid fa-circle-plus"></i> Agregar Grupo de Dispositivos</button>'),l+='<table class="table table-hover"><tbody><tr class="table-active"><th scope=col>Grupos de Dispositivos en Común</th><th scope=col></th></tr>',currentUserGroup.links){var v=[];for(a in currentUserGroup.links)a.startsWith("mesh/")&&null!=meshes[a]&&v.push(meshes[a]);for(a in v=getOrderedList(v,"name")){var h=0,f=v[a],u="",x=makeDeviceGroupRightsString(currentUserGroup.links[f._id].rights),k=(userinfo.links&&null!=userinfo.links[f._id]&&null!=userinfo.links[f._id].rights&&(h=userinfo.links[f._id].rights),"<i>Grupo de Dispositivos Desconocido</i>");f&&(k="<a href=# onclick='gotoMesh(\""+f._id+"\");haltEvent(event);'>"+f.name+"</a>"),0!=(2&h)&&(u="<a href=# onclick='return p51removeMeshFromUserGroup(event,\""+encodeURIComponentEx(f._id)+'")\' title="Remover los permisos del grupo de usuarios a este grupo de dispositivos" style=cursor:pointer><i class="fa-solid fa-trash text-danger hoverButton"></i></a>',x='<span style=cursor:pointer onclick=p20showAddMeshUserDialog(3,"'+encodeURIComponentEx(f._id)+'")>'+x+" <img class=hoverButton style=cursor:pointer src=images/link5.png></span>"),l+="<tr "+(++d%2==0?"style=background-color:#DDD":"")+'><td style=width:30%><div title="Grupo de Dispositivos" class=m99></div><div>&nbsp;'+k+"<div></div></div></td><td style=width:70%><div style=float:right>"+u+"</div><div>"+x+"</div></td></tr>"}}if(1==d&&(l+="<tr><td><div style=padding:6px>&nbsp;<i>No hay grupos de dispositivos en común</i><div></div></div></td><td></td></tr>"),d=1,l=l+"</tbody></table>"+"<br />",currentUserGroup._id.split("/")[1]==userinfo._id.split("/")[1]&&(l+='<button class="btn btn-primary btn-sm me-2 mb-1" onclick="return p20showAddMeshUserDialog(7)"><i class="fa-solid fa-circle-plus"></i> Agregar Dispositivo</button>'),l+='<table class="table table-hover"><tbody><tr class="table-active"><th scope=col>Dispositivos en Común</th><th scope=col></th></tr>',currentUserGroup.links){var b=[];for(a in currentUserGroup.links)a.startsWith("node/")&&null!=(y=getNodeFromId(a))&&b.push(y);for(a in b=getOrderedList(b,"name")){var y=b[a],u="",x=makeUserDeviceRightsString(currentUserGroup.links[y._id].rights),h=GetNodeRights(y),w="<i>Dispositivo Desconocido</i>";y&&(w="<a href=# onclick='gotoDevice(\""+y._id+"\");haltEvent(event);'>"+y.name+"</a>"),0!=(2&h)&&(u="<a href=# onclick='return p51removeDeviceFromUserGroup(event,\""+encodeURIComponentEx(y._id)+'")\' title="Remover los permisos de grupo de usuarios para este dispositivo" style=cursor:pointer><img src=images/trash.png border=0 height=10 width=10></a>',x='<span style=cursor:pointer onclick=p20showAddMeshUserDialog(7,"'+encodeURIComponentEx(y._id)+'")>'+x+" <img class=hoverButton style=cursor:pointer src=images/link5.png></span>"),l+="<tr "+(++d%2==0?"style=background-color:#DDD":"")+'><td style=width:30%><div title="Grupo de Dispositivos" class=m99></div><div>&nbsp;'+w+"<div></div></div></td><td style=width:70%><div style=float:right>"+u+"</div><div>"+x+"</div></td></tr>"}}1==d&&(l+="<tr><td><div style=padding:6px>&nbsp;<i>Sin dispositivos en común</i><div></div></div></td><td></td></tr>"),l+="</tbody></table>",null!=currentUserGroup.membershipType&&0!=o||0==(256&userinfo.siteadmin)||(l+="<div style=font-size:small;text-align:right><span><a href=# onclick=p51showDeleteUserGroupDialog() style=cursor:pointer>Eliminar Grupo de Usuarios</a></span></div>"),QH("p51group2",l),go(51);var C="";if(0==(268435456&features)&&51<=xxcurrentView&&xxcurrentView<=59&&null!=currentUserGroup){for(var a in C="?viewmode="+xxcurrentView+"&gotougrp="+(serverinfo.crossDomain?currentUserGroup._id:currentUserGroup._id.split("/")[2]),urlargs)C+="&"+a+"="+urlargs[a];try{window.history.replaceState({},document.title,window.location.pathname+C)}catch(e){}}}}}function p51edituserGroupFeatures(){var e,t;xxdialogMode||(e=currentUserGroup.flags||0,t="",1==serverinfo.userGroupsSessionRecording&&(t+='<div><label><input type=checkbox class="form-check-input me-2" id=d51flag1 '+(2&e?"checked":"")+">Grabar sesiones</label><br></div>"),xxdialogButtons=3,setModalContent("xxAddAgent","Editar características del grupo de usuarios",t),showModal("xxAddAgentModal","idx_dlgOkButton",p51edituserGroupFeaturesEx))}function p51edituserGroupFeaturesEx(){var e=0;1==serverinfo.userGroupsSessionRecording&&Q("d51flag1").checked&&(e+=2),meshserver.send({action:"editusergroup",ugrpid:currentUserGroup._id,flags:e})}function p51removeDeviceFromUserGroup(e,t){var o;xxdialogMode||null!=(o=getNodeFromId(decodeURIComponent(t)))&&(setModalContent("xxAddAgent","Remover Permisos del Dispositivo",format('¿Confirmar la eliminación de los permisos de acceso para el dispositivo "{0}"?',o.name)),showModal("xxAddAgentModal","idx_dlgOkButton",()=>p51removeDeviceFromUserGroupEx(3,o._id)))}function p51removeDeviceFromUserGroupEx(e,t){meshserver.send({action:"adddeviceuser",nodeid:t,userids:[currentUserGroup._id],rights:0,remove:!0})}function p51removeMeshFromUserGroup(e,t){var o;xxdialogMode||null!=(o=meshes[decodeURIComponent(t)])&&(setModalContent("xxAddAgent","Remover Permisos de Grupo de Dispositivos",format('¿Confirmar la eliminación de los permisos de acceso para el grupo de dispositivos "{0}"?',o.name)),showModal("xxAddAgentModal","idx_dlgOkButton",()=>p51removeMeshFromUserGroupEx(3,o._id)))}function p51editgroup(e,t){xxdialogMode||(t=addHtmlFormFloating("Nombre",'<input id=dp51name class="form-control" maxlength=32 onchange=p51editgroupValidate() onkeyup=p51editgroupValidate(event) '+(t?"readonly disabled":"")+"/>"),t+=addHtmlFormFloating("Descripción",'<textarea id=dp51desc class="form-control" maxlength=1024 style=width:100%;resize:none></textarea>'),xxdialogButtons=3,setModalContent("xxAddAgent","Editar Grupo de Usuarios",t),showModal("xxAddAgentModal","idx_dlgOkButton",p51editgroupEx),Q("dp51name").value=currentUserGroup.name,currentUserGroup.desc&&(Q("dp51desc").value=currentUserGroup.desc),p51editgroupValidate(),(2==e?Q("dp51desc"):Q("dp51name")).focus())}function p51editgroupEx(){meshserver.send({action:"editusergroup",ugrpid:currentUserGroup._id,name:Q("dp51name").value,desc:Q("dp51desc").value})}function p51editgroupValidate(e){QE("idx_dlgOkButton",0<Q("dp51name").value.length),e&&"Enter"==e.key&&Q("dp51desc").focus()}function p51showDeleteUserGroupDialog(){var e;return xxdialogMode||(e=format("¿Eliminar Grupo de Usuarios {0}?",EscapeHtml(currentUserGroup.name))+"<br /><br />",xxdialogButtons=3,setModalContent("xxAddAgent","Eliminar Grupo de Usuarios",e+='<label><input id=p51check type=checkbox class="form-check-input me-2" onchange=p51validateDeleteGroupDialog() />Confirmar</label>'),showModal("xxAddAgentModal","idx_dlgOkButton",function(){p51showDeleteUserGroupDialogEx(xxdialogButtons,xxdialogTag)}),p51validateDeleteGroupDialog()),!1}function p51validateDeleteGroupDialog(){QE("idx_dlgOkButton",Q("p51check").checked)}function p51showDeleteUserGroupDialogEx(e,t){meshserver.send({action:"deleteusergroup",ugrpid:currentUserGroup._id})}function p51deleteUser(e,t){return haltEvent(e),p51viewuserEx(2,decodeURIComponent(t)),!1}function p51viewuserEx(e,t){2==e&&(e=t.split("/")[2],users&&users[t]&&(e=users[t].name),userinfo._id==t&&(e=userinfo.name),setModalContent("xxAddAgent","Remover Membresía de Usuario",format('¿Confirmar la eliminación del usuario "{0}"?',EscapeHtml(decodeURIComponent(e)))),showModal("xxAddAgentModal","idx_dlgOkButton",p51viewuserEx2(3,t)))}function p51viewuserEx2(e,t){meshserver.send({action:"removeuserfromusergroup",ugrpid:currentUserGroup._id,userid:t})}function p51showAddUserDialog(){var e;return xxdialogMode||(e="Permitir a los usuarios administrar este grupo de dispositivos y los dispositivos en este grupo.",524288&features&&(e+=" Los usuarios deben iniciar sesión en este servidor una vez antes de poder ser añadidos a un grupo de dispositivos."),setModalContent("xxAddAgent","Agregar Usuarios al Grupo de Usuarios",e=(e=(e+="<br /><br /><div style='position:relative'>")+addHtmlFormFloating("Identificadores de Usuario",'<input id=dp51username maxlength=32 class="form-control" onchange=p51validateAddUserDialog() onkeyup=p51validateAddUserDialog() placeholder="user1, user2, user3" />'))+"<div id=dp51usersuggest class=suggestionBox style='top:30px;left:130px;display:none'></div>"+"</div><br>"),showModal("xxAddAgentModal","idx_dlgOkButton",function(){p51showAddUserDialogEx(3,xxdialogTag)}),Q("dp51username").focus(),p51validateAddUserDialog()),!1}function p51setname(e){e=decodeURIComponent(e);var t,o=Q("dp51username").value.split(",");for(t in o)o[t]=o[t].trim();return o[o.length-1]=e,Q("dp51username").value=o.join(", "),p51validateAddUserDialog(),!1}function p51validateAddUserDialog(){var e=!0;if(Q("dp51username")){var t=Q("dp51username").value.split(",");for(l in t){var o=t[l]=t[l].trim();(0==o.length||0<=o.indexOf('"'))&&(e=!1)}var n=!1,i=!1;if(null!=users){var a=t[t.length-1].trim(),s=a.toLowerCase(),r=[];if(0<a.length){for(var l in users){var d=users[l]._id.split("/");if(currentUserGroup.domain==d[1]&&d[2]===s){i=!0;break}if(0<=users[l].name.toLowerCase().indexOf(s)&&currentUserGroup.domain==d[1]&&(r.push([users[l]._id,users[l].name]),8<=r.length))break}if(0==i&&0<r.length){var c="";for(l in r){var u=r[l][0],p=r[l][1];u.split("/")[2]==p.toLowerCase()?c+="<div class=suggestionBoxItem onclick='p51setname(\""+encodeURIComponentEx(u.split("/")[2])+"\")'>"+EscapeHtml(p)+"</div>":c+="<div class=suggestionBoxItem onclick='p51setname(\""+encodeURIComponentEx(u.split("/")[2])+"\")'><div>"+EscapeHtml(p)+"</div><div class=suggestionBoxSubItem>"+EscapeHtml(u.split("/")[2])+"</div></div>"}QH("dp51usersuggest",c),n=!0}}}QV("dp51usersuggest",n)}QE("idx_dlgOkButton",e)}function p51showAddUserDialogEx(e,t){if(null==t){var o,n=Q("dp51username").value.split(","),i=[];for(o in n)i.push(n[o].trim());meshserver.send({action:"addusertousergroup",ugrpid:currentUserGroup._id,usernames:i})}else meshserver.send({action:"addusertousergroup",ugrpid:currentUserGroup._id,usernames:[t.split("/")[2]]})}var currentUser=null;function gotoUser(e,t,o){if((!xxdialogMode||t)&&(null==o||null==o.originalTarget||null==o.originalTarget.href)){var n=currentUser=users[decodeURIComponent(e)];if(null==n)go(4);else{QH("p30userName",EscapeHtml(n.name)),QH("p31userName",EscapeHtml(n.name));var t=n._id==userinfo._id,o=0,e=(null!=wssessions&&wssessions[n._id]&&(o=wssessions[n._id]),null!=n.flags&&1&n.flags?(QV("MainUserImage",!1),QV("MainUserImageEx",!0),null==n.accountImageRnd&&(n.accountImageRnd=Math.floor(9999999999*Math.random())),Q("MainUserImageEx").src="userimage.ashx?id="+n._id.split("/")[2]+"&rnd="+n.accountImageRnd):(Q("MainUserImage").classList.remove("gray"),0==o&&Q("MainUserImage").classList.add("gray"),QV("MainUserImage",!0),QV("MainUserImageEx",!1)),n._id.split("/")[2]),e=(e.startsWith("~twitter:")?(QV("p30userAuthServiceLogo",!0),Q("p30userAuthServiceLogo").src="images/login/twitter64.png"):e.startsWith("~google:")?(QV("p30userAuthServiceLogo",!0),Q("p30userAuthServiceLogo").src="images/login/google64.png"):e.startsWith("~github:")?(QV("p30userAuthServiceLogo",!0),Q("p30userAuthServiceLogo").src="images/login/github64.png"):e.startsWith("~azure:")?(QV("p30userAuthServiceLogo",!0),Q("p30userAuthServiceLogo").src="images/login/azure64.png"):e.startsWith("~oidc:")?(QV("p30userAuthServiceLogo",!0),Q("p30userAuthServiceLogo").src="images/login/oidc64.png"):e.startsWith("~jumpcloud:")?(QV("p30userAuthServiceLogo",!0),Q("p30userAuthServiceLogo").src="images/login/jumpcloud64.png"):e.startsWith("~intel:")?(QV("p30userAuthServiceLogo",!0),Q("p30userAuthServiceLogo").src="images/login/intel64.png"):e.startsWith("~:")?(QV("p30userAuthServiceLogo",!0),Q("p30userAuthServiceLogo").src="images/login/generic64.png"):QV("p30userAuthServiceLogo",!1),[]),i="",a=(null!=n.siteadmin&&0!=(32&n.siteadmin)&&4294967295!=n.siteadmin&&(i='<img src="images/padlock12.png" height=12 width=8 title="La cuenta esta bloqueada" style="margin-top:2px" /> ',e.push("Cuenta bloqueada")),null==n.siteadmin||0==(4294966047&n.siteadmin)?e.push("Sin permisos en el servidor"):8==n.siteadmin?e.push("Acceso a archivos del servidor"):4294967295==n.siteadmin?e.push("Administrador total"):e.push("Permisos parciales"),null!=n.siteadmin&&4294967295!=n.siteadmin&&0!=(1216&n.siteadmin)&&e.push("Restricciones"),"<div style=min-height:80px><table style=width:100%>"),s=(0!=(8&args.hide)&&(a+="<br />"+addDeviceAttribute("Nombre",n.name)),n.email?EscapeHtml(n.email):"<i>No establecido</i>"),r="",l=n.realname?EscapeHtml(n.realname):"<i>No establecido</i>",d=(serverinfo.emailcheck&&(r=1==n.emailVerified?'<b style=color:green;cursor:pointer title="El correo electrónico está verificado">&#x2713</b> ':'<b style=color:red;cursor:pointer title="Correo electrónico no verificado">&#x2717;</b> '),serverinfo.crossDomain||0!=debugmode?a=(a+=addDeviceAttribute("Dominio",""!=(d=n._id.split("/")[1])?EscapeHtml(d):"<i>Por Defecto</i>"))+addDeviceAttribute("Identificador de Usuario",EscapeHtml(n._id)):n.name.toLowerCase()!=n._id.split("/")[2]&&(a+=addDeviceAttribute("Identificador de Usuario",EscapeHtml(n._id.split("/")[2]))),""),r=(n.email&&(d=' <a href="mailto:'+EscapeHtml(n.email)+'" \'><i class="fa-solid fa-arrow-up-right-from-square fa-xs"></i></a>'),a=4294967295!=n.siteadmin||4294967295==userinfo.siteadmin?(a+=addDeviceAttribute("Correo electrónico",'<span role=button onclick=p30showUserEmailChangeDialog(event,"'+encodeURIComponentEx(n._id)+'")>'+r+s+d+' <i class="fa-solid fa-pencil fa-xs"></i></span>'))+addDeviceAttribute("Nombre Real",'<span role=button onclick=p30showUserRealNameChangeDialog(event,"'+encodeURIComponentEx(n._id)+'")>'+l+' <i class="fa-solid fa-pencil fa-xs"></i></span>'):(a+=addDeviceAttribute("Correo electrónico",r+s+d))+addDeviceAttribute("Nombre Real",l),(33554432&features||null!=n.phone)&&(a+=addDeviceAttribute("Número de Teléfono","<span role=button onclick=p30editPhone()>"+(n.phone||"<i>Ninguno</i>")+' <i class="fa-solid fa-pencil fa-xs"></i></span>')),(33554432&features2||null!=n.msghandle)&&(a+=addDeviceAttribute("Mensajería",'<span role=button onclick=p30editMessaging()><i class="fa-solid fa-comment fa-xs" title="Mensajería habilitada" style="margin-top:2px"></i> '+(n.msghandle||"<i>Ninguno</i>")+' <i class="fa-solid fa-pencil fa-xs"></i></span>')),[]),c=(1==serverinfo.usersSessionRecording&&n.flags&&2&n.flags&&r.push("Grabar Sesiones"),n.removeRights&&(0!=(8&n.removeRights)?r.push("No hay Control remoto"):(0!=(65536&n.removeRights)?r.push("Sin Escritorio"):0!=(256&n.removeRights)&&r.push("Vista de escritorio solamente"),0!=(512&n.removeRights)&&r.push("Sin Terminal"),0!=(1024&n.removeRights)&&r.push("Sin Archivos")),0!=(16&n.removeRights)&&r.push("Sin consola"),0!=(32768&n.removeRights)&&r.push("No hay Desinstalar"),0!=(131072&n.removeRights)&&r.push("No hay Comando remoto"),0!=(64&n.removeRights)&&r.push("No hay Despertar"),0!=(262144&n.removeRights))&&r.push("No hay Reiniciar/Apagar"),a=(a+=addDeviceAttribute("Caracteristicas",addLink(r=""==(r=r.join(", "))?"<i>Ninguno</i>":r,"p20edituserfeatures()")))+addDeviceAttribute("Permisos del Servidor","<span role=button onclick='return showUserAdminDialog(event,\""+encodeURIComponentEx(n._id)+"\")'>"+i+e.join(", ")+' <i class="fa-solid fa-pencil fa-xs"></i></span>'),n.quota&&(a+=addDeviceAttribute("Cuota del Servidor",EscapeHtml(parseInt(n.quota)/1024)+" k")),a+=addDeviceAttribute("Creación",printDateTime(new Date(1e3*n.creation))),n.login&&(a+=addDeviceAttribute("Último Ingreso",printDateTime(new Date(1e3*n.login)))),-1==n.passchange?a+=addDeviceAttribute("Contraseña","Se cambiará en el próximo inicio de sesión."):n.passchange&&(a+=addDeviceAttribute("Contraseña",format("Última modificación: {0}",printDateTime(new Date(1e3*n.passchange))))),0),s="<i>Ninguno<i>";if(n.links){for(var u in n.links)u.startsWith("mesh/")&&c++;1==c?s="1 grupo":1<c&&(s=format("{0} grupos",c))}if(a+=addDeviceAttribute("Grupos de Dispositivos",s),4294967295==userinfo.siteadmin||2&userinfo.siteadmin){var p="<i>Ninguno</i>";if(n.groups)for(var u in p="",n.groups)p+='<span class="tagSpan">'+EscapeHtml(n.groups[u])+"</span>";a+=addDeviceAttribute("Reinos del Administrador",addLinkConditional(p,'showUserGroupDialog(event,"'+encodeURIComponentEx(n._id)+'")',4294967295==userinfo.siteadmin||null==userinfo.groups&&userinfo._id!=n._id&&4294967295!=n.siteadmin))}d=[],l=0,r=(n.consent&&(l=n.consent),serverinfo.consent&&(l|=serverinfo.consent),64&l&&8&l?d.push("Mensaje de Escritorio + Barra de Herramientas"):64&l?d.push("Barra de Herramientas de Escritorio"):8&l?d.push("Mensaje de Escritorio"):1&l&&d.push("Notificación de Escritorio"),16&l?d.push("Mensaje en Terminal"):2&l&&d.push("Notificación de Terminal"),32&l?d.push("Solicitud de Archivos"):4&l&&d.push("Notificación de Archivos"),7==l&&(d=["Siempre Notificar"]),a+=addDeviceAttribute("Consentimiento del Usuario",addLinkConditional(d=""==(d=(d=56==(56&l)?["Siempre Preguntar"]:d).join(", "))?"<i>Ninguno</i>":d,"p20editmeshconsent(2)",!0)),0);if((0<n.otpsecret||0<n.otphkeys||0<n.otpekey||0<n.otpduo)&&(r=1,i=[],0<n.otpsecret&&i.push("Aplicación de Autenticación"),0<n.otphkeys&&i.push("Llave de Seguridad"),0<n.otpekey&&i.push("Correo electrónico"),0<n.otpduo&&i.push("Duo"),0<n.otpkeys&&i.push("Códigos de Respaldo"),0<n.otpdev&&i.push("Dispositivo Push"),null!=n.phone&&67108864&features&&i.push("SMS"),null!=n.msghandle&&67108864&features2&&i.push("Mensajería"),a+=addDeviceAttribute("Seguridad",'<i class="fa-solid fa-key" title="Segundo factor de autenticación habilitado" style="margin-top:2px"></i> '+i.join(", "))),a=(a+="</table></div><br />")+('<input type=button class="btn btn-primary btn-sm me-1" value="Notas" title="Ver notas sobre este usuario" onclick=showNotes(false,"'+encodeURIComponentEx(n._id)+'") />'),n.phone&&33554432&features&&(a+='<input type=button class="btn btn-primary btn-sm me-1" value="SMS" title="Enviar un mensaje SMS a este usuario" onclick=showSendSMS("'+encodeURIComponentEx(n._id)+'") />'),n.msghandle&&33554432&features2&&(a+='<input type=button class="btn btn-primary btn-sm me-1" value="Mensaje" title="Enviar mensaje a este usuario" onclick=showSendMessage("'+encodeURIComponentEx(n._id)+'") />'),"string"==typeof n.email&&!0===n.emailVerified&&64&features&&(a+='<input type=button class="btn btn-primary btn-sm me-1" value="Correo electrónico" title="Enviar un mensaje de correo electrónico a este usuario" onclick=showSendEmail("'+encodeURIComponentEx(n._id)+'") />'),!t&&(0<o||8&features2&&n.webpush)&&(a=(a+='<input type=button class="btn btn-primary btn-sm me-1" value="Notificar" title="Enviar notificación de usuario" onclick=showUserAlertDialog(event,"'+encodeURIComponentEx(n._id)+'") />')+'<input type=button class="btn btn-primary btn-sm me-1" value="Chat" title="Chat" onclick=userChat(event,"'+encodeURIComponentEx(n._id)+'","'+encodeURIComponentEx(n.name)+'") />',0<o)&&null!=serverinfo&&null!=serverinfo.altmessenging)for(var u in serverinfo.altmessenging){var m=serverinfo.altmessenging[u];null!=m.type&&"user"!=m.type||(a+='<input type=button class="btn btn-primary btn-sm me-1" value="'+EscapeHtml(m.name)+'" onclick=altUserChat(event,"'+encodeURIComponentEx(n._id)+'","'+encodeURIComponentEx(n.name)+'",'+u+") />")}QH("p30html",a),drawUserPermissions();var e=null!=userinfo.siteadmin&&2&userinfo.siteadmin&&4294967295!=n.siteadmin||4294967295==userinfo.siteadmin,g=(a="<div style=float:right;font-size:small>",e&&userinfo._id!=n._id&&(a+="<a href=# style=cursor:pointer onclick='return p30showDeleteUserDialog()' title=\"Remover este usuario\">Eliminar Usuario</a>"),a+="</div><div style=font-size:small>",e&&0==(524288&features)&&"~"!=n._id.split("/")[2][0]&&(a=a+"<a href=# style=cursor:pointer onclick='return p30showUserChangePassDialog("+r+')\' title="Cambiar la contraseña para este usuario">Cambiar Contraseña</a> <a href=# style=cursor:pointer onclick=\'return p30viewPreviousLogins()\' title="Ver inicios de sesión anteriores de éste usuario">Inicios de Sesión Anteriores</a>'),a+="</div><br>",QH("p30html3",a),a="",1==o?a="1 sesión activa":1<o&&(a=format("{0} sesiones activas",o)),QH("MainUserState",a),go(30),QH("p31events",""),refreshUsersEvents(),"");if(0==(268435456&features)&&30<=xxcurrentView&&xxcurrentView<=39&&null!=currentUser){for(var u in g="?viewmode="+xxcurrentView+"&gotouser="+(serverinfo.crossDomain?currentUser._id:currentUser._id.split("/")[2]),urlargs)g+="&"+u+"="+urlargs[u];try{window.history.replaceState({},document.title,window.location.pathname+g)}catch(e){}}}}}function p30editPhone(){var e;xxdialogMode||(e=(e='<table style=width:100%><tr><td style=width:56px><img src="images/phone80.png" style=padding:8px>')+'<td style=width:100%;text-align:center>Número de teléfono con capacidad de SMS para este usuario.<br />Deja en blanco para ninguno.<br /><br /><div style=width:100%;text-align:center>Número de teléfono: <input type=tel pattern="[0-9]" autocomplete="tel" value="'+(currentUser.phone||"")+'" inputmode="tel" maxlength=18 id=d2phoneinput onKeyUp=p30editPhoneValidate() onkeypress="if (event.key==\'Enter\') p30editPhoneValidate(1)"></div></table>',xxdialogButtons=3,xxdialogTag="verifyPhone",setModalContent("xxAddAgent","Notificaciones Telefónicas",e),showModal("xxAddAgentModal","idx_dlgOkButton",p30editPhoneEx),Q("d2phoneinput").focus(),p30editPhoneValidate())}function p30editMessaging(){var e,t;xxdialogMode||(t="<select id=d2serviceselect style=width:160px;margin-left:8px onchange=p30editMessagingValidate()><option value=0>Ninguno</option>",0!=(1&serverinfo.userMsgProviders)&&(t+="<option value=1>Telegram</option>"),0!=(4&serverinfo.userMsgProviders)&&(t+="<option value=4>Discord</option>"),0!=(8&serverinfo.userMsgProviders)&&(t+="<option value=8>XMPP</option>"),0!=(16&serverinfo.userMsgProviders)&&(t+="<option value=16>CallMeBot</option>"),0!=(32&serverinfo.userMsgProviders)&&(t+="<option value=32>Pushover</option>"),0!=(64&serverinfo.userMsgProviders)&&(t+="<option value=64>ntfy</option>"),0!=(128&serverinfo.userMsgProviders)&&(t+="<option value=128>Zulip</option>"),0!=(256&serverinfo.userMsgProviders)&&(t+="<option value=256>Slack</option>"),e=(e='<table style=width:100%><tr><td style=width:56px;vertical-align:top><img src="images/messaging40.png" style=padding:8px>')+"<td style=width:100%>Cuenta de Mensajería para este usuario.<table style=margin-top:12px><tr><td>Servicio<td>"+(t+="</select>")+"<tr><td>Usuario<td><input maxlength=1024 style=width:160px;margin-left:8px id=d2handleinput onKeyUp=p30editMessagingValidate() onkeypress=\"if (event.key=='Enter') p30editMessagingValidate(1)\"></table>",serverinfo.discordUrl&&(e+="<div id=d2discordurl style=display:none><br /><a href="+serverinfo.discordUrl+' target="_discord">Unete a este canal de Discord para recibir notificaciones.</a></div>'),e=(e+='<div id=d2callmebotinfo style=display:none><br /><a href=https://www.callmebot.com/blog/free-api-signal-send-messages/ target="_callmebot">Signal</a>, <a href=https://www.callmebot.com/blog/free-api-whatsapp-messages/ target="_callmebot">Whatsapp</a>, <a href=https://www.callmebot.com/blog/free-api-facebook-messenger/ target="_callmebot">Facebook</a>, <a href=https://www.callmebot.com/blog/telegram-text-messages/ target="_callmebot">Telegram</a></div>')+'<div id=d2pushoverinfo style=display:none><br /><a href=https://pushover.net/ target="_pushover">Informacion en Pushover.net</a></div><div id=d2ntfyinfo style=display:none><br /><a href="'+(serverinfo.userMsgNftyUrl||"https://ntfy.sh/")+'" target="_ntfy">Servicio gratuito en ntfy.sh</a></div>',xxdialogButtons=3,xxdialogTag="verifyMessaging",setModalContent("xxAddAgent","Notificaciones de Mensajería",e+='<div id=d2slackinfo style=display:none><br /><a href=https://api.slack.com/messaging/webhooks target="_slack">Slack Webhook Setup</a></div>'),showModal("xxAddAgentModal","idx_dlgOkButton",p30editMessagingEx),Q("d2handleinput").focus(),currentUser.msghandle&&(currentUser.msghandle.startsWith("telegram:")&&0!=(1&serverinfo.userMsgProviders)&&(Q("d2serviceselect").value=1,Q("d2handleinput").value=currentUser.msghandle.substring(10)),currentUser.msghandle.startsWith("discord:")&&0!=(4&serverinfo.userMsgProviders)&&(Q("d2serviceselect").value=4,Q("d2handleinput").value=currentUser.msghandle.substring(8)),currentUser.msghandle.startsWith("xmpp:")&&0!=(8&serverinfo.userMsgProviders)&&(Q("d2serviceselect").value=8,Q("d2handleinput").value=currentUser.msghandle.substring(5)),currentUser.msghandle.startsWith("callmebot:")&&0!=(16&serverinfo.userMsgProviders)&&(Q("d2serviceselect").value=16,"signal"==(t=currentUser.msghandle.substring(10).split("|"))[0]&&3==t.length&&(Q("d2handleinput").value="https://api.callmebot.com/signal/send.php?phone="+decodeURIComponent(t[1])+"&apikey="+decodeURIComponent(t[2])),"whatsapp"==t[0]&&3==t.length&&(Q("d2handleinput").value="https://api.callmebot.com/whatsapp.php?phone="+decodeURIComponent(t[1])+"&apikey="+decodeURIComponent(t[2])),"facebook"==t[0])&&2==t.length&&(Q("d2handleinput").value="https://api.callmebot.com/facebook/send.php?apikey="+decodeURIComponent(t[1])),currentUser.msghandle.startsWith("pushover:")&&0!=(32&serverinfo.userMsgProviders)&&(Q("d2serviceselect").value=32,Q("d2handleinput").value=currentUser.msghandle.substring(9)),currentUser.msghandle.startsWith("ntfy:")&&0!=(64&serverinfo.userMsgProviders)&&(Q("d2serviceselect").value=64,Q("d2handleinput").value=currentUser.msghandle.substring(5)),currentUser.msghandle.startsWith("zulip:")&&0!=(128&serverinfo.userMsgProviders)&&(Q("d2serviceselect").value=128,Q("d2handleinput").value=currentUser.msghandle.substring(6)),currentUser.msghandle.startsWith("slack:"))&&0!=(256&serverinfo.userMsgProviders)&&(Q("d2serviceselect").value=256,Q("d2handleinput").value=currentUser.msghandle.substring(6)),p30editMessagingValidate())}function p30editMessagingValidate(e){QE("d2handleinput",0!=Q("d2serviceselect").value),serverinfo.discordUrl&&QV("d2discordurl",4==Q("d2serviceselect").value),QV("d2callmebotinfo",16==Q("d2serviceselect").value),QV("d2pushoverinfo",32==Q("d2serviceselect").value),QV("d2ntfyinfo",64==Q("d2serviceselect").value),QV("d2slackinfo",256==Q("d2serviceselect").value),0==Q("d2serviceselect").value?Q("d2handleinput").placeholder="":4==Q("d2serviceselect").value?Q("d2handleinput").placeholder="Usuario:0000":8==Q("d2serviceselect").value?Q("d2handleinput").placeholder="nombredeusuario@servidor.com":16==Q("d2serviceselect").value?Q("d2handleinput").placeholder="https://api.callmebot.com/...":32==Q("d2serviceselect").value?Q("d2handleinput").placeholder="Clave de usuario":64==Q("d2serviceselect").value?Q("d2handleinput").placeholder="Tema":128==Q("d2serviceselect").value?Q("d2handleinput").placeholder="nombredeusuario@ejemplo.com":256==Q("d2serviceselect").value?Q("d2handleinput").placeholder="https://hooks.slack.com/...":Q("d2handleinput").placeholder="Nombre de Usuario",1==e&&dialogclose(1)}function p30editMessagingEx(){var e=null;""==Q("d2handleinput").value||0==Q("d2serviceselect").value?e="":1==Q("d2serviceselect").value?e="telegram:@"+Q("d2handleinput").value:4==Q("d2serviceselect").value?e="discord:"+Q("d2handleinput").value:8==Q("d2serviceselect").value?e="xmpp:"+Q("d2handleinput").value:16==Q("d2serviceselect").value?e="callmebot:"+Q("d2handleinput").value:32==Q("d2serviceselect").value?e="pushover:"+Q("d2handleinput").value:64==Q("d2serviceselect").value?e="ntfy:"+Q("d2handleinput").value:128==Q("d2serviceselect").value?e="zulip:"+Q("d2handleinput").value:256==Q("d2serviceselect").value&&(e="slack:"+Q("d2handleinput").value),null!=e&&meshserver.send({action:"edituser",id:currentUser._id,msghandle:e})}function p20edituserfeatures(){var e,t,o;xxdialogMode||(e=currentUser.flags||0,t=currentUser.removeRights||0,o=o="",1==serverinfo.usersSessionRecording&&(o+='<div><label><input type=checkbox id=d20flag1 class="form-check-input me-2" onchange=p20edituserfeaturesValidate() '+(2&e?"checked":"")+">Grabar sesiones</label><br></div>"),setModalContent("xxAddAgent","Editar funciones de usuario",o=(o=(o=(o=(o=o+('<div><label><input type=checkbox id=d20flag7 class="form-check-input me-2" onchange=p20edituserfeaturesValidate() '+(8&t?"checked":"")+">No hay Control remoto</label><br></div>")+('<div style=margin-left:8px><label><input type=checkbox id=d20flag2 class="form-check-input me-2" onchange=p20edituserfeaturesValidate() '+(65536&t?"checked":"")+">Sin Acceso al Escritorio</label><br></div>"))+('<div style=margin-left:16px><label><input type=checkbox id=d20flag3 class="form-check-input me-2" onchange=p20edituserfeaturesValidate() '+(256&t?"checked":"")+">Sólo Vista Remota</label><br></div>")+('<div style=margin-left:8px><label><input type=checkbox id=d20flag4 class="form-check-input me-2" onchange=p20edituserfeaturesValidate() '+(512&t?"checked":"")+">Sin Acceso a la Terminal</label><br></div>"))+('<div style=margin-left:8px><label><input type=checkbox id=d20flag5 class="form-check-input me-2" onchange=p20edituserfeaturesValidate() '+(1024&t?"checked":"")+">Sin Acceso a Archivos</label><br></div>")+('<div><label><input type=checkbox id=d20flag6 class="form-check-input me-2" onchange=p20edituserfeaturesValidate() '+(16&t?"checked":"")+">Sin consola de agente</label><br></div>"))+('<div><label><input type=checkbox id=d20flag8 class="form-check-input me-2" onchange=p20edituserfeaturesValidate() '+(32768&t?"checked":"")+">No hay Desinstalar</label><br></div>")+('<div><label><input type=checkbox id=d20flag9 class="form-check-input me-2" onchange=p20edituserfeaturesValidate() '+(131072&t?"checked":"")+">No hay Comando remoto</label><br></div>"))+('<div><label><input type=checkbox id=d20flag10 class="form-check-input me-2" onchange=p20edituserfeaturesValidate() '+(64&t?"checked":"")+">No hay Despertar</label><br></div>")+('<div><label><input type=checkbox id=d20flag11 class="form-check-input me-2" onchange=p20edituserfeaturesValidate() '+(262144&t?"checked":"")+">No hay Reiniciar/Apagar</label><br></div>")),showModal("xxAddAgentModal","idx_dlgOkButton",p20edituserfeaturesEx),p20edituserfeaturesValidate())}function p20edituserfeaturesValidate(){QE("d20flag2",!Q("d20flag7").checked),QE("d20flag3",!Q("d20flag7").checked&&!Q("d20flag2").checked),QE("d20flag4",!Q("d20flag7").checked),QE("d20flag5",!Q("d20flag7").checked)}function p20edituserfeaturesEx(){var e=1&(currentUser.flags||0),t=(1==serverinfo.usersSessionRecording&&Q("d20flag1").checked&&(e+=2),0);Q("d20flag7").checked?t+=8:(Q("d20flag2").checked?t+=65536:Q("d20flag3").checked&&(t+=256),Q("d20flag4").checked&&(t+=512),Q("d20flag5").checked&&(t+=1024)),Q("d20flag6").checked&&(t+=16),Q("d20flag8").checked&&(t+=32768),Q("d20flag9").checked&&(t+=131072),Q("d20flag10").checked&&(t+=64),Q("d20flag11").checked&&(t+=262144),meshserver.send({action:"edituser",id:currentUser._id,flags:e,removeRights:t})}function p30editPhoneValidate(e){var t=""==Q("d2phoneinput").value||isPhoneNumber(Q("d2phoneinput").value);QE("idx_dlgOkButton",t),1==e&&t&&dialogclose(1)}function p30editPhoneEx(){meshserver.send({action:"edituser",id:currentUser._id,phone:Q("d2phoneinput").value})}function p30showUserRealNameChangeDialog(e){return xxdialogMode||(xxdialogButtons=3,setModalContent("xxAddAgent",format("Cambiar Nombre Real de {0}",EscapeHtml(currentUser.name)),'<div class="form-floating mb-2"><input id=dp30realname class="form-control" placeholder="Real Name" maxlength=256 /><label for=dp30realname>Real Name</label></div>'),showModal("xxAddAgentModal","idx_dlgOkButton",p30showUserRealNameChangeDialogEx),Q("dp30realname").focus(),Q("dp30realname").value=currentUser.realname||""),!1}function p30showUserRealNameChangeDialogEx(){meshserver.send({action:"edituser",id:currentUser._id,realname:Q("dp30realname").value})}function p30showUserEmailChangeDialog(e){var t;return xxdialogMode||(t="",t+='<div class="form-floating mb-2"><input id=dp30email class="form-control" maxlength=32 onchange=p30validateEmail() onkeyup=p30validateEmail() placeholder=Email /><label for=dp30email>Email</label></div>',serverinfo.emailcheck&&(t+=addHtmlFormFloating("Estado",'<select id=dp30verified class="form-control" onchange=p30validateEmail()><option value=0>No verificado</option><option value=1>Verficado</option></select>')),setModalContent("xxAddAgent",format("Cambiar Correo Electrónico para {0}",EscapeHtml(currentUser.name)),t),xxdialogButtons=3,showModal("xxAddAgentModal","idx_dlgOkButton",p30showUserEmailChangeDialogEx),Q("dp30email").focus(),Q("dp30email").value=currentUser.email||"",serverinfo.emailcheck&&(Q("dp30verified").value=currentUser.emailVerified?1:0),p30validateEmail()),!1}function p30validateEmail(){var e=Q("dp30email").value,t=e.split("@"),t=0==e.length||2==t.length&&0<t[0].length&&1<t[1].split(".").length&&2<t[1].length&&e.length<1024&&(e!=userinfo.email||1==serverinfo.emailcheck&&Q("dp30verified").value!=(userinfo.emailVerified?1:0));QE("idx_dlgOkButton",t)}function p30showUserEmailChangeDialogEx(){var e={action:"edituser",id:currentUser._id,email:Q("dp30email").value};serverinfo.emailcheck&&(e.emailVerified=1==Q("dp30verified").value),meshserver.send(e)}function p30viewPreviousLogins(){xxdialogMode||(setModalContent("xxAddAgent","Inicios de Sesión Anteriores","Loading..."),meshserver.send({action:"previousLogins",userid:currentUser._id}))}function p30showUserChangePassDialog(e){if(!xxdialogMode){var t=(t="")+'<div class="form-floating mb-2"><input id=p4pass1 type=password class="form-control" maxlength=256 onchange=p30showUserChangePassDialogValidate(1) onkeyup=p30showUserChangePassDialogValidate(1) placeholder=Password></input><label for=p4pass1>Password</label></div>'+'<div class="form-floating mb-2"><input id=p4pass2 type=password class="form-control" maxlength=256 onchange=p30showUserChangePassDialogValidate(1) onkeyup=p30showUserChangePassDialogValidate(1) placeholder=Password></input><label for=p4pass2>Confirm Password</label></div>';if(65536&features&&(t+='<div class="form-floating mb-2"><input id=p4hint type=text class="form-control" maxlength=256 placeholder="Password hint"></input><label for=p4hint>Password hint</label></div>'),passRequirements){var o,n=[],i=0;for(o in passRequirements)"reset"!=o&&"hint"!=o&&(n.push(o+":"+passRequirements[o]),i++);0<i&&(t+="<div style=font-size:x-small;padding:6px>"+format("Requerimientos: {0}.",n.join(", "))+"</div>")}t+='<div><label><input id=p4resetNextLogin class="form-check-input me-2" type=checkbox />Forzar restablecimiento de contraseña en el próximo inicio de sesión.</label></div>',1==e&&(t+='<div><label><input id=p4twoFactorRemove class="form-check-input me-2" type=checkbox />Remover toda la autenticación de segundo factor.</label></div>'),setModalContent("xxAddAgent",format("Cambiar Contraseña de {0}",EscapeHtml(currentUser.name)),t),showModal("xxAddAgentModal","idx_dlgOkButton",function(){p30showUserChangePassDialogEx(3,e)}),p30showUserChangePassDialogValidate(),Q("p4pass1").focus(),-1==currentUser.passchange&&(Q("p4resetNextLogin").checked=!0)}}function p30showUserChangePassDialogValidate(){var e=!0;""==Q("p4pass1").value&&""==Q("p4pass2").value||(Q("p4pass1").value!=Q("p4pass2").value||passRequirements&&0==checkPasswordRequirements(Q("p4pass1").value,passRequirements))&&(e=!1),QE("idx_dlgOkButton",e)}function p30showUserChangePassDialogEx(e,t){var o=!1;1==t&&1==Q("p4twoFactorRemove").checked&&(o=!0),Q("p4pass1").value==Q("p4pass2").value&&(t={action:"changeuserpass",userid:currentUser._id,pass:Q("p4pass1").value,removeMultiFactor:o,resetNextLogin:Q("p4resetNextLogin").checked},65536&features&&(t.hint=Q("p4hint").value),meshserver.send(t))}function p30showDeleteUserDialog(){xxdialogMode||(setModalContent("xxAddAgent",format("Eliminar Usuario {0}",EscapeHtml(currentUser.name)),format("¿Confirmar la eliminación del usuario {0}?",EscapeHtml(currentUser.name))+'<br /><br /><label><input id=p10check type=checkbox class="form-check-input me-2" onchange=p10validateDeleteNodeDialog() />Confirmar</label>'),showModal("xxAddAgentModal","idx_dlgOkButton",p30showDeleteUserDialogEx),p10validateDeleteNodeDialog())}function p30showDeleteUserDialogEx(){meshserver.send({action:"deleteuser",userid:currentUser._id,username:currentUser.name})}function drawUserPermissions(){var e=1,t="",o=0,n=!1;for(h in meshes)meshes[h]._id.split("/")[1]==currentUser._id.split("/")[1]&&(o++,null==currentUser.links||null==currentUser.links[h])&&(n=!0);if(0<o&&n&&(t+='<button class="btn btn-primary btn-sm me-2 mb-1" onclick="return p20showAddMeshUserDialog(1)"><i class="fa-solid fa-circle-plus"></i> Agregar Grupo de Dispositivos</button>'),t+='<table class="table table-hover"><tbody><tr class="table-active"><th scope=col>Grupos de Dispositivos en Común</th><th scope=col></th></tr>',currentUser.links){var i=[];for(h in currentUser.links)h.startsWith("mesh/")&&null!=meshes[h]&&i.push(meshes[h]);for(h in i=getOrderedList(i,"name")){var a,s=0,r=i[h],l="",d=makeDeviceGroupRightsString(g=currentUser.links[r._id].rights);null!=r&&(userinfo.links&&null!=userinfo.links[r._id]&&null!=userinfo.links[r._id].rights&&(s=userinfo.links[r._id].rights),a="<i>Grupo de Dispositivos Desconocido</i>",r&&(a="<a href=# onclick='gotoMesh(\""+r._id+"\");haltEvent(event);'>"+EscapeHtml(r.name)+"</a>"),currentUser._id!=userinfo._id&&0!=(2&s)&&(l="<a href=# onclick='return p30removeMeshFromUser(event,\""+encodeURIComponentEx(r._id)+'")\' title="Remover permisos de usuario de este grupo de dispositivos" style=cursor:pointer><img src=images/trash.png border=0 height=10 width=10></a>',d='<span style=cursor:pointer onclick=p20showAddMeshUserDialog(1,"'+encodeURIComponentEx(r._id)+'")>'+d+" <img class=hoverButton style=cursor:pointer src=images/link5.png></span>"),t+="<tr "+(++e%2==0?"style=background-color:#DDD":"")+'><td style=width:30%><div title="Grupo de Dispositivos" class=m99></div><div>&nbsp;'+a+"<div></div></div></td><td style=width:70%><div style=float:right>"+l+"</div><div>"+d+"</div></td></tr>")}}if(1==e&&(t+="<tr><td><div style=padding:6px>&nbsp;<i>No hay grupos de dispositivos en común</i><div></div></div></td><td></td></tr>"),t+="</tbody></table>",null!=usergroups){if(e=1,t+="<br />",0!=(256&userinfo.siteadmin)){var c=0,u=!1;for(h in usergroups)null==usergroups[h].membershipType&&usergroups[h]._id.split("/")[1]==currentUser._id.split("/")[1]&&(c++,null==currentUser.links||null==currentUser.links[h])&&(u=!0);0<c&&u&&(t+='<button class="btn btn-primary btn-sm me-2 mb-1" onclick="return p30showAddUserGroupDialog()"><i class="fa-solid fa-circle-plus"></i> Agregar Grupo de Usuarios</button>')}if(t+='<table class="table table-hover"><tbody><tr class="table-active"><th scope=col>Miembro de Grupos de Usuarios</th><th scope=col></th></tr>',currentUser.links){var p=[];for(h in currentUser.links)h.startsWith("ugrp/")&&null!=usergroups[h]&&p.push(usergroups[h]);for(h in p=getOrderedList(p,"name")){var m=p[h],g=currentUser.links[p[h]._id].rights,l="",v="<i>Grupo de Usuarios Desconocido</i>";t+="<tr "+(++e%2==0?"style=background-color:#DDD":"")+'><td><div title="Grupo de Usuarios" class=m4></div><div>&nbsp;'+(v=null!=m&&(v=EscapeHtml(m.name),null!=usergroups)?"<a href=# onclick='gotoUserGroup(\""+encodeURIComponentEx(p[h]._id)+"\");haltEvent(event);'>"+v+"</a>":v)+"<div></div></div></td><td><div style=float:right>"+(l=null==m.membershipType&&0!=(256&userinfo.siteadmin)?"<a href=# onclick='return p30RemoveUserGroup(event,\""+encodeURIComponentEx(p[h]._id)+'")\' title="Remover miembro de grupo de usuarios" style=cursor:pointer><i class="fa-solid fa-trash text-danger hoverButton"></i></a>':l)+"</div></td></tr>"}}1==e&&(t+="<tr><td><div style=padding:6px>&nbsp;<i>No es miembro de ningún grupo de usuarios</i><div></div></div></td><td></td></tr>"),t+="</tbody></table>"}if(e=1,t+="<br />",currentUser._id.split("/")[1]==userinfo._id.split("/")[1]&&(t+='<button class="btn btn-primary btn-sm me-2 mb-1" onclick="return p20showAddMeshUserDialog(4)"><i class="fa-solid fa-circle-plus"></i> Agregar Dispositivo</button>'),t+='<table class="table table-hover"><tbody><tr class="table-active"><th scope=col>Dispositivos en Común</th><th scope=col></th></tr>',currentUser.links){var h,f=[];for(h in currentUser.links)h.startsWith("node/")&&null!=(x=getNodeFromId(h))&&f.push(x);for(h in f.sort(nameSort),f){var x=f[h],g=currentUser.links[x._id].rights,l="",s=GetNodeRights(x),k=(userinfo.links&&null!=userinfo.links[h]&&null!=userinfo.links[h].rights&&(s=userinfo.links[h].rights),x?EscapeHtml(x.name):"<i>Dispositivo Desconocido</i>");0!=(2&s)&&(l="<a href=# onclick='return p30removeNodeFromUser(event,\""+encodeURIComponentEx(x._id)+'")\' title="Remover permisos de usuario de este grupo de dispositivos" style=cursor:pointer><img src=images/trash.png border=0 height=10 width=10></a>',d='<span style=cursor:pointer onclick=p20showAddMeshUserDialog(4,"'+encodeURIComponentEx(x._id)+'")>'+makeUserDeviceRightsString(g)+" <img class=hoverButton style=cursor:pointer src=images/link5.png></span>"),k="<a href=# onclick='gotoDevice(\""+x._id+"\",10);haltEvent(event);'>"+k+"</a>",t+="<tr "+(++e%2==0?"style=background-color:#DDD":"")+'><td style=width:30%><div title="Dispositivo" class=si'+x.icon+"></div><div>&nbsp;"+k+"<div></div></div></td><td style=width:70%><div style=float:right>"+l+"</div><div>"+d+"</div></td></tr>"}}1==e&&(t+="<tr><td><div style=padding:6px>&nbsp;<i>Sin dispositivos en común</i><div></div></div></td><td></td></tr>"),t+="</tbody></table>",QH("p30html2",t)}function p30removeDeviceSharing(e,t,o,n){xxdialogMode||(setModalContent("xxAddAgent","Eliminar Compartir el Dispostivo",format('¿Confirmar la eliminación del dispositivo compartido "{0}"?',decodeURIComponent(n))),showModal("xxAddAgentModal","idx_dlgOkButton",function(e,t){meshserver.send({action:"removeDeviceShare",nodeid:t[0],publicid:t[1]})},3,[decodeURIComponent(t),decodeURIComponent(o)]))}function p30removeNodeFromUser(e,t){xxdialogMode||(setModalContent("xxAddAgent","Remover Permisos del Dispositivo",format('¿Confirmar la eliminación de los permisos de acceso para el dispositivo "{0}"?',(t=getNodeFromId(decodeURIComponent(t))).name)),showModal("xxAddAgentModal","idx_dlgOkButton",function(e,t){meshserver.send({action:"adddeviceuser",nodeid:t._id,nodename:t.name,userids:[currentUser._id],rights:0,remove:!0})},3,t))}function p30removeUserFromNode(e,o){var t,n;xxdialogMode||(t=null,n="",o=decodeURIComponent(o),xxdialogButtons=3,xxdialogTag=t,o.startsWith("user/")?(setModalContent("xxAddAgent","Remover Permisos de Usuario",(n=users&&null!=(t=users[o])?t.name:n)?format('¿Confirmar la eliminación de los permisos de acceso para el usuario "{0}"?',n):"¿Confirmar la eliminación de los permisos de acceso?"),showModal("xxAddAgentModal","idx_dlgOkButton",function(e,t){meshserver.send({action:"adddeviceuser",nodeid:currentNode._id,nodename:currentNode.name,userids:[o],rights:0,remove:!0})})):o.startsWith("ugrp/")&&(setModalContent("xxAddAgent","Remover Permisos de Grupo de Usuarios",(n=usergroups&&null!=(t=usergroups[o])?t.name:n)?format('¿Confirmar la eliminación de los permisos de acceso para el grupo de usuarios "{0}"?',n):"¿Confirmar la eliminación de los permisos de acceso?"),showModal("xxAddAgentModal","idx_dlgOkButton",function(e,t){meshserver.send({action:"adddeviceuser",nodeid:currentNode._id,nodename:currentNode.name,userids:[o],rights:0,remove:!0})})))}function p30RemoveUserGroup(e,t){var o;xxdialogMode||null==usergroups||(o=decodeURIComponent(t),setModalContent("xxAddAgent","Remover Miembro de Grupo de Usuarios",format('¿Confirmar la eliminación del grupo de usuarios "{0}"?',null!=(t=usergroups[o])?EscapeHtml(t.name):"<i>Desconocido</i>")),showModal("xxAddAgentModal","idx_dlgOkButton",function(){p30RemoveUserGroupEx(3,o)}))}function p30RemoveUserGroupEx(e,t){meshserver.send({action:"removeuserfromusergroup",ugrpid:t,userid:currentUser._id})}function p30showAddUserGroupDialog(){if(!xxdialogMode&&null!=usergroups){var e,t="";for(e in usergroups)null!=usergroups[e].membershipType||usergroups[e]._id.split("/")[1]!=currentUser._id.split("/")[1]||null!=currentUser.links&&null!=currentUser.links[e]||(t+="<option value="+encodeURIComponentEx(e)+">"+EscapeHtml(usergroups[e].name)+"</option>");var o=addHtmlFormFloating("Grupo de Usuarios",'<select id=dp2groupid class="form-select">'+t+"</select>");return xxdialogButtons=3,setModalContent("xxAddAgent","Agregar Miembros",o),showModal("xxAddAgentModal","idx_dlgOkButton",p30showAddUserGroupDialogEx),Q("dp2groupid").focus(),!1}}function p30showAddUserGroupDialogEx(){meshserver.send({action:"addusertousergroup",ugrpid:decodeURIComponent(Q("dp2groupid").value),usernames:[currentUser._id.split("/")[2]]})}function p30removeMeshFromUser(e,t){var o;xxdialogMode||null!=(o=meshes[decodeURIComponent(t)])&&(setModalContent("xxAddAgent","Remover Permisos de Grupo de Dispositivos",format('¿Confirmar la eliminación de los permisos de acceso para el grupo de dispositivos "{0}"?',o.name)),showModal("xxAddAgentModal","idx_dlgOkButton",function(){p30removeMeshFromUserEx(3,o._id)}))}function p30removeMeshFromUserEx(e,t){meshserver.send({action:"removemeshuser",meshid:t,userid:currentUser._id})}var currentUserEvents=null;function userEventsUpdate(){if(null!=currentUser){var e="",t=null;for(r in currentUserEvents){var o=currentUserEvents[r],n=new Date(o.time);if(o.msg){null==o.h&&(o.h=Math.random()),printDate(n)!=t&&(null!=t&&(e+="</table>"),e+='<table class="table table-hover p3eventsTable" cellpadding=0 cellspacing=0><tr><td colspan=4 class=DevSt>'+(t=printDate(n))+"</td></tr>");var i,a,s="fa-mobile-screen";if("user"==o.etype&&(s="fa-user"),"server"==o.etype&&(s="fa-server"),null==o.msgid||null==eventsMessageId[o.msgid])i="string"==typeof o.msg?EscapeHtml(o.msg).split("(R)").join("&reg;"):"";else{for(var r in i=eventsMessageId[o.msgid],o.msgArgs){var l=o.msgArgs[r];"string"==typeof l&&0==l.indexOf("DATETIME:")&&(l=printFlexDateTime(new Date(parseInt(l.substring(9))))),i=i.split("{"+r+"}").join(l)}i=EscapeHtml(i).split("(R)").join("&reg;")}o.nodeid&&null!=(a=getNodeFromId(o.nodeid))&&(s="si"+a.icon,i="<a href=# onclick='gotoDevice(\""+o.nodeid+"\",10);haltEvent(event);'>"+EscapeHtml(a.name)+"</a> &rarr; "+i),o.username&&o.username!=currentUser.name?(a="",o.guestname&&(a=' / <span title="Esta es una sesión para compartir con invitados">'+EscapeHtml(o.guestname)+"</span>"),i=2&userinfo.siteadmin&&o.userid?"<a href=# onclick='gotoUser(\""+encodeURIComponentEx(o.userid)+"\");haltEvent(event);'>"+EscapeHtml(o.username)+"</a>"+a+" &rarr; "+i:EscapeHtml(o.guestname)+" &rarr; "+i):o.guestname&&(i='<span title="Esta es una sesión para compartir con invitados">'+EscapeHtml(o.guestname)+"</span> &rarr; "+i),"relay"!=o.etype&&"relaylog"!=o.action||(s="fa-arrow-right-arrow-left"),e+="<tr onclick=showEventDetails("+o.h+',3)  onmouseover=eventMouseHover(this,1) onmouseout=eventMouseHover(this,0) style=cursor:pointer><td style=width:18px><i class="fa-solid '+s+'"></i></td><td class=g1>&nbsp;</td><td class=style10>'+printTime(n)+" - "+i+"</td></tr><tr></tr>"}}null!=t&&(e+="</table>"),""==e&&(e="<br><i>No se Encontraron Eventos</i><br><br>"),QH("p31events",e)}}function refreshUsersEvents(){""!=p31filterevents.value?meshserver.send({action:"events",limit:parseInt(p31limitdropdown.value),userid:currentUser._id,filter:p31filterevents.value}):meshserver.send({action:"events",limit:parseInt(p31limitdropdown.value),userid:currentUser._id})}var d3filetreelinkpath,p52recordings=null;function updateRecordings(){for(var e=[],t=document.getElementsByClassName("RecordingCheckbox"),o="",n=0;n<t.length;n++)t[n].checked&&e.push(t[n].value);if(null==p52recordings)o+="<div style=width:100%;text-align:center;margin-top:20px><i>Cargando...</i></div>";else if("number"==typeof p52recordings)o+=1==p52recordings?"<div style=width:100%;text-align:center;margin-top:20px><i>El servidor no puede acceder la carpeta de grabaciones.</i></div>":2==p52recordings?"<div style=width:100%;text-align:center;margin-top:20px><i>El servidor no puede obtener las grabaciones de la base de datos.</i></div>":"<div style=width:100%;text-align:center;margin-top:20px><i>Ha ocurrido un error desconcido.</i></div>";else if(0==p52recordings.length)o+="<div style=width:100%;text-align:center;margin-top:20px><i>No hay grabaciones.</i></div>";else{if(o=(o+='<table class="table table-hover" cellpadding=0 cellspacing=0><thead class="text-center"><tr>')+("<th>Sesión</th><th style=width:110px>"+nobreak("Tiempo de Inicio")+"</th><th style=width:110px>Duración</th><th style=width:110px>Tamaño</th></tr></thead><tbody>"),null!=p52recordings){var i=null;for(n in p52recordings){var a=p52recordings[n],s=printDate(new Date(a.time));s!=i&&(o+="<tr><td class=userTableHeader colspan=4>"+(i=s)),o+=addRecordingHtml(n,a)}}o+="</tbody></table>"}QH("p52recordings",o);for(t=document.getElementsByClassName("RecordingCheckbox"),n=0;n<t.length;n++)t[n].checked=0<=e.indexOf(t[n].value);p52updateInfo()}function addRecordingHtml(e,t){var o="",n=(t.lengthTime&&(o=pad2(Math.floor(t.lengthTime/3600))+":"+pad2(Math.floor(t.lengthTime%3600/60))+":"+pad2(Math.floor(t.lengthTime%60))),printTime(new Date(t.time))),i=(t.sessionStart&&(n=printTime(new Date(t.sessionStart))),""),a=(t.size&&(i=format("{0} Kb",Math.round(t.size/1024))),"<i>Desconocido</i>"),s=(t.name&&t.meshname&&(a=null!=meshes[t.meshid]?"<a href=# onclick='gotoMesh(\""+t.meshid+"\")'>"+EscapeHtml(t.meshname)+"</a> - <a href=# onclick='gotoDevice(\""+t.nodeid+"\",10)'>"+EscapeHtml(t.name)+"</a>":EscapeHtml(t.meshname)+" - "+EscapeHtml(t.name)),null!=t.userids&&0<t.userids.length&&(1<t.userids.length?a+=" - "+format("{0} users",t.userids.length):a+=(s=null)!=(s=null!=users?users[t.userids[0]]:s)?" - <a href=# onclick='gotoUser(\""+encodeURIComponentEx(t.userids[0])+"\")'>"+EscapeHtml(s.name)+"</a>":" - "+EscapeHtml(t.userids[0].split("/")[2])),1==t.protocol&&(a+=" - Sesión de la Terminal"),2==t.protocol&&(a+=" - Sesión de Escritorio"),5==t.protocol&&(a+=" - Transferencia de Archivos"),100==t.protocol&&(a+=" - Intel&reg; AMT WSMAN"),101==t.protocol&&(a+=" - Redirección de Intel&reg; AMT"),200==t.protocol&&(a+=" - Mensajero"),""),r="fa-circle-xmark text-danger",t=(1==t.present&&(r="fa-circle-check text-success",s='<div style=cursor:pointer;float:right><a onclick=downloadFile("recordings.ashx?file='+encodeURIComponentEx(t.filename)+'")><i class="fa-fw fa-solid fa-download fa-sm" title="Download Recording"></i></a>&nbsp;</div>',s+='<div style=cursor:pointer;float:right><a href="player.htm?stream='+encodeURIComponentEx(t.filename)+'") rel="noreferrer noopener" target="mcplay-'+encodeURIComponentEx(t.filename)+'"><i class="fa-fw fa-solid fa-play fa-sm" title="Play Recording"></i></a>&nbsp;</div>'),"<tr tabindex=0 onmouseover=userMouseHover2(this,1) onmouseout=userMouseHover2(this,0) onkeypress=\"if (event.key=='Enter') showRecordingDialog(event,'"+e+"')\"><td style=cursor:pointer>");return(t+="<div class=bar style=width:100%>")+"<div></div>"+('<div class=baricon onclick=showRecordingDialog(event,"'+e+'")><i class="fa-fw fa-solid '+r+'"></i></div>')+('<div class=g1 onclick=showRecordingDialog(event,"'+e+'")></div><div class=g2 onclick=showRecordingDialog("'+e+'")></div>')+('<div style=line-height:24px onclick=showRecordingDialog(event,"'+e+'")>'+s+"<div style=font-size:16px>"+a+"</div></div></div><td style=text-align:center>"+n+"<td style=text-align:center>"+o+"<td style=text-align:center>"+i)}function showRecordingDialog(e,t){if(!xxdialogMode&&"IMG"!=e.target.tagName&&"A"!=e.target.tagName){var o=p52recordings[t],n="";if(o.protocol&&(e="Desconocido",1==o.protocol&&(e="Terminal"),2==o.protocol&&(e="Escritorio"),5==o.protocol&&(e="Archivos"),100==o.protocol&&(e="Intel&reg; AMT WSMAN"),n+=addHtmlValue4("Protocolo",e=101==o.protocol?"Redirección de Intel&reg; AMT":e)),n+=addHtmlValue4("Estado",1==o.present?"Presente en el servidor":"No está en el servidor"),o.name&&(n+=addHtmlValue4("Nombre del Dispositivo",EscapeHtml(o.name))),o.meshname&&(n+=addHtmlValue4("Grupo de Dispositivos",EscapeHtml(o.meshname))),o.size&&(n+=addHtmlValue4("Tamaño",format("{0} bytes",o.size))),o.startTime&&(n+=addHtmlValue4("Tiempo de Inicio",printTime(new Date(o.startTime)))),o.time&&(n+=addHtmlValue4("Tiempo de Finalización",printTime(new Date(o.time)))),o.lengthTime&&(n+=addHtmlValue4("Duración",pad2(Math.floor(o.lengthTime/3600))+":"+pad2(Math.floor(o.lengthTime%3600/60))+":"+pad2(Math.floor(o.lengthTime%60)))),1==o.multiplex&&(n+=addHtmlValue4("Multiplexor","Habilitado")),o.userids)for(var t in o.userids)n+=addHtmlValue4("Usuario",o.userids[t].split("/")[2]);xxdialogButtons=9,setModalContent("xxAddAgent","Detalles de la Grabación",n),showModal("xxAddAgentModal","idx_dlgOkButton",null)}}function refreshRecodings(){meshserver.send({action:"recordings",limit:1e3})}function openRecodringPlayer(){xxdialogMode||safeNewWindow(window.location.origin+"{{{domainurl}}}player.htm","meshcentral-deskplayer")}function p52updateInfo(){for(var e=document.getElementsByClassName("RecordingCheckbox"),t=0;t<e.length;t++)!0===e[t].checked&&0}function d3init(){d3fileoptions={dialog:1,filter:"d3filter",files:"d3serverfiles",folderup:"p3FolderUp",currentFolder:"p3CurrentFolder",func:d3setActions},Q("d3localFile").value="",Q("d3localFile").accept=Q("d3filter").value,d3modechange()}function d3modechange(){var e=Q("d3uploadMode").value;QV("d3localmode",1==e),QV("d3servermode",2==e),(1==e?d3setActions:d3updatefiles)()}var d3filetreelocation=[],d3fileoptions=null;function d3updatefiles(){if(null!=d3fileoptions&&("d3filter"!=d3fileoptions.filter||1!=Q("d3uploadMode").value)){for(var e,t="",o="",n=filetree,i=1,a="",s=[],r=[],l=document.getElementsByName("fc"),d=0;d<l.length;d++)l[d].checked&&r.push(l[d].value);for(d in d3filetreelinkpath="",d3filetreelocation){if(null==n.f||null==n.f[d3filetreelocation[d]])break;s.push(d3filetreelocation[d]),1==i?(e=d3filetreelocation[d].split("/"),window.location.origin,e[0],d3filetreelocation[d]===userinfo._id?d3filetreelinkpath+="self":d3filetreelinkpath+=e[0]+"/"+e[2]):""!=d3filetreelinkpath&&(d3filetreelinkpath+="/"+d3filetreelocation[d],2<i)&&d3filetreelocation[d],a=(n=n.f[d3filetreelocation[d]]).n,i++}d3filetreelocation=s;var c=p5sort_files(n.f),u="";for(d in d3fileoptions.filter&&(u=Q(d3fileoptions.filter).value),c){var p,m,g=c[d],v=g.n;3==g.t&&""!=u&&0==g.nx.toLowerCase().endsWith(u)||(v=70<v.length?'<span title="'+EscapeHtml(v)+'">'+EscapeHtml(v.substring(0,70))+"...</span>":EscapeHtml(v),p="",null!=g.s&&(p=getFileSizeStr(g.s)),m="",m=3!=g.t?'<div class=filelist file=999><span style=float:right title=""></span><span><div class=fileIcon'+g.t+' onclick=d3folderset("'+encodeURIComponentEx(g.nx)+'")></div>&nbsp;<a href=# style=cursor:pointer onclick=\'return d3folderset("'+encodeURIComponentEx(g.nx)+"\")'>"+v+"</a></span></div>":(v=v,'<div class=filelist file=3><input style=float:left name=fcx class="fcb form-check-input me-2" type=checkbox onchange=d3setActions() value="'+g.nx+'">&nbsp;<span style=float:right>'+EscapeHtml(p)+"</span><span><div class=fileIcon"+g.t+"></div>"+v+"</span></div>"),g.t<3?t+=m:o+=m)}d3fileoptions.currentFolder&&QH(d3fileoptions.currentFolder,a),QH(d3fileoptions.files,t+o),QE(d3fileoptions.folderup,0<d3filetreelocation.length),d3fileoptions.func&&d3fileoptions.func()}}function d3folderset(e){return d3filetreelocation.push(decodeURIComponent(e)),d3updatefiles(),!1}function d3folderup(e){if(null==e)d3filetreelocation.pop();else for(;d3filetreelocation.length>e;)d3filetreelocation.pop();d3updatefiles()}function d3getFileSel(){for(var e=[],t=document.getElementsByName("fcx"),o=0;o<t.length;o++)t[o].checked&&e.push(t[o].value);return e}function d3setActions(){1==d3fileoptions.dialog?1==Q("d3uploadMode").value?QE("idx_dlgOkButton",0<Q("d3localFile").value.length):QE("idx_dlgOkButton",1==d3getFileSel().length):2==d3fileoptions.dialog&&QE("idx_dlgOkButton",1==d3getFileSel().length)}var reportCSV=null;function generateReportDialog(){if(!xxdialogMode){var e="",t="",o=JSON.parse(getstore("_ReportSettings","{}")),n={1:"Sesiones Remotas",2:"Uso de tráfico de usuario",3:"Inicios de sesión de usuario"};for(i in 4294967295==userinfo.siteadmin&&(n[4]="Registro de Base de datos"),n)e+="<option value="+i+(o.type==i?" selected":"")+">"+n[i]+"</option>";t=t+addHtmlFormFloating("Tipo",'<select id=d2reportType class="form-select" onchange=generateReportDialogValidate()>'+e+"</select>")+"<div id=d2GroupByDiv style=display:none>",e="";for(i in n={1:"Usuario",2:"Dispositivo",3:"Día"})e+="<option value="+i+(o.groupBy==i?" selected":"")+">"+n[i]+"</option>";for(i in t=(t+=addHtmlFormFloating("Agrupar Por",'<select id=d2groupBy class="form-select" onchange=generateReportDialogValidate()>'+e+"</select>"))+"</div>"+"<div id=d2GroupByDiv2 style=display:none>",e="",n={1:"Usuario",3:"Día"})e+="<option value="+i+(o.groupBy2==i?" selected":"")+">"+n[i]+"</option>";t=(t+=addHtmlFormFloating("Agrupar Por",'<select id=d2groupBy2 class="form-select" onchange=generateReportDialogValidate()>'+e+"</select>"))+"</div>"+"<div id=d2DeviceGroupDiv style=display:none>",e="<option value=0"+(0==o.devGroup?" selected":"")+">Todos</option>";var i,a=getOrderedList(meshes,"name");for(i in a)e+="<option value="+encodeURIComponentEx(a[i]._id)+(o.devGroup==a[i]._id?" selected":"")+">"+EscapeHtml(a[i].name)+"</option>";for(i in t=(t+=addHtmlFormFloating("Grupo de Dispositivos",'<select onchange=generateReportDialogValidate() id=d2groupId class="form-select">'+e+"</select>"))+"</div>"+"<div id=d2timeBackDiv style=display:none>",e="",null==o.timeRange&&(o.timeRange=1),n={1:"Último día",7:"Últimos 7 días",30:"Últimos 30 días",0:"Intervalo de tiempo"})e+="<option value="+i+(o.timeRange==i?" selected":"")+">"+n[i]+"</option>";setModalContent("xxAddAgent","Generar informe",t=(t=(t=(t=(t+=addHtmlFormFloating("Tiempo",'<select id=d2timeRange class="form-select" onchange=generateReportDialogValidate()>'+e+"</select>"))+"</div>"+"<div id=d2timeRangeDiv style=display:none>")+addHtmlFormFloating("Intervalo de Tiempo",'<input id=d2timeRangeSelector class="flatpickr form-control" type="text" placeholder="Seleccionad fecha y hora..." data-id="altinput">'))+"</div>"+"<div id=d2showTrafficDiv style=display:none>")+addHtmlValue("",'<div style=width:250px><label><input type=checkbox class="form-check-input me-2" id=d2showTraffic '+(o.showTraffic?"checked":"")+">Mostrar tráfico</label><div>")+"</div>"),showModal("xxAddAgentModal","idx_dlgOkButton",generateReportDialogEx),generateReportDialogValidate();t=new Date,t=(t.setDate(t.getDate()-7),flatpickr("#d2timeRangeSelector",{mode:"range",enableTime:!0,maxDate:new Date,defaultDate:[t,new Date],minuteIncrement:1}));xxdialogTag=t}}function generateReportDialogValidate(){QV("d2timeRangeDiv",0==Q("d2timeRange").value),QV("d2timeBackDiv",4!=Q("d2reportType").value),QV("d2GroupByDiv",1==Q("d2reportType").value),QV("d2GroupByDiv2",3==Q("d2reportType").value),QV("d2DeviceGroupDiv",1==Q("d2reportType").value),QV("d2showTrafficDiv",1==Q("d2reportType").value)}function generateReportDialogEx(e,t){var o,n=0==Q("d2timeRange").value?(o=Math.floor(t.selectedDates[1].getTime()/1e3),Math.floor(t.selectedDates[0].getTime()/1e3)):(o=Math.floor(new Date/1e3),n=new Date,Math.floor(n.setDate(n.getDate()-Q("d2timeRange").value)/1e3)),t=null;try{t=Intl.DateTimeFormat().resolvedOptions().timeZone}catch(e){}var i=decodeURIComponent(Q("d2groupId").value),a=(0==i&&(i=null),putstore("_ReportSettings",JSON.stringify({type:parseInt(Q("d2reportType").value),groupBy:parseInt(Q("d2groupBy").value),groupBy2:parseInt(Q("d2groupBy2").value),timeRange:parseInt(Q("d2timeRange").value),devGroup:i,showTraffic:Q("d2showTraffic").checked})),parseInt(Q("d2groupBy").value));3==Q("d2reportType").value&&(a=parseInt(Q("d2groupBy2").value)),meshserver.send({action:"report",type:parseInt(Q("d2reportType").value),groupBy:a,start:n,end:o,tz:t,tf:(new Date).getTimezoneOffset(),l:getLang(),devGroup:i,showTraffic:Q("d2showTraffic").checked})}function renderReport(e){var t={time:"Tiempo",device:"Dispositivo",session:"Sesión",user:"Usuario",devgroup:"Grupo de Dispositivos",guest:"Invitado",length:"Longitud",bytesin:"Bytes entrantes",bytesout:"Bytes salientes",os:"Sistema Operativo",ip:"Dirección IP",browser:"Navegador",msg:"Mensaje",twofactor:"2do factor"},o='<table class="table table-hover">',n=null,i=[];if(0==Object.keys(e.groups).length)reportCSV=null,QV("p60downloadReportDiv",!1),o+="<tr><td style=text-align:center;padding-top:32px>El informe no ha devuelto contenido.</tr></td>";else{for(var a in reportCSV='"Grupo"',o+="<tr>",e.columns){var s=null!=t[e.columns[a].title]?t[e.columns[a].title]:EscapeHtml(e.columns[a].title),r="";e.columns[a].align?r+=";text-align:"+EscapeHtml(e.columns[a].align):r+=";text-align:left",0!=a||"datetime"!=e.columns[a].format&&"time"!=e.columns[a].format||(r+=";width:1%"),o+="<th style="+r+">"+s+"</th>",reportCSV+=',"'+csvClean(s)+'"'}for(var a in o+="</tr>",reportCSV+="\r\n",e.groups)for(var l in o=(o+="<tr style=height:8px></tr>")+("<tr><td colspan="+e.columns.length+' style="border-bottom:1pt solid black"><b>'),0!=a&&(o+=renderReportFormat(a,e.groupFormat)),o+="</b></td></tr>",e.groups[a].entries){var d,c=e.groups[a].entries[l];for(d in o+="<tr>",reportCSV+=0!=a?'"'+csvClean(renderReportFormatCSV(a,e.groupFormat))+'"':'""',e.columns){var u,p,r="";null!=e.columns[d].format&&(r="white-space:nowrap;"),e.columns[d].align&&(r="text-align:"+EscapeHtml(e.columns[d].align)),null!=c[e.columns[d].id]?(o+='<td style="'+r+'">'+renderReportFormat(c[e.columns[d].id],e.columns[d].format)+"</td>",reportCSV+=',"'+csvClean(renderReportFormatCSV(c[e.columns[d].id],e.columns[d].format))+'"'):(o+="<td></td>",reportCSV+=","),null!=e.columns[d].sumBy&&(u=c[e.columns[d].sumBy],!0===e.columns[d].sumBy&&(u=!0),p=c[e.columns[d].id],n=e.columns[d].sumBy,null!=p)&&(-1==i.indexOf(u)&&i.push(u),null==e.columns[d].subtotals&&(e.columns[d].subtotals={},e.columns[d].totals={}),null==e.columns[d].subtotals[u]?e.columns[d].subtotals[u]=p:e.columns[d].subtotals[u]+=p,null==e.columns[d].totals[u]?e.columns[d].totals[u]=p:e.columns[d].totals[u]+=p)}o+="</tr>",reportCSV+="\r\n"}if(null!=n){var m=-1;if(!0===n)m=99999;else for(var a in e.columns)e.columns[a].id==n&&(m=a);if(0<=m){i.sort();var g=!0;for(l in o+="<tr style=height:8px></tr>",i){for(var a in o+="<tr>",e.columns)a==m?(r="",e.columns[d].align&&(r+=";text-align:"+EscapeHtml(e.columns[d].align)),g&&(r+=";border-top:1pt solid #777"),o+='<td style="color:#777'+r+'">'+renderReportFormat(i[l],e.columns[a].format)):null!=e.columns[a].totals?(r="",e.columns[d].align&&(r+=";text-align:"+EscapeHtml(e.columns[d].align)),g&&(r+=";border-top:1pt solid #777"),o+='<td style="color:#777'+r+'">'+renderReportFormat(e.columns[a].totals[i[l]],e.columns[a].format)):o+="<td></td>";o+="</tr>",g=!1}}}QV("p60downloadReportDiv",!0)}o+="</table>",QH("p60report",o)}function renderReportFormat(e,t){if(null==e)return"";if("datetime"==t)return printDateTime(new Date(e));if("time"==t)return printTime(new Date(e));if("protocol"==t)return 1==e?"Terminal":2==e?"Escritorio":5==e?"Archivos":100==e?"AMT-WSMAN":101==e?"AMT-Redir":200==e?"Mensajero":201==e?"Web-RDP":202==e?"Web-SSH":203==e?"Web-SFTP":204==e?"Web-VNC":"Desconocido ("+e+")";if("seconds"==t)return s=e%60,a=60&Math.floor(e/60),i=Math.floor(e/3600),zeroPad(i,2)+":"+zeroPad(a,2)+":"+zeroPad(s,2);if("node"==t)return null!=(n=getNodeFromId(e))?"<div onclick='gotoDevice(\""+n._id+'",10);haltEvent(event);\' style=float:left;margin-right:4px class="j'+n.icon+'"></div>'+EscapeHtml(n.name):"<i>Desconocido</i>";if("mesh"==t)return null!=(o=meshes[e])?"<div onclick='gotoMesh(\""+o._id+'",10);haltEvent(event);\' style=float:left;margin-right:4px;cursor:pointer class="m99"></div>'+EscapeHtml(o.name):"<i>Desconocido</i>";if("nodemesh"==t){var o,n,i=null,a=null,s=e.split("/"),r="<table><tr>";if(3<=s.length&&(i=s[0]+"/"+s[1]+"/"+s[2]),null!=(a=6<=s.length?s[3]+"/"+s[4]+"/"+s[5]:a)){if(null==(o=meshes[a]))return"<i>Desconocido</i>";r+="<td><div onclick='gotoMesh(\""+o._id+'",10);haltEvent(event);\' style=float:left;margin-right:4px;cursor:pointer class="m99"></div>'+EscapeHtml(o.name)+"&nbsp;&nbsp;&nbsp;</td>"}return null==(n=getNodeFromId(i))?"<i>Desconocido</i>":r=r+("<td><div onclick='gotoDevice(\""+n._id+'",10);haltEvent(event);\' style=float:left;margin-right:4px class="j'+n.icon+'"></div>'+EscapeHtml(n.name)+"</td>")+"</tr></table>"}if("user"==t)return s=null,e==userinfo._id?s=userinfo:null!=users&&(s=users[e]),null!=s?(a=s.name,null!=s.realname&&(a+=", "+s.realname),"<div onclick='gotoUser(\""+s._id+'",10);haltEvent(event);\' style=float:left;margin-right:4px;cursor:pointer><i class="fa-solid fa-user-circle"></i></div>'+EscapeHtml(a)):"<i>Usuario desconocido</i>";if("msg"==t){if(107==e)return'<div style=float:left;margin-right:4px;cursor:pointer><i class="fa-solid fa-check-circle text-success"></i></div>Inicio de sesión exitoso';if(108==e)return'<div style=float:left;margin-right:4px;cursor:pointer class="NotifyIconTiny2"></div>Segundo factor incorrecto';if(109==e)return'<div style=float:left;margin-right:4px;cursor:pointer class="NotifyIconTiny4"></div>Cuenta bloqueada';if(110==e)return'<div style=float:left;margin-right:4px;cursor:pointer><i class="fa-solid fa-exclamation-triangle text-warning"></i></div>Intento de inicio de sesión no válido'}if("2fa"==t){if(""==e)return"Ninguno";if("backup"==e)return"Códigos de Respaldo";if("fido"==e)return"tecla FIDO";if("sms"==e)return"mensaje de texto";if("hwotp"==e)return"OTP de hardware";if("messenger"==e)return"Mensajería";if("push"==e)return"Notificación de inserción";if("otp"==e)return"Contraseña de un solo uso";if("cookie"==e)return"Recordar dispositivo";if("tokenlogin"==e)return"Ficha de inicio de sesión";if("ipaddr"==e)return"Dirección IP";if("sso"==e)return"Inicio de sesión único"}return"records"==t?null!=(o={node:"Registro de dispotitivos",mesh:"Registro de grupo de dispositivos",user:"Registros de Usuario",sysinfo:"Registro de informacion de dispossitivos",iploc:"Registros de Ubicacion IP",note:"Registro de Notas",ifinfo:"Registros de información de la interfaz de red.",cfile:"Registro de archivos de configuracion",lastconnect:"Registros de hora de última conexión",power:"Registro de cambios en origen de poder",events:"Registro de eventos",serverstats:"Historial de estadisticas del servidor",ugrp:"Registro de grupos de usuario",deviceshare:"Registros de uso compartido de dispositivos",logintoken:"Registro de Tokens de inicio de sesion",smbios:"Registro SMBIOS del dispositivo",pmt:"Registro de Notificaciones Push del dispositivo",meshcentral:"Dispositivo, usuarios, grupos y otros registros"})[e]?o[e]:e:EscapeHtml(e)}function renderReportFormatCSV(e,t){if("datetime"==t)return printDateTime(new Date(e));if("time"==t)return printTime(new Date(e));if("protocol"==t)return 1==e?"Terminal":2==e?"Escritorio":5==e?"Archivos":"Desconocido";if("node"==t){var o=getNodeFromId(e);if(null!=o)return o.name}if("mesh"==t){o=meshes[e];if(null!=o)return o.name}var n;if("user"==t)return o=null,e==userinfo._id?o=userinfo:null!=users&&(o=users[e]),null!=o?(n=o.name,null!=o.realname&&(n+=" - "+o.realname),n):"Usuario desconocido";if("msg"==t){if(107==e)return"Inicio de sesión exitoso";if(108==e)return"Segundo factor incorrecto";if(109==e)return"Cuenta bloqueada";if(110==e)return"Intento de inicio de sesión no válido"}return"records"==t?renderReportFormat(e,t):""+e}function p60downloadReport(){xxdialogMode||null==reportCSV||saveAs(stringToUtf8Blob(reportCSV),"Report.csv")}var notifications=[];function clickNotificationIcon(e){1==e?QV("notifiyBox",!0):0==e?QV("notifiyBox",!1):QV("notifiyBox","none"==QS("notifiyBox").display),drawNotifications()}function setNotificationCount(e){parseInt(Q("notificationCount").innerHTML)!=e&&(QH("notificationCount",e),QS("notificationCount")["background-color"]=0==e?"lightblue":"orange",QV("notificationCount",0<e))}function drawNotifications(){var e=getstore("notifications",0),t="";if(0==notifications.length)t="<div style=margin:5px>Actualmente no hay notificaciones</div>";else for(var o in notifications){var n,o=notifications[o],i="",a=new Date(o.time),s=0;null!=o.title&&(i="<b>"+EscapeHtml(o.title)+"</b>: "),null!=o.nodeid&&null!=(n=getNodeFromId(o.nodeid))&&(s=n.icon,i=16&e?"<b>"+EscapeHtml(meshes[n.meshid].name)+" / "+EscapeHtml(n.name)+"</b>: ":"<b>"+EscapeHtml(n.name)+"</b>: "),t+='<div title="'+format("Ocurrió en {0}",printDateTime(a))+'" id="notifyx'+o.id+'" class=notification style="cursor:pointer;border-top:1px solid '+(""==t?"transparent":"orange")+'">',s&&(t+="<div class=j"+s+' onclick="notificationSelected('+o.id+')" style=margin:5px;float:left></div>'),t+='<div onclick="notificationDelete('+o.id+')" class=unselectable title="Borrar esta notificación" style=margin:5px;float:right;color:orange><b>X</b></div><div onclick="notificationSelected('+o.id+')" style=margin:5px>'+i+EscapeHtml(o.text)+"</div><div style=margin-left:5px;margin-bottom:5px;color:gray;font-size:10px>"+printDateTime(a)+"</div></div>"}var r="";1<notifications.length&&(r='<div id="notifyRemoveAll" onclick="deleteAllNotifications()" style="cursor:pointer;border-top:1px solid orange;margin:5px;color:orange;text-align:right;padding-right:3px">Borrar todo</div>'),QH("notifiyBox",'<div class=customScroll style="max-height:170px;overflow-y:auto;margin:5px">'+t+r+"</div>")}function notificationSelected(e,t){var o,n=-1;for(o in notifications)notifications[o].id==e&&(n=o);-1!=n&&(notificationSelectedEx(notifications[n],e),t)&&notifications[n]&&(notifications[n].notification&&(notifications[n].notification.close(),delete notifications[n].notification),notificationDelete(e))}function notificationSelectedEx(e,t){null!=e.nodeid?"desktop"==e.tag?gotoDevice(e.nodeid,12):"terminal"==e.tag?gotoDevice(e.nodeid,11):"files"==e.tag?gotoDevice(e.nodeid,13):"intelamt"==e.tag?gotoDevice(e.nodeid,14):"console"==e.tag?gotoDevice(e.nodeid,15):gotoDevice(e.nodeid,10):"backupcodes"!=e.tag||xxdialogMode?null!=e.tag&&e.tag.startsWith("meshmessenger/")?(safeNewWindow("/messenger?id="+e.tag+"&title="+encodeURIComponentEx(e.username),e.tag.split("/")[2]),notificationDelete(t)):null!=e.url&&(safeNewWindow(e.url),notificationDelete(t)):(go(2),account_manageOtp(0),notificationDelete(t))}function notificationDelete(e){var t=-1,o=Q("notifyx"+e);if(null!=o){for(var n in notifications)notifications[n].id==e&&(t=n);-1!=t&&(meshserver.send({action:"intersession",subaction:"removeNotify",id:e}),notifications[t].notification&&(notifications[t].notification.close(),delete notifications[t].notification),notifications.splice(t,1),o.parentNode.removeChild(o),setNotificationCount(notifications.length),0==notifications.length&&QV("notifiyBox",!1),1==notifications.length&&QV("notifyRemoveAll",!1),0<notifications.length)&&0==t&&(o=notifications[0],QS("notifyx"+o.id)["border-top"]="1px solid transparent")}}function addNotification(e){if("number"==typeof e.titleid)try{e.title=[null,"Nueva Cuenta","Límite del Servidor","Advertencia de Seguridad","Configuraciones de la cuenta","Grupo de Dispositivos","Códigos de Invitación"][e.titleid]}catch(e){}if("number"==typeof e.msgid)try{e.text=[null,"Permiso denegado","Nombre de usuario no válido","Contraseña no válida","Correo electrónico no válido","Dominio no válido","Permisos de sitio no válidos","El usuario ya existe","No se puede agregar un usuario en este modo","Excepción de validación","Límite de cuenta alcanzado.","Solicitud de Chat, haga clic aquí para aceptar.","Ha habido {0} intentos fallidos de inicio de sesión en esta cuenta desde el último inicio de sesión.","No se pudo cambiar la dirección de correo electrónico, otra cuenta ya usa: {0}.","Correo electrónico enviado.","Usuario {0} no encontrado.","Usuarios {0} no encontrados.","Error, no se puede cambiar a la contraseña utilizada anteriormente.","Error, no se puede cambiar a la contraseña de uso común.","Error, contraseña no cambiada.","Contraseña cambiada.","La contraseña actual no es correcta.",'Error, el código de invitación "{0}" ya está en uso.',"Puerta de enlace SMS no habilitada","Sin derechos de gestión de usuarios","Mensaje SMS no válido","No hay número de teléfono para este usuario","SMS enviado exitosamente.","Error de SMS","Error de SMS: {0}",'El dominio de correo electrónico "{0}" no está permitido. Solo ({1}) están permitidos',"Mensaje invalido","Mensaje enviado con éxito.","Mensaje de error","Mensaje de error: {0}"][e.msgid],Array.isArray(e.args)&&(e.text=format(e.text,e.args[0],e.args[1],e.args[2],e.args[3],e.args[4],e.args[5]))}catch(e){}null==e.time&&(e.time=Date.now()),null==e.id&&(e.id=Math.random()),notifications.unshift(e),setNotificationCount(notifications.length),clickNotificationIcon(!0);var t,o,n=getstore("notifications",0),i=(1&n&&Q("chimes").play(),null);Notification&&"granted"==Notification.permission&&(t=e.text.split("&reg;").join("").split("<b>").join("").split("</b>").join("").split("<br />").join("\r\n"),e.nodeid?(o=getNodeFromId(e.nodeid))&&(i=16&n?new Notification(decodeURIComponent("{{{extitle}}}")+" - "+meshes[o.meshid].name+" - "+o.name,{tag:e.tag,body:t,icon:"/images/notify/icons128-"+o.icon+".png"}):new Notification(decodeURIComponent("{{{extitle}}}")+" - "+o.name,{tag:e.tag,body:t,icon:"/images/notify/icons128-"+o.icon+".png"})):(null==e.icon&&(e.icon=0),n=null==(n=e.title)?"":" - "+e.title,i=new Notification(decodeURIComponent("{{{extitle}}}")+n,{tag:e.tag,body:t,icon:"/images/notify/icons128-"+e.icon+".png"})),i.id=e.id,i.xtag=e.tag,i.url=e.url,i.nodeid=e.nodeid,i.username=e.username,i.onclick=function(e){notificationSelected(e.target.id,!0)},e.notification=i),"number"==typeof e.maxtime&&0<e.maxtime&&((o=function e(){notificationDelete(e.xid)}).xid=e.id,setTimeout(o,1e3*e.maxtime))}function deleteAllNotifications(){notifications=[],setNotificationCount(0),drawNotifications(),QV("notifiyBox",!1)}function setupGeneralServerStats(){window.serverStatCpu&&window.serverStatCpu.destroy(),window.serverStatMemory&&window.serverStatMemory.destroy(),window.serverStatCpu=new Chart(document.getElementById("serverCpuChart").getContext("2d"),{type:"doughnut",data:{datasets:[{data:[0,0],backgroundColor:["#AAAAAA","#00AA00"]}],labels:["Usado","Libre"]},options:{events:[],responsive:!0,plugins:{legend:{display:!1}},animation:{animateScale:!0,animateRotate:!0},width:"40px"}}),window.serverStatMemory=new Chart(document.getElementById("serverMemoryChart").getContext("2d"),{type:"doughnut",data:{datasets:[{data:[0,0],backgroundColor:["#AAAAAA","#00AA00"]}],labels:["Usado","Libre"]},options:{events:[],responsive:!0,plugins:{legend:{display:!1}},animation:{animateScale:!0,animateRotate:!0},width:"40px"}})}var lastServerStats=null;function updateGeneralServerStats(e){if(null!=e?lastServerStats=e:e=lastServerStats,null!=e){var t,o={ServerState:"Estado del Servidor",AgentErrorCounters:"Contador de Errores del Agente",UnknownGroup:"Grupo Desconocido",InvalidPKCSsignature:"Firma PKCS no válida",InvalidRSAsignature:"Firma RSA inválida",InvalidJSON:"JSON no válido.",UnknownAction:"Acción Desconocida",BadWebCertificate:"Certificado Web Erróneo",BadSignature:"Firma Errónea",MaxSessionsReached:"Sesiones Máximas Alcanzadas",UnknownDeviceGroup:"Grupo de Dispositivos Desconocido",InvalidDeviceGroupType:"Tipo de Grupo de Dispositivos No Válido",DuplicateAgent:"Duplicar Agente",ConnectedIntelAMT:"Conectado Intel&reg; AMT",RelayErrors:"Errores de Relé",UserAccounts:"Cuentas de Usuario",DeviceGroups:"Grupos de Dispositivos",AgentSessions:"Sesiones del Agente",ConnectedUsers:"Usuarios Conectados",UsersSessions:"Sesiones de Usuarios",RelaySessions:"Sesiones de Relé",RelayCount:"Contador de Relé"},n=(setupGeneralServerStats(),"object"==typeof e.cpuavg&&(t=Math.min(e.cpuavg[0],1),window.serverStatCpu.config.data.datasets[0].data=[t,1-t],QH("serverCpuChartText",'<div style=margin-bottom:5px>Carga del CPU</div><div><b title="Carga del CPU en el último minuto">'+Math.round(100*e.cpuavg[0])/100+'</b>, <b title="Carga del CPU en los últimos 5 minutos">'+Math.round(100*e.cpuavg[1])/100+'</b>, <b title="Carga del CPU en los últimos 15 minutos">'+Math.round(100*e.cpuavg[2])/100+"</b></div>"),QS("serverCpuChartView").display="inline-block",window.serverStatCpu.update()),"number"==typeof e.totalmem&&"number"==typeof e.availablemem?(window.serverStatMemory.config.data.datasets[0].data=[e.totalmem-e.availablemem,e.availablemem],QH("serverMemoryChartText","<div style=margin-bottom:5px>Memoria Disponible</div><div><b>"+getNiceSize3(e.availablemem)+"</b> libre, <b>"+getNiceSize3(e.totalmem)+"</b> total</div>"),QS("serverMemoryChartView").display="inline-block",window.serverStatMemory.update()):"number"==typeof e.totalmem&&"number"==typeof e.freemem&&(window.serverStatMemory.config.data.datasets[0].data=[e.totalmem-e.freemem,e.freemem],QH("serverMemoryChartText","<div style=margin-bottom:5px>Memoria</div><div><b>"+getNiceSize3(e.freemem)+"</b> libre, <b>"+getNiceSize3(e.totalmem)+"</b> total</div>"),QS("serverMemoryChartView").display="inline-block",window.serverStatMemory.update()),"<div style=width:100% cellpadding=0 cellspacing=0>");if("object"==typeof e.values)for(var i in e.values)for(var a in n+="<div class=userTableHeader style=margin-bottom:4px;width:200px>"+(o[i]||i)+"</div>",e.values[i])n+='<div style=display:inline-block class="me-2"><table class=serverStateTableCell><tr><td></td><td><span>'+(o[a]||a)+"</span><span style=float:right>"+e.values[i][a]+"</span></td><td></td></tr></table></div>";n+="</div>",QH("serverStatsTable",n)}}var serverTimelineStats=null,serverTimelineConfig={type:"line",data:{labels:[],datasets:[{label:"",backgroundColor:"rgba(255, 99, 132, .5)",borderColor:"rgb(255, 99, 132)",data:[],fill:!0}]},options:{animation:!1,responsive:!0,maintainAspectRatio:!1,elements:{line:{cubicInterpolationMode:"monotone"}},scales:{x:{type:"time",time:{tooltipFormat:"ll HH:mm"},display:!0,title:{display:!1,text:""}},y:{type:"linear",display:!0,title:{display:!0,text:""},stacked:!0}}}};function refreshServerTimelineStats(e){null!=meshserver&&2==meshserver.State&&meshserver.send({action:"servertimelinestats",hours:720})}function pastDate(e){var t=new Date;return t.setTime(t.getTime()-36e5*e),t}function setServerTimelineStats(e){serverTimelineStats=e,updateServerTimelineStats()}function addServerTimelineStats(e){var t;null!=serverTimelineStats&&((t=null)!=Q("p40server").value&&""==(t=decodeURIComponent(Q("p40server").value))&&(t=null),e.s==t)&&(serverTimelineStats.push(e),0==(t=Q("p40type").value)?(serverTimelineConfig.data.datasets[0].data.push({x:e.time,y:e.conn.ca}),serverTimelineConfig.data.datasets[1].data.push({x:e.time,y:e.conn.cu}),serverTimelineConfig.data.datasets[2].data.push({x:e.time,y:e.conn.us}),serverTimelineConfig.data.datasets[3].data.push({x:e.time,y:e.conn.rs}),null!=e.conn.am&&serverTimelineConfig.data.datasets[4].data.push({x:e.time,y:e.conn.am})):1==t?(serverTimelineConfig.data.datasets[0].data.push({x:e.time,y:e.mem.external/1048576}),serverTimelineConfig.data.datasets[1].data.push({x:e.time,y:e.mem.heapUsed/1048576}),serverTimelineConfig.data.datasets[2].data.push({x:e.time,y:e.mem.heapTotal/1048576}),serverTimelineConfig.data.datasets[3].data.push({x:e.time,y:e.mem.rss/1048576})):3==t||4==t?updateServerTimelineStats():5==t&&"object"==typeof e.cpu&&"number"==typeof e.cpu[0]&&serverTimelineConfig.data.datasets[0].data.push({x:e.time,y:e.cpu[0]}),updateServerTimelineHours())}function updateServerTimelineHours(){serverTimelineConfig.options.scales.y.type=Q("p40log").checked?"logarithmic":"linear",serverTimelineConfig.options.scales.x.min=pastDate(Q("p40time").value),window.serverMainStats.update()}function setupServerTimelineStats(){window.serverMainStats=new Chart(document.getElementById("serverMainStats").getContext("2d"),serverTimelineConfig)}let trafficSeriesNames=["Agente","CIRA","AMT-OS","HTTP","Relé","Terminal","Escritorio","Archivos","WebRDP","WebSSH","WebVNC","Multiplex de Escritorio"],seriesColors=[[158,151,16],[16,84,158],[255,99,132],[39,158,16],[134,16,158],[0,148,255],[255,216,0],[255,127,237],[109,213,255],[89,94,255],[179,104,255],[179,104,255]];function seriesColor1(e){return"rgba("+(seriesColors[e][0]+(255-seriesColors[e][0])/1.5)+","+(seriesColors[e][1]+(255-seriesColors[e][1])/1.5)+","+(seriesColors[e][2]+(255-seriesColors[e][2])/1.5)+")"}function seriesColor2(e){return"rgba("+seriesColors[e][0]+","+seriesColors[e][1]+","+seriesColors[e][2]+")"}function updateServerTimelineStats(){if(null!=serverTimelineStats){var e=Q("p40type").value,t=pastDate(Q("p40time").value),o=[],n=null,i=!1,a=!0;if(null!=Q("p40server").value&&(""==(n=decodeURIComponent(Q("p40server").value))&&(n=null),a=!1),serverTimelineConfig.options.scales.x.min=t,serverTimelineConfig.options.scales.y.stacked=3==e||4==e,0==e){serverTimelineConfig.options.scales.y.title.text="Conteo de Conexión";for(var s={labels:[pastDate(0),t],datasets:[{label:"Agentes",data:[],backgroundColor:"rgba(158, 151, 16, .1)",borderColor:"rgb(158, 151, 16)",fill:!0},{label:"Usuarios",data:[],backgroundColor:"rgba(16, 84, 158, .1)",borderColor:"rgb(16, 84, 158)",fill:!0},{label:"Sesiones de Usuario",data:[],backgroundColor:"rgba(255, 99, 132, .1)",borderColor:"rgb(255, 99, 132)",fill:!0},{label:"Sesiones de Relé",data:[],backgroundColor:"rgba(39, 158, 16, .1)",borderColor:"rgb(39, 158, 16)",fill:!0},{label:"Intel AMT",data:[],backgroundColor:"rgba(134, 16, 158, .1)",borderColor:"rgb(134, 16, 158)",fill:!0}]},r=0;r<serverTimelineStats.length;r++){new Date(serverTimelineStats[r].time);null!=serverTimelineStats[r].s&&-1==o.indexOf(serverTimelineStats[r].s)&&(o.push(serverTimelineStats[r].s),a)&&(n=serverTimelineStats[r].s,a=!1),null==serverTimelineStats[r].s&&(i=!0),serverTimelineStats[r].s==n&&(1==serverTimelineStats[r].first&&(s.datasets[0].data.push({x:serverTimelineStats[r].time-1,y:NaN}),s.datasets[1].data.push({x:serverTimelineStats[r].time-1,y:NaN}),s.datasets[2].data.push({x:serverTimelineStats[r].time-1,y:NaN}),s.datasets[3].data.push({x:serverTimelineStats[r].time-1,y:NaN}),s.datasets[4].data.push({x:serverTimelineStats[r].time-1,y:NaN})),serverTimelineStats[r].conn&&(s.datasets[0].data.push({x:serverTimelineStats[r].time,y:serverTimelineStats[r].conn.ca}),s.datasets[1].data.push({x:serverTimelineStats[r].time,y:serverTimelineStats[r].conn.cu}),s.datasets[2].data.push({x:serverTimelineStats[r].time,y:serverTimelineStats[r].conn.us}),s.datasets[3].data.push({x:serverTimelineStats[r].time,y:serverTimelineStats[r].conn.rs}),null!=serverTimelineStats[r].conn.am))&&s.datasets[4].data.push({x:serverTimelineStats[r].time,y:serverTimelineStats[r].conn.am})}}else if(1==e){serverTimelineConfig.options.scales.y.title.text="Megabytes",s={labels:[pastDate(0),t],datasets:[{label:"Externo",data:[],backgroundColor:"rgba(158, 151, 16, .1)",borderColor:"rgb(158, 151, 16)",fill:!0},{label:"Heap Usado",data:[],backgroundColor:"rgba(16, 84, 158, .1)",borderColor:"rgb(16, 84, 158)",fill:!0},{label:"Heap Total",data:[],backgroundColor:"rgba(255, 99, 132, .1)",borderColor:"rgb(255, 99, 132)",fill:!0},{label:"RSS",data:[],backgroundColor:"rgba(39, 158, 16, .1)",borderColor:"rgb(39, 158, 16)",fill:!0}]};for(r=0;r<serverTimelineStats.length;r++)null!=serverTimelineStats[r].s&&-1==o.indexOf(serverTimelineStats[r].s)&&(o.push(serverTimelineStats[r].s),a)&&(n=serverTimelineStats[r].s,a=!1),null==serverTimelineStats[r].s&&(i=!0),serverTimelineStats[r].s==n&&(1==serverTimelineStats[r].first&&(s.datasets[0].data.push({x:serverTimelineStats[r].time-1,y:NaN}),s.datasets[1].data.push({x:serverTimelineStats[r].time-1,y:NaN}),s.datasets[2].data.push({x:serverTimelineStats[r].time-1,y:NaN}),s.datasets[3].data.push({x:serverTimelineStats[r].time-1,y:NaN})),s.datasets[0].data.push({x:serverTimelineStats[r].time,y:serverTimelineStats[r].mem.external/1048576}),s.datasets[1].data.push({x:serverTimelineStats[r].time,y:serverTimelineStats[r].mem.heapUsed/1048576}),s.datasets[2].data.push({x:serverTimelineStats[r].time,y:serverTimelineStats[r].mem.heapTotal/1048576}),s.datasets[3].data.push({x:serverTimelineStats[r].time,y:serverTimelineStats[r].mem.rss/1048576}))}else if(3==e||4==e){serverTimelineConfig.options.scales.y.title.text="Megabytes",s={labels:[pastDate(0),t],datasets:[]};for(var l=0,r=0;r<serverTimelineStats.length;r++)null!=serverTimelineStats[r].traffic&&(null!=serverTimelineStats[r].s&&-1==o.indexOf(serverTimelineStats[r].s)&&(o.push(serverTimelineStats[r].s),a)&&(n=serverTimelineStats[r].s,a=!1),null==serverTimelineStats[r].s&&(i=!0),serverTimelineStats[r].s==n)&&serverTimelineStats[r].traffic&&(0<serverTimelineStats[r].traffic.AgentCtrlIn&&(l|=1),0<serverTimelineStats[r].traffic.CIRAIn&&(l|=2),0<serverTimelineStats[r].traffic.LMSIn&&(l|=4),0<serverTimelineStats[r].traffic.httpIn&&(l|=8),serverTimelineStats[r].traffic.relayIn&&(0<serverTimelineStats[r].traffic.relayIn[0]&&(l|=16),0<serverTimelineStats[r].traffic.relayIn[1]&&(l|=32),0<serverTimelineStats[r].traffic.relayIn[2]&&(l|=64),0<serverTimelineStats[r].traffic.relayIn[5]&&(l|=128),0<serverTimelineStats[r].traffic.relayIn[10]&&(l|=256),0<serverTimelineStats[r].traffic.relayIn[11]&&(l|=512),0<serverTimelineStats[r].traffic.relayIn[12])&&(l|=1024),serverTimelineStats[r].traffic.desktopMultiplex)&&0<serverTimelineStats[r].traffic.desktopMultiplex.in&&(l|=2048);for(r=0;r<13;r++)l&1<<r&&s.datasets.push({label:trafficSeriesNames[r],data:[],backgroundColor:seriesColor1(r),borderColor:seriesColor2(r),fill:!0,steppedLine:!0});for(r=0;r<serverTimelineStats.length;r++)if(null!=serverTimelineStats[r].traffic&&(null!=serverTimelineStats[r].s&&-1==o.indexOf(serverTimelineStats[r].s)&&(o.push(serverTimelineStats[r].s),a)&&(n=serverTimelineStats[r].s,a=!1),null==serverTimelineStats[r].s&&(i=!0),serverTimelineStats[r].s==n)){if(1==serverTimelineStats[r].first)for(var d=1;d<61440;d<<=1)l&d&&s.datasets[0].data.push({x:serverTimelineStats[r].time-1,y:NaN});var c=0;3==e?(1&l&&s.datasets[c++].data.push({x:serverTimelineStats[r].time,y:serverTimelineStats[r].traffic.AgentCtrlIn?serverTimelineStats[r].traffic.AgentCtrlIn/1048576:0}),2&l&&s.datasets[c++].data.push({x:serverTimelineStats[r].time,y:serverTimelineStats[r].traffic.CIRAIn?serverTimelineStats[r].traffic.CIRAIn/1048576:0}),4&l&&s.datasets[c++].data.push({x:serverTimelineStats[r].time,y:serverTimelineStats[r].traffic.LMSIn?serverTimelineStats[r].traffic.LMSIn/1048576:0}),8&l&&s.datasets[c++].data.push({x:serverTimelineStats[r].time,y:serverTimelineStats[r].traffic.httpIn?serverTimelineStats[r].traffic.httpIn/1048576:0}),16&l&&s.datasets[c++].data.push({x:serverTimelineStats[r].time,y:serverTimelineStats[r].traffic.relayIn&&serverTimelineStats[r].traffic.relayIn[0]?serverTimelineStats[r].traffic.relayIn[0]/1048576:0}),32&l&&s.datasets[c++].data.push({x:serverTimelineStats[r].time,y:serverTimelineStats[r].traffic.relayIn&&serverTimelineStats[r].traffic.relayIn[1]?serverTimelineStats[r].traffic.relayIn[1]/1048576:0}),64&l&&s.datasets[c++].data.push({x:serverTimelineStats[r].time,y:serverTimelineStats[r].traffic.relayIn&&serverTimelineStats[r].traffic.relayIn[2]?serverTimelineStats[r].traffic.relayIn[2]/1048576:0}),128&l&&s.datasets[c++].data.push({x:serverTimelineStats[r].time,y:serverTimelineStats[r].traffic.relayIn&&serverTimelineStats[r].traffic.relayIn[5]?serverTimelineStats[r].traffic.relayIn[5]/1048576:0}),256&l&&s.datasets[c++].data.push({x:serverTimelineStats[r].time,y:serverTimelineStats[r].traffic.relayIn&&serverTimelineStats[r].traffic.relayIn[10]?serverTimelineStats[r].traffic.relayIn[10]/1048576:0}),512&l&&s.datasets[c++].data.push({x:serverTimelineStats[r].time,y:serverTimelineStats[r].traffic.relayIn&&serverTimelineStats[r].traffic.relayIn[11]?serverTimelineStats[r].traffic.relayIn[11]/1048576:0}),1024&l&&s.datasets[c++].data.push({x:serverTimelineStats[r].time,y:serverTimelineStats[r].traffic.relayIn&&serverTimelineStats[r].traffic.relayIn[12]?serverTimelineStats[r].traffic.relayIn[12]/1048576:0}),2048&l&&s.datasets[c++].data.push({x:serverTimelineStats[r].time,y:serverTimelineStats[r].traffic.desktopMultiplex&&serverTimelineStats[r].traffic.desktopMultiplex.in?serverTimelineStats[r].traffic.desktopMultiplex.in/1048576:0})):4==e&&(1&l&&s.datasets[c++].data.push({x:serverTimelineStats[r].time,y:serverTimelineStats[r].traffic.AgentCtrlOut?serverTimelineStats[r].traffic.AgentCtrlOut/1048576:0}),2&l&&s.datasets[c++].data.push({x:serverTimelineStats[r].time,y:serverTimelineStats[r].traffic.CIRAOut?serverTimelineStats[r].traffic.CIRAOut/1048576:0}),4&l&&s.datasets[c++].data.push({x:serverTimelineStats[r].time,y:serverTimelineStats[r].traffic.LMSOut?serverTimelineStats[r].traffic.LMSOut/1048576:0}),8&l&&s.datasets[c++].data.push({x:serverTimelineStats[r].time,y:serverTimelineStats[r].traffic.httpOut?serverTimelineStats[r].traffic.httpOut/1048576:0}),16&l&&s.datasets[c++].data.push({x:serverTimelineStats[r].time,y:serverTimelineStats[r].traffic.relayOut&&serverTimelineStats[r].traffic.relayOut[0]?serverTimelineStats[r].traffic.relayOut[0]/1048576:0}),32&l&&s.datasets[c++].data.push({x:serverTimelineStats[r].time,y:serverTimelineStats[r].traffic.relayOut&&serverTimelineStats[r].traffic.relayOut[1]?serverTimelineStats[r].traffic.relayOut[1]/1048576:0}),64&l&&s.datasets[c++].data.push({x:serverTimelineStats[r].time,y:serverTimelineStats[r].traffic.relayOut&&serverTimelineStats[r].traffic.relayOut[2]?serverTimelineStats[r].traffic.relayOut[2]/1048576:0}),128&l&&s.datasets[c++].data.push({x:serverTimelineStats[r].time,y:serverTimelineStats[r].traffic.relayOut&&serverTimelineStats[r].traffic.relayOut[5]?serverTimelineStats[r].traffic.relayOut[5]/1048576:0}),256&l&&s.datasets[c++].data.push({x:serverTimelineStats[r].time,y:serverTimelineStats[r].traffic.relayOut&&serverTimelineStats[r].traffic.relayOut[10]?serverTimelineStats[r].traffic.relayOut[10]/1048576:0}),512&l&&s.datasets[c++].data.push({x:serverTimelineStats[r].time,y:serverTimelineStats[r].traffic.relayOut&&serverTimelineStats[r].traffic.relayOut[11]?serverTimelineStats[r].traffic.relayOut[11]/1048576:0}),1024&l&&s.datasets[c++].data.push({x:serverTimelineStats[r].time,y:serverTimelineStats[r].traffic.relayOut&&serverTimelineStats[r].traffic.relayOut[12]?serverTimelineStats[r].traffic.relayOut[12]/1048576:0}),2048&l)&&s.datasets[c++].data.push({x:serverTimelineStats[r].time,y:serverTimelineStats[r].traffic.desktopMultiplex&&serverTimelineStats[r].traffic.desktopMultiplex.out?serverTimelineStats[r].traffic.desktopMultiplex.out/1048576:0})}}else if(5==e){serverTimelineConfig.options.scales.y.title.text="Uso",s={labels:[pastDate(0),t],datasets:[{label:"CPU",data:[],backgroundColor:"rgba(158, 151, 16, .1)",borderColor:"rgb(158, 151, 16)",fill:!0}]};for(r=0;r<serverTimelineStats.length;r++)"object"==typeof serverTimelineStats[r].cpu&&"number"==typeof serverTimelineStats[r].cpu[0]&&(null!=serverTimelineStats[r].s&&-1==o.indexOf(serverTimelineStats[r].s)&&(o.push(serverTimelineStats[r].s),a)&&(n=serverTimelineStats[r].s,a=!1),null==serverTimelineStats[r].s&&(i=!0),serverTimelineStats[r].s==n)&&(1==serverTimelineStats[r].first&&s.datasets[0].data.push({x:serverTimelineStats[r].time-1,y:NaN}),s.datasets[0].data.push({x:serverTimelineStats[r].time,y:serverTimelineStats[r].cpu[0]}))}if(serverTimelineConfig.data=s,window.serverMainStats.update(),0<o.length){for(var u="",r=0;r<o.length;r++)u+='<option value="'+encodeURIComponentEx(o[r])+'"'+(n==o[r]?" selected":"")+">"+EscapeHtml(o[r])+"</option>";i&&(u+='<option value=""'+(null==n?" selected":"")+">Nulo</option>"),QH("p40server",u)}QV("p40server",0<o.length)}}function p40downloadEvents(){for(var e="time, conn.agent, conn.users, conn.usersessions, conn.relaysession, conn.intelamt, mem.external, mem.heapused, mem.heaptotal, mem.rss\r\n",t=0;t<serverTimelineStats.length;t++)serverTimelineStats[t].conn&&serverTimelineStats[t].mem&&(e+=new Date(serverTimelineStats[t].time)+", "+serverTimelineStats[t].conn.ca+", "+serverTimelineStats[t].conn.cu+", "+serverTimelineStats[t].conn.us+", "+serverTimelineStats[t].conn.rs+", "+(serverTimelineStats[t].conn.am||"")+", "+serverTimelineStats[t].mem.external+", "+serverTimelineStats[t].mem.heapUsed+", "+serverTimelineStats[t].mem.heapTotal+", "+serverTimelineStats[t].mem.rss+"\r\n");saveAs(stringToUtf8Blob(e),"ServerStats.csv")}var xxdialogMode,xxdialogFunc,xxdialogButtons,xxdialogTag,serverTrace=[],serverTraceSources=[];function displayServerTrace(){var e,t="",o=parseInt(Q("p41limitdropdown").value);for(e in serverTrace.length>o&&serverTrace.splice(o),serverTrace){var n,i=[];for(n in serverTrace[e].args)"object"==typeof serverTrace[e].args[n]?i.push(JSON.stringify(serverTrace[e].args[n])):i.push(serverTrace[e].args[n]);t+="<div class=traceEvent onclick=showTraceEvent("+e+")>"+EscapeHtml(new Date(serverTrace[e].time).toLocaleTimeString())+" - <b>"+EscapeHtml(serverTrace[e].source.toUpperCase())+"</b>: "+EscapeHtml(i.join(", "))+"</div>"}QH("p41events",t)}function showTraceEvent(e){var t=serverTrace[e],o="";if(!xxdialogMode&&null!=t){for(var e in t.args)"object"==typeof t.args[e]?o+=EscapeHtml(JSON.stringify(t.args[e]))+"<br /><br />":o+=EscapeHtml(t.args[e])+"<br /><br />";xxdialogButtons=1,setModalContent("xxAddAgent","Evento de Seguimiento del Servidor","<div class=selecttext style=max-height:300px;overflow-y:auto>"+o+"</div>"),showModal("xxAddAgentModal","idx_dlgOkButton",null)}}function clearServerTracing(){serverTrace=[],displayServerTrace()}function setServerTracing(){var e='<div style="max-height:200px;overflow-y:auto">';setModalContent("xxAddAgent","Seguimiento del Servidor",(e+='<div style="width:100%;border-bottom:1px solid gray;margin-bottom:5px;margin-top:5px"><b>Servidor Central</b></div>')+('<div><label><input type=checkbox class="form-check-input me-2" id=p41c1 '+(0<=serverTraceSources.indexOf("cookie")?"checked":"")+">Codificador de Cookie</label></div>")+('<div><label><input type=checkbox class="form-check-input me-2" id=p41c2 '+(0<=serverTraceSources.indexOf("dispatch")?"checked":"")+">Despachador de Mensajes</label></div>")+('<div><label><input type=checkbox class="form-check-input me-2" id=p41c3 '+(0<=serverTraceSources.indexOf("main")?"checked":"")+">Mensajes del Servidor Principal</label></div>")+('<div><label><input type=checkbox class="form-check-input me-2" id=p41c4 '+(0<=serverTraceSources.indexOf("peer")?"checked":"")+">Emparejamiento de Servidores MeshCentral</label></div>")+('<div><label><input type=checkbox class="form-check-input me-2" id=p41c15 '+(0<=serverTraceSources.indexOf("agent")?"checked":"")+">Tráfico del MeshAgent</label></div>")+('<div><label><input type=checkbox class="form-check-input me-2" id=p41c14 '+(0<=serverTraceSources.indexOf("agentupdate")?"checked":"")+">Actualización del Agente Mesh</label></div>")+('<div><label><input type=checkbox class="form-check-input me-2" id=p41c16 '+(0<=serverTraceSources.indexOf("cert")?"checked":"")+">Certificado del Servidor</label></div>")+('<div><label><input type=checkbox class="form-check-input me-2" id=p41c17 '+(0<=serverTraceSources.indexOf("db")?"checked":"")+">Base de Datos del Servidor</label></div>")+('<div><label><input type=checkbox class="form-check-input me-2" id=p41c18 '+(0<=serverTraceSources.indexOf("email")?"checked":"")+">Correo electrónico / SMS / Tráfico push</label></div>")+'<div style="width:100%;border-bottom:1px solid gray;margin-bottom:5px;margin-top:5px"><b>Servidor Web</b></div>'+('<div><label><input type=checkbox class="form-check-input me-2" id=p41c5 '+(0<=serverTraceSources.indexOf("web")?"checked":"")+">Servidor Web</label></div>")+('<div><label><input type=checkbox class="form-check-input me-2" id=p41c6 '+(0<=serverTraceSources.indexOf("webrequest")?"checked":"")+">Solicitudes al Servidor Web</label></div>")+('<div><label><input type=checkbox class="form-check-input me-2" id=p41c7 '+(0<=serverTraceSources.indexOf("relay")?"checked":"")+">Web Socket Relay</label></div>")+('<div><label><input type=checkbox class="form-check-input me-2" id=p41c20 '+(0<=serverTraceSources.indexOf("httpheaders")?"checked":"")+">Encabezados HTTP del Servidor Web</label></div>")+('<div><label><input type=checkbox class="form-check-input me-2" id=p41c21 '+(0<=serverTraceSources.indexOf("authlog")?"checked":"")+">Log de autenticacion de usuario</label></div>")+'<div style="width:100%;border-bottom:1px solid gray;margin-bottom:5px;margin-top:5px"><b>Intel&reg; AMT</b></div>'+('<div><label><input type=checkbox class="form-check-input me-2" id=p41c19 '+(0<=serverTraceSources.indexOf("amt")?"checked":"")+">Gerente de Intel AMT</label></div>")+('<div><label><input type=checkbox class="form-check-input me-2" id=p41c9 '+(0<=serverTraceSources.indexOf("webrelay")?"checked":"")+">Relay de Conexión</label></div>")+('<div><label><input type=checkbox class="form-check-input me-2" id=p41c10 '+(0<=serverTraceSources.indexOf("mps")?"checked":"")+">Servidor CIRA</label></div>")+('<div><label><input type=checkbox class="form-check-input me-2" id=p41c11 '+(0<=serverTraceSources.indexOf("mpscmd")?"checked":"")+">Comandos del Servidor CIRA</label></div>")+"</div>"),showModal("xxAddAgentModal","idx_dlgOkButton",setServerTracingEx)}function setServerTracingEx(){for(var e=[],t=["cookie","dispatch","main","peer","web","webrequest","relay","webrelaydata","webrelay","mps","mpscmd","swarm","swarmcmd","agentupdate","agent","cert","db","email","amt","httpheaders","authlog"],o=1;o<22;o++)try{Q("p41c"+o).checked&&e.push(t[o-1])}catch(e){}meshserver.send({action:"traceinfo",traceSources:e})}function p41downloadServerTrace(){var e,t="time, source, message\r\n";for(e in serverTrace)t+='"'+new Date(serverTrace[e].time).toLocaleTimeString()+'","'+serverTrace[e].source+'","'+serverTrace[e].args.join(", ")+'"\r\n';return saveAs(stringToUtf8Blob(t),"servertrace.csv"),!1}function setupServiceWorker(){0!=(8&features2)&&"string"==typeof serverinfo.vapidpublickey&&null!=Notification&&"granted"==Notification.permission&&"serviceWorker"in navigator&&navigator.serviceWorker.register("serviceworker.js").then(function(e){navigator.serviceWorker.ready.then(function(e){e.pushManager.subscribe({applicationServerKey:urlBase64ToUint8Array(serverinfo.vapidpublickey),userVisibleOnly:!0}).then(function(e){meshserver.send({action:"webpush",sub:e})}).catch(function(e){console.error("Worker: Unable to subscribe to push",e)})})}).catch(function(e){console.log("Worker: Registration failed",e)})}var xxcurrentView=-1;function setDialogMode(e,t,o,n,i,a){setSessionActivity(),QV("uiMenu",!1),xxdialogMode=e,xxdialogFunc=n,xxdialogButtons=o,xxdialogTag=a,QV("id_dialogclose",2&o||8&o),QV("idx_dlgDeleteButton",4&o),QV("idx_dlgButtonBar",7&o),QV("idx_dlgMoreButtons",16&o),t&&QH("xxAddAgentTitle",t);for(var s=1;s<24;s++)QV("dialog"+s,s==e);QV("dialog",e),i&&(2==e?QH("id_dialogOptions",i):QH("id_dialogMessage",i)),0==e&&xxModal&&xxModal.hide(),MoreToggle(!1)}function dialogclose(e){setSessionActivity(),(8&xxdialogButtons||e)&&xxdialogFunc&&xxdialogFunc(e,xxdialogTag)}function center(){setSessionActivity(),11==xxcurrentView?deskAdjust():10==xxcurrentView?mainUpdate(256):1==xxcurrentView&&mainUpdate(4)}function messagebox(e,t){setSessionActivity(),QH("id_dialogMessage",t),setDialogMode(1,e,1)}function statusbox(e,t){setSessionActivity(),QH("id_dialogMessage",t),setDialogMode(1,e)}var backStack=[];function goBack(){setSessionActivity(),xxdialogMode||0==goBackStack.length||(fullscreen&&deskToggleFull(),go(goBackStack.pop()),goBackStack.pop())}function goForward(e){xxdialogMode||(backStack.push(e),goStack())}function goStack(){if(0==backStack.length)go(2);else{var e=backStack[backStack.length-1],t=e.split("/")[0];if("node"==t&&(setupDeviceMenu(0),gotoDevice(e)),"mesh"==t&&gotoMesh(e),"devices"==t&&go(1),"account"==t&&go(2),"events"==t&&go(3),"users"==t&&go(4),"files"==t){if(262144&features&&!(1==userinfo.otpsecret||0<userinfo.otphkeys||0<userinfo.otpkeys||8388608&features&&1==userinfo.otpekey))return void setDialogMode(2,"Seguridad de la Cuenta",1,null,'Unable to access this feature until two-factor authentication is enabled. This is required for extra security. Go to the "My Account" and look at the "Account Security" section.');go(5)}"server"==t&&go(6)}}function go(e,t){if((!t||3!=t.which&&2!=t.button)&&(262144&features&&0==count2factoraAuths()&&2<e&&(e=2,setModalContent("xxAddAgent","Seguridad de la Cuenta",'Unable to access this feature until two - factor authentication is enabled.This is required for extra security.Go to the "My Account" tab and look at the "Account Security" section.'),showModal("xxAddAgentModal","idx_dlgOkButton")),null!=pluginHandler&&pluginHandler.callHook("goPageStart",e,t),setSessionActivity(),!xxdialogMode))if(QV("uiMenu",!1),!t||1!=t.shiftKey&&2!=t.which&&1!=t.button||15==e||""!="{{{currentNode}}}".toLowerCase()){if(xxcurrentView!=e){xxcurrentView<0||e<10?goBackStack=[]:50!=xxcurrentView&&Math.floor(xxcurrentView/10)==Math.floor(e/10)||goBackStack.push(xxcurrentView),11==xxcurrentView&&null!=desktop&&null!=desktop.m.recordedData&&deskRecordSession(),(4==e&&null!=userinfo&&0==(2&userinfo.siteadmin)||0!=(4&features))&&(e=52),17==xxcurrentView&&deviceDetailsStatsClear();for(var o=0;o<61;o++)QV("p"+o,o==e);if(xxcurrentView=e,fullscreen&&deskToggleFull(),0==(268435456&features)&&0<xxcurrentView){var n="";for(o in 10<=xxcurrentView&&xxcurrentView<=19?null!=currentNode&&(n="?viewmode="+xxcurrentView+"&gotonode="+currentNode._id.split("/")[2]):20<=xxcurrentView&&xxcurrentView<=29?null!=currentMesh&&(n="?viewmode="+xxcurrentView+"&gotomesh="+currentMesh._id.split("/")[2]):30<=xxcurrentView&&xxcurrentView<=39?null!=currentUser&&(n="?viewmode="+xxcurrentView+"&gotouser="+(serverinfo.crossDomain?currentUser._id:currentUser._id.split("/")[2])):51<=xxcurrentView&&xxcurrentView<=51?null!=currentUserGroup&&null!=currentUserGroup._id&&(n="?viewmode="+xxcurrentView+"&gotougrp="+(serverinfo.crossDomain?currentUserGroup._id:currentUserGroup._id.split("/")[2])):1<xxcurrentView&&(n="?viewmode="+xxcurrentView),urlargs)n+=(""==n?"?":"&")+o+"="+urlargs[o];try{window.history.replaceState({},document.title,window.location.pathname+n)}catch(e){}}var i=["MainMenuMyDevices","MainMenuMyAccount","MainMenuMyEvents","MainMenuMyFiles","MainMenuMyUsers","MainMenuMyServer"];for(o in i)QC(i[o]).remove("fullselect"),QC(i[o]).remove("semiselect");var a=["LeftMenuMyDevices","LeftMenuMyAccount","LeftMenuMyEvents","LeftMenuMyFiles","LeftMenuMyUsers","LeftMenuMyServer"];for(o in a)QC(a[o]).remove("lbbuttonsel"),QC(a[o]).remove("lbbuttonsel2");var s=e<9?"fullselect":"semiselect",r=e<9||115==e||40==e||41==e||42==e?"lbbuttonsel2":"lbbuttonsel",l=0,d=(0<goBackStack.length&&(l=goBackStack[goBackStack.length-1]),1==e||1==l||0==l&&10<=e&&e<20?(QC("MainMenuMyDevices").add(s),QC("LeftMenuMyDevices").add(r)):2==e||2==l||0==l&&20<=e&&e<30?(QC("MainMenuMyAccount").add(s),QC("LeftMenuMyAccount").add(r)):3==e||60==e?(QC("MainMenuMyEvents").add(s),QC("LeftMenuMyEvents").add(r)):4==e||30<=e&&e<40||50==e||51==e||52==e?(QC("MainMenuMyUsers").add(s),QC("LeftMenuMyUsers").add(r)):5==e?(QC("MainMenuMyFiles").add(s),QC("LeftMenuMyFiles").add(r)):(6==e||115==e||40<=e&&e<50)&&(QC("MainMenuMyServer").add(s),QC("LeftMenuMyServer").add(r)),QV("ServerPlugins",null!=pluginHandler),webPageStackMenu&&10<=e?QC("column_l").add("room4submenu"):QC("column_l").remove("room4submenu"),QV("topbar",0!=e),0==e&&webPageFullScreen&&QC("body").add("arg_hide"),QV("MainSubMenuSpan",10<=e&&e<20),QV("UserDummyMenuSpan",51==e||e<10&&6!=e&&webPageFullScreen),QV("MeshSubMenuSpan",20<=e&&e<30),QV("UserSubMenuSpan",30<=e&&e<40),QV("ServerSubMenuSpan",6==e||115==e||40==e||41==e||42==e||43==e),QV("UsersSubMenuSpan",4==e||50==e||52==e),QV("EventsSubMenuSpan",3==e||60==e),{3:"EventsLive",4:"UsersGeneral",10:"MainDev",11:"MainDevDesktop",12:"MainDevTerminal",13:"MainDevFiles",14:"MainDevAmt",15:"MainDevConsole",16:"MainDevEvents",17:"MainDevInfo",19:"MainDevPlugins",20:"MeshGeneral",21:"MeshSummary",30:"UserGeneral",31:"UserEvents",6:"ServerGeneral",40:"ServerStats",41:"ServerTrace",42:"ServerPlugins",50:"UsersGroups",52:"UsersRecordings",60:"EventsReport",115:"ServerConsole"});for(o in d)QC(d[o]).remove("style3x"),QC(d[o]).remove("style3sel"),QC(d[o]).add(e==o?"style3sel":"style3x");11==e&&deskAdjust(),115==e&&QV("p15",!0),QV("p15uploadCore",115!=e),QV("p15BackButton",115!=e&&0==(32&args.hide)&&""=="{{currentNode}}".toLowerCase()),15!=e&&115!=e||setupConsole(),1==e&&mainUpdate(4),2==e&&Notification&&QV("accountEnableNotificationsSpan","granted"!=Notification.permission),40==e&&null==serverTimelineStats&&refreshServerTimelineStats(),42==e&&refreshPluginLatest(),21==e&&p21updateMesh(),52==e&&(null==p52recordings&&refreshRecodings(),updateRecordings()),12==e&&null!=xtermfit&&(xtermfit.fit(),xterm.focus()),document.title=currentNode&&10<=e&&e<20?currentNode.name+(meshes[currentNode.meshid]?" - "+meshes[currentNode.meshid].name:"")+" - "+decodeURIComponent("{{{extitle}}}"):decodeURIComponent("{{{extitle}}}"),null!=pluginHandler&&pluginHandler.callHook("goPageEnd",e,t),QS("column_l").overflow=0<=[11,12].indexOf(e)?"hidden":null}}else 10<=e&&e<=19?currentNode&&safeNewWindow(window.location.origin+"{{{domainurl}}}?gotonode="+currentNode._id.split("/")[2]+"&viewmode="+e+"&hide=16"+(urlargs.key?"&key="+urlargs.key:""),"meshcentral:"+currentNode._id):20<=e&&e<=29?currentMesh&&safeNewWindow(window.location.origin+"{{{domainurl}}}?gotomesh="+currentMesh._id.split("/")[2]+"&viewmode="+e+"&hide=16"+(urlargs.key?"&key="+urlargs.key:""),"meshcentral:"+currentMesh._id):30<=e&&e<=39?currentUser&&safeNewWindow(window.location.origin+"{{{domainurl}}}?gotouser="+(serverinfo.crossDomain?currentUser._id:currentUser._id.split("/")[2])+"&viewmode="+e+"&hide=16"+(urlargs.key?"&key="+urlargs.key:""),"meshcentral:"+currentUser._id):50<=e&&e<=59?currentUserGroup&&safeNewWindow(window.location.origin+"{{{domainurl}}}?gotougrp="+(serverinfo.crossDomain?currentUserGroup._id:currentUserGroup._id.split("/")[2])+"&viewmode="+e+"&hide=16"+(urlargs.key?"&key="+urlargs.key:""),"meshcentral:"+currentUserGroup._id):safeNewWindow(window.location.origin+"{{{domainurl}}}?viewmode="+e+"&hide=0"+(urlargs.key?"&key="+urlargs.key:""),"meshcentral:"+e)}function updatePluginList(e){if(null!=pluginHandler){if(Array.isArray(e)&&e.forEach(function(e){updatePluginList(e)}),QV("pluginNoneNotice",0==installedPluginList.length),installedPluginList.length){if(null!=e&&(null==installedPluginList.version_info&&(installedPluginList.version_info=[]),installedPluginList.version_info[e.id]=e),(o=Q("p42tbl").querySelectorAll(".p42tblRow")).length)for(var t in Object.values(o))o[t].parentNode.removeChild(o[t]);var s={0:{text:"Disabled",color:"858483"},1:{text:"Installed",color:"00aa00"}},r={0:{install:"Install",delete:"Delete"},1:{disable:"Disable",upgrade:"Upgrade"}},l=Q("p42tbl");installedPluginList.forEach(function(e){var t,o=[],n=(1==e.hasAdminPanel&&e.status?e.nameHtml="<a onclick=\"return goPlugin('"+e.shortName+"', '"+e.name.replace(/'/g,"\\'")+"');\">"+EscapeHtml(e.name)+"</a>":e.nameHtml=EscapeHtml(e.name),e.statusText=s[e.status].text,e.statusColor=s[e.status].color,null==e.versionHistoryUrl&&o.push("downgrade"),e.status||(e.version=" - "),e.upgradeAvail="Comprobando...",null!=installedPluginList.version_info&&null!=installedPluginList.version_info[e._id]&&(!(i=installedPluginList.version_info[e._id]).hasUpdate&&(o.push("upgrade"),e.status)?e.upgradeAvail="Actualizado":e.upgradeAvail='<a title="Ver Registro de Cambios" rel="noreferrer noopener" target="_blank" href="'+i.changelogUrl+'">'+i.version+"</a>",i.meshCentralCompat||(e.upgradeAvail+=" [ <span onclick=\"return setModalContent('xxAddAgent', 'Compatibility Issue', 'This plugin version is not compatible with your MeshCentral installation, please upgrade MeshCentral first.');showModal('xxAddAgentModal', 'idx_dlgOkButton');\" title=\"Versión incompatible, por favor primero actualiza tu instalación de MeshCentral\" style=\"cursor: pointer; color:red;\"> ! </span> ]",o.push("install"),o.push("upgrade"))),e.actions="<select onchange=\"return pluginAction(this,'"+e._id+'\');"><option value=""> --</option>',Object.entries(r[e.status]));for(t in n)-1===o.indexOf(n[t][0])&&(e.actions+='<option value="'+n[t][0]+'">'+n[t][1]+"</option>");e.actions+="</select>";var i="<td><img style=margin-top:3px src=images/plugin24.png></td><td class=gradTable1>&nbsp;</td><td class=gradTable2>"+e.nameHtml+"</td><td class=gradTable2>"+EscapeHtml(e.description)+'</td><td class=gradTable2 style=text-align:center><a href="'+EscapeHtml(e.homepage)+'" rel="noreferrer noopener" target="_blank">Home</a></td><td class=gradTable2 style=text-align:center>'+EscapeHtml(e.version)+'</td><td style=text-align:center class="pluginUpgradeAvailable gradTable2">'+e.upgradeAvail+'</td><td class=gradTable2 style="text-align:center;color:#'+e.statusColor+'">'+e.statusText+'</td><td class="pluginAction gradTable2" style=text-align:center>'+e.actions+"</td><td class=gradTable3>&nbsp;</td>",a=l.insertRow(-1);a.innerHTML=i,a.classList.add("p42tblRow"),a.setAttribute("data-id",e._id),a.setAttribute("id","pluginRow-"+e._id)})}else{var o=Q("p42tbl").querySelectorAll(".p42tblRow");for(t in Object.values(o))o[t].parentNode.removeChild(o[t])}null==e&&refreshPluginLatest()}}function refreshPluginLatest(){null!=pluginHandler&&meshserver.send({action:"pluginLatestCheck"})}function distributeCore(){null!=pluginHandler&&(meshserver.send({action:"distributeCore",nodes:nodes}),QV("pluginRestartNotice",!1))}function pluginActionEx(){if(null!=pluginHandler){var e=Q("lastPluginAct").value,t=Q("lastPluginId").value,o=Q("lastPluginVersion").value;switch(e){case"upgrade":case"install":meshserver.send({action:"installplugin",id:t,version_only:!1});break;case"downgrade":Q("lastPluginVersion").querySelectorAll("option").forEach(function(e){e.value==o&&(pVers=e.text)}),meshserver.send({action:"installplugin",id:t,version_only:{name:pVers,url:o}});break;case"delete":meshserver.send({action:"removeplugin",id:t});break;case"disable":meshserver.send({action:"disableplugin",id:t})}QV("pluginRestartNotice",!0)}}function pluginAction(e,t){if(null!=pluginHandler){if("downgrade"==e.value)meshserver.send({action:"getpluginversions",id:t});else{var o,n=null;for(o in installedPluginList)installedPluginList[o]._id==t&&(n=installedPluginList[o]);setModalContent("xxAddAgent","Acción de Plugin",format("¿Estás seguro de que desea {0} el plugin: {1}?",e.value,n.name)+'<input id="lastPluginAct" type="hidden" value="'+e.value+'" /><input id="lastPluginId" type="hidden" value="'+t+'" /><input id="lastPluginVersion" type="hidden" value="" />'),showModal("xxAddAgentModal","idx_dlgOkButton",()=>pluginActionEx())}e.value=""}}function goPlugin(e,t){null!=pluginHandler&&(null==e?Q("p43iframe").src="":(QH("p43title",t),Q("p43iframe").src="/pluginadmin.ashx?pin="+e,go(43)))}function removeUserRights(e,t){var o;return t==userinfo._id&&null!=userinfo.removeRights&&((o=t=0)!=(8&userinfo.removeRights)&&(o+=8),0!=(65536&userinfo.removeRights)&&(t+=65536),0!=(256&userinfo.removeRights)&&(t+=256),0!=(512&userinfo.removeRights)&&(t+=512),0!=(1024&userinfo.removeRights)&&(t+=1024),0!=(16&userinfo.removeRights)&&(o+=16),0!=(32768&userinfo.removeRights)&&(o+=32768),0!=(131072&userinfo.removeRights)&&(o+=131072),0!=(64&userinfo.removeRights)&&(o+=64),0!=(262144&userinfo.removeRights)&&(o+=262144),e=4294967295!=e?(e|t)&4294967295-o:((e=2015471)|t)&4294967295-o),e}function GetMeshRights(e,t){if(null==e)return 0;if(null==t&&(t=userinfo._id),null==(e="string"==typeof e?meshes[e]:e)||null==e.links)return 0;if(serverinfo.manageAllDeviceGroups&&t==userinfo._id)return removeUserRights(4294967295,t);var o=0,n=e.links[t];if(null!=n){if(4294967295==n.rights)return removeUserRights(4294967295,t);o=n.rights}var i=null;if(t==userinfo._id?i=userinfo:null!=users&&(i=users[t]),null!=i)for(var a in i.links)if(a.startsWith("ugrp/")&&null!=(n=e.links[a])){if(4294967295==n.rights)return removeUserRights(4294967295,t);o|=n.rights}return removeUserRights(o,t)}function IsMeshViewable(e,t){if(null!=e&&(null==t&&(t=userinfo._id),null!=(e="string"==typeof e?meshes[e]:e))&&null!=e.links){if(null!=e.links[t])return!0;if(serverinfo.manageAllDeviceGroups&&t==userinfo._id)return!0;var o=null;if(t==userinfo._id?o=userinfo:null!=users&&(o=users[t]),null!=o)for(var n in o.links)if(n.startsWith("ugrp/")&&null!=e.links[n])return!0}return!1}function GetNodeRights(e,t){if(null==e)return 0;if(null==t&&(t=userinfo._id),"string"==typeof e&&null==(e=getNodeFromId(e)))return 0;var o=GetMeshRights(e.meshid,t);if(4294967295!=o&&(null!=e.links&&null!=e.links[t]&&(o|=e.links[t].rights),null!=e.links)&&null!=userinfo.links)for(var n in e.links)n.startsWith("ugrp/")&&null!=userinfo.links[n]&&null!=e.links[n].rights&&(o|=e.links[n].rights);return removeUserRights(o,t)}function IsNodeViewable(e,t){if(null!=e&&(null==t&&(t=userinfo._id),"string"!=typeof e||null!=(e=getNodeFromId(e)))){if(IsMeshViewable(e.meshid,t))return!0;if(null!=e.links&&null!=e.links[t])return!0;if(null!=e.links&&null!=userinfo.links)for(var o in e.links)if(o.startsWith("ugrp/")&&null!=userinfo.links[o]&&null!=e.links[o].rights)return!0}return!1}if("undefined"==typeof TextEncoder){window.TextEncoder=function(){},TextEncoder.prototype.encode=function(e){for(var t,o=e.length,n=-1,i="undefined"==typeof Uint8Array?new Array(1.5*o):new Uint8Array(3*o),a=0,s=0;s!==o;){if(a=e.charCodeAt(s),s+=1,55296<=a&&a<=56319){if(s===o){i[n+=1]=239,i[n+=1]=191,i[n+=1]=189;break}if(!(56320<=(t=e.charCodeAt(s))&&t<=57343)){i[n+=1]=239,i[n+=1]=191,i[n+=1]=189;continue}if(s+=1,65535<(a=1024*(a-55296)+t-56320+65536)){i[n+=1]=240|a>>>18,i[n+=1]=128|a>>>12&63,i[n+=1]=128|a>>>6&63,i[n+=1]=128|63&a;continue}}a<=127?i[n+=1]=0|a:(a<=2047?i[n+=1]=192|a>>>6:(i[n+=1]=224|a>>>12,i[n+=1]=128|a>>>6&63),i[n+=1]=128|63&a)}return"undefined"!=typeof Uint8Array?i.subarray(0,n+1):(i.length=n+1,i)},TextEncoder.prototype.toString=function(){return"[object TextEncoder]"};try{Object.defineProperty(TextEncoder.prototype,"encoding",{get:function(){if(TextEncoder.prototype.isPrototypeOf(this))return"utf-8";throw TypeError("Illegal invocation")}})}catch(e){TextEncoder.prototype.encoding="utf-8"}"undefined"!=typeof Symbol&&(TextEncoder.prototype[Symbol.toStringTag]="TextEncoder")}function urlBase64ToUint8Array(e){for(var e=(e+"=".repeat((4-e.length%4)%4)).replace(/-/g,"+").replace(/_/g,"/"),t=atob(e),o=new Uint8Array(t.length),n=0;n<t.length;++n)o[n]=t.charCodeAt(n);return o}function joinPaths(){var e,t=[];for(e in arguments){var o=arguments[e];if(null!=o&&""!=o){for(;o.endsWith("/")||o.endsWith("\\");)o=o.substring(0,o.length-1);for(;o.startsWith("/")||o.startsWith("\\");)o=o.substring(1);t.push(o)}}return t.join("/")}function putstore(e,t){try{if("undefined"==typeof localStorage||localStorage.getItem(e)==t)return;null==t?localStorage.removeItem(e):localStorage.setItem(e,t)}catch(e){}if("_"!=e[0]){var o={};try{for(var n=0,i=localStorage.length;n<i;++n){var a=localStorage.key(n);"_"!=a[0]&&(o[a]=localStorage.getItem(a),"desktopsettings"!=a)&&"stars"!=a&&"deskKeyShortcuts"!=a&&"deskStrings"!=a&&"cmdopt"!=a&&"string"==typeof o[a]&&64<o[a].length&&delete o[a]}}catch(e){}meshserver.send({action:"userWebState",state:JSON.stringify(o)})}}function stringToUtf8Blob(e){var t=(new TextEncoder).encode(e),o=new Uint8Array(3+t.length);o[0]=239,o[1]=187,o[2]=191;for(var n=0;n<t.length;n++)o[n+3]=t[n];return new Blob([o],{type:"application/octet-stream"})}function stringToUtf8BlobNoHeader(e){return new Blob([(new TextEncoder).encode(e)],{type:"application/octet-stream"})}function multiTranslate(e){var t=e.indexOf("]|");return e.substring(t+2)}function getLang(){return null!=navigator.languages?navigator.languages[0]:navigator.language}function getNodeAmtVersion(e){return null==e||null==e.intelamt||"string"!=typeof e.intelamt.ver||(e=e.intelamt.ver.split(".")).length<2?0:parseInt(e[0])+parseInt(e[1])/100}function getstore(e,t){try{var o;return"undefined"==typeof localStorage?t:null==(o=localStorage.getItem(e))?t:o}catch(e){return t}}function addLink(e,t){return'<span tabindex=0 role="button" onclick=\''+t+"' onkeypress=\"if (event.key=='Enter') {"+t+'} ">'+e+' <i class="fa-solid fa-pencil fa-xs"></i></span>'}function addLinkConditional(e,t,o){return o?addLink(e,t):e}function addKeyLink(e,t){return"<span tabindex=0 role=button onclick="+t+" onkeypress=\"if (event.key=='Enter') { "+t+' } ">'+e+' <i class="fa-solid fa-key"></i></span>'}function addKeyLinkConditional(e,t,o){return o?"<span title='"+t+"'>"+e+' <i class="fa-solid fa-key"></i></span>':e}function haltEvent(e){return e.preventDefault&&e.preventDefault(),e.stopPropagation&&e.stopPropagation(),!1}function addOption(e,t,o){var n=document.createElement("option");n.text=t,n.value=o,Q(e).add(n)}function passwordcheck(e){return 7<e.length&&/\d/.test(e)&&/[a-z]/.test(e)&&/[A-Z]/.test(e)&&/\W/.test(e)}function methodcheck(e){return!(!e||null==e||!e.Body||"SUCCESS"==e.Body.ReturnValueStr||(messagebox("Error en la Llamada",e.Header.Method+": "+e.Body.ReturnValueStr.replace("_"," ")),0))}function TableStart(){return"<table cellpadding=0 cellspacing=0 style=width:100%;border-radius:8px><tr><td width=200px><p><td>"}function TableStart2(){return"<table cellpadding=0 cellspacing=0 style=width:100%;border-radius:8px><tr><td><p><td>"}function TableEntry(e,t){return"<tr><td><p>"+e+"<td>"+t}function FullTable(e,t){var o=TableStart();for(i in e)i&&e[i]&&(o+=TableEntry(i,e[i]));return o+TableEnd(t)}function TableEnd(e){return"<tr><td colspan=2><p>"+(e||"")+"</table>"}function AddButton(e,t){return'<input type=button value="'+e+'" onclick="'+t+'" style=margin:4px>'}function AddButton2(e,t){return'<input type=button value="'+e+'" onclick="'+t+'">'}function AddRefreshButton(e){return'<input type=button name=refreshbtn value=Refresh onclick="refreshButtons(false);'+e+'" style=margin:4px '+(0==refreshButtonsState?"disabled":"")+">"}function MoreStart(){return"<div id=idx_dlgMoreButtons3 style=display:none><hr>"}function MoreEnd(){return"</div>"}function MoreToggle(e){QV("idx_dlgMoreButtons1",!e),QV("idx_dlgMoreButtons2",e),QV("idx_dlgMoreButtons3",e)}function getSelectedOptions(e){for(var t,o=[],n=0,i=e.options.length;n<i;n++)(t=e.options[n]).selected&&o.push(t.value);return o}function getInstance(e,t){for(var o in e)if(e[o].InstanceID==t)return e[o];return null}function getItem(e,t,o){for(var n in e)if(e[n][t]==o)return e[n];return null}function guidToStr(e){return e.substring(6,8)+e.substring(4,6)+e.substring(2,4)+e.substring(0,2)+"-"+e.substring(10,12)+e.substring(8,10)+"-"+e.substring(14,16)+e.substring(12,14)+"-"+e.substring(16,20)+"-"+e.substring(20)}function getUrlVars(){for(var e,t=[],o=window.location.href.slice(window.location.href.indexOf("?")+1).split("&"),n=0;n<o.length;n++)0<(e=o[n].indexOf("="))&&(t[o[n].substring(0,e)]=o[n].substring(e+1,o[n].length));return t}function addHtmlValue(e,t,o=[]){return`<div class="row mb-1"><div class="${o[0]||"col col-md-2 col-lg-2"}"><b>${e}</b></div><div class="${o[1]||"col col-md-10 col-lg-10"}">${t}</div></div>`}function addHtmlFormFloating(e,t,o=[]){return`<div class="row mb-1"><div class="form-floating mb-3 ${o[0]||"col-md-12"}">${t}<label class="${o[1]||"ms-2"}">${e}</label></div></div>`}function addHtmlValue2(e,t){return"<div><div style=display:inline-block;float:right>"+t+"</div><div style=display:inline-block>"+e+"</div></div>"}function addHtmlValue3(e,t){return"<div><b>"+e+"</b></div><div style=margin-left:16px>"+t+"</div>"}function addHtmlValue4(e,t){return"<table style=width:100%><td style=width:120px>"+e+"<td style=text-align:right><b>"+t+"</b></table>"}function addHtmlValue5(e,t){return"<div style=padding:4px><div style=display:inline-block;float:right><b>"+t+"</b></div><div style=display:inline-block>"+e+"</div></div>"}function focusTextBox(e){setTimeout(function(){Q(e).selectionStart=Q(e).selectionEnd=65535,Q(e).focus()},0)}function validateEmail(e){return/^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/.test(e)}function isPrivateIP(e){return e.startsWith("10.")||e.startsWith("172.16.")||e.startsWith("192.168.")}function u2fSupported(){return window.u2f&&(0<navigator.userAgent.indexOf("Chrome/")||0<navigator.userAgent.indexOf("Firefox/")||0<navigator.userAgent.indexOf("Opera/")||0<navigator.userAgent.indexOf("Safari/"))}function findOne(t,e){return null!=t&&null!=e&&e.some(function(e){return 0<=t.indexOf(e)})}function copyTextToClip(e){var t,o=document.createElement("DIV");o.textContent=e,document.body.appendChild(o),e=o,document.selection?((t=document.body.createTextRange()).moveToElementText(e),t.select()):window.getSelection&&((t=document.createRange()).selectNode(e),window.getSelection().removeAllRanges(),window.getSelection().addRange(t)),document.execCommand("copy"),o.remove()}function copyTextToClip2(e){var t,o=document.createElement("DIV");o.textContent=decodeURIComponent(e),document.body.appendChild(o),e=o,document.selection?((t=document.body.createTextRange()).moveToElementText(e),t.select()):window.getSelection&&((t=document.createRange()).selectNode(e),window.getSelection().removeAllRanges(),window.getSelection().addRange(t)),document.execCommand("copy"),o.remove()}function capitalizeFirstLetter(e){return e.charAt(0).toUpperCase()+e.slice(1)}function printDate(e){return e.toLocaleDateString(args.locale)}function printTime(e){return e.toLocaleTimeString(args.locale)}function printDateTime(e){return e.toLocaleString(args.locale)}function printFlexDateTime(e){return(printDate(new Date)==printDate(e)?printTime:printDateTime)(e)}function addDetailItem(e,t,o,n=[]){return`<div class="row mb-1"><div class="${n[0]||"col-md-8"}"> ${nobreak(e)} </div><div class="${n[1]||"col-md-4 text-end"}"> ${t} </div></div>`}function format(e){var o=Array.prototype.slice.call(arguments,1);return e.replace(/{(\d+)}/g,function(e,t){return void 0!==o[t]?o[t]:e})}function addTextLink(e,t,o){var n=t.toLowerCase().indexOf(e.toLowerCase());return-1==n?t:t.substring(0,n)+'<a href="'+o+'">'+e+"</a>"+t.substring(n+e.length)}function getOrderedList(e,o){var t,n=[];for(t in e)n.push(e[t]);return n.sort(function(e,t){e=e[o].toLowerCase(),t=t[o].toLowerCase();return t<e?1:e<t?-1:0}),n}function capitalizeFirstLetter(e){return e.charAt(0).toUpperCase()+e.slice(1)}function nobreak(e){return e.split(" ").join("&nbsp;")}function pad2(e){e="00"+e;return e.substr(e.length-2)}function encodeURIComponentEx(e){return encodeURIComponent(e).replace(/'/g,"%27")}function getUserName(e){var t=e.split("/"),o=t[0]+"/"+t[1]+"/"+t[2],n="";if(4==t.length&&t[3].startsWith("guest:")&&(n=" - "+decode_utf8(atob(t[3].substring(6)))),users&&null!=users[o])return null!=users[o].realname?users[o].realname+n:users[o].name+n;if(currentNode&&currentNode.links&&currentNode.links[e]&&null!=currentNode.links[e].name)return currentNode.links[e].name+n;if(e==userinfo._id)return userinfo.name+n;if(nodes)for(var i in nodes)if(nodes[i].links)for(var a in nodes[i].links)if(nodes[i].links[a].name&&a==e)return nodes[i].links[a].name+n;return t[2]+n}function round(e,t){t=Math.pow(10,t||0);return Math.round(e*t)/t}function safeNewWindow(e,t){e=window.open(e,t,"noopener,noreferrer");e&&(e.opener=null)}function isWindowsNode(e){return 2==e.mtype&&null!=e.agent&&null!=e.agent.id&&0<=[1,2,3,4,21,22,34,42,43].indexOf(e.agent.id)}function downloadFile(e,t,o){var n=document.createElement("a");n.setAttribute("href",e),n.setAttribute("rel","noreferrer noopener"),n.setAttribute("target","fileDownloadFrame"),n.setAttribute("download",decodeURIComponent(t||"")),document.body.appendChild(n),n.click(),document.body.removeChild(n),o&&setDialogMode(0)}function dialogBoxDrag(){var t=Q("xxAddAgentModal"),o=0,n=0,i=0,a=0;function s(e){(e=e||window.event).preventDefault(),o=i-e.clientX,n=a-e.clientY,i=e.clientX,a=e.clientY,t.style.top=t.offsetTop-n+"px",t.style.left=t.offsetLeft-o+"px"}function r(){document.onmouseup=null,document.onmousemove=null}Q("dialogHeader").onmousedown=function(e){(e=e||window.event).preventDefault(),i=e.clientX,a=e.clientY,document.onmouseup=r,document.onmousemove=s}}window.addEventListener("beforeunload",function(e){(null!=desktop&&11==xxcurrentView||null!=terminal&&12==xxcurrentView)&&(e.preventDefault(),e.returnValue="")})</script>