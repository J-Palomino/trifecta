<!doctypehtml><html lang=cs dir=ltr xmlns=http://www.w3.org/1999/xhtml><meta http-equiv=X-UA-Compatible content="IE=edge"><meta http-equiv=Content-Type content="text/html;charset=utf-8"><meta name=viewport content="user-scalable=1,initial-scale=1,minimum-scale=1,maximum-scale=1"><meta name=apple-mobile-web-app-capable content=yes><meta name=format-detection content="telephone=no"><meta name=robots content=noindex,nofollow><link rel=manifest href={{{domainurl}}}manifest.json><link type=image/x-icon href={{{domainurl}}}favicon.ico rel="shortcut icon"><link keeplink=1 type=text/css href=styles/style.css media=screen rel=stylesheet title=CSS><link type=text/css href=styles/ol.css media=screen rel=stylesheet title=CSS><link type=text/css href=styles/ol3-contextmenu.min.css media=screen rel=stylesheet title=CSS><link type=text/css href=styles/xterm.css media=screen rel=stylesheet title=CSS><link type=text/css href=styles/flatpickr.min.css media=screen rel=stylesheet title=CSS><link rel=apple-touch-icon href=/favicon-303x303.png><script src=scripts/common-0.0.1{{{min}}}.js></script><script src=scripts/meshcentral{{{min}}}.js></script><script src=scripts/amt-0.2.0{{{min}}}.js></script><script src=scripts/amt-wsman-0.2.0{{{min}}}.js></script><script src=scripts/amt-desktop-0.0.2{{{min}}}.js></script><script src=scripts/amt-terminal-0.0.2{{{min}}}.js></script><script src=scripts/zlib{{{min}}}.js></script><script src=scripts/zlib-inflate{{{min}}}.js></script><script src=scripts/zlib-adler32{{{min}}}.js></script><script src=scripts/zlib-crc32{{{min}}}.js></script><script src=scripts/amt-redir-ws-0.1.0{{{min}}}.js></script><script src=scripts/amt-wsman-ws-0.2.0{{{min}}}.js></script><script src=scripts/agent-redir-ws-0.1.1{{{min}}}.js></script><script src=scripts/agent-redir-rtc-0.1.0{{{min}}}.js></script><script src=scripts/agent-desktop-0.0.2{{{min}}}.js></script><script src=scripts/agent-rdp-0.0.1{{{min}}}.js></script><script src=scripts/qrcode.min.js></script><script src=scripts/xterm{{{min}}}.js></script><script src=scripts/xterm-addon-fit{{{min}}}.js></script><script src=scripts/flatpickr.js></script><script src=mstsc/mstsc.js></script><script src=mstsc/keyboard.js></script><script src=mstsc/rle.js></script><script src=mstsc/client.js></script><script src=mstsc/canvas.js></script><script keeplink=1 src=scripts/u2f-api{{{min}}}.js></script><script keeplink=1 src=scripts/charts{{{min}}}.js></script><script keeplink=1 src=scripts/moment{{min}}.js></script><script keeplink=1 src=scripts/chartjs-adapter-moment{{{min}}}.js></script><script keeplink=1 src=scripts/filesaver.min.js></script><script keeplink=1 src=scripts/ol{{{min}}}.js></script><script keeplink=1 src=scripts/ol3-contextmenu{{{min}}}.js></script><script keeplink=1 src=scripts/purify{{{min}}}.js></script><script keeplink=1 src=scripts/marked{{{min}}}.js></script><title>{{{title}}}</title><body id=body oncontextmenu=handleContextMenu(event) style=display:none;min-width:495px onload='"undefined"!=typeof startup&&startup()'><div id=contextMenu class="contextMenu noselect"style=display:none><div id=cxinfo class=cmtext onclick=cmaction(1,event)><b>Informace</b></div><div id=cxdesktop class=cmtext onclick=cmaction(3,event)>Plocha</div><div id=cxterminal class=cmtext onclick=cmaction(2,event)>Terminál</div><div id=cxfiles class=cmtext onclick=cmaction(4,event)>Soubory</div><div id=cxevents class=cmtext onclick=cmaction(5,event)>Události</div><div id=cxdetails class=cmtext onclick=cmaction(6,event)>Podrobnosti</div><div id=cxconsole class=cmtext onclick=cmaction(7,event)>Konzole</div><div id=cxwebrdp class=cmtext onclick=cmaction(11,event)>Web-RDP</div><div id=cxwebvnc class=cmtext onclick=cmaction(12,event)>Web-VNC</div><div id=cxwebssh class=cmtext onclick=cmaction(13,event)>Web-SSH</div><div id=cxrdp class=cmtext onclick=cmaction(14,event)>RDP</div><div id=cxplugins class=cmtext onclick=cmaction(8,event) style=display:none>Zásuvné moduly</div><hr id=cxmgroupsplit><div id=cxstar class=cmtext onclick=cmaction(10,event) style=display:none>Přepnout hvězdu</div><div id=cxmdesktop class=cmtext onclick=cmaction(9,event) style=display:none>Multi-Desktop</div></div><div id=meshContextMenu class="contextMenu noselect"style=display:none;min-width:0><div id=cxselectall class=cmtext onclick=cmmeshaction(1,event)>Vybrat vše</div><div id=cxselectnone class=cmtext onclick=cmmeshaction(2,event)>Nevybrat nic</div></div><div id=filesShellContextMenu class="contextMenu noselect"style=display:none;min-width:0><div class=cmtext onclick=cmconnectfilesaction()>Požádat o souhlas</div></div><div id=termShellContextMenu class="contextMenu noselect"style=display:none;min-width:0><div class=cmtext onclick=cmtermaction(1,0,event)><b>Shell správce</b></div><div class=cmtext onclick=cmtermaction(6,0,event)>PowerShell správce</div><div class=cmtext onclick=cmtermaction(8,0,event)>Shell uživatele</div><div class=cmtext onclick=cmtermaction(9,0,event)>PowerShell uživatele</div><div class=cmtext onclick=cmtermaction(1,16,event)>Zeptejte se Admin Shell</div><div class=cmtext onclick=cmtermaction(6,16,event)>Zeptejte se Admin PowerShell</div><div class=cmtext onclick=cmtermaction(8,16,event)>Zeptejte se uživatele Shell</div><div class=cmtext onclick=cmtermaction(9,16,event)>Zeptejte se uživatele PowerShell</div></div><div id=termShellContextMenu2 class="contextMenu noselect"style=display:none;min-width:0><div class=cmtext onclick=cmtermaction(8,0,event)><b>Shell uživatele</b></div><div class=cmtext onclick=cmtermaction(9,0,event)>PowerShell uživatele</div></div><div id=termShellContextMenuLinux class="contextMenu noselect"style=display:none;min-width:0><div class=cmtext onclick=cmtermaction(1,0,event)><b>Příkazový řádek správce</b></div><div class=cmtext onclick=cmtermaction(8,0,event)>Shell uživatele</div><div class=cmtext onclick=cmtermaction(100,0,event)>Přihlásit se Shell</div></div><div id=deskConnectContextMenu class="contextMenu noselect"style=display:none;min-width:0><div class=cmtext onclick=cmdeskaction(1,event)>Zeptejte se souhlasu + bar</div><div class=cmtext onclick=cmdeskaction(2,event)>Požádat o souhlas</div><div class=cmtext onclick=cmdeskaction(3,event)>Bar ochrany osobních údajů</div></div><div id=deskDisconnectContextMenu class="contextMenu noselect"style=display:none;min-width:0><div class=cmtext onclick=cmdeskaction(10,event)>Odpojit a uzamknout</div><div class=cmtext onclick=cmdeskaction(11,event)>Odpojit</div></div><div id=altPortContextMenu class="contextMenu noselect"style=display:none;min-width:0><div class=cmtext onclick=cmaltportaction(1,event)>Alternativní port</div></div><div id=sshPortContextMenu class="contextMenu noselect"style=display:none;min-width:0><div class=cmtext onclick=cmsshportaction(1,event)>Alternativní port</div></div><div id=rfbPortContextMenu class="contextMenu noselect"style=display:none;min-width:0><div class=cmtext onclick=cmrfbportaction(1,event)>Alternativní port</div></div><div id=httpPortContextMenu class="contextMenu noselect"style=display:none;min-width:0><div class=cmtext onclick=cmhttpportaction(1,event)>Alternativní port</div></div><div id=httpsPortContextMenu class="contextMenu noselect"style=display:none;min-width:0><div class=cmtext onclick=cmhttpsportaction(1,event)>Alternativní port</div></div><div id=filesContextMenu class="contextMenu noselect"style=display:none;min-width:0><div class=cmtext onclick=cmfilesaction(1,event)>Přejmenovat</div><div class=cmtext onclick=cmfilesaction(2,event)>Upravit</div><div class=cmtext onclick=cmfilesaction(3,event)>Smazat</div></div><div id=expandAllContextMenu class="contextMenu noselect"style=display:none;min-width:0><div class=cmtext onclick=cmexpandaction(1,event)>Rozšířit vše</div><div class=cmtext onclick=cmexpandaction(2,event)>Sbalit vše</div></div><div id=deskPlayerContextMenu class="contextMenu noselect"style=display:none;min-width:0><div class=cmtext onclick=cmdeskplayeraction(1,event)>Otevřít přehrávač ...</div></div><div id=deskKeyShortcutContextMenu class="contextMenu noselect"style=display:none;min-width:0><div class=cmtext onclick=cmdeskshortcutaction(1,event)>Přizpůsobit ...</div></div><div id=deskPreConfigShortcutContextMenu class="contextMenu noselect"style="display:none;min-width:0;max-height:calc(80% - 50px);overflow-y:auto"><span id=deskPreConfigShortcutContextMenu1></span> <span id=deskPreConfigShortcutContextMenu2></span><div class=cmtext onclick=cmdeskpreconfigtypeaction(-1,event)>Přizpůsobit ...</div></div><div id=deskPreConfigScriptContextMenu class="contextMenu noselect"style="display:none;min-width:0;max-height:calc(80% - 50px);overflow-y:auto"><span id=deskPreConfigScriptContextMenu1></span> <span id=deskPreConfigScriptContextMenu2></span></div><div id=container><div id=notifiyBox class=notifiyBox style=display:none></div><div id=masthead class=noselect><div style=float:left>{{{titlehtml}}}</div><div class=title onclick=go(1,event)>{{{title1}}}</div><div class=title2>{{{title2}}}</div><div style=float:right><div id=notificationCount onclick=clickNotificationIcon() class=unselectable style=display:none title="Klikněte pro zobrazení aktuálních upozornění">0</div></div><p id=logoutControl><span id=logoutControlSpan class=logoncontrolspan></span><span id=idleTimeoutNotify style=color:#ff0></span><div class=textnewui id=textnewui onmouseup=toggleBootstrapUIMode() onkeypress='"Enter"==event.key&&toggleBootstrapUIMode()'><b>Try the new MeshCentral UI</b></div></div><div id=page_leftbar><div style=height:16px></div><div id=LeftMenuMyDevices tabindex=0 class="lbbutton lbbuttonsel"title="Moje zařízení"onmouseup=go(1,event) onkeypress='"Enter"==event.key&&go(1)'><div class="lbtg lb2"></div></div><div id=LeftMenuMyAccount tabindex=0 class=lbbutton title="Můj účet"onmouseup=go(2,event) onkeypress='"Enter"==event.key&&go(2)'><div class="lbtg lb1"></div></div><div id=LeftMenuMyEvents tabindex=0 class=lbbutton title="Moje události"onmouseup=go(3,event) onkeypress='"Enter"==event.key&&go(3)'><div class="lbtg lb3"></div></div><div id=LeftMenuMyFiles tabindex=0 class=lbbutton style=display:none title="Moje soubory"onmouseup=go(5,event) onkeypress='"Enter"==event.key&&go(5)'><div class="lbtg lb4"></div></div><div id=LeftMenuMyUsers tabindex=0 class=lbbutton style=display:none title=Uživatelé onmouseup=go(4,event) onkeypress='"Enter"==event.key&&go(4)'><div class="lbtg lb5"></div></div><div id=LeftMenuMyServer tabindex=0 class=lbbutton style=display:none title="Můj server"onmouseup=go(6,event) onkeypress='"Enter"==event.key&&go(6)'><div class="lbtg lb6"></div></div></div><div id=topbar class=noselect><div><div style=position:relative><span id=logoutControlSpan2></span><div tabindex=0 id=uiMenuButton title="Výběr uživatelského rozhraní"onclick=showUserInterfaceSelectMenu() onkeypress='"Enter"==event.key&&showUserInterfaceSelectMenu()'>♦<div id=uiMenu style=display:none><table><tr><td><div tabindex=0 id=uiViewButton1 class=uiSelector onclick=userInterfaceSelectMenu(1) title="Rozhraní s lištou vlevo"onkeypress='"Enter"==event.key&&userInterfaceSelectMenu(1)'><div class=uiSelector1></div></div><div tabindex=0 id=uiViewButton2 class=uiSelector onclick=userInterfaceSelectMenu(2) title="Rozhraní s lištou nahoře"onkeypress='"Enter"==event.key&&userInterfaceSelectMenu(2)'><div class=uiSelector2></div></div><div tabindex=0 id=uiViewButton3 class=uiSelector onclick=userInterfaceSelectMenu(3) title="Rozhraní s pevnou šířkou"onkeypress='"Enter"==event.key&&userInterfaceSelectMenu(3)'><div class=uiSelector3></div></div><div tabindex=0 id=uiViewButton7 class=uiSelector onclick=toggleBootstrapUIMode() title="Toggle Modern UI"onkeypress='"Enter"==event.key&&toggleBootstrapUIMode()'><div class=uiSelector7></div></div><td><div tabindex=0 id=uiViewButton6 class=uiSelector onclick=showNotes(!1) title="Osobní poznámky"onkeypress='"Enter"==event.key&&showNotes(!1)'><div class=uiSelector6></div></div><div tabindex=0 id=uiViewButton4 class=uiSelector onclick=toggleNightMode() title="Vyp/zap. tmavý režim"onkeypress='"Enter"==event.key&&toggleNightMode()'><div class=uiSelector4></div></div><div tabindex=0 id=uiViewButton5 class=uiSelector onclick=toggleFooterBarMode() title="Vyp/zap. lištu zápatí"onkeypress='"Enter"==event.key&&toggleFooterBarMode()'><div class=uiSelector5></div></div><div class=uiSelector_end>&nbsp;</div></table></div></div><table id=MainMenuSpan cellpadding=0 cellspacing=0 class=style1><tr><td tabindex=0 id=MainMenuMyDevices class="topbar_td style3x"onmouseup=go(1,event) onkeypress='"Enter"==event.key&&go(1)'>Moje zařízení<td tabindex=0 id=MainMenuMyAccount class="topbar_td style3x"onmouseup=go(2,event) onkeypress='"Enter"==event.key&&go(2)'>Můj účet<td tabindex=0 id=MainMenuMyEvents class="topbar_td style3x"onmouseup=go(3,event) onkeypress='"Enter"==event.key&&go(3)'>Moje události<td tabindex=0 id=MainMenuMyFiles class="topbar_td style3x"onmouseup=go(5,event) onkeypress='"Enter"==event.key&&go(5)'>Moje soubory<td tabindex=0 id=MainMenuMyUsers class="topbar_td style3x"onmouseup=go(4,event) onkeypress='"Enter"==event.key&&go(4)'>Uživatelé<td tabindex=0 id=MainMenuMyServer class="topbar_td style3x"onmouseup=go(6,event) onkeypress='"Enter"==event.key&&go(6)'>Můj server<td class="topbar_td_end style3">&nbsp;</table><div id=MainSubMenuSpan style=display:none><table id=MainSubMenu cellpadding=0 cellspacing=0 class=style1><tr><td tabindex=0 id=MainDev class="topbar_td style3x"onmouseup=go(10,event) onkeypress='"Enter"==event.key&&go(10)'>Obecné<td tabindex=0 id=MainDevDesktop class="topbar_td style3x"onmouseup=go(11,event) onkeypress='"Enter"==event.key&&go(11)'>Plocha<td tabindex=0 id=MainDevTerminal class="topbar_td style3x"onmouseup=go(12,event) onkeypress='"Enter"==event.key&&go(12)'>Terminál<td tabindex=0 id=MainDevFiles class="topbar_td style3x"onmouseup=go(13,event) onkeypress='"Enter"==event.key&&go(13)'>Soubory<td tabindex=0 id=MainDevEvents class="topbar_td style3x"onmouseup=go(16,event) onkeypress='"Enter"==event.key&&go(16)'>Události<td tabindex=0 id=MainDevInfo class="topbar_td style3x"onmouseup=go(17,event) onkeypress='"Enter"==event.key&&go(17)'>Podrobnosti<td tabindex=0 id=MainDevAmt class="topbar_td style3x"onmouseup=go(14,event) onkeypress='"Enter"==event.key&&go(14)'>Intel®AMT<td tabindex=0 id=MainDevConsole class="topbar_td style3x"onmouseup=go(15,event) onkeypress='"Enter"==event.key&&go(15)'>Konzole<td tabindex=0 id=MainDevPlugins class="topbar_td style3x"onmouseup=go(19,event) onkeypress='"Enter"==event.key&&go(19)'>Zásuvné moduly<td class="topbar_td_end style3">&nbsp;</table></div><div id=MeshSubMenuSpan style=display:none><table id=MeshSubMenu cellpadding=0 cellspacing=0 class=style1><tr><td tabindex=0 id=MeshGeneral class="topbar_td style3x"onmouseup=go(20,event) onkeypress='"Enter"==event.key&&go(20)'>Obecné<td tabindex=0 id=MeshSummary class="topbar_td style3x"onmouseup=go(21,event) onkeypress='"Enter"==event.key&&go(21)'>Souhrn<td class="topbar_td_end style3">&nbsp;</table></div><div id=EventsSubMenuSpan style=display:none><table id=EventsSubMenu cellpadding=0 cellspacing=0 class=style1><tr><td tabindex=0 id=EventsLive class="topbar_td style3x"onmouseup=go(3,event) onkeypress='"Enter"==event.key&&go(3)'>Události<td tabindex=0 id=EventsReport class="topbar_td style3x"onmouseup=go(60,event) onkeypress='"Enter"==event.key&&go(60)'>Zprávy<td class="topbar_td_end style3">&nbsp;</table></div><div id=UserSubMenuSpan style=display:none><table id=UserSubMenu cellpadding=0 cellspacing=0 class=style1><tr><td tabindex=0 id=UserGeneral class="topbar_td style3x"onmouseup=go(30,event) onkeypress='"Enter"==event.key&&go(30)'>Obecné<td tabindex=0 id=UserEvents class="topbar_td style3x"onmouseup=go(31,event) onkeypress='"Enter"==event.key&&go(31)'>Události<td class="topbar_td_end style3">&nbsp;</table></div><div id=UsersSubMenuSpan style=display:none><table id=UsersSubMenu cellpadding=0 cellspacing=0 class=style1><tr><td tabindex=0 id=UsersGeneral class="topbar_td style3x"onmouseup=go(4,event) onkeypress='"Enter"==event.key&&go(4)'>Uživatelé<td tabindex=0 id=UsersGroups class="topbar_td style3x"onmouseup=go(50,event) onkeypress='"Enter"==event.key&&go(50)'>Skupiny<td tabindex=0 id=UsersRecordings class="topbar_td style3x"onmouseup=go(52,event) onkeypress='"Enter"==event.key&&go(52)'>Nahrávky<td class="topbar_td_end style3">&nbsp;</table></div><div id=ServerSubMenuSpan style=display:none><table id=ServerSubMenu cellpadding=0 cellspacing=0 class=style1><tr><td tabindex=0 id=ServerGeneral class="topbar_td style3x"onmouseup=go(6,event) onkeypress='"Enter"==event.key&&go(6)'>Obecné<td tabindex=0 id=ServerStats class="topbar_td style3x"onmouseup=go(40,event) onkeypress='"Enter"==event.key&&go(40)'>Statistiky<td tabindex=0 id=ServerConsole class="topbar_td style3x"onmouseup=go(115,event) onkeypress='"Enter"==event.key&&go(115)'>Konzole<td tabindex=0 id=ServerTrace class="topbar_td style3x"onmouseup=go(41,event) onkeypress='"Enter"==event.key&&go(41)'>Trasování<td tabindex=0 id=ServerPlugins class="topbar_td style3x"onmouseup=go(42,event) onkeypress='"Enter"==event.key&&go(42)'>Zásuvné moduly<td class="topbar_td_end style3">&nbsp;</table></div><div id=UserDummyMenuSpan><table id=UserDummyMenu cellpadding=0 cellspacing=0 class=style1><tr><td class=style3>&nbsp;</table></div></div></div></div><div id=column_l><div id=p0 style=display:none><div id=p0message><span id=p0span>Server odpojen</span>,<href onclick=reload() style=cursor:pointer><u>klikněte pro opětovné připojení</u></href>.</div></div><div id=p1 style=display:none><div id=p1title><div style=display:none id=devListToolbarViewIcons><div id=devViewPageState style=float:left;line-height:32px;height:32px;font-size:16px;display:none></div><div tabindex=0 id=devViewPageButton1 class=viewSelector onclick=onDeviceViewPageChange(1) onkeypress='"Enter"==event.key&&onDeviceViewPageChange(1)'title="Go to first page"style=display:none><div class=viewSelector9></div></div><div tabindex=0 id=devViewPageButton2 class=viewSelector onclick=onDeviceViewPageChange(2) onkeypress='"Enter"==event.key&&onDeviceViewPageChange(2)'title="Go to previous page"style=display:none><div class=viewSelector10></div></div><div tabindex=0 id=devViewPageButton3 class=viewSelector onclick=onDeviceViewPageChange(3) onkeypress='"Enter"==event.key&&onDeviceViewPageChange(3)'title="Go to next page"style=display:none><div class=viewSelector11></div></div><div tabindex=0 id=devViewPageButton4 class=viewSelector onclick=onDeviceViewPageChange(4) onkeypress='"Enter"==event.key&&onDeviceViewPageChange(4)'title="Go to last page"style=display:none;margin-right:12px><div class=viewSelector8></div></div><div tabindex=0 id=devViewButton1 class=viewSelector onclick=onDeviceViewChange(1) onkeypress='"Enter"==event.key&&onDeviceViewChange(1)'title=Sloupce><div class=viewSelector2></div></div><div tabindex=0 id=devViewButton2 class=viewSelector onclick=onDeviceViewChange(2) onkeypress='"Enter"==event.key&&onDeviceViewChange(2)'title=Seznam><div class=viewSelector1></div></div><div tabindex=0 id=devViewButton3 class=viewSelector onclick=onDeviceViewChange(3) onkeypress='"Enter"==event.key&&onDeviceViewChange(3)'title=Desktopy><div class=viewSelector3></div></div><div tabindex=0 id=devViewButton5 class=viewSelector onclick=onDeviceViewChange(5) onkeypress='"Enter"==event.key&&onDeviceViewChange(5)'title=Desktopy><div class=viewSelector7></div></div><div tabindex=0 id=devViewButton4 class=viewSelector onclick=onDeviceViewChange(4) onkeypress='"Enter"==event.key&&onDeviceViewChange(4)'title=Mapa style=display:none><div class=viewSelector4></div></div></div><div><h1>Moje zařízení</h1></div></div><table id=devListToolbarSpan class=noselect><tr><td class=h1><td id=devListToolbar class=style14 style=display:none><img style=cursor:pointer;margin-top:4px;display:none title="Sbalit vše"id=CollapseAllButton src=images/icon-collapse.png width=9 height=11 onclick=cmexpandaction(2)> <img style=cursor:pointer;margin-top:4px;display:none title="Rozšířit vše"id=ExpandAllButton src=images/icon-expand.png width=9 height=11 onclick=cmexpandaction(1)> <input type=button id=SelectAllButton onclick=selectallButtonFunction() value="Vybrat vše">&nbsp; <input type=button id=GroupActionButton disabled value="Akce skupiny"onclick=groupActionFunction()>&nbsp; <input type=button id=ScrollToTopButton onclick=onDevicesScroll(!0) style=display:none;margin-right:4px value="Scroll To Top"> <input id=SearchInput type=input autocomplete=off placeholder=Filtr onchange=onDeviceSearchChanged(event) onclick=onDeviceSearchChanged(event) onkeyup=onDeviceSearchChanged(event) onfocus=onSearchFocus(1) onblur=onSearchFocus(0) title="Filtr: uživatel:xxx nebo u:xxx ip:xxx skupina:xxx nebo g:xxx tag:xxx nebo t: xxx atag:xxx nebo a:xxx os:xxx amt:xxx desc:xxx wsc:ok wsc:noav wsc: noupdate wsc:nofirewall wsc:any">&nbsp; <span id=SearchInputClearButton style=display:none;position:relative><img src=images/x16.png type=button onclick=clearDeviceSearch() style=position:absolute;cursor:pointer;left:-18px;top:-8px srcset="images/x32.png 2x"></span><select id=DevFilterSelect onchange=onOnlineCheckBox(event) title="Filtr zařízení"><option value=0>Vše<option value=1>Online<option value=5>Offline<option value=2>Session<option value=3>S hvězdičkou<option value=4>Intel® AMT<option value=6>Pomoc<option value=7>Označené<option value=8>Neoznačený</select> <label><input type=checkbox id=RealNameCheckBox onclick=onRealNameCheckBox()><span title="Zobrazit název operačního systému">Název počítače</span></label> <label style=display:none><input type=checkbox id=OnlineCheckBox onclick=onOnlineCheckBox(event)><span title="Zobrazovat pouze zařízení, která jsou online">Online</span></label> <span id=devsCustomUIBar></span><td id=kvmListToolbar class=style14 style=display:none><img style=cursor:pointer;margin-top:4px;display:none title="Sbalit vše"id=CollapseAllButton2 src=images/icon-collapse.png width=9 height=11 onclick=cmexpandaction(2)> <img style=cursor:pointer;margin-top:4px;display:none title="Rozšířit vše"id=ExpandAllButton2 src=images/icon-expand.png width=9 height=11 onclick=cmexpandaction(1)> <input type=button onclick=connectAllKvmFunction() value="Připojit vše">&nbsp; <input type=button onclick=disconnectAllKvmFunction() value="Odpojit vše">&nbsp; <input type=button onclick=onDevicesScroll(!0) value="Scroll To Top">&nbsp; <label><input type=checkbox id=autoConnectDesktopCheckbox onclick=autoConnectDesktops(event) title="Automatické připojení">Automaticky&nbsp;</label> <input type=button onclick=showMultiDesktopSettings() value=Nastavení>&nbsp; <input id=KvmSearchInput type=search placeholder=Filtr onchange=onDeviceSearchChanged(event) onclick=onDeviceSearchChanged(event) onkeyup=onDeviceSearchChanged(event) autocomplete=off onfocus=onSearchFocus(1) onblur=onSearchFocus(0)>&nbsp; <span id=KvmSearchInputClearButton style=display:none;position:relative><img src=images/x16.png type=button onclick=clearDeviceSearch() style=position:absolute;cursor:pointer;left:-18px;top:-8px srcset="images/x32.png 2x"></span><td id=devMapToolbar class=style14 style=display:none>&nbsp;&nbsp;<input type=search id=mapSearchLocation placeholder="Hledat umístění"onfocus=onMapSearchFocus(1) onblur=onMapSearchFocus(0)> <input type=button value=Hledat title="Vyhledat umístění"onclick=getSearchLocation()> <input type=button id=refreshmap title="Reset mapového pohledu"value=Reset onclick=refreshMap(!1,!0)><td class=auto-style1 style=height:100%><img style=display:none;cursor:pointer;margin-top:3px id=devListToolbarSettings src=images/icon-gear.png width=16 height=16 onclick=onDeviceViewSettings()><div style=display:none id=devListToolbarView>Zobrazit <select id=viewselect onchange=onDeviceViewChange()><option value=1>Sloupce<option value=2>Seznam<option value=3>Stolní počítače s pevnou šířkou<option id=viewselectmapoption value=4 style=display:none>Mapa<option value=5>Desktopy</select></div><div style=display:none id=devListToolbarSort>Řadit <select id=sortselect onchange=mainUpdate(6)><option>Skupina<option>Napájení<option>Zařízení<option>Štítky<option>Skupinové značky<option>Naposledy připojen</select> &nbsp;</div><div style=display:none id=devListToolbarSize>Velikost <select id=sizeselect onchange=onDeviceViewChange()><option value=0>Malé<option value=1>Středně<option value=2>Velký</select> &nbsp;</div><td class=h2></table><div id=NoMeshesPanel style=display:none><table><tr><td valign=top style=width:50px><img src=images/info.png loading=lazy width=47 height=48><td><div id=getStarted1>Začněte <a href=# onclick="return account_createMesh()"><strong>vytvořením skupiny zařízení a to kliknutím sem</strong></a>.</div><div id=getStarted2>Žádné skupiny zařízení.</div></table></div><div id=xdevices class=noselect style=display:none onscroll=onDevicesScroll(!1)></div><div id=xdevicesmap style=display:none><div id=xmapSearchResultsDlg style=display:none><div id=xmapSearchResultsBck><div id=xmapSearchClose onclick=mapCloseSearchWindow()><b>X</b></div><div style=padding:5px>Výsledky umístění</div><div style=width:100%;margin:6px></div></div><div id=xmapSearchResults style=margin:6px></div></div></div><div id=xmap-info-window></div></div><div id=p2 style=display:none><div id=p2title><h1>Můj účet</h1></div><div id=p2info style=overflow-y:auto><div id=p2AccountImageFrame><img id=p2AccountImage alt=""loading=lazy width=128 height=128 onclick=account_manageImage(0) src=images/user-256.png><div><a onclick=account_manageImage(0)>Změnit obrázek</a></div></div><div id=p2AccountSecurity style=display:none><p><strong>Nastavení zabezpečení</strong><div style=margin-left:25px><div id=managePhoneNumber1><div class=p2AccountActions><span id=authPhoneNumberCheck><strong>✓</strong></span></div><span><a href=# onclick="return account_managePhone()">Spravovat telefonní číslo</a><br></span></div><div id=manageEmail2FA><div class=p2AccountActions><span id=authEmailSetupCheck><strong>✓</strong></span></div><span><a href=# onclick="return account_manageAuthEmail()">Správa ověřování e-mailů</a><br></span></div><div id=manageAuthApp><div class=p2AccountActions><span id=authAppSetupCheck><strong>✓</strong></span></div><span><a href=# onclick="return account_manageAuthApp()">Spravovat aplikaci pro dvoufázové ověření</a><br></span></div><div id=manageDuoApp><div class=p2AccountActions><span id=authDuoSetupCheck><strong>✓</strong></span></div><span><a href=# onclick="return account_manageAuthDuo()">Manage Duo authentication</a><br></span></div><div id=manageHardwareOtp><div class=p2AccountActions><span id=authKeySetupCheck><strong>✓</strong></span></div><span><a href=# onclick="return account_manageHardwareOtp(0)">Spravovat klíče zabezpečení</a><br></span></div><div id=managePushAuthDev><div class=p2AccountActions><span id=authPushAuthDevCheck><strong>✓</strong></span></div><span><a href=# onclick="return account_managePushAuthDev()">Spravujte ověřování push</a><br></span></div><div id=manageMessaging1><div class=p2AccountActions><span id=authMessagingCheck><strong>✓</strong></span></div><span><a href=# onclick="return account_manageMessaging()">Manage messaging</a><br></span></div><div id=manageOtp><div class=p2AccountActions><span id=authCodesSetupCheck><strong>✓</strong></span></div><span><a href=# onclick="return account_manageOtp(0)">Spravovat záložní kódy</a><br></span></div></div></div><div id=p2AccountActions><p><strong>Akce účtu</strong><p class=mL><span id=viewPreviousLogins><a href=# onclick="return account_viewPreviousLogins()">Zobrazit předchozí přihlášení</a><br></span><span id=managePhoneNumber2 style=display:none><a href=# onclick="return account_managePhone()">Spravovat telefonní číslo</a><br></span><span id=manageMessaging2 style=display:none><a href=# onclick="return account_manageMessaging()">Manage messaging</a><br></span><span id=verifyEmailId style=display:none><a href=# onclick="return account_showVerifyEmail()">Ověřit e-mail</a><br></span><span id=accountEnableNotificationsSpan style=display:none><a href=# onclick="return account_enableNotifications()">Zapnout upozornění z webu v prohlížeči</a><br></span><a href=# onclick="return account_showLocalizationSettings()">Nastavení lokalizace</a><br><a href=# onclick="return account_showAccountNotifySettings()">Nastavení upozornění</a><br><span id=p2AccountPassActions><span id=accountChangeEmailAddressSpan style=display:none><a href=# onclick="return account_showChangeEmail()">Změnit e-mailovou adresu</a><br></span><a href=# onclick="return account_showChangePassword()">Změnit heslo</a><span id=p2nextPasswordUpdateTime></span><br><a href=# onclick="return account_showDeleteAccount()">Smazat účet</a><br></span><span id=accountCreateLoginTokenSpan style=display:none><a href=# onclick="return account_createLoginToken()">Vytvořit přihlašovací token</a><br></span></p><br style=clear:both></div><div id=p2logintokens></div><strong>Skupiny zařízení</strong> <span id=p2createMeshLink1>– <a href=# onclick="return account_createMesh()"class=newMeshBtn>Vytvořit</a></span><br><br><div id=p2meshes></div><div id=p2noMeshFound style=display:none>Žádné skupiny zařízení.<span id=p2createMeshLink2> <a href=# onclick="return account_createMesh()"><strong>Začněte zde!</strong></a></span></div><br style=clear:both></div></div><div id=p3 style=display:none><div id=p3title><h1>Moje události</h1></div><table class=pTable><tr><td class=h1><td class=auto-style1><input type=button style=display:none value="Stáhnout zprávu"onclick=p3showReportDialog()><td class=auto-style1>Filtr <select id=p3filterevents onchange=refreshEvents()><option notransval=1 value="">All Logs<option notransval=1 value=agentlog>Agent Logs<option notransval=1 value=relaylog>Relay Logs<option notransval=1 value=manual>Manual Logs<option notransval=1 value=runcommands>Run Command Logs<option notransval=1 value=batchupload>Batch Upload Logs<option notransval=1 value=changenode>Change Node Logs<option notransval=1 value=removenode>Remove Node Logs</select> Zobrazit <select id=p3limitdropdown onchange=refreshEvents()><option notransval=1 value=60>Posledních 60<option notransval=1 value=120>Posledních 120<option notransval=1 value=250>Posledních 250<option notransval=1 value=500>Posledních 500<option notransval=1 value=1000>Posledních 1000<option notransval=1 value="">Bez omezení</select>&nbsp; <a href=# onclick=p3showDownloadEventsDialog(2)><img src=images/link4.png height=10 width=10 title="Stáhnout události"style=cursor:pointer></a>&nbsp;<td class=h2></table><div id=p3events></div></div><div id=p4 style=display:none><div id=p4title><h1>Uživatelé</h1></div><table class=pTable><tr><td class=h1><td class=style14><div style=float:right><input type=button onclick=showUserBroadcastDialog() style=margin-right:6px value="Hromadná zpráva"> <a href=# onclick=p4downloadUserInfo()><img style=cursor:pointer title="Stáhnout informace o uživatelích"src=images/link4.png></a><a href=# onclick=p4batchAccountCreate()><img id=p4UserBatchCreate style=cursor:pointer;display:none title="Dávkově vytvořit vícero uživatelských účtů"src=images/link6.png></a><img style=cursor:pointer;margin-top:3px;margin-left:6px id=usersListToolbarSettings src=images/icon-gear.png width=16 height=16 onclick=onUsersViewSettings()></div><div><input type=button id=UsersSelectAllButton onclick=p3usersSelectallButtonFunction() value="Vybrat vše"> <input type=button id=UsersGroupActionButton disabled value="Akce skupiny"onclick=p3usersGroupActionFunction()> <input id=UserNewAccountButton type=button onclick=showCreateNewAccountDialog() value="Nový účet…"> <input id=UserSearchInput type=search style=width:120px;margin-left:6px placeholder=Filtr onchange=onUserSearchInputChanged() onkeyup=onUserSearchInputChanged() autocomplete=off onfocus=onUserSearchFocus(1) onblur=onUserSearchFocus(0)></div><td class=h2></table><div id=p3users></div></div><div id=p5 style=display:none><div id=p5title><h1>Moje soubory</h1></div><table id=p5toolbar cellpadding=0 cellspacing=0><tr><td id=p5filehead valign=bottom><div id=p5rightOfButtons></div><div><input type=button id=p5FolderUp disabled onclick="return p5folderup()"value=Nahoru>&nbsp; <input type=button id=p5SelectAllButton disabled onclick=p5selectallfile() value="Vybrat vše">&nbsp; <input type=button id=p5RenameFileButton disabled value=Přejmenovat onclick=p5renamefile()>&nbsp; <input type=button id=p5DeleteFileButton disabled value=Smazat onclick=p5deletefile()>&nbsp; <input type=button id=p5ViewFileButton disabled value=Upravit onclick=p5viewfile()>&nbsp; <input type=button id=p5NewFolderButton disabled value="Nová složka"onclick=p5createfolder()>&nbsp; <input type=button id=p5UploadButton disabled value=Nahrát onclick=p5uploadFile()>&nbsp; <input type=button id=p5DownloadButton disabled value=Stažení onclick=p5downloadButton()>&nbsp; <input type=button id=p5CutButton disabled value=Vyjmout onclick=p5copyFile(1)>&nbsp; <input type=button id=p5CopyButton disabled value=Kopírovat onclick=p5copyFile(0)>&nbsp; <input type=button id=p5PasteButton disabled value=Vložit onclick=p5pasteFile()>&nbsp;</div><tr><td id=p5filesubhead><div style=float:right><select id=p5sortdropdown onchange=updateFiles()><option value=1 selected>Seřadit podle názvu<option value=2>Seřadit podle velikosti<option value=3>Seřadit podle data<option value=4>Sestupně podle názvu<option value=5>Sestupně podle velikosti<option value=6>Sestupně podle data</select></div><div>&nbsp;&nbsp;<span id=p5currentpath></span></div></table><div id=p5filetable><div id=p5PublicShare><div>Tyto soubory jsou veřejné, kliknutím na „odkaz“ získáte veřejnou url adresu.</div></div><div id=bigok style=display:none><b>✓</b></div><div id=bigfail style=display:none><b>✗</b></div><span id=p5files></span></div><table id=p5toolbarBottom style=width:100% cellpadding=0 cellspacing=0><tr><td class=style6>&nbsp;<span id=p5bottomstatus></span></table></div><div id=p6 style=display:none><div id=p6info style=overflow-y:auto><div id=p6title><img id=MainMeshImage src=serverpic.ashx><h1>Můj server</h1></div><div id=p2ServerActions><p><strong>Akce serveru</strong><div style=margin-left:25px><div id=p2ServerActionsBackup><div class=p2AccountActions><span style=display:none><strong>✓</strong></span></div><a id=p6backuplink href={{{domainurl}}}backup.zip rel="noreferrer noopener"target=_blank>Stáhnout zálohu serveru</a></div><div id=p2ServerActionsRestore><div class=p2AccountActions><span style=display:none><strong>✓</strong></span></div><a href=# onclick="return server_showRestoreDlg()">Obnovit server ze zálohy</a></div><div id=p2ServerActionsGoogleBackup style=display:none><div class=p2AccountActions><span id=p2ServerActionsGoogleBackupCheck style=display:none><strong>✓</strong></span></div><span><a href=# onclick="return server_setupGoogleDriveBackup()">Záloha Disku Google</a><br></span></div><div id=p2ServerActionsVersion><div class=p2AccountActions><span style=display:none><strong>✓</strong></span></div><a href=# onclick="return server_showVersionDlg()">Zjistit dostupnost novější verze</a></div><div id=p2ServerActionsErrors><div class=p2AccountActions><span style=display:none><strong>✓</strong></span></div><a href=# onclick="return server_showErrorsDlg()">Zobrazit záznam chyb na serveru</a></div><div id=p2ServerActionsConfig><div class=p2AccountActions><span style=display:none><strong>✓</strong></span></div><a href=# onclick="return server_showConfigDlg()">Show server configuration</a></div></div><br></div><strong>Statistiky serveru</strong><br><br><div id=serverStats><div id=serverCpuChartView style=display:none><div class=chartViewCanvas style=height:40px;text-align:center><canvas id=serverCpuChart style=display:inline-block></canvas></div><div class=chartViewText id=serverCpuChartText></div></div><div id=serverMemoryChartView style=display:none><div class=chartViewCanvas style=height:40px;text-align:center><canvas id=serverMemoryChart style=display:inline-block></canvas></div><div class=chartViewText id=serverMemoryChartText></div></div><br><br><div id=serverStatsTable></div></div><div id=serverWarningsDiv style=display:none><br><strong>Varování serveru</strong><br><br><div id=serverCertWarnings></div><div id=serverWarnings></div></div></div></div><div id=p10 style=display:none><div id=p10title><div id=p10BackButton><div class=backButton tabindex=0 onclick=goBack() title=Zpět onkeypress='"Enter"==event.key&&goBack()'><div class=backButtonEx></div></div></div><h1>Obecné – <span id=p10deviceName></span></h1></div><div id=p10info style=overflow-y:auto><table style=width:100% cellpadding=0 cellspacing=0><tr><td style=width:auto valign=top><div id=p10html></div><td style=width:100px;display:none id=notesPanel valign=top><table><thead><tr><th>Poznámky<tbody><tr><td><div id=notesPanelArea style=width:300px;height:200px;resize:none;overflow-y:scroll></div></table><td style=width:20px><td style=width:200px;vertical-align:top;position:relative valign=top><div class=deviceNotifyLargeDot><div id=p10deviceMsg onclick=showDeviceMessages(null,null,event) class=deviceNotifyDotSub></div><img id=p10deviceStar class=deviceNotifyDotSub src=images/icon-star-notify-16.png width=16 height=16> <img id=p10deviceNotify onclick=showDeviceSessions(null,null,event) class=deviceNotifyDotSub src=images/icon-relay-notify.png width=16 height=16> <img id=p10deviceHelp onclick=showDeviceHelpRequests(null,null,event) class=deviceNotifyDotSub src=images/icon-help-notify-16.png width=16 height=16></div><div id=p10deviceBattery class="deviceBatteryLarge deviceBatteryLarge1"></div><a href=# onclick=p10showiconselector()><img id=MainComputerImage></a><div id=MainComputerState></div></table><br><div id=p10html2></div><div id=p10html3></div><div id=p10html4></div><div id=p10html5></div></div></div><div id=p11 class=noselect style=display:none><div id=p11title><div id=p11deviceNameHeader><div id=p11BackButton><div class=backButton tabindex=0 onclick=goBack() title=Zpět onkeypress='"Enter"==event.key&&goBack()'><div class=backButtonEx></div></div></div><div id=devListToolbarViewIcons><div class=viewSelector onclick=deskToggleFull(event) title="Celá obrazovka. Podržte shift pro zobrazení na celou obrazovku."><div class=viewSelector5></div></div></div><h1>Plocha – <span id=p11deviceName></span></h1></div></div><div id=p11warning onclick=showFeaturesDlg()><div class=icon2></div><div class=warningbox>Port přesměrování nebo funkce KVM jsou zakázány<span id=p11warninga>, zapnete kliknutím sem.</span></div></div><div id=p11warning2 onclick=showPowerActionDlg()><div class=icon2></div><div class=warningbox>Vzdálený počítač není zapnutý, klikněte sem pro zapnutí.</div></div><div style=position:absolute;right:16px;margin-top:-14px;font-size:x-small;color:#000><div id=p11capslock style=display:inline-block;margin-left:1px;border-radius:5px;background-color:#a3ffb8;padding:2px>CAPS</div><div id=p11scrolllock style=display:inline-block;margin-left:1px;border-radius:5px;background-color:#a3ffb8;padding:2px>SVITEK</div><div id=p11numlock style=display:inline-block;margin-left:1px;border-radius:5px;background-color:#a3ffb8;padding:2px>NUM</div></div><div id=deskarea0 cellpadding=0 cellspacing=0><div id=deskarea1 class=areaHead><div class=toright2><div id=idx_deskFullBtn2 onclick=deskToggleFull(event) style=float:right>&nbsp;✖</div><span id=p11power></span>&nbsp;<div class=deskareaicon title="Přepnout režim zobrazení"onclick=toggleAspectRatio(1)>⇲</div><div class=deskareaicon title="Otočit doleva"onclick=drotate(-1)>↺</div><div class=deskareaicon title="Otočit doprava"onclick=drotate(1)>↻</div><div id=deskRecordIcon class=deskareaicon title="Server tuto relaci nahrává"style=display:none;background-color:red;width:12px;height:12px;border-radius:6px;margin-top:5px></div><input id=deskFocusBtn type=button title="Vyp/zap. režim zaměření, kdy je aktualizována pouze oblast kolem myši"onkeypress=return!1 onkeydown=return!1 value="Zaměřit vše"onclick=deskToggleFocus() style=margin-right:3px;display:none> <input id=deskActionsBtn type=button title="Provést na zařízení akci napájení"onkeypress=return!1 onkeydown=return!1 value=Akce onclick=deviceActionFunction() class=mR> <input id=deskActionsSettings type=button value=Nastavení… title="Upravit nastavení vzdálené plochy"onkeypress=return!1 onkeydown=return!1 onclick=showDesktopSettings() class=mR> <input type=button title="Změnit stav napájení vzdáleného stroje"onkeypress=return!1 onkeydown=return!1 value="Akce napájení…"onclick=showPowerActionDlg() style=display:none><div id=desktopCustomUpperRight style=float:left;margin-right:6px></div><div id=desktopCustomUiButtons style=float:left></div></div><div><input type=button id=autoconnectbutton1 value="Automatické připojení"onclick=autoConnectDesktop(event) onkeypress=return!1 onkeydown=return!1 style=display:none;margin-right:4px> <span id=connectbutton1span><input type=button id=connectbutton1 cmenu=deskConnectButton title="Připojte se pomocí vzdálené plochy MeshAgent"value=Připojit onclick=connectDesktop(event,3) onkeypress=return!1 onkeydown=return!1 disabled></span><span id=connectbutton1rspan><input type=button id=connectbutton1r cmenu=altPortContextMenu value="Připojení RDP"title="Připojte se pomocí RDP"onclick=askRdpCredentials() onkeypress=return!1 onkeydown=return!1 disabled></span><span id=connectbutton1hspan><input type=button id=connectbutton1h value="HW připojení"title="Připojte se pomocí hardwarového KVM"onclick=connectDesktop(event,2) onkeypress=return!1 onkeydown=return!1 disabled></span><span id=disconnectbutton1span><input type=button id=disconnectbutton1 cmenu=deskDisconnectButton value=Odpojit onclick=connectDesktop(event,0) onkeypress=return!1 onkeydown=return!1></span><span id=deskstatus style=line-height:22px>Odpojeno</span><span id=deskmetadata></span></div></div><div id=deskarea3x><div id=p11bigok style=display:none><b>✓</b></div><div id=p11bigfail style=display:none><b>✗</b></div><div id=DeskFocus oncontextmenu=return!1 onmousedown=dmousedown(event) onmouseup=dmouseup(event) onmousemove=dmousemove(event)></div><div id=DeskParent><canvas id=Desk width=640 height=480 oncontextmenu=return!1 onmousedown=dmousedown(event) onmouseup=dmouseup(event) onmousemove=dmousemove(event) onmousewheel=dmousewheel(event)></canvas></div><div id=DeskTools><div id=deskToolsAreaTop><a id=DeskToolsRefreshButton style=right:2px onclick=refreshDeskTools()>Načíst znovu</a><div id=deskToolsTopTabProcess class=deskToolsTopTab onclick=changeDeskToolTab(0) style=left:0;bottom:0>Procesy</div><div id=deskToolsTopTabService class=deskToolsTopTab onclick=changeDeskToolTab(1) style=display:none;left:90px;color:gray>Služby</div></div><div id=deskToolsArea><div id=DeskToolsProcessTab><div id=deskToolsHeader><a class=colmn1 title="Seřadit podle ID procesu"onclick=sortProcess(0)>PID</a> <a class=colmn2 title="Seřadit podle názvu"onclick=sortProcess(1)>Název</a></div><div id=DeskToolsProcesses></div></div><div id=DeskToolsServiceTab style=display:none><div id=deskToolsServiceHeader><a class=colmn1 style=width:70px title="Seřadit podle stavu"onclick=sortService(0)>Stav</a> <a class=colmn2 title="Seřadit podle názvu"onclick=sortService(1)>Název</a></div><div id=DeskToolsServices></div></div></div></div><div id=p11DeskConsoleMsg style=display:none;text-align:left;cursor:pointer;position:absolute;left:30px;top:17px;color:#ff0;background-color:rgba(0,0,0,.6);padding:10px;border-radius:5px;text-align:left onclick=p11clearConsoleMsg()></div><div id=p11DeskSessionSelector style=display:none;position:absolute;left:30px;top:17px;right:30px;bottom:17px;overflow-y:auto></div></div><div id=deskarea4 class=areaFoot><div class=toright2><span id=DeskLatency style=line-height:22px;width:50px title="Latence relace na počítači"></span> <span id=DeskTimer style=line-height:22px title="Čas spojení"></span> <input id=DeskToolsButton type=button value=Nástroje title="Zobraz./nezobrazovat nástroje"onkeypress=return!1 onkeydown=return!1 onclick=toggleDeskTools()> <span>&nbsp;</span> <span id=DeskRunButton cmenu=deskPreConfigScriptContextMenu class=deskarea title="Spustit skript na tomto počítači"><img class=desktopButtons src=images/icon-play.png onclick=runDeviceCmd() height=16 width=16 style=padding-top:2px></span><span id=DeskChatButton class=deskarea title="Otevřít chat na tomto počítači"><img class=desktopButtons src=images/icon-chat.png onclick=deviceChat(event) height=16 width=16 style=padding-top:2px></span><span id=DeskNotifyButton title="Zobrazit upozornění na vzdáleném zařízení"><img class=desktopButtons src=images/icon-notify.png onclick=deviceToastFunction() height=16 width=16 style=padding-top:2px></span><span id=DeskLockButton title="Zamkněte vzdálený počítač"><img src=images/icon-lock.png class=desktopButtons onclick=deviceLockFunction() height=16 width=16></span><span id=DeskOpenWebButton title="Otevřít webovou adresu na vzdáleném počítači"><img class=desktopButtons src=images/icon-url2.png onclick=deviceUrlFunction() height=16 width=16></span><span id=DeskBackgroundButton title="Vyp/zap. pozadí vzdálené plochy"><img class=desktopButtons id=DeskBackgroundButtonImage src=images/icon-background.png onclick=deviceToggleBackground(event) height=16 width=16></span><span id=DeskSaveImageButton title="Uložit snímek obrazovky vzdáleného počítače"><img class=desktopButtons src=images/icon-camera.png onclick=deskSaveImage() height=16 width=16></span><span id=DeskRecordButton cmenu=deskPlayerContextMenu title="Zaznamenejte relaci vzdálené plochy do souboru"style=display:none><img class=desktopButtons id=DeskRecordButtonImage src=images/icon-film.png onclick=deskRecordSession() height=16 width=16></span><span id=DeskClipboardInButton title="Stáhněte si vzdálenou schránku do místní schránky"style=display:none><img class=desktopButtons id=DeskClipboardInButtonImage src=images/icon-clipboard-in.png onclick=deskClipboardInFunction() height=16 width=16></span><span id=DeskClipboardOutButton title="Nahrajte místní schránku do vzdáleného zařízení"><img class=desktopButtons id=DeskClipboardOutButtonImage src=images/icon-clipboard-out.png onclick=deskClipboardOutFunction() height=16 width=16></span><span id=DeskRefreshButton title="Obnovte plochu"><img class=desktopButtons id=DeskRefreshButtonImage src=images/icon-refresh.png onclick=deskRefreshFunction() height=16 width=16></span><span id=DeskInputLockedButton title="Vzdálený vstup je uzamčen"><img class=desktopButtons id=DeskInputLockedButtonImage src=images/icon-keylock-red.png onclick=deskInputLockFunction(0) height=16 width=16></span><span id=DeskInputUnLockedButton title="Vzdálený vstup je odblokován"><img class=desktopButtons id=DeskInputUnLockedButtonImage src=images/icon-keylock.png onclick=deskInputLockFunction(1) height=16 width=16></span><span id=DeskGuestShareButton title="Sdílejte zařízení s hostem"><img class=desktopButtons id=DeskGuestShareButtonImage src=images/icon-share2.png onclick=showShareDevice() height=16 width=16></span></div><div class=toright2><span id=DeskMonitorSelectionSpan></span></div><div><select id=deskkeys cmenu=deskKeyShortcutContextMenu></select> <input id=DeskWD type=button value=Odeslat onkeypress=return!1 onkeydown=return!1 onclick=deskSendKeys()> <input id=DeskESC style=display:none type=button value=ESC onkeypress=return!1 onkeydown=return!1 onclick=sendDeskEsc()> <input id=DeskClip type=button value=Schránka onkeypress=return!1 onkeydown=return!1 onclick=showDeskClip()> <input id=DeskType cmenu=deskPreConfigShortcutContextMenu type=button value=Typ onkeypress=return!1 onkeydown=return!1 onclick=showDeskType()> <label><span id=DeskControlSpan title="Přepnutí vstupu myši a klávesnice"><input id=DeskControl type=checkbox onkeypress=return!1 onkeydown=return!1 onclick=toggleKvmControl()>Vstup</span></label>&nbsp;</div></div></div></div><div id=p12 style=display:none><div id=p12title><div id=p12BackButton><div class=backButton tabindex=0 onclick=goBack() title=Zpět onkeypress='"Enter"==event.key&&goBack()'><div class=backButtonEx></div></div></div><div id=devListToolbarViewIcons2 style=float:right><div class=viewSelector onclick=deskToggleFull(event) title="Celá obrazovka. Podržte shift pro zobrazení na celou obrazovku."><div class=viewSelector5></div></div></div><h1>Terminál – <span id=p12deviceName></span></h1></div><div id=p12warning onclick=showFeaturesDlg()><div class=icon2></div><div class=warningbox>Port přesměrování nebo funkce KVM jsou zakázány<span id=p12warninga>, zapnete kliknutím sem.</span></div></div><div id=p12warning2 onclick=showPowerActionDlg()><div class=icon2></div><div class=warningbox>Vzdálený počítač není zapnutý, klikněte sem pro zapnutí.</div></div><div id=termTable style=position:relative><table style=width:100% cellpadding=0 cellspacing=0><tr><td class=areaHead style=line-height:22px><div class=toright2><div id=idx_termFullBtn2 onclick=deskToggleFull(event) style=float:right>&nbsp;✖</div><div id=termRecordIcon class=deskareaicon title="Server tuto relaci nahrává"style=display:none;background-color:red;width:12px;height:12px;border-radius:6px;margin-top:5px;margin-left:5px></div><input id=termActionsBtn type=button title="Provést na zařízení akci napájení"onkeypress=return!1 onkeydown=return!1 value=Akce onclick=deviceActionFunction()><div id=terminalCustomUpperRight style=float:left;margin-right:6px></div><div id=terminalCustomUiButtons style=float:left></div></div><div><input type=button id=autoconnectbutton2 value="Automatické připojení"onclick=autoConnectTerminal(event) onkeypress=return!1 onkeydown=return!1 style=display:none><span id=connectbutton2span style=margin-right:4px><input type=button id=connectbutton2 cmenu=termConnectButton value=Připojit onclick=connectTerminal(event,1) onkeypress=return!1 onkeydown=return!1 disabled></span><span id=connectbutton2sspan style=margin-right:4px><input type=button id=connectbutton2s cmenu=sshPortContextMenu value="Připojení SSH"onclick=connectTerminal(event,3) onkeypress=return!1 onkeydown=return!1 disabled></span><span id=connectbutton2hspan style=margin-right:4px><input type=button id=connectbutton2h value="HW připojení"title="Připojte se pomocí hardwaru KVM Intel® AMT"onclick=connectTerminal(event,2) onkeypress=return!1 onkeydown=return!1 disabled></span><span id=disconnectbutton2span style=margin-right:4px><input type=button id=disconnectbutton2 value=Odpojit onclick=connectTerminal(event,0) onkeypress=return!1 onkeydown=return!1></span><span id=termstatus style=line-height:22px>Odpojeno</span><span id=termtitle></span></div><tr><td id=termarea3x><div id=termarea3xdiv style=width:100%;height:100%;text-align:left></div><pre id=Term></pre><tr><td class=areaFoot><div class=toright2><span id=TermTimer title="Čas spojení"></span>&nbsp; <span id=terminalSettingsButtons style=display:none><input id=id_tcrbutton type=button onkeypress=return!1 onkeydown=return!1 class=bottombutton value=CR+LF title="Přepnout, co odešle klávesa return (enter)"onclick=termToggleCr()> <input id=id_tfxkeysbutton type=button onkeypress=return!1 onkeydown=return!1 class=bottombutton value="Intel (F10 = ESC+[OM)"title="Přepnout typ emulace kláves F1 až F10"onclick=termToggleFx()> <input id=id_ttypebutton type=button onkeypress=return!1 onkeydown=return!1 class=bottombutton value="Rozšířené Ascii"title="Přepnout typ emulace terminálu"onclick=termToggleType()> </span><span id=terminalSizeDropDown style=display:none><select id=termSizeList onkeypress=return!1><option value=1>80x25<option value=2>100x30</select> </span><span id=specialKeyDropDown><select id=specialkeylist onkeypress=return!1></select> <input id=specialkeylistinput type=button onkeypress=return!1 class=bottombutton value=Odeslat title="Poslat vybraný speciální klíč"onclick=sendSpecialKey()></span></div><div>&nbsp; <input type=button onkeypress=return!1 onkeydown=return!1 class=bottombutton id=ctrlcbutton value=Ctl-C onclick='termSendKey(3,"ctrlcbutton")'> <input type=button onkeypress=return!1 onkeydown=return!1 class=bottombutton id=ctrlxbutton value=Ctl-X onclick='termSendKey(24,"ctrlxbutton")'> <input type=button onkeypress=return!1 onkeydown=return!1 class=bottombutton id=escbutton value=ESC onclick='termSendKey(27,"escbutton")'> <input type=button onkeypress=return!1 onkeydown=return!1 class=bottombutton id=bsbutton value="Backspace (klávesa zpětného výmazu)"onclick='termSendKey(8,"bsbutton")'style=display:none> <input type=button onkeypress=return!1 onkeydown=return!1 class=bottombutton id=pastebutton value=Vložit title="Vložit text do terminálu"onclick=showTermPasteDialog() style=display:none></div></table><div id=p12TermConsoleMsg style=display:none;text-align:left;cursor:pointer;position:absolute;left:30px;top:45px;color:#ff0;background-color:rgba(0,0,0,.6);padding:10px;border-radius:5px onclick=p12clearConsoleMsg()></div></div></div><div id=p13 style=display:none><div id=p13title><div id=p13BackButton style=float:left><div class=backButton tabindex=0 onclick=goBack() title=Zpět onkeypress='"Enter"==event.key&&goBack()'><div class=backButtonEx></div></div></div><h1>Soubory - <span id=p13deviceName></span></h1></div><table id=p13toolbar cellpadding=0 cellspacing=0><tr><td class=areaHead style=line-height:22px><div class=toright2><input id=filesActionsBtn type=button title="Provést na zařízení akci napájení"value=Akce onclick=deviceActionFunction()><div id=filesRecordIcon class=deskareaicon title="Server tuto relaci nahrává"style=display:none;background-color:red;width:12px;height:12px;border-radius:6px;margin-top:5px;margin-left:5px></div><div id=filesCustomUpperRight style=float:left;margin-right:6px></div><div id=filesCustomUiButtons style=float:left></div></div><div><input id=p13AutoConnect value="Automatické připojení"onclick=autoConnectFiles(event) type=button style=display:none> <input id=p13Connect value=Připojit cmenu=filesConnectButton onclick=connectFiles(event,1) type=button> <input id=p13Disconnect value=Odpojit onclick=connectFiles(event) type=button> <input id=p13Connects value="Připojení SFTP"cmenu=sshPortContextMenu onclick=connectFiles(event,2) type=button> <span id=p13Status>Odpojeno</span></div><tr><td class=areaHead2 valign=bottom><div id=p13rightOfButtons class=toright2></div><div><input type=button style=margin-right:2px disabled id=p13FolderUp value=Nahoru onclick=p13folderup()> <input type=button style=margin-right:2px disabled id=p13SelectAllButton value="Vybrat vše"onclick=p13selectallfile()> <input type=button style=margin-right:2px disabled id=p13RenameFileButton value=Přejmenovat onclick=p13renamefile()> <input type=button style=margin-right:2px disabled id=p13DeleteFileButton value=Smazat onclick=p13deletefile()> <input type=button style=margin-right:2px disabled id=p13ViewFileButton value=Upravit onclick=p13viewfile()> <input type=button style=margin-right:2px disabled id=p13NewFolderButton value="Nová složka"onclick=p13createfolder()> <input type=button style=margin-right:2px disabled id=p13UploadButton value=Nahrát onclick=p13uploadFile()> <input type=button style=margin-right:2px disabled id=p13DownloadButton value=Stažení onclick=p13downloadButton()> <input type=button style=margin-right:2px disabled id=p13CutButton value=Vyjmout onclick=p13copyFile(1)> <input type=button style=margin-right:2px disabled id=p13CopyButton value=Kopírovat onclick=p13copyFile(0)> <input type=button style=margin-right:2px disabled id=p13PasteButton value=Vložit onclick=p13pasteFile()> <input type=button style=margin-right:2px disabled id=p13ZipButton value=Zip onclick=p13zipFiles()> <input type=button style=margin-right:2px disabled id=p13UnzipButton value=Unzip onclick=p13unzipFile()> <input type=button style=margin-right:2px disabled id=p13RefreshButton value="Načíst znovu"onclick=p13folderup(9999)> <input type=button style=margin-right:2px disabled id=p13FindButton value=Nalézt onclick=p13findfile()> <input type=button style=margin-right:2px disabled id=p13GoToFolderButton value=GoTo onclick=p13gotofolder()> <input type=button style=margin-right:2px disabled id=p13OpenButton value=Open onclick=p13openfilefolder()></div><tr><td class=areaHead3><div class=toright2><select id=p13sizedropdown onchange=p13updateFiles()><option value=0 selected>Human Readable<option value=1 title=Bytes>Bytes<option value=10 title=KB>Kilobytes<option value=20 title=MB>Megabajtů<option value=30 title=GB>Gigabyte</select> <select id=p13sortdropdown onchange=p13updateFiles()><option value=1 selected>Seřadit podle názvu<option value=2>Seřadit podle velikosti<option value=3>Seřadit podle data<option value=4>Sestupně podle názvu<option value=5>Sestupně podle velikosti<option value=6>Sestupně podle data</select></div><div>&nbsp;&nbsp;<span id=p13currentpath></span></div></table><div id=p13FilesConsoleMsg style=display:none;text-align:left;cursor:pointer;position:absolute;left:30px;top:165px;color:#ff0;background-color:rgba(0,0,0,.6);padding:10px;border-radius:5px onclick=p13clearConsoleMsg()></div><div id=p13filetable><div id=p13bigok style=display:none><b>✓</b></div><div id=p13bigfail style=display:none><b>✗</b></div><span id=p13files></span></div><table id=p13toolbarBottom cellpadding=0 cellspacing=0><tr><td class=style6>&nbsp;<span id=p13bottomstatus></span></table></div><div id=p14 style=display:none><div id=p14title><div id=p14BackButton style=float:left><div class=backButton tabindex=0 onclick=goBack() title=Zpět onkeypress='"Enter"==event.key&&goBack()'><div class=backButtonEx></div></div></div><div id=devListToolbarViewIcons><div class=viewSelector onclick=deskToggleFull(event) title="Celá obrazovka. Podržte shift pro zobrazení na celou obrazovku."><div class=viewSelector5></div></div></div><h1><span id=p14deviceNamePrefix>Intel® AMT</span> – <span id=p14deviceName></span></h1></div><iframe id=p14iframe src={{{domainurl}}}commander.ashx></iframe></div><div id=p15 style=display:none><div id=p15title><div id=p15BackButton style=float:left><div class=backButton tabindex=0 onclick=goBack() title=Zpět onkeypress='"Enter"==event.key&&goBack()'><div class=backButtonEx></div></div></div><h1><span id=p15deviceName></span></h1></div><table id=consoleTable cellpadding=0 cellspacing=0><tr><td class=areaHead><div class=toright2><div id=p15coreName title="Informace o aktuálním jádru v tomto agentovi"></div><input type=button id=p15uploadCore value="Akce agenta"onclick=p15uploadCore(event) title="Změnit modul Java Script kódu agenta"> <img onclick=p15downloadConsoleText() style=cursor:pointer;margin-top:6px title="Stáhnout text z konzole"src=images/link4.png></div><div id=p15statetext></div><tr><td><div class=areaProgress><div id=consoleprogressbar></div></div><tr><td id=p15agentConsole><pre id=p15agentConsoleText></pre><tr><td class=areaFoot><table style=width:100%><tr><td style=width:99%><input id=p15consoleText style=width:100% onkeyup=p15consoleSend(event) onfocus=onConsoleFocus(1) onblur=onConsoleFocus(0)><td>&nbsp;<td id=p15outputselecttd><select id=p15outputselect onchange=setupConsole()><option id=p15outputselect1 value=1>Agent<option id=p15outputselect3 value=3>Tam<option id=p15outputselect2 value=2>MQTT</select><td style=width:1%><input id=id_p15consoleClear type=button class=bottombutton value=Vymazat onclick=p15consoleClear()></table></table></div><div id=p16 style=display:none><div id=p16title><div id=p16BackButton style=float:left><div class=backButton tabindex=0 onclick=goBack() title=Zpět onkeypress='"Enter"==event.key&&goBack()'><div class=backButtonEx></div></div></div><h1>Události – <span id=p16deviceName></span></h1></div><table class=pTable><tr><td class=h1><td class=auto-style1>Filtr <select id=p16filterevents onchange=refreshDeviceEvents()><option notransval=1 value="">All Logs<option notransval=1 value=agentlog>Agent Logs<option notransval=1 value=relaylog>Relay Logs<option notransval=1 value=manual>Manual Logs<option notransval=1 value=runcommands>Run Command Logs<option notransval=1 value=batchupload>Batch Upload Logs<option notransval=1 value=changenode>Change Node Logs<option notransval=1 value=removenode>Remove Node Logs</select> Zobrazit <select id=p16limitdropdown onchange=refreshDeviceEvents()><option notransval=1 value=60>Posledních 60<option notransval=1 value=120>Posledních 120<option notransval=1 value=250>Posledních 250<option notransval=1 value=500>Posledních 500<option notransval=1 value=1000>Posledních 1000</select> <a href=# onclick=p3showDownloadEventsDialog(1)><img src=images/link4.png height=10 width=10 title="Stáhnout události"style=cursor:pointer></a>&nbsp;<td class=h2></table><div id=p16events></div></div><div id=p17 style=display:none;margin-left:-18px><div id=p17title style=margin-left:18px><div id=p17BackButton style=float:left><div class=backButton tabindex=0 onclick=goBack() title=Zpět onkeypress='"Enter"==event.key&&goBack()'><div class=backButtonEx></div></div></div><div id=devListToolbarViewIcons3><div class=viewSelector onclick=deskToggleCpuGraph(event) title="Zobrazit využití procesoru a paměti zařízení."><div class=viewSelector6></div></div></div><h1>Podrobnosti – <span id=p17deviceName></span></h1></div><div id=p17info style=overflow-y:auto><div id=p17graph style=width:100%><table style=width:100%><tr><td style=width:64px;vertical-align:top><img src=images/details/graph64.png border=0 width=64><td><div class=DevSt style=margin-bottom:3px;margin-left:16px><b>Živý graf</b></div><div style="margin-bottom:10px;margin-left:16px;height:240px;width:calc(100% - 16px);position:relative"><canvas id=deviceDetailsStats style=position:absolute;top:0;left:0;right:0;bottom:0></canvas></div><div id=extraGraphValues style=display:none;margin-left:30px;margin-bottom:15px></div></table></div><div id=p17info2></div></div></div><div id=p19 style=display:none><div id=p19title><div id=p19BackButton style=float:left><div class=backButton tabindex=0 onclick=goBack() title=Zpět onkeypress='"Enter"==event.key&&goBack()'><div class=backButtonEx></div></div></div><h1>Zásuvné moduly – <span id=p19deviceName></span></h1></div><div id=p19headers></div><div id=p19pages></div></div><div id=p20 style=display:none><div id=p20main style=overflow-y:auto><div id=p20title><picture id=MainMeshImage style=border-width:0;height:200px;width:200px;float:right><source type=image/webp width=200 height=200 srcset=images/webp/mesh-256.webp><img alt=""width=200 height=200 src=images/mesh-256.png></picture><div style=float:left><div class=backButton tabindex=0 onclick=goBack() title=Zpět onkeypress='"Enter"==event.key&&goBack()'><div class=backButtonEx></div></div></div><h1>Obecné – <span id=p20meshName></span></h1></div><p id=p20info><p id=p20info2></div></div><div id=p21 style=display:none><div id=p21title><div style=float:left><div class=backButton tabindex=0 onclick=goBack() title=Zpět onkeypress='"Enter"==event.key&&goBack()'><div class=backButtonEx></div></div></div><h1>Souhrn - <span id=p21meshName></span></h1></div><div id=p21main style=overflow-y:auto><div style=width:100%><div style=display:table;width:93%><div id=meshPowerChartDiv style=width:23%;display:inline-block;text-align:center;max-width:250px><div style=margin:10px;font-size:16px>Stavy napájení</div><canvas id=meshPowerChart style=width:250px;height:250px></canvas></div><div id=meshOsChartDiv style=width:23%;display:inline-block;text-align:center;max-width:250px><div style=margin:10px;font-size:16px>Typy agenta</div><canvas id=meshOsChart style=width:250px;height:250px></canvas></div><div id=meshConnChartDiv style=width:23%;display:inline-block;text-align:center;max-width:250px><div style=margin:10px;font-size:16px>Konektivita</div><canvas id=meshConnChart style=width:250px;height:250px></canvas></div><div id=meshSecurityChartDiv style=width:23%;display:inline-block;text-align:center;max-width:250px><div style=margin:10px;font-size:16px>Zabezpečení</div><canvas id=meshSecurityChart style=width:250px;height:250px></canvas></div></div></div><p id=p21info style=overflow-y:auto></div></div><div id=p30 style=display:none><div id=p30title><div style=float:left><div class=backButton tabindex=0 onclick=goBack() title=Zpět onkeypress='"Enter"==event.key&&goBack()'><div class=backButtonEx></div></div></div><h1>Obecné – <span id=p30userName></span></h1></div><div id=p30info style=overflow-y:auto><table style=width:100% cellpadding=0 cellspacing=0><tr><td style=width:auto valign=top><div id=p30html></div><td style=width:20px><td style=width:200px;position:relative valign=top><img id=p30userAuthServiceLogo loading=lazy style=display:none class=userAuthStrategyLogo width=64 height=64><picture id=MainUserImage style=display:none;border-width:0;height:200px;width:200px;float:right onclick=account_manageImage(1)><source type=image/webp width=200 height=200 srcset=images/webp/user-256.webp><img alt=""width=200 height=200 src=images/user-256.png></picture><img id=MainUserImageEx alt=""width=200 height=200 src=images/user-256.png onclick=account_manageImage(1)><div style=width:100%;text-align:center><strong><span id=MainUserState></span></strong></div></table><br><div id=p30html2></div><div id=p30html3></div></div></div><div id=p31 style=display:none><div id=p31title><div style=float:left><div class=backButton tabindex=0 onclick=goBack() title=Zpět onkeypress='"Enter"==event.key&&goBack()'><div class=backButtonEx></div></div></div><h1>Události – <span id=p31userName></span></h1></div><table class=pTable><tr><td class=h1><td class=auto-style1>Filtr <select id=p31filterevents onchange=refreshUsersEvents()><option notransval=1 value="">All Logs<option notransval=1 value=agentlog>Agent Logs<option notransval=1 value=relaylog>Relay Logs<option notransval=1 value=manual>Manual Logs<option notransval=1 value=runcommands>Run Command Logs<option notransval=1 value=batchupload>Batch Upload Logs<option notransval=1 value=changenode>Change Node Logs<option notransval=1 value=removenode>Remove Node Logs</select> Zobrazit <select id=p31limitdropdown onchange=refreshUsersEvents()><option notransval=1 value=60>Posledních 60<option notransval=1 value=120>Posledních 120<option notransval=1 value=250>Posledních 250<option notransval=1 value=500>Posledních 500<option notransval=1 value=1000>Posledních 1000<option notransval=1 value="">Bez omezení</select> <a href=# onclick=p3showDownloadEventsDialog(3)><img src=images/link4.png height=10 width=10 title="Stáhnout události"style=cursor:pointer></a>&nbsp;<td class=h2></table><div id=p31events></div></div><div id=p40 style=display:none><div id=p40title><h1>Statistiky mého serveru</h1></div><div class=areaHead><div class=toright2><select id=p40server style=display:none onchange=updateServerTimelineStats()></select>&nbsp; <select id=p40type onchange=updateServerTimelineStats()><option value=0>Spojení<option value=1>Operační paměť<option value=5>Procesor<option value=3>Příchozí provoz<option value=4>Odchozí provoz</select>&nbsp; <select id=p40time onchange=updateServerTimelineHours()><option value=3>Předešlé 3 hodiny<option value=8>Předchozích 8 hodin<option value=24>Předchozí den<option value=168>Předchozí týden<option value=720>Předchozích 30 dnů</select>&nbsp; <img src=images/link4.png height=10 width=10 title="Stáhnout datové body (.csv)"style=cursor:pointer onclick=p40downloadEvents()>&nbsp;</div><div><input value="Načíst znovu"type=button onclick=refreshServerTimelineStats()> &nbsp;<label><input id=p40log type=checkbox onclick=updateServerTimelineHours()>Log-X</label></div></div><canvas id=serverMainStats></canvas></div><div id=p41 style=display:none><div id=p41title><h1>Trasování serveru</h1></div><div class=areaHead><div class=toright2>Zobrazit <select id=p41limitdropdown onchange=displayServerTrace()><option value=100>Posledních 100<option value=250>Posledních 250<option value=500>Posledních 500<option value=1000>Posledních 1000</select> <input value=Vymazat type=button onclick=clearServerTracing()> <img src=images/link4.png height=10 width=10 title="Stáhnout trace (.csv)"style=cursor:pointer onclick=p41downloadServerTrace()>&nbsp;</div><div><input value=Trasování type=button onclick=setServerTracing()> <span id=p41traceStatus>Nic</span></div></div><div id=p41events></div></div><div id=p42 style=display:none><h1>Moje serverové zásuvné moduly</h1><div class=areaHead><div class=toright2></div><div><input value="Stáhnout zásuvný modul"type=button onclick="return pluginHandler.addPluginDlg()"></div></div><div id=pluginRestartNotice class=areaHead style=background-color:gold;display:none><div class=toright2><input value="Obnovit jádra agentů"type=button onclick="return distributeCore(),!1"></div><div style=padding:2px><div style=padding:2px><b>Poznámka:</b> Zásuvné moduly byly změněny a to může vyžadovat aktualizaci jádra agenta.</div></div></div><table id=p42tbl><tr class=DevSt><th style=width:26px><th style=width:10px><th class=chName>Název<th class=chDescription>Popis<th class=chSite style=text-align:center>Odkaz<th class=chVersion style=text-align:center>Verze<th class=chUpgradeAvail style=text-align:center>Nejnovější<th class=chStatus style=text-align:center>Stav<th class=chAction style=text-align:center>Akce<th style=width:10px></table><div id=pluginNoneNotice style=width:100%;text-align:center;padding-top:10px;display:none><i>Žádné zásuvné moduly na serveru.</i></div></div><div id=p43 style=display:none><div id=p43BackButton><div class=backButton tabindex=0 onmouseup=go(42) title=Zpět onkeypress='"Enter"==event.key&&go(42)'><div class=backButtonEx></div></div></div><h1>Moje serverové zásuvné moduly – <span id=p43title></span></h1><iframe id=p43iframe frameborder=0 style="width:100%;height:calc(100vh - 245px);max-height:calc(100vh - 245px)"></iframe></div><div id=p50 style=display:none><div id=p50title><h1>Moje uživatelské skupiny</h1></div><table class=pTable><tr><td class=h1><td class=style14><div style=float:right></div><div id=p50userGroupOps><input type=button id=UsersGroupsSelectAllButton onclick=p50usersSelectallButtonFunction() value="Vybrat vše"> <input type=button id=UsersGroupsGroupActionButton disabled value="Akce skupiny"onclick=p50usersGroupActionFunction()> <input id=NewUserGroupButton type=button onclick=showCreateUserGroupDialog(1) value="Nová skupina…"> <input id=DuplicateUserGroupButton type=button style=display:none onclick=showCreateUserGroupDialog(2) value="Duplikovat skupinu…"></div><td class=h2></table><div id=p50groups></div></div><div id=p51 style=display:none><div id=p51title><div style=float:left><div class=backButton tabindex=0 onclick=goBack() title=Zpět onkeypress='"Enter"==event.key&&goBack()'><div class=backButtonEx></div></div></div><h1>Skupina uživatelů - <span id=p51groupName></span></h1></div><div id=p51info style=overflow-y:auto><table style=width:100% cellpadding=0 cellspacing=0><tr><td style=width:auto valign=top><div id=p51group></div><td style=width:20px><td style=width:200px valign=top><picture id=MainUserImage style=border-width:0;height:200px;width:200px;float:right><source type=image/webp width=200 height=200 srcset=images/webp/group-256.webp><img alt=""width=200 height=200 src=images/group-256.png></picture><div style=width:100%;text-align:center><strong><span id=MainUserState></span></strong></div></table><div id=p51group2></div><br></div></div><div id=p52 style=display:none><div id=p52title><h1>Moje uživatelské nahrávky</h1></div><table class=pTable><tr><td class=h1><td class=style14><div style=float:right><input type=button onclick=openRecodringPlayer() value="Otevřít přehrávač ..."></div><div><input type=button onclick=refreshRecodings() value="Načíst znovu"></div><td class=h2></table><div id=p52recordings style=overflow-y:auto></div></div><div id=p60 style=display:none><div id=p60title><h1>Moje zprávy</h1></div><table class=pTable><tr><td class=h1><td class=style14><div style=float:right;line-height:22px><a id=p60downloadReportDiv style=display:none href=# onclick=p60downloadReport()><img src=images/link4.png height=10 width=10 title="Stáhnout zprávu"style=cursor:pointer></a>&nbsp;</div><div><input type=button onclick=generateReportDialog() value="Vygenerovat zprávu..."></div><td class=h2></table><div id=p60report style=overflow-y:auto></div></div><br id=column_l_bottomgap></div><div id=footer><div class=footer1>{{{footer}}}</div><div class=footer2><a id=verifyEmailId2 style=display:none href=# onclick=account_showVerifyEmail()>Ověřit e-mail</a> &nbsp;<a id=termsLinkFooter href=terms>Smluvní podmínky a ochrana soukromí</a></div></div><div id=dialog class=noselect style=display:none><div id=dialogHeader><div tabindex=0 id=id_dialogclose onclick=setDialogMode() onkeypress='"Enter"==event.key&&setDialogMode()'>✖</div><div id=id_dialogtitle></div></div><div id=dialogBody><div id=dialog1><div id=id_dialogMessage></div></div><div id=dialog2><div id=id_dialogOptions></div></div><div id=dialog3><div id=d3upload><div>Výběr souboru</div><select id=d3uploadMode onchange=d3modechange()><option value=1>Nahrání lokálního souboru<option value=2>Výběr souboru serveru</select></div><div id=d3localmode style=display:none><div>Nahrát soubor</div><form id=d3localmodeform method=post enctype=multipart/form-data action=uploadfile.ashx target=fileUploadFrame><input id=d3auth name=auth style=display:none> <input id=d3filter name=filter style=display:none> <input id=d3attrib name=attrib style=display:none> <input type=file id=d3localFile name=files onchange=d3setActions()> <input type=submit id=d3submit style=display:none></form></div><div id=d3servermode><div id=d3serveraction valign=bottom><input type=button id=p3FolderUp disabled onclick=d3folderup() value=Nahoru>&nbsp;<span id=p3CurrentFolder></span></div><div id=d3serverfiles></div></div></div><div id=dialog4><input id=d4WrapButton type=button value=Zalamování onclick=d4ToggleWrap()> <input id=d4SizeButton type=button value=Malé onclick=d4ToggleSize()> <input id=d4EncodingButton type=button value=Drsný onclick=d4ToggleEncoding()> <input id=d4LineBreakButton type=button value=Windows onclick=d4ToggleLineBreak()> <textarea id=d4editorarea autocomplete=off style="height:calc(100vh - 286px);width:100%;overflow:scroll;resize:none;white-space:pre"></textarea></div><div id=dialog7><div class=dtab><button id=td7meshkvm class=tablinks onclick='changeDesktopSettingsTab(event,"d7meshkvm")'>Agent</button> <button id=td7rdpkvm class=tablinks onclick='changeDesktopSettingsTab(event,"d7rdpkvm")'>RDP</button> <button id=td7amtkvm class=tablinks onclick='changeDesktopSettingsTab(event,"d7amtkvm")'>Intel® AMT</button></div><div id=d7meshkvm class=tabcontent><div style=margin-top:8px><div>Kvalita</div><select id=d7bitmapquality dir=rtl></select></div><div><div>Škálování</div><select id=d7bitmapscaling dir=rtl><option selected value=1024>100%<option value=896>87,5%<option value=768>75%<option value=640>62,5%<option value=512>50%<option value=384>37,5%<option value=256>25%<option value=128>12,5%</select></div><div><div>Snímková frekvence</div><select id=d7framelimiter dir=rtl><option selected value=50>Rychle<option value=100>Středně<option value=400>Pomalu<option value=1000>Velmi pomalu</select></div><div><div>Kódování</div><select id=d7encoding dir=rtl><option value=1>JPEG<option value=2>PNG<option value=3>TIFF<option selected value=4>WEBP</select></div><div id=d7desktopOtherSettings><div>Ostatní nastavení</div><div id=d7otherset2 style=display:block><label style=display:block><input type=checkbox id=d7deskSwapMouse>Zaměnit tlačítka myši</label> <label style=display:block><input type=checkbox id=d7deskrmw>Obrácení směru posouvání myši</label> <label style=display:block><input type=checkbox id=d7deskRemoteKeyMap>Použijte Mapu vzdálené klávesnice</label> <label style=display:block id=d7deskAutoClipboardLabel><input type=checkbox id=d7deskAutoClipboard>Automatická schránka</label> <label style=display:block id=d7deskAutoLockLabel><input type=checkbox id=d7deskAutoLock>Zamknout na Odpojit</label></div></div></div><div id=d7amtkvm class=tabcontent><div style=margin-top:8px><div>Kódovaní obrazu</div><select id=d7desktopmode><option value=1>RLE8, Nejrychlejší<option value=2>RLE16, doporučeno<option value=3>RAW8, pomalé<option value=4>RAW16, velmi pomalé</select></div><div><div>Ostatní nastavení</div><div id=d7otherset style=display:block><label style=display:block><input type=checkbox id=d7showfocus>Zobrazit nástroj pro zaměření</label> <label style=display:block><input type=checkbox id=d7showcursor>Zobrazit lokální kurzor myši</label> <label style=display:block><input type=checkbox id=d7localKeyMap>Lokální klávesová mapa</label> <label style=display:block><input type=checkbox id=d7kvmrmw>Obrácení směru posouvání myši</label></div></div></div><div id=d7rdpkvm class=tabcontent><div style=margin-top:8px><div>Velikost vzdálené plochy</div><select id=d7rdpsize><option notransval=1 value=canvas>Rozlišení plochy<option notransval=1 value=browser>Rozlišení prohlížeče<option notransval=1 value=screen>Rozlišení obrazovky<option notransval=1 value=640x480>640x480<option notransval=1 value=1024x768>1024x768<option notransval=1 value=1280x800>1280x800<option notransval=1 value=1440x900>1440x900<option notransval=1 value=1600x900>1600x900<option notransval=1 value=1680x1050>1680x1050<option notransval=1 value=1920x1080>1920x1080</select></div><div><div>Možnosti</div><div id=d7rdpflags style=display:block><label style=display:block><input type=checkbox id=d7rdp1>Zakázat tapetu</label> <label style=display:block><input type=checkbox id=d7rdp2>Zakázat tažení celého okna</label> <label style=display:block><input type=checkbox id=d7rdp3>Zakázat animace nabídky</label> <label style=display:block><input type=checkbox id=d7rdp4>Zakázat motivy</label> <label style=display:block><input type=checkbox id=d7rdp6>Zakázat stín kurzoru</label> <label style=display:block><input type=checkbox id=d7rdp7>Zakázat nastavení kurzoru</label> <label style=display:block><input type=checkbox id=d7rdp8>Povolit vyhlazování písem</label> <label style=display:block><input type=checkbox id=d7rdp9>Povolit tvorbu plochy</label> <label style=display:block><input type=checkbox id=d7rdpclip>Automatická schránka</label> <label style=display:block><input type=checkbox id=d7rdpsmb>Zaměnit tlačítka myši</label> <label style=display:block><input type=checkbox id=d7rdprmw>Obrácení směru posouvání myši</label></div></div></div></div></div><div id=idx_dlgButtonBar><input id=idx_dlgCancelButton type=button value=Storno onclick=dialogclose(0)> <input id=idx_dlgOkButton type=button value=OK onclick=dialogclose(1)><div><input id=idx_dlgDeleteButton type=button value=Smazat style=display:none onclick=dialogclose(2)></div><div id=idx_dlgMoreButtons><a href=# id=idx_dlgMoreButtons1 style=cursor:pointer;color:gray;text-decoration:none title="Přepnout pokročilé možnosti"onclick=MoreToggle(!0)>▼</a> <a href=# id=idx_dlgMoreButtons2 style=cursor:pointer;color:gray;text-decoration:none title="Přepnout pokročilé možnosti"onclick=MoreToggle(!1)>▲</a></div></div></div><iframe name=fileUploadFrame style=display:none></iframe><form style=display:none method=post action=uploadfile.ashx enctype=multipart/form-data target=fileUploadFrame><input id=p5fileDragName name=name><input id=p5fileDragAuthCookie name=auth><input id=p5fileDragSize name=size><input id=p5fileDragType name=type><input id=p5fileDragData name=data><input id=p5fileDragLink name=link><input type=submit id=p5loginSubmit2 style=display:none></form><form style=display:none method=post action=uploadnodefile.ashx enctype=multipart/form-data target=fileUploadFrame><input id=p13fileDragName name=name><input id=p13fileDragSize name=size><input id=p13fileDragType name=type><input id=p13fileDragData name=data><input id=p13fileDragLink name=link><input type=submit id=p13loginSubmit2 style=display:none></form><audio id=chimes><source src=sounds/chimes.mp3 type=audio/mp3></audio><iframe style=display:none name=fileDownloadFrame></iframe></div><script>var i,args,urlargs,random="{{{randomlength}}}",webState="{{{webstate}}}";for(i in webState=null!=(webState=""!=webState?JSON.parse(decodeURIComponent(webState)):webState)&&"object"==typeof webState?webState:{})if("desktopsettings"!=i)try{localStorage.setItem(i,webState[i])}catch(e){}if(!webState.loctag)try{localStorage.removeItem("loctag")}catch(e){}var desktop,terminal,files,autoReconnect=!0,powerStatetable=["","Zapnuto","Spánek","Spánek","Spánek","Hibernuje se","Vypnout","Připojeno"],StatusStrs=["Odpojeno","Připojování…","Nastavení…","Připojeno","Intel&reg; AMT připojeno"],agentsStr=["Neznámé","Windows 32bit konzole","Windows 64bit konzole","Windows 32bit služba","Windows 64bit služba","Linux 32bit","Linux 64bit","MIPS","XENx86","Android","Linux ARM","macOS x86-32bit","Android x86","PogoPlug ARM","Android","Linux Poky x86-32bit","macOS x86-64bit","ChromeOS","Linux Poky x86-64bit","Linux NoKVM x86-32bit","Linux NoKVM x86-64bit","Windows MinCore konzole","Windows MinCore služba","NodeJS","ARM-Linaro","ARMv6l / ARMv7l","ARMv8 64bit","ARMv6l / ARMv7l / NoKVM","MIPS24KC (OpenWRT)","Apple Silicon","FreeBSD x86-64","Neznámé","Linux ARM 64 bit (glibc/2.24 NOKVM)","Alpine Linux x86 64 Bit (MUSL)","Asistent (Windows)","Armada370 - ARM32/HF (libc/2.26)","OpenWRT x86-64","OpenBSD x86-64","Neznámé","Neznámé","MIPSEL24KC (OpenWRT)","ARMADA/CORTEX-A53/MUSL (OpenWRT)","Windows ARM 64bit console","Windows ARM 64bit service"],agentsStrNoAgent=["","","","","Windows","","Linux","","","","","","","","","","","","","","","","","","","","","","","Jablko"],sort=0,searchFocus=0,mapSearchFocus=0,userSearchFocus=0,consoleFocus=0,showRealNames=!1,meshserver=null,meshes={},loginTokens={},meshcount=0,nodes=null,usergroups=null,filetree={},userinfo=null,serverinfo=null,events=[],users=null,wssessions=null,stars={},nodeShortIdent=0,desktopsettings={encoding:2,showfocus:!1,showmouse:!0,showcad:!0,quality:40,scaling:1024,framerate:50,localkeymap:!1,swapmouse:!1,remotekeymap:!1,autoclipboard:!1,autolock:!1,agentencoding:4},multidesktopsettings={quality:20,scaling:128,framerate:1e3,agentencoding:4},debugLevel=parseInt("{{{debuglevel}}}"),features=parseInt("{{{features}}}"),features2=parseInt("{{{features2}}}"),sessionTime=parseInt("{{{sessiontime}}}"),webRelayPort=parseInt("{{{webRelayPort}}}"),webRelayDns="{{{webRelayDns}}}",hidePowerTimeline="{{{hidePowerTimeline}}}",showNotesPanel="{{{showNotesPanel}}}",sessionRefreshTimer=null,domain="{{{domain}}}",domainUrl="{{{domainurl}}}",authCookie="{{{authCookie}}}",authRelayCookie="{{{authRelayCookie}}}",logoutControls=JSON.parse(decodeURIComponent("{{{logoutControls}}}")),authCookieRenewTimer=null,multiDesktop={},serverPublicNamePort="{{{serverDnsName}}}:{{{serverPublicPort}}}",amtScanResults=null,debugmode=0,windowsBrowser=detectWindowsBrowser(),attemptWebRTC=0!=(128&features),webrtcconfiguration="{{{webrtcconfig}}}";if(""==webrtcconfiguration)webrtcconfiguration=null;else try{webrtcconfiguration=JSON.parse(decodeURIComponent(webrtcconfiguration))}catch(e){console.log('Invalid WebRTC config: "'+webrtcconfiguration+'".'),webrtcconfiguration=null}var passRequirements="{{{passRequirements}}}";""!=passRequirements&&(passRequirements=JSON.parse(decodeURIComponent(passRequirements)));var customui=""!=(customui="{{{customui}}}")?JSON.parse(decodeURIComponent(customui)):null,deskAspectRatio=0;try{deskAspectRatio=parseInt(getstore("deskAspectRatio","0"))}catch(e){}var uiMode=parseInt(getstore("uiMode",1)),webPageStackMenu=!1,webPageFullScreen=!0,nightMode=setNightMode(),footerBar="1"==getstore("footerBar","1"),sessionActivity=Date.now(),updateSessionTimer=null,pluginHandlerBuilder={{{pluginHandler}}},pluginHandler=null,installedPluginList=(null!=pluginHandlerBuilder&&(pluginHandler=new pluginHandlerBuilder),null),goBackStack=[],CollapsedGroups={};try{CollapsedGroups=JSON.parse(getstore("_collapse","{}"))}catch(e){}var deviceViewSettings={};try{deviceViewSettings=JSON.parse(getstore("_deviceViewSettings","{}"))}catch(e){}var userViewSettings={};try{userViewSettings=JSON.parse(getstore("_usersViewSettings","{}"))}catch(e){}var xterm=null,xtermfit=null,xtermResizeTimer=null,miscState={},checkedNodeids={},deskKeyboardShortcuts=[],deskKeyboardStrings=[],deskLastClipboardSent=null,requestedLastConnects=!1,devicePagingState=null,p11DeskConsoleMsgTimer=null,p12TermConsoleMsgTimer=null,p13FilesConsoleMsgTimer=null,webpSupport=!1;function startup(){if(0==(32&features)){var e=null;try{e=top.location.toString().toLowerCase()}catch(e){}if(top!=self&&(null==e||0==top.active))return void(top.location=self.location)}null!=(urlargs=parseUriArgs()).key&&(urlargs.key=""+urlargs.key),urlargs.key&&0==isAlphaNumeric(urlargs.key)&&delete urlargs.key,urlargs.locale&&0==isAlphaNumeric(urlargs.locale)&&delete urlargs.locale,delete urlargs.user,delete urlargs.pass,delete urlargs.viewmode,delete urlargs.gotonode,delete urlargs.gotodevicename,delete urlargs.gotodeviceip,delete urlargs.gotomesh,delete urlargs.gotouser,delete urlargs.gotougrp,urlargs.key&&(Q("termsLinkFooter").href+="?key="+urlargs.key),(args=parseUriArgs()).key&&0==isAlphaNumeric(args.key)&&delete args.key,args.locale&&0==isAlphaNumeric(args.locale)&&delete args.locale,args.locale||null!=(o=getstore("loctag",0))&&"*"!=o&&(args.locale=o),debugmode=args.debug,null!=args.webrtc&&(attemptWebRTC=1==args.webrtc),QV("p13AutoConnect",debugmode),QV("autoconnectbutton2",debugmode),QV("autoconnectbutton1",debugmode),nightMode&&(QC("body").add("night"),QS("body")["background-color"]="#000"),toggleFullScreen();try{stars=JSON.parse(getstore("stars","{}"))}catch(e){}var e=0,t=parseInt("{{{hide}}}"),t=((t||args.hide)&&(args.hide&&(e=parseInt(args.hide)),t)&&(e|=t),args.hide=e,QV("uiViewButton5",!(4&args.hide)),adjustPanels(),"");logoutControls&&(null!=logoutControls.name&&(t='<span onmouseup=go(2) CLASS="LogoffLinkColor" style="cursor:pointer">'+format("Vítejte {0}.",logoutControls.name)+"</span>"),null!=logoutControls.logoutUrl)&&(t+=format(' <a href="'+logoutControls.logoutUrl+'" CLASS="LogoffLinkColor">Odhlásit se</a>')),1&args.hide?QH("logoutControlSpan2",t):QH("logoutControlSpan",t),document.onclick=function(e){hideContextMenu()},document.onkeypress=ondockeypress,document.onkeydown=ondockeydown,document.onkeyup=ondockeyup,window.addEventListener("blur",ondocblur,!1),window.onresize=function(){hideContextMenu(),mainUpdate(512),browserfullscreen=isBrowserFullscreen(),QV("DeskESC",browserfullscreen),null!=xtermfit&&12==xxcurrentView&&xtermfit.fit()},setTimeout(function(){urlargs.filter&&(Q("SearchInput").value=urlargs.filter,Q("KvmSearchInput").value=urlargs.filter),mainUpdate(512)},200),DOMPurify&&DOMPurify.addHook("afterSanitizeAttributes",function(e){"target"in e&&(e.setAttribute("target","_blank"),e.setAttribute("rel","noopener noreferrer")),e.hasAttribute("target")||!e.hasAttribute("xlink:href")&&!e.hasAttribute("href")||e.setAttribute("xlink:show","new")}),QV("textnewui",0!=(1073741824&features2)),(meshserver=MeshServerCreateControl(domainUrl)).onStateChanged=onStateChanged,meshserver.onMessage=onMessage,meshserver.trace=args.trace,meshserver.Start(),Q("sortselect").selectedIndex=sort=getstore("sort",0),Q("sizeselect").selectedIndex=getstore("viewsize",1),Q("KvmSearchInput").value=Q("SearchInput").value=getstore("_search",""),showRealNames=1==getstore("showRealNames",0),Q("RealNameCheckBox").checked=showRealNames,Q("DevFilterSelect").value=getstore("devFilterSelect",0),Q("viewselect").value=getstore("deviceView",1),Q("DeskControl").checked=1==getstore("DeskControl",1),QV("accountChangeEmailAddressSpan",0==(2097152&features)),mainUpdate(3);for(var n=1;n<5;n++)Q("devViewButton"+n).classList.remove("viewSelectorSel");Q("devViewButton"+Q("viewselect").value).classList.add("viewSelectorSel"),Q("p5filetable").addEventListener("drop",p5fileDragDrop,!1),Q("p5filetable").addEventListener("dragover",p5fileDragOver,!1),Q("p5filetable").addEventListener("dragleave",p5fileDragLeave,!1),Q("deskarea0").addEventListener("drop",p11fileDragDrop,!1),Q("deskarea0").addEventListener("dragover",p11fileDragOver,!1),Q("deskarea0").addEventListener("dragleave",p11fileDragLeave,!1),Q("p13filetable").addEventListener("drop",p13fileDragDrop,!1),Q("p13filetable").addEventListener("dragover",p13fileDragOver,!1),Q("p13filetable").addEventListener("dragleave",p13fileDragLeave,!1),setInterval(updateDeviceTimeline,12e4);e=null;try{e=localStorage.getItem("desktopsettings")}catch(e){}null!=e&&(desktopsettings=JSON.parse(e)),e=null;try{e=localStorage.getItem("multidesktopsettings")}catch(e){}null!=e&&(multidesktopsettings=JSON.parse(e)),applyDesktopSettings();for(var o="",i=1;i<27;i++)o+="<option value='"+i+"'>Ctrl-"+String.fromCharCode(64+i)+" ("+i+")</option>";QH("specialkeylist",o),setupGeneralServerStats(),setupServerTimelineStats(),userInterfaceSelectMenu(),setupMeshSummaryStats(),QV("p4UserBatchCreate",0==(524288&features)),d4EditWrapVal=Number(getstore("editorWrap",0)),d4EditSizeVal=Number(getstore("editorSize",0)),d4EditEncodingVal=Number(getstore("editorEncoding",0)),d4EditLineBreakVal=Number(getstore("editorLineBreak",0)),d4ToggleWrap(!0),d4ToggleSize(!0),d4ToggleEncoding(!0),d4ToggleLineBreak(!0),null!=pluginHandler&&pluginHandler.callHook("onWebUIStartupEnd"),-1==["en","ko","ja","zh-chs","zh-cht"].indexOf("{{{lang}}}")&&""!="{{{lang}}}".toLowerCase()&&QC("body").add("nonenglish");var a=document.getElementsByClassName("topbar_td");for(r in a)a[r].innerHTML&&(a[r].innerHTML=a[r].innerHTML.split(" ").join("&nbsp;"));if(null!=customui){if(customui.devicesbarbuttons){o="";for(r in customui.devicesbarbuttons){var s="one"==customui.devicesbarbuttons[r].selection||"many"==customui.devicesbarbuttons[r].selection?"disabled":"";o+='<input id="cui:'+r+'" type="button" value="'+customui.devicesbarbuttons[r].name+'" '+s+' onclick=customUIAction(event,"devicesbarbuttons") />'}QH("devsCustomUIBar",o)}if(customui.desktopbuttons){o="";for(r in customui.desktopbuttons)o+='<input id="cui:'+r+'" type="button" value="'+customui.desktopbuttons[r].name+'" style="float:left" onclick=customUIAction(event,"desktopbuttons") />';QH("desktopCustomUiButtons",o)}if(customui.terminalbuttons){o="";for(r in customui.terminalbuttons)o+='<input id="cui:'+r+'" type="button" value="'+customui.terminalbuttons[r].name+'" style="float:left" onclick=customUIAction(event,"terminalbuttons") />';QH("terminalCustomUiButtons",o)}if(customui.filesbuttons){o="";for(r in customui.filesbuttons)o+='<input id="cui:'+r+'" type="button" value="'+customui.filesbuttons[r].name+'" style="float:left" onclick=customUIAction(event,"filesbuttons") />';QH("filesCustomUiButtons",o)}}10<=sessionTime&&(sessionRefreshTimer=setTimeout(refreshCookieSession,Math.round(6e4*sessionTime*.8))),deskKeyboardShortcuts=[];var r,l=getstore("deskKeyShortcuts","0x0A002E,0x100000,0x100028,0x100026,0x10004C,0x10004D,0x11004D,0x100052,0x020073,0x080057,0x020009,0x100025,0x100027").split(",");for(r in l)""!=l[r]&&deskKeyboardShortcuts.push(parseInt(l[r]));updateDeskShortcutKeys();try{deskKeyboardStrings=JSON.parse(getstore("deskStrings","[]"))}catch(e){}updateDesktopStrings(),updateCollapseAllButton(),dialogBoxDrag(),urlargs.key&&(Q("p6backuplink").href+="?key="+urlargs.key),QV("uiViewButton4",0==(3145728&features2)),Q("DeskType").value=multiTranslate("[KeyboardTyping]|Typ"),QV("ScrollToTopButton",0!=(134217728&features2))}function refreshCookieSession(){var e=null;try{e=new XDomainRequest}catch(e){}(e=e||new XMLHttpRequest).open("GET",window.location.origin+domainUrl+"refresh.ashx"),e.timeout=15e3,e.onload=function(){sessionRefreshTimer=setTimeout(refreshCookieSession,Math.round(6e4*sessionTime*.8))},e.onerror=e.ontimeout=function(){sessionRefreshTimer=null},e.send()}function customUIAction(e,t){e=e.srcElement.id;if(0!=e.startsWith("cui:")){var n=customui[t][e.substring(4)];if(null!=n){if("devicesbarbuttons"==t){for(var o=document.getElementsByClassName("DeviceCheckbox"),i=[],a=0;a<o.length;a++)!0===o[a].checked&&i.push(o[a].defaultValue.substring(6));if("string"==typeof n.action&&("event"==n.action&&meshserver.send({action:"uicustomevent",section:t,element:e.substring(4),selectedDevices:i,logmsg:n.logmsg}),n.action.startsWith("dialog:")&&showCustomUiDialog(n.action.substring(7),{section:t,element:e.substring(4),selectedDevices:i}),n.deselectdevices)){for(a=0;a<o.length;a++)o[a].checked=!1;checkedNodeids={},p1updateInfo()}}"devicebuttons"!=t&&"desktopbuttons"!=t&&"terminalbuttons"!=t&&"filesbuttons"!=t||(i=[currentNode._id],"string"==typeof n.action&&("event"==n.action&&meshserver.send({action:"uicustomevent",section:t,element:e.substring(4),selectedDevices:i,logmsg:n.logmsg}),n.action.startsWith("dialog:"))&&showCustomUiDialog(n.action.substring(7),{section:t,element:e.substring(4),selectedDevices:i}))}}}function showCustomUiDialog(e,t){if(null!=customui&&null!=customui.dialogs&&"object"==typeof customui.dialogs[e]){var n="",o=customui.dialogs[e],i=3;if("string"==typeof o.text&&(n+="<div style=margin-bottom:8px>"+o.text+"</div>"),"number"==typeof o.buttons&&(i=o.buttons),"object"==typeof o.elements)for(var a in o.elements){var s=o.elements[a];if("text"==s.type&&(n+=addHtmlValue(s.name,"<input id=cui:"+a+" style=width:230px autocomplete=off />")),"textarea"==s.type&&(null==s.name?n+="<textarea id=cui:"+a+" style=width:356px;resize:none;height:100px autocomplete=off></textarea>":n+=addHtmlValue(s.name,"<textarea id=cui:"+a+" style=width:230px;resize:none;height:100px autocomplete=off></textarea>")),"droplist"==s.type){var r,l="";for(r in s.options)l+='<option value="'+r+'">'+EscapeHtml(s.options[r])+"</option>";n+=addHtmlValue(s.name,'<select id="cui:'+a+'" style=width:230px autocomplete=off />'+l+"</select>")}}setDialogMode(2,o.title,i,showCustomUiDialogEx,n,{action:"uicustomevent",section:"dialogs",element:e,src:t,values:{},logmsg:o.logmsg})}}function showCustomUiDialogEx(e,t){if(1==e){var n=customui.dialogs[t.element];if("object"==typeof n.elements)for(var o in n.elements){var i=n.elements[o];"droplist"!=i.type&&"textarea"!=i.type&&"text"!=i.type||(t.values[o]=Q("cui:"+o).value)}if(meshserver.send(t),n.deselectdevices){for(var a=document.getElementsByClassName("DeviceCheckbox"),o=0;o<a.length;o++)a[o].checked=!1;checkedNodeids={},p1updateInfo()}}}function adjustPanels(){var e=args.hide,e=(0==footerBar&&(e|=4),QV("masthead",!(1&e)),QV("topbar",!(2&e)),QV("footer",!(4&e)),QV("p1title",!(8&e)),QV("p2title",!(8&e)),QV("p3title",!(8&e)),QV("p4title",!(8&e)),QV("p5title",!(8&e)),QV("p6title",!(8&e)),QV("p10title",!(8&e)),QV("p11title",!(8&e)),QV("p12title",!(8&e)),QV("p13title",!(8&e)),QV("p14title",!(8&e)),QV("p15title",!(8&e)),QV("p16title",!(8&e)),QV("p17title",!(8&e)),QV("p20title",!(8&e)),QV("p21title",!(8&e)),QV("p30title",!(8&e)),QV("p31title",!(8&e)),QV("p40title",!(8&e)),QV("p41title",!(8&e)),QV("p50title",!(8&e)),QV("p51title",!(8&e)),footerBar?QC("body").remove("nofooter"):QC("body").add("nofooter"),0!=args.hide&&(2==uiMode?(QS("container")["grid-template-rows"]=(1&e?"0":"66")+"px fit-content(48px) auto "+(4&e?"0":"45")+"px",QS("container")["-ms-grid-rows"]=(1&e?"0":"66")+"px fit-content(48px) auto "+(4&e?"0":"45")+"px"):(QS("container")["grid-template-rows"]=(1&e?"0":"66")+"px "+(2&e?"0":"24")+"px auto "+(4&e?"0":"45")+"px",QS("container")["-ms-grid-rows"]=(1&e?"0":"66")+"px "+(2&e?"0":"24")+"px auto "+(4&e?"0":"45")+"px")),(1&e?0:66)+(2&e?0:24)+(4&e?0:45)+(8&e?0:60)),t=1<uiMode?24:0,n=(QS("p2info").height="calc(100vh - "+(20+e+t)+"px)",QS("p2info")["max-height"]="calc(100vh - "+(20+e+t)+"px)",QS("p3users")["max-height"]="calc(100vh - "+(50+e)+"px)",QS("p50groups")["max-height"]="calc(100vh - "+(50+e)+"px)",QS("p3events").height="calc(100vh - "+(50+e)+"px)",QS("p5filetable").height="calc(100vh - "+(99+e)+"px)",QS("p13filetable").height="calc(100vh - "+(127+e+t)+"px)",QS("serverMainStats").height="calc(100vh - "+(50+e+t)+"px)",QS("serverMainStats")["max-height"]="calc(100vh - "+(50+e+t)+"px)",QS("xdevices")["max-height"]="calc(100vh - "+(46+e)+"px)",QS("xdevicesmap")["max-height"]="calc(100vh - "+(46+e)+"px)",QS("p15agentConsole").height="calc(100vh - "+(84+e+t)+"px)",QS("p15agentConsole")["max-height"]="calc(100vh - "+(84+e+t)+"px)",QS("p15agentConsoleText").height="calc(100vh - "+(81+e+t)+"px)",QS("p15agentConsoleText")["max-height"]="calc(100vh - "+(81+e+t)+"px)",!(0===args.xterm||null!=terminal&&null==xterm));fullscreen?(QS("deskarea3x").height=null,QS("deskarea3x")["max-height"]=null,QS("p14iframe").height=null,QS("p14iframe")["max-height"]=null,n&&(QS("termarea3x").height="calc(100vh - 55px)",QS("termarea3xdiv").height="calc(100vh - 55px)",QS("termarea3x")["max-width"]="calc(1px)")):(QS("deskarea3x").height="calc(100vh - "+(74+e+t)+"px)",QS("deskarea3x")["max-height"]="calc(100vh - "+(74+e+t)+"px)",QS("p14iframe").height="calc(100vh - "+(23+e+t)+"px)",QS("p14iframe")["max-height"]="calc(100vh - "+(23+e+t)+"px)",n&&(QS("termarea3x").height="calc(100vh - "+(74+e+t)+"px)",QS("termarea3xdiv").height="calc(100vh - "+(74+e+t)+"px)",QS("termarea3x")["max-width"]="calc(1px)")),QS("p43iframe").height="calc(100vh - "+(84+e)+"px)",QS("p43iframe")["max-height"]="calc(100vh - "+(84+e)+"px)",QS("p6info").height="calc(100vh - "+(e-50+t)+"px)",QS("p6info")["max-height"]="calc(100vh - "+(e-50+t)+"px)",QS("p10info").height="calc(100vh - "+(20+e+t)+"px)",QS("p10info")["max-height"]="calc(100vh - "+(20+e+t)+"px)",QS("p17info").height="calc(100vh - "+(20+e+t)+"px)",QS("p17info")["max-height"]="calc(100vh - "+(20+e+t)+"px)",QS("p20main").height="calc(100vh - "+(e-50+t)+"px)",QS("p20main")["max-height"]="calc(100vh - "+(e-50+t)+"px)",QS("p21main").height="calc(100vh - "+(20+e+t)+"px)",QS("p21main")["max-height"]="calc(100vh - "+(20+e+t)+"px)",QS("p30info").height="calc(100vh - "+(20+e+t)+"px)",QS("p30info")["max-height"]="calc(100vh - "+(20+e+t)+"px)",QS("p51info").height="calc(100vh - "+(20+e+t)+"px)",QS("p51info")["max-height"]="calc(100vh - "+(20+e+t)+"px)",QS("p16events").height="calc(100vh - "+(50+e+t)+"px)",QS("p16events")["max-height"]="calc(100vh - "+(50+e+t)+"px)",QS("p31events").height="calc(100vh - "+(50+e+t)+"px)",QS("p31events")["max-height"]="calc(100vh - "+(50+e+t)+"px)",QS("p41events").height="calc(100vh - "+(48+e+t)+"px)",QS("p41events")["max-height"]="calc(100vh - "+(48+e+t)+"px)",QS("p52recordings").height="calc(100vh - "+(48+e+t)+"px)",QS("p52recordings")["max-height"]="calc(100vh - "+(48+e+t)+"px)",QS("p60report").height="calc(100vh - "+(48+e+t)+"px)",QS("p60report")["max-height"]="calc(100vh - "+(48+e+t)+"px)",(32&args.hide||""!="{{currentNode}}".toLowerCase())&&(QV("p10BackButton",!1),QV("p11BackButton",!1),QV("p12BackButton",!1),QV("p13BackButton",!1),QV("p14BackButton",!1),QV("p15BackButton",!1),QV("p16BackButton",!1),QV("p17BackButton",!1)),p1updateInfo()}function toggleAspectRatio(e){1===e&&putstore("deskAspectRatio",deskAspectRatio=(deskAspectRatio+1)%3),deskAdjust()}function toggleStackMenu(e){1==webPageFullScreen&&(1===e&&putstore("webPageStackMenu",webPageStackMenu=!webPageStackMenu),0==webPageStackMenu?QC("body").remove("menu_stack"):(QC("body").add("menu_stack"),10<=xxcurrentView&&QC("column_l").remove("room4submenu")),deskAdjust())}function showUserInterfaceSelectMenu(){if(!xxdialogMode){Q("uiViewButton1").classList.remove("uiSelectorSel"),Q("uiViewButton2").classList.remove("uiSelectorSel"),Q("uiViewButton3").classList.remove("uiSelectorSel"),Q("uiViewButton4").classList.remove("uiSelectorSel"),Q("uiViewButton5").classList.remove("uiSelectorSel");try{Q("uiViewButton"+uiMode).classList.add("uiSelectorSel")}catch(e){}QV("uiMenu","none"==QS("uiMenu").display),nightMode&&Q("uiViewButton4").classList.add("uiSelectorSel"),footerBar&&Q("uiViewButton5").classList.add("uiSelectorSel")}}function userInterfaceSelectMenu(e){e&&putstore("uiMode",uiMode=e),webPageFullScreen=uiMode<3,webPageStackMenu=1<uiMode,toggleFullScreen(0),toggleStackMenu(0),webPageStackMenu&&10<=xxcurrentView?QC("column_l").add("room4submenu"):QC("column_l").remove("room4submenu"),adjustPanels()}function toggleNightMode(){var e;xxdialogMode||(setDialogMode(2,"Tmavý režim",3,toggleNightModeEx,"<input type=radio id=night0 name=nightmoderadio value=0 "+(0==(e=getstore("nightMode","0"))?"checked":"")+"><label for=night0>Dle prohlížeče</label><br>"+("<input type=radio id=night2 name=nightmoderadio value=2 "+(2==e?"checked":"")+"><label for=night2>Světlý režim</label><br>")+("<input type=radio id=night1 name=nightmoderadio value=1 "+(1==e?"checked":"")+"><label for=night1>Tmavý režim</label><br>")),QV("uiMenu",!1))}function toggleNightModeEx(){var e="0";Q("night1").checked&&(e="1"),putstore("nightMode",e=Q("night2").checked?"2":e),setNightMode()}function setNightMode(){var e=getstore("nightMode","0");return nightMode=!1,0!=(1048576&features2)&&(e="1"),"1"==(e=0!=(2097152&features2)?"2":e)?nightMode=!0:"0"==e&&window.matchMedia&&(nightMode=window.matchMedia("(prefers-color-scheme: dark)").matches),nightMode?(QC("body").add("night"),QS("body")["background-color"]="#000"):(QC("body").remove("night"),QS("body")["background-color"]="#d3d9d6"),nightMode}function toggleFooterBarMode(){putstore("footerBar",(footerBar=!footerBar)?"1":"0"),QS("container")["grid-template-rows"]=null,QS("container")["-ms-grid-rows"]=null,adjustPanels()}function toggleFullScreen(e){1===e&&putstore("webPageFullScreen",webPageFullScreen=!webPageFullScreen),0==webPageFullScreen?(QC("body").remove("menu_stack"),QC("body").remove("fullscreen"),QC("body").remove("arg_hide"),10<=xxcurrentView&&QC("column_l").add("room4submenu"),QV("UserDummyMenuSpan",!1)):(QC("body").add("fullscreen"),16&args.hide&&QC("body").add("arg_hide"),QV("page_leftbar",!(16&args.hide)),QV("MainMenuSpan",!(16&args.hide)),10<=xxcurrentView&&QC("column_l").remove("room4submenu"),QV("UserDummyMenuSpan",xxcurrentView<10&&webPageFullScreen)),mainUpdate(512),QV("body",!0)}function saveUserInterfaceMode(){var e=2;Q("ui1").checked&&(e=3),getstore("uiViewMode",2)!=e&&(putstore("uiViewMode",e),reload())}function toggleBootstrapUIMode(){var e,t;xxdialogMode||(t="<input type=radio id=ui0 name=uiradio value=2 "+(2==(e=getstore("uiViewMode",2))?"checked":"")+"><label for=ui0>Classic</label><br>",setDialogMode(2,"User Interface",3,saveUserInterfaceMode,t+="<input type=radio id=ui1 name=uiradio value=3 "+(3==e?"checked":"")+"><label for=ui1>Modern</label><br>"),QV("uiMenu",!1))}function getNodeFromId(e){if(null!=nodes)for(var t in nodes)if(nodes[t]._id==e)return nodes[t];return null}function reload(){var e=window.location.href;(e=e.endsWith("/#")?e.substring(0,e.length-2):e).endsWith("#")&&(e=e.substring(0,e.length-1)),window.location.href=e}function onStateChanged(e,t,n,o){0==t?(setDialogMode(0),go(0),deviceShares=powerTimelineUpdate=powerTimelineNode=powerTimelineReq=powerTimeline=null,deleteAllNotifications(),hideContextMenu(),QV("verifyEmailId2",!1),QV("logoutControl",!1),"noauth"==o?QH("p0span","Nedaří se ověřit se"):"invalidorigin"==o?QH("p0span","Invalid origin in HTTP request"):(2==n?autoReconnect&&setTimeout(serverPoll,5e3):QH("p0span","Nedaří se připojit k web socketu"),null!=authCookieRenewTimer&&(clearInterval(authCookieRenewTimer),authCookieRenewTimer=null))):2==t&&(meshserver.send({action:"usergroups"}),meshserver.send({action:"meshes"}),meshserver.send({action:"nodes",id:"{{currentNode}}",skip:null==devicePagingState?0:devicePagingState.skip}),meshserver.send({action:"loginTokens"}),null!=pluginHandler&&meshserver.send({action:"plugins"}),""=="{{currentNode}}".toLowerCase()&&meshserver.send({action:"files"}),""=="{{viewmode}}".toLowerCase()&&go(1),authCookieRenewTimer=setInterval(function(){meshserver.send({action:"authcookie"})},18e5),40==xxcurrentView)&&refreshServerTimelineStats()}function serverPoll(){var e=null;try{e=new XDomainRequest}catch(e){}(e=e||new XMLHttpRequest).open("HEAD",window.location.href),e.timeout=15e3,e.onload=function(){e.status<500?reload():setTimeout(serverPoll,1e4)},e.onerror=e.ontimeout=function(){setTimeout(serverPoll,1e4)},e.send()}function detectWindowsBrowser(){var e=window.navigator.userAgent.toUpperCase();return 0<=e.indexOf("WINDOWS")||0<=e.indexOf("WIN32")||0<=e.indexOf("WIN64")}function updateSiteAdmin(){var e=parseInt("{{{serverfeatures}}}"),t=userinfo.siteadmin,n=4294967295!=t&&0!=(1024&t)||0!=(256&features2);QV("p2AccountSecurity",0==(4&features)&&0==serverinfo.domainauth&&0!=(4096&features)&&0==n),QV("p2AccountActions",!n),QV("managePhoneNumber1",33554432&features&&67108864&features&&1!=serverinfo.lock2factor),QV("managePhoneNumber2",33554432&features&&!(67108864&features)&&1!=serverinfo.lock2factor),QV("manageMessaging1",33554432&features2&&67108864&features2&&1!=serverinfo.lock2factor),QV("manageMessaging2",33554432&features2&&!(67108864&features2)&&1!=serverinfo.lock2factor),QV("manageEmail2FA",8388608&features&&1!=serverinfo.lock2factor),QV("p2AccountPassActions",0==(4&features)&&0==serverinfo.domainauth&&null!=userinfo&&0==userinfo._id.split("/")[2].startsWith("~")),QV("accountCreateLoginTokenSpan",128&features2),QV("p2AccountImageFrame",!n),QV("p2ServerActions",21&t&&0!=(143&e)),QV("LeftMenuMyServer",21&t&&0!=(64&e)),QV("MainMenuMyServer",21&t),QV("p2ServerActionsBackup",1&t&&0!=(1&e)),QV("p2ServerActionsRestore",4&t&&0!=(2&e)),QV("p2ServerActionsVersion",16&t&&0!=(4&e)),QV("p2ServerActionsErrors",16&t&&0!=(8&e)),QV("p2ServerActionsConfig",16&t&&0!=(128&e)),QV("MainMenuMyFiles",8&t),QV("LeftMenuMyFiles",8&t),0==(8&t)&&5==xxcurrentView&&(setDialogMode(0),go(1)),null!=currentNode&&gotoDevice(currentNode._id,xxcurrentView,!0),null!=userinfo.flags&&1&userinfo.flags?(null==userinfo.accountImageRnd&&(userinfo.accountImageRnd=Math.floor(9999999999*Math.random())),Q("p2AccountImage").src="userimage.ashx?rnd="+userinfo.accountImageRnd):Q("p2AccountImage").src="images/user-256.png",0!=(2&userinfo.siteadmin)?(null==users&&meshserver.send({action:"users"}),null==wssessions&&meshserver.send({action:"wssessioncount"}),mainUpdate(24576)):(wssessions=users=null,mainUpdate(16384),(4==xxcurrentView||30<=xxcurrentView&&xxcurrentView<40)&&(setDialogMode(0),go(1),currentUser=null)),meshserver.send({action:"events",limit:parseInt(p3limitdropdown.value)}),QV("ServerConsole",4294967295===userinfo.siteadmin&&0!=(16&e)),QV("ServerTrace",4294967295===userinfo.siteadmin&&0!=(32&e)),115==xxcurrentView&&4294967295!=userinfo.siteadmin&&go(6),6==xxcurrentView&&0==(21&userinfo.siteadmin)&&go(1),0!=(21&t)&&meshserver.send({action:"serverstats",interval:1e4})}check_webp_feature("lossy",function(e,t){(webpSupport=t)||(d7encoding.options[1].disabled=!0,d7encoding.value=1)}),window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").addEventListener("change",setNightMode);var updateNaggleTimer=null,updateNaggleFlags=0;function mainUpdate(e){updateNaggleFlags|=e,null==updateNaggleTimer&&(updateNaggleTimer=setTimeout(function(){512&updateNaggleFlags&&center(),1&updateNaggleFlags&&onSearchInputChanged(),2&updateNaggleFlags&&onSortSelectChange(!1),128&updateNaggleFlags&&updateMeshes(),4&updateNaggleFlags&&(updateDevices(),updateDeviceDetails(),21==xxcurrentView)&&p21updateMesh(),8&updateNaggleFlags&&drawNotifications(),16&updateNaggleFlags&&32768&features&&updateMapMarkers(),32&updateNaggleFlags&&eventsUpdate(),64&updateNaggleFlags&&32768&features&&refreshMap(!1,!0),256&updateNaggleFlags&&drawDeviceTimeline(),1024&updateNaggleFlags&&deviceEventsUpdate(),2048&updateNaggleFlags&&userEventsUpdate(),4096&updateNaggleFlags&&p20updateMesh(),8192&updateNaggleFlags&&updateUserGroups(),16384&updateNaggleFlags&&updateUsers(),32768&updateNaggleFlags&&updateRecordings(),65536&updateNaggleFlags&&updateLoginTokens(),updateNaggleTimer=null,updateNaggleFlags=0,gotoStartViewPage()},150))}function count2factoraAuths(){var e;return null==userinfo?-1:(e=0,1==userinfo.otpsecret&&e++,0<userinfo.otphkeys&&(e+=userinfo.otphkeys),8388608&features&&1==userinfo.otpekey&&e++,33554432&features&&67108864&features&&null!=userinfo.phone&&e++,33554432&features2&&67108864&features2&&null!=userinfo.msghandle&&e++,0<e&&0<userinfo.otpkeys&&0==(262144&features2)&&e++,e)}var backupCodesWarningDone=!1;function updateSelf(){var e,t=count2factoraAuths(),n=4294967295!=userinfo.siteadmin&&0!=(1024&userinfo.siteadmin),n=(QV("verifyEmailId",!0!==userinfo.emailVerified&&null!=userinfo.email&&1==serverinfo.emailcheck),QV("verifyEmailId2",!0!==userinfo.emailVerified&&null!=userinfo.email&&1==serverinfo.emailcheck&&0==n),QV("manageOtp",1!=serverinfo.lock2factor&&0<t&&0==(262144&features2)),QV("authPhoneNumberCheck",null!=userinfo.phone),QV("authMessagingCheck",null!=userinfo.msghandle),QV("authEmailSetupCheck",1==userinfo.otpekey&&null!=userinfo.email&&1==userinfo.emailVerified),QV("authDuoSetupCheck",1==userinfo.otpduo&&0!=(536870912&features2)),QV("authAppSetupCheck",1==userinfo.otpsecret),QV("manageAuthApp",1!=serverinfo.lock2factor&&(1==userinfo.otpsecret||0==(131072&features2))),QV("manageDuoApp",1!=serverinfo.lock2factor&&0!=(536870912&features2)),QV("authKeySetupCheck",0<userinfo.otphkeys),QV("authPushAuthDevCheck",0<userinfo.otpdev&&0!=(64&features2)),QV("authCodesSetupCheck",0<userinfo.otpkeys),QV("managePushAuthDev",1!=serverinfo.lock2factor&&64&features2&&0<t),QV("manageHardwareOtp",1!=serverinfo.lock2factor),mainUpdate(4228),0==backupCodesWarningDone&&1==t&&0==(524288&features2)&&(addNotification({text:"Přidejte 2-faktorové záložní kódy. Pokud dojde ke ztrátě stávajícího faktoru, není možné tento účet obnovit.",title:"2-faktorové ověřování se",tag:"backupcodes"}),backupCodesWarningDone=!0),4294967295==userinfo.siteadmin||0==(64&userinfo.siteadmin));QV("p2createMeshLink1",n),QV("p2createMeshLink2",n),QV("getStarted1",n),QV("getStarted2",!n),"number"==typeof userinfo.passchange&&(-1==userinfo.passchange?QH("p2nextPasswordUpdateTime"," - Resetovat při příštím přihlášení."):null!=passRequirements&&"number"==typeof passRequirements.reset&&((t=userinfo.passchange+86400*passRequirements.reset-Math.floor(Date.now()/1e3))<0?QH("p2nextPasswordUpdateTime"," - Resetovat při příštím přihlášení."):t<3600?(n=Math.floor(t/60),QH("p2nextPasswordUpdateTime",format(1==n?" - Resetovat za 1 minutu.":" - Resetovat za {0} minut.",n))):t<86400?(e=Math.floor(t/3600),QH("p2nextPasswordUpdateTime",format(1==e?" - Resetovat za 1 hodinu.":" - Resetovat za {0} hodin.",e))):(n=Math.floor(t/86400),QH("p2nextPasswordUpdateTime",format(1==e?" - Resetovat za 1 den.":" - Resetovat za {0} dnů.",n))))),QV("MainMenuMyUsers",null!=users&&0==(4&features)||0!=(512&userinfo.siteadmin)&&0!=(134217728&features)),QV("LeftMenuMyUsers",null!=users&&0==(4&features)||0!=(512&userinfo.siteadmin)&&0!=(134217728&features)),QV("UsersGeneral",null!=users&&0==(4&features)),QV("UsersGroups",null!=users&&0==(4&features)),QV("UsersRecordings",0!=(512&userinfo.siteadmin)&&0!=(134217728&features))}function setSessionActivity(){sessionActivity=Date.now(),QH("idleTimeoutNotify","")}function checkIdleSessionTimeout(){var e=Date.now()-sessionActivity;e>serverinfo.timeout?(null!=desktop&&(desktop.Stop(),webRtcDesktopReset(),(desktopNode=desktop=null)!=pluginHandler)&&pluginHandler.callHook("onDesktopDisconnect"),null!=terminal&&(terminal.Stop(),terminal=null),null!=files&&(files.Stop(),files=null),serverinfo.logoutOnIdleSessionTimeout&&(window.location.href="logout")):(e=Math.round((serverinfo.timeout-e)/1e3))<=60?QH("idleTimeoutNotify","<br />"+format(1==e?"1 sekunda do odpojení":"{0} sekund do odpojení",e)):(e=Math.round(e/60))<=5&&QH("idleTimeoutNotify","<br />"+format(1==e?"1 minuta do odpojení":"{0} minut do odpojení",e))}function onMessage(P,e){switch(e.action){case"trace":serverTrace.unshift(e),displayServerTrace();break;case"intersession":"removeNotify"==e.subaction&&notificationDelete(e.id);break;case"traceinfo":"object"==typeof e.traceSources&&(null!=e.traceSources&&0<e.traceSources.length?(serverTraceSources=e.traceSources,QH("p41traceStatus",EscapeHtml(e.traceSources.join(", ")))):(serverTraceSources=[],QH("p41traceStatus","Nic")));break;case"serverstats":updateGeneralServerStats(e);break;case"serverwarnings":if(null!=e.warnings&&0<e.warnings.length){var R={1:"",2:"Chybí parametry WebDAV.",3:'Nerozpoznaná možnost konfigurace "{0}".',4:"Komprese WebSocket je zakázána, tato funkce je nefunkční v NodeJS v11.11 až v12.15 a v13.2",5:"Nelze načíst kořenový certifikát Intel AMT TLS pro výchozí doménu.",6:"Nelze načíst kořenový certifikát Intel AMT TLS pro doménu {0}.",7:"Místní FQDN CIRA jsou ignorovány, když je server v režimu pouze LAN nebo WAN.",8:"Nemůže mít více než 4 místní FQDN CIRA. Ignorování hodnoty.",9:"Kontrola hash agenta se přeskakuje, není to bezpečné.",10:"Chybí e-mailová adresa Let's Encrypt.",11:"Neplatné názvy hostitelů Let's Encrypt.",12:"Neplatná jména Let's Encrypt, nesmí obsahovat *.",13:"Nelze nastavit modul Let's Encrypt.",14:"Neplatná jména Let's Encrypt, nelze vyřešit: {0}",15:"Neplatná e-mailová adresa Let's Encrypt, nelze vyřešit: {0}",16:"Nelze načíst seznam adres IPv6 důvěryhodného proxy serveru CloudFlare.",17:"SendGrid server má omezené použití v režimu LAN.",18:"SMTP server má omezené použití v režimu LAN.",19:"SMS brána má omezené použití v režimu LAN.",20:'Neplatný "LoginCookieEncryptionKey" v config.json.',21:"Cestu zálohy nelze nastavit ve složce meshcentral-data, nastavení zálohování je ignorováno.",22:"Nepodařilo se podepsat agenta {0}: {1}",23:"Unable to load agent icon file: {0}.",24:"Unable to load agent logo file: {0}.",25:"This NodeJS version does not support OpenID.",26:"This NodeJS version does not support Discord.js.",27:"Firebase now requires a service account JSON file, Firebase disabled."},t="";for(r in e.warnings)"string"==typeof(n=e.warnings[r])?t+="<div style=color:red;padding-bottom:6px><b>VAROVÁNÍ: "+n+"</b></div>":(null==(i=R[n.id])?i=n.msg:null!=n.args&&(i=format(i,...n.args)),t+="<div style=color:red;padding-bottom:6px><b>VAROVÁNÍ: "+i+"</b></div>");QH("serverWarnings",t),QV("serverWarningsDiv",!0)}break;case"servertimelinestats":setServerTimelineStats(e.events);break;case"authcookie":authCookie=e.cookie,authRelayCookie=e.rcookie;break;case"serverinfo":if((serverinfo=e.serverinfo).timeout&&(setInterval(checkIdleSessionTimeout,1e4),checkIdleSessionTimeout()),1==debugmode&&console.log("Server time: ",printDateTime(new Date(serverinfo.serverTime))),setupServiceWorker(),null!=serverinfo.certExpire&&0<=(u=Math.floor((serverinfo.certExpire-Date.now())/864e5))&&u<20&&(QH("serverCertWarnings","<div style=color:red;padding-bottom:6px><b>VAROVÁNÍ: "+format("Platnost certifikátu vyprší za {0} dnů",u)+"</b></div>"),QV("serverWarningsDiv",!0),addNotification({text:format("Platnost certifikátu vyprší za {0} dnů",u)})),serverinfo.preConfiguredRemoteInput){t="";for(r in serverinfo.preConfiguredRemoteInput)t+='<div class="cmtext" onclick="cmdeskpreconfigtypeaction('+r+',event)">'+EscapeHtml(serverinfo.preConfiguredRemoteInput[r].name)+"</div>";""!=t&&(t+="<hr />"),QH("deskPreConfigShortcutContextMenu1",t)}if(serverinfo.preConfiguredScripts){var t="",n="";for(r in serverinfo.preConfiguredScripts){var o=serverinfo.preConfiguredScripts[r],i='<div class="cmtext" onclick="cmdeskpreconfigscriptaction('+r+',event)">'+EscapeHtml(serverinfo.preConfiguredScripts[r].name)+"</div>";3!=o.type&&(t+=i),3<=o.type&&(n+=i)}QH("deskPreConfigScriptContextMenu1",t),QH("deskPreConfigScriptContextMenu2",n)}break;case"userinfo":userinfo=e.userinfo,updateSiteAdmin(),updateSelf();break;case"users":for(var a in users={},e.users)users[e.users[a]._id]=e.users[a];null!=currentUser&&(currentUser=users[currentUser._id]),mainUpdate(16384),updateSelf();break;case"wssessioncount":wssessions=e.wssessions,mainUpdate(16384);break;case"meshes":for(var a in meshes={},e.meshes)meshes[e.meshes[a]._id]=e.meshes[a];null!=currentMesh&&(currentMesh=meshes[currentMesh._id]),mainUpdate(132);break;case"usergroups":var s=0;if(Array.isArray(e.ugroups))for(var r in usergroups={},e.ugroups)s++,usergroups[e.ugroups[r]._id]=e.ugroups[r];else for(var r in usergroups=e.ugroups,e.ugroups)s++,e.ugroups[r]._id=r;0==s&&(usergroups=null),mainUpdate(8192);break;case"files":filetree=setupBackPointers(e.filetree),updateFiles(),d3updatefiles();break;case"nodes":for(var a in nodes=[],e.nodes)for(var l in e.nodes[a])null==e.nodes[a][l]._id?console.log("Invalid node ("+l+"): "+JSON.stringify(e.nodes)):(null==e.nodes[a][l].name&&(e.nodes[a][l].name="???"),e.nodes[a][l].namel=e.nodes[a][l].name.toLowerCase(),e.nodes[a][l].rname?e.nodes[a][l].rnamel=e.nodes[a][l].rname.toLowerCase():e.nodes[a][l].rnamel=e.nodes[a][l].namel,e.nodes[a][l].meshnamel=meshes[a]?meshes[a].name.toLowerCase():"*",e.nodes[a][l].meshid=a,e.nodes[a][l].state=e.nodes[a][l].state||0,e.nodes[a][l].icon||(e.nodes[a][l].icon=1),e.nodes[a][l].ident=++nodeShortIdent,nodes.push(e.nodes[a][l]));for(var r in stars)null==getNodeFromId(r)&&delete stars[r];null!=currentNode&&0==IsNodeViewable(currentNode)&&(currentNode=null,go(1)),null!=currentNode&&(null!=(currentNode=getNodeFromId(currentNode._id))?gotoDevice(currentNode._id,xxcurrentView,!0):go(1)),devicePagingState=null==e.totalcount?null:{total:e.totalcount,skip:e.skip,limit:e.limit},updateDevicePageState(),mainUpdate(71);break;case"powertimeline":if(e.nodeid==powerTimelineReq){for(var r in powerTimelineNode=e.nodeid,powerTimeline=e.timeline,powerTimelineUpdate=Date.now()+3e5,powerTimeline)r%2==1&&(powerTimeline[r]=1e3*powerTimeline[r]);currentNode._id==e.nodeid&&mainUpdate(256)}break;case"deviceShares":e.nodeid==deviceSharesReq&&(deviceSharesNode=e.nodeid,deviceShares=e.deviceShares,null!=currentNode&&currentNode._id==e.nodeid)&&gotoDevice(currentNode._id,xxcurrentView,!0);break;case"deviceMeshShares":e.meshid==deviceSharesReq&&(deviceSharesNode=e.meshid,deviceShares=e.deviceShares,null!=currentMesh&&currentMesh._id==e.meshid)&&p20updateMesh();break;case"getsysinfo":e.nodeid==powerTimelineReq&&(!0===e.noinfo?updateDeviceDetails(getNodeFromId(e.nodeid)):updateDeviceDetails(getNodeFromId(e.nodeid),e.hardware));break;case"lastconnect":null!=(T=getNodeFromId(e.nodeid))&&(T.lastconnect=e.time,T.lastaddr=e.addr,currentNode._id==T._id)&&""==Q("MainComputerState").innerHTML&&null!=T.lastconnect&&QH("MainComputerState","<span>Naposledy spatřen:<br />"+printDateTime(new Date(T.lastconnect))+"</span>");break;case"lastconnects":var H=Object.keys(e.lastconnects);for(r in H){var j=H[r];null!=(T=getNodeFromId(j))&&(T.lastconnect=e.lastconnects[j])}mainUpdate(4);case"msg":if(null!=e.nodeid){var d=-1;if(null!=nodes)for(var r in nodes)if(nodes[r]._id==e.nodeid){d=r;break}if(-1!=d)if("cpuinfo"===e.type&&null!=currentNode&&currentNode._id==e.nodeid){var u=Date.now()/1e3,c=0,p=0;"number"==typeof e.cpu.total&&(c=e.cpu.total),"number"==typeof e.memory.percentConsumed&&(p=e.memory.percentConsumed),deviceDetailsStatsData.push([u,c,p]),deviceDetailsStatsDraw(e)}else if("console"===e.type)p15consoleReceive(nodes[d],e.value,e.source);else if("notify"===e.type){if(0==(8&(l=getstore("notifications",0)))&&null!=e.amtMessage)break;l={text:e.value,title:e.title,icon:e.icon,titleid:e.titleid,msgid:e.msgid,args:e.args};null!=e.id&&(l.id=e.id),null!=e.nodeid&&(l.nodeid=e.nodeid),null!=e.tag&&(l.tag=e.tag),null!=e.url&&(l.url=e.url),null!=e.username&&(l.username=e.username),"number"==typeof e.maxtime&&(l.maxtime=e.maxtime),addNotification(l)}else if("ps"===e.type)showDeskToolsProcesses(e);else if("services"===e.type)showDeskToolsServices(e);else if("service"===e.type)showServiceDetailsDialog(e);else if("getclip"===e.type&&null!=currentNode&&currentNode._id==e.nodeid)1==e.tag&&"clipboard"===xxdialogTag?Q("d2clipText").value=e.data:2===e.tag&&null!=navigator.clipboard&&navigator.clipboard.writeText(e.data).then(function(){}).catch(function(e){console.log(e)});else if("setclip"===e.type&&"clipboard"===xxdialogTag&&null!=currentNode&&currentNode._id==e.nodeid)QH("dlgClipStatus",e.success?"<span style=color:green>Úspěch</span>":"<span style=color:red>Nezdařilo se</span>"),setTimeout(function(){try{QH("dlgClipStatus","")}catch(e){}},2e3);else if("userSessions"===e.type&&null!=currentNode&&currentNode._id===e.nodeid&&null==desktop){var m=[];if(null!=e.data)for(var r in e.data)"Active"!=e.data[r].State&&"Connected"!=e.data[r].State&&"Console"!=e.data[r].StationName&&3!=debugmode||m.push(e.data[r]);if(0===m.length)connectDesktop(null,1,null,e.tag);else if(1===m.length)connectDesktop(null,1,m[0].SessionId,e.tag);else{var t="",v="{{{userSessionsSort}}}";for(r in m.sort(function(e,t){return e[v]?t[v]?e[v]<t[v]?-1:t[v]<e[v]?1:0:1:-1}),m)t+='<div style="text-align:left;cursor:pointer;background-color:gray;margin:5px;padding:5px;border-radius:5px" onclick=connectDesktop(event,1,'+m[r].SessionId+","+e.tag+")>"+m[r].State+(m[r].StationName?", "+m[r].StationName:""),m[r].Username&&(m[r].Domain?t+=" - "+m[r].Domain+"/"+m[r].Username:t+=" - "+m[r].Username),t+="</div>";QH("p11DeskSessionSelector",t),QV("p11DeskSessionSelector",!0)}}else"psinfo"===e.type?xxdialogTag==="ps|"+e.nodeid+"|"+e.pid&&(t="<div style=max-height:200px;overflow-y:auto>","object"==typeof e.value&&0<Object.keys(e.value).length?(e.value=jsonToCamel(e.value),!e.value.cmd&&e.value.path&&(e.value.cmd=e.value.path),!e.value.processUser&&e.value.userName&&(e.value.processUser=e.value.userName.split("\\")[1]),!e.value.processDomain&&e.value.userName&&(e.value.processDomain=e.value.userName.split("\\")[0]),e.value.processName&&(t+="<div style=padding:4px><div style=padding-bottom:4px>Název procesu</div><div style=word-wrap:break-word;padding-left:6px><b>"+e.value.processName+"</b></div></div>"),e.value.machineName&&(t+=addHtmlValue5("Název stroje",e.value.machineName)),e.value.cmd&&(t+="<div style=padding:4px><div style=padding-bottom:4px>Příkazový řádek</div><div style=word-wrap:break-word;padding-left:6px><b>"+e.value.cmd+"</b></div></div>"),e.value.mainWindowTitle&&(t+="<div style=padding:4px><div style=padding-bottom:4px>Název okna</div><div style=word-wrap:break-word;padding-left:6px><b>"+e.value.mainWindowTitle+"</b></div></div>"),e.value.processUser&&(t+=addHtmlValue5("Uživatel",e.value.processUser)),e.value.processDomain&&(t+=addHtmlValue5("Doména",e.value.processDomain)),e.value.startTime&&(t+=addHtmlValue5("Doba spuštění",e.value.startTime)),t+="<hr />",e.value.PriorityBoostEnabled&&(t+=addHtmlValue5("Zvýšení priority",e.value.PriorityBoostEnabled?"Povoleno":"Zakázáno")),e.value.sessionId&&(t+=addHtmlValue5("ID relace",e.value.sessionId)),e.value.handleCount&&(t+=addHtmlValue5("Handle Count",e.value.handleCount)),e.value.privilegedProcessorTime&&(t+=addHtmlValue5("Čas privilegovaného procesoru",format("{0} sekund",e.value.privilegedProcessorTime))),e.value.totalProcessorTime&&(t+=addHtmlValue5("Celkový čas procesoru",format("{0} sekund",e.value.totalProcessorTime))),e.value.userProcessorTime&&(t+=addHtmlValue5("Čas procesoru uživatele",format("{0} sekund",e.value.userProcessorTime))),e.value.nonpagedSystemMemorySize&&(t+=addHtmlValue5("Nestránkovaná paměť",getNiceSize2(e.value.nonpagedSystemMemorySize))),e.value.pagedMemorySize&&(t+=addHtmlValue5("Stránkovaná paměť",getNiceSize2(e.value.pagedMemorySize))),e.value.privateMemorySize&&(t+=addHtmlValue5("Soukromá paměť",getNiceSize2(e.value.privateMemorySize))),e.value.virtualMemorySize&&(t+=addHtmlValue5("Virtuální paměť",getNiceSize2(e.value.virtualMemorySize))),e.value.workingSet&&(t+=addHtmlValue5("Pracovní sada",getNiceSize2(e.value.workingSet))),e.value.peakWorkingSet&&(t+=addHtmlValue5("Špičková pracovní sada",getNiceSize2(e.value.peakWorkingSet))),e.value.peakPagedMemorySize&&(t+=addHtmlValue5("Špičková stránkovaná paměť",getNiceSize2(e.value.peakPagedMemorySize))),e.value.peakVirtualMemorySize&&(t+=addHtmlValue5("Špičková virtuální paměť",getNiceSize2(e.value.peakVirtualMemorySize)))):t+="Nejsou k dispozici žádné informace",t+="</div>",QH("id_dialogOptions",t)):"deskBackground"===e.type&&(""!=e.data?Q("DeskBackgroundButtonImage").src="images/icon-background.png":Q("DeskBackgroundButtonImage").src="images/icon-background-red.png")}else"notify"===e.type&&(l={text:e.value,title:e.title,icon:e.icon,titleid:e.titleid,msgid:e.msgid,args:e.args},null!=e.id&&(l.id=e.id),null!=e.tag&&(l.tag=e.tag),null!=e.url&&(l.url=e.url),null!=e.username&&(l.username=e.username),"number"==typeof e.maxtime&&(l.maxtime=e.maxtime),addNotification(l));break;case"getnetworkinfo":if(currentNode._id!=e.nodeid)return;if(updateDeviceDetails(getNodeFromId(e.nodeid),null,e),2==xxdialogMode&&xxdialogTag=="if"+e.nodeid){var t="<div class=dialogText>";if(currentNode.lastconnect&&(t+=addHtmlValue2("Poslední připojení agenta",printDateTime(new Date(currentNode.lastconnect)))),currentNode.lastaddr&&(2<(u=currentNode.lastaddr.split(":")).length?t+=addHtmlValue2("Poslední adresa agenta",currentNode.lastaddr+' <img src="images/link4.png" title="Kopírovat adresu do schránky" style="cursor:pointer" onclick=copyTextToClip2("'+encodeURIComponentEx(currentNode.lastaddr)+'") width=10 height=10>'):isPrivateIP(currentNode.lastaddr)?t+=addHtmlValue2("Poslední adresa agenta",u[0]+' <img src="images/link4.png" title="Kopírovat adresu do schránky" style="cursor:pointer" onclick=copyTextToClip2("'+encodeURIComponentEx(u[0])+'") width=10 height=10>'):t+=addHtmlValue2("Poslední adresa agenta",'<a href="https://iplocation.com/?ip='+u[0]+'" rel="noreferrer noopener" target="MeshIPLoopup">'+u[0]+'</a> <img src="images/link4.png" title="Kopírovat adresu do schránky" style="cursor:pointer" onclick=copyTextToClip2("'+encodeURIComponentEx(u[0])+'") width=10 height=10>')),null!=e.updateTime&&(t+=addHtmlValue2("Poslední změna rozhraní",printDateTime(new Date(e.updateTime)))),null!=e.netif)for(var r in e.netif)t+="<hr />",(g=e.netif[r]).name&&(t+=addHtmlValue2("Název","<b>"+EscapeHtml(g.name)+"</b>")),g.desc&&(t+=addHtmlValue2("Popis",EscapeHtml(g.desc).replace("(R)","&reg;").replace("(r)","&reg;"))),g.dnssuffix&&(t+=addHtmlValue2("DNS přípona",EscapeHtml(g.dnssuffix)+' <img src="images/link4.png" title="Zkopírovat jméno do schránky" style="cursor:pointer" onclick=copyTextToClip2("'+encodeURIComponentEx(g.dnssuffix)+'") width=10 height=10>')),g.mac&&(t+=addHtmlValue2("MAC adresa",'<a href="https://maclookup.app/search/result?mac='+g.mac.substring(0,6)+'" rel="noreferrer noopener" target="MeshMACLoopup">'+EscapeHtml(g.mac.toLowerCase())+'</a> <img src="images/link4.png" title="Kopírovat MAC adresu do schránky" style="cursor:pointer" onclick=copyTextToClip2("'+encodeURIComponentEx(g.mac.toLowerCase())+'") width=10 height=10>')),g.v4addr&&(t+=addHtmlValue2("IPv4 adresa",EscapeHtml(g.v4addr)+' <img src="images/link4.png" title="Kopírovat adresu do schránky" style="cursor:pointer" onclick=copyTextToClip2("'+encodeURIComponentEx(g.v4addr)+'") width=10 height=10>')),g.v4mask&&(t+=addHtmlValue2("IPv4 maska",EscapeHtml(g.v4mask)+' <img src="images/link4.png" title="Kopírovat adresu do schránky" style="cursor:pointer" onclick=copyTextToClip2("'+encodeURIComponentEx(g.v4mask)+'") width=10 height=10>')),g.v4gateway&&(t+=addHtmlValue2("IPv4 brána",EscapeHtml(g.v4gateway)+' <img src="images/link4.png" title="Kopírovat adresu do schránky" style="cursor:pointer" onclick=copyTextToClip2("'+encodeURIComponentEx(g.v4gateway)+'") width=10 height=10>')),g.gatewaymac&&(t+=addHtmlValue2("MAC adresa brány",'<a href="https://maclookup.app/search/result?mac='+g.gatewaymac.substring(0,6)+'" rel="noreferrer noopener" target="MeshMACLoopup">'+EscapeHtml(g.gatewaymac.toLowerCase())+'</a> <img src="images/link4.png" title="Kopírovat MAC adresu do schránky" style="cursor:pointer" onclick=copyTextToClip2("'+encodeURIComponentEx(g.gatewaymac.toLowerCase())+'") width=10 height=10>'));else if(null!=e.netif2)for(var r in e.netif2){var g=e.netif2[r];if(!(0==Array.isArray(g)||g.length<1||null==g[0]||"string"==typeof g[0].mac&&g[0].mac.startsWith("00:00:00:00"))){t=(t+="<hr />")+addHtmlValue2("Název","<b>"+EscapeHtml(r)+"</b>"),"string"==typeof g[0].mac&&(t+=addHtmlValue2("MAC adresa",'<a href="https://maclookup.app/search/result?mac='+g[0].mac.split(":").join("").substring(0,6)+'" rel="noreferrer noopener" target="MeshMACLoopup">'+EscapeHtml(g[0].mac.toLowerCase())+'</a> <img src="images/link4.png" title="Kopírovat MAC adresu do schránky" style="cursor:pointer" onclick=copyTextToClip2("'+encodeURIComponentEx(g[0].mac.toLowerCase())+'") width=10 height=10>')),g[0].fqdn&&(t+=addHtmlValue2("FQDN",g[0].fqdn));for(var h=0;h<g.length;h++){var f=g[h];"IPv6"==f.family?(f.address&&(t+=addHtmlValue2("IPv6 adresa",EscapeHtml(f.address)+' <img src="images/link4.png" title="Kopírovat adresu do schránky" style="cursor:pointer" onclick=copyTextToClip2("'+encodeURIComponentEx(f.address)+'") width=10 height=10>')),f.netmask&&(t+=addHtmlValue2("Maska IPv6",EscapeHtml(f.netmask)+' <img src="images/link4.png" title="Kopírovat adresu do schránky" style="cursor:pointer" onclick=copyTextToClip2("'+encodeURIComponentEx(f.netmask)+'") width=10 height=10>')),f.gateway&&(t+=addHtmlValue2("Brána IPv6",EscapeHtml(f.gateway)+' <img src="images/link4.png" title="Kopírovat adresu do schránky" style="cursor:pointer" onclick=copyTextToClip2("'+encodeURIComponentEx(f.gateway)+'") width=10 height=10>'))):"IPv4"==f.family&&(f.address&&(t+=addHtmlValue2("IPv4 adresa",EscapeHtml(f.address)+' <img src="images/link4.png" title="Kopírovat adresu do schránky" style="cursor:pointer" onclick=copyTextToClip2("'+encodeURIComponentEx(f.address)+'") width=10 height=10>')),f.netmask&&(t+=addHtmlValue2("IPv4 maska",EscapeHtml(f.netmask)+' <img src="images/link4.png" title="Kopírovat adresu do schránky" style="cursor:pointer" onclick=copyTextToClip2("'+encodeURIComponentEx(f.netmask)+'") width=10 height=10>')),f.gateway)&&(t+=addHtmlValue2("IPv4 brána",EscapeHtml(f.gateway)+' <img src="images/link4.png" title="Kopírovat adresu do schránky" style="cursor:pointer" onclick=copyTextToClip2("'+encodeURIComponentEx(f.gateway)+'") width=10 height=10>'))}}}else t+="<hr />Nejsou k dispozici žádné informace o síťovém rozhraní tohoto zařízení.";t+="</div>",QH("d2netinfo",t)}break;case"serverversion":2==xxdialogMode&&"MeshCentralServerUpdate"==xxdialogTag&&(t="<div class=dialogText>",e.tags.current||(e.tags.current="Neznámé"),e.tags.stable||(e.tags.stable="Neznámé"),e.tags.latest||(e.tags.latest="Neznámé"),t=(t=(t=t+addHtmlValue2("Nainstalovaná verze","<b>"+EscapeHtml(e.tags.current)+"</b>")+"<hr />")+addHtmlValue2("<label><input id=d2updateCheck1 type=checkbox onclick=server_showVersionDlgUpdate()"+("Neznámé"==e.tags.stable||e.tags.current==e.tags.stable||0==(2048&features)?" disabled":"")+" /> Stabilní verze</label>","<b>"+EscapeHtml(e.tags.stable)+"</b>"))+addHtmlValue2("<label><input id=d2updateCheck2 type=checkbox onclick=server_showVersionDlgUpdate()"+("Neznámé"==e.tags.latest||e.tags.current==e.tags.latest||0==(2048&features)?" disabled":"")+" /> Nejnovější vydaná verze</label>","<b>"+EscapeHtml(e.tags.latest)+"</b>")+"</div>",e.tags.current==e.tags.latest&&e.tags.current==e.tags.stable||0==(2048&features)?setDialogMode(2,"Verze MeshCentral",1,null,t):(setDialogMode(2,"Verze MeshCentral",3,server_showVersionDlgEx,t+="<hr />Pro zahájení aktualizace serveru zaškrtněte a klikněte na OK. ",e.tags),server_showVersionDlgUpdate()));break;case"servererrors":2==xxdialogMode&&"MeshCentralServerErrors"==xxdialogTag&&(null==e.data?setDialogMode(2,"Server Errors",1,null,"Zatím na serveru nebyly zaznamenány žádné chyby."):(setDialogMode(2,"Chyby na MeshCentral serveru",3,server_showErrorsDlgEx,t=(t='<div class="dialogText dialogTextLog"><pre id=d2ServerErrorsLogPre>'+EscapeHtml(e.data)+"</pre></div>")+'<br /><div style=float:right><img src=images/link4.png height=10 width=10 title="Stáhnout záznam chyb" style=cursor:pointer onclick=d2CopyServerErrorsToClip()></div>'+"<div><label><input id=d2clearErrorsCheck type=checkbox onclick=server_showErrorsDlgUpdate() /> Pro vymazání záznamu chyb zaškrtněte a klikněte na OK.</label></div>"),server_showErrorsDlgUpdate()));break;case"serverconfig":2==xxdialogMode&&"MeshCentralServerConfig"==xxdialogTag&&(null==e.data?setDialogMode(2,"Server Configuration",1,null,"Server has no config file."):(setDialogMode(4,"Server Configuration",2),QV("d4EncodingButton",!1),QV("d4LineBreakButton",!1),QS("dialog").width="auto",QS("dialog").bottom="80px",QS("dialog").top=QS("dialog").left=QS("dialog").right="100px",Q("d4editorarea").value=e.data,Q("d4editorarea").setAttribute("readonly","readonly")));break;case"serverconsole":p15consoleReceive("serverconsole",e.value);break;case"events":null!=e.nodeid&&null!=currentNode&&e.nodeid==currentNode._id?(currentDeviceEvents=e.events,mainUpdate(1024)):null!=e.userid&&null!=currentUser&&e.userid==currentUser._id?(currentUserEvents=e.events,mainUpdate(2048)):(events=e.events,mainUpdate(32));break;case"recordings":p52recordings=e.events,null!=e.error&&(p52recordings=e.error),updateRecordings();break;case"getcookie":"MCRouter"==e.tag?(-1!=(A=serverinfo.name).indexOf(".")&&0==(2&features)||(A=window.location.hostname),domainUrl.substring(0,domainUrl.length-1),I="mcrouter://"+A+(443==serverinfo.port?"":":"+serverinfo.port)+domainUrl+"control.ashx?c="+authCookie+"&t="+serverinfo.tlshash+"&l={{{lang}}}"+(urlargs.key?"&key="+urlargs.key:""),null!=e.nodeid&&(I+="&nodeid="+e.nodeid),null!=e.tcpport&&(I+="&protocol=1&remoteport="+e.tcpport),e.localRelay&&(I+="&local=1"),e.localport&&(I+="&localport="+e.localport),null!=e.name&&(I+="&name="+encodeURIComponentEx(e.name)),null!=e.ip&&(I+="&remoteip="+e.ip),downloadFile(I+="&appid="+e.protocol+"&autoexit=1","")):"novnc"==e.tag?(c=window.location.origin+domainUrl+"novnc/vnc.html?ws=wss%3A%2F%2F"+window.location.host+encodeURIComponentEx(domainUrl)+(e.localRelay?"local":"mesh")+"relay.ashx%3Fauth%3D"+e.cookie+"&show_dot=1"+(urlargs.key?"&key="+urlargs.key:"")+"&l={{{lang}}}",null!=(T=getNodeFromId(e.nodeid))&&(c+="&name="+encodeURIComponentEx(T.name)),safeNewWindow(c,"mcnovnc/"+e.nodeid)):"mstsc"==e.tag?(p=window.location.origin+domainUrl+"mstsc.html?ws="+e.cookie+(urlargs.key?"&key="+urlargs.key:""),null!=(T=getNodeFromId(e.nodeid))&&(p+="&name="+encodeURIComponentEx(T.name)),e.localRelay&&(p+="&local=1"),safeNewWindow(p,"mcmstsc/"+e.nodeid)):"ssh"==e.tag&&(u=window.location.origin+domainUrl+"ssh.html?ws="+e.cookie+(urlargs.key?"&key="+urlargs.key:""),null!=(T=getNodeFromId(e.nodeid))&&(u+="&name="+encodeURIComponentEx(T.name)),e.localRelay&&(u+="&local=1"),safeNewWindow(u,"mcssh/"+e.nodeid));break;case"getNotes":(l=Q("d2devNotes"))&&e.id==decodeURIComponent(l.attributes.noteid.value)?(e.notes?QH("d2devNotes",decodeURIComponent(e.notes)):QH("d2devNotes",""),0==("true"==l.attributes.ro.value)&&(l.removeAttribute("readonly"),QE("idx_dlgOkButton",!0),QV("idx_dlgOkButton",!0),focusTextBox("d2devNotes"))):(Q("notesPanelArea").innerHTML=e.notes&&marked&&DOMPurify?DOMPurify.sanitize(marked.parse(decodeURIComponent(e.notes),{breaks:!0}),{USE_PROFILES:{html:!0}}):"","true"===showNotesPanel&&e.notes?QV("notesPanel",!0):QV("notesPanel",!1));break;case"otpauth-request":2==xxdialogMode&&"otpauth-request"==xxdialogTag&&(null!=e.err?(c=["","2FA je uzamčena","Záložní kódy jsou uzamčeny","Používá se přihlašovací token","OTP 2FA není povoleno","Účet je uzamčen","Nelze načíst OTPLIB"],0<e.err&&e.err<c.length?QH("d2optinfo",c[e.err]):QH("d2optinfo",format("Chyba č. {0}",e.err))):(52==(p=e.secret).length?p=p.split(/(.............)/).filter(Boolean).join(" "):32==p.length&&(p=(p=p.split(/(....)/).filter(Boolean).join(" ")).substring(0,20)+"<br/>"+p.substring(20)),QH("d2optinfo","<table style=width:380px><tr><td style=vertical-align:top>"+format('Instalace <a href="https://play.google.com/store/apps/details?id=com.google.android.apps.authenticator2" rel="noreferrer noopener" target=_blank>Google Authenticator</a> nebo kompatibilní aplikaci a naskenujte kód, použijte <a href="{0}" rel="noreferrer noopener" target=_blank> tento odkaz</a> nebo vložte tajemství. Pak vložte aktuální 6 číselný token pro aktivaci 2-faktorového přihlašování.',e.url)+'<br /><br />Secret <img src=images/link4.png height=10 width=10 title="Copy Secret to clipboard" style=cursor:pointer onclick=d2CopySecretToClip()><br /><tt id=d2optsecret secret="'+e.secret+'" style=font-size:12px>'+p+'</tt><br /><br /></td><td style=width:1px;vertical-align:top><a href="'+e.url+'" rel="noreferrer noopener" target=_blank><div id="qrcode"></div></a></td><tr><td colspan=2 style="text-align:center;border-top:1px solid black"><br />Zadejte token pro 2-faktorové přihlášení: <input type=text autocomplete="one-time-code" inputmode="numeric" pattern="[0-9]*" onkeypress="return (event.keyCode == 8) || (event.charCode >= 48 && event.charCode <= 57)" onkeyup=account_addOtpCheck(event) onkeydown=account_addOtpCheck() maxlength=6 id=d2otpauthinput type=text></td></table>'),new QRCode(Q("qrcode"),{text:e.url,width:128,height:128,colorDark:"#000000",colorLight:"#EEE",correctLevel:QRCode.CorrectLevel.H}),QV("idx_dlgOkButton",!0),QE("idx_dlgOkButton",!1),Q("d2otpauthinput").focus()));break;case"otpauth-setup":if(xxdialogMode)return;setDialogMode(2,"Aplikace pro ověřování se",1,null,e.success?"<b style=color:green>Aktivace aplikace pro ověřování se úspěšná.</b> Budete potřebovat platný token k novému přihlášení.":"<b style=color:red>aktivace 2-faktorového přihlašování se nezdařila.</b> Vymažte tajemství z aplikace a zkuste to znovu. Na zadání správného kódu máte jen několik minut.");break;case"otpauth-clear":if(xxdialogMode)return;setDialogMode(2,"Aplikace pro ověřování se",1,null,e.success?"<b>Aplikace pro ověřování se odstraněna.</b> Tuto funkci můžete kdykoli znovu aktivovat.":"<b style=color:red>odstranění 2-faktorového přihlašování se nezdařilo.</b> Zkusit znovu.");break;case"otpauth-getpasswords":if(xxdialogMode)return;t="Jednorázové tokeny lze použít jako sekundární ověřování. Vytvořte sadu, vytiskněte je a uložte na bezpečném místě.";if(t+='<div style="border-radius:6px;border: 2px dashed #888;width:100%;margin-top:8px"><div style="padding:8px;font-family:Arial, Helvetica, sans-serif;font-size:20px;font-weight:bold"><table class=selecttext style=width:100%;text-align:center>',e.passwords){var h=0,k="";for(r in e.passwords){++h%2&&(t+="<tr>");for(var y=""+e.passwords[r].p;y.length<8;)y="0"+y;!0===e.passwords[r].u?(t+="<td>"+y.substring(0,4)+"&nbsp;"+y.substring(4),""!=k&&(k+=" "),k+=y):t+="<td><strike style=color:#BBB>"+y.substring(0,4)+"&nbsp;"+y.substring(4)}}else t+="<tr><td>Žádné aktivní tokeny";t=(t+="</table></div></div><br />")+"<div><input type=button value=Zavřít onclick=setDialogMode(0) style=float:right></input>"+'<input type=button value="Vytvořit nové tokeny" onclick="account_manageOtp(1);"></input>',null!=e.passwords&&(t=(t+='<input type=button value="Vymazat tokeny" onclick="account_manageOtp(2);"></input>')+'&nbsp;<img src=images/link4.png height=10 width=10 title="Kopírovat platné kódy do schránky" style=cursor:pointer onclick=copyTextToClip2("'+encodeURIComponentEx(k)+'")>'),setDialogMode(2,"Spravovat záložní kódy",8,null,t+="</div><br />","otpauth-manage");break;case"otp-hkey-get":if(xxdialogMode&&"otpauth-hardware-manage"!=xxdialogTag)return;var O='<div style="border-radius:6px;border:2px solid #CCC;background-color:#BBB;width:100%;box-sizing:border-box;margin-bottom:6px"><div style="margin:3px;font-family:Arial, Helvetica, sans-serif;font-size:16px;font-weight:bold"><table style=width:100%;text-align:left>',F="</table></div></div>",t='<a href="https://www.yubico.com/" rel="noreferrer noopener" target="_blank">Hardwarové klíče</a> jsou použity jako druhý faktor ověřování.';if(t+='<div style="max-height:150px;overflow-y:auto;overflow-x:hidden;margin-top:6px;margin-bottom:6px">',e.keys&&0<e.keys.length)for(var r in e.keys){var B=e.keys[r];t+=O+'<tr style=margin:5px><td style=width:30px><img width=24 height=18 src="images/hardware-key-'+(U=2==B.type?"OTP":"WebAuthn")+'-24.png" style=margin-top:4px><td style=width:250px>'+B.name+'<td><input type=button value="Odstranit" onclick=account_removehkey('+B.i+")></input>"+F}else t+=O+"<tr style=text-align:center><td>Není nastaven žádný klíč"+F;t=t+"</div>"+'<div><input type=button value="Zavřít" onclick=setDialogMode(0) style=float:right></input>';u="number"==typeof userinfo.otphkeys?userinfo.otphkeys:0;"number"!=typeof serverinfo.maxfidokeys||serverinfo.maxfidokeys>u?(0!=(131072&features)&&(t+='<input id=d2addkey3 type=button value="Přidat klíč" onclick="account_addhkey(3);"></input>'),0!=(16384&features)&&(t+='<input id=d2addkey2 type=button value="Přidat YubiKey&reg; OTP" onclick="account_addhkey(2);"></input>')):t+="Bylo dosaženo maximálního počtu klíčů.",setDialogMode(2,"Spravovat klíče zabezpečení",8,null,t+="</div><br />","otpauth-hardware-manage"),0==u2fSupported()&&QE("d2addkey1",!1);break;case"otp-hkey-yubikey-add":e.result?meshserver.send({action:"otp-hkey-get"}):setDialogMode(2,"Přidat bezpečnostní klíč",1,null,"<br />Chyba, klíč nelze přidat.<br /><br />");break;case"otp-hkey-setup-response":if(xxdialogMode&&"otpauth-hardware-manage"!=xxdialogTag)return;1==e.result?meshserver.send({action:"otp-hkey-get"}):setDialogMode(2,"Přidat bezpečnostní klíč",1,null,"<br />CHYBA: klíč nelze přidat.<br /><br />","otpauth-hardware-manage");break;case"webauthn-startregister":if(xxdialogMode&&"otpauth-hardware-manage"!=xxdialogTag)return;setDialogMode(2,"Přidat bezpečnostní klíč",2,null,t='Stiskněte klávesu.<br /><br /><div style=width:100%;text-align:center><img width=120 height=117 src="images/hardware-keypress-120.png" /></div><input id=dp1keyname style=display:none value='+e.name+" />");c=e.request;e.request.challenge=Uint8Array.from(atob(e.request.challenge),function(e){return e.charCodeAt(0)}),e.request.user.id=Uint8Array.from(atob(e.request.user.id),function(e){return e.charCodeAt(0)}),navigator.credentials.create({publicKey:c}).then(function(e){meshserver.send({action:"webauthn-endregister",response:{rawId:btoa(String.fromCharCode.apply(null,new Uint8Array(e.rawId))),response:{attestationObject:btoa(String.fromCharCode.apply(null,new Uint8Array(e.response.attestationObject))),clientDataJSON:btoa(String.fromCharCode.apply(null,new Uint8Array(e.response.clientDataJSON)))},type:e.type}}),setDialogMode(0)},function(e){console.log("CHYBA: "+e),setDialogMode(2,"Přidat bezpečnostní klíč",1,null,"CHYBA: "+e)});break;case"verifyPhone":if(xxdialogMode&&"verifyPhone"!=xxdialogTag)return;setDialogMode(2,"Telefonní oznámení",3,account_managePhoneConfirm,t=(t='<table><tr><td><img src="images/phone80.png" style=padding:8px>')+"<td>Zkontrolujte telefon a zadejte ověřovací kód."+'<br /><br /><div style=width:100%;text-align:center>Ověřovací kód: <input type=tel pattern="[0-9]" inputmode="number" maxlength=6 id=d2phoneCodeInput onKeyUp=account_managePhoneCodeValidate() onkeypress="if (event.key==\'Enter\') account_managePhoneCodeValidate(1)"></div></table>',e.cookie),Q("d2phoneCodeInput").focus(),account_managePhoneCodeValidate();break;case"verifyMessaging":if(xxdialogMode&&"verifyMessaging"!=xxdialogTag)return;setDialogMode(2,"Messaging Notifications",3,account_manageMessagingConfirm,t=(t='<table><tr><td><img src="images/messaging40.png" style=padding:8px>')+"<td>Check your messaging application and enter the verification code."+'<br /><br /><div style=width:100%;text-align:center>Ověřovací kód: <input type=tel pattern="[0-9]" inputmode="number" maxlength=6 id=d2phoneCodeInput onKeyUp=account_managePhoneCodeValidate() onkeypress="if (event.key==\'Enter\') account_managePhoneCodeValidate(1)"></div></table>',e.cookie),Q("d2phoneCodeInput").focus(),account_managePhoneCodeValidate();break;case"fileoperation":setDialogMode(4,EscapeHtml(e.file),3,function(e,t){var n=Q("d4editorarea").value,n=0===d4EditLineBreakVal?n.replace(/\r?\n|\r/g,"\r\n"):2===d4EditLineBreakVal?n.replace(/\r\n|\n/g,"\r"):n.replace(/\r\n|\r/g,"\n"),n=1==d4EditEncodingVal?encode_utf8(n):n;meshserver.send({action:"fileoperation",fileop:"set",path:t.path,file:t.file,data:btoa(n)})},null,e),QV("d4EncodingButton",!0),QV("d4LineBreakButton",!0),QS("dialog").width="auto",QS("dialog").bottom="80px",QS("dialog").top=QS("dialog").left=QS("dialog").right="100px",Q("d4editorarea").value=1==d4EditEncodingVal?decode_utf8(atob(e.data)):atob(e.data);break;case"event":if(!e.event.nolog){if(currentNode&&e.event.nodeid==currentNode._id&&null!=currentDeviceEvents&&(e.event.action==p16filterevents.value||""==p16filterevents.value)){if(null!=currentDeviceEvents){currentDeviceEvents.unshift(e.event);for(var x=parseInt(p16limitdropdown.value);currentDeviceEvents.length>x;)currentDeviceEvents.pop()}mainUpdate(1024)}if(currentUser&&e.event.userid==currentUser._id&&(e.event.action==p31filterevents.value||""==p31filterevents.value)){if(null!=currentUserEvents){currentUserEvents.unshift(e.event);for(x=parseInt(p31limitdropdown.value);currentUserEvents.length>x;)currentUserEvents.pop()}mainUpdate(2048)}if(e.event.action==p3filterevents.value||""==p3filterevents.value){if(null!=events){events.unshift(e.event);for(x=parseInt(p3limitdropdown.value);events.length>x;)events.pop()}mainUpdate(32)}}if(!e.event.noact)switch(e.event.action){case"serverinfochange":null!=e.event.lock2factor&&(serverinfo.lock2factor=e.event.lock2factor,updateSelf(),updateSiteAdmin());break;case"deviceShareUpdate":e.event.nodeid==deviceSharesReq&&(deviceSharesNode=e.event.nodeid,deviceShares=e.event.deviceShares,currentNode._id==deviceSharesNode)&&gotoDevice(currentNode._id,xxcurrentView,!0);break;case"agentlog":98==e.event.msgid&&0<GetNodeRights(e.event.nodeid)&&(l=getNodeFromId(e.event.nodeid),addNotification({text:format("Žádost o pomoc od uživatele {0}: {1}",e.event.msgArgs[0],e.event.msgArgs[1]),title:l.name,icon:l.icon,nodeid:e.event.nodeid}));break;case"recording":null!=p52recordings&&"object"==typeof p52recordings&&(p52recordings.unshift(e.event),e.event.present=1,updateRecordings());break;case"userWebState":try{if(null!=localStorage){var b=localStorage.getItem("showRealNames"),w=localStorage.getItem("uiMode"),L=localStorage.getItem("sort"),S=localStorage.getItem("loctag"),K=localStorage.getItem("nightMode"),G=localStorage.getItem("footerBar"),D=JSON.parse(e.event.state);for(r in D)localStorage.setItem(r,D[r]);if(null!=D.showRealNames&&D.showRealNames!=b&&(showRealNames=Q("RealNameCheckBox").checked="1"==D.showRealNames,mainUpdate(6)),null!=D.uiMode&&D.uiMode!=w&&userInterfaceSelectMenu(parseInt(D.uiMode)),null!=D.sort&&D.sort!=L&&(document.getElementById("sortselect").selectedIndex=sort=parseInt(D.sort),mainUpdate(6)),null!=D.loctag&&D.loctag!=S&&(null!=D.loctag?args.locale=D.loctag:delete args.locale,mainUpdate(4294967295)),null!=D.nightMode&&D.nightMode!=K&&(putstore("nightMode",D.nightMode),setNightMode()),null!=D.footerBar&&D.footerBar!=G&&(footerBar="1"==D.footerBar,QS("container")["grid-template-rows"]=null,QS("container")["-ms-grid-rows"]=null,adjustPanels()),null!=D.stars&&D.stars!=JSON.stringify(stars)&&(stars=JSON.parse(D.stars),3==Q("DevFilterSelect").value?mainUpdate(5):mainUpdate(4),currentNode)&&refreshDevice(currentNode._id),null!=D.deskKeyShortcuts){deskKeyboardShortcuts=[];var W=D.deskKeyShortcuts.split(",");for(r in W)""!=W[r]&&deskKeyboardShortcuts.push(parseInt(W[r]));updateDeskShortcutKeys()}if(null!=D.deskStrings){o=null;try{o=JSON.parse(D.deskStrings)}catch(e){}Array.isArray(o)&&(deskKeyboardStrings=o,updateDesktopStrings())}}}catch(e){}break;case"servertimelinestats":addServerTimelineStats(e.event.data);break;case"accountcreate":case"accountchange":if("object"!=typeof e.event.account||null==e.event.account)return void console.log(e.event);userinfo._id==e.event.account._id&&(b=e.event.account.siteadmin||0,w=userinfo.siteadmin||0,L=e.event.account.removeRights||0,S=userinfo.removeRights||0,(e.event.account.quota!=userinfo.quota||0==(8&userinfo.siteadmin)&&0!=(8&e.event.account.siteadmin))&&meshserver.send({action:"files"}),K=userinfo.groups,userinfo=e.event.account,w==b&&S==L&&1!=e.event.accountImageChange||(1==e.event.accountImageChange&&(userinfo.accountImageRnd=Math.floor(9999999999*Math.random())),updateSiteAdmin()),updateSelf(),0!=(2&userinfo.siteadmin)&&(G=userinfo.groups||[],(K||[]).join(",")!=G.join(","))&&(users=wssessions=null,meshserver.send({action:"users"}),meshserver.send({action:"wssessioncount"})),e.event.nodeListChange==userinfo._id)&&meshserver.send({action:"nodes",skip:null==devicePagingState?0:devicePagingState.skip}),currentNode&&refreshDevice(currentNode._id),null!=users&&(null==userinfo.groups||0==userinfo.groups.length||1==findOne(e.event.account.groups,userinfo.groups)?users[e.event.account._id]=e.event.account:delete users[e.event.account._id],mainUpdate(16388));break;case"accountremove":null!=users&&(delete users[e.event.userid],mainUpdate(16384));break;case"createusergroup":case"usergroupchange":w=(usergroups=null==usergroups?{}:usergroups)[e.event.ugrpid];null==w?usergroups[e.event.ugrpid]={_id:e.event.ugrpid,name:e.event.name,desc:e.event.desc,domain:e.event.domain,links:e.event.links}:(w.name=e.event.name,e.event.desc?w.desc=e.event.desc:delete w.desc,e.event.links?w.links=e.event.links:delete w.links,e.event.flags?w.flags=e.event.flags:delete w.flags,"number"==typeof e.event.consent&&(w.consent=e.event.consent)),mainUpdate(28672),meshserver.send({action:"meshes"}),meshserver.send({action:"nodes",skip:null==devicePagingState?0:devicePagingState.skip});break;case"deleteusergroup":if(null!=usergroups&&null!=usergroups[e.event.ugrpid]){delete usergroups[e.event.ugrpid];var C=0;for(r in usergroups)C++;0==C&&(usergroups=null),mainUpdate(24576)}break;case"createmesh":null!=meshes[e.event.meshid]||!serverinfo.manageAllDeviceGroups&&null==e.event.mesh.links[userinfo._id]||(meshes[e.event.meshid]=e.event.mesh,mainUpdate(24708),meshserver.send({action:"files"}));break;case"meshchange":if(null==meshes[e.event.meshid]){var M=!1;for(r in null!=e.event.links[userinfo._id]&&(M=!0),null!=userinfo.links[e.event.meshid]&&(M=!0),userinfo.links)r.startsWith("ugrp/")&&null!=e.event.links[r]&&(M=!0);M&&(meshes[e.event.meshid]={_id:e.event.meshid,name:e.event.name,mtype:e.event.mtype,desc:e.event.desc,links:e.event.links,amt:e.event.amt,invite:e.event.invite,expireDevs:e.event.expireDevs,relayid:e.event.relayid},meshserver.send({action:"nodes",skip:null==devicePagingState?0:devicePagingState.skip}))}else{if(null!=e.event.name)for(var r in meshes[e.event.meshid].name=e.event.name,nodes)nodes[r].meshid==e.event.meshid&&(nodes[r].meshnamel=e.event.name.toLowerCase());if(null!=e.event.desc&&(meshes[e.event.meshid].desc=e.event.desc),null!=e.event.flags&&(meshes[e.event.meshid].flags=e.event.flags),null!=e.event.consent&&(meshes[e.event.meshid].consent=e.event.consent),e.event.links&&(meshes[e.event.meshid].links=e.event.links),e.event.amt&&(meshes[e.event.meshid].amt=e.event.amt),null!=e.event.invite?meshes[e.event.meshid].invite=e.event.invite:delete meshes[e.event.meshid].invite,null!=e.event.expireDevs&&(0<e.event.expireDevs?meshes[e.event.meshid].expireDevs=e.event.expireDevs:delete meshes[e.event.meshid].expireDevs),null!=e.event.relayid&&(meshes[e.event.meshid].relayid=e.event.relayid),0==IsMeshViewable(e.event.meshid)){20==xxcurrentView&&currentMesh==meshes[e.event.meshid]&&go(2),delete meshes[e.event.meshid];var z=[];for(r in nodes)(nodes[r].meshid!=e.event.meshid||null!=userinfo.links&&null!=userinfo.links[nodes[r]._id])&&z.push(nodes[r]);nodes=z,10<=xxcurrentView&&xxcurrentView<20&&currentNode&&!IsNodeViewable(currentNode)&&(setDialogMode(0),go(1))}}mainUpdate(24708),currentNode&&!IsNodeViewable(currentNode)&&(currentNode=null,10<=xxcurrentView)&&xxcurrentView<20&&go(1),20==xxcurrentView&&currentMesh._id==e.event.meshid&&mainUpdate(4096);break;case"deletemesh":meshes[e.event.meshid]&&(delete meshes[e.event.meshid],mainUpdate(128),meshserver.send({action:"files"}));z=[];if(null!=nodes)for(var r in nodes)nodes[r].meshid!=e.event.meshid&&z.push(nodes[r]);nodes=z,mainUpdate(24580),20<=xxcurrentView&&xxcurrentView<30&&currentMesh._id==e.event.meshid&&(setDialogMode(0),go(2)),10<=xxcurrentView&&xxcurrentView<20&&currentNode&&!IsNodeViewable(currentNode)&&(setDialogMode(0),go(1));break;case"addnode":var T=e.event.node;meshes[T.meshid]&&null==getNodeFromId(T._id)&&(T.namel=T.name.toLowerCase(),T.rname?T.rnamel=T.rname.toLowerCase():T.rnamel=T.namel,T.meshnamel=meshes[T.meshid]?meshes[T.meshid].name.toLowerCase():"*",T.state=0,T.icon||(T.icon=1),T.ident=++nodeShortIdent,nodes.push(T),mainUpdate(23),20==xxcurrentView)&&null!=currentMesh&&currentMesh._id==T.meshid&&mainUpdate(4096);break;case"removenode":d=-1;for(r in nodes)if(nodes[r]._id==e.event.nodeid){d=r;break}-1!=d&&(T=nodes[d],currentNode==T&&(10<=xxcurrentView&&xxcurrentView<20&&(setDialogMode(0),go(1)),currentNode=null),nodes.splice(d,1),mainUpdate(20),20==xxcurrentView)&&null!=currentMesh&&currentMesh._id==T.meshid&&mainUpdate(4096);break;case"changenode":d=-1;for(r in nodes)if(nodes[r]._id==e.event.nodeid){d=r;break}if(-1!=d){if((T=nodes[d]).name=e.event.node.name,T.rname=e.event.node.rname,T.lusers=e.event.node.lusers,T.users=e.event.node.users,T.host=e.event.node.host,T.desc=e.event.node.desc,T.ip=e.event.node.ip,T.osdesc=e.event.node.osdesc,T.publicip=e.event.node.publicip,T.iploc=e.event.node.iploc,T.wifiloc=e.event.node.wifiloc,T.gpsloc=e.event.node.gpsloc,T.tags=e.event.node.tags,T.ssh=e.event.node.ssh,T.rdp=e.event.node.rdp,T.userloc=e.event.node.userloc,T.rdpport=e.event.node.rdpport,T.rfbport=e.event.node.rfbport,T.sshport=e.event.node.sshport,T.httpport=e.event.node.httpport,T.httpsport=e.event.node.httpsport,T.consent=e.event.node.consent,T.pmt=e.event.node.pmt,null!=e.event.node.links?T.links=e.event.node.links:delete T.links,null!=e.event.node.agent&&(null==T.agent&&(T.agent={}),null!=e.event.node.agent.ver&&(T.agent.ver=e.event.node.agent.ver),null!=e.event.node.agent.id&&(T.agent.id=e.event.node.agent.id),null!=e.event.node.agent.caps&&(T.agent.caps=e.event.node.agent.caps),null!=e.event.node.agent.root&&(T.agent.root=e.event.node.agent.root),null!=e.event.node.agent.core?T.agent.core=e.event.node.agent.core:T.agent.core&&delete T.agent.core,T.agent.tag=e.event.node.agent.tag),null!=e.event.node.intelamt&&(null==T.intelamt&&(T.intelamt={}),null!=e.event.node.intelamt.state&&(T.intelamt.state=e.event.node.intelamt.state),null!=e.event.node.intelamt.host&&(T.intelamt.user=e.event.node.intelamt.host),null!=e.event.node.intelamt.user?T.intelamt.user=e.event.node.intelamt.user:delete T.intelamt.user,null!=e.event.node.intelamt.tls&&(T.intelamt.tls=e.event.node.intelamt.tls),null!=e.event.node.intelamt.ver&&(T.intelamt.ver=e.event.node.intelamt.ver),null!=e.event.node.intelamt.tag&&(T.intelamt.tag=e.event.node.intelamt.tag),null!=e.event.node.intelamt.uuid&&(T.intelamt.uuid=e.event.node.intelamt.uuid),null!=e.event.node.intelamt.realm&&(T.intelamt.realm=e.event.node.intelamt.realm),null!=e.event.node.intelamt.flags&&(T.intelamt.flags=e.event.node.intelamt.flags),null!=e.event.node.intelamt.warn?T.intelamt.warn=e.event.node.intelamt.warn:delete T.intelamt.warn),null!=e.event.node.av&&(T.av=e.event.node.av),null!=e.event.node.wsc&&(T.wsc=e.event.node.wsc),null!=e.event.node.volumes&&(T.volumes=e.event.node.volumes),T.namel=T.name.toLowerCase(),T.rname?T.rnamel=T.rname.toLowerCase():T.rnamel=T.namel,e.event.node.icon&&(T.icon=e.event.node.icon),e.event.node.meshid!=T.meshid)if(null!=meshes[e.event.node.meshid]||null!=userinfo.links&&null!=userinfo.links[T._id])T.meshid=e.event.node.meshid,T.meshnamel=meshes[e.event.node.meshid]?meshes[e.event.node.meshid].name.toLowerCase():"*",mainUpdate(7);else{null!=currentNode&&currentNode._id==T._id&&10<=xxcurrentView&&xxcurrentView<20&&!IsNodeViewable(currentNode)&&(currentNode=null,setDialogMode(0),go(1));d=-1;for(r in nodes)if(nodes[r]._id==e.event.nodeid){d=r;break}nodes.splice(d,1),mainUpdate(20)}updateDeviceViewDevice(T),mainUpdate(26),refreshDevice(T._id),20==xxcurrentView&&null!=currentMesh&&currentMesh._id==T.meshid&&mainUpdate(4096),currentNode==T&&null!=xxdialogMode&&"@xxmap"==xxdialogTag&&p10showNodeLocationDialog()}break;case"nodemeshchange":d=-1;for(r in nodes)if(nodes[r]._id==e.event.nodeid){d=r;break}if(-1!=d){T=nodes[d];null!=meshes[e.event.newMeshId]||null!=userinfo.links&&null!=userinfo.links[T._id]?(T.meshid=e.event.newMeshId,T.meshnamel=meshes[e.event.newMeshId]?meshes[e.event.newMeshId].name.toLowerCase():"*",mainUpdate(7)):(null!=currentNode&&currentNode._id==T._id&&10<=xxcurrentView&&xxcurrentView<20&&!IsNodeViewable(currentNode)&&(currentNode=null,setDialogMode(0),go(1)),nodes.splice(d,1),mainUpdate(20)),refreshDevice(e.event.nodeid)}else{T=e.event.node;if(!meshes[T.meshid])break;T.namel=T.name.toLowerCase(),T.rname?T.rnamel=T.rname.toLowerCase():T.rnamel=T.namel,T.meshnamel=meshes[T.meshid]?meshes[T.meshid].name.toLowerCase():"*",T.state=0,T.icon||(T.icon=1),T.ident=++nodeShortIdent,nodes.push(T),mainUpdate(23)}break;case"nodeconnect":var N,d=-1;for(r in nodes)if(nodes[r]._id==e.event.nodeid){d=r;break}-1!=d&&(T=nodes[d],l=getstore("notifications",0),e.event.meshid&&userinfo.links&&userinfo.links[e.event.meshid]&&userinfo.links[e.event.meshid].notify&&(l|=userinfo.links[e.event.meshid].notify),null!=userinfo.notify&&(null!=userinfo.notify[e.event.meshid]&&(l|=userinfo.notify[e.event.meshid]),null!=userinfo.notify[e.event.nodeid])&&(l|=userinfo.notify[e.event.nodeid]),2&l&&(b="Agent připojen",null!=T.agent&&!1===T.agent.root&&(b="Agent spojený s omezenými privilegii"),N={title:T.name,icon:T.icon,nodeid:T._id,id:e.event.id},0==(1&T.conn)&&0!=(1&e.event.conn)&&(N.text=b,addNotification(N)),0==(2&T.conn)&&0!=(2&e.event.conn)&&(N.text="Zjištěno Intel AMT",addNotification(N)),0==(4&T.conn)&&0!=(4&e.event.conn)&&(N.text="Připojeno Intel AMT CIRA",addNotification(N)),0==(16&T.conn))&&0!=(16&e.event.conn)&&(N.text="MQTT připojeno",addNotification(N)),4&l&&(N={title:T.name,icon:T.icon,nodeid:T._id,id:e.event.id},0!=(1&T.conn)&&0==(1&e.event.conn)&&(N.text="Agent odpojen",addNotification(N)),0!=(2&T.conn)&&0==(2&e.event.conn)&&(N.text="Intel AMT nebyl detekován",addNotification(N)),0!=(4&T.conn)&&0==(4&e.event.conn)&&(N.text="Intel AMT CIRA odpojen",addNotification(N)),0!=(16&T.conn))&&0==(16&e.event.conn)&&(N.text="MQTT odpojeno",addNotification(N)),T.conn=e.event.conn,T.pwr=e.event.pwr,T.lastconnect=Date.now(),0==(1&T.conn)&&delete T.sessions,1==(S=Q("DevFilterSelect").value)||5==S?mainUpdate(21):(updateDeviceViewDevice(T),mainUpdate(17)),refreshDevice(T._id),20==xxcurrentView)&&null!=currentMesh&&currentMesh._id==T.meshid&&mainUpdate(4096);break;case"wssessioncount":null!=wssessions&&(0==e.event.count&&wssessions[e.event.userid]?delete wssessions[e.event.userid]:wssessions[e.event.userid]=e.event.count,mainUpdate(16384));break;case"login":null!=users&&users[e.event.userid]&&(users[e.event.userid].login=Math.floor(new Date(e.event.time).getTime()/1e3));break;case"scanamtdevice":if(null==xxdialogMode||!Q("dp1range")||xxdialogTag!="AMTSCAN:"+e.event.range)return;t="";if(null==e.event.results)t="<div style=width:100%;text-align:center;margin-top:12px>Nedaří se skenovat tento rozsah.</div><div style=width:100%;text-align:center;margin-top:12px;color:gray;line-height:1.5>Ukázkové hodnoty rozsahu IP<br />192.168.0.100<br />192.168.1.0/24<br />192.167.0.1-192.168.0.100</div>";else{for(var r in amtScanResults=e.event.results,e.event.results){var E=e.event.results[r],V=E.hostname,V=(20<(V="host"==E.hosttype?capitalizeFirstLetter(V.split(".")[0]):V).length&&(V=V.substring(0,20)+"..."),'<b title="'+EscapeHtml(E.hostname)+'">'+EscapeHtml(V)+"</b> - v"+E.ver);2==E.state?1==E.tls?V+=" s TLS.":V+=" bez TLS.":V+=" not activated.",t+='<div style=width:100%;margin-bottom:2px;background-color:lightgray><div style=padding:4px><div style=display:inline-block;margin-right:5px><input class=DevScanCheckbox name=dp1checkbox tag="'+EscapeHtml(r)+'" type=checkbox onclick=addAmtScanToMeshCheckbox() /></div><div class=j1 style=display:inline-block></div><div style=display:inline-block;margin-left:5px;overflow-x:auto;white-space:nowrap>'+V+"</div></div></div>"}""==t&&(t="<div style=width:100%;text-align:center;margin-top:12px>Skenování nevrátilo žádné výsledky.</div><div style=width:100%;text-align:center;margin-top:12px;color:gray;line-height:1.5>Ukázkové hodnoty rozsahu IP<br />192.168.0.100<br />192.168.1.0/24<br />192.167.0.1-192.168.0.100</div>")}QH("dp1results",t),QE("dp1range",!0),QE("dp1rangebutton",!0),QE("d2scanSelectButton",!0);break;case"notify":l={text:e.event.value,title:e.event.title,icon:e.event.icon,titleid:e.titleid,msgid:e.msgid,args:e.args};null!=e.id&&(l.id=e.id),null!=e.event.tag&&(l.tag=e.event.tag),"number"==typeof e.maxtime&&(l.maxtime=e.maxtime),addNotification(l);break;case"traceinfo":"object"==typeof e.event.traceSources&&(null!=e.event.traceSources&&0<e.event.traceSources.length?(serverTraceSources=e.event.traceSources,QH("p41traceStatus",EscapeHtml(e.event.traceSources.join(", ")))):(serverTraceSources=[],QH("p41traceStatus","Nic")));break;case"sysinfohash":null!=currentNode&&e.event.nodeid==powerTimelineReq&&meshserver.send({action:"getsysinfo",nodeid:e.event.nodeid});break;case"ifchange":null!=currentNode&&currentNode._id==e.event.nodeid&&meshserver.send({action:"getnetworkinfo",nodeid:currentNode._id});break;case"devicesessions":if(null!=(T=getNodeFromId(e.event.nodeid))){if(T.sessions=e.event.sessions,null!=T.sessions){for(var r in T.sessions)0==Object.keys(T.sessions[r]).length&&delete T.sessions[r];0==Object.keys(T.sessions).length&&delete T.sessions}updateDeviceViewDevice(T),null!=currentNode&&currentNode._id==e.event.nodeid&&gotoDevice(currentNode._id,xxcurrentView,!0),xxdialogTag=="SESSIONS-"+e.event.nodeid&&showDeviceSessions(e.event.nodeid,!0),xxdialogTag=="MESSAGES-"+e.event.nodeid&&showDeviceMessages(e.event.nodeid,!0),xxdialogTag=="HELPREQ-"+e.event.nodeid&&showDeviceHelpRequests(e.event.nodeid,!0),2!=Q("DevFilterSelect").value&&6!=Q("DevFilterSelect").value||mainUpdate(1)}break;case"loginTokenChanged":if(e.event.userid!=userinfo._id)return;loginTokens=e.event.loginTokens,mainUpdate(65536);break;case"loginTokenAdded":if(e.event.userid!=userinfo._id)return;(loginTokens=null==loginTokens?[]:loginTokens).push(e.event.newToken),mainUpdate(65536);break;case"stopped":break;case"updatePluginList":installedPluginList=e.event.list,updatePluginList();break;case"pluginStateChange":null!=pluginHandler&&pluginHandler.refreshPluginHandler();break;case"plugin":if(null!=pluginHandler)try{pluginHandler[e.event.plugin][e.event.pluginaction](e)}catch(e){console.log("PluginHandler nemohlo zprávu události: ",e)}}break;case"createInviteLink":var A,I;xxdialogTag==e.meshid&&(-1!=(A=serverinfo.name).indexOf(".")&&0==(2&features)||(A=window.location.hostname),domainUrl.substring(0,domainUrl.length-1),I=1==serverinfo.https?"https://"+A+(443==serverinfo.port?"":":"+serverinfo.port)+domainUrl+"agentinvite?c="+e.cookie+(urlargs.key?"&key="+urlargs.key:""):"http://"+A+(80==serverinfo.port?"":":"+serverinfo.port)+domainUrl+"agentinvite?c="+e.cookie+(urlargs.key?"&key="+urlargs.key:""),Q("agentInvitationLink").href=I,p=format(1==e.expire?"1 hodina":"{0} hodin",e.expire),24==e.expire&&(p="1 den"),168==e.expire&&(p="1 týden"),5040==e.expire&&(p="1 měsíc"),0==e.expire&&(p="Neomezeno"),QH("agentInvitationLink",format("Odkaz na pozvánku ({0})",p)),QV("agentInvitationLinkDiv",!0));break;case"createDeviceShareLink":var U;xxdialogTag||(t="",null!=(T=getNodeFromId(e.nodeid))&&(t=(t=(t+=addHtmlValue("Zařízení",T.name))+addHtmlValue("Jméno hosta",e.guestname))+addHtmlValue("Vstup uživatele",e.viewOnly?"Není povoleno, pouze zobrazit":"Povoleno"),e.start&&e.expire&&(e.recurring?(t+=addHtmlValue("Doba spuštění",printDateTime(new Date(e.start))),e.expire<2?t+=addHtmlValue("Délka trvání",format("{0} minuta",e.expire)):t+=addHtmlValue("Délka trvání",format("{0} minut",e.expire))):t=(t+=addHtmlValue("Doba spuštění",printDateTime(new Date(e.start))))+addHtmlValue("Čas vypršení platnosti",printDateTime(new Date(e.expire)))),1==e.recurring&&(t+=addHtmlValue("Opakující se","Denně")),2==e.recurring&&(t+=addHtmlValue("Opakující se","Týdně")),n=[],7&e.consent&&n.push("Upozornit"),56&e.consent&&n.push("Výzva"),64&e.consent&&n.push("Lišta soukromí"),0==n.length&&n.push("Nic"),t+=addHtmlValue("Souhlas uživatele",n.join(", ")),U="",e.p<=7?U=["","Vzdálené připojení terminálu","Odkaz na vzdálenou plochu","Odkaz na vzdálenou plochu + terminál","Odkaz na vzdálené soubory","Odkaz na vzdálený terminál + soubory","Odkaz na vzdálenou plochu + soubory","Odkaz na vzdálenou plochu + terminál + soubory"][e.p]:8==e.p?U=format("HTTP/{0} link",e.port):16==e.p&&(U=format("HTTPS/{0}",e.port)),setDialogMode(2,"Sdílet zařízení",1,null,t+='<div id=agentInvitationLinkDiv style="text-align:center;font-size:large;margin:16px"><a href="'+e.url+'" id=agentInvitationLink rel="noreferrer noopener" target="_blank" style=cursor:pointer>'+U+'</a> <img src=images/link4.png height=10 width=10 title="Kopírovat odkaz do schránky" style=cursor:pointer onclick=d2CopyInviteToClip()></div></div>')));break;case"getmqttlogin":if(null==currentNode||currentNode._id!=e.nodeid||null!=xxdialogMode)return;t="Pro připojení MQTT pro toto zařízení je možné použít tato nastavení.<br /><br />";delete e.action,delete e.nodeid,setDialogMode(2,"MQTT přihlašovací údaje",1,null,t+="<textarea readonly=readonly style=width:100%;resize:none;height:100px;overflow:auto;font-size:12px readonly>"+JSON.stringify(e)+"</textarea>");break;case"stopped":autoReconnect=!1,QH("p0span",e.msg);break;case"updatePluginList":installedPluginList=e.list,updatePluginList();break;case"pluginVersionsAvailable":null!=pluginHandler&&updatePluginList(e.list);break;case"downgradePluginVersions":var Z='<select id="lastPluginVersion">';e.info.versionList.forEach(function(e){Z+='<option value="'+e.zipball_url+'">'+e.name+"</option>"}),Z+="</select>",setDialogMode(2,"Akce zásuvného modulu",3,pluginActionEx,format("Select the version to downgrade the plugin: {0}",e.info.name)+"<hr />"+Z+"<hr />Mějte na paměti, že návrat ke starší verzi se nedoporučuje. Učiňte tak pouze v případě, že nedávná aktualizace něco pokazila.NaN"+e.info.id+'" />');break;case"serverBackup":"googleDrive"==e.service&&(QV("p2ServerActionsGoogleBackup",0<e.state),QV("p2ServerActionsGoogleBackupCheck",2<e.state),miscState.googleDrive={state:e.state},2==e.state)&&(t='<img style=float:right src="images/googledrive-48.png" /><div>Přejděte na níže uvedenou adresu URL, udělejte přístup a zkopírujte kód tokenu zpět.</div><br />',setDialogMode(2,"Záloha Disku Google",3,server_setupGoogleDriveBackupEx,t=(t+=addHtmlValue("Zapnutí",'<a href="'+e.url+'" rel="noreferrer noopener" target="_blank">Browse to this URL</a>'))+addHtmlValue("Kód","<input id=gdcode onkeyup=server_setupGoogleDriveBackupCheck3() style=width:240px></input>"),"gd2"),Q("gdcode").focus(),QE("idx_dlgOkButton",!1));break;case"pluginError":setDialogMode(2,"Chyba zásuvného modulu",1,null,e.msg);break;case"plugin":if(null!=pluginHandler&&"string"==typeof e.plugin)try{pluginHandler[e.plugin][e.method](P,e)}catch(e){console.log("Error loading plugin handler ("+e+")")}break;case"amtsetupbin":saveAs(new Blob([Uint8Array.from(atob(e.file),function(e){return e.charCodeAt(0)})],{type:"application/octet-stream"}),"setup.bin");break;case"previousLogins":u="previousLogins";if(null!=e.userid&&(u+=":"+e.userid),2==xxdialogMode&&xxdialogTag==u){var t="",C="BBB",_="";if(0==e.events.length)t+="No previous login.";else{for(var r in t+="<div style=max-height:260px;overflow-y:scroll;overflow-x:hidden><table>",e.events)107==(a=e.events[r].m)?(a="Platné přihlášení",C="BBD1BB",_="",null!=e.events[r].tn&&(a=format("Token: {0}",e.events[r].tn),C="88D188")):108==a?(a="Neplatné 2FA",C="DD9DC3",_="x"):109==a?(a="Uzamknutý účet",C="E1BBBB",_="x"):110==a&&(a="Neplatné heslo",C="E1BBBB",_="x"),t+="<tr><td><img src=images/user-32"+_+'.png height=32 width=32 style=float:left srcset="images/user-64'+_+'.png 2x"><td><div style=width:300px;background-color:#'+C+";border-radius:6px;margin-bottom:4px;padding:4px><div>"+printDateTime(new Date(e.events[r].t))+", <b>"+EscapeHtml(a)+"</b></div><div style=font-size:x-small>"+EscapeHtml(e.events[r].a.join(", "))+"</div></div></tr>";t+="</table></div>"}setDialogMode(2,"Předchozí přihlášení",1,null,t)}break;case"getDeviceDetails":saveAs(new Blob([e.data],{type:"application/octet-stream"}),"seznam zařízení."+e.type);break;case"createLoginToken":if(xxdialogMode)return;t="Všimněte si tohoto uživatelského jména a hesla, heslo nelze znovu zobrazit.<br /><br />";t+=addHtmlValue("Název",EscapeHtml(e.name)),0!=e.expire&&(t+=addHtmlValue("Platnost vyprší",EscapeHtml(printDateTime(new Date(e.expire))))),setDialogMode(2,"Vytvořit přihlašovací token",1,null,t=(t+=addHtmlValue("Uživatelské jméno",'<img src="images/link4.png" title="Kopírovat odkaz do schránky" style="margin:9px;cursor:pointer;float:right" onclick=copyTextToClip2("'+encodeURIComponentEx(e.tokenUser)+'") width=10 height=10><div class=selecttext style=width:230px;padding:5px;background-color:orange;border-radius:5px;font-size:15px>'+EscapeHtml(e.tokenUser)+"</div>"))+addHtmlValue("Heslo",'<img src="images/link4.png" title="Kopírovat odkaz do schránky" style="margin:9px;cursor:pointer;float:right" onclick=copyTextToClip2("'+encodeURIComponentEx(e.tokenPass)+'") width=10 height=10><div class=selecttext style=width:230px;padding:5px;background-color:orange;border-radius:5px;font-size:15px>'+EscapeHtml(e.tokenPass)+"</div>"));break;case"loginTokens":loginTokens=e.loginTokens,mainUpdate(65536);break;case"report":renderReport(e.data)}}function gotoStartViewPage(){var e=parseInt("{{viewmode}}");if(-1==xxcurrentView){if(""!="{{currentNode}}".toLowerCase()){if(null==getNodeFromId("{{currentNode}}"))return;gotoDevice("{{currentNode}}",e)}else if(null!=args.gotonode){if(96==args.gotonode.length&&(args.gotonode=btoa(hex2rstr(args.gotonode)).split("+").join("@").split("/").join("$")),null==getNodeFromId("node/"+domain+"/"+args.gotonode))return;gotoDevice("node/"+domain+"/"+args.gotonode,e),goBackStack.push(1)}else if(null!=args.gotodevicename){var t=null;if(null!=nodes)for(var n in nodes)nodes[n].name==args.gotodevicename&&(t=nodes[n]._id);t&&(gotoDevice(t,e),goBackStack.push(1))}else if(null!=args.gotodeviceip){t=null;if(null!=nodes)for(var n in nodes)nodes[n].ip==args.gotodeviceip&&(t=nodes[n]._id);t&&(gotoDevice(t,e),goBackStack.push(1))}else if(null!=args.gotomesh){if(null==meshes["mesh/"+domain+"/"+args.gotomesh])return;gotoMesh("mesh/"+domain+"/"+args.gotomesh),go(e),goBackStack.push(2)}else if(null!=args.gotouser){var o=args.gotouser;if(args.gotouser.indexOf("/")<0&&(o="user/"+domain+"/"+args.gotouser),null==users||null==users[o])return;gotoUser(encodeURIComponentEx(o)),go(e),goBackStack.push(4)}else if(null!=args.gotougrp){o=args.gotougrp;if(args.gotougrp.indexOf("/")<0&&(o="ugrp/"+domain+"/"+args.gotougrp),null==usergroups||null==usergroups[o])return;gotoUserGroup(o),go(e),goBackStack.push(50)}else isNaN(e)?(setDialogMode(0),go(1)):go(e);delete args.gotonode,delete args.gotomesh,delete args.gotouser,delete args.gotougrp}}function onRealNameCheckBox(){putstore("showRealNames",(showRealNames=Q("RealNameCheckBox").checked)?1:0),mainUpdate(7)}function onOnlineCheckBox(e){putstore("devFilterSelect",Q("DevFilterSelect").value),onDeviceSearchChanged(e)}function updateDevicePageState(){var e,t;null==devicePagingState||devicePagingState.total<=devicePagingState.limit?(QV("devViewPageState",!1),QV("devViewPageButton1",!1),QV("devViewPageButton2",!1),QV("devViewPageButton3",!1),QV("devViewPageButton4",!1)):(e=Math.floor((devicePagingState.skip+devicePagingState.limit)/devicePagingState.limit),t=Math.ceil(devicePagingState.total/devicePagingState.limit),QV("devViewPageState",!0),QV("devViewPageButton1",!0),QV("devViewPageButton2",!0),QV("devViewPageButton3",!0),QV("devViewPageButton4",!0),QH("devViewPageState",e+"/"+t))}function onDeviceViewPageChange(e){if(null!=devicePagingState){var t=Math.floor((devicePagingState.skip+devicePagingState.limit)/devicePagingState.limit),n=Math.ceil(devicePagingState.total/devicePagingState.limit);switch(e){case 1:1<t&&meshserver.send({action:"nodes",skip:0});break;case 2:1<t&&meshserver.send({action:"nodes",skip:(t-2)*devicePagingState.limit});break;case 3:t<n&&meshserver.send({action:"nodes",skip:t*devicePagingState.limit});break;case 4:t<n&&meshserver.send({action:"nodes",skip:(n-1)*devicePagingState.limit})}}}function onDeviceViewChange(e){null!=e&&(Q("viewselect").value=e);for(var t=1;t<6;t++)Q("devViewButton"+t).classList.remove("viewSelectorSel");Q("devViewButton"+Q("viewselect").value).classList.add("viewSelectorSel"),putstore("deviceView",Q("viewselect").value),putstore("viewsize",Q("sizeselect").value),mainUpdate(4),setTimeout(function(){mainUpdate(512)},200)}function onDeviceViewSettings(){var e;xxdialogMode||(null==deviceViewSettings&&(deviceViewSettings={}),Array.isArray(deviceViewSettings.devsCols)||(deviceViewSettings.devsCols=["user","ip","conn"]),e="",setDialogMode(2,"Sloupce zobrazení zařízení",3,onDeviceViewSettingsEx,e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e+="<label><input id=d2c8 type=checkbox"+(0<=deviceViewSettings.devsCols.indexOf("agtype")?" checked":"")+">Typ agenta</label><br />")+("<label><input id=d2c9 type=checkbox"+(0<=deviceViewSettings.devsCols.indexOf("agver")?" checked":"")+">Verze agenta</label><br />"))+("<label><input id=d2c6 type=checkbox"+(0<=deviceViewSettings.devsCols.indexOf("desc")?" checked":"")+">Popis zařízení</label><br />"))+("<label><input id=d2c5 type=checkbox"+(0<=deviceViewSettings.devsCols.indexOf("os")?" checked":"")+">Operační systém</label><br />"))+("<label><input id=d2c10 type=checkbox"+(0<=deviceViewSettings.devsCols.indexOf("tags")?" checked":"")+">Štítky</label><br />"))+("<label><input id=d2c11 type=checkbox"+(0<=deviceViewSettings.devsCols.indexOf("windowsav")?" checked":"")+">Windows AV</label><br />"))+("<label><input id=d2c12 type=checkbox"+(0<=deviceViewSettings.devsCols.indexOf("windowsupdate")?" checked":"")+">Windows Update</label><br />"))+("<label><input id=d2c13 type=checkbox"+(0<=deviceViewSettings.devsCols.indexOf("windowsfirewall")?" checked":"")+">Windows Firewall</label><br />"))+("<label><input id=d2c14 type=checkbox"+(0<=deviceViewSettings.devsCols.indexOf("lastbootuptime")?" checked":"")+">Last Boot Up Time</label><br />"))+("<label><input id=d2c1 type=checkbox"+(0<=deviceViewSettings.devsCols.indexOf("links")?" checked":"")+">Odkazy na MeshCentral Router</label><br />"))+("<label><input id=d2c2 type=checkbox"+(0<=deviceViewSettings.devsCols.indexOf("user")?" checked":"")+">Přihlášení uživatelé</label><br />"))+("<label><input id=d2c3 type=checkbox"+(0<=deviceViewSettings.devsCols.indexOf("ip")?" checked":"")+">IP adresa agenta</label><br />"))+("<label><input id=d2c4 type=checkbox"+(0<=deviceViewSettings.devsCols.indexOf("conn")?" checked":"")+">Připojení k serveru</label><br />"))+("<label><input id=d2c7 type=checkbox"+(0<=deviceViewSettings.devsCols.indexOf("lastseen")?" checked":"")+">Naposledy připojen</label><br />"))+("<label><input id=d2c15 type=checkbox"+(0<=deviceViewSettings.devsCols.indexOf("amthost")?" checked":"")+">Intel&reg; AMT hostname</label><br />"))+("<label><input id=d2c17 type=checkbox"+(0<=deviceViewSettings.devsCols.indexOf("amtstate")?" checked":"")+">Intel&reg; AMT state</label><br />")))}function onDeviceViewSettingsEx(){var e=[];Q("d2c1").checked&&e.push("links"),Q("d2c2").checked&&e.push("user"),Q("d2c3").checked&&e.push("ip"),Q("d2c4").checked&&e.push("conn"),Q("d2c5").checked&&e.push("os"),Q("d2c6").checked&&e.push("desc"),Q("d2c7").checked&&e.push("lastseen"),Q("d2c8").checked&&e.push("agtype"),Q("d2c9").checked&&e.push("agver"),Q("d2c10").checked&&e.push("tags"),Q("d2c11").checked&&e.push("windowsav"),Q("d2c12").checked&&e.push("windowsupdate"),Q("d2c13").checked&&e.push("windowsfirewall"),Q("d2c14").checked&&e.push("lastbootuptime"),Q("d2c15").checked&&e.push("amthost"),Q("d2c17").checked&&e.push("amtstate"),deviceViewSettings.devsCols=e,putstore("_deviceViewSettings",JSON.stringify(deviceViewSettings)),mainUpdate(4)}function ondockeypress(e){if(setSessionActivity(),!xxdialogMode&&11==xxcurrentView&&desktop&&Q("DeskControl").checked){if(null!=currentNode){var t=GetNodeRights(currentNode);if(0==(0==(8192&features2)&&(4294967295==t||0!=(8&t)&&0==(256&t))))return!1;t=4294967295!=t&&0!=(8&t)&&0==(256&t)&&0!=(4096&t);if(1==t&&(1==e.altKey||1==e.ctrlKey||e.keyCode<32&&8!=e.keyCode&&13!=e.keyCode||90<e.keyCode))return!1}return desktop.m.handleKeys(e)}if(!xxdialogMode&&12==xxcurrentView&&terminal&&3==terminal.State&&null==xterm)return terminal.m.TermHandleKeys(e);if(!xxdialogMode&&(15==xxcurrentView||115==xxcurrentView))return agentConsoleHandleKeys(e);if(!xxdialogMode&&4==xxcurrentView){if(1==e.ctrlKey||1==e.altKey||1==e.metaKey)return;var n=0;if(e.key?(1===e.key.length&&0==userSearchFocus&&(Q("UserSearchInput").value=Q("UserSearchInput").value+e.key,n=1),8==e.keyCode&&0==userSearchFocus&&(o=Q("UserSearchInput").value,Q("UserSearchInput").value=o.substring(0,o.length-1),n=1),27==e.keyCode&&(Q("UserSearchInput").value="",n=1)):0!=e.charCode&&0==userSearchFocus&&(Q("UserSearchInput").value=Q("UserSearchInput").value+String.fromCharCode(e.charCode),n=1),0<n)return 1==n&&onUserSearchInputChanged(),haltEvent(e)}if(!xxdialogMode&&1==xxcurrentView)if(1==e.ctrlKey&&96==e.charCode)showRealNames=!showRealNames,putstore("showRealNames",(Q("RealNameCheckBox").value=showRealNames)?1:0),mainUpdate(6);else if(1!=e.ctrlKey&&1!=e.altKey&&1!=e.metaKey){if(Q("viewselect").value<4){var o,n=0;if(e.key?(1===e.key.length&&0==searchFocus&&(Q("KvmSearchInput").value=Q("SearchInput").value=Q("SearchInput").value+e.key,n=1),8==e.keyCode&&0==searchFocus&&(o=Q("SearchInput").value,Q("KvmSearchInput").value=Q("SearchInput").value=o.substring(0,o.length-1),n=1),27==e.keyCode&&(Q("KvmSearchInput").value=Q("SearchInput").value="",n=1)):0!=e.charCode&&0==searchFocus&&(Q("KvmSearchInput").value=Q("SearchInput").value=Q("SearchInput").value+String.fromCharCode(e.charCode),n=1),0<n)return 1==n&&mainUpdate(5),haltEvent(e)}4==Q("viewselect").value&&(e.key?(1===e.key.length&&0==mapSearchFocus&&(Q("mapSearchLocation").value=Q("mapSearchLocation").value+e.key,n=1),27==e.keyCode&&(Q("mapSearchLocation").value="",mapCloseSearchWindow(),n=1),13==e.keyCode&&getSearchLocation()):0!=e.charCode&&0==mapSearchFocus&&(Q("mapSearchLocation").value=Q("mapSearchLocation").value+String.fromCharCode(e.charCode)))}}function ondockeydown(e){if(setSessionActivity(),!xxdialogMode&&11==xxcurrentView&&desktop&&Q("DeskControl").checked){if(null!=currentNode){var t=GetNodeRights(currentNode);if(0==(0==(8192&features2)&&(4294967295==t||0!=(8&t)&&0==(256&t))))return!1;t=4294967295!=t&&0!=(8&t)&&0==(256&t)&&0!=(4096&t);if(1==t&&(1==e.altKey||1==e.ctrlKey||e.keyCode<32&&8!=e.keyCode&&13!=e.keyCode||90<e.keyCode))return!1}return desktop.m.handleKeyDown(e)}if(!xxdialogMode&&12==xxcurrentView&&terminal&&3==terminal.State&&null==xterm&&(terminal.m.TermHandleKeyDown(e),37<=e.keyCode)&&e.keyCode<=40&&haltEvent(e),!xxdialogMode&&13==xxcurrentView&&116==e.keyCode&&null!=p13filetree)return haltEvent(e),!1;if(!xxdialogMode&&(15==xxcurrentView||115==xxcurrentView))return agentConsoleHandleKeys(e);if(!xxdialogMode&&4==xxcurrentView&&(8===e.keyCode&&0==userSearchFocus&&(n=Q("UserSearchInput").value,Q("UserSearchInput").value=n.substring(0,n.length-1),o=1),27===e.keyCode&&(Q("UserSearchInput").value="",o=1),0<o))return 1==o&&mainUpdate(5),haltEvent(e);if(!xxdialogMode&&1==xxcurrentView&&1!=e.ctrlKey&&1!=e.altKey&&1!=e.metaKey){var n,o=0;if(Q("viewselect").value<4)if(8===e.keyCode&&0==searchFocus&&(n=Q("SearchInput").value,Q("KvmSearchInput").value=Q("SearchInput").value=n.substring(0,n.length-1),o=1),27===e.keyCode&&(Q("KvmSearchInput").value=Q("SearchInput").value="",o=1),0<o)return 1==o&&mainUpdate(5),haltEvent(e);4==Q("viewselect").value&&(8===e.keyCode&&0==mapSearchFocus&&(n=Q("mapSearchLocation").value,Q("mapSearchLocation").value=n.substring(0,n.length-1),o=1),27===e.keyCode)&&(Q("mapSearchLocation").value="",mapCloseSearchWindow())}}function ondockeyup(e){if(setSessionActivity(),!xxdialogMode&&11==xxcurrentView&&desktop&&Q("DeskControl").checked){if(null!=currentNode){var t=GetNodeRights(currentNode);if(0==(0==(8192&features2)&&(4294967295==t||0!=(8&t)&&0==(256&t))))return!1;t=4294967295!=t&&0!=(8&t)&&0==(256&t)&&0!=(4096&t);if(1==t&&(1==e.altKey||1==e.ctrlKey||e.keyCode<32&&8!=e.keyCode&&13!=e.keyCode||90<e.keyCode))return!1}return desktop.m.handleKeyUp(e)}return!xxdialogMode&&12==xxcurrentView&&terminal&&3==terminal.State&&null==xterm?terminal.m.TermHandleKeyUp(e):xxdialogMode||13!=xxcurrentView||116!=e.keyCode||null==p13filetree?xxdialogMode||4!=xxcurrentView||(8!==e.keyCode||0!=searchFocus)&&27!==e.keyCode?(xxdialogMode&&27==e.keyCode&&dialogclose(0),1!=e.shiftKey||27!=e.keyCode?!xxdialogMode&&0==xxcurrentView&&1!=e.ctrlKey&&1!=e.altKey&&1!=e.metaKey&&(Q("viewselect").value<4&&(8===e.keyCode&&0==searchFocus||27===e.keyCode)||4==Q("viewselect").value&&(8===e.keyCode&&0==mapSearchFocus||27===e.keyCode))?haltEvent(e):void 0:(dialogclose(0),Q("KvmSearchInput").value=Q("SearchInput").value="",mainUpdate(5),null!=desktop&&connectDesktop(),null!=terminal&&connectTerminal(),null!=files&&connectFiles(),void go(1))):haltEvent(e):(p13folderup(9999),haltEvent(e),!1)}function ondocblur(){if(!xxdialogMode&&11==xxcurrentView&&desktop&&Q("DeskControl").checked&&desktop.m.handleReleaseKeys)return desktop.m.handleReleaseKeys()}function devGrpMouseHover(e,t){setSessionActivity();Q("viewselect").value;e=e.children[1].children[1];e.children[0].classList.remove("g1s"),e.children[1].classList.remove("e2s"),e.children[2].classList.remove("g2s"),1==t&&(e.children[0].classList.add("g1s"),e.children[1].classList.add("e2s"),e.children[2].classList.add("g2s"))}function devMouseHover(e,t){setSessionActivity();var n,o=Q("viewselect").value;1==o?((n=e.children[0].children[0].children[1].children[0].children[0].children[0]).children[1].classList.remove("g1s"),n.children[2].classList.remove("e2s"),n.children[3].classList.remove("g2s"),1==t&&(n.children[1].classList.add("g1s"),n.children[2].classList.add("e2s"),n.children[3].classList.add("g2s"))):2==o&&((n=e).children[2].classList.remove("g1s"),n.children[4].classList.remove("e2s"),n.children[3].classList.remove("g2s"),1==t)&&(n.children[2].classList.add("g1s"),n.children[4].classList.add("e2s"),n.children[3].classList.add("g2s"))}var deviceHeaderCount,deviceHeaderId=0,deviceHeaderTotal=0,deviceHeadersTitles={},deviceHeaders={},oldviewmode=0;function updateDevices(){if(null!=nodes&&1==xxcurrentView){var e="",t=0,n=null,o={},i=Q("viewselect").value,a={},s={};if(QV("xdevices",4!=i),QV("xdevicesmap",4==i),QV("devListToolbar",i<3),QV("kvmListToolbar",3==i||5==i),QV("devMapToolbar",4==i),QV("devListToolbarSize",3==i||5==i),QV("devListToolbarSettings",2==i),QV("NoMeshesPanel",0==nodes.length&&0==meshcount),QV("devListToolbarViewIcons",0<nodes.length),QV("devListToolbarSort",0<nodes.length&&4!=i),0==nodes.length&&(i=1,sort=0),4==i)setTimeout(function(){null!=xxmap.map&&xxmap.map.updateSize()},200);else{deviceHeaderCount={},deviceHeaders={},deviceHeadersTitles={};var r=[],l=((deviceHeaderTotal=deviceHeaderId=0)==sort?nodes.sort(meshSort):1==sort?nodes.sort(powerSort):2==sort?1==showRealNames?nodes.sort(deviceHostSort):nodes.sort(deviceSort):5==sort&&(deviceViewSettings&&deviceViewSettings.devsCols&&0<=deviceViewSettings.devsCols.indexOf("lastseen")||(0==requestedLastConnects&&(requestedLastConnects=!0,meshserver.send({action:"lastconnects"})),null==deviceViewSettings&&(deviceViewSettings={}),Array.isArray(deviceViewSettings.devsCols)?deviceViewSettings.devsCols.push("lastseen"):deviceViewSettings.devsCols=["user","ip","conn","lastseen"]),nodes.sort(lastConnectSort)),Q("column_l").clientWidth-60),d=Math.floor(l/301),d=301+Math.floor((l-301*d)/d),u=4;for(w in deviceViewSettings&&deviceViewSettings.devsCols&&(u=deviceViewSettings.devsCols.length+1,0<=deviceViewSettings.devsCols.indexOf("desc"))&&u--,nodes){var c=nodes[w];if(0!=c.v){var p,m,v=meshes[c.meshid],g=GetNodeRights(c);if(0==sort?(meshes[c.meshid]?c.meshid:"*")!=n&&(1!=i&&3!=i&&5!=i||null==n||(e+="</div>"),deviceHeaderSet(),p="",2==i&&(e+="<tr><td colspan="+u+">"),meshes[c.meshid]&&1==meshes[c.meshid].mtype&&(p="<span class=devHeaderx>, Pouze Intel&reg; AMT</span>"),meshes[c.meshid]&&3==meshes[c.meshid].mtype&&(p=meshes[c.meshid].relayid?"<span class=devHeaderx>, Reléová zařízení</span>":"<span class=devHeaderx>, Místní zařízení</span>"),1==i&&null!=n&&(2==t&&(e+="<td><div style=width:301px></div></td>"),""!=e)&&(e+="</tr></table>"),2==i&&(e+="<div>"),e=(e+="<div class=DevSt style=width:100%;padding-top:4px><span style=float:right>")+"<span id=DevxHeader"+deviceHeaderId+" class=devHeaderx></span>"+p+"</span>",1!=i&&2!=i&&3!=i&&5!=i||(k=CollapsedGroups[c.meshid],e+='<img class=collapseImage cmenu=expandAllContextMenu id="DevxColImg'+deviceHeaderId+'" src=images/c'+(!0===k?"1":"2")+'.png height=8 width=8 style=margin-left:2px;margin-right:2px;cursor:pointer onclick=toggleCollapseGroup("'+deviceHeaderId+'","'+c.meshid+'",'+i+")></img>"),n=meshes[c.meshid]?(e+='<span id=MxMESH cmenu=meshContextMenu tabindex=0 style=cursor:pointer onclick=gotoMesh("'+c.meshid+"\") onkeypress=\"if (event.key=='Enter') gotoMesh('"+c.meshid+"')\">"+EscapeHtml(meshes[c.meshid].name)+"</span>"+getMeshActions(v,g)+"</div>",c.meshid):(e+="<span id=MxMESH><i>Jednotlivá zařízení</i></span></div>","*"),2==i&&(e+="</div>"),t=0,(o[n]=1)!=i&&3!=i&&5!=i||(e+="<div id=DevxCol"+deviceHeaderId+(!0===k?" style=display:none":"")+">")):1==sort?(p=c.pwr||0)!==n&&(1!=i&&3!=i&&5!=i||null==n||(e+="</div>"),deviceHeaderSet(),1==i&&null!==n&&(2==t&&(e+="<td><div style=width:301px></div></td>"),""!=e)&&(e+="</tr></table>"),2==i&&(e+="<tr><td colspan="+u+">"),e+="<div class=DevSt style=width:100%;padding-top:4px><span id=DevxHeader"+deviceHeaderId+" class=devHeaderx style=float:right></span>",1!=i&&2!=i&&3!=i&&5!=i||(k=CollapsedGroups["pwr:"+p],e+='<img class=collapseImage cmenu=expandAllContextMenu id="DevxColImg'+deviceHeaderId+'" src=images/c'+(!0===k?"1":"2")+'.png height=8 width=8 style=margin-left:2px;margin-right:2px;cursor:pointer onclick=toggleCollapseGroup("'+deviceHeaderId+'","pwr:'+p+'",'+i+")></img>"),e+="<span>"+PowerStateStr2(c.pwr)+"</span></div>",n=p,t=0,1!=i&&3!=i&&5!=i||(e+="<div id=DevxCol"+deviceHeaderId+(!0===k?" style=display:none":"")+">")):2!=sort&&5!=sort||null==n&&(n="1"),1==i?e+="<div name=xxdevice1 id=xv1"+c._id+" style=display:inline-block;position:relative;width:"+d+"px;height:50px;padding-top:1px;padding-bottom:1px></div>":2==i?(m=c.meshid,1==sort?m="pwr:"+(c.pwr||0):3!=sort&&4!=sort||(m="tag:**xx**xx*TaG*xx**xx**"),e+="<tr name=xxdevice2 colname=DevxCol"+m+" style=height:20px"+((k=3!=sort&4!=sort&CollapsedGroups[m])?";display:none":"")+" id=xv2"+c._id+"></tr>"):(3==i||5==i)&&1&c.conn&&0!=(8&g||256&g)&&c.agent&&0!=(1&c.agent.caps)&&(0!=Object.keys(checkedNodeids).length&&!checkedNodeids[c._id]||(e+=updateDeviceViewHtml(i,null,c),r.push(c._id))),(3==sort||4==sort)&&""!=e){if(c.tags)for(var h in c.tags){var f=c.tags[h],k=(4==sort&&(f=v?v.name+" - "+c.tags[h]:"**INDV*~*DEVS** - "+c.tags[h]),CollapsedGroups["tag:"+encodeURIComponentEx(f)]),y=e.replace("**xx**xx*TaG*xx**xx**",encodeURIComponentEx(f)+(k?" style=display:none":""));if(null==a[f]?(a[f]=y,s[f]=1):(a[f]+=y,s[f]+=1),3==i||5==i)break}else 4!=sort||null==v||null!=c.tags&&0!=c.tags.length||(f=v.name,k=CollapsedGroups["tag:"+encodeURIComponentEx(f)],y=e.replace("**xx**xx*TaG*xx**xx**",encodeURIComponentEx(f)+(k?" style=display:none":"")),null==a[f]?(a[f]=y,s[f]=1):(a[f]+=y,s[f]+=1));e=""}deviceHeaderTotal++,void 0===deviceHeaderCount[c.state]?deviceHeaderCount[c.state]=1:deviceHeaderCount[c.state]++}}if(1==i&&null!=n&&(e+="</div>"),32<=r.length&&(Q("autoConnectDesktopCheckbox").checked=!1),QE("autoConnectDesktopCheckbox",r.length<32),3==sort||4==sort){var x=[],b=0;for(w in a)x.push(w);for(h in x.sort(function(e,t){return sortCollator.compare(e.toLowerCase(),t.toLowerCase())}),x){var w=x[h];e=2==i?(e=(e+="<tr><td colspan="+u+"><div class=DevSt style=width:100%;padding-top:4px>")+'<img class=collapseImage cmenu=expandAllContextMenu id="DevxColImg'+b+'" src=images/c'+(!0===(k=CollapsedGroups["tag:"+encodeURIComponentEx(w)])?"1":"2")+'.png height=8 width=8 style=margin-left:2px;margin-right:2px;cursor:pointer onclick=toggleCollapseGroup("'+b+'","tag:'+encodeURIComponentEx(w)+'",2)></img>')+"<span class=devHeaderx style=float:right>"+s[w]+" node"+(1<s[w]?"s":"")+"</span><span>"+EscapeHtml(w).split("|").join(" &rarr; ").split("**INDV*~*DEVS**").join("<i>Jednotlivá zařízení</i>")+"</span></div>"+a[w]:(e=(e=(e+="<div class=DevSt style=width:100%;padding-top:4px><span class=devHeaderx style=float:right>"+format(1<s[w]?"{0} nodes":"{0} node",s[w])+"</span>")+'<img class=collapseImage cmenu=expandAllContextMenu id="DevxColImg'+b+'" src=images/c'+(!0===(k=CollapsedGroups["tag:"+encodeURIComponentEx(w)])?"1":"2")+'.png height=8 width=8 style=margin-left:2px;margin-right:2px;cursor:pointer onclick=toggleCollapseGroup("'+b+'","tag:'+encodeURIComponentEx(w)+'")></img>')+"<span>"+EscapeHtml(w).split("|").join(" &rarr; ").split("**INDV*~*DEVS**").join("<i>Jednotlivá zařízení</i>")+"</span></div>")+"<div id=DevxCol"+b+(!0===k?" style=display:none":"")+">"+a[w]+"</div>",b++}}var S=!1;if(""==e&&0<nodes.length&&(""!=Q("SearchInput").value||0!=Q("DevFilterSelect").value)&&(S=!0,e=3==sort?'<div style="margin:30px">Žádná zařízení nejsou zahrnuta do žádné skupiny, kliknutím na "Skupiny" zařízení přidáte do skupiny.</div>':'<div style="margin:30px">Tomuto vyhledávání nevyhovují žádná zařízení. <a onclick=clearDeviceSearch()>Vymazat vyhledávací filtr</a></div>'),1==i&&2==t&&(e+="<td><div style=width:301px></div></td>"),0==sort&&""==Q("SearchInput").value&&0==Q("DevFilterSelect").value&&i<3){var D=deviceHeaderId,C=[];for(w in meshes)C.push(meshes[w]);for(w in C.sort(nameSort),C){var M=C[w],g=GetMeshRights(M);null==o[M._id]&&(""!=n&&""!=e&&(e+="</tr></table>"),e=(e=(e=(e+="<table style=width:100%;padding-top:4px cellpadding=0 cellspacing=0><tr><td colspan=3 class=DevSt>")+'<img class=collapseImage cmenu=expandAllContextMenu id="DevxColImg'+ ++D+'" src=images/c'+(!0===(k=CollapsedGroups[M._id])?"1":"2")+'.png height=8 width=8 style=margin-left:2px;margin-right:2px;cursor:pointer onclick=toggleCollapseGroup("'+D+'","'+M._id+'")></img>')+'<span id=MxMESH style=cursor:pointer onclick=gotoMesh("'+M._id+'")>'+EscapeHtml(M.name)+"</span><span>")+getMeshActions(M,g)+"</span></td></tr><tr>",1==M.mtype?(e+="<td><div style=padding:10px><i>V této skupině zařízení nejsou žádná zařízení Intel&reg; AMT",0==(4&g)||4294967295!=userinfo.siteadmin&&0!=(4096&userinfo.siteadmin)||(e+=", <a href=# style=cursor:pointer onclick='return addDeviceToMesh(\""+M._id+"\")'>přidejte nějaké</a>")):2==M.mtype?(e=e+"<td><div id=DevxCol"+D+(!0===k?" style=display:none":"")+"><div style=padding:10px><i>V této skupině zařízení nejsou žádná zařízení",0==(4&g)||4294967295!=userinfo.siteadmin&&0!=(4096&userinfo.siteadmin)||(e+=", <a href=# style=cursor:pointer onclick='return addAgentToMesh(\""+M._id+"\")'>přidejte nějaké</a>")):3==M.mtype?(e=e+"<td><div id=DevxCol"+D+(!0===k?" style=display:none":"")+"><div style=padding:10px><i>V této skupině zařízení nejsou žádná místní zařízení",0==(4&g)||4294967295!=userinfo.siteadmin&&0!=(4096&userinfo.siteadmin)||(e+=", <a href=# style=cursor:pointer onclick='return addLocalDeviceToMesh(\""+M._id+"\")'>přidejte nějaké</a>")):4==M.mtype&&(e=e+"<td><div id=DevxCol"+D+(!0===k?" style=display:none":"")+"><div style=padding:10px><i>V této skupině zařízení nejsou žádná zařízení"),e+=".</i></div></td></div>",n=M._id,0)}}for(w in""!=e&&0==S?(e+="</table>",2==i&&(S="",null==deviceViewSettings&&(deviceViewSettings={}),Array.isArray(deviceViewSettings.devsCols)||(deviceViewSettings.devsCols=["user","ip","conn"]),0<=deviceViewSettings.devsCols.indexOf("agtype")&&(S+="<th style=color:gray;width:100px>Typ agenta"),0<=deviceViewSettings.devsCols.indexOf("agver")&&(S+="<th style=color:gray;width:100px>Verze agenta"),0<=deviceViewSettings.devsCols.indexOf("os")&&(S+="<th style=color:gray;width:160px>OS"),0<=deviceViewSettings.devsCols.indexOf("tags")&&(S+="<th style=color:gray;width:120px>Štítky"),0<=deviceViewSettings.devsCols.indexOf("windowsav")&&(S+="<th style=color:gray;width:100px>Windows AV"),0<=deviceViewSettings.devsCols.indexOf("windowsupdate")&&(S+="<th style=color:gray;width:120px>Windows Update"),0<=deviceViewSettings.devsCols.indexOf("windowsfirewall")&&(S+="<th style=color:gray;width:120px>Windows Firewall"),0<=deviceViewSettings.devsCols.indexOf("lastbootuptime")&&(S+="<th style=color:gray;width:120px>Last Boot Up Time"),0<=deviceViewSettings.devsCols.indexOf("links")&&(S+="<th style=color:gray;width:120px>Odkazy"),0<=deviceViewSettings.devsCols.indexOf("user")&&(S+="<th style=color:gray;width:120px>Uživatel"),0<=deviceViewSettings.devsCols.indexOf("ip")&&(S+="<th style=color:gray;width:120px>Adresa"),0<=deviceViewSettings.devsCols.indexOf("conn")&&(S+="<th style=color:gray;width:100px>Konektivita"),0<=deviceViewSettings.devsCols.indexOf("amthost")&&(S+="<th style=color:gray;width:100px>AMT Host"),0<=deviceViewSettings.devsCols.indexOf("amtstate")&&(S+="<th style=color:gray;width:100px>AMT State"),0<=deviceViewSettings.devsCols.indexOf("lastseen")&&(S+="<th style=color:gray;width:120px>Naposledy připojen",0==requestedLastConnects)&&(requestedLastConnects=!0,meshserver.send({action:"lastconnects"})),e="<table style=width:100%;margin-top:4px cellpadding=0 cellspacing=0><th style=color:gray>"+S+e+"</tr></table><div style=height:1px></div>")):(e+="</table>",3==sort&&(e='<div style="margin:10px"><i>Nenalezena žádná zařízení se štítky.</i></div>')),e+="<div style=border-top-style:solid;border-top-width:1px;border-top-color:#DDDDDD;cursor:pointer;font-size:small;margin-top:4px>",i<3&&0==sort&&0<Object.keys(meshes).length&&(4294967295==userinfo.siteadmin||0==(64&userinfo.siteadmin))&&(e+='<a href=# onclick="return account_createMesh()" title="Vytvořit novou skupinu zařízení." style=cursor:pointer>Přidat skupinu zařízení</a>&nbsp'),4294967295!=userinfo.siteadmin&&0!=(128&userinfo.siteadmin)||(e+="<a href=# onclick='return p10showMeshCmdDialog(0)' style=cursor:pointer title=\"Stáhnout MeshCmd – nástroj s mnoha funkcemi, určený pro příkazový řádek.\">MeshCmd</a>&nbsp","win32"!=navigator.platform.toLowerCase()&&"macintel"!=navigator.platform.toLowerCase())||(e+="<a href=# onclick='return p10showMeshRouterDialog()' style=cursor:pointer title=\"Stáhnout MeshCentral Router – nástroj pro mapování TCP portů.\">Router</a>&nbsp"),e+="</div><br/>",QH("xdevices",e),deviceHeaderSet(),deviceHeaders)QH(w,deviceHeaders[w]);for(w in deviceHeadersTitles)Q(w).title=deviceHeadersTitles[w];if(p1updateInfo(),3!=i&&5!=i||1!=xxcurrentView)disconnectAllKvmFunction(),Q("autoConnectDesktopCheckbox").checked=!1;else{var z,T=[{x:180,y:101},{x:302,y:169},{x:454,y:255}][Q("sizeselect").selectedIndex];for(w in 3==i&&(S=T.x+2,l=l-5,z=Math.floor(l/S),z=S+Math.floor((l-z*S)/z),T.y=T.y*(z/T.x),T.x=z),multiDesktop)multiDesktop[w].xxdelete=!0;for(w in r){var N=r[w],E=N.split("/")[2],V=multiDesktop[N];if(null!=V){var A=5==i?V.m.width*T.y/V.m.height:T.x;V.m.CanvasId.setAttribute("style","background-color:black;width:"+A+"px;height:"+T.y+"px"),Q("xkvmid_"+E).appendChild(V.m.CanvasId),delete V.xxdelete,QH("skvmid_"+E,["Odpojeno","Připojování…","Nastavení…","",""][null==V.m.State?V.m.state:V.m.State])}else{c=getNodeFromId(N);if(desktopNode==c&&null!=desktop){var t=desktop.m.CanvasId,A=5==i?desktop.m.width*T.y/desktop.m.height:T.x;t.setAttribute("id","kvmid_"+E),t.setAttribute("style","background-color:black;width:"+A+"px;height:"+T.y+"px"),t.setAttribute("onclick","toggleKvmDevice('"+N+"')"),t.removeAttribute("onmousedown"),t.removeAttribute("onmouseup"),t.removeAttribute("onmousemove"),Q("xkvmid_"+E).appendChild(t),QH("skvmid_"+E,["Odpojeno","Připojování…","Nastavení…","",""][null==desktop.m.State?desktop.m.state:desktop.m.State]),desktop.m.SendCompressionLevel&&desktop.m.SendCompressionLevel(multidesktopsettings.agentencoding,multidesktopsettings.quality,multidesktopsettings.scaling,multidesktopsettings.framerate),desktop.shortid=E,desktop.onStateChanged=onMultiDesktopStateChange,desktop.m.onRemoteInputLockChanged=null,desktop.m.onKeyboardStateChanged=null,multiDesktop[N]=desktop,desktop=desktopNode=currentNode=null,QH("DeskParent",'<canvas id="Desk" oncontextmenu="return false" onmousedown=dmousedown(event) onmouseup=dmouseup(event) onmousemove=dmousemove(event)></canvas>')}else{(t=document.createElement("canvas")).setAttribute("id","kvmid_"+E),t.setAttribute("width",640),t.setAttribute("height",480),t.setAttribute("oncontextmenu","return false"),t.setAttribute("style","background-color:black;width:"+T.x+"px;height:"+T.y+"px"),t.setAttribute("onclick","toggleKvmDevice('"+N+"')");try{Q("xkvmid_"+E).appendChild(t)}catch(e){}1==Q("autoConnectDesktopCheckbox").checked&&setTimeout(function(){connectMultiDesktop(c,1)},100)}}}for(w in multiDesktop)1==multiDesktop[w].xxdelete?(multiDesktop[w].Stop(),delete multiDesktop[w]):debugmode&&multiDesktop[w].m&&multiDesktop[w].m.onScreenSizeChange&&mdeskAdjust(multiDesktop[w].m,multiDesktop[w].m.ScreenWidth,multiDesktop[w].m.ScreenHeight,multiDesktop[w].m.CanvasId);deskAdjust()}}oldviewmode=i,onDevicesScrollEx()}}var onDevicesTouchActive=!1,onDevicesScrollnagleTimer=null;function onDevicesScroll(e){(e=void 0===e?!1:e)&&(Q("xdevices").scrollTop=0),null!=onDevicesScrollnagleTimer||onDevicesTouchActive||(onDevicesScrollnagleTimer=setTimeout(onDevicesScrollEx,250))}function onDeviceTouch(e){onDevicesTouchActive!=e&&0==(onDevicesTouchActive=e)&&onDevicesScrollEx()}function onDevicesScrollEx(){null!=onDevicesScrollnagleTimer&&(clearTimeout(onDevicesScrollnagleTimer),onDevicesScrollnagleTimer=null);for(var e,t=Q("xdevices").scrollTop-200,n=Q("xdevices").scrollTop+Q("xdevices").clientHeight+200,o=Q("viewselect").value,i=document.getElementsByName("xxdevice"+o),a=0;a<i.length;a++)i[a].offsetTop>=t&&i[a].offsetTop<n&&null!=(e=getNodeFromId(i[a].id.substring(3)))?updateDeviceViewHtml(o,i[a],e):i[a].innerHTML=""}function updateDeviceViewDevice(e){var t,n=Q("viewselect").value;1!=n&&2!=n?mainUpdate(4):null!=(e="string"==typeof e?getNodeFromId(e):e)&&null!=(t=Q("xv"+n+e._id))&&""!=t.innerHTML&&updateDeviceViewHtml(n,t,e)}function updateDeviceViewHtml(e,t,n){var o=EscapeHtml(n.name),i=(0==o.length&&(o="<i>Nic</i>"),null!=n.rname&&0<n.rname.length&&(o+=" / "+EscapeHtml(n.rname)),EscapeHtml(n.name));if(0==(i=1==showRealNames&&null!=n.rname?EscapeHtml(n.rname):i).length&&(i="<i>Nic</i>"),1==e&&"none"==t.parentNode.style.display||2==e&&"none"==t.style.display)t.innerHTML="";else{var a="",s="",r=(1==stars[n._id]&&(s+=2==e?"<img class=deviceNotifySmallDotSub src=images/icon-star-notify-10.png width=10 height=10>":"<img class=deviceNotifyDotSub src=images/icon-star-notify-16.png width=16 height=16>"),null!=n.sessions&&(null!=n.sessions.msg&&(s+=2==e?"<div onclick=showDeviceMessages('"+n._id+'\',null,event) style="width:10;height:10" class=deviceNotifySmallDotSub></div>':"<div onclick=showDeviceMessages('"+n._id+'\',null,event) style="width:16;height:16" class=deviceNotifyDotSub>'+Object.keys(n.sessions.msg).length+"</div>"),null==n.sessions.kvm&&null==n.sessions.terminal&&null==n.sessions.files&&null==n.sessions.tcp&&null==n.sessions.udp||(s+=2==e?"<img onclick=showDeviceSessions('"+n._id+"',null,event) class=deviceNotifySmallDotSub src=images/icon-relay-notify10.png width=10 height=10>":"<img onclick=showDeviceSessions('"+n._id+"',null,event) class=deviceNotifyDotSub src=images/icon-relay-notify.png width=16 height=16>"),null!=n.sessions.help&&(s+=2==e?"<img onclick=showDeviceHelpRequests('"+n._id+"',null,event) class=deviceNotifySmallDotSub src=images/icon-help-notify-10.png width=10 height=10>":"<img onclick=showDeviceHelpRequests('"+n._id+"',null,event) class=deviceNotifyDotSub src=images/icon-help-notify-16.png width=16 height=16>"),null!=n.sessions.battery)&&1==e&&(l="","ac"==(r=n.sessions.battery).state&&(l="Zařízení je zapojeno"),"dc"==r.state&&(l="Zařízení je napájeno z baterie"),u="",d=-1,"number"==typeof r.level&&0<=r.level&&r.level<=100&&(u=r.level+"%",5<(d=Math.floor((r.level+10)/25)+1)&&(lvl=5),"ac"==r.state)&&(100==r.level?d=11:d+=5),0<d)&&(a+='<div class="deviceBatterySmall deviceBatterySmall'+d+'" title="'+(null!=l?l+", "+u:u)+'"></div>'),""!=s&&(a+=2==e?"<div class=deviceNotifySmallDot>"+s+"</div>":"<div class=deviceNotifyDot>"+s+"</div>"),n.icon);if(n.conn&&0!=n.conn||3==n.mtype||(r+=" gray"),1==e)t.innerHTML='<table id=devs cmenu=devsContentMenu onmouseover=devMouseHover(this,1) onmouseout=devMouseHover(this,0) style=width:100%;height:100%><tr><td style=width:22px><input class="'+n.meshid+' DeviceCheckbox" onchange=p1devcheck(event) value=devid_'+n._id+" type=checkbox "+(checkedNodeids[n._id]?" checked":"")+"></td><td><table onmouseup=gotoDevice('"+n._id+"',null,null,event) border=0 cellspacing=0 style=width:100%;height:100%;cursor:pointer><tr><td style=width:50px tabindex=0 onkeypress=\"if (event.key=='Enter') gotoDevice('"+n._id+'\',null,null,event)"><div class="i'+r+'" style=width:50px></div></td><td class=g1t></td><td class=e2t><div class=e1t style=width:'+(t.clientWidth-120)+'px title="'+o+'">'+i+"</div><div>"+NodeStateStr(n)+"</div></td><td class=g2t></td></tr></table></td></tr></table>"+a;else if(2==e){var l,d=[],u=(n.conn&&(0!=(1&n.conn)&&(4==n.mtype?"PDU"==n.porttype?d.push('<span title="Přepínací port je připraven k použití.">Přepínač</span>'):d.push('<span title="Port IP-KVM je připojen a připraven k použití.">IP-KVM</span>'):d.push('<span title="Agent je připojen a připraven.">Agent</span>')),0!=(2&n.conn)?d.push('<span title="Intel&reg; AMT CIRA je připojeno a připraveno k použití.">CIRA</span>'):0!=(4&n.conn)&&d.push('<span title="Intel&reg; AMT je směrovatelné.">AMT</span>'),0!=(8&n.conn)&&d.push('<span title="Agent je dostupný pomocí předávání (relay) přes jiného agenta.">Předávání (relay)</span>'),0!=(16&n.conn))&&d.push('<span title="MQTT připojení na zařízení je aktivní.">MQTT</span>'),3==n.mtype&&((l=meshes[n.meshid])&&l.relayid?d.push('<span title="Připojení k místní síti prostřednictvím přenosového agenta.">Předávání (relay)</span>'):d.push('<span title="Připojení k místní síti.">Lokální</span>')),n.desc&&0<=deviceViewSettings.devsCols.indexOf("desc")&&(i="<div style=float:right"+(1==stars[n._id]?";padding-right:15px":"")+">"+EscapeHtml(n.desc)+"</div><div>"+i+"</div>"),n.meshid),c=(1==sort?u="pwr:"+(n.pwr||0):3!=sort&&4!=sort||(u="tag:**xx**xx*TaG*xx**xx**"),CollapsedGroups[u],"<td style=position:relative><div id=devs cmenu=devsContentMenu class=bar18 tabindex=0 onmouseover=devMouseHover(this,1) onmouseout=devMouseHover(this,0) style=height:18px;width:100%;font-size:medium onkeypress=\"if (event.key=='Enter') gotoDevice('"+n._id+"',null,null,event)\">");if(c=(c=(c+='<div class=deviceBarCheckbox><input class="'+n.meshid+' DeviceCheckbox" value=devid_'+n._id+" type=checkbox onchange=p1devcheck(event) "+(checkedNodeids[n._id]?" checked":"")+"></div>")+("<div class=deviceBarIcon onmouseup=gotoDevice('"+n._id+"',null,null,event)><div class=\"j"+r+'" style=width:16px;margin-top:1px;margin-left:2px;height:16px></div></div>'))+"<div class=g1 style=height:18px;float:left></div><div class=g2 style=height:18px;float:right></div>"+('<div class=style10 style=cursor:pointer;font-size:14px;max-height:18px;text-overflow:ellipsis;overflow:hidden;white-space:nowrap title="'+o+"\" onmouseup=gotoDevice('"+n._id+"',null,null,event)>"+i+"</div></div>"+a+"</td>"),null==deviceViewSettings&&(deviceViewSettings={}),Array.isArray(deviceViewSettings.devsCols)||(deviceViewSettings.devsCols=["user","ip","conn"]),0<=deviceViewSettings.devsCols.indexOf("agtype")&&(c+='<td style=text-align:center;font-size:x-small;padding-left:4px;padding-right:4px title="'+EscapeHtml(3!=n.mtype&&n.agent&&n.agent.id&&n.agent.id<=agentsStr.length?agentsStr[n.agent.id]:"")+'">'+EscapeHtml(3!=n.mtype&&n.agent&&n.agent.id&&n.agent.id<=agentsStr.length?agentsStr[n.agent.id]:"").replace(",","<br />")),0<=deviceViewSettings.devsCols.indexOf("agver")&&(c+='<td style=text-align:center;font-size:x-small;padding-left:4px;padding-right:4px title="'+EscapeHtml(n.agent&&n.agent.core?n.agent.core:"")+'">'+EscapeHtml(n.agent&&n.agent.core?n.agent.core:"").replace(",","<br />")),0<=deviceViewSettings.devsCols.indexOf("os")&&(3==n.mtype?(s="",4==n.agent.id&&(s="Windows"),6==n.agent.id&&(s="Linux"),29==n.agent.id&&(s="MacOS"),c+='<td style=text-align:center;font-size:x-small title="'+EscapeHtml(s)+'">'+EscapeHtml(s)):c+='<td style=text-align:center;font-size:x-small title="'+EscapeHtml(n.osdesc||"")+'">'+EscapeHtml(n.osdesc||"")),0<=deviceViewSettings.devsCols.indexOf("tags")){c+="<td style=text-align:center;font-size:x-small>";var p="";if(null!=n.tags)for(var m in n.tags)p+="<span class=tagSpan>"+EscapeHtml(n.tags[m])+"</span> ";c+="<span style=line-height:20px>"+p+"</span>"}0<=deviceViewSettings.devsCols.indexOf("windowsav")&&(c+="<td style=text-align:center>"+(n.wsc&&null!=n.wsc.antiVirus?"OK"==n.wsc.antiVirus?"<span style=color:green>OK</span>":"<span style=color:red>ŠPATNÝ</span>":"")),0<=deviceViewSettings.devsCols.indexOf("windowsupdate")&&(c+="<td style=text-align:center>"+(n.wsc&&null!=n.wsc.autoUpdate?"OK"==n.wsc.autoUpdate?"<span style=color:green>OK</span>":"<span style=color:red>ŠPATNÝ</span>":"")),0<=deviceViewSettings.devsCols.indexOf("windowsfirewall")&&(c+="<td style=text-align:center>"+(n.wsc&&null!=n.wsc.firewall?"OK"==n.wsc.firewall?"<span style=color:green>OK</span>":"<span style=color:red>ŠPATNÝ</span>":"")),0<=deviceViewSettings.devsCols.indexOf("lastbootuptime")&&(c+="<td style=text-align:center;font-size:x-small>"+(null!=n.lastbootuptime?printDateTime(new Date(n.lastbootuptime)):"")),0<=deviceViewSettings.devsCols.indexOf("links")&&(c+="<td style=text-align:center;font-size:x-small>"+getShortRouterLinks(n)),0<=deviceViewSettings.devsCols.indexOf("user")&&(c+="<td style=text-align:center>"+getUserShortStr(n)),0<=deviceViewSettings.devsCols.indexOf("ip")&&(l="",3==n.mtype?l=n.host:n.ip&&(l=n.ip),c+="<td style=text-align:center>"+l),0<=deviceViewSettings.devsCols.indexOf("conn")&&(c+="<td style=text-align:center>"+d.join("&nbsp;+&nbsp;")),0<=deviceViewSettings.devsCols.indexOf("lastseen")&&(c+="<td style=text-align:center;font-size:x-small>",0<n.conn?c+="Připojeno":null!=n.lastconnect&&(c+=printDateTime(new Date(n.lastconnect)))),0<=deviceViewSettings.devsCols.indexOf("amthost")&&(c+="<td style=text-align:center>"+(null==n.intelamt||null==n.intelamt.host?"":EscapeHtml(n.intelamt.host))),0<=deviceViewSettings.devsCols.indexOf("amtstate")&&(u="",n.intelamt&&(0==n.intelamt.state&&(u=' <span title="Intel&reg; AMT is not activated">Pre</span>'),1==n.intelamt.state&&(u=' <span title="Intel&reg; AMT is in activation mode">In</span>'),2==n.intelamt.state)&&n.intelamt.flags&&(2&n.intelamt.flags?u=' <span title="Intel&reg; AMT je aktivováno v režimu uživatele">CCM</span>':4&n.intelamt.flags&&(u+=' <span title="Intel&reg; AMT je aktivováno v režimu správce">ACM</span>')),c+="<td style=text-align:center>"+u),t.innerHTML=c}else if(3==e||5==e)return c="<div id=devs cmenu=devsContentMenu style=display:inline-block;position:relative;margin:1px;background-color:lightgray;border-radius:5px;position:relative><div tabindex=0 style=padding:3px;cursor:pointer onmouseup=gotoDevice('"+n._id+"',11,null,event) onkeypress=\"if (event.key=='Enter') gotoDevice('"+n._id+"',11,null,event)\">"+a,(c+='<div class="j'+r+'" style=width:16px;float:left></div>&nbsp;'+i+"</div>")+"<span onmouseup=gotoDevice('"+n._id+"',null,null,event)></span><div id=xkvmid_"+n._id.split("/")[2]+"><div id=skvmid_"+n._id.split("/")[2]+' tabindex=0 style="position:absolute;color:white;left:5px;top:27px;text-shadow:0px 0px 5px #000;z-index:10;cursor:default" onclick=toggleKvmDevice(\''+n._id+"') onkeypress=\"if (event.key=='Enter') toggleKvmDevice('"+n._id+"')\">Odpojeno</div></div></div>"}}function getShortRouterLinks(e){var t="",n=GetNodeRights(e);if((0!=(1&e.conn)||3==e.mtype)&&e.agent&&0!=(8&n)&&14!=e.agent.id&&(0!=webRelayPort&&(t=(t+='<a href=# onclick=p10WebRouter("'+e._id+'",1,'+(e.httpport||80)+")>HTTP"+(e.httpport&&80!=e.httpport?"/"+e.httpport:"")+"</a>&nbsp;")+'<a href=# onclick=p10WebRouter("'+e._id+'",2,'+(e.httpsport||443)+")>HTTPS"+(e.httspport&&443!=e.httpsport?"/"+e.httpsport:"")+"</a>&nbsp;"),0<e.agent.id&&e.agent.id<5&&("win32"!=navigator.platform.toLowerCase()||null!=serverinfo.devicemeshrouterlinks&&0==serverinfo.devicemeshrouterlinks.rdp||(t+='<a href=# cmenu=altPortContextMenu id=rdpMCRouterLink onclick=p10MCRouter("'+e._id+'",3)>RDP</a>&nbsp;')),4<e.agent.id&&("win32"!=navigator.platform.toLowerCase()&&"macintel"!=navigator.platform.toLowerCase()||null!=serverinfo.devicemeshrouterlinks&&0==serverinfo.devicemeshrouterlinks.ssh||(t+='<a href=# onclick=p10MCRouter("'+e._id+'",4,'+(e.sshport||22)+")>SSH</a>&nbsp;"),"win32"!=navigator.platform.toLowerCase()||null!=serverinfo.devicemeshrouterlinks&&0==serverinfo.devicemeshrouterlinks.scp||(t+='<a href=# onclick=p10MCRouter("'+e._id+'",5,'+(e.sshport||22)+")>SCP</a>&nbsp;")),"win32"==navigator.platform.toLowerCase()||"macintel"==navigator.platform.toLowerCase())&&null!=serverinfo.devicemeshrouterlinks&&Array.isArray(serverinfo.devicemeshrouterlinks.extralinks))for(var o in serverinfo.devicemeshrouterlinks.extralinks){var o=serverinfo.devicemeshrouterlinks.extralinks[o],i='"'+o.protocol+'"';doesDeviceMatchFilterTags(e,o.filter)&&(3!=e.mtype||"mcrdesktop"!=o.protocol&&"mcrfiles"!=o.protocol)&&("number"==typeof o.protocol?i=o.protocol:"http"==o.protocol?i=1:"https"==o.protocol?i=2:"rdp"==o.protocol?i=3:"ssh"==o.protocol?i=4:"scp"==o.protocol?i=5:"mcrdesktop"==o.protocol?i=6:"mcrfiles"==o.protocol&&(i=7),t+='<a href=# onclick=p10MCRouter("'+e._id+'",'+i+","+o.port+(o.ip?',"'+o.ip+'"':",null")+","+(o.localport||0)+")>"+o.name+"</a>&nbsp;")}return t}function doesDeviceMatchFilterTags(e,t){if(null==t)return!0;if(Array.isArray(t)){if(0<=t.indexOf(e.meshid))return!0;if(0<=t.indexOf(e._id))return!0;if(Array.isArray(e.tags))for(var n in e.tags)if(0<=t.indexOf("tag:"+e.tags[n]))return!0}return!1}function showDeviceHelpRequests(e,t,n){if(n&&haltEvent(n),!xxdialogMode||t){var o=null,i="";if(null==(o=null==e?currentNode:getNodeFromId(e))||null==o.sessions)setDialogMode(0);else{if(null!=o.sessions.help)for(var a in o.sessions.help)i+='<div style="background-color:#CCC;padding:6px;border-radius:6px"><a style="float:right" onclick=closeDeviceHelpRequest("'+encodeURIComponentEx(a)+'","'+encodeURIComponentEx(o._id)+'")>Zavrhnout</a><div style=margin-bottom:6px><b>'+EscapeHtml(a)+"</b></div><div style=margin-bottom:6px>"+EscapeHtml(o.sessions.help[a])+"</div></div>";""!=i?setDialogMode(2,"Žádosti o pomoc - "+EscapeHtml(o.name),1,null,i,"HELPREQ-"+o._id):setDialogMode(0)}}return!1}function closeDeviceHelpRequest(e,t){setDialogMode(0),meshserver.send({action:"msg",type:"localapp",nodeid:decodeURIComponent(t),appid:decodeURIComponent(e),value:{cmd:"cancelhelp"}})}function showDeviceSessions(e,t,n){if(n&&haltEvent(n),!xxdialogMode||t){var o=null,i="";if(null==(o=null==e?currentNode:getNodeFromId(e))||null==o.sessions)setDialogMode(0);else{for(var a in o.sessions)if("kvm"==a&&null==o.sessions.multidesk)for(var s in i+="<u>Vzdálená plocha</u>",o.sessions.kvm)s.startsWith("user/")?(r="",s!=userinfo._id&&4294967295!=GetNodeRights(o)||(r=' <a href=# onclick=\'return endDeviceSession("kvm", "'+encodeURIComponentEx(o._id)+'", "'+encodeURIComponentEx(s)+'")\' title="Odpojit tuto relaci" style=cursor:pointer><img src=images/trash.png border=0 height=10 width=10></a>'),i+=addHtmlValue2(getUserName(s),(1==o.sessions.kvm[s]?"1 relace":nobreak(format("{0} relací",o.sessions.kvm[s])))+r)):"busy"==s&&(i+=addHtmlValue2("Zařízení je zaneprázdněné",1==o.sessions.kvm[s]?"1 relace":nobreak(format("{0} relací",o.sessions.kvm[s]))));else if("multidesk"==a)for(var s in i+="<u>Vzdálená plocha</u>",o.sessions.multidesk){var r="";s!=userinfo._id&&4294967295!=GetNodeRights(o)||(r=' <a href=# onclick=\'return endDeviceSession("multidesk", "'+encodeURIComponentEx(o._id)+'", "'+encodeURIComponentEx(s)+'")\' title="Odpojit tuto relaci" style=cursor:pointer><img src=images/trash.png border=0 height=10 width=10></a>'),i+=addHtmlValue2(getUserName(s),(1==o.sessions.multidesk[s]?"1 relace":nobreak(format("{0} relací",o.sessions.multidesk[s])))+r)}else if("terminal"==a)for(var s in i+="<u>Terminál</u>",o.sessions.terminal){r="";s!=userinfo._id&&4294967295!=GetNodeRights(o)||(r=' <a href=# onclick=\'return endDeviceSession("terminal", "'+encodeURIComponentEx(o._id)+'", "'+encodeURIComponentEx(s)+'")\' title="Odpojit tuto relaci" style=cursor:pointer><img src=images/trash.png border=0 height=10 width=10></a>'),i+=addHtmlValue2(getUserName(s),(1==o.sessions.terminal[s]?"1 relace":nobreak(format("{0} relací",o.sessions.terminal[s])))+r)}else if("files"==a)for(var s in i+="<u>Soubory</u>",o.sessions.files){r="";s!=userinfo._id&&4294967295!=GetNodeRights(o)||(r=' <a href=# onclick=\'return endDeviceSession("files", "'+encodeURIComponentEx(o._id)+'", "'+encodeURIComponentEx(s)+'")\' title="Odpojit tuto relaci" style=cursor:pointer><img src=images/trash.png border=0 height=10 width=10></a>'),i+=addHtmlValue2(getUserName(s),(1==o.sessions.files[s]?"1 relace":nobreak(format("{0} relací",o.sessions.files[s])))+r)}else if("tcp"==a)for(var s in i+="<u>Směrování TCP</u>",o.sessions.tcp){r="";s!=userinfo._id&&4294967295!=GetNodeRights(o)||(r=' <a href=# onclick=\'return endDeviceSession("tcp", "'+encodeURIComponentEx(o._id)+'", "'+encodeURIComponentEx(s)+'")\' title="Odpojit tuto relaci" style=cursor:pointer><img src=images/trash.png border=0 height=10 width=10></a>'),i+=addHtmlValue2(getUserName(s),(1==o.sessions.tcp[s]?"1 relace":nobreak(format("{0} relací",o.sessions.tcp[s])))+r)}else if("udp"==a)for(var s in i+="<u>Směrování UDP</u>",o.sessions.udp){r="";s!=userinfo._id&&4294967295!=GetNodeRights(o)||(r=' <a href=# onclick=\'return endDeviceSession("udp", "'+encodeURIComponentEx(o._id)+'", "'+encodeURIComponentEx(s)+'")\' title="Odpojit tuto relaci" style=cursor:pointer><img src=images/trash.png border=0 height=10 width=10></a>'),i+=addHtmlValue2(getUserName(s),(1==o.sessions.udp[s]?"1 relace":nobreak(format("{0} relací",o.sessions.udp[s])))+r)}""!=i?setDialogMode(2,"Session - "+EscapeHtml(o.name),1,null,i,"SESSIONS-"+o._id):setDialogMode(0)}}return!1}function endDeviceSession(e,t,n){var n=decodeURIComponent(n).split("/"),o=n[0]+"/"+n[1]+"/"+n[2],i=null;4==n.length&&n[3].startsWith("guest:")&&(i=atob(n[3].substring(6))),"multidesk"==e?meshserver.send({action:"endDesktopMultiplex",nodeid:decodeURIComponent(t),xuserid:o,guestname:i,guestname:i}):meshserver.send({action:"msg",type:"endtunnel",nodeid:decodeURIComponent(t),xuserid:o,guestname:i,guestname:i,protocol:e})}function showDeviceMessages(e,t,n){if(n&&haltEvent(n),!xxdialogMode||t){var o=null,i="<div style=max-height:200px;overflow-y:auto>",a=0;if(null==(o=null==e?currentNode:getNodeFromId(e))||null==o.sessions||null==o.sessions.msg)setDialogMode(0);else{for(var s in o.sessions.msg){var r=s,l=5;"string"==typeof o.sessions.msg[s].msg&&(r=o.sessions.msg[s].msg),"number"==typeof o.sessions.msg[s].msgid&&null!=eventsMessageId[o.sessions.msg[s].msgid]&&(r=eventsMessageId[o.sessions.msg[s].msgid]),i+="<table style=width:96%><td style=width:24px><div class=NotifyIconSmall"+(l=(l="number"==typeof o.sessions.msg[s].icon?o.sessions.msg[s].icon:l)<1||9<l?5:l)+'></div><td><div style="border-radius:5px;background-color:#BBB;width:100%;padding:8px">'+EscapeHtml(r)+"</div></table>",a++}i+="</div>",0<a&&setDialogMode(2,"Zprávy agenta - "+EscapeHtml(o.name),1,null,i,"MESSAGES-"+o._id)}}return!1}function toggleCollapseGroup(e,t,n){if(2==n){var o=document.getElementsByName("xxdevice2");if(0==o.length)return;for(var i,a=[],s=0;s<o.length;s++)o[s].attributes.colname.value.substring(7)==t&&a.push(o[s]);(i="none"==a[0].style.display)?delete CollapsedGroups[t]:CollapsedGroups[t]=!0;for(s=0;s<a.length;s++)a[s].style.display=i?"":"none"}else(i="none"==QS("DevxCol"+e).display)?delete CollapsedGroups[t]:CollapsedGroups[t]=!0,QV("DevxCol"+e,i);Q("DevxColImg"+e).src=i?"images/c2.png":"images/c1.png",putstore("_collapse",JSON.stringify(CollapsedGroups)),updateCollapseAllButton(),onDevicesScrollEx(),onDevicesScrollEx()}function toggleKvmDevice(e){var t=GetNodeRights(e="string"==typeof e?getNodeFromId(e):e);(8&t||256&t)&&1&e.conn&&connectMultiDesktop(e,1)}function getUserShortStr(e){var t,n;return null!=e&&null!=e.users&&Array.isArray(e.users)&&0!=e.users.length?1<e.users.length?'<span title="'+EscapeHtml(e.users.join(", "))+'">'+nobreak(format("{0} uživatelů",e.users.length))+"</span>":(0<(n=(t=e=e.users[0]).indexOf("\\"))&&(t=e.substring(n+1)),15<(t=EscapeHtml(t)).length&&(t=t.substring(0,14)+"&#8230;"),'<span title="'+EscapeHtml(e)+'">'+t+"</span>"):""}function autoConnectDesktops(){1==Q("autoConnectDesktopCheckbox").checked&&connectAllKvmFunction()}function connectAllKvmFunction(e){if(xxdialogMode)return!1;if(!0!==e){var t=0;for(i in nodes){var n=nodes[i],o=nodes[i]._id;null!=multiDesktop[o]||0!=Object.keys(checkedNodeids).length&&!checkedNodeids[o]||(8&(o=GetNodeRights(n))||256&o)&&1&n.conn&&1==n.v&&t++}if(8<t)return void setDialogMode(2,"Připojit vše",3,function(){connectAllKvmFunction(!0)},format("Opravdu připojit k {0} zařízení?",t))}for(var i in nodes)1!=nodes[i].v||null!=multiDesktop[nodes[i]._id]||0!=Object.keys(checkedNodeids).length&&!checkedNodeids[nodes[i]._id]||toggleKvmDevice(nodes[i]._id)}function disconnectAllKvmFunction(){if(xxdialogMode)return!1;for(var e in multiDesktop)multiDesktop[e].Stop();multiDesktop={}}function onMultiDesktopStateChange(e,t){try{QH("skvmid_"+e.shortid,["Odpojeno","Připojování…","Nastavení…","",""][t])}catch(e){}}function onDeviceSearchChanged(e){var t=new URL(window.location.href);if(null==e||"SearchInput"!=e.target.id&&"KvmSearchInput"!=e.target.id?null!=e&&"DevFilterSelect"==e.target.id||(t.searchParams.delete("filter"),urlargs.filter&&delete urlargs.filter):("SearchInput"==e.target.id?Q("KvmSearchInput").value=Q("SearchInput").value:Q("SearchInput").value=Q("KvmSearchInput").value,""!=e.target.value?(t.searchParams.set("filter",e.target.value),urlargs.filter&&(urlargs.filter=e.target.value)):(t.searchParams.delete("filter"),urlargs.filter&&delete urlargs.filter)),0==(268435456&features)&&0<xxcurrentView)try{window.history.replaceState({},document.title,decodeURIComponent(t.toString()))}catch(e){}mainUpdate(5)}function showMultiDesktopSettings(){QV("td7amtkvm",!1),QV("td7meshkvm",!0),QV("td7rdpkvm",!1),QV("d7desktopOtherSettings",!1),d7bitmapquality.value=multidesktopsettings.quality,d7bitmapscaling.value=multidesktopsettings.scaling,d7encoding.value=multidesktopsettings.agentencoding,multidesktopsettings.framerate?d7framelimiter.value=multidesktopsettings.framerate:d7framelimiter.value=100,setDialogMode(7,"Nastavení vzdálené plochy",3,showMultiDesktopSettingsChanged)}function showMultiDesktopSettingsChanged(){for(var e in multidesktopsettings.quality=d7bitmapquality.value,multidesktopsettings.scaling=d7bitmapscaling.value,multidesktopsettings.framerate=d7framelimiter.value,multidesktopsettings.agentencoding=d7encoding.value,localStorage.setItem("multidesktopsettings",JSON.stringify(multidesktopsettings)),multiDesktop)multiDesktop[e].m.SendCompressionLevel(multidesktopsettings.agentencoding,multidesktopsettings.quality,multidesktopsettings.scaling,multidesktopsettings.framerate)}function connectMultiDesktop(e,t){var n=e._id,o=n.split("/")[2],i=multiDesktop[n];null==i?null!=Q("kvmid_"+o)&&(2==t?null!=e.intelamt.user&&""!=e.intelamt.user&&((i=CreateAmtRedirect(CreateAmtRemoteDesktop("kvmid_"+o),authCookie)).shortid=o,i.onStateChanged=onMultiDesktopStateChange,i.m.bpp=1,i.m.useZRLE=!0,i.m.showmouse=!0,i.m.onKvmData=function(e){console.log("KVM Data received in multi-desktop mode, this is not supported.")},i.m.onScreenSizeChange=mdeskAdjust,i.Start(n,16994,"*","*",0),i.contype=2,multiDesktop[n]=i):1==t&&((i=CreateAgentRedirect(meshserver,CreateAgentRemoteDesktop("kvmid_"+o),serverPublicNamePort,authCookie,authRelayCookie,domainUrl)).m.UseExtendedKeyFlag=e.agent.id<5,i.m.mouseCursorActive(11==xxcurrentView),i.shortid=o,i.attemptWebRTC=attemptWebRTC,i.webrtcconfig=webrtcconfiguration,i.onStateChanged=onMultiDesktopStateChange,i.m.ImageType=multidesktopsettings.agentencoding,i.m.CompressionLevel=multidesktopsettings.quality,i.m.ScalingLevel=multidesktopsettings.scaling,multidesktopsettings.framerate&&(i.m.FrameRateTimer=multidesktopsettings.framerate),multidesktopsettings.swapmouse&&(i.m.SwapMouse=multidesktopsettings.swapmouse),multidesktopsettings.rmw&&(i.m.ReverseMouseWheel=multidesktopsettings.rmw),1==multidesktopsettings.remotekeymap&&(i.m.remoteKeyMap=multidesktopsettings.remotekeymap),i.m.onScreenSizeChange=mdeskAdjust,i.Start(n),i.contype=1,multiDesktop[n]=i)):(i.Stop(),delete multiDesktop[n])}function getMeshActions(e,t){return 0==(4&t)?"":(t="",1==e.mtype&&(0==(1&features)&&(t=(t+=' <a href=# style=cursor:pointer;font-size:small title="Přidat nový Intel&reg; AMT počítač, který je umístěn v lokální síti." onclick=\'return addDeviceToMesh("'+e._id+"\")'>Přidat lokálně</a>")+' <a href=# style=cursor:pointer;font-size:small title="Přidat nový Intel&reg; AMT počítač pomocí skenu lokální sítě." onclick=\'return addAmtScanToMesh("'+e._id+"\")'>Skenovat síť</a>"),e.amt)&&0<e.amt.type&&(t+=' <a href=# style=cursor:pointer;font-size:small title="Proveďte aktivaci a konfiguraci Intel&reg; AMT." onclick=\'return showAmtSetup("'+e._id+"\")'>Nastavit</a>"),2!=e.mtype||4294967295!=userinfo.siteadmin&&0!=(4096&userinfo.siteadmin)||(t+=' <a href=# style=cursor:pointer;font-size:small title="Přidejte nový počítač do této skupiny zařízení instalací agenta sítě." onclick=\'return addAgentToMesh("'+e._id+"\")'>Přidat agenta</a>",0==(2&features)&&(t+=' <a href=# style=cursor:pointer;font-size:small title="Pozvěte někoho, aby nainstaloval agenta sítě do této skupiny zařízení." onclick=\'return inviteAgentToMesh("'+e._id+"\")'>Pozvat</a>")),3==e.mtype&&(t+=' <a href=# style=cursor:pointer;font-size:small title="Přidejte zařízení umístěné v místní síti." onclick=\'return addLocalDeviceToMesh("'+e._id+"\")'>Přidat zařízení</a>"),t)}function addLocalDeviceToMesh(e){if(xxdialogMode)return!1;var t=meshes[e],t=format('Přidejte místní zařízení do skupiny zařízení "{0}".',EscapeHtml(t.name))+"<br /><br />";setDialogMode(2,"Přidejte místní zařízení",3,addLocalDeviceToMeshEx,(t+=addHtmlValue("Název zařízení","<input id=dp1devicename style=width:230px maxlength=32 autocomplete=off onchange=validateLocalDeviceToMesh() onkeyup=validateLocalDeviceToMesh() />"))+addHtmlValue("Název stroje",'<input id=dp1hostname style=width:230px maxlength=32 autocomplete=off placeholder="Stejné jako název zařízení" onchange=validateLocalDeviceToMesh() onkeyup=validateLocalDeviceToMesh() />')+addHtmlValue("Typ","<select id=dp1type style=width:236px><option value=4>Windows (RDP)</option><option value=6>Linux (SSH/SCP/VNC)</option><option value=29>macOS (SSH/SCP/VNC)</option></select>"),e),validateLocalDeviceToMesh(),Q("dp1devicename").focus()}function validateLocalDeviceToMesh(){QE("idx_dlgOkButton",0<Q("dp1devicename").value.length)}function addLocalDeviceToMeshEx(e,t){var n=Q("dp1hostname").value;""==n&&(n=Q("dp1devicename").value),meshserver.send({action:"addlocaldevice",meshid:t,devicename:Q("dp1devicename").value,hostname:n,type:parseInt(Q("dp1type").value)})}function addDeviceToMesh(e){var t;return xxdialogMode||(t=meshes[e],t=format("Přidat nové Intel&reg; AMT zařízení do skupiny „{0}“.",EscapeHtml(t.name))+"<br /><br />",setDialogMode(2,"Přidat Intel&reg; AMT zařízení",3,addDeviceToMeshEx,t=(t=(t=(t=(t+=addHtmlValue("Název zařízení","<input id=dp1devicename style=width:230px maxlength=32 autocomplete=off onchange=validateDeviceToMesh() onkeyup=validateDeviceToMesh() />"))+addHtmlValue("Název stroje",'<input id=dp1hostname style=width:230px maxlength=32 autocomplete=off placeholder="Stejné jako název zařízení" onchange=validateDeviceToMesh() onkeyup=validateDeviceToMesh() />'))+addHtmlValue("Uživatelské jméno",'<input id=dp1username style=width:230px maxlength=32 autocomplete=off placeholder="admin" onchange=validateDeviceToMesh() onkeyup=validateDeviceToMesh() />'))+addHtmlValue("Heslo","<input id=dp1password type=password style=width:230px autocomplete=off maxlength=32 onchange=validateDeviceToMesh() onkeyup=validateDeviceToMesh() />"))+addHtmlValue("Zabezpečení","<select id=dp1tls style=width:236px><option value=0>Žádné TLS zabezpečení</option><option value=1>TLS vyžadováno</option></select>"),e),validateDeviceToMesh(),Q("dp1devicename").focus()),!1}function showAmtImport(e){xxdialogMode||(setDialogMode(2,"Intel&reg; AMT Device Import",3,showAmtImportEx,'Create many Intel&reg; AMT device at once by importing a JSON file with the following format:<br /><pre>[\r\n  {\r\n    "fqdn":"mycomputer.com",\r\n    "uuid":"xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx",\r\n    "version":"12.0.1",\r\n    "username":"admin",\r\n    "password":"password",\r\n    "tls":true\r\n  }\r\n]</pre><input style=width:370px type=file id=d4importFile accept=".json" onchange=showAmtImportValidate() />',e),QE("idx_dlgOkButton",!1))}function showAmtImportValidate(){QE("idx_dlgOkButton",null!=Q("d4importFile").value)}function showAmtImportEx(e,n){var t=new FileReader;t.onload=function(e){var t=null;try{t=JSON.parse(e.target.result)}catch(e){return void setDialogMode(2,"Intel&reg; AMT Device Import",1,null,format("Neplatný JSON soubor: {0}.",e))}null!=t?meshserver.send({action:"importamtdevices",meshid:n,amtdevices:t}):setDialogMode(2,"Intel&reg; AMT Device Import",1,null,"Neplatný formát JSON souboru.")},t.readAsText(Q("d4importFile").files[0])}function showAmtSetup(e){var t,n;return xxdialogMode||(t=serverinfo.name,n=meshes[e],-1!=t.indexOf(".")&&0==(2&features)||(t=window.location.hostname),domainUrl.substring(0,domainUrl.length-1),t=1==serverinfo.https?"wss://"+t+(443==serverinfo.port?"":":"+serverinfo.port)+domainUrl:"ws://"+t+(80==serverinfo.port?"":":"+serverinfo.port)+domainUrl,n=format("Přidejte, aktivujte a nakonfigurujte Intel&reg; AMT do skupiny „{0}“ pravidelným spuštěním MeshCmd jako správce na vzdáleném zařízení.",EscapeHtml(n.name))+"<br /><br />",n+="<textarea readonly=readonly style=width:100%;resize:none;height:100px;overflow:auto;font-size:12px readonly>meshcmd amtconfig --url "+t+"apf.ashx --id '"+e.split("/")[2]+"' --serverhttpshash "+serverinfo.tlshash+"</textarea>",null!=serverinfo.amtAcmFqdn&&(n+="<div style=margin-top:8px>Pro aktivaci ACM bude třeba Intel&reg; AMT nastavit na následující důvěryhodný plně kvalifikovaný název domény: <b>"+serverinfo.amtAcmFqdn.join(", ")+"</b></div>"),setDialogMode(2,"Nastavení Intel&reg; AMT",9,null,n),Q("idx_dlgOkButton").focus()),!1}function showAmtAcmSetup(){if(xxdialogMode)return!1;var e="<table><tr><td><img src=images/usbkey70.png height=70 width=31 style=margin-left:4px;margin-right:8px><td><div>Aktivujte Intel&reg; AMT v režimu správce (ACM) pomocí USB klíče ve formátu FAT. Umístěte soubor setup.bin a pomocí tohoto klíče spusťte jeden nebo více počítačů.</div><div style=margin-top:6px>Začněte zadáním starého a nového hesla MBEx.</div></table>",e=(e=(e+=addHtmlValue("staré heslo","<input id=dp1password0 type=password style=width:230px autocomplete=off maxlength=32 onchange=validateAmtAcmSetupEx() onkeyup=validateAmtAcmSetupEx() />"))+addHtmlValue("Nové heslo*","<input id=dp1password1 type=password style=width:230px autocomplete=off maxlength=32 onchange=validateAmtAcmSetupEx() onkeyup=validateAmtAcmSetupEx() />"))+addHtmlValue("Nové heslo*","<input id=dp1password2 type=password style=width:230px autocomplete=off maxlength=32 onchange=validateAmtAcmSetupEx() onkeyup=validateAmtAcmSetupEx() />");32&features2&&1==currentMesh.mtype&&serverinfo.amtProvServerMeshId==currentMesh._id&&(e+="<label><input id=dp1lanprov type=checkbox /> Používá se pro aktivaci holé sítě LAN.</label>"),setDialogMode(2,"Intel&reg; AMT ACM",3,showAmtAcmSetupEx,e+='<div><span id=dp10passNotify style="font-size:10px"> * 8-16 znaků, 1 velké písmeno, 1 malé písmeno, 1 číslo, 1 znak jiný než alfanumerický.</span></div>'),Q("dp1password0").focus(),validateAmtAcmSetupEx()}function validateAmtAcmSetupEx(){var e=Q("dp1password0").value,t=Q("dp1password1").value,n=Q("dp1password2").value,o=!0;"admin"!=e&&0==checkPasswordRequirements(e,{min:8,max:16,numeric:1,lower:1,upper:1,nonalpha:1})&&(o=!1),t==n&&0!=checkPasswordRequirements(t,{min:8,max:16,numeric:1,lower:1,upper:1,nonalpha:1})||(o=!1),QE("idx_dlgOkButton",o)}function showAmtAcmSetupEx(){meshserver.send({action:"amtsetupbin",oldmebxpass:Q("dp1password0").value,newmebxpass:Q("dp1password1").value,baremetal:32&features2&&Q("dp1lanprov").checked})}function addAmtScanToMesh(e){return xxdialogMode||(setDialogMode(2,"Hledat Intel&reg; AMT zařízení",0,addAmtScanToMeshEx,"Zadejte rozsah IP adres pro vyhledání Intel&reg; AMT zařízení.<br /><br />"+addHtmlValue("IP rozsah",'<table style=width:250px><tr><td style=width:99%><input id=dp1range style=width:100% list=iprangelist value="192.168.1.0/24" onkeyup=addAmtScanToMeshKeyUp(event) /><td style=width:1%><input id=dp1rangebutton type=button value="Skenovat" onclick=addAmtScanToMeshButton()></input></tr></table>')+'<div id=dp1results style="width:100%;height:200px;background-color:white;border:1px gray solid;overflow-y:scroll"></div>'+('<input type=hidden id=amtScanMeshId value="'+e+'" />')+'<div style="padding:10px;margin-bottom:5px"><input id="idx_dlgCancelButton2" type="button" value="Storno" style="" onclick="dialogclose(0)" /><input id="idx_dlgOkButton2" type="button" value="OK" style="" onclick="dialogclose(1)" /><div><input id="d2scanSelectButton" type="button" value="Vybrat vše" onclick="scanSelectAll()" /></div></div>',e),QE("idx_dlgOkButton2",!1),QE("d2scanSelectButton",!1),QH("dp1results","<div style=width:100%;text-align:center;margin-top:12px;color:gray;line-height:1.5>Ukázkové hodnoty rozsahu IP<br />192.168.0.100<br />192.168.1.0/24<br />192.167.0.1-192.168.0.100</div>"),focusTextBox("dp1range"),addAmtScanToMeshKeyUp()),!1}function scanSelectAll(){for(var e=document.getElementsByClassName("DevScanCheckbox"),t=0;t<e.length;t++)e[t].checked=!0;addAmtScanToMeshCheckbox()}function addAmtScanToMeshKeyUp(e){QE("dp1rangebutton",3<Q("dp1range").value.split(".").length),e&&13==e.keyCode&&(haltEvent(e),addAmtScanToMeshButton())}function addAmtScanToMeshEx(e){for(var t,n,o=document.getElementsByClassName("DevScanCheckbox"),i=0;i<o.length;i++)o[i].checked&&(t=o[i].getAttribute("tag"),n=(t=amtScanResults[t]).hostname,"host"==t.hosttype&&(n=capitalizeFirstLetter(n.split(".")[0])),meshserver.send({action:"addamtdevice",meshid:Q("amtScanMeshId").value,devicename:n,hostname:t.hostname,amtusername:"",amtpassword:"",amttls:t.tls}))}function addAmtScanToMeshButton(){var e=Q("dp1range").value.trim(),t=e.split(" ");""!=(e=(e=1<t.length?t[t.length-1]:e).trim())&&(QE("dp1range",!1),QE("dp1rangebutton",!1),QH("dp1results","<div style=width:100%;text-align:center;margin-top:20px>Skenování…</div><div style=width:100%;text-align:center;margin-top:6px;color:#666>"+e+"</div>"),xxdialogTag="AMTSCAN:"+e,meshserver.send({action:"scanamtdevice",range:e}))}function addAmtScanToMeshCheckbox(){for(var e=document.getElementsByClassName("DevScanCheckbox"),t=0,n=0;n<e.length;n++)e[n].checked&&t++;QE("idx_dlgOkButton2",0<t)}function checkEmail(e){var e=e.split("@"),t=2==e.length&&0<e[0].length&&1<e[1].split(".").length&&2<e[1].length;if(1==t){var n,o=e[1].split(".");for(n in o)0==o[n].length&&(t=!1)}return t}function inviteAgentToMesh(e){var t,n;return xxdialogMode||(t="",n=meshes[e],64&features&&(t=(t=(t=(t=(t=(t=(t=(t+=addHtmlValue("Typ pozvání","<select id=d2InviteType onchange=d2ChangedInviteType() style=width:236px><option value=0>Odkaz na pozvánku</option><option value=1>E-mailová pozvánka</option></select>")+"<hr />")+"<div id=emailInviteDiv style=display:none>"+format("Pozvěte někoho k instalaci agenta. E-mailem bude zaslán odkaz na instalaci agenta pro skupinu „{0}“.",EscapeHtml(n.name))+"<br /><br />")+addHtmlValue("Jméno (volitelné)",'<input id=agentInviteName value="" style=width:230px maxlength=64 />'))+addHtmlValue("E-mail",'<input id=agentInviteEmail style=width:230px placeholder="e-mail@example.com" onkeyup=validateAgentInvite()></input>'))+addHtmlValue("Operační systém","<select id=agentInviteNameOs onchange=d2ChangedInviteType() style=width:236px><option value=4>Odeslat odkaz na instalaci</option><option value=0 selected>Všechny podporované</option><option value=1>Pouze Windows</option><option value=3>pouze Apple macOS</option><option value=2>Pouze Linux</option><option value=5>Asistent MeshCentral</option></select>")+"<div id=d2agentexpirediv>")+addHtmlValue("Platnost odkazu","<select id=agentInviteExpire style=width:236px><option value=1>1 hodina</option><option value=8>8 hodin</option><option value=24>1 den</option><option value=168>1 týden</option><option value=5040>1 měsíc</option><option value=0>Neomezeno</option></select>")+"</div><div id=d2agentInstallTypeDiv2>")+addHtmlValue("Typ instalace","<select id=agentInviteType style=width:236px><option value=0>Bezobslužná a interaktivní</option><option value=2>Pouze bezobslužná</option><option value=1>Pouze interaktivní</option></select>")+"</div>")+addHtmlValue("Zpráva<br />(volitelné)",'<textarea id=agentInviteMessage value="" style=width:230px;height:100px;resize:none maxlength=1024 /></textarea>')+"</div>"),setDialogMode(2,"Pozvat",3,performAgentInvite,t=(t=(t=(t=(t+="<div id=urlInviteDiv>"+format("Pozvěte někoho k instalaci agenta tím, že mu nasdílíte odkaz. Tento odkaz obsahuje pokyny pro zařazení do skupiny zařízení „{0}“. Odkaz je veřejný a protistrana nepotřebuje žádný účet na tomto serveru.",EscapeHtml(n.name))+"<br /><br />")+addHtmlValue("Platnost odkazu","<select id=d2inviteExpire style=width:236px onchange=d2RequestInvitationLink()><option value=1>1 hodina</option><option value=8>8 hodin</option><option value=24>1 den</option><option value=168>1 týden</option><option value=5040>1 měsíc</option><option value=0>Neomezeno</option></select>"))+addHtmlValue("Agenti","<select id=d2agentType style=width:236px onchange=d2ChangedInviteType()><option value=0>Všichni dostupní agenti</option><option value=1>Windows MeshAgent</option><option value=2>Linux MeshAgent</option><option value=4>MacOS MeshAgent</option><option value=8>Asistent MeshCentral</option><option value=16>Android MeshAgent</option></select>")+"<div id=d2agentInstallTypeDiv>")+addHtmlValue("Typ instalace","<select id=d2agentInviteType style=width:236px onchange=d2RequestInvitationLink()><option value=0>Bezobslužná a interaktivní</option><option value=2>Pouze bezobslužná</option><option value=1>Pouze interaktivní</option></select>"))+"</div>"+'<div id=agentInvitationLinkDiv style="text-align:center;font-size:large;margin:16px;display:none"><a href=# id=agentInvitationLink rel="noreferrer noopener" target="_blank" style=cursor:pointer></a> <img src=images/link4.png height=10 width=10 title="Kopírovat odkaz do schránky" style=cursor:pointer onclick=d2CopyInviteToClip()></div></div>',e),(64&features?(Q("d2InviteType").focus(),d2ChangedInviteType):(Q("d2inviteExpire").focus(),validateAgentInvite))(),d2RequestInvitationLink()),!1}function d2RequestInvitationLink(){meshserver.send({action:"createInviteLink",meshid:xxdialogTag,expire:parseInt(Q("d2inviteExpire").value),flags:parseInt(Q("d2agentInviteType").value),agents:parseInt(Q("d2agentType").value)})}function d2ChangedInviteType(){64&features&&(QV("urlInviteDiv",0==Q("d2InviteType").value),QV("d2agentexpirediv",4==Q("agentInviteNameOs").value),QV("d2agentInstallTypeDiv2",Q("agentInviteNameOs").value<2),QV("emailInviteDiv",1==Q("d2InviteType").value)),QV("d2agentInstallTypeDiv",parseInt(Q("d2agentType").value)<2),validateAgentInvite(),d2RequestInvitationLink()}function d2CopyInviteToClip(){copyTextToClip(Q("agentInvitationLink").href)}function d2CopySecretToClip(){copyTextToClip(Q("d2optsecret").getAttribute("secret"))}function validateAgentInvite(){64&features&&1==Q("d2InviteType").value?(QE("idx_dlgOkButton",checkEmail(Q("agentInviteEmail").value)),QV("idx_dlgCancelButton",!0)):(QE("idx_dlgOkButton",!0),QV("idx_dlgCancelButton",!1))}function performAgentInvite(e,t){64&features&&1==Q("d2InviteType").value&&meshserver.send({action:"inviteAgent",meshid:t,email:Q("agentInviteEmail").value,name:Q("agentInviteName").value,os:Q("agentInviteNameOs").value,flags:Q("agentInviteType").value,msg:Q("agentInviteMessage").value,expire:parseInt(Q("agentInviteExpire").value)})}function addAgentToMesh(e){if(!xxdialogMode){var t,n=meshes[e],o="",i="",a="<select id=aginsSelect onchange=addAgentToMeshClick() style=width:236px><option value=0>Windows</option><option value=1>Linux / BSD</option><option value=5>Linux / BSD / macOS binární instalační program</option><option value=2>Apple macOS</option>",a=(0==(2&features)&&(a+="<option value=6>Mobilní zařízení</option>"),o+=addHtmlValue("Operační systém",a=a+"<option value=7>Asistent MeshCentral</option>"+"<option value=3>Windows (odinstalace)</option><option value=4>Linux / BSD (odinstalace)</option><option value=8>Apple macOS (UnInstall)</option></select>"),serverinfo.name),s=(-1!=a.indexOf(".")&&0==(2&features)||(a=window.location.hostname),domainUrl.substring(0,domainUrl.length-1)),r="",r=1==serverinfo.https?443==serverinfo.port?"":":"+serverinfo.port:80==serverinfo.port?"":":"+serverinfo.port,l=[6,5,10005,25,26,28,30,32,36,37,40,41,16,29],d={6:"Linux x86-64",5:"Linux x86-32",10005:"Apple OSX Universal",25:"Linux ARM-HF, Rasberry Pi",26:"Linux ARM64-HF",28:"Linux MIPS24KC (OpenWRT)",30:"FreeBSD x86-64",32:"Linux ARM 64 bit (glibc/2.24 NOKVM)",36:"OpenWRT x86-64",37:"OpenBSD x86-64",40:"Linux MIPSEL24KC (OpenWRT)",41:"ARMADA/CORTEX-A53/MUSL (OpenWRT)",16:"Apple macOS x86-64",29:"Apple macOS ARM-64"};for(t in l)i+="<option value="+l[t]+">"+d[l[t]]+"</option>";o=(o=(o=(o=(o+="<div id=aginsSysTypeDiv>")+addHtmlValue("Typ systému","<select id=aginsSysType onchange=addAgentToMeshClick() style=width:236px>"+i+"</select>"))+"</div>"+"<div id=aginsTypeDiv>")+addHtmlValue("Typ instalace","<select id=aginsType onchange=addAgentToMeshClick() style=width:236px><option value=0>Bezobslužná a interaktivní</option><option value=2>Pouze bezobslužná</option><option value=1>Pouze interaktivní</option></select>")+"</div><div id=asinsTypeDiv>")+addHtmlValue("Typ instalace","<select id=asinsType onchange=addAgentToMeshClick() style=width:236px><option value=2>Aplikace, Připojit na žádost uživatele</option><option value=3>Aplikace, vždy připojeno</option><option value=0>System Tray, Connect on user request</option><option value=1>Systémová lišta, vždy připojeno</option><option value=4>Systémová lišta, pouze monitor</option></select>")+"</div><hr>",n.name.split("\\").join("").split("/").join("").split(":").join("").split("*").join("").split("?").join("").split('"').join("").split("<").join("").split(">").join("").split("|").join("").split(" ").join("").split("'").join("");o=(o=(o=(o+="<div id=agins_windows>"+format("Pro přidání nového zařízení do skupiny „{0}“, si stáhněte agenta a nainstalujte na zařízení, které chcete spravovat. Tento agent už obsahuje veškeré informace pro připojení na server.",EscapeHtml(n.name))+"<br /><br />")+addHtmlValue("Mesh Agent",'<a id=aginsw32lnk name="meshagents?id=3&meshid='+e.split("/")[2]+"&installflags=0"+(urlargs.key?"&key="+urlargs.key:"")+'" title="x86 32bit version of the MeshAgent">Windows x86-32 (.exe)</a> <img src=images/link4.png height=10 width=10 title="Copy Windows x86 32bit agent URL to clipboard" style=cursor:pointer onclick=copyAgentUrl("meshagents?id=3&meshid='+e.split("/")[2]+'&installflags=",1)>'))+addHtmlValue("Mesh Agent",'<a id=aginsw64lnk name="meshagents?id=4&meshid='+e.split("/")[2]+"&installflags=0"+(urlargs.key?"&key="+urlargs.key:"")+'" title="x86 64bit version of the MeshAgent">Windows x86-64 (.exe)</a> <img src=images/link4.png height=10 width=10 title="Copy Windows x86 64bit agent URL to clipboard" style=cursor:pointer onclick=copyAgentUrl("meshagents?id=4&meshid='+e.split("/")[2]+'&installflags=",1)>'))+addHtmlValue("Mesh Agent",'<a id=aginswa64lnk name="meshagents?id=43&meshid='+e.split("/")[2]+"&installflags=0"+(urlargs.key?"&key="+urlargs.key:"")+'" title="ARM 64bit version of the MeshAgent">Windows ARM-64 (.exe)</a> <img src=images/link4.png height=10 width=10 title="Copy Windows ARM 64bit agent URL to clipboard" style=cursor:pointer onclick=copyAgentUrl("meshagents?id=43&meshid='+e.split("/")[2]+'&installflags=",1)>'),0<debugmode&&(o+=addHtmlValue("Soubor s nastaveními",'<a id=aginswmshlnk name="meshsettings?id='+e.split("/")[2]+"&installflags=0"+(urlargs.key?"&key="+urlargs.key:"")+'">'+format("{0} nastavení (.msh)",EscapeHtml(n.name))+"</a>")),setDialogMode(2,"Přidat agenta",2,null,o=(o=(o=(o=(o=(o=(o=(o=(o=(o=(o=(o=(o=(o=(o=(o=(o=(o=(o=(o=(o=(o=(o=(o=(o+="</div>")+("<div id=agins_linux style=display:none>"+format('Pro přidání nového zařízení do skupiny „"{0}"“, na něm spusťte následující příkaz. Je třeba spouštět s právy správce systému (root).',EscapeHtml(n.name))+"<br />"))+"<textarea id=agins_linux_area rows=2 cols=20 readonly=readonly style=border-radius:4px;padding:6px;margin-top:4px;margin-bottom:4px;background-color:#FFF9D3;border:0;width:100%;resize:none;height:160px;overflow:auto;font-size:12px></textarea>"+'<div style=font-size:x-small;float:right>* Pro BSD, nejprve spusťte „pkg install wget sudo bash“.</div><a style=text-decoration:none title="Zkopírovat do schránky" onclick=copyAgentIdValue("agins_linux_area")><img src=images/link4.png height=10 width=10 style=cursor:pointer> Kopírovat</a></div>')+("<div id=agins_osx style=display:none>"+format("Pro přidání nového zařízení do skupiny „{0}“, je třeba do počítače, který chcete spravovat, stáhnout a nainstalovat agenta. Ten už obsahuje potřebné informace pro připojení na server.",EscapeHtml(n.name))+"<br /><br />"))+addHtmlValue("Mesh Agent",'<a onclick=downloadFile("meshosxagent?id=16&meshid='+e.split("/")[2]+(urlargs.key?"&key="+urlargs.key:"")+'") title="x86-64bit version of macOS Mesh Agent">macOS x86-64bit</a> <img src=images/link4.png height=10 width=10 title="Kopírovat odkaz pro macOS agenta do schránky" style=cursor:pointer onclick=copyAgentUrl("meshosxagent?id=16&meshid='+e.split("/")[2]+'",0)>'))+addHtmlValue("Mesh Agent",'<a onclick=downloadFile("meshosxagent?id=29&meshid='+e.split("/")[2]+(urlargs.key?"&key="+urlargs.key:"")+'") title="ARM 64bit version of macOS Mesh Agent">macOS ARM (64bit)</a> <img src=images/link4.png height=10 width=10 title="Kopírovat odkaz pro macOS agenta do schránky" style=cursor:pointer onclick=copyAgentUrl("meshosxagent?id=29&meshid='+e.split("/")[2]+'",0)>'))+addHtmlValue("Mesh Agent",'<a onclick=downloadFile("meshosxagent?id=10005&meshid='+e.split("/")[2]+(urlargs.key?"&key="+urlargs.key:"")+'") title="Universal version of macOS Mesh Agent">macOS (Universal)</a> <img src=images/link4.png height=10 width=10 title="Kopírovat odkaz pro macOS agenta do schránky" style=cursor:pointer onclick=copyAgentUrl("meshosxagent?id=10005&meshid='+e.split("/")[2]+'",0)>')+"</div>")+('<div id=agins_qrcode style=display:none;min-height:180px><a id=agins_qrimage_a rel="noreferrer noopener" target=_blank><div id=agins_qrimage style=float:right;margin-left:10px;width:180px;height:180px;cursor:pointer></div></a><div>'+format('Chcete -li přidat mobilní zařízení do skupiny "{0}", stáhněte si aplikaci MeshAgent a naskenujte tento QR kód.',EscapeHtml(n.name))+"</div>"))+"<table style=width:180px>"+'<tr><td style=text-align:center><a title="Google Play obchod"rel="noreferrer noopener" target=_blank href="https://play.google.com/store/apps/details?id=com.meshcentral.agent2"><img style=cursor:pointer src="images/google-play-140.png" width=140 srcset="images/google-play-280.png 2x" /></a></td></tr>')+'<tr><td style=text-align:center><a title="Amazon App Store" rel="noreferrer noopener" target=_blank href="https://www.amazon.co.uk/gp/product/B097Z4Q7SK/"><img style=cursor:pointer src="images/amazon-appstore-140.png"  width=140 srcset="images/amazon-appstore-280.png 2x" /></a></td></tr>'+"</table>")+addHtmlValue("Android APK",'<a onclick=downloadFile("meshagents?id=14'+(urlargs.key?"&key="+urlargs.key:"")+'",null,true) title="APK version of the MeshAgent">APK</a> <img src=images/link4.png height=10 width=10 title="Zkopírujte URL do schránky" style=cursor:pointer onclick=copyAgentUrl("meshagents?id=14&meshid='+e.split("/")[2]+(urlargs.key?"&key="+urlargs.key:"")+'")>')+"</div>")+("<div id=agins_assistant style=display:none><table><tr><td style=vertical-align:top><div>"+format('MeshCentral Assistant je nástroj Windows, který mohou uživatelé použít k požádání o pomoc. Pomocí níže uvedeného odkazu si stáhněte verzi, která se připojí ke skupině zařízení "{0}".',EscapeHtml(n.name))+"</div><div></div><br />"))+('<a id=asinslnk name="meshagents?id=10006&meshid='+e.split("/")[2]+(urlargs.key?"&key="+urlargs.key:"")+'" title="MeshCentral Assistant pro Windows">Assistant pro Windows (.exe)</a> <img src=images/link4.png height=10 width=10 title="Zkopírujte URL do schránky" style=cursor:pointer onclick=copyAgentUrl("meshagents?id=10006&meshid='+e.split("/")[2]+(urlargs.key?"&key="+urlargs.key:"")+'")>'))+'</td><td><img id=agass_img1 src=images/assistant-100.png width=74 height=100 srcset="images/assistant-200.png 2x"><img id=agass_img2 src=images/assistant2-100.png width=74 height=100 srcset="images/assistant2-200.png 2x"></td></tr></table></div>'+"<div id=agins_assistant2 style=display:none><table><tr><td style=vertical-align:top><div>MeshCentral Assistant je nástroj Windows, který mohou uživatelé použít k požádání o pomoc. Pomocí níže uvedeného odkazu si stáhněte verzi, která bude sledovat agenta na pozadí.</div><div></div><br />")+('<a id=asinslnk2 name="meshagents?id=10006&meshid='+e.split("/")[2]+(urlargs.key?"&key="+urlargs.key:"")+'" title="MeshCentral Assistant pro Windows">Assistant pro Windows (.exe)</a> <img src=images/link4.png height=10 width=10 title="Zkopírujte URL do schránky" style=cursor:pointer onclick=copyAgentUrl("meshagents?id=10006&meshid='+e.split("/")[2]+(urlargs.key?"&key="+urlargs.key:"")+'")>'))+'</td><td><img src=images/assistant-100.png width=74 height=100 srcset="images/assistant-200.png 2x"></td></tr></table></div>'+"<div id=agins_windows_un style=display:none>Pro odebrání agenta si stáhněte níže uvedené soubor, spusťte ho a klikněte na „uninstall“.<br /><br />")+addHtmlValue("Mesh Agent",'<a id=aginsw32unlnk name="meshagents?id=3&meshid='+e.split("/")[2]+"&installflags=0"+(urlargs.key?"&key="+urlargs.key:"")+'" title="x86 32bit version of the MeshAgent">Windows x86-32 (.exe)</a> <img src=images/link4.png height=10 width=10 title="Copy Windows x86 32bit agent URL to clipboard" style=cursor:pointer onclick=copyAgentUrl("meshagents?id=3&meshid='+e.split("/")[2]+'&installflags=",1)>'))+addHtmlValue("Mesh Agent",'<a id=aginsw64unlnk name="meshagents?id=4&meshid='+e.split("/")[2]+"&installflags=0"+(urlargs.key?"&key="+urlargs.key:"")+'" title="x86 64bit version of the MeshAgent">Windows x86-64 (.exe)</a> <img src=images/link4.png height=10 width=10 title="Copy Windows x86 64bit agent URL to clipboard" style=cursor:pointer onclick=copyAgentUrl("meshagents?id=4&meshid='+e.split("/")[2]+'&installflags=",1)>'))+addHtmlValue("Mesh Agent",'<a id=aginswa64unlnk name="meshagents?id=43&meshid='+e.split("/")[2]+"&installflags=0"+(urlargs.key?"&key="+urlargs.key:"")+'" title="ARM 64bit version of the MeshAgent">Windows ARM-64 (.exe)</a> <img src=images/link4.png height=10 width=10 title="Copy Windows ARM 64bit agent URL to clipboard" style=cursor:pointer onclick=copyAgentUrl("meshagents?id=43&meshid='+e.split("/")[2]+'&installflags=",1)>')+"</div>")+"<div id=agins_linux_un style=display:none>Pokud chcete agenta odebrat, spusťte následující příkaz a to s právy správce systému (root).<br />"+"<textarea id=agins_linux_area_un rows=2 cols=20 readonly=readonly style=border-radius:4px;padding:6px;margin-top:4px;margin-bottom:4px;background-color:#FFF9D3;border:0;width:100%;resize:none;height:160px;overflow:auto;font-size:12px></textarea>")+'<a style=text-decoration:none title="Zkopírovat do schránky" onclick=copyAgentIdValue("agins_linux_area_un")><img src=images/link4.png height=10 width=10 style=cursor:pointer> Copy</a></div>'+'<div id=agins_osx_un style=display:none>To remove a mesh agent, download the file below, right click on the ".mpkg" file and click "Show Package Contents", then right click on "Uninstall.command" and click "Open"<br /><br />')+addHtmlValue("Mesh Agent",'<a onclick=downloadFile("meshosxagent?id=10005&meshid='+e.split("/")[2]+(urlargs.key?"&key="+urlargs.key:"")+'") title="Universal version of macOS Mesh Agent">macOS Agent (Universal)</a> <img src=images/link4.png height=10 width=10 title="Kopírovat odkaz pro macOS agenta do schránky" style=cursor:pointer onclick=copyAgentUrl("meshosxagent?id=10005&meshid='+e.split("/")[2]+'",0)>'))+"</div>"+"<div id=agins_linux_inst style=display:none>This is a executable on OS's with graphical user interfaces<br /><br />Apple macOS executables will need to be removed from quarantine to run 'xattr -r -d com.apple.quarantine meshagent'<br /><br />You need to 'chmod +x meshagent' and run this file<br /><br />")+addHtmlValue("Mesh Agent",'<a id=aginsbinlnk name="meshagents?id='+e.split("/")[2]+"&installflags=0"+(urlargs.key?"&key="+urlargs.key:"")+'">MeshAgenta</a> <img src=images/link4.png height=10 width=10 title="Zkopírujte URL agenta do schránky" style=cursor:pointer onclick=copyAgentUrl("meshagents?id='+e.split("/")[2]+'&installflags=",1)>'))+addHtmlValue("Příkaz",'<input id=aginsbincmd type=text style="width:216px" readonly value=\'wget -O meshagent'+(0!=(2147483648&features)?" --no-check-certificate":"")+' "https://'+a+r+domainUrl+"meshagents?id="+e.split("/")[2].split("$").join("%24").split("@").join("%40")+'\' /> <img src=images/link4.png height=10 width=10 title="Zkopírujte URL agenta do schránky" style=cursor:pointer onclick=copyAgentIdValue("aginsbincmd")>')+"</div>","fileDownload"),new QRCode(Q("agins_qrimage"),{text:serverinfo.magenturl+","+serverinfo.agentCertHash+","+e.split("/")[2],width:180,height:180,colorDark:"#000000",colorLight:"#EEE",correctLevel:QRCode.CorrectLevel.M}),Q("agins_qrimage_a").setAttribute("href",serverinfo.magenturl+","+serverinfo.agentCertHash+","+e.split("/")[2]),0==(8192&features)?(Q("agins_linux_area").value='(wget "https://'+a+r+domainUrl+"meshagents?script=1"+(urlargs.key?"&key="+urlargs.key:"")+'"'+(0!=(2147483648&features)?" --no-check-certificate":"")+' -O ./meshinstall.sh || wget "https://'+a+r+domainUrl+'meshagents?script=1" --no-proxy'+(0!=(2147483648&features)?" --no-check-certificate":"")+" -O ./meshinstall.sh) && chmod 755 ./meshinstall.sh && sudo -E ./meshinstall.sh https://"+a+r+s+" '"+e.split("/")[2]+"' || ./meshinstall.sh https://"+a+r+s+" '"+e.split("/")[2]+"'\r\n",Q("agins_linux_area_un").value='(wget "https://'+a+r+domainUrl+"meshagents?script=1"+(urlargs.key?"&key="+urlargs.key:"")+'"'+(0!=(2147483648&features)?" --no-check-certificate":"")+' -O ./meshinstall.sh || wget "https://'+a+r+domainUrl+'meshagents?script=1" --no-proxy'+(0!=(2147483648&features)?" --no-check-certificate":"")+" -O ./meshinstall.sh) && chmod 755 ./meshinstall.sh && sudo -E ./meshinstall.sh uninstall https://"+a+r+s+" '"+e.split("/")[2]+"' || ./meshinstall.sh uninstall https://"+a+r+s+" '"+e.split("/")[2]+"'\r\n"):(Q("agins_linux_area").value='wget "https://'+a+r+domainUrl+"meshagents?script=1"+(urlargs.key?"&key="+urlargs.key:"")+'" --no-proxy'+(0!=(2147483648&features)?" --no-check-certificate":"")+" -O ./meshinstall.sh && chmod 755 ./meshinstall.sh && sudo -E ./meshinstall.sh https://"+a+r+s+" '"+e.split("/")[2]+"' || ./meshinstall.sh https://"+a+r+s+" '"+e.split("/")[2]+"'\r\n",Q("agins_linux_area_un").value='wget "https://'+a+r+domainUrl+"meshagents?script=1"+(urlargs.key?"&key="+urlargs.key:"")+'" --no-proxy'+(0!=(2147483648&features)?" --no-check-certificate":"")+" -O ./meshinstall.sh && chmod 755 ./meshinstall.sh && sudo -E ./meshinstall.sh uninstall https://"+a+r+s+" '"+e.split("/")[2]+"' || ./meshinstall.sh uninstall https://"+a+r+s+" '"+e.split("/")[2]+"'\r\n"),Q("aginsSelect").focus(),addAgentToMeshClick()}return!1}function copyAgentIdValue(e){copyTextToClip(Q(e).value)}function copyAgentUrl(e,t){var n=serverinfo.name,n=(-1!=n.indexOf(".")&&0==(2&features)||(n=window.location.hostname),domainUrl.substring(0,domainUrl.length-1),"https://"+n+(443==serverinfo.port?"":":"+serverinfo.port)+domainUrl+e);1==t&&(n+=Q("aginsType").value),n+=urlargs.key?"&key="+urlargs.key:"",5==Q("aginsSelect").value&&(n+="&meshinstall="+Q("aginsSysType").value),7==Q("aginsSelect").value&&(n+="&ac="+Q("asinsType").value),copyTextToClip(n)}function addAgentToMeshClick(){var e=Q("aginsSelect").value;QV("agins_windows",0==e),QV("agins_linux",1==e),QV("agins_osx",2==e),QV("agins_windows_un",3==e),QV("agins_linux_un",4==e),QV("agins_linux_inst",5==e),QV("aginsSysTypeDiv",5==e),QV("agins_qrcode",6==e),QV("agins_assistant",7==e&&4!=Q("asinsType").value),QV("agins_assistant2",7==e&&4==Q("asinsType").value),QV("agins_osx_un",8==e),Q("aginsbinlnk").onclick=function(){downloadFile(Q("aginsbinlnk").name.split("installflags=")[0]+"installflags="+Q("aginsType").value+(urlargs.key?"&key="+urlargs.key:"")+"&meshinstall="+Q("aginsSysType").value)},Q("aginsbincmd").value=Q("aginsbincmd").value.split("&installflags=")[0]+"&installflags="+Q("aginsType").value+(urlargs.key?"&key="+urlargs.key:"")+"&meshinstall="+Q("aginsSysType").value+'"',QV("aginsTypeDiv",0==e||5==e),QV("asinsTypeDiv",7==e),Q("aginsw32lnk").onclick=function(){downloadFile(Q("aginsw32lnk").name.split("installflags=")[0]+"installflags="+Q("aginsType").value+(urlargs.key?"&key="+urlargs.key:""),null,!0)},Q("aginsw64lnk").onclick=function(){downloadFile(Q("aginsw64lnk").name.split("installflags=")[0]+"installflags="+Q("aginsType").value+(urlargs.key?"&key="+urlargs.key:""),null,!0)},Q("aginswa64lnk").onclick=function(){downloadFile(Q("aginswa64lnk").name.split("installflags=")[0]+"installflags="+Q("aginsType").value+(urlargs.key?"&key="+urlargs.key:""),null,!0)},Q("aginsw32unlnk").onclick=function(){downloadFile(Q("aginsw32lnk").name.split("installflags=")[0]+"installflags="+Q("aginsType").value+(urlargs.key?"&key="+urlargs.key:""),null,!0)},Q("aginsw64unlnk").onclick=function(){downloadFile(Q("aginsw64lnk").name.split("installflags=")[0]+"installflags="+Q("aginsType").value+(urlargs.key?"&key="+urlargs.key:""),null,!0)},Q("aginswa64unlnk").onclick=function(){downloadFile(Q("aginswa64lnk").name.split("installflags=")[0]+"installflags="+Q("aginsType").value+(urlargs.key?"&key="+urlargs.key:""),null,!0)},0<debugmode&&(Q("aginswmshlnk").onclick=function(){downloadFile(Q("aginswmshlnk").name.split("installflags=")[0]+"installflags="+Q("aginsType").value+(urlargs.key?"&key="+urlargs.key:""),null,!0)}),Q("asinslnk").onclick=function(){downloadFile(Q("asinslnk").name+"&ac="+Q("asinsType").value,null,!0)},Q("asinslnk2").onclick=function(){downloadFile(Q("asinslnk").name+"&ac="+Q("asinsType").value,null,!0)},7==e&&(QV("agass_img1",Q("asinsType").value<2),QV("agass_img2",2<=Q("asinsType").value))}function validateDeviceToMesh(){QE("idx_dlgOkButton",0<Q("dp1devicename").value.length&&passwordcheck(Q("dp1password").value))}function addDeviceToMeshEx(e,t){var n=Q("dp1username").value,o=(""==n&&(n="admin"),Q("dp1hostname").value);""==o&&(o=Q("dp1devicename").value),meshserver.send({action:"addamtdevice",meshid:t,devicename:Q("dp1devicename").value,hostname:o,amtusername:n,amtpassword:Q("dp1password").value,amttls:Q("dp1tls").value})}function deviceHeaderSet(){0==deviceHeaderId?deviceHeaderId=1:(deviceHeaders["DevxHeader"+deviceHeaderId]=1==deviceHeaderTotal?"1 uzel":format("{0} uzlů",deviceHeaderTotal),deviceHeaderId++,deviceHeaderCount={},deviceHeaderTotal=0)}var powerStateStrings=["",'<span title="Zařízení je zapnuté.">Zapnuto</span>','<span title="Zařízení je ve stavu spánku (S1).">Spí</span>','<span title="Zařízení je ve stavu spánku (S2).">Spí</span>','<span title="Zařízení je v hlubokém spánku (S3).">Hluboký spánek</span>','<span title="Zařízení je hibernováno (S4).">Hibernuje se</span>','<span title="Zařízení je vypnuto (S5).">Soft-Off</span>','<span title="Zařízení je zjištěno, ale nelze zjistit stav jeho napájení.">Připojeno</span>','<span title="Zařízení je vypnuto.">Vypnuto</span>'],powerStateStrings2=["","Zařízení je zapnuté","Zařízení je ve stavu spánku (S1)","Zařízení je ve stavu spánku (S2)","Zařízení je v hlubokém spánku (S3)","Zařízení je hibernováno (S4)","Zařízení je ve stavu soft-off (S5)","Zařízení je přítomno, ale nedaří se zjistit stav napájení","Zařízení je vypnuto"],powerColorTable=["pwsTransparent","pwsBlack","pwsBlue","pwsBlue2","pwsLightblue","pwsBlueviolet","pwsDarkgreen","pwsLightseagreen","pwsLightseagreen2"];function NodeStateStr(e){var t=[];return 0<e.state&&e.state<powerStatetable.length&&state.push(powerStatetable[e.state]),e.conn&&(0!=(1&e.conn)&&(4==e.mtype?"PDU"==e.porttype?t.push('<span title="Vypínač je připraven k použití.">Přepínač</span>'):t.push('<span title="Port IP-KVM je aktivní a připraven k použití.">IP-KVM</span>'):t.push('<span title="Agent je připojen a připraven.">Agent</span>')),0!=(2&e.conn)?t.push('<span title="Intel&reg; AMT CIRA je připojeno a připraveno k použití.">CIRA</span>'):0!=(4&e.conn)&&t.push('<span title="Intel&reg; AMT je směrovatelné.">AMT</span>'),0!=(8&e.conn)&&t.push('<span title="Agent je dostupný pomocí předávání (relay) přes jiného agenta.">Předávání (relay)</span>'),0!=(16&e.conn))&&t.push('<span title="MQTT připojení na zařízení je aktivní.">MQTT</span>'),null!=e.pwr&&0!=e.pwr&&t.push(powerStateStrings[e.pwr]),0==t.length?"&nbsp;":t.join(", ")}function PowerStateStr(e){return e<powerStatetable.length?powerStatetable[e]:""}function PowerStateStr2(e){return 0!=e&&e<powerStatetable.length?powerStatetable[e]:"Neznámé"}function updateCollapseAllButton(){var e=0<Object.keys(CollapsedGroups).length;QV("CollapseAllButton",!e),QV("ExpandAllButton",e),QV("CollapseAllButton2",!e),QV("ExpandAllButton2",e)}function selectallButtonFunction(){for(var e=document.getElementsByClassName("DeviceCheckbox"),t=Object.keys(checkedNodeids).length,n=0;n<e.length;n++)e[n].checked=0==t;if(checkedNodeids={},0==t){checkedNodeids={};for(var o=document.getElementsByName("xxdevice"+Q("viewselect").value),n=0;n<o.length;n++)(null==o[n].parentElement.attributes.style||o[n].parentElement.attributes.style.value.indexOf("display")<0)&&(checkedNodeids[o[n].id.substring(3)]=1)}p1updateInfo()}function p1devcheck(e){e.srcElement.checked?checkedNodeids[e.srcElement.value.substring(6)]=1:delete checkedNodeids[e.srcElement.value.substring(6)],p1updateInfo()}function p1updateInfo(){var e=Object.keys(checkedNodeids).length;if(0<e?(QE("GroupActionButton",!0),Q("SelectAllButton").value="Nevybrat nic",QV("cxmdesktop",!0)):(QE("GroupActionButton",!1),Q("SelectAllButton").value="Vybrat vše",QV("cxmdesktop",!1)),null!=customui&&customui.devicesbarbuttons)for(var t in customui.devicesbarbuttons)"one"==customui.devicesbarbuttons[t].selection&&QE("cui:"+t,1==e),"many"==customui.devicesbarbuttons[t].selection&&QE("cui:"+t,1<=e)}function groupActionFunction(){var e=[],t=getCheckedDevices(),n=0;if(262144&features&&0==count2factoraAuths())setDialogMode(2,"Nastavení zabezpečení",1,null,"Nelze získat přístup k této funkci, dokud není povoleno dvoufaktorové ověřování. To je nutné pro větší bezpečnost. Přejděte na kartu „Můj účet“ a podívejte se do části „Zabezpečení účtu“.");else{if(4194304&features)for(var o in t)if(0!=(16&getNodeFromId(t[o]).conn)){e.push({v:103,name:"Poslat MQTT zprávu"});break}for(var o in e.push({v:105,name:"Export informací o zařízení",s:!0}),t){var i=getNodeFromId(t[o]),a=GetNodeRights(i);1&a&&0==(2&n)&&(n|=2,e.push({v:102,name:"Přesunout do skupiny zařízení"})),0!=(1&i.conn)&&0!=(32768&a)&&0==(1&n)&&(n|=1,e.push({v:104,name:"Odinstalovat agenta"})),64&a&&0==(8&n)&&(n|=8,e.push({v:100,name:"Probudit zařízení"})),262144&a&&0==(4&n)&&(n|=4,e.push({v:4,name:"Uspat zařízení"}),e.push({v:3,name:"Reset zařízení"}),e.push({v:2,name:"Vypnout zařízení"})),131072&a&&0==(16&n)&&(n|=16,e.push({v:106,name:"Spouštějte příkazy"})),16384&a&&0==(32&n)&&(n|=32,e.push({v:108,name:"Oznámení zařízení"})),4&a&&0==(64&n)&&(n|=64,e.push({v:107,name:"Upravit značky"})),8&a&&0==(256&n)&&(n|=256,e.push({v:109,name:"Nahrát soubory"})),32768&a&&0==(128&n)&&(n|=128,e.push({v:101,name:"Smazat zařízení"})),null!=i.agent&&16&features2&&4294967295==a&&0==(512&n)&&(n|=512,e.push({v:110,name:"Vynutit aktualizaci agenta"}),e.push({v:111,name:"Jasné jádro agenta"}),e.push({v:112,name:"Nahrát výchozí jádro serveru"}))}var s="";for(o in e.sort(nameSort),e)s+="<option value="+e[o].v+(e[o].s?" selected":"")+">"+e[o].name+"</option>";var r="Vyberte operaci, kterou chcete provést na všech vybraných zařízeních. Akce budou prováděny pouze s náležitými právy.<br /><br />";setDialogMode(2,"Akce skupiny",3,groupActionFunctionEx,r+=addHtmlValue("Operace","<select id=d2groupop>"+s+"</select>"))}}function getCheckedDevices(){return Object.keys(checkedNodeids)}function uncheckAllDevices(){for(var e=document.getElementsByClassName("DeviceCheckbox"),t=0;t<e.length;t++)e[t].checked=!1;checkedNodeids={}}function groupActionFunctionEx(){var e=Q("d2groupop").value;if(100==e)meshserver.send({action:"wakedevices",nodeids:getCheckedDevices()}),uncheckAllDevices();else if(101==e){var t=getCheckedDevices(),n="";if(0!=t.length){if(1==t.length)n+="Potvrdit odebrání vybraného zařízení?<br /><br />";else{n+=format("Potvrdit odebrání {0} vybraných zařízení?<br />",t.length);var o=0,i=0;for(l in t)null!=(d=getNodeFromId(t[l])).conn&&0<d.conn?o++:i++;var a="";1==o?a+=format("1 vybrané zařízení je online.<br />",o):1<o&&(a+=format("Vybraná zařízení ({0}) jsou online.<br />",o)),1==i?a+=format("1 vybrané zařízení je offline.<br />",i):1<i&&(a+=format("Vybraná zařízení ({0}) jsou offline.<br />",i)),n+=""!=a?"<div style=padding:8px>"+a+"</div>":"<br />"}setDialogMode(2,"Odstranit zařízení",3,d2groupActionFunctionDelExec,n+="<label><input id=d2check type=checkbox onchange=d2groupActionFunctionDelCheck() />Potvrdit</label>"),QE("idx_dlgOkButton",!1)}}else if(102==e)p10showChangeGroupDialog(getCheckedDevices());else if(103==e)p10showSendMqttMsgDialog(getCheckedDevices());else if(104==e)p10showSendUninstallAgentDialog(getCheckedDevices());else if(105==e)p2downloadDeviceInfo();else if(106==e)d2runCommandDialog({nodeids:getCheckedDevices(),title:"Spouštění příkazů na vybraných zařízeních.",func:uncheckAllDevices});else if(107==e){var n="Proveďte dávkovou operaci značky zařízení<br /><br />",s=(n=(n+=addHtmlValue("Operace","<select id=d2deviceop style=float:right;width:250px><option value=1>Přidat štítky</option><option value=2>Nastavit značky</option><option value=3>Odeberte štítky</option></select>"))+addHtmlValue("Štítky",'<input id=dp10devicevalue maxlength=4096 placeholder="Štítek1, Štítek2, Štítek3" />'),[]),a="";for(l in nodes)if(nodes[l].tags)for(var r in nodes[l].tags)-1==s.indexOf(nodes[l].tags[r])&&s.push(nodes[l].tags[r]);if(0<s.length){for(var l in s.sort(),s)a+='<span style=padding:4px;background-color:#BBB;border-radius:3px;cursor:pointer onclick=showEditNodeValueDialogAddTag("'+encodeURIComponentEx(s[l])+'")>'+EscapeHtml(s[l])+"</span> ";n+="<div style=margin-top:8px;width:370px;line-height:26px;max-height:160px;overflow-y:auto>"+a+"</div>"}setDialogMode(2,"Upravit značky zařízení",3,d2groupActionFunctionTagsExec,n)}else if(108==e){var n="<div style=margin-bottom:4px>Proveďte dávkové oznámení zařízení</div>";setDialogMode(2,"Oznámení zařízení",3,d2groupActionFunctionNotifyExec,n=(n=(n=(n=(n=(n+="<select id=d2deviceop style=width:100%;margin-bottom:4px><option value=2>Oznámení přípitku</option><option value=1>Schránka se zprávou</option><option value=3>Alert Box</option></select>")+'<input id=dp2notifyTitle maxlength=256 placeholder="Titul" style=width:100%;box-sizing:border-box;margin-bottom:4px />'+"<textarea id=d2notifyMsg style=background-color:#fcf3cf;width:100%;height:140px;resize:none;overflow-y:scroll;box-sizing:border-box;margin-bottom:4px></textarea>")+"<select style=width:100% id=d2notifyTimeout>"+'<option disabled value="">Only Applicable to Message Box Notifications</option>')+"<option value=2 selected>Show for 2 Minutes (Default)</option>"+"<option value=10>Show for 10 minutes</option>")+"<option value=30>Show for 30 minutes</option>"+"<option value=60>Show for 60 minutes</option>")+"<option value=0>Zobrazit zprávu, dokud ji uživatel nezavře</option>"+"</select>"),Q("d2notifyMsg").focus()}else if(109==e){var d,u=!1,c=!1;for(l in t=getCheckedDevices())(d=getNodeFromId(t[l])).agent&&(0<d.agent.id&&d.agent.id<5||34==d.agent.id?u=!0:c=!0);var n="Nahrajte vybrané soubory do všech vybraných zařízení<br /><br />";n=(n+="<form method=post enctype=multipart/form-data action=uploadfilebatch.ashx target=fileUploadFrame>")+("<input type=hidden name=authCookie value="+authCookie+" /><input type=hidden name=nodeIds value="+t.join(",")+" /><input type=submit id=d2batchUploadSubmit style=display:none />")+'<input type=file name=files id=d2uploadinput style=width:100% multiple=multiple onchange="d2batchUploadValidate()" /><br /><br />',u&&(n+=addHtmlValue("Windows cesta",'<input style=width:250px type=text onchange="d2batchUploadValidate()" onkeyup="d2batchUploadValidate()" name=winpath id=d2winuploadpath placeholder="C:\\temp" value="" />')),c&&(n+=addHtmlValue("Cesta Linuxu",'<input style=width:250px type=text onchange="d2batchUploadValidate()" onkeyup="d2batchUploadValidate()" name=linuxpath id=d2linuxuploadpath placeholder="/tmp" value="" />')),setDialogMode(2,"Dávkové nahrávání souborů",3,d2batchUploadValidateOk,n=n+"<br /><label><input type=checkbox name=createFolder />Vytvořit složku, pokud neexistuje?</label><br />"+"<label><input type=checkbox name=overwriteFiles />Přepsat, pokud soubor existuje?</label></form>"),d2batchUploadValidate()}else 110==e?setDialogMode(2,"Vynutit aktualizaci agenta",3,d2groupActionFunctionAgentUpdateExec,n="Vynutit aktualizaci agenta na vybraných zařízeních?<br /><br />"):111==e?setDialogMode(2,"Jasné jádro agenta",3,d2groupActionFunctionAgentClearCoreExec,n="Vymazat jádro agenta na vybraných zařízeních?<br /><br />"):112==e?setDialogMode(2,"Nahrát výchozí jádro serveru",3,d2groupActionFunctionAgentDefaultCodeExec,n="Nahrát výchozí jádro serveru na vybraná zařízení?<br /><br />"):(meshserver.send({action:"poweraction",nodeids:getCheckedDevices(),actiontype:parseInt(e)}),uncheckAllDevices())}function d2batchUploadValidate(){QE("idx_dlgOkButton",!(0==Q("d2uploadinput").files.length||null!=Q("d2winuploadpath")&&""==Q("d2winuploadpath").value||null!=Q("d2linuxuploadpath")&&""==Q("d2linuxuploadpath").value))}function d2batchUploadValidateOk(){Q("d2batchUploadSubmit").click()}function d2groupActionFunctionAgentUpdateExec(){meshserver.send({action:"updateAgents",nodeids:getCheckedDevices()})}function d2groupActionFunctionAgentClearCoreExec(){meshserver.send({action:"uploadagentcore",nodeids:getCheckedDevices(),type:"clear"})}function d2groupActionFunctionAgentDefaultCodeExec(){meshserver.send({action:"uploadagentcore",nodeids:getCheckedDevices(),type:"default"})}function d2groupActionFunctionNotifyExec(){var e=Q("d2deviceop").value,t=Q("dp2notifyTitle").value,n=Q("d2notifyMsg").value,o=getCheckedDevices(),i=parseFloat(Q("d2notifyTimeout").value);if(0!=n.length)if(""==(t=""==t?decodeURIComponent("{{{extitle}}}"):t)&&(t="MeshCentral"),isNaN(i)&&(i=2),1==e)for(var a=0;a<o.length;a++)meshserver.send({action:"msg",type:"messagebox",nodeid:o[a],title:t,msg:n,timeout:6e4*i});else if(2==e)meshserver.send({action:"toast",nodeids:o,title:t,msg:n});else if(3==e)for(a=0;a<o.length;a++)meshserver.send({action:"msg",type:"alertbox",nodeid:o[a],title:t,msg:n})}function d2groupActionFunctionTagsExec(){var e=getCheckedDevices(),t=Q("d2deviceop").value,n=Q("dp10devicevalue").value;if(2==t)for(var o in e)meshserver.send({action:"changedevice",nodeid:e[o],tags:n});else{var i=[];for(o in n=n.split(",")){var a=n[o].trim();0<a.length&&a.length<64&&-1==i.indexOf(a)&&i.push(a)}for(o in e){var s=null,r=!1,l=getNodeFromId(e[o]);null==(s=null!=l.tags?Clone(l.tags):s)&&(s=[]);for(var d,u=0;u<n.length;u++)1==t&&-1==s.indexOf(n[u])&&(s.push(n[u]),r=!0),3==t&&0<=(d=s.indexOf(n[u]))&&(s.splice(d,1),r=!0);r&&meshserver.send({action:"changedevice",nodeid:e[o],tags:s.join(",")})}}}function p2downloadDeviceInfo(){if(!xxdialogMode){var e,t=getCheckedDevices(),n=!1;for(e in t)null!=getNodeFromId(t[e]).intelamt&&(n=!0);var o="Stáhněte si seznam zařízení s jedním z níže uvedených formátů souborů.<br /><br />",o=(o+=addHtmlValue("CSV formát","<a href=# style=cursor:pointer onclick='return p2downloadDeviceInfoCSV()'>devicelist.csv</a>"))+addHtmlValue("JSON formát","<a href=# style=cursor:pointer onclick='return p2downloadDeviceInfoJSON()'>devicelist.json</a>");n&&(o+=addHtmlValue("Intel&reg; AMT JSON","<a href=# style=cursor:pointer onclick='return p2downloadAmtInfoJSON()'>computerlist.json</a>")),setDialogMode(2,"Export informací o zařízení",1,null,o+="<div style=margin-top:8px><label><input type=checkbox id=d2DevInfoDetailsCheck />Zahrnout podrobnosti o zařízení</label></div>")}}function csvClean(e){return null==e?"":e.split(",").join("")}function p2downloadDeviceInfoCSV(){var e=getCheckedDevices();if(Q("d2DevInfoDetailsCheck").checked){var t=null;try{t=Intl.DateTimeFormat().resolvedOptions().timeZone}catch(e){}meshserver.send({action:"getDeviceDetails",nodeids:e,tz:t,tf:(new Date).getTimezoneOffset(),l:getLang(),type:"csv"})}else{var n,o="id,name,rname,host,icon,ip,osdesc,state,groupname,conn,pwr,av,update,firewall,bitlocker,avdetails,tags,lastbootuptime\r\n";for(n in e){var i=getNodeFromId(e[n]);if(o+='"'+i._id.split(",").join("")+'","'+i.name.split(",").join("")+'","'+(i.rname?i.rname.split(",").join(""):"")+'","'+(i.host?i.host.split(",").join(""):"")+'","'+i.icon+'","'+(i.ip||"")+'","'+(i.osdesc?i.osdesc.split(",").join(""):"")+'","'+i.state+'","'+meshes[i.meshid].name.split(",").join("")+'","'+(i.conn||"")+'","'+(i.pwr||"")+'"',"object"==typeof i.wsc?o+=',"'+csvClean(i.wsc.antiVirus)+'","'+csvClean(i.wsc.autoUpdate)+'","'+csvClean(i.wsc.firewall)+'"':o+=",,,","object"==typeof i.volumes){var a="",s=!0;for(d in i.volumes)void 0!==i.volumes[d].protectionStatus&&(s?s=!1:a+="|",a+=d+"/"+i.volumes[d].volumeStatus);o+=',"'+csvClean(a)+'"'}else o+=",";if("object"==typeof i.av){var r="",l=!0;for(d in i.av)"string"==typeof i.av[d].product&&(l?l=!1:r+="|",r+=i.av[d].product+"/"+(i.av[d].enabled?"enabled":"disabled")+"/"+(i.av[d].updated?"updated":"notupdated"));o+=',"'+csvClean(r)+'"'}else o+=",";if("object"==typeof i.tags){var d,u="",c=!0;for(d in i.tags)c?c=!1:u+="|",u+=i.tags[d];o+=',"'+csvClean(u)+'"'}else o+=",";"number"==typeof i.lastbootuptime&&(o+=',"'+i.lastbootuptime+'"'),o+="\r\n"}saveAs(stringToUtf8Blob(o),"devicelist.csv")}return!1}function p2downloadAmtInfoJSON(){var e,t=getCheckedDevices(),n={webappversion:"0.9.0",computers:[]};for(e in t){var o,i=getNodeFromId(t[e]);null!=i.intelamt&&(o={name:i.name,host:i.host,user:i.intelamt.user,pass:"",tls:1==i.intelamt.tls?1:0,ver:i.intelamt.ver,pstate:i.intelamt.state},2==i.intelamt.state&&(o.pmode=1),i.intelamt.realm&&(o.digestrealm=i.intelamt.realm),i.intelamt.hash&&(o.tlscerthash=i.intelamt.hash),n.computers.push(o))}saveAs(new Blob([JSON.stringify(n,null,2)],{type:"application/octet-stream"}),"computerlist.json")}function p2downloadDeviceInfoJSON(){var e=getCheckedDevices();if(Q("d2DevInfoDetailsCheck").checked){var t=null;try{t=Intl.DateTimeFormat().resolvedOptions().timeZone}catch(e){}meshserver.send({action:"getDeviceDetails",nodeids:e,tz:t,tf:(new Date).getTimezoneOffset(),l:getLang(),type:"json"})}else{var n,o=[];for(n in e)o.push(getNodeFromId(e[n]));saveAs(new Blob([JSON.stringify(o,null,2)],{type:"application/octet-stream"}),"devicelist.json")}return!1}function d2groupActionFunctionDelCheck(){QE("idx_dlgOkButton",Q("d2check").checked)}function d2groupActionFunctionDelExec(){meshserver.send({action:"removedevices",nodeids:getCheckedDevices()}),uncheckAllDevices()}function d2runCommandDialog(e){var t,n=!1,o=!1,i=!1;for(t in e.nodeids){var a=getNodeFromId(e.nodeids[t]);a.agent&&(24==(24&GetNodeRights(a))&&(i=!0),0<a.agent.id&&a.agent.id<5?n=!0:o=!0)}if(1==n||1==o||1==i){var s={type:1,runAs:0,source:1,cmd:""};try{s=JSON.parse(getstore("runopt",s))}catch(e){}e.selectedFile&&(r=e.selectedFile.name.toLowerCase(),console.log("filename",r),r.endsWith(".bat")&&(s.type=1),r.endsWith(".ps1")&&(s.type=2),r.endsWith(".sh")&&(s.type=3),r.endsWith(".agentconsole"))&&(s.type=4);var r="";e.title&&(r+=e.title+"<br />"),r+="<select id=d2cmdtype onclick=d2runCommandValidate() style=width:100%;margin-bottom:4px;margin-top:4px>",1==n&&(r+="<option value=1"+(1==s.type?" selected":"")+">Příkazový řádek systému Windows</option><option value=2"+(2==s.type?" selected":"")+">Windows PowerShell</option>"),1==o&&(r+="<option value=3"+(3==s.type?" selected":"")+">Linux / BSD / macOS Command Shell</option>"),1==i&&(r+="<option value=4"+(4==s.type?" selected":"")+">Konzole agenta</option>"),r=r+"</select>"+("<select id=d2cmduser style=width:100%;margin-bottom:4px><option value=0"+(0==s.runAs?" selected":"")+">Spustit jako agent</option><option value=1"+(1==s.runAs?" selected":"")+">Spustit jako uživatel, agent, pokud žádný uživatel</option><option value=2"+(2==s.runAs?" selected":"")+">Musí běžet jako uživatel</option></select>"),null==e.selectedFile&&(r+="<select id=d2cmdsource onclick=d2runCommandValidate() style=width:100%;margin-bottom:4px><option value=0"+(0==s.source?" selected":"")+">Příkazy z textového pole</option><option value=1"+(1==s.source?" selected":"")+">Příkazy ze souboru</option>",8&userinfo.siteadmin&&(r+="<option value=2"+(2==s.source?" selected":"")+">Příkazy ze souboru na serveru</option>"),r=r+("</select><textarea id=d2runcmd onkeyup=d2runCommandValidate() style=background-color:#fcf3cf;width:100%;height:200px;resize:none;overflow-y:scroll>"+(s.cmd?EscapeHtml(decodeURIComponent(s.cmd)):""))+"</textarea><div id=d2runfile style=display:none><input id=d2runfileex type=file onchange=d2runCommandValidate() id=d2localFile name=files onchange=d2runCommandValidate() /></div>",8&userinfo.siteadmin)&&(r+='<div id=d2runsfile style=display:none><div id=d2serveraction valign=bottom><input type=button id=p2FolderUp disabled="disabled" onclick=d3folderup() value="Up" />&nbsp;<span id=p2CurrentFolder></span></div><div id=d2serverfiles></div></div>'),setDialogMode(2,"Spustit příkazy",3,d2groupActionFunctionRunCommands,r,e),null==e.selectedFile&&(Q("d2runcmd").focus(),8&userinfo.siteadmin)&&(d3fileoptions={dialog:2,files:"d2serverfiles",folderup:"p2FolderUp",currentFolder:"p2CurrentFolder",func:null},d3updatefiles()),d2runCommandValidate()}}function d2runCommandValidate(){var e;QV("d2cmduser",Q("d2cmdtype").value<4),null==xxdialogTag.selectedFile?(QV("d2runcmd",0==Q("d2cmdsource").value),QV("d2runfile",1==Q("d2cmdsource").value),QV("d2runsfile",2==Q("d2cmdsource").value),e=!1,0==Q("d2cmdsource").value&&0<Q("d2runcmd").value.length&&(e=!0),1==Q("d2cmdsource").value&&1==Q("d2runfileex").files.length&&(e=!0),2==Q("d2cmdsource").value&&(e=!1),QE("idx_dlgOkButton",e)):QE("idx_dlgOkButton",!0)}function d2groupActionFunctionRunCommands(e,t){var n=3;try{n=parseInt(Q("d2cmdtype").value)}catch(e){}null==t.selectedFile&&putstore("runopt",JSON.stringify({type:n,runAs:parseInt(Q("d2cmduser").value),source:parseInt(Q("d2cmdsource").value),cmd:encodeURIComponent(Q("d2runcmd").value)}));var o,i={action:"runcommands",nodeids:t.nodeids,type:n,runAsUser:parseInt(Q("d2cmduser").value)};t.selectedFile?((o=new FileReader).onload=function(e){i.cmds=e.target.result,meshserver.send(i),t.func&&t.func()},o.readAsText(t.selectedFile)):0==Q("d2cmdsource").value?(i.cmds=Q("d2runcmd").value,meshserver.send(i),t.func&&t.func()):1==Q("d2cmdsource").value?((o=new FileReader).onload=function(e){i.cmds=e.target.result,meshserver.send(i),t.func&&t.func()},o.readAsText(Q("d2runfileex").files[0])):2==Q("d2cmdsource").value&&1==(n=d3getFileSel()).length&&(i.cmdpath=d3filetreelocation.join("/")+"/"+n[0],meshserver.send(i),t.func)&&t.func()}function onSortSelectChange(e){sort=document.getElementById("sortselect").selectedIndex,e||putstore("sort",sort)}var sortCollator=new Intl.Collator(void 0,{numeric:!0,sensitivity:"base"});function nameSort(e,t){e=e.name.toLowerCase(),t=t.name.toLowerCase();return sortCollator.compare(e,t)}function meshSort(e,t){var n=sortCollator.compare(e.meshnamel,t.meshnamel);return 0!=n||0!=(n=sortCollator.compare(e.meshid,t.meshid))?n:1==showRealNames?sortCollator.compare(e.rnamel,t.rnamel):sortCollator.compare(e.namel,t.namel)}function powerSort(e,t){var n=e.pwr||0,o=t.pwr||0;return o<n?-1:n<o?1:n==o?1==showRealNames?sortCollator.compare(e.rnamel,t.rnamel):sortCollator.compare(e.namel,t.namel):void 0}function deviceSort(e,t){return sortCollator.compare(e.namel,t.namel)}function deviceHostSort(e,t){return sortCollator.compare(e.rnamel,t.rnamel)}function lastConnectSort(e,t){var n=e.lastconnect,o=t.lastconnect;return null==n&&(n=99999999999999),null==o&&(o=99999999999999),(n=0<e.conn?99999999999998:n)==(o=0<t.conn?99999999999998:o)?nameSort(e,t):n-o}function onSearchFocus(e){searchFocus=e}function clearDeviceSearch(){Q("KvmSearchInput").value=Q("SearchInput").value="",onOnlineCheckBox(),mainUpdate(1)}function onMapSearchFocus(e){mapSearchFocus=e}function onUserSearchFocus(e){userSearchFocus=e}function onConsoleFocus(e){consoleFocus=e}function parseSearchAndInput(e){var t,n=e.split(" a "),o=null;for(t in n){var i=getDevicesThatMatchFilter(n[t]);if(null==o)o=i;else{var a,s=[];for(a in i)0<=o.indexOf(i[a])&&s.push(i[a]);o=s}}return o}function parseSearchOrInput(e){var t,n=e.split(" nebo "),o=null;for(t in n){var i=parseSearchAndInput(n[t]);if(null==o)o=i;else for(var a in i)o.indexOf(0<=i[a])&&o.push(i[a])}return o}function getDevicesThatMatchFilter(e){var t=[],n=null,o=null,i=null,a=null,s=null,r=null,l=null,d=null,u=null;if(e.startsWith("uživatel:".toLowerCase())?n=e.substring("uživatel:".length):e.startsWith("u:".toLowerCase())?n=e.substring("u:".length):e.startsWith("ip:".toLowerCase())?o=e.substring("ip:".length):e.startsWith("skupina:".toLowerCase())?i=e.substring("skupina:".length):e.startsWith("s:".toLowerCase())?i=e.substring("s:".length):e.startsWith("štítek:".toLowerCase())?a=e.substring("štítek:".length):e.startsWith("š:".toLowerCase())?a=e.substring("š:".length):e.startsWith("atag:".toLowerCase())?s=e.substring("atag:".length):e.startsWith("a:".toLowerCase())?s=e.substring("a:".length):e.startsWith("os:".toLowerCase())?l=e.substring("os:".length):e.startsWith("amt:".toLowerCase())?d=e.substring("amt:".length):e.startsWith("popis:".toLowerCase())?u=e.substring("popis:".length):"wsc:ok"==e?r=1:"wsc:noav"==e?r=2:"wsc:noupdate"==e?r=3:"wsc:nofirewall"==e?r=4:"wsc:any"==e&&(r=5),""==e)for(var c in nodes)t.push(c);else if(null!=o)for(var c in nodes)null!=nodes[c].ip&&0<=nodes[c].ip.toLowerCase().indexOf(o)&&t.push(c);else if(null!=i)for(var c in nodes)0<=meshes[nodes[c].meshid].name.toLowerCase().indexOf(i)&&t.push(c);else if(null!=a){for(var c in nodes)if(null==nodes[c].tags&&""==a)t.push(c);else if(null!=nodes[c].tags)for(var p in nodes[c].tags)if(0<=nodes[c].tags[p].toLowerCase().indexOf(a)){t.push(c);break}}else if(null!=s)for(var c in nodes)(null!=nodes[c].agent&&null==nodes[c].agent.tag&&""==s||null!=nodes[c].agent&&null!=nodes[c].agent.tag&&0<=nodes[c].agent.tag.toLowerCase().indexOf(s))&&t.push(c);else if(null!=n){for(var c in nodes)if(nodes[c].users&&0<nodes[c].users.length)for(var m in nodes[c].users)0<=nodes[c].users[m].toLowerCase().indexOf(n)&&t.push(c)}else if(null!=l)for(var c in nodes)null!=nodes[c].osdesc&&0<=nodes[c].osdesc.toLowerCase().indexOf(l)&&t.push(c);else if(null!=d)for(var c in nodes)null==nodes[c].intelamt||""!=d&&nodes[c].intelamt.state!=d||t.push(c);else if(null!=u)for(var c in nodes)null!=nodes[c].desc&&""!=nodes[c].desc&&(""==u||0<=nodes[c].desc.toLowerCase().indexOf(u))&&t.push(c);else if(null!=r)for(var c in nodes)!nodes[c].wsc||(1==r&&"OK"==nodes[c].wsc.antiVirus&&"OK"==nodes[c].wsc.autoUpdate&&"OK"==nodes[c].wsc.firewall||(2==r||5==r)&&"OK"!=nodes[c].wsc.antiVirus||(3==r||5==r)&&"OK"!=nodes[c].wsc.autoUpdate||(4==r||5==r)&&"OK"!=nodes[c].wsc.firewall)&&t.push(c);else if("*"==e)for(var c in nodes)1==stars[nodes[c]._id]&&t.push(c);else try{var v=e.split(/\s+/).join("|"),g=new RegExp(v);for(c in nodes)32768&features2?268435456&features2?(g.test(nodes[c].name.toLowerCase())||g.test(meshes[nodes[c].meshid].name.toLowerCase())||null!=nodes[c].rnamel&&g.test(nodes[c].rnamel.toLowerCase()))&&t.push(c):(g.test(nodes[c].name.toLowerCase())||null!=nodes[c].rnamel&&g.test(nodes[c].rnamel.toLowerCase()))&&t.push(c):268435456&features2?showRealNames?(null!=nodes[c].rnamel&&g.test(nodes[c].rnamel.toLowerCase())||g.test(meshes[nodes[c].meshid].name.toLowerCase()))&&t.push(c):(g.test(nodes[c].name.toLowerCase())||g.test(meshes[nodes[c].meshid].name.toLowerCase()))&&t.push(c):showRealNames?null!=nodes[c].rnamel&&g.test(nodes[c].rnamel.toLowerCase())&&t.push(c):g.test(nodes[c].name.toLowerCase())&&t.push(c)}catch(e){for(var c in nodes)t.push(c)}return t}function onSearchInputChanged(){var e=Q("SearchInput").value.toLowerCase().trim(),t=(putstore("_search",Q("SearchInput").value),QS("SearchInput")["background-color"]=QS("KvmSearchInput")["background-color"]=""==e?null:"#FDFFBE",QV("SearchInputClearButton",""!=e),QV("KvmSearchInputClearButton",""!=e),parseSearchOrInput(e));for(o in nodes)nodes[o].v=0<=t.indexOf(o);var n,e=Q("DevFilterSelect").value;if(1==e)for(var o in nodes)null!=nodes[o].conn&&0!=nodes[o].conn||3==nodes[o].mtype||(nodes[o].v=!1);if(2==e)for(var o in nodes)(null==(n=nodes[o]).sessions||null==n.sessions.kvm&&null==n.sessions.terminal&&null==n.sessions.files&&null==n.sessions.tcp&&null==n.sessions.udp)&&(n.v=!1);if(3==e)for(var o in nodes)1!=stars[nodes[o]._id]&&(nodes[o].v=!1);if(4==e)for(var o in nodes)null==nodes[o].intelamt&&(nodes[o].v=!1);if(5==e)for(var o in nodes)null!=nodes[o].conn&&0!=nodes[o].conn&&(nodes[o].v=!1);if(6==e)for(var o in nodes)null!=(n=nodes[o]).sessions&&null!=n.sessions.help||(n.v=!1);if(7==e)for(var o in nodes)null!=(n=nodes[o]).tags&&0!=n.tags.length||(n.v=!1);if(8==e)for(var o in nodes)null!=(n=nodes[o]).tags&&0<n.tags.length&&(n.v=!1)}var contextelement=null;function handleContextMenu(e){if(hideContextMenu(),!xxdialogMode){for(var t=null!==window.pageXOffset?window.pageXOffset:(document.documentElement||document.body.parentNode||document.body).scrollLeft,n=null!==window.pageYOffset?window.pageYOffset:(document.documentElement||document.body.parentNode||document.body).scrollTop,o=document.elementFromPoint(e.pageX-t,e.pageY-n);o&&null!=o&&null==o.attributes.cmenu;)o=o.parentElement;if(null==o)return!0;var i=o.attributes.cmenu.value;switch(i){case"filesConnectButton":if(null==currentNode||null==currentNode.agent)return!0;contextelement=o,showContextMenuDiv(document.getElementById("filesShellContextMenu"),e.pageX,e.pageY);break;case"termConnectButton":if(null==currentNode||null==currentNode.agent||3==currentNode.mtype)return!0;if(serverinfo.linuxshell&&4<currentNode.agent.id)return;contextelement=o;var a=document.getElementById("termShellContextMenu");4<currentNode.agent.id&&!isWindowsNode(currentNode)&&(a=document.getElementById("termShellContextMenuLinux")),showContextMenuDiv(a=34==currentNode.agent.id?document.getElementById("termShellContextMenu2"):a,e.pageX,e.pageY);break;case"deskConnectButton":if(null==currentNode||null==currentNode.agent)return!0;contextelement=o,showContextMenuDiv(document.getElementById("deskConnectContextMenu"),e.pageX,e.pageY);break;case"deskDisconnectButton":if(null==currentNode||null==currentNode.agent)return!0;contextelement=o,showContextMenuDiv(document.getElementById("deskDisconnectContextMenu"),e.pageX,e.pageY);break;case"devsContentMenu":contextelement=o;showContextMenuDiv(a=document.getElementById("contextMenu"),e.pageX,e.pageY);var s=getNodeFromId((s=(1==Q("viewselect").value?contextelement.children[0].children[0].children[1].children[0]:contextelement.children[1]).attributes.onmouseup.value).substring(12,s.length-18)),r=GetNodeRights(s),l=0!=(16&r),d=4294967295==r||0==(512&r),u=4294967295==r||0==(1024&r);QV("cxdesktop",0!=(1&s.conn)&&4!=s.mtype&&(1==s.mtype||null==s.agent||null==s.agent.caps||0!=(1&s.agent.caps)||s.intelamt&&2==s.intelamt.state)&&(8&r||256&r)&&(4294967295==r||0==(65536&r))),QV("cxterminal",0!=(1&s.conn)&&4!=s.mtype&&(1==s.mtype||null==s.agent||null==s.agent.caps||0!=(2&s.agent.caps)||s.intelamt&&2==s.intelamt.state)&&8&r&&d),QV("cxfiles",4!=s.mtype&&2==s.mtype&&(null==s.agent||null==s.agent.caps||0!=(4&s.agent.caps))&&8&r&&u),QV("cxevents",null!=s.intelamt&&(2==s.intelamt.state||2&s.conn)&&8&r),QV("cxdetails",s.mtype<3),QV("cxwebvnc",(0!=(1&s.conn)||3==s.mtype)&&s.agent&&0!=(8&r)&&0==(536870912&features)),QV("cxwebrdp",(0!=(1&s.conn)||3==s.mtype)&&s.agent&&0!=(8&r)&&0==(1073741824&features)),QV("cxwebssh",512&features2&&(0!=(1&s.conn)||3==s.mtype)&&s.agent&&0!=(8&r)),QV("cxconsole",l&&2==s.mtype&&(null==s.agent||null==s.agent.caps||0!=(8&s.agent.caps))&&8&r),QV("cxrdp",!1),0==(1&s.conn)&&3!=s.mtype||!s.agent||0==(8&r)||0<s.agent.id&&s.agent.id<5&&("win32"!=navigator.platform.toLowerCase()||null!=serverinfo.devicemeshrouterlinks&&0==serverinfo.devicemeshrouterlinks.rdp||QV("cxrdp",!0)),QV("cxmgroupsplit",!0),QV("cxstar",!0);break;default:if(null==(a=document.getElementById(i)))return!0;contextelement=o,showContextMenuDiv(a,e.pageX,e.pageY)}return haltEvent(e)}}function showContextMenuDiv(e,t,n){var o=document.documentElement.getBoundingClientRect(),i=o.height,o=o.width;e.style.left=e.style.right=e.style.top=e.style.bottom=null,o/2<t?e.style.right=o-event.pageX+"px":e.style.left=event.pageX+"px",i/2<n?e.style.bottom=i-event.pageY+"px":e.style.top=event.pageY+"px",e.style.display="block"}function cmaction(e,t){var n,o=(1==Q("viewselect").value?contextelement.children[0].children[0].children[1].children[0]:contextelement.children[1]).attributes.onmouseup.value;if(o=o.substring(12,o.length-18),9==e&&(Q("viewselect").value=3,Q("viewselect").onchange(),Q("autoConnectDesktopCheckbox").checked=!0,Q("autoConnectDesktopCheckbox").onclick()),0<e&&e<9&&(n=[0,10,12,11,13,16,17,15,19][e],t&&1==t.shiftKey?safeNewWindow(window.location.origin+"?node="+o.split("/")[2]+"&viewmode="+n+"&hide=16"+(urlargs.key?"&key="+urlargs.key:""),"meshcentral:"+o):(gotoDevice(o,n),t=meshes[currentNode.meshid],1&currentNode.conn&&2==t.mtype&&(11==n&&null==desktop&&1&currentNode.agent.caps&&connectDesktop(null,3),12==n&&null==terminal&&2&currentNode.agent.caps&&connectTerminal(null,1),13==n)&&null==files&&connectFiles(null))),10==e){for(var i=document.getElementsByClassName("DeviceCheckbox"),a=[],s=0;s<i.length;s++)!0===i[s].checked&&a.push(i[s].defaultValue.substring(6));for(s in 0==a.length&&a.push(o),a)null!=stars[a[s]]&&(delete stars[a[s]],delete a[s]);var r=Object.keys(stars).length;for(s in a)r<200&&null==stars[a[s]]&&(stars[a[s]]=1,r++);putstore("stars",JSON.stringify(stars)),updateDeviceViewDevice(o),3==Q("DevFilterSelect").value&&mainUpdate(1)}else 11==e?p10mstsc(o):12==e?p10rfb(o):13==e?p10ssh(o):14==e&&p10MCRouter(o,3)}function cmmeshaction(e){var t=contextelement.attributes.onclick.value.substring(10,contextelement.attributes.onclick.value.length-2),n=document.getElementsByClassName("DeviceCheckbox");if(1==e||2==e){for(var o=0;o<n.length;o++)n[o].attributes&&n[o].attributes.class.value.split(" ")[0]==t&&(n[o].checked=1==e);if(1==e)for(var o in nodes)nodes[o].meshid==t&&1==nodes[o].v&&(checkedNodeids[nodes[o]._id]=1);else if(2==e)for(var o in checkedNodeids){var i=getNodeFromId(o);null!=i&&i.meshid==t&&1==i.v&&delete checkedNodeids[o]}}p1updateInfo()}function cmconnectfilesaction(){connectFiles(null,1,32)}function cmtermaction(e,t){e<100?connectTerminal(null,1,{protocol:e,consent:t}):100==e&&connectTerminal(null,1,{protocol:1,requireLogin:!0,consent:t})}function cmdeskaction(e){1==e&&connectDesktop(null,3,null,72),2==e&&connectDesktop(null,3,null,8),3==e&&connectDesktop(null,3,null,64),10==e&&null!=desktop&&(desktop.sendCtrlMsg('{"ctrlChannel":"102938","type":"autolock","value":true}'),connectDesktop()),11==e&&null!=desktop&&(desktop.sendCtrlMsg('{"ctrlChannel":"102938","type":"autolock","value":false}'),connectDesktop())}function cmaltportaction(e){xxdialogMode||(setDialogMode(2,"Připojení RDP",3,function(){var e=0<Q("d10rdpport").value.length?parseInt(Q("d10rdpport").value):3389;meshserver.send({action:"changedevice",nodeid:currentNode._id,rdpport:e})},'Port vzdáleného připojení RDP:<br /><br /><input type=text placeholder="3389" inputmode="numeric" pattern="[0-9]*" onkeypress="return (event.keyCode == 8) || (event.charCode >= 48 && event.charCode <= 57)" maxlength=5 id=d10rdpport type=text>',currentNode),Q("d10rdpport").focus(),null!=currentNode.rdpport&&(Q("d10rdpport").value=currentNode.rdpport))}function cmsshportaction(e){xxdialogMode||(setDialogMode(2,"Připojení SSH",3,function(){var e=0<Q("d10sshport").value.length?parseInt(Q("d10sshport").value):22;meshserver.send({action:"changedevice",nodeid:currentNode._id,sshport:e})},'Port vzdáleného připojení SSH:<br /><br /><input type=text placeholder="22" inputmode="numeric" pattern="[0-9]*" onkeypress="return (event.keyCode == 8) || (event.charCode >= 48 && event.charCode <= 57)" maxlength=5 id=d10sshport type=text>',currentNode),Q("d10sshport").focus(),null!=currentNode.sshport&&(Q("d10sshport").value=currentNode.sshport))}function cmrfbportaction(e){xxdialogMode||(setDialogMode(2,"Připojení VNC",3,function(){var e=0<Q("d10rfbport").value.length?parseInt(Q("d10rfbport").value):3389;meshserver.send({action:"changedevice",nodeid:currentNode._id,rfbport:e})},'Port vzdáleného připojení VNC:<br /><br /><input type=text placeholder="5900" inputmode="numeric" pattern="[0-9]*" onkeypress="return (event.keyCode == 8) || (event.charCode >= 48 && event.charCode <= 57)" maxlength=5 id=d10rfbport type=text>',currentNode),Q("d10rfbport").focus(),null!=currentNode.rfbport&&(Q("d10rfbport").value=currentNode.rfbport))}function cmhttpportaction(e){xxdialogMode||(setDialogMode(2,"Připojení HTTP",3,function(){var e=0<Q("d10httpport").value.length?parseInt(Q("d10httpport").value):80;meshserver.send({action:"changedevice",nodeid:currentNode._id,httpport:e})},'Port vzdáleného připojení HTTP:<br /><br /><input type=text placeholder="80" inputmode="numeric" pattern="[0-9]*" onkeypress="return (event.keyCode == 8) || (event.charCode >= 48 && event.charCode <= 57)" maxlength=5 id=d10httpport type=text>',currentNode),Q("d10httpport").focus(),null!=currentNode.httpport&&(Q("d10httpport").value=currentNode.httpport))}function cmhttpsportaction(e){xxdialogMode||(setDialogMode(2,"Připojení HTTPS",3,function(){var e=0<Q("d10httpsport").value.length?parseInt(Q("d10httpsport").value):443;meshserver.send({action:"changedevice",nodeid:currentNode._id,httpsport:e})},'Port vzdáleného připojení HTTPS:<br /><br /><input type=text placeholder="443" inputmode="numeric" pattern="[0-9]*" onkeypress="return (event.keyCode == 8) || (event.charCode >= 48 && event.charCode <= 57)" maxlength=5 id=d10httpsport type=text>',currentNode),Q("d10httpsport").focus(),null!=currentNode.httpsport&&(Q("d10httpsport").value=currentNode.httpsport))}function cmfilesaction(e){var t;xxdialogMode||(t=p13sort_files(p13filetree.dir)[parseInt(contextelement.attributes.fileindex.nodeValue)],1==e?(setDialogMode(2,"Přejmenovat",3,p13renamefileEx,'<input type=text id=p13renameinput maxlength=64 onkeyup=p13fileNameCheck(event) style=width:100% value="'+t.n+'" />',{action:"rename",path:p13filetreelocation.join("/"),oldname:t.n}),focusTextBox("p13renameinput"),p13fileNameCheck()):2==e?t.s<=204800?p13downloadfile(encodeURIComponentEx(p13filetreelocation.join("/")+"/"+t.n),encodeURIComponentEx(t.n),t.s,"viewer"):messagebox("Editor souborů","Upravovat je možné jen soubory, které jsou menší než 200 kilobajtů."):3==e&&setDialogMode(2,"Smazat",3,p13deletefileCm,"Smazat položku?",t))}function cmexpandaction(e){if(1==e)CollapsedGroups={};else{if(0==sort){for(var t in CollapsedGroups={},meshes)CollapsedGroups[t]=!0;for(var t in nodes)null==meshes[nodes[t].meshid]&&(CollapsedGroups[nodes[t].meshid]=!0)}if(1==sort){CollapsedGroups={};for(t=0;t<10;t++)CollapsedGroups["pwr:"+t]=!0}if(3==sort)for(var t in CollapsedGroups={},nodes)if((o=nodes[t]).tags)for(var n in o.tags)CollapsedGroups["tag:"+encodeURIComponentEx(o.tags[n])]=!0;if(4==sort)for(var t in CollapsedGroups={},nodes){var o=nodes[t],i=meshes[o.meshid];if(i){if(CollapsedGroups["tag:"+encodeURIComponentEx(i.name)]=!0,o.tags)for(var n in o.tags)CollapsedGroups["tag:"+encodeURIComponentEx(i.name+" - "+o.tags[n])]=!0}else if(o.tags)for(var n in o.tags)CollapsedGroups["tag:"+encodeURIComponentEx("**INDV*~*DEVS** - "+o.tags[n])]=!0}}putstore("_collapse",JSON.stringify(CollapsedGroups)),updateCollapseAllButton(),mainUpdate(4)}function cmdeskplayeraction(e){xxdialogMode||safeNewWindow(window.location.origin+"{{{domainurl}}}player.htm"+(urlargs.key?"?key="+urlargs.key:""),"meshcentral-deskplayer")}function cmdeskshortcutaction(e){xxdialogMode||deskCustomizeKeys()}function cmdeskpreconfigtypeaction(e){xxdialogMode||(-1==e?deskCustomizeStrings():showDeskTypeEx(e<1e3?serverinfo.preConfiguredRemoteInput[e].value:deskKeyboardStrings[e-1e3].v))}function cmdeskpreconfigscriptaction(e){meshserver.send({action:"runcommands",nodeids:[currentNode._id],presetcmd:e})}function p13deletefileCm(e,t){files.sendText({action:"rm",reqid:1,path:p13filetreelocation.join("/"),delfiles:[t.n],rec:!1}),p13folderup(999)}function hideContextMenu(){QV("contextMenu",!1),QV("meshContextMenu",!1),QV("filesShellContextMenu",!1),QV("termShellContextMenu",!1),QV("termShellContextMenu2",!1),QV("termShellContextMenuLinux",!1),QV("deskConnectContextMenu",!1),QV("deskDisconnectContextMenu",!1),QV("altPortContextMenu",!1),QV("rfbPortContextMenu",!1),QV("sshPortContextMenu",!1),QV("httpPortContextMenu",!1),QV("httpsPortContextMenu",!1),QV("filesContextMenu",!1),QV("deskPlayerContextMenu",!1),QV("deskKeyShortcutContextMenu",!1),QV("deskPreConfigShortcutContextMenu",!1),QV("deskPreConfigScriptContextMenu",!1),QV("expandAllContextMenu",!1),contextelement=null}var map_cm_popup,map_cm_editMarker,map_cm_clearMarker,map_cm_saveMarker,map_cm_nodemenu_items,contextmenu_items,currentNode,xxmap={map:null,contextmenu:null,activeInteractions:[],showindex:0,markersSource:null,markersLayer:null,mapLayer:null,mapView:null};function updateMapMarkers(e){if(0!=(32768&features)){if(null!=xxmap&&null==xxmap.map)try{loadmap()}catch(e){console.error("loadmap() exception",e)}if(null!=xxmap){var t,n=null;for(t in nodes)try{var o,i,a=map_parseNodeLoc(nodes[t]),s=xxmap.markersSource.getFeatureById(nodes[t]._id);null==a||nodes[t].meshid!=e&&null!=e?s&&xxmap.markersSource.removeFeature(s):(o=a[0],i=a[1],a[2],null==n?n=[o,i,o,i,0]:(o<n[0]&&(n[0]=o),i<n[1]&&(n[1]=i),o>n[2]&&(n[2]=o),i>n[3]&&(n[3]=i)),null==s?(addFeature(nodes[t]),n[4]=1):(updateFeature(nodes[t],s),s.setStyle(markerStyle(nodes[t],a[2]))))}catch(e){console.error("updateMapMarkers() exception",e,JSON.stringify(nodes[t]))}return n}}}function stringToIntHash(e){for(var t=0,n=0;n<e.length;n++)t=(t<<5)-t+e.charCodeAt(n),t|=0;return t}function map_parseNodeLoc(e){var t=null,n=0;return e.iploc&&(t=e.iploc,n=1),e.wifiloc&&(t=e.wifiloc,n=2),e.gpsloc&&(t=e.gpsloc,n=3),e.userloc&&(t=e.userloc,n=4),null==t||"string"!=typeof t?null:(t=t.split(","),1==n?[parseFloat(t[0])+stringToIntHash(e._id.substring(0,20))/1e11,parseFloat(t[1])+stringToIntHash(e._id.substring(20))/1e11,n]:[parseFloat(t[0]),parseFloat(t[1]),n])}function loadmap(){if(0!=(32768&features)&&null!=xxmap)if(0==(32768&features))xxmap=null;else{QV("viewselectmapoption",!0),QV("devViewButton4",!0);try{xxmap.markersSource=new ol.source.Vector,xxmap.markersLayer=new ol.layer.Vector({source:xxmap.markersSource}),xxmap.mapLayer=new ol.layer.Tile({source:new ol.source.OSM}),xxmap.mapView=new ol.View({center:ol.proj.transform([0,0],"EPSG:4326","EPSG:3857"),zoom:2,minZoom:2,maxZoom:20,extent:ol.proj.transformExtent([-1e5,-69.55,1e5,69.55],"EPSG:4326","EPSG:3857")}),xxmap.map=new ol.Map({target:"xdevicesmap",layers:[xxmap.mapLayer,xxmap.markersLayer],view:xxmap.mapView}),xxmap.map.addOverlay(map_cm_popup),xxmap.map.on("click",function(e){var t,e=xxmap.map.forEachFeatureAtPixel(e.pixel,function(e,t){return e});e&&gotoDevice(null!=(t=e.getId())?t:getCorrespondingFeature(e).getId(),10)}),xxmap.map.on("pointermove",function(e){var t,e=xxmap.map.forEachFeatureAtPixel(e.pixel,function(e,t){return e});e?(xxmap.map.getTargetElement().style.cursor="pointer",t=e.getGeometry().getCoordinates(),map_cm_popup.setPosition(t),e.getId()?QH("xmap-info-window",e.get("name")):(t=getCorrespondingFeature(e),QH("xmap-info-window",t.get("name")))):(xxmap.map.getTargetElement().style.cursor="",QH("xmap-info-window",""))});var e=new ContextMenu({width:160,defaultItems:!1,items:contextmenu_items});e.on("open",function(e){var e=xxmap.map.forEachFeatureAtPixel(e.pixel,function(e,t){return e});xxmap.contextmenu.clear(),e?e.getId()?addContextMenuItems(e):(e=getCorrespondingFeature(e))?addContextMenuItems(e):xxmap.contextmenu.extend(contextmenu_items):xxmap.contextmenu.extend(contextmenu_items)}),null==xxmap.contextmenu&&(xxmap.contextmenu=e),xxmap.map.addControl(xxmap.contextmenu)}catch(e){console.log(e),QV("viewselectmapoption",!1),QV("devViewButton4",!1),xxmap=null}}}function addFeature(e,t,n){var o=getModifiedFeature(e._id);o?xxmap.markersSource.addFeature(o):(t||n||(t=(o=map_parseNodeLoc(e))[0],n=o[1]),180<n&&meshserver.send({action:"changedevice",nodeid:e._id,userloc:[t,n=180-n]}),t<90&&-90<t&&n<180&&-180<n&&((o=new ol.Feature({geometry:new ol.geom.Point(ol.proj.transform([n,t],"EPSG:4326","EPSG:3857")),name:e.name,status:e.conn,lat:t,lon:n})).setId(e._id),o.setStyle(markerStyle(e)),xxmap.markersSource.addFeature(o)))}function removeFeature(e){e=xxmap.markersSource.getFeatureById(e._id);e&&xxmap.markersSource.removeFeature(e)}function updateFeature(e,t){e.conn!=t.get("status")&&(t.set("status",e.conn),t.setStyle(markerStyle(e)));var n,o=map_parseNodeLoc(e);null!=o&&(n=o[0],o=o[1],n==t.get("lat")&&o==t.get("lon")||(t.set("lat",n),t.set("lon",o),o=ol.proj.transform([parseFloat(o),parseFloat(n)],"EPSG:4326","EPSG:3857"),t.getGeometry().setCoordinates(o))),e.name!=t.get("name")&&t.set("name",e.name)}function modifyMarkerloc(e){var t,n=e.getId();n&&(e.setStyle(markerStyle(getNodeFromId(e.a),4)),getActiveInteractions(e)||(t=new ol.interaction.Modify({features:new ol.Collection([e]),pixelTolerance:10}),xxmap.activeInteractions.push({featureid:n,feature:e,interaction:t}),xxmap.map.addInteraction(t)))}function saveMarkerloc(e){var t,n=e.getId();n&&(t=getActiveInteractions(e))&&(xxmap.map.removeInteraction(t),removeInteraction(n),t=e.getGeometry().getCoordinates(),180<(e=ol.proj.transform(t,"EPSG:3857","EPSG:4326"))[0]&&(e[0]=180-e[0]),meshserver.send({action:"changedevice",nodeid:n,userloc:[e[1],e[0]]}))}function markerStyle(e,t){null==t&&(t=0,e.iploc&&(t=1),e.wifiloc&&(t=2),e.gpsloc&&(t=3),e.userloc)&&(t=4);e=connStateColor(e);return[new ol.style.Style({image:new ol.style.Icon({color:e,anchor:[.5,1],src:"images/mapmarker"+["","-ip","-wifi","-gps","-user"][t]+".png"})})]}function connStateColor(e){return 1==e.conn||3==e.conn||5==e.conn?"#00ffdd":"#C70039"}function addContextMenuItems(t){getActiveInteractions(t)?(map_cm_saveMarker.data=t,xxmap.contextmenu.push(map_cm_saveMarker)):(map_cm_editMarker.data=t,xxmap.contextmenu.push(map_cm_editMarker),getNodeFromId(t.a).userloc&&(map_cm_clearMarker.data=t,xxmap.contextmenu.push(map_cm_clearMarker))),map_cm_nodemenu_items.forEach(function(e){"Přiblížit"==e.text||"Oddálit"==e.text?e.data=t:"-"!=e&&(e.data=t.getId())}),xxmap.contextmenu.extend(map_cm_nodemenu_items)}function getActiveInteractions(e){for(var t=e.getId(),n=0;n<xxmap.activeInteractions.length;n++)if(xxmap.activeInteractions[n].featureid==t)return xxmap.activeInteractions[n].interaction;return!1}function getModifiedFeature(e){if(e)for(var t=0;t<xxmap.activeInteractions.length;t++)if(xxmap.activeInteractions[t].featureid==e)return xxmap.activeInteractions[t].feature;return null}function removeInteraction(e){for(var t=-1,n=0;n<xxmap.activeInteractions.length;n++)if(xxmap.activeInteractions[n].featureid===e){t=n;break}0<=t&&xxmap.activeInteractions.splice(t,1)}function getCorrespondingFeature(e){for(var t=e.getGeometry().getCoordinates(),n=0;n<xxmap.activeInteractions.length;n++){var o=xxmap.activeInteractions[n].feature,i=o.getGeometry().getCoordinates();if(i[0].toFixed(5)==t[0].toFixed(5)&&i[1].toFixed(5)==t[1].toFixed(5))return o}return null}function refreshMap(e,t){e&&(xxmap.map.setTarget(null),xxmap.map=null,xxmap.markersSource=null,xxmap.mapView=null,xxmap.mapLayer=null,xxmap.activeInteractions=[]);e=updateMapMarkers();if(null!=e&&(t||1==e[4])){for(var t=(e[0]+e[2])/2,n=(e[1]+e[3])/2,o=Math.max(Math.abs(e[0]-e[2]),Math.abs(e[1]-e[3])),e=xxmap.map.getView(),i=(e.setCenter(ol.proj.transform([n,t],"EPSG:4326","EPSG:3857")),360),a=-2;o<i;)a++,i/=2;e.setZoom(a)}}function placeNode(e){if(!xxdialogMode){var t,n='<div style=margin-bottom:6px><label for=selectnode-search>Hledat</label>&nbsp&nbsp<input type=text placeholder="Název zařízení" id="selectnode-search" onchange=onPlaceNodeInputChange() onkeyup=onPlaceNodeInputChange() autocomplete=off style=width:120px></div><div id=placenode style="height:254px;overflow-y:auto;width:100%;margin:12px 1px 4px 1px;"><div id=noNodesMapPlace style=text-align:center;width:100%;display:none>Nenalezena žádná zařízení.</div>';for(t in nodes)n=(n+="<div class=noselect id="+nodes[t]._id+"-rowid onclick=selectNodeToPlace(event,'"+nodes[t]._id+"') style=background-color:lightgray;margin-bottom:4px;border-radius:2px><input name=PlaceMapDeviceCheckbox id="+nodes[t]._id+"-checkid type=checkbox style=width:16px;display:inline />")+"<div class=j"+nodes[t].icon+" style=width:16px;height:16px;margin-top:2px;margin-right:4px;display:inline-block></div><div style=width:16px;display:inline>"+nodes[t].name+"</div></div>";setDialogMode(2,"Vybrat kam umístit uzel",3,placeNodeEx,n+"</div>",e),onPlaceNodeInputChange()}}function placeNodeEx(e,t){var n,o,i,a,s=document.getElementsByName("PlaceMapDeviceCheckbox");for(n in s)s[n].checked&&(o=getNodeFromId(s[n].id.substring(0,s[n].id.length-8)))&&(i=xxmap.markersSource.getFeatureById(n),a=[(a=ol.proj.transform(t,"EPSG:3857","EPSG:4326"))[1],a[0]],i&&(i.getGeometry().setCoordinates(t),getActiveInteractions(i))?saveMarkerloc(i):meshserver.send({action:"changedevice",nodeid:o._id,userloc:a}))}function onPlaceNodeInputChange(){updatePlaceNodeTable(Q("selectnode-search").value.trim().toLowerCase())}function updatePlaceNodeTable(e){document.getElementsByName("PlaceMapDeviceCheckbox");var t,n=0;for(t in nodes){var o=0<=nodes[t].namel.indexOf(e)||""==e||null!=nodes[t].rnamel&&0<=nodes[t].rnamel.indexOf(e);o&&n++,QV(nodes[t]._id+"-rowid",o)}QV("noNodesMapPlace",0==n)}function selectNodeToPlace(e,t){"PlaceMapDeviceCheckbox"!=e.target.name&&((e=Q(t+"-checkid")).checked=!e.checked);var n,o=document.getElementsByName("PlaceMapDeviceCheckbox"),i=0;for(n in o)o[n].checked&&i++;QE("idx_dlgOkButton",0<i)}function addMeshOptions(e,t){}function meshOptionRmvMod(e,t){}function meshExists(){for(var e in meshes)if(meshes[e])return!0;return!1}function setMeshView(e){var t=Q("select-mesh");t[t.selectedIndex].value==e&&(t[0].selected=!0,onSelectMeshChange())}function clearMeshOptions(){}function getSearchLocation(){try{var e,t=Q("mapSearchLocation").value.trim();0<t.length&&((e=new XMLHttpRequest).onreadystatechange=function(){4==e.readyState&&200==e.status&&formatSearchData(e.responseText)},e.open("GET","https://nominatim.openstreetmap.org/search?q="+t+"&format=json",!0),e.send())}catch(e){}}function formatSearchData(e){try{QH("xmapSearchResults","");for(var t=JSON.parse(e),n=0,o='<div class="xmapItem">',i=0;i<t.length;i++)t[i].display_name&&t[i].boundingbox[0]&&t[i].boundingbox[1]&&t[i].boundingbox[2]&&t[i].boundingbox[3]&&(n++,o+='<div class="xmapItemSel1" onclick=mapGotoSelectedLocation(this)><div>'+t[i].display_name+"</div><div style=display:none>"+t[i].boundingbox[0]+"!#!"+t[i].boundingbox[1]+"!#!"+t[i].boundingbox[2]+"!#!"+t[i].boundingbox[3]+"</div></div>");o+="</div>",1==n?zoomToExtent([parseFloat(t[0].boundingbox[2]),parseFloat(t[0].boundingbox[0]),parseFloat(t[0].boundingbox[3]),parseFloat(t[0].boundingbox[1])]):(0==n&&(o="<div style=width:200px>Nenalezeno žádné umístění.<div>"),QV("xmapSearchResultsDlg",!0)),QH("xmapSearchResults",o)}catch(e){}}function mapGotoSelectedLocation(e){e=e.children[1].innerHTML.split("!#!");zoomToExtent([parseFloat(e[2]),parseFloat(e[0]),parseFloat(e[3]),parseFloat(e[1])]),mapCloseSearchWindow()}function mapCloseSearchWindow(){QH("xmapSearchResults",""),QV("xmapSearchResultsDlg",!1)}function zoomToLocation(e,t){var n=xxmap.map.getView();n.setCenter(e),n.setZoom(t)}function zoomToFitExtent(){var e;0<xxmap.markersSource.getFeatures().length&&(e=xxmap.markersSource.getExtent(),xxmap.map.getView().fit(e,xxmap.map.getSize()))}function zoomToExtent(e){e=ol.proj.transformExtent(e,ol.proj.get("EPSG:4326"),ol.proj.get("EPSG:3857"));xxmap.map.getView().fit(e,xxmap.map.getSize())}function refreshDevice(e){currentNode&&currentNode._id==e&&gotoDevice(e,xxcurrentView,!0)}32768&features&&(map_cm_popup=new ol.Overlay({element:Q("xmap-info-window"),positioning:"bottom-center",stopEvent:!1}),map_cm_editMarker={text:"Upravit umístění uzlu",callback:function(e){modifyMarkerloc(e.data)}},map_cm_clearMarker={text:"Odstranit umístění uzlu",callback:function(e){meshserver.send({action:"changedevice",nodeid:e.data.a,userloc:[]})}},map_cm_saveMarker={text:"Uložit umístění uzlu",callback:function(e){saveMarkerloc(e.data)}},map_cm_nodemenu_items=[{text:"Obecné informace",callback:function(e){null!=e.data&&gotoDevice(e.data,10)}},{text:"Plocha",callback:function(e){null!=e.data&&gotoDevice(e.data,11)}},{text:"Terminál",callback:function(e){null!=e.data&&gotoDevice(e.data,12)}},{text:"Intel&reg; AMT",callback:function(e){null!=e.data&&gotoDevice(e.data,14)}},"-",{text:"Přiblížit",callback:function(e){zoomToLocation(e.data.getGeometry().getCoordinates(),19)}},{text:"Oddálit",callback:function(e){zoomToLocation(e.data.getGeometry().getCoordinates(),2)}}],contextmenu_items=[{text:"Načíst znovu",callback:function(){refreshMap(!0,!0)}},{text:"Přiblížit na míru",callback:function(){zoomToFitExtent()}},{text:"Vystředit mapu zde",callback:function(e){xxmap.mapView.animate({center:e.coordinate})}},{text:"Umístit uzel sem",callback:function(e){placeNode(e.coordinate)}}]);var powerTimelineNode=null,powerTimelineReq=null,powerTimelineUpdate=null,powerTimeline=null,deviceSharesNode=null,deviceSharesReq=null,deviceShares=null;function getCurrentNode(){return currentNode}function gotoDevice(e,t,n,o){if(!o||3!=o.which&&2!=o.button)if(!0!==userinfo.emailVerified&&1==serverinfo.emailcheck&&4294967295!=userinfo.siteadmin)setDialogMode(2,"Nastavení zabezpečení",1,null,'Dokud nebude ověřena e-mailová adresa, nelze k této funkci přistupovat. To je vyžadováno pro obnovení hesla. Chcete-li změnit a ověřit e-mailovou adresu, přejděte na kartu "Můj účet".');else if(262144&features&&0==count2factoraAuths())setDialogMode(2,"Nastavení zabezpečení",1,null,"Nelze získat přístup k této funkci, dokud není povoleno dvoufaktorové ověřování. To je nutné pro větší bezpečnost. Přejděte na kartu „Můj účet“ a podívejte se do části „Zabezpečení účtu“.");else if(!o||1!=o.shiftKey&&2!=o.which&&1!=o.button){var i=getNodeFromId(e);if(null!=i){null!=currentNode&&currentNode._id==i._id&&0!=(1&i.conn)||deviceDetailsStatsClear();var a=meshes[i.meshid],s=GetNodeRights(i),P=null==currentNode||currentNode._id!=e;if(!currentNode||currentNode._id!=i._id||1==n){currentNode=i,QV("deskPreConfigScriptContextMenu1",2==currentNode.mtype&&isWindowsNode(currentNode)),QV("deskPreConfigScriptContextMenu2",2==currentNode.mtype&&!isWindowsNode(currentNode)),QV("p10deviceNotify",null!=currentNode.sessions&&(null!=currentNode.sessions.kvm||null!=currentNode.sessions.terminal||null!=currentNode.sessions.files||null!=currentNode.sessions.tcp||null!=currentNode.sessions.udp)),QV("p10deviceStar",1==stars[currentNode._id]),QV("p10deviceHelp",null!=currentNode.sessions&&null!=currentNode.sessions.help),null!=currentNode.sessions&&null!=currentNode.sessions.msg?(QV("p10deviceMsg",!0),QH("p10deviceMsg",Object.keys(currentNode.sessions.msg).length)):QV("p10deviceMsg",!1),QV("p10deviceBattery",!1),null!=currentNode.sessions&&null!=currentNode.sessions.battery?(f="","ac"==(r=currentNode.sessions.battery).state&&(f="Zařízení je zapojeno"),"dc"==r.state&&(f="Zařízení je napájeno z baterie"),d="",w=-1,"number"==typeof r.level&&0<=r.level&&r.level<=100&&(d=r.level+"%",5<(w=Math.floor((r.level+10)/25)+1)&&(lvl=5),"ac"==r.state)&&(100==r.level?w=11:w+=5),0<w&&(Q("p10deviceBattery").title=null!=f?f+", "+d:d,QV("p10deviceBattery",!0),Q("p10deviceBattery").className="deviceBatteryLarge deviceBatteryLarge"+w)):QV("p10deviceBattery",!1);var r=EscapeHtml(i.name),l=(0==r.length&&(r="<i>Nic</i>"),f=r=0==(4&s)||a.flags&&0!=(2&a.flags)?r:'<span tabindex=0 title="Pro úpravu toho, jak je zařízení nazýváno na serveru, klikněte sem" onclick=showEditNodeValueDialog(0) onkeyup="if (event.key == \'Enter\') showEditNodeValueDialog(0)" style=cursor:pointer>'+r+' <img class=hoverButton src="images/link5.png" /></span>',a&&(r+="<span style=color:#AAA;font-size:small> - "+EscapeHtml(a.name)+"</span>"),QH("p10deviceName",r),QH("p11deviceName",r),QH("p12deviceName",r),QH("p13deviceName",r),QH("p14deviceName",r),QH("p15deviceName","Konzole – "+r),QH("p16deviceName",r),QH("p17deviceName",r),QH("p19deviceName",r),"<table style=width:100%>"),d=(0!=(8&args.hide)&&(l+="<br />"+addDeviceAttribute("Název",f)),a&&(l+=addDeviceAttribute('<span title="Název skupiny zařízení, do které tento počítač patří.">Skupina</span>','<a href=# title="Název skupiny zařízení, do které tento počítač patří" onclick=gotoMesh("'+i.meshid+'") style=cursor:pointer>'+EscapeHtml(meshes[i.meshid].name)+"</a>")),null!=i.rname&&i.name!=i.rname&&(l+=addDeviceAttribute('<span title="Název tohoto počítače nastavený v operačním systému">Název počítače</span>','<span title="Název tohoto počítače nastavený v operačním systému">'+EscapeHtml(i.rname)+"</span>")),(0==(1&features)&&4!=i.mtype||3==i.mtype)&&(l+=addDeviceAttribute("Název stroje",addLinkConditional("<span onclick=showEditNodeValueDialog(1) style=cursor:pointer>"+(i.host?EscapeHtml(i.host):"<i>Nic</i>")+"</span>","showEditNodeValueDialog(1)",4&s))),i.desc?EscapeHtml(i.desc):"<i>Nic</i>");if(l+=addDeviceAttribute("Popis",0!=(4&s)?"<span onclick=showEditNodeValueDialog(2) style=cursor:pointer>"+d+' <img class=hoverButton src="images/link5.png" /></span>':d),4==i.mtype&&(null!=i.portnum&&(l+=addDeviceAttribute("Číslo portu",i.portnum)),null!=i.porttype)&&(l+=addDeviceAttribute("Typ portu",i.porttype)),null!=i.agent&&null!=i.agent.id&&3==i.mtype?(4==i.agent.id&&(l+=addDeviceAttribute("Typ zařízení","Windows")),6==i.agent.id&&(l+=addDeviceAttribute("Typ zařízení","Linux")),29==i.agent.id&&(l+=addDeviceAttribute("Typ zařízení","macOS"))):null!=i.agent&&null!=i.agent.id&&null!=i.agent.ver&&(k="",k=i.agent.id<=agentsStr.length?agentsStr[i.agent.id]:agentsStr[0],0!=i.agent.ver&&(k+=" v"+i.agent.ver),14==i.agent.id&&(k=i.agent.core),!1===i.agent.root&&0!=(1&i.conn)&&(k+=", Omezený"),l+=addDeviceAttribute("Mesh Agent",k)),null!=i.intelamt&&(k="",w={0:nobreak("Neaktivováno (před)"),1:nobreak("Neaktivováno (v)"),2:nobreak("Zapnuto")},null!=i.intelamt.ver&&null==i.intelamt.state?k+="<i>Neznámý stav</i>, v"+EscapeHtml(i.intelamt.ver):null==i.intelamt.ver&&2==i.intelamt.state?k+="<i>Zapnuto</i>":null==i.intelamt.ver||null==i.intelamt.state?k+="<i>Neznámý stav a verze</i>":(k+=w[i.intelamt.state],2==i.intelamt.state&&i.intelamt.flags&&(2&i.intelamt.flags?k+=' <span title="Intel&reg; AMT je aktivováno v režimu uživatele">CCM</span>':4&i.intelamt.flags&&(k+=' <span title="Intel&reg; AMT je aktivováno v režimu správce">ACM</span>')),k+=", v"+EscapeHtml(i.intelamt.ver)),2==i.intelamt.state&&(1==i.intelamt.tls&&(k+=', <span title="Intel&reg; AMT je nastaveno s TLS zabezpečením">TLS</span>'),r=!1,null==i.intelamt.user||""==i.intelamt.user?0!=(4&s)?(k+=', <i style=color:#FF0000;cursor:pointer title="Upravit přihlašovací údaje k Intel&reg; AMT" onclick=editDeviceAmtSettings("'+i._id+'")>Žádné přihlašovací údaje</i>',r=!0):k+=", <i style=color:#FF0000>Žádné přihlašovací údaje</i>":0!=(1&features2)&&null!=i.intelamt.warn&&(f=null,0!=(1&i.intelamt.warn)&&(f="Neplatná pověření"),null!=(f=0!=(8&i.intelamt.warn)?"Zkoušení přihlašovacích údajů":f))&&(0!=(4&s)?(k+=', <i style=color:#FF0000;cursor:pointer title="Upravit přihlašovací údaje k Intel&reg; AMT" onclick=editDeviceAmtSettings("'+i._id+'")>'+f+"</i>",r=!0):k+=", <i style=color:#FF0000>"+f+"</i>"),k+=" ",r=0!=(4&s)&&0==(1&features2)||r)&&(k+='<img src=images/link4.png height=10 width=10 title="Upravit přihlašovací údaje k Intel&reg; AMT" style=cursor:pointer onclick=editDeviceAmtSettings("'+i._id+'")>'),d='<span title="Intel&reg; Manageability Engine">Intel&reg; ME<span>',"number"==typeof i.intelamt.sku&&(0!=(8&i.intelamt.sku)?d='<span title="Intel&reg; Active Management Technology">Intel&reg; AMT<span>':0!=(16&i.intelamt.sku)&&(d='<span title="Intel&reg; Standard Manageability">Intel&reg; SM<span>')),l+=addDeviceAttribute(d,k)),null!=i.agent&&null!=i.agent.tag?l+=addDeviceAttribute("Štítek agenta",p=(p=EscapeHtml(i.agent.tag)).startsWith("mailto:")?'<a href="'+EscapeHtml(p)+'">'+EscapeHtml(p.substring(7))+"</a>":p):null!=i.intelamt&&null!=i.intelamt.tag&&(l+=addDeviceAttribute("Intel&reg; AMT štítek",p=(p=EscapeHtml(i.intelamt.tag)).startsWith("mailto:")?'<a href="'+EscapeHtml(p)+'">'+EscapeHtml(p.substring(7))+"</a>":p)),i.osdesc&&(l+=addDeviceAttribute("Operační systém",i.osdesc)),i.wsc&&(c=[],null!=i.wsc.antiVirus&&("OK"==i.wsc.antiVirus?c.push("AV - <span style=color:green>OK</span>"):c.push("AV - <span style=color:red>ŠPATNÝ</span>")),null!=i.wsc.autoUpdate&&("OK"==i.wsc.autoUpdate?c.push("Aktualizace - <span style=color:green>OK</span>"):c.push("Aktualizace - <span style=color:red>ŠPATNÝ</span>")),null!=i.wsc.firewall&&("OK"==i.wsc.firewall?c.push("Firewall - <span style=color:green>OK</span>"):c.push("Firewall - <span style=color:red>ŠPATNÝ</span>")),l+=addDeviceAttribute("Zabezpečení systému Windows",c.join(", "))),i.defender&&(c=[],null!=i.defender.RealTimeProtection&&(1==i.defender.RealTimeProtection?c.push("RealTimeProtection - <span style=color:green>On</span>"):c.push("RealTimeProtection - <span style=color:red>Vypnuto</span>")),null!=i.defender.TamperProtected&&(1==i.defender.TamperProtected?c.push("TamperProtection - <span style=color:green>On</span>"):c.push("TamperProtection - <span style=color:red>Vypnuto</span>")),0<c.length)&&(l+=addDeviceAttribute("Windows Defender",c.join(", "))),i.av&&0<i.av.length){var u,c=[];for(v in i.av)i.av[v].product&&(u=EscapeHtml(i.av[v].product),!0!==i.av[v].enabled&&(u+=" - <span style=color:red>Zakázáno</span>"),!0!==i.av[v].updated&&(u+=" - <span style=color:red>Neaktuální</span>"),1==i.av[v].enabled&&1==i.av[v].updated&&(u+=" - <span style=color:green>OK</span>"),c.push(u));l+=addDeviceAttribute("Antivir",c.join("<br />"))}i.users&&0<i.users.length&&(w=i.users.map(function(e){return addKeyLinkConditional(EscapeHtml(e),"Zamknuto",i.lusers&&0<=i.lusers.indexOf(e))}).join(", "),l+=addDeviceAttribute(1<i.users.length?"Aktivní uživatelé":"Aktivní uživatel",w)),null!=i.agent&&14!=i.agent.id&&3!=i.mtype&&(f=[],r=0,i.consent&&(r=i.consent),serverinfo.consent&&(r|=serverinfo.consent),64&r&&8&r?f.push("Výzva na ploše+panel nástrojů"):64&r?f.push("Panel nástrojů na ploše"):8&r?f.push("Výzva na ploše"):1&r&&f.push("Informovat na ploše"),16&r?f.push("Výzva terminálu"):2&r&&f.push("Oznámení terminálu"),32&r?f.push("Dotaz na soubory"):4&r&&f.push("Upozornit na soubory"),7==r&&(f=["Vždy upozornit"]),l+=addDeviceAttribute("Souhlas uživatele",addLinkConditional(f=""==(f=(f=56==(56&r)?["Vždy se dotázat"]:f).join(", "))?"<i>Nic</i>":f,"p20editmeshconsent(3)",1&s)));var d=[],p=(null!=userinfo.notify&&null!=userinfo.notify[i._id]&&(2&(k=userinfo.notify[i._id])&&d.push("Připojit"),4&k&&d.push("Odpojit"),null!=i.intelamt&&8&k&&d.push("Intel&reg; AMT"),16384&features2&&userinfo.emailVerified&&(y=0,16&k&&y++,32&k&&y++,64&k&&y++,0<y)&&d.push(format("Email ({0})",y)),null!=userinfo.msghandle)&&0!=(33554432&features2)&&(y=0,128&k&&y++,256&k&&y++,512&k&&y++,0<y)&&d.push(format("Messaging ({0})",y)),l+=addDeviceAttribute("Upozornění",addLink(d=""==(d=d.join(", "))?"<i>Nic</i>":d,"p20editDeviceNotify()")),i.conn),m=(p&&1<p&&(w=[],0!=(1&i.conn)&&w.push('<span title="Agent je připojen a připraven.">Mesh Agent</span>'),0!=(2&i.conn)?w.push('<span title="Intel&reg; AMT CIRA je připojeno a připraveno k použití.">Intel&reg; AMT CIRA</span>'):0!=(4&i.conn)&&w.push('<span title="Intel&reg; AMT je směrovatelné a připraveno k použití.">Intel&reg; AMT</span>'),0!=(8&i.conn)&&w.push('<span title="Agent je dostupný pomocí předávání (relay) přes jiného agenta.">Mesh předávání (relay)</span>'),0!=(16&i.conn)&&w.push('<span title="MQTT připojení na zařízení je aktivní.">MQTT</span>'),l+=addDeviceAttribute("Konektivita",w.join(", "))),"<i>Nic</i>");if(null!=i.tags)for(var v in m="",i.tags)m+="<span class=tagSpan>"+EscapeHtml(i.tags[v])+"</span> ";l+=addDeviceAttribute("Štítky",0!=(4&s)?"<span onclick=showEditNodeValueDialog(3) style=line-height:26px;cursor:pointer>"+m+' <img class=hoverButton src="images/link5.png" width=10 height=10 /></span>':"<span style=line-height:26px>"+m+"</span>"),null==i.ssh&&null==i.rdp||(c=[],0!=(4&s)?(null!=i.ssh&&c.push("<span onclick=showClearSshDialog(3) style=cursor:pointer>"+(1==i.ssh?"SSH-User+Pass":2==i.ssh?"SSH-User+Key+Pass":"SSH-uživatel+klíč")+' <img class=hoverButton src="images/link5.png" width=10 height=10 /></span>'),null!=i.rdp&&c.push('<span onclick=showClearRdpDialog(3) style=cursor:pointer>RDP <img class=hoverButton src="images/link5.png" width=10 height=10 /></span>')):(null!=i.ssh&&c.push(1==i.ssh?"SSH-User+Pass":2==i.ssh?"SSH-User+Key+Pass":"SSH-uživatel+klíč"),null!=i.rdp&&c.push("RDP")),l+=addDeviceAttribute("Pověření",c.join(", ")));var g=[];for(v in meshes)meshes[v].relayid==i._id&&g.push('<a href=# onclick=gotoMesh("'+meshes[v]._id+'") style=cursor:pointer>'+EscapeHtml(meshes[v].name)+"</a>");if(0<g.length&&(l+=addDeviceAttribute('<span title="Skupiny zařízení, pro které je toto zařízení relé">Relé pro</span>',g.join(", "))),l+="</table><br />",0!=(262220&s)&&i.mtype<3&&(null==i.agent||34!=i.agent.id)&&(l+='<input type=button value="Akce" title="Provést na zařízení akci napájení" onclick=deviceActionFunction() />'),l=(l+='<input type=button value="Poznámky" title="Zobrazit poznámky k tomuto zařízení" onclick=showNotes('+(0==(128&s))+',"'+encodeURIComponentEx(i._id)+'") />')+('<input type=button value="Záznam událostí" title="Zapsat událost pro toto zařízení" onclick=writeDeviceEvent("'+encodeURIComponentEx(i._id)+'") />'),2==i.mtype&&1&p&&0!=(131072&s)&&(l+='<input type=button cmenu=deskPreConfigScriptContextMenu value="Spustit" title="Spouštějte příkazy na tomto zařízení." onclick=runDeviceCmd("'+encodeURIComponentEx(i._id)+'") />'),4!=i.mtype){if((8&s&&1&p&&0!=(16384&s)||1==i.pmt&&0!=(2&features2))&&(l+='<input type=button value="Zpráva" title="Zobrazte textovou zprávu na vzdáleném zařízení" onclick=deviceMessageFunction() />'),(8&s&&1&p&&0!=(16384&s)||1==i.pmt&&0!=(2&features2))&&(l+='<input type=button value="Chat" title="Otevřít chat na tomto počítači" onclick=deviceChat(event) />'),null!=serverinfo&&null!=serverinfo.altmessenging&&8&s&&1&p)for(var v in serverinfo.altmessenging){var h=serverinfo.altmessenging[v];null!=h.type&&"device"!=h.type||(l+='<input type=button value="'+EscapeHtml(serverinfo.altmessenging[v].name)+'" onclick=altDeviceChat(event,'+v+") />")}!1!==serverinfo.guestdevicesharing&&null!=i.agent&&3&i.agent.caps&&1&p&&524296==(524296&s)&&(4294967295==s||0==(4096&s))?(l+='<input type=button value="Sdílet" title="Vytvořte odkaz pro sdílení tohoto zařízení s hostem" onclick=showShareDevice() />',QV("DeskGuestShareButton",!0)):QV("DeskGuestShareButton",!1)}if(4==i.mtype&&1&p&&("PDU"==i.porttype?1==i.pwr?262144&s&&(l+='<input type=button value="Vypnout" title="Vypnout" onclick=setIpPduState(0) />'):8==i.pwr&&64&s&&(l+='<input type=button value="Zapnout" title="Zapnout" onclick=setIpPduState(1) />'):8&s&&(l+='<input type=button value="Ovládání na dálku" title="Ovládání na dálku" onclick=openIpKvmRemoteControl("'+encodeURIComponentEx(i._id)+'") />')),null!=customui&&null!=customui.devicebuttons)for(var v in customui.devicebuttons)(null==customui.devicebuttons[v].showif||null!=a&&customui.devicebuttons[v].showif==a._id||customui.devicebuttons[v].showif==currentNode._id)&&(l+='<input id="cui:'+v+'" type="button" value="'+customui.devicebuttons[v].name+'" onclick=customUIAction(event,"devicebuttons") />');QH("p10html",l),mainUpdate(256);var r=4294967295==s||0==(65536&s),f=4294967295==s||0==(512&s),k=4294967295==s||0==(1024&s),y=4294967295==s||0==(2048&s),l='<div class="p10html3right">';if(0!=(1&s)&&4!=i.mtype&&(l+='&nbsp;<a href=# onclick=p10showChangeGroupDialog(["'+i._id+'"]) title="Přesunout toto zařízení do jiné skupiny zařízení">Změnit skupinu</a>'),0!=(32768&s)&&(l+='&nbsp;<a href=# onclick=p10showDeleteNodeDialog("'+i._id+'") title="Odstranit toto zařízení">Smazat zařízení</a>'),l+='</div><div class="p10html3left">',i.agent&&3!=i.mtype&&0!=(1048576&s)&&(l+='<a href=# onclick=p10showNodeNetInfoDialog("'+i._id+'") title="Zobrazit informace o síťovém rozhraní zařízení">Síťová rozhraní</a>&nbsp;'),32768&features&&null!=xxmap&&(l+='<a href=# onclick=p10showNodeLocationDialog("'+i._id+'") title="Zobrazit informace o umístění zařízení">Umístění</a>&nbsp;'),null==i.agent||14!=i.agent.id&&34!=i.agent.id){if(4294967295!=userinfo.siteadmin&&0!=(128&userinfo.siteadmin)||f&&0!=(8&s)&&null!=i.agent&&14!=i.agent.id&&(l+='<a href=# onclick=p10showMeshCmdDialog(1,"'+i._id+'") title="Směrovač provozu, použitý k připojení zařízení prostřednictvím tohoto serveru.">MeshCmd</a>&nbsp;'),0!==args.xterm||!i.agent||0==(2&i.agent.caps)||0==(8&s)||4294967295!=s&&0!=(512&s)||(l+='<a href=# onclick=p10openxterm(event,"'+i._id+'") title="Otevřete terminál XTerm">XTerm</a>&nbsp;'),(0!=(1&p)||3==i.mtype)&&i.agent&&0!=(8&s)&&(0!=webRelayPort&&(l=(l+='<a href=# cmenu=httpPortContextMenu onclick=p10WebRouter("'+i._id+'",1,'+(i.httpport||80)+")>HTTP"+(i.httpport&&80!=i.httpport?"/"+i.httpport:"")+"</a>&nbsp;")+'<a href=# cmenu=httpsPortContextMenu onclick=p10WebRouter("'+i._id+'",2,'+(i.httpsport||443)+")>HTTPS"+(i.httpsport&&443!=i.httpsport?"/"+i.httpsport:"")+"</a>&nbsp;"),0<i.agent.id&&i.agent.id<5&&("win32"!=navigator.platform.toLowerCase()||null!=serverinfo.devicemeshrouterlinks&&0==serverinfo.devicemeshrouterlinks.rdp||(l+='<a href=# cmenu=altPortContextMenu id=rdpMCRouterLink onclick=p10MCRouter("'+i._id+'",3) title="Vyžaduje instalaci routeru MeshCentral.">RDP'+(i.rdpport&&3389!=i.rdpport?"/"+i.rdpport:"")+"</a>&nbsp;")),4<i.agent.id&&("win32"!=navigator.platform.toLowerCase()&&"macintel"!=navigator.platform.toLowerCase()||null!=serverinfo.devicemeshrouterlinks&&0==serverinfo.devicemeshrouterlinks.ssh||(l+='<a href=# cmenu=sshPortContextMenu onclick=p10MCRouter("'+i._id+'",4,'+(i.sshport||22)+') title="Vyžaduje instalaci routeru MeshCentral.">SSH'+(i.sshport&&22!=i.sshport?"/"+i.sshport:"")+"</a>&nbsp;"),"win32"!=navigator.platform.toLowerCase()||null!=serverinfo.devicemeshrouterlinks&&0==serverinfo.devicemeshrouterlinks.scp||(l+='<a href=# cmenu=sshPortContextMenu onclick=p10MCRouter("'+i._id+'",5,'+(i.sshport||22)+') title="Vyžaduje instalaci routeru MeshCentral.">SCP'+(i.sshport&&22!=i.sshport?"/"+i.sshport:"")+"</a>&nbsp;")),"win32"==navigator.platform.toLowerCase()||"macintel"==navigator.platform.toLowerCase())&&null!=serverinfo.devicemeshrouterlinks&&Array.isArray(serverinfo.devicemeshrouterlinks.extralinks))for(var v in serverinfo.devicemeshrouterlinks.extralinks){var x=serverinfo.devicemeshrouterlinks.extralinks[v],b='"'+x.protocol+'"';doesDeviceMatchFilterTags(i,x.filter)&&("number"==typeof x.protocol?b=x.protocol:"http"==x.protocol?b=1:"https"==x.protocol?b=2:"rdp"==x.protocol?b=3:"ssh"==x.protocol?b=4:"scp"==x.protocol?b=5:"mcrdesktop"==x.protocol?b=6:"mcrfiles"==x.protocol&&(b=7),6!=b&&7!=b||2==i.mtype)&&(l+='<a href=# onclick=p10MCRouter("'+i._id+'",'+b+","+x.port+(x.ip?',"'+x.ip+'"':",null")+","+(x.localport||0)+') title="Vyžaduje instalaci routeru MeshCentral.">'+x.name+"</a>&nbsp;")}0==(1&p)&&3!=i.mtype||!i.agent||0==(8&s)||0!=(536870912&features)||(l+='<a href=# cmenu=rfbPortContextMenu id=rfbLink onclick=p10rfb("'+i._id+'") title="Na tomto zařízení spusťte webovou relaci VNC.">Web-VNC</a>&nbsp;'),0==(1&p)&&3!=i.mtype||!i.agent||0==(8&s)||0!=(1073741824&features)||(l+='<a href=# cmenu=altPortContextMenu id=mstscLink onclick=p10mstsc("'+i._id+'") title="Spusťte na tomto zařízení webovou relaci RDP.">Web-RDP</a>&nbsp;'),512&features2&&(0!=(1&p)||3==i.mtype)&&i.agent&&0!=(8&s)&&(l+='<a href=# cmenu=sshPortContextMenu id=sshLink onclick=p10ssh("'+i._id+'") title="Na tomto zařízení spusťte webovou relaci SSH.">Web-SSH</a>&nbsp;'),4294967295==s&&4194304&features&&(l+='<a href=# onclick=p10showMqttLoginDialog("'+i._id+'") title="Získat přihlašovací údaje MQTT pro toto zařízení.">MQTT přihlášení</a>&nbsp;')}l+="</div><br>",3==i.mtype?(QH("p10html3",""),QH("p10html5",l)):(QH("p10html3",l),QH("p10html5",""));var d=PowerStateStr(i.state),w="",w=(null!=i.agent&&!1===i.agent.root&&(w=', <span title="Agent běží na vzdáleném zařízení se sníženými oprávněními.">Omezený</span>'),0!=(1&p)&&(0<d.length&&(d+="<br/>"),4==i.mtype?"PDU"==i.porttype?d+='<span style=font-size:12px title="Port přepínače je připojen">Port přepínače je připojen</span>'+w:d+='<span style=font-size:12px title="IP-KVM port připojen">IP-KVM port připojen</span>'+w:d+='<span style=font-size:12px title="Agent připojen">Agent připojen</span>'+w),0!=(2&p)?(0<d.length&&(d+="<br/>"),d+='<span style=font-size:12px title="Intel&reg; AMT připojeno">Intel&reg; AMT připojeno</span>'):0!=(4&p)&&(0<d.length&&(d+="<br/>"),d+='<span style=font-size:12px title="Intel&reg; AMT zjištěno">Intel&reg; AMT zjištěno</span>'),0!=(16&p)&&(0<d.length&&(d+="<br/>"),d+='<span style=font-size:12px title="MQTT připojeno">MQTT kanál připojen</span>'),""==d&&i.lastconnect?d="<span style=font-size:12px>Naposledy spatřen:<br />"+printDateTime(new Date(i.lastconnect))+"</span>":("PDU"==i.porttype||1<i.pwr&&7!=i.pwr)&&(d+="<br/>"+powerStateStrings[i.pwr]),QH("MainComputerState",d),Q("MainComputerImage").setAttribute("src","images/icons256-"+i.icon+"-1.png"),Q("MainComputerImage").className=i.conn&&0!=i.conn||3==i.mtype?"":"gray",3==i.mtype&&null!=i.agent&&4<i.agent.id&&512&features2&&(i.agent.caps=6),f&&setupTerminal(),k&&setupFiles(),0!=(16&s)),p=(w?setupConsole():15==t&&(t=10),QV("MainDevDesktop",r&&(null==i.agent&&null!=i.intelamt&&("number"!=typeof i.intelamt.sku||0!=(8&i.intelamt.sku))||null!=i.agent&&(null==i.agent.caps||0!=(1&i.agent.caps)||i.intelamt&&2==i.intelamt.state)||3==i.mtype&&(3==i.agent.id||4==i.agent.id))&&(8&s||256&s)),QV("MainDevTerminal",(null==i.agent&&null!=i.intelamt||i.agent&&null==i.agent.caps||i.agent&&0!=(2&i.agent.caps)||i.intelamt&&2==i.intelamt.state)&&8&s&&f),QV("MainDevFiles",null!=i.agent&&null!=i.agent.caps&&0!=(4&i.agent.caps)&&8&s&&k),QV("MainDevInfo",i.mtype<3&&0!=(1048576&s)),QV("MainDevAmt",null!=i.intelamt&&(2==i.intelamt.state||2&i.conn)&&8&s&&y),QV("MainDevConsole",w&&null!=i.agent&&null!=i.agent.caps&&0!=(8&i.agent.caps)&&8&s),QV("MainDevPlugins",!1),QV("p15uploadCore",null!=i.agent&&null!=i.agent.caps&&0!=(16&i.agent.caps)),QH("p15coreName",null!=i.agent&&null!=i.agent.core?i.agent.core:""),null!=i.intelamt&&"number"==typeof i.intelamt.sku&&0!=(16&i.intelamt.sku)?(QH("MainDevAmt","Intel&reg;SM"),QH("p14deviceNamePrefix","Intel&reg; SM")):(QH("MainDevAmt","Intel&reg;AMT"),QH("p14deviceNamePrefix","Intel&reg; AMT")),Q("p14iframe").contentWindow.getCurrentMeshNode()),d=(null!=p&&p._id!=currentNode._id&&Q("p14iframe").contentWindow.disconnect(),0!=(6&i.conn));if(Q("p14iframe").contentWindow.setConnectionState(d),Q("p14iframe").contentWindow.setFrameHeight("650px"),Q("p14iframe").contentWindow.setAuthCallback(updateAmtCredentials),powerTimelineNode!=currentNode._id&&powerTimelineReq!=currentNode._id&&(QH("p10html2",""),powerTimelineReq=currentNode._id,meshserver.send({action:"powertimeline",nodeid:currentNode._id}),meshserver.send({action:"lastconnect",nodeid:currentNode._id}),meshserver.send({action:"getsysinfo",nodeid:currentNode._id}),meshserver.send({action:"getnetworkinfo",nodeid:currentNode._id}),meshserver.send({action:"getNotes",id:currentNode._id}),QH("p17info2","")),deviceSharesNode!=currentNode._id&&deviceSharesReq!=currentNode._id&&(deviceSharesReq=currentNode._id,meshserver.send({action:"deviceShares",nodeid:currentNode._id})),QV("DeskTools",!1),showDeskToolsProcesses(),refreshDeviceEvents(),document.title=currentNode&&10<=xxcurrentView&&xxcurrentView<20?currentNode.name+(a?" - "+a.name:"")+" - "+decodeURIComponent("{{{extitle}}}"):decodeURIComponent("{{{extitle}}}"),P&&(p11clearConsoleMsg(),p12clearConsoleMsg(),p13clearConsoleMsg()),null!=pluginHandler&&(QH("p19headers",""),QH("p19pages",""),pluginHandler.callHook("onDeviceRefreshEnd",e,t,n,o),null!=(r=getstore("_curPluginPage",null)))&&null!=Q("p19ph-"+r)&&pluginHandler.callPluginPage(r,Q("p19ph-"+r)),l="",7&s&&(l+='<a href=# onclick="return p20showAddMeshUserDialog(5)" style=cursor:pointer;margin-right:10px><img src=images/icon-addnew.png border=0 height=12 width=12> Přidat uživatele</a>',null!=usergroups)){var S=0,D=!1;for(v in usergroups)null==usergroups[v].membershipType&&usergroups[v]._id.split("/")[1]==e.split("/")[1]&&(S++,null==currentNode.links||null==currentNode.links[v])&&(D=!0);0<S&&D&&(l+='<a href=# onclick="return p20showAddMeshUserDialog(6)" style=cursor:pointer;margin-right:10px><img src=images/icon-addnew.png border=0 height=12 width=12> Přidat skupinu uživatelů</a>')}l+='<table style="color:black;background-color:#EEE;border-color:#AAA;border-width:1px;border-style:solid;border-collapse:collapse" border=0 cellpadding=2 cellspacing=0 width=100%><tbody><tr style=background-color:#AAAAAA;font-weight:bold><th scope=col style=text-align:left;width:430px>Uživatelská oprávnění</th><th scope=col style=text-align:left></th></tr>';var C=1;if(null!=currentNode.links){var M=[];for(v in currentNode.links)(v.startsWith("user/")||v.startsWith("ugrp/"))&&M.push(v);for(v in M.sort(),M){var z="",T="",N=M[v],E=currentNode.links[N].rights,V=EscapeHtml(N.split("/")[2]),T=makeUserDeviceRightsString(E),E=!1;null!=currentNode.links[N].name&&(V=EscapeHtml(currentNode.links[N].name)),N==userinfo._id&&(V=EscapeHtml(userinfo.name)),null!=users&&null!=users[N]&&(V=EscapeHtml(users[N].name)),null!=usergroups&&null!=usergroups[N]&&(V=EscapeHtml(usergroups[N].name),E=!0),0!=(2&s)&&(T=E?(z="<a href=# onclick='return p30removeUserFromNode(event,\""+encodeURIComponentEx(N)+'")\' title="Odebrat práva skupiny uživatelů na tuto skupinu zařízení" style=cursor:pointer><img src=images/trash.png border=0 height=10 width=10></a>','<span style=cursor:pointer onclick=p20showAddMeshUserDialog(6,"'+encodeURIComponentEx(N)+'")>'+T+" <img class=hoverButton style=cursor:pointer src=images/link5.png></span>"):(z="<a href=# onclick='return p30removeUserFromNode(event,\""+encodeURIComponentEx(N)+'")\' title="Odebrat práva uživatele na tuto skupinu zařízení" style=cursor:pointer><img src=images/trash.png border=0 height=10 width=10></a>','<span style=cursor:pointer onclick=p20showAddMeshUserDialog(5,"'+encodeURIComponentEx(N)+'")>'+T+" <img class=hoverButton style=cursor:pointer src=images/link5.png></span>")),l+="<tr "+(++C%2==0?"style=background-color:#DDD":"")+'><td style=width:30%><div title="'+(E?"Skupina uživatelů":"Uživatel")+'" class=m'+(E?4:2)+"></div><div>&nbsp;"+(V=null!=users?E?"<a href=# onclick='gotoUserGroup(\""+encodeURIComponentEx(N)+"\");haltEvent(event);'>"+V+"</a>":"<a href=# onclick='gotoUser(\""+encodeURIComponentEx(N)+"\");haltEvent(event);'>"+V+"</a>":V)+"<div></div></div></td><td style=width:70%><div style=float:right>"+z+"</div><div>"+T+"</div></td></tr>"}}if(1==C&&(l+="<tr><td><div style=padding:6px>&nbsp;<i>Žádní uživatelé se zvláštními oprávněními zařízení</i><div></div></div></td><td></td></tr>"),l+="</tbody></table>",null!=deviceShares&&deviceSharesNode==currentNode._id&&0<deviceShares.length){l+='<br /><table style="color:black;background-color:#EEE;border-color:#AAA;border-width:1px;border-style:solid;border-collapse:collapse" border=0 cellpadding=2 cellspacing=0 width=100%><tbody><tr style=background-color:#AAAAAA;font-weight:bold><th scope=col style=text-align:left;width:430px>Aktivní sdílení zařízení</th><th scope=col style=text-align:left></th></tr>';for(C=1,v=0;v<deviceShares.length;v++){var A=deviceShares[v],z="",I=(null!=A.url&&(z+='<a href="'+A.url+'" rel="noreferrer noopener" target=_blank title="Odkaz na sdílení zařízení" style=cursor:pointer><img src=images/link2.png border=0 height=10 width=10></a> '),z+="<a href=# onclick='return p30removeDeviceSharing(event,\""+encodeURIComponentEx(currentNode._id)+'","'+encodeURIComponentEx(A.publicid)+'","'+encodeURIComponentEx(A.guestName)+'")\' title="Odebrat sdílení zařízení" style=cursor:pointer><img src=images/trash.png border=0 height=10 width=10></a>',""),U=(A.p<=7?I=["","Terminál","Plocha","Desktop + terminál","Soubory","Terminál + soubory","Plocha + soubory","Plocha + Terminál + Soubory"][A.p]:8==A.p?I="HTTP/"+A.port:16==A.p&&(I="HTTPS/"+A.port),I),I=(null!=A.startTime&&null!=A.expireTime&&(U=format("{0}, {1} až {2}",I,printFlexDateTime(new Date(A.startTime)),printFlexDateTime(new Date(A.expireTime)))),null!=A.startTime&&null!=A.duration&&(U=(A.duration,format("{0}, {1} po dobu {2} minut",I,printFlexDateTime(new Date(A.startTime)),A.duration))),1==A.recurring&&(U+=", Opakující se denně"),2==A.recurring&&(U+=", Opakující se týdně"),0!=(2&A.p)&&!0===A.viewOnly&&(U+=", Zobrazit pouze plochu"),null!=A.consent&&(0==A.consent?U+=", Žádný souhlas":(0!=(56&A.consent)&&(U+=", Vyzvat k souhlasu"),0!=(64&A.consent)&&(U+=", Panel nástrojů"))),EscapeHtml(A.guestName));l+="<tr "+(++C%2==0?"style=background-color:#DDD":"")+"><td style=width:30%><div class=m2></div><div>&nbsp;"+(I=A.publicid.startsWith("AS:node/")?"<i>Agent Self-Share</i>":I)+"<div></div></div></td><td style=width:70%><div style=float:right>"+z+"</div><div>"+U+"</div></td></tr>"}l+="</tbody></table>"}QH("p10html4",l);var _="";if(0==(268435456&features)&&10<=xxcurrentView&&xxcurrentView<=19&&null!=currentNode){for(var v in _="?viewmode="+xxcurrentView+"&gotonode="+currentNode._id.split("/")[2],urlargs)_+="&"+v+"="+urlargs[v];try{window.history.replaceState({},document.title,window.location.pathname+_)}catch(e){}}QV("p11DeskSessionSelector",!1),QH("p11DeskSessionSelector","")}setupDesktop(),go(t=t||10)}}else safeNewWindow(window.location.origin+"?node="+e.split("/")[2]+"&viewmode=10&hide=16"+(urlargs.key?"&key="+urlargs.key:""),"meshcentral:"+e)}function setIpPduState(e){0==e?setDialogMode(2,"Provoz napájení",3,function(){meshserver.send({action:"poweraction",nodeids:[currentNode._id],actiontype:2})},"Provést vypnutí?"):setDialogMode(2,"Provoz napájení",3,function(){meshserver.send({action:"wakedevices",nodeids:[currentNode._id]})},"Zapnout napájení?")}function p20editDeviceNotify(){var e,t,n;return xxdialogMode||(e=0,t=16384&features2&&userinfo.emailVerified?1:0,userinfo.notify&&userinfo.notify[currentNode._id]&&(e=userinfo.notify[currentNode._id]),n='<div style="border-bottom: 1px solid #888;margin-bottom:3px">Upozornění na webové stránce</div><div><label><input id=p20notifyIntelDeviceConnect type=checkbox />Připojení zařízení</label></div><div><label><input id=p20notifyIntelDeviceDisconnect type=checkbox />Odpojení zařízení</label></div>',null!=currentNode.intelamt&&(t+=2,n+="<div><label><input id=p20notifyIntelAmtKvmActions type=checkbox />Události Intel&reg; AMT desktop a serial</label></div>"),1&t&&(n+='<br /><div style="border-bottom: 1px solid #888;margin-bottom:3px">E-mailová upozornění</div><div><label><input id=p20enotifyIntelDeviceConnect type=checkbox />Připojení zařízení</label></div><div><label><input id=p20enotifyIntelDeviceDisconnect type=checkbox />Odpojení zařízení</label></div><div><label><input id=p20enotifyIntelDeviceHelp type=checkbox />Help requests</label></div>'),null!=userinfo.msghandle&&0!=(33554432&features2)&&(n+='<br /><div style="border-bottom: 1px solid #888;margin-bottom:3px">Messaging Notifications</div><div><label><input id=p20emsgDeviceConnect type=checkbox />Připojení zařízení</label></div><div><label><input id=p20emsgDeviceDisconnect type=checkbox />Odpojení zařízení</label></div><div><label><input id=p20emsgDeviceHelp type=checkbox />Help requests</label></div>'),setDialogMode(2,"Nastavení upozornění",3,p20editDeviceNotifyEx,n,t),Q("p20notifyIntelDeviceConnect").checked=2&e,Q("p20notifyIntelDeviceDisconnect").checked=4&e,2&t&&(Q("p20notifyIntelAmtKvmActions").checked=8&e),1&t&&(Q("p20enotifyIntelDeviceConnect").checked=16&e,Q("p20enotifyIntelDeviceDisconnect").checked=32&e,Q("p20enotifyIntelDeviceHelp").checked=64&e),null!=userinfo.msghandle&&0!=(33554432&features2)&&(Q("p20emsgDeviceConnect").checked=128&e,Q("p20emsgDeviceDisconnect").checked=256&e,Q("p20emsgDeviceHelp").checked=512&e)),!1}function p20editDeviceNotifyEx(e,t){var n=0,n=(n+=Q("p20notifyIntelDeviceConnect").checked?2:0)+(Q("p20notifyIntelDeviceDisconnect").checked?4:0);2&t&&(n+=Q("p20notifyIntelAmtKvmActions").checked?8:0),1&t&&(n=(n=(n+=Q("p20enotifyIntelDeviceConnect").checked?16:0)+(Q("p20enotifyIntelDeviceDisconnect").checked?32:0))+(Q("p20enotifyIntelDeviceHelp").checked?64:0)),null!=userinfo.msghandle&&0!=(33554432&features2)&&(n=(n=(n+=Q("p20emsgDeviceConnect").checked?128:0)+(Q("p20emsgDeviceDisconnect").checked?256:0))+(Q("p20emsgDeviceHelp").checked?512:0)),meshserver.send({action:"changeusernotify",nodeid:currentNode._id,notify:n})}function makeUserDeviceRightsString(e){var t,n;return 57592==e?"Úplná práva na zařízení":(t=[],8&e&&(n=[],256&e&&n.push("Žádný vstup"),512&e&&n.push("Žádný terminál"),1024&e&&n.push("Žádné soubory"),2048&e&&n.push("Žádné AMT"),4096&e&&n.push("Omezený vstup"),65536&e&&n.push("Žádná plocha"),524288&e&&!1!==serverinfo.guestdevicesharing&&n.push("Sdílení hostů"),t.push(0<n.length?"Control ("+n.join(", ")+")":"Řízení")),16&e&&t.push("Konzole"),32&e&&t.push("Soubory serveru"),64&e&&t.push("Probudit"),128&e&&t.push("Poznámky"),8192&e&&t.push("Omezit události"),16384&e&&t.push("Chat"),32768&e&&t.push("Odinstalace"),131072&e&&t.push("Příkazy"),262144&e&&t.push("Reset / Vypnuto"),524288&e&&t.push("Sdílení"),1048576&e&&t.push("Podrobnosti"),2097152&e&&t.push("Předávání (relay)"),0==t.length?"Žádná práva":t.join(", "))}function makeDeviceGroupRightsString(e){var t,n;return 4294967295==e?"Plná práva":(t=[],1&e&&t.push("Upravit skupinu"),2&e&&t.push("Spravovat uživatele"),4&e&&t.push("Správa zařízení"),8&e&&(n=[],256&e&&n.push("Žádný vstup"),512&e&&n.push("Žádný terminál"),1024&e&&n.push("Žádné soubory"),2048&e&&n.push("Žádné AMT"),4096&e&&n.push("Omezený vstup"),65536&e&&n.push("Žádná plocha"),524288&e&&!1!==serverinfo.guestdevicesharing&&n.push("Sdílení hostů"),t.push(0<n.length?"Control ("+n.join(", ")+")":"Řízení")),16&e&&t.push("Konzole"),32&e&&t.push("Soubory serveru"),64&e&&t.push("Probudit"),128&e&&t.push("Poznámky"),8192&e&&t.push("Omezit události"),16384&e&&t.push("Chat"),32768&e&&t.push("Odinstalace"),131072&e&&t.push("Příkazy"),262144&e&&t.push("Reset / Vypnuto"),524288&e&&t.push("Sdílení"),1048576&e&&t.push("Podrobnosti"),2097152&e&&t.push("Předávání (relay)"),0==t.length?"Žádná práva":t.join(", "))}function runDeviceCmd(e){xxdialogMode||d2runCommandDialog({nodeids:[e?decodeURIComponent(e):currentNode._id]})}function writeDeviceEvent(e){xxdialogMode||(setDialogMode(2,"Přidat událost zařízení",3,writeDeviceEventEx,"<textarea id=d2devEvent style=background-color:#fcf3cf;width:100%;height:200px;resize:none;overflow-y:scroll></textarea><span style=font-size:10px>Tím se přidá položka do protokolu událostí tohoto zařízení.<span>",e),Q("d2devEvent").focus())}function writeDeviceEventEx(e,t){meshserver.send({action:"setDeviceEvent",nodeid:decodeURIComponent(t),msg:encodeURIComponentEx(Q("d2devEvent").value)})}function showNotes(e,t){xxdialogMode||(e="<textarea id=d2devNotes ro="+e+" noteid="+(t=null==t?encodeURIComponentEx("p"+userinfo._id):t)+" readonly style=background-color:#fcf3cf;width:100%;height:200px;resize:none;overflow-y:scroll></textarea>",t.startsWith("node%2F%2F")&&(e+=" <span style=font-size:10px>Poznámky pro skupinu zařízení si mohou zobrazit nebo upravit pouze ostatní správci skupiny.</span>"),"true"===showNotesPanel&&(e+=" <span style=font-size:10px><a target=_blank href='https://www.markdownguide.org/cheat-sheet/'>Markdown syntax supported</a></span>"),setDialogMode(2,"Poznámky",3,showNotesEx,e,t),meshserver.send({action:"getNotes",id:decodeURIComponent(t)}))}function showNotesEx(e,t){Q("notesPanelArea").innerHTML=marked&&DOMPurify?DOMPurify.sanitize(marked.parse(Q("d2devNotes").value,{breaks:!0}),{USE_PROFILES:{html:!0}}):Q("d2devNotes").value,meshserver.send({action:"setNotes",id:decodeURIComponent(t),notes:encodeURIComponentEx(Q("d2devNotes").value)}),"true"===showNotesPanel&&""!=Q("d2devNotes").value?QV("notesPanel",!0):QV("notesPanel",!1)}function openIpKvmRemoteControl(e){xxdialogMode||safeNewWindow("/ipkvm.ashx/"+(e=decodeURIComponent(e).split("/")[2])+"/","ipkvm:"+e)}function deviceChat(e){var t;xxdialogMode||(t="/messenger?id=meshmessenger/"+encodeURIComponentEx(currentNode._id)+"/"+encodeURIComponentEx(userinfo._id)+"&title="+currentNode.name,""!=serverinfo.domainsuffix&&(t="/"+serverinfo.domainsuffix+t),null!=authCookie&&""!=authCookie&&(t+="&auth="+authCookie),1==currentNode.pmt&&0!=(2&features2)&&(t+="&pmt=1"),e&&1==e.shiftKey?safeNewWindow(t,"meshmessenger:"+currentNode._id):safeNewWindow(t,"meshmessenger:"+currentNode._id,"directories=no,titlebar=no,toolbar=no,location=no,status=no,menubar=no,scrollbars=no,resizable=no,width=400,height=560"),meshserver.send({action:"meshmessenger",nodeid:decodeURIComponent(currentNode._id)}))}function altDeviceChat(e,t){var n,o,i,a,s,r;xxdialogMode||(n=serverinfo.altmessenging[t].url.split("{0}").join(currentNode._id.split("/")[2]).split("{1}").join(currentNode._id.split("/")[2]).split("{2}").join(currentNode._id.split("/")[2]).split("{3}").join(currentNode._id.split("/")[2]),a=o=encodeURIComponentEx(userinfo._id.split("/")[2]),s=i=encodeURIComponentEx(userinfo._id.split("/").join("-")),null!=userinfo.realname&&(a=encodeURIComponentEx(userinfo.realname.split(" ").join("")),s=encodeURIComponentEx(userinfo.realname.split(" ").join("-"))),r=n=n.split("{4}").join(o).split("{5}").join(i).split("{6}").join(a).split("{7}").join(s),"string"==typeof serverinfo.altmessenging[t].localurl&&(r=(r=serverinfo.altmessenging[t].localurl.split("{0}").join(currentNode._id.split("/")[2]).split("{1}").join(currentNode._id.split("/")[2]).split("{2}").join(currentNode._id.split("/")[2]).split("{3}").join(currentNode._id.split("/")[2])).split("{4}").join(o).split("{5}").join(i).split("{6}").join(a).split("{7}").join(s)),""!=n&&meshserver.send({action:"msg",type:"openUrl",nodeid:currentNode._id,url:n}),""!=r&&safeNewWindow(r,"altmessenger:"+currentNode._id,"directories=no,titlebar=no,toolbar=no,location=no,status=no,menubar=no,scrollbars=no,resizable=no,width=400,height=560"))}function deviceToggleBackground(){xxdialogMode||meshserver.send({action:"msg",type:"deskBackground",nodeid:currentNode._id,op:1})}function deviceUrlFunction(){xxdialogMode||(setDialogMode(2,"Otevřít stránku na zařízení",3,deviceUrlFunctionEx,'<input id=d2devurl placeholder="http://server.com" style=width:100%;overflow-y:scroll onkeyup=deviceUrlFunctionValidate() onchange=deviceUrlFunctionValidate()></input>'),Q("d2devurl").focus(),deviceUrlFunctionValidate())}function deviceUrlFunctionValidate(){var e=Q("d2devurl").value.toLowerCase();QE("idx_dlgOkButton",e.startsWith("http://")&&7<e.length||e.startsWith("https://")&&8<e.length)}function deviceUrlFunctionEx(){meshserver.send({action:"msg",type:"openUrl",nodeid:currentNode._id,url:Q("d2devurl").value})}function deviceMessageFunction(){xxdialogMode||(setDialogMode(2,"Zpráva zařízení",3,deviceMessageFunctionEx,"<div style=margin-bottom:4px>Zobrazte okno se zprávou na vzdáleném zařízení.</div><textarea id=d2devMessage style=background-color:#fcf3cf;width:100%;height:80px;resize:none;overflow-y:scroll;box-sizing:border-box;margin-bottom:4px></textarea><select style=width:100% id=d2devTimeout><option value=2 selected>Show for 2 Minutes (Default)</option><option value=10>Show for 10 minutes</option><option value=30>Show for 30 minutes</option><option value=60>Show for 60 minutes</option><option value=0>Zobrazit zprávu, dokud ji uživatel nezavře</option></select>"),Q("d2devMessage").focus())}function deviceMessageFunctionEx(){var e=decodeURIComponent("{{{extitle}}}"),t=parseFloat(Q("d2devTimeout").value);""==e&&(e="MeshCentral"),isNaN(t)&&(t=2),1==currentNode.pmt?meshserver.send({action:"pushmessage",nodeid:currentNode._id,title:e,msg:Q("d2devMessage").value}):meshserver.send({action:"msg",type:"messagebox",nodeid:currentNode._id,title:e,msg:Q("d2devMessage").value,timeout:6e4*t})}function deskClipboardInFunction(){var e;null!=desktop&&3==desktop.State&&(desktop.m.getClipboard?null!=(e=desktop.m.getClipboard())&&null!=navigator.clipboard&&navigator.clipboard.writeText(e).then(function(){}).catch(function(e){console.log(e)}):meshserver.send({action:"msg",type:"getclip",nodeid:currentNode._id,tag:2}))}function deskInputLockFunction(e){xxdialogMode||null==desktop||3!=desktop.State||setDialogMode(2,"Dálkový zámek vstupu",3,function(){try{desktop.m.SendRemoteInputLock(e)}catch(e){}},1==e?"Zamknout myš a klávesnici vzdáleného uživatele?":"Odemknout myš a klávesnici vzdáleného uživatele?")}function deskClipboardOutFunction(){if(null!=navigator.clipboard&&null!=navigator.clipboard.readText)try{navigator.clipboard.readText().then(function(e){desktop.m.setClipboard?desktop.m.setClipboard(e):meshserver.send({action:"msg",type:"setclip",nodeid:currentNode._id,data:e})}).catch(function(e){console.log(e)})}catch(e){console.log(e)}return!0}function deskRefreshFunction(){null!=desktop&&3==desktop.State&&desktop.m.SendRefresh()}function deviceToastFunction(){xxdialogMode||(setDialogMode(2,"Oznámení zařízení",3,deviceToastFunctionEx,'<select id=d2deviceop style=width:100%;margin-bottom:4px><option value=2>Oznámení přípitku</option><option value=1>Schránka se zprávou</option><option value=3>Alert Box</option></select><input id=dp2notifyTitle maxlength=256 placeholder="Titul" style=width:100%;box-sizing:border-box;margin-bottom:4px /><textarea id=d2notifyMsg style=background-color:#fcf3cf;width:100%;height:140px;resize:none;overflow-y:scroll;box-sizing:border-box;margin-bottom:4px></textarea><select style=width:100% id=d2notifyTimeout><option disabled value="">Only Applicable to Message Box Notifications</option><option value=2 selected>Show for 2 Minutes (Default)</option><option value=10>Show for 10 minutes</option><option value=30>Show for 30 minutes</option><option value=60>Show for 60 minutes</option><option value=0>Zobrazit zprávu, dokud ji uživatel nezavře</option></select>'),Q("d2notifyMsg").focus())}function deviceToastFunctionEx(){var e=Q("d2deviceop").value,t=Q("dp2notifyTitle").value,n=Q("d2notifyMsg").value,o=parseFloat(Q("d2notifyTimeout").value);0!=n.length&&(""==(t=""==t?decodeURIComponent("{{{extitle}}}"):t)&&(t="MeshCentral"),isNaN(o)&&(o=2),1==e?meshserver.send({action:"msg",type:"messagebox",nodeid:currentNode._id,title:t,msg:n,timeout:6e4*o}):2==e?meshserver.send({action:"toast",nodeids:[currentNode._id],title:t,msg:n}):3==e&&meshserver.send({action:"msg",type:"alertbox",nodeid:currentNode._id,title:t,msg:n}))}function deviceLockFunction(){null==xxdialogMode&&null!=desktop&&1==desktop.contype&&setDialogMode(2,"Zamknout plochu",3,function(){null!=desktop&&1==desktop.contype&&desktop.sendCtrlMsg('{"ctrlChannel":"102938","type":"lock"}')},"Zamknout uživatelskou plochu?")}function showShareDevice(){if(!xxdialogMode){var e,t=GetNodeRights(currentNode),n="",o="Vytvoří odkaz, který umožňuje hostovi bez účtu vzdálené ovládání tohoto zařízení po omezenou dobu.<br /><br />",i=(o+=addHtmlValue("Jméno hosta","<input id=d2inviteName style=width:250px maxlength=128 type=text onkeyup=showShareDeviceValidate() />"),"<option value=2>Plocha</option>"),a=(4294967295!=t&&0!=(256&t)&&(i=""),"<option value=1>Terminál</option>"),s=(4294967295!=t&&0!=(512&t)&&(a=""),"<option value=4>Soubory</option>"),r=(4294967295!=t&&0!=(1024&t)&&(s=""),"<option value=5>Plocha + soubory</option>"),l=(4294967295!=t&&0!=(1280&t)&&(r=""),"<option value=6>Terminál + soubory</option>"),d=(4294967295!=t&&0!=(1536&t)&&(l=""),"<option value=7>Plocha + Terminál + Soubory</option>"),u=(4294967295!=t&&0!=(1792&t)&&(d=""),""),n=(0!=webRelayPort&&(u="<option value=8>HTTP</option><option value=9>HTTPS</option>",4294967295!=t)&&0!=(8&t)&&(u=""),""),c="",p=(1==(1&currentNode.agent.caps)&&(n+=i+"<option value=3>Desktop, View only</option>"),2==(2&currentNode.agent.caps)&&(n+=a),4==(4&currentNode.agent.caps)&&(n+=s),5==(5&currentNode.agent.caps)&&(n+=r),6==(6&currentNode.agent.caps)&&(n+=l),7==(7&currentNode.agent.caps)&&(n+=d),o+=addHtmlValue("Typ","<select id=d2shareType style=float:right;width:250px onchange=showShareDeviceValidate()>"+(n+=u)+"</select>"),{1:"1 minuta",5:"5 minut",10:"10 minut",15:"15 minut",30:"30 minut",45:"45 minut",60:"60 minut",120:"2 hodiny",240:"4 hodiny",480:"8 hodin",720:"12 hodin",960:"16 hodin",1440:"24 hodin",2880:"2 dny",5760:"4 dny",0:"Neomezeno"});for(e in n="",p)(null==serverinfo.guestdevicesharingmaxtime||0<e&&e<=serverinfo.guestdevicesharingmaxtime)&&(n+="<option value="+e+">"+p[e]+"</option>"),0<e&&e<=720&&(null==serverinfo.guestdevicesharingmaxtime||0<e&&e<=serverinfo.guestdevicesharingmaxtime)&&(c+="<option value="+e+">"+p[e]+"</option>");o=(o=(o=(o=(o=o+addHtmlValue("Doba platnosti","<select id=d2timeRange style=float:right;width:250px onchange=showShareDeviceValidate()><option value=0>Nyní začíná</option><option value=1>Časový rozsah</option><option value=2>Denně se opakující</option><option value=3>Opakující se týdně</option></select>")+"<div id=d2modenow>")+addHtmlValue("Čas vypršení platnosti","<select id=d2inviteExpire style=float:right;width:250px>"+n+"</select>")+"</div><div id=d2moderange style=display:none>")+addHtmlValue("Časový rozsah",'<input id=d2timeRangeSelector style=float:right;width:250px class=flatpickr type="text" placeholder="Vyberte datum a čas..." data-id="altinput">')+"</div><div id=d2moderecurring style=display:none>")+addHtmlValue("Doba spuštění",'<input id=d2timeStartSelector style=float:right;width:250px class=flatpickr type="text" placeholder="Vyberte datum a čas..." data-id="altinput">'))+addHtmlValue("Délka trvání","<select id=d2inviteDuration style=float:right;width:250px>"+c+"</select>")+"</div>",1&currentNode.agent.caps&&(o+="<div id=d2userConsentSelector>"+addHtmlValue("Souhlas uživatele","<select id=d2userConsent style=float:right;width:250px><option value=0>Pouze informovat<option value=1>Vyzvat k souhlasu</option><option value=2>No Consent</option></select>")+"</div>"),setDialogMode(2,"Sdílet zařízení",3,showShareDeviceEx,o=(o+="<div id=d2httpPortSelector>"+addHtmlValue("Port","<input id=d2httpPort style=float:right;width:250px value=80 onkeyup=showShareDeviceValidate()></input>")+"</div>")+("<div id=d2httpsPortSelector>"+addHtmlValue("Port","<input id=d2httpsPort style=float:right;width:250px value=443 onkeyup=showShareDeviceValidate()></input>")+"</div>")),showShareDeviceValidate();t=new Date,i=(t.setDate(t.getDate()+1),flatpickr("#d2timeRangeSelector",{mode:"range",enableTime:!0,minDate:new Date,defaultDate:[new Date,t],minuteIncrement:1})),a=flatpickr("#d2timeStartSelector",{enableTime:!0,minDate:new Date,defaultDate:new Date,minuteIncrement:1});xxdialogTag={range:i,start:a}}}function showShareDeviceValidate(){1&currentNode.agent.caps&&QV("d2userConsentSelector",Q("d2shareType").value<8),QV("d2httpPortSelector",8==Q("d2shareType").value),QV("d2httpsPortSelector",9==Q("d2shareType").value),QV("d2modenow",0==Q("d2timeRange").value),QV("d2moderange",1==Q("d2timeRange").value),QV("d2moderecurring",2<=Q("d2timeRange").value);var e,t=!0;8==Q("d2shareType").value&&(e=parseInt(Q("d2httpPort").value),Q("d2httpPort").value!=e||e<1||65535<e)&&(t=!1),9==Q("d2shareType").value&&(e=parseInt(Q("d2httpsPort").value),Q("d2httpsPort").value!=e||e<1||65535<e)&&(t=!1),0==Q("d2inviteName").value.trim().length&&(t=!1),QE("idx_dlgOkButton",t)}function showShareDeviceEx(e,t){var n=0,o=parseInt(Q("d2shareType").value),i=!1;8==o?meshserver.send({action:"createDeviceShareLink",nodeid:currentNode._id,guestname:Q("d2inviteName").value.trim(),p:8,expire:parseInt(Q("d2inviteExpire").value),port:parseInt(Q("d2httpPort").value),consent:0}):9==o?meshserver.send({action:"createDeviceShareLink",nodeid:currentNode._id,guestname:Q("d2inviteName").value.trim(),p:16,expire:parseInt(Q("d2inviteExpire").value),port:parseInt(Q("d2httpsPort").value),consent:0}):(3==o&&(i=!0),1&(o=[0,1,2,2,4,6,5,7][o])&&(n|=2,1&currentNode.agent.caps&&1==Q("d2userConsent").value&&(n|=16),1&currentNode.agent.caps)&&2==Q("d2userConsent").value&&(n=0),2&o&&(n|=65,1&currentNode.agent.caps&&1==Q("d2userConsent").value&&(n|=8),1&currentNode.agent.caps)&&2==Q("d2userConsent").value&&(n=0),4&o&&(n|=4,1&currentNode.agent.caps&&1==Q("d2userConsent").value&&(n|=32),1&currentNode.agent.caps)&&2==Q("d2userConsent").value&&(n=0),0==Q("d2timeRange").value?meshserver.send({action:"createDeviceShareLink",nodeid:currentNode._id,guestname:Q("d2inviteName").value.trim(),p:o,expire:parseInt(Q("d2inviteExpire").value),consent:n,viewOnly:i}):1==Q("d2timeRange").value?meshserver.send({action:"createDeviceShareLink",nodeid:currentNode._id,guestname:Q("d2inviteName").value.trim(),p:o,start:Math.floor(t.range.selectedDates[0].getTime()/1e3),end:Math.floor(t.range.selectedDates[1].getTime()/1e3),consent:n,viewOnly:i}):meshserver.send({action:"createDeviceShareLink",nodeid:currentNode._id,guestname:Q("d2inviteName").value.trim(),p:o,start:Math.floor(t.start.selectedDates[0].getTime()/1e3),expire:parseInt(Q("d2inviteDuration").value),recurring:Q("d2timeRange").value-1,consent:n,viewOnly:i}))}function deviceActionFunction(){var e,t,n,o,i;xxdialogMode||(e=GetNodeRights(currentNode),t=0,n="Vyberte operaci na tomto zařízení.<br /><br />",o="<select id=d2deviceop style=float:right;width:250px onchange=deviceActionFunctionValidate()>",i="",null!=currentNode.agent&&14==currentNode.agent.id?0!=(1&currentNode.conn)&&0!=(8&e)&&(t++,o+="<option value=400>Blikat</option><option value=401>Vibrovat</option>",i+="<div id=d2devicetimediv>"+addHtmlValue("Čas","<select id=d2devicetime style=float:right;width:250px><option value=1000>1 sekunda</option><option value=5000>5 sekund</option><option value=10000>10 sekund</option></select>")+"</div>"):(0!=(64&e)&&(t++,o+="<option value=100>Probudit</option>"),0!=(1&currentNode.conn)&&0!=(131072&e)&&(t++,o+="<option value=106>Spustit příkazy</option>"),0!=currentNode.conn&&0!=(262144&e)&&(t++,o+="<option value=4>Spánek</option><option value=3>Reset</option><option value=2>Vypnout</option>"),0!=(16&currentNode.conn)&&(t++,o+="<option value=103>Poslat MQTT zprávu</option>"),null!=currentNode.intelamt&&2==currentNode.intelamt.state&&0!=(6&currentNode.conn)&&0!=(262144&e)&&(t++,o+="<option value=310>Reset Intel&reg; AMT</option><option value=308>Vypnutí Intel&reg; AMT</option>",11!=xxcurrentView&&12!=xxcurrentView||(o+="<option value=312>Intel&reg; AMT Reset to BIOS</option><option value=311>Intel&reg; AMT Power on to BIOS</option><option value=315>Intel&reg; AMT Power on to PXE</option><option value=316>Intel&reg; AMT Reset to PXE</option>")),null!=currentNode.intelamt&&2==currentNode.intelamt.state&&0!=(6&currentNode.conn)&&0!=(64&e)&&(t++,o+="<option value=302>Zapněte Intel&reg; AMT</option>"),(11==xxcurrentView||12==xxcurrentView)&&15<=getNodeAmtVersion(currentNode)&&2==currentNode.intelamt.state&&0!=(6&currentNode.conn)&&4294967295==e&&0==(1024&features)&&(t++,o+="<option value=107>Intel&reg; AMT One Click Recovery</option>"),0!=(1&currentNode.conn)&&0!=(32768&e)&&(t++,o+="<option value=104>Odinstalovat agenta</option>")),n+=addHtmlValue("Operace",o+="</select>"),setDialogMode(2,"Akce zařízení",0==t?2:3,deviceActionFunctionEx,(n=0==t?"Momentálně nejsou pro toto zařízení k dispozici žádné akce.":n)+i),0<t&&deviceActionFunctionValidate())}function deviceActionFunctionValidate(){var e=Q("d2deviceop").value;try{QV("d2devicetimediv",400==e||401==e)}catch(e){}}function deviceActionFunctionEx(){var e,t,n,o=Q("d2deviceop").value;100==o?meshserver.send({action:"wakedevices",nodeids:[currentNode._id]}):103==o?p10showSendMqttMsgDialog([currentNode._id]):104==o?p10showSendUninstallAgentDialog([currentNode._id]):106==o?(t=e=!1,currentNode.agent&&(0<currentNode.agent.id&&currentNode.agent.id<5?e=!0:t=!0),1!=e&&1!=t||(n="Spouštění příkazů na vybraných zařízeních.<br />",1==e&&(n+="<select id=d2cmdtype style=width:100%;margin-bottom:4px;margin-top:4px><option value=1>Příkazový řádek systému Windows</option><option value=2>Windows PowerShell</option>",1==t&&(n+="<option value=3>Linux / BSD / macOS Command Shell</option>"),n+="</select>"),setDialogMode(2,"Spustit příkazy",3,deviceRunCmdsFunctionEx,n=n+"<select id=d2cmduser style=width:100%;margin-bottom:4px><option value=0>Spustit jako agent</option><option value=1>Spustit jako uživatel, agent, pokud žádný uživatel</option><option value=2>Musí běžet jako uživatel</option></select>"+"<textarea id=d2runcmd style=background-color:#fcf3cf;width:100%;height:200px;resize:none;overflow-y:scroll></textarea>"),Q("d2runcmd").focus())):107==o?(Q("d3localmodeform").action="oneclickrecovery.ashx",Q("d3auth").value=authCookie,Q("d3filter").value=".efi",Q("d3attrib").value=currentNode._id,setDialogMode(3,"Intel&reg; AMT One Click Recovery",3,deviceActionOneClickRecovery),d3init()):302==o?setDialogMode(2,"Provoz Intel&reg; AMT Power",3,function(){meshserver.send({action:"poweraction",nodeids:[currentNode._id],actiontype:parseInt(o)})},"Chcete zapnout napájení Intel&reg; AMT?"):308==o?setDialogMode(2,"Provoz Intel&reg; AMT Power",3,function(){meshserver.send({action:"poweraction",nodeids:[currentNode._id],actiontype:parseInt(o)})},"Perform Intel&reg; AMT power off?<br><br><b>NOTE: If there is an active AMT session, then power off command will be rejected, so you must disconnect from the AMT session first!</b>"):310==o?setDialogMode(2,"Provoz Intel&reg; AMT Power",3,function(){meshserver.send({action:"poweraction",nodeids:[currentNode._id],actiontype:parseInt(o)})},"Chcete provést reset Intel&reg; AMT?"):311==o?setDialogMode(2,"Provoz Intel&reg; AMT Power",3,function(){meshserver.send({action:"poweraction",nodeids:[currentNode._id],actiontype:parseInt(o)+(12==xxcurrentView?2:0)})},"Perform Intel&reg; AMT power on to BIOS?"):312==o?setDialogMode(2,"Provoz Intel&reg; AMT Power",3,function(){meshserver.send({action:"poweraction",nodeids:[currentNode._id],actiontype:parseInt(o)+(12==xxcurrentView?2:0)})},"Perform Intel&reg; AMT reset to BIOS?"):315==o?setDialogMode(2,"Provoz Intel&reg; AMT Power",3,function(){meshserver.send({action:"poweraction",nodeids:[currentNode._id],actiontype:parseInt(o)+(12==xxcurrentView?2:0)})},"Perform Intel&reg; AMT power on to PXE?"):316==o?setDialogMode(2,"Provoz Intel&reg; AMT Power",3,function(){meshserver.send({action:"poweraction",nodeids:[currentNode._id],actiontype:parseInt(o)+(12==xxcurrentView?2:0)})},"Perform Intel&reg; AMT reset to PXE?"):400==o||401==o?meshserver.send({action:"poweraction",nodeids:[currentNode._id],actiontype:parseInt(o),time:parseInt(Q("d2devicetime").value)}):meshserver.send({action:"poweraction",nodeids:[currentNode._id],actiontype:parseInt(o)})}function deviceActionOneClickRecovery(){var e;1==Q("d3uploadMode").value?Q("d3submit").click():1==(e=d3getFileSel()).length&&meshserver.send({action:"oneclickrecovery",nodeids:[Q("d3attrib").value],type:"diskimage",path:d3filetreelocation.join("/")+"/"+e[0]})}function deviceRunCmdsFunctionEx(){var e=3;try{e=parseInt(Q("d2cmdtype").value)}catch(e){}meshserver.send({action:"runcommands",nodeids:[currentNode._id],type:e,cmds:Q("d2runcmd").value,runAsUser:parseInt(Q("d2cmduser").value)})}function updateAmtCredentials(e){var t=getNodeFromId(currentNode._id);1==e||null==t.intelamt.user||""==t.intelamt.user?editDeviceAmtSettings(currentNode._id,updateAmtCredentialsEx):Q("p14iframe").contentWindow.connectButtonfunctionEx()}function updateAmtCredentialsEx(e,t){Q("p14iframe").contentWindow.connectButtonfunctionEx()}function updateDeviceTimeline(){2==meshserver.State&&null!=powerTimelineNode&&null!=powerTimelineUpdate&&null!=currentNode&&3!=currentNode.mtype&&powerTimelineNode==powerTimelineReq&&currentNode._id==powerTimelineNode&&powerTimelineUpdate<Date.now()&&(powerTimelineUpdate=null,meshserver.send({action:"powertimeline",nodeid:currentNode._id}),meshserver.send({action:"lastconnect",nodeid:currentNode._id}))}function drawDeviceTimeline(){if(!(null==currentNode||xxcurrentView<10||19<xxcurrentView||3==currentNode.mtype||"true"===hidePowerTimeline)){var e=null,t=Date.now(),n=(currentNode._id==powerTimelineNode&&(e=powerTimeline),new Date),o=(n.setHours(0,0,0,0),(n=new Date(n.getTime()-5184e5)).getTime(),[]);if(null!=e&&1<e.length){o.push([0,e[1],e[0]]);for(var i=e[1],a=2;a<e.length;a+=2){var s=e[a],r=t;e.length>a+1&&(r=e[a+1]),o.push([i,i+r,s]),i+=r}}var l="",d=1,u=new Date,c=Q("column_l").offsetWidth-192;u.setHours(0,0,0,0);for(a=0;a<7;a++){var p,m="",v=u.getTime(),g=v+864e5;for(p in o){var h,f,k,y=o[p];1==isTimeBlockInside(v,g,y[0],y[1])&&(k=Math.max(v,y[0]),h=Math.min(Math.min(g,y[1]),t),0<(f=Math.round((h-k)*c/864e5)))&&(k=format("{0} od {1} do {2}.",powerStateStrings2[y[2]],printTime(new Date(k)),printTime(new Date(h))),m+='<div class="pwState '+powerColor(y[2])+'" title="'+k+'" style="width:'+f+'px;"></div>')}l+="<tr class="+(d%2==0?"altBack":"")+"><td><div>&nbsp;"+printDate(u)+"<div></div></div></td><td><div>"+m+"</div></td></tr>",++d,u=new Date(u.getFullYear(),u.getMonth(),u.getDate()-1)}n="";try{n="&tz="+encodeURIComponentEx(Intl.DateTimeFormat().resolvedOptions().timeZone)}catch(e){}QH("p10html2",'<table cellpadding=2 cellspacing=0><thead><tr style=><th scope=col style=text-align:center;width:150px>Den</th><th scope=col style=text-align:center><a onclick=downloadFile("devicepowerevents.ashx?id='+currentNode._id+"&tf="+(new Date).getTimezoneOffset()+"&l="+encodeURIComponentEx(getLang())+n+(urlargs.key?"&key="+urlargs.key:"")+'",null,true)><img title="Stáhnout události napájení" src="images/link4.png" /></a>Stav napájení za uplynulých 7 dnů</th></tr></thead><tbody>'+l+"</tbody></table>")}}function powerColor(e){return e<powerColorTable.length?powerColorTable[e]:"pwsYellow"}function isTimeBlockInside(e,t,n,o){return n<e&&t<o||e<n&&n<t||e<o&&o<t}function addDeviceAttribute(e,t){return"<tr><td class=style7>"+e+"</td><td class=style9>"+t+"</td></tr>"}function editDeviceAmtSettings(e,t,n){var o,i;xxdialogMode||(o="",i=3,0!=(4&GetNodeRights(e=getNodeFromId(e)))&&(o=(o+=addHtmlValue("Uživatelské jméno",'<input id=dp10username style=width:230px maxlength=32 autocomplete=nope placeholder="admin" onchange=validateDeviceAmtSettings() onkeyup=validateDeviceAmtSettings() />'))+addHtmlValue("Heslo","<input id=dp10password type=password style=width:230px autocomplete=nope maxlength=32 onchange=validateDeviceAmtSettings() onkeyup=validateDeviceAmtSettings() />"),0==(1&features2)&&(o+=addHtmlValue("Zabezpečení","<select id=dp10tls style=width:236px><option value=0>Žádné TLS zabezpečení</option><option value=1>TLS vyžadováno</option></select>")),setDialogMode(2,"Upravit přihlašovací údaje k Intel&reg; AMT",i=null!=e.intelamt.user&&""!=e.intelamt.user?7:i,editDeviceAmtSettingsEx,o,{node:e,func:t,arg:n}),null!=e.intelamt.user&&""!=e.intelamt.user?Q("dp10username").value=e.intelamt.user:Q("dp10username").value="admin",0==(1&features2)&&(Q("dp10tls").value=e.intelamt.tls),validateDeviceAmtSettings()))}function validateDeviceAmtSettings(){QE("idx_dlgOkButton",passwordcheck(Q("dp10password").value))}function editDeviceAmtSettingsEx(e,t){var n;2==e?meshserver.send({action:"changedevice",nodeid:t.node._id,intelamt:{user:"",pass:""}}):(""==(e=Q("dp10username").value)&&(e="admin"),n=Q("dp10password").value,e={action:"changedevice",nodeid:t.node._id,intelamt:{user:e=""==n?"":e,pass:n}},0==(1&features2)&&(e.intelamt.tls=parseInt(Q("dp10tls").value)),meshserver.send(e),t.func&&setTimeout(function(){t.func(null,t.arg)},1e3))}function p10showSendMqttMsgDialog(e){var t;return xxdialogMode||(t=addHtmlValue("Téma","<input id=dp2topic style=width:230px maxlength=64 onchange=p10validateSendMqttMsgDialog() onkeyup=p10validateSendMqttMsgDialog(event,1) />"),setDialogMode(2,"Poslat MQTT zprávu",3,p10showSendMqttMsgDialogEx,t+=addHtmlValue("Zpráva","<div style=width:230px;margin:0;padding:0><textarea id=dp2msg maxlength=4096 style=width:100%;height:150px;resize:none onchange=p10validateSendMqttMsgDialog() onkeyup=p10validateSendMqttMsgDialog(event,1)></textarea></div>"),e),p10validateSendMqttMsgDialog(),Q("dp2topic").focus()),!1}function p10validateSendMqttMsgDialog(){QE("idx_dlgOkButton",0<Q("dp2topic").value.length&&0<Q("dp2msg").value.length)}function p10showSendMqttMsgDialogEx(e,t){meshserver.send({action:"sendmqttmsg",nodeids:t,topic:Q("dp2topic").value,msg:Q("dp2msg").value}),uncheckAllDevices()}function p10showSendUninstallAgentDialog(e){var t;return xxdialogMode||(t="",t=1<e.length?format("Opravdu odinstalovat označených {0} agentů?",e.length):"Opravdu odinstalovat vybraného agenta?",setDialogMode(2,"Odinstalovat agenta",3,p10showSendUninstallAgentDialogEx,t=(t+="<br /><br />")+(1<e.length?"To neodstraní zařízení ze serveru, ale ta už se k němu nebudou moci připojit Veškerý vzdálený přístup k zařízením bude ztracen. Aby tento příkaz fungoval, je třeba, aby zařízení byla připojena.":"Toto neodstraní zařízení ze serveru, ale ta už se k němu nebudou moci připojit. Veškerý vzdálený přístup k zařízení bude ztracen. Aby mohl tento příkaz fungovat, je třeba, aby zařízení bylo připojené.")+"<br /><br /><label style=color:red><input id=p10check type=checkbox onchange=p10validateDeleteNodeDialog() />Potvrdit</label>",e),p10validateSendUninstallAgentDialog()),!1}function p10validateSendUninstallAgentDialog(){QE("idx_dlgOkButton",Q("p10check").checked)}function p10showSendUninstallAgentDialogEx(e,t){meshserver.send({action:"uninstallagent",nodeids:t}),uncheckAllDevices()}function p10showChangeGroupDialog(e){if(!xxdialogMode){var t=null;if(1==e.length)try{t=meshes[getNodeFromId(e[0]).meshid]._id}catch(e){}var n,o,i="<select id=p10newGroup style=width:236px>",a=0,s=[];for(n in meshes){var r=GetMeshRights(n);meshes[n]._id!=t&&4&r&&s.push(meshes[n])}for(n in s.sort(nameSort),s)a++,i+="<option value='"+s[n]._id+"'>"+s[n].name+"</option>";i+="</select>",0<a?(o=1==e.length?"Vybrat novou skupinu pro toto zařízení<br /><br />":"Vybrat novou skupinu pro označená zařízení<br /><br />",setDialogMode(2,"Změnit skupinu",3,p10showChangeGroupDialogEx,o+=addHtmlValue("Nová skupina zařízení",i),e)):setDialogMode(2,"Změnit skupinu",1,null,"Žádná další podobná skupina zařízení neexistuje.")}return!1}function p10showChangeGroupDialogEx(e,t){meshserver.send({action:"changeDeviceMesh",nodeids:t,meshid:Q("p10newGroup").value}),uncheckAllDevices()}function p10showDeleteNodeDialog(e){return xxdialogMode||(setDialogMode(2,"Smazat uzel",3,p10showDeleteNodeDialogEx,format("Opravdu smazat uzel {0}?",EscapeHtml(currentNode.name))+"<br /><br /><label><input id=p10check type=checkbox onchange=p10validateDeleteNodeDialog() />Potvrdit</label>",e),p10validateDeleteNodeDialog()),!1}function p10validateDeleteNodeDialog(){QE("idx_dlgOkButton",Q("p10check").checked)}function p10showDeleteNodeDialogEx(e,t){meshserver.send({action:"removedevices",nodeids:[t]})}function p10WebRouter(e,t,n,o){var i=null,a=getNodeFromId(e),s=(3==a.mtype&&(s=meshes[a.meshid])&&s.relayid&&(i=s.relayid,o=a.host),serverinfo.name),a=(-1!=s.indexOf(".")&&0==(2&features)||(s=window.location.hostname),"https://"+(s=""!=webRelayDns?webRelayDns:s)+":"+webRelayPort+"/control-redirect.ashx?n="+e+"&p="+n+"&appid="+t+"&c="+authRelayCookie);return null!=o&&(a+="&addr="+o),null!=i&&(a+="&relayid="+i),safeNewWindow(a,"WebRelay"),!1}function p10MCRouter(e,t,n,o,i){var a=getNodeFromId(e),s=meshes[a.meshid];return 3==t&&null==n&&(n=null!=a.rdpport?a.rdpport:3389),3==a.mtype&&s&&s.relayid&&(e=s.relayid,o=a.host),meshserver.send({action:"getcookie",nodeid:e,tcpport:n,ip:o,tag:"MCRouter",protocol:t,localport:i,name:s?s.name:null}),!1}function p10rfb(e,t){var n=getNodeFromId(e),o=null,i=meshes[n.meshid];null==t&&(t=null!=n.rfbport?n.rfbport:5900),3==n.mtype&&i&&i.relayid&&(e=i.relayid,o=n.host),meshserver.send({action:"getcookie",nodeid:e,tcpport:t,tcpaddr:o,tag:"novnc",name:i?i.name:null})}function p10mstsc(e,t){var n=getNodeFromId(e),o=meshes[n.meshid];null==t&&(t=null!=n.rdpport?n.rdpport:3389),meshserver.send({action:"getcookie",nodeid:e,tcpport:t,tag:"mstsc",name:o?o.name:null})}function p10ssh(e,t){var n=getNodeFromId(e),o=meshes[n.meshid];null==t&&(t=null!=n.sshport?n.sshport:22),meshserver.send({action:"getcookie",nodeid:e,tcpport:t,tag:"ssh",name:o?o.name:null})}var d2map=null;function p10showNodeLocationDialog(){if(null!=xxdialogMode&&"@xxmap"==xxdialogTag)setDialogMode(0);else if(xxdialogMode)return!1;var e,t,n,o,i=[],a=["iploc","wifiloc","gpsloc","userloc"],s=null;for(e in a)null!=currentNode[a[e]]&&(n=currentNode[a[e]].split(","),t=parseFloat(n[0]),n=parseFloat(n[1]),t<90)&&-90<t&&n<180&&-180<n&&((o=new ol.Feature({geometry:new ol.geom.Point(ol.proj.fromLonLat([n,t]))})).setStyle(markerStyle(currentNode,parseInt(e)+1)),i.push(o),null==s?s=[t,n,t,n,0]:(t<s[0]&&(s[0]=t),n<s[1]&&(s[1]=n),t>s[2]&&(s[2]=t),n>s[3]&&(s[3]=n)));var r=new ol.source.Vector({features:i}),r=new ol.layer.Vector({source:r}),l=(setDialogMode(2,"Umístění zařízení",1,null,"<div id=d2map style=width:100%;height:300px></div>","@xxmap"),0),d=0,u=8;if(null!=s)for(var d=(s[0]+s[2])/2,l=(s[1]+s[3])/2,c=Math.max(Math.abs(s[0]-s[2]),Math.abs(s[1]-s[3])),p=360,u=-2;c<p;)u++,p/=2;return 1==i.length&&(u=8),d2map=new ol.Map({target:"d2map",interactions:ol.interaction.defaults({dragPan:!1,mouseWheelZoom:!1}),layers:[new ol.layer.Tile({source:new ol.source.OSM}),r],view:new ol.View({center:ol.proj.fromLonLat([l,d]),zoom:u})}),!1}function p10showNodeNetInfoDialog(){return xxdialogMode||(setDialogMode(2,"Síťová rozhraní",1,null,"<div id=d2netinfo>Načítání…</div>","if"+currentNode._id),meshserver.send({action:"getnetworkinfo",nodeid:currentNode._id})),!1}function p10showMeshRouterDialog(){var e,t;xxdialogMode||(e="<div>MeshCentral Router je Windows nástroj pro mapování TCP portů. Prostřednictvím tohoto serveru můžete například vzdáleně přistupovat na RDP vzdálenou plochu jiného počítače.</div><br />",e=(e+=addHtmlValue("Spustitelný soubor Win32",'<a style=cursor:pointer onclick=downloadFile("meshagents?meshaction=winrouter'+(urlargs.key?"&key="+urlargs.key:"")+'",null,true)>MeshCentralRouter.exe</a>'))+addHtmlValue("Instalační program MacOS",'<a style=cursor:pointer onclick=downloadFile("meshagents?meshaction=macrouter'+(urlargs.key?"&key="+urlargs.key:"")+'",null,true)>MeshCentralRouter.dmg</a>'),-1!=(t=serverinfo.name).indexOf(".")&&0==(2&features)||(t=window.location.hostname),domainUrl.substring(0,domainUrl.length-1),setDialogMode(2,"MeshCentral Router",1,null,e=(e+="<br /><div>Spusťte směrovač MeshCentral a kliknutím na tlačítko „Instalovat“ jej spusťte z prohlížeče.</div>")+('<br /><a style=cursor:pointer target="mcrouterframe" rel="noreferrer noopener" href="'+("mcrouter://"+t+(443==serverinfo.port?"":":"+serverinfo.port)+domainUrl+"control.ashx?c="+authCookie+"&t="+serverinfo.tlshash+"&l={{{lang}}}"+(urlargs.key?"&key="+urlargs.key:""))+'"><input type=button style=width:100%;cursor:pointer value="Spusťte směrovač MeshCentral" /></a>')+'<iframe style=display:none name="mcrouterframe"></iframe>',"fileDownload"))}function p10showMqttLoginDialog(e){meshserver.send({action:"getmqttlogin",nodeid:e})}function p10openxterm(e,t){haltEvent(e);var e="/xterm?nodeid="+encodeURIComponentEx(t)+"&auto=1",n=getNodeFromId(t);if(null!=n)return 0<=[1,2,3,4,21,22].indexOf(n.agent.id)?e+="&os=win":e+="&os=linux",urlargs.key&&(e+="&key="+urlargs.key),safeNewWindow(e,"xterm:"+t),!1}function p10showMeshCmdDialog(e,t){var n;xxdialogMode||(n="",0==e&&(n+="<div>MeshCmd je nástroj příkazového řádku, který provádí mnoho různých operací. Soubor akcí lze volitelně stáhnout a upravit, aby poskytoval informace o serveru a přihlašovací údaje.<br /><br />"),1==e&&(n+='<div>Stáhněte "meshcmd " se souborem akcí pro směrování provozu přes tento server do tohoto zařízení. Nezapomeňte upravit meshaction.txt a přidat heslo k účtu nebo provést potřebné změny.<br /><br />'),n=(n+=addHtmlValue("Operační systém","<select id=aginsSelect onchange=meshCmdOsClick() style=width:236px><option value=4>Windows x86 (64bit)</option><option value=3>Windows x86 (32bit)</option><option value=43>Windows ARM (64bit)</option><option value=6>Linux x86 (64bit)</option><option value=5>Linux x86 (32bit)</option><option value=16>macOS x86 (64bit)</option><option value=29>macOS ARM (64bit)</option><option value=25>Linux ARM, Raspberry Pi (32bit)</option><option value=26>Linux ARM, Raspberry Pi (64bit)</option></select>"))+addHtmlValue("MeshCmd",'<a id=meshcmddownloadid onclick=downloadFile("meshagents?meshcmd=3'+(urlargs.key?"&key="+urlargs.key:"")+'")></a>'),0==e&&(n+=addHtmlValue("Soubor akcí",'<a onclick=downloadFile("meshagents?meshaction=generic'+(urlargs.key?"&key="+urlargs.key:"")+'")>MeshAction (.txt)</a>')),1==e&&(n+=addHtmlValue("Soubor akcí",'<a onclick=downloadFile("meshagents?meshaction=route&nodeid='+t+(urlargs.key?"&key="+urlargs.key:"")+'")>MeshAction (.txt)</a>')),setDialogMode(2,"Stáhnout MeshCmd",9,null,n+="</div>","fileDownload"),meshCmdOsClick())}function meshCmdOsClick(){var e=Q("aginsSelect").value,t="";3==e&&(t="MeshCmd (Win x86-32 executable)"),4==e&&(t="MeshCmd (Win x86-64 executable)"),43==e&&(t="MeshCmd (Win ARM-64 executable)"),5==e&&(t="MeshCmd (Linux x86, 32bit)"),6==e&&(t="MeshCmd (Linux x86, 64bit)"),16==e&&(t="MeshCmd (macOS,x86-64bit)"),29==e&&(t="MeshCmd (macOS, ARM-64bit)"),25==e&&(t="MeshCmd (Linux ARM, 32bit)"),26==e&&(t="MeshCmd (Linux ARM, 64bit)"),QH("meshcmddownloadid",t),Q("meshcmddownloadid").onclick=function(){downloadFile("meshagents?meshcmd="+e+(urlargs.key?"&key="+urlargs.key:""))}}function p10showiconselector(){xxdialogMode||0!=(4&GetNodeRights(currentNode))&&(setDialogMode(2,"Výběr ikony",0,null,'<div style=text-align:center><br /><div tabindex=0 style="display:inline-block;margin:0 10px 0 10px" class=i1 onclick=p10setIcon(1) onkeypress="if (event.key==\'Enter\') p10setIcon(1)"></div><div tabindex=0 style="display:inline-block;margin:0 10px 0 10px" class=i2 onclick=p10setIcon(2) onkeypress="if (event.key==\'Enter\') p10setIcon(2)"></div><div tabindex=0 style="display:inline-block;margin:0 10px 0 10px" class=i3 onclick=p10setIcon(3) onkeypress="if (event.key==\'Enter\') p10setIcon(3)"></div><div tabindex=0 style="display:inline-block;margin:0 10px 0 10px" class=i4 onclick=p10setIcon(4) onkeypress="if (event.key==\'Enter\') p10setIcon(4)"></div><br /><div tabindex=0 style="display:inline-block;margin:0 10px 0 10px" class=i5 onclick=p10setIcon(5) onkeypress="if (event.key==\'Enter\') p10setIcon(5)"></div><div tabindex=0 style="display:inline-block;margin:0 10px 0 10px" class=i6 onclick=p10setIcon(6) onkeypress="if (event.key==\'Enter\') p10setIcon(6)"></div><div tabindex=0 style="display:inline-block;margin:0 10px 0 10px" class=i7 onclick=p10setIcon(7) onkeypress="if (event.key==\'Enter\') p10setIcon(7)"></div><div tabindex=0 style="display:inline-block;margin:0 10px 0 10px" class=i8 onclick=p10setIcon(8) onkeypress="if (event.key==\'Enter\') p10setIcon(8)"></div><br /><br /></div>'),QV("id_dialogclose",!0))}function p10setIcon(e){setDialogMode(0),meshserver.send({action:"changedevice",nodeid:currentNode._id,icon:e})}function showClearSshDialog(){setDialogMode(2,"Upravit zařízení",3,showClearSshDialogEx,"Vymazat přihlašovací údaje SSH?")}function showClearSshDialogEx(e,t){meshserver.send({action:"changedevice",nodeid:currentNode._id,ssh:0})}function showClearRdpDialog(){setDialogMode(2,"Upravit zařízení",3,showClearRdpDialogEx,"Vymazat přihlašovací údaje RDP?")}function showClearRdpDialogEx(e,t){meshserver.send({action:"changedevice",nodeid:currentNode._id,rdp:0})}var desktopNode,showEditNodeValueDialog_modes=["Název zařízení","Název stroje","Popis","Štítky"],showEditNodeValueDialog_modes2=["name","host","desc","tags"],showEditNodeValueDialog_modes3=["","","","Štítek1, Štítek2, Štítek3"],showEditNodeValueDialog_modes4=[64,64,64,4096];function showEditNodeValueDialog(e){if(!xxdialogMode){var t=addHtmlValue(showEditNodeValueDialog_modes[e],"<input id=dp10devicevalue maxlength="+showEditNodeValueDialog_modes4[e]+' placeholder="'+showEditNodeValueDialog_modes3[e]+'" onchange=p10editdevicevalueValidate('+e+",event) onkeyup=p10editdevicevalueValidate("+e+",event) />");if(3==e){var n=[],o="";for(a in nodes)if(nodes[a].tags)for(var i in nodes[a].tags)-1==n.indexOf(nodes[a].tags[i])&&n.push(nodes[a].tags[i]);if(0<n.length){for(var a in n.sort(),n)o+='<span style=padding:4px;background-color:#BBB;border-radius:3px;cursor:pointer onclick=showEditNodeValueDialogAddTag("'+encodeURIComponentEx(n[a])+'")>'+EscapeHtml(n[a])+"</span> ";t+="<div style=margin-top:8px;width:370px;line-height:26px;max-height:160px;overflow-y:auto>"+o+"</div>"}}setDialogMode(2,"Upravit zařízení",3,showEditNodeValueDialogEx,t,e);t=currentNode[showEditNodeValueDialog_modes2[e]];null==t&&(t=""),Array.isArray(t)&&(t=t.join(", ")),Q("dp10devicevalue").value=t,p10editdevicevalueValidate(),Q("dp10devicevalue").focus()}}function showEditNodeValueDialogAddTag(e){var t,n=Q("dp10devicevalue").value.split(","),o=[];for(t in n)o.push(n[t].trim());0<=o.indexOf(e)||(Q("dp10devicevalue").value+=(0==Q("dp10devicevalue").value.length?"":", ")+decodeURIComponent(e),setTimeout(function(){Q("dp10devicevalue").selectionStart=Q("dp10devicevalue").selectionEnd=9e4},0),p10editdevicevalueValidate())}function showEditNodeValueDialogEx(e,t){var n={action:"changedevice",nodeid:currentNode._id};n[showEditNodeValueDialog_modes2[t]]=Q("dp10devicevalue").value,meshserver.send(n)}function p10editdevicevalueValidate(e,t){e=1<e||0<Q("dp10devicevalue").value.length;QE("idx_dlgOkButton",e),null!=t&&1==e&&13==t.keyCode&&dialogclose(1)}function setupDesktop(){var e,t;desktopNode!=currentNode&&null!=desktop&&desktopNode._id!=currentNode._id&&(desktop.Stop(),desktop=desktopNode=null),desktopNode==currentNode&&null!=desktop||(null!=(e=multiDesktop[currentNode._id])?(QH("DeskParent",""),(t=e.m.CanvasId).setAttribute("id","Desk"),t.setAttribute("onmousedown","dmousedown(event)"),t.setAttribute("onmouseup","dmouseup(event)"),t.setAttribute("onmousemove","dmousemove(event)"),t.removeAttribute("onclick"),Q("DeskParent").appendChild(t),(desktop=e).m.SendCompressionLevel&&desktop.m.SendCompressionLevel(desktopsettings.agentencoding,desktopsettings.quality,desktopsettings.scaling,desktopsettings.framerate),desktop.onStateChanged=onDesktopStateChange,desktop.onMetadataChange=function(e){updateMetadata(desktop,"deskmetadata")},0!=(8192&features2)&&(desktop.m.stopInput=!0),desktop&&desktop.m.mouseCursorActive&&desktop.m.mouseCursorActive(!0),QV("DeskInputLockedButton",1==desktop.m.RemoteInputLock),QV("DeskInputUnLockedButton",0==desktop.m.RemoteInputLock),desktop.m.onRemoteInputLockChanged=function(e,t){QV("DeskInputLockedButton",t),QV("DeskInputUnLockedButton",!t)},desktop.m.onKeyboardStateChanged=function(e,t){QS("p11numlock").display=1&t?"inline-block":"none",QS("p11scrolllock").display=2&t?"inline-block":"none",QS("p11capslock").display=4&t?"inline-block":"none"},desktopNode=currentNode,onDesktopStateChange(desktop,desktop.State),delete multiDesktop[currentNode._id]):(null==desktop&&QH("DeskParent",'<canvas id=Desk oncontextmenu="return false" onmousedown=dmousedown(event) onmouseup=dmouseup(event) onmousemove=dmousemove(event)></canvas>'),desktopNode=currentNode),Q("Desk").addEventListener("DOMMouseScroll",function(e){return dmousewheel(e)}),Q("Desk").addEventListener("mousewheel",function(e){return dmousewheel(e)})),desktopNode=currentNode,desktop&&(desktop.m.onDisplayinfo=deskDisplayInfo)(desktop.m,desktop.m.displays,desktop.m.selectedDisplay),updateDesktopButtons(),deskAdjust(),updateMetadata(desktop,"deskmetadata")}function updateDesktopButtons(){var e=0,t=(null!=desktop&&(e=desktop.State),GetNodeRights(currentNode)),n=1==currentNode.agent?1:2,n=(QV("disconnectbutton1span",0!=e),QV("connectbutton1span",0==e&&(8&t||256&t)&&null!=currentNode.agent&&1&currentNode.agent.caps),QV("connectbutton1rspan",0==(1073741824&features)&&0==e&&8&t&&null!=currentNode.agent&&(3==currentNode.agent.id||4==currentNode.agent.id)),1==n?QV("connectbutton1hspan",0==e&&8&t&&null!=currentNode.intelamt&&2==currentNode.intelamt.state):QV("connectbutton1hspan",0==e&&8&t&&null!=currentNode.intelamt&&2==currentNode.intelamt.state&&null!=currentNode.intelamt.ver&&(null==currentNode.intelamt.sku||"number"==typeof currentNode.intelamt.sku&&0!=(8&currentNode.intelamt.sku))),QV("td7amtkvm",!(null==currentNode.intelamt||"number"==typeof currentNode.intelamt.sku&&0!=(16&currentNode.intelamt.sku)||null==currentNode.intelamt.ver&&null!=currentNode.agent||0!=e&&2!=desktop.contype)),QV("td7meshkvm",webRtcDesktop||null!=currentNode.agent&&1&currentNode.agent.caps&&(0==e||1==desktop.contype)),QV("td7rdpkvm",!(null==currentNode.agent||3!=currentNode.agent.id&&4!=currentNode.agent.id||0!=e&&4!=desktop.contype)),0==(8192&features2)&&(null==currentNode.agent||14!=currentNode.agent.id)&&(4294967295==t||0!=(8&t)&&0==(256&t)&&0==(4096&t))),o=0!=(1&currentNode.conn),i=(QE("connectbutton1",o),QE("connectbutton1r",o||3==currentNode.mtype),currentNode.rdpport&&3389!=currentNode.rdpport?QH("desktopCustomUpperRight",'<a style="cursor:pointer;line-height:22px" onclick="cmaltportaction(1,event)">'+format("RDP Port {0}",currentNode.rdpport||3389)+"</a>"):QH("desktopCustomUpperRight",""),0!=(6&currentNode.conn)),i=(QE("connectbutton1h",i),QV("deskFocusBtn",null!=desktop&&2==desktop.contype&&0!=e&&desktopsettings.showfocus),QE("DeskClip",3==e),QV("DeskClip",n&&currentNode.agent&&6144!=(6144&features2)&&11!=currentNode.agent.id&&16!=currentNode.agent.id&&(null==desktop||2!=desktop.contype)&&(1!=desktopsettings.autoclipboard||null==navigator.clipboard||null==navigator.clipboard.readText)),QE("DeskESC",3==e&&4!=desktop.contype),QV("DeskESC",browserfullscreen&&n),QE("DeskType",3==e),QV("DeskType",n),QE("DeskWD",3==e),QV("DeskWD",n),QV("deskkeys",n),QE("deskkeys",null!=desktop),QV("DeskTimer",3==e),QV("DeskLatency",3==e),QS("DeskLatency").display=3==e?"inline-block":"none",desktop&&4==desktop.contype?desktopsettings.rdpautoclipboard:desktopsettings.autoclipboard);QV("DeskClipboardOutButton",o&&n&&null!=desktop&&0==(4096&features2)&&null!=navigator.clipboard&&null!=navigator.clipboard.readText&&(1!=i||null==navigator.clipboard||null==navigator.clipboard.readText)),QV("d7deskAutoClipboardLabel",null!=navigator.clipboard.readText&&0==(4096&features2)),QV("DeskClipboardInButton",o&&n&&null!=desktop&&0==(2048&features2)&&null!=navigator.clipboard&&null!=navigator.clipboard.writeText&&(1!=i||null==navigator.clipboard||null==navigator.clipboard.readText)),3!=e&&(QV("DeskInputLockedButton",!1),QV("DeskInputUnLockedButton",!1),QV("p11numlock",!1),QV("p11scrolllock",!1),QV("p11capslock",!1)),QV("DeskRunButton",0!=(131072&t)&&o),QV("DeskSaveImageButton",3==e&&null!=Q("Desk").toBlob&&0==(1024&features2)),QV("DeskRecordButton",3==e&&null!=Q("Desk").toBlob&&null!=desktop.m.StartRecording&&0==(1024&features2)),QV("DeskChatButton",0!=(16384&t)&&0==browserfullscreen&&currentNode.agent&&o),QV("DeskNotifyButton",0!=(16384&t)&&0==browserfullscreen&&currentNode.agent&&o),QV("DeskLockButton",0!=(16384&t)&&0==browserfullscreen&&currentNode.agent&&currentNode.agent.id<5&&n&&3==e),QV("DeskToolsButton",currentNode.agent&&o),QE("DeskToolsButton",n),QV("DeskOpenWebButton",0==browserfullscreen&&n&&currentNode.agent&&o),QV("DeskBackgroundButton",n&&3==e&&1==desktop.contype&&currentNode.agent&&11!=currentNode.agent.id&&16!=currentNode.agent.id&&o),QV("DeskControlSpan",n),QV("DeskRefreshButton",3==e&&1==desktop.contype),Q("DeskControl").checked=!!(8&t)&&1==getstore("DeskControl",1),QS("DeskControlSpan").color=Q("DeskControl").checked?null:"red",0==o&&QV("DeskTools",!1)}var autoConnectDesktopTimer=null;function autoConnectDesktop(e){autoConnectDesktopTimer=null==autoConnectDesktopTimer?setInterval(function(){connectDesktop(null,1)},1e3):(clearInterval(autoConnectDesktopTimer),null)}var agentConsoleMessages=["","Čekání na povolení přístupu uživatelem ...","Odepřeno","Zahájení relace vzdáleného terminálu se nezdařilo, {0} ({1})","Časový limit","Přijata neplatná síťová data","Nelze zachytit zobrazení","Vyjednávání protokolu se nezdařilo ({0})","NLA není podporováno","SSL vyžaduje server","SSL není serverem povoleno","SSL certifikát není na serveru","Nekonzistentní příznaky","Server vyžaduje hybrid","SSL s ověřením uživatele vyžadovaným serverem"];function formatAgentConsoleMessage(e,t,n){for(null==n&&(n=[]);n.length<3;)n.push("");return(t&&t<agentConsoleMessages.length?EscapeHtml(format(agentConsoleMessages[t],n[0],n[1],n[2])):EscapeHtml(e)).split("\n").join("<br />")+"<br /><br />"}function connectDesktop(e,t,n,o){xxdialogMode||(null!=e&&0!=e.shiftKey&&3==t&&(t=1),QV("p11DeskSessionSelector",!1),p11clearConsoleMsg(),null==desktop?(desktopNode=currentNode,2==t?null==desktopNode.intelamt.user||""==desktopNode.intelamt.user?editDeviceAmtSettings(desktopNode._id,connectDesktop,2):((desktop=CreateAmtRedirect(CreateAmtRemoteDesktop("Desk"),authCookie)).debugmode=debugmode,desktop.onStateChanged=onDesktopStateChange,desktop.m.bpp=1==desktopsettings.encoding||3==desktopsettings.encoding?1:2,desktop.m.useZRLE=desktopsettings.encoding<3,desktop.m.localKeyMap=desktopsettings.localkeymap,desktop.m.ReverseMouseWheel=desktopsettings.kvmrmw,desktop.m.showmouse=desktopsettings.showmouse,desktop.m.onScreenSizeChange=deskAdjust,desktop.m.onKvmData=function(e){if(0==e.length)desktop.m._sentPresence||(desktop.m._sentPresence=!0,desktop.m.sendKvmData(JSON.stringify({action:"present",ver:1})));else{var t=null;try{t=JSON.parse(e)}catch(e){}null!=t&&null!=t.action&&("restart"==t.action?(webRtcDesktopReset(),desktop.m.sendKvmData(JSON.stringify({action:"present",ver:1}))):"present"==t.action&&null==webRtcDesktop?(webRtcDesktop={platform:t.platform},"undefined"!=typeof RTCPeerConnection?webRtcDesktop.webrtc=new RTCPeerConnection(null):"undefined"!=typeof webkitRTCPeerConnection&&(webRtcDesktop.webrtc=new webkitRTCPeerConnection(null)),webRtcDesktop.webchannel=webRtcDesktop.webrtc.createDataChannel("Datový kanál",{}),webRtcDesktop.webchannel.onopen=function(){console.log("WebRTC Data Channel Open"),Q("deskstatus").textContent=StatusStrs[desktop.State]+", Soft-KVM",desktop.m.hold(!0),webRtcDesktop.webRtcActive=!0,webRtcDesktop.softdesktop=CreateKvmDataChannel(webRtcDesktop.webchannel,CreateAgentRemoteDesktop("Desk",Q("id_mainarea")),desktop.m),webRtcDesktop.softdesktop.m.setRotation(desktop.m.rotation),webRtcDesktop.softdesktop.m.onScreenSizeChange=deskAdjust,webRtcDesktop.softdesktop.m.ImageType=webpSupport?4:1,desktopsettings.quality&&(webRtcDesktop.softdesktop.m.CompressionLevel=desktopsettings.quality),desktopsettings.scaling&&(webRtcDesktop.softdesktop.m.ScalingLevel=desktopsettings.scaling),webRtcDesktop.softdesktop.Start()},webRtcDesktop.webchannel.onclose=function(e){console.log("WebRTC Data Channel Closed"),webRtcDesktopReset()},webRtcDesktop.webrtc.onicecandidate=function(e){null==e.candidate?desktop.m.sendKvmData(JSON.stringify({action:"offer",ver:1,sdp:webRtcDesktop.webrtcoffer.sdp})):webRtcDesktop.webrtcoffer.sdp+="a="+e.candidate.candidate+"\r\n"},webRtcDesktop.webrtc.oniceconnectionstatechange=function(){null==webRtcDesktop||null==webRtcDesktop.webrtc||"disconnected"!=webRtcDesktop.webrtc.iceConnectionState&&"failed"!=webRtcDesktop.webrtc.iceConnectionState||webRtcDesktopReset()},webRtcDesktop.webrtc.createOffer(function(e){webRtcDesktop.webrtcoffer=e,webRtcDesktop.webrtc.setLocalDescription(e,function(){},webRtcDesktopReset)},webRtcDesktopReset,{mandatory:{OfferToReceiveAudio:!1,OfferToReceiveVideo:!1}})):"answer"==t.action&&null!=webRtcDesktop&&webRtcDesktop.webrtc.setRemoteDescription(new RTCSessionDescription({type:"answer",sdp:t.sdp}),function(){},webRtcDesktopReset))}},4==desktopNode.conn&&null!=desktopNode.intelamt&&1==desktopNode.intelamt.tls?desktop.Start(desktopNode._id,16995,"*","*",1):desktop.Start(desktopNode._id,16994,"*","*",0),desktop.contype=2):null==t||1==t||3==t&&4<currentNode.agent.id&&null==debugmode?((desktop=CreateAgentRedirect(meshserver,CreateAgentRemoteDesktop("Desk"),serverPublicNamePort,authCookie,authRelayCookie,domainUrl)).m.UseExtendedKeyFlag=desktopNode.agent.id<5,desktop.m.mouseCursorActive(11==xxcurrentView),desktop.debugmode=debugmode,desktop.m.debugmode=debugmode,desktop.attemptWebRTC=attemptWebRTC,desktop.webrtcconfig=webrtcconfiguration,desktop.options={},null!=n&&(desktop.options.tsid=n),null!=o&&(desktop.options.consent=o),1==desktopsettings.autolock&&(desktop.options.autolock=!0),desktop.onStateChanged=onDesktopStateChange,0!=(8192&features2)&&(desktop.m.stopInput=!0),desktop.m.onRemoteInputLockChanged=function(e,t){QV("DeskInputLockedButton",t),QV("DeskInputUnLockedButton",!t)},desktop.m.onKeyboardStateChanged=function(e,t){QS("p11numlock").display=1&t?"inline-block":"none",QS("p11scrolllock").display=2&t?"inline-block":"none",QS("p11capslock").display=4&t?"inline-block":"none"},desktop.onConsoleMessageChange=function(){desktop.consoleMessage?(Q("p11DeskConsoleMsg").innerHTML+=formatAgentConsoleMessage(desktop.consoleMessage,desktop.consoleMessageId,desktop.consoleMessageArgs),QV("p11DeskConsoleMsg",!0),null!=p11DeskConsoleMsgTimer&&clearTimeout(p11DeskConsoleMsgTimer),desktop.consoleMessageTimeout&&(p11DeskConsoleMsgTimer=setTimeout(p11clearConsoleMsg,1e3*desktop.consoleMessageTimeout))):p11clearConsoleMsg()},desktop.onMetadataChange=function(e){updateMetadata(desktop,"deskmetadata")},desktop.m.ImageType=desktopsettings.agentencoding,desktop.m.CompressionLevel=desktopsettings.quality,desktop.m.ScalingLevel=desktopsettings.scaling,desktopsettings.framerate&&(desktop.m.FrameRateTimer=desktopsettings.framerate),desktopsettings.swapmouse&&(desktop.m.SwapMouse=desktopsettings.swapmouse),desktopsettings.rmw&&(desktop.m.ReverseMouseWheel=desktopsettings.rmw),1==desktopsettings.remotekeymap&&(desktop.m.remoteKeyMap=desktopsettings.remotekeymap),desktop.m.onScreenSizeChange=deskAdjust,desktop.Start(desktopNode._id),desktop.latency.callback=function(e){updateSessionTime()},desktop.contype=1):3==t?meshserver.send({action:"msg",type:"userSessions",nodeid:currentNode._id,tag:o}):4==t&&((desktop=CreateRDPDesktop("Desk",domainUrl)).onStateChanged=onDesktopStateChange,desktop.m.onScreenSizeChange=mdeskAdjust,desktop.m.onClipboardChanged=function(e){null!=e&&desktopsettings.rdpautoclipboard&&null!=navigator.clipboard&&navigator.clipboard.writeText(e).then(function(){}).catch(function(e){console.log(e)})},desktopsettings.rdpsmb&&(desktop.m.SwapMouse=desktopsettings.rdpsmb),desktopsettings.rdprmw&&(desktop.m.ReverseMouseWheel=desktopsettings.rdprmw),desktop.Start(desktopNode._id,currentNode.rdpport||3389,n),desktop.contype=4,desktop.onConsoleMessageChange=function(){desktop.consoleMessage?(Q("p11DeskConsoleMsg").innerHTML+=formatAgentConsoleMessage(desktop.consoleMessage,desktop.consoleMessageId,desktop.consoleMessageArgs),QV("p11DeskConsoleMsg",!0),null!=p11DeskConsoleMsgTimer&&clearTimeout(p11DeskConsoleMsgTimer),desktop.consoleMessageTimeout&&(p11DeskConsoleMsgTimer=setTimeout(p11clearConsoleMsg,1e3*desktop.consoleMessageTimeout))):p11clearConsoleMsg()})):(desktop.Stop(),webRtcDesktopReset(),(desktopNode=desktop=null)!=pluginHandler&&pluginHandler.callHook("onDesktopDisconnect")))}function askRdpCredentials(){var e;xxdialogMode||(e="<div>",1==currentNode.rdp?e=e+addHtmlValue("Pověření","<select id=d2mode style=width:230px onchange=askRdpCredentialsValidate()><option value=1>Použijte pověření serveru</option><option value=2>Použijte nová pověření</option></select>")+"<div id=d2cred style=display:none>":e+="<div id=d2cred>",e=(e=(e+=addHtmlValue("Doména","<input type=text id=d2domain style=width:230px maxlength=128 />"))+addHtmlValue("Uživatelské jméno","<input type=text id=d2user style=width:230px onKeyUp=askRdpCredentialsValidate() maxlength=128 />"))+addHtmlValue("Heslo","<input type=password id=d2pass style=width:230px maxlength=128 autocomplete=off />"),0==(4194304&features2)&&(e+=addHtmlValue("",'<label><input type="checkbox" id=d2savecred>Pamatujte si přihlašovací údaje</label>')),setDialogMode(2,"Pověření RDP",19,askRdpCredentialsEx,e=(e=(e=(e=(e+="</div>")+MoreStart())+addHtmlValue("Alternativní prostředí","<input type=text id=d2altshell style=width:230px maxlength=2048 />"))+addHtmlValue("Pracovní adresář","<input type=text id=d2workdir style=width:230px maxlength=2048 />"))+MoreEnd()))}function askRdpCredentialsValidate(){1==currentNode.rdp&&(QV("d2cred",2==Q("d2mode").value),1==Q("d2mode").value)?QE("idx_dlgOkButton",!0):QE("idx_dlgOkButton",""!=Q("d2user").value)}function askRdpCredentialsEx(){var e,t=null,n=null;desktopsettings.rdpsize?"browser"==desktopsettings.rdpsize?(t=window.innerWidth,n=window.innerHeight):"screen"==desktopsettings.rdpsize?(t=window.screen.width,n=window.screen.height):"canvas"==desktopsettings.rdpsize?(t=Q("DeskParent").offsetWidth,n=Q("DeskParent").offsetHeight):1<=(e=desktopsettings.rdpsize.indexOf("x"))&&(t=parseInt(desktopsettings.rdpsize.substring(0,e)),n=parseInt(desktopsettings.rdpsize.substring(e+1))):(t=Q("DeskParent").offsetWidth,n=Q("DeskParent").offsetHeight),1==currentNode.rdp&&1==Q("d2mode").value?connectDesktop(null,4,{servercred:!0,width:t,height:n,flags:null!=desktopsettings.rdpflags?desktopsettings.rdpflags:47,altshell:Q("d2altshell").value,workdir:Q("d2workdir").value}):(e=!1,0==(4194304&features2)&&(e=Q("d2savecred").checked),connectDesktop(null,4,{domain:Q("d2domain").value,username:Q("d2user").value,password:Q("d2pass").value,savecred:e,width:t,height:n,flags:null!=desktopsettings.rdpflags?desktopsettings.rdpflags:47,altshell:Q("d2altshell").value,workdir:Q("d2workdir").value}))}function updateMetadata(e,t){var n="",o=0;if(e&&3==e.State){if(e.metadata&&e.metadata.users)for(var i in e.metadata.users)o+=e.metadata.users[i];1<o&&(n="<span onclick=showSessionMetadata(1) style=cursor:pointer>"+format(", {0} sledování",o)+"</span>")}QH("deskmetadata",n),e==desktop&&"sessionMetadata1"==xxdialogTag&&showSessionMetadata(1)}function showSessionMetadata(e){if(!xxdialogMode||xxdialogTag=="sessionMetadata"+e){xxdialogMode&&setDialogMode(0);var t=1==e?desktop:null;if(t&&t.metadata){var n="";if(t.metadata.startTime&&(n+=addHtmlValue4("Doba spuštění",printDateTime(new Date(t.metadata.startTime)))),t.metadata.users)for(var o in t.metadata.users){var i=1==t.metadata.users[o]?"1 připojení":format("Počet připojení: {0}",t.metadata.users[o]);n+=addHtmlValue2(getUserName(o),i)}setDialogMode(2,"Informace o relaci",1,null,n,"sessionMetadata"+e)}}}function p11clearConsoleMsg(){QH("p11DeskConsoleMsg",""),QV("p11DeskConsoleMsg",!1),p11DeskConsoleMsgTimer&&(clearTimeout(p11DeskConsoleMsgTimer),p11DeskConsoleMsgTimer=null)}function p12clearConsoleMsg(){QH("p12TermConsoleMsg",""),QV("p12TermConsoleMsg",!1),p12TermConsoleMsgTimer&&(clearTimeout(p12TermConsoleMsgTimer),p12TermConsoleMsgTimer=null)}function p13clearConsoleMsg(){QH("p13FilesConsoleMsg",""),QV("p13FilesConsoleMsg",!1),p13FilesConsoleMsgTimer&&(clearTimeout(p13FilesConsoleMsgTimer),p13FilesConsoleMsgTimer=null)}function p12setConsoleMsg(e,t){e?(Q("p12TermConsoleMsg").innerHTML+=e,QV("p12TermConsoleMsg",!0),null!=p12TermConsoleMsgTimer&&clearTimeout(p12TermConsoleMsgTimer),t&&(p12TermConsoleMsgTimer=setTimeout(p12clearConsoleMsg,t))):p12clearConsoleMsg()}function p13setConsoleMsg(e,t){e?(Q("p13FilesConsoleMsg").innerHTML+=e,QV("p13FilesConsoleMsg",!0),null!=p13FilesConsoleMsgTimer&&clearTimeout(p13FilesConsoleMsgTimer),t&&(p13FilesConsoleMsgTimer=setTimeout(p13clearConsoleMsg,t))):p13clearConsoleMsg()}var webRtcDesktop=null;function webRtcDesktopReset(){if(null!=webRtcDesktop){if(null!=webRtcDesktop.softdesktop&&(webRtcDesktop.softdesktop.Stop(),webRtcDesktop.softdesktop=null),null!=webRtcDesktop.webchannel){try{webRtcDesktop.webchannel.close()}catch(e){}webRtcDesktop.webchannel=null}if(null!=webRtcDesktop.webrtc){try{webRtcDesktop.webrtc.close()}catch(e){}webRtcDesktop.webrtc=null}webRtcDesktop=null,desktop&&desktop.m&&(desktop.m.hold(!1),Q("deskstatus").textContent=StatusStrs[desktop.State])}}function onDesktopStateChange(e,t){var n=t,e=(3==n&&2==e.contype&&n++,StatusStrs[n]);switch(null!=desktop&&1==desktop.webRtcActive&&(e+=", WebRTC"),null!=desktop&&3==n&&4==desktop.contype&&(e+=", RDP"),QH("deskstatus",e),t){case 0:null!=desktop&&(null!=desktop.m.recordedData&&deskRecordSession(),desktop.Stop()),desktopNode=desktop=null,QV("DeskFocus",!1),QV("DeskMonitorSelectionSpan",!1),QV("deskRecordIcon",!1),QV("DeskInputLockedButton",!1),QV("DeskInputUnLockedButton",!1),deskFocusBtn.value="Zaměřit vše",1==fullscreen&&deskToggleFull(),webRtcDesktopReset(),deskPreferedStickyDisplay=0;break;case 2:break;case 3:desktop&&1==desktop.serverIsRecording&&QV("deskRecordIcon",!0),desktop.startTime=new Date,(deskLastClipboardSent=null)==updateSessionTimer&&(updateSessionTimer=setInterval(updateSessionTime,1e3))}updateDesktopButtons(),deskAdjust(),setTimeout(deskAdjust,50),updateMetadata(desktop,"deskmetadata")}function updateSessionTime(){var e="",t=0;if(desktop&&desktop.startTime){if(desktop.latency&&0<=desktop.latency.current&&(e=format("{0} ms",desktop.latency.current)),t=Math.floor((new Date-desktop.startTime)/1e3),QH("DeskTimer",zeroPad(Math.floor(t/3600),2)+":"+zeroPad(Math.floor(t/60)%60,2)+":"+zeroPad(t%60,2)),QH("DeskLatency",e),(4!=desktop.contype&&!0===desktopsettings.autoclipboard||4==desktop.contype&&!0===desktopsettings.rdpautoclipboard)&&null!=navigator.clipboard&&null!=navigator.clipboard.readText){if("firefox"==Mstsc.browser())return;try{navigator.clipboard.readText().then(function(e){null!=desktop&&null!=e&&deskLastClipboardSent!=e&&(desktop.m.setClipboard?desktop.m.setClipboard(e):(console.log("s3"),meshserver.send({action:"msg",type:"setclip",nodeid:currentNode._id,data:e})),deskLastClipboardSent=e)}).catch(function(e){})}catch(e){console.log(e)}}}else QH("DeskTimer",""),QH("DeskLatency","");t=0,terminal&&terminal.startTime?(terminal.latency&&0<=terminal.latency.current&&(e=format("{0} ms, ",terminal.latency.current)),t=Math.floor((new Date-terminal.startTime)/1e3),QH("TermTimer",e+zeroPad(Math.floor(t/3600),2)+":"+zeroPad(Math.floor(t/60)%60,2)+":"+zeroPad(t%60,2))):QH("TermTimer",""),null==desktop&&null==terminal&&(clearInterval(updateSessionTimer),updateSessionTimer=null)}function showDesktopSettings(){var e;xxdialogMode||(applyDesktopSettings(),updateDesktopButtons(),e=!1,0==(e="none"!=QS("td7meshkvm").display&&0<Q("td7meshkvm").className.indexOf("active")||"none"!=QS("td7rdpkvm").display&&0<Q("td7rdpkvm").className.indexOf("active")||"none"!=QS("td7amtkvm").display&&0<Q("td7amtkvm").className.indexOf("active")?!0:e)&&("none"!=QS("td7meshkvm").display?changeDesktopSettingsTab(null,"d7meshkvm"):"none"!=QS("td7rdpkvm").display?changeDesktopSettingsTab(null,"d7rdpkvm"):"none"!=QS("td7amtkvm").display&&changeDesktopSettingsTab(null,"d7amtkvm")),setDialogMode(7,"Nastavení vzdálené plochy",3,showDesktopSettingsChanged))}function changeDesktopSettingsTab(e,t){for(var n,o=document.getElementsByClassName("tabcontent"),i=0;i<o.length;i++)o[i].style.display="none";for(n=document.getElementsByClassName("tablinks"),i=0;i<n.length;i++)n[i].className=n[i].className.replace(" active","");document.getElementById(t).style.display="block",null!=e?e.currentTarget.className+=" active":document.getElementById("t"+t).className+=" active"}function showDesktopSettingsChanged(){desktopsettings.encoding=d7desktopmode.value,desktopsettings.showfocus=d7showfocus.checked,desktopsettings.showmouse=d7showcursor.checked,desktopsettings.quality=d7bitmapquality.value,desktopsettings.scaling=d7bitmapscaling.value,desktopsettings.framerate=d7framelimiter.value,desktopsettings.agentencoding=d7encoding.value,desktopsettings.swapmouse=d7deskSwapMouse.checked,desktopsettings.rmw=d7deskrmw.checked,desktopsettings.remotekeymap=d7deskRemoteKeyMap.checked,desktopsettings.autoclipboard=d7deskAutoClipboard.checked,desktopsettings.autolock=d7deskAutoLock.checked,desktopsettings.localkeymap=d7localKeyMap.checked,desktopsettings.kvmrmw=d7kvmrmw.checked,desktopsettings.rdpsize=d7rdpsize.value,desktopsettings.rdpsmb=d7rdpsmb.checked,desktopsettings.rdprmw=d7rdprmw.checked,desktopsettings.rdpautoclipboard=d7rdpclip.checked;for(var e=0,t=1;t<10;t++)5!=t&&Q("d7rdp"+t).checked&&(e|=1<<t-1);desktopsettings.rdpflags=e,localStorage.setItem("desktopsettings",JSON.stringify(desktopsettings)),applyDesktopSettings(),updateDesktopButtons(),desktop&&(1==desktop.contype&&(desktop.m.SwapMouse=desktopsettings.swapmouse,desktop.m.ReverseMouseWheel=desktopsettings.rmw,desktop.m.remoteKeyMap=desktopsettings.remotekeymap,0!=desktop.State)&&(desktop.m.SendCompressionLevel(desktopsettings.agentencoding,desktopsettings.quality,desktopsettings.scaling,desktopsettings.framerate),desktop.sendCtrlMsg('{"ctrlChannel":"102938","type":"autolock","value":'+desktopsettings.autolock+"}"),desktop.m.SendRefresh()),2==desktop.contype&&(desktop.m.ReverseMouseWheel=desktopsettings.kvmrmw,0==desktopsettings.showfocus&&(desktop.m.focusmode=0,deskFocusBtn.value="Zaměřit vše"),0!=desktop.State)&&(desktop.Stop(),setTimeout(function(){connectDesktop(null,2)},50)),4==desktop.contype)&&(desktop.m.SwapMouse=desktopsettings.rdpsmb,desktop.m.ReverseMouseWheel=desktopsettings.rdprmw)}function applyDesktopSettings(){var e="",t=512&features?[100,90,80,70,60,50,40,30,20,10,5,1]:[60,50,40,30,20,10,5,1];for(n in t)e+="<option value="+t[n]+">"+t[n]+"%</option>";QH("d7bitmapquality",e),d7desktopmode.value=desktopsettings.encoding,d7showfocus.checked=desktopsettings.showfocus,d7showcursor.checked=desktopsettings.showmouse,desktopsettings.agentencoding?d7encoding.value=desktopsettings.agentencoding:desktopsettings.agentencoding=4,d7bitmapquality.value=40,0<=t.indexOf(parseInt(desktopsettings.quality))&&(d7bitmapquality.value=desktopsettings.quality),d7bitmapscaling.value=desktopsettings.scaling,desktopsettings.framerate?d7framelimiter.value=desktopsettings.framerate:d7framelimiter.value=100,null!=desktopsettings.swapmouse&&(d7deskSwapMouse.checked=desktopsettings.swapmouse),null!=desktopsettings.rmw&&(d7deskrmw.checked=desktopsettings.rmw),null!=desktopsettings.remotekeymap&&(d7deskRemoteKeyMap.checked=desktopsettings.remotekeymap),null!=desktopsettings.autoclipboard&&(d7deskAutoClipboard.checked=desktopsettings.autoclipboard),null!=desktopsettings.autolock&&(d7deskAutoLock.checked=desktopsettings.autolock),desktopsettings.localkeymap&&(d7localKeyMap.checked=desktopsettings.localkeymap),desktopsettings.kvmrmw&&(d7kvmrmw.checked=desktopsettings.kvmrmw),QV("deskFocusBtn",null!=desktop&&2==desktop.contype&&0!=desktop.state&&desktopsettings.showfocus),null!=desktopsettings.rdpsize&&(d7rdpsize.value=desktopsettings.rdpsize),null==desktopsettings.rdpflags&&(desktopsettings.rdpflags=47),null!=desktopsettings.rdpsmb&&(d7rdpsmb.checked=desktopsettings.rdpsmb),null!=desktopsettings.rdprmw&&(d7rdprmw.checked=desktopsettings.rdprmw),null!=desktopsettings.rdpautoclipboard&&(d7rdpclip.checked=desktopsettings.rdpautoclipboard);for(var n=1;n<10;n++)5!=n&&(Q("d7rdp"+n).checked=0!=(desktopsettings.rdpflags&1<<n-1))}function enterBrowserFullscreen(e){navigator.keyboard&&navigator.keyboard.lock&&navigator.keyboard.lock(),e.requestFullscreen?e.requestFullscreen():e.msRequestFullscreen?e.msRequestFullscreen():e.mozRequestFullScreen?e.mozRequestFullScreen():e.webkitRequestFullscreen&&e.webkitRequestFullscreen(Element.ALLOW_KEYBOARD_INPUT)}function exitBrowserFullscreen(){document.exitFullscreen?document.exitFullscreen():document.msExitFullscreen?document.msExitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitExitFullscreen&&document.webkitExitFullscreen(),navigator.keyboard&&navigator.keyboard.unlock&&navigator.keyboard.unlock()}function isBrowserFullscreen(){return!!(document.fullscreenElement||document.mozFullScreenElement||document.webkitFullscreenElement||document.msFullscreenElement)}var fullscreen=!1,browserfullscreen=!1;function deskToggleFull(e){var t=!(0===args.xterm||null!=terminal&&null==xterm);(fullscreen=!fullscreen)?(QC("body").add("fulldesk"),QS("deskarea3x").height="100%",QS("deskarea3x")["max-height"]="100%",t?(QS("termTable").position="absolute",QS("termTable").top=QS("termTable").bottom=QS("termTable").left=QS("termTable").right="0"):(QS("termTable").height="100%",QS("termTable")["max-height"]="100%"),1==e.shiftKey&&(enterBrowserFullscreen(Q("container")),browserfullscreen=!0)):(QC("body").remove("fulldesk"),e=args.hide,0==footerBar&&(e|=4),e=(1&e?0:66)+(2&e?0:24)+(4&e?0:45)+(8&e?0:60),QS("deskarea3x").height="calc(100vh - "+(75+e)+"px)",QS("deskarea3x")["max-height"]="calc(100vh - "+(75+e)+"px)",t?(QS("termTable").position=null,QS("termTable").top=QS("termTable").bottom=QS("termTable").left=QS("termTable").right=null):(QS("termTable").height="calc(100vh - "+(75+e)+"px)",QS("termTable")["max-height"]="calc(100vh - "+(75+e)+"px)"),1==browserfullscreen&&(exitBrowserFullscreen(),browserfullscreen=!1)),deskAdjust(),updateDesktopButtons(),adjustPanels(),null!=xterm&&12==xxcurrentView&&(xtermfit.fit(),xterm.focus())}function deskToggleFocus(){desktop.m.focusmode=(desktop.m.focusmode+64)%192,Q("deskFocusBtn").value=["Zaměřit vše","Malé zaměření","Velké zaměření"][desktop.m.focusmode/64]}function deskAdjust(){var e=Q("DeskParent").clientHeight,t=Q("DeskParent").clientWidth,n=Q("Desk").height,o=Q("Desk").width;2==deskAspectRatio?(QS("Desk")["margin-top"]=null,QS("Desk").height="100%",QS("Desk").width="100%",QS("DeskParent").overflow="hidden"):1==deskAspectRatio?(QS("Desk")["margin-top"]="0px",QS("Desk").height=n+"px",QS("Desk").width=o+"px",QS("DeskParent").overflow="scroll"):(n/o<e/t?(t=n*t/o+"px",QS("Desk").height=t,QS("Desk").width="100%"):(t=o*e/n+"px",QS("Desk").height=webPageFullScreen||fullscreen?null:"100%",QS("Desk").width=t),QS("Desk")["margin-top"]=null,QS("DeskParent").overflow="hidden")}function mdeskAdjust(e,t,n,o){var i;e&&t&&n&&o&&(3!=(i=Q("viewselect").value)&&5!=i||("Desk"==o.id?deskAdjust():(5==i&&(i=[{x:180,y:101},{x:302,y:169},{x:454,y:255}][Q("sizeselect").selectedIndex],QS(o.id).width=(0!=e.State?t*i.y/n:i.x)+"px"),QS(o.id)["margin-top"]=null,QS(o.id)["margin-bottom"]=null)))}function sendDeskEsc(){null!=desktop&&3==desktop.State&&(2==desktop.contype?desktop.m.sendkey([[65307,1],[65307,0]]):desktop.m.SendKeyMsgKC([[desktop.m.KeyAction.EXDOWN,27],[desktop.m.KeyAction.EXUP,27]]))}function p11fileDragDrop(e){var t;haltEvent(e),QV("p11bigfail",!1),QV("p11bigok",!1),null==xxdialogMode&&null!=desktop&&3==desktop.State&&null!=e.dataTransfer&&0!=e.dataTransfer.files.length&&((t=(e=e.dataTransfer.files[0]).name.toLowerCase()).endsWith(".bat")||t.endsWith(".ps1")||t.endsWith(".sh")||t.endsWith(".agentconsole")?d2runCommandDialog({nodeids:[currentNode._id],selectedFile:e}):t.endsWith(".txt")&&((t=new FileReader).onload=function(e){showDeskType(e.target.result)},t.readAsText(e)))}var p11dragtimer=null;function p11fileDragOver(e){haltEvent(e),null!=p11dragtimer&&(clearTimeout(p11dragtimer),p11dragtimer=null);e=null==xxdialogMode&&null!=desktop&&3==desktop.State;QV("p11bigok",e),QV("p11bigfail",!e)}function p11fileDragLeave(e){haltEvent(e),"Desk"!=e.target.id?(QV("p11bigfail",!1),QV("p11bigok",!1)):p11dragtimer=setTimeout(function(){QV("p11bigfail",!1),QV("p11bigok",!1),p11dragtimer=null},10)}function updateDeskShortcutKeys(){var e,t="",n=parseInt(Q("deskkeys").value);for(e in""==n&&0<deskKeyboardShortcuts.length&&(n=deskKeyboardShortcuts[0]),deskKeyboardShortcuts)t+="<option value="+deskKeyboardShortcuts[e]+(n==deskKeyboardShortcuts[e]?" selected":"")+">"+keyShortcutTotext(deskKeyboardShortcuts[e])+"</option>";QH("deskkeys",t)}var keyStrings={8:"BackSpace",9:"Tab",13:"Zadání",27:"Uniknout",32:"Space",44:"Tisk obrazovky",45:"Vložit",46:"Del",36:"Domov",35:"Konec",33:"Page Up",34:"Page Down",37:"Vlevo, odjet",38:"Nahoru",39:"Že jo",40:"Dolů",0:"Nic"};function keyShortcutTotext(e){var t=[];return 65536&e&&t.push("Posun"),131072&e&&t.push("Alt"),524288&e&&t.push("Ctrl"),1048576&e&&t.push("Win"),112<=(e&=65535)&&e<=123?t.push("F"+(e-111)):0!=e&&keyStrings[e]?t.push(keyStrings[e]):0!=e&&t.push(String.fromCharCode(e)),t.join(" + ")}function deskCustomizeKeys(){if(!xxdialogMode){var e=(e='<div id=d2shortcuts style="width:100%;height:180px;padding:4px;overflow-y:auto;border:1px solid gray"></div><div style=width:100%;padding:5px>')+"<label><input id=d1kshift type=checkbox /> Posun</label><label> <input id=d1kalt type=checkbox /> Alt</label><label> <input id=d1kctrl type=checkbox /> Ctrl</label> <input id=d1kwin type=checkbox /> Win</label>"+" <select id=d2keySelect>";for(t in keyStrings)e+="<option value="+t+">"+keyStrings[t]+"</option>";for(var t=1;t<=12;t++)e+="<option value="+(t+111)+">F"+t+"</option>";for(t=0;t<10;t++)e+="<option value="+(t+48)+">"+t+"</option>";for(t=0;t<26;t++)e+="<option value="+(t+65)+">"+String.fromCharCode(t+65)+"</option>";setDialogMode(2,"Přizpůsobení klávesových zkratek",1,deskCustomizeKeysEx,e=e+"</select> <input type=button value=Přidat onclick=addDeskCustomizeKey() /></div>"+'<div style=width:100%;padding:2px;text-align:center><input type=button value="Restore Default Keyboard Shortcuts" onclick=restoreDeskCustomizeKey() /></div>'),deskUpdateShortcutList()}}function deskCustomizeKeysEx(){putstore("deskKeyShortcuts",deskKeyboardShortcuts.join(",")),updateDeskShortcutKeys()}function deskUpdateShortcutList(){var e,t="";for(e in deskKeyboardShortcuts){var n=keyShortcutTotext(deskKeyboardShortcuts[e]),o="";e!=deskKeyboardShortcuts.length-1&&(o+='<img width=8 height=8 style=float:right;cursor:pointer;padding:3px src="images/c2.png" onclick=deskCustomizeKeyDown('+deskKeyboardShortcuts[e]+")>"),0!=e&&(o+='<img width=8 height=8 style=float:right;cursor:pointer;padding:3px src="images/c3.png" onclick=deskCustomizeKeyUp('+deskKeyboardShortcuts[e]+")>"),t+='<div style="width:100%;background-color:#AAA;border-radius:4px;margin-bottom:4px;padding:4px;text-align:left;box-sizing:border-box" value='+deskKeyboardShortcuts[e]+">"+n+'<img width=10 height=10 style=float:right;cursor:pointer;padding:2px;margin-left:8px src="images/trash.png" onclick=removeDeskCustomizeKey('+deskKeyboardShortcuts[e]+")>"+o+"</div>"}""==t&&(t="<i>Nejsou definovány žádné klávesové zkratky</i>"),QH("d2shortcuts",t)}function deskCustomizeKeyDown(e){var e=deskKeyboardShortcuts.indexOf(e),t=deskKeyboardShortcuts[e+1];deskKeyboardShortcuts[e+1]=deskKeyboardShortcuts[e],deskKeyboardShortcuts[e]=t,deskUpdateShortcutList()}function deskCustomizeKeyUp(e){var e=deskKeyboardShortcuts.indexOf(e),t=deskKeyboardShortcuts[e];deskKeyboardShortcuts[e]=deskKeyboardShortcuts[e-1],deskKeyboardShortcuts[e-1]=t,deskUpdateShortcutList()}function removeDeskCustomizeKey(e){var t,n=[];for(t in deskKeyboardShortcuts)deskKeyboardShortcuts[t]!=e&&n.push(deskKeyboardShortcuts[t]);deskKeyboardShortcuts=n,deskUpdateShortcutList()}function restoreDeskCustomizeKey(){deskKeyboardShortcuts=[],putstore("deskKeyShortcuts",null);var e,t=getstore("deskKeyShortcuts","0x0A002E,0x100000,0x100028,0x100026,0x10004C,0x10004D,0x11004D,0x100052,0x020073,0x080057,0x020009,0x100025,0x100027").split(",");for(e in t)""!=t[e]&&deskKeyboardShortcuts.push(parseInt(t[e]));updateDeskShortcutKeys(),deskUpdateShortcutList()}function addDeskCustomizeKey(){var e=parseInt(Q("d2keySelect").value);Q("d1kshift").checked&&(e|=65536),Q("d1kalt").checked&&(e|=131072),Q("d1kctrl").checked&&(e|=524288),Q("d1kwin").checked&&(e|=1048576),0<e&&-1==deskKeyboardShortcuts.indexOf(e)&&(deskKeyboardShortcuts.push(e),deskUpdateShortcutList())}function deskCustomizeStrings(){var e;xxdialogMode||(e='<div id=d2strings style="width:100%;height:180px;padding:4px;overflow-y:auto;border:1px solid gray"></div><div style=width:100%;padding:5px>',setDialogMode(2,"Přizpůsobení řetězců klávesnice",1,deskCustomizeStringsEx,e=(e=(e+=addHtmlValue("Název","<input type=text id=d2shortcutname style=width:230px maxlength=32 autocomplete=off onkeyup=deskCustomizeStringsUpdate(event) />"))+addHtmlValue("Hodnota","<input type=text id=d2shortcutvalue style=width:230px maxlength=256 autocomplete=off onkeyup=deskCustomizeStringsUpdate(event) />"))+addHtmlValue("","<input id=d2addbutton type=button value=Přidat onclick=addDeskCustomizeString() style=float:right />")),deskUpdateStringsList(),deskCustomizeStringsUpdate())}function deskCustomizeStringsUpdate(){QE("d2addbutton",""!=Q("d2shortcutname").value&&""!=Q("d2shortcutvalue").value)}function deskCustomizeStringsEx(){putstore("deskStrings",JSON.stringify(deskKeyboardStrings)),updateDesktopStrings()}function deskUpdateStringsList(){var e,t="";for(e in deskKeyboardStrings){var n="";e!=deskKeyboardStrings.length-1&&(n+='<img width=8 height=8 style=float:right;cursor:pointer;padding:3px src="images/c2.png" onclick=deskCustomizeStringDown('+e+")>"),0!=e&&(n+='<img width=8 height=8 style=float:right;cursor:pointer;padding:3px src="images/c3.png" onclick=deskCustomizeStringUp('+e+")>"),t=(t+='<div style="width:100%;background-color:#AAA;border-radius:4px;margin-bottom:4px;padding:4px;text-align:left;box-sizing:border-box" value='+(e+1e3)+"><div><b>"+EscapeHtml(deskKeyboardStrings[e].n)+'</b><img width=10 height=10 style=float:right;cursor:pointer;padding:2px;margin-left:8px src="images/trash.png" onclick=removeDeskCustomizeString('+e+")>"+n+"</div>")+("<div stlye=font-size:x-small>"+EscapeHtml(deskKeyboardStrings[e].v)+"</div>")+"</div>"}""==t&&(t="<i>Nejsou definovány žádné klávesové řetězce</i>"),QH("d2strings",t)}function deskCustomizeStringDown(e){var t=deskKeyboardStrings[e+1];deskKeyboardStrings[e+1]=deskKeyboardStrings[e],deskKeyboardStrings[e]=t,deskUpdateStringsList()}function deskCustomizeStringUp(e){var t=deskKeyboardStrings[e];deskKeyboardStrings[e]=deskKeyboardStrings[e-1],deskKeyboardStrings[e-1]=t,deskUpdateStringsList()}function removeDeskCustomizeString(e){deskKeyboardStrings.splice(e,1),deskUpdateStringsList()}function addDeskCustomizeString(){Array.isArray(deskKeyboardStrings)||(deskKeyboardStrings=[]);var e=Q("d2shortcutname").value,t=Q("d2shortcutvalue").value;""!=e&&""!=t&&(deskKeyboardStrings.push({n:e,v:t}),deskUpdateStringsList())}function updateDesktopStrings(){var e,t="";for(e in deskKeyboardStrings)t+='<div class="cmtext" onclick="cmdeskpreconfigtypeaction('+(parseInt(e)+1e3)+',event)">'+EscapeHtml(deskKeyboardStrings[e].n)+"</div>";""!=t&&(t+="<hr />"),QH("deskPreConfigShortcutContextMenu2",t)}function deskSendKeys(){if(Q("DeskWD").blur(),!xxdialogMode&&null!=desktop&&3==desktop.State){var e=parseInt(Q("deskkeys").value);if(655406==e)desktop.m.sendcad();else{var t=(16711680&e)>>16,e=65535&e,n=[],o=[],i={8:65288,9:65289,13:65293,27:65307,45:65379,46:65535,36:65360,35:65367,33:65365,34:65366,37:65361,38:65362,39:65363,40:65364,112:65470,113:65471,114:65472,115:65473,116:65474,117:65475,118:65476,119:65477,120:65478,121:65479,122:65480,123:65481};if(2==desktop.contype){1&t&&(n.push([65505,1]),o.push([65505,0])),2&t&&(n.push([65513,1]),o.push([65513,0])),8&t&&(n.push([65507,1]),o.push([65507,0])),16&t&&(n.push([65511,1]),o.push([65511,0])),65<=(e=i[e]?i[e]:e)&&e<=90&&(e+=32),0!=e&&(n.push([e,1]),o.push([e,0])),o.reverse();for(var a=0;a<o.length;a++)n.push(o[a]);desktop.m.sendkey(n)}else{1&t&&(n.push([desktop.m.KeyAction.DOWN,16]),o.push([desktop.m.KeyAction.UP,16])),2&t&&(n.push([desktop.m.KeyAction.EXDOWN,18]),o.push([desktop.m.KeyAction.EXUP,18])),8&t&&(n.push([desktop.m.KeyAction.EXDOWN,17]),o.push([desktop.m.KeyAction.EXUP,17])),16&t&&(n.push([desktop.m.KeyAction.EXDOWN,91]),o.push([desktop.m.KeyAction.EXUP,91])),0!=e&&(n.push([desktop.m.KeyAction.DOWN,e]),o.push([desktop.m.KeyAction.UP,e])),o.reverse();for(a=0;a<o.length;a++)n.push(o[a]);desktop.m.SendKeyMsgKC(n)}}}}function showDeskType(e){var t;xxdialogMode||null==desktop||3!=desktop.State||(Q("DeskType").blur(),t="<div>Zadejte text a kliknutím na OK jej zadejte na dálku. Než budete pokračovat, nezapomeňte umístit kurzor do správné polohy.<div>",setDialogMode(2,"Zadávání z klávesnice na dálku",3,showDeskTypeEx,t+='<textarea id=d2typeText style="margin-top:5px;width:100%;height:184px;resize:none" maxlength=2000>'+(e?EscapeHtml(e):"")+"</textarea>"),Q("d2typeText").focus())}var AmtDeskTypeTimer=null,AmtDeskTypeContent=null,DeskTypeTranslate={39:222,42:106,43:107,44:188,45:189,46:190,47:191,59:186,61:187,91:219,92:220,93:221,96:192,191:111},DeskTypeShiftTranslate={33:49,34:222,35:51,36:52,37:53,38:55,40:57,41:48,58:186,60:188,62:190,63:191,64:50,94:54,95:189,106:56,107:187,123:219,124:220,125:221,126:192};function showDeskTypeEx(e){var t,n=[],o=!1,i=("string"==typeof e?t=e:(t=Q("d2typeText").value,Q("d2typeText").value)).toUpperCase();if(2==desktop.contype){for(var a in t){var s=t.charCodeAt(a);n.push([s,1],[s,0])}AmtDeskTypeContent=n,AmtDeskTypeTimer=setInterval(function(){var e=AmtDeskTypeContent.shift();desktop&&desktop.m.sendkey(e[0],e[1]),null!=desktop&&0!=AmtDeskTypeContent.length||(clearInterval(AmtDeskTypeTimer),AmtDeskTypeContent=null)},10)}else if(4==desktop.contype)desktop.m.SendStringUnicode(t);else if(!0!==desktopsettings.remotekeymap)desktop.m.SendStringUnicode(t);else{for(var a in t){var s=t.charCodeAt(a),r=i.charCodeAt(a);65<=s&&s<=90||97<=s&&s<=122?(s==r&&0==o&&(n.push([desktop.m.KeyAction.DOWN,16]),o=!0),s!=r&&1==o&&(n.push([desktop.m.KeyAction.UP,16]),o=!1)):48<=s&&s<=57?1==o&&(n.push([desktop.m.KeyAction.UP,16]),o=!1):DeskTypeTranslate[s]?(1==o&&(n.push([desktop.m.KeyAction.UP,16]),o=!1),r=DeskTypeTranslate[s]):DeskTypeShiftTranslate[s]&&(0==o&&(n.push([desktop.m.KeyAction.DOWN,16]),o=!0),r=DeskTypeShiftTranslate[s]),n.push([desktop.m.KeyAction.DOWN,r],[desktop.m.KeyAction.UP,r])}1==o&&(n.push([desktop.m.KeyAction.UP,16]),o=!1),desktop.m.SendKeyMsgKC(n)}}function showDeskClip(){var e;xxdialogMode||null==desktop||3!=desktop.State||(Q("DeskClip").blur(),e="",0==(2048&features2)&&(e+='<input id=dlgClipGet type=button value="Získejte schránku" style=width:160px onclick=showDeskClipGet()>'),0==(4096&features2)&&(e+='<input id=dlgClipSet type=button value="Nastavit schránku" style=width:160px onclick=showDeskClipSet()>'),setDialogMode(2,"Vzdálená schránka",8,null,e=(e+='<div id=dlgClipStatus style="display:inline-block;margin-left:8px" ></div>')+'<textarea id=d2clipText style="width:100%;height:184px;resize:none" maxlength=65535></textarea>'+'<input type=button value="Close" style=width:80px;float:right onclick=dialogclose(0)><div style=height:26px;margin-top:3px><span id=linuxClipWarn style=display:none>Obsah vzdálené schránky je uchováván po dobu dobu 60 sekund.</span>&nbsp;</div><div></div>',"clipboard"),Q("d2clipText").focus())}function showDeskClipGet(){null!=desktop&&3==desktop.State&&meshserver.send({action:"msg",type:"getclip",nodeid:currentNode._id,tag:1})}function showDeskClipSet(){null!=desktop&&3==desktop.State&&(desktop.m.setClipboard?desktop.m.setClipboard(Q("d2clipText").value):(meshserver.send({action:"msg",type:"setclip",nodeid:currentNode._id,data:Q("d2clipText").value}),QV("linuxClipWarn",currentNode&&currentNode.agent&&4<currentNode.agent.id&&21!=currentNode.agent.id&&22!=currentNode.agent.id&&34!=currentNode.agent.id)))}function sendCAD(){xxdialogMode||null==desktop||3!=desktop.State||desktop.m.sendcad()}function toggleDeskTools(){Q("DeskToolsButton").blur(),xxdialogMode||("none"==QS("DeskTools").display?(QV("DeskTools",!0),Q("DeskTools").nodeid=currentNode._id,QH("DeskToolsProcesses",""),QH("DeskToolsServices",""),QV("deskToolsTopTabService",!1),changeDeskToolTab(0),refreshDeskTools(0),refreshDeskTools(1)):QV("DeskTools",!1))}var deskToolTabSelection=0;function changeDeskToolTab(e){deskToolTabSelection=e,QV("DeskToolsProcessTab",0==e),QV("DeskToolsServiceTab",1==e),QS("deskToolsTopTabProcess").bottom=0==e?"0px":"3px",QS("deskToolsTopTabService").bottom=1==e?"0px":"3px",QS("deskToolsTopTabProcess").color=0==e?"black":"gray",QS("deskToolsTopTabService").color=1==e?"black":"gray"}function refreshDeskTools(e){e=null==e?deskToolTabSelection:e;QV("DeskToolsRefreshButton",!1),setTimeout(refreshDeskToolsEx,500),0==e&&meshserver.send({action:"msg",type:"ps",nodeid:currentNode._id}),1==e&&meshserver.send({action:"msg",type:"services",nodeid:currentNode._id})}function refreshDeskToolsEx(){QV("DeskToolsRefreshButton",!0)}var deskTools={sort:1,ssort:1,msg:null,smsg:null,resizing:!1};function sortProcess(e){deskTools.sort=e,showDeskToolsProcesses(deskTools.msg)}function sortService(e){deskTools.ssort=e,showDeskToolsServices(deskTools.smsg)}function sortProcessPid(e,t){return e.p>t.p?1:e.p<t.p?-1:sortProcessName(e,t)}function sortProcessName(e,t){return e.d>t.d?1:e.d<t.d?-1:0}function showDeskToolsProcesses(e){if(null==(deskTools.msg=e))QH("DeskToolsProcesses","");else if(Q("DeskTools").nodeid==e.nodeid){var t=[],n=null;try{n=JSON.parse(e.value)}catch(e){}if(null!=n){for(var o in n)t.push({p:parseInt(o),c:n[o].cmd,d:n[o].cmd.toLowerCase(),u:n[o].user});0==deskTools.sort?t.sort(sortProcessPid):1==deskTools.sort&&t.sort(sortProcessName);var i,a,s="";for(i in t)0!=t[i].p&&(a=t[i].c,s=(s=(s=(s=(s+="<div onclick=showProcessDetails("+t[i].p+") class=deskToolsBar>")+"<div style=width:50px;float:left;text-align:right;padding-right:5px>"+EscapeHtml(t[i].p)+"</div>")+'<a href=# style=float:right;padding-right:5px;cursor:pointer title="Zastavit proces" onclick=\'return stopProcess('+EscapeHtml(t[i].p)+',"'+EscapeHtml(t[i].c)+'")\'><img width=10 height=10 src="images/trash.png"></a>')+"<div style=float:right;padding-right:5px>"+(t[i].u?EscapeHtml(t[i].u):"")+"</div>")+'<div style="white-space:nowrap;overflow:hidden;text-overflow:ellipsis;padding-right:5px" title="'+EscapeHtml(a)+'">'+a+"</div></div>");QH("DeskToolsProcesses",s)}}}function showProcessDetails(e){xxdialogMode||(setDialogMode(2,format("Podrobnosti procesu, č. {0}",e),1,null,"Requesting Process Details...","ps|"+currentNode._id+"|"+e),meshserver.send({action:"msg",type:"psinfo",nodeid:currentNode._id,pid:e}))}function showDeskToolsServices(e){if(null==(deskTools.smsg=e))QH("DeskToolsProcesses","");else if(Q("DeskTools").nodeid==e.nodeid){QV("deskToolsTopTabService",!0);var t=[],n=null;try{n=JSON.parse(e.value)}catch(e){}if(null!=(deskTools.services=n)){for(var o in n)n[o].status?t.push({p:capitalizeFirstLetter(n[o].status.state.toLowerCase()),d:n[o].displayName,i:o}):n[o].serviceType&&t.push({p:n[o].serviceType,d:n[o].name,i:o});0==deskTools.ssort?t.sort(sortProcessPid):1==deskTools.ssort&&t.sort(sortProcessName);var i,a,s="";for(o in t)0!=t[o].p&&(i=t[o].d,"Stopped"==(a=t[o].p)?a="Zastaveno":"Running"==a&&(a="Spuštěno"),s=(s=(s+="<div onclick=showServiceWaitDialog("+t[o].i+") class=deskToolsBar>")+"<div style=width:70px;float:left;padding-right:5px>"+EscapeHtml(a)+"</div>")+'<div style="white-space:nowrap;overflow:hidden;text-overflow:ellipsis" title="'+i+'">'+EscapeHtml(i)+"</div></div>");QH("DeskToolsServices",s)}}}function showServiceDetailsDialog(e){var t,n,o;xxdialogMode&&-1!=xxdialogTag.indexOf("service_")&&(t=xxdialogTag.replace("service_",""),n=e.value?JSON.parse(e.value):deskTools.services[t],e.value&&(n.displayName=deskTools.services[t].displayName),null!=n)&&(e="",n.name&&(e+=addHtmlValue("Název",n.name)),n.displayName&&(e+=addHtmlValue("Zobrazované jméno",n.displayName)),n.status&&("Stopped"==(o=capitalizeFirstLetter(n.status.state.toLowerCase()))?o="Zastaveno":"Running"==o&&(o="Spuštěno"),n.status.state&&(e+=addHtmlValue("Stav",o)),n.status.pid&&(e+=addHtmlValue("PID",n.status.pid)),o=[],!0===n.status.isFileSystemDriver&&o.push("Ovladač souborového systému"),!0===n.status.isInteractive&&o.push("Interaktivní"),!0===n.status.isKernelDriver&&o.push("Ovladač jádra"),!0===n.status.isOwnProcess&&o.push("OwnProcess"),!0===n.status.isSharedProcess&&o.push("SharedProcess"),0<o.length)&&(e+=addHtmlValue("Typ",o.join(", "))),n.startType&&(e+=addHtmlValue("Start Type",n.startType)),n.user&&(e+=addHtmlValue("Uživatel",n.user)),n.installedBy&&(e+=addHtmlValue("Installed By",n.installedBy)),n.installedDate&&(e+=addHtmlValue("Installed Date",printDateTime(new Date(n.installedDate)))),n.failureActions&&(n.failureActions.resetPeriod&&(e+=addHtmlValue("Restart Fail Count After ",(o=(n.failureActions.resetPeriod<86400?0:n.failureActions.resetPeriod)/86400)+" Day"+(1!=o?"s":""))),n.failureActions.actions)&&(n.failureActions.actions[0]&&(e+=addHtmlValue("First Failure",n.failureActions.actions[0].type)),n.failureActions.actions[1]&&(e+=addHtmlValue("Second Failure",n.failureActions.actions[1].type)),n.failureActions.actions[2])&&(e+=addHtmlValue("Subsequent Failures",n.failureActions.actions[2].type)),setDialogMode(2,"Podrobnosti o serveru",8,null,e+='<br/><div style=float:right;margin-bottom:12px><input type=button value="Zavřít" onclick=showServiceDetailsDialogEx(0,'+t+')></div><div style=margin-bottom:12px><input type=button value="Start" onclick=showServiceDetailsDialogEx(1,'+t+')><input type=button value="Zastavit" onclick=showServiceDetailsDialogEx(2,'+t+')><input type=button value="Restart" onclick=showServiceDetailsDialogEx(3,'+t+")></div>","service_"+t))}function showServiceWaitDialog(e){var t;return xxdialogMode||null!=(t=deskTools.services[e])&&(meshserver.send({action:"msg",type:"service",nodeid:currentNode._id,serviceName:t.name}),setDialogMode(2,"Podrobnosti o serveru",1,null,"Requesting Service Details...","service_"+e)),!1}function showServiceDetailsDialogEx(e,t){setDialogMode(0),0!=e&&null!=(t=deskTools.services[t])&&(1==e&&meshserver.send({action:"msg",type:"serviceStart",nodeid:currentNode._id,serviceName:t.name}),2==e&&meshserver.send({action:"msg",type:"serviceStop",nodeid:currentNode._id,serviceName:t.name}),3==e&&meshserver.send({action:"msg",type:"serviceRestart",nodeid:currentNode._id,serviceName:t.name}),setTimeout(function(){refreshDeskTools(1)},1e3))}function toggleKvmControl(){Q("DeskControl").blur(),putstore("DeskControl",Q("DeskControl").checked?1:0),QS("DeskControlSpan").color=Q("DeskControl").checked?null:"red"}function deskRecordSession(){var e;null!=desktop&&(null==desktop.m.recordedData?(Q("DeskRecordButtonImage").src="images/icon-film-red.png",desktop.m.StartRecording()):(Q("DeskRecordButtonImage").src="images/icon-film.png",e=new Date,e="DesktopSession-"+currentNode.name+"-"+e.getFullYear()+"-"+("0"+(e.getMonth()+1)).slice(-2)+"-"+("0"+e.getDate()).slice(-2)+"-"+("0"+e.getHours()).slice(-2)+"-"+("0"+e.getMinutes()).slice(-2),saveAs(data2blob(desktop.m.StopRecording().join("")),e+".mcrec")))}function deskSaveImage(){var e,t;xxdialogMode||null==desktop||3!=desktop.State||(e=new Date,t="Plocha-"+currentNode.name+"-"+e.getFullYear()+"-"+("0"+(e.getMonth()+1)).slice(-2)+"-"+("0"+e.getDate()).slice(-2)+"-"+("0"+e.getHours()).slice(-2)+"-"+("0"+e.getMinutes()).slice(-2),Q("Desk").toBlob(function(e){saveAs(e,t+".png")}))}function deskDisplayInfo(e,t,n){var o,i=0,a="";for(o in t){i++;var s=t[o],r=1;"All Displays"==s&&(s="Všechny displeje",r=2),s.startsWith("Display ")&&(s=format("Zobrazit {0}",s.substring(8))),a+="<img id=DeskMonitorSelectionX"+o+' class="'+(n==o?"":" gray")+"\" src='images/icon-monitor"+r+".png' title=\""+EscapeHtml(s)+'" onclick=deskSetDisplay('+o+") height=16 width=16 style=padding-top:2px;margin-left:2px />",deskPreferedStickyDisplay==o&&n!=deskPreferedStickyDisplay&&desktop.m.SetDisplay(o),deskPreferedStickyDisplay=-1}QH("DeskMonitorSelectionSpan",a),QV("DeskMonitorSelectionSpan",1<i)}function deskGetDisplayNumbers(e){desktop.m.GetDisplayNumbers()}Q("DeskTools").addEventListener("mousemove",function(e){e=e.clientX-Q("DeskTools").getBoundingClientRect().left;Q("DeskTools").style.cursor=e<5?"col-resize":"default"}),Q("DeskTools").addEventListener("mousedown",function(e){"col-resize"===Q("DeskTools").style.cursor&&(deskTools.resizing=!0,Q("Desk").removeAttribute("onmouseup"),Q("Desk").removeAttribute("onmousedown"),Q("Desk").removeAttribute("onmousemove"))}),document.addEventListener("mouseup",function(){!0===deskTools.resizing&&"col-resize"===Q("DeskTools").style.cursor&&(deskTools.resizing=!1,Q("Desk").setAttribute("onmouseup","dmouseup(event)"),Q("Desk").setAttribute("onmousedown","dmousedown(event)"),Q("Desk").setAttribute("onmousemove","dmousemove(event)"))}),document.addEventListener("mousemove",function(e){deskTools.resizing&&(e=Q("DeskTools").getBoundingClientRect().right-e.clientX)<Q("DeskParent").clientWidth-10&&(Q("DeskTools").style.width=e+"px")});var deskPreferedStickyDisplay=-1;function deskSetDisplay(e){desktop.m.SetDisplay(deskPreferedStickyDisplay=parseInt(e))}var terminalNode,dblClickDetectArgs={t:0,x:0,y:0};function dblClickDetect(e){var t;1==e.buttons&&((t=Date.now())-dblClickDetectArgs.t<250&&Math.abs(e.clientX-dblClickDetectArgs.x)<2&&Math.abs(e.clientY-dblClickDetectArgs.y)<2&&!xxdialogMode&&null!=desktop&&Q("DeskControl").checked&&(null!=webRtcDesktop&&null!=webRtcDesktop.softdesktop?(webRtcDesktop.softdesktop.m.mousedblclick(e),desktop.m.sendKeepAlive()):desktop.m.mousedblclick(e)),dblClickDetectArgs.t=t,dblClickDetectArgs.x=e.clientX,dblClickDetectArgs.y=e.clientY)}function dmousedown(e){setSessionActivity(),e.addx=Q("DeskParent").scrollLeft,e.addy=Q("DeskParent").scrollTop,!xxdialogMode&&null!=desktop&&Q("DeskControl").checked&&(null!=webRtcDesktop&&null!=webRtcDesktop.softdesktop?(webRtcDesktop.softdesktop.m.mousedown(e),desktop.m.sendKeepAlive()):desktop.m.mousedown(e)),dblClickDetect(e)}function dmouseup(e){setSessionActivity(),e.addx=Q("DeskParent").scrollLeft,e.addy=Q("DeskParent").scrollTop,!xxdialogMode&&null!=desktop&&Q("DeskControl").checked&&(null!=webRtcDesktop&&null!=webRtcDesktop.softdesktop?(webRtcDesktop.softdesktop.m.mouseup(e),desktop.m.sendKeepAlive()):desktop.m.mouseup(e))}function dmousemove(e){setSessionActivity(),e.addx=Q("DeskParent").scrollLeft,e.addy=Q("DeskParent").scrollTop,!xxdialogMode&&null!=desktop&&Q("DeskControl").checked?(Q("Desk").style.cursor="",null!=webRtcDesktop&&null!=webRtcDesktop.softdesktop?(webRtcDesktop.softdesktop.m.mousemove(e),desktop.m.sendKeepAlive()):desktop.m.mousemove(e)):xxdialogMode||null==desktop||Q("DeskControl").checked||(Q("Desk").style.cursor="not-allowed")}function dmousewheel(e){return setSessionActivity(),e.addx=Q("DeskParent").scrollLeft,e.addy=Q("DeskParent").scrollTop,!(xxdialogMode||null==desktop||!Q("DeskControl").checked||(null!=webRtcDesktop&&null!=webRtcDesktop.softdesktop?(webRtcDesktop.softdesktop.m.mousewheel(e),desktop.m.sendKeepAlive()):desktop.m.mousewheel&&desktop.m.mousewheel(e),haltEvent(e),0))}function drotate(e){xxdialogMode||null==desktop||(desktop.m.setRotation(desktop.m.rotation+e),deskAdjust(),deskAdjust())}function stopProcess(e,t){return setDialogMode(2,"Správa procesů",3,stopProcessEx,format('Zastavit proces #{0} "{1}"?',e,t),e),!1}function stopProcessEx(e,t){meshserver.send({action:"msg",type:"pskill",nodeid:currentNode._id,value:t}),setTimeout(refreshDeskTools,300)}function setupTerminal(){terminalNode!=currentNode&&null!=terminal&&terminalNode._id!=currentNode._id&&(terminal.Stop(),terminal=terminalNode=null),terminalNode=currentNode,updateTerminalButtons()}function updateTerminalButtons(){var e=null!=terminal&&0!=terminal.state,t=(3==terminalNode.mtype&&null!=terminalNode.agent&&4<terminalNode.agent.id&&512&features2&&(terminalNode.agent.caps=6),QV("disconnectbutton2span",1==e),QV("connectbutton2span",0==e&&null!=terminalNode.agent&&2&terminalNode.agent.caps&&3!=terminalNode.mtype),QV("connectbutton2sspan",512&features2&&0==e&&null!=terminalNode.agent&&2&terminalNode.agent.caps&&3!=terminalNode.agent.id&&0==(16777216&features2)),1==terminalNode.mtype?(QV("connectbutton2hspan",0==e&&null!=terminalNode.intelamt&&2==terminalNode.intelamt.state),QV("terminalSizeDropDown",0==e&&null!=terminalNode.intelamt&&2==terminalNode.intelamt.state)):(QV("connectbutton2hspan",0==e&&null!=terminalNode.intelamt&&2==terminalNode.intelamt.state&&null!=terminalNode.intelamt.ver),QV("terminalSizeDropDown",0==e&&null!=terminalNode.intelamt&&2==terminalNode.intelamt.state&&null!=terminalNode.intelamt.ver)),QV("termActionsBtn",3!=terminalNode.mtype),1==e&&3!=terminal.contype||null==terminalNode.agent||3==terminalNode.agent.id||4==terminalNode.agent.id?QH("terminalCustomUpperRight",""):QH("terminalCustomUpperRight","<a style=cursor:pointer onclick=cmsshportaction(1,event)>"+format("Port SSH {0}",terminalNode.sshport||22)+"</a>"),0!=(1&terminalNode.conn)||3==terminalNode.mtype),t=(QE("connectbutton2",t),QE("connectbutton2s",t),0!=(6&terminalNode.conn)),t=(QE("connectbutton2h",t),QE("ctrlcbutton",e),QE("ctrlxbutton",e),QE("escbutton",e),QE("bsbutton",e),QE("pastebutton",e),QE("specialkeylist",e),QE("specialkeylistinput",e),QV("terminalSettingsButtons",terminal&&2==terminal.contype),terminal&&(Q("id_ttypebutton").value=terminalEmulations[terminal.m.terminalEmulation],Q("id_tfxkeysbutton").value=fxEmulations[terminal.m.fxEmulation],Q("id_tcrbutton").value="\r\n"==terminal.m.lineFeed?"CR+LF":"LF"),!(0===args.xterm||null!=terminal&&null==xterm));QV("termarea3xdiv",t),QV("Term",!t),QV("bsbutton",!t),QV("pastebutton",!t),QV("devListToolbarViewIcons2",t),QE("termSizeList",null==terminal)}function onTerminalStateChange(e,t){if(terminal==e){var n=t,o=(3==n&&2==e.contype&&n++,StatusStrs[n]);switch(3==n&&(3==e.contype&&(o+=", SSH"),1==e.webRtcActive)&&(o+=", WebRTC"),QH("termstatus",o),t){case 0:if(QH("termtitle",""),QV("termRecordIcon",!1),null==xterm)try{e.m.TermResetScreen(),e.m.TermDraw()}catch(e){}else xterm.dispose(),xterm=xtermfit=null;null!=e&&(e.Stop(),terminal=null);break;case 3:e&&1==e.serverIsRecording&&QV("termRecordIcon",!0),e.startTime=new Date,null==updateSessionTimer&&(updateSessionTimer=setInterval(updateSessionTime,1e3)),null!=xterm&&xterm.focus()}updateTerminalButtons()}}var autoConnectTerminalTimer=null;function autoConnectTerminal(e){autoConnectTerminalTimer=null==autoConnectTerminalTimer?setInterval(connectTerminal,100):(clearInterval(autoConnectTerminalTimer),null)}function CreateRemoteTunnel(e,t){var n={protocol:1};return null!=t&&"number"==typeof t.protocol&&(n.protocol=t.protocol),n.onTunnelUpdate=e,n.xxStateChange=function(e){},n.ProcessBinaryData=function(e){n.onTunnelUpdate(e)},n.ProcessData=function(e){n.onTunnelUpdate(e)},n.terminalEmulation=1,n.fxEmulation=0,n.lineFeed="\r\n",n}function tunnelUpdate(e){null!=xterm&&(xterm.writeUtf8?"string"==typeof e?xterm.writeUtf8(e):xterm.writeUtf8(new Uint8Array(e)):"string"==typeof e?xterm.write(e):xterm.write(new Uint8Array(e)))}function sshTunnelAuthDialog(e,t){var n="";e.askkeypass?n+=addHtmlValue("Ověření","<select id=dp2authmethod style=width:230px onchange=sshAuthUpdate(event)><option value=3 selected>Uložený klíč</option><option value=1>Uživatelské jméno heslo</option><option value=2>Uživatelské jméno a klíč</option></select>"):n+=addHtmlValue("Ověření","<select id=dp2authmethod style=width:230px onchange=sshAuthUpdate(event)><option value=1 selected>Uživatelské jméno heslo</option><option value=2>Uživatelské jméno a klíč</option></select>"),n=(n=(n+="<div id=d2userauth style=display:none>")+addHtmlValue("Uživatelské jméno","<input id=dp2user style=width:230px maxlength=64 autocomplete=off onkeyup=sshAuthUpdate(event) />")+"</div><div id=d2passauth style=display:none>")+addHtmlValue("Heslo","<input type=password id=dp2pass style=width:230px maxlength=64 autocomplete=off onkeyup=sshAuthUpdate(event) />"),0==(4194304&features2)&&(n+=addHtmlValue("","<label><input id=dp2keep type=checkbox>Pamatujte si přihlašovací údaje</label>")),n=(n=(n+="</div><div id=d2keyauth style=display:none>")+addHtmlValue("Soubor klíče","<input type=file id=dp2key style=width:230px maxlength=64 autocomplete=off onchange=sshAuthUpdate(event) /><div id=d2badkey style=font-size:x-small>Soubor klíče musí být ve formátu OpenSSH.</div>"))+addHtmlValue("Klíčové heslo","<input type=password id=dp2keypass style=width:230px maxlength=64 autocomplete=off onkeyup=sshAuthUpdate(event) />"),0==(4194304&features2)&&(n=(n+=addHtmlValue("","<label><input id=dp2keep1 type=checkbox onchange=sshAuthUpdate(event)>Zapamatujte si uživatele a klíč</label>"))+addHtmlValue("","<label><input id=dp2keep2 type=checkbox>Pamatuj si heslo</label>")),n+="</div>",setDialogMode(2,"Ověření",11,t,n=e.askkeypass?(n+="<div id=d2keyauth2 style=display:none>")+addHtmlValue("Heslo","<input type=password id=dp2keypass2 style=width:230px maxlength=64 autocomplete=off onkeyup=sshAuthUpdate(event) />")+"</div>":n,"ssh"),Q("dp2user").focus(),sshAuthUpdate(),setTimeout(sshAuthUpdate,50)}function sshTunnelUpdate(e){if("string"==typeof e)if("{"==e[0]){var t=JSON.parse(e);switch(t.action){case"sshauth":sshTunnelAuthDialog(t,sshConnectEx);break;case"sshautoauth":terminal.socket.send(JSON.stringify({action:"sshautoauth",cols:xterm.cols,rows:xterm.rows,width:Q("termarea3xdiv").offsetWidth,height:Q("termarea3xdiv").offsetHeight}));break;case"connectionerror":p12setConsoleMsg("Chyba připojení",5e3);break;case"autherror":p12setConsoleMsg("Chyba ověření",5e3);break;case"sessionerror":p12setConsoleMsg("Relace vypršela",5e3);break;case"sessiontimeout":p12setConsoleMsg("Časový limit relace",5e3)}}else"~"==e[0]&&(xterm.writeUtf8?xterm.writeUtf8(e.substring(1)):xterm.write(e.substring(1)))}function sshAuthUpdate(e){var t;QV("d2userauth",3!=Q("dp2authmethod").value),QV("d2passauth",1==Q("dp2authmethod").value),QV("d2keyauth",2==Q("dp2authmethod").value),QV("d2keyauth2",3==Q("dp2authmethod").value),1==Q("dp2authmethod").value?QE("idx_dlgOkButton",0<Q("dp2user").value.length&&0<Q("dp2pass").value.length):3==Q("dp2authmethod").value?QE("idx_dlgOkButton",0<Q("dp2keypass2").value.length):(QE("idx_dlgOkButton",!1),0==(4194304&features2)&&QE("dp2keep2",Q("dp2keep1").checked),1==(0<Q("dp2user").value.length&&null!=Q("dp2key").files&&1==Q("dp2key").files.length&&Q("dp2key").files[0].size<8e3)&&((t=new FileReader).onload=function(e){e=0<=e.target.result.indexOf("-----BEGIN OPENSSH PRIVATE KEY-----")&&0<=e.target.result.indexOf("-----END OPENSSH PRIVATE KEY-----")||0<=e.target.result.indexOf("-----BEGIN RSA PRIVATE KEY-----")&&0<=e.target.result.indexOf("-----END RSA PRIVATE KEY-----");QE("idx_dlgOkButton",e),QS("d2badkey").color=e?"#000":"#F00"},t.readAsText(Q("dp2key").files[0]))),e&&13==e.keyCode&&e.target&&1==Q("dp2authmethod").value&&("dp2user"==e.target.id&&Q("dp2pass").focus(),"dp2pass"==e.target.id)&&dialogclose(1)}function sshConnectEx(e){var t,n,o;0==e?null!=terminal&&connectTerminal():(t=0,1==Q("dp2authmethod").value?(0==(4194304&features2)&&(t=Q("dp2keep").checked?1:0),terminal.socket.send(JSON.stringify({action:"sshauth",username:Q("dp2user").value,password:Q("dp2pass").value,keep:t,cols:xterm.cols,rows:xterm.rows,width:Q("termarea3xdiv").offsetWidth,height:Q("termarea3xdiv").offsetHeight}))):3==Q("dp2authmethod").value?terminal.socket.send(JSON.stringify({action:"sshkeyauth",keypass:Q("dp2keypass2").value,cols:xterm.cols,rows:xterm.rows,width:Q("termarea3xdiv").offsetWidth,height:Q("termarea3xdiv").offsetHeight})):(0==(4194304&features2)&&1==(t=Q("dp2keep1").checked?1:0)&&(t+=Q("dp2keep2").checked?1:0),e=new FileReader,n=Q("dp2user").value,o=Q("dp2keypass").value,e.onload=function(e){terminal.socket.send(JSON.stringify({action:"sshauth",username:n,keypass:o,key:e.target.result,keep:t,cols:xterm.cols,rows:xterm.rows,width:Q("termarea3xdiv").offsetWidth,height:Q("termarea3xdiv").offsetHeight}))},e.readAsText(Q("dp2key").files[0])))}function xTermSendResize(){(xtermResizeTimer=null)!=xterm&&null!=terminal&&null!=terminal.sendCtrlMsg&&("sshterminalrelay.ashx"==terminal.urlname?terminal.socket.send(JSON.stringify({action:"resize",cols:xterm.cols,rows:xterm.rows,width:Q("termarea3xdiv").offsetWidth,height:Q("termarea3xdiv").offsetHeight})):terminal.sendCtrlMsg(JSON.stringify({ctrlChannel:"102938",type:"termsize",cols:xterm.cols,rows:xterm.rows})))}function connectTerminal(e,t,n){if(p12clearConsoleMsg(),terminal)"ssh"==xxdialogTag&&setDialogMode(0),terminal.Stop(),terminal=null,fullscreen&&deskToggleFull();else if(2==t){if(null==terminalNode.intelamt.user||""==terminalNode.intelamt.user)return void editDeviceAmtSettings(terminalNode._id,connectTerminal,2);var o={};1==Q("termSizeList").value?(o.cols=80,o.rows=25):2==Q("termSizeList").value&&(o.cols=100,o.rows=30),fullscreen&&deskToggleFull(),QV("termarea3xdiv",!1),QV("Term",!0),(terminal=CreateAmtRedirect(CreateAmtRemoteTerminal("Term",o),authCookie)).debugmode=debugmode,terminal.m.debugmode=debugmode,terminal.m.onTitleChange=function(e,t){QH("termtitle"," - "+EscapeHtml(t))},terminal.onStateChanged=onTerminalStateChange,terminal.Start(terminalNode._id,16994,"*","*",0),terminal.contype=2,Q("id_ttypebutton").value=terminalEmulations[terminal.m.terminalEmulation]}else{o={protocol:null!=n&&"number"==typeof n.protocol?n.protocol:1};n&&n.requireLogin&&(o.requireLogin=!0),n&&n.consent&&(o.consent=n.consent),-1==[1,2,3,4,21,22].indexOf(currentNode.agent.id)&&(1==Q("termSizeList").value?(o.cols=80,o.rows=25,o.xterm=!0):2==Q("termSizeList").value?(o.cols=100,o.rows=30,o.xterm=!0):3==Q("termSizeList").value&&(o.cols=Math.floor((Q("column_l").clientWidth-60)/10),o.rows=Math.floor((Q("column_l").clientHeight-120)/20),o.xterm=!0)),e&&1==e.shiftKey&&(4<currentNode.agent.id?1==o.protocol&&(o.protocol=7):1==o.protocol&&(o.protocol=6)),null!=serverinfo.linuxshell&&4<currentNode.agent.id&&("root"==serverinfo.linuxshell&&(o.protocol=1,delete o.requireLogin),"user"==serverinfo.linuxshell&&(o.protocol=8,delete o.requireLogin),"login"==serverinfo.linuxshell)&&(o.protocol=1,o.requireLogin=!0),0!==args.xterm?(QV("termarea3xdiv",!0),QV("Term",!1),null!=xterm&&xterm.dispose(),xtermfit=new FitAddon.FitAddon,xterm=new Terminal,xtermfit&&xterm.loadAddon(xtermfit),xterm.open(Q("termarea3xdiv")),xterm.onData(function(e){null!=terminal&&("sshterminalrelay.ashx"==terminal.urlname?terminal.socket.send("~"+e):terminal.sendText(e))}),xtermfit&&xtermfit.fit(),xterm.onTitleChange(function(e){QH("termtitle"," - "+EscapeHtml(e))}),xterm.onResize(function(e){xtermResizeTimer&&clearTimeout(xtermResizeTimer),xtermResizeTimer=setTimeout(xTermSendResize,200)}),o.cols=xterm.cols,o.rows=xterm.rows,terminal=CreateAgentRedirect(meshserver,CreateRemoteTunnel(3==t?sshTunnelUpdate:tunnelUpdate,o),serverPublicNamePort,authCookie,authRelayCookie,domainUrl),3==t&&(terminal.urlname="sshterminalrelay.ashx"),terminal.debugmode=debugmode,terminal.m.debugmode=debugmode,(terminal.options=o).requireLogin&&(terminal.options.requireLogin=!0),terminal.Start(terminalNode._id),terminal.onStateChanged=onTerminalStateChange,terminal.contype=t,terminal.attemptWebRTC=!1,terminal.onConsoleMessageChange=function(){p12setConsoleMsg(terminal.consoleMessage?formatAgentConsoleMessage(terminal.consoleMessage,terminal.consoleMessageId,terminal.consoleMessageArgs):null,terminal.consoleMessageTimeout)}):(QV("termarea3xdiv",!1),QV("Term",!0),(terminal=CreateAgentRedirect(meshserver,CreateAmtRemoteTerminal("Term",o),serverPublicNamePort,authCookie,authRelayCookie,domainUrl)).options=o,terminal.debugmode=debugmode,terminal.m.debugmode=debugmode,terminal.m.onTitleChange=function(e,t){QH("termtitle"," - "+EscapeHtml(t))},terminal.m.lineFeed=0<=[1,2,3,4,21,22].indexOf(currentNode.agent.id)?"\r\n":"\r",terminal.attemptWebRTC=!1,terminal.onStateChanged=onTerminalStateChange,terminal.onConsoleMessageChange=function(){p12setConsoleMsg(terminal.consoleMessage?formatAgentConsoleMessage(terminal.consoleMessage,terminal.consoleMessageId,terminal.consoleMessageArgs):null,terminal.consoleMessageTimeout)},terminal.Start(terminalNode._id),terminal.contype=t,terminal.m.terminalEmulation=0,terminal.m.fxEmulation=0,Q("id_ttypebutton").value=terminalEmulations[0])}Q("connectbutton2").blur()}var terminalEmulations=["UTF8 terminál","Rozšířené ASCII","Intel ASCII"];function termToggleType(){terminal&&!xxdialogMode&&(terminal.m.terminalEmulation=(terminal.m.terminalEmulation+1)%3,Q("id_ttypebutton").value=terminalEmulations[terminal.m.terminalEmulation],Q("id_ttypebutton").blur())}var filesNode,fxEmulations=["Intel (F10 = ESC+[OM)","Alternativní (F10 = ESC+0)","VT100+ (F10 = ESC+[OY)"];function termToggleFx(){terminal&&!xxdialogMode&&(terminal.m.fxEmulation=(terminal.m.fxEmulation+1)%3,Q("id_tfxkeysbutton").value=fxEmulations[terminal.m.fxEmulation],Q("id_tfxkeysbutton").blur())}function termToggleCr(){terminal&&!xxdialogMode&&("\n"==terminal.m.lineFeed?terminal.m.lineFeed="\r\n":terminal.m.lineFeed="\n",Q("id_tcrbutton").value="\r\n"==terminal.m.lineFeed?"CR+LF":"LF")}function termSendKey(e,t){terminal&&!xxdialogMode&&(null!=xterm?("sshterminalrelay.ashx"==terminal.urlname?terminal.socket.send("~"+String.fromCharCode(e)):terminal.sendText?terminal.sendText(String.fromCharCode(e)):terminal.send(String.fromCharCode(e)),xterm.focus()):null!=terminal&&(terminal.m.TermSendKey(e),Q(t).blur()))}function showTermPasteDialog(){terminal&&!xxdialogMode&&(Q("pastebutton").blur(),setDialogMode(2,"Vložit",3,showTermPasteDialogEx,'<textarea id=d2pasteText style="width:100%;height:184px;resize:none"></textarea>'),Q("d2pasteText").focus())}function showTermPasteDialogEx(){terminal&&terminal.m.TermSendKeys(Q("d2pasteText").value)}function sendSpecialKey(){null!=xterm?("sshterminalrelay.ashx"==terminal.urlname?terminal.socket.send("~"+String.fromCharCode(Q("specialkeylist").value)):terminal.sendText(String.fromCharCode(Q("specialkeylist").value)),xterm.focus()):null!=terminal&&(terminal.m.TermSendKey(Q("specialkeylist").value),Q("specialkeylist").blur(),Q("specialkeylistinput").blur())}function setupFiles(){filesNode!=currentNode&&null!=files&&filesNode._id!=currentNode._id&&(files.Stop(),files=filesNode=null);var e=0!=(1&(filesNode=currentNode).conn)||3==filesNode.mtype;QE("p13Connect",e),QE("p13Connects",e),QV("p13Connect",null==files&&2==filesNode.mtype),QV("p13Connects",0!=(512&features2)&&null!=filesNode.agent&&3!=filesNode.agent.id&&4!=filesNode.agent.id&&0==(8388608&features2)),QV("p13Disconnect",null!=files),p13setActions()}function onFilesStateChange(e,t){setSessionActivity(),QV("p13Connect",0==t&&2==filesNode.mtype),QV("p13Connects",0==t&&512&features2&&null!=filesNode.agent&&3!=filesNode.agent.id&&4!=filesNode.agent.id&&0==(8388608&features2)),QV("p13Disconnect",0!=t);var n=StatusStrs[t];switch(3==t&&(2==files.contype&&(n+=", SFTP"),1==files.webRtcActive)&&(n+=", WebRTC"),Q("p13Status").textContent=n,t){case 0:QH("p13files",""),p13filetree=null,p13filetreelocation=[],QH("p13currentpath",""),QE("p13FolderUp",!1),QV("filesRecordIcon",!1),p13setActions(),null!=files&&(files.Stop(),files=null),"fileMsgDialog"==xxdialogTag&&setDialogMode(0),null!=uploadFile&&(p13uploadFileTransferDone(),uploadFile=null);break;case 3:if(p13filetreelocation=[],p13targetpath="",files){var o=[];try{o=JSON.parse(getstore("_devFilePaths","[]"))}catch(e){}for(var i=0;i<o.length;i++)o[i].n==currentNode._id&&(p13targetpath=o[i].p);p13filetreelocation=p13targetpath.split("/"),files.sendText({action:"ls",reqid:1,path:p13targetpath}),1==files.serverIsRecording&&QV("filesRecordIcon",!0)}}}function CreateRemoteFiles(e){var t={protocol:5};return t.onFileUpdate=e,t.xxStateChange=function(e){},t.ProcessData=function(e){t.onFileUpdate(e)},t}var autoConnectFilesTimer=null;function autoConnectFiles(e){autoConnectFilesTimer=null==autoConnectFilesTimer?setInterval(connectFiles,100):(clearInterval(autoConnectFilesTimer),null)}function connectFiles(e,t,n){p13clearConsoleMsg(),files?(files.Stop(),files=null):(files=CreateAgentRedirect(meshserver,CreateRemoteFiles(p13gotFiles),serverPublicNamePort,authCookie,authRelayCookie,domainUrl),2==t&&(files.urlname="sshfilesrelay.ashx"),files.contype=t,files.options={consent:n},files.attemptWebRTC=attemptWebRTC,files.webrtcconfig=webrtcconfiguration,files.onStateChanged=onFilesStateChange,files.onConsoleMessageChange=function(){files.consoleMessage?(Q("p13FilesConsoleMsg").innerHTML+=formatAgentConsoleMessage(files.consoleMessage,files.consoleMessageId,files.consoleMessageArgs),QV("p13FilesConsoleMsg",!0),null!=p13FilesConsoleMsgTimer&&clearTimeout(p13FilesConsoleMsgTimer),files.consoleMessageTimeout&&(p13FilesConsoleMsgTimer=setTimeout(p13clearConsoleMsg,1e3*files.consoleMessageTimeout))):p13clearConsoleMsg()},files.Start(filesNode._id)),p13clipboard=p13clipboardFolder=null,p13clipboardCut=0,p13updateClipview()}var p13sortorder,p13filetree=null,p13targetpath=null,p13filetreelocation=[];function p13fileOperationDialogEx(e){0==e&&null!=files&&files.sendText({action:"cancel"})}function p13gotFiles(t){if(0<t.length&&123!=t.charCodeAt(0))p13gotDownloadBinaryData(t);else{try{t=JSON.parse(decode_utf8(t))}catch(e){try{t=JSON.parse(t)}catch(e){return void console.log("Unable to parse: "+t)}}if("download"==t.action)p13gotDownloadCommand(t);else if("findfile"==t.action)xxdialogTag==t.reqid&&(null==t.r?(QE("d2findFilter",!0),QE("filefind_dlgOkButton",!0),xxdialogTag=null,""==Q("d2findResults").innerHTML&&QH("d2findResults","<div style=text-align:center;margin:10px><i>Nebyly nalezeny žádné soubory</i></div>")):QA("d2findResults","<div style=white-space:nowrap>"+EscapeHtml(t.r)+"</div>"));else if(null!=t.action&&t.action.startsWith("upload"))p13gotUploadData(t);else{switch(t.action){case"sshauth":return void sshTunnelAuthDialog(t,p13sshConnectEx);case"autherror":return void p13setConsoleMsg("Chyba ověření",5e3);case"connectionerror":return void p13setConsoleMsg("Chyba připojení",5e3);case"sessionerror":return void p13setConsoleMsg("Relace vypršela",5e3);case"sessiontimeout":return void p13setConsoleMsg("Časový limit relace",5e3)}if("dialogmessage"==t.action)null==t.msg&&"fileMsgDialog"==xxdialogTag?setDialogMode(0):"zipping"!=t.msg||xxdialogMode&&"fileMsgDialog"!=xxdialogTag?"unzipping"!=t.msg||xxdialogMode&&"fileMsgDialog"!=xxdialogTag?"unziperror"!=t.msg||xxdialogMode&&"fileMsgDialog"!=xxdialogTag?"zippingFile"!=t.msg||xxdialogMode&&"fileMsgDialog"!=xxdialogTag||setDialogMode(2,"Provoz souboru",10,p13fileOperationDialogEx,"<div style=margin:10px>"+EscapeHtml(t.file)+"</div><br /><progress value="+EscapeHtml(t.progress)+" style=width:100% max=100 />","fileMsgDialog"):setDialogMode(2,"Provoz souboru",10,null,"<div style=margin:10px>Unzipping Error</div><br />"+EscapeHtml(t.error),"fileMsgDialog"):setDialogMode(2,"Provoz souboru",10,null,"<div style=margin:10px>Unzipping file...</div>","fileMsgDialog"):setDialogMode(2,"Provoz souboru",10,p13fileOperationDialogEx,"<div style=margin:10px>Komprese souborů ...</div>","fileMsgDialog");else if("refresh"==t.action)p13folderup(9999);else if(null!=t.path)if(null==t.dir)""!=p13targetpath&&p13folderup();else if(t.path=t.path.replace(/\//g,"\\"),null!=p13filetree&&t.path==p13filetree.path){var e=p13getCheckedNames();p13filetree=t,p13updateFiles(e)}else{for(var n=t.path.replace(/\//g,"\\"),o=p13targetpath.replace(/\//g,"\\");0<n.length&&"\\"==n[0];)n=n.substring(1);for(;0<o.length&&"\\"==o[0];)o=o.substring(1);(n==o||"\\"==t.path&&""==p13targetpath)&&(p13filetree=t,p13updateFiles())}}}}function p13sshConnectEx(e){var t,n,o;0==e?null!=files&&connectFiles():(t=0,1==Q("dp2authmethod").value?(0==(4194304&features2)&&(t=Q("dp2keep").checked?1:0),files.socket.send(JSON.stringify({action:"sshauth",username:Q("dp2user").value,password:Q("dp2pass").value,keep:t}))):3==Q("dp2authmethod").value?files.socket.send(JSON.stringify({action:"sshkeyauth",keypass:Q("dp2keypass2").value})):(0==(4194304&features2)&&1==(t=Q("dp2keep1").checked?1:0)&&(t+=Q("dp2keep2").checked?1:0),e=new FileReader,n=Q("dp2user").value,o=Q("dp2keypass").value,e.onload=function(e){files.socket.send(JSON.stringify({action:"sshauth",username:n,keypass:o,key:e.target.result,keep:t}))},e.readAsText(Q("dp2key").files[0])))}function p13getCheckedNames(){for(var e=[],t=document.getElementsByName("fd"),n=0;n<t.length;n++)t[n].checked&&e.push(p13filetree.dir[t[n].value].n);return e}function p13updateFiles(e){var t="",n="",o='<a href=# style=cursor:pointer onclick="return p13folderup(0)">Root</a>';if(null!=p13filetree){var i=p13filetree.path.split("\\");for(g in p13filetreelocation=[],i)""!=i[g]&&p13filetreelocation.push(i[g]);for(g in p13filetreelocation)o+=' / <a href=# style=cursor:pointer onclick="return p13folderup('+(parseInt(g)+1)+')">'+EscapeHtml(p13filetreelocation[g])+"</a>";var a=p13filetreelocation.join("/"),s=p13sort_files(p13filetree.dir);for(g in s){var r=s[g],l=r.n,d=70<l.length?'<span title="'+EscapeHtml(l)+'">'+EscapeHtml(l.substring(0,70))+"…</span>":EscapeHtml(l),u="",c=(null!=r.d&&(c=new Date(r.d),u=printDateTime(c="number"==typeof r.d?new Date(1e3*r.d):c)+"&nbsp;"),"");if(null!=r.s){var p=["Bytes","KB","MB","GB","TB"];let e=parseInt(Math.floor(Math.log(Math.abs(r.s))/Math.log(1024)),10);var m=Q("p13sizedropdown").options[Q("p13sizedropdown").selectedIndex],c=0==Q("p13sizedropdown").value?0===r.s?"n/a":0===e?r.s+" "+p[e]:(r.s/1024**e).toFixed(2)+" "+p[e]:1==Q("p13sizedropdown").value?getFileSizeStr(r.s):(r.s/2**m.value).toFixed(2)+" "+m.title}p="";r.t<3?(p="<div class=filelist file=999>",p=(p+="<input file=999 style=float:left name=fd class=fcb type=checkbox onchange=p13setActions() value='"+r.nx+'\'>&nbsp;<span style=float:right title=""></span>')+"<span><div class=fileIcon"+("REMOVABLE"==r.dt?5:"CDROM"==r.dt?6:r.t)+' onclick=p13folderset("'+encodeURIComponentEx(r.nx)+'")></div><a href=# style=cursor:pointer onclick=\'return p13folderset("'+encodeURIComponentEx(r.nx)+"\")'>",isWindowsNode(currentNode)&&r.dt&&currentNode.volumes&&currentNode.volumes[d.charAt(0).toUpperCase()]&&currentNode.volumes[d.charAt(0).toUpperCase()].name?p+=currentNode.volumes[d.charAt(0).toUpperCase()].name+" ("+d+")":p+=d,p+="</a></span></div>"):(m=d,0<r.s&&(m=3==filesNode.mtype?"<a href=# style=cursor:pointer onclick=\"return p13downloadfile('"+encodeURIComponentEx(a+"/"+l)+"','"+encodeURIComponentEx(l)+"',"+r.s+')">'+d+"</a>":'<a onclick=downloadFile("devicefile.ashx?c='+authCookie+"&m="+currentNode.meshid.split("/")[2]+"&n="+currentNode._id.split("/")[2]+"&f="+encodeURIComponentEx(a+"/"+l)+'","'+encodeURIComponentEx(l)+'") style=cursor:pointer>'+d+"</a>"),p="<div id=fileEntry cmenu=filesContextMenu fileIndex="+g+" class=filelist file=3><input file=3 style=float:left name=fd class=fcb type=checkbox onchange=p13setActions() value='"+r.nx+"'>&nbsp;<span class=fsize>"+u+"</span><span style=float:right>"+EscapeHtml(c)+"</span><span><div class=fileIcon"+r.t+"></div>"+m+"</span></div>"),r.t<3?t+=p:n+=p}if(QH("p13files",t+n),QH("p13currentpath",o),QE("p13FolderUp",0!=p13filetreelocation.length),null!=e)for(var v=document.getElementsByName("fd"),g=0;g<v.length;g++)0<=e.indexOf(p13filetree.dir[v[g].value].n)&&(v[g].checked=!0);p13setActions()}}function p13openfilefolder(){setDialogMode(2,"Open File/Folder",3,p13openfilefolderEx,"Are you sure you want to open this file/folder on the remote devices desktop ?")}function p13openfilefolderEx(){for(var e="",t=document.getElementsByName("fd"),n=0;n<t.length;n++)t[n].checked&&(e=(isWindowsNode(currentNode)?"":"/")+p13filetreelocation.join(isWindowsNode(currentNode)?"\\":"/")+(isWindowsNode(currentNode)?"\\":"/")+p13filetree.dir[t[n].value].n);""!=e&&files.sendText({action:"open",reqid:1,path:e,dir:1==p13getFileSelDirCount()})}function p13gotofolder(){setDialogMode(2,"Go To Folder",3,p13gotofolderEx,'<input type=text id=p13folderinput style=width:100% placeholder="'+(isWindowsNode(currentNode)?"C:\\":"/var/www")+'" />'),focusTextBox("p13folderinput")}function p13gotofolderEx(){p13targetpath=Q("p13folderinput").value.split("\\").join("/"),files&&(p13storeCurrentPath(p13targetpath),files.sendText({action:"ls",reqid:1,path:p13targetpath}))}function p13folderset(e){p13targetpath=joinPaths(p13filetree.path,p13filetree.dir[e].n).split("\\").join("/"),files&&(p13storeCurrentPath(p13targetpath),files.sendText({action:"ls",reqid:1,path:p13targetpath}))}function p13folderup(e){if(null==e)p13filetreelocation.pop();else for(;p13filetreelocation.length>e;)p13filetreelocation.pop();return p13targetpath=p13filetreelocation.join("/"),files&&(p13storeCurrentPath(p13targetpath),files.sendText({action:"ls",reqid:1,path:p13targetpath})),!1}function p13storeCurrentPath(e){var t=[],n=-1;try{t=JSON.parse(getstore("_devFilePaths","[]"))}catch(e){}for(var o=0;o<t.length;o++)t[o].n==currentNode._id&&(n=o);for(0<=n&&t.splice(n,1),t.push({n:currentNode._id,p:e});40<t.length;)t.shift();putstore("_devFilePaths",JSON.stringify(t))}function p13findfile(){var e;xxdialogMode||(e=addHtmlValue("Filtr",'<input id=d2findFilter style="width:230px" onkeyup=p13findfileValidate() onkeydown=p13findfileDown(event) placeholder="*.txt"></input>'),setDialogMode(2,"Najít soubory",0,null,e=(e+='<div id=d2findResults style="width:100%;height:184px;background-color:white;border:1px solid black;padding:3px;overflow:scroll;margin-top:8px"></div>')+"<div style=margin-top:8px><input id=filefind_dlgCancelButton type=button value=Zavřít style=float:right;width:80px;margin-left:5px onclick=p13findfileCancel()>"+"<input id=filefind_dlgOkButton type=submit value=Hledat style=float:right;width:80px onclick=p13findfileEx()><br /><br /></div>"),p13findfileValidate(),Q("d2findFilter").focus())}function p13findfileDown(e){"Zadání"==e.code&&p13findfileEx()}function p13findfileValidate(){QE("filefind_dlgOkButton",0<Q("d2findFilter").value.length)}function p13findfileCancel(){null!=xxdialogTag&&files.sendText({action:"cancelfindfile",reqid:xxdialogTag}),dialogclose(0)}function p13findfileEx(e,t){var n,o,i;0!=Q("d2findFilter").value.length&&(n=0<currentNode.agent.id&&currentNode.agent.id<5||14==currentNode.agent.id||34==currentNode.agent.id,i=p13filetreelocation.join(o=n?"\\":"/")+o,n||(i=o+i),xxdialogTag="find:"+Math.random(),files.sendText({action:"findfile",reqid:xxdialogTag,path:i,filter:Q("d2findFilter").value}),QH("d2findResults",""),QE("d2findFilter",!1),QE("filefind_dlgOkButton",!1))}function p13sort_filename(e,t){return e.ln>t.ln?+p13sortorder:e.ln<t.ln?-1*p13sortorder:0}function p13sort_timestamp(e,t){return e.d>t.d?+p13sortorder:e.d<t.d?-1*p13sortorder:0}function p13sort_bysize(e,t){return e.s==t.s?p13sort_filename(e,t):(e.s-t.s)*p13sortorder}function p13sort_files(e){var t,n=[],o=Q("p13sortdropdown").value;for(t in e)e[t].nx=t,null==e[t].s&&(e[t].s=0),null==e[t].n&&(e[t].n=t),e[t].ln=e[t].n.toLowerCase(),n.push(e[t]);return p13sortorder=1,3<o&&(p13sortorder=-1,o-=3),1==o?n.sort(p13sort_filename):2==o?n.sort(p13sort_bysize):3==o&&n.sort(p13sort_timestamp),n}function p13setActions(){var e,t,n,o,i=null!=currentNode.agent&&14!=currentNode.agent.id;null==p13filetree?(QE("p13DeleteFileButton",!1),QE("p13NewFolderButton",!1),QE("p13UploadButton",!1),QE("p13RenameFileButton",!1),QE("p13ViewFileButton",!1),QE("p13SelectAllButton",!1),Q("p13SelectAllButton").value="Vybrat vše",QE("p13RefreshButton",!1),QE("p13FindButton",!1),QE("p13CutButton",!1),QE("p13CopyButton",!1),QE("p13ZipButton",!1),QE("p13UnZipButton",!1),QE("p13PasteButton",!1),QE("p13GoToFolderButton",!1),QE("p13DownloadButton",!1),QE("p13OpenButton",!1)):(e=p13getFileSelCount(),t=p13getFileCount(),n=p13getFileSelCount(!1),o=0<currentNode.agent.id&&currentNode.agent.id<5||14==currentNode.agent.id||34==currentNode.agent.id,QE("p13DeleteFileButton",0<e&&(0<p13filetreelocation.length||0==o)),QE("p13NewFolderButton",i&&(0<p13filetreelocation.length||0==o)),QE("p13UploadButton",0<p13filetreelocation.length||0==o||14==currentNode.agent.id),QE("p13RenameFileButton",i&&1==e&&(0<p13filetreelocation.length||0==o)),QE("p13ViewFileButton",i&&1==e&&1==n&&(0<p13filetreelocation.length||0==o)),QE("p13SelectAllButton",0<t),Q("p13SelectAllButton").value=0<e?"Nevybrat nic":"Vybrat vše",QE("p13RefreshButton",!0),QE("p13FindButton",i&&(0<p13filetreelocation.length||0==o)),QE("p13CutButton",i&&0<e&&e==n&&(0<p13filetreelocation.length||0==o)),QE("p13CopyButton",i&&0<e&&e==n&&(0<p13filetreelocation.length||0==o)),QE("p13ZipButton",i&&0<e&&(0<p13filetreelocation.length||0==o)),QE("p13UnzipButton",i&&1==e&&1==n&&(0<p13filetreelocation.length||0==o)&&p13getFileSelAllowedExt(".zip")),QE("p13PasteButton",i&&(0<p13filetreelocation.length||0==o)&&null!=p13clipboard&&0<p13clipboard.length),QE("p13GoToFolderButton",i),QE("p13OpenButton",i&&1==e),QE("p13DownloadButton",0<e&&e==n&&(0<p13filetreelocation.length||0==o))),1==(null!=files&&0!=files.state)&&2!=files.contype||null==filesNode.agent||3==filesNode.agent.id||4==filesNode.agent.id?QH("filesCustomUpperRight",""):QH("filesCustomUpperRight","<a style=cursor:pointer onclick=cmsshportaction(1,event)>"+format("Port SSH {0}",filesNode.sshport||22)+"</a>"),QV("filesActionsBtn",3!=filesNode.mtype),QV("p13FindButton",3!=filesNode.mtype),QV("p13CutButton",3!=filesNode.mtype),QV("p13CopyButton",3!=filesNode.mtype),QV("p13ZipButton",3!=filesNode.mtype),QV("p13UnzipButton",3!=filesNode.mtype),QV("p13PasteButton",3!=filesNode.mtype)}function p13getFileSelCount(e){for(var t=0,n=document.getElementsByName("fd"),o=0;o<n.length;o++)!n[o].checked||0==e&&"3"!=n[o].attributes.file.value||t++;return t}function p13getFileSelDirCount(){for(var e=0,t=document.getElementsByName("fd"),n=0;n<t.length;n++)t[n].checked&&"999"==t[n].attributes.file.value&&e++;return e}function p13getFileCount(){return document.getElementsByName("fd").length}function p13getFileSelAllowedExt(e){for(var t=document.getElementsByName("fd"),n=0;n<t.length;n++)if(t[n].checked&&!p13filetree.dir[t[n].value].n.endsWith(e))return!1;return!0}function p13selectallfile(){for(var e=0==p13getFileSelCount(),t=document.getElementsByName("fd"),n=0;n<t.length;n++)t[n].checked=e;p13setActions()}function p13createfolder(){setDialogMode(2,"Nová složka",3,p13createfolderEx,"<input type=text id=p13renameinput maxlength=64 onkeyup=p13fileNameCheck(event) style=width:100% />"),focusTextBox("p13renameinput"),p13fileNameCheck()}function p13createfolderEx(){files.sendText({action:"mkdir",reqid:1,path:p13filetreelocation.join("/")+"/"+Q("p13renameinput").value}),p13folderup(999)}function p13deletefile(){var e=p13getFileSelCount(),t=0<p13getFileSelDirCount()?"<br /><br /><label><input type=checkbox id=p13recdeleteinput>Rekurzivní mazání</label><br>":"<input type=checkbox id=p13recdeleteinput style='display:none'>";setDialogMode(2,"Smazat",3,p13deletefileEx,1<e?format("Smazat {0} vybrané prvky?",e)+t:"Smazat vybraný prvek?"+t)}function p13deletefileEx(){for(var e=[],t=document.getElementsByName("fd"),n=0;n<t.length;n++)t[n].checked&&e.push(p13filetree.dir[t[n].value].n);files.sendText({action:"rm",reqid:1,path:p13filetreelocation.join("/"),delfiles:e,rec:Q("p13recdeleteinput").checked}),p13folderup(999)}function p13renamefile(){for(var e,t=document.getElementsByName("fd"),n=0;n<t.length;n++)t[n].checked&&(e=p13filetree.dir[t[n].value].n);setDialogMode(2,"Přejmenovat",3,p13renamefileEx,'<input type=text id=p13renameinput maxlength=64 onkeyup=p13fileNameCheck(event) style=width:100% value="'+e+'" />',{action:"rename",path:p13filetreelocation.join("/"),oldname:e}),focusTextBox("p13renameinput"),p13fileNameCheck()}function p13renamefileEx(e,t){t.newname=Q("p13renameinput").value,files.sendText(t),p13folderup(999)}function p13fileNameCheck(e){var t=isFilenameValid(Q("p13renameinput").value);QE("idx_dlgOkButton",t),1==t&&null!=e&&13==e.keyCode&&dialogclose(1)}function p13uploadFile(){setDialogMode(2,"Nahrát soubor",3,p13uploadFileEx,"<input type=file name=files id=p13uploadinput style=width:100% multiple=multiple onchange=\"updateUploadDialogOk('p13uploadinput')\" />"),updateUploadDialogOk("p13uploadinput")}function updateUploadDialogOk(e){QE("idx_dlgOkButton",0<Q("p13uploadinput").files.length)}function p13uploadFileEx(){p13doUploadFiles(Q("p13uploadinput").files)}function p13viewfile(){for(var e=document.getElementsByName("fd"),t=0;t<e.length;t++)if(e[t].checked){p13filetree.dir[e[t].value].s<=204800?p13downloadfile(encodeURIComponentEx(p13filetreelocation.join("/")+"/"+p13filetree.dir[e[t].value].n),encodeURIComponentEx(p13filetree.dir[e[t].value].n),p13filetree.dir[e[t].value].s,"viewer"):messagebox("Editor souborů","Upravovat je možné jen soubory, které jsou menší než 200 kilobajtů.");break}}function p13unzipFile(){for(var e,t,n,o=document.getElementsByName("fd"),i=0;i<o.length;i++)o[i].checked&&(e=isWindowsNode(currentNode)?"\\":"/",t=(isWindowsNode(currentNode)?"":"/")+p13filetreelocation.join(e)+e+p13filetree.dir[o[i].value].n.split(".zip")[0]+e,n=(isWindowsNode(currentNode)?"":"/")+p13filetreelocation.join(e)+e+p13filetree.dir[o[i].value].n);setDialogMode(2,"Unzip To Folder",3,p13unzipFileEx,'<input type=text id=p13unzipfolderinput maxlength=64 style=width:100% value="'+t+'" />',{action:"unzip",input:n}),focusTextBox("p13unzipfolderinput")}function p13unzipFileEx(e,t){t.dest=Q("p13unzipfolderinput").value,files.sendText(t)}function p13zipFiles(){for(var e=[],t=document.getElementsByName("fd"),n=0;n<t.length;n++)t[n].checked&&e.push(p13filetree.dir[t[n].value].n);setDialogMode(2,"Název souboru ZIP",3,p13zipFilesEx,'<input type=text id=p13renameinput maxlength=64 onkeyup=p13fileNameCheck(event) style=width:100% value="" />',{action:"zip",path:p13filetreelocation.join("/"),files:e}),focusTextBox("p13renameinput"),p13fileNameCheck()}function p13zipFilesEx(e,t){t.output=Q("p13renameinput").value,t.output.toLowerCase().endsWith(".zip")||(t.output+=".zip"),files.sendText(t)}var p13clipboard=null,p13clipboardFolder=null,p13clipboardCut=0;function p13copyFile(e){var t=document.getElementsByName("fd");p13clipboard=[],p13clipboardCut=e,p13clipboardFolder=p13targetpath;for(var n=0;n<t.length;n++)t[n].checked&&"3"==t[n].attributes.file.value&&p13clipboard.push(p13filetree.dir[t[n].value].n);p13updateClipview()}function p13pasteFile(){var e="";setDialogMode(2,"Vložit",3,p13pasteFileEx,e=null!=p13clipboard&&0<p13clipboard.length?0==p13clipboardCut?1<p13clipboard.length?format("Potvrdit kopírování {0} zaznámů do tohoto umístění?",p13clipboard.length):format("Potvrdit kopírování jednoho záznamu do tohoto umístění?"):1<p13clipboard.length?format("Potvrdit přesun {0} záznamů do tohoto umístění?",p13clipboard.length):format("Potvrdit přesun jednoho záznamu do tohoto umístění?"):e)}function p13pasteFileEx(){files.sendText({action:0==p13clipboardCut?"copy":"move",reqid:1,scpath:p13clipboardFolder,dspath:p13targetpath,names:p13clipboard}),p13folderup(999),1==p13clipboardCut&&(p13clipboardFolder=p13clipboard=null,p13clipboardCut=0,p13updateClipview())}function p13updateClipview(){var e="";null!=p13clipboard&&0<p13clipboard.length&&(e=0==p13clipboardCut?1<p13clipboard.length?format('Drží se {0} záznamů pro kopii, <a href=# onclick="return p13clearClip()" style=cursor:pointer>Vymazat</a>.',p13clipboard.length):format('Drží se jeden záznam pro kopii, <a href=# onclick="return p13clearClip()" style=cursor:pointer>Vymazat</a>.'):1<p13clipboard.length?format('Drží se {0} zaznamů pro přesun, <a href=# onclick="return p13clearClip()" style=cursor:pointer>Vymazat</a>.',p13clipboard.length):format('Drží se jeden záznam pro přesun, <a href=# onclick="return p13clearClip()" style=cursor:pointer>Vymazat</a>.')),QH("p13bottomstatus",e),p13setActions()}function p13clearClip(){return p13clipboardFolder=p13clipboard=null,p13clipboardCut=0,p13updateClipview(),!1}function p13fileDragDrop(e){if(haltEvent(e),QV("p13bigfail",!1),QV("p13bigok",!1),null!=e.dataTransfer&&0!=e.dataTransfer.files.length&&null!=p13filetree){var t,n=[];for(t in e.dataTransfer.files)null!=e.dataTransfer.files[t].size&&0!=e.dataTransfer.files[t].size&&n.push(e.dataTransfer.files[t]);0!=n.length&&p13doUploadFiles(n)}}var gdownloadFile,p13dragtimer=null;function p13fileDragOver(e){haltEvent(e),null!=p13dragtimer&&(clearTimeout(p13dragtimer),p13dragtimer=null);e=null!=p13filetree;QV("p13bigok",e),QV("p13bigfail",!e)}function p13fileDragLeave(e){haltEvent(e),"p13filetable"!=e.target.id?(QV("p13bigfail",!1),QV("p13bigok",!1)):p13dragtimer=setTimeout(function(){QV("p13bigfail",!1),QV("p13bigok",!1),p13dragtimer=null},10)}function p13downloadfile(e,t,n,o){!xxdialogMode&&files&&(gdownloadFile={path:decodeURIComponent(e),file:decodeURIComponent(t),size:n,tsize:0,data:"",state:0,id:Math.random(),tag:o},files.sendText({action:"download",sub:"start",id:gdownloadFile.id,path:gdownloadFile.path}),setDialogMode(2,"Stáhnout soubor",10,p13downloadFileCancel,"<div>"+EscapeHtml(gdownloadFile.file)+"</div><br /><progress id=d2progressBar style=width:100% value=0 max="+n+" />"))}function p13downloadFileCancel(){setDialogMode(0),files.sendText({action:"download",sub:"cancel",id:gdownloadFile.id}),gdownloadFile=null}function p13gotDownloadCommand(e){null!=gdownloadFile&&e.id==gdownloadFile.id&&("start"==e.sub?(gdownloadFile.state=1,files.sendText({action:"download",sub:"startack",id:gdownloadFile.id})):"cancel"==e.sub&&(gdownloadFile=null,setDialogMode(0)))}function p13gotDownloadBinaryData(e){gdownloadFile&&0!=gdownloadFile.state&&(4<e.length&&(gdownloadFile.tsize+=e.length-4,gdownloadFile.data+=e.substring(4),Q("d2progressBar").value=gdownloadFile.tsize),0!=(1&ReadInt(e,0))?"viewer"==gdownloadFile.tag?(setDialogMode(4,EscapeHtml(gdownloadFile.file),3,p13editSaveBack,null,gdownloadFile.file),QV("d4EncodingButton",!0),QV("d4LineBreakButton",!0),QS("dialog").width="auto",QS("dialog").bottom="80px",QS("dialog").top=QS("dialog").left=QS("dialog").right="100px",Q("d4editorarea").value=1==d4EditEncodingVal?decode_utf8(gdownloadFile.data):gdownloadFile.data,gdownloadFile=null):(saveAs(data2blob(gdownloadFile.data),gdownloadFile.file),gdownloadFile=null,setDialogMode(0)):files.sendText({action:"download",sub:"ack",id:gdownloadFile.id}))}function p13downloadButton(){for(var e,t,n=document.getElementsByName("fd"),o=0;o<n.length;o++)n[o].checked&&(e=p13filetree.dir[n[o].value],t="devicefile.ashx?c="+authCookie,downloadFile(t=(t=(t+="&m="+currentNode.meshid.split("/")[2])+("&n="+currentNode._id.split("/")[2]))+("&f="+encodeURIComponentEx(p13filetreelocation.join("/")+"/"+e.n)),encodeURIComponentEx(e.n)))}var uploadFile,d4EditWrapVal=0,d4EditSizeVal=0,d4EditEncodingVal=0,d4EditLineBreakVal=0;function d4ToggleWrap(e){e||(d4EditWrapVal=++d4EditWrapVal%2),Q("d4WrapButton").value=["Zalamování: zapnuto","Zalamování: vypnuto"][d4EditWrapVal],QS("d4editorarea").overflow=0==d4EditWrapVal?"auto":"scroll",QS("d4editorarea")["white-space"]=0==d4EditWrapVal?null:"pre",putstore("editorWrap",d4EditWrapVal)}function d4ToggleSize(e){e||(d4EditSizeVal=++d4EditSizeVal%4),QS("d4editorarea")["font-size"]=["100%","125%","150%","200%"][d4EditSizeVal],Q("d4SizeButton").value=["Velikost: 100%","Velikost: 125%","Velikost: 150%","Velikost: 200%"][d4EditSizeVal],putstore("editorSize",d4EditSizeVal)}function d4ToggleEncoding(e){e||(d4EditEncodingVal=++d4EditEncodingVal%2,Q("d4editorarea").value=(1==d4EditEncodingVal?decode_utf8:encode_utf8)(Q("d4editorarea").value)),Q("d4EncodingButton").value=["Kódování: RAW","Kódování: UTF8"][d4EditEncodingVal],putstore("editorEncoding",d4EditEncodingVal)}function d4ToggleLineBreak(e){e||(d4EditLineBreakVal=++d4EditLineBreakVal%3),Q("d4LineBreakButton").value=["Line Break: Windows (CR LF)","Line Break: Linux (LF)","Line Break: Mac (CR)"][d4EditLineBreakVal],putstore("editorLineBreak",d4EditLineBreakVal)}function p13editSaveBack(e,t){var n=Q("d4editorarea").value,n=0===d4EditLineBreakVal?n.replace(/\r?\n|\r/g,"\r\n"):2===d4EditLineBreakVal?n.replace(/\r\n|\n/g,"\r"):n.replace(/\r\n|\r/g,"\n"),n=1==d4EditEncodingVal?(new TextEncoder).encode(n):(new TextEncoder).encode(decode_utf8(n));p13uploadFileContinue(1,[{name:t,size:n.byteLength,type:"text/plain",xdata:n}])}function p13doUploadFiles(e){if(!xxdialogMode){var t=0<currentNode.agent.id&&currentNode.agent.id<5||14==currentNode.agent.id||34==currentNode.agent.id,n=[],o=0;for(i in p13filetree.dir)n.push(t?p13filetree.dir[i].n.toLowerCase():p13filetree.dir[i].n);for(var i=0;i<e.length;i++)t?0<=n.indexOf(e[i].name.toLowerCase())&&o++:0<=n.indexOf(e[i].name)&&o++;0==o?p13uploadFileContinue(1,e):setDialogMode(2,"Nahrát soubor",3,p13uploadFileContinue,format(1==o?"Nahrání přepíše 1 soubor. Pokračovat?":"Nahrání přepíše {0} soubory. Pokračovat?",o),e)}}function p13uploadFileContinue(e,t){(uploadFile={}).xpath=p13filetreelocation.join("/"),uploadFile.xfiles=t,uploadFile.xfilePtr=-1,setDialogMode(2,"Nahrát soubor",10,p13uploadFileCancel,"<div id=p13dfileName>Připojování…</div><br /><progress id=d2progressBar style=width:100% value=0 max=0 />"),p13uploadNextFile()}let byteToHex=[];for(var n=0;n<=255;++n){var hexOctet=n.toString(16).padStart(2,"0");byteToHex.push(hexOctet)}function arrayBufferToHex(e){return Array.prototype.map.call(new Uint8Array(e),e=>byteToHex[e]).join("")}function performHash(e,t){window.crypto.subtle.digest("SHA-384",e).then(function(e){t(arrayBufferToHex(e))},function(){t(null)})}function performHashOnFile(e,t){var n=new FileReader;n.onerror=function(e){t(null)},n.onload=function(){window.crypto.subtle.digest("SHA-384",n.result).then(function(e){t(arrayBufferToHex(e))},function(){t(null)})},n.readAsArrayBuffer(e)}function p13uploadNextFile(){if(uploadFile.xfilePtr++,uploadFile.xfiles.length>uploadFile.xfilePtr){uploadFile.xptr=0;var t=uploadFile.xfiles[uploadFile.xfilePtr];if(QH("p13dfileName",EscapeHtml(t.name)),Q("d2progressBar").max=t.size,Q("d2progressBar").value=0,null==t.xdata){uploadFile.xfile=t;var e,n=null;for(e in p13filetree.dir)p13filetree.dir[e].n==t.name&&(n=p13filetree.dir[e]);null!=n&&n.s<=uploadFile.xfile.size?performHashOnFile(uploadFile.xfile,function(e){files.sendText(JSON.stringify({action:"uploadhash",reqid:uploadFile.xfilePtr,path:uploadFile.xpath,name:t.name,tag:{h:e.toUpperCase(),s:n.s,skip:n.s==uploadFile.xfile.size}}))}):files.sendText(JSON.stringify({action:"upload",reqid:uploadFile.xfilePtr,path:uploadFile.xpath,name:t.name,size:uploadFile.xfile.size}))}else uploadFile.xdata=t.xdata,files.sendText(JSON.stringify({action:"upload",reqid:uploadFile.xfilePtr,path:uploadFile.xpath,name:t.name,size:uploadFile.xdata.byteLength}))}else p13uploadFileTransferDone()}function p13uploadFileCancel(e,t){null!=uploadFile&&(files.sendText(JSON.stringify({action:"uploadcancel",reqid:uploadFile.xfilePtr})),uploadFile=null),p13uploadFileTransferDone()}function p13uploadFileTransferDone(){uploadFile=null,setDialogMode(0),p13folderup(9999)}function p13gotUploadData(e){if(null!=uploadFile&&parseInt(uploadFile.xfilePtr)==parseInt(e.reqid))switch(e.action){case"uploadstart":p13uploadNextPart(!(uploadFile.xdataPriming=8));break;case"uploadack":p13uploadNextPart(!1);break;case"uploaddone":(uploadFile.xfiles.length>uploadFile.xfilePtr+1?p13uploadNextFile:p13uploadFileTransferDone)();break;case"uploaderror":p13uploadFileCancel();break;case"uploadhash":var t=uploadFile.xfiles[uploadFile.xfilePtr];t&&(e.tag.h===e.hash?e.tag.skip?p13uploadNextFile():(uploadFile.xptr=e.tag.s,files.sendText(JSON.stringify({action:"upload",reqid:uploadFile.xfilePtr,path:uploadFile.xpath,name:t.name,size:uploadFile.xfile.size,append:!0}))):files.sendText(JSON.stringify({action:"upload",reqid:uploadFile.xfilePtr,path:uploadFile.xpath,name:t.name,size:uploadFile.xfile.size,append:!1})))}}function p13uploadNextPart(e){if(uploadFile.xdata){var t=uploadFile.xdata,n=uploadFile.xptr;if(n>=t.byteLength)files.sendText(JSON.stringify({action:"uploaddone",reqid:uploadFile.xfilePtr}));else{if((o=uploadFile.xptr+(attemptWebRTC?16384:65536))>t.byteLength){if(1==e)return;o=t.byteLength}t=new Uint8Array(t.slice(n,o));123==t[0]||0==t[0]?((n=new Uint8Array(o-n+1)).set(t,1),files.send(n)):files.send(t),uploadFile.xptr=o,Q("d2progressBar").value=o}}else if(uploadFile.xfile&&null==uploadFile.xreader&&!(uploadFile.xptr>=uploadFile.xfile.size)){var o;if((o=uploadFile.xptr+(attemptWebRTC?16384:65536))>uploadFile.xfile.size){if(1==e)return;o=uploadFile.xfile.size}uploadFile.xreader=new FileReader,uploadFile.xreader.onerror=function(e){console.log(e)},uploadFile.xreader.onload=function(){var e,t=uploadFile.xreader.result;delete uploadFile.xreader,null!=t&&(123==(e=new Uint8Array(t))[0]||0==e[0]?((t=new Uint8Array(t.byteLength+1)).set(e,1),files.send(t)):files.send(e),uploadFile.xptr=o,Q("d2progressBar").value=o,uploadFile.xptr>=uploadFile.xfile.size?files.sendText(JSON.stringify({action:"uploaddone",reqid:uploadFile.xfilePtr})):0<uploadFile.xdataPriming&&(uploadFile.xdataPriming--,p13uploadNextPart(!0)))},uploadFile.xreader.readAsArrayBuffer(uploadFile.xfile.slice(uploadFile.xptr,o))}}var currentDeviceEvents=null;function deviceEventsUpdate(){var e="",t=null;for(r in currentDeviceEvents){var n=currentDeviceEvents[r],o=new Date(n.time);if(n.msg){null==n.h&&(n.h=Math.random()),printDate(o)!=t&&(null!=t&&(e+="</table>"),e+="<table class=p3eventsTable cellpadding=0 cellspacing=0><tr><td colspan=4 class=DevSt>"+(t=printDate(o))+"</td></tr>");var i,a,s="si3";if("user"==n.etype&&(s="m2"),"server"==n.etype&&(s="si3"),null==n.msgid||null==eventsMessageId[n.msgid])i="string"==typeof n.msg?EscapeHtml(n.msg).split("(R)").join("&reg;"):"";else{for(var r in i=eventsMessageId[n.msgid],n.msgArgs){var l=n.msgArgs[r];"string"==typeof l&&0==l.indexOf("DATETIME:")&&(l=printFlexDateTime(new Date(parseInt(l.substring(9))))),i=i.split("{"+r+"}").join(l)}i=EscapeHtml(i).split("(R)").join("&reg;")}n.username&&(a="",n.guestname&&(a=' / <span title="Toto je relace sdílení hostů">'+EscapeHtml(n.guestname)+"</span>"),i=2&userinfo.siteadmin&&n.userid?"<a href=# onclick='gotoUser(\""+encodeURIComponentEx(n.userid)+"\");haltEvent(event);'>"+EscapeHtml(n.username)+"</a>"+a+" &rarr; "+i:EscapeHtml(n.username)+a+" &rarr; "+i),"relay"!=n.etype&&"relaylog"!=n.action||(s="relayIcon16"),e+="<tr onclick=showEventDetails("+n.h+",1) onmouseover=eventMouseHover(this,1) onmouseout=eventMouseHover(this,0) style=cursor:pointer><td style=width:18px><div class="+s+"></div></td><td class=g1>&nbsp;</td><td class=style10>"+printTime(o)+" - "+i+"</td><td class=g2>&nbsp;</td></tr><tr style=height:2px></tr>"}}null!=t&&(e+="</table>"),""==e&&(e="<br><i>Nenalezeny žádné události</i><br><br>"),QH("p16events",e)}function refreshDeviceEvents(){""!=p16filterevents.value?meshserver.send({action:"events",nodeid:currentNode._id,limit:parseInt(p16limitdropdown.value),filter:p16filterevents.value}):meshserver.send({action:"events",nodeid:currentNode._id,limit:parseInt(p16limitdropdown.value)})}function showEventDetails(e,t){if(xxdialogMode)return!1;var n,o;for(i in 1==t&&(n=currentDeviceEvents),2==t&&(n=events),n=3==t?currentUserEvents:n)if(n[i].h==e){o=n[i];break}if(o){var i,a="<div style=overflow-y:auto;max-height:300px>";for(i in o)"h"!=i&&"_id"!=i&&"ids"!=i&&"domain"!=i&&null!=o[i]&&("object"==typeof o[i]?a+=addHtmlValue3(EscapeHtml(i),EscapeHtml(JSON.stringify(o[i]))):a+=addHtmlValue3(EscapeHtml(i),EscapeHtml(o[i])));setDialogMode(2,"Podrobnosti události",9,null,a+="</div>")}}var deviceDetailsStats=null,deviceDetailsStatsTimer=null,deviceDetailsStatsData=[],deviceDetailsConfig={type:"line",data:{labels:[],datasets:[{label:"Procesor",backgroundColor:"rgba(134, 16, 158, .5)",borderColor:"rgb(134, 16, 158)",data:[],fill:!0},{label:"Operační paměť",backgroundColor:"rgba(255, 99, 132, .5)",borderColor:"rgb(255, 99, 132)",data:[],fill:!0}]},options:{events:["click"],animation:!1,responsive:!0,maintainAspectRatio:!1,tooltips:{enabled:!1},elements:{line:{cubicInterpolationMode:"monotone"}},scales:{x:{type:"linear",display:!0,title:{display:!1,text:""},min:0,max:100,reverse:!0},y:{type:"linear",display:!0,title:{display:!1,text:""},min:0,max:100}}}};function deskToggleCpuGraph(){("none"==QS("p17graph").display?(QV("p17graph",!0),window.deviceDetailsStatsChart=new Chart(document.getElementById("deviceDetailsStats").getContext("2d"),deviceDetailsConfig),deviceDetailsStatsTimer=setInterval(deviceDetailsStatsTimerFunc,2e3),deviceDetailsStatsTimerFunc):deviceDetailsStatsClear)()}function deviceDetailsStatsClear(){QV("p17graph",!1),null!=window.deviceDetailsStatsChart&&(window.deviceDetailsStatsChart.destroy(),delete window.deviceDetailsStatsChart),null!=deviceDetailsStatsTimer&&(clearInterval(deviceDetailsStatsTimer),deviceDetailsStatsTimer=null),deviceDetailsStatsData=[],deviceDetailsStatsDraw(),QV("extraGraphValues",!1),QH("extraGraphValues","")}function deviceDetailsStatsTimerFunc(){null!=currentNode&&meshserver.send({action:"msg",type:"cpuinfo",nodeid:currentNode._id})}function deviceDetailsStatsDraw(e){for(var t=Date.now()/1e3-100;0<deviceDetailsStatsData.length&&deviceDetailsStatsData[0][0]<t-5;)deviceDetailsStatsData.shift();var n=[],o=[];for(a in deviceDetailsStatsData){var i=deviceDetailsStatsData[a];n.push({x:100-(i[0]-t),y:i[1]}),o.push({x:100-(i[0]-t),y:i[2]})}if(deviceDetailsConfig.data.datasets[0].data=n,deviceDetailsConfig.data.datasets[1].data=o,window.deviceDetailsStatsChart&&window.deviceDetailsStatsChart.update(),null!=e&&Array.isArray(e.thermals)&&0<e.thermals.length){var a,s="&nbsp;";for(a in e.thermals)s+='<div class=thermalSensor title="'+e.thermals[a].InstanceName+'">'+parseFloat(e.thermals[a].CurrentTemperature).toFixed(2)+"&deg;C / "+parseFloat(1.8*e.thermals[a].CurrentTemperature+32).toFixed(2)+"&deg;F</div>";QV("extraGraphValues",!0),QH("extraGraphValues",s)}}var consoleNode,DeviceDetailsHardware=null,DeviceDetailsNetwork=null,DeviceDetailsNodeId=null;function updateDeviceDetails(e,t,n){if(null!=currentNode&&(null==e&&(e=currentNode),currentNode._id==e._id)){DeviceDetailsNodeId!=e._id&&(DeviceDetailsNetwork=DeviceDetailsHardware=null,DeviceDetailsNodeId=e._id),null==(t=DeviceDetailsHardware=null!=t?t:DeviceDetailsHardware)&&(t={}),null==(n=DeviceDetailsNetwork=null!=n?n:DeviceDetailsNetwork)&&(n={});var o,i,a=[],s={},r="";if(e.rname&&(r+=addDetailItem("Název",EscapeHtml(e.rname),s)),t.windows&&t.windows.osinfo&&t.windows.osinfo.Description&&(r+=addDetailItem("Popis",EscapeHtml(t.windows.osinfo.Description),s)),e.osdesc&&(r+=addDetailItem("Verze",EscapeHtml(e.osdesc),s)),t.windows&&t.windows.osinfo&&((d=t.windows.osinfo).OSArchitecture&&(d.OSArchitecture.startsWith("32")?r+=addDetailItem("Architektura","32bitové",s):d.OSArchitecture.startsWith("64")?r+=addDetailItem("Architektura","64bitové",s):r+=addDetailItem("Architektura",EscapeHtml(d.OSArchitecture),s)),d.LastBootUpTime)&&(i={year:parseInt(d.LastBootUpTime.substring(0,4)),month:parseInt(d.LastBootUpTime.substring(4,6))-1,day:parseInt(d.LastBootUpTime.substring(6,8)),hours:parseInt(d.LastBootUpTime.substring(8,10)),minutes:parseInt(d.LastBootUpTime.substring(10,12)),seconds:parseInt(d.LastBootUpTime.substring(12,14))},r+=addDetailItem("Last Boot Up Time",printDateTime(new Date(i.year,i.month,i.day,i.hours,i.minutes,i.seconds)))),t.linux&&t.linux.LastBootUpTime&&(r+=addDetailItem("Last Boot Up Time",printDateTime(new Date(t.linux.LastBootUpTime)))),t.darwin&&t.darwin.LastBootUpTime&&(r+=addDetailItem("Last Boot Up Time",printDateTime(new Date(1e3*t.darwin.LastBootUpTime)))),""!=r&&a.push({name:"Operační systém",html:r,img:"software64.png"}),e.agent&&(r="",null!=e.agent&&null!=e.agent.id&&null!=e.agent.ver&&(i="",i=e.agent.id<=agentsStr.length?agentsStr[e.agent.id]:agentsStr[0],0!=e.agent.ver&&(i+=" v"+e.agent.ver),r+=addDetailItem("Mesh Agent",i=14==e.agent.id?e.agent.core:i)),0!=(1&e.conn)?r+=addDetailItem("Poslední připojení agenta","Připojeno hned"):e.lastconnect&&(r+=addDetailItem("Poslední připojení agenta",printDateTime(new Date(e.lastconnect)))),e.lastaddr&&(2<(i=e.lastaddr.split(":")).length?r+=addDetailItem("Poslední adresa agenta",e.lastaddr):isPrivateIP(e.lastaddr)?r+=addDetailItem("Poslední adresa agenta",i[0]):r+=addDetailItem("Poslední adresa agenta",'<a href="https://iplocation.com/?ip='+i[0]+'" rel="noreferrer noopener" target="MeshIPLoopup">'+i[0]+"</a>")),null!=t.agentvers&&t.agentvers.compileTime&&(i=Date.parse(t.agentvers.compileTime),r+=addDetailItem("Čas kompilace",isNaN(i)?t.agentvers.compileTime:printDateTime(new Date(i)))),""!=r)&&a.push({name:"Mesh Agent",html:r,img:"meshagent64.png"}),t.mobile&&(r="",t.mobile.brand&&t.mobile.model&&(r+=addDetailItem("Modelka",EscapeHtml(t.mobile.brand+", "+t.mobile.model),s)),t.mobile.device&&(r+=addDetailItem("Zařízení",EscapeHtml(t.mobile.device),s)),t.mobile.bootloader&&(r+=addDetailItem("Zavaděč",EscapeHtml(t.mobile.bootloader),s)),t.mobile.id&&(r+=addDetailItem("Identifikátor",EscapeHtml(t.mobile.id),s)),t.mobile.host&&(r+=addDetailItem("Název stroje",EscapeHtml(t.mobile.host),s)),t.mobile.androidapi&&t.mobile.androidrelease&&(r+=addDetailItem("Android Version",EscapeHtml(t.mobile.androidrelease+", API Level "+t.mobile.androidapi),s)),""!=r)&&a.push({name:"Mobilní zařízení",html:r,img:"mobile64.png"}),null!=n.netif){var l={};for(h in n.netif)"string"==typeof(d=n.netif[h]).mac&&(null==l[d.mac]?(l[d.mac]=d,l[d.mac].ipv4layer=[{v4addr:d.v4addr,v4mask:d.v4mask,v4gateway:d.v4gateway}]):l[d.mac].ipv4layer.push({v4addr:d.v4addr,v4mask:d.v4mask,v4gateway:d.v4gateway}));var r="";for(h in r+="<table style=width:100%>",l){var d=l[h];for(p in r=(r+="<tr><td><div class=style10 style=border-radius:5px;padding:8px>")+("<div style=margin-bottom:3px><b>"+EscapeHtml(d.name+(d.dnssuffix?", "+d.dnssuffix:""))+"</b></div>"),d.desc&&(r+=addDetailItem("Popis",EscapeHtml(d.desc).split("(R)").join("&reg;"))),d.mac&&(d.gatewaymac?r+=addDetailItem("Vrstva MAC",format("MAC: {0}, Gateway: {1}",EscapeHtml(d.mac),EscapeHtml(d.gatewaymac))):d.mac&&(r+=addDetailItem("Vrstva MAC",format("MAC: {0}",EscapeHtml(d.mac))))),d.ipv4layer){var u=d.ipv4layer[p];u.v4gateway&&u.v4mask?r+=addDetailItem("Vrstva IPv4",format("IP: {0}, Maska: {1}, Brána: {2}",EscapeHtml(u.v4addr),EscapeHtml(u.v4mask),EscapeHtml(u.v4gateway))):u.v4addr&&(r+=addDetailItem("Vrstva IPv4",format("IP: {0}",EscapeHtml(u.v4addr))))}r+="</div></td></tr>"}""!=(r+="</table>")&&a.push({name:"Sítě",html:r,img:"networking64.png"})}if(null!=n.netif2){var r="";for(h in r+="<table style=width:100%>",n.netif2){d=n.netif2[h];if(!(0==Array.isArray(d)||d.length<1||null==d[0]||"string"==typeof d[0].mac&&d[0].mac.startsWith("00:00:00:00"))){r+="<tr><td><div class=style10 style=border-radius:5px;padding:8px>";var c="";null!=h&&(c+=h),null!=d[0].fqdn&&""!=d[0].fqdn&&(c+=", "+d[0].fqdn),0<c.length&&(r+="<div style=margin-bottom:3px><b>"+EscapeHtml(c)+"</b></div>"),d.desc&&(r+=addDetailItem("Popis",EscapeHtml(d.desc).split("(R)").join("&reg;"))),"string"==typeof d[0].mac&&(d[0].gatewaymac?r+=addDetailItem("Vrstva MAC",format("MAC: {0}, Gateway: {1}",EscapeHtml(d[0].mac),EscapeHtml(d[0].gatewaymac))):r+=addDetailItem("Vrstva MAC",format("MAC: {0}",EscapeHtml(d[0].mac))));for(var p=0;p<d.length;p++){var m=d[p],v=[];m.address&&v.push(format("IP: {0}",EscapeHtml(m.address))),m.netmask&&v.push(format("Maska: {0}",EscapeHtml(m.netmask))),m.gateway&&v.push(format("Brána: {0}",EscapeHtml(m.gateway))),0<v.length&&("IPv4"==m.family&&(r+=addDetailItem("Vrstva IPv4",v.join(", "))),"IPv6"==m.family)&&(r+=addDetailItem("Vrstva IPv6",v.join(", ")))}r+="</div></td></tr>"}}t.network&&t.network.dns&&(r=(r+="<tr><td><div class=style10 style=border-radius:5px;padding:8px>")+addDetailItem("<b>DNS Servers</b>",t.network.dns.join(", "))+"</div></td></tr>"),""!=(r+="</table>")&&a.push({name:"Sítě",html:r,img:"networking64.png"})}if(null!=e.intelamt&&(r="",r+=addDetailItem("Verze",e.intelamt.ver?"v"+EscapeHtml(e.intelamt.ver):"<i>Neznámé</i>",s),i=t.identifiers&&t.identifiers.product_uuid,r+=addDetailItem("Identifikátor",e.intelamt.uuid?EscapeHtml(e.intelamt.uuid):i?EscapeHtml(i):"<i>Neznámé</i>",s),i={0:nobreak("Neaktivováno"),1:nobreak("Předaktivace"),2:nobreak("Zapnuto")},o="",2==e.intelamt.state&&e.intelamt.flags&&(2&e.intelamt.flags?o=", Client Control Mode (CCM)":4&e.intelamt.flags&&(o=", Admin Control Mode (ACM)")),""!=(r=(r=(r+=addDetailItem("Poskytující stát",(e.intelamt.state?i[e.intelamt.state]:"<i>Neznámé</i>")+o,s))+addDetailItem("Zabezpečení",1==e.intelamt.tls?"Zabezpečeno pomocí TLS":"TLS není nastaven",s))+addDetailItem("Pověření správce",null==e.intelamt.user||""==e.intelamt.user||null!=e.intelamt.warn&&0!=(9&e.intelamt.warn)?"Neznámý":"Známý",s)))&&("number"==typeof e.intelamt.sku&&0!=(16&e.intelamt.sku)?a.push({name:"Intel&reg; Standard Manageability (Intel&reg; SM)",html:r,img:"amt64.png"}):a.push({name:"Intel&reg; Active Management Technology (Intel&reg; AMT)",html:r,img:"amt64.png"})),t.identifiers){var r="",g=t.identifiers;if(g.bios_vendor&&(r+=addDetailItem("Výrobce",EscapeHtml(g.bios_vendor),s)),g.bios_version&&(r+=addDetailItem("Verze",EscapeHtml(g.bios_version),s)),g.bios_serial&&(r+=addDetailItem("Sériové číslo",EscapeHtml(g.bios_serial),s)),g.bios_mode&&(r+=addDetailItem("Mode",EscapeHtml(g.bios_mode),s)),""!=r&&a.push({name:"BIOS",html:r,img:"chip64.png"}),r="",g.board_vendor&&(r+=addDetailItem("Výrobce",EscapeHtml(g.board_vendor),s)),g.board_name&&(r+=addDetailItem("Název",EscapeHtml(g.board_name),s)),g.board_serial&&""!=g.board_serial&&(r+=addDetailItem("Sériové číslo",EscapeHtml(g.board_serial),s)),g.board_version&&(r+=addDetailItem("Verze",EscapeHtml(g.board_version),s)),g.product_uuid&&(r+=addDetailItem("Identifikátor",EscapeHtml(g.product_uuid),s)),g.cpu_name&&(r+=addDetailItem("Procesor",EscapeHtml(g.cpu_name).split("(TM)").join("&trade;").split("(R)").join("&reg;"),s)),g.gpu_name)for(var h in g.gpu_name)r+=addDetailItem("GPU",EscapeHtml(g.gpu_name[h]).split("(TM)").join("&trade;").split("(R)").join("&reg;"),s);""!=r&&a.push({name:"Základní deska",html:r,img:"motherboard64.png"})}if(t.tpm&&(r="",(i=t.tpm).SpecVersion&&(r+=addDetailItem("SpecVersion",parseFloat(EscapeHtml(i.SpecVersion)).toFixed(1),s)),i.ManufacturerId&&(r+=addDetailItem("ManufacturerId",EscapeHtml(i.ManufacturerId),s)),i.ManufacturerVersion&&(r+=addDetailItem("ManufacturerVersion",EscapeHtml(i.ManufacturerVersion),s)),null!=i.IsActivated&&(r+=addDetailItem("IsActivated",i.IsActivated?"Yes":"No",s)),null!=i.IsEnabled&&(r+=addDetailItem("IsEnabled",i.IsEnabled?"Yes":"No",s)),null!=i.IsOwned&&(r+=addDetailItem("IsOwned",i.IsOwned?"Yes":"No",s)),""!=r)&&a.push({name:"TPM",html:r,img:"tpm64.png"}),t.windows&&t.windows.memory&&0<t.windows.memory.length){r="";for(h in t.windows.memory.sort(function(e,t){return e.BankLabel>t.BankLabel?1:e.BankLabel<t.BankLabel?-1:0}),r+="<table style=width:100%>",t.windows.memory){d=t.windows.memory[h];r=(r+="<tr><td><div class=style10 style=border-radius:5px;padding:8px>")+("<div style=margin-bottom:3px><b>"+EscapeHtml(d.BankLabel||d.DeviceLocator||"Unknown")+"</b></div>"),d.Capacity&&d.Speed?r+=addDetailItem("Kapacita / Rychlost",format("{0} Mb, {1} Mhz",d.Capacity/1024/1024,d.Speed),s):d.Capacity&&(r+=addDetailItem("Kapacita",format("{0} Mb",d.Capacity/1024/1024),s)),d.PartNumber&&(r+=addDetailItem("Číslo dílu",EscapeHtml(d.Manufacturer&&"Undefined"!=d.Manufacturer?d.Manufacturer+", ":"")+EscapeHtml(d.PartNumber),s)),r+="</div>"}""!=(r+="</table>")&&a.push({name:"Operační paměť",html:r,img:"ram64.png"})}if(t.linux&&t.linux.memory&&0<t.linux.memory.Memory_Device.length){r="";for(h in t.linux.memory.Memory_Device.sort(function(e,t){return e.Locator>t.Locator?1:e.Locator<t.Locator?-1:0}),r+="<table style=width:100%>",t.linux.memory.Memory_Device)(d=t.linux.memory.Memory_Device[h]).Size&&"No Module Installed"==d.Size||(r=(r+="<tr><td><div class=style10 style=border-radius:5px;padding:8px>")+"<div style=margin-bottom:3px><b>"+EscapeHtml(d.Locator||"Unknown")+"</b></div>",d.Size&&d.Speed?r+=addDetailItem("Kapacita / Rychlost",format("{0}, {1}",d.Size,d.Speed),s):d.Size&&(r+=addDetailItem("Kapacita",format("{0}",d.Size),s)),d.PartNumber&&(r+=addDetailItem("Číslo dílu",EscapeHtml(d.Manufacturer&&"Undefined"!=d.Manufacturer?d.Manufacturer+", ":"")+EscapeHtml(d.PartNumber),s)),r+="</div>");""!=(r+="</table>")&&a.push({name:"Operační paměť",html:r,img:"ram64.png"})}if(t.darwin&&t.darwin.memory&&0<t.darwin.memory.length){r="";for(h in r+="<table style=width:100%>",t.darwin.memory)(d=t.darwin.memory[h]).Size&&"No Module Installed"==d.Size||(r=(r+="<tr><td><div class=style10 style=border-radius:5px;padding:8px>")+"<div style=margin-bottom:3px><b>"+EscapeHtml(d.DeviceLocator||"Unknown")+"</b></div>",d.Size&&d.Speed?r+=addDetailItem("Kapacita / Rychlost",format("{0}, {1}",d.Size,d.Speed),s):d.Size&&(r+=addDetailItem("Kapacita",format("{0}",d.Size),s)),d.PartNumber&&(r+=addDetailItem("Číslo dílu",EscapeHtml(d.Manufacturer&&""!=d.Manufacturer?d.Manufacturer+", ":"")+EscapeHtml(d.PartNumber),s)),r+="</div>");""!=(r+="</table>")&&a.push({name:"Operační paměť",html:r,img:"ram64.png"})}if(t.identifiers&&t.identifiers.storage_devices){var f,r="";for(h in g.storage_devices.sort(function(e,t){return e.Caption>t.Caption?1:e.Caption<t.Caption?-1:0}),r+="<table style=width:100%>",g.storage_devices)(d=g.storage_devices[h]).Size&&(r=(r+="<tr><td><div class=style10 style=border-radius:5px;padding:8px>")+"<div style=margin-bottom:3px><b>"+EscapeHtml(d.Caption)+"</b></div>",d.Model&&d.Model!=d.Caption&&(r+=addDetailItem("Modelka",EscapeHtml(d.Model),s)),d.Size&&("string"==typeof d.Size&&parseInt(d.Size)==d.Size&&(d.Size=parseInt(d.Size)),"number"==typeof d.Size&&(r+=addDetailItem("Kapacita",format("{0} Mb",Math.floor(d.Size/1024/1024)),s)),"string"==typeof d.Size)&&(r+=addDetailItem("Kapacita",EscapeHtml(d.Size),s)),t.windows&&t.windows.drives&&d.Model&&(f=t.windows.drives.find(e=>e.Model===d.Model))&&f.Status&&(r+=addDetailItem("Stav",EscapeHtml(f.Status),s)),r+="</div>");""!=(r+="</table>")&&a.push({name:"Úložiště",html:r,img:"storage64.png"})}if(t.windows&&t.windows.volumes){var k,r="";for(h in t.windows.volumes)r=(r+="<tr><td><div class=style10 style=border-radius:5px;padding:8px>")+("<div style=margin-bottom:3px><b>"+h+":"+(null==(d=t.windows.volumes[h]).name||""==d.name?"":" - "+EscapeHtml(d.name))+"</b></div>"),d.size&&(y=["Bytes","KB","MB","GB","TB"],x=0===(p=parseInt(Math.floor(Math.log(Math.abs(d.size))/Math.log(1024)),10))?d.size+" "+y[p]:(d.size/1024**p).toFixed(2)+" "+y[p],r+=addDetailItem("Kapacita",EscapeHtml(x),s)),d.sizeremaining&&(y=["Bytes","KB","MB","GB","TB"],x=0===(p=parseInt(Math.floor(Math.log(Math.abs(d.sizeremaining))/Math.log(1024)),10))?d.sizeremaining+" "+y[p]:(d.sizeremaining/1024**p).toFixed(2)+" "+y[p],r+=addDetailItem("Capacity Remaining",EscapeHtml(x),s)),d.type&&(r+=addDetailItem("File System",(""!=(b=1==d.removable?"Removable":1==d.cdrom?"CD-ROM":"")?b+" / ":"")+("Unknown"==d.type?"Neznámé":EscapeHtml(d.type)),s)),(d.protectionStatus||d.volumeStatus)&&(k=[],d.protectionStatus&&k.push("Povoleno"),d.volumeStatus&&"FullyDecrypted"==d.volumeStatus&&k.push("Fully Decrypted"),d.volumeStatus&&"EncryptionInProgress"==d.volumeStatus&&k.push("Encryption In Progress"),d.volumeStatus&&"FullyEncrypted"==d.volumeStatus&&k.push("Fully Encrypted"),k=k.join(" - "),d.recoveryPassword&&(k+=addKeyLink("",'deviceDetailsShowBitlockerInfo("'+encodeURIComponentEx(h)+'","'+encodeURIComponentEx(d.identifier)+'","'+encodeURIComponentEx(d.recoveryPassword)+'")')),r+=addDetailItem("BitLocker",k,s)),r+="</div>";""!=r&&a.push({name:"Storage Volumes",html:"<table style=width:100%>"+r+"</table>",img:"storage64.png"})}if(t.linux&&t.linux.volumes){var y,x,r="";for(h in t.linux.volumes)(d=t.linux.volumes[h]).mount_point.startsWith("/var/lib/docker/overlay2")||(r=(r+="<tr><td><div class=style10 style=border-radius:5px;padding:8px>")+"<div style=margin-bottom:3px><b>"+d.mount_point+"</b></div>",d.size&&(y=["KB","MB","GB","TB"],x=0===(p=parseInt(Math.floor(Math.log(Math.abs(d.size))/Math.log(1024)),10))?d.size+" "+y[p]:(d.size/1024**p).toFixed(2)+" "+y[p],r+=addDetailItem("Kapacita",EscapeHtml(x),s)),d.available&&(x=0==Math.abs(d.available)?"0 KB":(y=["KB","MB","GB","TB"],0===(p=parseInt(Math.floor(Math.log(Math.abs(d.available))/Math.log(1024)),10))?d.available+" "+y[p]:(d.available/1024**p).toFixed(2)+" "+y[p]),r+=addDetailItem("Capacity Remaining",EscapeHtml(x),s)),d.type&&(r+=addDetailItem("File System",(""!=(b=1==d.removable?"Removable":1==d.cdrom?"CD-ROM":"")?b+" / ":"")+("Unknown"==d.type?"Neznámé":EscapeHtml(d.type)),s)),r+="</div>");""!=r&&a.push({name:"Storage Volumes",html:"<table style=width:100%>"+r+"</table>",img:"storage64.png"})}if(t.darwin&&t.darwin.volumes){var b,r="";for(h in t.darwin.volumes)(d=t.darwin.volumes[h]).mount_point.startsWith("/var/lib/docker/overlay2")||(r=(r+="<tr><td><div class=style10 style=border-radius:5px;padding:8px>")+"<div style=margin-bottom:3px><b>"+d.mount_point+"</b></div>",d.size&&(r+=addDetailItem("Kapacita",EscapeHtml(d.size),s)),d.available&&(r+=addDetailItem("Capacity Remaining",EscapeHtml(d.available),s)),d.type&&(r+=addDetailItem("File System",(""!=(b=1==d.removable?"Removable":1==d.cdrom?"CD-ROM":"")?b+" / ":"")+("Unknown"==d.type?"Neznámé":EscapeHtml(d.type)),s)),r+="</div>");""!=r&&a.push({name:"Storage Volumes",html:"<table style=width:100%>"+r+"</table>",img:"storage64.png"})}r="";for(h in a)null==a[h].img?r+="<div class=DevSt style=margin-bottom:3px;margin-left:16px><b>"+a[h].name+"</b></div><div style=margin-bottom:10px;margin-left:16px>"+a[h].html+"</div>":r=(r=(r+="<table style=width:100%><tr>")+"<td style=width:64px;vertical-align:top><img src=images/details/"+a[h].img+" border=0 width=64 /></td>")+"<td><div class=DevSt style=margin-bottom:3px;margin-left:16px><b>"+a[h].name+"</b></div><div style=margin-bottom:10px;margin-left:16px>"+a[h].html+"</div></td></tr></table>";""==r?QH("p17info2","Žádné informace o tomto zařízení."):QH("p17info2",r)}}function deviceDetailsShowBitlockerInfo(e,t,n){if(xxdialogMode)return!1;t="<div><p>Identifikátor</p><p style=user-select:text;font-weight:bold>"+(t?decodeURIComponent(t):"Neznámé")+"</p>";t+="<p>Recovery Password</p><p style=user-select:text;font-weight:bold>"+(n?decodeURIComponent(n):"Neznámé")+"</p></div>",setDialogMode(2,decodeURIComponent(e)+": BitLocker Information",1,null,t,"")}function agentConsoleHandleKeys(e){var t,n,o;return!(!e.ctrlKey&&!e.altKey)||(t=0,n=Q("p15consoleText"),e.key?13==e.keyCode&&0==consoleFocus?(p15consoleSend(e),t=1):8==e.keyCode&&0==consoleFocus?(o=n.value,n.value=o.substring(0,o.length-1),t=1):27==e.keyCode?(n.value="",t=1):38==e.keyCode||40==e.keyCode?(o=consoleHistory.indexOf(n.value),38==e.keyCode&&consoleHistory.length-1>o?n.value=consoleHistory[o+1]:40==e.keyCode&&0<o?n.value=consoleHistory[o-1]:40==e.keyCode&&0==o&&(n.value=""),t=1):1===e.key.length&&(insertTextAtCursor(n,e.key),t=1):0!=e.charCode&&0==consoleFocus&&(n.value=n.value+String.fromCharCode(e.charCode),t=1),0<t?haltEvent(e):void 0)}function insertTextAtCursor(e,t){var n,o;document.selection?(e.focus(),(sel=document.selection.createRange()).text=t):e.selectionStart||"0"==e.selectionStart?(n=e.selectionStart,o=e.selectionEnd,e.value=e.value.substring(0,n)+t+e.value.substring(o,e.value.length),e.setSelectionRange(o+1,o+1)):e.value+=myValue}var consoleServerText="";function setupConsole(){var e,t;115==xxcurrentView?(e="server"==consoleNode,consoleNode="server",QH("p15deviceName","Konzole mého serveru"),QE("p15consoleText",!0),QH("p15statetext",""),QH("p15coreName",""),QV("p15outputselecttd",!1),0==e&&(QH("p15agentConsoleText",consoleServerText),Q("p15agentConsoleText").scrollTop=Q("p15agentConsoleText").scrollHeight)):(e=consoleNode==currentNode,meshes[(consoleNode=currentNode).meshid],0!=(16&GetNodeRights(currentNode))?(null==consoleNode.consoleText&&(consoleNode.consoleText=""),0==e&&(QH("p15agentConsoleText",consoleNode.consoleText),Q("p15agentConsoleText").scrollTop=Q("p15agentConsoleText").scrollHeight),0==(1&consoleNode.conn)&&consoleNode.conn,e=0!=(1&consoleNode.conn)?"Agent je online":"Agent je offline",0!=(16&consoleNode.conn)&&(e+=", MQTT je online"),QH("p15statetext",e),QE("p15uploadCore",0!=(1&consoleNode.conn)),QV("p15outputselecttd",0!=(16&consoleNode.conn)||1==currentNode.pmt&&0!=(4&features2)),QV("p15outputselect2",0!=(16&consoleNode.conn)),QV("p15outputselect3",1==currentNode.pmt&&0!=(4&features2)),e=Q("p15outputselect").value,0==(16&consoleNode.conn)&&2==e&&(e=1,Q("p15outputselect").value=1),1==currentNode.pmt&&0!=(4&features2)||3!=e||(e=1,Q("p15outputselect").value=1),t=!1,0!=(1&consoleNode.conn)&&1==e&&(t=!0),0!=(16&consoleNode.conn)&&2==e&&(t=!0),1==currentNode.pmt&&0!=(4&features2)&&3==e&&(t=!0),QE("p15consoleText",t)):(QH("p15statetext","Přístup odepřen"),QE("p15consoleText",!1),QE("p15uploadCore",!1),QV("p15outputselecttd",!1)),QV("devListToolbarViewIcons3",0!=(1&consoleNode.conn)))}function p15consoleClear(){QH("p15agentConsoleText",""),Q("id_p15consoleClear").blur(),115==xxcurrentView?consoleServerText="":consoleNode.consoleText=""}var consoleHistory=[];function p15consoleSend(e){var t;e&&13!=e.keyCode||(e=Q("p15consoleText").value,t="<div style=color:green>&gt; "+EscapeHtml(e)+"<br/></div>",115==xxcurrentView?(consoleServerText+=t,meshserver.send({action:"serverconsole",value:e})):0!=(16&consoleNode.conn)&&2==Q("p15outputselect").value?(t="<div style=color:orange>MQTT&gt; "+EscapeHtml(e)+"<br/></div>",consoleNode.consoleText+=t,meshserver.send({action:"sendmqttmsg",topic:"console",nodeids:[consoleNode._id],msg:e})):1==consoleNode.pmt&&3==Q("p15outputselect").value&&0!=(4&features2)?(t="<div style=color:violet>TAM&gt; "+EscapeHtml(e)+"<br/></div>",consoleNode.consoleText+=t,meshserver.send({action:"pushconsole",nodeid:consoleNode._id,console:e})):0!=(1&consoleNode.conn)&&(consoleNode.consoleText+=t,meshserver.send({action:"msg",type:"console",nodeid:consoleNode._id,value:e})),Q("p15agentConsoleText").innerHTML+=t,Q("p15agentConsoleText").scrollTop=Q("p15agentConsoleText").scrollHeight,Q("p15consoleText").value="",0<e.length&&(0<=(t=consoleHistory.indexOf(e))&&consoleHistory.splice(t,1),consoleHistory.unshift(e),consoleHistory.splice(10)))}function p15consoleReceive(e,t,n){"serverconsole"===e?(t="<div>"+EscapeHtml(t)+"</div>",consoleServerText+=t,"server"==consoleNode&&(Q("p15agentConsoleText").innerHTML+=t,Q("p15agentConsoleText").scrollTop=Q("p15agentConsoleText").scrollHeight)):(t="MQTT"==n?"<div style=color:red>MQTT&gt; "+EscapeHtml(t)+"<br/></div>":"<div>"+EscapeHtml(t)+"</div>",null==e.consoleText?e.consoleText=t:e.consoleText+=t,consoleNode==e&&(Q("p15agentConsoleText").innerHTML+=t,Q("p15agentConsoleText").scrollTop=Q("p15agentConsoleText").scrollHeight))}function p15downloadConsoleText(){saveAs(new Blob([Q("p15agentConsoleText").innerText],{type:"application/octet-stream"}),"console.txt")}function p15uploadCore(e){xxdialogMode||(1==e.shiftKey?meshserver.send({action:"uploadagentcore",nodeids:[consoleNode._id],type:"default"}):1==e.altKey?meshserver.send({action:"uploadagentcore",nodeids:[consoleNode._id],type:"clear"}):1==e.ctrlKey?p15uploadCore2():setDialogMode(2,"Provést akci agenta",3,p15uploadCoreEx,addHtmlValue("Akce","<select id=d3coreMode style=width:230px><option value=1>Nahrát výchozí jádro serveru</option><option value=2>Vymazat jádro</option><option value=6>Nahrát jádro pro obnovu</option><option value=7>Nahrajte malé jádro</option><option value=3>Nahrát hlavní soubor</option><option value=4>Jemné odpojení agenta</option><option value=5>Vynutit odpojení agenta</option><option value=8>Restart agent service</select>")))}function p15uploadCoreEx(){1==Q("d3coreMode").value?meshserver.send({action:"uploadagentcore",nodeids:[consoleNode._id],type:"default"}):2==Q("d3coreMode").value?meshserver.send({action:"uploadagentcore",nodeids:[consoleNode._id],type:"clear"}):3==Q("d3coreMode").value?p15uploadCore2():4==Q("d3coreMode").value?meshserver.send({action:"agentdisconnect",nodeid:consoleNode._id,disconnectMode:1}):5==Q("d3coreMode").value?meshserver.send({action:"agentdisconnect",nodeid:consoleNode._id,disconnectMode:2}):6==Q("d3coreMode").value?meshserver.send({action:"uploadagentcore",nodeids:[consoleNode._id],type:"recovery"}):7==Q("d3coreMode").value?meshserver.send({action:"uploadagentcore",nodeids:[consoleNode._id],type:"tiny"}):8==Q("d3coreMode").value&&meshserver.send({action:"msg",type:"console",nodeid:consoleNode._id,value:"service restart"})}function p15uploadCore2(){xxdialogMode||(Q("d3localmodeform").action="uploadmeshcorefile.ashx",Q("d3auth").value=authCookie,Q("d3filter").value=".js",Q("d3attrib").value=currentNode._id,setDialogMode(3,"Nahrát jádro agenta",3,p15uploadCoreEx2),d3init())}function p15uploadCoreEx2(){var e;1==Q("d3uploadMode").value?Q("d3submit").click():1==(e=d3getFileSel()).length&&meshserver.send({action:"uploadagentcore",nodeids:[consoleNode._id],type:"custom",path:d3filetreelocation.join("/")+"/"+e[0]})}function account_viewPreviousLogins(){xxdialogMode||(setDialogMode(2,"Předchozí přihlášení",1,null,"Načítání…","previousLogins"),meshserver.send({action:"previousLogins"}))}function account_manageImage(e){var t,n,o,i;xxdialogMode||(setDialogMode(2,"Spravovat obrázek účtu",7,account_manageImageEx2,'<input id=p2file type=file style=width:100% accept="image/*" onchange=account_manageImageEx()><div style=width:100%><canvas id=p2canvas width=256 height=256 style="width:256px;height:256px;margin-left:60px;margin-top:8px;border-radius:16px;box-shadow: 0px 0px 15px #000" onclick=account_canvasClick() /></div>',(t=0==e?userinfo:currentUser)._id),n=Q("p2canvas").getContext("2d"),null==t.accountImageRnd&&(t.accountImageRnd=Math.floor(9999999999*Math.random())),o="",1==e&&(o="&id="+t._id.split("/")[2]),(i=new Image).onload=function(){n.clearRect(0,0,256,256),n.drawImage(i,0,0)},i.src=null!=t.flags&&1&t.flags?"userimage.ashx?rnd="+t.accountImageRnd+o:"images/user-256.png",QE("idx_dlgDeleteButton",null!=t.flags&&1&t.flags),QE("idx_dlgOkButton",!1))}function account_canvasClick(){Q("p2file").click()}function account_manageImageEx(){var e=Q("p2file").files[0],i=new Image;i.onload=function(){var e=0,t=0,n=Math.min(i.width,i.height),o=(i.width>n&&(e=(i.width-n)/2),i.height>n&&(t=(i.height-n)/2),Q("p2canvas").getContext("2d"));o.imageSmoothingEnabled=!0,o.webkitImageSmoothingEnabled=!0,o.mozImageSmoothingEnabled=!0,o.clearRect(0,0,256,256),o.drawImage(i,e,t,n,n,0,0,256,256),QE("idx_dlgOkButton",!0)},i.src=URL.createObjectURL(e)}function account_manageImageEx2(e,t){meshserver.send({action:"updateUserImage",userid:t,image:2==e?0:Q("p2canvas").toDataURL(Q("p2file").files[0].type)})}function account_managePhone(){xxdialogMode||0==(33554432&features)||(null!=userinfo.phone?(setDialogMode(2,"Telefonní oznámení",3,account_managePhoneRemove,'<table style=width:100%><tr><td style=width:56px><img src="images/phone80.png" style=padding:8px>'+("<td style=text-align:center><div style=padding:6px>Ověřené telefonní číslo</div><div style=font-size:20px>"+EscapeHtml(userinfo.phone)+"</div>")+"<div style=margin:10px><label><input id=d2delPhone type=checkbox onclick=account_managePhoneRemoveValidate() />Odeberte telefonní číslo</label></div>"),account_managePhoneRemoveValidate):(setDialogMode(2,"Telefonní oznámení",3,account_managePhoneAdd,'<table style=width:100%><tr><td style=width:56px><img src="images/phone80.png" style=padding:8px>'+"<td>Zadejte své telefonní číslo podporující SMS. Po ověření lze číslo použít pro ověření přihlášení a další oznámení."+'<br /><br /><div style=width:100%;text-align:center>Telefonní číslo: <input type=tel pattern="[0-9]" autocomplete="tel" inputmode="tel" maxlength=18 id=d2phoneinput onKeyUp=account_managePhoneValidate() onkeypress="if (event.key==\'Enter\') account_managePhoneValidate(1)"></div></table>',"verifyPhone"),Q("d2phoneinput").focus(),account_managePhoneValidate))()}function isPhoneNumber(e){var t=!0;e.startsWith("+")&&(e=e.substring(1));for(var n=0;n<e.length;n++){var o=e.charCodeAt(n);(o<48||57<o)&&32!=o&&45!=o&&46!=o&&(t=!1)}return t&&10<=e.length}function account_managePhoneValidate(e){var t=isPhoneNumber(Q("d2phoneinput").value);QE("idx_dlgOkButton",t),1==e&&t&&dialogclose(1)}function account_managePhoneCodeValidate(e){var t=6==Q("d2phoneCodeInput").value.length&&Q("d2phoneCodeInput").value.match(/[0-9]/);QE("idx_dlgOkButton",t),1==e&&t&&dialogclose(1)}function account_managePhoneConfirm(e,t){meshserver.send({action:"confirmPhone",code:Q("d2phoneCodeInput").value,cookie:t})}function account_managePhoneAdd(){0!=isPhoneNumber(Q("d2phoneinput").value)&&(QE("d2phoneinput",!1),meshserver.send({action:"verifyPhone",phone:Q("d2phoneinput").value}))}function account_managePhoneRemove(){Q("d2delPhone").checked&&meshserver.send({action:"removePhone"})}function account_managePhoneRemoveValidate(){QE("idx_dlgOkButton",Q("d2delPhone").checked)}function account_manageMessaging(){var e,t;xxdialogMode||0==(33554432&features2)||(null!=userinfo.msghandle?(setDialogMode(2,"Messaging Notifications",3,account_manageMessagingRemove,e=(e='<table style=width:100%><tr><td style=width:56px><img src="images/messaging40.png" style=padding:8px>')+("<td style=text-align:center><div style=padding:6px>Verified handle</div><div style=font-weight:bold>"+EscapeHtml(userinfo.msghandle)+"</div>")+"<div style=margin:10px><label><input id=d2delPhone type=checkbox onclick=account_managePhoneRemoveValidate() />Remove messaging</label></div>"),account_managePhoneRemoveValidate):(t="<select id=d2serviceselect style=width:160px;margin-left:8px onchange=account_manageMessagingValidate()>",0!=(1&serverinfo.userMsgProviders)&&(t+="<option value=1>Telegram</option>"),0!=(4&serverinfo.userMsgProviders)&&(t+="<option value=4>Discord</option>"),0!=(8&serverinfo.userMsgProviders)&&(t+="<option value=8>XMPP</option>"),0!=(16&serverinfo.userMsgProviders)&&(t+="<option value=16>CallMeBot</option>"),0!=(32&serverinfo.userMsgProviders)&&(t+="<option value=32>Pushover</option>"),0!=(64&serverinfo.userMsgProviders)&&(t+="<option value=64>ntfy</option>"),0!=(128&serverinfo.userMsgProviders)&&(t+="<option value=128>Zulip</option>"),0!=(256&serverinfo.userMsgProviders)&&(t+="<option value=256>Slack</option>"),e=(e='<table style=width:100%><tr><td style=width:56px;vertical-align:top><img src="images/messaging40.png" style=padding:8px>')+"<td>Enter your messaging service and handle. Once verified, this server can send you login verification and other notifications.<br /><br /><table><tr><td>Service<td>"+(t+="</select>")+"<tr><td>Handle<td><input maxlength=1024 style=width:160px;margin-left:8px id=d2handleinput onKeyUp=account_manageMessagingValidate() onkeypress=\"if (event.key=='Enter') account_manageMessagingValidate(1)\"></table>",serverinfo.discordUrl&&(e+="<div id=d2discordurl style=display:none><br /><a href="+serverinfo.discordUrl+' target="_discord">Join this Discord server to receive notifications.</a></div>'),e+='<div id=d2callmebotinfo style=display:none><br /><a href=https://www.callmebot.com/blog/free-api-signal-send-messages/ target="_callmebot">Signal</a>, <a href=https://www.callmebot.com/blog/free-api-whatsapp-messages/ target="_callmebot">Whatsapp</a>, <a href=https://www.callmebot.com/blog/free-api-facebook-messenger/ target="_callmebot">Facebook</a>, <a href=https://www.callmebot.com/blog/telegram-text-messages/ target="_callmebot">Telegram</a></div><div id=d2pushoverinfo style=display:none><br /><a href=https://pushover.net/ target="_pushover">Information at Pushover.net</a></div>',console.log(serverinfo.userMsgNftyUrl),setDialogMode(2,"Messaging Notifications",3,account_manageMessagingAdd,e=e+('<div id=d2ntfyinfo style=display:none><br /><a href="'+(serverinfo.userMsgNftyUrl||"https://ntfy.sh/")+'" target="_ntfy">Free service at ntfy.sh</a></div>')+'<div id=d2slackinfo style=display:none><br /><a href=https://api.slack.com/messaging/webhooks target="_slack">Slack Webhook Setup</a></div>',"verifyMessaging"),Q("d2handleinput").focus(),account_manageMessagingValidate))()}function account_manageMessagingValidate(e){serverinfo.discordUrl&&QV("d2discordurl",4==Q("d2serviceselect").value),QV("d2callmebotinfo",16==Q("d2serviceselect").value),QV("d2pushoverinfo",32==Q("d2serviceselect").value),QV("d2ntfyinfo",64==Q("d2serviceselect").value),QV("d2slackinfo",256==Q("d2serviceselect").value),4==Q("d2serviceselect").value?Q("d2handleinput").placeholder="Username:0000":8==Q("d2serviceselect").value?Q("d2handleinput").placeholder="username@server.com":16==Q("d2serviceselect").value?Q("d2handleinput").placeholder="https://api.callmebot.com/...":32==Q("d2serviceselect").value?Q("d2handleinput").placeholder="User key":64==Q("d2serviceselect").value?Q("d2handleinput").placeholder="Téma":128==Q("d2serviceselect").value?Q("d2handleinput").placeholder="username@sample.com":256==Q("d2serviceselect").value?Q("d2handleinput").placeholder="https://hooks.slack.com/...":Q("d2handleinput").placeholder="Uživatelské jméno";var t=0<Q("d2handleinput").value.length;QE("idx_dlgOkButton",t),1==e&&t&&dialogclose(1)}function account_manageMessagingAdd(){0!=Q("d2handleinput").value.length&&(QE("d2handleinput",!1),meshserver.send({action:"verifyMessaging",service:Q("d2serviceselect").value,handle:Q("d2handleinput").value}))}function account_manageMessagingConfirm(e,t){meshserver.send({action:"confirmMessaging",code:Q("d2phoneCodeInput").value,cookie:t})}function account_manageMessagingRemove(){Q("d2delPhone").checked&&meshserver.send({action:"removeMessaging"})}function account_manageAuthEmail(){var e;xxdialogMode||0==(8388608&features)||setDialogMode(2,"Ověřování e-mailem",1,function(){e!=Q("email2facheck").checked&&meshserver.send({action:"otpemail",enabled:Q("email2facheck").checked})},"Pokud je tato možnost povolena, při každém přihlášení budete mít možnost dostávat přihlašovací token na váš e-mailový účet pro zvýšení bezpečnosti.<br /><br /><label><input id=email2facheck type=checkbox "+((e=1==userinfo.otpekey&&null!=userinfo.email&&1==userinfo.emailVerified)?"checked":"")+"/>Povolit e-mailovou dvoufaktorovou autentizaci.</label>")}function account_manageAuthDuo(){xxdialogMode||0==(536870912&features2)||(0==(1==userinfo.otpduo)?setDialogMode(2,"Duo Authentication",3,function(){window.location.href="/add-duo?rurl="+encodeURIComponentEx(window.location.href)+(urlargs.key?"&key="+urlargs.key:"")},'Confirm enabling of Duo 2FA login security. Once enabled you will be given the option to use Duo at login for added security. Click ok to go thru the steps to enable Duo.<p style="text-align: center"><img src="images/duo-2fa-250.png"></p>'):(setDialogMode(2,"Duo Authentication",3,function(){meshserver.send({action:"otpduo",enabled:!1})},'<p><label><input id=duo2facheck type=checkbox onclick=account_manageAuthDuoConfirm() />Confirm disabling 2FA Duo login security.</label></p><p style="text-align: center"><img src="images/duo-2fa-250-disable.png"></p>'),QE("idx_dlgOkButton",!1)))}function account_manageAuthDuoConfirm(){QE("idx_dlgOkButton",Q("duo2facheck").checked)}function account_manageAuthApp(){if(!xxdialogMode&&0!=(4096&features))return(1==userinfo.otpsecret?account_removeOtp:account_addOtp)(),!1}function account_addOtp(){xxdialogMode||1==userinfo.otpsecret||0==(4096&features)||(setDialogMode(2,"Aplikace pro ověřování se",2,function(){meshserver.send({action:"otpauth-setup",secret:Q("d2optsecret").attributes.secret.value,token:Q("d2otpauthinput").value})},"<div id=d2optinfo>Načítání…</div>","otpauth-request"),meshserver.send({action:"otpauth-request"}))}function account_addOtpCheck(e){var t=6==Q("d2otpauthinput").value.length;QE("idx_dlgOkButton",t),e&&13==e.keyCode&&t&&dialogclose(1)}function account_removeOtp(){xxdialogMode||1!=userinfo.otpsecret||0==(4096&features)||setDialogMode(2,"Aplikace pro ověřování se",3,function(){meshserver.send({action:"otpauth-clear"})},"Potvrdit odstranění aplikace pro 2-faktorové ověřování se?")}function account_manageOtp(e){return 2==xxdialogMode&&"otpauth-manage"==xxdialogTag&&dialogclose(0),xxdialogMode||0==(4096&features)||0<count2factoraAuths()&&meshserver.send({action:"otpauth-getpasswords",subaction:e}),!1}function account_managePushAuthDev(){if(!xxdialogMode&&0!=(64&features2)){if(1==userinfo.otpdev)setDialogMode(2,"Ověřovací zařízení",3,function(){meshserver.send({action:"otpdev-clear"})},"Potvrdit odebrání zařízení pro autentizaci push?");else{var e=[];for(n in nodes){var t=nodes[n];null!=t.agent&&14==t.agent.id&&1==t.pmt&&4294967295==GetNodeRights(t)&&e.push(t)}if(0==e.length)setDialogMode(2,"Ověřovací zařízení",1,null,"Aby bylo možné používat ověřování push notifikací, musí být ve vašem účtu nastaveno mobilní zařízení s plnými právy.");else{var n,o="Vyberte zařízení, které chcete zaregistrovat pro ověřování push notifikací. Po výběru zařízení vyzve k potvrzení.<br /><br />",i="<select id=d2devselect style=width:240px>";for(n in e)i+='<option value="'+e[n]._id+'">'+EscapeHtml(e[n].name)+"</option>";setDialogMode(2,"Ověřovací zařízení",3,function(){meshserver.send({action:"otpdev-set",nodeid:Q("d2devselect").value})},o+=addHtmlValue("Zařízení",i+="</select>"))}}return!1}}function account_manageHardwareOtp(){return 2==xxdialogMode&&"otpauth-hardware-manage"==xxdialogTag&&dialogclose(0),xxdialogMode||0==(4096&features)||meshserver.send({action:"otp-hkey-get"}),!1}function account_addhkey(e){var t;3==e?(t="Zadejte název klíče, který přidat.<br /><br />",t+=addHtmlValue("Název klíče",'<input id=dp1keyname style=width:230px maxlength=20 autocomplete=off placeholder="MyKey" onkeyup=account_addhkeyValidate(event,2) />')):2==e&&(t="Zadejte název klíče, vyberte kolonku OTP a stiskněte tlačítko na YubiKey&trade;.<br /><br />",t=(t+=addHtmlValue("Název klíče",'<input id=dp1keyname style=width:230px maxlength=20 autocomplete=off placeholder="MyKey" onkeyup=account_addhkeyValidate(event,1) />'))+addHtmlValue("YubiKey&trade; OTP","<input id=dp1key style=width:230px autocomplete=off onkeyup=account_addhkeyValidate(event,2) />")),setDialogMode(2,"Přidat bezpečnostní klíč",3,account_addhkeyEx,t,e),Q("dp1keyname").focus()}function account_addhkeyValidate(e,t){null!=e&&13==e.keyCode&&(2==t?dialogclose(1):Q("dp1key").focus())}function account_addhkeyEx(e,t){var n=Q("dp1keyname").value;""==n&&(n="MyKey"),2==t?(meshserver.send({action:"otp-hkey-yubikey-add",name:n,otp:Q("dp1key").value}),setDialogMode(2,"Přidat bezpečnostní klíč",0,null,"<br />Kontrola…<br /><br /><br />","otpauth-hardware-manage")):3==t&&meshserver.send({action:"webauthn-startregister",name:n})}function account_removehkey(e){meshserver.send({action:"otp-hkey-remove",index:e}),meshserver.send({action:"otp-hkey-get"})}var currentMesh,filetreelinkpath,loclist={af:"afrikánština",sq:"albánština",ar:"arabština (standardní)","ar-dz":"arabština (Alžír)","ar-bh":"arabština (Bahrajn)","ar-eg":"arabština (Egypt)","ar-iq":"arabština (Irák)","ar-jo":"arabština (Jordánsko)","ar-kw":"arabština (Kuvajt)","ar-lb":"arabština (Libanon)","ar-ly":"arabština (Libye)","ar-ma":"arabština (Maroko)","ar-om":"arabština (Omán)","ar-qa":"arabština (Katar)","ar-sa":"arabština (Saudská Arábie)","ar-sy":"arabština (Sýrie)","ar-tn":"arabština (Tunisko)","ar-ae":"arabština (Spojené Emiráty)","ar-ye":"arabština (Jemen)",an:"aragonština",hy:"arménština",as:"asámština",ast:"asturština",az:"azerbájdžánština",eu:"baskičtina",bg:"bulharština",be:"běloruština",bn:"bengálština",bs:"bosenština",br:"bretonština",my:"barmština",ca:"katalánština",ch:"chamorro",ce:"čečenština",zh:"čínština","zh-hk":"čínština (Hong Kong)","zh-cn":"čínština (PRC)","zh-sg":"čínština (Singapur)","zh-tw":"čínština (Taiwan)",cv:"čuvaština",co:"korsičtina",cr:"kríjština",hr:"chorvatština",cs:"čeština",da:"dánština",nl:"nizozemština (standardní)","nl-be":"nizozemština (Belgie)",en:"angličtina","en-au":"angličtina (Austrálie)","en-bz":"angličtina (Belize)","en-ca":"angličtina (Kanada)","en-ie":"angličtina (Irsko)","en-jm":"angličtina (Jamajka)","en-nz":"angličtina (Nový Zéland)","en-ph":"angličtina (Filipíny)","en-za":"angličtina (Jihoafrická Republika)","en-tt":"angličtina (Trinidad a Tobago)","en-gb":"angličtina (Velká Británie)","en-us":"angličtina (Spojené státy americké)","en-zw":"angličtina (Zimbabwe)",eo:"esperanto",et:"estonština",fo:"faerština",fa:"Farsi (perština)",fj:"fidžijština",fi:"finština",fr:"francouzština (standardní)","fr-be":"francouzština (Belgie)","fr-ca":"francouzština (Kanada)","fr-fr":"francouzština (Francie)","fr-lu":"francouzština (Lucembursko)","fr-mc":"francouzština (Monako)","fr-ch":"francouzština (Švýcarsko)",fy:"fríština",fur:"furlanština",gd:"gaelština (skotská)","gd-ie":"gaelština (irská)",gl:"galicijština",ka:"gruzínština",de:"němčina (standardní)","de-at":"němčina (Rakousko)","de-de":"němčina (Německo)","de-li":"němčina (Lichtenštejnsko)","de-lu":"němčina (Lucembursko)","de-ch":"němčina (Švýcarsko)",el:"řečtina",gu:"gudžarátština",ht:"haitština",he:"hebrejština",hi:"hindština",hu:"maďarština",is:"islandština",id:"indonézština",iu:"inuktitutština",ga:"irština",it:"italština (standardní)","it-ch":"italština (Švýcarsko)",ja:"japonština",kn:"kannadština",ks:"kašmírština",kk:"kazaština",km:"khmerština",ky:"kyrgyzština",tlh:"klingonština",ko:"korejština","ko-kp":"korejština (Severní Korea)","ko-kr":"korejština (Jižní Korea)",la:"latina",lv:"lotyština",lt:"lotyština",lb:"lucemburština",mk:"FYRO makedonština",ms:"malajština",ml:"malajálamština",mt:"maltština",mi:"maorština",mr:"maráthština",mo:"moldavština",nv:"navažština",ng:"ndondština",ne:"nepálština",no:"norština",nb:"norština (bokmål)",nn:"norština (nynorsk)",oc:"okcitánština",or:"urijština",om:"oromština","fa-ir":"perština/Írán",pl:"polština",pt:"portugalština","pt-br":"portugalština (Brazílie)",pa:"paňdžábština","pa-in":"paňdžábština (Indie)","pa-pk":"paňdžábština (Pákistán)",qu:"kečuánština",rm:"rétorománština",ro:"rumunština","ro-mo":"rumunština (Moldavsko)",ru:"ruština","ru-mo":"ruština (Moldavsko)",sz:"sámština (Lulejská)",sg:"sanžština",sa:"sanskrt",sc:"sardinština",sd:"sindhština",si:"sinhálština",sr:"srbština",sk:"slovenština",sl:"slovinština",so:"Somani",sb:"lužická srbština",es:"španělština","es-ar":"španělština (Argentina)","es-bo":"španělština (Bolívie)","es-cl":"španělština (Chile)","es-co":"španělština (Kolumbie)","es-cr":"španělština (Kostarika)","es-do":"španělština (Dominikánská republika)","es-ec":"španělština (Ekvádor)","es-sv":"španělština (Salvador)","es-gt":"španělština (Guatemala)","es-hn":"španělština (Honduras)","es-mx":"španělština (Mexiko)","es-ni":"španělština (Nikaragua)","es-pa":"španělština (Panama)","es-py":"španělština (Paraguay)","es-pe":"španělština (Peru)","es-pr":"španělština (Portoriko)","es-es":"španělština (Španělsko)","es-uy":"španělština (Uruguay)","es-ve":"španělština (Venezuela)",sx:"Sutu",sw:"svahilština",sv:"švédština","sv-fi":"švédština (Finsko)","sv-sv":"švédština (Švédsko)",ta:"tamilština",tt:"tatarština",te:"telugština",th:"thajština",tig:"Tigre",ts:"Tsonga",tn:"setswanština",tr:"turečtina",tk:"turkmenština",uk:"ukrajinština",hsb:"hornolužická srbština",ur:"urdština",ve:"Venda",vi:"vietnamština",vo:"volapük",wa:"valonština",cy:"velština",xh:"xhoština",ji:"jidiš",zu:"zuluština"},loclistex={"zh-chs":"Zjednodušená čínština)","zh-cht":"Čínština (tradiční)"};function account_showLocalizationSettings(){if(!xxdialogMode){var e=getstore("loctag",0),t="",n='<select id=d2locselect style=width:240px><option value="*">Převzít z webového prohlížeče</option>';for(o in loclist)n+='<option value="'+o+'"'+(e==o?" selected":"")+">"+o+" - "+loclist[o]+"</option>";if(n+="</select>",serverinfo.languages&&0<serverinfo.languages.length){t+="Změna jazyka vyžaduje znovunačtení stránky.<br /><br />";var o,i='<select id=d2langselect style=width:240px><option value="*">Převzít z webového prohlížeče</option>';for(o in serverinfo.languages){var a=serverinfo.languages[o];i+='<option value="'+a+'"'+(userinfo.lang==a?" selected":"")+">"+a+" - "+(loclist[a]||loclistex[a])+"</option>"}t+=addHtmlValue("Jazyk",i+="</select>")}t+=addHtmlValue("Datum a čas",n),4294967295==userinfo.siteadmin&&""==domain&&(t+='<br /><a rel="noreferrer noopener" target="_blank" href="translator.htm">Pomozte MeshCentral přeložit do svého jazyka</a>'),setDialogMode(2,"Nastavení lokalizace",3,account_showLocalizationSettingsEx,t)}return!1}function account_showLocalizationSettingsEx(){var e=Q("d2langselect").value,e=((e="*"==e&&null==userinfo.lang?userinfo.lang:e)!=userinfo.lang&&meshserver.send({action:"changelang",lang:e}),getstore("loctag",0)),t=Q("d2locselect").value;e!=t&&("*"!=t?args.locale=t:delete args.locale,putstore("loctag",args.locale),mainUpdate(4294967295))}function account_enableNotifications(){return Notification&&Notification.requestPermission().then(function(e){QV("accountEnableNotificationsSpan","granted"!=e),setupServiceWorker()}),!1}function account_createLoginToken(){if(xxdialogMode)return!1;var e,t="",n="Vytvořte dočasné uživatelské jméno a heslo, které lze použít jako alternativní přihlašovací údaje k vašemu účtu. To je užitečné pro povolení přístupu nástrojů nebo jiných služeb k vašemu účtu.<br /><br />",o={0:"Neomezeno",1:"1 minuta",5:"5 minut",10:"10 minut",15:"15 minut",30:"30 minut",45:"45 minut",60:"60 minut",120:"2 hodiny",240:"4 hodiny",480:"8 hodin",720:"12 hodin",960:"16 hodin",1440:"24 hodin",2880:"2 dny",5760:"4 dny",10080:"7 dní"};for(e in o)t+="<option value="+e+">"+o[e]+"</option>";setDialogMode(2,"Vytvořit přihlašovací token",3,account_createLoginTokenEx,(n+=addHtmlValue("Název tokenu","<input class=boxsize id=d2tokenName style=width:250px maxlength=100 type=text onchange=account_createLoginTokenValidate() onkeyup=account_createLoginTokenValidate() />"))+addHtmlValue("Čas vypršení platnosti","<select class=boxsize id=d2tokenExpire style=width:250px>"+t+"</select>")),QE("idx_dlgOkButton",!1),Q("d2tokenName").focus()}function account_createLoginTokenValidate(){QE("idx_dlgOkButton",0<Q("d2tokenName").value.length)}function account_createLoginTokenEx(){meshserver.send({action:"createLoginToken",name:Q("d2tokenName").value,expire:parseInt(Q("d2tokenExpire").value)})}function account_showAccountNotifySettings(){var e;return xxdialogMode||(setDialogMode(2,"Nastavení upozornění",3,account_showAccountNotifySettingsEx,"<div><label><input id=p2notifyPlayNotifySound type=checkbox />Zvuk upozornění</label></div><div><label><input id=p2notifyGroupName type=checkbox />Zobrazit název skupiny zařízení</label></div><div><label><input id=p2notifyIntelDeviceConnect type=checkbox />Připojení zařízení</label></div><div><label><input id=p2notifyIntelDeviceDisconnect type=checkbox />Odpojení zařízení</label></div><div><label><input id=p2notifyIntelAmtKvmActions type=checkbox />Události Intel&reg; AMT desktop a serial</label></div>"),e=getstore("notifications",0),Q("p2notifyPlayNotifySound").checked=1&e,Q("p2notifyIntelDeviceConnect").checked=2&e,Q("p2notifyIntelDeviceDisconnect").checked=4&e,Q("p2notifyIntelAmtKvmActions").checked=8&e,Q("p2notifyGroupName").checked=16&e),!1}function account_showAccountNotifySettingsEx(){var e=0;putstore("notifications",(e+=Q("p2notifyPlayNotifySound").checked?1:0)+(Q("p2notifyIntelDeviceConnect").checked?2:0)+(Q("p2notifyIntelDeviceDisconnect").checked?4:0)+(Q("p2notifyIntelAmtKvmActions").checked?8:0)+(Q("p2notifyGroupName").checked?16:0))}function account_showVerifyEmail(){return xxdialogMode||1==userinfo.emailVerified||1!=serverinfo.emailcheck||setDialogMode(2,"Ověření e-mailu",3,account_showVerifyEmailEx,"Klikněte na OK a bude vám zaslán ověřovací e-mail na:<br /><div style=padding:8px><b>"+EscapeHtml(userinfo.email)+"</b></div>Počkejte pár minut než dojde k ověření."),!1}function account_showVerifyEmailEx(){meshserver.send({action:"verifyemail",email:userinfo.email})}function account_showChangeEmail(){var e;return xxdialogMode||(e="Svůj e-mail si změníte zde.<br /><br />",setDialogMode(2,"Změna e-mailové adresy",3,account_changeEmail,e+=addHtmlValue("Email","<input id=dp2email style=width:230px maxlength=256 onchange=account_validateEmail() onkeyup=account_validateEmail(event) />")),null!=userinfo.email&&(Q("dp2email").value=userinfo.email),account_validateEmail(),Q("dp2email").focus()),!1}function account_validateEmail(e,t){QE("idx_dlgOkButton",validateEmail(Q("dp2email").value)&&Q("dp2email").value!=userinfo.email),null!=e&&13==e.keyCode&&dialogclose(1)}function account_changeEmail(){meshserver.send({action:"changeemail",email:Q("dp2email").value})}function account_showDeleteAccount(){var e;return xxdialogMode||(e="Pokud chcete tento účet smazat, zadejte do obou kolonek heslo k účtu a stiskněte OK.<br /><br />",setDialogMode(2,"Smazat účet",0,null,e=(e=(e=(e+="<form method=post><input type=hidden name=action value=deleteaccount /><input type=hidden name=authcookie value="+authCookie+" /><table style=margin-left:80px><tr>")+"<td align=right>Heslo:</td><td><input id=apassword1 type=password name=apassword1 autocomplete=off onchange=account_validateDeleteAccount() onkeyup=account_validateDeleteAccount() /></td>"+"</tr><tr><td align=right>Heslo:</td><td><input id=apassword2 type=password name=apassword2 autocomplete=off onchange=account_validateDeleteAccount() onkeyup=account_validateDeleteAccount() /></td>")+"</tr></table><br /><div style=padding:10px;margin-bottom:4px>"+"<input id=account_dlgCancelButton type=button value=Cancel style=float:right;width:80px;margin-left:5px onclick=dialogclose(0)>")+'<input id=account_dlgOkButton type=submit value=OK style="float:right;width:80px" onclick=dialogclose(1)>'+"</div><br /></form>"),account_validateDeleteAccount(),Q("apassword1").focus()),!1}function account_showChangePassword(){if(!xxdialogMode){var e=(e=(e=(e=(e="Heslo ke svému účtu si změníte zadáním stávajícího hesla a pak nového (do obou kolonek) do níže uvedených kolonek.")+"<br /><br />"+"<table style=margin-left:60px>")+("<tr><td align=right>"+nobreak("Dosavadní heslo:")+"</td><td><input id=apassword0 type=password name=apassword0 autocomplete=off onchange=account_validateNewPassword() onkeyup=account_validateNewPassword() onkeydown=account_validateNewPassword() /> <b></b></td></tr>"))+("<tr><td align=right>"+nobreak("Nové heslo:")+"</td><td><input id=apassword1 type=password name=apassword1 autocomplete=off onchange=account_validateNewPassword() onkeyup=account_validateNewPassword() onkeydown=account_validateNewPassword() /> <b><span id=dxPassWarn></span></b></td></tr>"))+("<tr><td align=right>"+nobreak("Nové heslo:")+"</td><td><input id=apassword2 type=password name=apassword2 autocomplete=off onchange=account_validateNewPassword() onkeyup=account_validateNewPassword() onkeydown=account_validateNewPassword() /></td></tr>");if(65536&features&&(e+="<tr><td align=right>Nápověda k heslu:</td><td><input id=apasswordhint name=apasswordhint maxlength=250 type=text autocomplete=off onchange=account_validateNewPassword() onkeyup=account_validateNewPassword() onkeydown=account_validateNewPassword() /></td></tr>"),e+="</table>",passRequirements){var t,n=[],o=0;for(t in passRequirements)"reset"!=t&&"hint"!=t&&(n.push(t+":"+passRequirements[t]),o++);0<o&&(e+="<br /><span style=font-size:x-small>Požadavky: "+n.join(", ")+".</span>")}setDialogMode(2,"Změnit heslo",3,account_showChangePasswordEx,e+="<br />"),Q("apassword0").focus(),account_validateNewPassword()}return!1}function account_showChangePasswordEx(){var e;Q("apassword1").value==Q("apassword2").value&&(e={action:"changepassword",oldpass:Q("apassword0").value,newpass:Q("apassword1").value},65536&features&&(e.hint=Q("apasswordhint").value),meshserver.send(e))}function account_createMesh(){if(!xxdialogMode)if(4294967295!=userinfo.siteadmin&&0!=(64&userinfo.siteadmin))setDialogMode(2,"Nová skupina zařízení",1,null,"Tento účet nemá práva k vytvoření nové skupiny zařízení.");else if(!0!==userinfo.emailVerified&&1==serverinfo.emailcheck&&4294967295!=userinfo.siteadmin)setDialogMode(2,"Nastavení zabezpečení",1,null,'Dokud nebude ověřena e-mailová adresa, nelze k této funkci přistupovat. To je vyžadováno pro obnovení hesla. Chcete-li změnit a ověřit e-mailovou adresu, přejděte na kartu "Můj účet".');else if(262144&features&&0==count2factoraAuths())setDialogMode(2,"Nastavení zabezpečení",1,null,"Nelze získat přístup k této funkci, dokud není povoleno dvoufaktorové ověřování. To je nutné pro větší bezpečnost. Přejděte na kartu „Můj účet“ a podívejte se do části „Zabezpečení účtu“.");else{var e=[];if(0==(2&features))for(var t in nodes){var n=nodes[t];2==n.mtype&&null!=n.agent&&4294967295==GetNodeRights(n)&&e.push(n)}var o="Vytvořit novou skupinu zařízení podle nastavení níže.<br /><br />",i="";if(o+=addHtmlValue("Název","<input id=dp2meshname style=width:230px maxlength=128 onchange=account_validateMeshCreate() onkeyup=account_validateMeshCreate(event,1) />"),0==(1&features)&&(i+="<option value=3>Místní zařízení, žádný agent</option>"),0==(2&features)&&0<e.length&&(i+="<option value=103>Žádná zařízení agenta nepřenášejí přes agenta</option>"),65536&features2&&(0==(1&features)&&(i+="<option value=4>IP-KVM / napájecí zařízení</option>"),0==(2&features))&&0<e.length&&(i+="<option value=104>IP-KVM / Napájecí zařízení přenášené přes agenta</option>"),o+=addHtmlValue("Typ","<div style=width:230px;margin:0;padding:0><select id=dp2meshtype style=width:100% onchange=account_validateMeshCreate() onkeyup=account_validateMeshCreate(event,2) ><option value=2>Spravovat pomocí softwarového agenta</option><option value=1>Pouze Intel&reg; AMT, bez agenta</option>"+i+"</select></div>"),0<e.length){o+="<div id=d2devrelaydiv style=display:none>",e.sort(nameSort);var a=[];for(t in e)a.push('<option value="'+e[t]._id+'">'+EscapeHtml(e[t].name)+"</option>");o=o+addHtmlValue("Reléové zařízení","<div style=width:230px;margin:0;padding:0><select id=d2devrelay style=width:100% onchange=account_validateMeshCreate() onkeyup=account_validateMeshCreate(event,2) >"+a.join("")+"</select></div>")+"</div>"}setDialogMode(2,"Nová skupina zařízení",3,account_createMeshEx,o=(o=(o=(o=(o=o+addHtmlValue("Popis","<div style=width:230px;margin:0;padding:0><textarea id=dp2meshdesc maxlength=1024 style=width:100%;resize:none></textarea></div>")+"<div id=d2ipkvm style=display:none><hr />")+addHtmlValue("Modelka","<div style=width:230px;margin:0;padding:0><select id=dp2ipkvmmodel style=width:100% onchange=account_validateMeshCreate() onkeyup=account_validateMeshCreate(event,2) ><option value=1>Raritan Dominion KX III</option><option value=2>Webový vypínač 7</option></select></div>"))+addHtmlValue("Název stroje","<input id=dp2ipkvmhost style=width:230px maxlength=128 onchange=account_validateMeshCreate() onkeyup=account_validateMeshCreate(event,1) />"))+addHtmlValue("Uživatelské jméno","<input id=dp2ipkvmuser style=width:230px maxlength=128 onchange=account_validateMeshCreate() onkeyup=account_validateMeshCreate(event,1) />"))+addHtmlValue("Heslo","<input id=dp2ipkvmpass type=password style=width:230px maxlength=128 onchange=account_validateMeshCreate() onkeyup=account_validateMeshCreate(event,1) />")+"</div>"),account_validateMeshCreate(),Q("dp2meshname").focus()}return!1}function account_validateMeshCreate(e,t){var n=parseInt(Q("dp2meshtype").value),t=(1==t&&null!=e&&"Zadání"==e.key&&0<Q("dp2meshname").value.length&&Q("dp2meshtype").focus(),2==t&&null!=e&&"Zadání"==e.key&&Q("dp2meshdesc").focus(),0<Q("dp2meshname").value.length);QV("d2ipkvm",4==n||104==n);try{QV("d2devrelaydiv",100<n)}catch(e){}4==n&&0==Q("dp2ipkvmhost").value.length&&0==Q("dp2ipkvmuser").value.length&&0==Q("dp2ipkvmpass").value.length&&(t=!1),QE("idx_dlgOkButton",t)}function account_createMeshEx(e,t){var n=parseInt(Q("dp2meshtype").value),o={action:"createmesh",meshname:Q("dp2meshname").value,meshtype:n,desc:Q("dp2meshdesc").value};4!=n&&104!=n||(o.kvmmodel=parseInt(Q("dp2ipkvmmodel").value),o.kvmhost=Q("dp2ipkvmhost").value,o.kvmuser=Q("dp2ipkvmuser").value,o.kvmpass=Q("dp2ipkvmpass").value),100<n&&(o.meshtype=n-100,o.relayid=Q("d2devrelay").value),meshserver.send(o)}function account_validateDeleteAccount(){QE("account_dlgOkButton",0<Q("apassword1").value.length&&Q("apassword1").value==Q("apassword2").value)}function account_validateNewPassword(){var e,t="",n=0<Q("apassword0").value.length&&0<Q("apassword1").value.length&&Q("apassword1").value==Q("apassword2").value&&Q("apassword0").value!=Q("apassword1").value;65536&features&&Q("apasswordhint").value==Q("apassword1").value&&(n=!1),""!=Q("apassword1").value&&(null==passRequirements||""==passRequirements?t=80<=(e=checkPasswordStrength(Q("apassword1").value))?"<span style=color:green>Silné<span>":60<=e?"<span style=color:blue>Dobré<span>":"<span style=color:red>Slabé<span>":0==checkPasswordRequirements(Q("apassword1").value,passRequirements)&&(n=!1,t="<span style=color:red>Zásada<span>")),QH("dxPassWarn",t),QE("idx_dlgOkButton",n)}function checkPasswordStrength(e){var t=0,n={},o=0,i={digits:/\d/.test(e),lower:/[a-z]/.test(e),upper:/[A-Z]/.test(e),nonWords:/\W/.test(e)};if(!e)return 0;for(var a,s=0;s<e.length;s++)n[e[s]]=(n[e[s]]||0)+1,t+=5/n[e[s]];for(a in i)o+=1==i[a]?1:0;return parseInt(t+10*(o-1))}function checkPasswordRequirements(e,t){if(null==t||""==t||"object"!=typeof t)return!0;if(t.min&&e.length<t.min)return!1;if(t.max&&e.length>t.max)return!1;for(var n=0,o=0,i=0,a=0,s=0;s<e.length;s++)/\d/.test(e[s])&&n++,/[a-z]/.test(e[s])&&o++,/[A-Z]/.test(e[s])&&i++,/\W/.test(e[s])&&a++;return!(t.numeric&&n<t.numeric||t.lower&&o<t.lower||t.upper&&i<t.upper||t.nonalpha&&a<t.nonalpha)}function updateMeshes(){var e="",t=0,n=0,o=[];for(i in meshes)o.push(meshes[i]);for(i in o.sort(nameSort),o){1<t&&(e+="</tr><tr>",t=0),t++,n++;var a=GetMeshRights(o[i]),s="Částečná práva";4294967295==a?s="Administrátor":0==a&&(s="Žádná práva"),e+="<div onmouseover=devGrpMouseHover(this,1) onmouseout=devGrpMouseHover(this,0) style=display:inline-block;width:431px;height:50px;padding-top:1px;padding-bottom:1px;float:left><div style=float:left;width:30px;height:100%></div><div tabindex=0 style=height:100%;cursor:pointer onclick=gotoMesh('"+o[i]._id+"') onkeypress=\"if (event.key=='Enter') gotoMesh('"+o[i]._id+"')\"><div class=mi style=float:left;width:50px;height:50px></div><div style=height:100%><div class=g1></div><div class=e2 style=width:300px><div class=e1>"+EscapeHtml(o[i].name)+"</div><div>"+s+"</div></div><div class=g2 style=float:left></div></div></div></div>"}meshcount=n,QH("p2meshes",e),QV("p2noMeshFound",0==n)}function updateLoginTokens(){var e="",t=1;if(null!=loginTokens&&0<loginTokens.length){e+='<p><strong>Aktivní přihlašovací tokeny</strong> - <span id="p2createMeshLink1"> <a href=# onclick="return account_createLoginToken()" class="newMeshBtn"> Vytvořit</a></span></p><div style=margin-left:40px><table style="color:black;background-color:#EEE;border-color:#AAA;border-width:1px;border-style:solid;border-collapse:collapse" border=0 cellpadding=2 cellspacing=0 width=100%><tbody><tr style=background-color:#AAAAAA;font-weight:bold><th scope=col style=text-align:left;width:430px>Název</th><th scope=col style=text-align:left>Uživatelské jméno</th></tr>';for(var n=0;n<loginTokens.length;n++){var o=loginTokens[n],i="<a href=# onclick='return p2removeLoginToken(event,\""+encodeURIComponentEx(o.tokenUser)+'")\' title="Odebrat přihlašovací token" style=cursor:pointer><img src=images/trash.png border=0 height=10 width=10></a>',a="";0!=o.expire&&(a=EscapeHtml(format("Vyprší {0}",printDateTime(new Date(o.expire))))+" "),e+="<tr "+(++t%2==0?"style=background-color:#DDD":"")+"><td style=width:30%><div class=m2></div><div>&nbsp;"+EscapeHtml(o.name)+"<div></div></div></td><td style=width:70%><div style=float:right>"+a+i+"</div><div>"+EscapeHtml(o.tokenUser)+"</div></td></tr>"}e+="</tbody></table></div><br />",QV("accountCreateLoginTokenSpan",!1)}else QV("accountCreateLoginTokenSpan",128&features2);QH("p2logintokens",e)}function p2removeLoginToken(e,t){if(t=decodeURIComponent(t),null!=loginTokens){for(var n,o=null,i=0;i<loginTokens.length;i++)loginTokens[i].tokenUser==t&&(o=loginTokens[i]);null!=o&&(n="Potvrdit odebrání tohoto přihlašovacího tokenu?<br /><br />",setDialogMode(2,"Odebrat přihlašovací token",3,function(e,t){meshserver.send({action:"loginTokens",remove:[t]})},n=(n+=addHtmlValue("Název",EscapeHtml(o.name)))+addHtmlValue("Uživatelské jméno",EscapeHtml(o.tokenUser)),t))}}function gotoMesh(e){return currentMesh=meshes[e],p20updateMesh(),go(20),!1}function server_setupGoogleDriveBackup(){if(xxdialogMode||null==miscState.googleDrive)return!1;var e,t=miscState.googleDrive;t.state<3?(e='<img style=float:right src="images/googledrive-48.png" /><div>Nastavte tento server tak, aby automaticky nahrával zálohy na Disk Google. Začněte tím, že pro svůj účet vytvoříte a zadáte ID klienta Disku Google a ClientSecret.</div><br />',setDialogMode(2,"Záloha Disku Google",3,server_setupGoogleDriveBackupEx,e=(e=(e+=addHtmlValue("Pověření",'<a href="https://console.developers.google.com/apis/api/drive.googleapis.com/credentials" rel="noreferrer noopener" target="_blank">Google Drive Console</a>'))+addHtmlValue("ID klienta",'<input id=gdclientid style=width:240px placeholder="xxxxxxxx.apps.googleusercontent.com" onkeyup=server_setupGoogleDriveBackupCheck1()></input>'))+addHtmlValue("Tajemství klienta","<input id=gdclientsecret style=width:240px onkeyup=server_setupGoogleDriveBackupCheck1()></input>"),"gd1"),Q("gdclientid").focus(),QE("idx_dlgOkButton",!1)):3==t.state&&(e='<img style=float:right src="images/googledrive-48.png" /><div>Zálohování na Disk Google je aktuálně aktivní.</div>',setDialogMode(2,"Záloha Disku Google",3,server_setupGoogleDriveBackupEx,e+="<br /><label><input id=gdcheck type=checkbox onchange=server_setupGoogleDriveBackupCheck2() />Odebrat konfiguraci</label>","gd0"),QE("idx_dlgOkButton",!1))}function server_setupGoogleDriveBackupCheck1(){QE("idx_dlgOkButton",0<Q("gdclientid").value.length&&0<Q("gdclientsecret").value.length)}function server_setupGoogleDriveBackupCheck2(){QE("idx_dlgOkButton",Q("gdcheck").checked)}function server_setupGoogleDriveBackupCheck3(){QE("idx_dlgOkButton",0<Q("gdcode").value.length)}function server_setupGoogleDriveBackupEx(e,t){"gd0"==t&&meshserver.send({action:"serverBackup",service:"googleDrive",state:0}),"gd1"==t&&meshserver.send({action:"serverBackup",service:"googleDrive",state:1,clientid:Q("gdclientid").value,clientsecret:Q("gdclientsecret").value}),"gd2"==t&&meshserver.send({action:"serverBackup",service:"googleDrive",state:2,code:Q("gdcode").value})}function server_showRestoreDlg(){var e;return xxdialogMode||(e="Obnova serveru ze zálohy, <span style=color:red>nahradí všechny stávající uživatele a data na tomto serveru těmi ze zálohy.</span> (tj. je smaže). Udělejte to, pouze pokud víte, co děláte (tj. že přijdete o vše, co bylo vytvořeno po pořízení zálohy, ze které obnovujete).<br /><br />",setDialogMode(2,"Obnova serveru",0,null,e=(e=(e=(e+='<form action="/restoreserver.ashx'+(urlargs.key?"?key="+urlargs.key:"")+'" enctype="multipart/form-data" method="post"><div>')+("<input type=hidden name=auth value="+authCookie+">"))+'<input id=account_dlgFileInput type=file name=datafile style=width:100% accept=".zip,application/octet-stream,application/zip,application/x-zip,application/x-zip-compressed" onchange=account_validateServerRestore()><br /><br />'+"<input id=account_dlgCancelButton type=button value=Storno style=float:right;width:80px;margin-left:5px onclick=dialogclose(0)>")+"<input id=account_dlgOkButton type=submit value=OK style=float:right;width:80px onclick=dialogclose(1)>"+"</div><br /><br /></form>"),account_validateServerRestore()),!1}function account_validateServerRestore(){QE("account_dlgOkButton",1==Q("account_dlgFileInput").files.length)}function server_showVersionDlg(){return xxdialogMode||(setDialogMode(2,"Verze MeshCentral",1,null,"Načítání…","MeshCentralServerUpdate"),meshserver.send({action:"serverversion"})),!1}function server_showVersionDlgUpdate(){var e=Q("d2updateCheck1").checked,t=Q("d2updateCheck2").checked;QE("d2updateCheck1","Neznámé"!=xxdialogTag.stable&&xxdialogTag.current!=xxdialogTag.stable&&0==t),QE("d2updateCheck2","Neznámé"!=xxdialogTag.latest&&xxdialogTag.current!=xxdialogTag.latest&&0==e),QE("idx_dlgOkButton",e&&!t||!e&&t)}function server_showVersionDlgEx(e,t){Q("d2updateCheck1").checked&&meshserver.send({action:"serverupdate",tag:"stable",version:t.stable}),Q("d2updateCheck2").checked&&meshserver.send({action:"serverupdate",tag:"latest",version:t.latest})}function server_showErrorsDlg(){return xxdialogMode||(setDialogMode(2,"Server Errors",1,null,"Načítání…","MeshCentralServerErrors"),meshserver.send({action:"servererrors"})),!1}function server_showErrorsDlgUpdate(){QE("idx_dlgOkButton",Q("d2clearErrorsCheck").checked)}function server_showErrorsDlgEx(){meshserver.send({action:"serverclearerrorlog"})}function d2CopyServerErrorsToClip(){saveAs(new Blob([Q("d2ServerErrorsLogPre").innerText],{type:"application/octet-stream"}),"servererrors.txt")}function server_showConfigDlg(){return xxdialogMode||(setDialogMode(2,"Server Configuration",1,null,"Načítání…","MeshCentralServerConfig"),meshserver.send({action:"serverconfig"})),!1}function d2CopyServerConfigToClip(){saveAs(new Blob([Q("d2ServerConfigPre").innerText],{type:"application/octet-stream"}),"config.json")}function p20updateMesh(){if(null!=currentMesh){var e,t,n=GetMeshRights(currentMesh),o=EscapeHtml(currentMesh.name),i=(0==o.length&&(o="<i>Nic</i>"),0!=(1&n)&&(o='<span tabindex=0 title="Kliknutím sem upravíte název skupiny zařízení" onclick=p20editmesh(1) onkeyup="if (event.key == \'Enter\') p20editmesh(1)" style=cursor:pointer>'+o+' <img class=hoverButton src="images/link5.png" /></span>'),QH("p20meshName",o),QV("MeshSummary",4!=currentMesh.mtype),format("Neznámé č. {0}",currentMesh.mtype)),a=(1==currentMesh.mtype&&(i="Pouze Intel&reg; AMT, bez agenta"),2==currentMesh.mtype&&(i="Spravovat pomocí softwarového agenta"),3==currentMesh.mtype&&(i=null==currentMesh.relayid?"Místní zařízení, žádný agent":"Žádná zařízení agenta nepřenášejí přes agenta"),4==currentMesh.mtype&&(i=null==currentMesh.relayid?"IP-KVM zařízení":"IP-KVM zařízení přenášené přes agenta",1==currentMesh.kvm.model)&&(i+=", Raritan KX III"),"");if(0!=(8&args.hide)&&(a+=addHtmlValue("Název",o)),a=(a+=addHtmlValue("Popis",addLinkConditional(currentMesh.desc&&""!=currentMesh.desc?EscapeHtml(currentMesh.desc):"<i>Nic</i>","p20editmesh(2)",0!=(1&n))))+addHtmlValue("Typ",i),3!=currentMesh.mtype&&4!=currentMesh.mtype||null==currentMesh.relayid||(o="<i>Neznámé</i>",a+=addHtmlValue("Reléové zařízení",addLinkConditional(o=null!=(i=getNodeFromId(currentMesh.relayid))?EscapeHtml(i.name):o,"p20editmeshrelay()",0!=(1&n)))),4==currentMesh.mtype&&(a=(a+=addHtmlValue("Název stroje",currentMesh.kvm.host))+addHtmlValue("Uživatelské jméno",currentMesh.kvm.user)),null!=currentMesh.creatorid&&null!=users&&null!=users[currentMesh.creatorid]?a+=addHtmlValue("Tvůrce",'<a onclick=gotoUser("'+encodeURIComponentEx((i=users[currentMesh.creatorid])._id)+'",false,null)>'+EscapeHtml(i.name)+"</a>"):null!=currentMesh.creatorname&&(a+=addHtmlValue("Tvůrce",EscapeHtml(currentMesh.creatorname))),null!=currentMesh.creation&&(a+=addHtmlValue("Čas vytvoření",printDateTime(new Date(currentMesh.creation)))),3!=currentMesh.mtype&&(e=[],currentMesh.flags&&(1&currentMesh.flags&&e.push("Automatické odstranění"),2&currentMesh.flags&&e.push(4==currentMesh.mtype?"Synchronizace názvu portu":"Synchronizace názvu stroje"),1==serverinfo.devGroupSessionRecording)&&4&currentMesh.flags&&e.push("Záznam relací"),"number"==typeof currentMesh.expireDevs&&0<currentMesh.expireDevs&&e.push("Odebrat neaktivní"),a+=addHtmlValue("Funkce",addLinkConditional(e=""==(e=e.join(", "))?"<i>Nic</i>":e,"p20editmeshfeatures()",1&n))),2==currentMesh.mtype&&(e=[],o=0,currentMesh.consent&&(o=currentMesh.consent),serverinfo.consent&&(o|=serverinfo.consent),64&o&&8&o?e.push("Výzva na ploše+panel nástrojů"):64&o?e.push("Panel nástrojů na ploše"):8&o?e.push("Výzva na ploše"):1&o&&e.push("Informovat na ploše"),16&o?e.push("Výzva terminálu"):2&o&&e.push("Oznámení terminálu"),32&o?e.push("Dotaz na soubory"):4&o&&e.push("Upozornit na soubory"),7==o&&(e=["Vždy upozornit"]),a+=addHtmlValue("Souhlas uživatele",addLinkConditional(e=""==(e=(e=56==(56&o)?["Vždy se dotázat"]:e).join(", "))?"<i>Nic</i>":e,"p20editmeshconsent(1)",1&n))),3==currentMesh.mtype||4294967295!=userinfo.siteadmin&&0!=(1024&userinfo.siteadmin)||(i=0,o=[],userinfo.links&&userinfo.links[currentMesh._id]&&userinfo.links[currentMesh._id].notify&&(i|=userinfo.links[currentMesh._id].notify),userinfo.notify&&userinfo.notify[currentMesh._id]&&(i|=userinfo.notify[currentMesh._id]),2&i&&o.push("Připojit"),4&i&&o.push("Odpojit"),8&i&&o.push("Intel&reg; AMT"),16384&features2&&userinfo.emailVerified&&(t=0,16&i&&t++,32&i&&t++,64&i&&t++,0<t)&&o.push(format("Email ({0})",t)),null!=userinfo.msghandle&&0!=(33554432&features2)&&(t=0,128&i&&t++,256&i&&t++,512&i&&t++,0<t)&&o.push(format("Messaging ({0})",t)),0==o.length&&o.push("<i>Nic</i>"),a+=addHtmlValue("Upozornění",addLink(o.join(", "),"p20editMeshNotify()"))),16777216&features&&2==currentMesh.mtype&&(i=!(e="<i>Nic</i>"),null!=currentMesh.invite&&(i=!0,e=currentMesh.invite.codes.join(", ")),a+=addHtmlValue("Pozvat kódy",addLinkConditional(e,"p20editmeshInviteCode()",1&n||i))),currentMesh.mtype<3&&0!=(1&features2)&&(t="Žádná zásada",currentMesh.amt&&(1==currentMesh.amt.type?t="Deaktivovat":2==currentMesh.amt.type?(t="Jednoduchý režim řízený klientem (CCM)",2==currentMesh.amt.cirasetup&&(t+=" + CIRA")):3==currentMesh.amt.type?(t="Jednoduchý režim řízený správcem (ACM)",2==currentMesh.amt.cirasetup&&(t+=" + CIRA")):4==currentMesh.amt.type&&(t="Plně automatické")),a+=addHtmlValue("Intel&reg; AMT",addLinkConditional(t,"p20editMeshAmt()",1&n))),1&n&&(a+='<br><input type=button value=Poznámky title="Zobrazit poznámky k této skupině zařízení" onclick=showNotes(false,"'+encodeURIComponentEx(currentMesh._id)+'") />'),a+="<br style=clear:both><br>",2&n&&(a+='<a href=# onclick="return p20showAddMeshUserDialog()" style=cursor:pointer;margin-right:10px><img src=images/icon-addnew.png border=0 height=12 width=12> Přidat uživatele</a>',null!=usergroups)){var s=0,r=!1;for(g in usergroups)null==usergroups[g].membershipType&&usergroups[g]._id.split("/")[1]==currentMesh._id.split("/")[1]&&(s++,null==currentMesh.links||null==currentMesh.links[g])&&(r=!0);0<s&&r&&(a+='<a href=# onclick="return p20showAddMeshUserDialog(2)" style=cursor:pointer;margin-right:10px><img src=images/icon-addnew.png border=0 height=12 width=12> Přidat skupinu uživatelů</a>')}1==currentMesh.mtype&&(1&n&&(a+='<a href=# style=cursor:pointer;margin-right:10px title="Import Intel&reg; AMT devices." onclick=\'return showAmtImport("'+currentMesh._id+"\")'><img src=images/icon-installmesh.png border=0 height=12 width=12> Import</a>"),null!=currentMesh.amt)&&0<currentMesh.amt.type&&(a+='<a href=# style=cursor:pointer;margin-right:10px title="Proveďte aktivaci a konfiguraci Intel&reg; AMT." onclick=\'return showAmtSetup("'+currentMesh._id+"\")'><img src=images/icon-installmesh.png border=0 height=12 width=12> Nastavit</a>"),2!=currentMesh.mtype||4294967295!=userinfo.siteadmin&&0!=(4096&userinfo.siteadmin)||(a=(a+="<a href=# onclick='return addAgentToMesh(\""+currentMesh._id+'")\' style=cursor:pointer;margin-right:10px title="Přidejte nový počítač do této skupiny zařízení instalací agenta sítě."><img src=images/icon-addnew.png border=0 height=12 width=12> Přidat agenta</a>')+"<a href=# onclick='return inviteAgentToMesh(\""+currentMesh._id+'")\' style=cursor:pointer;margin-right:10px title="Pozvěte někoho, aby nainstaloval agenta sítě do této skupiny zařízení."><img src=images/icon-addnew.png border=0 height=12 width=12> Pozvat</a>'),3!=currentMesh.mtype||4294967295!=userinfo.siteadmin&&0!=(4096&userinfo.siteadmin)||(a+="<a href=# onclick='return addLocalDeviceToMesh(\""+currentMesh._id+'")\' style=cursor:pointer;margin-right:10px title="Přidejte zařízení umístěné v místní síti."><img src=images/icon-addnew.png border=0 height=12 width=12> Přidat zařízení</a>'),currentMesh.amt&&2<currentMesh.amt.type&&(4294967295==userinfo.siteadmin||0==(4096&userinfo.siteadmin))&&(a+="<a href=# style=cursor:pointer;font-size:small title=\"Přepněte Intel AMT do režimu správy správce (ACM).\" onclick='return showAmtAcmSetup()'><img src=images/icon-installmesh.png border=0 height=12 width=12> ACM</a>"),a+='<table style="color:black;background-color:#EEE;border-color:#AAA;border-width:1px;border-style:solid;border-collapse:collapse" border=0 cellpadding=2 cellspacing=0 width=100%><tbody><tr style=background-color:#AAAAAA;font-weight:bold><th scope=col style=text-align:left;width:430px>Uživatelská oprávnění</th><th scope=col style=text-align:left></th></tr>';var l=1,d=[];for(g in currentMesh.links){var u=g.split("/")[2];currentMesh.links[g].name&&(u=currentMesh.links[g].name),g==userinfo._id&&(u=userinfo.name),null!=usergroups&&null!=usergroups[g]&&(u=usergroups[g].name),d.push({id:g,name:u,rights:currentMesh.links[g].rights})}for(g in d.sort(function(e,t){return e.name>t.name?1:e.name<t.name?-1:0}),d){var c="",p=makeDeviceGroupRightsString(d[g].rights),m=2,v=(d[g].id==userinfo._id||4294967295!=n&&0==(2&n)||(4294967295!=n&&4294967295==currentMesh.links[d[g].id].rights||(c="<a href=# onclick='return p20deleteUser(event,\""+encodeURIComponentEx(d[g].id)+'")\' title="Odebrat práva uživatele na tuto skupinu zařízení" style=cursor:pointer><img src=images/trash.png border=0 height=10 width=10></a>'),p='<span tabindex=0 style=cursor:pointer onclick=p20viewuser("'+encodeURIComponentEx(d[g].id)+"\") onkeypress=\"if (event.key=='Enter') p20viewuser('"+encodeURIComponentEx(d[g].id)+"')\">"+p+" <img class=hoverButton style=cursor:pointer src=images/link5.png></span>"),d[g].id.startsWith("ugrp/")&&(m=4),EscapeHtml(decodeURIComponent(d[g].name)));null!=usergroups&&d[g].id.startsWith("ugrp/")&&(v="<a tabindex=0 href=# onclick='gotoUserGroup(\""+encodeURIComponentEx(d[g].id)+"\");haltEvent(event);'>"+v+"</a>"),a+="<tr style="+(l%2==0?";background-color:#DDD":"")+'><td style=width:30%><div title="Uživatel" class=m'+m+"></div><div>&nbsp;"+(v=null!=users&&d[g].id.startsWith("user/")?"<a tabindex=0 href=# onclick='gotoUser(\""+encodeURIComponentEx(d[g].id)+"\");haltEvent(event);'>"+v+"</a>":v)+"<div></div></div></td><td style=width:70%><div style=float:right>"+c+"</div><div>"+p+"</div></td></tr>",++l}if(a+="</tbody></table>",null!=deviceShares&&deviceSharesNode==currentMesh._id&&0<deviceShares.length){a+='<p></p><table style="color:black;background-color:#EEE;border-color:#AAA;border-width:1px;border-style:solid;border-collapse:collapse" border=0 cellpadding=2 cellspacing=0 width=100%><tbody><tr style=background-color:#AAAAAA;font-weight:bold><th scope=col style=text-align:left;width:430px>Aktivní sdílení zařízení</th><th scope=col style=text-align:left><th scope=col style=text-align:left></th></tr>';for(var l=1,g=0;g<deviceShares.length;g++){var h=deviceShares[g],c="",f=(null!=h.url&&(c+='<a href="'+h.url+'" rel="noreferrer noopener" target=_blank title="Odkaz na sdílení zařízení" style=cursor:pointer><img src=images/link2.png border=0 height=10 width=10></a> '),c+="<a href=# onclick='return p30removeDeviceSharing(event,\""+encodeURIComponentEx(h.nodeid)+'","'+encodeURIComponentEx(h.publicid)+'","'+encodeURIComponentEx(h.guestName)+'")\' title="Odebrat sdílení zařízení" style=cursor:pointer><img src=images/trash.png border=0 height=10 width=10></a>',""),k=(h.p<=7?f=["","Terminál","Plocha","Desktop + terminál","Soubory","Terminál + soubory","Plocha + soubory","Plocha + Terminál + Soubory"][h.p]:8==h.p?f="HTTP/"+h.port:16==h.p&&(f="HTTPS/"+h.port),f),f=(null!=h.startTime&&null!=h.expireTime&&(k=format("{0}, {1} až {2}",f,printFlexDateTime(new Date(h.startTime)),printFlexDateTime(new Date(h.expireTime)))),null!=h.startTime&&null!=h.duration&&(k=(h.duration,format("{0}, {1} po dobu {2} minut",f,printFlexDateTime(new Date(h.startTime)),h.duration))),1==h.recurring&&(k+=", Opakující se denně"),2==h.recurring&&(k+=", Opakující se týdně"),0!=(2&h.p)&&!0===h.viewOnly&&(k+=", Zobrazit pouze plochu"),null!=h.consent&&(0==h.consent?k+=", Žádný souhlas":(0!=(56&h.consent)&&(k+=", Vyzvat k souhlasu"),0!=(64&h.consent)&&(k+=", Panel nástrojů"))),EscapeHtml(h.guestName));h.publicid.startsWith("AS:node/")&&(f="<i>Agent Self-Share</i>"),null!=(x=getNodeFromId(h.nodeid))&&(b=0<x.conn?"":" gray",a+="<tr "+(++l%2==0?"style=background-color:#DDD":"")+"><td style=width:30%>"+("<div onclick='gotoDevice(\""+x._id+'",10);haltEvent(event);\' style=float:left class="j'+x.icon+b+'"></div>&nbsp;<a onclick=\'gotoDevice("'+x._id+"\",10);haltEvent(event);'>"+EscapeHtml(x.name)+"</a>")+"<td style=width:30%><div class=m2></div><div>&nbsp;"+f+"<div></div></div></td><td style=width:70%><div style=float:right>"+c+"</div><div>"+k+"</div></td></tr>")}a+="</tbody></table>"}else deviceSharesNode!=currentMesh._id&&deviceSharesReq!=currentMesh._id&&(deviceSharesReq=currentMesh._id,meshserver.send({action:"deviceMeshShares",meshid:currentMesh._id}));l=0,nodes.sort(deviceSort);var o="",y=(1==currentMesh.mtype&&(o+='<a onclick=meshDownloadDeviceList()><img title="Stáhněte si seznam zařízení" src="images/link4.png" /></a>',0==(1&features))&&(o+=' <a onclick=meshImportDeviceList()><img title="Importovat seznam zařízení" src="images/link6.png" /></a>'),'<table style="color:black;background-color:#EEE;border-color:#AAA;border-width:1px;border-style:solid;border-collapse:collapse" border=0 cellpadding=2 cellspacing=0 width=100%><tbody><tr style=background-color:#AAAAAA;font-weight:bold><th scope=col style=text-align:left;width:430px>Zařízení</th><th scope=col style=text-align:right>'+o+"</th></tr>");for(g in nodes){var x,b=0<(x=nodes[g]).conn?"":" gray";currentMesh._id==x.meshid&&(y+="<tr style="+(l%2==0?";background-color:#DDD":"")+"><td style=width:30%><div onclick='gotoDevice(\""+x._id+'",10);haltEvent(event);\' style=float:left class="j'+x.icon+b+'"></div>&nbsp;<a onclick=\'gotoDevice("'+x._id+"\",10);haltEvent(event);'>"+EscapeHtml(x.name)+"</a></div></div></td><td style=width:70%><div style=float:right>"+PowerStateStr(x.pwr)+"&nbsp;</div><div>"+(x.osdesc?EscapeHtml(x.osdesc):"")+"</div></td></tr>",++l)}0==l&&(y+="<tr><td><i>Nic</i></td></tr>"),y+="</tbody></table>",4294967295==n&&(y+="<div style=font-size:small;text-align:right><span><a href=# onclick=p20showDeleteMeshDialog() style=cursor:pointer>Smazat skupinu</a></span></div>"),QH("p20info",a),QH("p20info2",y);var w="";if(0==(268435456&features)&&20<=xxcurrentView&&xxcurrentView<=29&&null!=currentMesh){for(var g in w="?viewmode="+xxcurrentView+"&gotomesh="+currentMesh._id.split("/")[2],urlargs)w+="&"+g+"="+urlargs[g];try{window.history.replaceState({},document.title,window.location.pathname+w)}catch(e){}}}}function meshDownloadDeviceList(){if(!xxdialogMode){var e,t={webappversion:"0.9.0",computers:[]};for(e in nodes){var n,o=nodes[e];currentMesh._id==o.meshid&&null!=o.intelamt&&(n={name:o.name,host:o.host,user:o.intelamt.user,pass:"",tls:1==o.intelamt.tls?1:0,ver:o.intelamt.ver,pstate:o.intelamt.state},2==o.intelamt.state&&(n.pmode=1),o.intelamt.realm&&(n.digestrealm=o.intelamt.realm),o.intelamt.hash&&(n.tlscerthash=o.intelamt.hash),t.computers.push(n))}saveAs(stringToUtf8BlobNoHeader(JSON.stringify(t,null,2)),currentMesh.name+".json")}}function meshImportDeviceList(){xxdialogMode||(setDialogMode(2,"Importujte zařízení Intel&reg; AMT",3,meshImportDeviceListEx,'Importujte seznam místních zařízení Intel&reg; AMT ve formátu MeshCommander JSON.<br /><br /><input style=width:370px type=file id=d4importFile accept=".json" onchange=meshImportDeviceListValidate() />'),QE("idx_dlgOkButton",!1))}function meshImportDeviceListValidate(){QE("idx_dlgOkButton",null!=Q("d4importFile").value)}function meshImportDeviceListEx(){var e=new FileReader;e.onload=function(e){var t=null;try{t=JSON.parse(e.target.result)}catch(e){return void setDialogMode(2,"Importujte zařízení Intel&reg; AMT",1,null,format("Neplatný JSON soubor: {0}.",e))}if("object"==typeof t&&"string"==typeof t.webappversion&&"object"==typeof t.computers&&Array.isArray(t.computers)){var n,o=0;for(n in t.computers){var i,a=t.computers[n];"string"==typeof a.name&&"string"==typeof a.host&&"string"==typeof a.user&&"string"==typeof a.pass&&(i={action:"addamtdevice",meshid:currentMesh._id,devicename:a.name,hostname:a.host,amtusername:a.user,amtpassword:a.pass,amttls:1==a.tls?1:0},"string"==typeof a.ver&&(i.ver=a.ver),"number"==typeof a.pstate&&(i.state=a.pstate),"string"==typeof a.digestrealm&&(i.realm=a.digestrealm),"string"==typeof a.tlscerthash&&(i.hash=a.tlscerthash),meshserver.send(i),o++)}0==o&&setDialogMode(2,"Import uživatelských účtů",1,null,"Nelze importovat žádné zařízení.")}else setDialogMode(2,"Importujte zařízení Intel&reg; AMT",1,null,"Neplatný formát JSON souboru.")},e.readAsText(Q("d4importFile").files[0])}function p20editMeshAmt(){xxdialogMode||(setDialogMode(2,"Intel&reg; AMT zásada",3,p20editMeshAmtEx,""+addHtmlValue("Typ","<select id=dp20amtpolicy style=width:230px onchange=p20editMeshAmtChange()><option value=0>Žádná zásada</option><option value=1>Deaktivovat</option><option value=2>Jednoduchý režim řízený klientem (CCM)</option>"+(0!=(1048576&features)?"<option value=3>Jednoduchý režim řízený správcem (ACM)</option>":"")+"<option value=4>Plně automatické</option></select>")+"<div id=dp20amtpolicydiv></div>"),currentMesh.amt&&(Q("dp20amtpolicy").value=currentMesh.amt.type),p20editMeshAmtChange(),!currentMesh.amt||2!=currentMesh.amt.type&&3!=currentMesh.amt.type||(Q("dp20amtpolicypass").value=currentMesh.amt.password,2!=currentMesh.amt.type&&3!=currentMesh.amt.type||(null!=currentMesh.amt.badpass&&(Q("dp20amtbadpass").value=currentMesh.amt.badpass),3==currentMesh.amt.type&&null!=currentMesh.amt.ccm&&(Q("dp20amtccmmode").value=currentMesh.amt.ccm)),0==(1024&features)&&(Q("dp20amtcira").value=currentMesh.amt.cirasetup)),dp20amtValidatePolicy())}function p20editMeshAmtChange(){var e=Q("dp20amtpolicy").value,t="";2!=e&&3!=e||(t=(t=(t=t+addHtmlValue("Heslo","<select id=dp20amtpass style=width:230px onchange=dp20amtValidatePolicy() onkeyup=dp20amtValidatePolicy()><option value=0>Náhodné heslo</option>"+(null!=currentMesh.amt&&1==currentMesh.amt.password?"<option value=1 selected>Ponechat stávající heslo</option>":"")+"<option value=2>Vyberte nové heslo</option></select>")+"<div id=dp20amtpassdiv style=display:none>")+addHtmlValue("Nové heslo*","<input id=dp20amtpolicypass type=password style=width:230px maxlength=32 onchange=dp20amtValidatePolicy() onkeyup=dp20amtValidatePolicy() autocomplete=off />"))+addHtmlValue("Nové heslo*","<input id=dp20amtpolicypass2 type=password style=width:230px maxlength=32 onchange=dp20amtValidatePolicy() onkeyup=dp20amtValidatePolicy() autocomplete=off />")+"</div>",3==e&&(t+=addHtmlValue("Režim CCM","<select id=dp20amtccmmode style=width:230px onchange=dp20amtValidatePolicy() onkeyup=dp20amtValidatePolicy()><option value=0>Neměňte, ponechte CCM, pokud je nastaveno</option><option value=1>Pokud je nastaveno, deaktivujte CCM</option><option value=2>Aktivujte CCM, pokud ACM selže</option></select>")),t=(t+="<div id=dp20amtbadpassdiv style=display:none>")+addHtmlValue("Neznámé heslo","<select id=dp20amtbadpass style=width:230px><option value=0>Nedělat nic</option><option value=1>Pokud je v CCM, znovu aktivujte Intel&reg; AMT</option></select>")+"</div>",0==(1024&features)&&(t+=addHtmlValue('<span title="Vzdálený přístup iniciováný klientem">Nastavení CIRA</span>',"<select id=dp20amtcira style=width:230px><option value=0>Nedělat nic</option><option value=1>Nepřipojovat k serveru</option><option value=2>Připojit se na server</option></select>")),t+='<span id=dp10passNotify style="font-size:10px"> * 8-16 znaků, 1 velké písmeno, 1 malé písmeno, 1 číslo, 1 znak jiný než alfanumerický.</span>',2==currentMesh.mtype&&2==e&&(t+='<span style="font-size:10px"> Tato zásada nebude mít vliv na zařízení s Intel&reg; AMT v ACM režimu.</span>')),0==e&&(t="<table style=padding-top:4px><tr><td><img style=padding-right:8px src=images/rcheckbox60.png width=60 height=60><td>Pokud je vybrána tato zásada, Intel&reg; AMT není spravován tímto serverem. Intel AMT lze stále používat ruční aktivací a konfigurací.</table>"),1==e&&(t="<table style=padding-top:4px><tr><td><img style=padding-right:8px src=images/rcheckbox60.png width=60 height=60><td>Pokud je vybrána tato zásada, bude deaktivována jakákoli Intel&reg; AMT v režimu ovládání klienta (CCM). U ostatních zařízení bude CIRA vymazána a stále je lze spravovat ručně.</table>"),4==e&&(t="<table style=padding-top:4px><tr><td><img style=padding-right:8px src=images/checkbox60.png width=60 height=60><td>Toto je doporučená zásada. Aktivace a správa Intel&reg; AMT je zcela automatizovaná a server se pokusí co nejlépe využít správu hardwaru.</table>"),QH("dp20amtpolicydiv",t),setTimeout(dp20amtValidatePolicy,500)}function dp20amtValidatePolicy(){var e,t=!0,n=Q("dp20amtpolicy").value;2!=n&&3!=n||2!=Q("dp20amtpass").value||(t=(e=Q("dp20amtpolicypass").value)===Q("dp20amtpolicypass2").value&&passwordcheck(e)),QE("idx_dlgOkButton",t),2!=n&&3!=n||QV("dp20amtpassdiv",2==Q("dp20amtpass").value),QV("dp10passNotify",(2==n||3==n)&&2==Q("dp20amtpass").value),QV("dp20amtbadpassdiv",2==n||3==n&&1!=Q("dp20amtccmmode").value)}function p20editMeshAmtEx(){var e=parseInt(Q("dp20amtpolicy").value),t={type:e},n=null;2!=e&&3!=e||(0==Q("dp20amtpass").value&&(n=""),1==Q("dp20amtpass").value&&(n=null),2==Q("dp20amtpass").value&&(n=Q("dp20amtpolicypass").value)),2==e?(t={type:e,password:n,badpass:parseInt(Q("dp20amtbadpass").value)}).cirasetup=0==(1024&features)?parseInt(Q("dp20amtcira").value):1:3==e?(t={type:e,password:n,badpass:parseInt(Q("dp20amtbadpass").value),ccm:parseInt(Q("dp20amtccmmode").value)}).cirasetup=0==(1024&features)?parseInt(Q("dp20amtcira").value):1:4==e&&(t={type:e}),meshserver.send({action:"meshamtpolicy",meshid:currentMesh._id,amtpolicy:t})}function p20showDeleteMeshDialog(){var e;return xxdialogMode||(e=format("Opravdu smazat skupinu {0}? Smazáním skupiny se smažou také všechny informace o zařízeních v této skupině.",EscapeHtml(currentMesh.name))+"<br /><br />",setDialogMode(2,"Smazat skupinu",3,p20showDeleteMeshDialogEx,e+="<label><input id=p20check type=checkbox onchange=p20validateDeleteMeshDialog() />Potvrdit</label>"),p20validateDeleteMeshDialog()),!1}function p20validateDeleteMeshDialog(){QE("idx_dlgOkButton",Q("p20check").checked)}function p20showDeleteMeshDialogEx(e,t){meshserver.send({action:"deletemesh",meshid:currentMesh._id,meshname:currentMesh.name})}function p20editmeshrelay(){if(!xxdialogMode){var e=[];if(0==(2&features))for(var t in nodes){var n=nodes[t];2==n.mtype&&null!=n.agent&&4294967295==GetNodeRights(n)&&e.push(n)}if(e.sort(nameSort),0==e.length)setDialogMode(2,"Upravit skupinu zařízení",1,null,"Nejsou k dispozici žádná reléová zařízení.");else{var o=[];for(t in e)o.push('<option value="'+e[t]._id+'"'+(currentMesh.relayid==e[t]._id?" selected":"")+">"+EscapeHtml(e[t].name)+"</option>");setDialogMode(2,"Upravit skupinu zařízení",3,p20editmeshrelayEx,addHtmlValue("Reléové zařízení","<div style=width:230px;margin:0;padding:0><select id=d2devrelay style=width:100%>"+o.join("")+"</select></div>"))}}}function p20editmeshrelayEx(){meshserver.send({action:"editmesh",meshid:currentMesh._id,relayid:Q("d2devrelay").value})}function p20editmesh(e){var t;xxdialogMode||(t=addHtmlValue("Název","<input id=dp20meshname style=width:230px maxlength=128 onchange=p20editmeshValidate() onkeyup=p20editmeshValidate(event) />"),setDialogMode(2,"Upravit skupinu zařízení",3,p20editmeshEx,t+=addHtmlValue("Popis","<div style=width:230px;margin:0;padding:0><textarea id=dp20meshdesc maxlength=1024 style=width:100%;resize:none></textarea></div>")),Q("dp20meshname").value=currentMesh.name,currentMesh.desc&&(Q("dp20meshdesc").value=currentMesh.desc),p20editmeshValidate(),(2==e?Q("dp20meshdesc"):Q("dp20meshname")).focus())}function p20editmeshEx(){meshserver.send({action:"editmesh",meshid:currentMesh._id,meshname:Q("dp20meshname").value,desc:Q("dp20meshdesc").value})}function p20editmeshValidate(e){QE("idx_dlgOkButton",0<Q("dp20meshname").value.length),e&&"Enter"==e.key&&Q("dp20meshdesc").focus()}function p20editmeshconsent(e){var t,n,o;xxdialogMode||(n=0,o=t="",1==e&&(n=currentMesh.consent||0,o="Upravit souhlas uživatele u skupiny zařízení"),2==e&&(n=currentUser.consent||0,o="Upravit souhlas uživatele"),3==e&&(n=currentNode.consent||0,o="Upravit souhlas uživatele zařízení"),4==e&&(n=currentUserGroup.consent||0,o="Upravit souhlas skupiny uživatelů"),setDialogMode(2,o,3,p20editmeshconsentEx,t=(t=(t=(t=(t=t+'<div style="width:100%;border-bottom:1px solid gray;margin-bottom:5px"><b>Plocha</b></div>'+("<div><label><input type=checkbox id=d20flag1 "+(1&n?"checked":"")+">Upozornit uživatele</label></div>"))+("<div><label><input type=checkbox id=d20flag2 "+(8&n?"checked":"")+">Výzva k souhlasu uživatele</label></div>")+("<div><label><input type=checkbox id=d20flag7 "+(64&n?"checked":"")+">Zobrazit panel nástrojů připojení</label></div>"))+'<div style="width:100%;border-bottom:1px solid gray;margin-bottom:5px;margin-top:8px"><b>Terminál</b></div>'+("<div><label><input type=checkbox id=d20flag3 "+(2&n?"checked":"")+">Upozornit uživatele</label></div>"))+("<div><label><input type=checkbox id=d20flag4 "+(16&n?"checked":"")+">Výzva k souhlasu uživatele</label></div>")+'<div style="width:100%;border-bottom:1px solid gray;margin-bottom:5px;margin-top:8px"><b>Soubory</b></div>')+("<div><label><input type=checkbox id=d20flag5 "+(4&n?"checked":"")+">Upozornit uživatele</label></div>")+("<div><label><input type=checkbox id=d20flag6 "+(32&n?"checked":"")+">Výzva k souhlasu uživatele</label></div>"),e),serverinfo.consent&&(1&serverinfo.consent&&(Q("d20flag1").checked=!0),8&serverinfo.consent&&(Q("d20flag2").checked=!0),2&serverinfo.consent&&(Q("d20flag3").checked=!0),16&serverinfo.consent&&(Q("d20flag4").checked=!0),4&serverinfo.consent&&(Q("d20flag5").checked=!0),32&serverinfo.consent&&(Q("d20flag6").checked=!0),64&serverinfo.consent&&(Q("d20flag7").checked=!0),QE("d20flag1",!(1&serverinfo.consent)),QE("d20flag2",!(8&serverinfo.consent)),QE("d20flag3",!(2&serverinfo.consent)),QE("d20flag4",!(16&serverinfo.consent)),QE("d20flag5",!(4&serverinfo.consent)),QE("d20flag6",!(32&serverinfo.consent)),QE("d20flag7",!(64&serverinfo.consent))))}function p20editmeshconsentEx(e,t){var n=0;Q("d20flag1").checked&&(n+=1),Q("d20flag2").checked&&(n+=8),Q("d20flag3").checked&&(n+=2),Q("d20flag4").checked&&(n+=16),Q("d20flag5").checked&&(n+=4),Q("d20flag6").checked&&(n+=32),Q("d20flag7").checked&&(n+=64),1==t&&meshserver.send({action:"editmesh",meshid:currentMesh._id,consent:n}),2==t&&meshserver.send({action:"edituser",id:currentUser._id,consent:n}),3==t&&meshserver.send({action:"changedevice",nodeid:currentNode._id,consent:n}),4==t&&meshserver.send({action:"editusergroup",ugrpid:currentUserGroup._id,consent:n})}function p20editmeshfeatures(){var e,t,n;xxdialogMode||(e=currentMesh.flags||0,t="",n=0,"number"==typeof currentMesh.expireDevs&&0<currentMesh.expireDevs&&2e3<(n=currentMesh.expireDevs)&&(n=2e3),1==serverinfo.devGroupSessionRecording&&4!=currentMesh.mtype&&(t+="<div><label><input type=checkbox id=d20flag4 onchange=p20editmeshfeaturesValidate() "+(4&e?"checked":"")+">Zaznamenejte relace</label><br></div>"),t=(t=2!=currentMesh.mtype&&4!=currentMesh.mtype?t:t+("<div><label><input type=checkbox id=d20flag2 onchange=p20editmeshfeaturesValidate() "+(2&e?"checked":"")+">"+(4==currentMesh.mtype?"Synchronizujte název zařízení serveru s názvem portu":"Synchronizovat název zařízení na serveru s názvem stroje"))+"</label><br></div><div><label><input type=checkbox id=d20flag1 onchange=p20editmeshfeaturesValidate() "+(1&e?"checked":"")+">Při odpojení zařízení odebrat</label><br></div>")+"<div><label><input type=checkbox id=d20expireDevice onchange=p20editmeshfeaturesValidate() "+(0<n?"checked":"")+'>Automaticky odebrat neaktivní zařízení</label><br></div><div style=margin-left:20px id=d20expireDeviceDev>Deaktivujte dny do odstranění <label><input type=number inputmode=numeric onchange=p20editmeshfeaturesValidate() onkeyup=p20editmeshfeaturesValidate() onpaste=p20editmeshfeaturesValidate() onkeydown=p20editmeshfeaturesValidate() maxlength=4 min=1 max=2000 style=width:80px value="'+(0==n?30:n)+'" id=d20expireDeviceDays></label><br></div>',serverinfo.autoremoveinactivedevices&&(1==serverinfo.autoremoveinactivedevices?t+=format("<span style=font-size:x-small;margin-left:6px>Ve výchozím nastavení budou neaktivní zařízení odstraněna po 1 dni.</span>",serverinfo.autoremoveinactivedevices):t+=format("<span style=font-size:x-small;margin-left:6px>Ve výchozím nastavení budou neaktivní zařízení odstraněna po {0} dnech.</span>",serverinfo.autoremoveinactivedevices)),setDialogMode(2,"Upravit vlastnosti skupiny zařízení",3,p20editmeshfeaturesEx,t),p20editmeshfeaturesValidate())}function p20editmeshfeaturesValidate(){var e=0,t=!0,e=(2!=currentMesh.mtype&&4!=currentMesh.mtype||!Q("d20flag1").checked||(e+=1),QE("d20expireDevice",0==(1&e)),0==(1&e)&&Q("d20expireDevice").checked);QV("d20expireDeviceDev",e),e&&(e=parseInt(Q("d20expireDeviceDays").value),isNaN(e)||e<1||2e3<e||e!=Q("d20expireDeviceDays").value)&&(t=!1),QE("idx_dlgOkButton",t)}function p20editmeshfeaturesEx(){var e=0,t=(2!=currentMesh.mtype&&4!=currentMesh.mtype||(Q("d20flag1").checked&&(e+=1),Q("d20flag2").checked&&(e+=2)),1==serverinfo.devGroupSessionRecording&&4!=currentMesh.mtype&&Q("d20flag4").checked&&(e+=4),0);0==(1&e)&&Q("d20expireDevice").checked&&(t=parseInt(Q("d20expireDeviceDays").value)),meshserver.send({action:"editmesh",meshid:currentMesh._id,flags:e,expireDevs:t})}function p20showAddMeshUserDialog(e,t){if(!xxdialogMode){var n="";if(null==e||5==e)null==t&&(n+=null==e?"Umožnit uživatelům spravovat tuto skupinu a zařízení v této skupině.":"Povolit uživatelům spravovat toto zařízení.",524288&features&&(n+=" Než budou moci být přiřazeni ke skupině zařízení, je třeba aby se uživatelé alespoň jednou k tomuto serveru přihlásili."),n+="<br /><br />"),n=(n+="<div style='position:relative'>")+addHtmlValue("Identifikátory uživatelů",'<input id=dp20username style=width:230px maxlength=256 onchange=p20validateAddMeshUserDialog() onkeyup=p20validateAddMeshUserDialog() placeholder="user1, user2, user3" />')+"<div id=dp20usersuggest class=suggestionBox style='top:30px;left:130px;display:none'></div></div><br>";else if(1==e){var o="";if(null==t)for(l in a=getOrderedList(meshes,"name"))null!=currentUser.links&&null!=currentUser.links[a[l]._id]||(o+="<option value="+encodeURIComponentEx(a[l]._id)+">"+EscapeHtml(a[l].name)+"</option>");else o+="<option value="+t+">"+EscapeHtml(meshes[decodeURIComponent(t)].name)+"</option>";n+=addHtmlValue("Skupina zařízení","<div style=width:230px;margin:0;padding:0><select onchange=p20validateAddMeshUserDialog() id=dp2groupid style=width:100%"+(t?" disabled":"")+">"+o+"</select></div>")}else if(2==e){if(null==usergroups)return;o="";for(l in i=getOrderedList(usergroups,"name"))currentMesh._id.split("/")[1]!=i[l]._id.split("/")[1]||null!=currentMesh.links&&null!=currentMesh.links[i[l]._id]||(o+="<option value="+encodeURIComponentEx(i[l]._id)+">"+EscapeHtml(i[l].name)+"</option>");n+=addHtmlValue("Skupina uživatelů","<div style=width:230px;margin:0;padding:0><select onchange=p20validateAddMeshUserDialog() id=dp2groupid style=width:100%>"+o+"</select></div>")}else if(6==e){if(null==usergroups)return;var i,o="";if(null==t)for(l in i=getOrderedList(usergroups,"name"))null!=i[l].membershipType||currentNode._id.split("/")[1]!=i[l]._id.split("/")[1]||null!=currentNode.links&&null!=currentNode.links[i[l]._id]||(o+="<option value="+encodeURIComponentEx(i[l]._id)+">"+EscapeHtml(i[l].name)+"</option>");else o+="<option value="+t+">"+EscapeHtml(usergroups[decodeURIComponent(t)].name)+"</option>";n+=addHtmlValue("Skupina uživatelů","<div style=width:230px;margin:0;padding:0><select onchange=p20validateAddMeshUserDialog() id=dp2groupid style=width:100%"+(t?" disabled":"")+">"+o+"</select></div>")}else if(3==e){o="";for(l in t=t&&decodeURIComponent(t),a=getOrderedList(meshes,"name"))null==t&&null!=currentUserGroup.links&&null!=currentUserGroup.links[a[l]._id]||(o+="<option value="+encodeURIComponentEx(a[l]._id)+(t==a[l]._id?" selected":" ")+">"+EscapeHtml(a[l].name)+"</option>");n+=addHtmlValue("Skupina zařízení","<div style=width:230px;margin:0;padding:0><select onchange=p20validateAddMeshUserDialog("+e+") id=dp2groupid style=width:100%>"+o+"</select></div>")}else if(4==e||7==e){var a,o="",s=null,r=null;for(l in null!=t&&null!=(r=getNodeFromId(decodeURIComponent(t)))&&(s=r.meshid),a=getOrderedList(meshes,"name"))null!=a[l].links[userinfo._id]&&7&a[l].links[userinfo._id].rights&&(null==s&&(s=a[l]._id),o+="<option value="+encodeURIComponentEx(a[l]._id)+(s==a[l]._id?" selected":" ")+">"+EscapeHtml(a[l].name)+"</option>");n+=addHtmlValue("Skupina zařízení","<div style=width:230px;margin:0;padding:0><select onchange=p20changeMeshAddMeshUserDialog("+e+") id=dp2meshid style=width:100%>"+o+"</select></div>"),o="";var l,d=getOrderedList(nodes,"name");for(l in d)d[l].meshid==s&&(o+="<option value="+encodeURIComponentEx(d[l]._id)+(r==d[l]?" selected":" ")+">"+EscapeHtml(d[l].name)+"</option>");n+=addHtmlValue("Zařízení","<div style=width:230px;margin:0;padding:0><select onchange=p20validateAddMeshUserDialog("+e+") id=dp2nodeid style=width:100%>"+o+"</select></div>")}else{var u=(e=decodeURIComponent(e)).split("/")[2];users&&users[e]&&(u=users[e].name),usergroups&&usergroups[e]&&(u=usergroups[e].name),userinfo._id==e&&(u=userinfo.name),e.startsWith("ugrp/")?n+=format("Oprávnění skupiny na {0}.",u)+"<br /><br />":n+=format("Oprávnění skupiny pro uživatele {0}.",u)+"<br /><br />"}var u=-1,c=4!=e&&5!=e&&6!=e&&7!=e;n+='<div style="height:120px;overflow-y:scroll;border:1px solid gray;resize:vertical;">',c&&(n+="<label><input type=checkbox onchange=p20validateAddMeshUserDialog() id=p20fulladmin>Administrátor</label><br><label><input type=checkbox onchange=p20validateAddMeshUserDialog() id=p20editmesh>Upravit skupinu zařízení</label><br><label><input type=checkbox onchange=p20validateAddMeshUserDialog() id=p20manageusers>Spravovat uživatele pro skupinu zařízení</label><br><label><input type=checkbox onchange=p20validateAddMeshUserDialog() id=p20managecomputers>Spravovat počítače ve skupině zařízení</label><br>"),n=(n+="<label><input type=checkbox onchange=p20validateAddMeshUserDialog() id=p20remotecontrol>Remote Control & Relay</label><br>")+"<label><input type=checkbox onchange=p20validateAddMeshUserDialog() id=p20remoteview style=margin-left:12px>Pouze prohlížení na dálku</label><br>"+"<label><input type=checkbox onchange=p20validateAddMeshUserDialog() id=p20remotelimitedinput style=margin-left:12px>Pouze omezený vstup</label><br>",!1!==serverinfo.guestdevicesharing&&(n+="<label><input type=checkbox onchange=p20validateAddMeshUserDialog() id=p20guestshare style=margin-left:12px>Sdílení hostů</label><br>"),n=(n=(n=(n=(n=(n=(n=(n=n+"<label><input type=checkbox onchange=p20validateAddMeshUserDialog() id=p20nodesktop style=margin-left:12px>Žádný přístup na plochu</label><br>"+"<label><input type=checkbox onchange=p20validateAddMeshUserDialog() id=p20noterminal style=margin-left:12px>Žádný přístup k terminálu</label><br>")+"<label><input type=checkbox onchange=p20validateAddMeshUserDialog() id=p20nofiles style=margin-left:12px>Žádný přístup k souborům</label><br>"+"<label><input type=checkbox onchange=p20validateAddMeshUserDialog() id=p20noamt style=margin-left:12px>Žádné Intel&reg; AMT</label><br>")+"<label><input type=checkbox onchange=p20validateAddMeshUserDialog() id=p20meshagentconsole>Konzole agenta</label><br>"+"<label><input type=checkbox onchange=p20validateAddMeshUserDialog() id=p20meshserverfiles>Soubory serveru</label><br>")+"<label><input type=checkbox onchange=p20validateAddMeshUserDialog() id=p20wakedevices>Probudit zařízení</label><br>"+"<label><input type=checkbox onchange=p20validateAddMeshUserDialog() id=p20editnotes>Upravit popis zařízení</label><br>")+"<label><input type=checkbox onchange=p20validateAddMeshUserDialog() id=p20limitevents>Zobrazit pouze vlastní události</label><br>"+"<label><input type=checkbox onchange=p20validateAddMeshUserDialog() id=p20chatnotify>Chat a upozornění</label><br>")+"<label><input type=checkbox onchange=p20validateAddMeshUserDialog() id=p20uninstall>Odinstalujte agenta / smažte zařízení</label><br>"+"<label><input type=checkbox onchange=p20validateAddMeshUserDialog() id=p20commands>Dálkové příkazy</label><br>")+"<label><input type=checkbox onchange=p20validateAddMeshUserDialog() id=p20resetoff>Reset / Vypnutí</label><br>"+"<label><input type=checkbox onchange=p20validateAddMeshUserDialog() id=p20details>Podrobnosti o zařízení</label><br>")+"<label><input type=checkbox onchange=p20validateAddMeshUserDialog() id=p20relay>Use as Relay</label><br>"+"</div>",null==e?(setDialogMode(2,"Přidat uživatele do skupiny zařizení",3,p20showAddMeshUserDialogEx,n),QE("p20fulladmin",4294967295==GetMeshRights(currentMesh)),Q("dp20username").focus()):1===e?(setDialogMode(2,null==t?"Přidejte oprávnění skupiny zařízení":"Upravit oprávnění na skupinu zařízení",t?7:3,p20showAddMeshUserDialogEx,n,e),4294967295==(u=null!=t?meshes[decodeURIComponent(t)].links[currentUser._id].rights:u)&&(Q("p20fulladmin").checked=!0,u=-1)):2===e?(setDialogMode(2,"Přidat skupinu uživatelů",3,p20showAddMeshUserDialogEx,n,e),QE("p20fulladmin",4294967295==GetMeshRights(currentMesh))):3===e?(setDialogMode(2,null==t?"Přidat skupinu zařízení":"Upravit skupinu zařízení",t?7:3,p20showAddMeshUserDialogEx,n,e),QE("dp2groupid",null==t),4294967295==(u=null!=t?currentUserGroup.links[decodeURIComponent(t)].rights:u)&&(Q("p20fulladmin").checked=!0,u=-1)):4===e?(setDialogMode(2,null==t?"Přidat oprávnění zařízení":"Upravit oprávnění zařízení",t?7:3,p20showAddMeshUserDialogEx,n,e),QE("dp2meshid",null==t),QE("dp2nodeid",null==t)):7===e?(setDialogMode(2,null==t?"Přidat oprávnění zařízení":"Upravit oprávnění zařízení",t?7:3,p20showAddMeshUserDialogEx,n,e),QE("dp2meshid",null==t),QE("dp2nodeid",null==t),null!=t&&(u=currentUserGroup.links[decodeURIComponent(t)].rights,QE("dp20username",!1))):5===e?(setDialogMode(2,t?"Upravit oprávnění uživatelského zařízení":"Přidat oprávnění uživatelského zařízení",t?7:3,p20showAddMeshUserDialogEx,n,e),null!=t&&(t=decodeURIComponent(t),null!=users&&null!=users[t]?Q("dp20username").value=users[t].name:Q("dp20username").value=t.split("/")[2],u=currentNode.links[t].rights,QE("dp20username",!1)),Q("dp20username").focus()):6===e?(setDialogMode(2,t?"Upravit oprávnění skupiny uživatelů":"Přidejte oprávnění skupiny uživatelů",t?7:3,p20showAddMeshUserDialogEx,n,e),null!=t&&(u=currentNode.links[decodeURIComponent(t)].rights)):(e.startsWith("ugrp/")?setDialogMode(2,"Upravit oprávnění na skupinu zařízení",7,p20showAddMeshUserDialogEx,n,e):setDialogMode(2,"Upravit oprávnění uživatele pro skupinu zařízení",7,p20showAddMeshUserDialogEx,n,e),GetMeshRights(currentMesh),4294967295==(u=GetMeshRights(currentMesh,e))&&(Q("p20fulladmin").checked=!0,u=-1),QE("p20fulladmin",4294967295==GetMeshRights(currentMesh))),-1!=u&&(c&&(1&u&&(Q("p20editmesh").checked=!0),2&u&&(Q("p20manageusers").checked=!0),4&u)&&(Q("p20managecomputers").checked=!0),8&u&&(Q("p20remotecontrol").checked=!0,65536&u&&(Q("p20nodesktop").checked=!0),256&u&&(Q("p20remoteview").checked=!0),524288&u&&!1!==serverinfo.guestdevicesharing&&(Q("p20guestshare").checked=!0),512&u&&(Q("p20noterminal").checked=!0),1024&u&&(Q("p20nofiles").checked=!0),2048&u&&(Q("p20noamt").checked=!0),4096&u)&&(Q("p20remotelimitedinput").checked=!0),16&u&&(Q("p20meshagentconsole").checked=!0),32&u&&(Q("p20meshserverfiles").checked=!0),64&u&&(Q("p20wakedevices").checked=!0),128&u&&(Q("p20editnotes").checked=!0),8192&u&&(Q("p20limitevents").checked=!0),16384&u&&(Q("p20chatnotify").checked=!0),32768&u&&(Q("p20uninstall").checked=!0),131072&u&&(Q("p20commands").checked=!0),262144&u&&(Q("p20resetoff").checked=!0),524288&u&&!1!==serverinfo.guestdevicesharing&&(Q("p20guestshare").checked=!0),1048576&u&&(Q("p20details").checked=!0),2097152&u)&&(Q("p20relay").checked=!0),p20validateAddMeshUserDialog(e)}return!1}function p20changeMeshAddMeshUserDialog(e){var t,n="",o=decodeURIComponent(Q("dp2meshid").value);for(t in nodes)nodes[t].meshid==o&&(n+="<option value="+encodeURIComponentEx(nodes[t]._id)+">"+EscapeHtml(nodes[t].name)+"</option>");QH("dp2nodeid",n),p20validateAddMeshUserDialog(e)}function p20setname(e){e=decodeURIComponent(e);var t,n=Q("dp20username").value.split(",");for(t in n)n[t]=n[t].trim();return n[n.length-1]=e,Q("dp20username").value=n.join(", "),p20validateAddMeshUserDialog(),!1}function p20validateAddMeshUserDialog(e){var t,n,o=!0;if(4===e&&(e=0,""!=(t=decodeURIComponent(Q("dp2nodeid").value))&&null!=currentUser.links&&null!=currentUser.links[t]&&(e=currentUser.links[t].rights),Q("p20remotecontrol").checked=0!=(8&e),Q("p20meshagentconsole").checked=0!=(16&e),Q("p20meshserverfiles").checked=0!=(32&e),Q("p20wakedevices").checked=0!=(64&e),Q("p20editnotes").checked=0!=(128&e),Q("p20remoteview").checked=0!=(256&e),Q("p20noterminal").checked=0!=(512&e),Q("p20nofiles").checked=0!=(1024&e),Q("p20noamt").checked=0!=(2048&e),Q("p20remotelimitedinput").checked=0!=(4096&e),Q("p20limitevents").checked=0!=(8192&e),Q("p20chatnotify").checked=0!=(16384&e),Q("p20uninstall").checked=0!=(32768&e),Q("p20nodesktop").checked=0!=(65536&e),Q("p20commands").checked=0!=(131072&e),Q("p20resetoff").checked=0!=(262144&e),!1!==serverinfo.guestdevicesharing&&(Q("p20guestshare").checked=0!=(524288&e)),Q("p20details").checked=0!=(1048576&e),Q("p20relay").checked=0!=(2097152&e),o=""!=t),Q("dp20username")){var i=Q("dp20username").value.split(",");for(u in i){var a=i[u]=i[u].trim();(0==a.length||0<=a.indexOf('"'))&&(o=!1)}var e=!1,s=!1;if(null!=users){var r=i[i.length-1].trim(),l=r.toLowerCase(),d=[];if(0<r.length){for(var u in users){var c=users[u]._id.split("/");if((null==currentMesh||currentMesh.domain==c[1])&&(null==currentNode||currentNode.domain==c[1])){if(c[2]===l){s=!0;break}if(0<=users[u].name.toLowerCase().indexOf(l)&&(d.push([users[u]._id,users[u].name]),8<=d.length))break}}if(0==s&&0<d.length){var p="";for(u in d){var m=d[u][0],v=d[u][1];m.split("/")[2]==v.toLowerCase()?p+="<div class=suggestionBoxItem onclick='p20setname(\""+encodeURIComponentEx(m.split("/")[2])+"\")'>"+EscapeHtml(v)+"</div>":p+="<div class=suggestionBoxItem onclick='p20setname(\""+encodeURIComponentEx(m.split("/")[2])+"\")'><div>"+EscapeHtml(v)+"</div><div class=suggestionBoxSubItem>"+EscapeHtml(m.split("/")[2])+"</div></div>"}QH("dp20usersuggest",p),e=!0}}}QV("dp20usersuggest",e)}QE("idx_dlgOkButton",o),null!=Q("p20fulladmin")?(n=!Q("p20fulladmin").checked,QE("p20editmesh",n),QE("p20manageusers",n),QE("p20managecomputers",n)):n=""!=t,QE("p20remotecontrol",n),QE("p20meshagentconsole",n),QE("p20meshserverfiles",n),QE("p20wakedevices",n),QE("p20editnotes",n),QE("p20limitevents",n),QE("p20remoteview",n&&Q("p20remotecontrol").checked),!1!==serverinfo.guestdevicesharing&&QE("p20guestshare",n&&Q("p20remotecontrol").checked&&(Q("p20remoteview").checked||!Q("p20remotelimitedinput").checked)),QE("p20remotelimitedinput",n&&Q("p20remotecontrol").checked&&!Q("p20remoteview").checked),QE("p20nodesktop",n&&Q("p20remotecontrol").checked),QE("p20noterminal",n&&Q("p20remotecontrol").checked),QE("p20nofiles",n&&Q("p20remotecontrol").checked),QE("p20noamt",n&&Q("p20remotecontrol").checked),QE("p20chatnotify",n),QE("p20uninstall",n),QE("p20commands",n),QE("p20resetoff",n),QE("p20details",n),QE("p20relay",n)}function p20showAddMeshUserDialogEx(e,t){var n,o,i=0;if(null!=Q("p20fulladmin")&&1==Q("p20fulladmin").checked?i=4294967295:(null!=Q("p20fulladmin")&&(1==Q("p20editmesh").checked&&(i+=1),1==Q("p20manageusers").checked&&(i+=2),1==Q("p20managecomputers").checked)&&(i+=4),1==Q("p20remotecontrol").checked&&(i+=8),1==Q("p20meshagentconsole").checked&&(i+=16),1==Q("p20meshserverfiles").checked&&(i+=32),1==Q("p20wakedevices").checked&&(i+=64),1==Q("p20editnotes").checked&&(i+=128),1==Q("p20remoteview").checked&&(i+=256),1==Q("p20nodesktop").checked&&(i+=65536),1==Q("p20noterminal").checked&&(i+=512),1==Q("p20nofiles").checked&&(i+=1024),1==Q("p20noamt").checked&&(i+=2048),1!=Q("p20remotelimitedinput").checked||Q("p20remoteview").checked||(i+=4096),1==Q("p20limitevents").checked&&(i+=8192),1==Q("p20chatnotify").checked&&(i+=16384),1==Q("p20uninstall").checked&&(i+=32768),1==Q("p20commands").checked&&(i+=131072),1==Q("p20resetoff").checked&&(i+=262144),!1===serverinfo.guestdevicesharing||1!=Q("p20guestshare").checked||!Q("p20remoteview").checked&&(Q("p20remoteview").checked||Q("p20remotelimitedinput").checked)||(i+=524288),1==Q("p20details").checked&&(i+=1048576),1==Q("p20relay").checked&&(i+=2097152)),0==(8&i)&&(256&i&&(i-=256),512&i&&(i-=512),1024&i&&(i-=1024),2048&i&&(i-=2048),4096&i&&(i-=4096),65536&i)&&(i-=65536),1===t){var a=decodeURIComponent(Q("dp2groupid").value);null!=(r=meshes[a])&&meshserver.send({action:"addmeshuser",meshid:a,meshname:r.name,userids:[currentUser._id],meshadmin:i,remove:2==e})}else if(2===t){var s=decodeURIComponent(Q("dp2groupid").value);null!=(r=meshes[currentMesh._id])&&meshserver.send({action:"addmeshuser",meshid:currentMesh._id,meshname:currentMesh.name,userid:s,meshadmin:i,remove:2==e})}else if(3===t){var r,a=decodeURIComponent(Q("dp2groupid").value);null!=(r=meshes[a])&&meshserver.send({action:"addmeshuser",meshid:a,meshname:r.name,userids:[currentUserGroup._id],meshadmin:i,remove:2==e})}else if(4===t)null!=(o=getNodeFromId(n=decodeURIComponent(Q("dp2nodeid").value)))&&meshserver.send({action:"adddeviceuser",nodeid:n,nodename:o.name,userids:[currentUser._id],rights:i,remove:2==e});else if(5===t){var l=[];for(u in d=Q("dp20username").value.split(","))l.push(d[u].trim());meshserver.send({action:"adddeviceuser",nodeid:currentNode._id,nodename:currentNode.name,usernames:l,rights:i,remove:2==e})}else if(6===t){s=decodeURIComponent(Q("dp2groupid").value);null!=currentNode&&meshserver.send({action:"adddeviceuser",nodeid:currentNode._id,nodename:currentNode.name,userids:[s],rights:i,remove:2==e})}else if(7===t)null!=(o=getNodeFromId(n=decodeURIComponent(Q("dp2nodeid").value)))&&meshserver.send({action:"adddeviceuser",nodeid:n,nodename:o.name,userids:[currentUserGroup._id],rights:i,remove:2==e});else if(null==t){var d,u,l=[];for(u in d=Q("dp20username").value.split(","))l.push(d[u].trim());meshserver.send({action:"addmeshuser",meshid:currentMesh._id,meshname:currentMesh.name,usernames:l,meshadmin:i,remove:2==e})}else meshserver.send({action:"addmeshuser",meshid:currentMesh._id,meshname:currentMesh.name,userids:[t],meshadmin:i,remove:2==e})}function p20viewuser(e){var t,n,o,i,a,s;xxdialogMode||(t=decodeURIComponent(e),n=GetMeshRights(currentMesh),o=GetMeshRights(currentMesh,t),userinfo._id!=t&&(4294967295==n||0!=(2&n)&&4294967295!=o)?p20showAddMeshUserDialog(e):(e=[],4294967295==o?e.push("Administrátor (všechna oprávnění)"):(0!=(1&o)&&e.push("Upravit skupinu zařízení"),0!=(2&o)&&e.push("Spravovat uživatele pro skupinu zařízení"),0!=(4&o)&&e.push("Spravovat počítače ve skupině zařízení"),0!=(8&o)&&e.push("Ovládání na dálku"),0!=(16&o)&&e.push("Konzole agenta"),0!=(32&o)&&e.push("Soubory serveru"),0!=(64&o)&&e.push("Probudit zařízení"),0!=(128&o)&&e.push("Upravit poznámky"),0!=(8&o)&&0!=(256&o)&&e.push("Pouze prohlížení na dálku"),0!=(8&o)&&0!=(65536&o)&&e.push("Žádná plocha"),0!=(8&o)&&0!=(512&o)&&e.push("Žádný terminál"),0!=(8&o)&&0!=(1024&o)&&e.push("Žádné soubory"),0!=(8&o)&&0!=(2048&o)&&e.push("Žádné Intel&reg; AMT"),0!=(8&o)&&0!=(4096&o)&&0==(256&o)&&e.push("Omezený vstup"),0!=(8192&o)&&e.push("Pouze vlastní události"),0!=(16384&o)&&e.push("Chat a upozornění"),0!=(32768&o)&&e.push("Odinstalace"),0!=(131072&o)&&e.push("Příkazy"),0!=(262144&o)&&e.push("Reset / Vypnuto"),0!=(524288&o)&&e.push("Sdílení"),0!=(1048576&o)&&e.push("Podrobnosti"),0!=(2097152&o)&&e.push("Předávání (relay)")),0==e.length&&e.push("Žádná práva"),i=t.split("/")[2],users&&users[t]&&(i=users[t].name),userinfo._id==t&&(i=userinfo.name),a=1,s=addHtmlValue("Uživatelské jméno",EscapeHtml(decodeURIComponent(i))),t.split("/")[2]!=i&&(s+=addHtmlValue("Identifikátor uživatele",EscapeHtml(t.split("/")[2]))),s+=addHtmlValue("Oprávnění",e.join(", ")),userinfo._id!=t&&(4294967295==n||0!=(2&n)&&4294967295!=o)&&(a+=4),setDialogMode(2,"Uživatel této skupiny zařízení",a,p20viewuserEx,s,t)))}function p20viewuserEx(e,t){2==e&&(e=t.split("/")[2],users&&users[t]&&(e=users[t].name),usergroups&&usergroups[t]&&(e=usergroups[t].name),userinfo._id==t&&(e=userinfo.name),t.startsWith("user/")&&setDialogMode(2,"Odebrat uživatelská oprávnění",3,p20viewuserEx2,format("Potvrdit odebrání práv uživateli „{0}“?",EscapeHtml(decodeURIComponent(e))),t),t.startsWith("ugrp/"))&&setDialogMode(2,"Odebrat oprávnění skupiny uživatelů",3,p20viewuserEx2,format("Potvrdit odebrání práv skupině uživatelů „{0}“?",EscapeHtml(decodeURIComponent(e))),t)}function p20deleteUser(e,t){return haltEvent(e),p20viewuserEx(2,decodeURIComponent(t)),!1}function p20viewuserEx2(e,t){meshserver.send({action:"removemeshuser",meshid:currentMesh._id,meshname:currentMesh.name,userid:t})}function p20editmeshInviteCode(){if(xxdialogMode)return!1;var e,t=GetMeshRights(currentMesh),n=serverinfo.name;-1!=n.indexOf(".")&&0==(2&features)||(n=window.location.hostname),n=1==serverinfo.https?"https://"+n+(443==serverinfo.port?"":":"+serverinfo.port)+domainUrl+"invite"+(urlargs.key?"?key="+urlargs.key:""):"http://"+n+(80==serverinfo.port?"":":"+serverinfo.port)+domainUrl+"invite"+(urlargs.key?"?key="+urlargs.key:""),1&t?(setDialogMode(2,"Pozvat kódy",3,p20editmeshInviteCodeEx,e=(e=(e=(e=(e="Pokud je tato možnost povolena, může kdokoli použít k připojení zařízení k této skupině zařízení pomocí následujícího veřejného odkazu:<br /><br />")+('<div style=width:100%;text-align:center><a rel="noreferrer noopener" target=_blank href="'+n+'">'+n+"</a></div><br />")+"<div style=margin-bottom:5px><label><input id=agentJoinCheck type=checkbox onclick=p20editmeshInviteCodeValidate() />Povolit kódy pozvání</label></div>")+addHtmlValue("Pozvat kódy",'<input id=agentInviteCode style=width:236px onkeyup=p20editmeshInviteCodeValidate() placeholder="code1, code2, code3" />'))+addHtmlValue("Agenti","<select id=agentType style=width:236px onchange=p20editmeshInviteCodeValidate()><option value=0>Všichni dostupní agenti</option><option value=1>Windows MeshAgent</option><option value=2>Linux MeshAgent</option><option value=4>MacOS MeshAgent</option><option value=8>Asistent MeshCentral</option></select>")+"<div id=d2agentInstallTypeDiv>")+addHtmlValue("Typ instalace","<select id=agentInviteType style=width:236px><option value=0>Bezobslužná a interaktivní</option><option value=2>Pouze bezobslužná</option><option value=1>Pouze interaktivní</option></select>")+"</div>"),null!=currentMesh.invite&&(Q("agentJoinCheck").checked=!0,Q("agentInviteCode").value=currentMesh.invite.codes.join(", "),currentMesh.invite.ag&&(Q("agentType").value=currentMesh.invite.ag),Q("agentInviteType").value=3&currentMesh.invite.flags),p20editmeshInviteCodeValidate()):(e="Kódy pozvání může použít kdokoli pro připojení zařízení k této skupině zařízení pomocí následujícího veřejného odkazu:<br /><br />",setDialogMode(2,"Pozvat kódy",1,null,e=(e=(e+='<div style=width:100%;text-align:center><a rel="noreferrer noopener" target=_blank href="'+n+'">'+n+"</a></div><br />")+addHtmlValue("Pozvat kódy",currentMesh.invite.codes.join(", ")))+addHtmlValue("Typ instalace",["Bezobslužná a interaktivní","Pouze interaktivní","Pouze bezobslužná"][3&currentMesh.invite.flags])))}function p20editmeshInviteCodeValidate(){var e,t=!0,n=Q("agentInviteCode").value.split(",");for(e in n)n[e]=n[e].trim(),""==n[e]&&(t=!1);QE("agentInviteCode",Q("agentJoinCheck").checked),QE("agentType",Q("agentJoinCheck").checked),QE("agentInviteType",Q("agentJoinCheck").checked),QE("idx_dlgOkButton",0==Q("agentJoinCheck").checked||t),QV("d2agentInstallTypeDiv",parseInt(Q("agentType").value)<2)}function p20editmeshInviteCodeEx(){if(1==Q("agentJoinCheck").checked){var e,t=Q("agentInviteCode").value.split(",");for(e in t)t[e]=t[e].trim();meshserver.send({action:"editmesh",meshid:currentMesh._id,invite:{codes:t,flags:parseInt(Q("agentInviteType").value),ag:parseInt(Q("agentType").value)}})}else meshserver.send({action:"editmesh",meshid:currentMesh._id,invite:"*"})}function p20editMeshNotify(){var e,t,n;return xxdialogMode||(e=0,t=16384&features2&&userinfo.emailVerified,userinfo.links&&userinfo.links[currentMesh._id]&&userinfo.links[currentMesh._id].notify&&(e|=userinfo.links[currentMesh._id].notify),userinfo.notify&&userinfo.notify[currentMesh._id]&&(e|=userinfo.notify[currentMesh._id]),n='<div style="border-bottom: 1px solid #888;margin-bottom:3px">Upozornění na webové stránce</div><div><label><input id=p20notifyIntelDeviceConnect type=checkbox />Připojení zařízení</label></div><div><label><input id=p20notifyIntelDeviceDisconnect type=checkbox />Odpojení zařízení</label></div>',currentMesh.mtype<3&&(n+="<div><label><input id=p20notifyIntelAmtKvmActions type=checkbox />Události Intel&reg; AMT desktop a serial</label></div>"),t&&(n+='<br /><div style="border-bottom: 1px solid #888;margin-bottom:3px">E-mailová upozornění</div><div><label><input id=p20enotifyIntelDeviceConnect type=checkbox />Připojení zařízení</label></div><div><label><input id=p20enotifyIntelDeviceDisconnect type=checkbox />Odpojení zařízení</label></div><div><label><input id=p20enotifyIntelDeviceHelp type=checkbox />Help requests</label></div>'),null!=userinfo.msghandle&&0!=(33554432&features2)&&(n+='<br /><div style="border-bottom: 1px solid #888;margin-bottom:3px">Messaging Notifications</div><div><label><input id=p20emsgDeviceConnect type=checkbox />Připojení zařízení</label></div><div><label><input id=p20emsgDeviceDisconnect type=checkbox />Odpojení zařízení</label></div><div><label><input id=p20emsgDeviceHelp type=checkbox />Help requests</label></div>'),setDialogMode(2,"Nastavení upozornění",3,p20editMeshNotifyEx,n,t),Q("p20notifyIntelDeviceConnect").checked=2&e,Q("p20notifyIntelDeviceDisconnect").checked=4&e,currentMesh.mtype<3&&(Q("p20notifyIntelAmtKvmActions").checked=8&e),t&&(Q("p20enotifyIntelDeviceConnect").checked=16&e,Q("p20enotifyIntelDeviceDisconnect").checked=32&e,Q("p20enotifyIntelDeviceHelp").checked=64&e),null!=userinfo.msghandle&&0!=(33554432&features2)&&(Q("p20emsgDeviceConnect").checked=128&e,Q("p20emsgDeviceDisconnect").checked=256&e,Q("p20emsgDeviceHelp").checked=512&e)),!1}function p20editMeshNotifyEx(e,t){var n=0,n=(n+=Q("p20notifyIntelDeviceConnect").checked?2:0)+(Q("p20notifyIntelDeviceDisconnect").checked?4:0);currentMesh.mtype<3&&(n+=Q("p20notifyIntelAmtKvmActions").checked?8:0),t&&(n=(n=(n+=Q("p20enotifyIntelDeviceConnect").checked?16:0)+(Q("p20enotifyIntelDeviceDisconnect").checked?32:0))+(Q("p20enotifyIntelDeviceHelp").checked?64:0)),null!=userinfo.msghandle&&0!=(33554432&features2)&&(n=(n=(n+=Q("p20emsgDeviceConnect").checked?128:0)+(Q("p20emsgDeviceDisconnect").checked?256:0))+(Q("p20emsgDeviceHelp").checked?512:0)),meshserver.send({action:"changemeshnotify",meshid:currentMesh._id,notify:n})}function setupMeshSummaryStats(){window.meshPowerChart=new Chart(document.getElementById("meshPowerChart").getContext("2d"),{type:"doughnut",data:{datasets:[{data:[0,0],backgroundColor:["#20F","#40D","#60B","#809","#A07","#C05"]}]},options:{shadowColor:"blue",responsive:!0,plugins:{legend:{display:!1}},animation:{animateScale:!0,animateRotate:!0},layout:{padding:{left:10,right:10,top:10,bottom:10}}}}),window.meshOsChart=new Chart(document.getElementById("meshOsChart").getContext("2d"),{type:"doughnut",data:{datasets:[{data:[0,0],backgroundColor:["#20F","#30E","#40D","#50C","#60B","#70A","#809","#908","#A07","#B06","#C05"]}]},options:{responsive:!0,plugins:{legend:{display:!1}},animation:{animateScale:!0,animateRotate:!0},layout:{padding:{left:10,right:10,top:10,bottom:10}}}}),window.meshConnChart=new Chart(document.getElementById("meshConnChart").getContext("2d"),{type:"doughnut",data:{datasets:[{data:[0,0],backgroundColor:["#20F","#40D","#60B","#809","#A07","#C05"]}],labels:["Nepřipojeno","Agent","Intel&reg; AMT","Agent + Intel&reg; AMT"]},options:{responsive:!0,plugins:{legend:{display:!1}},animation:{animateScale:!0,animateRotate:!0},layout:{padding:{left:10,right:10,top:10,bottom:10}}}}),window.meshSecurityChart=new Chart(document.getElementById("meshSecurityChart").getContext("2d"),{type:"doughnut",data:{datasets:[{data:[0,0],backgroundColor:["#20F","#40D","#60B","#809","#A07","#C05"]}],labels:["OK","Antivirus není aktivní","Žádná automatická aktualizace","Firewall není aktivní","Více problémů"]},options:{responsive:!0,plugins:{legend:{display:!1}},animation:{animateScale:!0,animateRotate:!0},layout:{padding:{left:10,right:10,top:10,bottom:10}}}})}function p21updateMesh(){if(null!=currentMesh){var e,t=GetMeshRights(currentMesh),n=EscapeHtml(currentMesh.name),o=(0==n.length&&(n="<i>Nic</i>"),0!=(1&t)&&(n='<span tabindex=0 title="Kliknutím sem upravíte název skupiny zařízení" onclick=p20editmesh(1) onkeyup="if (event.key == \'Enter\') p20editmesh(1)" style=cursor:pointer>'+n+' <img class=hoverButton src="images/link5.png" /></span>'),QH("p21meshName",n),{}),i={},a=[0,0,0,0],s=[0,0,0,0,0],r=!1,l=!1,d=!1,u=!1;for(b in nodes)nodes[b].meshid==currentMesh._id&&(nodes[b].agent&&(r=!0,null==o[nodes[b].agent.id]?o[nodes[b].agent.id]=1:o[nodes[b].agent.id]++),nodes[b].pwr&&(l=!0,null==i[nodes[b].pwr]?i[nodes[b].pwr]=1:i[nodes[b].pwr]++),0==nodes[b].conn?(d=!0,a[0]++):0!=(6&nodes[b].conn)?(d=!0,0!=(1&nodes[b].conn)?a[3]++:a[2]++):0!=(1&nodes[b].conn)&&(d=!0,a[1]++),nodes[b].wsc)&&(u=!0,e=0,"OK"==nodes[b].wsc.antiVirus&&e++,"OK"==nodes[b].wsc.autoUpdate&&e++,"OK"==nodes[b].wsc.firewall&&e++,3==e?s[0]++:e<2?s[4]++:"OK"!=nodes[b].wsc.antiVirus?s[1]++:"OK"!=nodes[b].wsc.autoUpdate?s[2]++:"OK"!=nodes[b].wsc.firewall&&s[3]++);var c=[],p=[],m=[],v=[],g=3==currentMesh.mtype?agentsStrNoAgent:agentsStr;for(b in o)c.push(o[b]),p.push(g[b]);for(b in i)m.push(i[b]),v.push(powerStatetable[b]);window.meshPowerChart.config.data.datasets[0].data=m,window.meshPowerChart.config.data.labels=v,window.meshPowerChart.update(),2<=currentMesh.mtype&&(window.meshOsChart.config.data.datasets[0].data=c,window.meshOsChart.config.data.labels=p,window.meshOsChart.update()),window.meshConnChart.config.data.datasets[0].data=a,window.meshConnChart.update(),window.meshSecurityChart.config.data.datasets[0].data=s,window.meshSecurityChart.update();var h="",f=0;if(0<m.length){var k=[];for(b in i)k.push([powerStatetable[b],i[b]]);for(b in k.sort(function(e,t){return-(e[1]-t[1])}),h+='<table style="margin-top:10px;color:black;background-color:#EEE;border-color:#AAA;border-width:1px;border-style:solid;border-collapse:collapse" border=0 cellpadding=2 cellspacing=0 width=100%><tbody><tr style=background-color:#AAAAAA;font-weight:bold><th scope=col colspan=2 style=text-align:left;width:430px>Stavy napájení</th></tr>',k)h+="<tr style="+(++f%2==0?"background-color:#DDD":"")+"><td style=text-align:right;width:60px>"+k[b][1]+" <td> "+k[b][0]+"</tr>";h+="</tbody></table>"}if(0<c.length&&2<=currentMesh.mtype){var f=0,y=[];for(b in o)y.push([g[b],o[b]]);for(b in y.sort(function(e,t){return-(e[1]-t[1])}),h+='<table style="margin-top:10px;color:black;background-color:#EEE;border-color:#AAA;border-width:1px;border-style:solid;border-collapse:collapse" border=0 cellpadding=2 cellspacing=0 width=100%><tbody><tr style=background-color:#AAAAAA;font-weight:bold><th scope=col colspan=2 style=text-align:left;width:430px>Typy agenta</th></tr>',y)h+="<tr style="+(++f%2==0?"background-color:#DDD":"")+"><td style=text-align:right;width:60px>"+y[b][1]+"<td> "+y[b][0]+"</tr>";h+="</tbody></table>"}if(d){for(var x=[],b=f=0;b<4;b++)x.push([["Nepřipojeno","Agent","Intel&reg; AMT","Agent + Intel&reg; AMT"][b],a[b]]);x.sort(function(e,t){return-(e[1]-t[1])}),h+='<table style="margin-top:10px;color:black;background-color:#EEE;border-color:#AAA;border-width:1px;border-style:solid;border-collapse:collapse" border=0 cellpadding=2 cellspacing=0 width=100%><tbody><tr style=background-color:#AAAAAA;font-weight:bold><th scope=col colspan=2 style=text-align:left;width:430px>Konektivita</th></tr>';for(b=0;b<4;b++)0<x[b][1]&&(h+="<tr style="+(++f%2==0?"background-color:#DDD":"")+"><td style=text-align:right;width:60px>"+x[b][1]+"<td> "+x[b][0]+"</tr>");h+="</tbody></table>"}if(u){for(var w=[],b=f=0;b<4;b++)w.push([['<img src="images/link2.png" style=cursor:pointer onclick=\'return p21setDevicesFilter("wsc:ok")\' width=10 height=10 /> OK','<img src="images/link2.png" style=cursor:pointer onclick=\'return p21setDevicesFilter("wsc:noav")\' width=10 height=10 /> Antivirus není aktivní','<img src="images/link2.png" style=cursor:pointer onclick=\'return p21setDevicesFilter("wsc:noupdate")\' width=10 height=10 /> Žádná automatická aktualizace','<img src="images/link2.png" style=cursor:pointer onclick=\'return p21setDevicesFilter("wsc:nofirewall")\' width=10 height=10 /> Firewall není aktivní','<img src="images/link2.png" style=cursor:pointer onclick=\'return p21setDevicesFilter("wsc:any")\' width=10 height=10 /> Více problémů'][b],s[b]]);w.sort(function(e,t){return-(e[1]-t[1])}),h+='<table style="margin-top:10px;color:black;background-color:#EEE;border-color:#AAA;border-width:1px;border-style:solid;border-collapse:collapse" border=0 cellpadding=2 cellspacing=0 width=100%><tbody><tr style=background-color:#AAAAAA;font-weight:bold><th scope=col colspan=2 style=text-align:left;width:430px>Zabezpečení</th></tr>';for(b=0;b<4;b++)0<w[b][1]&&(h+="<tr style="+(++f%2==0?"background-color:#DDD":"")+"><td style=text-align:right;width:60px>"+w[b][1]+"<td> "+w[b][0]+"</tr>");h+="</tbody></table>"}""==h&&(h="<i>V této skupině nejsou žádná zařízení.</i>"),QH("p21info",h);t=(l?1:0)+(2<=currentMesh.mtype&&r?1:0)+(d?1:0)+(u?1:0);QS("meshPowerChartDiv").display=l?"inline-block":"none",QS("meshOsChartDiv").display=2<=currentMesh.mtype&&r?"inline-block":"none",QS("meshConnChartDiv").display=d?"inline-block":"none",QS("meshSecurityChartDiv").display=u?"inline-block":"none",QS("meshPowerChartDiv").width=3<t?"23%":"31%",QS("meshOsChartDiv").width=3<t?"23%":"31%",QS("meshConnChartDiv").width=3<t?"23%":"31%",QS("meshSecurityChartDiv").width=3<t?"23%":"31%"}}function p21setDevicesFilter(e){go(1),Q("KvmSearchInput").value=Q("SearchInput").value=e,mainUpdate(5)}var sortorder,filetreelocation=[];function updateFiles(){if(QV("MainMenuMyFiles",0==(8&features)),0==(8&features)){for(var e,t,n="",o="",i='<a href=# style=cursor:pointer onclick="return p5folderup(0)">Root</a>',a="Root",s=filetree,r=1,l=[],d=filetreelinkpath,u=[],c=document.getElementsByName("fc"),p=0;p<c.length;p++)c[p].checked&&u.push(c[p].value);for(p in filetreelinkpath="",filetreelocation){if(null==s.f||null==s.f[filetreelocation[p]])break;l.push(filetreelocation[p]),a+=" / "+filetreelocation[p],1==r?(e=filetreelocation[p].split("/"),t=window.location.origin+domainUrl+e[0]+"files/"+e[2],filetreelinkpath+=filetreelocation[p]):""!=filetreelinkpath&&(filetreelinkpath+="/"+filetreelocation[p],2<r)&&(t+="/"+filetreelocation[p]),s=s.f[filetreelocation[p]],i+=' / <a href=# style=cursor:pointer onclick="return p5folderup('+r+')">'+EscapeHtml(null!=s.n?s.n:filetreelocation[p])+"</a>",r++}filetreelocation=l;var m=a.toLowerCase().startsWith("root / "+userinfo._id+" / public"),v=p5sort_files(s.f);for(p in v){var g,h,f=v[p],k=f.n,y=70<k.length?'<span title="'+EscapeHtml(k)+'">'+EscapeHtml(k.substring(0,70))+"…</span>":EscapeHtml(k),x="",b=(null!=f.d&&(x=printDateTime(new Date(f.d))+"&nbsp;"),""),w=(null!=f.s&&(b=getFileSizeStr(f.s)),"");w=f.t<3||4==f.t?(g=1==f.t||4==f.t?p5getQuotabar(f):"",'<div class=filelist file=999><input file=999 style=float:left name=fc class=fcb type=checkbox onchange=p5setActions() value="'+EscapeHtml(k)+'">&nbsp;<span style=float:right title="">'+g+"</span><span><div class=fileIcon"+f.t+' onclick=p5folderset("'+encodeURIComponentEx(f.nx)+'")></div><a href=# style=cursor:pointer onclick=\'return p5folderset("'+encodeURIComponentEx(f.nx)+"\")'>"+y+"</a></span></div>"):(k=y,g="",h=urlargs.key?"&key="+urlargs.key:"",m&&(g='<img src="images/link2.png" style=cursor:pointer title="Zobrazit veřejný odkaz" onclick=\'return p5showPublicLink("'+t+"/"+encodeURIComponentEx(f.nx)+"?download=1"+h+'")\' width=10 height=10 /> <img src="images/link4.png" title="Kopírovat odkaz do schránky" style="cursor:pointer" onclick=copyTextToClip2("'+encodeURIComponentEx(t+"/"+encodeURIComponentEx(f.nx)+"?download=1"+h)+'") width=10 height=10>'),0<f.s&&(k=g+'<a onclick=downloadFile("downloadfile.ashx?link='+encodeURIComponentEx(filetreelinkpath+"/"+f.nx)+'")>'+y+"</a>"),'<div class=filelist file=3><input file=3 style=float:left name=fc class=fcb type=checkbox onchange=p5setActions() value="'+f.nx+'">&nbsp;<span class=fsize>'+x+"</span><span style=float:right>"+b+"</span><span><div class=fileIcon"+f.t+"></div>"+k+"</span></div>"),f.t<3?n+=w:o+=w}if(QH("p5rightOfButtons",p5getQuotabar(s)),QH("p5files",n+o),QH("p5currentpath",i),QE("p5FolderUp",0!=filetreelocation.length),QV("p5PublicShare",m),d==filetreelinkpath)for(c=document.getElementsByName("fc"),p=0;p<c.length;p++)c[p].checked=0<=u.indexOf(c[p].value);p5setActions()}}function getNiceSize(e){return e<=0?"Překročen limit pro ukládání":e<2048?format("{0} bajtů zbývá",e):e<2097152?format("{0} kilobajtů zbývá",Math.round(e/1024)):e<2147483648?format("{0} megabajtů zbývá",Math.round(e/1024/1024)):format("{0} gigabajtů zbývá",Math.round(e/1024/1024/1024))}function getNiceSize2(e){return e<=0?"Nic":e<2048?format("{0} b",e):e<2097152?format("{0} Kb",Math.round(e/1024)):e<2147483648?format("{0} Mb",Math.round(e/1024/1024)):format("{0} Gb",Math.round(e/1024/1024/1024))}function getNiceSize3(e){return e<=0?"Nic":e<2048?format("{0} b",e):e<2097152?format("{0} Kb",round(e/1024,1)):e<2147483648?format("{0} Mb",round(e/1024/1024,1)):format("{0} Gb",round(e/1024/1024/1024,1))}function p5getQuotabar(e){for(;1<e.t&&4!=e.t;)e=e.parent;var t,n;return 1!=e.t&&4!=e.t||null==e.maxbytes?"":(t=Math.floor(e.s/1024),n=e.maxbytes-e.s,'<span title="'+(1<e.c?format("{0}k v {1} souborech. {2}k maximum",t,e.c,Math.floor(e.maxbytes/1024/1024)):format("{0}k v 1 souboru. {1}k maximum",t,Math.floor(e.maxbytes/1024/1024)))+'">'+getNiceSize(n)+" <progress style=height:10px;width:100px value="+e.s+" max="+e.maxbytes+" /></span>")}function p5showPublicLink(e){return setDialogMode(2,"Veřejný odkaz",1,null,'<input type=text style=width:350px value="'+e+'" readonly /> <img src="images/link4.png" title="Kopírovat odkaz do schránky" style="cursor:pointer" onclick=copyTextToClip2("'+encodeURIComponentEx(e)+'") width=10 height=10>'),!1}function p5sort_filename(e,t){return e.ln>t.ln?+sortorder:e.ln<t.ln?-1*sortorder:0}function p5sort_timestamp(e,t){return e.d>t.d?+sortorder:e.d<t.d?-1*sortorder:0}function p5sort_bysize(e,t){return e.s==t.s?p5sort_filename(e,t):(e.s-t.s)*sortorder}function p5sort_files(e){var t,n=[],o=Q("p5sortdropdown").value;for(t in e)e[t].nx=t,null==e[t].n&&(e[t].n=t),e[t].ln=e[t].n.toLowerCase(),n.push(e[t]);return sortorder=1,3<o&&(sortorder=-1,o-=3),1==o?n.sort(p5sort_filename):2==o?n.sort(p5sort_bysize):3==o&&n.sort(p5sort_timestamp),n}function p5setActions(){var e=getFileSelCount(),t=getFileCount(),n=getFileSelCount(!1);QE("p5DeleteFileButton",0<e&&0<filetreelocation.length),QE("p5ViewFileButton",1==e&&1==n&&0<filetreelocation.length),QE("p5NewFolderButton",0<filetreelocation.length),QE("p5UploadButton",0<filetreelocation.length),QE("p5DownloadButton",0<e&&e==n&&0<filetreelocation.length),QE("p5RenameFileButton",1==e&&0<filetreelocation.length),QE("p5SelectAllButton",0<t),Q("p5SelectAllButton").value=0<e?"Nevybrat nic":"Vybrat vše",QE("p5CutButton",0<n&&e==n),QE("p5CopyButton",0<n&&e==n),QE("p5PasteButton",null!=p5clipboard&&0<p5clipboard.length&&0<filetreelocation.length)}function getFileSelCount(e){for(var t=0,n=document.getElementsByName("fc"),o=0;o<n.length;o++)!n[o].checked||0==e&&"3"!=n[o].attributes.file.value||t++;return t}function getFileSelDirCount(){for(var e=0,t=document.getElementsByName("fc"),n=0;n<t.length;n++)t[n].checked&&"999"==t[n].attributes.file.value&&e++;return e}function getFileCount(){return document.getElementsByName("fc").length}function p5selectallfile(){for(var e=0==getFileSelCount(),t=document.getElementsByName("fc"),n=0;n<t.length;n++)t[n].checked=e;p5setActions()}function setupBackPointers(e){if(null!=e.f){var t,n=0,o=0;for(t in e.f)setupBackPointers(e.f[t]),(e.f[t].parent=e).f[t].s&&(n+=e.f[t].s),e.f[t].c&&(o+=e.f[t].c),3==e.f[t].t&&o++;e.s=n,e.c=o}return e}function getFileSizeStr(e){return 1==(e="number"!=typeof e?0:e)?"1 bajt":format("{0} bajtů",e)}function p5folderup(e){if(null==e)filetreelocation.pop();else for(;filetreelocation.length>e;)filetreelocation.pop();return updateFiles(),!1}function p5folderset(e){return filetreelocation.push(decodeURIComponent(e)),updateFiles(),!1}function p5createfolder(){setDialogMode(2,"Nová složka",3,p5createfolderEx,"<input type=text id=p5renameinput maxlength=64 onkeyup=p5fileNameCheck(event) style=width:100% />"),focusTextBox("p5renameinput"),p5fileNameCheck()}function p5createfolderEx(){meshserver.send({action:"fileoperation",fileop:"createfolder",path:filetreelocation,newfolder:Q("p5renameinput").value})}function p5deletefile(){var e=getFileSelCount(),t=0<getFileSelDirCount()?"<br /><br /><label><input type=checkbox id=p5recdeleteinput>Rekurzivní mazání</label><br>":"<input type=checkbox id=p5recdeleteinput style='display:none'>";setDialogMode(2,"Smazat",3,p5deletefileEx,1<e?format("Smazat {0} vybrané prvky?",e)+t:"Smazat vybraný prvek?"+t)}function p5deletefileEx(){for(var e=[],t=document.getElementsByName("fc"),n=0;n<t.length;n++)t[n].checked&&e.push(t[n].value);meshserver.send({action:"fileoperation",fileop:"delete",path:filetreelocation,delfiles:e,rec:Q("p5recdeleteinput").checked})}function p5renamefile(){for(var e,t=document.getElementsByName("fc"),n=0;n<t.length;n++)t[n].checked&&(e=t[n].value);setDialogMode(2,"Přejmenovat",3,p5renamefileEx,'<input type=text id=p5renameinput maxlength=64 onkeyup=p5fileNameCheck(event) style=width:100% value="'+e+'" />',{action:"fileoperation",fileop:"rename",path:filetreelocation,oldname:e}),focusTextBox("p5renameinput"),p5fileNameCheck()}function p5renamefileEx(e,t){t.newname=Q("p5renameinput").value,meshserver.send(t)}function p5fileNameCheck(e){var t=isFilenameValid(Q("p5renameinput").value);QE("idx_dlgOkButton",t),1==t&&e&&13==e.keyCode&&dialogclose(1)}var isFilenameValid=(()=>{var t=/^[^\\/:\*\?"<>\|]+$/,n=/^\./,o=/^(nul|prn|con|lpt[0-9]|com[0-9])(\.|$)/i;return function(e){return t.test(e)&&!n.test(e)&&!o.test(e)&&"."!=e[0]}})();function p5uploadFile(){setDialogMode(2,"Nahrát soubor",3,p5uploadFileEx,'<form method=post enctype=multipart/form-data action=uploadfile.ashx target=fileUploadFrame><input type=text name=link style=display:none id=p5uploadpath value="'+encodeURIComponentEx(filetreelinkpath)+'" /><input type=file name=files id=p5uploadinput style=width:100% multiple=multiple onchange="p5updateUploadDialogOk(\'p5uploadinput\')" /><input type=hidden name=authCookie value='+authCookie+" /><input type=submit id=p5loginSubmit style=display:none /><span id=p5confirmOverwriteSpan style=display:none><br /><label><input type=checkbox id=p5confirmOverwrite onchange=\"p5updateUploadDialogOk('p5uploadinput')\" />Potvrdit přepsání?</label></span></form>"),p5updateUploadDialogOk("p5uploadinput")}function p5uploadFileEx(){Q("p5loginSubmit").click()}function p5GetFileInfo(e){var t,n=filetree;for(t in filetreelocation)null!=n.f&&null!=n.f[filetreelocation[t]]&&(n=n.f[filetreelocation[t]]);return n.f[e]}function p5updateUploadDialogOk(){var e=Q("p5uploadinput").files,t=[];for(a in e)null!=e[a].size&&0!=e[a].size&&t.push(e[a]);var n=filetree,o=[],i=0;for(a in filetreelocation)null!=n.f&&null!=n.f[filetreelocation[a]]&&(n=n.f[filetreelocation[a]]);if(QE("idx_dlgOkButton",0<e.length),0<e.length){if(null!=n.f){for(var a in n.f)o.push(a);for(a=0;a<e.length;a++)0<=o.indexOf(e[a].name)&&i++}QV("p5confirmOverwriteSpan",0<i),0<i?QE("idx_dlgOkButton",Q("p5confirmOverwrite").checked):(Q("p5confirmOverwrite").checked=!1,QE("idx_dlgOkButton",!0))}}function p5viewfile(){for(var e,t=document.getElementsByName("fc"),n=0;n<t.length;n++)if(t[n].checked)return null==(e=p5GetFileInfo(t[n].value))?void 0:void(e.s<=204800?meshserver.send({action:"fileoperation",fileop:"get",path:filetreelocation,file:t[n].value,tag:"edit"}):messagebox("Editor souborů","Upravovat je možné jen soubory, které jsou menší než 200 kilobajtů."))}var p5clipboard=null,p5clipboardFolder=null,p5clipboardCut=0;function p5copyFile(e){var t=document.getElementsByName("fc");p5clipboard=[],p5clipboardCut=e,p5clipboardFolder=Clone(filetreelocation);for(var n=0;n<t.length;n++)t[n].checked&&"3"==t[n].attributes.file.value&&p5clipboard.push(t[n].value);p5updateClipview()}function p5pasteFile(){var e="";setDialogMode(2,"Vložit",3,p5pasteFileEx,e=null!=p5clipboard&&0<p5clipboard.length?format("Potvrdit {0} z {1} záznam{2} do tohoto umístění?",0==p5clipboardCut?"copy":"move",p5clipboard.length,1<p5clipboard.length?"s":""):e)}function p5pasteFileEx(){meshserver.send({action:"fileoperation",fileop:0==p5clipboardCut?"copy":"move",scpath:p5clipboardFolder,path:filetreelocation,names:p5clipboard}),p5folderup(999),1==p5clipboardCut&&(p5clipboardFolder=p5clipboard=null,p5clipboardCut=0,p5updateClipview())}function p5updateClipview(){var e="";null!=p5clipboard&&0<p5clipboard.length&&(e=format("Drží se {0} zaznamů{1} pro {2}",p5clipboard.length,1<p5clipboard.length?"s":"",0==p5clipboardCut?"kopírovat":"přesunout")+', <a href=# onclick="return p5clearClip()" style=cursor:pointer>Vymazat</a>.'),QH("p5bottomstatus",e),p5setActions()}function p5clearClip(){return p5clipboardFolder=p5clipboard=null,p5clipboardCut=0,p5updateClipview(),!1}function p5fileDragDrop(e){if(!xxdialogMode&&(haltEvent(e),QV("bigfail",!1),QV("bigok",!1),null!=e.dataTransfer)){var t=[];for(a in e.dataTransfer.files)null!=e.dataTransfer.files[a].size&&0!=e.dataTransfer.files[a].size&&t.push(e.dataTransfer.files[a]);if(0!=t.length){var n=filetree,o=[],i=0;for(a in filetreelocation)null!=n.f&&null!=n.f[filetreelocation[a]]&&(n=n.f[filetreelocation[a]]);if(null!=n.f){for(var a in n.f)o.push(a);for(a=0;a<e.dataTransfer.files.length;a++)0<=o.indexOf(e.dataTransfer.files[a].name)&&i++}0==i?p5PerformUpload(1,e.dataTransfer.files):setDialogMode(2,"Nahrát soubor",3,p5PerformUpload,format(1==i?"Nahrání přepíše 1 soubor. Pokračovat?":"Nahrání přepíše {0} soubory. Pokračovat?",i),e.dataTransfer.files)}}}function p5PerformUpload(e,t){var n=0;p5uploadFile();try{Q("p5uploadinput").files=t}catch(e){n=1}if(0==n&&p5uploadFileEx(),setDialogMode(0),1==n&&0!=filetreelocation.length){for(var o=[],i=[],a=[],s=[],r=t.length,l=0,d=0;d<t.length;d++)l+=t[d].size;if(13e5<l)p5uploadFile();else for(d=0;d<t.length;d++){var u=new FileReader,c=t[d];o.push(c.name),i.push(c.size),a.push(c.type),u.onload=function(e){s.push(e.target.result),0==--r&&(Q("p5fileDragName").value=o.join("*"),Q("p5fileDragSize").value=i.join("*"),Q("p5fileDragType").value=a.join("*"),Q("p5fileDragData").value=s.join("*"),Q("p5fileDragLink").value=encodeURIComponentEx(filetreelinkpath),Q("p5fileDragAuthCookie").value=authCookie,Q("p5loginSubmit2").click())},u.readAsDataURL(c)}}}var p5dragtimer=null;function p5fileDragOver(e){xxdialogMode||(haltEvent(e),null!=p5dragtimer&&(clearTimeout(p5dragtimer),p5dragtimer=null),e=!0,0==filetreelocation.length&&(e=!1),QV("bigok",e),QV("bigfail",!e))}function p5fileDragLeave(e){xxdialogMode||(haltEvent(e),"p5filetable"!=e.target.id?(QV("bigfail",!1),QV("bigok",!1)):p5dragtimer=setTimeout(function(){QV("bigfail",!1),QV("bigok",!1),p5dragtimer=null},10))}function p5downloadButton(){for(var e=document.getElementsByName("fc"),t=0;t<e.length;t++)e[t].checked&&downloadFile("downloadfile.ashx?link="+encodeURIComponentEx(filetreelinkpath+"/"+e[t].value))}var eventsMessageId={1:"Přihlášení k účtu",2:"Odhlášení z účtu",3:"Jazyk změněn z {1} na {2}",4:"Připojil se k relaci multiplexu pro stolní počítače",5:"Opustil relaci multiplexu na ploše",6:"Zahájena relace multiplexu pro stolní počítače",7:"Dokončení relace nahrávání, {0} s",8:"Uzavřená relace multiplexu pro stolní počítače, {0} s",9:"Ukončená relace přenosu „{0}“ z {1} na {2}, {3} s",10:'Ukončena relace terminálu "{0}" od {1} do {2}, {3} s',11:"Ukončena relace na ploše „{0}“ od {1} do {2}, {3} s",12:"Ukončena relace správy souborů „{0}“ od {1} do {2}, {3} s",13:"Zahájena relace přenosu „{0}“ z {1} na {2}",14:'Zahájena relace terminálu "{0}" od {1} do {2}',15:'Zahájena relace na ploše "{0}" od {1} do {2}',16:"Zahájena relace správy souborů „{0}“ od {1} do {2}",17:'Zpracování příkazu konzoly: "{0}"',18:'Zobrazuje se okno se zprávou, title = "{0}", message = "{1}"',19:"Proces zabíjení {0}",20:"Zahájení: {0}",21:"Načítání obsahu schránky, {0} bajtů",22:"Nastavení obsahu schránky, {0} bajtů",23:"Pokus o aktivaci režimu Intel (R) AMT ACM",24:"Spouštění příkazů",25:"Provedení akce napájení = {0}, vynucené = {1}",26:'Zobrazuje se toastová zpráva, title = "{0}", message = "{1}"',27:"Místní uživatel přijal požadavek vzdáleného terminálu",28:"Místní uživatel odmítl požadavek na vzdálený terminál",29:"Připojení ke vzdálené ploše vynuceně uzavřeno místním uživatelem",30:"Spuštění vzdálené plochy po přijetí místním uživatelem",31:"Panel připojení ke vzdálené ploše aktivován / aktualizován",32:"Panel připojení ke vzdálené ploše selhal nebo není podporován",33:"Připojení ke vzdálené ploše vynuceně uzavřeno místním uživatelem",34:"Vzdálenou plochu se nepodařilo spustit po odmítnutí místním uživatelem",35:"Vzdálená plocha spuštěna s upozorněním na přípitek",36:"Vzdálená plocha spuštěna bez upozornění",37:"Panel připojení ke vzdálené ploše aktivován / aktualizován",38:"Panel připojení ke vzdálené ploše selhal nebo není podporován",39:"Připojení ke vzdálené ploše vynuceně uzavřeno místním uživatelem",40:"Spouštění vzdálených souborů po přijetí místním uživatelem",41:"Po odmítnutí místního uživatele se nepodařilo spustit vzdálené soubory",42:"Spuštěné vzdálené soubory s upozorněním na přípitek",43:"Spuštěné vzdálené soubory bez upozornění",44:'Vytvořit složku: "{0}"',45:"Smazat: „{0}“",46:'Smazat rekurzivní: "{0}", odstraněny prvky: {1}',47:'Smazat: "{0}", odstraněny prvky: {1}',48:"Přejmenovat: „{0}“ na „{1}“",49:'Stáhnout: "{0}"',50:"Nahrát: „{0}“",51:'Kopírovat: "{0}" do "{1}"',52:"Přesunout: „{0}“ do „{1}“",53:"Zamykání vzdáleného uživatele mimo plochu",54:"Agent uzavřel relaci s {0}% kompresí agent na server. Odesláno: {1}, komprimováno: {2}",55:"Vytvořená skupina zařízení: {0}",56:"Skupina zařízení odstraněna: {0}",57:"Přidáno zařízení {0} do skupiny zařízení {1}",58:"Zařízení požadovalo aktivaci Intel (R) AMT ACM, FQDN: {0}",59:"Změněno zařízení {0} ze skupiny {1}: {2}",60:"Odebrána práva uživatele zařízení pro {0}",61:"Změněna práva uživatele zařízení pro {0}",62:"Odebrán uživatel {0} ze skupiny uživatelů {1}",63:"Účet odstraněn",64:"Účet vytvořen, uživatelské jméno je {0}",65:"Účet vytvořen, e-mail je {0}",66:"Účet změněn: {0}",67:"Členství ve skupině uživatelů změněno: {0}",68:"Přidána skupina uživatelů {0} do skupiny zařízení {1}",69:"Skupina uživatelů vytvořena: {0}",70:"Odebrána skupina uživatelů {0} ze skupiny zařízení {1}",71:"Přidán uživatel {0} do skupiny uživatelů {1}",72:"Odebrán uživatel {0} ze skupiny uživatelů {1}",73:"Oznámení skupiny zařízení bylo změněno",74:"Heslo účtu změněno: {0}",75:"Změněná pověření účtu",76:"Skupina zařízení vytvořena: {0}",77:"Skupina zařízení odstraněna: {0}",78:"Členství ve skupině zařízení bylo změněno: {0}",79:"Skupina uživatelů změněna: {0}",80:"Přidán uživatel {0} do skupiny uživatelů {1}",81:"Odebrána práva uživatele zařízení pro {0}",82:"Změněna práva uživatele zařízení pro {0}",83:"Odebrán uživatel {0} ze skupiny zařízení {1}",84:"Přidáno zařízení {0} do skupiny zařízení {1}",85:"Přesunuto zařízení {0} do skupiny {1}",86:"Odebrána práva uživatele zařízení pro {0}",87:"Odebráno zařízení {0} ze skupiny zařízení {1}",88:"Povolené dvoufaktorové ověřování e-mailů",89:"Zakázané dvoufaktorové ověřování e-mailů",90:"Přidána ověřovací aplikace",91:"Odebrána ověřovací aplikace",92:"Byly vygenerovány nové záložní kódy 2FA",93:"Záložní kódy 2FA byly vymazány",94:"Odstraněný bezpečnostní klíč",95:"Přidán bezpečnostní klíč",96:"Ověřené telefonní číslo uživatele {0}",97:"Odebráno telefonní číslo uživatele {0}",98:"Požadována pomoc, uživatel: {0}, podrobnosti: {1}",99:"Spouštění příkazů jako uživatele",100:"Spouštění příkazů jako uživatele, pokud je to možné",101:"Přidáno sdílení zařízení {0} z {1} do {2}",102:"Odebráno sdílení zařízení {0}",103:"Hromadné nahrávání {0} souborů do složky {1}",104:'Automatické stahování souboru s výpisem jádra agenta: "{0}"',105:'Nahrát: "{0}", velikost: {1}',106:'Stáhnout: "{0}", Velikost: {1}',107:"Přihlášení k účtu od {0}, {1}, {2}",108:"Pokus o přihlášení uživatele s nesprávným druhým faktorem od {0}, {1}, {2}",109:"Pokus o přihlášení uživatele k uzamčenému účtu od {0}, {1}, {2}",110:"Neplatný pokus o přihlášení uživatele z domény {0}, {1}, {2}",111:"Zařízení požadovalo aktivaci Intel (R) AMT ACM TLS, plně kvalifikovaný název: {0}",112:'Ukončená relace messengeru "{0}" od {1} do {2}, {3} s',113:"Přidáno zařízení pro ověřování push notifikací",114:"Odebráno zařízení pro ověřování push notifikací",115:"Přidán přihlašovací token",116:"Odstraněn přihlašovací token",117:"Toto je stará verze agenta, zvažte aktualizaci.",118:"Tento agent má zastaralý mechanismus ověřování certifikátů, zvažte aktualizaci.",119:"Tento agent používá nezabezpečené tunely, zvažte aktualizaci.",120:'Zahájena relace místního přenosu "{0}", protokol {1} ​​až {2}',121:'Ukončena relace místního přenosu "{0}", protokol {1} ​​až {2}, {3} s',122:"Po {0} sekundách jste opustili relaci multiplexu na ploše.",123:'Opuštění relace Web-SSH "{1}" po {0} sekundách.',124:'Opuštění webové relace SFTP "{1}" po {0} sekundách.',125:'Opuštění webové relace RDP "{1}" po {0} sekundách.',126:"Opustili relaci Web-VNC po {0} sekundách.",127:"Zobrazovaný název účtu byl změněn na {0}.",128:"Účet byl vytvořen, jméno je {0}.",129:"Zobrazovaný název účtu byl odstraněn.",130:"Uživatelská oznámení se změnila",131:"Přidáno sdílení zařízení {0} s neomezeným časem.",132:"Zapnout.",133:"Vypnout.",134:"Násilně odpojená relace počítače uživatele {0}",135:"Násilně odpojená terminálová relace uživatele {0}",136:"Vynuceně odpojená relace souborů uživatele {0}",137:"Násilně odpojená relace směrování uživatele {0}",138:"Bylo přidáno sdílení zařízení {0}, které se opakuje denně.",139:"Bylo přidáno sdílení zařízení {0} opakující se týdně.",140:"Změněno zařízení {0} ze skupiny {1}: {2}",141:"Změna zásad Intel(r) AMT",142:"Skupina zařízení {0} byla změněna: {1}",143:'Připojil jsem se k relaci multiplexu počítače "{0}"',144:'Po {1} sekundách jste opustili desktopovou multiplexní relaci "{0}".',145:'Byla zahájena relace multiplexu počítače "{0}"',146:'Relace záznamu byla dokončena "{0}", {1} sekund',147:'Uzavřená stolní multiplexní relace "{0}", {1} sekund',148:'Byla zahájena relace Web-SSH "{0}".',149:'Byla zahájena relace Web-SFTP "{0}".',150:'Byla zahájena relace Web-RDP "{0}".',151:'Byla zahájena relace Web-VNC "{0}".',152:'Již není přenos pro "{0}".',153:'Je relé pro "{0}".',154:"Account changed to sync with LDAP data.",155:"Denied user login from {0}, {1}, {2}",156:"Verified messaging account of user {0}",157:"Removed messaging account of user {0}",158:'Displaying alert box, title="{0}", message="{1}"',159:"Device Powered On",160:"Enabled Duo two-factor authentication",161:"Disabled Duo two-factor authentication"},eventsShortMessageId={1:"Skupinové jméno",2:"Popis",3:"Vlajky",4:"Souhlas",5:"Automatické odstranění",6:"Kód pozvánky",7:"Reléové zařízení"};function eventMouseHover(e,t){e.children[1].classList.remove("g1s"),e.children[2].classList.remove("style10s"),e.children[3].classList.remove("g2s"),1==t&&(e.children[1].classList.add("g1s"),e.children[2].classList.add("style10s"),e.children[3].classList.add("g2s"))}function eventsUpdate(){var e="",t=null;for(r in events){var n=events[r],o=new Date(n.time);if(n.msg){null==n.h&&(n.h=Math.random()),printDate(o)!=t&&(null!=t&&(e+="</table>"),e+="<table class=p3eventsTable cellpadding=0 cellspacing=0><tr><td colspan=4 class=DevSt>"+(t=printDate(o))+"</td></tr>");var i,a,s="si3";if("ugrp"==n.etype&&(s="m4"),"user"==n.etype&&(s="m2"),"server"==n.etype&&(s="si3"),null==n.msgid||null==eventsMessageId[n.msgid])i="string"==typeof n.msg?EscapeHtml(n.msg).split("(R)").join("&reg;"):"";else{if(i=eventsMessageId[n.msgid],null!=n.msgArgs)for(var r in n.msgArgs){var l=n.msgArgs[r];if(Array.isArray(l)){var d,u=[];for(d in l)"number"==typeof l[d]&&eventsShortMessageId[l[d]]?u.push(eventsShortMessageId[l[d]]):u.push(l[d]);l=u.join(", ")}else"string"==typeof l&&0==l.indexOf("DATETIME:")&&(l=printFlexDateTime(new Date(parseInt(l.substring(9)))));i=i.split("{"+r+"}").join(l)}i=EscapeHtml(i).split("(R)").join("&reg;")}n.nodeid&&null!=(a=getNodeFromId(n.nodeid))&&(s="si"+a.icon,i="<a href=# onclick='gotoDevice(\""+n.nodeid+"\",10);haltEvent(event);'>"+EscapeHtml(a.name)+"</a> &rarr; "+i),n.username&&(a="",n.guestname&&(a=' / <span title="Toto je relace sdílení hostů">'+EscapeHtml(n.guestname)+"</span>"),i=2&userinfo.siteadmin&&n.userid?"<a href=# onclick='gotoUser(\""+encodeURIComponentEx(n.userid)+"\");haltEvent(event);'>"+EscapeHtml(n.username)+"</a>"+a+" &rarr; "+i:EscapeHtml(n.username)+a+" &rarr; "+i),n.remoteaddr&&(i+=" ("+n.remoteaddr+")"),"relay"!=n.etype&&"relaylog"!=n.action||(s="relayIcon16"),e+="<tr onclick=showEventDetails("+n.h+",2)  onmouseover=eventMouseHover(this,1) onmouseout=eventMouseHover(this,0) style=cursor:pointer><td style=width:18px><div class="+s+"></div></td><td class=g1>&nbsp;</td><td class=style10>"+printTime(o)+" - "+i+"</td><td class=g2>&nbsp;</td></tr><tr style=height:2px></tr>"}}null!=t&&(e+="</table>"),""==e&&(e="<br><i>Nenalezeny žádné události</i><br><br>"),QH("p3events",e)}function refreshEvents(){""!=p3filterevents.value?meshserver.send({action:"events",limit:parseInt(p3limitdropdown.value),filter:p3filterevents.value}):meshserver.send({action:"events",limit:parseInt(p3limitdropdown.value)})}function p3showReportDialog(){var e;xxdialogMode||(e="<div style=float:right><img src='images/report60.png' height=74 width=60 style=padding-top:2px /></div><div>",setDialogMode(2,"Stáhnout zprávu",3,null,e=(e=(e=(e=(e+=addHtmlValue("Typ zprávy","<select id=d2reportType style=width:160px onchange=p3showReportValidation()><option value=1>Všechny události</option>"))+addHtmlValue("Časové rozpětí","<select id=d2reportSpan style=width:160px onchange=p3showReportValidation()><option value=1>Vše k dispozici</option><option value=2>Jednoho dne</option></select>"))+("<div id=d2daySelector>"+addHtmlValue("Den hlášení","<input type=date id=d2reportDay style=width:160px onchange=p3showReportValidation()></input>")+"</div>"))+addHtmlValue("Skupina vytvořená","<select id=d2reportGroupBy style=width:160px onchange=p3showReportValidation()><option value=1>Nic</option><option value=2>Skupina zařízení</option><option value=3>Uživatel</option>"))+addHtmlValue("Formát","<select id=d2reportFormat style=width:160px onchange=p3showReportValidation()><option value=1>CSV</option><option value=2>JSON</option>")+"</div>"),p3showReportValidation(),Q("d2reportType").focus())}function p3showReportValidation(){Q("d2reportType").value;var e=Q("d2reportSpan").value,t=Q("d2reportDay").value,n=(Q("d2reportGroupBy").value,Q("d2reportFormat").value,QV("d2daySelector",2==e),!0);2==e&&""==t&&(n=!1),QE("idx_dlgOkButton",n)}function p3showDownloadEventsDialog(e){var t;xxdialogMode||(t="Stáhněte si seznam událostí v níže uvedeném formátu.<br /><br />",setDialogMode(2,"Export seznamu událostí",1,null,t=(t+=addHtmlValue("CSV formát",'<a href=# style=cursor:pointer onclick="return p3downloadEventsDialogCSV('+e+')">eventslist.csv</a>'))+addHtmlValue("JSON formát",'<a href=# style=cursor:pointer onclick="return p3downloadEventsDialogJSON('+e+')">eventslist.json</a>'),e))}function p3downloadEventsDialogCSV(e){var t,n,o;for(o in 1==e&&(n=currentDeviceEvents),2==e&&(n=events),t="utc, čas, typ, akce, uživatel, zařízení, zpráva\r\n",n=3==e?currentUserEvents:n){var i,a="";n[o].nodeid&&(i=getNodeFromId(n[o].nodeid))&&i.name&&(a=i.name),t+='"'+n[o].time+'","'+printDateTime(new Date(n[o].time))+'","'+n[o].etype+'","'+(null!=n[o].action?n[o].action:"")+'","'+(null!=n[o].username?n[o].username:"")+'","'+EscapeHtml(a)+'","'+(null!=n[o].msg?n[o].msg:"").split(",").join(" -")+'"\r\n'}return saveAs(stringToUtf8Blob(t),"eventslist.csv"),!1}function p3downloadEventsDialogJSON(e){var t,n,o=[];for(n in 1==e&&(t=currentDeviceEvents),2==e&&(t=events),t=3==e?currentUserEvents:t)o.push(events[n]);return saveAs(new Blob([JSON.stringify(o,null,2)],{type:"application/octet-stream"}),"eventslist.json"),!1}function updateUsers(){if(QV("UserNewAccountButton",0==(4&features)&&0==serverinfo.domainauth),null==users||0!=(4&features))QH("p3users","");else{var e=null!=userViewSettings&&userViewSettings.noViewLimit?1e5:100,t=[],n=e,o=0;for(u in users)t.push(users[u]);t.sort(nameSort);for(var i=Q("UserSearchInput").value.toLowerCase(),a=i,s=(i.startsWith("email:")?(i=null,a=a.substring(6)):i.startsWith("name:")?(a=null,i=i.substring(5)):i.startsWith("e:")?(i=null,a=a.substring(2)):i.startsWith("n:")&&(a=null,i=i.substring(2)),"<table class=p3usersTable cellpadding=0 cellspacing=0>"),r=!0,l=(s+="<th>Název<th style=width:80px>Skupiny zařízení<th style=width:120px>"+nobreak("Poslední přístup")+"<th style=width:120px>Oprávnění",[]),d=document.getElementsByClassName("UserCheckbox"),u=0;u<d.length;u++)d[u].checked&&l.push(d[u].value);for(u in t){var c=t[u],p=null;null!=(p=null!=wssessions?wssessions[c._id]:p)&&(null!=i&&(""==i||0<=c.name.toLowerCase().indexOf(i))||null!=a&&null!=c.email&&0<=c.email.toLowerCase().indexOf(a))&&(0<n?(r&&(s+="<tr><td class=userTableHeader colspan=4>Připojení uživatelé",r=!1),s+=addUserHtml(c,p),n--):o++)}for(u in r=!0,t){c=t[u],p=null;null==(p=null!=wssessions?wssessions[c._id]:p)&&(null!=i&&(""==i||0<=c.name.toLowerCase().indexOf(i))||null!=a&&null!=c.email&&0<=c.email.toLowerCase().indexOf(a))&&(0<n?(r&&(s+="<tr><td class=userTableHeader colspan=4>Nepřipojení uživatelé",r=!1),s+=addUserHtml(c,p),n--):o++)}s+="</table>",1==o?s+="<br />1 další uživatel není zobrazen, pro vyhledání uživatelů použijte kolonku pro vyhledávání…<br />":1<o&&(s+="<br />"+format("{0} dalších uživatelů není zobrazeno, vyhledejte je pomocí kolonky pro vyhledávání…",o)+"<br />"),n==e&&(s+="<br />Nenalezeni žádní uživatelé.<br />"),QH("p3users",s);for(var d=document.getElementsByClassName("UserCheckbox"),m=encodeURIComponentEx(userinfo._id),u=0;u<d.length;u++)d[u].checked=0<=l.indexOf(d[u].value)&&d[u].value!=m;p3updateInfo(),null!=currentUser&&30==xxcurrentView&&gotoUser(encodeURIComponentEx(currentUser._id),!0)}}function addUserHtml(e,t){var n="",o=" gray",i="",a=e._id!=userinfo._id,s="",r="",t=(null!=t?(o="",a&&(i='<span style=float:right;margin-top:1px;margin-right:4px title=Chat><a href=# onclick=userChat(event,"'+encodeURIComponentEx(e._id)+'","'+encodeURIComponentEx(e.name)+"\")><img src='images/icon-chat.png' height=16 width=16 style=padding-top:2px /></a></span>",i+="<span style=float:right;margin-top:1px;margin-left:4px;margin-right:4px title=Notify><a href=# onclick='return showUserAlertDialog(event,\""+encodeURIComponentEx(e._id)+"\")'><img src='images/icon-notify.png' height=16 width=16 style=padding-top:2px /></a></span>"),s+=nobreak(1==t?"1 relace":format("{0} relací",t))):e.access?s+='<span title="'+format("Poslední přístup: {0}",printDateTime(new Date(1e3*e.access)))+'">'+printDate(new Date(1e3*e.access))+"</span>":e.login&&(s+='<span title="'+format("Poslední přihlášení: {0}",printDateTime(new Date(1e3*e.login)))+'">'+printDate(new Date(1e3*e.login))+"</span>"),a&&(r+="<a href=# style=cursor:pointer onclick='return showUserAdminDialog(event,\""+encodeURIComponentEx(e._id)+"\")'>"),null!=e.siteadmin&&0!=(32&e.siteadmin)&&4294967295!=e.siteadmin&&(r+="Zamknuto,&nbsp;"),r+="<span title='Oprávnění serveru'>",4294966047&e.siteadmin),l=(null==e.siteadmin||0==t?r+="Uživatel":8==t?r+="Uživatel + Soubory":4294967295==e.siteadmin?r+="Správce":r+=0!=(2&t)?"Vedoucí":"Částečné",null!=e.siteadmin&&4294967295!=e.siteadmin&&0!=(1216&e.siteadmin)&&(r+="*"),r+="</span>",a&&(r+="</a>"),0);if(e.links)for(var d in e.links)d.startsWith("mesh/")&&l++;var t=EscapeHtml(e.name),a="";return 1==serverinfo.emailcheck&&(a=1!=e.emailVerified?' <b style=color:red title="Email není ověřen">&#x2717;</b>':' <b style=color:green title="E-mail je ověřen">&#x2713</b>'),null!=e.email&&(0==(2097152&features)||e.email.toLowerCase()!=e.name.toLowerCase()?t+=', <a href="mailto:'+EscapeHtml(e.email)+"\" '>"+EscapeHtml(e.email)+"</a>"+a:t+=' <a href="mailto:'+EscapeHtml(e.email)+'" \'><img src="images/mail12.png" height=9 width=12 title="Odeslat e-mail uživateli" style="margin-top:2px" /></a>'+a),null!=serverinfo.crossDomain&&""!=(a=e._id.split("/")[1])&&(t+=", <span style=color:#26F>"+a+"</span>"),(0<e.otpsecret||0<e.otphkeys||1==e.otpekey&&8388608&features||1==e.otpduo||null!=e.phone&&67108864&features)&&(t+=' <img src="images/key12.png" height=12 width=11 title="2-faktorové ověřování zapnuto" style="margin-top:2px" />'),null!=e.phone&&(t+=' <img src="images/phone12.png" height=12 width=7 title="Ověřené telefonní číslo" style="margin-top:2px" />'),null!=e.siteadmin&&0!=(32&e.siteadmin)&&4294967295!=e.siteadmin&&(t+=' <img src="images/padlock12.png" height=12 width=8 title="Účet je uzamčen" style="margin-top:2px" />'),null!=e.msghandle&&33554432&features2&&(t+=' <img src="images/messaging12.png" height=12 width=12 title="Verified messaging account" style="margin-top:2px" />'),n+("<tr tabindex=0 onmouseover=userMouseHover(this,1) onmouseout=userMouseHover(this,0) onkeypress=\"if (event.key=='Enter') gotoUser('"+encodeURIComponentEx(e._id)+"')\"><td>")+"<div class=bar>"+("<div class=baricon><input class=UserCheckbox value="+encodeURIComponentEx(e._id)+" onclick=p3updateInfo() type=checkbox"+(e._id==userinfo._id?" disabled":"")+'></div><div style=cursor:pointer onclick=gotoUser("'+encodeURIComponentEx(e._id)+'",false,event)>')+('<div class=baricon><div class="m2'+o+'"></div></div>')+"<div class=g1></div><div class=g2></div><div>"+("<div><span style=line-height:24px>"+t+"</span>"+i+"</div></div><td style=text-align:center>"+l+"<td style=text-align:center>"+s+"<td style=text-align:center>"+r)}function p3updateInfo(){for(var e=document.getElementsByClassName("UserCheckbox"),t=0,n=0;n<e.length;n++)!0===e[n].checked&&t++;QE("UsersGroupActionButton",0<t),Q("UsersSelectAllButton").value=0<t?"Nevybrat nic":"Vybrat vše"}function p3usersSelectallButtonFunction(){for(var e=encodeURIComponentEx(userinfo._id),t=document.getElementsByClassName("UserCheckbox"),n=0,o=0;o<t.length;o++)!0===t[o].checked&&n++;for(o=0;o<t.length;o++)t[o].checked=0==n&&t[o].value!=e;p3updateInfo()}function p3usersGroupActionFunction(){for(var e,t,n=document.getElementsByClassName("UserCheckbox"),o=0,i=0;i<n.length;i++)!0===n[i].checked&&o++;0!=o&&(e="",serverinfo.emailcheck&&(e+="<option value=4>Ověřit e-mail</option><option value=5>Zrušení platnosti e-mailu</option>"),t="Vyberte operaci, kterou chcete provést u všech vybraných uživatelů.<br /><br />",setDialogMode(2,"Akce skupiny",3,p3usersGroupActionFunctionEx,t+=addHtmlValue("Operace","<select style=width:240px id=d3groupop><option value=1>Uzamknout účet</option><option value=2>Odemkněte účet</option>"+e+"<option value=3>Smazat účet</option></select>")))}function p3usersGroupActionFunctionEx(){for(var e=document.getElementsByClassName("UserCheckbox"),t=[],n=0;n<e.length;n++)!0===e[n].checked&&t.push(decodeURIComponent(e[n].value));var o,i,a=Q("d3groupop").value;if(1==a)for(var n in t)0==(32&(o=null==(i=users[t[n]]).siteadmin?0:i.siteadmin))&&(o+=32,meshserver.send({action:"edituser",id:i._id,siteadmin:o}));else if(2==a)for(var n in t)0!=(32&(o=null==(i=users[t[n]]).siteadmin?0:i.siteadmin))&&(o-=32,meshserver.send({action:"edituser",id:i._id,siteadmin:o}));else if(3==a)setDialogMode(2,"Smazat účty",3,p3groupActionFunctionDelExec,"Potvrdit smazání vybraných účtů?<br /><br /><label><input id=d3check type=checkbox onchange=p3usersGroupActionFunctionDelCheck() />Potvrdit</label>"),QE("idx_dlgOkButton",!1);else if(4==a)for(var n in t)!0!==(i=users[t[n]]).emailVerified&&meshserver.send({action:"edituser",id:i._id,emailVerified:!0});else if(5==a)for(var n in t)!0===(i=users[t[n]]).emailVerified&&meshserver.send({action:"edituser",id:i._id,emailVerified:!1})}function p3usersGroupActionFunctionDelCheck(){QE("idx_dlgOkButton",Q("d3check").checked)}function p3groupActionFunctionDelExec(e){for(var t=document.getElementsByClassName("UserCheckbox"),n=[],o=0;o<t.length;o++)!0===t[o].checked&&n.push(decodeURIComponent(t[o].value));for(o in n){var i=users[n[o]];meshserver.send({action:"deleteuser",userid:i._id,username:i.name})}}function userMouseHover(e,t){var n=e.children[0].children[0].children[1];n.children[1].classList.remove("g1s"),n.children[2].classList.remove("g2s"),e.children[0].children[0].classList.remove("sbar"),1==t&&(n.children[1].classList.add("g1s"),n.children[2].classList.add("g2s"),e.children[0].children[0].classList.add("sbar"))}function userMouseHover2(e,t){var n=e.children[0].children[0];n.children[2].classList.remove("g1s"),n.children[3].classList.remove("g2s"),e.children[0].children[0].classList.remove("sbar"),1==t&&(n.children[2].classList.add("g1s"),n.children[3].classList.add("g2s"),e.children[0].children[0].classList.add("sbar"))}function userChat(e,t,n){if(!xxdialogMode)return haltEvent(e),e="/messenger?id=meshmessenger/"+t+"/"+encodeURIComponentEx(userinfo._id)+"&title="+n,null!=authCookie&&""!=authCookie&&(e+="&auth="+authCookie),urlargs.key&&(e+="&key="+urlargs.key),safeNewWindow(e,"meshmessenger:"+t),meshserver.send({action:"meshmessenger",userid:decodeURIComponent(t)}),!1}function altUserChat(e,t,n,o){var i,a,s,r,l;if(!xxdialogMode)return haltEvent(e),e=serverinfo.altmessenging[o].url,s=i=encodeURIComponentEx((l=decodeURIComponent(t)).split("/")[2]),r=a=encodeURIComponentEx(l.split("/").join("-")),null!=(l=users[l])&&null!=l.realname&&(s=encodeURIComponentEx(l.realname.split(" ").join("")),r=encodeURIComponentEx(l.realname.split(" ").join("-"))),e=e.split("{0}").join(i).split("{1}").join(a).split("{2}").join(s).split("{3}").join(r),urlargs.key&&(e+="&key="+urlargs.key),safeNewWindow(e,"altmessenger:"+t),meshserver.send({action:"notifyuser",userid:decodeURIComponent(t),msg:serverinfo.altmessenging[o].name,msgid:11,url:e}),!1}function showSendSMS(e){xxdialogMode||(setDialogMode(2,"Pošli SMS",3,showSendSMSEx,"<textarea id=d2smsText maxlength=160 style=background-color:#fcf3cf;width:100%;height:100px;resize:none onKeyUp=showSendSMSValidate()></textarea><span style=font-size:10px><span>",e),Q("d2smsText").focus(),showSendSMSValidate())}function showSendSMSValidate(){QE("idx_dlgOkButton",0<Q("d2smsText").value.length)}function showSendSMSEx(e,t){0<Q("d2smsText").value.length&&meshserver.send({action:"smsuser",userid:decodeURIComponent(t),msg:Q("d2smsText").value})}function showSendMessage(e){xxdialogMode||(setDialogMode(2,"Send Message",3,showSendMessageEx,"<textarea id=d2smsText maxlength=160 style=background-color:#fcf3cf;width:100%;height:100px;resize:none onKeyUp=showSendSMSValidate()></textarea><span style=font-size:10px><span>",e),Q("d2smsText").focus(),showSendSMSValidate())}function showSendMessageEx(e,t){0<Q("d2smsText").value.length&&meshserver.send({action:"msguser",userid:decodeURIComponent(t),msg:Q("d2smsText").value})}function showSendEmail(e){xxdialogMode||(setDialogMode(2,"Poslat e-mailem",3,showSendEmailEx,'<input id=d2emailSubject style=background-color:#fcf3cf;width:100% placeholder="Předmět"></input><textarea id=d2emailText maxlength=10000 style="background-color:#fcf3cf;width:100%;height:200px;resize:none;overflow-y:auto" onKeyUp=showSendEmailValidate()></textarea>',e),Q("d2emailSubject").focus(),showSendEmailValidate())}function showSendEmailValidate(){QE("idx_dlgOkButton",0<Q("d2emailSubject").value.length&&0<Q("d2emailText").value.length)}function showSendEmailEx(e,t){0<Q("d2emailText").value.length&&meshserver.send({action:"emailuser",userid:decodeURIComponent(t),subject:Q("d2emailSubject").value,msg:Q("d2emailText").value})}function showUserAlertDialog(e,t){if(!xxdialogMode)return haltEvent(e),setDialogMode(2,format("Upozornit {0}",EscapeHtml(users[decodeURIComponent(t)].name)),3,showUserAlertDialogEx,'<div style=margin-bottom:6px>Poslat tomuto uživateli textové upozornění.</div><textarea id=d2notifyText maxlength=2048 style="width:100%;height:184px;resize:none;background-color:#fcf3cf"></textarea><select style=width:100% id=broadcastMessageMaxTime><option value=0>Zobrazit zprávu, dokud ji uživatel nezavře</option><option value=10>Zobrazit na 10 sekund</option><option value=60>Zobrazit na 1 minutu</option><option value=300>Zobrazit po dobu 5 minut</option></select>',t),Q("d2notifyText").focus(),!1}function showUserAlertDialogEx(e,t){meshserver.send({action:"notifyuser",userid:decodeURIComponent(t),msg:Q("d2notifyText").value,maxtime:parseInt(Q("broadcastMessageMaxTime").value)})}function onUsersViewSettings(){var e;xxdialogMode||(e="",setDialogMode(2,"Zobrazení uživatelů",3,onUsersViewSettingsEx,e+="<label><input id=d2c1 type=checkbox"+((userViewSettings=null==userViewSettings?{}:userViewSettings).noViewLimit?"":" checked")+">Zobrazit pouze prvních 100 uživatelů</label><br />"))}function onUsersViewSettingsEx(){userViewSettings.noViewLimit=!Q("d2c1").checked,putstore("_usersViewSettings",JSON.stringify(userViewSettings)),mainUpdate(16384)}function p4batchAccountCreate(){xxdialogMode||(setDialogMode(2,"Import uživatelských účtů",3,p4batchAccountCreateEx,'Create many accounts at once by importing a JSON or CSV file<br /><br />JSON file format is as follows:<br /><pre>[\r\n {"user":"x1","pass":"x","email":"x1@x"},\r\n {"user":"x2","pass":"x","resetNextLogin":true}\r\n]</pre><br />CSV file format is as follows:<br /><pre>user,pass,email,resetNextLogin\r\nx1,x,x1@x,\r\nx2,x,,true\r\n</pre><br /><input style=width:370px type=file id=d4importFile accept=".json,.csv" onchange=p4batchAccountCreateValidate() />'),QE("idx_dlgOkButton",!1))}function p4batchAccountCreateValidate(){QE("idx_dlgOkButton",null!=Q("d4importFile").value)}function p4batchAccountCreateEx(){var e=new FileReader;e.onload=function(e){var t=null;if(Q("d4importFile").value.endsWith(".csv")){var n=e.target.result.split("\n"),o=n[0].trim().split(","),i=[];for(let e=1;e<n.length;e++){var a=n[e].trim();if(""!==a){var s=a.split(",");let t=!1;for(let e=0;e<s.length;e++)if(""!==s[e].trim()){t=!0;break}if(t){var r={};for(let e=0;e<o.length;e++){var l=s[e].trim();""!==o[e].trim()&&""!==l&&(r[o[e]]="true"===l.toLowerCase()||l)}i.push(r)}}}if(null!=(t=i)&&Array.isArray(t)){var d=!0;for(u in t)("string"!=typeof t[u].user||t[u].user.length<1||64<t[u].user.length)&&(d=!1),("string"!=typeof t[u].pass||t[u].pass.length<1||256<t[u].pass.length)&&(d=!1),0==checkPasswordRequirements(t[u].pass,passRequirements)&&(d=!1),null!=t[u].email&&("string"!=typeof t[u].email||t[u].email.length<1||128<t[u].email.length)&&(d=!1);0==d?setDialogMode(2,"Import uživatelských účtů",1,null,"Invalid CSV file format."):meshserver.send({action:"adduserbatch",users:t})}else setDialogMode(2,"Import uživatelských účtů",1,null,"Invalid CSV file format.")}else{try{t=JSON.parse(e.target.result)}catch(e){return void setDialogMode(2,"Import uživatelských účtů",1,null,format("Neplatný JSON soubor: {0}.",e))}if(null!=t&&Array.isArray(t)){var u,d=!0;for(u in t)("string"!=typeof t[u].user||t[u].user.length<1||64<t[u].user.length)&&(d=!1),("string"!=typeof t[u].pass||t[u].pass.length<1||256<t[u].pass.length)&&(d=!1),0==checkPasswordRequirements(t[u].pass,passRequirements)&&(d=!1),null!=t[u].email&&("string"!=typeof t[u].email||t[u].email.length<1||128<t[u].email.length)&&(d=!1);0==d?setDialogMode(2,"Import uživatelských účtů",1,null,"Neplatný formát JSON souboru."):meshserver.send({action:"adduserbatch",users:t})}else setDialogMode(2,"Import uživatelských účtů",1,null,"Neplatný formát JSON souboru.")}},e.readAsText(Q("d4importFile").files[0])}function p4downloadUserInfo(){var e;xxdialogMode||(e="Stáhněte si seznam uživatelů v níže uvedeném formátu.<br /><br />",setDialogMode(2,"Export seznamu uživatelů",1,null,e=(e+=addHtmlValue("CSV formát","<a href=# style=cursor:pointer onclick='return p4downloadUserInfoCSV()'>userlist.csv</a>"))+addHtmlValue("JSON formát","<a href=# style=cursor:pointer onclick='return p4downloadUserInfoJSON()'>userlist.json</a>")))}function p4downloadUserInfoCSV(){var e,t="id,jméno,email,vytvoření,poslední přihlášení,skupiny,authfactors,siteadmin,userradmin,locked\r\n";for(e in users){var n=!1,o=[];(0<users[e].otpsecret||0<users[e].otphkeys)&&(n=!0,0<users[e].otpsecret&&o.push("AuthApp"),0<users[e].otphkeys&&o.push("SecurityKey"),0<users[e].otpkeys)&&o.push("BackupCodes"),t=(t=(t=(t+='"'+users[e]._id+'","'+users[e].name+'","'+(users[e].email||"")+'","'+(users[e].creation?new Date(1e3*users[e].creation):"")+'","'+(users[e].login?new Date(1e3*users[e].login):"")+'","'+(users[e].groups?users[e].groups.join(","):"")+'","'+(n?o.join(","):"")+'"')+(","+(4294967295==users[e].siteadmin?"1":"0")))+(","+(0!=(2&users[e].siteadmin)?"1":"0")))+(","+(0!=(32&users[e].siteadmin)?"1":"0"))+"\r\n"}return saveAs(stringToUtf8Blob(t),"userlist.csv"),!1}function p4downloadUserInfoJSON(){var e,t=[];for(e in users)t.push(users[e]);return saveAs(new Blob([JSON.stringify(t,null,2)],{type:"application/octet-stream"}),"userlist.json"),!1}function showUserBroadcastDialog(e){xxdialogMode||(setDialogMode(2,"Hromadná zpráva",3,showUserBroadcastDialogEx,'<div style=margin-bottom:6px>Zaslat hromadnou zprávu všem připojeným uživatelům.</div><textarea id=broadcastMessage style="width:100%;height:184px;resize:none;background-color:#fcf3cf" value="" maxlength=2048 /></textarea><select style=width:100% id=broadcastMessageMaxTime><option value=0>Zobrazit zprávu, dokud ji uživatel nezavře</option><option value=10>Zobrazit na 10 sekund</option><option value=60>Zobrazit na 1 minutu</option><option value=300>Zobrazit po dobu 5 minut</option></select>',e?decodeURIComponent(e):null),Q("broadcastMessage").focus())}function showUserBroadcastDialogEx(e,t){meshserver.send({action:"userbroadcast",msg:Q("broadcastMessage").value,target:t,maxtime:parseInt(Q("broadcastMessageMaxTime").value)})}function showCreateNewAccountDialog(){if(!xxdialogMode){var e="";if(serverinfo.crossDomain){var t="<select style=width:240px id=p4domain>";for(n in serverinfo.crossDomain)t+="<option value="+n+">"+(""==serverinfo.crossDomain[n]?"Výchozí":EscapeHtml(serverinfo.crossDomain[n]))+"</option>";e+=addHtmlValue("Doména",t+="</select>")}if(0==(2097152&features)&&(e+=addHtmlValue("<span id=p4hname>Uživatelské jméno</span>","<input id=p4name maxlength=64 autocomplete=username onchange=showCreateNewAccountDialogValidate() onkeyup=showCreateNewAccountDialogValidate() />")),e=(e=(e=(e+=addHtmlValue("<span id=p4hemail>E-mail</span>",'<input id=p4email type=email maxlength=256 autocomplete="email" inputmode="email" onchange=showCreateNewAccountDialogValidate() onkeyup=showCreateNewAccountDialogValidate() />'))+addHtmlValue("<span id=p4hp1>Heslo</span>",'<input id=p4pass1 type=password maxlength=256 autocomplete="new-password" onchange=showCreateNewAccountDialogValidate() onkeyup=showCreateNewAccountDialogValidate() />'))+addHtmlValue("<span id=p4hp2>Heslo</span>",'<input id=p4pass2 type=password maxlength=256 autocomplete="new-password" onchange=showCreateNewAccountDialogValidate() onkeyup=showCreateNewAccountDialogValidate() />')+"<div><label><input id=p4randomPassword onchange=showCreateNewAccountDialogValidate() type=checkbox />Vytvořit náhodné heslo.</label></div>")+"<div><label><input id=p4removeEvents onchange=showCreateNewAccountDialogValidate() type=checkbox />Odebrat všechny předchozí události pro tento identifikátor uživatele.</label></div>"+"<div><label><input id=p4resetNextLogin onchange=showCreateNewAccountDialogValidate() type=checkbox />Vynutit reset hesla při dalším přihlášení.</label></div>",serverinfo.emailcheck&&(e+="<div><label><input id=p4verifiedEmail onchange=showCreateNewAccountDialogValidate() type=checkbox />E-mail je ověřen.</label></div><div><label><input id=p4invitationEmail type=checkbox title=Je vyžadováno ověření e-mailem a vynucené resetování hesla. />Zaslat pozvánku e-mailem.</label></div>"),passRequirements){var n,o=[],i=0;for(n in passRequirements)"reset"!=n&&"hint"!=n&&(o.push(n+":"+passRequirements[n]),i++);0<i&&(e+="<div style=font-size:x-small;padding:6px>"+format("Požadavky: {0}.",o.join(", "))+"</div>")}setDialogMode(2,"Vytvořit účet",3,showCreateNewAccountDialogEx,e),showCreateNewAccountDialogValidate(),(0==(2097152&features)?Q("p4name"):Q("p4email")).focus()}}function showCreateNewAccountDialogValidate(){var e=validateEmail(Q("p4email").value),t=!0,n=0<Q("p4pass1").value.length&&Q("p4pass1").value==Q("p4pass2").value&&checkPasswordRequirements(Q("p4pass1").value,passRequirements),t=(0==(2097152&features)&&(t=!Q("p4name")||0<Q("p4name").value.length&&-1==Q("p4name").value.indexOf(" "),QS("p4hname").color=t?"black":"#7b241c"),QS("p4hemail").color=e?"black":"#7b241c",serverinfo.emailcheck&&(QE("p4verifiedEmail",e),QE("p4invitationEmail",e&&Q("p4resetNextLogin").checked&&Q("p4verifiedEmail").checked),0==e&&(Q("p4verifiedEmail").checked=!1),0!=Q("p4resetNextLogin").checked&&0!=Q("p4verifiedEmail").checked||(Q("p4invitationEmail").checked=!1)),QE("p4pass1",!Q("p4randomPassword").checked),QE("p4pass2",!Q("p4randomPassword").checked),QS("p4hp1").color=n||Q("p4randomPassword").checked?"black":"#7b241c",QS("p4hp2").color=n||Q("p4randomPassword").checked?"black":"#7b241c",t&e);0==Q("p4randomPassword").checked&&(t&=n),QE("idx_dlgOkButton",t)}function showCreateNewAccountDialogEx(){var e={action:"adduser",username:(0==(2097152&features)?Q("p4name"):Q("p4email")).value,email:Q("p4email").value,pass:Q("p4pass1").value,resetNextLogin:Q("p4resetNextLogin").checked,randomPassword:Q("p4randomPassword").checked,removeEvents:Q("p4removeEvents").checked};serverinfo.emailcheck&&(e.emailVerified=Q("p4verifiedEmail").checked,e.emailInvitation=Q("p4invitationEmail").checked),serverinfo.crossDomain&&(e.domain=serverinfo.crossDomain[parseInt(Q("p4domain").value)]),meshserver.send(e)}function showUserGroupDialog(e,t){var n;if(!xxdialogMode)return haltEvent(e),t=decodeURIComponent(t),e="",n="Zadejte seznam správních oblastí (oddělovaných čárkou).<br /><br />",setDialogMode(2,"Administrativní oblasti",3,showUserGroupDialogEx,n+=addHtmlValue("Oblasti",'<input id=dp4usergroups style=width:230px value="'+(e=null!=(t=users[t.toLowerCase()]).groups?t.groups.join(", "):e)+'" placeholder="Jméno1, Jméno2, Jméno3" maxlength=256 onchange=p4validateUserGroups() onkeyup=p4validateUserGroups() />'),t),focusTextBox("dp4usergroups"),p4validateUserGroups(),!1}function p4validateUserGroups(){var e,t=Q("dp4usergroups").value,n=0,o=t.indexOf('"')+t.indexOf("/")+t.indexOf(">")+t.indexOf("<")+t.indexOf("'"),i=t.split(",");for(e in i)0==i[e].trim().length&&n++;QE("idx_dlgOkButton",""==t||-5==o&&n<1)}function showUserGroupDialogEx(e,t){var n,o=Q("dp4usergroups").value.split(","),i=[];for(n in o){var a=o[n].trim();0<a.length&&i.push(a)}meshserver.send({action:"edituser",id:t._id,groups:i})}function showUserAdminDialog(e,t){if(!xxdialogMode){haltEvent(e),t=decodeURIComponent(t);var n,e=users[t];if(null!=e)return(t="")!=(t=(t=(t=(t=(t+="<label><input type=checkbox onchange=showUserAdminDialogValidate() id=ua_fileaccess>Soubory serveru</label>, <input type=number onchange=showUserAdminDialogValidate() maxlength=10 id=ua_fileaccessquota>k max, standardně prázdné<br><hr/>")+"<label><input type=checkbox onchange=showUserAdminDialogValidate() id=ua_fulladmin>Administrátor</label><br>"+"<label><input type=checkbox onchange=showUserAdminDialogValidate() id=ua_serverbackup>Záloha serveru</label><br>")+"<label><input type=checkbox onchange=showUserAdminDialogValidate() id=ua_serverrestore>Obnova serveru</label><br>"+"<label><input type=checkbox onchange=showUserAdminDialogValidate() id=ua_serverupdate>Aktualizace serveru</label><br></div>")+"<div id=d2MngUsr><label><input type=checkbox onchange=showUserAdminDialogValidate() id=ua_manageusers>Spravovat uživatele</label><br></div>"+"<div id=d2MngGrp><label><input type=checkbox onchange=showUserAdminDialogValidate() id=ua_manageusergroups>Spravovat skupiny uživatelů</label><br></div>")+"<div id=d2MngRec><label><input type=checkbox onchange=showUserAdminDialogValidate() id=ua_managerecordings>Spravovat nahrávky</label><br></div>"+"<div id=d2AllEvnt><label><input type=checkbox onchange=showUserAdminDialogValidate() id=ua_allevents>Zobrazit všechny události</label><br></div>")&&(t+="<hr/>"),setDialogMode(2,"Oprávnění serveru",2+((n=userinfo._id==e._id)?0:1),showUserAdminDialogEx,t=(t=(t=(t="<div><div id=d2AdminPermissions>"+t)+"<label><input type=checkbox onchange=showUserAdminDialogValidate() id=ua_lockedaccount>Uzamknout účet</label><br>"+"<label><input type=checkbox onchange=showUserAdminDialogValidate() id=ua_nonewgroups>Žádná nová skupina zařízení</label><br>")+"<label><input type=checkbox onchange=showUserAdminDialogValidate() id=ua_nonewdevices>Žádná nová zařízení</label><br>"+"<label><input type=checkbox onchange=showUserAdminDialogValidate() id=ua_nomeshcmd>Žádné nástroje (MeshCmd/Router)</label><br>")+"<label><input type=checkbox onchange=showUserAdminDialogValidate() id=ua_locksettings>Zamknout nastavení účtu</label><br>"+"</div>",e),e.siteadmin&&0!=e.siteadmin&&(Q("ua_fulladmin").checked=4294967295==e.siteadmin,Q("ua_serverbackup").checked=4294967295!=e.siteadmin&&0!=(1&e.siteadmin),Q("ua_serverrestore").checked=4294967295!=e.siteadmin&&0!=(4&e.siteadmin),Q("ua_fileaccess").checked=4294967295!=e.siteadmin&&0!=(8&e.siteadmin),Q("ua_serverupdate").checked=4294967295!=e.siteadmin&&0!=(16&e.siteadmin),Q("ua_lockedaccount").checked=4294967295!=e.siteadmin&&0!=(32&e.siteadmin),Q("ua_nonewgroups").checked=4294967295!=e.siteadmin&&0!=(64&e.siteadmin),Q("ua_nomeshcmd").checked=4294967295!=e.siteadmin&&0!=(128&e.siteadmin),Q("ua_locksettings").checked=4294967295!=e.siteadmin&&0!=(1024&e.siteadmin),Q("ua_nonewdevices").checked=4294967295!=e.siteadmin&&0!=(4096&e.siteadmin)),0!=(2&userinfo.siteadmin)&&(Q("ua_manageusers").checked=4294967295!=e.siteadmin&&0!=(2&e.siteadmin),QE("ua_manageusers",!n&&2&userinfo.siteadmin)),0!=(256&userinfo.siteadmin)&&(Q("ua_manageusergroups").checked=4294967295!=e.siteadmin&&0!=(256&e.siteadmin),QE("ua_manageusergroups",!n&&256&userinfo.siteadmin)),0!=(512&userinfo.siteadmin)&&(Q("ua_managerecordings").checked=4294967295!=e.siteadmin&&0!=(512&e.siteadmin),QE("ua_managerecordings",!n&&512&userinfo.siteadmin)),0!=(2048&userinfo.siteadmin)&&(Q("ua_allevents").checked=4294967295!=e.siteadmin&&0!=(2048&e.siteadmin),QE("ua_allevents",!n&&2048&userinfo.siteadmin)),QE("ua_fulladmin",!n&&4294967295==userinfo.siteadmin),QE("ua_serverbackup",!n&&4294967295==userinfo.siteadmin),QE("ua_serverrestore",!n&&4294967295==userinfo.siteadmin),QE("ua_fileaccess",!n&&4294967295==userinfo.siteadmin),QE("ua_fileaccessquota",!n&&4294967295==userinfo.siteadmin),QE("ua_serverupdate",!n&&4294967295==userinfo.siteadmin),QV("d2AdminPermissions",4294967295==userinfo.siteadmin),QV("d2MngUsr",0!=(2&userinfo.siteadmin)),QV("d2MngGrp",0!=(256&userinfo.siteadmin)),QV("d2MngRec",0!=(512&userinfo.siteadmin)),QE("ua_lockedaccount",!n&&2&userinfo.siteadmin&&4294967295!=e.siteadmin&&userinfo._id!=e._id),QE("ua_nonewgroups",!n&&2&userinfo.siteadmin&&4294967295!=e.siteadmin&&userinfo._id!=e._id),QE("ua_nomeshcmd",!n&&2&userinfo.siteadmin&&4294967295!=e.siteadmin&&userinfo._id!=e._id),QE("ua_nonewdevices",!n&&2&userinfo.siteadmin&&4294967295!=e.siteadmin&&userinfo._id!=e._id),QE("ua_locksettings",!n&&2&userinfo.siteadmin&&4294967295!=e.siteadmin&&userinfo._id!=e._id),Q("ua_fileaccessquota").value=null!=e.quota?e.quota/1024:"",showUserAdminDialogValidate(),!1}}function showUserAdminDialogValidate(){4294967295==userinfo.siteadmin&&(QE("ua_serverbackup",!Q("ua_fulladmin").checked),QE("ua_manageusers",!Q("ua_fulladmin").checked),QE("ua_serverrestore",!Q("ua_fulladmin").checked),QE("ua_fileaccess",!Q("ua_fulladmin").checked),QE("ua_serverupdate",!Q("ua_fulladmin").checked),QE("ua_lockedaccount",!Q("ua_fulladmin").checked),QE("ua_nonewgroups",!Q("ua_fulladmin").checked),QE("ua_nomeshcmd",!Q("ua_fulladmin").checked),QE("ua_nonewdevices",!Q("ua_fulladmin").checked),QE("ua_manageusergroups",!Q("ua_fulladmin").checked),QE("ua_managerecordings",!Q("ua_fulladmin").checked),QE("ua_allevents",!Q("ua_fulladmin").checked),QE("ua_locksettings",!Q("ua_fulladmin").checked),QE("ua_fileaccessquota",Q("ua_fileaccess").checked&&!Q("ua_fulladmin").checked))}function showUserAdminDialogEx(e,t){var n=0,o=parseInt(Q("ua_fileaccessquota").value),t=(1==Q("ua_fulladmin").checked?n=4294967295:(1==Q("ua_serverbackup").checked&&(n+=1),1==Q("ua_manageusers").checked&&(n+=2),1==Q("ua_serverrestore").checked&&(n+=4),1==Q("ua_fileaccess").checked&&(n+=8),1==Q("ua_serverupdate").checked&&(n+=16),1==Q("ua_lockedaccount").checked&&(n+=32),1==Q("ua_nonewgroups").checked&&(n+=64),1==Q("ua_nomeshcmd").checked&&(n+=128),1==Q("ua_manageusergroups").checked&&(n+=256),1==Q("ua_managerecordings").checked&&(n+=512),1==Q("ua_locksettings").checked&&(n+=1024),1==Q("ua_allevents").checked&&(n+=2048),1==Q("ua_nonewdevices").checked&&(n+=4096)),{action:"edituser",id:t._id,siteadmin:n});0==isNaN(o)&&(t.quota=1024*o),meshserver.send(t)}function onUserSearchInputChanged(){mainUpdate(16384)}function updateUserGroups(){QV("p50userGroupOps",0!=(256&userinfo.siteadmin));var e=[],t="";if(usergroups)for(var n in usergroups)e.push(usergroups[n]);e.sort(nameSort);for(var o=[],i=document.getElementsByClassName("UserGroupCheckbox"),n=0;n<i.length;n++)i[n].checked&&o.push(i[n].value);if(0==e.length)t+="<br />Nenalezeny žádné skupiny.<br />",QV("DuplicateUserGroupButton",!1);else{for(var n in t=t+"<table class=p3usersTable cellpadding=0 cellspacing=0>"+"<th>Název<th style=width:80px>Uživatelé<th style=width:80px>Skupiny zařízení<th style=width:80px>Zařízení",e)t+=addUserGroupHtml(e[n]);t+="</table>",QV("DuplicateUserGroupButton",!0)}QH("p50groups",t);for(i=document.getElementsByClassName("UserGroupCheckbox"),n=0;n<i.length;n++)i[n].checked=0<=o.indexOf(i[n].value);p50updateInfo(),null!=currentUserGroup&&51==xxcurrentView&&gotoUserGroup(encodeURIComponentEx(currentUserGroup._id),!0)}function addUserGroupHtml(e){var t=0,n=0,o=0;if(e.links)for(var i in e.links)i.startsWith("user/")&&t++,i.startsWith("mesh/")&&n++,i.startsWith("node/")&&o++;var a=EscapeHtml(e.name),s=(null!=serverinfo.crossDomain&&""!=(s=e._id.split("/")[1])&&(a+=", <span style=color:#26F>"+EscapeHtml(s)+"</span>"),"<tr tabindex=0 onmouseover=userMouseHover2(this,1) onmouseout=userMouseHover2(this,0) onkeypress=\"if (event.key=='Enter') gotoUserGroup('"+encodeURIComponentEx(e._id)+"')\"><td style=cursor:pointer>");return(s+="<div class=bar style=width:100%>")+("<div class=baricon><input class=UserGroupCheckbox value="+encodeURIComponentEx(e._id)+" onclick=p50updateInfo() type=checkbox></div>")+('<div class=baricon onclick=gotoUserGroup("'+encodeURIComponentEx(e._id)+'")><div class=m4></div></div>')+('<div class=g1 onclick=gotoUserGroup("'+encodeURIComponentEx(e._id)+'")></div><div class=g2 onclick=gotoUserGroup("'+encodeURIComponentEx(e._id)+'")></div>')+('<div style=line-height:24px onclick=gotoUserGroup("'+encodeURIComponentEx(e._id)+'")><span style=font-size:16px>'+a+"</span></div></div><td style=text-align:center>"+t+"<td style=text-align:center>"+n+"<td style=text-align:center>"+o)}function p50updateInfo(){for(var e=document.getElementsByClassName("UserGroupCheckbox"),t=0,n=0;n<e.length;n++)!0===e[n].checked&&t++;QE("UsersGroupsGroupActionButton",0<t),Q("UsersGroupsSelectAllButton").value=0<t?"Nevybrat nic":"Vybrat vše"}function p50usersSelectallButtonFunction(){for(var e=encodeURIComponentEx(userinfo._id),t=document.getElementsByClassName("UserGroupCheckbox"),n=0,o=0;o<t.length;o++)!0===t[o].checked&&n++;for(o=0;o<t.length;o++)t[o].checked=0==n&&t[o].value!=e;p50updateInfo()}function p50usersGroupActionFunction(){for(var e,t=document.getElementsByClassName("UserGroupCheckbox"),n=0,o=0;o<t.length;o++)!0===t[o].checked&&n++;0!=n&&(e="Vyberte operaci, kterou chcete provést u všech vybraných uživatelů.<br /><br />",setDialogMode(2,"Akce skupiny",3,p50usersGroupActionFunctionEx,e+=addHtmlValue("Operace","<select style=width:240px id=d50groupop><option value=1>Smazat skupinu</option></select>")))}function p50usersGroupActionFunctionEx(){for(var e=document.getElementsByClassName("UserGroupCheckbox"),t=[],n=0;n<e.length;n++)!0===e[n].checked&&t.push(decodeURIComponent(e[n].value));1==Q("d50groupop").value&&(setDialogMode(2,"Odstranit skupiny uživatelů",3,p50groupActionFunctionDelExec,"Potvrdit smazání vybraných skupin uživatelů?<br /><br /><label><input id=d3check type=checkbox onchange=p50usersGroupActionFunctionDelCheck() />Potvrdit</label>"),QE("idx_dlgOkButton",!1))}function p50usersGroupActionFunctionDelCheck(){QE("idx_dlgOkButton",Q("d3check").checked)}function p50groupActionFunctionDelExec(e){for(var t=document.getElementsByClassName("UserGroupCheckbox"),n=0;n<t.length;n++)!0===t[n].checked&&meshserver.send({action:"deleteusergroup",ugrpid:decodeURIComponent(t[n].value)})}function showCreateUserGroupDialog(e){if(!xxdialogMode){var t="",n="";if(2==e){if(usergroups)for(var o in usergroups)n+="<option value="+encodeURIComponentEx(o)+">"+EscapeHtml(usergroups[o].name)+"</option>";t+=addHtmlValue("Skupina uživatelů","<div style=width:230px;margin:0;padding:0><select id=dp4groupid style=width:100%>"+n+"</select></div>")}if(1==e&&serverinfo.crossDomain){n="<select style=width:240px id=p4domain>";for(o in serverinfo.crossDomain)n+="<option value="+o+">"+(""==serverinfo.crossDomain[o]?"Výchozí":EscapeHtml(serverinfo.crossDomain[o]))+"</option>";t+=addHtmlValue("Doména",n+="</select>")}setDialogMode(2,1==e?"Vytvořit skupinu uživatelů":"Duplikovat skupinu uživatelů",3,showCreateUserGroupDialogEx,t=(t+=addHtmlValue("Název","<input id=p4name maxlength=64 onchange=showCreateUserGroupDialogValidate() onkeyup=showCreateUserGroupDialogValidate() />"))+addHtmlValue("Popis",'<textarea id=p4desc value="" style=width:230px;height:60px;resize:none maxlength=1024 /></textarea>'),e),showCreateUserGroupDialogValidate(),Q("p4name").focus()}}function showCreateUserGroupDialogValidate(){QE("idx_dlgOkButton",0<Q("p4name").value.length)}function showCreateUserGroupDialogEx(e,t){var n={action:"createusergroup",name:Q("p4name").value,desc:Q("p4desc").value};2==t&&(n.clone=decodeURIComponent(Q("dp4groupid").value)),1==t&&serverinfo.crossDomain&&(n.domain=serverinfo.crossDomain[parseInt(Q("p4domain").value)]),meshserver.send(n)}var currentUserGroup=null;function gotoUserGroup(e,t){if(!xxdialogMode||t){t=currentUserGroup=usergroups?usergroups[decodeURIComponent(e)]:null;if(null==t)51==xxcurrentView&&(setDialogMode(0),go(50));else{var e=EscapeHtml(t.name),n=(0==e.length&&(e="<i>Nic</i>"),null==currentUserGroup.membershipType&&0!=(256&userinfo.siteadmin)&&(e='<span tabindex=0 title="Kliknutím sem upravíte název skupiny uživatelů" onclick=p51editgroup(1) onkeyup="if (event.key == \'Enter\') p51editgroup(1)" style=cursor:pointer>'+e+' <img class=hoverButton src="images/link5.png" /></span>'),QH("p51groupName",e),0),o=0,i=0;if(t.links)for(var a in t.links)a.startsWith("user/")&&n++,a.startsWith("mesh/")&&o++,a.startsWith("node/")&&i++;var s,r=null==(r=t.desc)||""==r?"<i>Nic<i>":EscapeHtml(r),l="<div style=min-height:80px><table style=width:100%>",r=(0!=(8&args.hide)&&(l+="<br />"+addDeviceAttribute("Název",e)),null==serverinfo.crossDomain&&0==debugmode||(l=(l+=addDeviceAttribute("Doména",""!=(e=t._id.split("/")[1])?EscapeHtml(e):"<i>Výchozí</i>"))+addDeviceAttribute("Identifikátor skupiny",EscapeHtml(t._id))),null!=currentUserGroup.membershipType&&(l+=addDeviceAttribute("Group Type",EscapeHtml(currentUserGroup.membershipType))),0!=(256&userinfo.siteadmin)?l+=addDeviceAttribute("Popis","<span onclick=p51editgroup(2,"+(null!=currentUserGroup.membershipType)+") style=cursor:pointer>"+r+' <img class=hoverButton src="images/link5.png" /></span>'):l+=addDeviceAttribute("Popis",r),1==serverinfo.userGroupsSessionRecording&&(e=[],t.flags&&2&t.flags&&e.push("Záznam relací"),l+=addDeviceAttribute("Funkce",addLink(e=""==(e=e.join(", "))?"<i>Nic</i>":e,"p51edituserGroupFeatures()"))),[]),e=0,d=(t.consent&&(e=t.consent),serverinfo.consent&&(e|=serverinfo.consent),64&e&&8&e?r.push("Výzva na ploše+panel nástrojů"):64&e?r.push("Panel nástrojů na ploše"):8&e?r.push("Výzva na ploše"):1&e&&r.push("Informovat na ploše"),16&e?r.push("Výzva terminálu"):2&e&&r.push("Oznámení terminálu"),32&e?r.push("Dotaz na soubory"):4&e&&r.push("Upozornit na soubory"),7==e&&(r=["Vždy upozornit"]),l=(l=(l=(l+=addDeviceAttribute("Souhlas uživatele",addLinkConditional(r=""==(r=(r=56==(56&e)?["Vždy se dotázat"]:r).join(", "))?"<i>Nic</i>":r,"p20editmeshconsent(4)",!0)))+addDeviceAttribute("Uživatelé",n))+addDeviceAttribute("Skupiny zařízení",o))+addDeviceAttribute("Zařízení",i)+"</table></div><br />",0!=(256&userinfo.siteadmin)&&(l+='<input type=button value="Hromadná zpráva" title="Odeslat upozornění všem uživatelům v této skupině." onclick=showUserBroadcastDialog("'+encodeURIComponentEx(t._id)+'") />'),QH("p51group",l),l="<br />",null==currentUserGroup.membershipType&&0!=(256&userinfo.siteadmin)&&(l+='<a href=# onclick="return p51showAddUserDialog()" style=cursor:pointer;margin-right:10px><img src=images/icon-addnew.png border=0 height=12 width=12> Přidat uživatele</a>'),l+='<table style="color:black;background-color:#EEE;border-color:#AAA;border-width:1px;border-style:solid;border-collapse:collapse" border=0 cellpadding=2 cellspacing=0 width=100%><tbody><tr style=background-color:#AAAAAA;font-weight:bold><th scope=col style=text-align:left;width:430px>Členové skupiny</th><th scope=col style=text-align:left></th></tr>',1),u=[];for(a in currentUserGroup.links)0!=a.startsWith("user/")&&(s=a.split("/")[2],currentUserGroup.links[a].name&&(s=currentUserGroup.links[a].name),a==userinfo._id&&(s=userinfo.name),u.push({id:a,name:s,rights:currentUserGroup.links[a].rights}));for(a in u.sort(function(e,t){return e.name>t.name?1:e.name<t.name?-1:0}),u){var c="",p=(null==currentUserGroup.membershipType&&(c="<a href=# onclick='return p51deleteUser(event,\""+encodeURIComponentEx(u[a].id)+'")\' title="Odebrat práva uživatele na tuto skupinu zařízení" style=cursor:pointer><img src=images/trash.png border=0 height=10 width=10></a>'),EscapeHtml(decodeURIComponent(u[a].name)));l+="<tr "+(d%2==0?"style=background-color:#DDD":"")+'><td><div title="Uživatel" class=m2></div><div>&nbsp;'+(p=null!=users?"<a href=# onclick='gotoUser(\""+encodeURIComponentEx(u[a].id)+"\");haltEvent(event);'>"+p+"</a>":p)+"<div></div></div></td><td><div style=float:right>"+c+"</div></td></tr>",++d}1==d&&(l+="<tr><td><div style=padding:6px>&nbsp;<i>Žádní členové</i><div></div></div></td><td></td></tr>"),l+="</tbody></table><br />";var d=1,m=0,v=!1;for(a in meshes)currentUserGroup._id.split("/")[1]==meshes[a]._id.split("/")[1]&&(m++,null==currentUserGroup.links||null==currentUserGroup.links[a])&&(v=!0);if(0<m&&v&&(l+='<a href=# onclick="return p20showAddMeshUserDialog(3)" style=cursor:pointer;margin-right:10px><img src=images/icon-addnew.png border=0 height=12 width=12> Přidat skupinu zařízení</a>'),l+='<table style="color:black;background-color:#EEE;border-color:#AAA;border-width:1px;border-style:solid;border-collapse:collapse" border=0 cellpadding=2 cellspacing=0 width=100%><tbody><tr style=background-color:#AAAAAA;font-weight:bold><th scope=col style=text-align:left;width:430px>Společné skupiny zařízení</th><th scope=col style=text-align:left></th></tr>',currentUserGroup.links){var g=[];for(a in currentUserGroup.links)a.startsWith("mesh/")&&null!=meshes[a]&&g.push(meshes[a]);for(a in g=getOrderedList(g,"name")){var h=0,f=g[a],c="",k=makeDeviceGroupRightsString(currentUserGroup.links[f._id].rights),y=(userinfo.links&&null!=userinfo.links[f._id]&&null!=userinfo.links[f._id].rights&&(h=userinfo.links[f._id].rights),"<i>Neznámá skupina zařízení</i>");f&&(y="<a href=# onclick='gotoMesh(\""+f._id+"\");haltEvent(event);'>"+f.name+"</a>"),0!=(2&h)&&(c="<a href=# onclick='return p51removeMeshFromUserGroup(event,\""+encodeURIComponentEx(f._id)+'")\' title="Odebrat práva skupiny uživatelů na tuto skupinu zařízení" style=cursor:pointer><img src=images/trash.png border=0 height=10 width=10></a>',k='<span style=cursor:pointer onclick=p20showAddMeshUserDialog(3,"'+encodeURIComponentEx(f._id)+'")>'+k+" <img class=hoverButton style=cursor:pointer src=images/link5.png></span>"),l+="<tr "+(++d%2==0?"style=background-color:#DDD":"")+'><td style=width:30%><div title="Skupina zařízení" class=m99></div><div>&nbsp;'+y+"<div></div></div></td><td style=width:70%><div style=float:right>"+c+"</div><div>"+k+"</div></td></tr>"}}if(1==d&&(l+="<tr><td><div style=padding:6px>&nbsp;<i>Žádné společné skupiny zařízení</i><div></div></div></td><td></td></tr>"),d=1,l=l+"</tbody></table>"+"<br />",currentUserGroup._id.split("/")[1]==userinfo._id.split("/")[1]&&(l+='<a href=# onclick="return p20showAddMeshUserDialog(7)" style=cursor:pointer;margin-right:10px><img src=images/icon-addnew.png border=0 height=12 width=12> Přidat zařízení</a>'),l+='<table style="color:black;background-color:#EEE;border-color:#AAA;border-width:1px;border-style:solid;border-collapse:collapse" border=0 cellpadding=2 cellspacing=0 width=100%><tbody><tr style=background-color:#AAAAAA;font-weight:bold><th scope=col style=text-align:left;width:430px>Společná zařízení</th><th scope=col style=text-align:left></th></tr>',currentUserGroup.links){var x=[];for(a in currentUserGroup.links)a.startsWith("node/")&&null!=(b=getNodeFromId(a))&&x.push(b);for(a in x=getOrderedList(x,"name")){var b=x[a],c="",k=makeUserDeviceRightsString(currentUserGroup.links[b._id].rights),h=GetNodeRights(b),w="<i>Neznámé zařízení</i>";b&&(w="<a href=# onclick='gotoDevice(\""+b._id+"\");haltEvent(event);'>"+b.name+"</a>"),0!=(2&h)&&(c="<a href=# onclick='return p51removeDeviceFromUserGroup(event,\""+encodeURIComponentEx(b._id)+'")\' title="Odeberte práva skupiny uživatelů tomuto zařízení" style=cursor:pointer><img src=images/trash.png border=0 height=10 width=10></a>',k='<span style=cursor:pointer onclick=p20showAddMeshUserDialog(7,"'+encodeURIComponentEx(b._id)+'")>'+k+" <img class=hoverButton style=cursor:pointer src=images/link5.png></span>"),l+="<tr "+(++d%2==0?"style=background-color:#DDD":"")+'><td style=width:30%><div title="Skupina zařízení" class=m99></div><div>&nbsp;'+w+"<div></div></div></td><td style=width:70%><div style=float:right>"+c+"</div><div>"+k+"</div></td></tr>"}}1==d&&(l+="<tr><td><div style=padding:6px>&nbsp;<i>Žádná společná zařízení</i><div></div></div></td><td></td></tr>"),l+="</tbody></table>",null!=currentUserGroup.membershipType&&0!=n||0==(256&userinfo.siteadmin)||(l+="<div style=font-size:small;text-align:right><span><a href=# onclick=p51showDeleteUserGroupDialog() style=cursor:pointer>Smazat skupinu uživatelů</a></span></div>"),QH("p51group2",l),go(51);var S="";if(0==(268435456&features)&&51<=xxcurrentView&&xxcurrentView<=59&&null!=currentUserGroup){for(var a in S="?viewmode="+xxcurrentView+"&gotougrp="+(serverinfo.crossDomain?currentUserGroup._id:currentUserGroup._id.split("/")[2]),urlargs)S+="&"+a+"="+urlargs[a];try{window.history.replaceState({},document.title,window.location.pathname+S)}catch(e){}}}}}function p51edituserGroupFeatures(){var e,t;xxdialogMode||(e=currentUserGroup.flags||0,t="",1==serverinfo.userGroupsSessionRecording&&(t+="<div><label><input type=checkbox id=d51flag1 "+(2&e?"checked":"")+">Zaznamenejte relace</label><br></div>"),setDialogMode(2,"Upravit funkce skupiny uživatelů",3,p51edituserGroupFeaturesEx,t))}function p51edituserGroupFeaturesEx(){var e=0;1==serverinfo.userGroupsSessionRecording&&Q("d51flag1").checked&&(e+=2),meshserver.send({action:"editusergroup",ugrpid:currentUserGroup._id,flags:e})}function p51removeDeviceFromUserGroup(e,t){xxdialogMode||null!=(t=getNodeFromId(decodeURIComponent(t)))&&setDialogMode(2,"Odebrat oprávnění zařízení",3,p51removeDeviceFromUserGroupEx,format("Potvrdit odebrání přístupových práv pro zařízení „{0}“?",t.name),t._id)}function p51removeDeviceFromUserGroupEx(e,t){meshserver.send({action:"adddeviceuser",nodeid:t,userids:[currentUserGroup._id],rights:0,remove:!0})}function p51removeMeshFromUserGroup(e,t){xxdialogMode||null!=(t=meshes[decodeURIComponent(t)])&&setDialogMode(2,"Odebrat oprávnění skupiny zařízení",3,p51removeMeshFromUserGroupEx,format("Potvrdit odebrání přístupových práv pro skupinu zařízení „{0}“?",t.name),t._id)}function p51removeMeshFromUserGroupEx(e,t){meshserver.send({action:"removemeshuser",meshid:t,userid:currentUserGroup._id})}function p51editgroup(e,t){xxdialogMode||(t=addHtmlValue("Název","<input id=dp51name style=width:230px maxlength=32 onchange=p51editgroupValidate() onkeyup=p51editgroupValidate(event) "+(t?"readonly disabled":"")+"/>"),setDialogMode(2,"Upravit skupinu uživatelů",3,p51editgroupEx,t+=addHtmlValue("Popis","<div style=width:230px;margin:0;padding:0><textarea id=dp51desc maxlength=1024 style=width:100%;resize:none></textarea></div>")),Q("dp51name").value=currentUserGroup.name,currentUserGroup.desc&&(Q("dp51desc").value=currentUserGroup.desc),p51editgroupValidate(),(2==e?Q("dp51desc"):Q("dp51name")).focus())}function p51editgroupEx(){meshserver.send({action:"editusergroup",ugrpid:currentUserGroup._id,name:Q("dp51name").value,desc:Q("dp51desc").value})}function p51editgroupValidate(e){QE("idx_dlgOkButton",0<Q("dp51name").value.length),e&&"Enter"==e.key&&Q("dp51desc").focus()}function p51showDeleteUserGroupDialog(){var e;return xxdialogMode||(e=format("Smazat skupinu uživatlů {0}?",EscapeHtml(currentUserGroup.name))+"<br /><br />",setDialogMode(2,"Smazat skupinu uživatelů",3,p51showDeleteUserGroupDialogEx,e+="<label><input id=p51check type=checkbox onchange=p51validateDeleteGroupDialog() />Potvrdit</label>"),p51validateDeleteGroupDialog()),!1}function p51validateDeleteGroupDialog(){QE("idx_dlgOkButton",Q("p51check").checked)}function p51showDeleteUserGroupDialogEx(e,t){meshserver.send({action:"deleteusergroup",ugrpid:currentUserGroup._id})}function p51deleteUser(e,t){return haltEvent(e),p51viewuserEx(2,decodeURIComponent(t)),!1}function p51viewuserEx(e,t){2==e&&(e=t.split("/")[2],users&&users[t]&&(e=users[t].name),userinfo._id==t&&(e=userinfo.name),setDialogMode(2,"Odebrat uživatelské členství",3,p51viewuserEx2,format("Potvrdit odebrání členství uživateli „{0}“?",EscapeHtml(decodeURIComponent(e))),t))}function p51viewuserEx2(e,t){meshserver.send({action:"removeuserfromusergroup",ugrpid:currentUserGroup._id,userid:t})}function p51showAddUserDialog(){var e;return xxdialogMode||(e="Umožnit uživatelům spravovat tuto skupinu a zařízení v této skupině.",524288&features&&(e+=" Než budou moci být přiřazeni ke skupině zařízení, je třeba aby se uživatelé alespoň jednou k tomuto serveru přihlásili."),setDialogMode(2,"Přidat uživatele do skupiny",3,p51showAddUserDialogEx,e=(e=(e+="<br /><br /><div style='position:relative'>")+addHtmlValue("Identifikátory uživatelů",'<input id=dp51username style=width:230px maxlength=32 onchange=p51validateAddUserDialog() onkeyup=p51validateAddUserDialog() placeholder="user1, user2, user3" />'))+"<div id=dp51usersuggest class=suggestionBox style='top:30px;left:130px;display:none'></div>"+"</div><br>"),Q("dp51username").focus(),p51validateAddUserDialog()),!1}function p51setname(e){e=decodeURIComponent(e);var t,n=Q("dp51username").value.split(",");for(t in n)n[t]=n[t].trim();return n[n.length-1]=e,Q("dp51username").value=n.join(", "),p51validateAddUserDialog(),!1}function p51validateAddUserDialog(){var e=!0;if(Q("dp51username")){var t=Q("dp51username").value.split(",");for(l in t){var n=t[l]=t[l].trim();(0==n.length||0<=n.indexOf('"'))&&(e=!1)}var o=!1,i=!1;if(null!=users){var a=t[t.length-1].trim(),s=a.toLowerCase(),r=[];if(0<a.length){for(var l in users){var d=users[l]._id.split("/");if(currentUserGroup.domain==d[1]&&d[2]===s){i=!0;break}if(0<=users[l].name.toLowerCase().indexOf(s)&&currentUserGroup.domain==d[1]&&(r.push([users[l]._id,users[l].name]),8<=r.length))break}if(0==i&&0<r.length){var u="";for(l in r){var c=r[l][0],p=r[l][1];c.split("/")[2]==p.toLowerCase()?u+="<div class=suggestionBoxItem onclick='p51setname(\""+encodeURIComponentEx(c.split("/")[2])+"\")'>"+EscapeHtml(p)+"</div>":u+="<div class=suggestionBoxItem onclick='p51setname(\""+encodeURIComponentEx(c.split("/")[2])+"\")'><div>"+EscapeHtml(p)+"</div><div class=suggestionBoxSubItem>"+EscapeHtml(c.split("/")[2])+"</div></div>"}QH("dp51usersuggest",u),o=!0}}}QV("dp51usersuggest",o)}QE("idx_dlgOkButton",e)}function p51showAddUserDialogEx(e,t){if(null==t){var n,o=Q("dp51username").value.split(","),i=[];for(n in o)i.push(o[n].trim());meshserver.send({action:"addusertousergroup",ugrpid:currentUserGroup._id,usernames:i})}else meshserver.send({action:"addusertousergroup",ugrpid:currentUserGroup._id,usernames:[t.split("/")[2]]})}var currentUser=null;function gotoUser(e,t,n){if((!xxdialogMode||t)&&(null==n||null==n.originalTarget||null==n.originalTarget.href)){var o=currentUser=users[decodeURIComponent(e)];if(null==o)setDialogMode(0),go(4);else{QH("p30userName",EscapeHtml(o.name)),QH("p31userName",EscapeHtml(o.name));var t=o._id==userinfo._id,n=0,e=(null!=wssessions&&wssessions[o._id]&&(n=wssessions[o._id]),null!=o.flags&&1&o.flags?(QV("MainUserImage",!1),QV("MainUserImageEx",!0),null==o.accountImageRnd&&(o.accountImageRnd=Math.floor(9999999999*Math.random())),Q("MainUserImageEx").src="userimage.ashx?id="+o._id.split("/")[2]+"&rnd="+o.accountImageRnd):(Q("MainUserImage").classList.remove("gray"),0==n&&Q("MainUserImage").classList.add("gray"),QV("MainUserImage",!0),QV("MainUserImageEx",!1)),o._id.split("/")[2]),e=(e.startsWith("~twitter:")?(QV("p30userAuthServiceLogo",!0),Q("p30userAuthServiceLogo").src="images/login/twitter64.png"):e.startsWith("~google:")?(QV("p30userAuthServiceLogo",!0),Q("p30userAuthServiceLogo").src="images/login/google64.png"):e.startsWith("~github:")?(QV("p30userAuthServiceLogo",!0),Q("p30userAuthServiceLogo").src="images/login/github64.png"):e.startsWith("~azure:")?(QV("p30userAuthServiceLogo",!0),Q("p30userAuthServiceLogo").src="images/login/azure64.png"):e.startsWith("~oidc:")?(QV("p30userAuthServiceLogo",!0),Q("p30userAuthServiceLogo").src="images/login/oidc64.png"):e.startsWith("~jumpcloud:")?(QV("p30userAuthServiceLogo",!0),Q("p30userAuthServiceLogo").src="images/login/jumpcloud64.png"):e.startsWith("~intel:")?(QV("p30userAuthServiceLogo",!0),Q("p30userAuthServiceLogo").src="images/login/intel64.png"):e.startsWith("~:")?(QV("p30userAuthServiceLogo",!0),Q("p30userAuthServiceLogo").src="images/login/generic64.png"):QV("p30userAuthServiceLogo",!1),[]),i="",a=(null!=o.siteadmin&&0!=(32&o.siteadmin)&&4294967295!=o.siteadmin&&(i='<img src="images/padlock12.png" height=12 width=8 title="Účet je uzamčen" style="margin-top:2px" /> ',e.push("Uzamknutý účet")),null==o.siteadmin||0==(4294966047&o.siteadmin)?e.push("Žádná práva k serveru"):8==o.siteadmin?e.push("Přístup k souborům na serveru"):4294967295==o.siteadmin?e.push("Administrátor"):e.push("Částečná práva"),null!=o.siteadmin&&4294967295!=o.siteadmin&&0!=(1216&o.siteadmin)&&e.push("Omezení"),"<div style=min-height:80px><table style=width:100%>"),s=(0!=(8&args.hide)&&(a+="<br />"+addDeviceAttribute("Název",o.name)),o.email?EscapeHtml(o.email):"<i>Nenastaveno</i>"),r="",l=o.realname?EscapeHtml(o.realname):"<i>Nenastaveno</i>",d=(serverinfo.emailcheck&&(r=1==o.emailVerified?'<b style=color:green;cursor:pointer title="E-mail je ověřen">&#x2713</b> ':'<b style=color:red;cursor:pointer title="E-mail není ověřen">&#x2717;</b> '),serverinfo.crossDomain||0!=debugmode?a=(a+=addDeviceAttribute("Doména",""!=(d=o._id.split("/")[1])?EscapeHtml(d):"<i>Výchozí</i>"))+addDeviceAttribute("Identifikátor uživatele",EscapeHtml(o._id)):o.name.toLowerCase()!=o._id.split("/")[2]&&(a+=addDeviceAttribute("Identifikátor uživatele",EscapeHtml(o._id.split("/")[2]))),""),r=(o.email&&(d=' <a href="mailto:'+EscapeHtml(o.email)+'" \'><img class=hoverButton src="images/link1.png" /></a>'),a=4294967295!=o.siteadmin||4294967295==userinfo.siteadmin?(a+=addDeviceAttribute("E-mail",'<span style=cursor:pointer onclick=p30showUserEmailChangeDialog(event,"'+encodeURIComponentEx(o._id)+'")>'+r+s+d+' <img class=hoverButton style=cursor:pointer src="images/link5.png" /></span>'))+addDeviceAttribute("Skutečné jméno",'<span style=cursor:pointer onclick=p30showUserRealNameChangeDialog(event,"'+encodeURIComponentEx(o._id)+'")>'+l+' <img class=hoverButton style=cursor:pointer src="images/link5.png" /></span>'):(a+=addDeviceAttribute("E-mail",r+s+d))+addDeviceAttribute("Skutečné jméno",l),(33554432&features||null!=o.phone)&&(a+=addDeviceAttribute("Telefonní číslo","<span style=cursor:pointer onclick=p30editPhone()>"+(o.phone||"<i>Nic</i>")+' <img class=hoverButton style=cursor:pointer src="images/link5.png" /></span>')),(33554432&features2||null!=o.msghandle)&&(a+=addDeviceAttribute("Messaging",'<span style=cursor:pointer onclick=p30editMessaging()><img src="images/messaging12.png" height=12 width=12 title="Messaging enabled" style="margin-top:2px" /> '+(o.msghandle||"<i>Nic</i>")+' <img class=hoverButton style=cursor:pointer src="images/link5.png" /></span>')),[]),u=(1==serverinfo.usersSessionRecording&&o.flags&&2&o.flags&&r.push("Záznam relací"),o.removeRights&&(0!=(8&o.removeRights)?r.push("Žádné dálkové ovládání"):(0!=(65536&o.removeRights)?r.push("Žádná plocha"):0!=(256&o.removeRights)&&r.push("Pouze zobrazení na ploše"),0!=(512&o.removeRights)&&r.push("Žádný terminál"),0!=(1024&o.removeRights)&&r.push("Žádné soubory")),0!=(16&o.removeRights)&&r.push("Žádná konzola"),0!=(32768&o.removeRights)&&r.push("Žádná odinstalace"),0!=(131072&o.removeRights)&&r.push("Žádné dálkové ovládání"),0!=(64&o.removeRights)&&r.push("Žádné probuzení"),0!=(262144&o.removeRights))&&r.push("Bez resetu/vypnutí"),a=(a+=addDeviceAttribute("Funkce",addLink(r=""==(r=r.join(", "))?"<i>Nic</i>":r,"p20edituserfeatures()")))+addDeviceAttribute("Práva serveru","<span style=cursor:pointer onclick='return showUserAdminDialog(event,\""+encodeURIComponentEx(o._id)+"\")'>"+i+e.join(", ")+' <img style=cursor:pointer class=hoverButton src="images/link5.png" /></span>'),o.quota&&(a+=addDeviceAttribute("Kvóta serveru",EscapeHtml(parseInt(o.quota)/1024)+" k")),a+=addDeviceAttribute("Vytvořen",printDateTime(new Date(1e3*o.creation))),o.login&&(a+=addDeviceAttribute("Poslední přihlášení",printDateTime(new Date(1e3*o.login)))),-1==o.passchange?a+=addDeviceAttribute("Heslo","Bude změněno při příštím přihlášení."):o.passchange&&(a+=addDeviceAttribute("Heslo",format("Poslední změna: {0}",printDateTime(new Date(1e3*o.passchange))))),0),s="<i>Nic<i>";if(o.links){for(var c in o.links)c.startsWith("mesh/")&&u++;1==u?s="1 skupina":1<u&&(s=format("{0} skupin",u))}if(a+=addDeviceAttribute("Skupiny zařízení",s),4294967295==userinfo.siteadmin||2&userinfo.siteadmin){var p="<i>Nic</i>";if(o.groups)for(var c in p="",o.groups)p+='<span class="tagSpan">'+EscapeHtml(o.groups[c])+"</span>";a+=addDeviceAttribute("Oblasti správy",addLinkConditional(p,'showUserGroupDialog(event,"'+encodeURIComponentEx(o._id)+'")',4294967295==userinfo.siteadmin||null==userinfo.groups&&userinfo._id!=o._id&&4294967295!=o.siteadmin))}d=[],l=0,r=(o.consent&&(l=o.consent),serverinfo.consent&&(l|=serverinfo.consent),64&l&&8&l?d.push("Výzva na ploše+panel nástrojů"):64&l?d.push("Panel nástrojů na ploše"):8&l?d.push("Výzva na ploše"):1&l&&d.push("Informovat na ploše"),16&l?d.push("Výzva terminálu"):2&l&&d.push("Oznámení terminálu"),32&l?d.push("Dotaz na soubory"):4&l&&d.push("Upozornit na soubory"),7==l&&(d=["Vždy upozornit"]),a+=addDeviceAttribute("Souhlas uživatele",addLinkConditional(d=""==(d=(d=56==(56&l)?["Vždy se dotázat"]:d).join(", "))?"<i>Nic</i>":d,"p20editmeshconsent(2)",!0)),0);if((0<o.otpsecret||0<o.otphkeys||0<o.otpekey||0<o.otpduo)&&(r=1,i=[],0<o.otpsecret&&i.push("Aplikace pro ověřování se"),0<o.otphkeys&&i.push("Klíč zabezpečení"),0<o.otpekey&&i.push("E-mail"),0<o.otpduo&&i.push("Duo"),0<o.otpkeys&&i.push("Záložní kódy"),0<o.otpdev&&i.push("Zařízení Push"),null!=o.phone&&67108864&features&&i.push("SMS"),null!=o.msghandle&&67108864&features2&&i.push("Messaging"),a+=addDeviceAttribute("Zabezpečení",'<img src="images/key12.png" height=12 width=11 title="2-faktorové ověřování zapnuto" style="margin-top:2px" /> '+i.join(", "))),a=(a+="</table></div><br />")+('<input type=button value="Poznámky" title="Zobrazit poznámky k tomto uživateli" onclick=showNotes(false,"'+encodeURIComponentEx(o._id)+'") />'),o.phone&&33554432&features&&(a+='<input type=button value="SMS" title="Pošlete tomuto uživateli zprávu SMS" onclick=showSendSMS("'+encodeURIComponentEx(o._id)+'") />'),o.msghandle&&33554432&features2&&(a+='<input type=button value="Zpráva" title="Send a message to this user" onclick=showSendMessage("'+encodeURIComponentEx(o._id)+'") />'),"string"==typeof o.email&&!0===o.emailVerified&&64&features&&(a+='<input type=button value="E-mail" title="Pošlete e-mailovou zprávu tomuto uživateli" onclick=showSendEmail("'+encodeURIComponentEx(o._id)+'") />'),!t&&(0<n||8&features2&&o.webpush)&&(a=(a+='<input type=button value="Upozornit" title="Poslat upozornění uživateli" onclick=showUserAlertDialog(event,"'+encodeURIComponentEx(o._id)+'") />')+'<input type=button value="Chat" title="Chat" onclick=userChat(event,"'+encodeURIComponentEx(o._id)+'","'+encodeURIComponentEx(o.name)+'") />',0<n)&&null!=serverinfo&&null!=serverinfo.altmessenging)for(var c in serverinfo.altmessenging){var m=serverinfo.altmessenging[c];null!=m.type&&"user"!=m.type||(a+='<input type=button value="'+EscapeHtml(m.name)+'" onclick=altUserChat(event,"'+encodeURIComponentEx(o._id)+'","'+encodeURIComponentEx(o.name)+'",'+c+") />")}QH("p30html",a),drawUserPermissions();var e=null!=userinfo.siteadmin&&2&userinfo.siteadmin&&4294967295!=o.siteadmin||4294967295==userinfo.siteadmin,v=(a="<div style=float:right;font-size:small>",e&&userinfo._id!=o._id&&(a+="<a href=# style=cursor:pointer onclick='return p30showDeleteUserDialog()' title=\"Odebrat tohoto uživatele\">Smazat uživatele</a>"),a+="</div><div style=font-size:small>",e&&0==(524288&features)&&"~"!=o._id.split("/")[2][0]&&(a=a+"<a href=# style=cursor:pointer onclick='return p30showUserChangePassDialog("+r+')\' title="Změňte heslo pro tohoto uživatele">Změnit heslo</a> <a href=# style=cursor:pointer onclick=\'return p30viewPreviousLogins()\' title="Zobrazit předchozí přihlášení pro tohoto uživatele">Předchozí přihlášení</a>'),a+="</div><br>",QH("p30html3",a),a="",1==n?a="1 aktivní relace":1<n&&(a=format("{0} aktivních spojení",n)),QH("MainUserState",a),go(30),QH("p31events",""),refreshUsersEvents(),"");if(0==(268435456&features)&&30<=xxcurrentView&&xxcurrentView<=39&&null!=currentUser){for(var c in v="?viewmode="+xxcurrentView+"&gotouser="+(serverinfo.crossDomain?currentUser._id:currentUser._id.split("/")[2]),urlargs)v+="&"+c+"="+urlargs[c];try{window.history.replaceState({},document.title,window.location.pathname+v)}catch(e){}}}}}function p30editPhone(){xxdialogMode||(setDialogMode(2,"Telefonní oznámení",3,p30editPhoneEx,'<table style=width:100%><tr><td style=width:56px><img src="images/phone80.png" style=padding:8px>'+"<td style=width:100%;text-align:center>Telefonní číslo podporující SMS pro tohoto uživatele.<br />Nechte prázdné."+('<br /><br /><div style=width:100%;text-align:center>Telefonní číslo: <input type=tel pattern="[0-9]" autocomplete="tel" value="'+(currentUser.phone||"")+'" inputmode="tel" maxlength=18 id=d2phoneinput onKeyUp=p30editPhoneValidate() onkeypress="if (event.key==\'Enter\') p30editPhoneValidate(1)"></div></table>'),"verifyPhone"),Q("d2phoneinput").focus(),p30editPhoneValidate())}function p30editMessaging(){var e,t;xxdialogMode||(t="<select id=d2serviceselect style=width:160px;margin-left:8px onchange=p30editMessagingValidate()><option value=0>Nic</option>",0!=(1&serverinfo.userMsgProviders)&&(t+="<option value=1>Telegram</option>"),0!=(4&serverinfo.userMsgProviders)&&(t+="<option value=4>Discord</option>"),0!=(8&serverinfo.userMsgProviders)&&(t+="<option value=8>XMPP</option>"),0!=(16&serverinfo.userMsgProviders)&&(t+="<option value=16>CallMeBot</option>"),0!=(32&serverinfo.userMsgProviders)&&(t+="<option value=32>Pushover</option>"),0!=(64&serverinfo.userMsgProviders)&&(t+="<option value=64>ntfy</option>"),0!=(128&serverinfo.userMsgProviders)&&(t+="<option value=128>Zulip</option>"),0!=(256&serverinfo.userMsgProviders)&&(t+="<option value=256>Slack</option>"),e=(e='<table style=width:100%><tr><td style=width:56px;vertical-align:top><img src="images/messaging40.png" style=padding:8px>')+"<td style=width:100%>Messaging account for this user.<table style=margin-top:12px><tr><td>Service<td>"+(t+="</select>")+"<tr><td>Handle<td><input maxlength=1024 style=width:160px;margin-left:8px id=d2handleinput onKeyUp=p30editMessagingValidate() onkeypress=\"if (event.key=='Enter') p30editMessagingValidate(1)\"></table>",serverinfo.discordUrl&&(e+="<div id=d2discordurl style=display:none><br /><a href="+serverinfo.discordUrl+' target="_discord">Join this Discord server to receive notifications.</a></div>'),setDialogMode(2,"Messaging Notifications",3,p30editMessagingEx,e=(e=e+'<div id=d2callmebotinfo style=display:none><br /><a href=https://www.callmebot.com/blog/free-api-signal-send-messages/ target="_callmebot">Signal</a>, <a href=https://www.callmebot.com/blog/free-api-whatsapp-messages/ target="_callmebot">Whatsapp</a>, <a href=https://www.callmebot.com/blog/free-api-facebook-messenger/ target="_callmebot">Facebook</a>, <a href=https://www.callmebot.com/blog/telegram-text-messages/ target="_callmebot">Telegram</a></div>'+'<div id=d2pushoverinfo style=display:none><br /><a href=https://pushover.net/ target="_pushover">Information at Pushover.net</a></div>')+('<div id=d2ntfyinfo style=display:none><br /><a href="'+(serverinfo.userMsgNftyUrl||"https://ntfy.sh/")+'" target="_ntfy">Free service at ntfy.sh</a></div>')+'<div id=d2slackinfo style=display:none><br /><a href=https://api.slack.com/messaging/webhooks target="_slack">Slack Webhook Setup</a></div>',"verifyMessaging"),Q("d2handleinput").focus(),currentUser.msghandle&&(currentUser.msghandle.startsWith("telegram:")&&0!=(1&serverinfo.userMsgProviders)&&(Q("d2serviceselect").value=1,Q("d2handleinput").value=currentUser.msghandle.substring(10)),currentUser.msghandle.startsWith("discord:")&&0!=(4&serverinfo.userMsgProviders)&&(Q("d2serviceselect").value=4,Q("d2handleinput").value=currentUser.msghandle.substring(8)),currentUser.msghandle.startsWith("xmpp:")&&0!=(8&serverinfo.userMsgProviders)&&(Q("d2serviceselect").value=8,Q("d2handleinput").value=currentUser.msghandle.substring(5)),currentUser.msghandle.startsWith("callmebot:")&&0!=(16&serverinfo.userMsgProviders)&&(Q("d2serviceselect").value=16,"signal"==(t=currentUser.msghandle.substring(10).split("|"))[0]&&3==t.length&&(Q("d2handleinput").value="https://api.callmebot.com/signal/send.php?phone="+decodeURIComponent(t[1])+"&apikey="+decodeURIComponent(t[2])),"whatsapp"==t[0]&&3==t.length&&(Q("d2handleinput").value="https://api.callmebot.com/whatsapp.php?phone="+decodeURIComponent(t[1])+"&apikey="+decodeURIComponent(t[2])),"facebook"==t[0])&&2==t.length&&(Q("d2handleinput").value="https://api.callmebot.com/facebook/send.php?apikey="+decodeURIComponent(t[1])),currentUser.msghandle.startsWith("pushover:")&&0!=(32&serverinfo.userMsgProviders)&&(Q("d2serviceselect").value=32,Q("d2handleinput").value=currentUser.msghandle.substring(9)),currentUser.msghandle.startsWith("ntfy:")&&0!=(64&serverinfo.userMsgProviders)&&(Q("d2serviceselect").value=64,Q("d2handleinput").value=currentUser.msghandle.substring(5)),currentUser.msghandle.startsWith("zulip:")&&0!=(128&serverinfo.userMsgProviders)&&(Q("d2serviceselect").value=128,Q("d2handleinput").value=currentUser.msghandle.substring(6)),currentUser.msghandle.startsWith("slack:"))&&0!=(256&serverinfo.userMsgProviders)&&(Q("d2serviceselect").value=256,Q("d2handleinput").value=currentUser.msghandle.substring(6)),p30editMessagingValidate())}function p30editMessagingValidate(e){QE("d2handleinput",0!=Q("d2serviceselect").value),serverinfo.discordUrl&&QV("d2discordurl",4==Q("d2serviceselect").value),QV("d2callmebotinfo",16==Q("d2serviceselect").value),QV("d2pushoverinfo",32==Q("d2serviceselect").value),QV("d2ntfyinfo",64==Q("d2serviceselect").value),QV("d2slackinfo",256==Q("d2serviceselect").value),0==Q("d2serviceselect").value?Q("d2handleinput").placeholder="":4==Q("d2serviceselect").value?Q("d2handleinput").placeholder="Username:0000":8==Q("d2serviceselect").value?Q("d2handleinput").placeholder="username@server.com":16==Q("d2serviceselect").value?Q("d2handleinput").placeholder="https://api.callmebot.com/...":32==Q("d2serviceselect").value?Q("d2handleinput").placeholder="User key":64==Q("d2serviceselect").value?Q("d2handleinput").placeholder="Téma":128==Q("d2serviceselect").value?Q("d2handleinput").placeholder="username@sample.com":256==Q("d2serviceselect").value?Q("d2handleinput").placeholder="https://hooks.slack.com/...":Q("d2handleinput").placeholder="Uživatelské jméno",1==e&&dialogclose(1)}function p30editMessagingEx(){var e=null;""==Q("d2handleinput").value||0==Q("d2serviceselect").value?e="":1==Q("d2serviceselect").value?e="telegram:@"+Q("d2handleinput").value:4==Q("d2serviceselect").value?e="discord:"+Q("d2handleinput").value:8==Q("d2serviceselect").value?e="xmpp:"+Q("d2handleinput").value:16==Q("d2serviceselect").value?e="callmebot:"+Q("d2handleinput").value:32==Q("d2serviceselect").value?e="pushover:"+Q("d2handleinput").value:64==Q("d2serviceselect").value?e="ntfy:"+Q("d2handleinput").value:128==Q("d2serviceselect").value?e="zulip:"+Q("d2handleinput").value:256==Q("d2serviceselect").value&&(e="slack:"+Q("d2handleinput").value),null!=e&&meshserver.send({action:"edituser",id:currentUser._id,msghandle:e})}function p20edituserfeatures(){var e,t,n;xxdialogMode||(e=currentUser.flags||0,t=currentUser.removeRights||0,n=n="",1==serverinfo.usersSessionRecording&&(n+="<div><label><input type=checkbox id=d20flag1 onchange=p20edituserfeaturesValidate() "+(2&e?"checked":"")+">Zaznamenejte relace</label><br></div>"),setDialogMode(2,"Upravit uživatelské funkce",3,p20edituserfeaturesEx,n=(n=(n=(n=(n=n+("<div><label><input type=checkbox id=d20flag7 onchange=p20edituserfeaturesValidate() "+(8&t?"checked":"")+">Žádné dálkové ovládání</label><br></div>")+("<div style=margin-left:8px><label><input type=checkbox id=d20flag2 onchange=p20edituserfeaturesValidate() "+(65536&t?"checked":"")+">Žádný přístup na plochu</label><br></div>"))+("<div style=margin-left:16px><label><input type=checkbox id=d20flag3 onchange=p20edituserfeaturesValidate() "+(256&t?"checked":"")+">Pouze prohlížení na dálku</label><br></div>")+("<div style=margin-left:8px><label><input type=checkbox id=d20flag4 onchange=p20edituserfeaturesValidate() "+(512&t?"checked":"")+">Žádný přístup k terminálu</label><br></div>"))+("<div style=margin-left:8px><label><input type=checkbox id=d20flag5 onchange=p20edituserfeaturesValidate() "+(1024&t?"checked":"")+">Žádný přístup k souborům</label><br></div>")+("<div><label><input type=checkbox id=d20flag6 onchange=p20edituserfeaturesValidate() "+(16&t?"checked":"")+">Žádná konzola agenta</label><br></div>"))+("<div><label><input type=checkbox id=d20flag8 onchange=p20edituserfeaturesValidate() "+(32768&t?"checked":"")+">Žádná odinstalace</label><br></div>")+("<div><label><input type=checkbox id=d20flag9 onchange=p20edituserfeaturesValidate() "+(131072&t?"checked":"")+">Žádné dálkové ovládání</label><br></div>"))+("<div><label><input type=checkbox id=d20flag10 onchange=p20edituserfeaturesValidate() "+(64&t?"checked":"")+">Žádné probuzení</label><br></div>")+("<div><label><input type=checkbox id=d20flag11 onchange=p20edituserfeaturesValidate() "+(262144&t?"checked":"")+">Bez resetu/vypnutí</label><br></div>")),p20edituserfeaturesValidate())}function p20edituserfeaturesValidate(){QE("d20flag2",!Q("d20flag7").checked),QE("d20flag3",!Q("d20flag7").checked&&!Q("d20flag2").checked),QE("d20flag4",!Q("d20flag7").checked),QE("d20flag5",!Q("d20flag7").checked)}function p20edituserfeaturesEx(){var e=1&(currentUser.flags||0),t=(1==serverinfo.usersSessionRecording&&Q("d20flag1").checked&&(e+=2),0);Q("d20flag7").checked?t+=8:(Q("d20flag2").checked?t+=65536:Q("d20flag3").checked&&(t+=256),Q("d20flag4").checked&&(t+=512),Q("d20flag5").checked&&(t+=1024)),Q("d20flag6").checked&&(t+=16),Q("d20flag8").checked&&(t+=32768),Q("d20flag9").checked&&(t+=131072),Q("d20flag10").checked&&(t+=64),Q("d20flag11").checked&&(t+=262144),meshserver.send({action:"edituser",id:currentUser._id,flags:e,removeRights:t})}function p30editPhoneValidate(e){var t=""==Q("d2phoneinput").value||isPhoneNumber(Q("d2phoneinput").value);QE("idx_dlgOkButton",t),1==e&&t&&dialogclose(1)}function p30editPhoneEx(){meshserver.send({action:"edituser",id:currentUser._id,phone:Q("d2phoneinput").value})}function p30showUserRealNameChangeDialog(e){var t;return xxdialogMode||(t="",t+=addHtmlValue("Skutečné jméno","<input id=dp30realname style=width:230px maxlength=256 />"),setDialogMode(2,format("Změnit skutečné jméno pro {0}",EscapeHtml(currentUser.name)),3,p30showUserRealNameChangeDialogEx,t),Q("dp30realname").focus(),Q("dp30realname").value=currentUser.realname||""),!1}function p30showUserRealNameChangeDialogEx(){meshserver.send({action:"edituser",id:currentUser._id,realname:Q("dp30realname").value})}function p30showUserEmailChangeDialog(e){var t;return xxdialogMode||(t="",t+=addHtmlValue("E-mail","<input id=dp30email style=width:230px maxlength=32 onchange=p30validateEmail() onkeyup=p30validateEmail() />"),serverinfo.emailcheck&&(t+=addHtmlValue("Stav","<select id=dp30verified style=width:230px onchange=p30validateEmail()><option value=0>Neověřeno</option><option value=1>Ověřeno</option></select>")),setDialogMode(2,format("Změnit e-mail pro {0}",EscapeHtml(currentUser.name)),3,p30showUserEmailChangeDialogEx,t),Q("dp30email").focus(),Q("dp30email").value=currentUser.email||"",serverinfo.emailcheck&&(Q("dp30verified").value=currentUser.emailVerified?1:0),p30validateEmail()),!1}function p30validateEmail(){var e=Q("dp30email").value,t=e.split("@"),t=0==e.length||2==t.length&&0<t[0].length&&1<t[1].split(".").length&&2<t[1].length&&e.length<1024&&(e!=userinfo.email||1==serverinfo.emailcheck&&Q("dp30verified").value!=(userinfo.emailVerified?1:0));QE("idx_dlgOkButton",t)}function p30showUserEmailChangeDialogEx(){var e={action:"edituser",id:currentUser._id,email:Q("dp30email").value};serverinfo.emailcheck&&(e.emailVerified=1==Q("dp30verified").value),meshserver.send(e)}function p30viewPreviousLogins(){xxdialogMode||(setDialogMode(2,"Předchozí přihlášení",1,null,"Načítání…","previousLogins:"+currentUser._id),meshserver.send({action:"previousLogins",userid:currentUser._id}))}function p30showUserChangePassDialog(e){if(!xxdialogMode){var t="",t=(t+=addHtmlValue("Heslo","<input id=p4pass1 type=password style=width:230px maxlength=256 onchange=p30showUserChangePassDialogValidate(1) onkeyup=p30showUserChangePassDialogValidate(1)></input>"))+addHtmlValue("Heslo","<input id=p4pass2 type=password style=width:230px maxlength=256 onchange=p30showUserChangePassDialogValidate(1) onkeyup=p30showUserChangePassDialogValidate(1)></input>");if(65536&features&&(t+=addHtmlValue("Nápověda k heslu","<input id=p4hint type=text style=width:230px maxlength=256></input>")),passRequirements){var n,o=[],i=0;for(n in passRequirements)"reset"!=n&&"hint"!=n&&(o.push(n+":"+passRequirements[n]),i++);0<i&&(t+="<div style=font-size:x-small;padding:6px>"+format("Požadavky: {0}.",o.join(", "))+"</div>")}t+="<div><label><input id=p4resetNextLogin type=checkbox />Vynutit reset hesla při dalším přihlášení.</label></div>",1==e&&(t+="<div><label><input id=p4twoFactorRemove type=checkbox />Odstranit celé 2-faktorové ověřování.</label></div>"),setDialogMode(2,format("Změnit heslo pro {0}",EscapeHtml(currentUser.name)),3,p30showUserChangePassDialogEx,t,e),p30showUserChangePassDialogValidate(),Q("p4pass1").focus(),-1==currentUser.passchange&&(Q("p4resetNextLogin").checked=!0)}}function p30showUserChangePassDialogValidate(){var e=!0;""==Q("p4pass1").value&&""==Q("p4pass2").value||(Q("p4pass1").value!=Q("p4pass2").value||passRequirements&&0==checkPasswordRequirements(Q("p4pass1").value,passRequirements))&&(e=!1),QE("idx_dlgOkButton",e)}function p30showUserChangePassDialogEx(e,t){var n=!1;1==t&&1==Q("p4twoFactorRemove").checked&&(n=!0),Q("p4pass1").value==Q("p4pass2").value&&(t={action:"changeuserpass",userid:currentUser._id,pass:Q("p4pass1").value,removeMultiFactor:n,resetNextLogin:Q("p4resetNextLogin").checked},65536&features&&(t.hint=Q("p4hint").value),meshserver.send(t))}function p30showDeleteUserDialog(){xxdialogMode||(setDialogMode(2,format("Smazat uživatele {0}",EscapeHtml(currentUser.name)),3,p30showDeleteUserDialogEx,format("Potvrdit odstranění uživatele {0}?",EscapeHtml(currentUser.name))+"<br /><br /><label><input id=p10check type=checkbox onchange=p10validateDeleteNodeDialog() />Potvrdit</label>"),p10validateDeleteNodeDialog())}function p30showDeleteUserDialogEx(){meshserver.send({action:"deleteuser",userid:currentUser._id,username:currentUser.name})}function drawUserPermissions(){var e=1,t="",n=0,o=!1;for(h in meshes)meshes[h]._id.split("/")[1]==currentUser._id.split("/")[1]&&(n++,null==currentUser.links||null==currentUser.links[h])&&(o=!0);if(0<n&&o&&(t+='<a href=# onclick="return p20showAddMeshUserDialog(1)" style=cursor:pointer;margin-right:10px><img src=images/icon-addnew.png border=0 height=12 width=12> Přidat skupinu zařízení</a>'),t+='<table style="color:black;background-color:#EEE;border-color:#AAA;border-width:1px;border-style:solid;border-collapse:collapse" border=0 cellpadding=2 cellspacing=0 width=100%><tbody><tr style=background-color:#AAAAAA;font-weight:bold><th scope=col style=text-align:left;width:430px>Společné skupiny zařízení</th><th scope=col style=text-align:left></th></tr>',currentUser.links){var i=[];for(h in currentUser.links)h.startsWith("mesh/")&&null!=meshes[h]&&i.push(meshes[h]);for(h in i=getOrderedList(i,"name")){var a,s=0,r=i[h],l="",d=makeDeviceGroupRightsString(v=currentUser.links[r._id].rights);null!=r&&(userinfo.links&&null!=userinfo.links[r._id]&&null!=userinfo.links[r._id].rights&&(s=userinfo.links[r._id].rights),a="<i>Neznámá skupina zařízení</i>",r&&(a="<a href=# onclick='gotoMesh(\""+r._id+"\");haltEvent(event);'>"+EscapeHtml(r.name)+"</a>"),currentUser._id!=userinfo._id&&0!=(2&s)&&(l="<a href=# onclick='return p30removeMeshFromUser(event,\""+encodeURIComponentEx(r._id)+'")\' title="Odebrat práva uživatele na tuto skupinu zařízení" style=cursor:pointer><img src=images/trash.png border=0 height=10 width=10></a>',d='<span style=cursor:pointer onclick=p20showAddMeshUserDialog(1,"'+encodeURIComponentEx(r._id)+'")>'+d+" <img class=hoverButton style=cursor:pointer src=images/link5.png></span>"),t+="<tr "+(++e%2==0?"style=background-color:#DDD":"")+'><td style=width:30%><div title="Skupina zařízení" class=m99></div><div>&nbsp;'+a+"<div></div></div></td><td style=width:70%><div style=float:right>"+l+"</div><div>"+d+"</div></td></tr>")}}if(1==e&&(t+="<tr><td><div style=padding:6px>&nbsp;<i>Žádné společné skupiny zařízení</i><div></div></div></td><td></td></tr>"),t+="</tbody></table>",null!=usergroups){if(e=1,t+="<br />",0!=(256&userinfo.siteadmin)){var u=0,c=!1;for(h in usergroups)null==usergroups[h].membershipType&&usergroups[h]._id.split("/")[1]==currentUser._id.split("/")[1]&&(u++,null==currentUser.links||null==currentUser.links[h])&&(c=!0);0<u&&c&&(t+='<a href=# onclick="return p30showAddUserGroupDialog()" style=cursor:pointer;margin-right:10px><img src=images/icon-addnew.png border=0 height=12 width=12> Přidat skupinu uživatelů</a>')}if(t+='<table style="color:black;background-color:#EEE;border-color:#AAA;border-width:1px;border-style:solid;border-collapse:collapse" border=0 cellpadding=2 cellspacing=0 width=100%><tbody><tr style=background-color:#AAAAAA;font-weight:bold><th scope=col style=text-align:left;width:430px>Členství ve skupinách uživatelů</th><th scope=col style=text-align:left></th></tr>',currentUser.links){var p=[];for(h in currentUser.links)h.startsWith("ugrp/")&&null!=usergroups[h]&&p.push(usergroups[h]);for(h in p=getOrderedList(p,"name")){var m=p[h],v=currentUser.links[p[h]._id].rights,l="",g="<i>Neznámá skupina uživatelů</i>";t+="<tr "+(++e%2==0?"style=background-color:#DDD":"")+'><td><div title="Skupina uživatelů" class=m4></div><div>&nbsp;'+(g=null!=m&&(g=EscapeHtml(m.name),null!=usergroups)?"<a href=# onclick='gotoUserGroup(\""+encodeURIComponentEx(p[h]._id)+"\");haltEvent(event);'>"+g+"</a>":g)+"<div></div></div></td><td><div style=float:right>"+(l=null==m.membershipType&&0!=(256&userinfo.siteadmin)?"<a href=# onclick='return p30RemoveUserGroup(event,\""+encodeURIComponentEx(p[h]._id)+'")\' title="Odebrat členství uživatele ve skupině" style=cursor:pointer><img src=images/trash.png border=0 height=10 width=10></a>':l)+"</div></td></tr>"}}1==e&&(t+="<tr><td><div style=padding:6px>&nbsp;<i>Žádné členství ve skupinách</i><div></div></div></td><td></td></tr>"),t+="</tbody></table>"}if(e=1,t+="<br />",currentUser._id.split("/")[1]==userinfo._id.split("/")[1]&&(t+='<a href=# onclick="return p20showAddMeshUserDialog(4)" style=cursor:pointer;margin-right:10px><img src=images/icon-addnew.png border=0 height=12 width=12> Přidat zařízení</a>'),t+='<table style="color:black;background-color:#EEE;border-color:#AAA;border-width:1px;border-style:solid;border-collapse:collapse" border=0 cellpadding=2 cellspacing=0 width=100%><tbody><tr style=background-color:#AAAAAA;font-weight:bold><th scope=col style=text-align:left;width:430px>Společná zařízení</th><th scope=col style=text-align:left></th></tr>',currentUser.links){var h,f=[];for(h in currentUser.links)h.startsWith("node/")&&null!=(k=getNodeFromId(h))&&f.push(k);for(h in f.sort(nameSort),f){var k=f[h],v=currentUser.links[k._id].rights,l="",s=GetNodeRights(k),y=(userinfo.links&&null!=userinfo.links[h]&&null!=userinfo.links[h].rights&&(s=userinfo.links[h].rights),k?EscapeHtml(k.name):"<i>Neznámé zařízení</i>");0!=(2&s)&&(l="<a href=# onclick='return p30removeNodeFromUser(event,\""+encodeURIComponentEx(k._id)+'")\' title="Odebrat práva uživatele na tuto skupinu zařízení" style=cursor:pointer><img src=images/trash.png border=0 height=10 width=10></a>',d='<span style=cursor:pointer onclick=p20showAddMeshUserDialog(4,"'+encodeURIComponentEx(k._id)+'")>'+makeUserDeviceRightsString(v)+" <img class=hoverButton style=cursor:pointer src=images/link5.png></span>"),y="<a href=# onclick='gotoDevice(\""+k._id+"\",10);haltEvent(event);'>"+y+"</a>",t+="<tr "+(++e%2==0?"style=background-color:#DDD":"")+'><td style=width:30%><div title="Zařízení" class=si'+k.icon+"></div><div>&nbsp;"+y+"<div></div></div></td><td style=width:70%><div style=float:right>"+l+"</div><div>"+d+"</div></td></tr>"}}1==e&&(t+="<tr><td><div style=padding:6px>&nbsp;<i>Žádná společná zařízení</i><div></div></div></td><td></td></tr>"),t+="</tbody></table>",QH("p30html2",t)}function p30removeDeviceSharing(e,t,n,o){xxdialogMode||setDialogMode(2,"Odebrat sdílení zařízení",3,function(e,t){meshserver.send({action:"removeDeviceShare",nodeid:t[0],publicid:t[1]})},format("Potvrdit odebrání sdílení zařízení „{0}“?",decodeURIComponent(o)),[decodeURIComponent(t),decodeURIComponent(n)])}function p30removeNodeFromUser(e,t){xxdialogMode||setDialogMode(2,"Odebrat oprávnění zařízení",3,function(e,t){meshserver.send({action:"adddeviceuser",nodeid:t._id,nodename:t.name,userids:[currentUser._id],rights:0,remove:!0})},format("Potvrdit odebrání přístupových práv pro zařízení „{0}“?",(t=getNodeFromId(decodeURIComponent(t))).name),t)}function p30removeUserFromNode(e,n){var t,o;xxdialogMode||(t=null,o="",(n=decodeURIComponent(n)).startsWith("user/")?setDialogMode(2,"Odebrat uživatelská oprávnění",3,function(e,t){meshserver.send({action:"adddeviceuser",nodeid:currentNode._id,nodename:currentNode.name,userids:[n],rights:0,remove:!0})},(o=users&&null!=(t=users[n])?t.name:o)?format("Potvrdit odebrání přístupových práv pro uživatele „{0}“?",o):"Potvrdit odebrání přístupových práv?",t):n.startsWith("ugrp/")&&setDialogMode(2,"Odebrat oprávnění skupiny uživatelů",3,function(e,t){meshserver.send({action:"adddeviceuser",nodeid:currentNode._id,nodename:currentNode.name,userids:[n],rights:0,remove:!0})},(o=usergroups&&null!=(t=usergroups[n])?t.name:o)?format("Potvrdit odebrání přístupových práv pro skupinu uživatelů „{0}“?",o):"Potvrdit odebrání přístupových práv?",t))}function p30RemoveUserGroup(e,t){var n;xxdialogMode||null==usergroups||(t=decodeURIComponent(t),setDialogMode(2,"Odebrat členství ve skupině uživatelů",3,p30RemoveUserGroupEx,format("Potvrdit odebrání členství ve skupině uživatelů „{0}“?",null!=(n=usergroups[t])?EscapeHtml(n.name):"<i>Neznámé</i>"),t))}function p30RemoveUserGroupEx(e,t){meshserver.send({action:"removeuserfromusergroup",ugrpid:t,userid:currentUser._id})}function p30showAddUserGroupDialog(){if(!xxdialogMode&&null!=usergroups){var e,t="";for(e in usergroups)null!=usergroups[e].membershipType||usergroups[e]._id.split("/")[1]!=currentUser._id.split("/")[1]||null!=currentUser.links&&null!=currentUser.links[e]||(t+="<option value="+encodeURIComponentEx(e)+">"+EscapeHtml(usergroups[e].name)+"</option>");return setDialogMode(2,"Přidat členství",3,p30showAddUserGroupDialogEx,addHtmlValue("Skupina uživatelů","<div style=width:230px;margin:0;padding:0><select id=dp2groupid style=width:100%>"+t+"</select></div>")),Q("dp2groupid").focus(),!1}}function p30showAddUserGroupDialogEx(){meshserver.send({action:"addusertousergroup",ugrpid:decodeURIComponent(Q("dp2groupid").value),usernames:[currentUser._id.split("/")[2]]})}function p30removeMeshFromUser(e,t){xxdialogMode||null!=(t=meshes[decodeURIComponent(t)])&&setDialogMode(2,"Odebrat oprávnění skupiny zařízení",3,p30removeMeshFromUserEx,format("Potvrdit odebrání přístupových práv pro skupinu zařízení „{0}“?",t.name),t._id)}function p30removeMeshFromUserEx(e,t){meshserver.send({action:"removemeshuser",meshid:t,userid:currentUser._id})}var currentUserEvents=null;function userEventsUpdate(){if(null!=currentUser){var e="",t=null;for(r in currentUserEvents){var n=currentUserEvents[r],o=new Date(n.time);if(n.msg){null==n.h&&(n.h=Math.random()),printDate(o)!=t&&(null!=t&&(e+="</table>"),e+="<table class=p3eventsTable cellpadding=0 cellspacing=0><tr><td colspan=4 class=DevSt>"+(t=printDate(o))+"</td></tr>");var i,a,s="si3";if("user"==n.etype&&(s="m2"),"server"==n.etype&&(s="si3"),null==n.msgid||null==eventsMessageId[n.msgid])i="string"==typeof n.msg?EscapeHtml(n.msg).split("(R)").join("&reg;"):"";else{for(var r in i=eventsMessageId[n.msgid],n.msgArgs){var l=n.msgArgs[r];"string"==typeof l&&0==l.indexOf("DATETIME:")&&(l=printFlexDateTime(new Date(parseInt(l.substring(9))))),i=i.split("{"+r+"}").join(l)}i=EscapeHtml(i).split("(R)").join("&reg;")}n.nodeid&&null!=(a=getNodeFromId(n.nodeid))&&(s="si"+a.icon,i="<a href=# onclick='gotoDevice(\""+n.nodeid+"\",10);haltEvent(event);'>"+EscapeHtml(a.name)+"</a> &rarr; "+i),n.username&&n.username!=currentUser.name?(a="",n.guestname&&(a=' / <span title="Toto je relace sdílení hostů">'+EscapeHtml(n.guestname)+"</span>"),i=2&userinfo.siteadmin&&n.userid?"<a href=# onclick='gotoUser(\""+encodeURIComponentEx(n.userid)+"\");haltEvent(event);'>"+EscapeHtml(n.username)+"</a>"+a+" &rarr; "+i:EscapeHtml(n.guestname)+" &rarr; "+i):n.guestname&&(i='<span title="Toto je relace sdílení hostů">'+EscapeHtml(n.guestname)+"</span> &rarr; "+i),"relay"!=n.etype&&"relaylog"!=n.action||(s="relayIcon16"),e+="<tr onclick=showEventDetails("+n.h+",3)  onmouseover=eventMouseHover(this,1) onmouseout=eventMouseHover(this,0) style=cursor:pointer><td style=width:18px><div class="+s+"></div></td><td class=g1>&nbsp;</td><td class=style10>"+printTime(o)+" - "+i+"</td><td class=g2>&nbsp;</td></tr><tr style=height:2px></tr>"}}null!=t&&(e+="</table>"),""==e&&(e="<br><i>Nenalezeny žádné události</i><br><br>"),QH("p31events",e)}}function refreshUsersEvents(){""!=p31filterevents.value?meshserver.send({action:"events",limit:parseInt(p31limitdropdown.value),userid:currentUser._id,filter:p31filterevents.value}):meshserver.send({action:"events",limit:parseInt(p31limitdropdown.value),userid:currentUser._id})}var d3filetreelinkpath,p52recordings=null;function updateRecordings(){for(var e=[],t=document.getElementsByClassName("RecordingCheckbox"),n="",o=0;o<t.length;o++)t[o].checked&&e.push(t[o].value);if(null==p52recordings)n+="<div style=width:100%;text-align:center;margin-top:20px><i>Načítání…</i></div>";else if("number"==typeof p52recordings)n+=1==p52recordings?"<div style=width:100%;text-align:center;margin-top:20px><i>Server is unable to read from the recordings folder.</i></div>":2==p52recordings?"<div style=width:100%;text-align:center;margin-top:20px><i>Server is unable to get recordings from the database.</i></div>":"<div style=width:100%;text-align:center;margin-top:20px><i>An unknown error occured.</i></div>";else if(0==p52recordings.length)n+="<div style=width:100%;text-align:center;margin-top:20px><i>Žádné nahrávky.</i></div>";else{if(n=(n+="<table class=p3usersTable cellpadding=0 cellspacing=0>")+("<th>Zasedání<th style=width:110px>"+nobreak("Doba spuštění")+"<th style=width:110px>Délka trvání<th style=width:110px>Velikost"),null!=p52recordings){var i=null;for(o in p52recordings){var a=p52recordings[o],s=printDate(new Date(a.time));s!=i&&(n+="<tr><td class=userTableHeader colspan=4>"+(i=s)),n+=addRecordingHtml(o,a)}}n+="</table>"}QH("p52recordings",n);for(t=document.getElementsByClassName("RecordingCheckbox"),o=0;o<t.length;o++)t[o].checked=0<=e.indexOf(t[o].value);p52updateInfo()}function addRecordingHtml(e,t){var n="",o=(t.lengthTime&&(n=pad2(Math.floor(t.lengthTime/3600))+":"+pad2(Math.floor(t.lengthTime%3600/60))+":"+pad2(Math.floor(t.lengthTime%60))),printTime(new Date(t.time))),i=(t.sessionStart&&(o=printTime(new Date(t.sessionStart))),""),a=(t.size&&(i=format("{0} Kb",Math.round(t.size/1024))),"<i>Neznámé</i>"),s=(t.name&&t.meshname&&(a=null!=meshes[t.meshid]?"<a href=# onclick='gotoMesh(\""+t.meshid+"\")'>"+EscapeHtml(t.meshname)+"</a> - <a href=# onclick='gotoDevice(\""+t.nodeid+"\",10)'>"+EscapeHtml(t.name)+"</a>":EscapeHtml(t.meshname)+" - "+EscapeHtml(t.name)),null!=t.userids&&0<t.userids.length&&(1<t.userids.length?a+=" - "+format("{0} users",t.userids.length):a+=(s=null)!=(s=null!=users?users[t.userids[0]]:s)?" - <a href=# onclick='gotoUser(\""+encodeURIComponentEx(t.userids[0])+"\")'>"+EscapeHtml(s.name)+"</a>":" - "+EscapeHtml(t.userids[0].split("/")[2])),1==t.protocol&&(a+=" - Koncová relace"),2==t.protocol&&(a+=" - Relace na ploše"),5==t.protocol&&(a+=" - Přenos souboru"),100==t.protocol&&(a+=" - Intel&reg; AMT WSMAN"),101==t.protocol&&(a+=" - Intel&reg; AMT přesměrování"),200==t.protocol&&(a+=" - Posel"),""),r="m0",t=(1==t.present&&(r="m1",s='<div style=cursor:pointer;float:right><a onclick=downloadFile("recordings.ashx?file='+encodeURIComponentEx(t.filename)+'")><img src=images/link4.png height=10 width=10 title="Download Recording"></a>&nbsp;</div>',s+='<div style=cursor:pointer;float:right><a href="player.htm?stream='+encodeURIComponentEx(t.filename)+'") rel="noreferrer noopener" target="mcplay-'+encodeURIComponentEx(t.filename)+'"><img src=images/link7.png height=10 width=10 title="Play Recording"></a>&nbsp;</div>'),"<tr tabindex=0 onmouseover=userMouseHover2(this,1) onmouseout=userMouseHover2(this,0) onkeypress=\"if (event.key=='Enter') showRecordingDialog(event,'"+e+"')\"><td style=cursor:pointer>");return(t+="<div class=bar style=width:100%>")+"<div></div>"+('<div class=baricon onclick=showRecordingDialog(event,"'+e+'")><div class='+r+"></div></div>")+('<div class=g1 onclick=showRecordingDialog(event,"'+e+'")></div><div class=g2 onclick=showRecordingDialog("'+e+'")></div>')+('<div style=line-height:24px onclick=showRecordingDialog(event,"'+e+'")>'+s+"<div style=font-size:16px>"+a+"</div></div></div><td style=text-align:center>"+o+"<td style=text-align:center>"+n+"<td style=text-align:center>"+i)}function showRecordingDialog(e,t){if(!xxdialogMode&&"IMG"!=e.target.tagName&&"A"!=e.target.tagName){var n=p52recordings[t],o="";if(n.protocol&&(e="Neznámé",1==n.protocol&&(e="Terminál"),2==n.protocol&&(e="Plocha"),5==n.protocol&&(e="Soubory"),100==n.protocol&&(e="Intel&reg; AMT WSMAN"),o+=addHtmlValue4("Protokol",e=101==n.protocol?"Intel&reg; AMT přesměrování":e)),o+=addHtmlValue4("Stav",1==n.present?"Přítomen na serveru":"Ne na serveru"),n.name&&(o+=addHtmlValue4("Název zařízení",EscapeHtml(n.name))),n.meshname&&(o+=addHtmlValue4("Skupina zařízení",EscapeHtml(n.meshname))),n.size&&(o+=addHtmlValue4("Velikost",format("{0} bajtů",n.size))),n.startTime&&(o+=addHtmlValue4("Doba spuštění",printTime(new Date(n.startTime)))),n.time&&(o+=addHtmlValue4("Čas ukončení",printTime(new Date(n.time)))),n.lengthTime&&(o+=addHtmlValue4("Délka trvání",pad2(Math.floor(n.lengthTime/3600))+":"+pad2(Math.floor(n.lengthTime%3600/60))+":"+pad2(Math.floor(n.lengthTime%60)))),1==n.multiplex&&(o+=addHtmlValue4("Multiplexor","Povoleno")),n.userids)for(var t in n.userids)o+=addHtmlValue4("Uživatel",n.userids[t].split("/")[2]);setDialogMode(2,"Podrobnosti záznamu",9,null,o)}}function refreshRecodings(){meshserver.send({action:"recordings",limit:1e3})}function openRecodringPlayer(){xxdialogMode||safeNewWindow(window.location.origin+"{{{domainurl}}}player.htm","meshcentral-deskplayer")}function p52updateInfo(){for(var e=document.getElementsByClassName("RecordingCheckbox"),t=0;t<e.length;t++)!0===e[t].checked&&0}function d3init(){d3fileoptions={dialog:1,filter:"d3filter",files:"d3serverfiles",folderup:"p3FolderUp",currentFolder:"p3CurrentFolder",func:d3setActions},Q("d3localFile").value="",Q("d3localFile").accept=Q("d3filter").value,d3modechange()}function d3modechange(){var e=Q("d3uploadMode").value;QV("d3localmode",1==e),QV("d3servermode",2==e),(1==e?d3setActions:d3updatefiles)()}var d3filetreelocation=[],d3fileoptions=null;function d3updatefiles(){if(null!=d3fileoptions&&("d3filter"!=d3fileoptions.filter||1!=Q("d3uploadMode").value)){for(var e,t="",n="",o=filetree,i=1,a="",s=[],r=[],l=document.getElementsByName("fc"),d=0;d<l.length;d++)l[d].checked&&r.push(l[d].value);for(d in d3filetreelinkpath="",d3filetreelocation){if(null==o.f||null==o.f[d3filetreelocation[d]])break;s.push(d3filetreelocation[d]),1==i?(e=d3filetreelocation[d].split("/"),window.location.origin,e[0],d3filetreelocation[d]===userinfo._id?d3filetreelinkpath+="self":d3filetreelinkpath+=e[0]+"/"+e[2]):""!=d3filetreelinkpath&&(d3filetreelinkpath+="/"+d3filetreelocation[d],2<i)&&d3filetreelocation[d],a=(o=o.f[d3filetreelocation[d]]).n,i++}d3filetreelocation=s;var u=p5sort_files(o.f),c="";for(d in d3fileoptions.filter&&(c=Q(d3fileoptions.filter).value),u){var p,m,v=u[d],g=v.n;3==v.t&&""!=c&&0==v.nx.toLowerCase().endsWith(c)||(g=70<g.length?'<span title="'+EscapeHtml(g)+'">'+EscapeHtml(g.substring(0,70))+"…</span>":EscapeHtml(g),p="",null!=v.s&&(p=getFileSizeStr(v.s)),m="",m=3!=v.t?'<div class=filelist file=999><span style=float:right title=""></span><span><div class=fileIcon'+v.t+' onclick=d3folderset("'+encodeURIComponentEx(v.nx)+'")></div>&nbsp;<a href=# style=cursor:pointer onclick=\'return d3folderset("'+encodeURIComponentEx(v.nx)+"\")'>"+g+"</a></span></div>":(g=g,'<div class=filelist file=3><input style=float:left name=fcx class=fcb type=checkbox onchange=d3setActions() value="'+v.nx+'">&nbsp;<span style=float:right>'+EscapeHtml(p)+"</span><span><div class=fileIcon"+v.t+"></div>"+g+"</span></div>"),v.t<3?t+=m:n+=m)}d3fileoptions.currentFolder&&QH(d3fileoptions.currentFolder,a),QH(d3fileoptions.files,t+n),QE(d3fileoptions.folderup,0<d3filetreelocation.length),d3fileoptions.func&&d3fileoptions.func()}}function d3folderset(e){return d3filetreelocation.push(decodeURIComponent(e)),d3updatefiles(),!1}function d3folderup(e){if(null==e)d3filetreelocation.pop();else for(;d3filetreelocation.length>e;)d3filetreelocation.pop();d3updatefiles()}function d3getFileSel(){for(var e=[],t=document.getElementsByName("fcx"),n=0;n<t.length;n++)t[n].checked&&e.push(t[n].value);return e}function d3setActions(){1==d3fileoptions.dialog?1==Q("d3uploadMode").value?QE("idx_dlgOkButton",0<Q("d3localFile").value.length):QE("idx_dlgOkButton",1==d3getFileSel().length):2==d3fileoptions.dialog&&QE("idx_dlgOkButton",1==d3getFileSel().length)}var reportCSV=null;function generateReportDialog(){if(!xxdialogMode){var e="",t="",n=JSON.parse(getstore("_ReportSettings","{}")),o={1:"Vzdálené relace",2:"Využití uživatelského provozu",3:"Přihlášení uživatele"};for(i in 4294967295==userinfo.siteadmin&&(o[4]="Database Records"),o)e+="<option value="+i+(n.type==i?" selected":"")+">"+o[i]+"</option>";t=t+addHtmlValue("Typ","<select id=d2reportType style=float:right;width:250px onchange=generateReportDialogValidate()>"+e+"</select>")+"<div id=d2GroupByDiv style=display:none>",e="";for(i in o={1:"Uživatel",2:"Zařízení",3:"Den"})e+="<option value="+i+(n.groupBy==i?" selected":"")+">"+o[i]+"</option>";for(i in t=(t+=addHtmlValue("Skupina vytvořená","<select id=d2groupBy style=float:right;width:250px onchange=generateReportDialogValidate()>"+e+"</select>"))+"</div>"+"<div id=d2GroupByDiv2 style=display:none>",e="",o={1:"Uživatel",3:"Den"})e+="<option value="+i+(n.groupBy2==i?" selected":"")+">"+o[i]+"</option>";t=(t+=addHtmlValue("Skupina vytvořená","<select id=d2groupBy2 style=float:right;width:250px onchange=generateReportDialogValidate()>"+e+"</select>"))+"</div>"+"<div id=d2DeviceGroupDiv style=display:none>",e="<option value=0"+(0==n.devGroup?" selected":"")+">Vše</option>";var i,a=getOrderedList(meshes,"name");for(i in a)e+="<option value="+encodeURIComponentEx(a[i]._id)+(n.devGroup==a[i]._id?" selected":"")+">"+EscapeHtml(a[i].name)+"</option>";for(i in t=(t+=addHtmlValue("Skupina zařízení","<select onchange=generateReportDialogValidate() id=d2groupId style=float:right;width:250px>"+e+"</select>"))+"</div>"+"<div id=d2timeBackDiv style=display:none>",e="",null==n.timeRange&&(n.timeRange=1),o={1:"Poslední den",7:"Posledních 7 dní",30:"Předchozích 30 dnů",0:"Časový rozsah"})e+="<option value="+i+(n.timeRange==i?" selected":"")+">"+o[i]+"</option>";setDialogMode(2,"Vygenerovat zprávu",3,generateReportDialogEx,t=(t=(t=(t=(t+=addHtmlValue("Čas","<select id=d2timeRange style=float:right;width:250px onchange=generateReportDialogValidate()>"+e+"</select>"))+"</div>"+"<div id=d2timeRangeDiv style=display:none>")+addHtmlValue("Časový rozsah",'<input id=d2timeRangeSelector style=float:right;width:250px class=flatpickr type="text" placeholder="Vyberte datum a čas..." data-id="altinput">'))+"</div>"+"<div id=d2showTrafficDiv style=display:none>")+addHtmlValue("","<div style=width:250px><label><input type=checkbox id=d2showTraffic "+(n.showTraffic?"checked":"")+">Zobrazit provoz</label><div>")+"</div>"),generateReportDialogValidate();t=new Date,t=(t.setDate(t.getDate()-7),flatpickr("#d2timeRangeSelector",{mode:"range",enableTime:!0,maxDate:new Date,defaultDate:[t,new Date],minuteIncrement:1}));xxdialogTag=t}}function generateReportDialogValidate(){QV("d2timeRangeDiv",0==Q("d2timeRange").value),QV("d2timeBackDiv",4!=Q("d2reportType").value),QV("d2GroupByDiv",1==Q("d2reportType").value),QV("d2GroupByDiv2",3==Q("d2reportType").value),QV("d2DeviceGroupDiv",1==Q("d2reportType").value),QV("d2showTrafficDiv",1==Q("d2reportType").value)}function generateReportDialogEx(e,t){var n,o=0==Q("d2timeRange").value?(n=Math.floor(t.selectedDates[1].getTime()/1e3),Math.floor(t.selectedDates[0].getTime()/1e3)):(n=Math.floor(new Date/1e3),o=new Date,Math.floor(o.setDate(o.getDate()-Q("d2timeRange").value)/1e3)),t=null;try{t=Intl.DateTimeFormat().resolvedOptions().timeZone}catch(e){}var i=decodeURIComponent(Q("d2groupId").value),a=(0==i&&(i=null),putstore("_ReportSettings",JSON.stringify({type:parseInt(Q("d2reportType").value),groupBy:parseInt(Q("d2groupBy").value),groupBy2:parseInt(Q("d2groupBy2").value),timeRange:parseInt(Q("d2timeRange").value),devGroup:i,showTraffic:Q("d2showTraffic").checked})),parseInt(Q("d2groupBy").value));3==Q("d2reportType").value&&(a=parseInt(Q("d2groupBy2").value)),meshserver.send({action:"report",type:parseInt(Q("d2reportType").value),groupBy:a,start:o,end:n,tz:t,tf:(new Date).getTimezoneOffset(),l:getLang(),devGroup:i,showTraffic:Q("d2showTraffic").checked})}function renderReport(e){var t={time:"Čas",device:"Zařízení",session:"Zasedání",user:"Uživatel",devgroup:"Skupina zařízení",guest:"Host",length:"Délka",bytesin:"Bytes In",bytesout:"Bytes Out",os:"Operační systém",ip:"IP adresa",browser:"Prohlížeč",msg:"Zpráva",twofactor:"2. faktor"},n="<table style=width:100%>",o=null,i=[];if(0==Object.keys(e.groups).length)reportCSV=null,QV("p60downloadReportDiv",!1),n+="<tr><td style=text-align:center;padding-top:32px>Zpráva nevrátila žádné celistvosti.</tr></td>";else{for(var a in reportCSV='"Skupina"',n+="<tr>",e.columns){var s=null!=t[e.columns[a].title]?t[e.columns[a].title]:EscapeHtml(e.columns[a].title),r="";e.columns[a].align?r+=";text-align:"+EscapeHtml(e.columns[a].align):r+=";text-align:left",0!=a||"datetime"!=e.columns[a].format&&"time"!=e.columns[a].format||(r+=";width:1%"),n+="<th style="+r+">"+s+"</th>",reportCSV+=',"'+csvClean(s)+'"'}for(var a in n+="</tr>",reportCSV+="\r\n",e.groups)for(var l in n=(n+="<tr style=height:8px></tr>")+("<tr><td colspan="+e.columns.length+' style="border-bottom:1pt solid black"><b>'),0!=a&&(n+=renderReportFormat(a,e.groupFormat)),n+="</b></td></tr>",e.groups[a].entries){var d,u=e.groups[a].entries[l];for(d in n+="<tr>",reportCSV+=0!=a?'"'+csvClean(renderReportFormatCSV(a,e.groupFormat))+'"':'""',e.columns){var c,p,r="";null!=e.columns[d].format&&(r="white-space:nowrap;"),e.columns[d].align&&(r="text-align:"+EscapeHtml(e.columns[d].align)),null!=u[e.columns[d].id]?(n+='<td style="'+r+'">'+renderReportFormat(u[e.columns[d].id],e.columns[d].format)+"</td>",reportCSV+=',"'+csvClean(renderReportFormatCSV(u[e.columns[d].id],e.columns[d].format))+'"'):(n+="<td></td>",reportCSV+=","),null!=e.columns[d].sumBy&&(c=u[e.columns[d].sumBy],!0===e.columns[d].sumBy&&(c=!0),p=u[e.columns[d].id],o=e.columns[d].sumBy,null!=p)&&(-1==i.indexOf(c)&&i.push(c),null==e.columns[d].subtotals&&(e.columns[d].subtotals={},e.columns[d].totals={}),null==e.columns[d].subtotals[c]?e.columns[d].subtotals[c]=p:e.columns[d].subtotals[c]+=p,null==e.columns[d].totals[c]?e.columns[d].totals[c]=p:e.columns[d].totals[c]+=p)}n+="</tr>",reportCSV+="\r\n"}if(null!=o){var m=-1;if(!0===o)m=99999;else for(var a in e.columns)e.columns[a].id==o&&(m=a);if(0<=m){i.sort();var v=!0;for(l in n+="<tr style=height:8px></tr>",i){for(var a in n+="<tr>",e.columns)a==m?(r="",e.columns[d].align&&(r+=";text-align:"+EscapeHtml(e.columns[d].align)),v&&(r+=";border-top:1pt solid #777"),n+='<td style="color:#777'+r+'">'+renderReportFormat(i[l],e.columns[a].format)):null!=e.columns[a].totals?(r="",e.columns[d].align&&(r+=";text-align:"+EscapeHtml(e.columns[d].align)),v&&(r+=";border-top:1pt solid #777"),n+='<td style="color:#777'+r+'">'+renderReportFormat(e.columns[a].totals[i[l]],e.columns[a].format)):n+="<td></td>";n+="</tr>",v=!1}}}QV("p60downloadReportDiv",!0)}n+="</table>",QH("p60report",n)}function renderReportFormat(e,t){if(null==e)return"";if("datetime"==t)return printDateTime(new Date(e));if("time"==t)return printTime(new Date(e));if("protocol"==t)return 1==e?"Terminál":2==e?"Plocha":5==e?"Soubory":100==e?"AMT-WSMAN":101==e?"AMT-Redir":200==e?"Posel":201==e?"Web-RDP":202==e?"Web-SSH":203==e?"Web-SFTP":204==e?"Web-VNC":"Neznámé ("+e+")";if("seconds"==t)return s=e%60,a=60&Math.floor(e/60),i=Math.floor(e/3600),zeroPad(i,2)+":"+zeroPad(a,2)+":"+zeroPad(s,2);if("node"==t)return null!=(o=getNodeFromId(e))?"<div onclick='gotoDevice(\""+o._id+'",10);haltEvent(event);\' style=float:left;margin-right:4px class="j'+o.icon+'"></div>'+EscapeHtml(o.name):"<i>Neznámé</i>";if("mesh"==t)return null!=(n=meshes[e])?"<div onclick='gotoMesh(\""+n._id+'",10);haltEvent(event);\' style=float:left;margin-right:4px;cursor:pointer class="m99"></div>'+EscapeHtml(n.name):"<i>Neznámé</i>";if("nodemesh"==t){var n,o,i=null,a=null,s=e.split("/"),r="<table><tr>";if(3<=s.length&&(i=s[0]+"/"+s[1]+"/"+s[2]),null!=(a=6<=s.length?s[3]+"/"+s[4]+"/"+s[5]:a)){if(null==(n=meshes[a]))return"<i>Neznámé</i>";r+="<td><div onclick='gotoMesh(\""+n._id+'",10);haltEvent(event);\' style=float:left;margin-right:4px;cursor:pointer class="m99"></div>'+EscapeHtml(n.name)+"&nbsp;&nbsp;&nbsp;</td>"}return null==(o=getNodeFromId(i))?"<i>Neznámé</i>":r=r+("<td><div onclick='gotoDevice(\""+o._id+'",10);haltEvent(event);\' style=float:left;margin-right:4px class="j'+o.icon+'"></div>'+EscapeHtml(o.name)+"</td>")+"</tr></table>"}if("user"==t)return s=null,e==userinfo._id?s=userinfo:null!=users&&(s=users[e]),null!=s?(a=s.name,null!=s.realname&&(a+=", "+s.realname),"<div onclick='gotoUser(\""+s._id+'",10);haltEvent(event);\' style=float:left;margin-right:4px;cursor:pointer class="m2"></div>'+EscapeHtml(a)):"<i>Neznámý uživatel</i>";if("msg"==t){if(107==e)return'<div style=float:left;margin-right:4px;cursor:pointer class="NotifyIconTiny1"></div>Úspěšné přihlášení';if(108==e)return'<div style=float:left;margin-right:4px;cursor:pointer class="NotifyIconTiny2"></div>Nesprávný 2. faktor';if(109==e)return'<div style=float:left;margin-right:4px;cursor:pointer class="NotifyIconTiny4"></div>Uzamknutý účet';if(110==e)return'<div style=float:left;margin-right:4px;cursor:pointer class="NotifyIconTiny3"></div>Neplatný pokus o přihlášení'}if("2fa"==t){if(""==e)return"Nic";if("backup"==e)return"Záložní kódy";if("fido"==e)return"FIDO klíč";if("sms"==e)return"SMS zpráva";if("hwotp"==e)return"OTP hardwaru";if("messenger"==e)return"Messenging";if("push"==e)return"Oznámení";if("otp"==e)return"Jednorázové heslo";if("cookie"==e)return"Pamatujte na zařízení";if("tokenlogin"==e)return"Přihlašovací token";if("ipaddr"==e)return"IP adresa";if("sso"==e)return"Jednotné přihlášení"}return"records"==t?null!=(n={node:"Device record",mesh:"Device group record",user:"User records",sysinfo:"Device information records",iploc:"IP location information records",note:"Text notes records",ifinfo:"Network interface information records",cfile:"Configuration file records",lastconnect:"Last connection time records",power:"Device power transition records",events:"Event records",serverstats:"Server statistics records",ugrp:"User group records",deviceshare:"Device sharing records",logintoken:"Account login token records",smbios:"Device SMBIOS record",pmt:"Device Push Notification Record",meshcentral:"Device, users, groups and other records"})[e]?n[e]:e:EscapeHtml(e)}function renderReportFormatCSV(e,t){if("datetime"==t)return printDateTime(new Date(e));if("time"==t)return printTime(new Date(e));if("protocol"==t)return 1==e?"Terminál":2==e?"Plocha":5==e?"Soubory":"Neznámé";if("node"==t){var n=getNodeFromId(e);if(null!=n)return n.name}if("mesh"==t){n=meshes[e];if(null!=n)return n.name}var o;if("user"==t)return n=null,e==userinfo._id?n=userinfo:null!=users&&(n=users[e]),null!=n?(o=n.name,null!=n.realname&&(o+=" - "+n.realname),o):"Neznámý uživatel";if("msg"==t){if(107==e)return"Úspěšné přihlášení";if(108==e)return"Nesprávný 2. faktor";if(109==e)return"Uzamknutý účet";if(110==e)return"Neplatný pokus o přihlášení"}return"records"==t?renderReportFormat(e,t):""+e}function p60downloadReport(){xxdialogMode||null==reportCSV||saveAs(stringToUtf8Blob(reportCSV),"Report.csv")}var notifications=[];function clickNotificationIcon(e){1==e?QV("notifiyBox",!0):0==e?QV("notifiyBox",!1):QV("notifiyBox","none"==QS("notifiyBox").display),drawNotifications()}function setNotificationCount(e){parseInt(Q("notificationCount").innerHTML)!=e&&(QH("notificationCount",e),QS("notificationCount")["background-color"]=0==e?"lightblue":"orange",QV("notificationCount",0<e))}function drawNotifications(){var e=getstore("notifications",0),t="";if(0==notifications.length)t="<div style=margin:5px>V tuto chvíli zde nejsou žádná upozornění</div>";else for(var n in notifications){var o,n=notifications[n],i="",a=new Date(n.time),s=0;null!=n.title&&(i="<b>"+EscapeHtml(n.title)+"</b>: "),null!=n.nodeid&&null!=(o=getNodeFromId(n.nodeid))&&(s=o.icon,i=16&e?"<b>"+EscapeHtml(meshes[o.meshid].name)+" / "+EscapeHtml(o.name)+"</b>: ":"<b>"+EscapeHtml(o.name)+"</b>: "),t+='<div title="'+format("Nastalo na {0}",printDateTime(a))+'" id="notifyx'+n.id+'" class=notification style="cursor:pointer;border-top:1px solid '+(""==t?"transparent":"orange")+'">',s&&(t+="<div class=j"+s+' onclick="notificationSelected('+n.id+')" style=margin:5px;float:left></div>'),t+='<div onclick="notificationDelete('+n.id+')" class=unselectable title="Zrušte toto oznámení" style=margin:5px;float:right;color:orange><b>X</b></div><div onclick="notificationSelected('+n.id+')" style=margin:5px>'+i+EscapeHtml(n.text)+"</div><div style=margin-left:5px;margin-bottom:5px;color:gray;font-size:10px>"+printDateTime(a)+"</div></div>"}var r="";1<notifications.length&&(r='<div id="notifyRemoveAll" onclick="deleteAllNotifications()" style="cursor:pointer;border-top:1px solid orange;margin:5px;color:orange;text-align:right;padding-right:3px">Vymazat vše</div>'),QH("notifiyBox",'<div class=customScroll style="max-height:170px;overflow-y:auto;margin:5px">'+t+r+"</div>")}function notificationSelected(e,t){var n,o=-1;for(n in notifications)notifications[n].id==e&&(o=n);-1!=o&&(notificationSelectedEx(notifications[o],e),t)&&notifications[o]&&(notifications[o].notification&&(notifications[o].notification.close(),delete notifications[o].notification),notificationDelete(e))}function notificationSelectedEx(e,t){null!=e.nodeid?"desktop"==e.tag?gotoDevice(e.nodeid,12):"terminal"==e.tag?gotoDevice(e.nodeid,11):"files"==e.tag?gotoDevice(e.nodeid,13):"intelamt"==e.tag?gotoDevice(e.nodeid,14):"console"==e.tag?gotoDevice(e.nodeid,15):gotoDevice(e.nodeid,10):"backupcodes"!=e.tag||xxdialogMode?null!=e.tag&&e.tag.startsWith("meshmessenger/")?(safeNewWindow("/messenger?id="+e.tag+"&title="+encodeURIComponentEx(e.username),e.tag.split("/")[2]),notificationDelete(t)):null!=e.url&&(safeNewWindow(e.url),notificationDelete(t)):(go(2),account_manageOtp(0),notificationDelete(t))}function notificationDelete(e){var t=-1,n=Q("notifyx"+e);if(null!=n){for(var o in notifications)notifications[o].id==e&&(t=o);-1!=t&&(meshserver.send({action:"intersession",subaction:"removeNotify",id:e}),notifications[t].notification&&(notifications[t].notification.close(),delete notifications[t].notification),notifications.splice(t,1),n.parentNode.removeChild(n),setNotificationCount(notifications.length),0==notifications.length&&QV("notifiyBox",!1),1==notifications.length&&QV("notifyRemoveAll",!1),0<notifications.length)&&0==t&&(n=notifications[0],QS("notifyx"+n.id)["border-top"]="1px solid transparent")}}function addNotification(e){if("number"==typeof e.titleid)try{e.title=[null,"Nový účet","Serverový limit","Bezpečnostní varování","Nastavení účtu","Skupina zařízení","Pozvat kódy"][e.titleid]}catch(e){}if("number"==typeof e.msgid)try{e.text=[null,"Přístup odepřen","Neplatné uživatelské jméno","Neplatné heslo","Neplatný e-mail","Neplatná doména","Neplatná oprávnění webu","Uživatel již existuje","V tomto režimu nelze přidat uživatele","Ověřovací výjimka","Dosažen nejvyšší možný počet účtů.","Žádost o chat, přijměte kliknutím sem.","Od posledního přihlášení došlo k tomuto {0} neúspěšnému pokusu o přihlášení.","E -mailovou adresu se nepodařilo změnit, jiný účet již používá: {0}.","Email odeslán.","Uživatel {0} nebyl nalezen.","Uživatelé {0} nebyli nalezeni.","Chyba, nelze změnit dříve použité heslo.","Chyba, nelze změnit na běžně používané heslo.","Chyba, heslo nebylo změněno.","Heslo změněno.","Aktuální heslo není správné.",'Chyba, pozývací kód "{0}" se již používá.',"SMS brána není povolena","Žádná práva pro správu uživatelů","Neplatná SMS zpráva","Pro tohoto uživatele není k dispozici žádné telefonní číslo","SMS succesfully sent.","Chyba SMS","Chyba SMS: {0}",'E-mailová doména "{0}" není povolena. Povoleno je pouze ({1}).',"Invalid message","Message succesfully sent.","Message error","Message error: {0}"][e.msgid],Array.isArray(e.args)&&(e.text=format(e.text,e.args[0],e.args[1],e.args[2],e.args[3],e.args[4],e.args[5]))}catch(e){}null==e.time&&(e.time=Date.now()),null==e.id&&(e.id=Math.random()),notifications.unshift(e),setNotificationCount(notifications.length),clickNotificationIcon(!0);var t,n,o=getstore("notifications",0),i=(1&o&&Q("chimes").play(),null);Notification&&"granted"==Notification.permission&&(t=e.text.split("&reg;").join("").split("<b>").join("").split("</b>").join("").split("<br />").join("\r\n"),e.nodeid?(n=getNodeFromId(e.nodeid))&&(i=16&o?new Notification(decodeURIComponent("{{{extitle}}}")+" - "+meshes[n.meshid].name+" - "+n.name,{tag:e.tag,body:t,icon:"/images/notify/icons128-"+n.icon+".png"}):new Notification(decodeURIComponent("{{{extitle}}}")+" - "+n.name,{tag:e.tag,body:t,icon:"/images/notify/icons128-"+n.icon+".png"})):(null==e.icon&&(e.icon=0),o=null==(o=e.title)?"":" - "+e.title,i=new Notification(decodeURIComponent("{{{extitle}}}")+o,{tag:e.tag,body:t,icon:"/images/notify/icons128-"+e.icon+".png"})),i.id=e.id,i.xtag=e.tag,i.url=e.url,i.nodeid=e.nodeid,i.username=e.username,i.onclick=function(e){notificationSelected(e.target.id,!0)},e.notification=i),"number"==typeof e.maxtime&&0<e.maxtime&&((n=function e(){notificationDelete(e.xid)}).xid=e.id,setTimeout(n,1e3*e.maxtime))}function deleteAllNotifications(){notifications=[],setNotificationCount(0),drawNotifications(),QV("notifiyBox",!1)}function setupGeneralServerStats(){window.serverStatCpu=new Chart(document.getElementById("serverCpuChart").getContext("2d"),{type:"doughnut",data:{datasets:[{data:[0,0],backgroundColor:["#AAAAAA","#00AA00"]}],labels:["Použito","Volné"]},options:{events:[],responsive:!0,plugins:{legend:{display:!1}},animation:{animateScale:!0,animateRotate:!0},width:"40px"}}),window.serverStatMemory=new Chart(document.getElementById("serverMemoryChart").getContext("2d"),{type:"doughnut",data:{datasets:[{data:[0,0],backgroundColor:["#AAAAAA","#00AA00"]}],labels:["Použito","Volné"]},options:{events:[],responsive:!0,plugins:{legend:{display:!1}},animation:{animateScale:!0,animateRotate:!0},width:"40px"}})}var lastServerStats=null;function updateGeneralServerStats(e){if(null!=e?lastServerStats=e:e=lastServerStats,null!=e){var t,n={ServerState:"Stav serveru",AgentErrorCounters:"Počitadla chyb agenta",UnknownGroup:"Neznámá skupina",InvalidPKCSsignature:"Neplatný PKCS podpis",InvalidRSAsignature:"Neplatný RSA podpis",InvalidJSON:"Neplatný JSON",UnknownAction:"Neznámá akce",BadWebCertificate:"Nesprávný certifikát webu",BadSignature:"Nesprávný podpis",MaxSessionsReached:"Dosaženo maximálního počtu relací",UnknownDeviceGroup:"Neznámá skupina zařízení",InvalidDeviceGroupType:"Neplatný typ skupiny zařízení",DuplicateAgent:"Duplicitní agent",ConnectedIntelAMT:"Připojené Intel&reg; AMT",RelayErrors:"Chyby předávání (relay)",UserAccounts:"Uživatelské účty",DeviceGroups:"Skupiny zařízení",AgentSessions:"Relace agenta",ConnectedUsers:"Připojení",UsersSessions:"Uživatelské relace",RelaySessions:"Předávané relace",RelayCount:"Počet předávání (relay)"},o=("object"==typeof e.cpuavg&&(t=Math.min(e.cpuavg[0],1),window.serverStatCpu.config.data.datasets[0].data=[t,1-t],QH("serverCpuChartText",'<div style=margin-bottom:5px>Vytížení procesoru</div><div><b title="vytížení procesoru v předešlé minutě">'+Math.round(100*e.cpuavg[0])/100+'</b>, <b title="vytížení procesoru v uplynulých 5 minutách">'+Math.round(100*e.cpuavg[1])/100+'</b>, <b title="vytížení procesoru v uplynulých 15 minutách">'+Math.round(100*e.cpuavg[2])/100+"</b></div>"),QS("serverCpuChartView").display="inline-block",window.serverStatCpu.update()),"number"==typeof e.totalmem&&"number"==typeof e.availablemem?(window.serverStatMemory.config.data.datasets[0].data=[e.totalmem-e.availablemem,e.availablemem],QH("serverMemoryChartText","<div style=margin-bottom:5px>Dostupná paměť</div><div><b>"+getNiceSize3(e.availablemem)+"</b> volné, <b>"+getNiceSize3(e.totalmem)+"</b> celkem</div>"),QS("serverMemoryChartView").display="inline-block",window.serverStatMemory.update()):"number"==typeof e.totalmem&&"number"==typeof e.freemem&&(window.serverStatMemory.config.data.datasets[0].data=[e.totalmem-e.freemem,e.freemem],QH("serverMemoryChartText","<div style=margin-bottom:5px>Operační paměť</div><div><b>"+getNiceSize3(e.freemem)+"</b> volné, <b>"+getNiceSize3(e.totalmem)+"</b> celkem</div>"),QS("serverMemoryChartView").display="inline-block",window.serverStatMemory.update()),"<div style=width:100% cellpadding=0 cellspacing=0>");if("object"==typeof e.values)for(var i in e.values)for(var a in o+="<div class=userTableHeader style=margin-bottom:4px;width:200px>"+(n[i]||i)+"</div>",e.values[i])o+="<div style=display:inline-block><table class=serverStateTableCell><tr><td class=h1></td><td><span>"+(n[a]||a)+"</span><span style=float:right>"+e.values[i][a]+"</span></td><td class=h2></td></tr></table></div>";o+="</div>",QH("serverStatsTable",o)}}var serverTimelineStats=null,serverTimelineConfig={type:"line",data:{labels:[],datasets:[{label:"",backgroundColor:"rgba(255, 99, 132, .5)",borderColor:"rgb(255, 99, 132)",data:[],fill:!0}]},options:{animation:!1,responsive:!0,maintainAspectRatio:!1,elements:{line:{cubicInterpolationMode:"monotone"}},scales:{x:{type:"time",time:{tooltipFormat:"ll HH:mm"},display:!0,title:{display:!1,text:""}},y:{type:"linear",display:!0,title:{display:!0,text:""},stacked:!0}}}};function refreshServerTimelineStats(e){null!=meshserver&&2==meshserver.State&&meshserver.send({action:"servertimelinestats",hours:720})}function pastDate(e){var t=new Date;return t.setTime(t.getTime()-36e5*e),t}function setServerTimelineStats(e){serverTimelineStats=e,updateServerTimelineStats()}function addServerTimelineStats(e){var t;null!=serverTimelineStats&&((t=null)!=Q("p40server").value&&""==(t=decodeURIComponent(Q("p40server").value))&&(t=null),e.s==t)&&(serverTimelineStats.push(e),0==(t=Q("p40type").value)?(serverTimelineConfig.data.datasets[0].data.push({x:e.time,y:e.conn.ca}),serverTimelineConfig.data.datasets[1].data.push({x:e.time,y:e.conn.cu}),serverTimelineConfig.data.datasets[2].data.push({x:e.time,y:e.conn.us}),serverTimelineConfig.data.datasets[3].data.push({x:e.time,y:e.conn.rs}),null!=e.conn.am&&serverTimelineConfig.data.datasets[4].data.push({x:e.time,y:e.conn.am})):1==t?(serverTimelineConfig.data.datasets[0].data.push({x:e.time,y:e.mem.external/1048576}),serverTimelineConfig.data.datasets[1].data.push({x:e.time,y:e.mem.heapUsed/1048576}),serverTimelineConfig.data.datasets[2].data.push({x:e.time,y:e.mem.heapTotal/1048576}),serverTimelineConfig.data.datasets[3].data.push({x:e.time,y:e.mem.rss/1048576})):3==t||4==t?updateServerTimelineStats():5==t&&"object"==typeof e.cpu&&"number"==typeof e.cpu[0]&&serverTimelineConfig.data.datasets[0].data.push({x:e.time,y:e.cpu[0]}),updateServerTimelineHours())}function updateServerTimelineHours(){serverTimelineConfig.options.scales.y.type=Q("p40log").checked?"logarithmic":"linear",serverTimelineConfig.options.scales.x.min=pastDate(Q("p40time").value),window.serverMainStats.update()}function setupServerTimelineStats(){window.serverMainStats=new Chart(document.getElementById("serverMainStats").getContext("2d"),serverTimelineConfig)}let trafficSeriesNames=["Agent","CIRA","AMT-OS","HTTP","Předávání (relay)","Terminál","Plocha","Soubory","WebRDP","WebSSH","WebVNC","Desktop multiplex"],seriesColors=[[158,151,16],[16,84,158],[255,99,132],[39,158,16],[134,16,158],[0,148,255],[255,216,0],[255,127,237],[109,213,255],[89,94,255],[179,104,255],[179,104,255]];function seriesColor1(e){return"rgba("+(seriesColors[e][0]+(255-seriesColors[e][0])/1.5)+","+(seriesColors[e][1]+(255-seriesColors[e][1])/1.5)+","+(seriesColors[e][2]+(255-seriesColors[e][2])/1.5)+")"}function seriesColor2(e){return"rgba("+seriesColors[e][0]+","+seriesColors[e][1]+","+seriesColors[e][2]+")"}function updateServerTimelineStats(){if(null!=serverTimelineStats){var e=Q("p40type").value,t=pastDate(Q("p40time").value),n=[],o=null,i=!1,a=!0;if(null!=Q("p40server").value&&(""==(o=decodeURIComponent(Q("p40server").value))&&(o=null),a=!1),serverTimelineConfig.options.scales.x.min=t,serverTimelineConfig.options.scales.y.stacked=3==e||4==e,0==e){serverTimelineConfig.options.scales.y.title.text="Počitadlo připojení";for(var s={labels:[pastDate(0),t],datasets:[{label:"Agenti",data:[],backgroundColor:"rgba(158, 151, 16, .1)",borderColor:"rgb(158, 151, 16)",fill:!0},{label:"Uživatelé",data:[],backgroundColor:"rgba(16, 84, 158, .1)",borderColor:"rgb(16, 84, 158)",fill:!0},{label:"Relace uživatele",data:[],backgroundColor:"rgba(255, 99, 132, .1)",borderColor:"rgb(255, 99, 132)",fill:!0},{label:"Předávané relace",data:[],backgroundColor:"rgba(39, 158, 16, .1)",borderColor:"rgb(39, 158, 16)",fill:!0},{label:"Intel AMT",data:[],backgroundColor:"rgba(134, 16, 158, .1)",borderColor:"rgb(134, 16, 158)",fill:!0}]},r=0;r<serverTimelineStats.length;r++){new Date(serverTimelineStats[r].time);null!=serverTimelineStats[r].s&&-1==n.indexOf(serverTimelineStats[r].s)&&(n.push(serverTimelineStats[r].s),a)&&(o=serverTimelineStats[r].s,a=!1),null==serverTimelineStats[r].s&&(i=!0),serverTimelineStats[r].s==o&&(1==serverTimelineStats[r].first&&(s.datasets[0].data.push({x:serverTimelineStats[r].time-1,y:NaN}),s.datasets[1].data.push({x:serverTimelineStats[r].time-1,y:NaN}),s.datasets[2].data.push({x:serverTimelineStats[r].time-1,y:NaN}),s.datasets[3].data.push({x:serverTimelineStats[r].time-1,y:NaN}),s.datasets[4].data.push({x:serverTimelineStats[r].time-1,y:NaN})),serverTimelineStats[r].conn&&(s.datasets[0].data.push({x:serverTimelineStats[r].time,y:serverTimelineStats[r].conn.ca}),s.datasets[1].data.push({x:serverTimelineStats[r].time,y:serverTimelineStats[r].conn.cu}),s.datasets[2].data.push({x:serverTimelineStats[r].time,y:serverTimelineStats[r].conn.us}),s.datasets[3].data.push({x:serverTimelineStats[r].time,y:serverTimelineStats[r].conn.rs}),null!=serverTimelineStats[r].conn.am))&&s.datasets[4].data.push({x:serverTimelineStats[r].time,y:serverTimelineStats[r].conn.am})}}else if(1==e){serverTimelineConfig.options.scales.y.title.text="Megabajtů",s={labels:[pastDate(0),t],datasets:[{label:"Externí",data:[],backgroundColor:"rgba(158, 151, 16, .1)",borderColor:"rgb(158, 151, 16)",fill:!0},{label:"Halda využito",data:[],backgroundColor:"rgba(16, 84, 158, .1)",borderColor:"rgb(16, 84, 158)",fill:!0},{label:"Halda celkem",data:[],backgroundColor:"rgba(255, 99, 132, .1)",borderColor:"rgb(255, 99, 132)",fill:!0},{label:"RSS",data:[],backgroundColor:"rgba(39, 158, 16, .1)",borderColor:"rgb(39, 158, 16)",fill:!0}]};for(r=0;r<serverTimelineStats.length;r++)null!=serverTimelineStats[r].s&&-1==n.indexOf(serverTimelineStats[r].s)&&(n.push(serverTimelineStats[r].s),a)&&(o=serverTimelineStats[r].s,a=!1),null==serverTimelineStats[r].s&&(i=!0),serverTimelineStats[r].s==o&&(1==serverTimelineStats[r].first&&(s.datasets[0].data.push({x:serverTimelineStats[r].time-1,y:NaN}),s.datasets[1].data.push({x:serverTimelineStats[r].time-1,y:NaN}),s.datasets[2].data.push({x:serverTimelineStats[r].time-1,y:NaN}),s.datasets[3].data.push({x:serverTimelineStats[r].time-1,y:NaN})),s.datasets[0].data.push({x:serverTimelineStats[r].time,y:serverTimelineStats[r].mem.external/1048576}),s.datasets[1].data.push({x:serverTimelineStats[r].time,y:serverTimelineStats[r].mem.heapUsed/1048576}),s.datasets[2].data.push({x:serverTimelineStats[r].time,y:serverTimelineStats[r].mem.heapTotal/1048576}),s.datasets[3].data.push({x:serverTimelineStats[r].time,y:serverTimelineStats[r].mem.rss/1048576}))}else if(3==e||4==e){serverTimelineConfig.options.scales.y.title.text="Megabajtů",s={labels:[pastDate(0),t],datasets:[]};for(var l=0,r=0;r<serverTimelineStats.length;r++)null!=serverTimelineStats[r].traffic&&(null!=serverTimelineStats[r].s&&-1==n.indexOf(serverTimelineStats[r].s)&&(n.push(serverTimelineStats[r].s),a)&&(o=serverTimelineStats[r].s,a=!1),null==serverTimelineStats[r].s&&(i=!0),serverTimelineStats[r].s==o)&&serverTimelineStats[r].traffic&&(0<serverTimelineStats[r].traffic.AgentCtrlIn&&(l|=1),0<serverTimelineStats[r].traffic.CIRAIn&&(l|=2),0<serverTimelineStats[r].traffic.LMSIn&&(l|=4),0<serverTimelineStats[r].traffic.httpIn&&(l|=8),serverTimelineStats[r].traffic.relayIn&&(0<serverTimelineStats[r].traffic.relayIn[0]&&(l|=16),0<serverTimelineStats[r].traffic.relayIn[1]&&(l|=32),0<serverTimelineStats[r].traffic.relayIn[2]&&(l|=64),0<serverTimelineStats[r].traffic.relayIn[5]&&(l|=128),0<serverTimelineStats[r].traffic.relayIn[10]&&(l|=256),0<serverTimelineStats[r].traffic.relayIn[11]&&(l|=512),0<serverTimelineStats[r].traffic.relayIn[12])&&(l|=1024),serverTimelineStats[r].traffic.desktopMultiplex)&&0<serverTimelineStats[r].traffic.desktopMultiplex.in&&(l|=2048);for(r=0;r<13;r++)l&1<<r&&s.datasets.push({label:trafficSeriesNames[r],data:[],backgroundColor:seriesColor1(r),borderColor:seriesColor2(r),fill:!0,steppedLine:!0});for(r=0;r<serverTimelineStats.length;r++)if(null!=serverTimelineStats[r].traffic&&(null!=serverTimelineStats[r].s&&-1==n.indexOf(serverTimelineStats[r].s)&&(n.push(serverTimelineStats[r].s),a)&&(o=serverTimelineStats[r].s,a=!1),null==serverTimelineStats[r].s&&(i=!0),serverTimelineStats[r].s==o)){if(1==serverTimelineStats[r].first)for(var d=1;d<61440;d<<=1)l&d&&s.datasets[0].data.push({x:serverTimelineStats[r].time-1,y:NaN});var u=0;3==e?(1&l&&s.datasets[u++].data.push({x:serverTimelineStats[r].time,y:serverTimelineStats[r].traffic.AgentCtrlIn?serverTimelineStats[r].traffic.AgentCtrlIn/1048576:0}),2&l&&s.datasets[u++].data.push({x:serverTimelineStats[r].time,y:serverTimelineStats[r].traffic.CIRAIn?serverTimelineStats[r].traffic.CIRAIn/1048576:0}),4&l&&s.datasets[u++].data.push({x:serverTimelineStats[r].time,y:serverTimelineStats[r].traffic.LMSIn?serverTimelineStats[r].traffic.LMSIn/1048576:0}),8&l&&s.datasets[u++].data.push({x:serverTimelineStats[r].time,y:serverTimelineStats[r].traffic.httpIn?serverTimelineStats[r].traffic.httpIn/1048576:0}),16&l&&s.datasets[u++].data.push({x:serverTimelineStats[r].time,y:serverTimelineStats[r].traffic.relayIn&&serverTimelineStats[r].traffic.relayIn[0]?serverTimelineStats[r].traffic.relayIn[0]/1048576:0}),32&l&&s.datasets[u++].data.push({x:serverTimelineStats[r].time,y:serverTimelineStats[r].traffic.relayIn&&serverTimelineStats[r].traffic.relayIn[1]?serverTimelineStats[r].traffic.relayIn[1]/1048576:0}),64&l&&s.datasets[u++].data.push({x:serverTimelineStats[r].time,y:serverTimelineStats[r].traffic.relayIn&&serverTimelineStats[r].traffic.relayIn[2]?serverTimelineStats[r].traffic.relayIn[2]/1048576:0}),128&l&&s.datasets[u++].data.push({x:serverTimelineStats[r].time,y:serverTimelineStats[r].traffic.relayIn&&serverTimelineStats[r].traffic.relayIn[5]?serverTimelineStats[r].traffic.relayIn[5]/1048576:0}),256&l&&s.datasets[u++].data.push({x:serverTimelineStats[r].time,y:serverTimelineStats[r].traffic.relayIn&&serverTimelineStats[r].traffic.relayIn[10]?serverTimelineStats[r].traffic.relayIn[10]/1048576:0}),512&l&&s.datasets[u++].data.push({x:serverTimelineStats[r].time,y:serverTimelineStats[r].traffic.relayIn&&serverTimelineStats[r].traffic.relayIn[11]?serverTimelineStats[r].traffic.relayIn[11]/1048576:0}),1024&l&&s.datasets[u++].data.push({x:serverTimelineStats[r].time,y:serverTimelineStats[r].traffic.relayIn&&serverTimelineStats[r].traffic.relayIn[12]?serverTimelineStats[r].traffic.relayIn[12]/1048576:0}),2048&l&&s.datasets[u++].data.push({x:serverTimelineStats[r].time,y:serverTimelineStats[r].traffic.desktopMultiplex&&serverTimelineStats[r].traffic.desktopMultiplex.in?serverTimelineStats[r].traffic.desktopMultiplex.in/1048576:0})):4==e&&(1&l&&s.datasets[u++].data.push({x:serverTimelineStats[r].time,y:serverTimelineStats[r].traffic.AgentCtrlOut?serverTimelineStats[r].traffic.AgentCtrlOut/1048576:0}),2&l&&s.datasets[u++].data.push({x:serverTimelineStats[r].time,y:serverTimelineStats[r].traffic.CIRAOut?serverTimelineStats[r].traffic.CIRAOut/1048576:0}),4&l&&s.datasets[u++].data.push({x:serverTimelineStats[r].time,y:serverTimelineStats[r].traffic.LMSOut?serverTimelineStats[r].traffic.LMSOut/1048576:0}),8&l&&s.datasets[u++].data.push({x:serverTimelineStats[r].time,y:serverTimelineStats[r].traffic.httpOut?serverTimelineStats[r].traffic.httpOut/1048576:0}),16&l&&s.datasets[u++].data.push({x:serverTimelineStats[r].time,y:serverTimelineStats[r].traffic.relayOut&&serverTimelineStats[r].traffic.relayOut[0]?serverTimelineStats[r].traffic.relayOut[0]/1048576:0}),32&l&&s.datasets[u++].data.push({x:serverTimelineStats[r].time,y:serverTimelineStats[r].traffic.relayOut&&serverTimelineStats[r].traffic.relayOut[1]?serverTimelineStats[r].traffic.relayOut[1]/1048576:0}),64&l&&s.datasets[u++].data.push({x:serverTimelineStats[r].time,y:serverTimelineStats[r].traffic.relayOut&&serverTimelineStats[r].traffic.relayOut[2]?serverTimelineStats[r].traffic.relayOut[2]/1048576:0}),128&l&&s.datasets[u++].data.push({x:serverTimelineStats[r].time,y:serverTimelineStats[r].traffic.relayOut&&serverTimelineStats[r].traffic.relayOut[5]?serverTimelineStats[r].traffic.relayOut[5]/1048576:0}),256&l&&s.datasets[u++].data.push({x:serverTimelineStats[r].time,y:serverTimelineStats[r].traffic.relayOut&&serverTimelineStats[r].traffic.relayOut[10]?serverTimelineStats[r].traffic.relayOut[10]/1048576:0}),512&l&&s.datasets[u++].data.push({x:serverTimelineStats[r].time,y:serverTimelineStats[r].traffic.relayOut&&serverTimelineStats[r].traffic.relayOut[11]?serverTimelineStats[r].traffic.relayOut[11]/1048576:0}),1024&l&&s.datasets[u++].data.push({x:serverTimelineStats[r].time,y:serverTimelineStats[r].traffic.relayOut&&serverTimelineStats[r].traffic.relayOut[12]?serverTimelineStats[r].traffic.relayOut[12]/1048576:0}),2048&l)&&s.datasets[u++].data.push({x:serverTimelineStats[r].time,y:serverTimelineStats[r].traffic.desktopMultiplex&&serverTimelineStats[r].traffic.desktopMultiplex.out?serverTimelineStats[r].traffic.desktopMultiplex.out/1048576:0})}}else if(5==e){serverTimelineConfig.options.scales.y.title.text="Používání",s={labels:[pastDate(0),t],datasets:[{label:"Procesor",data:[],backgroundColor:"rgba(158, 151, 16, .1)",borderColor:"rgb(158, 151, 16)",fill:!0}]};for(r=0;r<serverTimelineStats.length;r++)"object"==typeof serverTimelineStats[r].cpu&&"number"==typeof serverTimelineStats[r].cpu[0]&&(null!=serverTimelineStats[r].s&&-1==n.indexOf(serverTimelineStats[r].s)&&(n.push(serverTimelineStats[r].s),a)&&(o=serverTimelineStats[r].s,a=!1),null==serverTimelineStats[r].s&&(i=!0),serverTimelineStats[r].s==o)&&(1==serverTimelineStats[r].first&&s.datasets[0].data.push({x:serverTimelineStats[r].time-1,y:NaN}),s.datasets[0].data.push({x:serverTimelineStats[r].time,y:serverTimelineStats[r].cpu[0]}))}if(serverTimelineConfig.data=s,window.serverMainStats.update(),0<n.length){for(var c="",r=0;r<n.length;r++)c+='<option value="'+encodeURIComponentEx(n[r])+'"'+(o==n[r]?" selected":"")+">"+EscapeHtml(n[r])+"</option>";i&&(c+='<option value=""'+(null==o?" selected":"")+">Nula</option>"),QH("p40server",c)}QV("p40server",0<n.length)}}function p40downloadEvents(){for(var e="time, conn.agent, conn.users, conn.usersessions, conn.relaysession, conn.intelamt, mem.external, mem.heapused, mem.heaptotal, mem.rss\r\n",t=0;t<serverTimelineStats.length;t++)serverTimelineStats[t].conn&&serverTimelineStats[t].mem&&(e+=new Date(serverTimelineStats[t].time)+", "+serverTimelineStats[t].conn.ca+", "+serverTimelineStats[t].conn.cu+", "+serverTimelineStats[t].conn.us+", "+serverTimelineStats[t].conn.rs+", "+(serverTimelineStats[t].conn.am||"")+", "+serverTimelineStats[t].mem.external+", "+serverTimelineStats[t].mem.heapUsed+", "+serverTimelineStats[t].mem.heapTotal+", "+serverTimelineStats[t].mem.rss+"\r\n");saveAs(stringToUtf8Blob(e),"ServerStats.csv")}var xxdialogMode,xxdialogFunc,xxdialogButtons,xxdialogTag,serverTrace=[],serverTraceSources=[];function displayServerTrace(){var e,t="",n=parseInt(Q("p41limitdropdown").value);for(e in serverTrace.length>n&&serverTrace.splice(n),serverTrace){var o,i=[];for(o in serverTrace[e].args)"object"==typeof serverTrace[e].args[o]?i.push(JSON.stringify(serverTrace[e].args[o])):i.push(serverTrace[e].args[o]);t+="<div class=traceEvent onclick=showTraceEvent("+e+")>"+EscapeHtml(new Date(serverTrace[e].time).toLocaleTimeString())+" - <b>"+EscapeHtml(serverTrace[e].source.toUpperCase())+"</b>: "+EscapeHtml(i.join(", "))+"</div>"}QH("p41events",t)}function showTraceEvent(e){var t=serverTrace[e],n="";if(!xxdialogMode&&null!=t){for(var e in t.args)"object"==typeof t.args[e]?n+=EscapeHtml(JSON.stringify(t.args[e]))+"<br /><br />":n+=EscapeHtml(t.args[e])+"<br /><br />";setDialogMode(2,"Událost sledování serveru",1,null,"<div class=selecttext style=max-height:300px;overflow-y:auto>"+n+"</div>")}}function clearServerTracing(){serverTrace=[],displayServerTrace()}function setServerTracing(){var e='<div style="max-height:200px;overflow-y:auto">';setDialogMode(2,"Trasování serveru",7,setServerTracingEx,(e+='<div style="width:100%;border-bottom:1px solid gray;margin-bottom:5px;margin-top:5px"><b>Hlavní server</b></div>')+("<div><label><input type=checkbox id=p41c1 "+(0<=serverTraceSources.indexOf("cookie")?"checked":"")+">Cookie enkodér</label></div>")+("<div><label><input type=checkbox id=p41c2 "+(0<=serverTraceSources.indexOf("dispatch")?"checked":"")+">Odesílatel</label></div>")+("<div><label><input type=checkbox id=p41c3 "+(0<=serverTraceSources.indexOf("main")?"checked":"")+">Zprávy hlavního serveru</label></div>")+("<div><label><input type=checkbox id=p41c4 "+(0<=serverTraceSources.indexOf("peer")?"checked":"")+">MeshCentral Server Peering</label></div>")+("<div><label><input type=checkbox id=p41c15 "+(0<=serverTraceSources.indexOf("agent")?"checked":"")+">Provoz MeshAgenta</label></div>")+("<div><label><input type=checkbox id=p41c14 "+(0<=serverTraceSources.indexOf("agentupdate")?"checked":"")+">Aktualizace MeshAgenta</label></div>")+("<div><label><input type=checkbox id=p41c16 "+(0<=serverTraceSources.indexOf("cert")?"checked":"")+">Certifikát serveru</label></div>")+("<div><label><input type=checkbox id=p41c17 "+(0<=serverTraceSources.indexOf("db")?"checked":"")+">Databáze serveru</label></div>")+("<div><label><input type=checkbox id=p41c18 "+(0<=serverTraceSources.indexOf("email")?"checked":"")+">E -mail/SMS/push provoz</label></div>")+'<div style="width:100%;border-bottom:1px solid gray;margin-bottom:5px;margin-top:5px"><b>Webový server</b></div>'+("<div><label><input type=checkbox id=p41c5 "+(0<=serverTraceSources.indexOf("web")?"checked":"")+">Webový server</label></div>")+("<div><label><input type=checkbox id=p41c6 "+(0<=serverTraceSources.indexOf("webrequest")?"checked":"")+">Požadavky webového serveru</label></div>")+("<div><label><input type=checkbox id=p41c7 "+(0<=serverTraceSources.indexOf("relay")?"checked":"")+">Web Socket Relay</label></div>")+("<div><label><input type=checkbox id=p41c20 "+(0<=serverTraceSources.indexOf("httpheaders")?"checked":"")+">Záhlaví HTTP webového serveru</label></div>")+("<div><label><input type=checkbox id=p41c21 "+(0<=serverTraceSources.indexOf("authlog")?"checked":"")+">User Authentication Log</label></div>")+'<div style="width:100%;border-bottom:1px solid gray;margin-bottom:5px;margin-top:5px"><b>Intel&reg; AMT</b></div>'+("<div><label><input type=checkbox id=p41c19 "+(0<=serverTraceSources.indexOf("amt")?"checked":"")+">Intel AMT manager</label></div>")+("<div><label><input type=checkbox id=p41c9 "+(0<=serverTraceSources.indexOf("webrelay")?"checked":"")+">Předávání (relay) spojení</label></div>")+("<div><label><input type=checkbox id=p41c10 "+(0<=serverTraceSources.indexOf("mps")?"checked":"")+">CIRA Server</label></div>")+("<div><label><input type=checkbox id=p41c11 "+(0<=serverTraceSources.indexOf("mpscmd")?"checked":"")+">příkazy CIRA serveru</label></div>")+"</div>")}function setServerTracingEx(e){var t=[],n=["cookie","dispatch","main","peer","web","webrequest","relay","webrelaydata","webrelay","mps","mpscmd","swarm","swarmcmd","agentupdate","agent","cert","db","email","amt","httpheaders","authlog"];if(1==e)for(var o=1;o<22;o++)try{Q("p41c"+o).checked&&t.push(n[o-1])}catch(e){}meshserver.send({action:"traceinfo",traceSources:t})}function p41downloadServerTrace(){var e,t="time, source, message\r\n";for(e in serverTrace)t+='"'+new Date(serverTrace[e].time).toLocaleTimeString()+'","'+serverTrace[e].source+'","'+serverTrace[e].args.join(", ")+'"\r\n';return saveAs(stringToUtf8Blob(t),"servertrace.csv"),!1}function setupServiceWorker(){0!=(8&features2)&&"string"==typeof serverinfo.vapidpublickey&&null!=Notification&&"granted"==Notification.permission&&"serviceWorker"in navigator&&navigator.serviceWorker.register("serviceworker.js").then(function(e){navigator.serviceWorker.ready.then(function(e){e.pushManager.subscribe({applicationServerKey:urlBase64ToUint8Array(serverinfo.vapidpublickey),userVisibleOnly:!0}).then(function(e){meshserver.send({action:"webpush",sub:e})}).catch(function(e){console.error("Worker: Unable to subscribe to push",e)})})}).catch(function(e){console.log("Worker: Registration failed",e)})}var xxcurrentView=-1;function setDialogMode(e,t,n,o,i,a){setSessionActivity(),QV("uiMenu",!1),xxdialogMode=e,xxdialogFunc=o,xxdialogButtons=n,xxdialogTag=a,QS("dialog").width=QS("dialog").top=QS("dialog").left=QS("dialog").right=QS("dialog").bottom=null,QE("idx_dlgOkButton",!0),QV("idx_dlgOkButton",1&n),QV("idx_dlgCancelButton",2&n),Q("idx_dlgCancelButton").value=2==n?"Zavřít":"Storno",QV("id_dialogclose",2&n||8&n),QV("idx_dlgDeleteButton",4&n),QV("idx_dlgButtonBar",7&n),QV("idx_dlgMoreButtons",16&n),t&&QH("id_dialogtitle",t);for(var s=1;s<24;s++)QV("dialog"+s,s==e);QV("dialog",e),i&&(2==e?QH("id_dialogOptions",i):QH("id_dialogMessage",i)),MoreToggle(!1)}function dialogclose(e){setSessionActivity();var t=xxdialogFunc,n=xxdialogButtons,o=xxdialogTag;setDialogMode(),(8&n||e)&&t&&t(e,o)}function center(){setSessionActivity(),11==xxcurrentView?deskAdjust():10==xxcurrentView?mainUpdate(256):1==xxcurrentView&&mainUpdate(4)}function messagebox(e,t){setSessionActivity(),QH("id_dialogMessage",t),setDialogMode(1,e,1)}function statusbox(e,t){setSessionActivity(),QH("id_dialogMessage",t),setDialogMode(1,e)}function goBack(){setSessionActivity(),xxdialogMode||0==goBackStack.length||(fullscreen&&deskToggleFull(),go(goBackStack.pop()),goBackStack.pop())}function go(e,t){if((!t||3!=t.which&&2!=t.button)&&(262144&features&&0==count2factoraAuths()&&2<e&&setDialogMode(e=2,"Nastavení zabezpečení",1,null,"Nelze získat přístup k této funkci, dokud není povoleno dvoufaktorové ověřování. To je nutné pro větší bezpečnost. Přejděte na kartu „Můj účet“ a podívejte se do části „Zabezpečení účtu“."),null!=pluginHandler&&pluginHandler.callHook("goPageStart",e,t),setSessionActivity(),!xxdialogMode))if(QV("uiMenu",!1),!t||1!=t.shiftKey&&2!=t.which&&1!=t.button||15==e||""!="{{{currentNode}}}".toLowerCase()){if(xxcurrentView!=e){xxcurrentView<0||e<10?goBackStack=[]:50!=xxcurrentView&&Math.floor(xxcurrentView/10)==Math.floor(e/10)||goBackStack.push(xxcurrentView),11==xxcurrentView&&null!=desktop&&null!=desktop.m.recordedData&&deskRecordSession(),(4==e&&null!=userinfo&&0==(2&userinfo.siteadmin)||0!=(4&features))&&(e=52),17==xxcurrentView&&deviceDetailsStatsClear();for(var n=0;n<61;n++)QV("p"+n,n==e);if(xxcurrentView=e,fullscreen&&deskToggleFull(),0==(268435456&features)&&0<xxcurrentView){var o="";for(n in 10<=xxcurrentView&&xxcurrentView<=19?null!=currentNode&&(o="?viewmode="+xxcurrentView+"&gotonode="+currentNode._id.split("/")[2]):20<=xxcurrentView&&xxcurrentView<=29?null!=currentMesh&&(o="?viewmode="+xxcurrentView+"&gotomesh="+currentMesh._id.split("/")[2]):30<=xxcurrentView&&xxcurrentView<=39?null!=currentUser&&(o="?viewmode="+xxcurrentView+"&gotouser="+(serverinfo.crossDomain?currentUser._id:currentUser._id.split("/")[2])):51<=xxcurrentView&&xxcurrentView<=51?null!=currentUserGroup&&null!=currentUserGroup._id&&(o="?viewmode="+xxcurrentView+"&gotougrp="+(serverinfo.crossDomain?currentUserGroup._id:currentUserGroup._id.split("/")[2])):1<xxcurrentView&&(o="?viewmode="+xxcurrentView),urlargs)o+=(""==o?"?":"&")+n+"="+urlargs[n];try{window.history.replaceState({},document.title,window.location.pathname+o)}catch(e){}}var i=["MainMenuMyDevices","MainMenuMyAccount","MainMenuMyEvents","MainMenuMyFiles","MainMenuMyUsers","MainMenuMyServer"];for(n in i)QC(i[n]).remove("fullselect"),QC(i[n]).remove("semiselect");var a=["LeftMenuMyDevices","LeftMenuMyAccount","LeftMenuMyEvents","LeftMenuMyFiles","LeftMenuMyUsers","LeftMenuMyServer"];for(n in a)QC(a[n]).remove("lbbuttonsel"),QC(a[n]).remove("lbbuttonsel2");var s=e<9?"fullselect":"semiselect",r=e<9||115==e||40==e||41==e||42==e?"lbbuttonsel2":"lbbuttonsel",l=0,d=(0<goBackStack.length&&(l=goBackStack[goBackStack.length-1]),1==e||1==l||0==l&&10<=e&&e<20?(QC("MainMenuMyDevices").add(s),QC("LeftMenuMyDevices").add(r)):2==e||2==l||0==l&&20<=e&&e<30?(QC("MainMenuMyAccount").add(s),QC("LeftMenuMyAccount").add(r)):3==e||60==e?(QC("MainMenuMyEvents").add(s),QC("LeftMenuMyEvents").add(r)):4==e||30<=e&&e<40||50==e||51==e||52==e?(QC("MainMenuMyUsers").add(s),QC("LeftMenuMyUsers").add(r)):5==e?(QC("MainMenuMyFiles").add(s),QC("LeftMenuMyFiles").add(r)):(6==e||115==e||40<=e&&e<50)&&(QC("MainMenuMyServer").add(s),QC("LeftMenuMyServer").add(r)),QV("ServerPlugins",null!=pluginHandler),webPageStackMenu&&10<=e?QC("column_l").add("room4submenu"):QC("column_l").remove("room4submenu"),QV("topbar",0!=e),0==e&&webPageFullScreen&&QC("body").add("arg_hide"),QV("MainSubMenuSpan",10<=e&&e<20),QV("UserDummyMenuSpan",51==e||e<10&&6!=e&&webPageFullScreen),QV("MeshSubMenuSpan",20<=e&&e<30),QV("UserSubMenuSpan",30<=e&&e<40),QV("ServerSubMenuSpan",6==e||115==e||40==e||41==e||42==e||43==e),QV("UsersSubMenuSpan",4==e||50==e||52==e),QV("EventsSubMenuSpan",3==e||60==e),{3:"EventsLive",4:"UsersGeneral",10:"MainDev",11:"MainDevDesktop",12:"MainDevTerminal",13:"MainDevFiles",14:"MainDevAmt",15:"MainDevConsole",16:"MainDevEvents",17:"MainDevInfo",19:"MainDevPlugins",20:"MeshGeneral",21:"MeshSummary",30:"UserGeneral",31:"UserEvents",6:"ServerGeneral",40:"ServerStats",41:"ServerTrace",42:"ServerPlugins",50:"UsersGroups",52:"UsersRecordings",60:"EventsReport",115:"ServerConsole"});for(n in d)QC(d[n]).remove("style3x"),QC(d[n]).remove("style3sel"),QC(d[n]).add(e==n?"style3sel":"style3x");11==e&&deskAdjust(),115==e&&QV("p15",!0),QV("p15uploadCore",115!=e),QV("p15BackButton",115!=e&&0==(32&args.hide)&&""=="{{currentNode}}".toLowerCase()),15!=e&&115!=e||setupConsole(),1==e&&mainUpdate(4),2==e&&Notification&&QV("accountEnableNotificationsSpan","granted"!=Notification.permission),40==e&&null==serverTimelineStats&&refreshServerTimelineStats(),42==e&&refreshPluginLatest(),21==e&&p21updateMesh(),52==e&&(null==p52recordings&&refreshRecodings(),updateRecordings()),12==e&&null!=xtermfit&&(xtermfit.fit(),xterm.focus()),document.title=currentNode&&10<=e&&e<20?currentNode.name+(meshes[currentNode.meshid]?" - "+meshes[currentNode.meshid].name:"")+" - "+decodeURIComponent("{{{extitle}}}"):decodeURIComponent("{{{extitle}}}"),null!=pluginHandler&&pluginHandler.callHook("goPageEnd",e,t),QS("column_l").overflow=0<=[11,12].indexOf(e)?"hidden":null}}else 10<=e&&e<=19?currentNode&&safeNewWindow(window.location.origin+"{{{domainurl}}}?gotonode="+currentNode._id.split("/")[2]+"&viewmode="+e+"&hide=16"+(urlargs.key?"&key="+urlargs.key:""),"meshcentral:"+currentNode._id):20<=e&&e<=29?currentMesh&&safeNewWindow(window.location.origin+"{{{domainurl}}}?gotomesh="+currentMesh._id.split("/")[2]+"&viewmode="+e+"&hide=16"+(urlargs.key?"&key="+urlargs.key:""),"meshcentral:"+currentMesh._id):30<=e&&e<=39?currentUser&&safeNewWindow(window.location.origin+"{{{domainurl}}}?gotouser="+(serverinfo.crossDomain?currentUser._id:currentUser._id.split("/")[2])+"&viewmode="+e+"&hide=16"+(urlargs.key?"&key="+urlargs.key:""),"meshcentral:"+currentUser._id):50<=e&&e<=59?currentUserGroup&&safeNewWindow(window.location.origin+"{{{domainurl}}}?gotougrp="+(serverinfo.crossDomain?currentUserGroup._id:currentUserGroup._id.split("/")[2])+"&viewmode="+e+"&hide=16"+(urlargs.key?"&key="+urlargs.key:""),"meshcentral:"+currentUserGroup._id):safeNewWindow(window.location.origin+"{{{domainurl}}}?viewmode="+e+"&hide=0"+(urlargs.key?"&key="+urlargs.key:""),"meshcentral:"+e)}function updatePluginList(e){if(null!=pluginHandler){if(Array.isArray(e)&&e.forEach(function(e){updatePluginList(e)}),QV("pluginNoneNotice",0==installedPluginList.length),installedPluginList.length){if(null!=e&&(null==installedPluginList.version_info&&(installedPluginList.version_info=[]),installedPluginList.version_info[e.id]=e),(n=Q("p42tbl").querySelectorAll(".p42tblRow")).length)for(var t in Object.values(n))n[t].parentNode.removeChild(n[t]);var s={0:{text:"Disabled",color:"858483"},1:{text:"Installed",color:"00aa00"}},r={0:{install:"Install",delete:"Delete"},1:{disable:"Disable",upgrade:"Upgrade"}},l=Q("p42tbl");installedPluginList.forEach(function(e){var t,n=[],o=(1==e.hasAdminPanel&&e.status?e.nameHtml="<a onclick=\"return goPlugin('"+e.shortName+"', '"+e.name.replace(/'/g,"\\'")+"');\">"+EscapeHtml(e.name)+"</a>":e.nameHtml=EscapeHtml(e.name),e.statusText=s[e.status].text,e.statusColor=s[e.status].color,null==e.versionHistoryUrl&&n.push("downgrade"),e.status||(e.version=" - "),e.upgradeAvail="Kontrola…",null!=installedPluginList.version_info&&null!=installedPluginList.version_info[e._id]&&(!(i=installedPluginList.version_info[e._id]).hasUpdate&&(n.push("upgrade"),e.status)?e.upgradeAvail="Aktuální":e.upgradeAvail='<a title="Zobrazit Changelog" rel="noreferrer noopener" target="_blank" href="'+i.changelogUrl+'">'+i.version+"</a>",i.meshCentralCompat||(e.upgradeAvail+=' [ <span onclick="return setDialogMode(2, \'Compatibility Issue\', 1, null, \'This plugin version is not compatible with your MeshCentral installation, please upgrade MeshCentral first.\');" title="Verze nekompatibilní, nejprve prosím upgradujte instalaci MeshCentral" style="cursor: pointer; color:red;"> ! </span> ]',n.push("install"),n.push("upgrade"))),e.actions="<select onchange=\"return pluginAction(this,'"+e._id+'\');"><option value=""> --</option>',Object.entries(r[e.status]));for(t in o)-1===n.indexOf(o[t][0])&&(e.actions+='<option value="'+o[t][0]+'">'+o[t][1]+"</option>");e.actions+="</select>";var i="<td><img style=margin-top:3px src=images/plugin24.png></td><td class=gradTable1>&nbsp;</td><td class=gradTable2>"+e.nameHtml+"</td><td class=gradTable2>"+EscapeHtml(e.description)+'</td><td class=gradTable2 style=text-align:center><a href="'+EscapeHtml(e.homepage)+'" rel="noreferrer noopener" target="_blank">Home</a></td><td class=gradTable2 style=text-align:center>'+EscapeHtml(e.version)+'</td><td style=text-align:center class="pluginUpgradeAvailable gradTable2">'+e.upgradeAvail+'</td><td class=gradTable2 style="text-align:center;color:#'+e.statusColor+'">'+e.statusText+'</td><td class="pluginAction gradTable2" style=text-align:center>'+e.actions+"</td><td class=gradTable3>&nbsp;</td>",a=l.insertRow(-1);a.innerHTML=i,a.classList.add("p42tblRow"),a.setAttribute("data-id",e._id),a.setAttribute("id","pluginRow-"+e._id)})}else{var n=Q("p42tbl").querySelectorAll(".p42tblRow");for(t in Object.values(n))n[t].parentNode.removeChild(n[t])}null==e&&refreshPluginLatest()}}function refreshPluginLatest(){null!=pluginHandler&&meshserver.send({action:"pluginLatestCheck"})}function distributeCore(){null!=pluginHandler&&(meshserver.send({action:"distributeCore",nodes:nodes}),QV("pluginRestartNotice",!1))}function pluginActionEx(){if(null!=pluginHandler){var e=Q("lastPluginAct").value,t=Q("lastPluginId").value,n=Q("lastPluginVersion").value;switch(e){case"upgrade":case"install":meshserver.send({action:"installplugin",id:t,version_only:!1});break;case"downgrade":Q("lastPluginVersion").querySelectorAll("option").forEach(function(e){e.value==n&&(pVers=e.text)}),meshserver.send({action:"installplugin",id:t,version_only:{name:pVers,url:n}});break;case"delete":meshserver.send({action:"removeplugin",id:t});break;case"disable":meshserver.send({action:"disableplugin",id:t})}QV("pluginRestartNotice",!0)}}function pluginAction(e,t){if(null!=pluginHandler){if("downgrade"==e.value)meshserver.send({action:"getpluginversions",id:t});else{var n,o=null;for(n in installedPluginList)installedPluginList[n]._id==t&&(o=installedPluginList[n]);setDialogMode(2,"Akce zásuvného modulu",3,pluginActionEx,format("Opravdu chcete {0} zásuvný modul: {1}",e.value,o.name)+'<input id="lastPluginAct" type="hidden" value="'+e.value+'" /><input id="lastPluginId" type="hidden" value="'+t+'" /><input id="lastPluginVersion" type="hidden" value="" />')}e.value=""}}function goPlugin(e,t){null!=pluginHandler&&(null==e?Q("p43iframe").src="":(QH("p43title",t),Q("p43iframe").src="/pluginadmin.ashx?pin="+e,go(43)))}function removeUserRights(e,t){var n;return t==userinfo._id&&null!=userinfo.removeRights&&((n=t=0)!=(8&userinfo.removeRights)&&(n+=8),0!=(65536&userinfo.removeRights)&&(t+=65536),0!=(256&userinfo.removeRights)&&(t+=256),0!=(512&userinfo.removeRights)&&(t+=512),0!=(1024&userinfo.removeRights)&&(t+=1024),0!=(16&userinfo.removeRights)&&(n+=16),0!=(32768&userinfo.removeRights)&&(n+=32768),0!=(131072&userinfo.removeRights)&&(n+=131072),0!=(64&userinfo.removeRights)&&(n+=64),0!=(262144&userinfo.removeRights)&&(n+=262144),e=4294967295!=e?(e|t)&4294967295-n:((e=2015471)|t)&4294967295-n),e}function GetMeshRights(e,t){if(null==e)return 0;if(null==t&&(t=userinfo._id),null==(e="string"==typeof e?meshes[e]:e)||null==e.links)return 0;if(serverinfo.manageAllDeviceGroups&&t==userinfo._id)return removeUserRights(4294967295,t);var n=0,o=e.links[t];if(null!=o){if(4294967295==o.rights)return removeUserRights(4294967295,t);n=o.rights}var i=null;if(t==userinfo._id?i=userinfo:null!=users&&(i=users[t]),null!=i)for(var a in i.links)if(a.startsWith("ugrp/")&&null!=(o=e.links[a])){if(4294967295==o.rights)return removeUserRights(4294967295,t);n|=o.rights}return removeUserRights(n,t)}function IsMeshViewable(e,t){if(null!=e&&(null==t&&(t=userinfo._id),null!=(e="string"==typeof e?meshes[e]:e))&&null!=e.links){if(null!=e.links[t])return!0;if(serverinfo.manageAllDeviceGroups&&t==userinfo._id)return!0;var n=null;if(t==userinfo._id?n=userinfo:null!=users&&(n=users[t]),null!=n)for(var o in n.links)if(o.startsWith("ugrp/")&&null!=e.links[o])return!0}return!1}function GetNodeRights(e,t){if(null==e)return 0;if(null==t&&(t=userinfo._id),"string"==typeof e&&null==(e=getNodeFromId(e)))return 0;var n=GetMeshRights(e.meshid,t);if(4294967295!=n&&(null!=e.links&&null!=e.links[t]&&(n|=e.links[t].rights),null!=e.links)&&null!=userinfo.links)for(var o in e.links)o.startsWith("ugrp/")&&null!=userinfo.links[o]&&null!=e.links[o].rights&&(n|=e.links[o].rights);return removeUserRights(n,t)}function IsNodeViewable(e,t){if(null!=e&&(null==t&&(t=userinfo._id),"string"!=typeof e||null!=(e=getNodeFromId(e)))){if(IsMeshViewable(e.meshid,t))return!0;if(null!=e.links&&null!=e.links[t])return!0;if(null!=e.links&&null!=userinfo.links)for(var n in e.links)if(n.startsWith("ugrp/")&&null!=userinfo.links[n]&&null!=e.links[n].rights)return!0}return!1}if("undefined"==typeof TextEncoder){window.TextEncoder=function(){},TextEncoder.prototype.encode=function(e){for(var t,n=e.length,o=-1,i="undefined"==typeof Uint8Array?new Array(1.5*n):new Uint8Array(3*n),a=0,s=0;s!==n;){if(a=e.charCodeAt(s),s+=1,55296<=a&&a<=56319){if(s===n){i[o+=1]=239,i[o+=1]=191,i[o+=1]=189;break}if(!(56320<=(t=e.charCodeAt(s))&&t<=57343)){i[o+=1]=239,i[o+=1]=191,i[o+=1]=189;continue}if(s+=1,65535<(a=1024*(a-55296)+t-56320+65536)){i[o+=1]=240|a>>>18,i[o+=1]=128|a>>>12&63,i[o+=1]=128|a>>>6&63,i[o+=1]=128|63&a;continue}}a<=127?i[o+=1]=0|a:(a<=2047?i[o+=1]=192|a>>>6:(i[o+=1]=224|a>>>12,i[o+=1]=128|a>>>6&63),i[o+=1]=128|63&a)}return"undefined"!=typeof Uint8Array?i.subarray(0,o+1):(i.length=o+1,i)},TextEncoder.prototype.toString=function(){return"[object TextEncoder]"};try{Object.defineProperty(TextEncoder.prototype,"encoding",{get:function(){if(TextEncoder.prototype.isPrototypeOf(this))return"utf-8";throw TypeError("Illegal invocation")}})}catch(e){TextEncoder.prototype.encoding="utf-8"}"undefined"!=typeof Symbol&&(TextEncoder.prototype[Symbol.toStringTag]="TextEncoder")}function urlBase64ToUint8Array(e){for(var e=(e+"=".repeat((4-e.length%4)%4)).replace(/-/g,"+").replace(/_/g,"/"),t=atob(e),n=new Uint8Array(t.length),o=0;o<t.length;++o)n[o]=t.charCodeAt(o);return n}function joinPaths(){var e,t=[];for(e in arguments){var n=arguments[e];if(null!=n&&""!=n){for(;n.endsWith("/")||n.endsWith("\\");)n=n.substring(0,n.length-1);for(;n.startsWith("/")||n.startsWith("\\");)n=n.substring(1);t.push(n)}}return t.join("/")}function putstore(e,t){try{if("undefined"==typeof localStorage||localStorage.getItem(e)==t)return;null==t?localStorage.removeItem(e):localStorage.setItem(e,t)}catch(e){}if("_"!=e[0]){var n={};try{for(var o=0,i=localStorage.length;o<i;++o){var a=localStorage.key(o);"_"!=a[0]&&(n[a]=localStorage.getItem(a),"desktopsettings"!=a)&&"stars"!=a&&"deskKeyShortcuts"!=a&&"deskStrings"!=a&&"cmdopt"!=a&&"string"==typeof n[a]&&64<n[a].length&&delete n[a]}}catch(e){}meshserver.send({action:"userWebState",state:JSON.stringify(n)})}}function stringToUtf8Blob(e){var t=(new TextEncoder).encode(e),n=new Uint8Array(3+t.length);n[0]=239,n[1]=187,n[2]=191;for(var o=0;o<t.length;o++)n[o+3]=t[o];return new Blob([n],{type:"application/octet-stream"})}function stringToUtf8BlobNoHeader(e){return new Blob([(new TextEncoder).encode(e)],{type:"application/octet-stream"})}function multiTranslate(e){var t=e.indexOf("]|");return e.substring(t+2)}function getLang(){return null!=navigator.languages?navigator.languages[0]:navigator.language}function getNodeAmtVersion(e){return null==e||null==e.intelamt||"string"!=typeof e.intelamt.ver||(e=e.intelamt.ver.split(".")).length<2?0:parseInt(e[0])+parseInt(e[1])/100}function getstore(e,t){try{var n;return"undefined"==typeof localStorage?t:null==(n=localStorage.getItem(e))?t:n}catch(e){return t}}function addLink(e,t){return"<span tabindex=0 style=cursor:pointer;text-decoration:none onclick='"+t+"' onkeypress=\"if (event.key=='Enter') {"+t+'} ">'+e+" <img class=hoverButton src=images/link5.png></span>"}function addLinkConditional(e,t,n){return n?addLink(e,t):e}function addKeyLink(e,t){return"<span tabindex=0 style=cursor:pointer;text-decoration:none onclick="+t+" onkeypress=\"if (event.key=='Enter') { "+t+' } ">'+e+" <img class=hoverButton src=images/key16.png></span>"}function addKeyLinkConditional(e,t,n){return n?"<span title='"+t+"'>"+e+" <img class=hoverButton src=images/key16.png></span>":e}function haltEvent(e){return e.preventDefault&&e.preventDefault(),e.stopPropagation&&e.stopPropagation(),!1}function addOption(e,t,n){var o=document.createElement("option");o.text=t,o.value=n,Q(e).add(o)}function passwordcheck(e){return 7<e.length&&/\d/.test(e)&&/[a-z]/.test(e)&&/[A-Z]/.test(e)&&/\W/.test(e)}function methodcheck(e){return!(!e||null==e||!e.Body||"SUCCESS"==e.Body.ReturnValueStr||(messagebox("Chyba volání",e.Header.Method+": "+e.Body.ReturnValueStr.replace("_"," ")),0))}function TableStart(){return"<table cellpadding=0 cellspacing=0 style=width:100%;border-radius:8px><tr><td width=200px><p><td>"}function TableStart2(){return"<table cellpadding=0 cellspacing=0 style=width:100%;border-radius:8px><tr><td><p><td>"}function TableEntry(e,t){return"<tr><td><p>"+e+"<td>"+t}function FullTable(e,t){var n=TableStart();for(i in e)i&&e[i]&&(n+=TableEntry(i,e[i]));return n+TableEnd(t)}function TableEnd(e){return"<tr><td colspan=2><p>"+(e||"")+"</table>"}function AddButton(e,t){return'<input type=button value="'+e+'" onclick="'+t+'" style=margin:4px>'}function AddButton2(e,t){return'<input type=button value="'+e+'" onclick="'+t+'">'}function AddRefreshButton(e){return'<input type=button name=refreshbtn value=Refresh onclick="refreshButtons(false);'+e+'" style=margin:4px '+(0==refreshButtonsState?"disabled":"")+">"}function MoreStart(){return"<div id=idx_dlgMoreButtons3 style=display:none><hr>"}function MoreEnd(){return"</div>"}function MoreToggle(e){QV("idx_dlgMoreButtons1",!e),QV("idx_dlgMoreButtons2",e),QV("idx_dlgMoreButtons3",e)}function getSelectedOptions(e){for(var t,n=[],o=0,i=e.options.length;o<i;o++)(t=e.options[o]).selected&&n.push(t.value);return n}function getInstance(e,t){for(var n in e)if(e[n].InstanceID==t)return e[n];return null}function getItem(e,t,n){for(var o in e)if(e[o][t]==n)return e[o];return null}function guidToStr(e){return e.substring(6,8)+e.substring(4,6)+e.substring(2,4)+e.substring(0,2)+"-"+e.substring(10,12)+e.substring(8,10)+"-"+e.substring(14,16)+e.substring(12,14)+"-"+e.substring(16,20)+"-"+e.substring(20)}function getUrlVars(){for(var e,t=[],n=window.location.href.slice(window.location.href.indexOf("?")+1).split("&"),o=0;o<n.length;o++)0<(e=n[o].indexOf("="))&&(t[n[o].substring(0,e)]=n[o].substring(e+1,n[o].length));return t}function addHtmlValue(e,t){return"<table><td style=width:120px>"+e+"<td><b>"+t+"</b></table>"}function addHtmlValue2(e,t){return"<div><div style=display:inline-block;float:right>"+t+"</div><div style=display:inline-block>"+e+"</div></div>"}function addHtmlValue3(e,t){return"<div><b>"+e+"</b></div><div style=margin-left:16px>"+t+"</div>"}function addHtmlValue4(e,t){return"<table style=width:100%><td style=width:120px>"+e+"<td style=text-align:right><b>"+t+"</b></table>"}function addHtmlValue5(e,t){return"<div style=padding:4px><div style=display:inline-block;float:right><b>"+t+"</b></div><div style=display:inline-block>"+e+"</div></div>"}function focusTextBox(e){setTimeout(function(){Q(e).selectionStart=Q(e).selectionEnd=65535,Q(e).focus()},0)}function validateEmail(e){return/^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/.test(e)}function isPrivateIP(e){return e.startsWith("10.")||e.startsWith("172.16.")||e.startsWith("192.168.")}function u2fSupported(){return window.u2f&&(0<navigator.userAgent.indexOf("Chrome/")||0<navigator.userAgent.indexOf("Firefox/")||0<navigator.userAgent.indexOf("Opera/")||0<navigator.userAgent.indexOf("Safari/"))}function findOne(t,e){return null!=t&&null!=e&&e.some(function(e){return 0<=t.indexOf(e)})}function copyTextToClip(e){var t,n=document.createElement("DIV");n.textContent=e,document.body.appendChild(n),e=n,document.selection?((t=document.body.createTextRange()).moveToElementText(e),t.select()):window.getSelection&&((t=document.createRange()).selectNode(e),window.getSelection().removeAllRanges(),window.getSelection().addRange(t)),document.execCommand("copy"),n.remove()}function copyTextToClip2(e){var t,n=document.createElement("DIV");n.textContent=decodeURIComponent(e),document.body.appendChild(n),e=n,document.selection?((t=document.body.createTextRange()).moveToElementText(e),t.select()):window.getSelection&&((t=document.createRange()).selectNode(e),window.getSelection().removeAllRanges(),window.getSelection().addRange(t)),document.execCommand("copy"),n.remove()}function capitalizeFirstLetter(e){return e.charAt(0).toUpperCase()+e.slice(1)}function printDate(e){return e.toLocaleDateString(args.locale)}function printTime(e){return e.toLocaleTimeString(args.locale)}function printDateTime(e){return e.toLocaleString(args.locale)}function printFlexDateTime(e){return(printDate(new Date)==printDate(e)?printTime:printDateTime)(e)}function addDetailItem(e,t,n){return"<table style=width:100%><td>"+nobreak(e)+"<td style=text-align:right>"+t+"</table>"}function format(e){var n=Array.prototype.slice.call(arguments,1);return e.replace(/{(\d+)}/g,function(e,t){return void 0!==n[t]?n[t]:e})}function addTextLink(e,t,n){var o=t.toLowerCase().indexOf(e.toLowerCase());return-1==o?t:t.substring(0,o)+'<a href="'+n+'">'+e+"</a>"+t.substring(o+e.length)}function getOrderedList(e,n){var t,o=[];for(t in e)o.push(e[t]);return o.sort(function(e,t){e=e[n].toLowerCase(),t=t[n].toLowerCase();return t<e?1:e<t?-1:0}),o}function capitalizeFirstLetter(e){return e.charAt(0).toUpperCase()+e.slice(1)}function nobreak(e){return e.split(" ").join("&nbsp;")}function pad2(e){e="00"+e;return e.substr(e.length-2)}function encodeURIComponentEx(e){return encodeURIComponent(e).replace(/'/g,"%27")}function getUserName(e){var t=e.split("/"),n=t[0]+"/"+t[1]+"/"+t[2],o="";if(4==t.length&&t[3].startsWith("guest:")&&(o=" - "+decode_utf8(atob(t[3].substring(6)))),users&&null!=users[n])return null!=users[n].realname?users[n].realname+o:users[n].name+o;if(currentNode&&currentNode.links&&currentNode.links[e]&&null!=currentNode.links[e].name)return currentNode.links[e].name+o;if(e==userinfo._id)return userinfo.name+o;if(nodes)for(var i in nodes)if(nodes[i].links)for(var a in nodes[i].links)if(nodes[i].links[a].name&&a==e)return nodes[i].links[a].name+o;return t[2]+o}function round(e,t){t=Math.pow(10,t||0);return Math.round(e*t)/t}function safeNewWindow(e,t){e=window.open(e,t,"noopener,noreferrer");e&&(e.opener=null)}function isWindowsNode(e){return 2==e.mtype&&null!=e.agent&&null!=e.agent.id&&0<=[1,2,3,4,21,22,34,42,43].indexOf(e.agent.id)}function isMacNode(e){return 2==e.mtype&&null!=e.agent&&null!=e.agent.id&&0<=[11,16,29].indexOf(e.agent.id)}function downloadFile(e,t,n){var o=document.createElement("a");o.setAttribute("href",e),o.setAttribute("rel","noreferrer noopener"),o.setAttribute("target","fileDownloadFrame"),o.setAttribute("download",decodeURIComponent(t||"")),document.body.appendChild(o),o.click(),document.body.removeChild(o),n&&setDialogMode(0)}function dialogBoxDrag(){var t=Q("dialog"),n=0,o=0,i=0,a=0;function s(e){(e=e||window.event).preventDefault(),n=i-e.clientX,o=a-e.clientY,i=e.clientX,a=e.clientY,t.style.top=t.offsetTop-o+"px",t.style.left=t.offsetLeft-n+"px"}function r(){document.onmouseup=null,document.onmousemove=null}Q("dialogHeader").onmousedown=function(e){(e=e||window.event).preventDefault(),i=e.clientX,a=e.clientY,document.onmouseup=r,document.onmousemove=s}}window.addEventListener("beforeunload",function(e){(null!=desktop&&11==xxcurrentView||null!=terminal&&12==xxcurrentView)&&(e.preventDefault(),e.returnValue="")})</script>