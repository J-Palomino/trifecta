<!doctypehtml><html lang=cs dir=ltr xmlns=http://www.w3.org/1999/xhtml><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta content="text/html; charset=utf-8"http-equiv=Content-Type><meta name=viewport content="user-scalable=1,initial-scale=1,minimum-scale=1,maximum-scale=1"><meta name=format-detection content="telephone=no"><meta name=robots content=noindex,nofollow><link rel=manifest href={{{domainurl}}}manifest.json><link rel="shortcut icon"href={{{domainurl}}}favicon.ico><link rel=icon type=image/png sizes=16x16 href={{{domainurl}}}favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href={{{domainurl}}}favicon-32x32.png><link rel=apple-touch-icon href=/favicon-303x303.png><link type=text/css href=styles/xterm.css media=screen rel=stylesheet title=CSS><meta name=apple-mobile-web-app-capable content=yes><meta name=apple-mobile-web-app-status-bar-style content=#ffffff><meta name=apple-mobile-web-app-title content={{{title}}}><script src=scripts/common-0.0.1{{{min}}}.js></script><script src=scripts/meshcentral{{{min}}}.js></script><script src=scripts/agent-redir-ws-0.1.1{{{min}}}.js></script><script src=scripts/agent-desktop-0.0.2{{{min}}}.js></script><script src=scripts/amt-0.2.0{{{min}}}.js></script><script src=scripts/amt-redir-ws-0.1.0{{{min}}}.js></script><script src=scripts/amt-desktop-0.0.2{{{min}}}.js></script><script src=scripts/xterm{{{min}}}.js></script><script src=scripts/xterm-addon-fit{{{min}}}.js></script><script src=scripts/zlib{{{min}}}.js></script><script src=scripts/zlib-inflate{{{min}}}.js></script><script src=scripts/zlib-adler32{{{min}}}.js></script><script src=scripts/zlib-crc32{{{min}}}.js></script><script keeplink=1 src=scripts/filesaver.min.js></script><meta name=msapplication-TileColor content=#00aba9><meta name=theme-color content=#ffffff><title>{{{title}}}</title><style>body{background-color:#fff}.night body{background-color:#000}#MxMESH{color:#000}.night #MxMESH{color:#d3d3d3}.textOverGray{color:#000}#dialog{z-index:1000;background-color:#eee;box-shadow:0 0 15px #666;font-family:Arial,Helvetica,sans-serif;border-radius:5px;position:fixed;top:90px;width:300px}.night #dialog{color:#000;background-color:#aaa}:focus{outline:0}a{color:#036;text-decoration:underline}.night a{color:#99f}#footer a{color:#fff;text-decoration:underline}#footer a:hover{text-decoration:none}.night #footer{color:gray}.i1{background:url(../images/icons50.png) 0 0;background-image:image-set(url(../images/icons50.png) 1x,url(../images/icons100.png) 2x);height:50px;width:50px;border:none}.i2{background:url(../images/icons50.png) -50px 0;background-image:image-set(url(../images/icons50.png) 1x,url(../images/icons100.png) 2x);height:50px;width:50px;border:none}.i3{background:url(../images/icons50.png) -100px 0;background-image:image-set(url(../images/icons50.png) 1x,url(../images/icons100.png) 2x);height:50px;width:50px;border:none}.i4{background:url(../images/icons50.png) -150px 0;background-image:image-set(url(../images/icons50.png) 1x,url(../images/icons100.png) 2x);height:50px;width:50px;border:none}.i5{background:url(../images/icons50.png) -200px 0;background-image:image-set(url(../images/icons50.png) 1x,url(../images/icons100.png) 2x);height:50px;width:50px;border:none}.i6{background:url(../images/icons50.png) -250px 0;background-image:image-set(url(../images/icons50.png) 1x,url(../images/icons100.png) 2x);height:50px;width:50px;border:none}.i7{background:url(../images/icons50.png) -300px 0;background-image:image-set(url(../images/icons50.png) 1x,url(../images/icons100.png) 2x);height:50px;width:50px;border:none}.i8{background:url(../images/icons50.png) -350px 0;background-image:image-set(url(../images/icons50.png) 1x,url(../images/icons100.png) 2x);height:50px;width:50px;border:none}.m0{background:url(../images/images16.png) -32px 0;height:16px;width:16px;border:none;float:left}.m1{background:url(../images/images16.png) -16px 0;height:16px;width:16px;border:none;float:left}.m2{background:url(../images/images16.png) -96px 0;height:16px;width:16px;border:none;float:left}.m3{background:url(../images/images16.png) -112px 0;height:16px;width:16px;border:none;float:left}.m4{background:url(../images/images16.png) -128px 0;height:16px;width:16px;border:none;float:left}.NotifyIconSmall1{width:24px;height:24px;background:url(../images/notify24.png) 0 0;background-image:image-set(url(../images/notify24.png) 1x,url(../images/notify48.png) 2x)}.NotifyIconSmall2{width:24px;height:24px;background:url(../images/notify24.png) -24px 0;background-image:image-set(url(../images/notify24.png) 1x,url(../images/notify48.png) 2x)}.NotifyIconSmall3{width:24px;height:24px;background:url(../images/notify24.png) -48px 0;background-image:image-set(url(../images/notify24.png) 1x,url(../images/notify48.png) 2x)}.NotifyIconSmall4{width:24px;height:24px;background:url(../images/notify24.png) -72px 0;background-image:image-set(url(../images/notify24.png) 1x,url(../images/notify48.png) 2x)}.NotifyIconSmall5{width:24px;height:24px;background:url(../images/notify24.png) -96px 0;background-image:image-set(url(../images/notify24.png) 1x,url(../images/notify48.png) 2x)}.NotifyIconSmall6{width:24px;height:24px;background:url(../images/notify24.png) -120px 0;background-image:image-set(url(../images/notify24.png) 1x,url(../images/notify48.png) 2x)}.NotifyIconSmall7{width:24px;height:24px;background:url(../images/notify24.png) -144px 0;background-image:image-set(url(../images/notify24.png) 1x,url(../images/notify48.png) 2x)}.NotifyIconSmall8{width:24px;height:24px;background:url(../images/notify24.png) -168px 0;background-image:image-set(url(../images/notify24.png) 1x,url(../images/notify48.png) 2x)}.NotifyIconSmall9{width:24px;height:24px;background:url(../images/notify24.png) -192px 0;background-image:image-set(url(../images/notify24.png) 1x,url(../images/notify48.png) 2x)}.gray{filter:gray;-webkit-filter:grayscale(100%) opacity(60%)}.DevSt{padding-left:5px;border-bottom-style:solid;border-bottom-width:1px;border-bottom-color:#ddd}.noselect{-webkit-touch-callout:none;-webkit-user-select:none;-khtml-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}.fileIcon1{background:url(data:image/gif;base64,R0lGODlhEAAQAJEDAPb49Y2Sj9LT2f///yH5BAEAAAMALAAAAAAQABAAAAImnI+py+1vhJwyUYAzHTL4D3qdlJWaIFJqmKod607sDKIiDUP63hQAOw==);height:16px;width:16px;cursor:pointer;border:none;float:left;margin-top:1px}.fileIcon2{background:url(data:image/gif;base64,R0lGODlhEAAQAJEDAM2xV/Xur+XPgP///yH5BAEAAAMALAAAAAAQABAAAAJD3ISZIGHWUGihznesYDYATFVM+D2hJ4lgN1olxALAtAlmPCJvuMmJd6PJckDYwicrHhTD5o7plJmg0Uc0asNMkphHAQA7);height:16px;width:16px;cursor:pointer;border:none;float:left;margin-top:1px}.fileIcon3{background:url(data:image/gif;base64,R0lGODlhEAAQAJEDAPb19IGBgbq6uv///yH5BAEAAAMALAAAAAAQABAAAAIy3ISpxgcPH2ouQgFEw1YmxnUXKEaaEZZnVWZk66JwzKpvuwZzwOgwb/C1gIOA8Yg8DgoAOw==);height:16px;width:16px;cursor:pointer;border:none;float:left;margin-top:1px}.fileIcon4{background:url(../images/meshicon16.png);height:16px;width:16px;cursor:pointer;border:none;float:left;margin-top:1px}.filelist{-moz-user-select:none;-khtml-user-select:none;-webkit-user-select:none;-o-user-select:none;cursor:default;-khtml-user-drag:element;clear:both}.deviceNotifyDot{position:absolute;right:10px;top:0;height:16px}.deviceNotifyDotSub{text-align:center;color:#fff;width:16px;background-color:#00f;padding:2px;border-radius:10px;box-shadow:2px 2px 10px #000;cursor:pointer;margin-left:3px;float:left}.deviceNotifyDotSub:hover{background-color:#44f}.deviceNotifySmallDot{position:absolute;right:10px;top:0;height:10px}.deviceNotifySmallDotSub{text-align:center;color:#fff;width:10px;padding:2px;background-color:#00f;border-radius:10px;box-shadow:2px 2px 10px #000;cursor:pointer;margin-left:2px;float:left}.deviceNotifySmallDotSub:hover{background-color:#44f}.deviceNotifyLargeDot{position:absolute;right:10px;top:10px;height:40px}.deviceNotifyLargeDotSub{text-align:center;width:35px;height:35px;color:#fff;padding:2px;background-color:#00f;border-radius:20px;box-shadow:2px 2px 10px #000;cursor:pointer;margin-left:4px;font-size:30px;float:left}.deviceNotifyLargeDotSub:hover{background-color:#44f}.style10{background-color:#c9c9c9;color:#000}.night .style10{background-color:#888}.deviceBatteryLarge{position:absolute;right:10px;top:0;width:28px;height:48px;border:none;box-shadow:none}.deviceBatteryLarge1{background:url(../images/batteries48.png) 0 0}.deviceBatteryLarge2{background:url(../images/batteries48.png) -28px 0}.deviceBatteryLarge3{background:url(../images/batteries48.png) -56px 0}.deviceBatteryLarge4{background:url(../images/batteries48.png) -84px 0}.deviceBatteryLarge5{background:url(../images/batteries48.png) -112px 0}.deviceBatteryLarge6{background:url(../images/batteries48.png) -140px 0}.deviceBatteryLarge7{background:url(../images/batteries48.png) -168px 0}.deviceBatteryLarge8{background:url(../images/batteries48.png) -196px 0}.deviceBatteryLarge9{background:url(../images/batteries48.png) -224px 0}.deviceBatteryLarge10{background:url(../images/batteries48.png) -252px 0}.deviceBatteryLarge11{background:url(../images/batteries48.png) -280px 0}.deviceBatterySmall{position:absolute;left:6px;top:22px;width:14px;height:24px;border:none;box-shadow:none}.deviceBatterySmall1{background:url(../images/batteries24.png) 0 0}.deviceBatterySmall2{background:url(../images/batteries24.png) -14px 0}.deviceBatterySmall3{background:url(../images/batteries24.png) -28px 0}.deviceBatterySmall4{background:url(../images/batteries24.png) -42px 0}.deviceBatterySmall5{background:url(../images/batteries24.png) -56px 0}.deviceBatterySmall6{background:url(../images/batteries24.png) -70px 0}.deviceBatterySmall7{background:url(../images/batteries24.png) -84px 0}.deviceBatterySmall8{background:url(../images/batteries24.png) -98px 0}.deviceBatterySmall9{background:url(../images/batteries24.png) -112px 0}.deviceBatterySmall10{background:url(../images/batteries24.png) -126px 0}.deviceBatterySmall11{background:url(../images/batteries24.png) -140px 0}.meshList{width:auto;height:40px;background-color:#d3d3d3;margin-top:5px;margin-bottom:5px;margin-left:60px;padding-top:5px;padding-bottom:5px;border-radius:8px 0 0 8px}.night .meshList{background-color:gray}.devList1{height:50px;cursor:pointer;position:relative;margin-top:5px;margin-bottom:5px}.devList2{float:left;margin-left:4px}.devList3{width:auto;height:40px;background-color:#d3d3d3;margin-left:60px;padding-top:5px;padding-bottom:5px;border-radius:8px 0 0 8px}.night .devList3{background-color:gray}.devList4{padding-left:12px;padding-top:2px;color:#000}.devList5{padding-left:12px;padding-top:3px;color:#444}.night .devList5{color:#000}.deskButton{box-shadow:0 0 10px #000;border-radius:20px;position:absolute;right:10px;top:10px;cursor:pointer;background-color:#aaa;z-index:1000}.menuButton{box-shadow:0 0 10px #000;border-radius:10px;display:inline-block;width:120px;background-color:#aaa;text-align:center;padding:8px;cursor:pointer;margin:10px;z-index:1000}#notificationCount{min-width:28px;font-size:20px;background-color:orange;text-align:center;cursor:pointer;color:#000}.notifiyBox{font-size:16px;position:absolute;z-index:1000;top:60px;right:76px;width:300px;text-align:left;background-color:#f0eccd;border:4px solid #666;-webkit-border-radius:10px;-moz-border-radius:10px;border-radius:10px;-webkit-box-shadow:2px 2px 4px #888;-moz-box-shadow:2px 2px 4px #888;box-shadow:2px 2px 4px #888;max-height:200px}.night .notifiyBox{color:#000}.notifiyBox:before{content:' ';position:absolute;width:0;height:0;right:5px;top:-30px;border:15px solid;border-color:transparent #666 #666 transparent}.notifiyBox:after{content:' ';position:absolute;width:0;height:0;right:7px;top:-24px;border:12px solid;border-color:transparent #f0eccd #f0eccd transparent}#p15statetext{padding:4px;height:15px}#p15agentConsole{background:#000;margin:0;padding:0;color:#d3d3d3;width:100%;position:relative}#p15coreName{padding:4px;display:inline-block}#p15agentConsoleText{position:absolute;margin:0;padding:0;top:0;bottom:0;left:0;right:0;overflow-y:scroll;overflow-x:auto}.areaHead{padding-top:2px;padding-bottom:2px;background:silver}.night .areaHead{color:#ccc;background:#333}.areaFoot{padding-top:2px;padding-bottom:2px;background:silver}.night .areaFoot{color:#ccc;background:#333}.toright2{float:right;text-align:right}#consoleTable{width:100%;height:100%;padding:0;margin-top:0}.night #consoleTable{color:#000}.menucurve{background-color:#fff;width:10px;height:10px;border-radius:10px 0 0 0;border-right:1px solid #fff;border-bottom:1px solid #fff}.night .menucurve{background-color:#000;border-right:1px solid #000;border-bottom:1px solid #000}#termTable{width:100%;padding:0;margin-top:0}.fulldesk #termTable{position:absolute;top:0;bottom:0;left:0;right:0}#termarea3x{background:#000;text-align:center;height:400px;position:relative}.viewSelector10{margin-left:2px;margin-top:2px;background:url(../images/views.png) -476px 0;height:28px;width:28px}.viewSelector11{margin-left:2px;margin-top:2px;background:url(../images/views.png) -504px 0;height:28px;width:28px}.tagSpan{background-color:#d3d3d3;padding:3px;border-radius:5px}.night .tagSpan{color:#000}#d2serveraction,#d3serveraction{width:100%;background-color:#d3d9d6;text-align:left;padding:3px}#d2serverfiles,#d3serverfiles{width:100%;height:150px;background-color:#fff;padding:2px;border:1px solid gray;overflow-y:scroll}</style><body id=body onload='"undefined"!=typeof startup&&startup()'style="overflow-y:hidden;margin:0;padding:0;border:0;font-size:13px;font-family:\'Trebuchet MS\',Arial,Helvetica,sans-serif"><div id=container><div id=notifiyBox class=notifiyBox style=display:none></div><div id=mastheadx></div><div id=masthead style="background:url(logo.png) 0 0;background-size:341px 50px;background-color:#036;background-repeat:no-repeat;height:50px;width:100%;overflow:hidden"><div style="width:calc(100% - 50px);overflow:hidden"><div style=float:left;height:66px;color:#c8c8c8;padding-left:10px;padding-top:6px onclick=go(2)><strong><font style="font-size:36px;font-family:Arial,Helvetica,sans-serif;text-shadow:1px 1px 2px #000">{{{title1}}}</font></strong></div><div style=float:left;height:66px;color:#c8c8c8;padding-left:5px;padding-top:10px><strong><font style="font-size:12px;font-family:Arial,Helvetica,sans-serif;text-shadow:1px 1px 2px #000">{{{title2}}}</font></strong></div></div><div id=devViewPageState class=noselect style=position:absolute;right:160px;top:10px;height:30px;line-height:30px;color:#c8c8c8;font-size:16px;display:none></div><img id=devViewPageButton2 class=noselect style=position:absolute;right:130px;top:10px;cursor:pointer;display:none onclick=onDeviceViewPageChange(2) src=/images/left-30.png width=20 height=30> <img id=devViewPageButton3 class=noselect style=position:absolute;right:100px;top:10px;cursor:pointer;display:none onclick=onDeviceViewPageChange(3) src=/images/right-30.png width=20 height=30><div id=notificationCount onclick=clickNotificationIcon() class=unselectable style=position:absolute;right:50px;top:0;font-size:28px;width:50px;height:50px;cursor:pointer;display:none title="Klikněte pro zobrazení aktuálních upozornění"><div id=notificationCount2 style=padding-top:8px>0</div></div><img id=topMenuIcon class=noselect style=position:absolute;right:0;top:10px;color:#c8c8c8;font-size:44px;margin-right:8px;cursor:pointer;display:none onclick=topMenu() src=/images/3bars-30.png width=30 height=30></div><div id=page_content style=position:absolute;bottom:32px;top:50px;width:100%><div id=column_l style=width:100%;padding:0;position:absolute;bottom:0;top:0><div id=p0 style=display:none;width:100%;height:100%><div style=display:flex;align-items:center;width:100%;height:100%><div id=p0message style=text-align:center;width:100%><span id=p0span>Server odpojen</span>,<href onclick=reload() style=cursor:pointer><u>klikněte pro opětovné připojení</u></href>.</div></div></div><div id=p1 style=display:none;width:100%;height:100%><div style=display:flex;align-items:center;width:100%;height:100%><div id=p1message style=text-align:center;width:100%></div></div></div><div id=p2 style=display:none;position:absolute;top:0;left:0;right:0;bottom:0><div id=xdevices style=position:absolute;overflow-y:auto;top:0;left:0;right:0;bottom:34px onscroll=onDevicesScroll() ontouchstart=onDeviceTouch(!0) ontouchend=onDeviceTouch(!1)></div><div id=xdevicesBar style=position:absolute;overflow-y:auto;height:34px;left:0;right:0;bottom:0;background-color:#aaa;color:#000><div style=margin:4px><span style=width:20px;display:inline-block;text-align:center;cursor:pointer;font-size:16px onclick=clearSearchInput()><b>X</b></span> <input id=SearchInput autocomplete=off type=search placeholder=Filtr onchange=onDeviceSearchChanged(event) onclick=onDeviceSearchChanged(event) onkeyup=onDeviceSearchChanged(event) style=padding:2px;margin:0;height:20px;background-color:#fff>&nbsp; <label class=noselect><input type=checkbox id=RealNameCheckBox onclick=onRealNameCheckBox()>Název počítače</label> <label class=noselect><input type=checkbox id=OnlineCheckBox onclick=onOnlineCheckBox(event)>Online</label></div></div></div><div id=p3 style=display:none;position:absolute;bottom:0;top:0;width:100%><table cellspacing=0 style=margin:0;padding:0;border-spacing:0;border:0><tr style=padding:0><td style=padding:0;color:#c8c8c8;text-align:center;cursor:pointer width=60px valign=top onclick=goBack()><div style=padding:0;background-color:#036;width:10px;height:10px;float:right;border:0><div class=menucurve></div></div><div style="padding:0;font-size:25px;background-color:#036;width:50px;border-radius:0 0 10px 0;height:36px">◀</div><td><div style=margin-left:5px><strong style=font-size:large><span id=p3userName></span></strong><br></div></table><div id=p3info style=overflow-y:auto;position:absolute;top:55px;bottom:0;width:100%><img id=p2AccountImage alt=""loading=lazy width=128 height=128 onclick=account_manageImage(0) src=images/user-256.png style="position:absolute;right:8px;top:7px;border-radius:8px;box-shadow:0 0 7px #000"><div style=margin-left:8px><div id=p3AccountActions><div id=p2AccountSecurity style=display:none><p><strong>Nastavení zabezpečení</strong><div style=margin-left:9px;margin-bottom:8px><div id=managePhoneNumber1 style=margin-top:5px;display:none><a onclick=account_managePhone() style=cursor:pointer>Spravovat telefonní číslo</a> <span id=authPhoneNumberCheck><strong>✓</strong></span></div><div id=manageEmail2FA style=margin-top:5px;display:none><a onclick=account_manageAuthEmail() style=cursor:pointer>Správa ověřování e-mailů</a> <span id=authEmailSetupCheck><strong>✓</strong></span></div><div style=margin-top:5px><a href=# onclick=account_showLocalizationSettings()>Nastavení lokalizace</a></div><div id=manageAuthApp style=margin-top:5px;display:none><a onclick=account_manageAuthApp() style=cursor:pointer>Spravovat aplikaci pro dvoufázové ověření</a> <span id=authAppSetupCheck><strong>✓</strong></span></div><div id=manageOtp style=margin-top:5px;display:none><a onclick=account_manageOtp(0) style=cursor:pointer>Spravovat záložní kódy</a> <span id=authCodesSetupCheck><strong>✓</strong></span></div></div></div><div id=p2AccountActions style=display:none><p><strong>Akce účtu</strong><div style=margin-left:9px;margin-bottom:8px><div style=margin-top:5px><span id=viewPreviousLogins><a onclick="return account_viewPreviousLogins()"style=cursor:pointer>Zobrazit předchozí přihlášení</a></span></div><div style=margin-top:5px><span id=managePhoneNumber2 style=display:none><a onclick=account_managePhone() style=cursor:pointer>Spravovat telefonní číslo</a></span></div><div style=margin-top:5px><span id=verifyEmailId style=display:none><a onclick=account_showVerifyEmail() style=cursor:pointer>Ověřit e-mail</a></span></div><span id=p2AccountPassActions><div style=margin-top:5px><span id=changeEmailId style=display:none><a onclick=account_showChangeEmail() style=cursor:pointer>Změnit e-mailovou adresu</a></span></div><div style=margin-top:5px><a onclick=account_showChangePassword() style=cursor:pointer>Změnit heslo</a><span id=p2nextPasswordUpdateTime></span></div><div style=margin-top:5px><a onclick=account_showDeleteAccount() style=cursor:pointer>Smazat účet</a></div></span><div style=margin-top:5px id=setDarkModeLink><a onclick=toggleNightMode() style=cursor:pointer>Nastavit tmavý režim</a></div><div style=margin-top:5px><a onclick=showNotes(!1) style=cursor:pointer>Osobní poznámky</a></div></div><br style=clear:both></div></div><strong>Skupiny zařízení</strong> <span id=p3createMeshLink1>( <a onclick=account_createMesh() style=cursor:pointer><img src=images/icon-addnew.png width=12 height=12 border=0> Vytvořit</a> )</span><br><br><div id=p3meshes></div><div id=p3noMeshFound style=margin-left:9px;display:none>Žádné skupiny zařízení.<span id=p3createMeshLink2> <a onclick=account_createMesh() style=cursor:pointer><strong>Začněte zde!</strong></a></span></div><br style=clear:both></div></div></div><div id=p5 style=display:none><table cellspacing=0 style=margin:0;padding:0;border-spacing:0;border:0><tr style=padding:0><td style=padding:0;color:#c8c8c8;text-align:center;cursor:pointer width=60px valign=top onclick=goBack()><div style=padding:0;background-color:#036;width:10px;height:10px;float:right;border:0><div class=menucurve></div></div><div style="padding:0;font-size:25px;background-color:#036;width:50px;border-radius:0 0 10px 0;height:36px">◀</div><td><img src=/images/user-50.png width=50 height=50><td><div style=margin-left:5px><strong style=font-size:large>Moje soubory</strong><br></div></table><div id=p5myfiles style=position:absolute;top:55px;bottom:0;width:100%><table id=p5toolbar style=width:100%;height:78px cellpadding=0 cellspacing=0><tr><td style=width:100%;background-color:#d3d9d6;text-align:left;padding:4px valign=bottom><div style=width:100%;text-align:center><input type=button style="width:calc(100%/5 - 5px)"id=p5FolderUp disabled onclick=p5folderup() value=Nahoru> <input type=button style="width:calc(100%/5 - 5px)"id=p5SelectAllButton disabled onclick=p5selectallfile() value="Vybrat vše"onkeypress=return!1 onkeydown=return!1> <input type=button style="width:calc(100%/5 - 5px)"id=p5RenameFileButton disabled value=Přejmenovat onclick=p5renamefile() onkeypress=return!1 onkeydown=return!1> <input type=button style="width:calc(100%/5 - 5px)"id=p5DeleteFileButton disabled value=Smazat onclick=p5deletefile() onkeypress=return!1 onkeydown=return!1> <input type=button style="width:calc(100%/5 - 5px)"id=p5NewFolderButton disabled value=Složka onclick=p5createfolder() onkeypress=return!1 onkeydown=return!1></div><div style=width:100%;text-align:center><input type=button style="width:calc(100%/5 - 5px)"id=p5UploadButton disabled value=Nahrát onclick=p5uploadFile() onkeypress=return!1 onkeydown=return!1> <input type=button style="width:calc(100%/5 - 5px)"id=p5CutButton disabled value=Vyjmout onclick=p5copyFile(1) onkeypress=return!1 onkeydown=return!1> <input type=button style="width:calc(100%/5 - 5px)"id=p5CopyButton disabled value=Kopírovat onclick=p5copyFile(0) onkeypress=return!1 onkeydown=return!1> <input type=button style="width:calc(100%/5 - 5px)"id=p5PasteButton disabled value=Vložit onclick=p5pasteFile() onkeypress=return!1 onkeydown=return!1> <input type=button style="width:calc(100%/5 - 5px)"id=p5RefreshButton value="Načíst znovu"onclick=p5refreshFiles() onkeypress=return!1 onkeydown=return!1></div><tr><td style=background-color:#e4e9e7;height:28px><table style=width:100%><tr><td id=p5currentpath style=overflow:hidden;padding-left:4px;padding-top:2px;color:#000><td style=text-align:right;padding-right:4px><select id=p5sortdropdown onchange=updateFiles()><option value=1 selected>Seřadit podle názvu<option value=2>Seřadit podle velikosti<option value=3>Seřadit podle data<option value=4>Sestupně podle názvu<option value=5>Sestupně podle velikosti<option value=6>Sestupně podle data</select></table></table><div id=p5filetable style="width:100%;height:calc(100% - 102px);overflow:auto;-webkit-user-select:none"><span id=p5files></span></div><table id=p5toolbarBottom style=width:100%;height:22px;position:absolute;bottom:0;background-color:#d3d9d6 cellpadding=0 cellspacing=0><tr><td style=text-align:left;padding:3px>&nbsp;<span id=p5bottomstatus></span><td id=p5rightOfButtons style=text-align:right;padding:3px></table></div></div><div id=p10 style=display:none;position:absolute;bottom:0;top:0;width:100%;overflow:hidden><table id=p10deskTopTable cellspacing=0 style=margin:0;padding:0;border-spacing:0;border:0;position:absolute;top:0><tr style=padding:0><td style=padding:0;color:#c8c8c8;text-align:center;cursor:pointer width=60px valign=top onclick=goBack()><div style=padding:0;background-color:#036;width:10px;height:10px;float:right;border:0><div class=menucurve></div></div><div style="padding:0;font-size:25px;background-color:#036;width:50px;border-radius:0 0 10px 0;height:36px">◀</div><td><a id=MainComputerImage style=cursor:pointer onclick=p10showiconselector()></a><td><div style=margin-left:5px><strong><span id=p10deviceName></span></strong><br><span id=MainComputerState></span></div></table><div id=p10dialog style="z-index:1000;background-color:#eee;box-shadow:0 0 15px #666;font-family:Arial,Helvetica,sans-serif;border-radius:5px;position:fixed;top:30px;width:300px;left:30px;display:none"><div style="width:100%;background-color:#036;color:#fff;border-radius:5px 5px 0 0"><div style=padding:5px>Přizpůsobení klávesových zkratek</div><div style=width:100%;margin:6px></div></div><div style=margin-right:16px;margin-left:8px><div id=p10dialog2 style=margin:auto;margin:3px></div></div><div style=width:100%;padding:2px;text-align:center><input type=button value="Restore Default Keyboard Shortcuts"onclick=restoreDeskCustomizeKey()></div><div style=padding:10px;margin-bottom:20px><input type=button value=OK style=float:right;width:80px onclick=deskCustomizeKeysEx()></div></div><div id=p10general style=overflow-y:scroll;position:absolute;top:55px;bottom:0;width:100%><div class=deviceNotifyLargeDot><img id=p10deviceStar class=deviceNotifyLargeDotSub src=images/icon-star-notify-40.png width=35 height=35><div id=p10deviceMsg onclick=showDeviceMessages(null,null,event) class=deviceNotifyLargeDotSub></div><img id=p10deviceNotify onclick=showDeviceSessions() class=deviceNotifyLargeDotSub src=images/icon-relay-notify-40.png width=35 height=35> <img id=p10deviceHelp onclick=showDeviceHelpRequests(null,null,event) class=deviceNotifyLargeDotSub src=images/icon-help-notify-40.png width=35 height=35></div><div id=p10deviceBattery class="deviceBatteryLarge deviceBatteryLarge1"></div><div id=p10html style=margin-left:8px;margin-right:8px></div><div id=p10html2></div><div id=p10html3 style=margin-left:8px></div></div><img id=deskkeybutton1 src=images/mobile-desk-exit.png class=deskButton style=top:10px;display:none onclick=exitButton()> <img id=deskkeybutton3a src=images/mobile-desk-menu-open.png class=deskButton style=top:60px;display:none onclick=toggleMenu(!1)> <img id=deskkeybutton3b src=images/mobile-desk-menu-close.png class=deskButton style=top:60px;display:none onclick=toggleMenu(!0)> <img id=deskkeybutton4a src=images/mobile-desk-mouse-left.png class=deskButton style=top:110px;display:none onclick=deskChangeMouseButton(0)> <img id=deskkeybutton4b src=images/mobile-desk-mouse-right.png class=deskButton style=top:110px;display:none onclick=deskChangeMouseButton(1)> <img id=deskkeybutton5a src=images/mobile-desk-scale-out.png class=deskButton style=top:160px;display:none onclick=deskChangeFullscreenZoom()> <img id=deskkeybutton5b src=images/mobile-desk-scale-in.png class=deskButton style=top:160px;display:none onclick=deskChangeFullscreenZoom()> <img id=deskkeybutton2a src=images/mobile-desk-keyboard-open.png class=deskButton style=top:210px;display:none onclick=toggleKeyboard()> <img id=deskkeybutton2b src=images/mobile-desk-keyboard-close.png class=deskButton style=top:210px;display:none onclick=toggleKeyboard()><div style=position:absolute;top:0;left:0;z-index:200;opacity:0;width:1px;height:1px><input id=softKeyboard autocapitalize=off autocomplete=off inputmode=text spellcheck=false style=z-index:200;opacity:0;width:1px;height:1px onfocus=keyboardFocusChange() onblur=keyboardFocusChange()></div><div id=deskButtonMenu style=display:none;position:absolute;top:10px;left:10px;right:55px;bottom:10px;z-index:1000></div><div id=p10desktop style=overflow:hidden;position:absolute;top:55px;bottom:0;width:100%;display:none><div id=deskarea1 style=position:absolute;top:0;width:100%;height:32px><div style=padding-top:2px;padding-bottom:2px;background:silver;height:32px><div style=float:right;text-align:right><span id=p14power></span>&nbsp; <input type=button id=deskFullScreen value="Celá obrazovka"onclick=deskToggleFull(event) onkeypress=return!1 onkeydown=return!1 disabled style=height:28px;margin-right:3px></div><div style=margin-left:3px><input type=button id=connectbutton1 value=Připojit onclick=connectDesktop(event,3) onkeypress=return!1 onkeydown=return!1 disabled style=height:28px> <input type=button id=connectbutton1h value="HW připojení"onclick=connectDesktop(event,2) onkeypress=return!1 onkeydown=return!1 disabled style=height:28px> <input type=button id=disconnectbutton1 value=Odpojit onclick=connectDesktop(event,0) onkeypress=return!1 onkeydown=return!1 style=height:28px> <span id=deskstatus style=color:#000>Odpojeno</span></div></div></div><div id=deskarea3 style="position:absolute;top:32px;width:100%;height:calc(100% - 64px);background-color:#000;text-align:center"><div id=DeskParent style=height:100%><canvas id=Desk width=640 height=200 style=width:100%;-ms-touch-action:none;margin-left:0 oncontextmenu=return!1 onmousedown=dmousedown(event) onmouseup=dmouseup(event) onmousemove=dmousemove(event) onmousewheel=dmousewheel(event)></canvas></div><div id=p11DeskConsoleMsg style=display:none;cursor:pointer;position:absolute;left:30px;top:17px;color:#ff0;background-color:rgba(0,0,0,.6);padding:10px;border-radius:5px;text-align:left onclick=p11clearConsoleMsg()></div><div id=p11DeskSessionSelector style=display:none;position:absolute;left:30px;top:17px;right:30px;bottom:17px;overflow-y:auto></div></div><div id=deskarea4 style=position:absolute;bottom:0;width:100%;height:32px><div style=padding-top:2px;padding-bottom:2px;background:silver><div style=float:right;text-align:right;padding-right:2px><span id=DeskLockButton><img src=images/icon-lock.png onclick=deviceLockFunction() height=16 width=16 style=padding-top:5px;cursor:pointer></span><span id=DeskChatButton><img src=images/icon-chat.png onclick=deviceChat(event) height=16 width=16 style=padding-top:5px;cursor:pointer></span>&nbsp; <span id=DeskToastButton><img src=images/icon-notify.png onclick=deviceToastFunction() height=16 width=16 style=padding-top:5px;cursor:pointer></span>&nbsp; <span id=DeskOpenWebButton><img src=images/icon-url2.png onclick=deviceUrlFunction() height=16 width=16 style=padding-top:5px;cursor:pointer></span>&nbsp; <span id=DeskRunButton><img src=images/icon-play.png onclick=runDeviceCmd() height=16 width=16 style=padding-top:5px;cursor:pointer></span></div><div><input id=deskActionsBtn type=button style=margin-left:3px;height:28px onkeypress=return!1 onkeydown=return!1 value=Akce onclick=deviceActionFunction()> <input type=button value=Nastavení onkeypress=return!1 onkeydown=return!1 onclick=showDesktopSettings() style=height:28px> <input type=button onkeypress=return!1 onkeydown=return!1 value="Akce napájení…"onclick=showPowerActionDlg() style=display:none;height:28px> <input type=button id=DeskScreens value=Obrazovky onkeypress=return!1 onkeydown=return!1 onclick=deskSelectScreens() style=display:none;height:28px> <label><span id=DeskControlSpan style=display:none><input id=DeskControl type=checkbox onkeypress=return!1 onkeydown=return!1>Vstup</span></label></div></div></div></div><div id=termButtonMenu style=display:none;position:absolute;top:10px;left:10px;right:55px;bottom:10px;z-index:1000></div><div id=p10terminal style=overflow:hidden;position:absolute;top:55px;bottom:0;width:100%;display:none;background-color:#333><div id=termTable style=position:absolute;top:0;bottom:0;left:0;right:0><div id=termarea1><div class=areaHead style=line-height:24px><div class=toright2><input type=button id=termFullScreen value="Celá obrazovka"onclick=deskToggleFull(event) onkeypress=return!1 onkeydown=return!1 disabled style=height:28px;margin-right:3px><div id=terminalCustomUpperRight style=float:left;margin-right:6px></div></div><div><span id=connectbutton2span style=margin-left:3px><input type=button id=connectbutton2 value=Připojit style=height:28px onclick=connectTerminal(event,1) onkeypress=return!1 onkeydown=return!1 disabled></span><span id=connectbutton2sspan style=margin-right:4px><input type=button id=connectbutton2s value="Připojení SSH"style=height:28px onclick=connectTerminal(event,3) onkeypress=return!1 onkeydown=return!1 disabled></span><span id=disconnectbutton2span style=margin-left:3px><input type=button id=disconnectbutton2 value=Odpojit style=height:28px onclick=connectTerminal(event,0) onkeypress=return!1 onkeydown=return!1></span><span id=termstatus style=line-height:22px>Odpojeno</span><span id=termtitle></span></div></div></div><div id=termarea3 style="width:100%;height:calc(100% - 60px)"cellpadding=0 cellspacing=0><div id=termarea3x style=width:100%;height:100%><div style=width:100%;height:100%;text-align:left id=termarea3xdiv></div></div></div><div id=termarea4 style=position:relative;height:32px><div class=areaFoot><div class=toright2></div><div style=height:28px><input id=termActionsBtn style=margin-left:3px;height:28px type=button title="Provést na zařízení akci napájení"onkeypress=return!1 onkeydown=return!1 value=Akce onclick=deviceActionFunction()> <input id=ctrlcbutton style=margin-left:3px;height:28px type=button onkeypress=return!1 onkeydown=return!1 value=Ctl-C onclick='termSendKey(3,"ctrlcbutton")'> <input id=ctrlxbutton style=margin-left:3px;height:28px type=button onkeypress=return!1 onkeydown=return!1 value=Ctl-X onclick='termSendKey(24,"ctrlxbutton")'> <input id=escbutton style=margin-left:3px;height:28px type=button onkeypress=return!1 onkeydown=return!1 value=ESC onclick='termSendKey(27,"escbutton")'></div></div></div><div id=p12TermConsoleMsg style=display:none;cursor:pointer;position:absolute;left:30px;top:45px;color:#ff0;background-color:rgba(0,0,0,.6);padding:10px;border-radius:5px onclick=p12clearConsoleMsg()></div></div></div><div id=p10files style=position:absolute;top:55px;bottom:0;width:100%;display:none><table id=p13toolbar style=width:100%;height:111px cellpadding=0 cellspacing=0><tr><td style="background-color:silver;border-bottom:2px solid #000;padding:2px;line-height:24px"><div style=float:right;text-align:right><input id=filesActionsBtn type=button onkeypress=return!1 onkeydown=return!1 value=Akce onclick=deviceActionFunction() style=margin-right:2px><div id=filesCustomUpperRight style=float:left;margin-right:6px></div></div><div style=margin-left:2px><input id=p13AutoConnect value="Automatické připojení"onclick=autoConnectFiles(event) onkeypress=return!1 onkeydown=return!1 type=button style=display:none> <input id=p13Connect value=Připojit onclick=connectFiles(event,1) onkeypress=return!1 onkeydown=return!1 type=button> <input id=p13Connects value="Připojení SFTP"onclick=connectFiles(event,2) onkeypress=return!1 onkeydown=return!1 type=button> <input id=p13Disconnect value=Odpojit onclick=connectFiles(event) onkeypress=return!1 onkeydown=return!1 type=button> <span class=textOverGray id=p13Status>Odpojeno</span></div><tr><td style=width:100%;background-color:#d3d9d6;text-align:left;padding:4px valign=bottom><div style=width:100%;text-align:center><input type=button style="width:calc(100%/5 - 5px)"id=p13FolderUp disabled onclick=p13folderup() value=Nahoru> <input type=button style="width:calc(100%/5 - 5px)"id=p13SelectAllButton disabled onclick=p13selectallfile() value="Vybrat vše"onkeypress=return!1 onkeydown=return!1> <input type=button style="width:calc(100%/5 - 5px)"id=p13RenameFileButton disabled value=Přejmenovat onclick=p13renamefile() onkeypress=return!1 onkeydown=return!1> <input type=button style="width:calc(100%/5 - 5px)"id=p13DeleteFileButton disabled value=Smazat onclick=p13deletefile() onkeypress=return!1 onkeydown=return!1> <input type=button style="width:calc(100%/5 - 5px)"id=p13NewFolderButton disabled value=Složka onclick=p13createfolder() onkeypress=return!1 onkeydown=return!1></div><div style=width:100%;text-align:center><input type=button style="width:calc(100%/5 - 5px)"id=p13UploadButton disabled value=Nahrát onclick=p13uploadFile() onkeypress=return!1 onkeydown=return!1> <input type=button style="width:calc(100%/5 - 5px)"id=p13CutButton disabled value=Vyjmout onclick=p13copyFile(1) onkeypress=return!1 onkeydown=return!1> <input type=button style="width:calc(100%/5 - 5px)"id=p13CopyButton disabled value=Kopírovat onclick=p13copyFile(0) onkeypress=return!1 onkeydown=return!1> <input type=button style="width:calc(100%/5 - 5px)"id=p13PasteButton disabled value=Vložit onclick=p13pasteFile() onkeypress=return!1 onkeydown=return!1> <input type=button style="width:calc(100%/5 - 5px)"id=p13RefreshButton disabled value="Načíst znovu"onclick=p13folderup(9999) onkeypress=return!1 onkeydown=return!1></div><tr><td style=background-color:#e4e9e7;height:28px><table style=width:100%><tr><td id=p13currentpath style=overflow:hidden;padding-left:4px;padding-top:2px;color:#000><td style=text-align:right;padding-right:4px><select id=p13sortdropdown onchange=p13updateFiles()><option value=1 selected>Seřadit podle názvu<option value=2>Seřadit podle velikosti<option value=3>Seřadit podle data<option value=4>Sestupně podle názvu<option value=5>Sestupně podle velikosti<option value=6>Sestupně podle data</select></table></table><div id=p13FilesConsoleMsg style=display:none;cursor:pointer;position:absolute;left:30px;top:165px;color:#ff0;background-color:rgba(0,0,0,.6);padding:10px;border-radius:5px onclick=p13clearConsoleMsg()></div><div id=p13filetable style="width:100%;height:calc(100% - 133px);overflow:auto;-webkit-user-select:none"><span id=p13files></span></div><table id=p13toolbarBottom style=width:100%;height:22px;position:absolute;bottom:0 cellpadding=0 cellspacing=0><tr><td style=text-align:left;padding:3px;text-align:center;background-color:#d3d9d6;color:#000>&nbsp;<span id=p13bottomstatus></span></table></div><div id=p10details style=overflow-y:scroll;position:absolute;top:55px;bottom:0;width:100%><div id=p10detailshtml style=margin-left:-3px></div></div><div id=p10console style=overflow:hidden;position:absolute;top:55px;bottom:0;width:100%><table id=consoleTable cellpadding=0 cellspacing=0><tr style=height:28px><td class=areaHead><div class=toright2><div id=p15coreName></div><input type=button id=p15uploadCore value="Akce agenta"onclick=p15uploadCore(event)></div><div id=p15statetext></div><tr><td id=p15agentConsole style=position:relative><pre id=p15agentConsoleText></pre><tr style=height:28px><td class=areaFoot><table style=width:100%><tr><td style=width:99%><input id=p15consoleText style=width:100%;box-sizing:border-box onkeyup=p15consoleSend(event)><td id=p15outputselecttd><select id=p15outputselect onchange=setupConsole()><option id=p15outputselect1 value=1>Agent<option id=p15outputselect3 value=3>Tam<option id=p15outputselect2 value=2>MQTT</select><td style=width:1%><input id=id_p15consoleClear type=button class=bottombutton value=Vymazat onclick=p15consoleClear()></table></table></div></div><div id=p20 style=display:none;position:absolute;bottom:0;top:0;width:100%><table cellspacing=0 style=margin:0;padding:0;border-spacing:0;border:0;position:absolute;top:0><tr style=padding:0><td style=padding:0;color:#c8c8c8;text-align:center;cursor:pointer width=60px valign=top onclick=goBack()><div style=padding:0;background-color:#036;width:10px;height:10px;float:right;border:0><div class=menucurve></div></div><div style="padding:0;font-size:25px;background-color:#036;width:50px;border-radius:0 0 10px 0;height:36px">◀</div><td onclick=p20editmesh(1)><img src=/images/meshicon50.png width=50 height=50><td onclick=p20editmesh(1)><div style=margin-left:5px><strong style=font-size:large><span id=p20meshName></span></strong><br></div></table><div style=overflow-y:auto;position:absolute;top:55px;bottom:0;left:0;right:0><div id=p20info style=margin-left:8px;margin-right:8px></div></div></div></div></div><div id=footer style=height:32px;width:100%;text-align:center;background-color:#113962;position:absolute;bottom:0><table id=footerMenu cellpadding=0 cellspacing=0 style=height:32px;width:100%;color:#fff;cursor:pointer;table-layout:fixed></table></div></div><div id=dialog style=display:none><div style="width:100%;background-color:#036;color:#fff;border-radius:5px 5px 0 0"><div id=id_dialogclose style=float:right;padding:5px;cursor:pointer onclick=setDialogMode()><b>X</b></div><div id=id_dialogtitle style=padding:5px></div><div style=width:100%;margin:6px></div></div><div style=margin-right:16px;margin-left:8px><div id=dialog1 style=margin:auto;text-align:center;margin:3px><div id=id_dialogMessage style=padding:10px></div></div><div id=dialog2 style=margin:auto;margin:3px><div id=id_dialogOptions></div></div><div id=dialog3 style=margin:auto;margin:3px><select id=deskkeys style=width:100%><option value=10>Ctrl+Alt+Del<option value=11>Tab<option value=5>Win<option value=0>Win+Down<option value=1>Win+Up<option value=2>Win+L<option value=3>Win+M<option value=4>Shift+Win+M<option value=6>Win+R<option value=7>Alt-F4<option value=8>Ctrl-W<option value=9>Alt-Tab<option value=12>Shift-F10</select></div><div id=dialog4 style=margin:auto;margin:3px><div id=d3upload><div>Výběr souboru</div><select id=d3uploadMode onchange=d3modechange()><option value=1>Nahrání lokálního souboru<option value=2>Výběr souboru serveru</select></div><div id=d3localmode style=display:none><div>Nahrát soubor</div><form id=d3localmodeform method=post enctype=multipart/form-data action=uploadfile.ashx target=fileUploadFrame><input id=d3auth name=auth style=display:none> <input id=d3filter name=filter style=display:none> <input id=d3attrib name=attrib style=display:none> <input type=file id=d3localFile name=files onchange=d3setActions()> <input type=submit id=d3submit style=display:none></form></div><div id=d3servermode><div id=d3serveraction valign=bottom><input type=button id=p3FolderUp disabled onclick=d3folderup() value=Nahoru>&nbsp;<span id=p3CurrentFolder></span></div><div id=d3serverfiles></div></div></div><div id=dialog7 style=margin:auto;margin:3px><div id=d7meshkvm><h4 style="width:100%;border-bottom:1px solid gray">Agent vzdálené plochy</h4><table style=width:100%><tr><td>Kvalita<td style=width:100px><select id=d7bitmapquality style=float:right;width:200px dir=rtl></select><tr><td>Škálování<td style=width:100px><select id=d7bitmapscaling style=float:right;width:200px dir=rtl><option selected value=1024>100%<option value=896>87,5%<option value=768>75%<option value=640>62,5%<option value=512>50%<option value=384>37,5%<option value=256>25%<option value=128>12,5%</select><tr><td>Rychlost<td style=width:100px><select id=d7framelimiter style=float:right;width:200px dir=rtl><option selected value=50>Rychle<option value=100>Středně<option value=400>Pomalu<option value=1000>Velmi pomalu</select><tr><td>Kódování<td style=width:100px><select id=d7encoding style=float:right;width:200px dir=rtl><option value=1>JPEG<option value=2>PNG<option value=3>TIFF<option selected value=4>WEBP</select><tr><td><td><label style=display:block id=d7deskAutoLockLabel><input type=checkbox id=d7deskAutoLock>Zamknout na Odpojit</label></table></div><div id=d7amtkvm><h4 style="width:100%;border-bottom:1px solid gray">Intel® AMT hardwarové KVM</h4><table style=width:100%><tr><td>Kódování<td style=width:100px><select id=d7desktopmode style=float:right;width:200px><option value=1>RLE8, Nejrychlejší<option value=2>RLE16, doporučeno<option value=3>RAW8, pomalé<option value=4>RAW16, velmi pomalé</select></table></div></div></div><div id=idx_dlgButtonBar style=padding:10px;margin-bottom:20px><input id=idx_dlgCancelButton type=button value=Storno style=float:right;width:80px;margin-left:5px onclick=dialogclose(0)> <input id=idx_dlgOkButton type=button value=OK style=float:right;width:80px onclick=dialogclose(1)><div><input id=idx_dlgDeleteButton type=button value=Smazat style=display:none onclick=dialogclose(2)></div></div></div><div id=topMenu style="z-index:1000;background-color:#eee;box-shadow:0 0 15px #666;font-family:Arial,Helvetica,sans-serif;border-radius:0 0 5px 5px;position:fixed;top:50px;right:5px;width:170px;display:none"><div style="padding:12px;border-top:1px solid gray;color:#000;cursor:pointer"onclick=topMenu(2)>Moje soubory</div><div style="padding:12px;border-top:1px solid gray;color:#000;cursor:pointer"onclick=topMenu(1)>Můj účet</div><div id=logoutMenuOption><a id=logoutMenuOptionRef href=/logout><div style="padding:12px;border-top:1px solid gray;color:#000;cursor:pointer">Odhlásit se</div></a></div></div><audio id=chimes><source src=sounds/chimes.mp3 type=audio/mp3></audio><iframe name=fileUploadFrame style=display:none></iframe><script>var i,random="{{{randomlength}}}",webState="{{{webstate}}}";for(i in webState=""!=webState?JSON.parse(decodeURIComponent(webState)):webState)localStorage.setItem(i,webState[i]);webState&&!webState.loctag&&localStorage.removeItem("loctag");var urlargs=parseUriArgs(),args=(null!=urlargs.key&&(urlargs.key=""+urlargs.key),urlargs.key&&0==isAlphaNumeric(urlargs.key)&&delete urlargs.key,urlargs.locale&&0==isAlphaNumeric(urlargs.locale)&&delete urlargs.locale,delete urlargs.user,delete urlargs.pass,delete urlargs.viewmode,delete urlargs.gotonode,delete urlargs.gotodevicename,delete urlargs.gotodeviceip,delete urlargs.gotomesh,delete urlargs.panel,parseUriArgs()),debugLevel=(args.key&&0==isAlphaNumeric(args.key)&&delete args.key,args.locale&&0==isAlphaNumeric(args.locale)&&delete args.locale,parseInt("{{{debuglevel}}}")),features=parseInt("{{{features}}}"),features2=parseInt("{{{features2}}}"),sessionTime=parseInt("{{{sessiontime}}}"),sessionRefreshTimer=null,domain="{{{domain}}}",domainUrl="{{{domainurl}}}",authCookie="{{{authCookie}}}",authRelayCookie="{{{authRelayCookie}}}",logoutControls=JSON.parse(decodeURIComponent("{{{logoutControls}}}")),authCookieRenewTimer=null,webRelayPort=parseInt("{{{webRelayPort}}}"),hidePowerTimeline="{{{hidePowerTimeline}}}",webRelayDns="{{{webRelayDns}}}",meshserver=null,xdr=null,usergroups=null,stars={},serverinfo=null,nodes=[],meshes={},filetree={},userinfo=null,serverinfo=null,users=null,nodeShortIdent=0,serverPublicNamePort="{{{serverDnsName}}}:{{{serverPublicPort}}}",debugmode=!1,attemptWebRTC=0!=(128&features),webrtcconfiguration="{{{webrtcconfig}}}";if(""==webrtcconfiguration)webrtcconfiguration=null;else try{webrtcconfiguration=JSON.parse(decodeURIComponent(webrtcconfiguration))}catch(e){console.log('Invalid WebRTC config: "'+webrtcconfiguration+'".'),webrtcconfiguration=null}var files,terminal,deskPinchZoom,StatusStrs=["Odpojeno","Připojování…","Nastavení…","Připojeno","Intel&reg; AMT připojeno"],agentsStr=["Neznámé","Windows 32bit konzole","Windows 64bit konzole","Windows 32bit služba","Windows 64bit služba","Linux 32bit","Linux 64bit","MIPS","XENx86","Android ARM","Linux ARM","macOS x86-32bit","Android x86","PogoPlug ARM","Android","Linux Poky x86-32bit","macOS x86-64bit","ChromeOS","Linux Poky x86-64bit","Linux NoKVM x86-32bit","Linux NoKVM x86-64bit","Windows MinCore konzole","Windows MinCore služba","NodeJS","ARM-Linaro","ARMv6l / ARMv7l","ARMv8 64bit","ARMv6l / ARMv7l / NoKVM","MIPS24KC (OpenWRT)","Apple Silicon","FreeBSD x86-64","Neznámé","Linux ARM 64 bit (glibc/2.24 NOKVM)","Alpine Linux x86 64 Bit (MUSL)","Asistent (Windows)","Armada370 - ARM32/HF (libc/2.26)","OpenWRT x86-64","OpenBSD x86-64","Neznámé","Neznámé","MIPSEL24KC (OpenWRT)","ARMADA/CORTEX-A53/MUSL (OpenWRT)","Windows ARM 64bit console","Windows ARM 64bit service"],passRequirements="{{{passRequirements}}}",sessionActivity=(""!=passRequirements&&(passRequirements=JSON.parse(decodeURIComponent(passRequirements))),Date.now()),deskKeyboardShortcuts=[],nightMode=setNightMode(),xterm=null,xtermfit=null,xtermResizeTimer=null,devicePagingState=null,p11DeskConsoleMsgTimer=null,p12TermConsoleMsgTimer=null,p13FilesConsoleMsgTimer=null,webpSupport=!1;function startup(){if(0==(32&features)){var e=null;try{e=top.location.toString().toLowerCase()}catch(e){}if(top!=self&&(null==e||0==top.active))return void(top.location=self.location)}args.locale||null!=(e=getstore("loctag",0))&&"*"!=e&&(args.locale=e),(window.onresize=center)(),QV("changeEmailId",0==(2097152&features)),QH("p1message","Připojování…"),go(1),document.onkeypress=ondeskkeypress,document.onkeydown=ondeskkeydown,document.onkeyup=ondeskkeyup,document.onclick=function(e){999==xxdialogMode&&"topMenuIcon"!=e.target.id&&(QV("topMenu",!1),xxdialogMode=0)},(meshserver=MeshServerCreateControl(domainUrl)).onStateChanged=onStateChanged,meshserver.onMessage=onMessage,meshserver.trace=args.trace,meshserver.Start();try{stars=JSON.parse(getstore("stars","{}"))}catch(e){}logoutControls&&logoutControls.logoutUrl&&(Q("logoutMenuOptionRef").href=logoutControls.logoutUrl);var t,e=localStorage.getItem("desktopsettings"),n=(null!=e&&(desktopsettings=JSON.parse(e)),applyDesktopSettings(),null!=args.webrtc&&(attemptWebRTC=1==args.webrtc),10<=sessionTime&&(sessionRefreshTimer=setTimeout(refreshCookieSession,Math.round(6e4*sessionTime*.8))),QV("setDarkModeLink",0==(3145728&features2)),deskKeyboardShortcuts=[],getstore("deskKeyShortcuts","0x0A002E,0x100000,0x100028,0x100026,0x10004C,0x10004D,0x11004D,0x100052,0x020073,0x080057,0x020009,0x100025,0x100027").split(","));for(t in n)deskKeyboardShortcuts.push(parseInt(n[t]));updateDeskShortcutKeys(),updateTermShortcutKeys()}function refreshCookieSession(){var e=null;try{e=new XDomainRequest}catch(e){}(e=e||new XMLHttpRequest).open("GET",window.location.origin+domainUrl+"refresh.ashx"),e.timeout=15e3,e.onload=function(){sessionRefreshTimer=setTimeout(refreshCookieSession,Math.round(6e4*sessionTime*.8))},e.onerror=e.ontimeout=function(){sessionRefreshTimer=null},e.send()}function onStateChanged(e,t,n,o){if(0==t){if(setDialogMode(0),go(0),deleteAllNotifications(),"noauth"==o)return void QH("p0span","Nedaří se ověřit se");2==n?setTimeout(serverPoll,5e3):QH("p0span","Nedaří se připojit k web socketu"),null!=authCookieRenewTimer&&(clearInterval(authCookieRenewTimer),authCookieRenewTimer=null),devicePagingState=null,updateDevicePageState()}else 2==t&&(meshserver.send({action:"usergroups"}),meshserver.send({action:"meshes"}),meshserver.send({action:"nodes",skip:null==devicePagingState?0:devicePagingState.skip}),meshserver.send({action:"files"}),authCookieRenewTimer=setInterval(function(){meshserver.send({action:"authcookie"})},18e5));QV("topMenuIcon",2==t)}function serverPoll(){xdr=null;try{xdr=new XDomainRequest}catch(e){}(xdr=xdr||new XMLHttpRequest).open("HEAD",window.location.href),xdr.timeout=15e3,xdr.onload=function(){xdr.status<500?reload():setTimeout(serverPoll,1e4)},xdr.onerror=xdr.ontimeout=function(){setTimeout(serverPoll,1e4)},xdr.send()}function updateSelf(){var e,t,n=0!=(256&features2);userinfo&&(n=4294967295!=userinfo.siteadmin&&0!=(1024&userinfo.siteadmin)||0!=(256&features2)),QV("p3AccountActions",0==(4&features)&&0==serverinfo.domainauth&&0==n),QV("logoutMenuOption",0==(4&features)&&0==serverinfo.domainauth),QV("p2AccountSecurity",0==(4&features)&&0==serverinfo.domainauth&&0!=(4096&features)&&0==n),QV("p2AccountImage",!n),QV("verifyEmailId",!0!==userinfo.emailVerified&&null!=userinfo.email&&1==serverinfo.emailcheck),QV("manageAuthApp",1!=serverinfo.lock2factor&&4096&features&&(1==userinfo.otpsecret||0==(131072&features2))),QV("manageOtp",1!=serverinfo.lock2factor&&0==(262144&features2)&&4096&features&&(1==userinfo.otpsecret||0<userinfo.otphkeys)),QV("authPhoneNumberCheck",null!=userinfo.phone),QV("authEmailSetupCheck",1==userinfo.otpekey&&null!=userinfo.email&&1==userinfo.emailVerified),QV("authAppSetupCheck",1==userinfo.otpsecret),QV("authCodesSetupCheck",0<userinfo.otpkeys),QV("p2AccountActions",0==(4&features)&&0==serverinfo.domainauth&&null!=userinfo),QV("p2AccountPassActions",0==(4&features)&&0==serverinfo.domainauth&&null!=userinfo&&0==userinfo._id.split("/")[2].startsWith("~")),QV("p3createMeshLink1",!1),QV("p3createMeshLink2",!1),null!=userinfo.flags&&1&userinfo.flags?(null==userinfo.accountImageRnd&&(userinfo.accountImageRnd=Math.floor(9999999999*Math.random())),Q("p2AccountImage").src="userimage.ashx?rnd="+userinfo.accountImageRnd):Q("p2AccountImage").src="images/user-256.png","number"==typeof userinfo.passchange&&(-1==userinfo.passchange?QH("p2nextPasswordUpdateTime"," - Resetovat při příštím přihlášení."):null!=passRequirements&&"number"==typeof passRequirements.reset&&((n=userinfo.passchange+86400*passRequirements.reset-Math.floor(Date.now()/1e3))<0?QH("p2nextPasswordUpdateTime"," - Resetovat při příštím přihlášení."):n<3600?(t=Math.floor(n/60),QH("p2nextPasswordUpdateTime",format(1==t?" - Resetovat za 1 minutu.":" - Resetovat za {0} minut.",t))):n<86400?(e=Math.floor(n/3600),QH("p2nextPasswordUpdateTime",format(1==e?" - Resetovat za 1 hodinu.":" - Resetovat za {0} hodin.",e))):(t=Math.floor(n/86400),QH("p2nextPasswordUpdateTime",format(1==e?" - Resetovat za 1 den.":" - Resetovat za {0} dnů.",t)))))}function setSessionActivity(){sessionActivity=Date.now()}function checkIdleSessionTimeout(){Date.now()-sessionActivity>serverinfo.timeout&&serverinfo.logoutOnIdleSessionTimeout&&(window.location.href="logout")}function onMessage(e,t){switch(t.action){case"serverinfo":(serverinfo=t.serverinfo).timeout&&(setInterval(checkIdleSessionTimeout,1e4),checkIdleSessionTimeout()),null!=userinfo&&updateSelf(),null!=serverinfo.certExpire&&0<=(u=Math.floor((serverinfo.certExpire-Date.now())/864e5))&&u<20&&addNotification({text:format("Platnost certifikátu vyprší za {0} dnů",u)}),QV("manageEmail2FA",8388608&features&&1!=serverinfo.lock2factor),QV("managePhoneNumber1",33554432&features&&67108864&features&&1!=serverinfo.lock2factor),QV("managePhoneNumber2",33554432&features&&!(67108864&features)&&1!=serverinfo.lock2factor);break;case"authcookie":authCookie=t.cookie,authRelayCookie=t.rcookie;break;case"userinfo":userinfo=t.userinfo,QH("p3userName",userinfo.name),null!=serverinfo&&updateSelf();break;case"users":for(var n in users={},t.users)users[t.users[n]._id]=t.users[n];null!=currentUser&&(currentUser=users[currentUser._id]),updateUsers();break;case"wssessioncount":wssessions=t.wssessions,updateUsers();break;case"meshes":for(var n in meshes={},t.meshes)meshes[t.meshes[n]._id]=t.meshes[n];null!=currentMesh&&(currentMesh=meshes[currentMesh._id]),updateMeshes(),mainUpdate(4);break;case"usergroups":var o=0;if(Array.isArray(t.ugroups))for(var a in usergroups={},t.ugroups)o++,usergroups[t.ugroups[a]._id]=t.ugroups[a];else for(var a in usergroups=t.ugroups,t.ugroups)o++;0==o&&(usergroups=null);break;case"files":filetree=setupBackPointers(t.filetree),updateFiles();break;case"nodes":for(var n in nodes=[],t.nodes)for(var i in t.nodes[n])t.nodes[n][i].namel=t.nodes[n][i].name.toLowerCase(),t.nodes[n][i].rname?t.nodes[n][i].rnamel=t.nodes[n][i].rname.toLowerCase():t.nodes[n][i].rnamel=t.nodes[n][i].namel,t.nodes[n][i].meshnamel=meshes[n]?meshes[n].name.toLowerCase():"*",t.nodes[n][i].meshid=n,t.nodes[n][i].state=t.nodes[n][i].state||0,t.nodes[n][i].desc=t.nodes[n][i].desc,t.nodes[n][i].icon||(t.nodes[n][i].icon=1),t.nodes[n][i].ident=++nodeShortIdent,nodes.push(t.nodes[n][i]);null!=currentNode&&0==IsNodeViewable(currentNode)&&(currentNode=null,go(2)),null!=currentNode&&(null!=(currentNode=getNodeFromId(currentNode._id))?gotoDevice(currentNode._id,xxcurrentView,!0):go(2)),devicePagingState=null==t.totalcount?null:{total:t.totalcount,skip:t.skip,limit:t.limit},updateDevicePageState(),mainUpdate(4),0==xxcurrentView&&go(parseInt("{{viewmode}}")),gotoDevice("{{currentNode}}",parseInt("{{viewmode}}"));break;case"powertimeline":if(t.nodeid==powerTimelineReq){for(var a in powerTimelineNode=t.nodeid,powerTimeline=t.timeline,powerTimelineUpdate=Date.now()+3e5,powerTimeline)a%2==1&&(powerTimeline[a]=1e3*powerTimeline[a]);currentNode._id==t.nodeid&&drawDeviceTimeline()}break;case"getsysinfo":t.nodeid==powerTimelineReq&&(!0===t.noinfo?updateDeviceDetails(getNodeFromId(t.nodeid)):updateDeviceDetails(getNodeFromId(t.nodeid),t.hardware));break;case"lastconnect":null!=(y=getNodeFromId(t.nodeid))&&(y.lastconnect=t.time,y.lastaddr=t.addr);break;case"msg":if(null!=t.nodeid){var s=-1;if(null!=nodes)for(var a in nodes)if(nodes[a]._id==t.nodeid){s=a;break}if(-1!=s)if("console"==t.type)p15consoleReceive(nodes[s],t.value,t.source);else if("notify"==t.type){if(0==(8&(i=getstore("notifications",0)))&&null!=t.amtMessage)break;i={text:t.value,title:t.title,icon:t.icon,titleid:t.titleid,msgid:t.msgid,args:t.args};null!=t.id&&(i.id=t.id),null!=t.nodeid&&(i.nodeid=t.nodeid),null!=t.tag&&(i.tag=t.tag),null!=t.url&&(i.url=t.url),null!=t.username&&(i.username=t.username),"number"==typeof t.maxtime&&(i.maxtime=t.maxtime),addNotification(i)}else if("userSessions"==t.type&&null!=currentNode&&currentNode._id==t.nodeid&&null==desktop){var l=[];if(null!=t.data)for(var a in t.data)"Active"!=t.data[a].State&&"Console"!=t.data[a].StationName&&3!=debugmode||l.push(t.data[a]);if(0==l.length)connectDesktop(null,1,null,t.tag);else if(1==l.length)connectDesktop(null,1,l[0].SessionId,t.tag);else{var r="",d="{{{userSessionsSort}}}";for(a in l.sort(function(e,t){return e[d]?t[d]?e[d]<t[d]?-1:t[d]<e[d]?1:0:1:-1}),l)r+='<div style="text-align:left;cursor:pointer;background-color:gray;margin:5px;padding:5px;border-radius:5px" onclick=connectDesktop(event,1,'+l[a].SessionId+","+t.tag+")>"+l[a].State+", "+l[a].StationName,l[a].Username&&(l[a].Domain?r+=" - "+l[a].Domain+"/"+l[a].Username:r+=" - "+l[a].Username),r+="</div>";QH("p11DeskSessionSelector",r),QV("p11DeskSessionSelector",!0)}}}else"notify"==t.type&&(i={text:t.value,title:t.title,icon:t.icon,titleid:t.titleid,msgid:t.msgid,args:t.args},null!=t.id&&(i.id=t.id),null!=t.tag&&(i.tag=t.tag),null!=t.url&&(i.url=t.url),null!=t.username&&(i.username=t.username),"number"==typeof t.maxtime&&(i.maxtime=t.maxtime),addNotification(i));break;case"getnetworkinfo":if(currentNode._id!=t.nodeid)return;updateDeviceDetails(getNodeFromId(t.nodeid),null,t);break;case"getNotes":(i=Q("d2devNotes"))&&t.id==decodeURIComponent(i.attributes.noteid.value)&&(t.notes?QH("d2devNotes",decodeURIComponent(t.notes)):QH("d2devNotes",""),0==("true"==i.attributes.ro.value))&&(i.removeAttribute("readonly"),QE("idx_dlgOkButton",!0),QV("idx_dlgOkButton",!0),focusTextBox("d2devNotes"));break;case"otpauth-request":var u;2==xxdialogMode&&"otpauth-request"==xxdialogTag&&(null!=t.err?(u=["","2FA je uzamčena","Záložní kódy jsou uzamčeny","Používá se přihlašovací token","OTP 2FA není povoleno","Účet je uzamčen","Nelze načíst OTPLIB"],0<t.err&&t.err<u.length?QH("d2optinfo",u[t.err]):QH("d2optinfo",format("Chyba č. {0}",t.err))):(52==(u=t.secret).length?u=u.split(/(.............)/).filter(Boolean).join(" "):32==u.length&&(u=(u=u.split(/(....)/).filter(Boolean).join(" ")).substring(0,20)+"<br/>"+u.substring(20)),QH("d2optinfo",format('Instalace <a href="https://play.google.com/store/apps/details?id=com.google.android.apps.authenticator2" rel="noreferrer noopener" target=_blank>Google Authenticator</a> nebo kompatibilní aplikaci, použijte <a href="{0}" rel="noreferrer noopener" target=_blank> tento odkaz</a> nebo vložte tajemství. Pak vložte aktuální 6 číselný token pro aktivaci 2-faktorového přihlašování.',t.url)+'<br /><br /><div style=width:100%;text-align:center><tt id=d2optsecret secret="'+t.secret+'" style=font-size:15px>'+u+'</tt><br /><br />Token: <input type=text autocomplete="one-time-code" inputmode="numeric" pattern="[0-9]*" onkeypress="return (event.keyCode == 8) || (event.charCode >= 48 && event.charCode <= 57)" onkeyup=account_addOtpCheck(event) onkeydown=account_addOtpCheck() maxlength=6 id=d2otpauthinput type=text></div>'),QV("idx_dlgOkButton",!0),QE("idx_dlgOkButton",!1),Q("d2otpauthinput").focus()));break;case"otpauth-setup":if(xxdialogMode)return;setDialogMode(2,"Aplikace pro ověřování se",1,null,t.success?"<b style=color:green>Aktivace aplikace pro ověřování se úspěšná.</b> Budete potřebovat platný token k novému přihlášení.":"<b style=color:red>aktivace 2-faktorového přihlašování se nezdařila.</b> Vymažte tajemství z aplikace a zkuste to znovu. Na zadání správného kódu máte jen několik minut.");break;case"otpauth-clear":if(xxdialogMode)return;setDialogMode(2,"Aplikace pro ověřování se",1,null,t.success?"<b>Aplikace pro ověřování se odstraněna.</b> Tuto funkci můžete kdykoli znovu aktivovat.":"<b style=color:red>odstranění 2-faktorového přihlašování se nezdařilo.</b> Zkusit znovu.");break;case"otpauth-getpasswords":if(xxdialogMode)return;r="Jednorázové tokeny lze použít jako sekundární ověřování. Vytvořte sadu, vytiskněte je a uložte na bezpečném místě.";if(r+="<div style='border-radius:6px;border: 2px dashed #888;width:100%;margin-top:8px'><div style='padding:8px;font-family:Arial, Helvetica, sans-serif;font-size:20px;font-weight:bold'><table style=width:100%;text-align:center>",t.passwords){var c=0;for(a in t.passwords){++c%2&&(r+="<tr>");for(var p=""+t.passwords[a].p;p.length<8;)p="0"+p;!0===t.passwords[a].u?r+="<td>"+p.substring(0,4)+"&nbsp;"+p.substring(4):r+="<td><strike style=color:#BBB>"+p.substring(0,4)+"&nbsp;"+p.substring(4)}}else r+="<tr><td>Žádné aktivní tokeny";r=(r+="</table></div></div><br />")+"<div><input type=button value='Zavřít' onclick=setDialogMode(0) style=float:right></input>"+"<input type=button value='Nové tokeny' onclick='account_manageOtp(1);'></input>",null!=t.passwords&&(r+="<input type=button value='Vymazat' onclick='account_manageOtp(2);'></input>"),setDialogMode(2,"Spravovat záložní kódy",8,null,r+="</div><br />","otpauth-manage");break;case"verifyPhone":if(xxdialogMode&&"verifyPhone"!=xxdialogTag)return;setDialogMode(2,"Telefonní oznámení",3,account_managePhoneConfirm,r=(r='<table><tr><td><img src="images/phone80.png" style=padding:8px>')+"<td>Check your phone and enter the verification code."+'<br /><br /><div style=width:100%;text-align:center>Ověřovací kód: <input type=tel pattern="[0-9]" inputmode="number" maxlength=6 id=d2phoneCodeInput onKeyUp=account_managePhoneCodeValidate() onkeypress="if (event.key==\'Enter\') account_managePhoneCodeValidate(1)"></div></table>',t.cookie),Q("d2phoneCodeInput").focus(),account_managePhoneCodeValidate();break;case"previousLogins":if(2==xxdialogMode&&"previousLogins"==xxdialogTag){var r="",m="BBB";if(0==t.events.length)r+="No previous login.";else{for(var a in r+="<div style=max-height:260px;overflow-y:scroll;overflow-x:hidden>",t.events)107==(n=t.events[a].m)?(n="Platné přihlášení",m="BBD1BB",0):108==n?(n="Neplatné 2FA",m="DD9DC3",0):109==n?(n="Uzamknutý účet",m="E1BBBB",0):110==n&&(n="Neplatné heslo",m="E1BBBB",0),r+="<div style=width:260px;background-color:#"+m+";border-radius:6px;margin-bottom:4px;padding:4px><div><b>"+EscapeHtml(n)+"</b><br />"+printDateTime(new Date(t.events[a].t))+"</div><div style=font-size:x-small>"+EscapeHtml(t.events[a].a.join(", "))+"</div></div></tr>";r+="</div>"}setDialogMode(2,"Předchozí přihlášení",1,null,r)}break;case"event":if(!t.event.noact)switch(t.event.action){case"serverinfochange":null!=t.event.lock2factor&&(serverinfo.lock2factor=t.event.lock2factor,updateSelf());break;case"userWebState":if(null!=localStorage){var g=JSON.parse(t.event.state);for(a in g)localStorage.setItem(a,g[a]);if(null!=g.stars&&(stars=JSON.parse(g.stars)),null!=g.loctag&&g.loctag!=oldLoctag?(null!=g.loctag?args.locale=g.loctag:delete args.locale,mainUpdate(132)):null!=g.stars&&(mainUpdate(4),"*"==Q("SearchInput").value)&&onSearchInputChanged(),currentNode&&refreshDevice(currentNode._id),null!=g.deskKeyShortcuts){deskKeyboardShortcuts=[];var h=g.deskKeyShortcuts.split(",");for(a in h)deskKeyboardShortcuts.push(parseInt(h[a]));updateDeskShortcutKeys()}}break;case"accountchange":if("object"!=typeof t.event.account||null==t.event.account)return void console.log(t.event);userinfo.name==t.event.account.name&&(t.event.account.siteadmin,userinfo.siteadmin,(t.event.account.quota!=userinfo.quota||0==(8&userinfo.siteadmin)&&0!=(8&t.event.account.siteadmin))&&meshserver.send({action:"files"}),userinfo=t.event.account,updateSelf(),t.event.nodeListChange==userinfo._id)&&meshserver.send({action:"nodes",skip:null==devicePagingState?0:devicePagingState.skip});break;case"createusergroup":case"usergroupchange":var v=(usergroups=null==usergroups?{}:usergroups)[t.event.ugrpid];null==v?usergroups[t.event.ugrpid]={_id:t.event.ugrpid,name:t.event.name,desc:t.event.desc,domain:t.event.domain,links:t.event.links}:(v.name=t.event.name,v.desc=t.event.desc,v.links=t.event.links,v.flags=t.event.flags),meshserver.send({action:"meshes"}),meshserver.send({action:"nodes",skip:null==devicePagingState?0:devicePagingState.skip});break;case"deleteusergroup":if(null!=usergroups&&null!=usergroups[t.event.ugrpid]){delete usergroups[t.event.ugrpid];m=0;for(a in usergroups)m++;0==m&&(usergroups=null)}break;case"createmesh":null!=meshes[t.event.meshid]||!userinfo.manageAllDeviceGroups&&null==t.event.mesh.links[userinfo._id]||(meshes[t.event.meshid]=t.event.mesh,mainUpdate(132),meshserver.send({action:"files"}));break;case"meshchange":if(null==meshes[t.event.meshid]){var f=!1;for(a in null!=t.event.links[userinfo._id]&&(f=!0),null!=userinfo.links[t.event.meshid]&&(f=!0),userinfo.links)a.startsWith("ugrp/")&&null!=t.event.links[a]&&(f=!0);f&&(meshes[t.event.meshid]={_id:t.event.meshid,name:t.event.name,mtype:t.event.mtype,desc:t.event.desc,links:t.event.links,relayid:t.event.relayid},meshserver.send({action:"nodes",skip:null==devicePagingState?0:devicePagingState.skip}))}else{if(meshes[t.event.meshid].name!=t.event.name)for(var a in meshes[t.event.meshid].name=t.event.name,nodes)nodes[a].meshid==t.event.meshid&&(nodes[a].meshnamel=t.event.name.toLowerCase());if(meshes[t.event.meshid].desc=t.event.desc,meshes[t.event.meshid].links=t.event.links,null!=t.event.relayid&&(meshes[t.event.meshid].relayid=t.event.relayid),0==IsMeshViewable(t.event.meshid)){20==xxcurrentView&&currentMesh==meshes[t.event.meshid]&&go(2),delete meshes[t.event.meshid];var k=[];for(a in nodes)(nodes[a].meshid!=t.event.meshid||null!=userinfo.links&&null!=userinfo.links[nodes[a]._id])&&k.push(nodes[a]);nodes=k,10<=xxcurrentView&&xxcurrentView<20&&currentNode&&!IsNodeViewable(currentNode)&&(setDialogMode(0),go(2),currentNode=null)}}mainUpdate(132),meshserver.send({action:"files"}),20==xxcurrentView&&currentMesh._id==t.event.meshid&&p20updateMesh();break;case"deletemesh":meshes[t.event.meshid]&&(delete meshes[t.event.meshid],updateMeshes(),meshserver.send({action:"files"}));k=[];for(a in nodes)nodes[a].meshid!=t.event.meshid&&k.push(nodes[a]);nodes=k,mainUpdate(4),20<=xxcurrentView&&xxcurrentView<30&&currentMesh._id==t.event.meshid&&(setDialogMode(0),go(2)),10<=xxcurrentView&&xxcurrentView<20&&currentNode&&!IsNodeViewable(currentNode)&&(setDialogMode(0),go(2));break;case"addnode":var y=t.event.node;meshes[y.meshid]&&null==getNodeFromId(y._id)&&(y.namel=y.name.toLowerCase(),y.rname?y.rnamel=y.rname.toLowerCase():y.rnamel=y.namel,y.meshnamel=meshes[y.meshid]?meshes[y.meshid].name.toLowerCase():"*",y.state=0,y.icon||(y.icon=1),y.ident=++nodeShortIdent,nodes.push(y),mainUpdate(4));break;case"removenode":s=-1;for(a in nodes)if(nodes[a]._id==t.event.nodeid){s=a;break}-1!=s&&(y=nodes[s],currentNode==y&&(10<=xxcurrentView&&xxcurrentView<20&&(setDialogMode(0),go(2)),currentNode=null),nodes.splice(s,1),mainUpdate(4));break;case"changenode":s=-1;for(a in nodes)if(nodes[a]._id==t.event.nodeid){s=a;break}-1!=s&&((y=nodes[s]).name=t.event.node.name,y.rname=t.event.node.rname,y.lusers=t.event.node.lusers,y.users=t.event.node.users,y.host=t.event.node.host,y.desc=t.event.node.desc,y.publicip=t.event.node.publicip,y.iploc=t.event.node.iploc,y.wifiloc=t.event.node.wifiloc,y.gpsloc=t.event.node.gpsloc,y.tags=t.event.node.tags,y.ssh=t.event.node.ssh,y.rdp=t.event.node.rdp,y.userloc=t.event.node.userloc,y.rdpport=t.event.node.rdpport,y.rfbport=t.event.node.rfbport,y.sshport=t.event.node.sshport,y.httpport=t.event.node.httpport,y.httpsport=t.event.node.httpsport,y.consent=t.event.node.consent,y.pmt=t.event.node.pmt,null!=t.event.node.agent&&(null==y.agent&&(y.agent={}),null!=t.event.node.agent.ver&&(y.agent.ver=t.event.node.agent.ver),null!=t.event.node.agent.id&&(y.agent.id=t.event.node.agent.id),null!=t.event.node.agent.caps&&(y.agent.caps=t.event.node.agent.caps),null!=t.event.node.agent.root&&(y.agent.root=t.event.node.agent.root),null!=t.event.node.agent.core?y.agent.core=t.event.node.agent.core:y.agent.core&&delete y.agent.core,y.agent.tag=t.event.node.agent.tag),null!=t.event.node.intelamt&&(null==y.intelamt&&(y.intelamt={}),null!=t.event.node.intelamt.state&&(y.intelamt.state=t.event.node.intelamt.state),null!=t.event.node.intelamt.host&&(y.intelamt.user=t.event.node.intelamt.host),null!=t.event.node.intelamt.user&&(y.intelamt.user=t.event.node.intelamt.user),null!=t.event.node.intelamt.tls&&(y.intelamt.tls=t.event.node.intelamt.tls),null!=t.event.node.intelamt.ver&&(y.intelamt.ver=t.event.node.intelamt.ver),null!=t.event.node.intelamt.tag&&(y.intelamt.tag=t.event.node.intelamt.tag),null!=t.event.node.intelamt.uuid&&(y.intelamt.uuid=t.event.node.intelamt.uuid),null!=t.event.node.intelamt.realm&&(y.intelamt.realm=t.event.node.intelamt.realm),null!=t.event.node.intelamt.flags&&(y.intelamt.flags=t.event.node.intelamt.flags),null!=t.event.node.intelamt.warn?y.intelamt.warn=t.event.node.intelamt.warn:delete y.intelamt.warn),null!=t.event.node.av&&(y.av=t.event.node.av),null!=t.event.node.wsc&&(y.wsc=t.event.node.wsc),y.namel=y.name.toLowerCase(),y.rname?y.rnamel=y.rname.toLowerCase():y.rnamel=y.namel,t.event.node.icon&&(y.icon=t.event.node.icon),refreshDevice(y._id),updateDeviceViewDevice(y),currentNode==y)&&updateDeviceDetails();break;case"nodemeshchange":s=-1;for(a in nodes)if(nodes[a]._id==t.event.nodeid){s=a;break}if(-1!=s){y=nodes[s];null!=meshes[t.event.newMeshId]||null!=userinfo.links&&null!=userinfo.links[y._id]?(y.meshid=t.event.newMeshId,y.meshnamel=meshes[t.event.newMeshId]?meshes[t.event.newMeshId].name.toLowerCase():"*"):(10<=xxcurrentView&&xxcurrentView<20&&currentNode&&!IsNodeViewable(currentNode)&&(setDialogMode(0),go(2),currentNode=null),nodes.splice(s,1)),mainUpdate(4),refreshDevice(t.event.nodeid)}else{y=t.event.node;if(!meshes[y.meshid])break;y.namel=y.name.toLowerCase(),y.rname?y.rnamel=y.rname.toLowerCase():y.rnamel=y.namel,y.meshnamel=meshes[y.meshid]?meshes[y.meshid].name.toLowerCase():"*",y.state=0,y.icon||(y.icon=1),y.ident=++nodeShortIdent,nodes.push(y),mainUpdate(4)}break;case"nodeconnect":s=-1;for(a in nodes)if(nodes[a]._id==t.event.nodeid){s=a;break}-1!=s&&((y=nodes[s]).conn=t.event.conn,y.pwr=t.event.pwr,0==(1&y.conn)&&delete y.sessions,refreshDevice(y._id),updateDeviceViewDevice(y));break;case"login":null!=users&&users["user/"+domain+"/"+t.event.username.toLowerCase()]&&(users["user/"+domain+"/"+t.event.username.toLowerCase()].login=t.event.time);break;case"notify":i={text:t.event.value,title:t.event.title,icon:t.event.icon,titleid:t.titleid,msgid:t.msgid,args:t.args};null!=t.id&&(i.id=t.id),null!=t.event.tag&&(i.tag=t.event.tag),"number"==typeof t.maxtime&&(i.maxtime=t.maxtime),addNotification(i);break;case"sysinfohash":null!=currentNode&&t.event.nodeid==powerTimelineReq&&meshserver.send({action:"getsysinfo",nodeid:t.event.nodeid});break;case"ifchange":null!=currentNode&&currentNode._id==t.event.nodeid&&meshserver.send({action:"getnetworkinfo",nodeid:currentNode._id});break;case"devicesessions":if(null!=(y=getNodeFromId(t.event.nodeid))){if(y.sessions=t.event.sessions,null!=y.sessions){for(var a in y.sessions)0==Object.keys(y.sessions[a]).length&&delete y.sessions[a];0==Object.keys(y.sessions).length&&delete y.sessions}refreshDevice(t.event.nodeid),updateDeviceViewDevice(y),xxdialogTag=="SESSIONS-"+t.event.nodeid&&showDeviceSessions(t.event.nodeid,!0),xxdialogTag=="HELPREQ-"+t.event.nodeid&&showDeviceHelpRequests(t.event.nodeid,!0)}}}}check_webp_feature("lossy",function(e,t){(webpSupport=t)||(d7encoding.options[1].disabled=!0,d7encoding.value=1)});var updateNaggleTimer=null,updateNaggleFlags=0;function mainUpdate(e){updateNaggleFlags|=e,null==updateNaggleTimer&&(updateNaggleTimer=setTimeout(function(){1&updateNaggleFlags&&onSearchInputChanged(),4&updateNaggleFlags&&(updateDevices(),updateDeviceDetails()),128&updateNaggleFlags&&updateMeshes(),updateNaggleTimer=null,updateNaggleFlags=0,gotoStartViewPage()},150))}function gotoStartViewPage(){var e=parseInt("{{viewmode}}");if(!(1<xxcurrentView)){if(""!="{{currentNode}}".toLowerCase()){if(null==getNodeFromId("{{currentNode}}"))return;gotoDevice("{{currentNode}}",e)}else if(null!=args.gotonode){if(96==args.gotonode.length&&(args.gotonode=btoa(hex2rstr(args.gotonode)).split("+").join("@").split("/").join("$")),null==getNodeFromId("node/"+domain+"/"+args.gotonode))return;args.panel&&(currentDevicePanel=parseInt(args.panel)),gotoDevice("node/"+domain+"/"+args.gotonode,e)}else if(null!=args.gotodevicename){var t=null;if(null!=nodes)for(var n in nodes)nodes[n].name==args.gotodevicename&&(t=nodes[n]._id);t&&(gotoDevice(t,e),go(e))}else if(null!=args.gotodeviceip){t=null;if(null!=nodes)for(var n in nodes)nodes[n].ip==args.gotodeviceip&&(t=nodes[n]._id);t&&(gotoDevice(t,e),go(e))}else if(null!=args.gotomesh){if(null==meshes["mesh/"+domain+"/"+args.gotomesh])return;gotoMesh("mesh/"+domain+"/"+args.gotomesh),go(e)}else isNaN(e)?(setDialogMode(0),go(1)):go(e);delete args.gotonode,delete args.gotomesh,delete args.panel,xxcurrentView<2&&go(2)}}function topMenu(e){null!=xxdialogMode&&0!=xxdialogMode&&999!=xxdialogMode||(void 0===e?1==("none"==QS("topMenu").display)?0!=xxdialogMode&&null!=xxdialogMode||(QV("topMenu",!0),xxdialogMode=999):(QV("topMenu",!1),xxdialogMode=0):(QV("topMenu",!1),xxdialogMode=0,1==e&&3!=xxcurrentView&&goForward("account"),2==e&&5!=xxcurrentView&&goForward("files")))}var backStack=[];function goBack(){xxdialogMode||(0<backStack.length&&backStack.pop(),goStack())}function goForward(e){xxdialogMode||(backStack.push(e),goStack())}function goStack(){var e,t;0==backStack.length?go(2):("node"==(t=(e=backStack[backStack.length-1]).split("/")[0])&&(setupDeviceMenu(0),gotoDevice(e)),"mesh"==t&&gotoMesh(e),"account"==t&&go(3),"devices"==t&&go(2),"files"==t&&(262144&features&&!(1==userinfo.otpsecret||0<userinfo.otphkeys||0<userinfo.otpkeys||8388608&features&&1==userinfo.otpekey)?setDialogMode(2,"Nastavení zabezpečení",1,null,'Unable to access this feature until two-factor authentication is enabled. This is required for extra security. Go to the "My Account" and look at the "Account Security" section.'):go(5)))}function updateFooterMenu(e){for(;null!=e&&e.length<3;)e.push({n:""});var t="",n="";if(null!=e)for(var o in e)t+='<td style="cursor:pointer'+(""==n?"":";border-left:solid 1px white")+'" onclick="'+e[o].f+'">'+e[o].n,n=e[o].n;QH("footerMenu","<tr>"+t)}function account_viewPreviousLogins(){xxdialogMode||(setDialogMode(2,"Předchozí přihlášení",1,null,"Načítání…","previousLogins"),meshserver.send({action:"previousLogins"}))}function account_manageImage(e){var t,n,o,a;xxdialogMode||(setDialogMode(2,"Spravovat obrázek účtu",7,account_manageImageEx2,'<input id=p2file type=file style=width:100% accept="image/*" onchange=account_manageImageEx()><div style=width:100%><canvas id=p2canvas width=256 height=256 style="width:256px;height:256px;margin-left:12px;margin-top:8px;border-radius:16px;box-shadow: 0px 0px 15px #000" onclick=account_canvasClick() /></div>',(t=0==e?userinfo:currentUser)._id),n=Q("p2canvas").getContext("2d"),null==t.accountImageRnd&&(t.accountImageRnd=Math.floor(9999999999*Math.random())),o="",1==e&&(o="&id="+t._id.split("/")[2]),(a=new Image).onload=function(){n.clearRect(0,0,256,256),n.drawImage(a,0,0)},a.src=null!=t.flags&&1&t.flags?"userimage.ashx?rnd="+t.accountImageRnd+o:"images/user-256.png",QE("idx_dlgDeleteButton",null!=t.flags&&1&t.flags),QE("idx_dlgOkButton",!1))}function account_canvasClick(){Q("p2file").click()}function account_manageImageEx(){var e=Q("p2file").files[0],a=new Image;a.onload=function(){var e=0,t=0,n=Math.min(a.width,a.height),o=(a.width>n&&(e=(a.width-n)/2),a.height>n&&(t=(a.height-n)/2),Q("p2canvas").getContext("2d"));o.imageSmoothingEnabled=!0,o.webkitImageSmoothingEnabled=!0,o.mozImageSmoothingEnabled=!0,o.clearRect(0,0,256,256),o.drawImage(a,e,t,n,n,0,0,256,256),QE("idx_dlgOkButton",!0)},a.src=URL.createObjectURL(e)}function account_manageImageEx2(e,t){meshserver.send({action:"updateUserImage",userid:t,image:2==e?0:Q("p2canvas").toDataURL("image/jpeg",.8)})}function toggleNightMode(){var e;xxdialogMode||(setDialogMode(2,"Tmavý režim",3,toggleNightModeEx,"<input type=radio id=night0 name=nightmoderadio value=0 "+(0==(e=getstore("nightMode","0"))?"checked":"")+"><label for=night0>Dle prohlížeče</label><br>"+("<input type=radio id=night2 name=nightmoderadio value=2 "+(2==e?"checked":"")+"><label for=night2>Světlý režim</label><br>")+("<input type=radio id=night1 name=nightmoderadio value=1 "+(1==e?"checked":"")+"><label for=night1>Tmavý režim</label><br>")),QV("uiMenu",!1))}function toggleNightModeEx(){var e="0";Q("night1").checked&&(e="1"),putstore("nightMode",e=Q("night2").checked?"2":e),setNightMode()}function setNightMode(){var e=getstore("nightMode","0");return nightMode=!1,0!=(1048576&features2)&&(e="1"),"1"==(e=0!=(2097152&features2)?"2":e)?nightMode=!0:"0"==e&&window.matchMedia&&(nightMode=window.matchMedia("(prefers-color-scheme: dark)").matches),nightMode?(QC("body").add("night"),QS("body")["background-color"]="#000",QS("body").color="lightgray"):(QC("body").remove("night"),QS("body")["background-color"]="#FFF",QS("body").color="black"),nightMode}function account_managePhone(){xxdialogMode||0==(33554432&features)||(null!=userinfo.phone?(setDialogMode(2,"Telefonní oznámení",3,account_managePhoneRemove,'<table style=width:100%><tr><td style=width:56px><img src="images/phone80.png" style=padding:8px>'+("<td style=text-align:center><div style=padding:6px>Ověřené telefonní číslo</div><div style=font-size:20px>"+userinfo.phone+"</div>")+"<div style=margin:10px><label><input id=d2delPhone type=checkbox onclick=account_managePhoneRemoveValidate() />Odeberte telefonní číslo</label></div>"),account_managePhoneRemoveValidate):(setDialogMode(2,"Telefonní oznámení",3,account_managePhoneAdd,'<table style=width:100%><tr><td style=width:56px><img src="images/phone80.png" style=padding:8px>'+"<td>Enter your SMS capable phone number. Once verified, the number may be used for login verification and other notifications."+'<br /><br /><div style=width:100%;text-align:center>Telefonní číslo: <input type=tel pattern="[0-9]" autocomplete="tel" inputmode="tel" maxlength=18 id=d2phoneinput onKeyUp=account_managePhoneValidate() onkeypress="if (event.key==\'Enter\') account_managePhoneValidate(1)"></div></table>',"verifyPhone"),Q("d2phoneinput").focus(),account_managePhoneValidate))()}function isPhoneNumber(e){return e.match(/^\(?([0-9]{3,4})\)?[-. ]?([0-9]{3})[-. ]?([0-9]{4})$/)}function account_managePhoneValidate(e){var t=isPhoneNumber(Q("d2phoneinput").value);QE("idx_dlgOkButton",t),1==e&&t&&dialogclose(1)}function account_managePhoneCodeValidate(e){var t=6==Q("d2phoneCodeInput").value.length&&Q("d2phoneCodeInput").value.match(/[0-9]/);QE("idx_dlgOkButton",t),1==e&&t&&dialogclose(1)}function account_managePhoneConfirm(e,t){meshserver.send({action:"confirmPhone",code:Q("d2phoneCodeInput").value,cookie:t})}function account_managePhoneAdd(){0!=isPhoneNumber(Q("d2phoneinput").value)&&(QE("d2phoneinput",!1),meshserver.send({action:"verifyPhone",phone:Q("d2phoneinput").value}))}function account_managePhoneRemove(){Q("d2delPhone").checked&&meshserver.send({action:"removePhone"})}function account_managePhoneRemoveValidate(){QE("idx_dlgOkButton",Q("d2delPhone").checked)}function account_manageAuthEmail(){var e;xxdialogMode||0==(8388608&features)||setDialogMode(2,"Ověřování e-mailem",1,function(){e!=Q("email2facheck").checked&&meshserver.send({action:"otpemail",enabled:Q("email2facheck").checked})},"Pokud je tato možnost povolena, při každém přihlášení budete mít možnost dostávat přihlašovací token na váš e-mailový účet pro zvýšení bezpečnosti.<br /><br /><label><input id=email2facheck type=checkbox "+((e=1==userinfo.otpekey&&null!=userinfo.email&&1==userinfo.emailVerified)?"checked":"")+"/>Povolit e-mailovou dvoufaktorovou autentizaci.</label>")}var d3filetreelinkpath,loclist={af:"afrikánština",sq:"albánština",ar:"arabština (standardní)","ar-dz":"arabština (Alžír)","ar-bh":"arabština (Bahrajn)","ar-eg":"arabština (Egypt)","ar-iq":"arabština (Irák)","ar-jo":"arabština (Jordánsko)","ar-kw":"arabština (Kuvajt)","ar-lb":"arabština (Libanon)","ar-ly":"arabština (Libye)","ar-ma":"arabština (Maroko)","ar-om":"arabština (Omán)","ar-qa":"arabština (Katar)","ar-sa":"arabština (Saudská Arábie)","ar-sy":"arabština (Sýrie)","ar-tn":"arabština (Tunisko)","ar-ae":"arabština (Spojené Emiráty)","ar-ye":"arabština (Jemen)",an:"aragonština",hy:"arménština",as:"asámština",ast:"asturština",az:"azerbájdžánština",eu:"baskičtina",bg:"bulharština",be:"běloruština",bn:"bengálština",bs:"bosenština",br:"bretonština",my:"barmština",ca:"katalánština",ch:"chamorro",ce:"čečenština",zh:"čínština","zh-hk":"čínština (Hong Kong)","zh-cn":"čínština (PRC)","zh-sg":"čínština (Singapur)","zh-tw":"čínština (Taiwan)",cv:"čuvaština",co:"korsičtina",cr:"kríjština",hr:"chorvatština",cs:"čeština",da:"dánština",nl:"nizozemština (standardní)","nl-be":"nizozemština (Belgie)",en:"angličtina","en-au":"angličtina (Austrálie)","en-bz":"angličtina (Belize)","en-ca":"angličtina (Kanada)","en-ie":"angličtina (Irsko)","en-jm":"angličtina (Jamajka)","en-nz":"angličtina (Nový Zéland)","en-ph":"angličtina (Filipíny)","en-za":"angličtina (Jihoafrická Republika)","en-tt":"angličtina (Trinidad a Tobago)","en-gb":"angličtina (Velká Británie)","en-us":"angličtina (Spojené státy americké)","en-zw":"angličtina (Zimbabwe)",eo:"esperanto",et:"estonština",fo:"faerština",fa:"Farsi (perština)",fj:"fidžijština",fi:"finština",fr:"francouzština (standardní)","fr-be":"francouzština (Belgie)","fr-ca":"francouzština (Kanada)","fr-fr":"francouzština (Francie)","fr-lu":"francouzština (Lucembursko)","fr-mc":"francouzština (Monako)","fr-ch":"francouzština (Švýcarsko)",fy:"fríština",fur:"furlanština",gd:"gaelština (skotská)","gd-ie":"gaelština (irská)",gl:"galicijština",ka:"gruzínština",de:"němčina (standardní)","de-at":"němčina (Rakousko)","de-de":"němčina (Německo)","de-li":"němčina (Lichtenštejnsko)","de-lu":"němčina (Lucembursko)","de-ch":"němčina (Švýcarsko)",el:"řečtina",gu:"gudžarátština",ht:"haitština",he:"hebrejština",hi:"hindština",hu:"maďarština",is:"islandština",id:"indonézština",iu:"inuktitutština",ga:"irština",it:"italština (standardní)","it-ch":"italština (Švýcarsko)",ja:"japonština",kn:"kannadština",ks:"kašmírština",kk:"kazaština",km:"khmerština",ky:"kyrgyzština",tlh:"klingonština",ko:"korejština","ko-kp":"korejština (Severní Korea)","ko-kr":"korejština (Jižní Korea)",la:"latina",lv:"lotyština",lt:"lotyština",lb:"lucemburština",mk:"FYRO makedonština",ms:"malajština",ml:"malajálamština",mt:"maltština",mi:"maorština",mr:"maráthština",mo:"moldavština",nv:"navažština",ng:"ndondština",ne:"nepálština",no:"norština",nb:"norština (bokmål)",nn:"norština (nynorsk)",oc:"okcitánština",or:"urijština",om:"oromština","fa-ir":"perština/Írán",pl:"polština",pt:"portugalština","pt-br":"portugalština (Brazílie)",pa:"paňdžábština","pa-in":"paňdžábština (Indie)","pa-pk":"paňdžábština (Pákistán)",qu:"kečuánština",rm:"rétorománština",ro:"rumunština","ro-mo":"rumunština (Moldavsko)",ru:"ruština","ru-mo":"ruština (Moldavsko)",sz:"sámština (Lulejská)",sg:"sanžština",sa:"sanskrt",sc:"sardinština",sd:"sindhština",si:"sinhálština",sr:"srbština",sk:"slovenština",sl:"slovinština",so:"Somani",sb:"lužická srbština",es:"španělština","es-ar":"španělština (Argentina)","es-bo":"španělština (Bolívie)","es-cl":"španělština (Chile)","es-co":"španělština (Kolumbie)","es-cr":"španělština (Kostarika)","es-do":"španělština (Dominikánská republika)","es-ec":"španělština (Ekvádor)","es-sv":"španělština (Salvador)","es-gt":"španělština (Guatemala)","es-hn":"španělština (Honduras)","es-mx":"španělština (Mexiko)","es-ni":"španělština (Nikaragua)","es-pa":"španělština (Panama)","es-py":"španělština (Paraguay)","es-pe":"španělština (Peru)","es-pr":"španělština (Portoriko)","es-es":"španělština (Španělsko)","es-uy":"španělština (Uruguay)","es-ve":"španělština (Venezuela)",sx:"Sutu",sw:"svahilština",sv:"švédština","sv-fi":"švédština (Finsko)","sv-sv":"švédština (Švédsko)",ta:"tamilština",tt:"tatarština",te:"telugština",th:"thajština",tig:"Tigre",ts:"Tsonga",tn:"setswanština",tr:"turečtina",tk:"turkmenština",uk:"ukrajinština",hsb:"hornolužická srbština",ur:"urdština",ve:"Venda",vi:"vietnamština",vo:"volapük",wa:"valonština",cy:"velština",xh:"xhoština",ji:"jidiš",zu:"zuluština"},loclistex={"zh-chs":"Zjednodušená čínština)","zh-cht":"Čínština (tradiční)"};function account_showLocalizationSettings(){if(!xxdialogMode){var e=getstore("loctag",0),t="",n='<select id=d2locselect style=width:180px><option value="*">Převzít z webového prohlížeče</option>';for(o in loclist)n+='<option value="'+o+'"'+(e==o?" selected":"")+">"+o+" - "+loclist[o]+"</option>";if(n+="</select>",serverinfo.languages&&0<serverinfo.languages.length){t+="Změna jazyka vyžaduje znovunačtení stránky.<br /><br />";var o,a='<select id=d2langselect style=width:180px><option value="*">Převzít z webového prohlížeče</option>';for(o in serverinfo.languages){var i=serverinfo.languages[o];a+='<option value="'+i+'"'+(userinfo.lang==i?" selected":"")+">"+i+" - "+(loclist[i]||loclistex[i])+"</option>"}t+=addHtmlValue("Jazyk",a+="</select>")}t+=addHtmlValue("Datum a čas",n),4294967295==userinfo.siteadmin&&""==domain&&(t+='<br /><a rel="noreferrer noopener" target="_blank" href="translator.htm">Pomozte MeshCentral přeložit do svého jazyka</a>'),setDialogMode(2,"Nastavení lokalizace",3,account_showLocalizationSettingsEx,t)}return!1}function account_showLocalizationSettingsEx(){var e=Q("d2langselect").value,e=((e="*"==e&&null==userinfo.lang?userinfo.lang:e)!=userinfo.lang&&meshserver.send({action:"changelang",lang:e}),getstore("loctag",0)),t=Q("d2locselect").value;e!=t&&("*"!=t?args.locale=t:delete args.locale,putstore("loctag",args.locale),mainUpdate(4294967295))}function account_manageAuthApp(){xxdialogMode||0==(4096&features)||(1==userinfo.otpsecret?account_removeOtp:account_addOtp)()}function account_addOtp(){xxdialogMode||1==userinfo.otpsecret||0==(4096&features)||(setDialogMode(2,"Aplikace pro ověřování se",2,function(){meshserver.send({action:"otpauth-setup",secret:Q("d2optsecret").attributes.secret.value,token:Q("d2otpauthinput").value})},"<div id=d2optinfo>Načítání…</div>","otpauth-request"),meshserver.send({action:"otpauth-request"}))}function account_addOtpCheck(e){var t=6==Q("d2otpauthinput").value.length;QE("idx_dlgOkButton",t),e&&13==e.keyCode&&t&&dialogclose(1)}function account_removeOtp(){xxdialogMode||1!=userinfo.otpsecret||0==(4096&features)||setDialogMode(2,"Aplikace pro ověřování se",3,function(){meshserver.send({action:"otpauth-clear"})},"Potvrdit odstranění aplikace pro 2-faktorové ověřování se?")}function account_manageOtp(e){2==xxdialogMode&&"otpauth-manage"==xxdialogTag&&dialogclose(0),xxdialogMode||0==(4096&features)||1!=userinfo.otpsecret&&userinfo.otphkeys<1||meshserver.send({action:"otpauth-getpasswords",subaction:e})}function account_showVerifyEmail(){xxdialogMode||1==userinfo.emailVerified||1!=serverinfo.emailcheck||setDialogMode(2,"Ověření e-mailu",3,account_showVerifyEmailEx,"Klikněte na OK a bude vám zaslán ověřovací e-mail na:<br /><div style=padding:8px><b>"+EscapeHtml(userinfo.email)+"</b></div>Počkejte pár minut než dojde k ověření.")}function account_showVerifyEmailEx(){meshserver.send({action:"verifyemail",email:userinfo.email})}function account_showChangeEmail(){xxdialogMode||(setDialogMode(2,"Změna e-mailové adresy",3,account_changeEmail,addHtmlValue("E-mail","<input id=dp3email style=width:170px maxlength=256 onchange=account_validateEmail() onkeyup=account_validateEmail(event) />")),null!=userinfo.email&&(Q("dp3email").value=userinfo.email),account_validateEmail(),Q("dp3email").focus())}function account_validateEmail(e,t){QE("idx_dlgOkButton",validateEmail(Q("dp3email").value)&&Q("dp3email").value!=userinfo.email),null!=e&&13==e.keyCode&&dialogclose(1)}function account_changeEmail(){meshserver.send({action:"changeemail",email:Q("dp3email").value})}function account_showDeleteAccount(){xxdialogMode||(setDialogMode(2,"Smazat účet",0,null,"<form method=post><table style=margin-left:10px><input type=hidden name=action value=deleteaccount /><input type=hidden name=authcookie value="+authCookie+" /><tr>"+"<td align=right>Heslo:</td><td><input id=apassword1 type=password name=apassword1 autocomplete=off onchange=account_validateDeleteAccount() onkeyup=account_validateDeleteAccount() /></td>"+"</tr><tr><td align=right>Heslo:</td><td><input id=apassword2 type=password name=apassword2 autocomplete=off onchange=account_validateDeleteAccount() onkeyup=account_validateDeleteAccount() /></td>"+"</tr></table><div style=padding:10px;margin-bottom:4px>"+'<input id=account_dlgCancelButton type=button value="Storno" style=float:right;width:80px;margin-left:5px onclick=dialogclose(0)>'+'<input id=account_dlgOkButton type=submit value="OK" style="float:right;width:80px" onclick=dialogclose(1)>'+"</div><br /></form>"),account_validateDeleteAccount(),Q("apassword1").focus())}function account_showChangePassword(){if(!xxdialogMode){var e="<table style=margin-left:10px>",e=(e=(e+="<tr><td align=right>"+nobreak("Dosavadní heslo:")+"</td><td><input id=apassword0 type=password name=apassword0 autocomplete=off onchange=account_validateNewPassword() onkeyup=account_validateNewPassword() onkeydown=account_validateNewPassword() /> <b></b></td></tr>")+("<tr><td align=right>"+nobreak("Nové heslo:")+"</td><td><input id=apassword1 type=password name=apassword1 autocomplete=off onchange=account_validateNewPassword() onkeyup=account_validateNewPassword() onkeydown=account_validateNewPassword() /> <b><span id=dxPassWarn></span></b></td></tr>"))+("<tr><td align=right>"+nobreak("Nové heslo:")+"</td><td><input id=apassword2 type=password name=apassword2 autocomplete=off onchange=account_validateNewPassword() onkeyup=account_validateNewPassword() onkeydown=account_validateNewPassword() /></td></tr>");if(65536&features&&(e+="<tr><td align=right>Nápověda k heslu:</td><td><input id=apasswordhint name=apasswordhint maxlength=250 type=text autocomplete=off onchange=account_validateNewPassword() onkeyup=account_validateNewPassword() onkeydown=account_validateNewPassword() /></td></tr>"),e+="</table>",passRequirements){var t,n=[],o=0;for(t in passRequirements)"reset"!=t&&"hint"!=t&&(n.push(t+":"+passRequirements[t]),o++);0<o&&(e+="<br /><span style=font-size:x-small>"+format("Požadavky: {0}.",n.join(", "))+"</span>")}setDialogMode(2,"Změnit heslo",3,account_showChangePasswordEx,e+="<br />"),Q("apassword0").focus(),account_validateNewPassword()}return!1}function account_showChangePasswordEx(){var e;Q("apassword1").value==Q("apassword2").value&&(e={action:"changepassword",oldpass:Q("apassword0").value,newpass:Q("apassword1").value},65536&features&&(e.hint=Q("apasswordhint").value),meshserver.send(e))}function account_createMesh(){var e;xxdialogMode||(4294967295!=userinfo.siteadmin&&0!=(64&userinfo.siteadmin)?setDialogMode(2,"Nová skupina zařízení",1,null,"Tento účet nemá práva k vytvoření nové skupiny zařízení."):!0!==userinfo.emailVerified&&1==serverinfo.emailcheck&&4294967295!=userinfo.siteadmin?setDialogMode(2,"Nastavení zabezpečení",1,null,"Nedaří se získat přístup k zařízení, dokud nebude ověřena e-mailová adresa. To je vyžadováno pro obnovení hesla. Přejděte do „Můj účet“ a změňte si a ověřte e-mailovou adresu."):262144&features&&!(1==userinfo.otpsecret||0<userinfo.otphkeys||0<userinfo.otpkeys||8388608&features&&1==userinfo.otpekey)?setDialogMode(2,"Nastavení zabezpečení",1,null,"Nedaří se získat přístup k zařízení, dokud není zapnuté 2-faktorové ověřování se. Toto je vyžadováno pro extra zabezpečení. Přejděte do „Můj účet“ a podívejte se do sekce „Zabezpečení účtu“."):(e=addHtmlValue("Název","<input id=dp3meshname style=width:170px maxlength=64 onchange=account_validateMeshCreate() onkeyup=account_validateMeshCreate() />"),setDialogMode(2,"Vytvořit skupinu zařízení",3,account_createMeshEx,e=(e+=addHtmlValue("Typ","<div style=width:170px;margin:0;padding:0><select id=dp3meshtype style=width:100% onchange=account_validateMeshCreate() ><option value=2>Skupina softwarového agenta</option><option value=1>Pouze Intel&reg; AMT</option></select></div>"))+addHtmlValue("Popis","<div style=width:170px;margin:0;padding:0><textarea id=dp3meshdesc maxlength=1024 style=width:100%;resize:none></textarea></div>")),account_validateMeshCreate(),Q("dp3meshname").focus()))}function account_validateMeshCreate(){QE("idx_dlgOkButton",0<Q("dp3meshname").value.length)}function account_createMeshEx(e,t){meshserver.send({action:"createmesh",meshname:Q("dp3meshname").value,meshtype:parseInt(Q("dp3meshtype").value),desc:Q("dp3meshdesc").value})}function account_validateDeleteAccount(){QE("account_dlgOkButton",0<Q("apassword1").value.length&&Q("apassword1").value==Q("apassword2").value)}function account_validateNewPassword(){var e,t="",n=0<Q("apassword0").value.length&&0<Q("apassword1").value.length&&Q("apassword1").value==Q("apassword2").value&&Q("apassword0").value!=Q("apassword1").value;65536&features&&Q("apasswordhint").value==Q("apassword1").value&&(n=!1),""!=Q("apassword1").value&&(null==passRequirements||""==passRequirements?t=80<=(e=checkPasswordStrength(Q("apassword1").value))?"<span style=color:green>Strong<span>":60<=e?"<span style=color:blue>&#9679;<span>":"<span style=color:red>&#9679;<span>":0==checkPasswordRequirements(Q("apassword1").value,passRequirements)&&(n=!1,t="<span style=color:red>Zásada<span>")),QH("dxPassWarn",t),QE("idx_dlgOkButton",n)}function checkPasswordStrength(e){var t=0,n={},o=0,a={digits:/\d/.test(e),lower:/[a-z]/.test(e),upper:/[A-Z]/.test(e),nonWords:/\W/.test(e)};if(!e)return 0;for(var i,s=0;s<e.length;s++)n[e[s]]=(n[e[s]]||0)+1,t+=5/n[e[s]];for(i in a)o+=1==a[i]?1:0;return parseInt(t+10*(o-1))}function checkPasswordRequirements(e,t){if(null==t||""==t||"object"!=typeof t)return!0;if(t.min&&e.length<t.min)return!1;if(t.max&&e.length>t.max)return!1;for(var n=0,o=0,a=0,i=0,s=0;s<e.length;s++)/\d/.test(e[s])&&n++,/[a-z]/.test(e[s])&&o++,/[A-Z]/.test(e[s])&&a++,/\W/.test(e[s])&&i++;return!(t.numeric&&n<t.numeric||t.lower&&o<t.lower||t.upper&&a<t.upper||t.nonalpha&&i<t.nonalpha)}function updateMeshes(){var e="",t=0;for(i in meshes){t++;var n=GetMeshRights(meshes[i]),o="Částečná práva";4294967295==n?o="Administrátor":0==n&&(o="Žádná práva"),e=(e=(e+="<div style=cursor:pointer onclick=goForward('"+i+"')>")+'<div style="float:left;margin-left:4px"><img src="/images/meshicon50.png" width=50 height=50 /></div>'+"<div class=meshList>")+("<div><div style=color:black;padding-left:12px;padding-top:2px><b>"+EscapeHtml(meshes[i].name)+"</b></div><div style=padding-left:12px;padding-top:3px;color:black>"+o+"</div></div>")+"</div></div>"}QH("p3meshes",e),QV("p3noMeshFound",0==t)}function gotoMesh(e){262144&features&&!(1==userinfo.otpsecret||0<userinfo.otphkeys||0<userinfo.otpkeys||8388608&features&&1==userinfo.otpekey)?setDialogMode(2,"Nastavení zabezpečení",1,null,'Unable to access this feature until two-factor authentication is enabled. This is required for extra security. Go to the "My Account" and look at the "Account Security" section.'):(null==(currentMesh=meshes[e])&&goBack(),p20updateMesh(),go(20))}function d3init(){d3fileoptions={dialog:1,filter:"d3filter",files:"d3serverfiles",folderup:"p3FolderUp",currentFolder:"p3CurrentFolder",func:d3setActions},Q("d3localFile").value="",Q("d3localFile").accept=Q("d3filter").value,d3modechange()}function d3modechange(){var e=Q("d3uploadMode").value;QV("d3localmode",1==e),QV("d3servermode",2==e),(1==e?d3setActions:d3updatefiles)()}var filetreelinkpath,d3filetreelocation=[],d3fileoptions=null;function d3updatefiles(){if(null!=d3fileoptions&&("d3filter"!=d3fileoptions.filter||1!=Q("d3uploadMode").value)){for(var e,t="",n="",o=filetree,a=1,i="",s=[],l=[],r=document.getElementsByName("fc"),d=0;d<r.length;d++)r[d].checked&&l.push(r[d].value);for(d in d3filetreelinkpath="",d3filetreelocation){if(null==o.f||null==o.f[d3filetreelocation[d]])break;s.push(d3filetreelocation[d]),1==a?(e=d3filetreelocation[d].split("/"),window.location.origin,e[0],d3filetreelocation[d]===userinfo._id?d3filetreelinkpath+="self":d3filetreelinkpath+=e[0]+"/"+e[2]):""!=d3filetreelinkpath&&(d3filetreelinkpath+="/"+d3filetreelocation[d],2<a)&&d3filetreelocation[d],i=(o=o.f[d3filetreelocation[d]]).n,a++}d3filetreelocation=s;var u=p5sort_files(o.f),c="";for(d in d3fileoptions.filter&&(c=Q(d3fileoptions.filter).value),u){var p,m,g=u[d],h=g.n;3==g.t&&""!=c&&0==g.nx.toLowerCase().endsWith(c)||(h=70<h.length?'<span title="'+EscapeHtml(h)+'">'+EscapeHtml(h.substring(0,70))+"…</span>":EscapeHtml(h),p="",null!=g.s&&(p=getFileSizeStr(g.s)),m="",m=3!=g.t?'<div class=filelist file=999><span style=float:right title=""></span><span><div class=fileIcon'+g.t+' onclick=d3folderset("'+encodeURIComponentEx(g.nx)+'")></div>&nbsp;<a href=# style=cursor:pointer onclick=\'return d3folderset("'+encodeURIComponentEx(g.nx)+"\")'>"+h+"</a></span></div>":(h=h,'<div class=filelist file=3><input style=float:left name=fcx class=fcb type=checkbox onchange=d3setActions() value="'+g.nx+'">&nbsp;<span style=float:right>'+EscapeHtml(p)+"</span><span><div class=fileIcon"+g.t+"></div>"+h+"</span></div>"),g.t<3?t+=m:n+=m)}d3fileoptions.currentFolder&&QH(d3fileoptions.currentFolder,i),QH(d3fileoptions.files,t+n),QE(d3fileoptions.folderup,0<d3filetreelocation.length),d3fileoptions.func&&d3fileoptions.func()}}function d3folderset(e){return d3filetreelocation.push(decodeURIComponent(e)),d3updatefiles(),!1}function d3folderup(e){if(null==e)d3filetreelocation.pop();else for(;d3filetreelocation.length>e;)d3filetreelocation.pop();d3updatefiles()}function d3getFileSel(){for(var e=[],t=document.getElementsByName("fcx"),n=0;n<t.length;n++)t[n].checked&&e.push(t[n].value);return e}function d3setActions(){1==d3fileoptions.dialog?1==Q("d3uploadMode").value?QE("idx_dlgOkButton",0<Q("d3localFile").value.length):QE("idx_dlgOkButton",1==d3getFileSel().length):2==d3fileoptions.dialog&&QE("idx_dlgOkButton",1==d3getFileSel().length)}var sortorder,filetreelocation=[];function p5refreshFiles(){meshserver.send({action:"files"})}function updateFiles(){if(QV("MainMenuMyFiles",0==(8&features)),0==(8&features)){for(var e,t,n="",o="",a="<a style=cursor:pointer;color:black onclick=p5folderup(0)>Root</a>",i="Root",s=filetree,l=1,r=[],d=filetreelinkpath,u=[],c=document.getElementsByName("fc"),p=0;p<c.length;p++)c[p].checked&&u.push(c[p].value);for(p in filetreelinkpath="",filetreelocation){if(null==s.f||null==s.f[filetreelocation[p]])break;r.push(filetreelocation[p]),i+=" / "+filetreelocation[p],1==l?(e=filetreelocation[p].split("/"),t=window.location.origin+domainUrl+e[0]+"files/"+e[2],filetreelinkpath+=filetreelocation[p]):""!=filetreelinkpath&&(filetreelinkpath+="/"+filetreelocation[p],2<l)&&(t+="/"+filetreelocation[p]),s=s.f[filetreelocation[p]],a+=" / <a style=cursor:pointer;color:black onclick=p5folderup("+l+")>"+EscapeHtml(null!=s.n?s.n:filetreelocation[p])+"</a>",l++}filetreelocation=r;var m=i.toLowerCase().startsWith("root / "+userinfo._id+" / public"),g=p5sort_files(s.f);for(p in g){var h,v=g[p],f=v.n,k=40<f.length?EscapeHtml(f.substring(0,40))+"…":EscapeHtml(f),y="",b=(null!=v.s&&(y=getFileSizeStr(v.s)),"");b=v.t<3||4==v.t?(h=1==v.t||4==v.t?p5getQuotabar(v):"","<div class=filelist file=999><input file=999 style=float:left name=fc class=fcb type=checkbox onchange=p5setActions() value='"+EscapeHtml(f)+"'>&nbsp;<span style=float:right;padding-right:4px>"+h+"</span><span><div class=fileIcon"+v.t+'></div><a style=cursor:pointer onclick=p5folderset("'+encodeURIComponent(v.nx)+'")>'+k+"</a></span></div>"):(f=k,h="",m&&(h=" (<a style=cursor:pointer onclick='p5showPublicLink(\""+t+"/"+v.nx+"\")'>Odkaz</a>)"),0<v.s&&(f='<a rel="noreferrer noopener" target="_blank" href="downloadfile.ashx?link='+encodeURIComponent(filetreelinkpath+"/"+v.nx)+'">'+k+"</a>"+h),"<div class=filelist file=3><input file=3 style=float:left name=fc class=fcb type=checkbox onchange=p5setActions() value='"+v.nx+"'>&nbsp;<span style=float:right;padding-right:4px>"+EscapeHtml(y)+"</span><span><div class=fileIcon"+v.t+"></div>"+f+"</span></div>"),v.t<3?n+=b:o+=b}if(QH("p5rightOfButtons",p5getQuotabar(s)),QH("p5files",n+o),QH("p5currentpath",a),QE("p5FolderUp",0!=filetreelocation.length),QV("p5PublicShare",m),d==filetreelinkpath)for(c=document.getElementsByName("fc"),p=0;p<c.length;p++)c[p].checked=0<=u.indexOf(c[p].value);p5setActions()}}function getNiceSize(e){return e<=0?"Uložiště plné":e<2048?format("{0}b zbývá",e):e<2097152?format("{0}k zbývá",Math.round(e/1024)):e<2147483648?format("{0}m zbývá",Math.round(e/1024/1024)):format("{0}g zbývá",Math.round(e/1024/1024/1024))}function p5getQuotabar(e){for(;1<e.t&&4!=e.t;)e=e.parent;return 1!=e.t&&4!=e.t||null==e.maxbytes?"":getNiceSize(e.maxbytes-e.s)+" <progress style=height:10px;width:100px value="+e.s+" max="+e.maxbytes+" />"}function p5showPublicLink(e){setDialogMode(2,"Veřejný odkaz",1,null,'<input type=text style=width:100% value="'+e+'" readonly />')}function p5sort_filename(e,t){return e.ln>t.ln?+sortorder:e.ln<t.ln?-1*sortorder:0}function p5sort_timestamp(e,t){return e.d>t.d?+sortorder:e.d<t.d?-1*sortorder:0}function p5sort_bysize(e,t){return e.s==t.s?p5sort_filename(e,t):(e.s-t.s)*sortorder}function p5sort_files(e){var t,n=[],o=Q("p5sortdropdown").value;for(t in e)e[t].nx=t,null==e[t].n&&(e[t].n=t),e[t].ln=e[t].n.toLowerCase(),n.push(e[t]);return sortorder=1,3<o&&(sortorder=-1,o-=3),1==o?n.sort(p5sort_filename):2==o?n.sort(p5sort_bysize):3==o&&n.sort(p5sort_timestamp),n}function p5setActions(){var e=getFileSelCount(),t=getFileCount(),n=getFileSelCount(!1);QE("p5DeleteFileButton",0<e&&0<filetreelocation.length),QE("p5NewFolderButton",0<filetreelocation.length),QE("p5UploadButton",0<filetreelocation.length),QE("p5RenameFileButton",1==e&&0<filetreelocation.length),QE("p5SelectAllButton",0<t),Q("p5SelectAllButton").value=0<e?"Nic":"Vše",QE("p5CutButton",0<n&&e==n),QE("p5CopyButton",0<n&&e==n),QE("p5PasteButton",null!=p5clipboard&&0<p5clipboard.length&&0<filetreelocation.length)}function getFileSelCount(e){for(var t=0,n=document.getElementsByName("fc"),o=0;o<n.length;o++)!n[o].checked||0==e&&"3"!=n[o].attributes.file.value||t++;return t}function getFileSelDirCount(){for(var e=0,t=document.getElementsByName("fc"),n=0;n<t.length;n++)t[n].checked&&"999"==t[n].attributes.file.value&&e++;return e}function getFileCount(){return document.getElementsByName("fc").length}function p5selectallfile(){for(var e=0==getFileSelCount(),t=document.getElementsByName("fc"),n=0;n<t.length;n++)t[n].checked=e;p5setActions()}function setupBackPointers(e){if(null!=e.f){var t,n=0,o=0;for(t in e.f)setupBackPointers(e.f[t]),(e.f[t].parent=e).f[t].s&&(n+=e.f[t].s),e.f[t].c&&(o+=e.f[t].c),3==e.f[t].t&&o++;e.s=n,e.c=o}return e}function getFileSizeStr(e){return 1==e?"1 bajt":format("{0} bajtů",e)}function p5folderup(e){if(null==e)filetreelocation.pop();else for(;filetreelocation.length>e;)filetreelocation.pop();return updateFiles(),!1}function p5folderset(e){return filetreelocation.push(decodeURIComponent(e)),updateFiles(),!1}function p5createfolder(){setDialogMode(2,"Nová složka",3,p5createfolderEx,"<input type=text id=p5renameinput maxlength=64 onkeyup=p5fileNameCheck(event) style=width:100% />"),focusTextBox("p5renameinput"),p5fileNameCheck()}function p5createfolderEx(){meshserver.send({action:"fileoperation",fileop:"createfolder",path:filetreelocation,newfolder:Q("p5renameinput").value})}function p5deletefile(){var e=getFileSelCount(),t=0<getFileSelDirCount()?"<br /><br /><label><input type=checkbox id=p5recdeleteinput>Rekurzivní mazání</label><br>":"<input type=checkbox id=p5recdeleteinput style='display:none'>";setDialogMode(2,"Smazat",3,p5deletefileEx,1<e?format("Smazat {0} vybrané prvky?",e)+t:"Smazat vybraný prvek?"+t)}function p5deletefileEx(){for(var e=[],t=document.getElementsByName("fc"),n=0;n<t.length;n++)t[n].checked&&e.push(t[n].value);meshserver.send({action:"fileoperation",fileop:"delete",path:filetreelocation,delfiles:e,rec:Q("p5recdeleteinput").checked})}function p5renamefile(){for(var e,t=document.getElementsByName("fc"),n=0;n<t.length;n++)t[n].checked&&(e=t[n].value);setDialogMode(2,"Přejmenovat",3,p5renamefileEx,'<input type=text id=p5renameinput maxlength=64 onkeyup=p5fileNameCheck(event) style=width:100% value="'+e+'" />',{action:"fileoperation",fileop:"rename",path:filetreelocation,oldname:e}),focusTextBox("p5renameinput"),p5fileNameCheck()}function p5renamefileEx(e,t){t.newname=Q("p5renameinput").value,meshserver.send(t)}function p5fileNameCheck(e){var t=isFilenameValid(Q("p5renameinput").value);QE("idx_dlgOkButton",t),1==t&&e&&13==e.keyCode&&dialogclose(1)}var isFilenameValid=(()=>{var t=/^[^\\/:\*\?"<>\|]+$/,n=/^\./,o=/^(nul|prn|con|lpt[0-9]|com[0-9])(\.|$)/i;return function(e){return t.test(e)&&!n.test(e)&&!o.test(e)&&"."!=e[0]}})();function p5uploadFile(){setDialogMode(2,"Nahrát soubor",3,p5uploadFileEx,'<form method=post enctype=multipart/form-data action=uploadfile.ashx target=fileUploadFrame><input type=text name=link style=display:none id=p5uploadpath value="'+encodeURIComponent(filetreelinkpath)+'" /><input type=file name=files id=p5uploadinput style=width:100% multiple=multiple onchange="updateUploadDialogOk(\'p5uploadinput\')" /><input type=hidden name=authCookie value='+authCookie+" /><input type=submit id=p5loginSubmit style=display:none /></form>"),updateUploadDialogOk("p5uploadinput")}function p5uploadFileEx(){Q("p5loginSubmit").click()}function updateUploadDialogOk(e){QE("idx_dlgOkButton",""!=Q(e).value)}var p5clipboard=null,p5clipboardFolder=null,p5clipboardCut=0;function p5copyFile(e){var t=document.getElementsByName("fc");p5clipboard=[],p5clipboardCut=e,p5clipboardFolder=Clone(filetreelocation);for(var n=0;n<t.length;n++)t[n].checked&&"3"==t[n].attributes.file.value&&p5clipboard.push(t[n].value);p5updateClipview()}function p5pasteFile(){var e="";setDialogMode(2,"Vložit",3,p5pasteFileEx,e=null!=p5clipboard&&0<p5clipboard.length?format("Potvrdit {0} z {1} záznam{2} do tohoto umístění?",0==p5clipboardCut?"copy":"move",p5clipboard.length,1<p5clipboard.length?"s":""):e)}function p5pasteFileEx(){meshserver.send({action:"fileoperation",fileop:0==p5clipboardCut?"copy":"move",scpath:p5clipboardFolder,path:filetreelocation,names:p5clipboard}),p5folderup(999),1==p5clipboardCut&&(p5clipboardFolder=p5clipboard=null,p5clipboardCut=0,p5updateClipview())}function p5updateClipview(){var e="";null!=p5clipboard&&0<p5clipboard.length&&(e=format("Drží se {0} zaznamů{1} pro {2}",p5clipboard.length,1<p5clipboard.length?"s":"",0==p5clipboardCut?"kopírovat":"přesunout")+', <a href=# onclick="return p5clearClip()" style=cursor:pointer>Vymazat</a>.'),QH("p5bottomstatus",e),p5setActions()}function p5clearClip(){return p5clipboardFolder=p5clipboard=null,p5clipboardCut=0,p5updateClipview(),!1}function p5fileDragDrop(e){if(haltEvent(e),QV("bigfail",!1),QV("bigok",!1),null!=e.dataTransfer&&0!=e.dataTransfer.files.length&&0!=filetreelocation.length)for(var t=[],n=[],o=[],a=[],i=e.dataTransfer.files.length,s=0;s<e.dataTransfer.files.length;s++){var l=new FileReader,r=e.dataTransfer.files[s];t.push(r.name),n.push(r.size),o.push(r.type),l.onload=function(e){a.push(e.target.result),0==--i&&(Q("p5fileDragName").value=t.join("*"),Q("p5fileDragSize").value=n.join("*"),Q("p5fileDragType").value=o.join("*"),Q("p5fileDragData").value=a.join("*"),Q("p5fileDragLink").value=encodeURIComponent(filetreelinkpath),Q("p5loginSubmit2").click())},l.readAsDataURL(r)}}var p5dragtimer=null;function p5fileDragOver(e){haltEvent(e),null!=p5dragtimer&&(clearTimeout(p5dragtimer),p5dragtimer=null);e=!0;0==filetreelocation.length&&(e=!1),QV("bigok",e),QV("bigfail",!e)}function p5fileDragLeave(e){haltEvent(e),"p5filetable"!=e.target.id?(QV("bigfail",!1),QV("bigok",!1)):p5dragtimer=setTimeout("QV('bigfail',false);QV('bigok',false);p5dragtimer=null;",200)}function onRealNameCheckBox(){putstore("showRealNames",(showRealNames=Q("RealNameCheckBox").checked)?1:0),mainUpdate(5)}function onOnlineCheckBox(e){putstore("onlineOnly",Q("OnlineCheckBox").checked?1:0),onSearchInputChanged()}function updateDevicePageState(){var e,t;null==devicePagingState||devicePagingState.total<=devicePagingState.limit?(QV("devViewPageState",!1),QV("devViewPageButton2",!1),QV("devViewPageButton3",!1)):(e=Math.floor((devicePagingState.skip+devicePagingState.limit)/devicePagingState.limit),t=Math.ceil(devicePagingState.total/devicePagingState.limit),QV("devViewPageState",!0),QV("devViewPageButton2",!0),QV("devViewPageButton3",!0),QH("devViewPageState",e+"/"+t))}function onDeviceViewPageChange(e){if(null!=devicePagingState){var t=Math.floor((devicePagingState.skip+devicePagingState.limit)/devicePagingState.limit),n=Math.ceil(devicePagingState.total/devicePagingState.limit);switch(e){case 2:1<t&&meshserver.send({action:"nodes",skip:(t-2)*devicePagingState.limit});break;case 3:t<n&&meshserver.send({action:"nodes",skip:t*devicePagingState.limit})}}}function onDeviceSearchChanged(e){setTimeout(function(){onSearchInputChanged()},10)}function clearSearchInput(){Q("SearchInput").value="",Q("OnlineCheckBox").checked=!1,onSearchInputChanged()}function onSearchInputChanged(){var e=Q("SearchInput").value.toLowerCase().trim(),t=(putstore("_search",Q("SearchInput").value),QS("SearchInput")["background-color"]=""==e?"#FFFFFF":"#FDFFBE",null),n=null,o=null,a=null,i=null,s=null,l=null,r=null;if(e.startsWith("uživatel:".toLowerCase())?t=e.substring("uživatel:".length):e.startsWith("u:".toLowerCase())?t=e.substring("u:".length):e.startsWith("ip:".toLowerCase())?n=e.substring("ip:".length):e.startsWith("skupina:".toLowerCase())?o=e.substring("skupina:".length):e.startsWith("s:".toLowerCase())?o=e.substring("s:".length):e.startsWith("štítek:".toLowerCase())?a=Q("SearchInput").value.trim().substring("štítek:".length):e.startsWith("š:".toLowerCase())?a=Q("SearchInput").value.trim().substring("š:".length):e.startsWith("atag:".toLowerCase())?i=Q("SearchInput").value.trim().substring("atag:".length).toLowerCase():e.startsWith("a:".toLowerCase())?i=Q("SearchInput").value.trim().substring("a:".length).toLowerCase():e.startsWith("os:".toLowerCase())?l=Q("SearchInput").value.trim().substring("os:".length).toLowerCase():e.startsWith("amt:".toLowerCase())?r=Q("SearchInput").value.trim().substring("amt:".length).toLowerCase():"wsc:ok"==e?s=1:"wsc:noav"==e?s=2:"wsc:noupdate"==e?s=3:"wsc:nofirewall"==e?s=4:"wsc:any"==e&&(s=5),""==e)for(var d in nodes)nodes[d].v=!0;else if(null!=n)for(var d in nodes)nodes[d].v=null!=nodes[d].ip&&0<=nodes[d].ip.indexOf(n);else if(null!=o)for(var d in nodes)nodes[d].v=0<=meshes[nodes[d].meshid].name.toLowerCase().indexOf(o);else if(null!=a)for(var d in nodes)nodes[d].v=null==nodes[d].tags&&""==a||null!=nodes[d].tags&&0<=nodes[d].tags.indexOf(a);else if(null!=i)for(var d in nodes)nodes[d].v=null!=nodes[d].agent&&null==nodes[d].agent.tag&&""==i||null!=nodes[d].agent&&null!=nodes[d].agent.tag&&0<=nodes[d].agent.tag.toLowerCase().indexOf(i);else if(null!=t){for(var d in nodes)if(nodes[d].v=!1,nodes[d].users&&0<nodes[d].users.length)for(var u in nodes[d].users)0<=nodes[d].users[u].toLowerCase().indexOf(t)&&(nodes[d].v=!0)}else if(null!=l)for(var d in nodes)nodes[d].v=null!=nodes[d].osdesc&&0<=nodes[d].osdesc.toLowerCase().indexOf(l);else if(null!=r)for(var d in nodes)nodes[d].v=null!=nodes[d].intelamt&&(""==r||nodes[d].intelamt.state==r);else if(null!=s)for(var d in nodes)nodes[d].v=!1,!nodes[d].wsc||(1==s&&"OK"==nodes[d].wsc.antiVirus&&"OK"==nodes[d].wsc.autoUpdate&&"OK"==nodes[d].wsc.firewall||(2==s||5==s)&&"OK"!=nodes[d].wsc.antiVirus||(3==s||5==s)&&"OK"!=nodes[d].wsc.autoUpdate||(4==s||5==s)&&"OK"!=nodes[d].wsc.firewall)&&(nodes[d].v=!0);else if("*"==e)for(var d in nodes)nodes[d].v=1==stars[nodes[d]._id];else try{var c=e.split(/\s+/).join("|"),p=new RegExp(c);for(d in nodes)nodes[d].v=32768&features2?268435456&features2?p.test(nodes[d].name.toLowerCase())||p.test(meshes[nodes[d].meshid].name.toLowerCase())||null!=nodes[d].rnamel&&p.test(nodes[d].rnamel.toLowerCase()):p.test(nodes[d].name.toLowerCase())||null!=nodes[d].rnamel&&p.test(nodes[d].rnamel.toLowerCase()):268435456&features2?showRealNames?null!=nodes[d].rnamel&&p.test(nodes[d].rnamel.toLowerCase())||p.test(meshes[nodes[d].meshid].name.toLowerCase()):p.test(nodes[d].name.toLowerCase())||p.test(meshes[nodes[d].meshid].name.toLowerCase()):showRealNames?null!=nodes[d].rnamel&&p.test(nodes[d].rnamel.toLowerCase()):p.test(nodes[d].name.toLowerCase())}catch(e){for(var d in nodes)nodes[d].v=!0}if(Q("OnlineCheckBox").checked)for(var d in nodes)null!=nodes[d].conn&&0!=nodes[d].conn||(nodes[d].v=!1);mainUpdate(4)}var gotKeyPressEvent=!1;function ondeskkeypress(e,t){if(setSessionActivity(),desktop&&!xxdialogMode&&10==xxcurrentView&&1==currentDevicePanel){if(gotKeyPressEvent=!0,Q("softKeyboard").value="",null!=currentNode){var n=GetMeshRights(currentNode.meshid);if(0==(0==(8192&features2)&&(4294967295==n||0!=(8&n)&&0==(256&n))))return!1;n=4294967295!=n&&0!=(8&n)&&0==(256&n)&&0!=(4096&n);if(1==n&&(1==e.altKey||1==e.ctrlKey||e.keyCode<32&&8!=e.keyCode&&13!=e.keyCode||90<e.keyCode))return!1}return desktop.m.handleKeys(e)}if(terminal&&!xxdialogMode&&10==xxcurrentView&&5==currentDevicePanel&&1!==t){if(1==e.altKey)return!0;gotKeyPressEvent=!0,Q("softKeyboard").value="";n=0;return 0!=e.charCode?n=e.charCode:0!=e.keyCode&&(n=e.keyCode),0!=n&&("sshterminalrelay.ashx"==terminal.urlname?terminal.socket.send("~"+String.fromCharCode(n)):terminal.sendText(String.fromCharCode(n))),!1}}function ondeskkeydown(e,t){if(setSessionActivity(),desktop&&!xxdialogMode&&10==xxcurrentView&&1==currentDevicePanel){if(gotKeyPressEvent=!1,Q("softKeyboard").value="",null!=currentNode){var n=GetMeshRights(currentNode.meshid);if(0==(0==(8192&features2)&&(4294967295==n||0!=(8&n)&&0==(256&n))))return!1;n=4294967295!=n&&0!=(8&n)&&0==(256&n)&&0!=(4096&n);if(1==n&&(1==e.altKey||1==e.ctrlKey||e.keyCode<32&&8!=e.keyCode&&13!=e.keyCode||90<e.keyCode))return!1}return desktop.m.handleKeyDown(e)}if(terminal&&!xxdialogMode&&10==xxcurrentView&&5==currentDevicePanel&&1!==t){if(1==e.altKey)return!0;Q("softKeyboard").value="",gotKeyPressEvent=!1;n=0;0!=e.charCode?n=e.charCode:0!=e.keyCode&&(n=e.keyCode),8==n?"sshterminalrelay.ashx"==terminal.urlname?terminal.socket.send("~"+String.fromCharCode(n)):terminal.sendText(String.fromCharCode(n)):e.ctrlKey&&64<=n&&n<=95&&("sshterminalrelay.ashx"==terminal.urlname?terminal.socket.send("~"+String.fromCharCode(n-64)):terminal.sendText(String.fromCharCode(n-64)))}}function ondeskkeyup(e,t){if(setSessionActivity(),desktop&&!xxdialogMode&&10==xxcurrentView&&1==currentDevicePanel){var n=Q("softKeyboard").value;if(Q("softKeyboard").value="",null!=currentNode){var o=GetMeshRights(currentNode.meshid);if(0==(0==(8192&features2)&&(4294967295==o||0!=(8&o)&&0==(256&o))))return!1;o=4294967295!=o&&0!=(8&o)&&0==(256&o)&&0!=(4096&o);if(1==o&&(1==e.altKey||1==e.ctrlKey||e.keyCode<32&&8!=e.keyCode&&13!=e.keyCode||90<e.keyCode))return!1}if(!(0==gotKeyPressEvent&&0<n.length&&desktop.m.SendKeyUnicode))return desktop.m.handleKeyUp(e);o=n[n.length-1].charCodeAt(0);desktop.m.SendKeyUnicode(desktop.m.KeyAction.DOWN,o),desktop.m.SendKeyUnicode(desktop.m.KeyAction.UP,o)}if(terminal&&!xxdialogMode&&10==xxcurrentView&&5==currentDevicePanel&&0==gotKeyPressEvent&&1!==t)return 1==e.altKey||(n=Q("softKeyboard").value,Q("softKeyboard").value="","sshterminalrelay.ashx"==terminal.urlname?terminal.socket.send("~"+n):n&&terminal.sendText(n),!1)}var deviceHeaderCount,sort=0,deviceHeaderId=0,deviceHeaders={},showRealNames=!1,deviceHeaderTotal=0,deviceHeaders={},deviceHeadersTitles={};function updateDevices(){var e,t="",n=0,o=null,a=0,i={};for(s in deviceHeaderCount={},deviceHeaders={},deviceHeadersTitles={},(deviceHeaderTotal=deviceHeaderId=0)==sort?nodes.sort(meshSort):1==sort?nodes.sort(powerSort):2==sort&&(1==showRealNames?nodes.sort(deviceHostSort):nodes.sort(deviceSort)),nodes)0!=nodes[s].v&&(0==sort?(nodes.sort(meshSort),(meshes[nodes[s].meshid]?nodes[s].meshid:"*")!=o&&(deviceHeaderSet(),e="",null!=meshes[nodes[s].meshid]&&1==meshes[nodes[s].meshid].mtype&&(e="<span style=color:lightgray>, Pouze Intel&reg; AMT</span>"),null!=o&&(2==n&&(t+="<td><div style=width:301px></div></td>"),""!=t)&&(t+="</tr></table>"),t+="<div class=DevSt style=padding-top:4px><span style=float:right>",i[o=meshes[nodes[s].meshid]?(t+='</span><span id=MxMESH style=cursor:pointer onclick=goForward("'+nodes[s].meshid+'")>'+EscapeHtml(meshes[nodes[s].meshid].name)+"</span>"+e+"<span id=DevxHeader"+deviceHeaderId+" style=color:lightgray></span></div>",nodes[s].meshid):(t+="</span><span id=MxMESH><i>Jednotlivá zařízení</i></span><span id=DevxHeader"+deviceHeaderId+" style=color:lightgray></span></div>","*")]=1,n=0)):1==sort?nodes[s].pwr!==o&&(deviceHeaderSet(),null!==o&&(2==n&&(t+="<td><div style=width:301px></div></td>"),""!=t)&&(t+="</tr></table>"),t+="<div class=DevSt style=width:100%;padding-top:4px><span>"+PowerStateStr2(nodes[s].pwr)+"</span><span id=DevxHeader"+deviceHeaderId+" style=color:lightgray></span></div>",o=nodes[s].pwr,n=0):2==sort&&null==o&&(o="1"),a++,t+="<div name=xxdevice onclick=goForward('"+nodes[s]._id+"') class=devList1 id='"+nodes[s]._id+"'></div>",deviceHeaderTotal++,void 0===deviceHeaderCount[nodes[s].state]?deviceHeaderCount[nodes[s].state]=1:deviceHeaderCount[nodes[s].state]++);if(""==t&&0<nodes.length&&""!=Q("SearchInput").value&&(t='<div style="margin:30px">Tomuto vyhledávání nevyhovují žádná zařízení.</div>'),0==sort&&""==Q("SearchInput").value)for(var s in meshes){var l=meshes[s];null==i[l._id]&&IsMeshViewable(l)&&(""!=o&&""!=t&&(t+="</tr></table>"),t=(t+="<div><div colspan=3 class=DevSt><span style=float:right>")+'</span><span id=MxMESH style=cursor:pointer onclick=goForward("'+l._id+'")>'+EscapeHtml(l.name)+"</span></div>",1==l.mtype&&(t+="<div style=padding:10px><i>Žádné Intel&reg; AMT zařízení v této skupině"),1<l.mtype&&(t+="<div style=padding:10px><i>V této skupině nejsou žádná zařízení"),t+=".</i></div></div>",o=l._id,a++)}for(s in 0==a?""!=Q("SearchInput").value||Q("OnlineCheckBox").checked?QH("xdevices",'<div style="margin-top:50px;text-align:center"><span style="font-size:30px">Žádná zařízení</span><br /><br />Tomuto vyhledávání nevyhovují žádná zařízení. <a onclick=clearSearchInput() style=cursor:pointer>Vymazat vyhledávací filtr</a></div>'):QH("xdevices",'<div style="margin-top:50px;text-align:center"><span style="font-size:30px">Žádná zařízení</span><br /><br />Pro přidání zařízení použijte desktop verzi těchto stránek.</div>'):QH("xdevices",t),deviceHeaderSet(),deviceHeaders)QH(s,deviceHeaders[s]);for(s in deviceHeadersTitles)Q(s).title=deviceHeadersTitles[s];onDevicesScrollEx()}var onDevicesTouchActive=!1,onDevicesScrollnagleTimer=null;function onDevicesScroll(){null==onDevicesScrollnagleTimer&&(onDevicesScrollnagleTimer=setTimeout(onDevicesScrollEx,250))}function onDeviceTouch(e){onDevicesTouchActive!=e&&0==(onDevicesTouchActive=e)&&onDevicesScrollEx()}function onDevicesScrollEx(){var e=document.getElementsByName("xxdevice");onDevicesScrollnagleTimer=null;for(var t=0;t<e.length;t++){var n=getNodeFromId(e[t].id);if(null==n)break;updateDeviceViewHtml(e[t],n)}}function updateDeviceViewDevice(e){var t;null!=e&&null!=(t=Q(e._id))&&""!=t.innerHTML&&updateDeviceViewHtml(t,e)}function updateDeviceViewHtml(e,t){var n,o,a,i,s,l=Q("xdevices").scrollTop-250,r=Q("xdevices").scrollTop+Q("xdevices").clientHeight+250;e.offsetTop>=l&&e.offsetTop<r?(EscapeHtml(t.name).length,null!=t.rname&&0<t.rname.length&&EscapeHtml(t.rname),l=EscapeHtml(t.name),0==(l=1==showRealNames&&null!=t.rname?EscapeHtml(t.rname):l).length&&(l="<i>Nic</i>"),n=r="",1==stars[t._id]&&(n+="<img class=deviceNotifyDotSub src=images/icon-star-notify-16.png width=16 height=16>"),null!=t.sessions&&(null!=t.sessions.msg&&(n+='<div style="width:16;height:16" class=deviceNotifyDotSub>'+Object.keys(t.sessions.msg).length+"</div>"),null==t.sessions.kvm&&null==t.sessions.terminal&&null==t.sessions.files&&null==t.sessions.tcp&&null==t.sessions.udp||(n+="<img class=deviceNotifyDotSub src=images/icon-relay-notify.png width=16 height=16>"),null!=t.sessions.help&&(n+="<img class=deviceNotifyDotSub src=images/icon-help-notify-16.png width=16 height=16>"),null!=t.sessions.battery)&&(o="","ac"==(i=t.sessions.battery).state?o="Zařízení je zapojeno":"dc"==i.state&&(o="Zařízení je napájeno z baterie"),a="",s=-1,"number"==typeof i.level&&0<=i.level&&i.level<=100&&(a=i.level+"%",5<(s=Math.floor((i.level+10)/25)+1)&&(lvl=5),"ac"==i.state)&&(100==i.level?s=11:s+=5),0<s)&&(r+='<div class="deviceBatterySmall deviceBatterySmall'+s+'" title="'+(null!=o?o+", "+a:a)+'"></div>'),""!=n&&(r+="<div class=deviceNotifyDot>"+n+"</div>"),i=t.icon,s=NodeStateStr(t),t.conn&&0!=t.conn||3==t.mtype||(i+=" gray"),e.innerHTML="<div>"+r+'<div class="i'+i+' devList2"></div><div class=devList3><div class=devList4><b>'+l+"</b></div><div class=devList5>"+s+"</div></div></div>"):e.innerHTML=""}function showDeviceHelpRequests(e,t,n){if(n&&haltEvent(n),!xxdialogMode||t){var o=null,a="";if(null==(o=null==e?currentNode:getNodeFromId(e))||null==o.sessions)setDialogMode(0);else{if(null!=o.sessions.help)for(var i in o.sessions.help)a+="<div style=margin-bottom:6px><b>"+EscapeHtml(i)+"</b></div><div style=margin-bottom:6px>"+EscapeHtml(o.sessions.help[i])+"</div>";""!=a?setDialogMode(2,"Žádosti o pomoc - "+EscapeHtml(o.name),1,null,a,"HELPREQ-"+o._id):setDialogMode(0)}}return!1}function showDeviceSessions(e,t,n){if(!(!0!==t&&xxdialogMode||null==currentNode)){var o,a=currentNode,i="";for(o in a.sessions)if("kvm"==o&&null==a.sessions.multidesk)for(var s in i+="<u>Vzdálená plocha</u>",a.sessions.kvm)s.startsWith("user/")?(l="",s!=userinfo._id&&4294967295!=GetNodeRights(a)||(l=' <a href=# onclick=\'return endDeviceSession("kvm", "'+encodeURIComponentEx(a._id)+'", "'+encodeURIComponentEx(s)+'")\' title="Odpojit tuto relaci" style=cursor:pointer><img src=images/trash.png border=0 height=10 width=10></a>'),i+=addHtmlValue4(getUserName(s),(1==a.sessions.kvm[s]?"1 relace":nobreak(format("{0} relací",a.sessions.kvm[s])))+l)):"busy"==s&&(i+=addHtmlValue2("Zařízení je zaneprázdněné",1==a.sessions.kvm[s]?"1 relace":nobreak(format("{0} relací",a.sessions.kvm[s]))));else if("multidesk"==o)for(var s in i+="<u>Vzdálená plocha</u>",a.sessions.multidesk){var l="";s!=userinfo._id&&4294967295!=GetNodeRights(a)||(l=' <a href=# onclick=\'return endDeviceSession("multidesk", "'+encodeURIComponentEx(a._id)+'", "'+encodeURIComponentEx(s)+'")\' title="Odpojit tuto relaci" style=cursor:pointer><img src=images/trash.png border=0 height=10 width=10></a>'),i+=addHtmlValue4(getUserName(s),(1==a.sessions.multidesk[s]?"1 relace":nobreak(format("{0} relací",a.sessions.multidesk[s])))+l)}else if("terminal"==o)for(var s in i+="<u>Terminál</u>",a.sessions.terminal){l="";s!=userinfo._id&&4294967295!=GetNodeRights(a)||(l=' <a href=# onclick=\'return endDeviceSession("terminal", "'+encodeURIComponentEx(a._id)+'", "'+encodeURIComponentEx(s)+'")\' title="Odpojit tuto relaci" style=cursor:pointer><img src=images/trash.png border=0 height=10 width=10></a>'),i+=addHtmlValue4(getUserName(s),(1==a.sessions.terminal[s]?"1 relace":nobreak(format("{0} relací",a.sessions.terminal[s])))+l)}else if("files"==o)for(var s in i+="<u>Soubory</u>",a.sessions.files){l="";s!=userinfo._id&&4294967295!=GetNodeRights(a)||(l=' <a href=# onclick=\'return endDeviceSession("files", "'+encodeURIComponentEx(a._id)+'", "'+encodeURIComponentEx(s)+'")\' title="Odpojit tuto relaci" style=cursor:pointer><img src=images/trash.png border=0 height=10 width=10></a>'),i+=addHtmlValue4(getUserName(s),(1==a.sessions.files[s]?"1 relace":nobreak(format("{0} relací",a.sessions.files[s])))+l)}else if("tcp"==o)for(var s in i+="<u>Směrování TCP</u>",a.sessions.tcp){l="";s!=userinfo._id&&4294967295!=GetNodeRights(a)||(l=' <a href=# onclick=\'return endDeviceSession("tcp", "'+encodeURIComponentEx(a._id)+'", "'+encodeURIComponentEx(s)+'")\' title="Odpojit tuto relaci" style=cursor:pointer><img src=images/trash.png border=0 height=10 width=10></a>'),i+=addHtmlValue4(getUserName(s),(1==a.sessions.tcp[s]?"1 relace":nobreak(format("{0} relací",a.sessions.tcp[s])))+l)}else if("udp"==o)for(var s in i+="<u>Směrování UDP</u>",a.sessions.udp){l="";s!=userinfo._id&&4294967295!=GetNodeRights(a)||(l=' <a href=# onclick=\'return endDeviceSession("udp", "'+encodeURIComponentEx(a._id)+'", "'+encodeURIComponentEx(s)+'")\' title="Odpojit tuto relaci" style=cursor:pointer><img src=images/trash.png border=0 height=10 width=10></a>'),i+=addHtmlValue4(getUserName(s),(1==a.sessions.udp[s]?"1 relace":nobreak(format("{0} relací",a.sessions.udp[s])))+l)}""!=i?setDialogMode(2,"Session - "+EscapeHtml(a.name),1,null,i,"SESSIONS-"+a._id):setDialogMode(0)}}function endDeviceSession(e,t,n){var n=decodeURIComponent(n).split("/"),o=n[0]+"/"+n[1]+"/"+n[2],a=null;4==n.length&&n[3].startsWith("guest:")&&(a=atob(n[3].substring(6))),"multidesk"==e?meshserver.send({action:"endDesktopMultiplex",nodeid:decodeURIComponent(t),xuserid:o,guestname:a,guestname:a}):meshserver.send({action:"msg",type:"endtunnel",nodeid:decodeURIComponent(t),xuserid:o,guestname:a,guestname:a,protocol:e})}function showDeviceMessages(e,t,n){if(n&&haltEvent(n),!xxdialogMode||t){var o=null,a="<div style=max-height:200px;width:100%;overflow-y:auto;overflow-x:hidden>",i=0;if(null==(o=null==e?currentNode:getNodeFromId(e))||null==o.sessions||null==o.sessions.msg)setDialogMode(0);else{for(var s in o.sessions.msg){var l=s,r=5;"string"==typeof o.sessions.msg[s].msg&&(l=o.sessions.msg[s].msg),a+="<table style=width:100%><td style=width:24px><div class=NotifyIconSmall"+(r=(r="number"==typeof o.sessions.msg[s].icon?o.sessions.msg[s].icon:r)<1||9<r?5:r)+'></div><td><div style="border-radius:5px;background-color:#BBB;width:calc(100% - 18px);padding:8px">'+EscapeHtml(l)+"</div></table>",i++}a+="</div>",0<i&&setDialogMode(2,"Zprávy agenta - "+EscapeHtml(o.name),1,null,a,"MESSAGES-"+o._id)}}return!1}var powerStatetable=["","Zapnuto","Spánek","Spánek","Spánek","Hibernuje se","Vypnout","Připojeno","Vypnuto"],powerStateStrings=["","Zapnuto","Spí","Spí","Hluboký spánek","Hibernuje se","Soft-Off","Připojeno","Vypnuto"],powerStateStrings2=["","Zařízení je zapnuté","Zařízení je ve stavu spánku (S1)","Zařízení je ve stavu spánku (S2)","Zařízení je v hlubokém spánku (S3)","Zařízení je hibernováno (S4)","Zařízení je ve stavu soft-off (S5)","Zařízení je přítomno, ale nedaří se zjistit stav napájení","Zařízení je vypnuto"],powerColorTable=["#00000000","black","blue","blue","lightblue","blueviolet","darkgreen","lightseagreen","lightseagreen"];function NodeStateStr(e){var t=[];return 0<e.state&&e.state<powerStatetable.length&&state.push(powerStatetable[e.state]),e.conn&&(0!=(1&e.conn)&&t.push("<span>"+(4==e.mtype?"PDU"==e.porttype?"Přepínač":"IP-KVM":"Agent")+"</span>"),0!=(2&e.conn)?t.push("<span>CIRA</span>"):0!=(4&e.conn)&&t.push("<span>Intel&reg; AMT</span>"),0!=(8&e.conn)&&t.push("<span>Předávání (relay)</span>"),0!=(16&e.conn))&&t.push("<span>MQTT</span>"),null!=e.pwr&&0!=e.pwr&&t.push(powerStateStrings[e.pwr]),t.join(", ")}function PowerStateStr(e){return e<powerStatetable.length?powerStatetable[e]:""}function PowerStateStr2(e){return 0!=e&&e<powerStatetable.length?powerStatetable[e]:"Neznámé"}function onSortSelectChange(e){sort=document.getElementById("sortselect").selectedIndex,e||putstore("sort",sort),mainUpdate(4)}function deviceHeaderSet(){if(0==deviceHeaderId)deviceHeaderId=1;else{deviceHeaders["DevxHeader"+deviceHeaderId]=", "+deviceHeaderTotal+(1==deviceHeaderTotal?" uzel":" uzly");var e,t="";for(e in deviceHeaderCount)0<t.length&&(t+=", "),t+=deviceHeaderCount[e]+" "+PowerStateStr2(e);deviceHeadersTitles["DevxHeader"+deviceHeaderId]=t,deviceHeaderId++,deviceHeaderCount={},deviceHeaderTotal=0}}var sortCollator=new Intl.Collator(void 0,{numeric:!0,sensitivity:"base"});function meshSort(e,t){var n=sortCollator.compare(e.meshnamel,t.meshnamel);return 0!=n||0!=(n=sortCollator.compare(e.meshid,t.meshid))?n:1==showRealNames?sortCollator.compare(e.rnamel,t.rnamel):sortCollator.compare(e.namel,t.namel)}function powerSort(e,t){var n=e.pwr||0,o=t.pwr||0;return o<n?-1:n<o?1:n==o?1==showRealNames?sortCollator.compare(e.rnamel,t.rnamel):sortCollator.compare(e.namel,t.namel):void 0}function deviceSort(e,t){return sortCollator.compare(e.namel,t.namel)}function deviceHostSort(e,t){return sortCollator.compare(e.rnamel,t.rnamel)}function refreshDevice(e){currentNode&&currentNode._id==e&&gotoDevice(e,xxcurrentView,!0)}var currentNode,currentDevicePanel=0,powerTimelineNode=null,powerTimelineReq=null,powerTimelineUpdate=null,powerTimeline=null;function getCurrentNode(){return currentNode}function gotoDevice(e,t,n){if(!0!==userinfo.emailVerified&&1==serverinfo.emailcheck&&4294967295!=userinfo.siteadmin)setDialogMode(2,"Nastavení zabezpečení",1,null,"Nedaří se získat přístup k zařízení, dokud nebude ověřena e-mailová adresa. To je vyžadováno pro obnovení hesla. Přejděte do „Můj účet“ a změňte si a ověřte e-mailovou adresu.");else if(262144&features&&!(1==userinfo.otpsecret||0<userinfo.otphkeys||0<userinfo.otpkeys||8388608&features&&1==userinfo.otpekey))setDialogMode(2,"Nastavení zabezpečení",1,null,"Nedaří se získat přístup k zařízení, dokud není zapnuté 2-faktorové ověřování se. Toto je vyžadováno pro extra zabezpečení. Přejděte do „Můj účet“ a podívejte se do sekce „Zabezpečení účtu“.");else{var o=getNodeFromId(e);if(null==o)goBack();else{var a=meshes[o.meshid],i=GetNodeRights(o),e=null==currentNode||currentNode._id!=e;if(!currentNode||currentNode._id!=o._id||1==n){currentNode=o,QV("p10deviceNotify",null!=currentNode.sessions&&(null!=o.sessions.kvm||null!=o.sessions.terminal||null!=o.sessions.files||null!=o.sessions.tcp||null!=o.sessions.udp)),QV("p10deviceStar",1==stars[currentNode._id]),QV("p10deviceHelp",null!=currentNode.sessions&&null!=currentNode.sessions.help),null!=currentNode.sessions&&null!=currentNode.sessions.msg?(QV("p10deviceMsg",!0),QH("p10deviceMsg",Object.keys(currentNode.sessions.msg).length)):QV("p10deviceMsg",!1),QV("p10deviceBattery",!1),null!=currentNode.sessions&&null!=currentNode.sessions.battery?(n="","ac"==(l=currentNode.sessions.battery).state&&(n="Zařízení je zapojeno"),"dc"==l.state&&(n="Zařízení je napájeno z baterie"),r="",s=-1,"number"==typeof l.level&&0<=l.level&&l.level<=100&&(r=l.level+"%",5<(s=Math.floor((l.level+10)/25)+1)&&(lvl=5),"ac"==l.state)&&(100==l.level?s=11:s+=5),0<s&&(Q("p10deviceBattery").title=null!=n?n+", "+r:r,QV("p10deviceBattery",!0),Q("p10deviceBattery").className="deviceBatteryLarge deviceBatteryLarge"+s)):QV("p10deviceBattery",!1);var s,l=EscapeHtml(o.name),n=(0==l.length&&(l="<i>Nic</i>"),0!=(4&i)&&(l="<span onclick=showEditNodeValueDialog(0) style=cursor:pointer>"+l+"</span>"),QH("p10deviceName",l),"<table style=width:100%>"),r=(a&&(n+=addDeviceAttribute("<span>Skupina</span>",'<a onclick=goForward("'+o.meshid+'") style=cursor:pointer>'+EscapeHtml(meshes[o.meshid].name)+"</a>")),null!=o.rname&&(n+=addDeviceAttribute("<span>Název</span>","<span>"+EscapeHtml(o.rname)+"</span>")),(0==(1&features)&&4!=o.mtype||3==o.mtype)&&(0!=(4&i)?o.host?n+=addDeviceAttribute("Název stroje","<span onclick=showEditNodeValueDialog(1) style=cursor:pointer>"+EscapeHtml(o.host)+"</span>"):n+=addDeviceAttribute("Název stroje","<span onclick=showEditNodeValueDialog(1) style=cursor:pointer><i>Nic</i></span>"):n+=addDeviceAttribute("Název stroje",EscapeHtml(o.host))),o.desc?EscapeHtml(o.desc):"<i>Nic</i>"),a=(n+=addDeviceAttribute("Popis",0!=(4&i)?"<span onclick=showEditNodeValueDialog(2) style=cursor:pointer>"+r+"</span>":r),4==o.mtype&&(null!=o.portnum&&(n+=addDeviceAttribute("Číslo portu",o.portnum)),null!=o.porttype)&&(n+=addDeviceAttribute("Typ portu",o.porttype)),null!=o.agent&&null!=o.agent.id&&3==o.mtype?(4==o.agent.id&&(n+=addDeviceAttribute("Typ zařízení","Windows")),6==o.agent.id&&(n+=addDeviceAttribute("Typ zařízení","Linux")),29==o.agent.id&&(n+=addDeviceAttribute("Typ zařízení","macOS"))):null!=o.agent&&null!=o.agent.id&&null!=o.agent.ver&&(c="",c=o.agent.id<=agentsStr.length?agentsStr[o.agent.id]:agentsStr[0],0!=o.agent.ver&&(c+=" v"+o.agent.ver),14==o.agent.id&&(c=o.agent.core),!1===o.agent.root&&0!=(1&o.conn)&&(c+=", Omezený"),n+=addDeviceAttribute("Mesh Agent",c)),null!=o.intelamt&&(c="",s={0:nobreak("Neaktivováno (před)"),1:nobreak("Neaktivováno (v)"),2:nobreak("Zapnuto")},null!=o.intelamt.ver&&null==o.intelamt.state?c+="<i>"+nobreak("Neznámý stav")+"</i>, v"+EscapeHtml(o.intelamt.ver):null==o.intelamt.ver&&2==o.intelamt.state?c+="<i>Zapnuto</i>":null==o.intelamt.ver||null==o.intelamt.state?c+="<i>Neznámý stav a verze</i>":(c+=s[o.intelamt.state],o.intelamt.flags&&(2&o.intelamt.flags?c=" <span>CCM</span>":4&o.intelamt.flags&&(c=" <span>ACM</span>")),c+=", v"+EscapeHtml(o.intelamt.ver)),2==o.intelamt.state&&(1==o.intelamt.tls&&(c+=', <span title="Intel&reg; AMT je nastaveno s TLS zabezpečením">TLS</span>'),l=!1,null==o.intelamt.user||""==o.intelamt.user?0!=(4&i)?(c+=', <i style=color:#FF0000;cursor:pointer title="Upravit přihlašovací údaje k Intel&reg; AMT" onclick=editDeviceAmtSettings("'+o._id+'")>Žádné přihlašovací údaje</i>',l=!0):c+=", <i style=color:#FF0000>Žádné přihlašovací údaje</i>":0!=(1&features2)&&null!=o.intelamt.warn&&(a=null,0!=(1&o.intelamt.warn)&&(a="Neplatná pověření"),null!=(a=0!=(8&o.intelamt.warn)?"Zkoušení přihlašovacích údajů":a))&&(0!=(4&i)?(c+=', <i style=color:#FF0000;cursor:pointer title="Upravit přihlašovací údaje k Intel&reg; AMT" onclick=editDeviceAmtSettings("'+o._id+'")>'+a+"</i>",l=!0):c+=", <i style=color:#FF0000>"+a+"</i>"),c+=" ",l=0!=(4&i)&&0==(1&features2)||l)&&(c+='<img src=images/link4.png height=10 width=10 title="Upravit přihlašovací údaje k Intel&reg; AMT" style=cursor:pointer onclick=editDeviceAmtSettings("'+o._id+'")>'),r="Intel&reg; ME","number"==typeof o.intelamt.sku&&(0!=(8&o.intelamt.sku)?r="Intel&reg; AMT":0!=(16&o.intelamt.sku)&&(r="Intel&reg; SM")),n+=addDeviceAttribute(r,c)),null!=o.agent&&null!=o.agent.tag&&"mailto:"!=o.agent.tag&&(n+=addDeviceAttribute("Štítek agenta",s=(s=EscapeHtml(o.agent.tag)).startsWith("mailto:")?'<a href="'+s+'">'+s.substring(7)+"</a>":s)),o.conn),d=(a&&1<a&&(l=[],0!=(1&o.conn)&&l.push("<span>"+(4==o.mtype?"PDU"==o.porttype?"Přepínač":"IP-KVM":"Agent")+"</span>"),0!=(2&o.conn)?l.push("<span>Intel&reg; AMT CIRA</span>"):0!=(4&o.conn)&&l.push("<span>Intel&reg; AMT</span>"),0!=(8&o.conn)&&l.push("<span>Agent Relay (předávání)</span>"),0!=(16&o.conn)&&l.push("<span>MQTT</span>"),n+=addDeviceAttribute("Konektivita",l.join(", "))),"<i>Nic</i>");if(null!=o.tags)for(var u in d="",o.tags)d+="<span class=tagSpan>"+EscapeHtml(o.tags[u])+"</span> ";n+=addDeviceAttribute("Štítky",0!=(4&i)?"<span onclick=showEditNodeValueDialog(3) style=cursor:pointer;color:black>"+d+"</span>":"<span style=line-height:26px;color:black>"+d+"</span>"),null==o.ssh&&null==o.rdp||(r=[],0!=(4&i)?(null!=o.ssh&&r.push("<span onclick=showClearSshDialog(3) style=cursor:pointer>"+(1==o.ssh?"SSH-User+Pass":2==o.ssh?"SSH-User+Key+Pass":"SSH-uživatel+klíč")+' <img class=hoverButton src="images/link5.png" width=10 height=10 /></span>'),null!=o.rdp&&r.push('<span onclick=showClearRdpDialog(3) style=cursor:pointer>RDP <img class=hoverButton src="images/link5.png" width=10 height=10 /></span>')):(null!=o.ssh&&r.push(1==o.ssh?"SSH-User+Pass":2==o.ssh?"SSH-User+Key+Pass":"SSH-uživatel+klíč"),null!=o.rdp&&r.push("RDP")),n+=addDeviceAttribute("Pověření",r.join(", "))),n+="</table><br />",0!=(262220&i)&&o.mtype<3&&(n+='<input type=button value="Akce" onclick=deviceActionFunction() />'),n+='<input type=button value="Poznámky" onclick=showNotes('+(0==(128&i))+',"'+encodeURIComponent(o._id)+'") />',4==o.mtype&&1&a&&("PDU"==o.porttype?1==o.pwr?262144&i&&(n+='<input type=button value="Vypnout" title="Vypnout" onclick=setIpPduState(0) />'):8==o.pwr&&64&i&&(n+='<input type=button value="Zapnout" title="Zapnout" onclick=setIpPduState(1) />'):8&i&&(n+='<input type=button value="Ovládání na dálku" title="Ovládání na dálku" onclick=openIpKvmRemoteControl("'+encodeURIComponentEx(o._id)+'") />')),QH("p10html",n),3==o.mtype&&null!=o.agent&&4<o.agent.id&&512&features2&&(o.agent.caps=6),setupTerminal(),setupFiles(),16&i&&setupConsole(),n="<div style=float:right;font-size:x-small;margin-right:10px>",0!=(32768&i)&&(n+='<a style=cursor:pointer onclick=p10showDeleteNodeDialog("'+o._id+'")>Smazat zařízení</a>'),n+="</div><div style=font-size:x-small>",0!=webRelayPort&&(n=(n+='<a onclick=p10WebRouter("'+o._id+'",1,'+(o.httpport||80)+")>HTTP"+(o.httpport&&80!=o.httpport?"/"+o.httpport:"")+"</a>&nbsp;")+'<a onclick=p10WebRouter("'+o._id+'",2,'+(o.httpsport||443)+")>HTTPS"+(o.httpsport&&443!=o.httpsport?"/"+o.httpsport:"")+"</a>&nbsp;"),n+="</div><br>",QH("p10html3",n);var c=PowerStateStr(o.state);0!=(1&a)&&(0<c.length&&(c+=", "),c+=4==o.mtype?"PDU"==o.porttype?"Přepínač":"IP-KVM":"Mesh Agent"),0!=(2&a)?(0<c.length&&(c+=", "),c+="Intel&reg; AMT připojeno"):0!=(4&a)&&(0<c.length&&(c+=", "),c+="Intel&reg; AMT zjištěno"),0!=(16&a)&&(0<c.length&&(c+=", "),c+="MQTT kanál připojen"),("PDU"==o.porttype||1<o.pwr&&7!=o.pwr)&&(0<c.length&&(c+=", "),c+=powerStateStrings[o.pwr]),QH("MainComputerState","<span style=font-size:12px>"+c+"</span>"),QH("MainComputerImage",'<div class="i'+o.icon+'"></div>'),powerTimelineNode!=currentNode._id&&powerTimelineReq!=currentNode._id&&(QH("p10html2",""),powerTimelineReq=currentNode._id,meshserver.send({action:"powertimeline",nodeid:currentNode._id}),meshserver.send({action:"lastconnect",nodeid:currentNode._id}),meshserver.send({action:"getsysinfo",nodeid:currentNode._id}),meshserver.send({action:"getnetworkinfo",nodeid:currentNode._id}),QH("p10detailshtml","")),e&&(p11clearConsoleMsg(),p13clearConsoleMsg()),QV("p11DeskSessionSelector",!1),QH("p11DeskSessionSelector","")}setupDesktop(),go(t=t||10),10==xxcurrentView&&setupDeviceMenu()}}}function setIpPduState(e){0==e?setDialogMode(2,"Provoz napájení",3,function(){meshserver.send({action:"poweraction",nodeids:[currentNode._id],actiontype:2})},"Provést vypnutí?"):setDialogMode(2,"Provoz napájení",3,function(){meshserver.send({action:"wakedevices",nodeids:[currentNode._id]})},"Zapnout napájení?")}function openIpKvmRemoteControl(e){xxdialogMode||safeNewWindow("/ipkvm.ashx/"+(e=decodeURIComponent(e).split("/")[2])+"/","ipkvm:"+e)}function deviceToastFunction(){xxdialogMode||setDialogMode(2,"Device Toast",3,deviceToastFunctionEx,"<textarea id=d2devToast style=width:100%;height:80px;resize:none;overflow-y:scroll></textarea>")}function deviceToastFunctionEx(){meshserver.send({action:"toast",nodeids:[currentNode._id],title:"MeshCentral",msg:Q("d2devToast").value})}function setupDeviceMenu(e,t){var n=GetNodeRights(currentNode),e=(null!=e&&(currentDevicePanel=e),QV("p10general",0==currentDevicePanel),QV("p10desktop",1==currentDevicePanel),QV("p10files",2==currentDevicePanel),QV("p10details",3==currentDevicePanel),QV("p10console",4==currentDevicePanel),QV("p10terminal",5==currentDevicePanel),[]);0!=currentDevicePanel&&e.push({n:"Obecné",f:"setupDeviceMenu(0)"}),1!=currentDevicePanel&&null!=currentNode&&(8&n||256&n)&&(4294967295==n||0==(65536&n))&&(null==currentNode.agent&&currentNode.intelamt&&("number"!=typeof currentNode.intelamt.sku||0!=(8&currentNode.intelamt.sku))||currentNode.agent&&1&currentNode.agent.caps)&&e.push({n:"Plocha",f:"setupDeviceMenu(1)"}),5!=currentDevicePanel&&null!=currentNode&&(8&n||256&n)&&(4294967295==n||0==(512&n))&&(null==currentNode.agent&&currentNode.intelamt&&("number"!=typeof currentNode.intelamt.sku||0!=(8&currentNode.intelamt.sku))||currentNode.agent&&2&currentNode.agent.caps)&&e.push({n:"Terminál",f:"setupDeviceMenu(5)"}),2!=currentDevicePanel&&null!=currentNode&&8&n&&(4294967295==n||0==(1024&n))&&1!=currentNode.mtype&&currentNode.agent&&4&currentNode.agent.caps&&e.push({n:"Soubory",f:"setupDeviceMenu(2)"}),3!=currentDevicePanel&&null!=currentNode&&currentNode.mtype<3&&0!=(1048576&n)&&e.push({n:"Podrobnosti",f:"setupDeviceMenu(3)"}),4!=currentDevicePanel&&null!=currentNode&&16&n&&2==currentNode.mtype&&e.push({n:"Konzole",f:"setupDeviceMenu(4)"}),updateFooterMenu(e),updateCurrentUrl(),1==currentDevicePanel&&deskAdjust()}function deviceActionFunction(){var e,t,n,o,a;xxdialogMode||(e=GetNodeRights(currentNode),t=0,n="Vyberte operaci na tomto zařízení.<br /><br />",o="<select id=d2deviceop style=float:right;width:170px onchange=deviceActionFunctionValidate()>",a="",null!=currentNode.agent&&14==currentNode.agent.id?0!=(1&currentNode.conn)&&0!=(8&e)&&(t++,o+="<option value=400>Blikat</option><option value=401>Vibrovat</option>",a+="<div id=d2devicetimediv>"+addHtmlValue("Čas","<select id=d2devicetime style=float:right;width:170px><option value=1000>1 sekunda</option><option value=5000>5 sekund</option><option value=10000>10 sekund</option></select>")+"</div>"):(0!=(64&e)&&(t++,o+="<option value=100>Probudit</option>"),0!=currentNode.conn&&0!=(262144&e)&&(t++,o+="<option value=4>Spánek</option><option value=3>Reset</option><option value=2>Vypnout</option>"),null!=currentNode.intelamt&&2==currentNode.intelamt.state&&0!=(6&currentNode.conn)&&0!=(262144&e)&&(t++,o+="<option value=310>Reset Intel&reg; AMT</option><option value=308>Vypnutí Intel&reg; AMT</option>"),null!=currentNode.intelamt&&2==currentNode.intelamt.state&&0!=(6&currentNode.conn)&&0!=(64&e)&&(t++,o+="<option value=302>Zapněte Intel&reg; AMT</option>")),n+=addHtmlValue("Operace",o+="</select>"),setDialogMode(2,"Akce zařízení",0==t?2:3,deviceActionFunctionEx,(n=0==t?"Momentálně nejsou pro toto zařízení k dispozici žádné akce.":n)+a),0<t&&deviceActionFunctionValidate())}function deviceActionFunctionValidate(){var e=Q("d2deviceop").value;try{QV("d2devicetimediv",400==e||401==e)}catch(e){}}function deviceActionFunctionEx(){var e=Q("d2deviceop").value;100==e?meshserver.send({action:"wakedevices",nodeids:[currentNode._id]}):103!=e&&104!=e&&106!=e&&107!=e&&(302==e?setDialogMode(2,"Provoz Intel&reg; AMT Power",3,function(){meshserver.send({action:"poweraction",nodeids:[currentNode._id],actiontype:parseInt(e)})},"Chcete zapnout napájení Intel&reg; AMT?"):308==e?setDialogMode(2,"Provoz Intel&reg; AMT Power",3,function(){meshserver.send({action:"poweraction",nodeids:[currentNode._id],actiontype:parseInt(e)})},"Perform Intel&reg; AMT power off?<br><br><b>NOTE: If there is an active AMT session, then power off command will be rejected, so you must disconnect from the AMT session first!</b>"):310==e?setDialogMode(2,"Provoz Intel&reg; AMT Power",3,function(){meshserver.send({action:"poweraction",nodeids:[currentNode._id],actiontype:parseInt(e)})},"Chcete provést reset Intel&reg; AMT?"):400==e||401==e?meshserver.send({action:"poweraction",nodeids:[currentNode._id],actiontype:parseInt(e),time:parseInt(Q("d2devicetime").value)}):meshserver.send({action:"poweraction",nodeids:[currentNode._id],actiontype:parseInt(e)}))}function showNotes(e,t){xxdialogMode||(e="<textarea id=d2devNotes ro="+e+" noteid="+(t=null==t?encodeURIComponentEx("p"+userinfo._id):t)+" readonly style=background-color:#fcf3cf;width:100%;height:200px;resize:none;overflow-y:scroll></textarea>",t.startsWith("node%2F%2F")&&(e+="<span style=font-size:10px>Poznámky pro skupinu zařízení si mohou zobrazit nebo upravit pouze ostatní správci skupiny.<span>"),setDialogMode(2,"Poznámky",3,showNotesEx,e,t),meshserver.send({action:"getNotes",id:decodeURIComponent(t)}))}function showNotesEx(e,t){meshserver.send({action:"setNotes",id:decodeURIComponent(t),notes:encodeURIComponentEx(Q("d2devNotes").value)})}function deviceLockFunction(){null==xxdialogMode&&0!=xxdialogMode||null==desktop||1!=desktop.contype||setDialogMode(2,"Zamknout plochu",3,function(){null!=desktop&&1==desktop.contype&&desktop.sendCtrlMsg('{"ctrlChannel":"102938","type":"lock"}')},"Zamknout uživatelskou plochu?")}function deviceChat(t){xxdialogMode||setDialogMode(2,"Akce zařízení",3,function(){var e="/messenger?id=meshmessenger/"+encodeURIComponentEx(currentNode._id)+"/"+encodeURIComponentEx(userinfo._id)+"&title="+currentNode.name;""!=serverinfo.domainsuffix&&(e="/"+serverinfo.domainsuffix+e),null!=authCookie&&""!=authCookie&&(e+="&auth="+authCookie),t&&1==t.shiftKey?safeNewWindow(e,"meshmessenger:"+currentNode._id):safeNewWindow(e,"meshmessenger:"+currentNode._id,"directories=no,titlebar=no,toolbar=no,location=no,status=no,menubar=no,scrollbars=no,resizable=no,width=400,height=560"),meshserver.send({action:"meshmessenger",nodeid:decodeURIComponent(currentNode._id)})},"Zahájit chat?")}function deviceUrlFunction(){xxdialogMode||(setDialogMode(2,"Otevřít stránku na zařízení",3,deviceUrlFunctionEx,'<input id=d2devurl placeholder="http://server.com" style=width:100%;overflow-y:scroll onkeyup=deviceUrlFunctionValidate() onchange=deviceUrlFunctionValidate()></input>'),Q("d2devurl").focus(),deviceUrlFunctionValidate())}function deviceUrlFunctionValidate(){var e=Q("d2devurl").value.toLowerCase();QE("idx_dlgOkButton",e.startsWith("http://")&&7<e.length||e.startsWith("https://")&&8<e.length)}function deviceUrlFunctionEx(){meshserver.send({action:"msg",type:"openUrl",nodeid:currentNode._id,url:Q("d2devurl").value})}function runDeviceCmd(e){xxdialogMode||d2runCommandDialog({nodeids:[e?decodeURIComponent(e):currentNode._id]})}function d2runCommandDialog(e){var t,n=!1,o=!1,a=!1;for(t in e.nodeids){var i=getNodeFromId(e.nodeids[t]);i.agent&&(24==(24&GetNodeRights(i))&&(a=!0),0<i.agent.id&&i.agent.id<5?n=!0:o=!0)}if(1==n||1==o||1==a){var s={type:1,runAs:0,source:1,cmd:""};try{s=JSON.parse(getstore("runopt",s))}catch(e){}e.selectedFile&&(l=e.selectedFile.name.toLowerCase(),console.log("filename",l),l.endsWith(".bat")&&(s.type=1),l.endsWith(".ps1")&&(s.type=2),l.endsWith(".sh")&&(s.type=3),l.endsWith(".agentconsole"))&&(s.type=4);var l="";e.title&&(l+=e.title+"<br />"),l+="<select id=d2cmdtype onclick=d2runCommandValidate() style=width:100%;margin-bottom:4px;margin-top:4px>",1==n&&(l+="<option value=1"+(1==s.type?" selected":"")+">Příkazový řádek systému Windows</option><option value=2"+(2==s.type?" selected":"")+">Windows PowerShell</option>"),1==o&&(l+="<option value=3"+(3==s.type?" selected":"")+">Linux / BSD / macOS Command Shell</option>"),1==a&&(l+="<option value=4"+(4==s.type?" selected":"")+">Konzole agenta</option>"),l=l+"</select>"+("<select id=d2cmduser style=width:100%;margin-bottom:4px><option value=0"+(0==s.runAs?" selected":"")+">Spustit jako agent</option><option value=1"+(1==s.runAs?" selected":"")+">Spustit jako uživatel, agent, pokud žádný uživatel</option><option value=2"+(2==s.runAs?" selected":"")+">Musí běžet jako uživatel</option></select>"),null==e.selectedFile&&(l+="<select id=d2cmdsource onclick=d2runCommandValidate() style=width:100%;margin-bottom:4px><option value=0"+(0==s.source?" selected":"")+">Příkazy z textového pole</option><option value=1"+(1==s.source?" selected":"")+">Příkazy ze souboru</option>",8&userinfo.siteadmin&&(l+="<option value=2"+(2==s.source?" selected":"")+">Příkazy ze souboru na serveru</option>"),l=l+("</select><textarea id=d2runcmd onkeyup=d2runCommandValidate() style=background-color:#fcf3cf;width:100%;height:200px;resize:none;overflow-y:scroll>"+(s.cmd?EscapeHtml(decodeURIComponent(s.cmd)):""))+"</textarea><div id=d2runfile style=display:none><input id=d2runfileex type=file onchange=d2runCommandValidate() id=d2localFile name=files onchange=d2runCommandValidate() /></div>",8&userinfo.siteadmin)&&(l+='<div id=d2runsfile style=display:none><div id=d2serveraction valign=bottom><input type=button id=p2FolderUp disabled="disabled" onclick=d3folderup() value="Up" />&nbsp;<span id=p2CurrentFolder></span></div><div id=d2serverfiles></div></div>'),setDialogMode(2,"Spustit příkazy",3,d2groupActionFunctionRunCommands,l,e),null==e.selectedFile&&(Q("d2runcmd").focus(),8&userinfo.siteadmin)&&(d3fileoptions={dialog:2,files:"d2serverfiles",folderup:"p2FolderUp",currentFolder:"p2CurrentFolder",func:null},d3updatefiles()),d2runCommandValidate()}}function d2runCommandValidate(){var e;QV("d2cmduser",Q("d2cmdtype").value<4),null==xxdialogTag.selectedFile?(QV("d2runcmd",0==Q("d2cmdsource").value),QV("d2runfile",1==Q("d2cmdsource").value),QV("d2runsfile",2==Q("d2cmdsource").value),e=!1,0==Q("d2cmdsource").value&&0<Q("d2runcmd").value.length&&(e=!0),1==Q("d2cmdsource").value&&1==Q("d2runfileex").files.length&&(e=!0),2==Q("d2cmdsource").value&&(e=!1),QE("idx_dlgOkButton",e)):QE("idx_dlgOkButton",!0)}function d2groupActionFunctionRunCommands(e,t){var n=3;try{n=parseInt(Q("d2cmdtype").value)}catch(e){}null==t.selectedFile&&putstore("runopt",JSON.stringify({type:n,runAs:parseInt(Q("d2cmduser").value),source:parseInt(Q("d2cmdsource").value),cmd:encodeURIComponent(Q("d2runcmd").value)}));var o,a={action:"runcommands",nodeids:t.nodeids,type:n,runAsUser:parseInt(Q("d2cmduser").value)};t.selectedFile?((o=new FileReader).onload=function(e){a.cmds=e.target.result,meshserver.send(a),t.func&&t.func()},o.readAsText(t.selectedFile)):0==Q("d2cmdsource").value?(a.cmds=Q("d2runcmd").value,meshserver.send(a),t.func&&t.func()):1==Q("d2cmdsource").value?((o=new FileReader).onload=function(e){a.cmds=e.target.result,meshserver.send(a),t.func&&t.func()},o.readAsText(Q("d2runfileex").files[0])):2==Q("d2cmdsource").value&&1==(n=d3getFileSel()).length&&(a.cmdpath=d3filetreelocation.join("/")+"/"+n[0],meshserver.send(a),t.func)&&t.func()}function updateDeviceTimeline(){2==meshserver.State&&null!=powerTimelineNode&&null!=powerTimelineUpdate&&null!=currentNode&&3!=currentNode.mtype&&powerTimelineNode==powerTimelineReq&&currentNode._id==powerTimelineNode&&powerTimelineUpdate<Date.now()&&(powerTimelineUpdate=null,meshserver.send({action:"powertimeline",nodeid:currentNode._id}))}function drawDeviceTimeline(){if(3==currentNode.mtype||"true"===hidePowerTimeline)QH("p10html2","<br />");else{var e=null,t=Date.now(),n=(currentNode._id==powerTimelineNode&&(e=powerTimeline),new Date),o=(n.setHours(0,0,0,0),(n=new Date(n.getTime()-5184e5)).getTime(),[]);if(null!=e&&1<e.length){o.push([0,e[1],e[0]]);for(var a=e[1],i=2;i<e.length;i+=2){var s=e[i],l=t;e.length>i+1&&(l=e[i+1]),o.push([a,a+l,s]),a+=l}}var r="",d=1,u=new Date,c=Q("masthead").offsetWidth-122;u.setHours(0,0,0,0);for(i=0;i<7;i++){var p,m="",g=u.getTime(),h=g+864e5;for(p in o){var v,f,k=o[p];1==isTimeBlockInside(g,h,k[0],k[1])&&(v=Math.max(g,k[0]),f=Math.min(Math.min(h,k[1]),t),0<(f=Math.round((f-v)*c/864e5)))&&(m+="<div style=display:table-cell;width:"+f+"px;background-color:"+powerColor(k[2])+";height:16px></div>")}r+="<tr style="+(d%2==0?"background-color:#DDD":"")+"><td><div>&nbsp;"+printDate(u)+"<div></div></div></td><td><div>"+m+"</div></td></tr>",++d,u=new Date(u.getFullYear(),u.getMonth(),u.getDate()-1)}QH("p10html2",'<table style="color:black;background-color:#EEE;border-color:#AAA;border-width:1px;border-style:solid;border-collapse:collapse;width:calc(100% - 18px);margin:9px" border=0 cellpadding=2 cellspacing=0><tbody><tr style=background-color:#AAAAAA;font-weight:bold><th scope=col style=text-align:center;width:90px>Den</th><th scope=col style=text-align:center>Stav napájení</th></tr>'+r+"</tbody></table>")}}function powerColor(e){return e<powerColorTable.length?powerColorTable[e]:"yellow"}function isTimeBlockInside(e,t,n,o){return n<e&&t<o||e<n&&n<t||e<o&&o<t}function addDeviceAttribute(e,t){return"<tr><td style=width:100px;color:gray>"+e+"</td><td style=overflow:hidden>"+t+"</td></tr>"}function editDeviceAmtSettings(e,t){var n,o;xxdialogMode||(n="",o=3,0!=(4&GetNodeRights(e=getNodeFromId(e)))&&(n=(n+=addHtmlValue("Uživatelské jméno",'<input id=dp10username style=width:170px maxlength=32 autocomplete=nope placeholder="admin" onchange=validateDeviceAmtSettings() onkeyup=validateDeviceAmtSettings() />'))+addHtmlValue("Heslo","<input id=dp10password type=password style=width:170px autocomplete=nope maxlength=32 onchange=validateDeviceAmtSettings() onkeyup=validateDeviceAmtSettings() />"),0==(1&features2)&&(n+=addHtmlValue("Zabezpečení","<select id=dp10tls style=width:176px><option value=0>Žádné TLS zabezpečení</option><option value=1>TLS vyžadováno</option></select>")),setDialogMode(2,"Upravit přihlašovací údaje k Intel&reg; AMT",o=null!=e.intelamt.user&&""!=e.intelamt.user?7:o,editDeviceAmtSettingsEx,n,{node:e,func:t}),null!=e.intelamt.user&&""!=e.intelamt.user?Q("dp10username").value=e.intelamt.user:Q("dp10username").value="admin",0==(1&features2)&&(Q("dp10tls").value=e.intelamt.tls),validateDeviceAmtSettings()))}function validateDeviceAmtSettings(){QE("idx_dlgOkButton",passwordcheck(Q("dp10password").value))}function editDeviceAmtSettingsEx(e,t){var n;2==e?meshserver.send({action:"changedevice",nodeid:t.node._id,intelamt:{user:"",pass:""}}):(""==(e=Q("dp10username").value)&&(e="admin"),n=Q("dp10password").value,e={action:"changedevice",nodeid:t.node._id,intelamt:{user:e=""==n?"":e,pass:n}},0==(1&features2)&&(e.intelamt.tls=parseInt(Q("dp10tls").value)),meshserver.send(e),t.func&&setTimeout(t.func,1e3))}function p10showDeleteNodeDialog(e){xxdialogMode||(setDialogMode(2,"Smazat uzel",3,p10showDeleteNodeDialogEx,format("Smazat {0}?",EscapeHtml(currentNode.name))+"<br /><br /><label><input id=p10check type=checkbox onchange=p10validateDeleteNodeDialog() />Potvrdit</label>",e),p10validateDeleteNodeDialog())}function p10validateDeleteNodeDialog(){QE("idx_dlgOkButton",Q("p10check").checked)}function p10showDeleteNodeDialogEx(e,t){meshserver.send({action:"removedevices",nodeids:[t]})}function p10WebRouter(e,t,n,o){var a=null,i=getNodeFromId(e),s=(3==i.mtype&&(s=meshes[i.meshid])&&s.relayid&&(a=s.relayid,o=i.host),serverinfo.name),i=(-1!=s.indexOf(".")&&0==(2&features)||(s=window.location.hostname),"https://"+(s=""!=webRelayDns?webRelayDns:s)+":"+webRelayPort+"/control-redirect.ashx?n="+e+"&p="+n+"&appid="+t+"&c="+authRelayCookie);return null!=o&&(i+="&addr="+o),null!=a&&(i+="&relayid="+a),safeNewWindow(i,"WebRelay"),!1}function p10showiconselector(){xxdialogMode||0!=(4&GetNodeRights(currentNode))&&(setDialogMode(2,"Výběr ikony",0,null,"<table align=center><td style=text-align:center><div style=display:inline-block class=i1 onclick=p10setIcon(1)></div><div style=display:inline-block class=i2 onclick=p10setIcon(2)></div><div style=display:inline-block class=i3 onclick=p10setIcon(3)></div><div style=display:inline-block class=i4 onclick=p10setIcon(4)></div><br /><div style=display:inline-block class=i5 onclick=p10setIcon(5)></div><div style=display:inline-block class=i6 onclick=p10setIcon(6)></div><div style=display:inline-block class=i7 onclick=p10setIcon(7)></div><div style=display:inline-block class=i8 onclick=p10setIcon(8)></div></table>"),QV("id_dialogclose",!0))}function p10setIcon(e){setDialogMode(0),meshserver.send({action:"changedevice",nodeid:currentNode._id,icon:e})}function showClearSshDialog(){setDialogMode(2,"Upravit zařízení",3,showClearSshDialogEx,"Vymazat přihlašovací údaje SSH?")}function showClearSshDialogEx(e,t){meshserver.send({action:"changedevice",nodeid:currentNode._id,ssh:0})}function showClearRdpDialog(){setDialogMode(2,"Upravit zařízení",3,showClearRdpDialogEx,"Vymazat přihlašovací údaje RDP?")}function showClearRdpDialogEx(e,t){meshserver.send({action:"changedevice",nodeid:currentNode._id,rdp:0})}var desktop,desktopNode,showEditNodeValueDialog_modes=["Název zařízení","Název stroje","Popis","Štítky"],showEditNodeValueDialog_modes2=["name","host","desc","tags"],showEditNodeValueDialog_modes3=["","","","Skupina1, Skupina2, Skupina3"];function showEditNodeValueDialog(e){if(!xxdialogMode){var t=addHtmlValue(showEditNodeValueDialog_modes[e],'<input id=dp10devicevalue style=width:170px maxlength=64 placeholder="'+showEditNodeValueDialog_modes3[e]+'" onchange=p10editdevicevalueValidate('+e+",event) onkeyup=p10editdevicevalueValidate("+e+",event) />");if(3==e){var n=[],o="";for(i in nodes)if(nodes[i].tags)for(var a in nodes[i].tags)-1==n.indexOf(nodes[i].tags[a])&&n.push(nodes[i].tags[a]);if(0<n.length){for(var i in n.sort(),n)o+='<span style=padding:4px;background-color:#BBB;border-radius:3px;cursor:pointer onclick=showEditNodeValueDialogAddTag("'+encodeURIComponentEx(n[i])+'")>'+EscapeHtml(n[i])+"</span> ";t+="<div style=margin-top:8px;width:280px;line-height:26px;max-height:160px;overflow-y:auto>"+o+"</div>"}}setDialogMode(2,"Upravit zařízení",3,showEditNodeValueDialogEx,t,e);t=currentNode[showEditNodeValueDialog_modes2[e]];null==t&&(t=""),Array.isArray(t)&&(t=t.join(", ")),Q("dp10devicevalue").value=t,p10editdevicevalueValidate(),Q("dp10devicevalue").focus()}}function showEditNodeValueDialogAddTag(e){var t,n=Q("dp10devicevalue").value.split(","),o=[];for(t in n)o.push(n[t].trim());0<=o.indexOf(e)||(Q("dp10devicevalue").value+=(0==Q("dp10devicevalue").value.length?"":", ")+decodeURIComponent(e),setTimeout(function(){Q("dp10devicevalue").selectionStart=Q("dp10devicevalue").selectionEnd=9e4},0),p10editdevicevalueValidate())}function showEditNodeValueDialogEx(e,t){var n={action:"changedevice",nodeid:currentNode._id};n[showEditNodeValueDialog_modes2[t]]=Q("dp10devicevalue").value,meshserver.send(n)}function p10editdevicevalueValidate(e,t){e=1<e||0<Q("dp10devicevalue").value.length;QE("idx_dlgOkButton",e),null!=t&&1==e&&13==t.keyCode&&dialogclose(1)}var desktopsettings={encoding:2,showfocus:!1,showmouse:!0,showcad:!0,quality:40,scaling:1024,framerate:50,autolock:!1,agentencoding:4};function setupDesktop(){desktopNode!=currentNode&&null!=desktop&&(desktop.Stop(),desktop=desktopNode=null),desktopNode==currentNode&&null!=desktop||(desktopNode=currentNode,Q("Desk").addEventListener("DOMMouseScroll",function(e){return dmousewheel(e)}),Q("Desk").addEventListener("mousewheel",function(e){return dmousewheel(e)})),desktopNode=currentNode,updateDesktopButtons(),Q("Desk").toBlob||QV("deskSaveBtn",!1)}function updateDesktopButtons(){meshes[currentNode.meshid];var e=0,t=(null!=desktop&&(e=desktop.State),GetNodeRights(currentNode)),e=(QV("disconnectbutton1",0!=e),QE("deskFullScreen",0!=e),QV("connectbutton1",0==e&&(8&t||256&t)&&null!=currentNode.agent&&1&currentNode.agent.caps),QV("connectbutton1h",0==e&&8&t&&null!=currentNode.intelamt&&2==currentNode.intelamt.state&&null!=currentNode.intelamt.ver&&(null==currentNode.intelamt.sku||"number"==typeof currentNode.intelamt.sku&&0!=(8&currentNode.intelamt.sku))),QV("d7amtkvm",!(null==currentNode.intelamt||"number"==typeof currentNode.intelamt.sku&&0!=(16&currentNode.intelamt.sku)||null==currentNode.intelamt.ver&&null!=currentNode.agent||0!=e&&2!=desktop.contype)),QV("d7meshkvm",null!=currentNode.agent&&1&currentNode.agent.caps&&(0==e||1==desktop.contype)),0!=(1&currentNode.conn)),n=(QE("connectbutton1",e),0!=(6&currentNode.conn));QE("connectbutton1h",n),QV("DeskToastButton",0!=(16384&t)&&currentNode.agent&&currentNode.agent.id<5&&8&t),QV("deskActionsBtn",8&t),Q("DeskControl").checked=0!=(8&t),0==e&&QV("DeskTools",!1)}var agentConsoleMessages=["","Čekání na povolení přístupu uživatelem ...","Odepřeno","Zahájení relace vzdáleného terminálu se nezdařilo, {0} ({1})","Časový limit","Přijata neplatná síťová data"];function formatAgentConsoleMessage(e,t,n){for(null==n&&(n=[]);n.length<3;)n.push("");return(t&&t<agentConsoleMessages.length?EscapeHtml(format(agentConsoleMessages[t],n[0],n[1],n[2])):EscapeHtml(e)).split("\n").join("<br />")+"<br /><br />"}function connectDesktop(e,t,n,o){setSessionActivity(),QV("p11DeskSessionSelector",!1),p11clearConsoleMsg(),null==desktop?(desktopNode=currentNode,2==t?null==desktopNode.intelamt.user||""==desktopNode.intelamt.user?editDeviceAmtSettings(desktopNode._id,connectDesktop):((desktop=CreateAmtRedirect(CreateAmtRemoteDesktop("Desk"),authCookie)).debugmode=debugmode,desktop.onStateChanged=onDesktopStateChange,desktop.m.bpp=1==desktopsettings.encoding||3==desktopsettings.encoding?1:2,desktop.m.useZRLE=desktopsettings.encoding<3,desktop.m.showmouse=!0,desktop.m.onScreenSizeChange=function(e,t,n){fullscreen&&(QS("deskarea3").width=t*fullscreenzoom+"px",QS("deskarea3").height=n*fullscreenzoom+"px"),deskAdjust()},4==desktopNode.conn&&null!=desktopNode.intelamt&&1==desktopNode.intelamt.tls?desktop.Start(desktopNode._id,16995,"*","*",1):desktop.Start(desktopNode._id,16994,"*","*",0),desktop.contype=2):null==t||1==t||3==t&&4<currentNode.agent.id?((desktop=CreateAgentRedirect(meshserver,CreateAgentRemoteDesktop("Desk"),serverPublicNamePort,authCookie,authRelayCookie,domainUrl)).debugmode=debugmode,desktop.m.debugmode=debugmode,desktop.attemptWebRTC=attemptWebRTC,desktop.webrtcconfig=webrtcconfiguration,desktop.options={},null!=n&&(desktop.options.tsid=n),null!=o&&(desktop.options.consent=o),1==desktopsettings.autolock&&(desktop.options.autolock=!0),desktop.onStateChanged=onDesktopStateChange,0!=(8192&features2)&&(desktop.m.stopInput=!0),desktop.onConsoleMessageChange=function(){desktop.consoleMessage?(Q("p11DeskConsoleMsg").innerHTML+=formatAgentConsoleMessage(desktop.consoleMessage,desktop.consoleMessageId,desktop.consoleMessageArgs),QV("p11DeskConsoleMsg",!0),null!=p11DeskConsoleMsgTimer&&clearTimeout(p11DeskConsoleMsgTimer),desktop.consoleMessageTimeout&&(p11DeskConsoleMsgTimer=setTimeout(p11clearConsoleMsg,1e3*desktop.consoleMessageTimeout))):p11clearConsoleMsg()},desktop.m.ImageType=desktopsettings.agentencoding,desktop.m.CompressionLevel=desktopsettings.quality,desktop.m.ScalingLevel=desktopsettings.scaling,desktop.m.FrameRateTimer=desktopsettings.framerate,desktop.m.onDisplayinfo=deskDisplayInfo,desktop.m.onScreenSizeChange=function(e,t,n){fullscreen&&(QS("deskarea3").width=t*fullscreenzoom+"px",QS("deskarea3").height=n*fullscreenzoom+"px"),deskAdjust()},desktop.Start(desktopNode._id),desktop.contype=1):3==t&&meshserver.send({action:"msg",type:"userSessions",nodeid:currentNode._id,tag:o})):(desktop.Stop(),desktopNode=desktop=null)}function p11clearConsoleMsg(){QH("p11DeskConsoleMsg",""),QV("p11DeskConsoleMsg",!1),p11DeskConsoleMsgTimer&&(clearTimeout(p11DeskConsoleMsgTimer),p11DeskConsoleMsgTimer=null)}function p12clearConsoleMsg(){QH("p12TermConsoleMsg",""),QV("p12TermConsoleMsg",!1),p12TermConsoleMsgTimer&&(clearTimeout(p12TermConsoleMsgTimer),p12TermConsoleMsgTimer=null)}function p13clearConsoleMsg(){QH("p13FilesConsoleMsg",""),QV("p13FilesConsoleMsg",!1),p13FilesConsoleMsgTimer&&(clearTimeout(p13FilesConsoleMsgTimer),p13FilesConsoleMsgTimer=null)}function p12setConsoleMsg(e,t){e?(Q("p12TermConsoleMsg").innerHTML+=e,QV("p12TermConsoleMsg",!0),null!=p12TermConsoleMsgTimer&&clearTimeout(p12TermConsoleMsgTimer),t&&(p12TermConsoleMsgTimer=setTimeout(p12clearConsoleMsg,t))):p12clearConsoleMsg()}function p13setConsoleMsg(e,t){e?(Q("p13FilesConsoleMsg").innerHTML+=e,QV("p13FilesConsoleMsg",!0),null!=p13FilesConsoleMsgTimer&&clearTimeout(p13FilesConsoleMsgTimer),t&&(p13FilesConsoleMsgTimer=setTimeout(p13clearConsoleMsg,t))):p13clearConsoleMsg()}function onDesktopStateChange(e,t){var n=t,e=(3==n&&2==e.contype&&n++,StatusStrs[n]);null!=desktop&&1==desktop.webRtcActive&&(e+=", WebRTC"),QH("deskstatus",e),0===t&&(desktop.Stop(),desktopNode=desktop=null,QV("DeskScreens",!1),1==fullscreen)&&deskToggleFull(),updateDesktopButtons(),deskAdjust(),setTimeout(deskAdjust,50)}function showDesktopSettings(){xxdialogMode||(applyDesktopSettings(),updateDesktopButtons(),setDialogMode(7,"Nastavení vzdálené plochy",3,showDesktopSettingsChanged))}function showDesktopSettingsChanged(){desktopsettings.encoding=d7desktopmode.value,desktopsettings.quality=d7bitmapquality.value,desktopsettings.scaling=d7bitmapscaling.value,desktopsettings.framerate=d7framelimiter.value,desktopsettings.autolock=d7deskAutoLock.checked,desktopsettings.agentencoding=d7encoding.value,localStorage.setItem("desktopsettings",JSON.stringify(desktopsettings)),applyDesktopSettings(),desktop&&(1==desktop.contype&&(0!=desktop.State&&desktop.m.SendCompressionLevel(desktopsettings.agentencoding,desktopsettings.quality,desktopsettings.scaling,desktopsettings.framerate),desktop.sendCtrlMsg('{"ctrlChannel":"102938","type":"autolock","value":'+desktopsettings.autolock+"}"),desktop.m.SendRefresh()),2==desktop.contype)&&0!=desktop.State&&(desktop.Stop(),setTimeout(function(){connectDesktop(null,2)},50))}function applyDesktopSettings(){var e,t="",n=512&features?[100,90,70,50,40,30,20,10,5,1]:[50,40,30,20,10,5,1];for(e in n)t+="<option value="+n[e]+">"+n[e]+"%</option>";QH("d7bitmapquality",t),d7desktopmode.value=desktopsettings.encoding,d7bitmapquality.value=40,desktopsettings.agentencoding?d7encoding.value=desktopsettings.agentencoding:desktopsettings.agentencoding=4,0<=n.indexOf(parseInt(desktopsettings.quality))&&(d7bitmapquality.value=desktopsettings.quality),d7bitmapscaling.value=desktopsettings.scaling,desktopsettings.framerate&&(d7framelimiter.value=desktopsettings.framerate),null!=desktopsettings.autolock&&(d7deskAutoLock.checked=desktopsettings.autolock)}var keyboardShown=!1,keyboardShownTimer=null,fullScreenMode=!1;function toggleKeyboard(){xxdialogMode||(null!=keyboardShownTimer&&clearTimeout(keyboardShownTimer),keyboardShown=keyboardShown?(Q("softKeyboard").blur(),!1):(Q("softKeyboard").focus(),!0),QV("deskkeybutton2a",fullscreen&&!keyboardShown),QV("deskkeybutton2b",fullscreen&&keyboardShown))}function keyboardFocusChange(){keyboardShownTimer=setTimeout(function(){keyboardShownTimer=null,keyboardShown=Q("softKeyboard")==document.activeElement,QV("deskkeybutton2a",fullscreen&&!keyboardShown),QV("deskkeybutton2b",fullscreen&&keyboardShown)},10)}function exitButton(){xxdialogMode||(QV("deskButtonMenu",!1),QV("termButtonMenu",!1),deskToggleFull())}function deskMenuButton(e){toggleMenu(!0),deskSendKeys(e)}function updateDeskShortcutKeys(){var e,t='<div class="menuButton" onclick="deskMenuButton(-1)">Přizpůsobit</div>';for(e in deskKeyboardShortcuts)t+='<div class="menuButton" onclick="deskMenuButton('+deskKeyboardShortcuts[e]+')">'+keyShortcutTotext(deskKeyboardShortcuts[e])+"</div>";QH("deskButtonMenu",t)}var keyStrings={8:"BackSpace",9:"Tab",13:"Zadání",27:"Uniknout",32:"Space",32:"Espace",44:"Tisk obrazovky",45:"Vložit",46:"Del",36:"Domov",35:"Konec",33:"Page Up",34:"Page Down",37:"Vlevo, odjet",38:"Nahoru",39:"Že jo",40:"Dolů",0:"Nic"};function keyShortcutTotext(e){var t=[];return 65536&e&&t.push("Posun"),131072&e&&t.push("Alt"),524288&e&&t.push("Ctrl"),1048576&e&&t.push("Win"),112<=(e&=65535)&&e<=123?t.push("F"+(e-111)):0!=e&&keyStrings[e]?t.push(keyStrings[e]):0!=e&&t.push(String.fromCharCode(e)),t.join(" + ")}function deskCustomizeKeys(){if(!xxdialogMode){var e=(e='<div id=d2shortcuts style="width:100%;height:180px;padding:4px;overflow-y:auto;border:1px solid gray"></div><div style=width:100%;padding:5px>')+"<label><input id=d1kshift type=checkbox /> Posun</label><label> <input id=d1kalt type=checkbox /> Alt</label><label> <input id=d1kctrl type=checkbox /> Ctrl</label> <input id=d1kwin type=checkbox /> Win</label>"+" <select id=d2keySelect>";for(t in keyStrings)e+="<option value="+t+">"+keyStrings[t]+"</option>";for(var t=1;t<=12;t++)e+="<option value="+(t+111)+">F"+t+"</option>";for(t=0;t<10;t++)e+="<option value="+(t+48)+">"+t+"</option>";for(t=0;t<26;t++)e+="<option value="+(t+65)+">"+String.fromCharCode(t+65)+"</option>";e+="</select> <input type=button value=Přidat onclick=addDeskCustomizeKey() /></div>",QH("p10dialog2",e),xxdialogMode=2,QV("p10dialog",!0),deskUpdateShortcutList()}}function deskCustomizeKeysEx(){QV("p10dialog",!1),xxdialogMode=0,putstore("deskKeyShortcuts",deskKeyboardShortcuts.join(",")),updateDeskShortcutKeys()}function restoreDeskCustomizeKey(){deskKeyboardShortcuts=[],putstore("deskKeyShortcuts",null);var e,t=getstore("deskKeyShortcuts","0x0A002E,0x100000,0x100028,0x100026,0x10004C,0x10004D,0x11004D,0x100052,0x020073,0x080057,0x020009,0x100025,0x100027").split(",");for(e in t)""!=t[e]&&deskKeyboardShortcuts.push(parseInt(t[e]));updateDeskShortcutKeys(),deskUpdateShortcutList()}function deskUpdateShortcutList(){var e,t="";for(e in deskKeyboardShortcuts){var n=keyShortcutTotext(deskKeyboardShortcuts[e]),o="";e!=deskKeyboardShortcuts.length-1&&(o+='<img width=8 height=8 style=float:right;cursor:pointer;padding:3px src="images/c2.png" onclick=deskCustomizeKeyDown('+deskKeyboardShortcuts[e]+")>"),0!=e&&(o+='<img width=8 height=8 style=float:right;cursor:pointer;padding:3px src="images/c3.png" onclick=deskCustomizeKeyUp('+deskKeyboardShortcuts[e]+")>"),t+='<div style="width:100%;background-color:#AAA;border-radius:4px;margin-bottom:4px;padding:4px;text-align:left;box-sizing:border-box" value='+deskKeyboardShortcuts[e]+">"+n+'<img width=10 height=10 style=float:right;cursor:pointer;padding:2px;margin-left:8px src="images/trash.png" onclick=removeDeskCustomizeKey('+deskKeyboardShortcuts[e]+")>"+o+"</div>"}""==t&&(t="<i>Nejsou definovány žádné klávesové zkratky</i>"),QH("d2shortcuts",t)}function deskCustomizeKeyDown(e){var e=deskKeyboardShortcuts.indexOf(e),t=deskKeyboardShortcuts[e+1];deskKeyboardShortcuts[e+1]=deskKeyboardShortcuts[e],deskKeyboardShortcuts[e]=t,deskUpdateShortcutList()}function deskCustomizeKeyUp(e){var e=deskKeyboardShortcuts.indexOf(e),t=deskKeyboardShortcuts[e];deskKeyboardShortcuts[e]=deskKeyboardShortcuts[e-1],deskKeyboardShortcuts[e-1]=t,deskUpdateShortcutList()}function removeDeskCustomizeKey(e){var t,n=[];for(t in deskKeyboardShortcuts)deskKeyboardShortcuts[t]!=e&&n.push(deskKeyboardShortcuts[t]);deskKeyboardShortcuts=n,deskUpdateShortcutList()}function addDeskCustomizeKey(){var e=parseInt(Q("d2keySelect").value);Q("d1kshift").checked&&(e|=65536),Q("d1kalt").checked&&(e|=131072),Q("d1kctrl").checked&&(e|=524288),Q("d1kwin").checked&&(e|=1048576),0<e&&-1==deskKeyboardShortcuts.indexOf(e)&&(deskKeyboardShortcuts.push(e),deskUpdateShortcutList())}function deskSendKeys(e){if(!xxdialogMode&&null!=desktop&&3==desktop.State)if(-1==e)deskCustomizeKeys();else if(655406==e)desktop.m.sendcad();else{var t=(16711680&e)>>16,e=65535&e,n=[],o=[],a={8:65288,9:65289,13:65293,27:65307,45:65379,46:65535,36:65360,35:65367,33:65365,34:65366,37:65361,38:65362,39:65363,40:65364,112:65470,113:65471,114:65472,115:65473,116:65474,117:65475,118:65476,119:65477,120:65478,121:65479,122:65480,123:65481};if(2==desktop.contype){1&t&&(n.push([65505,1]),o.push([65505,0])),2&t&&(n.push([65513,1]),o.push([65513,0])),8&t&&(n.push([65507,1]),o.push([65507,0])),16&t&&(n.push([65511,1]),o.push([65511,0])),65<=(e=a[e]?a[e]:e)&&e<=90&&(e+=32),0!=e&&(n.push([e,1]),o.push([e,0])),o.reverse();for(var i=0;i<o.length;i++)n.push(o[i]);desktop.m.sendkey(n)}else{1&t&&(n.push([desktop.m.KeyAction.DOWN,16]),o.push([desktop.m.KeyAction.UP,16])),2&t&&(n.push([desktop.m.KeyAction.EXDOWN,18]),o.push([desktop.m.KeyAction.EXUP,18])),8&t&&(n.push([desktop.m.KeyAction.EXDOWN,17]),o.push([desktop.m.KeyAction.EXUP,17])),16&t&&(n.push([desktop.m.KeyAction.EXDOWN,91]),o.push([desktop.m.KeyAction.EXUP,91])),0!=e&&(n.push([desktop.m.KeyAction.DOWN,e]),o.push([desktop.m.KeyAction.UP,e])),o.reverse();for(i=0;i<o.length;i++)n.push(o[i]);desktop.m.SendKeyMsgKC(n)}}}function toggleMenu(e){xxdialogMode||(QV("deskButtonMenu",fullscreen&&!e&&1==currentDevicePanel),QV("termButtonMenu",fullscreen&&!e&&5==currentDevicePanel),QV("deskkeybutton3a",fullscreen&&e),QV("deskkeybutton3b",fullscreen&&!e))}function deskChangeMouseButton(e){xxdialogMode||null!=desktop&&(desktop.m.SwapMouse=!desktop.m.SwapMouse,QV("deskkeybutton4a",fullscreen&&!desktop.m.SwapMouse),QV("deskkeybutton4b",fullscreen&&desktop.m.SwapMouse))}function deskChangeFullscreenZoom(){if(!xxdialogMode){if(1==currentDevicePanel){if(null==desktop)return;fullscreenzoom=1==fullscreenzoom?.5:1,QV("deskkeybutton5a",fullscreen&&1==fullscreenzoom),QV("deskkeybutton5b",fullscreen&&1!=fullscreenzoom),QS("deskarea3").width=desktop.m.ScreenWidth*fullscreenzoom+"px",QS("deskarea3").height=desktop.m.ScreenHeight*fullscreenzoom+"px",deskAdjust()}5==currentDevicePanel&&null!=terminal&&xterm.setOption("fontSize",15==xterm.getOption("fontSize")?10:15)}}var terminalNode,filesNode,fullscreen=!1,fullscreenzoom=1;function deskToggleFull(){fullscreen=!fullscreen,QV("mastheadx",!fullscreen),QV("masthead",!fullscreen),QV("topbar",!fullscreen),QV("p11deviceNameHeader",!fullscreen),QV("footer",!fullscreen),QV("column_l_bottomgap",!fullscreen),QV("idx_deskFullBtn2",fullscreen),QV("deskFullBtn",!fullscreen),QV("p10deskTopTable",!fullscreen),QV("deskarea1",!fullscreen),QV("deskarea4",!fullscreen),QV("termarea1",!fullscreen),QV("termarea4",!fullscreen);var e=GetNodeRights(currentNode),e=0==(8192&features2)&&14!=currentNode.agent.id&&(4294967295==e||0!=(8&e)&&0==(256&e)&&0==(4096&e));QV("deskkeybutton1",fullscreen),1==currentDevicePanel&&(QS("deskkeybutton2a").top=QS("deskkeybutton2b").top="210px",QS("deskkeybutton5a").top=QS("deskkeybutton5b").top=e?"160px":"60px",QV("deskkeybutton2a",fullscreen&&e),QV("deskkeybutton2b",!1),QV("deskkeybutton3a",fullscreen&&e),QV("deskkeybutton3b",!1),QV("deskkeybutton4a",fullscreen&&e&&!desktop.m.SwapMouse),QV("deskkeybutton4b",fullscreen&&e&&desktop.m.SwapMouse),QV("deskkeybutton5a",fullscreen&&1==fullscreenzoom),QV("deskkeybutton5b",fullscreen&&1!=fullscreenzoom)),5==currentDevicePanel&&(QS("deskkeybutton2a").top=QS("deskkeybutton2b").top="110px",QV("deskkeybutton2a",fullscreen),QV("deskkeybutton2b",!1),QV("deskkeybutton3a",fullscreen),QV("deskkeybutton3b",!1),QV("deskkeybutton4a",!1),QV("deskkeybutton4b",!1),QV("deskkeybutton5a",!1),QV("deskkeybutton5a",!1)),fullscreen?(QS("DeskParent").height=null,QS("page_content").top="0px",QS("page_content").bottom="0px",1==currentDevicePanel&&(QS("p10desktop").top="0px",QS("p10desktop").overflow="scroll",QS("deskarea3").top="0px",QS("deskarea3").width=desktop.m.ScreenWidth*fullscreenzoom+"px",QS("deskarea3").height=desktop.m.ScreenHeight*fullscreenzoom+"px",QS("deskarea3")["padding-right"]="55px"),5==currentDevicePanel&&(QS("p10terminal").top="0px",QS("p10terminal").overflow="scroll",QS("termarea3").top="0px",QS("termarea3").bottom=null,QS("termarea3").right=null,QS("termarea3")["padding-right"]="55px",QS("termarea3").height="100%"),QS("body")["background-color"]="#000",QS("p10")["background-color"]="#000"):(QS("DeskParent").height="100%",QS("page_content").top="50px",QS("page_content").bottom="32px",1==currentDevicePanel&&(QS("p10desktop").top="55px",QS("p10desktop").overflow="hidden",QS("deskarea3").top="32px",QS("deskarea3").left=null,QS("deskarea3").width="100%",QS("deskarea3").height="calc(100% - 64px)",QS("deskarea3")["padding-right"]="",QS("DeskParent")["margin-top"]=null,QS("DeskParent")["margin-left"]=null),5==currentDevicePanel&&(QS("p10terminal").top="55px",QS("p10terminal").overflow="hidden",Q("p10terminal").scrollTop=0,Q("p10terminal").scrollLeft=0,QS("termarea3").top="32px",QS("termarea3").bottom="32px",QS("termarea3")["padding-right"]=null,QS("termarea3").height="calc(100% - 60px)"),QS("body")["background-color"]=nightMode?"#000":"#FFF",QS("p10")["background-color"]=null),1==currentDevicePanel&&deskAdjust()}function deskAdjust(){var e,t,n,o;1==currentDevicePanel&&(fullscreen?(QS("Desk")["margin-top"]=null,QS("Desk")["margin-bottom"]=null,QS("Desk").width="100%",QS("Desk").height="100%",e=Q("p10desktop").clientHeight,n=Q("p10desktop").clientWidth,t=Q("deskarea3").clientHeight,o=Q("deskarea3").clientWidth-55,QS("deskarea3").top=t<e?(e-t)/2+"px":null,QS("deskarea3").left=o<n?(n-o)/2+"px":null):(e=Q("DeskParent").clientHeight,n=Q("DeskParent").clientWidth,(t=Q("Desk").height)/(o=Q("Desk").width)<e/n?(n=t*n/o+"px",QS("Desk").height=n,QS("Desk").width="100%"):(n=o*e/t+"px",QS("Desk").width=n,QS("Desk").height="100%"),QS("DeskParent").overflow="hidden",o=(Q("DeskParent").clientHeight-Q("Desk").clientHeight)/2,QS("Desk")["margin-top"]=o+"px",QS("Desk")["margin-bottom"]=o+"px"))}function sendSpecialKeys(){xxdialogMode||null==desktop||3!=desktop.State||setDialogMode(3,"Speciální klávesy",3,deskSendKeys)}function deskSaveImage(){var e,t;setSessionActivity(),xxdialogMode||null==desktop||3!=desktop.State||(e=new Date,t="Desktop-"+currentNode.name+"-"+e.getFullYear()+"-"+("0"+(e.getMonth()+1)).slice(-2)+"-"+("0"+e.getDate()).slice(-2)+"-"+("0"+e.getHours()).slice(-2)+"-"+("0"+e.getMinutes()).slice(-2),Q("Desk").toBlob(function(e){saveAs(e,t+".png")}))}function deskSelectScreens(){if(!xxdialogMode&&null!=desktop&&3==desktop.State){var e,t="",n=desktop.m.displays;for(e in n)t+="<option value="+e+" "+(desktop.m.selectedDisplay==e?" selected":"")+">"+n[e]+"</option>";setDialogMode(2,"Výběr obrazovky",3,deskSelectScreensEx,t=addHtmlValue4("Obrazovka","<select style=width:100% id=deskdisplays>"+t+"</select>"))}}function deskSelectScreensEx(){null!=desktop&&3==desktop.State&&desktop.m.SetDisplay(parseInt(Q("deskdisplays").value))}function deskDisplayInfo(e,t,n,o){var a,i=0;for(a in t)i++;QV("DeskScreens",1<i)}function dmousedown(e){setSessionActivity(),xxdialogMode||null==desktop||(fullscreen&&(e.addx=Q("p10desktop").scrollLeft*(1/fullscreenzoom),e.addy=Q("p10desktop").scrollTop*(1/fullscreenzoom)),desktop.m.mousedown(e))}function dmouseup(e){setSessionActivity(),xxdialogMode||null==desktop||(fullscreen&&(e.addx=Q("p10desktop").scrollLeft*(1/fullscreenzoom),e.addy=Q("p10desktop").scrollTop*(1/fullscreenzoom)),desktop.m.mouseup(e))}function dmousemove(e){setSessionActivity(),xxdialogMode||null==desktop||(fullscreen&&(e.addx=Q("p10desktop").scrollLeft*(1/fullscreenzoom),e.addy=Q("p10desktop").scrollTop*(1/fullscreenzoom)),desktop.m.mousemove(e))}function dmousewheel(e){return setSessionActivity(),!(xxdialogMode||null==desktop||!desktop.m.mousewheel||(fullscreen&&(e.addx=Q("p10desktop").scrollLeft*(1/fullscreenzoom),e.addy=Q("p10desktop").scrollTop*(1/fullscreenzoom)),desktop.m.mousewheel(e),haltEvent(e),0))}function drotate(e){xxdialogMode||null==desktop||(desktop.m.setRotation(desktop.m.rotation+e),deskAdjust())}function setupTerminal(){terminalNode!=currentNode&&null!=terminal&&(terminal.Stop(),terminal=null),terminalNode=currentNode,updateTerminalButtons()}function updateTerminalButtons(){currentNode.agent;var e=null!=terminal&&0!=terminal.state,t=(QE("termFullScreen",0!=e),3==terminalNode.mtype&&null!=terminalNode.agent&&4<terminalNode.agent.id&&512&features2&&(terminalNode.agent.caps=6),QV("disconnectbutton2span",1==e),QV("connectbutton2span",0==e&&null!=terminalNode.agent&&2&terminalNode.agent.caps&&3!=terminalNode.mtype),QV("connectbutton2sspan",0==e&&null!=terminalNode.agent&&2&terminalNode.agent.caps&&3!=terminalNode.agent.id),0!=(1&terminalNode.conn)||3==terminalNode.mtype);QE("connectbutton2",t),QE("connectbutton2s",t),QV("termActionsBtn",3!=terminalNode.mtype),QE("ctrlcbutton",e),QE("ctrlxbutton",e),QE("escbutton",e),1==e&&3!=terminal.contype||null==terminalNode.agent||3==terminalNode.agent.id||4==terminalNode.agent.id?QH("terminalCustomUpperRight",""):QH("terminalCustomUpperRight","<a style=cursor:pointer onclick=cmsshportaction(1,event)>"+format("Port SSH {0}",terminalNode.sshport||22)+"</a>")}function cmsshportaction(e){xxdialogMode||(setDialogMode(2,"Připojení SSH",3,function(){var e=0<Q("d10sshport").value.length?parseInt(Q("d10sshport").value):22;meshserver.send({action:"changedevice",nodeid:currentNode._id,sshport:e})},'Port vzdáleného připojení SSH:<br /><br /><input type=text placeholder="22" inputmode="numeric" pattern="[0-9]*" onkeypress="return (event.keyCode == 8) || (event.charCode >= 48 && event.charCode <= 57)" maxlength=5 id=d10sshport type=text>',currentNode),Q("d10sshport").focus(),null!=currentNode.sshport&&(Q("d10sshport").value=currentNode.sshport))}function onTerminalStateChange(e,t){var n=t,e=(3==n&&2==e.contype&&n++,StatusStrs[n]);switch(1==terminal.webRtcActive&&(e+=", WebRTC"),QH("termstatus",e),t){case 0:xterm.dispose(),(xterm=null)!=terminal&&(terminal.Stop(),terminal=null);break;case 3:xterm.focus()}updateTerminalButtons()}function CreateRemoteTunnel(e,t){var n={protocol:1};return null!=t&&"number"==typeof t.protocol&&(n.protocol=t.protocol),n.onTunnelUpdate=e,n.xxStateChange=function(e){},n.ProcessBinaryData=function(e){n.onTunnelUpdate(e)},n.ProcessData=function(e){n.onTunnelUpdate(e)},n.terminalEmulation=1,n.fxEmulation=0,n.lineFeed="\r\n",n}function tunnelUpdate(e){null!=xterm&&(xterm.writeUtf8?"string"==typeof e?xterm.writeUtf8(e):xterm.writeUtf8(new Uint8Array(e)):"string"==typeof e?xterm.write(e):xterm.write(new Uint8Array(e)))}function sshTunnelAuthDialog(e,t){var n="";e.askkeypass?n+=addHtmlValue("Ověření","<select id=dp2authmethod style=width:150px onchange=sshAuthUpdate(event)><option value=3 selected>Uložený klíč</option><option value=1>Uživatelské jméno heslo</option><option value=2>Uživatelské jméno a klíč</option></select>"):n+=addHtmlValue("Ověření","<select id=dp2authmethod style=width:150px onchange=sshAuthUpdate(event)><option value=1 selected>Uživatelské jméno heslo</option><option value=2>Uživatelské jméno a klíč</option></select>"),n=(n=(n+="<div id=d2userauth style=display:none>")+addHtmlValue("Uživatelské jméno","<input id=dp2user style=width:150px maxlength=64 autocomplete=off onkeyup=sshAuthUpdate(event) />")+"</div><div id=d2passauth style=display:none>")+addHtmlValue("Heslo","<input type=password id=dp2pass style=width:150px maxlength=64 autocomplete=off onkeyup=sshAuthUpdate(event) />"),0==(4194304&features2)&&(n+="<label><input id=dp2keep type=checkbox>Pamatujte si přihlašovací údaje</label>"),n=(n=(n+="</div><div id=d2keyauth style=display:none>")+addHtmlValue("Soubor klíče","<input type=file id=dp2key style=width:150px maxlength=64 autocomplete=off onchange=sshAuthUpdate(event) /><div id=d2badkey style=font-size:x-small>Soubor klíče musí být ve formátu OpenSSH.</div>"))+addHtmlValue("Klíčové heslo","<input type=password id=dp2keypass style=width:150px maxlength=64 autocomplete=off onkeyup=sshAuthUpdate(event) />"),0==(4194304&features2)&&(n+="<label><input id=dp2keep1 type=checkbox onchange=sshAuthUpdate(event)>Zapamatujte si uživatele a klíč</label><br/><label><input id=dp2keep2 type=checkbox>Pamatuj si heslo</label>"),n+="</div>",setDialogMode(2,"Ověření",11,t,n=e.askkeypass?(n+="<div id=d2keyauth2 style=display:none>")+addHtmlValue("Heslo","<input type=password id=dp2keypass2 style=width:150px maxlength=64 autocomplete=off onkeyup=sshAuthUpdate(event) />")+"</div>":n,"ssh"),Q("dp2user").focus(),sshAuthUpdate(),setTimeout(sshAuthUpdate,50)}function sshTunnelUpdate(e){if("string"==typeof e)if("{"==e[0]){var t=JSON.parse(e);switch(t.action){case"sshauth":sshTunnelAuthDialog(t,sshConnectEx);break;case"sshautoauth":terminal.socket.send(JSON.stringify({action:"sshautoauth",cols:xterm.cols,rows:xterm.rows,width:Q("termarea3xdiv").offsetWidth,height:Q("termarea3xdiv").offsetHeight}));break;case"autherror":p12setConsoleMsg("Chyba ověření",5e3);break;case"sessionerror":p12setConsoleMsg("Relace vypršela",5e3);break;case"sessiontimeout":p12setConsoleMsg("Časový limit relace",5e3)}}else"~"==e[0]&&(xterm.writeUtf8?xterm.writeUtf8(e.substring(1)):xterm.write(e.substring(1)))}function sshAuthUpdate(e){var t;QV("d2userauth",3!=Q("dp2authmethod").value),QV("d2passauth",1==Q("dp2authmethod").value),QV("d2keyauth",2==Q("dp2authmethod").value),QV("d2keyauth2",3==Q("dp2authmethod").value),1==Q("dp2authmethod").value?QE("idx_dlgOkButton",0<Q("dp2user").value.length&&0<Q("dp2pass").value.length):3==Q("dp2authmethod").value?QE("idx_dlgOkButton",0<Q("dp2keypass2").value.length):(QE("idx_dlgOkButton",!1),0==(4194304&features2)&&QE("dp2keep2",Q("dp2keep1").checked),1==(0<Q("dp2user").value.length&&null!=Q("dp2key").files&&1==Q("dp2key").files.length&&Q("dp2key").files[0].size<8e3)&&((t=new FileReader).onload=function(e){e=0<=e.target.result.indexOf("-----BEGIN OPENSSH PRIVATE KEY-----")&&0<=e.target.result.indexOf("-----END OPENSSH PRIVATE KEY-----")||0<=e.target.result.indexOf("-----BEGIN RSA PRIVATE KEY-----")&&0<=e.target.result.indexOf("-----END RSA PRIVATE KEY-----");QE("idx_dlgOkButton",e),QS("d2badkey").color=e?"#000":"#F00"},t.readAsText(Q("dp2key").files[0]))),e&&13==e.keyCode&&e.target&&1==Q("dp2authmethod").value&&("dp2user"==e.target.id&&Q("dp2pass").focus(),"dp2pass"==e.target.id)&&dialogclose(1)}function sshConnectEx(e){var t,n,o;0==e?null!=terminal&&connectTerminal():(t=0,1==Q("dp2authmethod").value?(0==(4194304&features2)&&(t=Q("dp2keep").checked?1:0),terminal.socket.send(JSON.stringify({action:"sshauth",username:Q("dp2user").value,password:Q("dp2pass").value,keep:t,cols:xterm.cols,rows:xterm.rows,width:Q("termarea3xdiv").offsetWidth,height:Q("termarea3xdiv").offsetHeight}))):3==Q("dp2authmethod").value?terminal.socket.send(JSON.stringify({action:"sshkeyauth",keypass:Q("dp2keypass2").value,cols:xterm.cols,rows:xterm.rows,width:Q("termarea3xdiv").offsetWidth,height:Q("termarea3xdiv").offsetHeight})):(0==(4194304&features2)&&1==(t=Q("dp2keep1").checked?1:0)&&(t+=Q("dp2keep2").checked?1:0),e=new FileReader,n=Q("dp2user").value,o=Q("dp2keypass").value,e.onload=function(e){terminal.socket.send(JSON.stringify({action:"sshauth",username:n,keypass:o,key:e.target.result,keep:t,cols:xterm.cols,rows:xterm.rows,width:Q("termarea3xdiv").offsetWidth,height:Q("termarea3xdiv").offsetHeight}))},e.readAsText(Q("dp2key").files[0])))}function xTermSendResize(){(xtermResizeTimer=null)!=xterm&&null!=terminal&&null!=terminal.sendCtrlMsg&&("sshterminalrelay.ashx"==terminal.urlname?terminal.socket.send(JSON.stringify({action:"resize",cols:xterm.cols,rows:xterm.rows,width:Q("termarea3xdiv").offsetWidth,height:Q("termarea3xdiv").offsetHeight})):terminal.sendCtrlMsg(JSON.stringify({ctrlChannel:"102938",type:"termsize",cols:xterm.cols,rows:xterm.rows})))}function connectTerminal(e,t,n){var o;p12clearConsoleMsg(),terminal?(terminal.Stop(),terminal=null,fullscreen&&deskToggleFull()):(o={protocol:null!=n&&"number"==typeof n.protocol?n.protocol:1},n&&n.requireLogin&&(o.requireLogin=!0),null!=serverinfo.linuxshell&&4<currentNode.agent.id&&("root"==serverinfo.linuxshell&&(o.protocol=1,delete o.requireLogin),"user"==serverinfo.linuxshell&&(o.protocol=8,delete o.requireLogin),"login"==serverinfo.linuxshell)&&(o.protocol=1,o.requireLogin=!0),QV("termarea3xdiv",!0),null!=xterm&&xterm.dispose(),xterm=new Terminal,(xtermfit=new FitAddon.FitAddon)&&xterm.loadAddon(xtermfit),xterm.open(Q("termarea3xdiv")),xterm.onData(function(e){"sshterminalrelay.ashx"==terminal.urlname?terminal.socket.send("~"+e):terminal.sendText(e)}),xtermfit&&xtermfit.fit(),xterm.onResize(function(e){xtermResizeTimer&&clearTimeout(xtermResizeTimer),xtermResizeTimer=setTimeout(xTermSendResize,200)}),document.getElementsByClassName("xterm-helper-textarea")[0].onfocus=()=>{xterm.blur(),fullscreen||toggleKeyboard()},document.getElementsByClassName("xterm-viewport")[0].style.overflow="hidden",terminal=CreateAgentRedirect(meshserver,CreateRemoteTunnel(3==t?sshTunnelUpdate:tunnelUpdate,o),serverPublicNamePort,authCookie,authRelayCookie,domainUrl),3==t&&(terminal.urlname="sshterminalrelay.ashx"),terminal.debugmode=debugmode,terminal.m.debugmode=debugmode,terminal.options=o,terminal.options={cols:xterm.cols,rows:xterm.rows},o.requireLogin&&(terminal.options.requireLogin=!0),terminal.Start(terminalNode._id),terminal.onStateChanged=onTerminalStateChange,terminal.contype=t,terminal.attemptWebRTC=!1,terminal.onConsoleMessageChange=function(){p12setConsoleMsg(terminal.consoleMessage?formatAgentConsoleMessage(terminal.consoleMessage,terminal.consoleMessageId,terminal.consoleMessageArgs):null,terminal.consoleMessageTimeout)}),Q("connectbutton2").blur()}function termSendKey(e,t){terminal&&!xxdialogMode&&(null!=xterm?("sshterminalrelay.ashx"==terminal.urlname?terminal.socket.send("~"+String.fromCharCode(e)):terminal.sendText?terminal.sendText(String.fromCharCode(e)):terminal.send(String.fromCharCode(e)),xterm.focus()):null!=terminal&&(terminal.m.TermSendKey(e),Q(t).blur()))}function updateTermShortcutKeys(){for(var e="",t=64;t<=95;t++)e+='<div class="menuButton" style="width:70px" onclick="termMenuButton('+t+')">Ctrl +'+String.fromCharCode(t)+"</div>";QH("termButtonMenu",e)}function termMenuButton(e){toggleMenu(!0),"sshterminalrelay.ashx"==terminal.urlname?terminal.socket.send("~"+String.fromCharCode(e-64)):terminal.sendText(String.fromCharCode(e-64))}function setupFiles(){var e=filesNode==currentNode,t=0!=(1&(filesNode=currentNode).conn)||3==filesNode.mtype;QE("p13Connect",t),QE("p13Connects",t),QV("p13Connect",null==files&&2==filesNode.mtype),QV("p13Connects",null==files&&null!=filesNode.agent&&3!=filesNode.agent.id&&4!=filesNode.agent.id),QV("p13Disconnect",null!=files),0!=e&&0!=t||!files||(files.Stop(),files=null),p13setActions()}function onFilesStateChange(e,t){setSessionActivity(),QV("p13Connect",0==t&&2==filesNode.mtype),QV("p13Connects",0==t&&null!=filesNode.agent&&3!=filesNode.agent.id&&4!=filesNode.agent.id),QV("p13Disconnect",0!=t);var n=StatusStrs[t];switch(3==t&&(2==files.contype&&(n+=", SFTP"),1==files.webRtcActive)&&(n+=", WebRTC"),Q("p13Status").textContent=n,t){case 0:QH("p13files",""),p13filetree=null,p13filetreelocation=[],QH("p13currentpath",""),QE("p13FolderUp",!1),p13setActions(),null!=files&&(files.Stop(),files=null),null!=uploadFile&&(p13uploadFileTransferDone(),uploadFile=null);break;case 3:if(p13filetreelocation=[],p13targetpath="",files){var o=[];try{o=JSON.parse(getstore("_devFilePaths","[]"))}catch(e){}for(var a=0;a<o.length;a++)o[a].n==currentNode._id&&(p13targetpath=o[a].p);p13filetreelocation=p13targetpath.split("/"),files.sendText({action:"ls",reqid:1,path:p13targetpath})}}}function CreateRemoteFiles(e){var t={protocol:5};return t.onFileUpdate=e,t.xxStateChange=function(e){},t.ProcessData=function(e){t.onFileUpdate(e)},t}var autoConnectFilesTimer=null;function autoConnectFiles(e){autoConnectFilesTimer=null==autoConnectFilesTimer?setInterval(connectFiles,100):(clearInterval(autoConnectFilesTimer),null)}function connectFiles(e,t){p13clearConsoleMsg(),files?(files.Stop(),files=null):(files=CreateAgentRedirect(meshserver,CreateRemoteFiles(p13gotFiles),serverPublicNamePort,authCookie,authRelayCookie,domainUrl),2==t&&(files.urlname="sshfilesrelay.ashx"),files.contype=t,files.attemptWebRTC=attemptWebRTC,files.webrtcconfig=webrtcconfiguration,files.onStateChanged=onFilesStateChange,files.onConsoleMessageChange=function(){files.consoleMessage?(Q("p13FilesConsoleMsg").innerHTML+=formatAgentConsoleMessage(files.consoleMessage,files.consoleMessageId,files.consoleMessageArgs),QV("p13FilesConsoleMsg",!0),null!=p13FilesConsoleMsgTimer&&clearTimeout(p13FilesConsoleMsgTimer),files.consoleMessageTimeout&&(p13FilesConsoleMsgTimer=setTimeout(p13clearConsoleMsg,1e3*files.consoleMessageTimeout))):p13clearConsoleMsg()},files.Start(filesNode._id)),p13clipboard=p13clipboardFolder=null,p13clipboardCut=0,p13updateClipview()}var p13sortorder,p13filetree=null,p13targetpath=null,p13filetreelocation=[];function p13gotFiles(t){if(0<t.length&&123!=t.charCodeAt(0))p13gotDownloadBinaryData(t);else{try{t=JSON.parse(decode_utf8(t))}catch(e){t=JSON.parse(t)}if("download"==t.action)p13gotDownloadCommand(t);else{switch(t.action){case"sshauth":sshTunnelAuthDialog(t,p13sshConnectEx);break;case"autherror":return void p13setConsoleMsg("Chyba ověření",5e3);case"connectionerror":return void p13setConsoleMsg("Chyba připojení",5e3);case"sessionerror":return void p13setConsoleMsg("Relace vypršela",5e3);case"sessiontimeout":return void p13setConsoleMsg("Časový limit relace",5e3)}if(null!=t.action&&t.action.startsWith("upload"))p13gotUploadData(t);else if(null!=t.path)if(null==t.dir)""!=p13targetpath&&p13folderup();else if(t.path=t.path.replace(/\//g,"\\"),null!=p13filetree&&t.path==p13filetree.path){var e=p13getCheckedNames();p13filetree=t,p13updateFiles(e)}else{for(var n=t.path.replace(/\//g,"\\"),o=p13targetpath.replace(/\//g,"\\");0<n.length&&"\\"==n[0];)n=n.substring(1);for(;0<o.length&&"\\"==o[0];)o=o.substring(1);(n==o||"\\"==t.path&&""==p13targetpath)&&(p13filetree=t,p13updateFiles())}}}}function p13sshConnectEx(e){var t,n,o;0==e?null!=files&&connectFiles():(t=0,1==Q("dp2authmethod").value?(0==(4194304&features2)&&(t=Q("dp2keep").checked?1:0),files.socket.send(JSON.stringify({action:"sshauth",username:Q("dp2user").value,password:Q("dp2pass").value,keep:t}))):3==Q("dp2authmethod").value?files.socket.send(JSON.stringify({action:"sshkeyauth",keypass:Q("dp2keypass2").value})):(0==(4194304&features2)&&1==(t=Q("dp2keep1").checked?1:0)&&(t+=Q("dp2keep2").checked?1:0),e=new FileReader,n=Q("dp2user").value,o=Q("dp2keypass").value,e.onload=function(e){files.socket.send(JSON.stringify({action:"sshauth",username:n,keypass:o,key:e.target.result,keep:t}))},e.readAsText(Q("dp2key").files[0])))}function p13getCheckedNames(){for(var e=[],t=document.getElementsByName("fd"),n=0;n<t.length;n++)t[n].checked&&e.push(p13filetree.dir[t[n].value].n);return e}function p13updateFiles(e){var t="",n="",o="<a style=cursor:pointer;color:black onclick=p13folderup(0)>Root</a>",a=p13filetree.path.split("\\");for(g in p13filetreelocation=[],a)""!=a[g]&&p13filetreelocation.push(a[g]);for(g in p13filetreelocation)o+=" / <a style=cursor:pointer;color:black onclick=p13folderup("+(parseInt(g)+1)+")>"+EscapeHtml(p13filetreelocation[g])+"</a>";var i=p13filetreelocation.join("/"),s=p13sort_files(p13filetree.dir);for(g in s){var l,r=s[g],d=r.n,u=40<d.length?EscapeHtml(d.substring(0,70))+"…":EscapeHtml(d),c="",p=(null!=r.s&&(c=getFileSizeStr(r.s)),"");p=r.t<3?"<div class=filelist file=999><input file=999 style=float:left name=fd class=fcb type=checkbox onchange=p13setActions() value='"+r.nx+"'>&nbsp;<span style=float:right></span><span><div class=fileIcon"+r.t+'></div><a style=cursor:pointer onclick=p13folderset("'+encodeURIComponent(r.nx)+'")>'+u+"</a></span></div>":(l=u,0<r.s&&(l='<a rel="noreferrer noopener" target="_blank" style=cursor:pointer onclick="p13downloadfile(\''+encodeURIComponent(i+"/"+d)+"','"+encodeURIComponent(d)+"',"+r.s+')">'+u+"</a>"),"<div class=filelist file=3><input file=3 style=float:left name=fd class=fcb type=checkbox onchange=p13setActions() value='"+r.nx+"'>&nbsp;<span style=float:right;padding-right:4px>"+c+"</span><span><div class=fileIcon"+r.t+"></div>"+l+"</span></div>"),r.t<3?t+=p:n+=p}if(QH("p13files",t+n),QH("p13currentpath",o),QE("p13FolderUp",0!=p13filetreelocation.length),null!=e)for(var m=document.getElementsByName("fd"),g=0;g<m.length;g++)0<=e.indexOf(p13filetree.dir[m[g].value].n)&&(m[g].checked=!0);p13setActions()}function p13folderset(e){p13targetpath=joinPaths(p13filetree.path,p13filetree.dir[e].n).split("\\").join("/"),files&&(p13storeCurrentPath(p13targetpath),files.sendText({action:"ls",reqid:1,path:p13targetpath}))}function p13folderup(e){if(null==e)p13filetreelocation.pop();else for(;p13filetreelocation.length>e;)p13filetreelocation.pop();p13targetpath=p13filetreelocation.join("/"),files&&(p13storeCurrentPath(p13targetpath),files.sendText({action:"ls",reqid:1,path:p13targetpath}))}function p13storeCurrentPath(e){var t=[],n=-1;try{t=JSON.parse(getstore("_devFilePaths","[]"))}catch(e){}for(var o=0;o<t.length;o++)t[o].n==currentNode._id&&(n=o);for(0<=n&&t.splice(n,1),t.push({n:currentNode._id,p:e});40<t.length;)t.shift();putstore("_devFilePaths",JSON.stringify(t))}function p13sort_filename(e,t){return e.ln>t.ln?+p13sortorder:e.ln<t.ln?-1*p13sortorder:0}function p13sort_timestamp(e,t){return e.d>t.d?+p13sortorder:e.d<t.d?-1*p13sortorder:0}function p13sort_bysize(e,t){return e.s==t.s?p13sort_filename(e,t):(e.s-t.s)*p13sortorder}function p13sort_files(e){var t,n=[],o=Q("p13sortdropdown").value;for(t in e)e[t].nx=t,null==e[t].s&&(e[t].s=0),null==e[t].n&&(e[t].n=t),e[t].ln=e[t].n.toLowerCase(),n.push(e[t]);return p13sortorder=1,3<o&&(p13sortorder=-1,o-=3),1==o?n.sort(p13sort_filename):2==o?n.sort(p13sort_bysize):3==o&&n.sort(p13sort_timestamp),n}function p13setActions(){var e,t,n,o,a=currentNode.agent&&14!=currentNode.agent.id;null==p13filetree?(QE("p13DeleteFileButton",!1),QE("p13NewFolderButton",!1),QE("p13UploadButton",!1),QE("p13RenameFileButton",!1),QE("p13SelectAllButton",!1),Q("p13SelectAllButton").value="Vše",QE("p13RefreshButton",!1),QE("p13CutButton",!1),QE("p13CopyButton",!1),QE("p13PasteButton",!1)):(e=p13getFileSelCount(),t=p13getFileCount(),n=p13getFileSelCount(!1),o=0<currentNode.agent.id&&currentNode.agent.id<5||14==currentNode.agent.id||34==currentNode.agent.id,QE("p13DeleteFileButton",a&&0<e&&(0<p13filetreelocation.length||0==o)),QE("p13NewFolderButton",a&&(0<p13filetreelocation.length||0==o)),QE("p13UploadButton",a&&(0<p13filetreelocation.length||0==o)),QE("p13RenameFileButton",a&&1==e&&(0<p13filetreelocation.length||0==o)),QE("p13SelectAllButton",0<t),Q("p13SelectAllButton").value=0<e?"Nic":"Vše",QE("p13RefreshButton",!0),QE("p13CutButton",a&&0<e&&e==n&&3!=currentNode.mtype&&(0<p13filetreelocation.length||0==o)),QE("p13CopyButton",a&&0<e&&e==n&&3!=currentNode.mtype&&(0<p13filetreelocation.length||0==o)),QE("p13PasteButton",a&&3!=currentNode.mtype&&(0<p13filetreelocation.length||0==o)&&null!=p13clipboard&&0<p13clipboard.length)),1==(null!=files&&0!=files.state)&&2!=files.contype||null==filesNode.agent||3==filesNode.agent.id||4==filesNode.agent.id?QH("filesCustomUpperRight",""):QH("filesCustomUpperRight","<a style=cursor:pointer onclick=cmsshportaction(1,event)>"+format("Port SSH {0}",filesNode.sshport||22)+"</a>"),QV("filesActionsBtn",3!=filesNode.mtype)}function p13getFileSelCount(e){for(var t=0,n=document.getElementsByName("fd"),o=0;o<n.length;o++)!n[o].checked||0==e&&"3"!=n[o].attributes.file.value||t++;return t}function p13getFileSelDirCount(){for(var e=0,t=document.getElementsByName("fd"),n=0;n<t.length;n++)t[n].checked&&"999"==t[n].attributes.file.value&&e++;return e}function p13getFileCount(){return document.getElementsByName("fd").length}function p13selectallfile(){for(var e=0==p13getFileSelCount(),t=document.getElementsByName("fd"),n=0;n<t.length;n++)t[n].checked=e;p13setActions()}function p13createfolder(){setDialogMode(2,"Nová složka",3,p13createfolderEx,"<input type=text id=p13renameinput maxlength=64 onkeyup=p13fileNameCheck(event) style=width:100% />"),focusTextBox("p13renameinput"),p13fileNameCheck()}function p13createfolderEx(){files.sendText({action:"mkdir",reqid:1,path:p13filetreelocation.join("/")+"/"+Q("p13renameinput").value}),p13folderup(999)}function p13deletefile(){var e=p13getFileSelCount(),t=0<p13getFileSelDirCount()?"<br /><br /><label><input type=checkbox id=p13recdeleteinput>Rekurzivní mazání</label><br>":"<input type=checkbox id=p13recdeleteinput style='display:none'>";setDialogMode(2,"Smazat",3,p13deletefileEx,1<e?format("Smazat {0} vybrané prvky?",e)+t:"Smazat vybraný prvek?"+t)}function p13deletefileEx(){for(var e=[],t=document.getElementsByName("fd"),n=0;n<t.length;n++)t[n].checked&&e.push(p13filetree.dir[t[n].value].n);files.sendText({action:"rm",reqid:1,path:p13filetreelocation.join("/"),delfiles:e,rec:Q("p13recdeleteinput").checked}),p13folderup(999)}function p13renamefile(){for(var e,t=document.getElementsByName("fd"),n=0;n<t.length;n++)t[n].checked&&(e=p13filetree.dir[t[n].value].n);setDialogMode(2,"Přejmenovat",3,p13renamefileEx,'<input type=text id=p13renameinput maxlength=64 onkeyup=p13fileNameCheck(event) style=width:100% value="'+e+'" />',{action:"rename",path:p13filetreelocation.join("/"),oldname:e}),focusTextBox("p13renameinput"),p13fileNameCheck()}function p13renamefileEx(e,t){t.newname=Q("p13renameinput").value,files.sendText(t),p13folderup(999)}function p13fileNameCheck(e){var t=isFilenameValid(Q("p13renameinput").value);QE("idx_dlgOkButton",t),1==t&&null!=e&&13==e.keyCode&&dialogclose(1)}function p13uploadFile(){setDialogMode(2,"Nahrát soubor",3,p13uploadFileEx,"<input type=file name=files id=p13uploadinput style=width:100% multiple=multiple onchange=\"updateUploadDialogOk('p13uploadinput')\" />"),updateUploadDialogOk("p13uploadinput")}function p13uploadFileEx(){p13doUploadFiles(Q("p13uploadinput").files)}function p13viewfile(){for(var e=document.getElementsByName("fd"),t=0;t<e.length;t++)if(e[t].checked){p13filetree.dir[e[t].value].s<=204800?p13downloadfile(encodeURIComponent(p13filetreelocation.join("/")+"/"+p13filetree.dir[e[t].value].n),encodeURIComponent(p13filetree.dir[e[t].value].n),p13filetree.dir[e[t].value].s,"viewer"):messagebox("Editor souborů","Upravovat je možné jen soubory, které jsou menší než 200 kilobajtů.");break}}var downloadFile,uploadFile,p13clipboard=null,p13clipboardFolder=null,p13clipboardCut=0;function p13copyFile(e){var t=document.getElementsByName("fd");p13clipboard=[],p13clipboardCut=e,p13clipboardFolder=p13targetpath;for(var n=0;n<t.length;n++)t[n].checked&&"3"==t[n].attributes.file.value&&p13clipboard.push(p13filetree.dir[t[n].value].n);p13updateClipview()}function p13pasteFile(){var e="";setDialogMode(2,"Vložit",3,p13pasteFileEx,e=null!=p13clipboard&&0<p13clipboard.length?0==p13clipboardCut?1<p13clipboard.length?format("Potvrdit kopii {0} záznamů do tohoto umístění?",p13clipboard.length):format("Potvrdit kopírování jednoho záznamu do tohoto umístění?"):1<p13clipboard.length?format("Potvrdit přesun {0} položek do tohoto umístění?",p13clipboard.length):format("Potvrdit přesun jednoho záznamu do tohoto umístění?"):e)}function p13pasteFileEx(){files.sendText({action:0==p13clipboardCut?"copy":"move",reqid:1,scpath:p13clipboardFolder,dspath:p13targetpath,names:p13clipboard}),p13folderup(999),1==p13clipboardCut&&(p13clipboardFolder=p13clipboard=null,p13clipboardCut=0,p13updateClipview())}function p13updateClipview(){var e="";null!=p13clipboard&&0<p13clipboard.length&&(e=0==p13clipboardCut?1<p13clipboard.length?format('Drží se {0} záznamů pro kopii, <a href=# onclick="return p13clearClip()" style=cursor:pointer>Vymazat</a>.',p13clipboard.length):format('Drží se jeden záznam pro kopii, <a href=# onclick="return p13clearClip()" style=cursor:pointer>Vymazat</a>.'):1<p13clipboard.length?format('Drží se {0} zaznamů pro přesun, <a href=# onclick="return p13clearClip()" style=cursor:pointer>Vymazat</a>.',p13clipboard.length):format('Drží se jeden záznam pro přesun, <a href=# onclick="return p13clearClip()" style=cursor:pointer>Vymazat</a>.')),QH("p13bottomstatus",e),p13setActions()}function p13clearClip(){return p13clipboardFolder=p13clipboard=null,p13clipboardCut=0,p13updateClipview(),!1}function updateUploadDialogOk(e){QE("idx_dlgOkButton",""!=Q(e).value)}function getFileSelCount(e){for(var t=0,n=document.getElementsByName("fc"),o=0;o<n.length;o++)!n[o].checked||0==e&&"3"!=n[o].attributes.file.value||t++;return t}function getFileCount(){return document.getElementsByName("fc").length}function p13downloadfile(e,t,n){xxdialogMode||downloadFile||!files||(downloadFile={path:decodeURIComponent(e),file:decodeURIComponent(t),size:n,tsize:0,data:"",state:0,id:Math.random()},files.sendText({action:"download",sub:"start",id:downloadFile.id,path:downloadFile.path}),setDialogMode(2,"Stáhnout soubor",10,p13downloadFileCancel,"<div>"+EscapeHtml(downloadFile.file)+"</div><br /><progress id=d2progressBar style=width:100% value=0 max="+n+" />"))}function p13downloadFileCancel(){setDialogMode(0),files.sendText({action:"download",sub:"cancel",id:downloadFile.id}),downloadFile=null}function p13gotDownloadCommand(e){null!=downloadFile&&e.id==downloadFile.id&&("start"==e.sub?(downloadFile.state=1,files.sendText({action:"download",sub:"startack",id:downloadFile.id})):"cancel"==e.sub&&(downloadFile=null,setDialogMode(0)))}function p13gotDownloadBinaryData(e){downloadFile&&0!=downloadFile.state&&(4<e.length&&(downloadFile.tsize+=e.length-4,downloadFile.data+=e.substring(4),Q("d2progressBar").value=downloadFile.tsize),0!=(1&ReadInt(e,0))?(saveAs(data2blob(downloadFile.data),downloadFile.file),downloadFile=null,setDialogMode(0)):files.sendText({action:"download",sub:"ack",id:downloadFile.id}))}function p13doUploadFiles(e){if(!xxdialogMode){var t=0<currentNode.agent.id&&currentNode.agent.id<5||14==currentNode.agent.id||34==currentNode.agent.id,n=[],o=0;for(a in p13filetree.dir)n.push(t?p13filetree.dir[a].n.toLowerCase():p13filetree.dir[a].n);for(var a=0;a<e.length;a++)t?0<=n.indexOf(e[a].name.toLowerCase())&&o++:0<=n.indexOf(e[a].name)&&o++;0==o?p13uploadFileContinue(1,e):setDialogMode(2,"Nahrát soubor",3,p13uploadFileContinue,format(1==o?"Nahrání přepíše 1 soubor. Pokračovat?":"Nahrání přepíše {0} soubory. Pokračovat?",o),e)}}function p13uploadFileContinue(e,t){(uploadFile={}).xpath=p13filetreelocation.join("/"),uploadFile.xfiles=t,uploadFile.xfilePtr=-1,setDialogMode(2,"Nahrát soubor",10,p13uploadFileCancel,"<div id=p13dfileName>Připojování…</div><br /><progress id=d2progressBar style=width:100% value=0 max=0 />"),p13uploadNextFile()}let byteToHex=[];for(var n=0;n<=255;++n){var hexOctet=n.toString(16).padStart(2,"0");byteToHex.push(hexOctet)}function arrayBufferToHex(e){return Array.prototype.map.call(new Uint8Array(e),e=>byteToHex[e]).join("")}function performHash(e,t){window.crypto.subtle.digest("SHA-384",e).then(function(e){t(arrayBufferToHex(e))},function(){t(null)})}function performHashOnFile(e,t){var n=new FileReader;n.onerror=function(e){t(null)},n.onload=function(){window.crypto.subtle.digest("SHA-384",n.result).then(function(e){t(arrayBufferToHex(e))},function(){t(null)})},n.readAsArrayBuffer(e)}function p13uploadNextFile(){if(uploadFile.xfilePtr++,uploadFile.xfiles.length>uploadFile.xfilePtr){uploadFile.xptr=0;var t=uploadFile.xfiles[uploadFile.xfilePtr];if(QH("p13dfileName",EscapeHtml(t.name)),Q("d2progressBar").max=t.size,Q("d2progressBar").value=0,null==t.xdata){uploadFile.xfile=t;var e,n=null;for(e in p13filetree.dir)p13filetree.dir[e].n==t.name&&(n=p13filetree.dir[e]);null!=n&&n.s<=uploadFile.xfile.size?performHashOnFile(uploadFile.xfile,function(e){files.sendText(JSON.stringify({action:"uploadhash",reqid:uploadFile.xfilePtr,path:uploadFile.xpath,name:t.name,tag:{h:e.toUpperCase(),s:n.s,skip:n.s==uploadFile.xfile.size}}))}):files.sendText(JSON.stringify({action:"upload",reqid:uploadFile.xfilePtr,path:uploadFile.xpath,name:t.name,size:uploadFile.xfile.size}))}else uploadFile.xdata=t.xdata,files.sendText(JSON.stringify({action:"upload",reqid:uploadFile.xfilePtr,path:uploadFile.xpath,name:t.name,size:uploadFile.xdata.byteLength}))}else p13uploadFileTransferDone()}function p13uploadFileCancel(e,t){null!=uploadFile&&(files.sendText(JSON.stringify({action:"uploadcancel",reqid:uploadFile.xfilePtr})),uploadFile=null),p13uploadFileTransferDone()}function p13uploadFileTransferDone(){uploadFile=null,setDialogMode(0),p13folderup(9999)}function p13gotUploadData(e){if(null!=uploadFile&&parseInt(uploadFile.xfilePtr)==parseInt(e.reqid))switch(e.action){case"uploadstart":p13uploadNextPart(!(uploadFile.xdataPriming=8));break;case"uploadack":p13uploadNextPart(!1);break;case"uploaddone":(uploadFile.xfiles.length>uploadFile.xfilePtr+1?p13uploadNextFile:p13uploadFileTransferDone)();break;case"uploaderror":p13uploadFileCancel();break;case"uploadhash":var t=uploadFile.xfiles[uploadFile.xfilePtr];t&&(e.tag.h===e.hash?e.tag.skip?p13uploadNextFile():(uploadFile.xptr=e.tag.s,files.sendText(JSON.stringify({action:"upload",reqid:uploadFile.xfilePtr,path:uploadFile.xpath,name:t.name,size:uploadFile.xfile.size,append:!0}))):files.sendText(JSON.stringify({action:"upload",reqid:uploadFile.xfilePtr,path:uploadFile.xpath,name:t.name,size:uploadFile.xfile.size,append:!1})))}}function p13uploadNextPart(e){if(uploadFile.xdata){var t=uploadFile.xdata,n=uploadFile.xptr;if(n>=t.byteLength)files.sendText(JSON.stringify({action:"uploaddone",reqid:uploadFile.xfilePtr}));else{if((o=uploadFile.xptr+(attemptWebRTC?16384:65536))>t.byteLength){if(1==e)return;o=t.byteLength}t=new Uint8Array(t.slice(n,o));123==t[0]||0==t[0]?((n=new Uint8Array(o-n+1)).set(t,1),files.send(n)):files.send(t),uploadFile.xptr=o,Q("d2progressBar").value=o}}else if(uploadFile.xfile&&null==uploadFile.xreader&&!(uploadFile.xptr>=uploadFile.xfile.size)){var o;if((o=uploadFile.xptr+(attemptWebRTC?16384:65536))>uploadFile.xfile.size){if(1==e)return;o=uploadFile.xfile.size}uploadFile.xreader=new FileReader,uploadFile.xreader.onerror=function(e){console.log(e)},uploadFile.xreader.onload=function(){var e,t=uploadFile.xreader.result;delete uploadFile.xreader,null!=t&&(123==(e=new Uint8Array(t))[0]||0==e[0]?((t=new Uint8Array(t.byteLength+1)).set(e,1),files.send(t)):files.send(e),uploadFile.xptr=o,Q("d2progressBar").value=o,uploadFile.xptr>=uploadFile.xfile.size?files.sendText(JSON.stringify({action:"uploaddone",reqid:uploadFile.xfilePtr})):0<uploadFile.xdataPriming&&(uploadFile.xdataPriming--,p13uploadNextPart(!0)))},uploadFile.xreader.readAsArrayBuffer(uploadFile.xfile.slice(uploadFile.xptr,o))}}var consoleNode,DeviceDetailsHardware=null,DeviceDetailsNetwork=null,DeviceDetailsNodeId=null;function updateDeviceDetails(t,e,n){if(null!=currentNode&&(null==t&&(t=currentNode),currentNode._id==t._id)){DeviceDetailsNodeId!=t._id&&(DeviceDetailsNetwork=DeviceDetailsHardware=null,DeviceDetailsNodeId=t._id),null==(e=DeviceDetailsHardware=null!=e?e:DeviceDetailsHardware)&&(e={}),null==(n=DeviceDetailsNetwork=null!=n?n:DeviceDetailsNetwork)&&(n={});var o=[],a={},i="";if(t.rname&&(i+=addDetailItem("Název",EscapeHtml(t.rname),a)),e.windows&&e.windows.osinfo&&e.windows.osinfo.Description&&(i+=addDetailItem("Popis",EscapeHtml(e.windows.osinfo.Description),a)),t.osdesc&&(i+=addDetailItem("Verze",EscapeHtml(t.osdesc),a)),e.windows&&e.windows.osinfo&&((c=e.windows.osinfo).OSArchitecture&&(c.OSArchitecture.startsWith("32")?i+=addDetailItem("Architektura","32bitové",a):c.OSArchitecture.startsWith("64")?i+=addDetailItem("Architektura","64bitové",a):i+=addDetailItem("Architektura",EscapeHtml(c.OSArchitecture),a)),c.LastBootUpTime)&&(r={year:parseInt(c.LastBootUpTime.substring(0,4)),month:parseInt(c.LastBootUpTime.substring(4,6))-1,day:parseInt(c.LastBootUpTime.substring(6,8)),hours:parseInt(c.LastBootUpTime.substring(8,10)),minutes:parseInt(c.LastBootUpTime.substring(10,12)),seconds:parseInt(c.LastBootUpTime.substring(12,14))},i+=addDetailItem("Last Boot Up Time",printDateTime(new Date(r.year,r.month,r.day,r.hours,r.minutes,r.seconds)))),e.linux&&e.linux.LastBootUpTime&&(r={year:(d=new Date(e.linux.LastBootUpTime)).getFullYear(),month:d.getMonth(),day:d.getDate(),hours:d.getHours(),minutes:d.getMinutes(),seconds:d.getSeconds()},i+=addDetailItem("Last Boot Up Time",printDateTime(new Date(r.year,r.month,r.day,r.hours,r.minutes,r.seconds)))),e.darwin&&e.darwin.LastBootUpTime&&(r={year:(d=new Date(1e3*e.darwin.LastBootUpTime)).getFullYear(),month:d.getMonth(),day:d.getDate(),hours:d.getHours(),minutes:d.getMinutes(),seconds:d.getSeconds()},i+=addDetailItem("Last Boot Up Time",printDateTime(new Date(r.year,r.month,r.day,r.hours,r.minutes,r.seconds)))),t.wsc&&(l=[],null!=t.wsc.antiVirus&&("OK"==t.wsc.antiVirus?l.push("AV - <span style=color:green>OK</span>"):l.push("AV - <span style=color:red>ŠPATNÝ</span>")),null!=t.wsc.autoUpdate&&("OK"==t.wsc.autoUpdate?l.push("Aktualizace - <span style=color:green>OK</span>"):l.push("Aktualizace - <span style=color:red>ŠPATNÝ</span>")),null!=t.wsc.firewall&&("OK"==t.wsc.firewall?l.push("Firewall - <span style=color:green>OK</span>"):l.push("Firewall - <span style=color:red>ŠPATNÝ</span>")),i+=addDetailItem("Zabezpečení systému Windows",l.join(", "))),t.defender&&(l=[],null!=t.defender.RealTimeProtection&&(1==t.defender.RealTimeProtection?l.push("RealTimeProtection - <span style=color:green>On</span>"):l.push("RealTimeProtection - <span style=color:red>Vypnuto</span>")),null!=t.defender.TamperProtected&&(1==t.defender.TamperProtected?l.push("TamperProtection - <span style=color:green>On</span>"):l.push("TamperProtection - <span style=color:red>Vypnuto</span>")),0<l.length)&&(i+=addDetailItem("Windows Defender",l.join(", "))),t.av&&0<t.av.length){var s,l=[];for(v in t.av)t.av[v].product&&(s=EscapeHtml(t.av[v].product),!0!==t.av[v].enabled&&(s+=" - <span style=color:red>Zakázáno</span>"),!0!==t.av[v].updated&&(s+=" - <span style=color:red>Neaktuální</span>"),1==t.av[v].enabled&&1==t.av[v].updated&&(s+=" - <span style=color:green>OK</span>"),l.push(s));i+=addDetailItem("Antivir",l.join("<br />"))}if(t.users&&0<t.users.length&&(d=t.users.map(function(e){return addKeyLinkConditional(EscapeHtml(e),"Zamknuto",t.lusers&&0<=t.lusers.indexOf(e))}).join(", "),i+=addDetailItem(1<t.users.length?"Aktivní uživatelé":"Aktivní uživatel",d)),""!=i&&o.push({name:"Operační systém",html:i,img:"software"}),t.agent){var r,d,i="";if(null!=t.agent&&null!=t.agent.id&&null!=t.agent.ver&&(r="",r=t.agent.id<=agentsStr.length?agentsStr[t.agent.id]:agentsStr[0],0!=t.agent.ver&&(r+=" v"+t.agent.ver),i+=addDetailItem("Mesh Agent",r=14==t.agent.id?t.agent.core:r)),0!=(1&t.conn)?i+=addDetailItem("Poslední připojení agenta","Připojeno hned"):t.lastconnect&&(i+=addDetailItem("Poslední připojení agenta",printDateTime(new Date(t.lastconnect)))),t.lastaddr&&(2<(d=t.lastaddr.split(":")).length?i+=addDetailItem("Poslední adresa agenta",t.lastaddr):isPrivateIP(t.lastaddr)?i+=addDetailItem("Poslední adresa agenta",d[0]):i+=addDetailItem("Poslední adresa agenta",'<a href="https://iplocation.com/?ip='+d[0]+'" rel="noreferrer noopener" target="MeshIPLoopup">'+d[0]+"</a>")),null!=e.agentvers&&e.agentvers.compileTime)try{var u=Date.parse(e.agentvers.compileTime);i+=addDetailItem("Čas kompilace",printDateTime(new Date(u)))}catch(e){}""!=i&&o.push({name:"Mesh Agent",html:i,img:"meshagent"})}if(e.mobile&&(i="",e.mobile.brand&&e.mobile.model&&(i+=addDetailItem("Modelka",EscapeHtml(e.mobile.brand+", "+e.mobile.model),a)),e.mobile.device&&(i+=addDetailItem("Zařízení",EscapeHtml(e.mobile.device),a)),e.mobile.bootloader&&(i+=addDetailItem("Zavaděč",EscapeHtml(e.mobile.bootloader),a)),e.mobile.id&&(i+=addDetailItem("Identifikátor",EscapeHtml(e.mobile.id),a)),e.mobile.host&&(i+=addDetailItem("Název stroje",EscapeHtml(e.mobile.host),a)),e.mobile.androidapi&&e.mobile.androidrelease&&(i+=addDetailItem("Android Version",EscapeHtml(e.mobile.androidrelease+", API Level "+e.mobile.androidapi),a)),""!=i)&&o.push({name:"Mobilní zařízení",html:i,img:"mobile"}),null!=n.netif2){var i="";for(v in i+="<table style=width:100%>",n.netif2){var c=n.netif2[v];if(!(0==Array.isArray(c)||c.length<1||null==c[0]||"string"==typeof c[0].mac&&c[0].mac.startsWith("00:00:00:00"))){i=(i+="<tr><td><div class=style10 style=border-radius:5px;padding:8px>")+("<div style=margin-bottom:3px><b>"+EscapeHtml(v+(c[0].fqdn?", "+c[0].fqdn:""))+"</b></div>"),c.desc&&(i+=addDetailItem("Popis",EscapeHtml(c.desc).split("(R)").join("&reg;"))),"string"==typeof c[0].mac&&(c[0].gatewaymac?i+=addDetailItem("Vrstva MAC",format("MAC: {0}, Gateway: {1}",EscapeHtml(c[0].mac),EscapeHtml(c[0].gatewaymac))):i+=addDetailItem("Vrstva MAC",format("MAC: {0}",EscapeHtml(c[0].mac))));for(var p=0;p<c.length;p++){var m=c[p],g=[];m.address&&g.push(format("IP: {0}",EscapeHtml(m.address))),m.netmask&&g.push(format("Maska: {0}",EscapeHtml(m.netmask))),m.gateway&&g.push(format("Brána: {0}",EscapeHtml(m.gateway))),0<g.length&&("IPv4"==m.family&&(i+=addDetailItem("Vrstva IPv4",g.join(", "))),"IPv6"==m.family)&&(i+=addDetailItem("Vrstva IPv6",g.join(", ")))}i+="</div></td></tr>"}}e.network&&e.network.dns&&(i=(i+="<tr><td><div class=style10 style=border-radius:5px;padding:8px>")+addDetailItem("<b>DNS Servers</b>",e.network.dns.join(", "))+"</div></td></tr>"),""!=(i+="</table>")&&o.push({name:"Sítě",html:i,img:"networking"})}if(null!=t.intelamt&&(i="",i=(i+=addDetailItem("Verze",t.intelamt.ver?"v"+EscapeHtml(t.intelamt.ver):"<i>Neznámé</i>",a))+addDetailItem("Identifikátor",t.intelamt.uuid?EscapeHtml(t.intelamt.uuid):"<i>Neznámé</i>",a),r={0:nobreak("Neaktivováno (před)"),1:nobreak("Neaktivováno (v)"),2:nobreak("Zapnuto")},d="",2==t.intelamt.state&&t.intelamt.flags&&(2&t.intelamt.flags?d=", Client Control Mode (CCM)":4&t.intelamt.flags&&(d=", Admin Control Mode (ACM)")),""!=(i=(i=(i+=addDetailItem("Poskytující stát",(t.intelamt.state?r[t.intelamt.state]:"<i>Neznámé</i>")+d,a))+addDetailItem("Zabezpečení",1==t.intelamt.tls?"Zabezpečeno pomocí TLS":"TLS není nastaven",a))+addDetailItem("Pověření správce",null==t.intelamt.user||""==t.intelamt.user||null!=t.intelamt.warn&&0!=(9&t.intelamt.warn)?"Neznámý":"Známý",a)))&&("number"==typeof t.intelamt.sku&&0!=(16&t.intelamt.sku)?o.push({name:"Intel&reg; Standard Manageability (Intel&reg; SM)",html:i,img:"amt"}):o.push({name:"Intel&reg; Active Management Technology (Intel&reg; AMT)",html:i,img:"amt"})),e.identifiers){var i="",h=e.identifiers;if(h.bios_vendor&&(i+=addDetailItem("Výrobce",EscapeHtml(h.bios_vendor),a)),h.bios_version&&(i+=addDetailItem("Verze",EscapeHtml(h.bios_version),a)),h.bios_serial&&(i+=addDetailItem("Sériové číslo",EscapeHtml(h.bios_serial),a)),h.bios_mode&&(i+=addDetailItem("Mode",EscapeHtml(h.bios_mode),a)),""!=i&&o.push({name:"BIOS",html:i,img:"chip"}),i="",h.board_vendor&&(i+=addDetailItem("Výrobce",EscapeHtml(h.board_vendor),a)),h.board_name&&(i+=addDetailItem("Název",EscapeHtml(h.board_name),a)),h.board_serial&&""!=h.board_serial&&(i+=addDetailItem("Sériové číslo",EscapeHtml(h.board_serial),a)),h.board_version&&(i+=addDetailItem("Verze",EscapeHtml(h.board_version),a)),h.product_uuid&&(i+=addDetailItem("Identifikátor",EscapeHtml(h.product_uuid),a)),h.cpu_name&&(i+=addDetailItem("Procesor",EscapeHtml(h.cpu_name).split("(TM)").join("&trade;").split("(R)").join("&reg;"),a)),h.gpu_name)for(var v in h.gpu_name)i+=addDetailItem("GPU",EscapeHtml(h.gpu_name[v]).split("(TM)").join("&trade;").split("(R)").join("&reg;"),a);""!=i&&o.push({name:"Základní deska",html:i,img:"motherboard"})}if(e.tpm&&(i="",(u=e.tpm).SpecVersion&&(i+=addDetailItem("SpecVersion",parseFloat(EscapeHtml(u.SpecVersion)).toFixed(1),a)),u.ManufacturerId&&(i+=addDetailItem("ManufacturerId",EscapeHtml(u.ManufacturerId),a)),u.ManufacturerVersion&&(i+=addDetailItem("ManufacturerVersion",EscapeHtml(u.ManufacturerVersion),a)),null!=u.IsActivated&&(i+=addDetailItem("IsActivated",u.IsActivated?"Yes":"No",a)),null!=u.IsEnabled&&(i+=addDetailItem("IsEnabled",u.IsEnabled?"Yes":"No",a)),null!=u.IsOwned&&(i+=addDetailItem("IsOwned",u.IsOwned?"Yes":"No",a)),""!=i)&&o.push({name:"TPM",html:i,img:"tpm"}),e.windows&&e.windows.memory&&0<e.windows.memory.length){i="";for(v in e.windows.memory.sort(function(e,t){return e.BankLabel>t.BankLabel?1:e.BankLabel<t.BankLabel?-1:0}),i+="<table style=width:100%>",e.windows.memory){c=e.windows.memory[v];i=(i+="<tr><td><div class=style10 style=border-radius:5px;padding:8px>")+("<div style=margin-bottom:3px><b>"+EscapeHtml(c.BankLabel||c.DeviceLocator||"Unknown")+"</b></div>"),c.Capacity&&c.Speed?i+=addDetailItem("Kapacita / Rychlost",format("{0} Mb, {1} Mhz",c.Capacity/1024/1024,c.Speed),a):c.Capacity&&(i+=addDetailItem("Kapacita",format("{0} Mb",c.Capacity/1024/1024),a)),c.PartNumber&&(i+=addDetailItem("Číslo dílu",EscapeHtml(c.Manufacturer&&"Undefined"!=c.Manufacturer?c.Manufacturer+", ":"")+EscapeHtml(c.PartNumber),a)),i+="</div>"}""!=(i+="</table>")&&o.push({name:"Operační paměť",html:i,img:"ram"})}if(e.linux&&e.linux.memory&&0<e.linux.memory.Memory_Device.length){i="";for(v in e.linux.memory.Memory_Device.sort(function(e,t){return e.Locator>t.Locator?1:e.Locator<t.Locator?-1:0}),i+="<table style=width:100%>",e.linux.memory.Memory_Device)(c=e.linux.memory.Memory_Device[v]).Size&&"No Module Installed"==c.Size||(i=(i+="<tr><td><div class=style10 style=border-radius:5px;padding:8px>")+"<div style=margin-bottom:3px><b>"+EscapeHtml(c.Locator||"Unknown")+"</b></div>",c.Size&&c.Speed?i+=addDetailItem("Kapacita / Rychlost",format("{0}, {1}",c.Size,c.Speed),a):c.Size&&(i+=addDetailItem("Kapacita",format("{0}",c.Size),a)),c.PartNumber&&(i+=addDetailItem("Číslo dílu",EscapeHtml(c.Manufacturer&&"Undefined"!=c.Manufacturer?c.Manufacturer+", ":"")+EscapeHtml(c.PartNumber),a)),i+="</div>");""!=(i+="</table>")&&o.push({name:"Operační paměť",html:i,img:"ram"})}if(e.darwin&&e.darwin.memory&&0<e.darwin.memory.length){i="";for(v in i+="<table style=width:100%>",e.darwin.memory)(c=e.darwin.memory[v]).Size&&"No Module Installed"==c.Size||(i=(i+="<tr><td><div class=style10 style=border-radius:5px;padding:8px>")+"<div style=margin-bottom:3px><b>"+EscapeHtml(c.DeviceLocator||"Unknown")+"</b></div>",c.Size&&c.Speed?i+=addDetailItem("Kapacita / Rychlost",format("{0}, {1}",c.Size,c.Speed),a):c.Size&&(i+=addDetailItem("Kapacita",format("{0}",c.Size),a)),c.PartNumber&&(i+=addDetailItem("Číslo dílu",EscapeHtml(c.Manufacturer&&""!=c.Manufacturer?c.Manufacturer+", ":"")+EscapeHtml(c.PartNumber),a)),i+="</div>");""!=(i+="</table>")&&o.push({name:"Operační paměť",html:i,img:"ram"})}if(e.identifiers&&h.storage_devices){var f,i="";for(v in h.storage_devices.sort(function(e,t){return e.Caption>t.Caption?1:e.Caption<t.Caption?-1:0}),i+="<table style=width:100%>",h.storage_devices)(c=h.storage_devices[v]).Size&&(i=(i+="<tr><td><div class=style10 style=border-radius:5px;padding:8px>")+"<div style=margin-bottom:3px><b>"+EscapeHtml(c.Caption)+"</b></div>",c.Model&&c.Model!=c.Caption&&(i+=addDetailItem("Modelka",EscapeHtml(c.Model),a)),c.Size&&("string"==typeof c.Size&&parseInt(c.Size)==c.Size&&(c.Size=parseInt(c.Size)),"number"==typeof c.Size&&(i+=addDetailItem("Kapacita",format("{0} Mb",Math.floor(c.Size/1024/1024)),a)),"string"==typeof c.Size)&&(i+=addDetailItem("Kapacita",EscapeHtml(c.Size),a)),e.windows&&e.windows.drives&&c.Model&&(f=e.windows.drives.find(e=>e.Model===c.Model))&&(i+=addDetailItem("Stav",EscapeHtml(f.Status),a)),i+="</div>");""!=(i+="</table>")&&o.push({name:"Úložiště",html:i,img:"storage"})}if(e.windows&&e.windows.volumes){var k,i="";for(v in e.windows.volumes)i=(i+="<tr><td><div class=style10 style=border-radius:5px;padding:8px>")+("<div style=margin-bottom:3px><b>"+v+":"+(null==(c=e.windows.volumes[v]).name||""==c.name?"":" - "+EscapeHtml(c.name))+"</b></div>"),c.size&&(y=["Bytes","KB","MB","GB","TB"],b=0===(p=parseInt(Math.floor(Math.log(Math.abs(c.size))/Math.log(1024)),10))?c.size+" "+y[p]:(c.size/1024**p).toFixed(2)+" "+y[p],i+=addDetailItem("Kapacita",EscapeHtml(b),a)),c.sizeremaining&&(y=["Bytes","KB","MB","GB","TB"],b=0===(p=parseInt(Math.floor(Math.log(Math.abs(c.sizeremaining))/Math.log(1024)),10))?c.sizeremaining+" "+y[p]:(c.sizeremaining/1024**p).toFixed(2)+" "+y[p],i+=addDetailItem("Capacity Remaining",EscapeHtml(b),a)),c.type&&(i+=addDetailItem("File System",(""!=(x=1==c.removable?"Removable":1==c.cdrom?"CD-ROM":"")?x+" / ":"")+("Unknown"==c.type?"Neznámé":EscapeHtml(c.type)),a)),(c.protectionStatus||c.volumeStatus)&&(k=[],c.protectionStatus&&k.push("Povoleno"),c.volumeStatus&&"FullyDecrypted"==c.volumeStatus&&k.push("Fully Decrypted"),c.volumeStatus&&"EncryptionInProgress"==c.volumeStatus&&k.push("Encryption In Progress"),c.volumeStatus&&"FullyEncrypted"==c.volumeStatus&&k.push("Fully Encrypted"),k=k.join(" - "),c.recoveryPassword&&(k+=addKeyLink("",'deviceDetailsShowBitlockerInfo("'+encodeURIComponentEx(v)+'","'+encodeURIComponentEx(c.identifier)+'","'+encodeURIComponentEx(c.recoveryPassword)+'")')),i+=addDetailItem("BitLocker",k,a)),i+="</div>";""!=i&&o.push({name:"Storage Volumes",html:"<table style=width:100%>"+i+"</table>",img:"storage"})}if(e.linux&&e.linux.volumes){var y,b,i="";for(v in e.linux.volumes)(c=e.linux.volumes[v]).mount_point.startsWith("/var/lib/docker/overlay2")||(i=(i+="<tr><td><div class=style10 style=border-radius:5px;padding:8px>")+"<div style=margin-bottom:3px><b>"+c.mount_point+"</b></div>",c.size&&(y=["KB","MB","GB","TB"],b=0===(p=parseInt(Math.floor(Math.log(Math.abs(c.size))/Math.log(1024)),10))?c.size+" "+y[p]:(c.size/1024**p).toFixed(2)+" "+y[p],i+=addDetailItem("Kapacita",EscapeHtml(b),a)),c.available&&(b=0==Math.abs(c.available)?"0 KB":(y=["KB","MB","GB","TB"],0===(p=parseInt(Math.floor(Math.log(Math.abs(c.available))/Math.log(1024)),10))?c.available+" "+y[p]:(c.available/1024**p).toFixed(2)+" "+y[p]),i+=addDetailItem("Capacity Remaining",EscapeHtml(b),a)),c.type&&(i+=addDetailItem("File System",(""!=(x=1==c.removable?"Removable":1==c.cdrom?"CD-ROM":"")?x+" / ":"")+("Unknown"==c.type?"Neznámé":EscapeHtml(c.type)),a)),i+="</div>");""!=i&&o.push({name:"Storage Volumes",html:"<table style=width:100%>"+i+"</table>",img:"storage"})}if(e.darwin&&e.darwin.volumes){var x,i="";for(v in e.darwin.volumes)(c=e.darwin.volumes[v]).mount_point.startsWith("/var/lib/docker/overlay2")||(i=(i+="<tr><td><div class=style10 style=border-radius:5px;padding:8px>")+"<div style=margin-bottom:3px><b>"+c.mount_point+"</b></div>",c.size&&(i+=addDetailItem("Kapacita",EscapeHtml(c.size),a)),c.available&&(i+=addDetailItem("Capacity Remaining",EscapeHtml(c.available),a)),c.type&&(i+=addDetailItem("File System",(""!=(x=1==c.removable?"Removable":1==c.cdrom?"CD-ROM":"")?x+" / ":"")+("Unknown"==c.type?"Neznámé":EscapeHtml(c.type)),a)),i+="</div>");""!=i&&o.push({name:"Storage Volumes",html:"<table style=width:100%>"+i+"</table>",img:"storage"})}i="";for(v in o)null==o[v].img?i+="<div class=DevSt style=margin-bottom:3px;margin-left:4px><b>"+o[v].name+"</b></div><div style=margin-bottom:10px;margin-left:4px>"+o[v].html+"</div>":i=(i=(i+="<table style=width:100%><tr>")+"<td style=width:32px;vertical-align:top><img src=images/details/"+o[v].img+'32.png srcset="images/details/'+o[v].img+'64.png 2x" border=0 width=32 /></td>')+"<td><div class=DevSt style=margin-bottom:3px;margin-left:4px><b>"+o[v].name+"</b></div><div style=margin-bottom:10px;margin-left:4px>"+o[v].html+"</div></td></tr></table>";""==i?QH("p10detailshtml","Žádné informace o tomto zařízení."):QH("p10detailshtml",i)}}function deviceDetailsShowBitlockerInfo(e,t,n){if(xxdialogMode)return!1;t="<div><p>Identifikátor</p><p style=user-select:text;font-weight:bold>"+(t?decodeURIComponent(t):"Neznámé")+"</p>";t+="<p>Recovery Password</p><p style=user-select:text;font-weight:bold>"+(n?decodeURIComponent(n):"Neznámé")+"</p></div>",setDialogMode(2,decodeURIComponent(e)+": BitLocker Information",1,null,t,"")}function insertTextAtCursor(e,t){var n,o;document.selection?(e.focus(),(sel=document.selection.createRange()).text=t):e.selectionStart||"0"==e.selectionStart?(n=e.selectionStart,o=e.selectionEnd,e.value=e.value.substring(0,n)+t+e.value.substring(o,e.value.length),e.setSelectionRange(o+1,o+1)):e.value+=myValue}var consoleServerText="";function setupConsole(){var e,t=consoleNode==currentNode;meshes[(consoleNode=currentNode).meshid];0!=(16&GetNodeRights(currentNode))?(null==consoleNode.consoleText&&(consoleNode.consoleText=""),0==t&&(QH("p15agentConsoleText",consoleNode.consoleText),Q("p15agentConsoleText").scrollTop=Q("p15agentConsoleText").scrollHeight),0==(1&consoleNode.conn)&&consoleNode.conn,t=0!=(1&consoleNode.conn)?"Agent je online":"Agent je offline",0!=(16&consoleNode.conn)&&(t+=", MQTT je online"),QH("p15statetext",t),QE("p15uploadCore",0!=(1&consoleNode.conn)),QV("p15outputselecttd",0!=(16&consoleNode.conn)||1==currentNode.pmt&&0!=(2&features2)),QV("p15outputselect2",0!=(16&consoleNode.conn)),QV("p15outputselect3",1==currentNode.pmt&&0!=(2&features2)),t=Q("p15outputselect").value,0==(16&consoleNode.conn)&&2==t&&(t=1,Q("p15outputselect").value=1),1==currentNode.pmt&&0!=(2&features2)||3!=t||(t=1,Q("p15outputselect").value=1),e=!1,0!=(1&consoleNode.conn)&&1==t&&(e=!0),0!=(16&consoleNode.conn)&&2==t&&(e=!0),1==currentNode.pmt&&0!=(2&features2)&&3==t&&(e=!0),QE("p15consoleText",e)):(QH("p15statetext","Přístup odepřen"),QE("p15consoleText",!1),QE("p15uploadCore",!1),QV("p15outputselecttd",!1)),QV("devListToolbarViewIcons3",0!=(1&consoleNode.conn))}function p15consoleClear(){QH("p15agentConsoleText",""),Q("id_p15consoleClear").blur(),consoleNode.consoleText=""}var currentMesh,consoleHistory=[];function p15consoleSend(e){var t;e&&13!=e.keyCode||(e=Q("p15consoleText").value,t="<div style=color:green>&gt; "+EscapeHtml(e)+"<br/></div>",0!=(16&consoleNode.conn)&&2==Q("p15outputselect").value?(t="<div style=color:orange>MQTT&gt; "+EscapeHtml(e)+"<br/></div>",consoleNode.consoleText+=t,meshserver.send({action:"sendmqttmsg",topic:"console",nodeids:[consoleNode._id],msg:e})):1==consoleNode.pmt&&3==Q("p15outputselect").value&&0!=(2&features2)?(t="<div style=color:violet>TAM&gt; "+EscapeHtml(e)+"<br/></div>",consoleNode.consoleText+=t,meshserver.send({action:"pushconsole",nodeid:consoleNode._id,console:e})):0!=(1&consoleNode.conn)&&(consoleNode.consoleText+=t,meshserver.send({action:"msg",type:"console",nodeid:consoleNode._id,value:e})),Q("p15agentConsoleText").innerHTML+=t,Q("p15agentConsoleText").scrollTop=Q("p15agentConsoleText").scrollHeight,Q("p15consoleText").value="",0<e.length&&(0<=(t=consoleHistory.indexOf(e))&&consoleHistory.splice(t,1),consoleHistory.unshift(e),consoleHistory.splice(10)))}function p15consoleReceive(e,t,n){"serverconsole"===e?(t="<div>"+EscapeHtml(t)+"</div>",consoleServerText+=t,"server"==consoleNode&&(Q("p15agentConsoleText").innerHTML+=t,Q("p15agentConsoleText").scrollTop=Q("p15agentConsoleText").scrollHeight)):(t="MQTT"==n?"<div style=color:red>MQTT&gt; "+EscapeHtml(t)+"<br/></div>":"<div>"+EscapeHtml(t)+"</div>",null==e.consoleText?e.consoleText=t:e.consoleText+=t,consoleNode==e&&(Q("p15agentConsoleText").innerHTML+=t,Q("p15agentConsoleText").scrollTop=Q("p15agentConsoleText").scrollHeight))}function p15downloadConsoleText(){saveAs(new Blob([Q("p15agentConsoleText").innerText],{type:"application/octet-stream"}),"console.txt")}function p15uploadCore(e){xxdialogMode||(1==e.shiftKey?meshserver.send({action:"uploadagentcore",nodeid:consoleNode._id,type:"default"}):1==e.altKey?meshserver.send({action:"uploadagentcore",nodeid:consoleNode._id,type:"clear"}):1==e.ctrlKey?p15uploadCore2():setDialogMode(2,"Provést akci agenta",3,p15uploadCoreEx,addHtmlValue("Akce","<select id=d3coreMode style=width:230px><option value=1>Nahrát výchozí jádro serveru</option><option value=2>Vymazat jádro</option><option value=6>Nahrát jádro pro obnovu</option><option value=7>Nahrajte malé jádro</option><option value=3>Nahrát hlavní soubor</option><option value=4>Jemné odpojení agenta</option><option value=5>Vynutit odpojení agenta</option><option value=8>Restart agent service</select>")))}function p15uploadCoreEx(){1==Q("d3coreMode").value?meshserver.send({action:"uploadagentcore",nodeid:consoleNode._id,type:"default"}):2==Q("d3coreMode").value?meshserver.send({action:"uploadagentcore",nodeid:consoleNode._id,type:"clear"}):3==Q("d3coreMode").value?p15uploadCore2():4==Q("d3coreMode").value?meshserver.send({action:"agentdisconnect",nodeid:consoleNode._id,disconnectMode:1}):5==Q("d3coreMode").value?meshserver.send({action:"agentdisconnect",nodeid:consoleNode._id,disconnectMode:2}):6==Q("d3coreMode").value?meshserver.send({action:"uploadagentcore",nodeid:consoleNode._id,type:"recovery"}):7==Q("d3coreMode").value?meshserver.send({action:"uploadagentcore",nodeid:consoleNode._id,type:"tiny"}):8==Q("d3coreMode").value&&meshserver.send({action:"msg",type:"console",nodeid:consoleNode._id,value:"service restart"})}function p15uploadCore2(){xxdialogMode||(Q("d3localmodeform").action="uploadmeshcorefile.ashx",Q("d3auth").value=authCookie,Q("d3attrib").value=currentNode._id,setDialogMode(4,"Nahrát jádro agenta",3,p15uploadCoreEx2),d3init())}function p15uploadCoreEx2(){var e;1==Q("d3uploadMode").value?Q("d3submit").click():1==(e=d3getFileSel()).length&&meshserver.send({action:"uploadagentcore",nodeid:consoleNode._id,type:"custom",path:d3filetreelocation.join("/")+"/"+e[0]})}function p20updateMesh(){if(null!=currentMesh){QH("p20meshName",EscapeHtml(currentMesh.name));var e,t=format("Neznámé č. {0}",currentMesh.mtype),n=GetMeshRights(currentMesh),o=(1==currentMesh.mtype&&(t="Pouze Intel&reg; AMT, bez agenta"),2==currentMesh.mtype&&(t="Spravovat pomocí softwarového agenta"),3==currentMesh.mtype&&(t=null==currentMesh.relayid?"Místní zařízení, žádný agent":"Žádná zařízení agenta nepřenášejí přes agenta"),4==currentMesh.mtype&&(t=null==currentMesh.relayid?"IP-KVM zařízení":"IP-KVM zařízení přenášené přes agenta",1==currentMesh.kvm.model)&&(t+=", Raritan KX III"),""),a=(o=(o=(o+=addHtmlValue("Název",addLinkConditional(EscapeHtml(currentMesh.name),"p20editmesh(1)",0!=(1&n))))+addHtmlValue("Popis",addLinkConditional(currentMesh.desc&&""!=currentMesh.desc?EscapeHtml(currentMesh.desc):"<i>Nic</i>","p20editmesh(2)",0!=(1&n))))+addHtmlValue("Typ",t),3!=currentMesh.mtype&&4!=currentMesh.mtype||null==currentMesh.relayid||(t="<i>Neznámé</i>",o+=addHtmlValue("Reléové zařízení",addLinkConditional(t=null!=(a=getNodeFromId(currentMesh.relayid))?EscapeHtml(a.name):t,"p20editmeshrelay()",0!=(1&n)))),o=(o=4==currentMesh.mtype?(o+=addHtmlValue("Název stroje",currentMesh.kvm.host))+addHtmlValue("Uživatelské jméno",currentMesh.kvm.user):o)+('<br><input type=button value="Poznámky" onclick=showNotes(false,"'+encodeURIComponent(currentMesh._id)+'") />')+"<br style=clear:both><br>",currentMesh.links[userinfo._id]),i=(a&&0!=(2&a.rights)&&(o+="<div style=margin-bottom:6px;float:left;margin-right:10px><a onclick=p20showAddMeshUserDialog() style=cursor:pointer><img src=images/icon-addnew.png border=0 height=12 width=12> Přidat uživatele</a></div>"),0<=navigator.userAgent.toLowerCase().indexOf("android")&&(o+="<div style=margin-bottom:6px;float:left;margin-right:10px><a onclick=p20installAndroidDialog() style=cursor:pointer><img src=images/icon-addnew.png border=0 height=12 width=12> Nainstalujte na toto zařízení</a></div>"),o+='<table style="color:black;background-color:#EEE;border-color:#AAA;border-width:1px;border-style:solid;border-collapse:collapse" border=0 cellpadding=2 cellspacing=0 width=100%><tbody><tr style=background-color:#AAAAAA;font-weight:bold><th scope=col style=text-align:left;width:430px>Uživatelská oprávnění</th></tr>',1),s=[];for(e in currentMesh.links){var l=e.split("/")[2];currentMesh.links[e].name&&(l=currentMesh.links[e].name),e==userinfo._id&&(l=userinfo.name),null!=usergroups&&null!=usergroups[e]&&(l=usergroups[e].name),s.push({id:e,name:l,rights:currentMesh.links[e].rights})}for(e in s.sort(function(e,t){return e.name>t.name?1:e.name<t.name?-1:0}),s){var r="",d="Částečná práva",u=s[e].rights,c=2;4294967295==u?d="Administrátor":0==u&&(d="Žádná práva"),e==userinfo._id||4294967295!=n&&0==(2&n)||(r='<a onclick=p20deleteUser(event,"'+encodeURIComponent(s[e].id)+'") style=cursor:pointer><img src=images/trash.png border=0 height=10 width=10></a>'),s[e].id.startsWith("ugrp/")&&(c=4),o=(o+='<tr onclick=p20viewuser("'+encodeURIComponent(s[e].id)+'") style=height:32px;cursor:pointer'+(i%2==0?";background-color:#DDD":"")+"><td>")+("<div style=float:right>"+r+"</div><div style=float:right;padding-right:4px>"+d+"</div><div class=m"+c+"></div><div>&nbsp;"+EscapeHtml(decodeURIComponent(s[e].name))+"<div></div></div>")+"</td></tr>",++i}o+="</tbody></table>",4294967295==n&&(o+="<div style=font-size:small;text-align:right;margin-top:6px><span><a onclick=p20showDeleteMeshDialog() style=cursor:pointer>Smazat skupinu</a></span></div>"),QH("p20info",o)}}function p20showDeleteMeshDialog(){var e;return xxdialogMode||(e=format("Opravdu smazat skupinu {0}? Smazáním skupiny se smažou také všechny informace o zařízeních v této skupině.",EscapeHtml(currentMesh.name))+"<br /><br />",setDialogMode(2,"Smazat skupinu",3,p20showDeleteMeshDialogEx,e+="<label><input id=p20check type=checkbox onchange=p20validateDeleteMeshDialog() />Potvrdit</label>"),p20validateDeleteMeshDialog()),!1}function p20validateDeleteMeshDialog(){QE("idx_dlgOkButton",Q("p20check").checked)}function p20showDeleteMeshDialogEx(e,t){meshserver.send({action:"deletemesh",meshid:currentMesh._id,meshname:currentMesh.name})}function p20editmeshrelay(){if(!xxdialogMode){var e=[];if(0==(2&features))for(var t in nodes){var n=nodes[t];2==n.mtype&&null!=n.agent&&4294967295==GetNodeRights(n)&&e.push(n)}if(e.sort(nameSort),0==e.length)setDialogMode(2,"Upravit skupinu zařízení",1,null,"Nejsou k dispozici žádná reléová zařízení.");else{var o=[];for(t in e)o.push('<option value="'+e[t]._id+'"'+(currentMesh.relayid==e[t]._id?" selected":"")+">"+EscapeHtml(e[t].name)+"</option>");setDialogMode(2,"Upravit skupinu zařízení",3,p20editmeshrelayEx,addHtmlValue("Reléové zařízení","<div style=width:170px><select id=d2devrelay style=width:100%>"+o.join("")+"</select></div>"))}}}function p20editmeshrelayEx(){meshserver.send({action:"editmesh",meshid:currentMesh._id,relayid:Q("d2devrelay").value})}function p20editmesh(e){var t;xxdialogMode||(t=addHtmlValue("Název","<input id=dp20meshname style=width:170px maxlength=32 onchange=p20editmeshValidate() onkeyup=p20editmeshValidate() />"),setDialogMode(2,"Upravit skupinu zařízení",3,p20editmeshEx,t+=addHtmlValue("Popis","<input id=dp20meshdesc style=width:170px maxlength=1024 onkeyup=p20editmeshValidate() />")),Q("dp20meshname").value=currentMesh.name,currentMesh.desc&&(Q("dp20meshdesc").value=currentMesh.desc),p20editmeshValidate(),(2==e?Q("dp20meshdesc"):Q("dp20meshname")).focus())}function p20editmeshEx(){meshserver.send({action:"editmesh",meshid:currentMesh._id,meshname:Q("dp20meshname").value,desc:Q("dp20meshdesc").value})}function p20editmeshValidate(){QE("idx_dlgOkButton",0<Q("dp20meshname").value.length)}function p20installAndroidDialog(){var e;xxdialogMode||(e="<div style=text-align:center><p>Nainstalujte si MeshCentral Agent na své zařízení Android. Po instalaci připojte zařízení k tomuto serveru kliknutím na odkaz párování.</p>",setDialogMode(2,"Instalace Androidu",1,null,e=(e=(e+='<p><a rel="noreferrer noopener" target=_blank href="https://play.google.com/store/apps/details?id=com.meshcentral.agent2"><img style=cursor:pointer src="images/google-play-140.png" width=140 srcset="images/google-play-280.png 2x" /></a></p>')+'<p><a rel="noreferrer noopener" target=_blank href="https://www.amazon.co.uk/gp/product/B097Z4Q7SK/"><img style=cursor:pointer src="images/amazon-appstore-140.png"  width=140 srcset="images/amazon-appstore-280.png 2x" /></a></p>'+('<p><a rel="noreferrer noopener" target=_blank href="meshagents?id=14'+(urlargs.key?"&key="+urlargs.key:"")+'" title="APK version of the MeshAgent">Android APK</a></p>'))+('<p><a href="'+serverinfo.magenturl+","+serverinfo.agentCertHash+","+currentMesh._id.split("/")[2]+'"><b>Odkaz na párování zařízení</b></a></p></div>')))}function p20showAddMeshUserDialog(){var e;xxdialogMode||(e=addHtmlValue("User ID","<input id=dp20username style=width:170px maxlength=256 onchange=p20validateAddMeshUserDialog() onkeyup=p20validateAddMeshUserDialog() />"),setDialogMode(2,"Přidat uživatele do skupiny zařízení",3,p20showAddMeshUserDialogEx,e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e+='<div style="border:2px groove gray;background-color:white;max-height:120px;overflow-y:scroll">')+"<label><input type=checkbox onchange=p20validateAddMeshUserDialog() id=p20fulladmin>Administrátor</label><br>"+"<label><input type=checkbox onchange=p20validateAddMeshUserDialog() id=p20editmesh>Upravit skupinu zařízení</label><br>")+"<label><input type=checkbox onchange=p20validateAddMeshUserDialog() id=p20manageusers>Spravovat uživatele pro skupinu zařízení</label><br>"+"<label><input type=checkbox onchange=p20validateAddMeshUserDialog() id=p20managecomputers>Spravovat počítače ve skupině zařízení</label><br>")+"<label><input type=checkbox onchange=p20validateAddMeshUserDialog() id=p20remotecontrol>Ovládání na dálku</label><br>"+"<label><input type=checkbox onchange=p20validateAddMeshUserDialog() id=p20remoteview style=margin-left:12px>Pouze prohlížení na dálku</label><br>")+"<label><input type=checkbox onchange=p20validateAddMeshUserDialog() id=p20remotelimitedinput style=margin-left:12px>Pouze omezený vstup</label><br>"+"<label><input type=checkbox onchange=p20validateAddMeshUserDialog() id=p20noterminal style=margin-left:12px>Žádný přístup k terminálu</label><br>")+"<label><input type=checkbox onchange=p20validateAddMeshUserDialog() id=p20nofiles style=margin-left:12px>Žádný přístup k souborům</label><br>"+"<label><input type=checkbox onchange=p20validateAddMeshUserDialog() id=p20noamt style=margin-left:12px>Žádné Intel&reg; AMT</label><br>")+"<label><input type=checkbox onchange=p20validateAddMeshUserDialog() id=p20meshagentconsole>Konzole agenta</label><br>"+"<label><input type=checkbox onchange=p20validateAddMeshUserDialog() id=p20meshserverfiles>Soubory serveru</label><br>")+"<label><input type=checkbox onchange=p20validateAddMeshUserDialog() id=p20wakedevices>Probudit zařízení</label><br>"+"<label><input type=checkbox onchange=p20validateAddMeshUserDialog() id=p20editnotes>Upravit popis zařízení</label><br>")+"<label><input type=checkbox onchange=p20validateAddMeshUserDialog() id=p20limitevents>Zobrazit pouze vlastní události</label><br>"+"<label><input type=checkbox onchange=p20validateAddMeshUserDialog() id=p20chatnotify>Chat a upozornění</label><br>")+"<label><input type=checkbox onchange=p20validateAddMeshUserDialog() id=p20uninstall>Odinstalovat agenta</label><br>"+"<label><input type=checkbox onchange=p20validateAddMeshUserDialog() id=p20commands>Dálkové příkazy</label><br>")+"<label><input type=checkbox onchange=p20validateAddMeshUserDialog() id=p20resetoff>Reset / Vypnutí</label><br>"+"</div>"),p20validateAddMeshUserDialog(),Q("dp20username").focus())}function p20validateAddMeshUserDialog(){var e=GetMeshRights(currentMesh),t=!Q("p20fulladmin").checked;QE("p20fulladmin",4294967295==e),QE("p20editmesh",t&&4294967295==e),QE("p20manageusers",t),QE("p20managecomputers",t),QE("p20remotecontrol",t),QE("p20meshagentconsole",t),QE("p20meshserverfiles",t),QE("p20wakedevices",t),QE("p20editnotes",t),QE("p20limitevents",t),QE("p20remoteview",t&&Q("p20remotecontrol").checked),QE("p20remotelimitedinput",t&&Q("p20remotecontrol").checked&&!Q("p20remoteview").checked),QE("p20noterminal",t&&Q("p20remotecontrol").checked),QE("p20nofiles",t&&Q("p20remotecontrol").checked),QE("p20noamt",t&&Q("p20remotecontrol").checked),QE("p20chatnotify",t),QE("p20uninstall",t),QE("p20commands",t),QE("p20resetoff",t)}function p20showAddMeshUserDialogEx(){var e,t=0,n=(1==Q("p20fulladmin").checked?t=4294967295:(1==Q("p20editmesh").checked&&(t+=1),1==Q("p20manageusers").checked&&(t+=2),1==Q("p20managecomputers").checked&&(t+=4),1==Q("p20remotecontrol").checked&&(t+=8),1==Q("p20meshagentconsole").checked&&(t+=16),1==Q("p20meshserverfiles").checked&&(t+=32),1==Q("p20wakedevices").checked&&(t+=64),1==Q("p20editnotes").checked&&(t+=128),1==Q("p20remoteview").checked&&(t+=256),1==Q("p20noterminal").checked&&(t+=512),1==Q("p20nofiles").checked&&(t+=1024),1==Q("p20noamt").checked&&(t+=2048),1==Q("p20remotelimitedinput").checked&&(t+=4096),1==Q("p20limitevents").checked&&(t+=8192),1==Q("p20chatnotify").checked&&(t+=16384),1==Q("p20uninstall").checked&&(t+=32768),1==Q("p20commands").checked&&(t+=131072),1==Q("p20resetoff").checked&&(t+=262144)),Q("dp20username").value.split(",")),o=[];for(e in n)o.push(n[e].trim());meshserver.send({action:"addmeshuser",meshid:currentMesh._id,meshname:currentMesh.name,usernames:o,meshadmin:t})}function p20viewuser(e){var t,n,o,a,i,s;xxdialogMode||(e=decodeURIComponent(e),t=[],n=GetMeshRights(currentMesh),4294967295==(o=GetMeshRights(currentMesh,e))?t.push("Administrátor"):(0!=(1&o)&&t.push("Upravit skupinu zařízení"),0!=(2&o)&&t.push("Spravovat uživatele pro skupinu zařízení"),0!=(4&o)&&t.push("Spravovat počítače ve skupině zařízení"),0!=(8&o)&&t.push("Ovládání na dálku"),0!=(16&o)&&t.push("Konzole agenta"),0!=(32&o)&&t.push("Soubory serveru"),0!=(64&o)&&t.push("Probudit zařízení"),0!=(128&o)&&t.push("Upravit poznámky"),0!=(256&o)&&t.push("Pouze prohlížení na dálku"),0!=(512&o)&&t.push("Žádný terminál"),0!=(1024&o)&&t.push("Žádné soubory"),0!=(2048&o)&&t.push("Žádné Intel&reg; AMT"),0!=(8&o)&&0!=(4096&o)&&0==(256&o)&&t.push("Omezený vstup"),0!=(8192&o)&&t.push("Pouze vlastní události"),0!=(16384&o)&&t.push("Chat a upozornění"),0!=(32768&o)&&t.push("Odinstalace"),0!=(131072&o)&&t.push("Příkazy"),0!=(262144&o)&&t.push("Reset / Vypnuto")),0==t.length&&t.push("Žádná práva"),a=1,i=e.split("/")[2],currentMesh.links[e].name&&(i=currentMesh.links[e].name),s=addHtmlValue("Uživatelské jméno",EscapeHtml(i)),i!=e.split("/")[2]&&(s+=addHtmlValue("uživatelské ID",EscapeHtml(e.split("/")[2]))),s+=addHtmlValue("Oprávnění",t.join(", ")),userinfo._id!=e&&(4294967295==n||0!=(2&n)&&4294967295!=o)&&(a+=4),setDialogMode(2,"Uživatel této skupiny zařízení",a,p20viewuserEx,s,e))}function p20viewuserEx(e,t){2==e&&(e=t.split("/")[2],users&&users[t]&&(e=users[t].name),usergroups&&usergroups[t]&&(e=usergroups[t].name),setDialogMode(2,"Vzdálený uživatel",3,p20viewuserEx2,format("Potvrdit odstranění uživatele {0}?",e=userinfo._id==t?userinfo.name:e),t))}function p20deleteUser(e,t){haltEvent(e),p20viewuserEx(2,decodeURIComponent(t))}function p20viewuserEx2(e,t){meshserver.send({action:"removemeshuser",meshid:currentMesh._id,meshname:currentMesh.name,userid:t})}var notifications=[];function clickNotificationIcon(e){1==e?QV("notifiyBox",!0):0==e?QV("notifiyBox",!1):QV("notifiyBox","none"==QS("notifiyBox").display),drawNotifications()}function setNotificationCount(e){parseInt(Q("notificationCount").innerHTML)!=e&&(QH("notificationCount2",e),QV("notificationCount",0<e))}function drawNotifications(){var e=getstore("notifications",0),t="";if(0==notifications.length)t="<div style=margin:5px>V tuto chvíli zde nejsou žádná upozornění</div>";else for(var n in notifications){var o,n=notifications[n],a="",i=new Date(n.time),s=0;null!=n.title&&(a="<b>"+EscapeHtml(n.title)+"</b>: "),null!=n.nodeid&&null!=(o=getNodeFromId(n.nodeid))&&(s=o.icon,a=16&e?"<b>"+EscapeHtml(meshes[o.meshid].name)+" / "+EscapeHtml(o.name)+"</b>: ":"<b>"+EscapeHtml(o.name)+"</b>: "),t+='<div title="'+format("Nastalo na {0}",printDateTime(i))+'" id="notifyx'+n.id+'" class=notification style="cursor:pointer;border-top:1px solid '+(""==t?"transparent":"orange")+'">',s&&(t+="<div class=j"+s+' onclick="notificationSelected('+n.id+')" style=margin:5px;float:left></div>'),t+='<div onclick="notificationDelete('+n.id+')" class=unselectable title="Zrušte toto oznámení" style=margin:5px;float:right;color:orange><b>X</b></div><div onclick="notificationSelected('+n.id+')" style=margin:5px>'+a+EscapeHtml(n.text)+"</div><div style=margin-left:5px;margin-bottom:5px;color:gray;font-size:10px>"+printDateTime(i)+"</div></div>"}var l="";1<notifications.length&&(l='<div id="notifyRemoveAll" onclick="deleteAllNotifications()" style="cursor:pointer;border-top:1px solid orange;margin:5px;color:orange;text-align:right;padding-right:3px">Vymazat vše</div>'),QH("notifiyBox",'<div class=customScroll style="max-height:170px;overflow-y:auto;margin:5px">'+t+l+"</div>")}function notificationSelected(e,t){var n,o=-1;for(n in notifications)notifications[n].id==e&&(o=n);-1!=o&&(notificationSelectedEx(notifications[o],e),t)&&notifications[o]&&(notifications[o].notification&&(notifications[o].notification.close(),delete notifications[o].notification),notificationDelete(e))}function notificationSelectedEx(e,t){null!=e.nodeid?"desktop"==e.tag?gotoDevice(e.nodeid,12):"terminal"==e.tag?gotoDevice(e.nodeid,11):"files"==e.tag?gotoDevice(e.nodeid,13):"intelamt"==e.tag?gotoDevice(e.nodeid,14):"console"==e.tag?gotoDevice(e.nodeid,15):gotoDevice(e.nodeid,10):"backupcodes"!=e.tag||xxdialogMode?null!=e.tag&&e.tag.startsWith("meshmessenger/")?(safeNewWindow("/messenger?id="+e.tag+"&title="+encodeURIComponentEx(e.username),e.tag.split("/")[2]),notificationDelete(t)):null!=e.url&&(safeNewWindow(e.url),notificationDelete(t)):(account_manageOtp(0),notificationDelete(t))}function notificationDelete(e){var t=-1,n=Q("notifyx"+e);if(null!=n){for(var o in notifications)notifications[o].id==e&&(t=o);-1!=t&&(meshserver.send({action:"intersession",subaction:"removeNotify",id:e}),notifications[t].notification&&(notifications[t].notification.close(),delete notifications[t].notification),notifications.splice(t,1),n.parentNode.removeChild(n),setNotificationCount(notifications.length),0==notifications.length&&QV("notifiyBox",!1),1==notifications.length&&QV("notifyRemoveAll",!1),0<notifications.length)&&0==t&&(n=notifications[0],QS("notifyx"+n.id)["border-top"]="1px solid transparent")}}function addNotification(e){if("number"==typeof e.titleid)try{e.title=[null,"Nový účet","Serverový limit","Bezpečnostní varování","Nastavení účtu","Skupina zařízení","Pozvat kódy"][e.titleid]}catch(e){}if("number"==typeof e.msgid)try{e.text=[null,"Přístup odepřen","Neplatné uživatelské jméno","Neplatné heslo","Neplatný e-mail","Neplatná doména","Neplatná oprávnění webu","Uživatel již existuje","V tomto režimu nelze přidat uživatele","Ověřovací výjimka","Dosažen nejvyšší možný počet účtů.","Žádost o chat, přijměte kliknutím sem.","Od posledního přihlášení došlo k tomuto {0} neúspěšnému pokusu o přihlášení.","E -mailovou adresu se nepodařilo změnit, jiný účet již používá: {0}.","Email odeslán.","Uživatel {0} nebyl nalezen.","Uživatelé {0} nebyli nalezeni.","Chyba, nelze změnit dříve použité heslo.","Chyba, nelze změnit na běžně používané heslo.","Chyba, heslo nebylo změněno.","Heslo změněno.","Aktuální heslo není správné.",'Chyba, pozývací kód "{0}" se již používá.',"SMS brána není povolena","Žádná práva pro správu uživatelů","Neplatná SMS zpráva","Pro tohoto uživatele není k dispozici žádné telefonní číslo","SMS byla úspěšně odeslána.","Chyba SMS","Chyba SMS: {0}",'E-mailová doména "{0}" není povolena. Povoleno je pouze ({1}).'][e.msgid],Array.isArray(e.args)&&(e.text=format(e.text,e.args[0],e.args[1],e.args[2],e.args[3],e.args[4],e.args[5]))}catch(e){}null==e.time&&(e.time=Date.now()),null==e.id&&(e.id=Math.random()),notifications.unshift(e),setNotificationCount(notifications.length),clickNotificationIcon(!0);var t,n,o=getstore("notifications",0),a=(1&o&&Q("chimes").play(),null);Notification&&"granted"==Notification.permission&&(t=e.text.split("&reg;").join("").split("<b>").join("").split("</b>").join("").split("<br />").join("\r\n"),e.nodeid?(n=getNodeFromId(e.nodeid))&&(a=16&o?new Notification(decodeURIComponent("{{{extitle}}}")+" - "+meshes[n.meshid].name+" - "+n.name,{tag:e.tag,body:t,icon:"/images/notify/icons128-"+n.icon+".png"}):new Notification(decodeURIComponent("{{{extitle}}}")+" - "+n.name,{tag:e.tag,body:t,icon:"/images/notify/icons128-"+n.icon+".png"})):(null==e.icon&&(e.icon=0),o=null==(o=e.title)?"":" - "+e.title,a=new Notification(decodeURIComponent("{{{extitle}}}")+o,{tag:e.tag,body:t,icon:"/images/notify/icons128-"+e.icon+".png"})),a.id=e.id,a.xtag=e.tag,a.url=e.url,a.nodeid=e.nodeid,a.username=e.username,a.onclick=function(e){notificationSelected(e.target.id,!0)},e.notification=a),"number"==typeof e.maxtime&&0<e.maxtime&&((n=function e(){notificationDelete(e.xid)}).xid=e.id,setTimeout(n,1e3*e.maxtime))}function deleteAllNotifications(){notifications=[],setNotificationCount(0),drawNotifications(),QV("notifiyBox",!1)}var xxdialogMode,xxdialogFunc,xxdialogButtons,xxdialogTag,xxcurrentView=-1;function go(e){if(setSessionActivity(),!xxdialogMode&&xxcurrentView!=e){updateFooterMenu(),setDialogMode(0);for(var t=0;t<32;t++)QV("p"+t,t==e);xxcurrentView=e,updateCurrentUrl()}}function updateCurrentUrl(){if(0==(268435456&features)&&0<xxcurrentView){var e,t="";for(e in 10<=xxcurrentView&&xxcurrentView<=19?null!=currentNode&&(t="?viewmode="+xxcurrentView+"&gotonode="+currentNode._id.split("/")[2]+(0<currentDevicePanel?"&panel="+currentDevicePanel:"")):20<=xxcurrentView&&xxcurrentView<=29?null!=currentMesh&&(t="?viewmode="+xxcurrentView+"&gotomesh="+currentMesh._id.split("/")[2]):1<xxcurrentView&&(t="?viewmode="+xxcurrentView),urlargs)t+=(""==t?"?":"&")+e+"="+urlargs[e];try{window.history.replaceState({},document.title,window.location.pathname+t)}catch(e){}}}function setDialogMode(e,t,n,o,a,i){setSessionActivity(),xxdialogMode=e,xxdialogFunc=o,xxdialogButtons=n,xxdialogTag=i,QE("idx_dlgOkButton",!0),QV("idx_dlgOkButton",1&n),QV("idx_dlgCancelButton",2&n),QV("id_dialogclose",2&n||8&n),QV("idx_dlgDeleteButton",4&n),QV("idx_dlgButtonBar",7&n),t&&QH("id_dialogtitle",t);for(var s=1;s<24;s++)QV("dialog"+s,s==e);QV("dialog",e),a&&(2==e?QH("id_dialogOptions",a):QH("id_dialogMessage",a))}function dialogclose(e){setSessionActivity();var t=xxdialogFunc,n=xxdialogButtons,o=xxdialogTag;setDialogMode(),(8&n||e)&&t&&t(e,o)}function removeUserRights(e,t){var n;return t==userinfo._id&&null!=userinfo.removeRights&&((n=t=0)!=(8&userinfo.removeRights)&&(n+=8),0!=(65536&userinfo.removeRights)&&(t+=65536),0!=(256&userinfo.removeRights)&&(t+=256),0!=(512&userinfo.removeRights)&&(t+=512),0!=(1024&userinfo.removeRights)&&(t+=1024),0!=(16&userinfo.removeRights)&&(n+=16),0!=(32768&userinfo.removeRights)&&(n+=32768),0!=(131072&userinfo.removeRights)&&(n+=131072),0!=(64&userinfo.removeRights)&&(n+=64),0!=(262144&userinfo.removeRights)&&(n+=262144),e=4294967295!=e?(e|t)&4294967295-n:((e=2015471)|t)&4294967295-n),e}function GetMeshRights(e,t){if(null==e)return 0;if(null==t&&(t=userinfo._id),null==(e="string"==typeof e?meshes[e]:e)||null==e.links)return 0;if(serverinfo.manageAllDeviceGroups&&t==userinfo._id)return removeUserRights(4294967295,t);var n=0,o=e.links[t];if(null!=o){if(4294967295==o.rights)return removeUserRights(4294967295,t);n=o.rights}var a=null;if(t==userinfo._id?a=userinfo:null!=users&&(a=users[t]),null!=a)for(var i in a.links)if(i.startsWith("ugrp/")&&null!=(o=e.links[i])){if(4294967295==o.rights)return removeUserRights(4294967295,t);n|=o.rights}return removeUserRights(n,t)}function IsMeshViewable(e,t){if(null!=e&&(null==t&&(t=userinfo._id),null!=(e="string"==typeof e?meshes[e]:e))&&null!=e.links){if(null!=e.links[t])return!0;if(serverinfo.manageAllDeviceGroups&&t==userinfo._id)return!0;var n=null;if(t==userinfo._id?n=userinfo:null!=users&&(n=users[t]),null!=n)for(var o in n.links)if(o.startsWith("ugrp/")&&null!=e.links[o])return!0}return!1}function GetNodeRights(e,t){if(null==e)return 0;if(null==t&&(t=userinfo._id),"string"==typeof e&&null==(e=getNodeFromId(e)))return 0;var n=GetMeshRights(e.meshid,t);if(4294967295!=n&&(null!=e.links&&null!=e.links[t]&&(n|=e.links[t].rights),null!=e.links)&&null!=userinfo.links)for(var o in e.links)o.startsWith("ugrp/")&&null!=userinfo.links[o]&&null!=e.links[o].rights&&(n|=e.links[o].rights);return removeUserRights(n,t)}function IsNodeViewable(e,t){if(null!=e&&(null==t&&(t=userinfo._id),"string"!=typeof e||null!=(e=getNodeFromId(e)))){if(IsMeshViewable(e.meshid,t))return!0;if(null!=e.links&&null!=e.links[t])return!0;if(null!=e.links&&null!=userinfo.links)for(var n in e.links)if(n.startsWith("ugrp/")&&null!=userinfo.links[n]&&null!=e.links[n].rights)return!0}return!1}function nameSort(e,t){e=e.name.toLowerCase(),t=t.name.toLowerCase();return sortCollator.compare(e,t)}function getNodeAmtVersion(e){return null==e||null==e.intelamt||"string"!=typeof e.intelamt.ver||(e=e.intelamt.ver.split(".")).length<2?0:parseInt(e[0])+parseInt(e[1])/100}function putstore(e,t){try{if("undefined"==typeof localStorage||localStorage.getItem(e)==t)return;null==t?localStorage.removeItem(e):localStorage.setItem(e,t)}catch(e){}if("_"!=e[0]){for(var n={},o=0,a=localStorage.length;o<a;++o){var i=localStorage.key(o);"_"!=i[0]&&(n[i]=localStorage.getItem(i))}meshserver.send({action:"userWebState",state:JSON.stringify(n)})}}function getstore(e,t){try{var n;return"undefined"==typeof localStorage?t:null==(n=localStorage.getItem(e))?t:n}catch(e){return t}}function center(){xtermfit&&xtermfit.fit(),onDevicesScroll(),QS("dialog").left=(getDocWidth()-300)/2+"px",deskAdjust(),null!=currentNode&&drawDeviceTimeline()}function messagebox(e,t){QH("id_dialogMessage",t),setDialogMode(1,e,1)}function statusbox(e,t){QH("id_dialogMessage",t),setDialogMode(1,e)}function getDocWidth(){return window.innerWidth||(document.documentElement&&document.documentElement.clientWidth&&0!=document.documentElement.clientWidth?document.documentElement:document.getElementsByTagName("body")[0]).clientWidth}function haltEvent(e){return e.preventDefault&&e.preventDefault(),e.stopPropagation&&e.stopPropagation(),!1}function haltReturn(e){13==e.keyCode&&haltEvent(e)}function validateEmail(e){return/^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/.test(e)}function reload(){window.location.href=window.location.href}function getNodeFromId(e){for(var t in nodes)if(nodes[t]._id==e)return nodes[t];return null}function addHtmlValue(e,t){return"<table><td style=width:120px>"+e+"<td><b>"+t+"</b></table>"}function addHtmlValue2(e,t){return"<div><div style=display:inline-block;float:right>"+t+"</div><div style=display:inline-block>"+e+"</div></div>"}function addHtmlValue4(e,t){return"<table style=width:100%><td style=width:120px>"+e+"<td style=text-align:right><b>"+t+"</b></table>"}function addLink(e,t){return"<a style=cursor:pointer;text-decoration:none onclick='"+t+"'>&diams; "+e+"</a>"}function addLinkConditional(e,t,n){return n?addLink(e,t):e}function addKeyLink(e,t){return"<span tabindex=0 style=cursor:pointer;text-decoration:none onclick="+t+" onkeypress=\"if (event.key=='Enter') { "+t+' } ">'+e+" <img class=hoverButton src=images/key16.png></span>"}function addKeyLinkConditional(e,t,n){return n?"<span title='"+t+"'>"+e+" <img class=hoverButton src=images/key16.png></span>":e}function passwordcheck(e){return/(?=.*\d)(?=.*[a-z])(?=.*[A-Z])(?=.*[!@#$%^&*()]).{8,}/.test(e)}function getFileSizeStr(e){return 1==(e="number"!=typeof e?0:e)?"1 bajt":format("{0} bytes",e)}function joinPaths(){var e,t=[];for(e in arguments){var n=arguments[e];if(null!=n&&""!=n){for(;n.endsWith("/")||n.endsWith("\\");)n=n.substring(0,n.length-1);for(;n.startsWith("/")||n.startsWith("\\");)n=n.substring(1);t.push(n)}}return t.join("/")}function focusTextBox(e){setTimeout(function(){Q(e).selectionStart=Q(e).selectionEnd=65535,Q(e).focus()},0)}isFilenameValid=(()=>{var t=/^[^\\/:\*\?"<>\|]+$/,n=/^\./,o=/^(nul|prn|con|lpt[0-9]|com[0-9])(\.|$)/i;return function(e){return t.test(e)&&!n.test(e)&&!o.test(e)&&"."!=e[0]}})();function printDate(e){return e.toLocaleDateString(args.locale)}function printTime(e){return e.toLocaleTimeString(args.locale)}function printDateTime(e){return e.toLocaleString(args.locale)}function format(e){var n=Array.prototype.slice.call(arguments,1);return e.replace(/{(\d+)}/g,function(e,t){return void 0!==n[t]?n[t]:e})}function nobreak(e){return e.split(" ").join("&nbsp;")}function getUserName(e){return users&&null!=users[e]?users[e].name:e.split("/")[2]}function addDetailItem(e,t,n){return"<table style=width:100%><td>"+nobreak(e)+"<td style=text-align:right>"+t+"</table>"}function isPrivateIP(e){return e.startsWith("10.")||e.startsWith("172.16.")||e.startsWith("192.168.")}function encodeURIComponentEx(e){return encodeURIComponent(e).replace(/'/g,"%27")}function safeNewWindow(e,t){e=window.open(e,t,"noopener,noreferrer");e&&(e.opener=null)}</script>