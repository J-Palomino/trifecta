<!doctypehtml><html lang=it dir=ltr xmlns=http://www.w3.org/1999/xhtml><meta http-equiv=X-UA-Compatible content="IE=edge"><meta http-equiv=Content-Type content="text/html;charset=utf-8"><meta name=viewport content="user-scalable=1,initial-scale=1,minimum-scale=1,maximum-scale=1"><meta name=apple-mobile-web-app-capable content=yes><meta name=format-detection content="telephone=no"><meta name=robots content=noindex,nofollow><link rel=manifest href={{{domainurl}}}manifest.json><link type=image/x-icon href={{{domainurl}}}favicon.ico rel="shortcut icon"><link keeplink=1 type=text/css href=styles/style-bootstrap.css media=screen rel=stylesheet title=CSS><link type=text/css href=styles/ol.css media=screen rel=stylesheet title=CSS><link type=text/css href=styles/ol3-contextmenu.min.css media=screen rel=stylesheet title=CSS><link type=text/css href=styles/xterm.css media=screen rel=stylesheet title=CSS><link type=text/css href=styles/flatpickr.min.css media=screen rel=stylesheet title=CSS><link id=theme-stylesheet href=styles/bootstrap{{{min}}}.css rel=stylesheet title=CSS><link href=styles/sweetalert2.min.css rel=stylesheet title=CSS><link href=styles/select2.min.css rel=stylesheet title=CSS><link href=styles/select2-bootstrap-5-theme.min.css rel=stylesheet title=CSS><link rel=apple-touch-icon href=/favicon-303x303.png><script src=scripts/common-0.0.1{{{min}}}.js></script><script src=scripts/meshcentral{{{min}}}.js></script><script src=scripts/amt-0.2.0{{{min}}}.js></script><script src=scripts/amt-wsman-0.2.0{{{min}}}.js></script><script src=scripts/amt-desktop-0.0.2{{{min}}}.js></script><script src=scripts/amt-terminal-0.0.2{{{min}}}.js></script><script src=scripts/zlib{{{min}}}.js></script><script src=scripts/zlib-inflate{{{min}}}.js></script><script src=scripts/zlib-adler32{{{min}}}.js></script><script src=scripts/zlib-crc32{{{min}}}.js></script><script src=scripts/amt-redir-ws-0.1.0{{{min}}}.js></script><script src=scripts/amt-wsman-ws-0.2.0{{{min}}}.js></script><script src=scripts/agent-redir-ws-0.1.1{{{min}}}.js></script><script src=scripts/agent-redir-rtc-0.1.0{{{min}}}.js></script><script src=scripts/agent-desktop-0.0.2{{{min}}}.js></script><script src=scripts/agent-rdp-0.0.1{{{min}}}.js></script><script src=scripts/qrcode.min.js></script><script src=scripts/xterm{{{min}}}.js></script><script src=scripts/xterm-addon-fit{{{min}}}.js></script><script src=scripts/flatpickr.js></script><script src=mstsc/mstsc.js></script><script src=mstsc/keyboard.js></script><script src=mstsc/rle.js></script><script src=mstsc/client.js></script><script src=mstsc/canvas.js></script><script src=scripts/jquery{{{min}}}.js></script><script src=scripts/bootstrap{{{min}}}.js></script><script src=scripts/fontawesome/all.min.js></script><script src=scripts/sweetalert2.all.min.js></script><script src=scripts/select2.full.min.js></script><script src=scripts/themes/theme-switcher.js></script><script keeplink=1 src=scripts/u2f-api{{{min}}}.js></script><script keeplink=1 src=scripts/charts{{{min}}}.js></script><script keeplink=1 src=scripts/moment{{min}}.js></script><script keeplink=1 src=scripts/chartjs-adapter-moment{{{min}}}.js></script><script keeplink=1 src=scripts/filesaver.min.js></script><script keeplink=1 src=scripts/ol{{{min}}}.js></script><script keeplink=1 src=scripts/ol3-contextmenu{{{min}}}.js></script><script keeplink=1 src=scripts/purify{{{min}}}.js></script><script keeplink=1 src=scripts/marked{{{min}}}.js></script><title>{{{title}}}</title><body id=body oncontextmenu=handleContextMenu(event) style=display:none;min-width:495px onload='"undefined"!=typeof startup&&startup()'><div id=contextMenu class="contextMenu noselect"style=display:none><div id=cxinfo class=cmtext onclick=cmaction(1,event)><b>Informazione</b></div><div id=cxdesktop class=cmtext onclick=cmaction(3,event)>Desktop</div><div id=cxterminal class=cmtext onclick=cmaction(2,event)>Terminale</div><div id=cxfiles class=cmtext onclick=cmaction(4,event)>File</div><div id=cxevents class=cmtext onclick=cmaction(5,event)>Eventi</div><div id=cxdetails class=cmtext onclick=cmaction(6,event)>Dettagli</div><div id=cxconsole class=cmtext onclick=cmaction(7,event)>Console</div><div id=cxwebrdp class=cmtext onclick=cmaction(11,event)>Web-RDP</div><div id=cxwebvnc class=cmtext onclick=cmaction(12,event)>Web-VNC</div><div id=cxwebssh class=cmtext onclick=cmaction(13,event)>Web-SSH</div><div id=cxrdp class=cmtext onclick=cmaction(14,event)>RDP</div><div id=cxplugins class=cmtext onclick=cmaction(8,event) style=display:none>Plugins</div><hr id=cxmgroupsplit><div id=cxstar class=cmtext onclick=cmaction(10,event) style=display:none>Attiva/disattiva stella</div><div id=cxmdesktop class=cmtext onclick=cmaction(9,event) style=display:none>Multi-Desktop</div></div><div id=meshContextMenu class="contextMenu noselect"style=display:none;min-width:0><div id=cxselectall class=cmtext onclick=cmmeshaction(1,event)>Seleziona tutto</div><div id=cxselectnone class=cmtext onclick=cmmeshaction(2,event)>Non selezionare niente</div></div><div id=altPortContextMenu class="contextMenu noselect"style=display:none;min-width:0><div class=cmtext onclick=cmaltportaction(1,event)>Porta alternativa</div></div><div id=sshPortContextMenu class="contextMenu noselect"style=display:none;min-width:0><div class=cmtext onclick=cmsshportaction(1,event)>Porta alternativa</div></div><div id=rfbPortContextMenu class="contextMenu noselect"style=display:none;min-width:0><div class=cmtext onclick=cmrfbportaction(1,event)>Porta alternativa</div></div><div id=httpPortContextMenu class="contextMenu noselect"style=display:none;min-width:0><div class=cmtext onclick=cmhttpportaction(1,event)>Porta alternativa</div></div><div id=httpsPortContextMenu class="contextMenu noselect"style=display:none;min-width:0><div class=cmtext onclick=cmhttpsportaction(1,event)>Porta alternativa</div></div><div id=filesContextMenu class="contextMenu noselect"style=display:none;min-width:0><div class=cmtext onclick=cmfilesaction(1,event)>Rinominare</div><div class=cmtext onclick=cmfilesaction(2,event)>modificare</div><div class=cmtext onclick=cmfilesaction(3,event)>Elimina</div></div><div id=expandAllContextMenu class="contextMenu noselect"style=display:none;min-width:0><div class=cmtext onclick=cmexpandaction(1,event)>Espandi tutto</div><div class=cmtext onclick=cmexpandaction(2,event)>Comprimi tutto</div></div><div id=deskPlayerContextMenu class="contextMenu noselect"style=display:none;min-width:0><div class=cmtext onclick=cmdeskplayeraction(1,event)>Apri il lettore...</div></div><div id=deskKeyShortcutContextMenu class="contextMenu noselect"style=display:none;min-width:0><div class=cmtext onclick=cmdeskshortcutaction(1,event)>Personalizzare...</div></div><div id=deskPreConfigShortcutContextMenu class="contextMenu noselect"style="display:none;min-width:0;max-height:calc(80% - 50px);overflow-y:auto"><span id=deskPreConfigShortcutContextMenu1></span> <span id=deskPreConfigShortcutContextMenu2></span><div class=cmtext onclick=cmdeskpreconfigtypeaction(-1,event)>Personalizzare...</div></div><div id=deskPreConfigScriptContextMenu class="contextMenu noselect"style="display:none;min-width:0;max-height:calc(80% - 50px);overflow-y:auto"><span id=deskPreConfigScriptContextMenu1></span> <span id=deskPreConfigScriptContextMenu2></span></div><div id=container><div id=notifiyBox class=notifiyBox style=display:none></div><div id=masthead class=noselect><div style=float:left>{{{titlehtml}}}</div><div class=title onclick=go(1,event)>{{{title1}}}</div><div class=title2>{{{title2}}}</div><div style=float:right><div id=notificationCount onclick=clickNotificationIcon() class=unselectable style=display:none title="Fare clic per visualizzare le notifiche correnti">0</div></div><p id=logoutControl><span id=logoutControlSpan class=logoncontrolspan></span><span id=idleTimeoutNotify style=color:#ff0></span></p><img id=topMenuIcon class=noselect style=position:absolute;right:0;top:10px;color:#c8c8c8;font-size:44px;margin-right:8px;cursor:pointer;display:none onclick=topMenu() src=/images/3bars-30.png width=30 height=30><div class=textnewui id=textnewui onmouseup=toggleBootstrapUIMode() onkeypress='"Enter"==event.key&&toggleBootstrapUIMode()'><b>Try the new MeshCentral UI</b></div></div><div class="sidebar flex-column"id=page_leftbar><div style=height:24px></div><nav class="nav flex-column"><a class="nav-link active text-center text-white lbbuttonsel"id=LeftMenuMyDevices href=# data-target=general onmouseup=go(1,event) onkeypress='"Enter"==event.key&&go(1)'><i class="fa-solid fa-computer me-2"></i></a> <a class="nav-link text-center text-white"id=LeftMenuMyAccount href=# data-target=account onmouseup=go(2,event) onkeypress='"Enter"==event.key&&go(2)'><i class="fa-solid fa-user-gear me-2"></i></a> <a class="nav-link text-center text-white"id=LeftMenuMyEvents href=# data-target=events onmouseup=go(3,event) onkeypress='"Enter"==event.key&&go(3)'><i class="fa-solid fa-calendar-alt me-2"></i></a> <a class="nav-link text-center text-white"id=LeftMenuMyFiles href=# data-target=files onmouseup=go(5,event) onkeypress='"Enter"==event.key&&go(5)'><i class="fa-solid fa-folder-open me-2"></i></a> <a class="nav-link text-center text-white"id=LeftMenuMyUsers href=# data-target=users onmouseup=go(4,event) onkeypress='"Enter"==event.key&&go(4)'><i class="fa-solid fa-users me-2"></i></a> <a class="nav-link text-center text-white"id=LeftMenuMyServer href=# data-target=server onmouseup=go(6,event) onkeypress='"Enter"==event.key&&go(6)'><i class="fa-solid fa-server me-2"></i></a></nav></div><div id=topbar class=noselect><div><div style=position:relative><span id=logoutControlSpan2></span><div tabindex=0 id=uiMenuButton title="Selezione dell'interfaccia utente"onclick=showUserInterfaceSelectMenu() onkeypress='"Enter"==event.key&&showUserInterfaceSelectMenu()'>♦<div id=uiMenu style=display:none><table><tr><td><div tabindex=0 id=uiViewButton1 class=uiSelector onclick=userInterfaceSelectMenu(1) title="Interfaccia della barra sinistra"onkeypress='"Enter"==event.key&&userInterfaceSelectMenu(1)'><div class=uiSelector1></div></div><div tabindex=0 id=uiViewButton2 class=uiSelector onclick=userInterfaceSelectMenu(2) title="Interfaccia della barra superiore"onkeypress='"Enter"==event.key&&userInterfaceSelectMenu(2)'><div class=uiSelector2></div></div><div tabindex=0 id=uiViewButton3 class=uiSelector onclick=userInterfaceSelectMenu(3) title="Interfaccia a larghezza fissa"onkeypress='"Enter"==event.key&&userInterfaceSelectMenu(3)'><div class=uiSelector3></div></div><div tabindex=0 id=uiViewButton7 class=uiSelector onclick=toggleBootstrapUIMode() title="Toggle Modern UI"onkeypress='"Enter"==event.key&&toggleBootstrapUIMode()'><div class=uiSelector7></div></div><td><div tabindex=0 id=uiViewButton6 class=uiSelector onclick=showNotes(!1) title="Note Personali"onkeypress='"Enter"==event.key&&showNotes(!1)'><div class=uiSelector6></div></div><div tabindex=0 id=uiViewButton4 class=uiSelector onclick=toggleNightMode() title="Attiva/disattiva la modalità notturna"onkeypress='"Enter"==event.key&&toggleNightMode()'><div class=uiSelector4></div></div><div tabindex=0 id=uiViewButton5 class=uiSelector onclick=toggleFooterBarMode() title="Attiva/disattiva la barra del piè di pagina"onkeypress='"Enter"==event.key&&toggleFooterBarMode()'><div class=uiSelector5></div></div><div class=uiSelector_end>&nbsp;</div></table></div></div><table id=MainMenuSpan cellpadding=0 cellspacing=0 class=style1><tr><td tabindex=0 id=MainMenuMyDevices class="topbar_td style3x"onmouseup=go(1,event) onkeypress='"Enter"==event.key&&go(1)'>I miei dispositivi<td tabindex=0 id=MainMenuMyAccount class="topbar_td style3x"onmouseup=go(2,event) onkeypress='"Enter"==event.key&&go(2)'>Il mio Account<td tabindex=0 id=MainMenuMyEvents class="topbar_td style3x"onmouseup=go(3,event) onkeypress='"Enter"==event.key&&go(3)'>I miei eventi<td tabindex=0 id=MainMenuMyFiles class="topbar_td style3x"onmouseup=go(5,event) onkeypress='"Enter"==event.key&&go(5)'>I miei file<td tabindex=0 id=MainMenuMyUsers class="topbar_td style3x"onmouseup=go(4,event) onkeypress='"Enter"==event.key&&go(4)'>I miei utenti<td tabindex=0 id=MainMenuMyServer class="topbar_td style3x"onmouseup=go(6,event) onkeypress='"Enter"==event.key&&go(6)'>Il mio server<td class="topbar_td_end style3">&nbsp;</table><div id=MainSubMenuSpan style=display:none><table id=MainSubMenu cellpadding=0 cellspacing=0 class=style1><tr><td tabindex=0 id=MainDev class="topbar_td style3x"onmouseup=go(10,event) onkeypress='"Enter"==event.key&&go(10)'>Generale<td tabindex=0 id=MainDevDesktop class="topbar_td style3x"onmouseup=go(11,event) onkeypress='"Enter"==event.key&&go(11)'>Desktop<td tabindex=0 id=MainDevTerminal class="topbar_td style3x"onmouseup=go(12,event) onkeypress='"Enter"==event.key&&go(12)'>Terminale<td tabindex=0 id=MainDevFiles class="topbar_td style3x"onmouseup=go(13,event) onkeypress='"Enter"==event.key&&go(13)'>File<td tabindex=0 id=MainDevEvents class="topbar_td style3x"onmouseup=go(16,event) onkeypress='"Enter"==event.key&&go(16)'>Eventi<td tabindex=0 id=MainDevInfo class="topbar_td style3x"onmouseup=go(17,event) onkeypress='"Enter"==event.key&&go(17)'>Dettagli<td tabindex=0 id=MainDevAmt class="topbar_td style3x"onmouseup=go(14,event) onkeypress='"Enter"==event.key&&go(14)'>Intel®AMT<td tabindex=0 id=MainDevConsole class="topbar_td style3x"onmouseup=go(15,event) onkeypress='"Enter"==event.key&&go(15)'>Console<td tabindex=0 id=MainDevPlugins class="topbar_td style3x"onmouseup=go(19,event) onkeypress='"Enter"==event.key&&go(19)'>Plugins<td class="topbar_td_end style3">&nbsp;</table></div><div id=MeshSubMenuSpan style=display:none><table id=MeshSubMenu cellpadding=0 cellspacing=0 class=style1><tr><td tabindex=0 id=MeshGeneral class="topbar_td style3x"onmouseup=go(20,event) onkeypress='"Enter"==event.key&&go(20)'>Generale<td tabindex=0 id=MeshSummary class="topbar_td style3x"onmouseup=go(21,event) onkeypress='"Enter"==event.key&&go(21)'>Sommario<td class="topbar_td_end style3">&nbsp;</table></div><div id=EventsSubMenuSpan style=display:none><div id=EventsSubMenu class=style1><div class="row d-flex"><div class="col flex-grow-0 flex-shrink-0"><div tabindex=0 id=EventsLive class="topbar_td style3x"onmouseup=go(3,event) onkeypress='"Enter"==event.key&&go(3)'>Eventi</div></div><div class="col flex-grow-0 flex-shrink-0"><div tabindex=0 id=EventsReport class="topbar_td style3x"onmouseup=go(60,event) onkeypress='"Enter"==event.key&&go(60)'>Rapporti</div></div><div class="col flex-grow-0 flex-shrink-0"><div class=style3>&nbsp;</div></div></div></div></div><div id=UserSubMenuSpan style=display:none><table id=UserSubMenu cellpadding=0 cellspacing=0 class=style1><tr><td tabindex=0 id=UserGeneral class="topbar_td style3x"onmouseup=go(30,event) onkeypress='"Enter"==event.key&&go(30)'>Generale<td tabindex=0 id=UserEvents class="topbar_td style3x"onmouseup=go(31,event) onkeypress='"Enter"==event.key&&go(31)'>Eventi<td class="topbar_td_end style3">&nbsp;</table></div><div id=UsersSubMenuSpan style=display:none><table id=UsersSubMenu cellpadding=0 cellspacing=0 class=style1><tr><td tabindex=0 id=UsersGeneral class="topbar_td style3x"onmouseup=go(4,event) onkeypress='"Enter"==event.key&&go(4)'>Utenti<td tabindex=0 id=UsersGroups class="topbar_td style3x"onmouseup=go(50,event) onkeypress='"Enter"==event.key&&go(50)'>Gruppi<td tabindex=0 id=UsersRecordings class="topbar_td style3x"onmouseup=go(52,event) onkeypress='"Enter"==event.key&&go(52)'>Registrazioni<td class="topbar_td_end style3">&nbsp;</table></div><div id=ServerSubMenuSpan style=display:none><table id=ServerSubMenu cellpadding=0 cellspacing=0 class=style1><tr><td tabindex=0 id=ServerGeneral class="topbar_td style3x"onmouseup=go(6,event) onkeypress='"Enter"==event.key&&go(6)'>Generale<td tabindex=0 id=ServerStats class="topbar_td style3x"onmouseup=go(40,event) onkeypress='"Enter"==event.key&&go(40)'>Stats<td tabindex=0 id=ServerConsole class="topbar_td style3x"onmouseup=go(115,event) onkeypress='"Enter"==event.key&&go(115)'>Console<td tabindex=0 id=ServerTrace class="topbar_td style3x"onmouseup=go(41,event) onkeypress='"Enter"==event.key&&go(41)'>Traccia<td tabindex=0 id=ServerPlugins class="topbar_td style3x"onmouseup=go(42,event) onkeypress='"Enter"==event.key&&go(42)'>Plugins<td class="topbar_td_end style3">&nbsp;</table></div><div id=UserDummyMenuSpan><table id=UserDummyMenu cellpadding=0 cellspacing=0 class=style1><tr><td class=style3>&nbsp;</table></div></div></div></div><div id=column_l class=pt-3><div id=p0 style=display:none><div id=p0message><span id=p0span>Server disconnesso</span>,<href onclick=reload() style=cursor:pointer><u>fare clic per riconnettersi</u></href>.</div></div><div id=p1 style=display:none><div id=p1title class="d-flex justify-content-between align-items-center"><div><h1>I miei dispositivi</h1></div><div style=display:none id=devListToolbarViewIcons><div id=devViewPageState style=float:left;line-height:32px;height:32px;font-size:16px;display:none></div><div tabindex=0 id=devViewPageButton1 class=viewSelector onclick=onDeviceViewPageChange(1) onkeypress='"Enter"==event.key&&onDeviceViewPageChange(1)'title="Go to first page"style=display:none><div class=viewSelector9></div></div><div tabindex=0 id=devViewPageButton2 class=viewSelector onclick=onDeviceViewPageChange(2) onkeypress='"Enter"==event.key&&onDeviceViewPageChange(2)'title="Go to previous page"style=display:none><div class=viewSelector10></div></div><div tabindex=0 id=devViewPageButton3 class=viewSelector onclick=onDeviceViewPageChange(3) onkeypress='"Enter"==event.key&&onDeviceViewPageChange(3)'title="Go to next page"style=display:none><div class=viewSelector11></div></div><div tabindex=0 id=devViewPageButton4 class=viewSelector onclick=onDeviceViewPageChange(4) onkeypress='"Enter"==event.key&&onDeviceViewPageChange(4)'title="Go to last page"style=display:none;margin-right:12px><div class=viewSelector8></div></div><span role=button tabindex=0 id=devViewButton1 class="fa-layers fa-fw fa-xl"onclick=onDeviceViewChange(1) onkeypress='"Enter"==event.key&&onDeviceViewChange(1)'title=Colonne><i class="fa-solid fa-bars"data-fa-transform="shrink-8 right-4 up-2"></i> <i class="fa-solid fa-bars"data-fa-transform="shrink-8 left-4 up-2"></i> <i class="fa-solid fa-bars"data-fa-transform="shrink-8 right-4 down-3"></i> <i class="fa-solid fa-bars"data-fa-transform="shrink-8 left-4 down-3"></i> </span><span role=button tabindex=0 id=devViewButton2 class="fa-layers fa-fw fa-xl"onclick=onDeviceViewChange(2) onkeypress='"Enter"==event.key&&onDeviceViewChange(2)'title=Elenco><i class="fa-solid fa-bars"></i> </span><span role=button tabindex=0 id=devViewButton3 class="fa-layers fa-fw fa-xl"onclick=onDeviceViewChange(3) onkeypress='"Enter"==event.key&&onDeviceViewChange(3)'title=Desktops><i class="fa-solid fa-square"data-fa-transform="shrink-9 up-4 left-4"></i> <i class="fa-solid fa-square"data-fa-transform="shrink-9 up-4 right-4"></i> <i class="fa-solid fa-square"data-fa-transform="shrink-9 down-4 left-4"></i> <i class="fa-solid fa-square"data-fa-transform="shrink-9 down-4 right-4"></i> </span><span role=button tabindex=0 id=devViewButton5 class="fa-layers fa-fw fa-xl"onclick=onDeviceViewChange(5) onkeypress='"Enter"==event.key&&onDeviceViewChange(5)'title=Desktops><i class="fa-solid fa-square"data-fa-transform="shrink-10 up-4 left-6"></i> <i class="fa-solid fa-square"data-fa-transform="shrink-10 up-4 right-1"></i> <i class="fa-solid fa-square"data-fa-transform="shrink-10 up-4 right-5"></i> <i class="fa-solid fa-square"data-fa-transform="shrink-10 down-4 left-1"></i> <i class="fa-solid fa-square"data-fa-transform="shrink-10 down-4 left-5"></i> <i class="fa-solid fa-square"data-fa-transform="shrink-10 down-4 right-6"></i> </span><span role=button tabindex=0 id=devViewButton4 class="fa-layers fa-fw fa-xl"onclick=onDeviceViewChange(4) onkeypress='"Enter"==event.key&&onDeviceViewChange(4)'title="Carta geografica"style=display:none><i class="fa-solid fa-map-location-dot"></i></span></div></div><div id=devListToolbarSpan class="noselect d-flex align-items-center p-1"><div id=devListToolbar class="d-flex align-items-center visually-hidden"><span class="fa-layers fa-fw me-1"role=button style=display:none title="Comprimi tutto"id=CollapseAllButton onclick=cmexpandaction(2)><i class="fa-solid fa-chevron-up"data-fa-transform=down-6></i> <i class="fa-solid fa-chevron-down"data-fa-transform=up-6></i> </span><span class="fa-layers fa-fw me-1"role=button style=display:none title="Espandi tutto"id=ExpandAllButton onclick=cmexpandaction(1)><i class="fa-solid fa-chevron-up"data-fa-transform=up-6></i> <i class="fa-solid fa-chevron-down"data-fa-transform=down-6></i> </span><input type=button class="btn btn-primary me-1 btn-sm"id=SelectAllButton onclick=selectallButtonFunction() value="Seleziona tutto"> <input type=button class="btn btn-primary me-1 btn-sm"id=GroupActionButton disabled value="Azione di gruppo"onclick=groupActionFunction()> <input type=button class="btn btn-primary me-1 btn-sm"id=ScrollToTopButton onclick=onDevicesScroll(!0) value="Scroll To Top"> <input id=SearchInput class="form-control-sm me-1 btn-sm"placeholder=Filtro onchange=onDeviceSearchChanged(event) onclick=onDeviceSearchChanged(event) onkeyup=onDeviceSearchChanged(event) onfocus=onSearchFocus(1) onblur=onSearchFocus(0) title="Filtro: utente:xxx o u:xxx ip:xxx gruppo:xxx o g:xxx tag:xxx o t: xxx atag:xxx o a:xxx os:xxx amt:xxx desc:xxx wsc:ok wsc:noav wsc: noupdate wsc:nofirewall wsc:qualsiasi"> <span id=SearchInputClearButton style=display:none;position:relative><span class="fa-layers fa-fw"role=button onclick=clearDeviceSearch() style=position:absolute;left:-25px;top:-15px><i class="fa-solid fa-circle"style=color:var(--bs-secondary-bg)></i> <i class="fa-solid fa-xmark"style=color:var(--bs-body-color)></i> </span></span><select class="form-select-sm me-1"id=DevFilterSelect onchange=onOnlineCheckBox(event) title="Filtro dispositivo"><option value=0 selected>Tutti<option value=1>in linea<option value=5>Disconnesso<option value=2>sessioni<option value=3>Asteriscata<option value=4>Intel® AMT<option value=6>Aiuto<option value=7>taggato<option value=8>senza tag</select><div class=form-check title="Mostra il nome del sistema operativo dei dispositivi"><input class="form-check-input me-1"type=checkbox id=RealNameCheckBox onclick=onRealNameCheckBox()><label class=form-check-label for=RealNameCheckBox>Nome del sistema operativo</label></div><label style=display:none><input type=checkbox id=OnlineCheckBox class="form-check-input me-2"onclick=onOnlineCheckBox(event)><span title="Mostra solo i dispositivi online">in linea</span></label> <span id=devsCustomUIBar></span></div><div id=kvmListToolbar class="d-flex align-items-center style14 visually-hidden"><span class="fa-layers fa-fw me-1"role=button style=display:none title="Comprimi tutto"id=CollapseAllButton2 onclick=cmexpandaction(2)><i class="fa-solid fa-chevron-up"data-fa-transform=down-6></i> <i class="fa-solid fa-chevron-down"data-fa-transform=up-6></i> </span><span class="fa-layers fa-fw me-1"role=button style=display:none title="Espandi tutto"id=ExpandAllButton2 onclick=cmexpandaction(1)><i class="fa-solid fa-chevron-up"data-fa-transform=up-6></i> <i class="fa-solid fa-chevron-down"data-fa-transform=down-6></i> </span><input type=button class="btn btn-primary me-1 btn-sm"onclick=connectAllKvmFunction() value="Connetti tutto"> <input type=button class="btn btn-primary me-1 btn-sm"onclick=disconnectAllKvmFunction() value="Disconnetti tutto"> <input type=button class="btn btn-primary me-1 btn-sm"onclick=onDevicesScroll(!0) value="Scroll To Top"><div class="form-check me-1"title="Connessione automatica"><input class="form-check-input me-1"type=checkbox id=autoConnectDesktopCheckbox onclick=autoConnectDesktops(event)><label class=form-check-label for=autoConnectDesktopCheckbox>Auto</label></div><input type=button class="btn btn-primary me-1 btn-sm"onclick=showMultiDesktopSettings() value=impostazioni> <input id=KvmSearchInput class="form-control-sm me-1"placeholder=Filtro onchange=onDeviceSearchChanged(event) onclick=onDeviceSearchChanged(event) onkeyup=onDeviceSearchChanged(event) onfocus=onSearchFocus(1) onblur=onSearchFocus(0) title="Filtro: utente:xxx o u:xxx ip:xxx gruppo:xxx o g:xxx tag:xxx o t: xxx atag:xxx o a:xxx os:xxx amt:xxx desc:xxx wsc:ok wsc:noav wsc: noupdate wsc:nofirewall wsc:qualsiasi"> <span id=KvmSearchInputClearButton style=display:none;position:relative><span class="fa-layers fa-fw"role=button onclick=clearDeviceSearch() style=position:absolute;left:-25px;top:-15px><i class="fa-solid fa-circle"style=color:var(--bs-secondary-bg)></i> <i class="fa-solid fa-xmark"style=color:var(--bs-body-color)></i></span></span></div><div id=devMapToolbar class="d-flex align-items-center style14 visually-hidden"><input class="form-control-sm me-1"type=search id=mapSearchLocation placeholder="Cerca posizione"onfocus=onMapSearchFocus(1) onblur=onMapSearchFocus(0)> <input class="btn btn-primary me-1 btn-sm"type=button value=Ricerca title="Cerca la posizione"onclick=getSearchLocation()> <input class="btn btn-primary me-1 btn-sm"type=button id=refreshmap title="Ripristina visualizzazione mappa"value=Ripristina onclick=refreshMap(!1,!0)></div><div class="d-flex align-items-center ms-auto"><div style=display:none id=devListToolbarView>Visualizza <select id=viewselect onchange=onDeviceViewChange()><option value=1>Colonne<option value=2>Elenco<option value=3>Larghezza fissa desktop<option id=viewselectmapoption value=4 style=display:none>Carta geografica<option value=5>Desktops</select></div><div style=display:none id=devListToolbarSize>Dimensione <select id=sizeselect class="form-select-sm me-2"onchange=onDeviceViewChange()><option value=0>Piccolo<option value=1>medio<option value=2>Grande</select> &nbsp;</div><div style=display:none id=devListToolbarSort>Ordinare <select id=sortselect class="form-select-sm me-2"onchange=mainUpdate(6)><option>Gruppo<option>Accensione<option>Dispositivo<option>Tags<option>Tag di gruppo<option>Ultima visualizzazione</select> &nbsp;</div><i class="fa-solid fa-gear"role=button id=devListToolbarSettings onclick=onDeviceViewSettings()></i></div></div><div id=NoMeshesPanel style=display:none><table><tr><td valign=top style=width:50px><img src=images/info.png loading=lazy width=47 height=48><td><div id=getStarted1>Per iniziare, <a href=# onclick="return account_createMesh()"><strong>fare clic qui per creare un gruppo di dispositivi</strong></a>.</div><div id=getStarted2>Nessun gruppo di dispositivi.</div></table></div><div id=xdevices class=noselect style=display:none onscroll=onDevicesScroll(!1)></div><div id=xdevicesmap style=display:none><div id=xmapSearchResultsDlg style=display:none><div id=xmapSearchResultsBck><div id=xmapSearchClose onclick=mapCloseSearchWindow()><b>X</b></div><div style=padding:5px>Risultati della posizione</div><div style=width:100%;margin:6px></div></div><div id=xmapSearchResults style=margin:6px></div></div></div><div id=xmap-info-window></div></div><div id=p2 style=display:none><div id=p2title><h1>Il mio Account</h1></div><div id=p2info style=overflow-y:auto><div id=p2AccountImageFrame><img id=p2AccountImage alt=""loading=lazy width=128 height=128 onclick=account_manageImage(0) src=images/user-256.png><div><a href=# onclick=account_manageImage(0)>Cambia immagine</a></div></div><div id=p2AccountSecurity style=display:none><p><strong>Sicurezza dell 'Account</strong><div style=margin-left:25px><div id=managePhoneNumber1><div class=p2AccountActions><span id=authPhoneNumberCheck><strong>✓</strong></span></div><span><a href=# onclick="return account_managePhone()">Gestisci numero di telefono</a><br></span></div><div id=manageEmail2FA><div class=p2AccountActions><span id=authEmailSetupCheck><strong>✓</strong></span></div><span><a href=# onclick="return account_manageAuthEmail()">Gestisci l'autenticazione e-mail</a><br></span></div><div id=manageAuthApp><div class=p2AccountActions><span id=authAppSetupCheck><strong>✓</strong></span></div><span><a href=# onclick="return account_manageAuthApp()">Gestisci l'app di autenticazione</a><br></span></div><div id=manageDuoApp><div class=p2AccountActions><span id=authDuoSetupCheck><strong>✓</strong></span></div><span><a href=# onclick="return account_manageAuthDuo()">Manage Duo authentication</a><br></span></div><div id=manageHardwareOtp><div class=p2AccountActions><span id=authKeySetupCheck><strong>✓</strong></span></div><span><a href=# onclick="return account_manageHardwareOtp(0)">Gestisci i token di sicurezza</a><br></span></div><div id=managePushAuthDev><div class=p2AccountActions><span id=authPushAuthDevCheck><strong>✓</strong></span></div><span><a href=# onclick="return account_managePushAuthDev()">Gestisci l'autenticazione push</a><br></span></div><div id=manageMessaging1><div class=p2AccountActions><span id=authMessagingCheck><strong>✓</strong></span></div><span><a href=# onclick="return account_manageMessaging()">Manage messaging</a><br></span></div><div id=manageOtp><div class=p2AccountActions><span id=authCodesSetupCheck><strong>✓</strong></span></div><span><a href=# onclick="return account_manageOtp(0)">Gestisci codici di backup</a><br></span></div><div class=p2AccountActions></div><span><a href=# onclick="return account_viewPreviousLogins()">Visualizza accessi precedenti</a><br></span></div></div><div id=p2AccountActions><p><strong>Azioni sull'account</strong><p class=mL><span id=managePhoneNumber2 style=display:none><a href=# onclick="return account_managePhone()">Gestisci numero di telefono</a><br></span><span id=manageMessaging2 style=display:none><a href=# onclick="return account_manageMessaging()">Manage messaging</a><br></span><span id=verifyEmailId style=display:none><a href=# onclick="return account_showVerifyEmail()">Verifica Email</a><br></span><span id=accountEnableNotificationsSpan style=display:none><a href=# onclick="return account_enableNotifications()">Abilita le notifiche web</a><br></span><a href=# onclick="return account_showLocalizationSettings()">Impostazioni di localizzazione</a><br><a href=# onclick="return account_showAccountNotifySettings()">Impostazioni di notifica</a><br><span id=p2AccountPassActions><span id=accountChangeEmailAddressSpan style=display:none><a href=# onclick="return account_showChangeEmail()">Modifica indirizzo e-mail</a><br></span><a href=# onclick="return account_showChangePassword()">Cambia la password</a><span id=p2nextPasswordUpdateTime></span><br><a href=# onclick="return account_showDeleteAccount()">Eliminare l'account</a><br></span><span id=accountCreateLoginTokenSpan style=display:none><a href=# onclick="return account_createLoginToken()">Crea token di accesso</a><br></span><a href=# onclick="return account_showThemesSwitcher()">Switch theme</a><br></p><br style=clear:both></div><div id=p2logintokens></div><strong>Gruppi di dispositivi</strong> <span id=p2createMeshLink1>- <button class="btn btn-primary btn-sm"onclick="return account_createMesh()"><i class="fa-fw fa-solid fa-circle-plus"></i> Nuovo</button></span><br><br><div id=p2meshes></div><div id=p2noMeshFound style=display:none>Nessun gruppo di dispositivi. <span id=p2createMeshLink2><a href=# onclick="return account_createMesh()"><strong>Inizia qui!</strong></a></span></div><br style=clear:both></div></div><div id=p3 style=display:none><div id=p3title><h1>I miei eventi</h1></div><table class=pTable><tr><td class="auto-style1 d-flex justify-content-end p-1"><div class="d-flex align-items-center"><label for=p3filterevents class=me-1>Filtro</label> <select id=p3filterevents class="form-select-sm me-2"onchange=refreshEvents()><option notransval=1 value="">All Logs<option notransval=1 value=agentlog>Agent Logs<option notransval=1 value=relaylog>Relay Logs<option notransval=1 value=manual>Manual Logs<option notransval=1 value=runcommands>Run Command Logs<option notransval=1 value=batchupload>Batch Upload Logs<option notransval=1 value=changenode>Change Node Logs<option notransval=1 value=removenode>Remove Node Logs</select> <label for=p3limitdropdown class=me-1>Mostrare</label> <select id=p3limitdropdown class="form-select-sm me-2"onchange=refreshEvents()><option notransval=1 value=60>Ultimi 60<option notransval=1 value=120>Ultimi 120<option notransval=1 value=250>Ultimi 250<option notransval=1 value=500>Ultimi 500<option notransval=1 value=1000>Ultimi 1000<option notransval=1 value="">Senza limiti</select> <a href=# onclick=p3showDownloadEventsDialog(2)><i class="fa-solid fa-download"title="Scarica eventi"></i></a></div></table><div id=p3events></div></div><div id=p4 style=display:none><div id=p4title><h1>I miei utenti</h1></div><table class=pTable><tr><td class="style14 d-flex align-items-center flex-wrap p-1"><div class="d-flex align-items-center"><input type=button id=UsersSelectAllButton class="btn btn-primary btn-sm me-1"onclick=p3usersSelectallButtonFunction() value="Seleziona tutto"> <input type=button id=UsersGroupActionButton class="btn btn-primary btn-sm me-1"disabled value="Azione di gruppo"onclick=p3usersGroupActionFunction()> <input id=UserNewAccountButton class="btn btn-primary btn-sm me-1"type=button onclick=showCreateNewAccountDialog() value="Nuovo account..."><div class="d-inline-flex align-items-center"><input id=UserSearchInput type=search class="form-control-sm me-1"placeholder=Filtro onchange=onUserSearchInputChanged() onkeyup=onUserSearchInputChanged() autocomplete=off onfocus=onUserSearchFocus(1) onblur=onUserSearchFocus(0)></div></div><div class="d-flex align-items-center ms-auto"><input type=button class="btn btn-primary btn-sm me-2"onclick=showUserBroadcastDialog() style=margin-right:6px value=Trasmissione> <a href=# onclick=p4downloadUserInfo()><i role=button class="fa-solid fa-download me-2"title="Scarica le informazioni dell'utente"></i></a> <a href=# onclick=p4batchAccountCreate()><i role=button id=p4UserBatchCreate style=display:none title="Batch crea molti account utente"class="fa-solid fa-upload me-1"></i></a> <i style=cursor:pointer;margin-top:3px;margin-left:6px id=usersListToolbarSettings class="fa-solid fa-cog"title=impostazioni onclick=onUsersViewSettings()></i></div></table><div id=p3users></div></div><div id=p5 style=display:none><div id=p5title><h1>I miei file</h1></div><table id=p5toolbar class=table cellpadding=0 cellspacing=0><tr><td id=p5filehead valign=bottom class="d-flex align-items-center"><div id=p5rightOfButtons class="d-flex align-items-center"></div><div class="m-1 d-flex align-items-center"><input type=button id=p5FolderUp class="btn btn-primary btn-sm me-1"disabled onclick="return p5folderup()"value=Su> <input type=button id=p5SelectAllButton class="btn btn-primary btn-sm me-1"disabled onclick=p5selectallfile() value="Seleziona tutto"> <input type=button id=p5RenameFileButton class="btn btn-primary btn-sm me-1"disabled value=Rinominare onclick=p5renamefile()> <input type=button id=p5DeleteFileButton class="btn btn-primary btn-sm me-1"disabled value=Elimina onclick=p5deletefile()> <input type=button id=p5ViewFileButton class="btn btn-primary btn-sm me-1"disabled value=modificare onclick=p5viewfile()> <input type=button id=p5NewFolderButton class="btn btn-primary btn-sm me-1"disabled value="Nuova cartella"onclick=p5createfolder()> <input type=button id=p5UploadButton class="btn btn-primary btn-sm me-1"disabled value=Caricare onclick=p5uploadFile()> <input type=button id=p5DownloadButton class="btn btn-primary btn-sm me-1"disabled value=Scarica onclick=p5downloadButton()> <input type=button id=p5CutButton class="btn btn-primary btn-sm me-1"disabled value=Taglia onclick=p5copyFile(1)> <input type=button id=p5CopyButton class="btn btn-primary btn-sm me-1"disabled value=Copia onclick=p5copyFile(0)> <input type=button id=p5PasteButton class="btn btn-primary btn-sm me-1"disabled value=Incolla onclick=p5pasteFile()></div><tr><td id=p5filesubhead class="d-flex align-items-center"><div class="d-flex align-items-center">&nbsp;&nbsp;<span id=p5currentpath></span></div><div style=float:right class="d-flex align-items-center ms-auto"><select id=p5sortdropdown class="form-select-sm me-1"onchange=updateFiles()><option value=1 selected>Ordina per nome<option value=2>Ordina per misura<option value=3>Ordinare per data<option value=4>Scendi per nome<option value=5>Scendi per dimensione<option value=6>Scendi per data</select></div></table><div id=p5filetable><div id=p5PublicShare><div>Questi file sono condivisi pubblicamente, fai clic su "link" per ottenere l'URL pubblico.</div></div><div id=bigok style=display:none><b>✓</b></div><div id=bigfail style=display:none><b>✗</b></div><span id=p5files></span></div><table id=p5toolbarBottom class="table table-hover"style=width:100% cellpadding=0 cellspacing=0><tr><td class=style6>&nbsp;<span id=p5bottomstatus></span></table></div><div id=p6 style=display:none><div id=p6info style=overflow-y:auto><div id=p6title><img id=MainMeshImage src=serverpic.ashx><h1>Il mio server</h1></div><div id=p2ServerActions><p><strong>Azioni del server</strong><div style=margin-left:25px><div id=p2ServerActionsBackup><div class=p2AccountActions><span style=display:none><strong>✓</strong></span></div><a id=p6backuplink href={{{domainurl}}}backup.zip rel="noreferrer noopener"target=_blank>Scarica il backup del server</a></div><div id=p2ServerActionsRestore><div class=p2AccountActions><span style=display:none><strong>✓</strong></span></div><a href=# onclick="return server_showRestoreDlg()">Ripristina server con backup</a></div><div id=p2ServerActionsGoogleBackup style=display:none><div class=p2AccountActions><span id=p2ServerActionsGoogleBackupCheck style=display:none><strong>✓</strong></span></div><span><a href=# onclick="return server_setupGoogleDriveBackup()">Backup di Google Drive</a><br></span></div><div id=p2ServerActionsVersion><div class=p2AccountActions><span style=display:none><strong>✓</strong></span></div><a href=# onclick="return server_showVersionDlg()">Controlla la versione del server</a></div><div id=p2ServerActionsErrors><div class=p2AccountActions><span style=display:none><strong>✓</strong></span></div><a href=# onclick="return server_showErrorsDlg()">Mostra registro errori del server</a></div><div id=p2ServerActionsConfig><div class=p2AccountActions><span style=display:none><strong>✓</strong></span></div><a href=# onclick="return server_showConfigDlg()">Show server configuration</a></div></div><br></div><strong>Statistiche del server</strong><br><br><div id=serverStats><div id=serverCpuChartView style=display:none><div class=chartViewCanvas style=height:40px;text-align:center><canvas id=serverCpuChart style=display:inline-block></canvas></div><div class=chartViewText id=serverCpuChartText></div></div><div id=serverMemoryChartView style=display:none><div class=chartViewCanvas style=height:40px;text-align:center><canvas id=serverMemoryChart style=display:inline-block></canvas></div><div class=chartViewText id=serverMemoryChartText></div></div><br><br><div id=serverStatsTable></div></div><div id=serverWarningsDiv style=display:none><br><strong>Server Warnings</strong><br><br><div id=serverCertWarnings></div><div id=serverWarnings></div></div></div></div><div id=p10 style=display:none><div id=p10title class="d-flex align-items-center"><div id=p10BackButton class=pe-2><i class="fa-solid fa-square-caret-left fa-2xl"role=button tabindex=0 onclick=goBack() title=Indietro onkeypress='"Enter"==event.key&&goBack()'></i></div><div class="fs-4 fw-bold">Generale - <span id=p10deviceName></span></div></div><div id=p10info style=overflow-y:auto class=pt-3><table style=width:100% cellpadding=0 cellspacing=0><tr><td style=width:auto valign=top><div id=p10html></div><td style=width:100px;display:none id=notesPanel valign=top><table><thead><tr><th>Appunti<tbody><tr><td><div id=notesPanelArea style=width:300px;height:200px;resize:none;overflow-y:scroll></div></table><td style=width:20px><td style=width:200px;vertical-align:top;position:relative valign=top><div class=deviceNotifyLargeDot><div id=p10deviceMsg onclick=showDeviceMessages(null,null,event) class=deviceNotifyDotSub></div><i title=Asteriscata role=button class="fa-solid fa-star"id=p10deviceStar onclick=showDeviceSessions(null,null,event) data-fa-transform=shrink-5 data-fa-mask="fa-solid fa-circle"></i> <i title="Elenco delle sessioni remote attive su questo computer."role=button class="fa-solid fa-arrow-right-arrow-left"id=p10deviceNotify onclick=showDeviceSessions(null,null,event) data-fa-transform=shrink-5 data-fa-mask="fa-solid fa-circle"></i> <i title="Aiuto richiesto"role=button class="fa-solid fa-question"id=p10deviceHelp onclick=showDeviceHelpRequests(null,null,event) data-fa-transform=shrink-5 data-fa-mask="fa-solid fa-circle"></i></div><div id=p10deviceBattery class="deviceBatteryLarge deviceBatteryLarge1"></div><a href=# onclick=p10showiconselector()><img id=MainComputerImage></a><div id=MainComputerState></div></table><br><div id=p10html2></div><div id=p10html3></div><div id=p10html4></div><div id=p10html5></div></div></div><div id=p11 class=noselect style=display:none><div id=p11title class="d-flex align-items-center"><div id=p11BackButton class=pe-2><i class="fa-solid fa-2xl fa-square-caret-left"role=button tabindex=0 onclick=goBack() title=Indietro onkeypress='"Enter"==event.key&&goBack()'></i></div><div class="fs-4 fw-bold">Desktop - <span id=p11deviceName></span></div><div id=devListToolbarViewIcons class=ms-auto><i class="fa-solid fa-xl fa-maximize fa-border"role=button onclick=deskToggleFull(event) title="A schermo intero. Tieni premuto il tasto Maiusc alla schermata intera del browser"></i></div></div><div id=p11warning onclick=showFeaturesDlg()><div class=icon2></div><div class=warningbox>La porta di reindirizzamento o la funzione KVM sono disabilitate<span id=p11warninga>, fare clic qui per abilitarlo.</span></div></div><div id=p11warning2 onclick=showPowerActionDlg()><div class=icon2></div><div class=warningbox>Il computer remoto non è acceso, fare clic qui per inviare un comando di alimentazione.</div></div><div style=position:absolute;right:16px;margin-top:-14px;font-size:x-small;color:#000><div id=p11capslock style=display:inline-block;margin-left:1px;border-radius:5px;background-color:#a3ffb8;padding:2px>CAPPUCCI</div><div id=p11scrolllock style=display:inline-block;margin-left:1px;border-radius:5px;background-color:#a3ffb8;padding:2px>SCORRERE</div><div id=p11numlock style=display:inline-block;margin-left:1px;border-radius:5px;background-color:#a3ffb8;padding:2px>NUMERO</div></div><div id=deskarea0 cellpadding=0 cellspacing=0><div id=deskarea1 class="areaHead d-flex flex-wrap"><div class="d-flex align-items-center"><input type=button class="btn btn-primary btn-sm me-1"id=autoconnectbutton1 value="Connessione automatica"onclick=autoConnectDesktop(event) onkeypress=return!1 onkeydown=return!1 style=display:none;margin-right:4px><div class="btn-group dropdown-center me-1"id=connectbutton1span><button type=button class="btn btn btn-primary btn-sm"id=connectbutton1 title="Connettiti utilizzando il desktop remoto MeshAgent"onclick=connectDesktop(event,3) onkeypress=return!1 onkeydown=return!1 disabled>Connetti</button> <button type=button class="btn btn-primary btn-sm dropdown-toggle dropdown-toggle-split"id=connectbutton1d data-bs-toggle=dropdown aria-expanded=false><span class=visually-hidden>Toggle Dropdown</span></button><ul class=dropdown-menu><li><a class=dropdown-item onclick=cmdeskaction(1,event)>Chiedi Consenso + Bar</a><li><a class=dropdown-item onclick=cmdeskaction(2,event)>Chiedi il consenso</a><li><a class=dropdown-item onclick=cmdeskaction(3,event)>Privacy bar</a></ul></div><div class="btn-group dropdown-center me-1"id=connectbutton1rspan><button type=button class="btn btn btn-primary btn-sm"id=connectbutton1r title="Connetti usando RDP"onclick=askRdpCredentials() onkeypress=return!1 onkeydown=return!1 disabled>Connessione RDP</button> <button type=button class="btn btn-primary btn-sm dropdown-toggle dropdown-toggle-split"id=connectbutton1rd data-bs-toggle=dropdown aria-expanded=false><span class=visually-hidden>Toggle Dropdown</span></button><ul class=dropdown-menu><li><a class=dropdown-item onclick=cmaltportaction(1,event)>Porta alternativa</a></ul></div><span id=connectbutton1hspan><button class="btn btn-primary btn-sm me-1"type=button id=connectbutton1h title="Connetti usando hardware KVM"onclick=connectDesktop(event,2) onkeypress=return!1 onkeydown=return!1 disabled>HW Connect</button></span><div class="btn-group dropdown-center me-1"id=disconnectbutton1span><button type=button class="btn btn btn-primary btn-sm"id=disconnectbutton1 title="Connettiti utilizzando il desktop remoto MeshAgent"onclick=connectDesktop(event,0) onkeypress=return!1 onkeydown=return!1>Disconnetti</button> <button type=button class="btn btn-primary btn-sm dropdown-toggle dropdown-toggle-split"id=diconnectbutton1d data-bs-toggle=dropdown aria-expanded=false><span class=visually-hidden>Toggle Dropdown</span></button><ul class=dropdown-menu><li><a class=dropdown-item onclick=cmdeskaction(10,event)>Disconnetti e blocca</a><li><a class=dropdown-item onclick=cmdeskaction(11,event)>Disconnetti</a></ul></div><span id=deskstatus style=line-height:22px>Disconnesso</span><span id=deskmetadata></span></div><div class="d-flex align-items-center ms-auto"><div id=desktopCustomUiButtons style=float:left></div><div id=desktopCustomUpperRight style=float:left;margin-right:6px></div><input type=button class="btn btn-primary btn-sm"title="Modificare lo stato di alimentazione della macchina remota"onkeypress=return!1 onkeydown=return!1 value="Azioni di accensione..."onclick=showPowerActionDlg() style=display:none> <input id=deskActionsBtn type=button class="btn btn-primary btn-sm me-1"title="Esegui azioni di accensione sul dispositivo"onkeypress=return!1 onkeydown=return!1 value=Azioni onclick=deviceActionFunction()> <input id=deskActionsSettings type=button class="btn btn-primary btn-sm me-1"value=impostazioni title="Modifica le impostazioni del desktop remoto"onkeypress=return!1 onkeydown=return!1 onclick=showDesktopSettings()> <input id=deskFocusBtn type=button title="Attiva/disattiva la modalità di messa a fuoco, quando è attiva viene aggiornata solo la regione intorno al mouse"onkeypress=return!1 onkeydown=return!1 value="Tutto a fuoco"onclick=deskToggleFocus() style=margin-right:3px;display:none><div id=deskRecordIcon class=deskareaicon title="Il server sta registrando questa sessione"style=display:none;background-color:red;width:12px;height:12px;border-radius:6px;margin-top:5px></div><div class=deskareaicon title="Ruota a destra"onclick=drotate(1)><i class="fa-solid fa-rotate-right"></i></div><div class=deskareaicon title="Ruota a sinistra"onclick=drotate(-1)><i class="fa-solid fa-rotate-left"></i></div><div class=deskareaicon title="Attiva/disattiva modalità di visualizzazione"onclick=toggleAspectRatio(1)>⇲</div><div id=idx_deskFullBtn2 onclick=deskToggleFull(event) style=float:right>&nbsp;✖</div></div></div><div id=deskarea3x><div id=p11bigok style=display:none><b>✓</b></div><div id=p11bigfail style=display:none><b>✗</b></div><div id=DeskFocus oncontextmenu=return!1 onmousedown=dmousedown(event) onmouseup=dmouseup(event) onmousemove=dmousemove(event)></div><div id=DeskParent><canvas id=Desk width=640 height=480 oncontextmenu=return!1 onmousedown=dmousedown(event) onmouseup=dmouseup(event) onmousemove=dmousemove(event) onmousewheel=dmousewheel(event)></canvas></div><div id=DeskTools><div id=deskToolsAreaTop><a id=DeskToolsRefreshButton class=link-underline-primary style=right:2px onclick=refreshDeskTools()>ricaricare</a><div id=deskToolsTopTabProcess class=deskToolsTopTab onclick=changeDeskToolTab(0) style=left:0;bottom:0>Processi</div><div id=deskToolsTopTabService class=deskToolsTopTab onclick=changeDeskToolTab(1) style=display:none;left:90px;color:gray>Servizi</div></div><div id=deskToolsArea><div id=DeskToolsProcessTab><div id=deskToolsHeader><a class=colmn1 title="Ordina per ID processo"onclick=sortProcess(0)>PID</a> <a class=colmn2 title="Ordina per nome"onclick=sortProcess(1)>Nome</a></div><div id=DeskToolsProcesses></div></div><div id=DeskToolsServiceTab style=display:none><div id=deskToolsServiceHeader><a class=colmn1 style=width:70px title="Ordina per stato"onclick=sortService(0)>Stato</a> <a class=colmn2 title="Ordina per nome"onclick=sortService(1)>Nome</a></div><div id=DeskToolsServices></div></div></div></div><div id=p11DeskConsoleMsg style=display:none;text-align:left;cursor:pointer;position:absolute;left:30px;top:17px;color:#ff0;background-color:rgba(0,0,0,.6);padding:10px;border-radius:5px;text-align:left onclick=p11clearConsoleMsg()></div><div id=p11DeskSessionSelector style=display:none;position:absolute;left:30px;top:17px;right:30px;bottom:17px;overflow-y:auto></div></div><div id=deskarea4 class="areaFoot d-flex flex-wrap"><div class="d-flex align-items-center"><select id=deskkeys class="form-select-sm me-1"cmenu=deskKeyShortcutContextMenu></select> <input id=DeskWD type=button class="btn btn-primary btn-sm me-1"value=Invia onkeypress=return!1 onkeydown=return!1 onclick=deskSendKeys()> <input id=DeskESC style=display:none type=button class="btn btn-primary btn-sm me-1"value=ESC onkeypress=return!1 onkeydown=return!1 onclick=sendDeskEsc()> <input id=DeskClip type=button class="btn btn-primary btn-sm me-1"value=Appunti onkeypress=return!1 onkeydown=return!1 onclick=showDeskClip()> <input id=DeskType class="btn btn-primary btn-sm me-1"cmenu=deskPreConfigShortcutContextMenu type=button value=Digita onkeypress=return!1 onkeydown=return!1 onclick=showDeskType()><div id=DeskControlSpan title="Attiva/disattiva input da mouse e tastiera"class=form-check><input id=DeskControl type=checkbox class=form-check-input onkeypress=return!1 onkeydown=return!1 onclick=toggleKvmControl()><label class=form-check-label for=DeskControl>Ingresso</label></div>&nbsp;</div><div class="d-flex ms-auto align-items-center"><span id=DeskMonitorSelectionSpan></span> <span id=DeskLatency style=width:70px class=text-center title="Latenza della sessione desktop"></span> <span id=DeskTimer style=width:70px class=text-center title="Orario della sessione"></span> <input id=DeskToolsButton type=button class="btn btn-primary btn-sm mx-1"value=Utilità title="Attiva/disattiva vista strumenti"onkeypress=return!1 onkeydown=return!1 onclick=toggleDeskTools()> <span id=DeskGuestShareButton title="Condividi il dispositivo con un ospite"role=button><i class="fa-solid fa-fw fa-share-nodes"id=DeskInputUnLockedButtonImage onclick=showShareDevice()></i> </span><span id=DeskInputUnLockedButton title="L'ingresso remoto è sbloccato"role=button><i class="fa-solid fa-fw fa-keyboard"onclick=deskInputLockFunction(1)></i> </span><span id=DeskInputLockedButton title="L'ingresso remoto è bloccato"role=button><i class="fa-solid fa-fw fa-keyboard"style=color:red onclick=deskInputLockFunction(0)></i> </span><span id=DeskRefreshButton title="Aggiorna il desktop"role=button><i class="fa-solid fa-fw fa-rotate"onclick=deskRefreshFunction()></i> </span><span id=DeskClipboardOutButton title="Carica gli appunti locali sul dispositivo remoto"role=button><i class="fa-solid fa-fw fa-up-long"data-fa-transform="shrink-9 down-4"data-fa-mask="fa-solid fa-clipboard"onclick=deskClipboardOutFunction()></i> </span><span id=DeskClipboardInButton title="Scarica appunti remoti negli appunti locali"style=display:none role=button><i class="fa-solid fa-fw fa-down-long"data-fa-transform="shrink-9 down-4"data-fa-mask="fa-solid fa-clipboard"onclick=deskClipboardInFunction()></i> </span><span id=DeskRecordButton cmenu=deskPlayerContextMenu title="Registra la sessione del desktop remoto su file"style=display:none role=button><i class="fa-solid fa-fw fa-video"onclick=deskRecordSession() id=DeskRecordButtonImage></i> </span><span id=DeskSaveImageButton title="Salva uno screenshot del desktop remoto"role=button><i class="fa-solid fa-fw fa-camera"onclick=deskSaveImage()></i> </span><span id=DeskBackgroundButton title="Attiva/disattiva lo sfondo del desktop remoto"role=button><i class="fa-solid fa-fw fa-image"onclick=deviceToggleBackground(event) id=DeskBackgroundButtonImage></i> </span><span id=DeskOpenWebButton title="Apri un indirizzo web sul computer remoto "role=button><i class="fa-solid fa-fw fa-globe"onclick=deviceUrlFunction()></i> </span><span id=DeskLockButton title="Blocca il computer remoto"role=button><i class="fa-solid fa-fw fa-lock"onclick=deviceLockFunction()></i> </span><span id=DeskNotifyButton title="Visualizza una notifica sul computer remoto"role=button><i class="fa-solid fa-fw fa-bell"onclick=deviceToastFunction()></i> </span><span id=DeskChatButton class=deskarea title="Apri la finestra di chat su questo computer "role=button><i class="fa-solid fa-fw fa-message"onclick=deviceChat(event)></i> </span><span id=DeskRunButton cmenu=deskPreConfigScriptContextMenu class=deskarea title="Run a script on this computer"role=button><i class="fa-solid fa-fw fa-play"onclick=runDeviceCmd()></i></span></div></div></div></div><div id=p12 style=display:none><div id=p12title class="d-flex align-items-center"><div id=p12BackButton class=pe-2><i class="fa-solid fa-square-caret-left fa-2xl"role=button tabindex=0 onclick=goBack() title=Indietro onkeypress='"Enter"==event.key&&goBack()'></i></div><div class="fs-4 fw-bold">Terminale - <span id=p12deviceName></span></div><div id=devListToolbarViewIcons2 class=ms-auto><i class="fa-solid fa-xl fa-maximize fa-border"role=button onclick=deskToggleFull(event) title="A schermo intero. Tieni premuto il tasto Maiusc alla schermata intera del browser"></i></div></div><div id=p12warning onclick=showFeaturesDlg()><div class=icon2></div><div class=warningbox>La porta di reindirizzamento o la funzione KVM sono disabilitate<span id=p12warninga>, fare clic qui per abilitarlo.</span></div></div><div id=p12warning2 onclick=showPowerActionDlg()><div class=icon2></div><div class=warningbox>Il computer remoto non è acceso, fare clic qui per inviare un comando di alimentazione.</div></div><div id=termTable style=position:relative><table style=width:100% cellpadding=0 cellspacing=0><tr><td class="areaHead d-flex flex-wrap"><div class="d-flex align-items-center"><button type=button id=autoconnectbutton2 class="btn btn-primary btn-sm me-1"onclick=autoConnectTerminal(event) onkeypress=return!1 onkeydown=return!1 style=display:none><i class="fa-solid fa-play"></i> Connessione automatica</button><div class="btn-group dropdown-center me-1"id=connectbutton2span><button type=button class="btn btn btn-primary btn-sm"id=connectbutton2 title="Connettiti utilizzando il desktop remoto MeshAgent"onclick=connectTerminal(event,1) onkeypress=return!1 onkeydown=return!1 disabled>Connetti</button> <button type=button class="btn btn-primary btn-sm dropdown-toggle dropdown-toggle-split"id=connectbutton2d data-bs-toggle=dropdown aria-expanded=false onclick=newContextMenu(event,1)><span class=visually-hidden>Toggle Dropdown</span></button><ul class=dropdown-menu><li><a class=dropdown-item onclick=cmtermaction(1,0,event)><b>Console amministrativa</b></a><li><a class=dropdown-item onclick=cmtermaction(6,0,event)>Credenziali di amministratore PowerShell</a><li><a class=dropdown-item onclick=cmtermaction(8,0,event)>Shell utente</a><li><a class=dropdown-item onclick=cmtermaction(9,0,event)>PowerShell Utente</a><li><a class=dropdown-item onclick=cmtermaction(1,16,event)>Chiedi a Shell di amministrazione</a><li><a class=dropdown-item onclick=cmtermaction(6,16,event)>Chiedi all'amministratore PowerShell</a><li><a class=dropdown-item onclick=cmtermaction(8,16,event)>Chiedi a Shell utente</a><li><a class=dropdown-item onclick=cmtermaction(9,16,event)>Chiedi all'utente PowerShell</a><li class=ass><a class=dropdown-item onclick=cmtermaction(8,0,event)><b>Shell utente</b></a><li class=ass><a class=dropdown-item onclick=cmtermaction(9,0,event)>PowerShell Utente</a><li class=lin><a class=dropdown-item onclick=cmtermaction(1,0,event)><b>Root Shell</b></a><li class=lin><a class=dropdown-item onclick=cmtermaction(8,0,event)>Shell utente</a><li class=lin><a class=dropdown-item onclick=cmtermaction(100,0,event)>Shell di accesso</a></ul></div><div class="btn-group dropdown-center me-1"id=connectbutton2sspan><button type=button class="btn btn btn-primary btn-sm"id=connectbutton2s title="Connettiti utilizzando il desktop remoto MeshAgent"onclick=connectTerminal(event,3) onkeypress=return!1 onkeydown=return!1 disabled>Connessione SSH</button> <button type=button class="btn btn-primary btn-sm dropdown-toggle dropdown-toggle-split"id=connectbutton2sd data-bs-toggle=dropdown aria-expanded=false><span class=visually-hidden>Toggle Dropdown</span></button><ul class=dropdown-menu><li><a class=dropdown-item onclick=cmsshportaction(1,event)>Porta alternativa</a></ul></div><span id=connectbutton2hspan><button type=button class="btn btn-primary btn-sm me-1"id=connectbutton2h title="Connettiti utilizzando KVM hardware Intel® AMT"onclick=connectTerminal(event,2) onkeypress=return!1 onkeydown=return!1 disabled>HW Connect</button></span> <span id=disconnectbutton2span><button type=button class="btn btn-primary btn-sm me-1"id=disconnectbutton2 onclick=connectTerminal(event,0) onkeypress=return!1 onkeydown=return!1>Disconnetti</button></span> <span id=termstatus style=line-height:22px>Disconnesso</span><span id=termtitle></span></div><div class="d-flex align-items-center ms-auto"><div id=idx_termFullBtn2 onclick=deskToggleFull(event) style=float:right>&nbsp;✖</div><div id=termRecordIcon class=deskareaicon title="Il server sta registrando questa sessione"style=display:none;background-color:red;width:12px;height:12px;border-radius:6px;margin-top:5px;margin-left:5px></div><input id=termActionsBtn type=button title="Esegui azioni di accensione sul dispositivo"onkeypress=return!1 onkeydown=return!1 value=Azioni class="btn btn-primary me-1 btn-sm"onclick=deviceActionFunction()><div id=terminalCustomUpperRight style=float:left;margin-right:6px></div><div id=terminalCustomUiButtons style=float:left></div></div><tr><td id=termarea3x><div id=termarea3xdiv style=width:100%;height:100%;text-align:left></div><pre id=Term></pre><tr><td class="areaFoot d-flex flex-wrap"><div class="d-flex align-items-center"><input type=button onkeypress=return!1 onkeydown=return!1 class="btn btn-primary btn-sm me-1"id=ctrlcbutton value=Ctl-C onclick='termSendKey(3,"ctrlcbutton")'> <input type=button onkeypress=return!1 onkeydown=return!1 class="btn btn-primary btn-sm me-1"id=ctrlxbutton value=Ctl-X onclick='termSendKey(24,"ctrlxbutton")'> <input type=button onkeypress=return!1 onkeydown=return!1 class="btn btn-primary me-1 btn-sm"id=escbutton value=ESC onclick='termSendKey(27,"escbutton")'> <input type=button onkeypress=return!1 onkeydown=return!1 class="btn btn-primary me-1 btn-sm"id=bsbutton value="Tornare  indietro"onclick='termSendKey(8,"bsbutton")'style=display:none> <input type=button onkeypress=return!1 onkeydown=return!1 class="btn btn-primary me-1 btn-sm"id=pastebutton value=Incolla title="Incolla il testo nel terminale"onclick=showTermPasteDialog() style=display:none></div><div class="d-flex align-items-center ms-auto"><span id=TermTimer title="Orario della sessione"></span>&nbsp; <span id=terminalSettingsButtons style=display:none><input id=id_tcrbutton type=button onkeypress=return!1 onkeydown=return!1 class="btn btn-primary me-1 btn-sm"value=CR+LF title="Attiva/disattiva ciò che invierà la chiave di ritorno"onclick=termToggleCr()> <input id=id_tfxkeysbutton type=button onkeypress=return!1 onkeydown=return!1 class="btn btn-primary me-1 btn-sm"value="Intel (F10 = ESC + [OM)"title="Commuta il tipo di emulazione dei tasti da F1 a F10"onclick=termToggleFx()> <input id=id_ttypebutton type=button onkeypress=return!1 onkeydown=return!1 class="btn btn-primary me-1 btn-sm"value="Ascii esteso"title="Attiva/disattiva il tipo di emulazione di terminale"onclick=termToggleType()> </span><span id=terminalSizeDropDown style=display:none><select id=termSizeList onkeypress=return!1 class="form-select-sm me-1"><option value=1>80x25<option value=2>100x30</select> </span><select id=specialkeylist class="form-select-sm me-1"onkeypress=return!1></select> <input id=specialkeylistinput type=button onkeypress=return!1 class="btn btn-primary btn-sm me-1"value=Invia title="Invia la chiave speciale selezionata"onclick=sendSpecialKey()></div></table><div id=p12TermConsoleMsg style=display:none;text-align:left;cursor:pointer;position:absolute;left:30px;top:45px;color:#ff0;background-color:rgba(0,0,0,.6);padding:10px;border-radius:5px onclick=p12clearConsoleMsg()></div></div></div><div id=p13 style=display:none><div id=p13title class="d-flex align-items-center"><div id=p13BackButton class=pe-2><i class="fa-solid fa-square-caret-left fa-2xl"role=button tabindex=0 onclick=goBack() title=Indietro onkeypress='"Enter"==event.key&&goBack()'></i></div><div class="fs-4 fw-bold">File - <span id=p13deviceName></span></div></div><table id=p13toolbar cellpadding=0 cellspacing=0><tr><td class="areaHead d-flex flex-wrap"><div class="d-flex align-items-center"><button id=p13AutoConnect onclick=autoConnectFiles(event) class="btn btn-primary btn-sm me-1"type=button style=display:none><i class="fa-solid fa-play"></i> Connessione automatica</button><div class="btn-group dropdown-center me-1"id=p13Connectspan><button type=button class="btn btn btn-primary btn-sm"id=p13Connect title="Connettiti utilizzando il desktop remoto MeshAgent"onclick=connectFiles(event,1) onkeypress=return!1 onkeydown=return!1 disabled>Connetti</button> <button type=button class="btn btn-primary btn-sm dropdown-toggle dropdown-toggle-split"id=p13Connectdrop data-bs-toggle=dropdown aria-expanded=false><span class=visually-hidden>Toggle Dropdown</span></button><ul class=dropdown-menu><li><a class=dropdown-item onclick=cmconnectfilesaction()>Chiedi il consenso</a></ul></div><button id=p13Disconnect class="btn btn-primary btn-sm me-1"onclick=connectFiles(event) type=button>Disconnetti</button><div class="btn-group dropdown-center me-1"id=p13Connectsspan><button type=button class="btn btn btn-primary btn-sm"id=p13Connects title="Connettiti utilizzando il desktop remoto MeshAgent"onclick=connectFiles(event,2) onkeypress=return!1 onkeydown=return!1 disabled>Connessione SFTP</button> <button type=button class="btn btn-primary btn-sm dropdown-toggle dropdown-toggle-split"id=p13Connectsdrop data-bs-toggle=dropdown aria-expanded=false><span class=visually-hidden>Toggle Dropdown</span></button><ul class=dropdown-menu><li><a class=dropdown-item onclick=cmsshportaction(1,event)>Porta alternativa</a></ul></div><span id=p13Status>Disconnesso</span></div><div class="d-flex align-items-center ms-auto"><input id=filesActionsBtn class="btn btn-primary me-1 btn-sm"type=button title="Esegui azioni di accensione sul dispositivo"value=Azioni onclick=deviceActionFunction()><div id=filesRecordIcon class=deskareaicon title="Il server sta registrando questa sessione"style=display:none;background-color:red;width:12px;height:12px;border-radius:6px;margin-top:5px;margin-left:5px></div><div id=filesCustomUpperRight style=float:left;margin-right:6px></div><div id=filesCustomUiButtons style=float:left></div></div><tr><td class="areaHead2 d-flex align-items-center flex-wrap"valign=bottom><div id=p13rightOfButtons class="toright2 d-flex align-items-center"></div><div class="d-flex align-items-center"><input type=button disabled id=p13FolderUp class="btn btn-primary me-1 btn-sm"value=Su onclick=p13folderup()> <input type=button disabled id=p13SelectAllButton class="btn btn-primary me-1 btn-sm"value="Seleziona tutto"onclick=p13selectallfile()> <input type=button disabled id=p13RenameFileButton class="btn btn-primary me-1 btn-sm"value=Rinominare onclick=p13renamefile()> <input type=button disabled id=p13DeleteFileButton class="btn btn-primary me-1 btn-sm"value=Elimina onclick=p13deletefile()> <input type=button disabled id=p13ViewFileButton class="btn btn-primary me-1 btn-sm"value=modificare onclick=p13viewfile()> <input type=button disabled id=p13NewFolderButton class="btn btn-primary me-1 btn-sm"value="Nuova cartella"onclick=p13createfolder()> <input type=button disabled id=p13UploadButton class="btn btn-primary me-1 btn-sm"value=Caricare onclick=p13uploadFile()> <input type=button disabled id=p13DownloadButton class="btn btn-primary me-1 btn-sm"value=Scarica onclick=p13downloadButton()> <input type=button disabled id=p13CutButton class="btn btn-primary me-1 btn-sm"value=Taglia onclick=p13copyFile(1)> <input type=button disabled id=p13CopyButton class="btn btn-primary me-1 btn-sm"value=Copia onclick=p13copyFile(0)> <input type=button disabled id=p13PasteButton class="btn btn-primary me-1 btn-sm"value=Incolla onclick=p13pasteFile()> <input type=button disabled id=p13ZipButton class="btn btn-primary me-1 btn-sm"value=Zip onclick=p13zipFiles()> <input type=button disabled id=p13UnzipButton class="btn btn-primary me-1 btn-sm"value=Unzip onclick=p13unzipFile()> <input type=button disabled id=p13RefreshButton class="btn btn-primary me-1 btn-sm"value=ricaricare onclick=p13folderup(9999)> <input type=button disabled id=p13FindButton class="btn btn-primary me-1 btn-sm"value=Trova onclick=p13findfile()> <input type=button disabled id=p13GoToFolderButton class="btn btn-primary me-1 btn-sm"value=GoTo onclick=p13gotofolder()> <input type=button disabled id=p13OpenButton class="btn btn-primary me-1 btn-sm"value=Open onclick=p13openfilefolder()></div><tr><td class=areaHead3><div class=toright2><select id=p13sizedropdown class="form-select-sm me-2"onchange=p13updateFiles()><option value=0 selected>Human Readable<option value=1 title=Bytes>Bytes<option value=10 title=KB>Kilobytes<option value=20 title=MB>Megabyte<option value=30 title=GB>Gigabyte</select> <select id=p13sortdropdown class="form-select-sm me-2"onchange=p13updateFiles()><option value=1 selected>Ordina per nome<option value=2>Ordina per misura<option value=3>Ordinare per data<option value=4>Scendi per nome<option value=5>Scendi per dimensione<option value=6>Scendi per data</select></div><div>&nbsp;&nbsp;<span id=p13currentpath></span></div></table><div id=p13FilesConsoleMsg style=display:none;text-align:left;cursor:pointer;position:absolute;left:30px;top:165px;color:#ff0;background-color:rgba(0,0,0,.6);padding:10px;border-radius:5px onclick=p13clearConsoleMsg()></div><div id=p13filetable><div id=p13bigok style=display:none><b>✓</b></div><div id=p13bigfail style=display:none><b>✗</b></div><span id=p13files></span></div><table id=p13toolbarBottom cellpadding=0 cellspacing=0><tr><td class=style6>&nbsp;<span id=p13bottomstatus></span></table></div><div id=p14 style=display:none><div id=p14title class="d-flex align-items-center"><div id=p14BackButton class=pe-2><i class="fa-solid fa-square-caret-left fa-2xl"role=button tabindex=0 onclick=goBack() title=Indietro onkeypress='"Enter"==event.key&&goBack()'></i></div><div class="fs-4 fw-bold"><span id=p14deviceNamePrefix>Intel® AMT</span> - <span id=p14deviceName></span></div><div id=devListToolbarViewIcons class=ms-auto><i class="fa-solid fa-xl fa-maximize fa-border"role=button onclick=deskToggleFull(event) title="A schermo intero. Tieni premuto il tasto Maiusc alla schermata intera del browser"></i></div></div><iframe id=p14iframe src={{{domainurl}}}commander.ashx></iframe></div><div id=p15 style=display:none><div id=p15title class="d-flex align-items-center"><div id=p15BackButton class=pe-2><i class="fa-solid fa-square-caret-left fa-2xl"role=button tabindex=0 onclick=goBack() title=Indietro onkeypress='"Enter"==event.key&&goBack()'></i></div><div class="fs-4 fw-bold"><span id=p15deviceName></span></div></div><table id=consoleTable cellpadding=0 cellspacing=0><tr><td class="areaHead d-flex flex-wrap"><div id=p15statetext class="d-flex align-items-center"></div><div class="d-flex align-items-center ms-auto"><div id=p15coreName class=me-1 title="Informazioni sul core corrente in esecuzione su questo agente"></div><input type=button id=p15uploadCore class="btn btn-primary me-1 btn-sm"value="Azione dell'agente"onclick=p15uploadCore(event) title="Modificare il modulo del codice Java Script dell'agente"> <i onclick=p15downloadConsoleText() title="Scarica il testo della console"class="fa-solid fa-download me-1"></i></div><tr><td><div class=areaProgress><div id=consoleprogressbar></div></div><tr><td id=p15agentConsole><pre id=p15agentConsoleText></pre><tr><td class=areaFoot><table style=width:100%><tr><td style=width:99%><input id=p15consoleText class=form-control onkeyup=p15consoleSend(event) onfocus=onConsoleFocus(1) onblur=onConsoleFocus(0)><td>&nbsp;<td id=p15outputselecttd><select id=p15outputselect onchange=setupConsole()><option id=p15outputselect1 value=1>Agente<option id=p15outputselect3 value=3>Spingere<option id=p15outputselect2 value=2>MQTT</select><td style=width:1%><input id=id_p15consoleClear type=button class="btn btn-primary bottombutton"value=Pulire onclick=p15consoleClear()></table></table></div><div id=p16 style=display:none><div id=p16title class="d-flex align-items-center"><div id=p16BackButton class=pe-2><i class="fa-solid fa-square-caret-left fa-2xl"role=button tabindex=0 onclick=goBack() title=Indietro onkeypress='"Enter"==event.key&&goBack()'></i></div><div class="fs-4 fw-bold">Eventi - <span id=p16deviceName></span></div></div><table class=pTable><tr><td class="auto-style1 d-flex justify-content-end p-1"><div class="d-flex align-items-center"><label class=me-1 for=p16filterevents>Filtro</label> <select id=p16filterevents class="form-control-sm me-2"onchange=refreshDeviceEvents()><option notransval=1 value="">All Logs<option notransval=1 value=agentlog>Agent Logs<option notransval=1 value=relaylog>Relay Logs<option notransval=1 value=manual>Manual Logs<option notransval=1 value=runcommands>Run Command Logs<option notransval=1 value=batchupload>Batch Upload Logs<option notransval=1 value=changenode>Change Node Logs<option notransval=1 value=removenode>Remove Node Logs</select> <label class=me-1 for=p16limitdropdown>Mostrare</label> <select id=p16limitdropdown class="form-control-sm me-2"onchange=refreshDeviceEvents()><option notransval=1 value=60>Ultimi 60<option notransval=1 value=120>Ultimi 120<option notransval=1 value=250>Ultimi 250<option notransval=1 value=500>Ultimi 500<option notransval=1 value=1000>Ultimi 1000</select> <i onclick=p3showDownloadEventsDialog(1) class="fa-solid fa-download"title="Scarica eventi"style=cursor:pointer></i></div></table><div id=p16events></div></div><div id=p17 style=display:none><div id=p17title class="d-flex align-items-center"><div id=p17BackButton class=pe-2><i class="fa-solid fa-square-caret-left fa-2xl"role=button tabindex=0 onclick=goBack() title=Indietro onkeypress='"Enter"==event.key&&goBack()'></i></div><div class="fs-4 fw-bold">Dettagli - <span id=p17deviceName></span></div><div id=devListToolbarViewIcons3 class=ms-auto><i class="fa-solid fa-chart-line fa-xl fa-border"role=button onclick=deskToggleCpuGraph(event) title="Mostra la CPU del dispositivo e l'utilizzo della memoria."></i></div></div><div id=p17info class="ps-0 pb-5 overflow-y-auto container-fluid"><div id=p17graph style=width:100%><table style=width:100%><tr><td style=width:64px;vertical-align:top><img src=images/details/graph64.png border=0 width=64><td><div class=DevSt style=margin-bottom:3px;margin-left:16px><b>Grafico in tempo reale</b></div><div style="margin-bottom:10px;margin-left:16px;height:240px;width:calc(100% - 16px);position:relative"><canvas id=deviceDetailsStats style=position:absolute;top:0;left:0;right:0;bottom:0></canvas></div><div id=extraGraphValues style=display:none;margin-left:30px;margin-bottom:15px></div></table></div><div id=p17info2></div></div></div><div id=p19 style=display:none><div id=p19title><div id=p19BackButton style=float:left><div class=backButton tabindex=0 onclick=goBack() title=Indietro onkeypress='"Enter"==event.key&&goBack()'><div class=backButtonEx></div></div></div><h1>Plugin - <span id=p19deviceName></span></h1></div><div id=p19headers></div><div id=p19pages></div></div><div id=p20 style=display:none><div id=p20main style=overflow-y:auto><div id=p20title class="d-flex align-items-center"><div id=p20BackButton class=pe-2><i class="fa-solid fa-square-caret-left fa-2xl"role=button tabindex=0 onclick=goBack() title=Indietro onkeypress='"Enter"==event.key&&goBack()'></i></div><div class="fs-4 fw-bold">Generale - <span id=p20meshName></span></div></div><picture id=MainMeshImage style=border-width:0;height:200px;width:200px;float:right><source type=image/webp width=200 height=200 srcset=images/webp/mesh-256.webp><img alt=""width=200 height=200 src=images/mesh-256.png></picture><p id=p20info><p id=p20info2></div></div><div id=p21 style=display:none><div id=p21title class="d-flex align-items-center"><div id=p21BackButton class=pe-2><i class="fa-solid fa-square-caret-left fa-2xl"role=button tabindex=0 onclick=goBack() title=Indietro onkeypress='"Enter"==event.key&&goBack()'></i></div><div class="fs-4 fw-bold">Sommario - <span id=p21meshName></span></div></div><div id=p21main style=overflow-y:auto><div style=width:100%><div style=display:table;width:93%><div id=meshPowerChartDiv style=width:23%;display:inline-block;text-align:center;max-width:250px><div style=margin:10px;font-size:16px>Stati di alimentazione</div><canvas id=meshPowerChart style=width:250px;height:250px></canvas></div><div id=meshOsChartDiv style=width:23%;display:inline-block;text-align:center;max-width:250px><div style=margin:10px;font-size:16px>Tipi di agente</div><canvas id=meshOsChart style=width:250px;height:250px></canvas></div><div id=meshConnChartDiv style=width:23%;display:inline-block;text-align:center;max-width:250px><div style=margin:10px;font-size:16px>Connettività</div><canvas id=meshConnChart style=width:250px;height:250px></canvas></div><div id=meshSecurityChartDiv style=width:23%;display:inline-block;text-align:center;max-width:250px><div style=margin:10px;font-size:16px>Sicurezza</div><canvas id=meshSecurityChart style=width:250px;height:250px></canvas></div></div></div><p id=p21info style=overflow-y:auto></div></div><div id=p30 style=display:none><div id=p30title class="d-flex align-items-center"><div id=p30BackButton class=pe-2><i class="fa-solid fa-square-caret-left fa-2xl"role=button tabindex=0 onclick=goBack() title=Indietro onkeypress='"Enter"==event.key&&goBack()'></i></div><div class="fs-4 fw-bold">Generale - <span id=p30userName></span></div></div><div id=p30info style=overflow-y:auto><div class=row><div class=col><div id=p30html></div></div><div class=col-auto style=width:20px></div><div class=col-auto style=width:200px;position:relative><img id=p30userAuthServiceLogo loading=lazy style=display:none class=userAuthStrategyLogo width=64 height=64><picture id=MainUserImage style=display:none;border-width:0;height:200px;width:200px;float:right onclick=account_manageImage(1)><source type=image/webp width=200 height=200 srcset=images/webp/user-256.webp><img alt=""width=200 height=200 src=images/user-256.png></picture><img id=MainUserImageEx alt=""width=200 height=200 src=images/user-256.png onclick=account_manageImage(1)><div style=width:100%;text-align:center><strong><span id=MainUserState></span></strong></div></div></div><br><div id=p30html2></div><div id=p30html3></div></div></div><div id=p31 style=display:none><div id=p31title class="d-flex align-items-center"><div id=p31BackButton class=pe-2><i class="fa-solid fa-square-caret-left fa-2xl"role=button tabindex=0 onclick=goBack() title=Indietro onkeypress='"Enter"==event.key&&goBack()'></i></div><div class="fs-4 fw-bold">Eventi - <span id=p31userName></span></div></div>{{!-- --}} {{!-- --}}<table class=pTable><tr><td class=h1><td class="auto-style1 d-flex justify-content-end p-1"><div class="d-flex align-items-center"><label for=p31filterevents class=me-1>Filtro</label> <select id=p31filterevents class="form-select-sm me-2"onchange=refreshUsersEvents()><option notransval=1 value="">All Logs<option notransval=1 value=agentlog>Agent Logs<option notransval=1 value=relaylog>Relay Logs<option notransval=1 value=manual>Manual Logs<option notransval=1 value=runcommands>Run Command Logs<option notransval=1 value=batchupload>Batch Upload Logs<option notransval=1 value=changenode>Change Node Logs<option notransval=1 value=removenode>Remove Node Logs</select> <label for=p31limitdropdown class=me-1>Mostrare</label> <select id=p31limitdropdown class="form-select-sm me-2"onchange=refreshUsersEvents()><option notransval=1 value=60>Ultimi 60<option notransval=1 value=120>Ultimi 120<option notransval=1 value=250>Ultimi 250<option notransval=1 value=500>Ultimi 500<option notransval=1 value=1000>Ultimi 1000<option notransval=1 value="">Senza limiti</select> <a href=# onclick=p3showDownloadEventsDialog(3)><i class="fa-solid fa-download"role=button title="Scarica eventi"></i></a></div><td class=h2></table><div id=p31events></div></div><div id=p40 style=display:none><div id=p40title><h1>Statistiche del mio server</h1></div><div class="areaHead d-flex align-items-center flex-wrap p-1"><div class="d-flex align-items-center"><input value=ricaricare type=button class="btn btn-primary btn-sm me-2"onclick=refreshServerTimelineStats()><div class=form-check><input class="form-check-input me-1"type=checkbox id=p40log onclick=updateServerTimelineHours()><label class=form-check-label for=p40log>Log-X</label></div></div><div class="toright2 d-flex align-items-center ms-auto"><select id=p40server style=display:none onchange=updateServerTimelineStats()></select> <select id=p40type class="form-select-sm me-1"onchange=updateServerTimelineStats()><option value=0>Connessioni<option value=1>Memoria<option value=5>CPU<option value=3>Traffico in entrata<option value=4>Traffico in uscita</select> <select id=p40time class="form-select-sm me-1"onchange=updateServerTimelineHours()><option value=3>Ultime 3 ore<option value=8>Ultime 8 ore<option value=24>Ultimo giorno<option value=168>La settimana scorsa<option value=720>Ultimi 30 giorni</select> <i class="fa-solid fa-download"title="Scarica punti dati (.csv)"style=cursor:pointer onclick=p40downloadEvents()></i></div></div><canvas id=serverMainStats></canvas></div><div id=p41 style=display:none><div id=p41title><h1>Traccia del mio server</h1></div><div class="areaHead d-flex align-items-center flex-wrap p-1"><div class="d-flex align-items-center"><input value=Tracciamento type=button class="btn btn-primary btn-sm me-1"onclick=setServerTracing()> <span id=p41traceStatus>Nessuna</span></div><div class="toright2 d-flex align-items-center ms-auto"><label for=p41limitdropdown class=me-1>Mostrare</label> <select id=p41limitdropdown class="form-select-sm me-1"onchange=displayServerTrace()><option value=100>Ultimi 100<option value=250>Ultimi 250<option value=500>Ultimi 500<option value=1000>Ultimi 1000</select> <input value=Pulire type=button class="btn btn-primary btn-sm me-1"onclick=clearServerTracing()> <i class="fa-solid fa-download"title="Scarica traccia (.csv)"style=cursor:pointer onclick=p41downloadServerTrace()></i></div></div><div id=p41events></div></div><div id=p42 style=display:none><h1>Plugin del mio server</h1><div class=areaHead><div class=toright2></div><div><input value="Scarica il plugin"type=button onclick="return pluginHandler.addPluginDlg()"></div></div><div id=pluginRestartNotice class=areaHead style=background-color:gold;display:none><div class=toright2><input value="Aggiorna i nuclei dell'agente"type=button onclick="return distributeCore(),!1"></div><div style=padding:2px><div style=padding:2px><b>Avviso:</b> I plugin sono stati modificati, questo potrebbe richiedere l'aggiornamento del core dell'agente.</div></div></div><table id=p42tbl><tr class=DevSt><th style=width:26px><th style=width:10px><th class=chName>Nome<th class=chDescription>Descrizione<th class=chSite style=text-align:center>Collegamento<th class=chVersion style=text-align:center>Versione<th class=chUpgradeAvail style=text-align:center>Ultimo<th class=chStatus style=text-align:center>Stato<th class=chAction style=text-align:center>Azione<th style=width:10px></table><div id=pluginNoneNotice style=width:100%;text-align:center;padding-top:10px;display:none><i>Nessun plugin sul server.</i></div></div><div id=p43 style=display:none><div id=p43BackButton><div class=backButton tabindex=0 onmouseup=go(42) title=Indietro onkeypress='"Enter"==event.key&&go(42)'><div class=backButtonEx></div></div></div><h1>Plugin del mio server - <span id=p43title></span></h1><iframe id=p43iframe frameborder=0 style="width:100%;height:calc(100vh - 245px);max-height:calc(100vh - 245px)"></iframe></div><div id=p50 style=display:none><div id=p50title><h1>I miei gruppi di utenti</h1></div><table class=pTable><tr><td class="style14 d-flex align-items-center flex-wrap p-1"><div id=p50userGroupOps class="d-flex align-items-center"><input type=button id=UsersGroupsSelectAllButton class="btn btn-primary btn-sm me-1"onclick=p50usersSelectallButtonFunction() value="Seleziona tutto"> <input type=button id=UsersGroupsGroupActionButton class="btn btn-primary btn-sm me-1"disabled value="Azione di gruppo"onclick=p50usersGroupActionFunction()> <input id=NewUserGroupButton type=button class="btn btn-primary btn-sm me-1"onclick=showCreateUserGroupDialog(1) value="Nuovo gruppo... "> <input id=DuplicateUserGroupButton type=button class="btn btn-primary btn-sm me-1"style=display:none onclick=showCreateUserGroupDialog(2) value="Duplica gruppo ..."></div></table><div id=p50groups></div></div><div id=p51 style=display:none><div id=p51title class="d-flex align-items-center"><div id=p51BackButton class=pe-2><i class="fa-solid fa-square-caret-left fa-2xl"role=button tabindex=0 onclick=goBack() title=Indietro onkeypress='"Enter"==event.key&&goBack()'></i></div><div class="fs-4 fw-bold">Gruppo di utenti - <span id=p51groupName></span></div></div><div id=p51info style=overflow-y:auto><div class=row><div class=col><div id=p51group></div></div><div class=col-auto style=width:20px></div><div class=col-auto style=width:200px><picture id=MainUserImage style=border-width:0;height:200px;width:200px;float:right><source type=image/webp width=200 height=200 srcset=images/webp/group-256.webp><img alt=""width=200 height=200 src=images/group-256.png></picture><div style=width:100%;text-align:center><strong><span id=MainUserState></span></strong></div></div></div><div id=p51group2></div><br></div></div><div id=p52 style=display:none><div id=p52title><h1>Le mie registrazioni utente</h1></div><table class=pTable><tr><td class="style14 d-flex align-items-center flex-wrap p-1"><div class="d-flex align-items-center"><input type=button class="btn btn-primary btn-sm"onclick=refreshRecodings() value=ricaricare></div><div class="d-flex align-items-center ms-auto"><input type=button class="btn btn-primary btn-sm"onclick=openRecodringPlayer() value="Apri il lettore..."></div></table><div id=p52recordings style=overflow-y:auto></div></div><div id=p60 style=display:none><div id=p60title><h1>I miei rapporti</h1></div>{{!-- --}} {{!-- --}}<table class=pTable><tr><td class=h1><td class=style14><div style=float:right;line-height:22px><a id=p60downloadReportDiv style=display:none href=# onclick=p60downloadReport()><i class="fa-solid fa-download"title="Scarica rapporto"></i></a>&nbsp;</div><div><button class="btn btn-primary btn-sm me-2 m-1"onclick=generateReportDialog()><i class="fa-regular fa-file-alt"></i> Genera rapporto...</button></div><td class=h2></table><div id=p60report style=overflow-y:auto></div></div><br id=column_l_bottomgap></div><div id=footer><div class=footer1>{{{footer}}}</div><div class=footer2 style=display:none><div class=row><div class="col-md-6 d-flex gap-2"></div><div class=col-md-6><a id=verifyEmailId2 style=display:none href=# onclick=account_showVerifyEmail()>Verifica Email</a> &nbsp;<a id=termsLinkFooter href=terms>Termini e privacy</a></div></div></div></div><div class="modal fade"id=xxAddAgentModal tabindex=-1 aria-hidden=true><div class="modal-dialog modal-dialog-centered"id=xxAddAgentModalConf><div class=modal-content><div class=modal-header id=dialogHeader><h5 class="modal-title text-white"id=xxAddAgentTitle></h5><button type=button class=btn-close data-bs-dismiss=modal aria-label=Close></button></div><div class=modal-body id=xxAddAgentBody><div id=dialog1><div id=id_dialogMessage></div></div><div id=dialog2><div id=id_dialogOptions></div></div><div id=dialog3><div id=d3upload><div>Selezione dei file</div><select id=d3uploadMode onchange=d3modechange()><option value=1>Caricamento file locale<option value=2>Selezione del file del server</select></div><div id=d3localmode style=display:none><div>Caricare un file</div><form id=d3localmodeform method=post enctype=multipart/form-data action=uploadfile.ashx target=fileUploadFrame><input id=d3auth name=auth style=display:none> <input id=d3filter name=filter style=display:none> <input id=d3attrib name=attrib style=display:none> <input type=file id=d3localFile name=files onchange=d3setActions()> <input type=submit id=d3submit style=display:none></form></div><div id=d3servermode><div id=d3serveraction valign=bottom><input type=button id=p3FolderUp disabled onclick=d3folderup() value=Su>&nbsp;<span id=p3CurrentFolder></span></div><div id=d3serverfiles></div></div></div><div id=dialog4><input id=d4WrapButton class="btn btn-primary me-1 mb-1"type=button value="Avvolgere "onclick=d4ToggleWrap()> <input id=d4SizeButton class="btn btn-primary me-1 mb-1"type=button value=Piccolo onclick=d4ToggleSize()> <input id=d4EncodingButton class="btn btn-primary me-1 mb-1"type=button value=Crudo onclick=d4ToggleEncoding()> <input id=d4LineBreakButton class="btn btn-primary me-1 mb-1"type=button value=Windows onclick=d4ToggleLineBreak()> <textarea id=d4editorarea autocomplete=off style="height:calc(100vh - 286px);width:100%;overflow:scroll;resize:none;white-space:pre"></textarea></div><div id=dialog7><div class=dtab><button id=td7meshkvm class=tablinks onclick='changeDesktopSettingsTab(event,"d7meshkvm")'>Agente</button> <button id=td7rdpkvm class=tablinks onclick='changeDesktopSettingsTab(event,"d7rdpkvm")'>RDP</button> <button id=td7amtkvm class=tablinks onclick='changeDesktopSettingsTab(event,"d7amtkvm")'>Intel® AMT</button></div><div id=d7meshkvm class=tabcontent><div style=margin-top:8px><div>Qualità</div><select id=d7bitmapquality dir=rtl></select></div><div><div>Ridimensionamento</div><select id=d7bitmapscaling dir=rtl><option selected value=1024>100%<option value=896>87.5%<option value=768>75%<option value=640>62.5%<option value=512>50%<option value=384>37.5%<option value=256>25%<option value=128>12.5%</select></div><div><div>Frequenza dei fotogrammi</div><select id=d7framelimiter dir=rtl><option selected value=50>Veloce<option value=100>medio<option value=400>Lento<option value=1000>Molto lento</select></div><div><div>Codifica</div><select id=d7encoding dir=rtl><option value=1>JPEG<option value=2>PNG<option value=3>TIFF<option selected value=4>WEBP</select></div><div id=d7desktopOtherSettings><div>Altre impostazioni</div><div id=d7otherset2 style=display:block><label style=display:block><input type=checkbox id=d7deskSwapMouse>Scambia i pulsanti del mouse</label> <label style=display:block><input type=checkbox id=d7deskrmw>Rotellina del mouse inversa</label> <label style=display:block><input type=checkbox id=d7deskRemoteKeyMap>Usa mappa tastiera remota</label> <label style=display:block id=d7deskAutoClipboardLabel><input type=checkbox id=d7deskAutoClipboard>Appunti automatici</label> <label style=display:block id=d7deskAutoLockLabel><input type=checkbox id=d7deskAutoLock>Blocca su Disconnessione</label></div></div></div><div id=d7amtkvm class=tabcontent><div style=margin-top:8px><div>Codifica delle immagini</div><select id=d7desktopmode><option value=1>RLE8, il più veloce<option value=2>RLE16, consigliato<option value=3>RAW8, lento<option value=4>RAW16, molto lento</select></div><div><div>Altre impostazioni</div><div id=d7otherset style=display:block><label style=display:block><input type=checkbox id=d7showfocus>Mostra strumento di messa a fuoco</label> <label style=display:block><input type=checkbox id=d7showcursor>Mostra cursore del mouse locale</label> <label style=display:block><input type=checkbox id=d7localKeyMap>Mappa della tastiera locale</label> <label style=display:block><input type=checkbox id=d7kvmrmw>Rotellina del mouse inversa</label></div></div></div><div id=d7rdpkvm class=tabcontent><div style=margin-top:8px><div>Dimensioni del display</div><select id=d7rdpsize><option notransval=1 value=canvas>Dimensioni della tela<option notransval=1 value=browser>Dimensione del browser<option notransval=1 value=screen>Dimensione dello schermo<option notransval=1 value=640x480>640x480<option notransval=1 value=1024x768>1024x768<option notransval=1 value=1280x800>1280x800<option notransval=1 value=1440x900>1440x900<option notransval=1 value=1600x900>1600x900<option notransval=1 value=1680x1050>1680x1050<option notransval=1 value=1920x1080>1920x1080</select></div><div><div>Opzioni</div><div id=d7rdpflags style=display:block><label style=display:block><input type=checkbox id=d7rdp1>Disabilita lo sfondo</label> <label style=display:block><input type=checkbox id=d7rdp2>Disabilita il trascinamento della finestra intera</label> <label style=display:block><input type=checkbox id=d7rdp3>Disattiva le animazioni del menu</label> <label style=display:block><input type=checkbox id=d7rdp4>Disabilita temi</label> <label style=display:block><input type=checkbox id=d7rdp6>Disabilita l'ombra del cursore</label> <label style=display:block><input type=checkbox id=d7rdp7>Disabilita le impostazioni del cursore</label> <label style=display:block><input type=checkbox id=d7rdp8>Abilita lo smorzamento dei caratteri</label> <label style=display:block><input type=checkbox id=d7rdp9>Abilita composizione desktop</label> <label style=display:block><input type=checkbox id=d7rdpclip>Appunti automatici</label> <label style=display:block><input type=checkbox id=d7rdpsmb>Scambia i pulsanti del mouse</label> <label style=display:block><input type=checkbox id=d7rdprmw>Rotellina del mouse inversa</label></div></div></div></div></div><div class=modal-footer><button type=button class="btn btn-primary"data-bs-dismiss=modal id=idx_dlgCancelButton>Annulla</button> <button type=button class="btn btn-outline-success"id=idx_dlgOkButton>OK</button> <button type=button class="btn btn-outline-danger"id=idx_dlgDeleteButton style=display:none>Elimina</button></div></div></div></div><iframe name=fileUploadFrame style=display:none></iframe><form style=display:none method=post action=uploadfile.ashx enctype=multipart/form-data target=fileUploadFrame><input id=p5fileDragName name=name><input id=p5fileDragAuthCookie name=auth><input id=p5fileDragSize name=size><input id=p5fileDragType name=type><input id=p5fileDragData name=data><input id=p5fileDragLink name=link class="btn btn-outline-success"><input type=submit id=p5loginSubmit2 style=display:none class="btn btn-outline-success"></form><form style=display:none method=post action=uploadnodefile.ashx enctype=multipart/form-data target=fileUploadFrame><input id=p13fileDragName name=name class="btn btn-outline-success"><input id=p13fileDragSize name=size class="btn btn-outline-success"><input id=p13fileDragType name=type class="btn btn-outline-success"><input id=p13fileDragData name=data class="btn btn-outline-success"><input id=p13fileDragLink name=link class="btn btn-outline-success"><input type=submit id=p13loginSubmit2 style=display:none class="btn btn-outline-success"></form><div id=topMenu style="z-index:1000;background-color:#fff;box-shadow:0 0 15px #666;font-family:Arial,Helvetica,sans-serif;border-radius:0 0 5px 5px;position:fixed;top:50px;right:5px;width:170px;display:none"><div style="padding:12px;border-top:1px solid gray;color:#000;cursor:pointer"onclick=topMenu(1)>I miei dispositivi</div><div style="padding:12px;border-top:1px solid gray;color:#000;cursor:pointer"onclick=topMenu(2)>Il mio Account</div><div style="padding:12px;border-top:1px solid gray;color:#000;cursor:pointer"onclick=topMenu(3)>I miei eventi</div><div style="padding:12px;border-top:1px solid gray;color:#000;cursor:pointer"onclick=topMenu(5)>I miei file</div><div style="padding:12px;border-top:1px solid gray;color:#000;cursor:pointer"onclick=topMenu(4)>I miei utenti</div><div style="padding:12px;border-top:1px solid gray;color:#000;cursor:pointer"onclick=topMenu(6)>Il mio server</div><div id=logoutMenuOption><a id=logoutMenuOptionRef href=/logout><div style="padding:12px;border-top:1px solid gray;color:#000;cursor:pointer">Disconnettersi</div></a></div></div><audio id=chimes><source src=sounds/chimes.mp3 type=audio/mp3></audio><iframe style=display:none name=fileDownloadFrame></iframe></div><script>var i,args,urlargs,random="{{{randomlength}}}",webState="{{{webstate}}}";for(i in webState=null!=(webState=""!=webState?JSON.parse(decodeURIComponent(webState)):webState)&&"object"==typeof webState?webState:{})if("desktopsettings"!=i)try{localStorage.setItem(i,webState[i])}catch(e){}if(!webState.loctag)try{localStorage.removeItem("loctag")}catch(e){}var desktop,terminal,files,autoReconnect=!0,powerStatetable=["","Acceso","Standby","Standby","Standby","In ibernaziome","Spegni","Presente"],StatusStrs=["Disconnesso","Collegamento ...","Impostare...","Collegato","Intel&reg; AMT Connected"],agentsStr=["Sconosciuto","Windows 32bit console","Windows 64bit console","Servizio Windows a 32 bit ","Servizio Windows a 64 bit","Linux 32bit","Linux 64bit","MIPS","XENx86","Android","Linux ARM","macOS x86-32bit","Android x86","PogoPlug ARM","Android","Linux Poky x86-32bit","macOS x86-64bit","ChromeOS","Linux Poky x86-64bit","Linux NoKVM x86-32bit","Linux NoKVM x86-64bit","Windows MinCore console","Servizio Windows MinCore ","NodeJS","ARM-Linaro","ARMv6l / ARMv7l","ARMv8 64bit","ARMv6l / ARMv7l / NoKVM","MIPS24KC (OpenWRT)","Apple Silicon","FreeBSD x86-64","Sconosciuto","Linux ARM 64 bit (glibc/2.24 NOKVM)","Alpine Linux x86 64 Bit (MUSL)","Assistente (Windows)","Armada370 - ARM32/HF (libc/2.26)","OpenWRT x86-64","OpenBSD x86-64","Sconosciuto","Sconosciuto","MIPSEL24KC (OpenWRT)","ARMADA/CORTEX-A53/MUSL (OpenWRT)","Windows ARM 64bit console","Windows ARM 64bit service"],agentsStrNoAgent=["","","","","Windows","","Linux","","","","","","","","","","","","","","","","","","","","","","","Mela"],sort=0,searchFocus=0,mapSearchFocus=0,userSearchFocus=0,consoleFocus=0,showRealNames=!1,meshserver=null,meshes={},loginTokens={},meshcount=0,nodes=null,usergroups=null,filetree={},userinfo=null,serverinfo=null,events=[],users=null,wssessions=null,stars={},nodeShortIdent=0,desktopsettings={encoding:2,showfocus:!1,showmouse:!0,showcad:!0,quality:40,scaling:1024,framerate:50,localkeymap:!1,swapmouse:!1,remotekeymap:!1,autoclipboard:!1,autolock:!1,agentencoding:4},multidesktopsettings={quality:20,scaling:128,framerate:1e3,agentencoding:4},debugLevel=parseInt("{{{debuglevel}}}"),features=parseInt("{{{features}}}"),features2=parseInt("{{{features2}}}"),sessionTime=parseInt("{{{sessiontime}}}"),webRelayPort=parseInt("{{{webRelayPort}}}"),webRelayDns="{{{webRelayDns}}}",hidePowerTimeline="{{{hidePowerTimeline}}}",showNotesPanel="{{{showNotesPanel}}}",sessionRefreshTimer=null,domain="{{{domain}}}",domainUrl="{{{domainurl}}}",authCookie="{{{authCookie}}}",authRelayCookie="{{{authRelayCookie}}}",logoutControls=JSON.parse(decodeURIComponent("{{{logoutControls}}}")),authCookieRenewTimer=null,multiDesktop={},serverPublicNamePort="{{{serverDnsName}}}:{{{serverPublicPort}}}",amtScanResults=null,debugmode=0,windowsBrowser=detectWindowsBrowser(),attemptWebRTC=0!=(128&features),webrtcconfiguration="{{{webrtcconfig}}}";if(""==webrtcconfiguration)webrtcconfiguration=null;else try{webrtcconfiguration=JSON.parse(decodeURIComponent(webrtcconfiguration))}catch(e){console.log('Invalid WebRTC config: "'+webrtcconfiguration+'".'),webrtcconfiguration=null}var passRequirements="{{{passRequirements}}}";""!=passRequirements&&(passRequirements=JSON.parse(decodeURIComponent(passRequirements)));var customui=""!=(customui="{{{customui}}}")?JSON.parse(decodeURIComponent(customui)):null,deskAspectRatio=0;try{deskAspectRatio=parseInt(getstore("deskAspectRatio","0"))}catch(e){}var uiMode=parseInt(getstore("uiMode",1)),webPageStackMenu=!1,webPageFullScreen=!0,nightMode=setNightMode(),footerBar="1"==getstore("footerBar","1"),sessionActivity=Date.now(),updateSessionTimer=null,pluginHandlerBuilder={{{pluginHandler}}},pluginHandler=null,installedPluginList=(null!=pluginHandlerBuilder&&(pluginHandler=new pluginHandlerBuilder),null),goBackStack=[],CollapsedGroups={};try{CollapsedGroups=JSON.parse(getstore("_collapse","{}"))}catch(e){}var deviceViewSettings={};try{deviceViewSettings=JSON.parse(getstore("_deviceViewSettings","{}"))}catch(e){}var userViewSettings={};try{userViewSettings=JSON.parse(getstore("_usersViewSettings","{}"))}catch(e){}var xterm=null,xtermfit=null,xtermResizeTimer=null,miscState={},checkedNodeids={},deskKeyboardShortcuts=[],deskKeyboardStrings=[],deskLastClipboardSent=null,requestedLastConnects=!1,devicePagingState=null,p11DeskConsoleMsgTimer=null,p12TermConsoleMsgTimer=null,p13FilesConsoleMsgTimer=null,webpSupport=!1;function startup(){if(0==(32&features)){var e=null;try{e=top.location.toString().toLowerCase()}catch(e){}if(top!=self&&(null==e||0==top.active))return void(top.location=self.location)}null!=(urlargs=parseUriArgs()).key&&(urlargs.key=""+urlargs.key),urlargs.key&&0==isAlphaNumeric(urlargs.key)&&delete urlargs.key,urlargs.locale&&0==isAlphaNumeric(urlargs.locale)&&delete urlargs.locale,delete urlargs.user,delete urlargs.pass,delete urlargs.viewmode,delete urlargs.gotonode,delete urlargs.gotodevicename,delete urlargs.gotodeviceip,delete urlargs.gotomesh,delete urlargs.gotouser,delete urlargs.gotougrp,urlargs.key&&(Q("termsLinkFooter").href+="?key="+urlargs.key),(args=parseUriArgs()).key&&0==isAlphaNumeric(args.key)&&delete args.key,args.locale&&0==isAlphaNumeric(args.locale)&&delete args.locale,args.locale||null!=(o=getstore("loctag",0))&&"*"!=o&&(args.locale=o),debugmode=args.debug,null!=args.webrtc&&(attemptWebRTC=1==args.webrtc),QV("p13AutoConnect",debugmode),QV("autoconnectbutton2",debugmode),QV("autoconnectbutton1",debugmode),nightMode&&(document.documentElement.setAttribute("data-bs-theme","dark"),QC("body").add("night"),QS("body")["background-color"]="#000"),toggleFullScreen();try{stars=JSON.parse(getstore("stars","{}"))}catch(e){}var e=0,t=parseInt("{{{hide}}}"),t=((t||args.hide)&&(args.hide&&(e=parseInt(args.hide)),t)&&(e|=t),args.hide=e,QV("uiViewButton5",!(4&args.hide)),adjustPanels(),"");logoutControls&&(null!=logoutControls.name&&(t='<span onmouseup=go(2) CLASS="LogoffLinkColor" style="cursor:pointer">'+format("Benvenuto {0}. ",logoutControls.name)+"</span>"),null!=logoutControls.logoutUrl)&&(t+=format(' <a href="'+logoutControls.logoutUrl+'" CLASS="LogoffLinkColor">Disconnettersi</a>')),1&args.hide?QH("logoutControlSpan2",t):QH("logoutControlSpan",t),document.onclick=function(e){hideContextMenu()},document.onkeypress=ondockeypress,document.onkeydown=ondockeydown,document.onkeyup=ondockeyup,window.addEventListener("blur",ondocblur,!1),window.onresize=function(){hideContextMenu(),mainUpdate(512),browserfullscreen=isBrowserFullscreen(),QV("DeskESC",browserfullscreen),null!=xtermfit&&12==xxcurrentView&&xtermfit.fit()},setTimeout(function(){urlargs.filter&&(Q("SearchInput").value=urlargs.filter,Q("KvmSearchInput").value=urlargs.filter),mainUpdate(512)},200),DOMPurify&&DOMPurify.addHook("afterSanitizeAttributes",function(e){"target"in e&&(e.setAttribute("target","_blank"),e.setAttribute("rel","noopener noreferrer")),e.hasAttribute("target")||!e.hasAttribute("xlink:href")&&!e.hasAttribute("href")||e.setAttribute("xlink:show","new")}),QV("textnewui",0!=(1073741824&features2)),(meshserver=MeshServerCreateControl(domainUrl)).onStateChanged=onStateChanged,meshserver.onMessage=onMessage,meshserver.trace=args.trace,meshserver.Start(),Q("sortselect").selectedIndex=sort=getstore("sort",0),Q("sizeselect").selectedIndex=getstore("viewsize",1),Q("KvmSearchInput").value=Q("SearchInput").value=getstore("_search",""),showRealNames=1==getstore("showRealNames",0),Q("RealNameCheckBox").checked=showRealNames,Q("DevFilterSelect").value=getstore("devFilterSelect",0),Q("viewselect").value=getstore("deviceView",1),Q("DeskControl").checked=1==getstore("DeskControl",1),QV("accountChangeEmailAddressSpan",0==(2097152&features)),mainUpdate(3);for(var i=1;i<5;i++)Q("devViewButton"+i).classList.remove("viewSelectorSel");Q("devViewButton"+Q("viewselect").value).classList.add("viewSelectorSel"),Q("p5filetable").addEventListener("drop",p5fileDragDrop,!1),Q("p5filetable").addEventListener("dragover",p5fileDragOver,!1),Q("p5filetable").addEventListener("dragleave",p5fileDragLeave,!1),Q("deskarea0").addEventListener("drop",p11fileDragDrop,!1),Q("deskarea0").addEventListener("dragover",p11fileDragOver,!1),Q("deskarea0").addEventListener("dragleave",p11fileDragLeave,!1),Q("p13filetable").addEventListener("drop",p13fileDragDrop,!1),Q("p13filetable").addEventListener("dragover",p13fileDragOver,!1),Q("p13filetable").addEventListener("dragleave",p13fileDragLeave,!1),setInterval(updateDeviceTimeline,12e4);e=null;try{e=localStorage.getItem("desktopsettings")}catch(e){}null!=e&&(desktopsettings=JSON.parse(e)),e=null;try{e=localStorage.getItem("multidesktopsettings")}catch(e){}null!=e&&(multidesktopsettings=JSON.parse(e)),applyDesktopSettings();for(var o="",n=1;n<27;n++)o+="<option value='"+n+"'>Ctrl-"+String.fromCharCode(64+n)+" ("+n+")</option>";QH("specialkeylist",o),setupGeneralServerStats(),setupServerTimelineStats(),userInterfaceSelectMenu(),setupMeshSummaryStats(),QV("p4UserBatchCreate",0==(524288&features)),d4EditWrapVal=Number(getstore("editorWrap",0)),d4EditSizeVal=Number(getstore("editorSize",0)),d4EditEncodingVal=Number(getstore("editorEncoding",0)),d4EditLineBreakVal=Number(getstore("editorLineBreak",0)),d4ToggleWrap(!0),d4ToggleSize(!0),d4ToggleEncoding(!0),d4ToggleLineBreak(!0),null!=pluginHandler&&pluginHandler.callHook("onWebUIStartupEnd"),-1==["en","ko","ja","zh-chs","zh-cht"].indexOf("{{{lang}}}")&&""!="{{{lang}}}".toLowerCase()&&QC("body").add("nonenglish");var a=document.getElementsByClassName("topbar_td");for(r in a)a[r].innerHTML&&(a[r].innerHTML=a[r].innerHTML.split(" ").join("&nbsp;"));if(null!=customui){if(customui.devicesbarbuttons){o="";for(r in customui.devicesbarbuttons){var s="one"==customui.devicesbarbuttons[r].selection||"many"==customui.devicesbarbuttons[r].selection?"disabled":"";o+='<input id="cui:'+r+'" type="button" value="'+customui.devicesbarbuttons[r].name+'" '+s+' onclick=customUIAction(event,"devicesbarbuttons") />'}QH("devsCustomUIBar",o)}if(customui.desktopbuttons){o="";for(r in customui.desktopbuttons)o+='<input id="cui:'+r+'" type="button" value="'+customui.desktopbuttons[r].name+'" style="float:left" onclick=customUIAction(event,"desktopbuttons") />';QH("desktopCustomUiButtons",o)}if(customui.terminalbuttons){o="";for(r in customui.terminalbuttons)o+='<input id="cui:'+r+'" type="button" value="'+customui.terminalbuttons[r].name+'" style="float:left" onclick=customUIAction(event,"terminalbuttons") />';QH("terminalCustomUiButtons",o)}if(customui.filesbuttons){o="";for(r in customui.filesbuttons)o+='<input id="cui:'+r+'" type="button" value="'+customui.filesbuttons[r].name+'" style="float:left" onclick=customUIAction(event,"filesbuttons") />';QH("filesCustomUiButtons",o)}}10<=sessionTime&&(sessionRefreshTimer=setTimeout(refreshCookieSession,Math.round(6e4*sessionTime*.8))),deskKeyboardShortcuts=[];var r,l=getstore("deskKeyShortcuts","0x0A002E,0x100000,0x100028,0x100026,0x10004C,0x10004D,0x11004D,0x100052,0x020073,0x080057,0x020009,0x100025,0x100027").split(",");for(r in l)""!=l[r]&&deskKeyboardShortcuts.push(parseInt(l[r]));updateDeskShortcutKeys();try{deskKeyboardStrings=JSON.parse(getstore("deskStrings","[]"))}catch(e){}updateDesktopStrings(),updateCollapseAllButton(),dialogBoxDrag(),urlargs.key&&(Q("p6backuplink").href+="?key="+urlargs.key),QV("uiViewButton4",0==(3145728&features2)),Q("DeskType").value=multiTranslate("[KeyboardTyping]|Digita"),QV("ScrollToTopButton",0!=(134217728&features2))}function refreshCookieSession(){var e=null;try{e=new XDomainRequest}catch(e){}(e=e||new XMLHttpRequest).open("GET",window.location.origin+domainUrl+"refresh.ashx"),e.timeout=15e3,e.onload=function(){sessionRefreshTimer=setTimeout(refreshCookieSession,Math.round(6e4*sessionTime*.8))},e.onerror=e.ontimeout=function(){sessionRefreshTimer=null},e.send()}function customUIAction(e,t){e=e.srcElement.id;if(0!=e.startsWith("cui:")){var i=customui[t][e.substring(4)];if(null!=i){if("devicesbarbuttons"==t){for(var o=document.getElementsByClassName("DeviceCheckbox"),n=[],a=0;a<o.length;a++)!0===o[a].checked&&n.push(o[a].defaultValue.substring(6));if("string"==typeof i.action&&("event"==i.action&&meshserver.send({action:"uicustomevent",section:t,element:e.substring(4),selectedDevices:n,logmsg:i.logmsg}),i.action.startsWith("dialog:")&&showCustomUiDialog(i.action.substring(7),{section:t,element:e.substring(4),selectedDevices:n}),i.deselectdevices)){for(a=0;a<o.length;a++)o[a].checked=!1;checkedNodeids={},p1updateInfo()}}"devicebuttons"!=t&&"desktopbuttons"!=t&&"terminalbuttons"!=t&&"filesbuttons"!=t||(n=[currentNode._id],"string"==typeof i.action&&("event"==i.action&&meshserver.send({action:"uicustomevent",section:t,element:e.substring(4),selectedDevices:n,logmsg:i.logmsg}),i.action.startsWith("dialog:"))&&showCustomUiDialog(i.action.substring(7),{section:t,element:e.substring(4),selectedDevices:n}))}}}function showCustomUiDialog(e,t){if(null!=customui&&null!=customui.dialogs&&"object"==typeof customui.dialogs[e]){var i="",o=customui.dialogs[e];if("string"==typeof o.text&&(i+="<div style=margin-bottom:8px>"+o.text+"</div>"),"number"==typeof o.buttons&&o.buttons,"object"==typeof o.elements)for(var n in o.elements){var a=o.elements[n];if("text"==a.type&&(i+=addHtmlFormFloating(a.name,"<input id=cui:"+n+" class=form-control autocomplete=off />")),"textarea"==a.type&&(null==a.name?i+="<textarea id=cui:"+n+" style=width:356px;resize:none;height:100px autocomplete=off></textarea>":i+=addHtmlFormFloating(a.name,"<textarea id=cui:"+n+" style=width:230px;resize:none;height:100px autocomplete=off></textarea>")),"droplist"==a.type){var s,r="";for(s in a.options)r+='<option value="'+s+'">'+EscapeHtml(a.options[s])+"</option>";i+=addHtmlFormFloating(a.name,'<select id="cui:'+n+'" class=form-select autocomplete=off />'+r+"</select>")}}setModalContent("xxAddAgent",o.title,i),showModal("xxAddAgentModal","idx_dlgOkButton",{action:"uicustomevent",section:"dialogs",element:e,src:t,values:{},logmsg:o.logmsg})}}function showCustomUiDialogEx(e,t){if(1==e){var i=customui.dialogs[t.element];if("object"==typeof i.elements)for(var o in i.elements){var n=i.elements[o];"droplist"!=n.type&&"textarea"!=n.type&&"text"!=n.type||(t.values[o]=Q("cui:"+o).value)}if(meshserver.send(t),i.deselectdevices){for(var a=document.getElementsByClassName("DeviceCheckbox"),o=0;o<a.length;o++)a[o].checked=!1;checkedNodeids={},p1updateInfo()}}}function adjustPanels(){var e=args.hide,e=(0==footerBar&&(e|=4),QV("masthead",!(1&e)),QV("topbar",!(2&e)),QV("footer",!(4&e)),QV("p1title",!(8&e)),QV("p2title",!(8&e)),QV("p3title",!(8&e)),QV("p4title",!(8&e)),QV("p5title",!(8&e)),QV("p6title",!(8&e)),QV("p10title",!(8&e)),QV("p11title",!(8&e)),QV("p12title",!(8&e)),QV("p13title",!(8&e)),QV("p14title",!(8&e)),QV("p15title",!(8&e)),QV("p16title",!(8&e)),QV("p17title",!(8&e)),QV("p20title",!(8&e)),QV("p21title",!(8&e)),QV("p30title",!(8&e)),QV("p31title",!(8&e)),QV("p40title",!(8&e)),QV("p41title",!(8&e)),QV("p50title",!(8&e)),QV("p51title",!(8&e)),footerBar?QC("body").remove("nofooter"):QC("body").add("nofooter"),0!=args.hide&&(2==uiMode?(QS("container")["grid-template-rows"]=(1&e?"0":"66")+"px fit-content(48px) auto "+(4&e?"0":"45")+"px",QS("container")["-ms-grid-rows"]=(1&e?"0":"66")+"px fit-content(48px) auto "+(4&e?"0":"45")+"px"):(QS("container")["grid-template-rows"]=(1&e?"0":"66")+"px "+(2&e?"0":"24")+"px auto "+(4&e?"0":"45")+"px",QS("container")["-ms-grid-rows"]=(1&e?"0":"66")+"px "+(2&e?"0":"24")+"px auto "+(4&e?"0":"45")+"px")),(1&e?0:66)+(2&e?0:24)+(4&e?0:45)+(8&e?0:60)),t=1<uiMode?24:0,i=(QS("p2info").height="calc(100vh - "+(20+e+t)+"px)",QS("p2info")["max-height"]="calc(100vh - "+(20+e+t)+"px)",QS("p3users")["max-height"]="calc(100vh - "+(50+e)+"px)",QS("p50groups")["max-height"]="calc(100vh - "+(50+e)+"px)",QS("p3events").height="calc(100vh - "+(50+e)+"px)",QS("p5filetable").height="calc(100vh - "+(99+e)+"px)",QS("p13filetable").height="calc(100vh - "+(127+e+t)+"px)",QS("serverMainStats").height="calc(100vh - "+(50+e+t)+"px)",QS("serverMainStats")["max-height"]="calc(100vh - "+(50+e+t)+"px)",QS("xdevices")["max-height"]="calc(100vh - "+(46+e)+"px)",QS("xdevicesmap")["max-height"]="calc(100vh - "+(46+e)+"px)",QS("p15agentConsole").height="calc(100vh - "+(84+e+t)+"px)",QS("p15agentConsole")["max-height"]="calc(100vh - "+(84+e+t)+"px)",QS("p15agentConsoleText").height="calc(100vh - "+(81+e+t)+"px)",QS("p15agentConsoleText")["max-height"]="calc(100vh - "+(81+e+t)+"px)",!(0===args.xterm||null!=terminal&&null==xterm));fullscreen?(QS("deskarea3x").height=null,QS("deskarea3x")["max-height"]=null,QS("p14iframe").height=null,QS("p14iframe")["max-height"]=null,i&&(QS("termarea3x").height="calc(100vh - 55px)",QS("termarea3xdiv").height="calc(100vh - 55px)",QS("termarea3x")["max-width"]="calc(1px)")):(QS("deskarea3x").height="calc(100vh - "+(74+e+t)+"px)",QS("deskarea3x")["max-height"]="calc(100vh - "+(74+e+t)+"px)",QS("p14iframe").height="calc(100vh - "+(23+e+t)+"px)",QS("p14iframe")["max-height"]="calc(100vh - "+(23+e+t)+"px)",i&&(QS("termarea3x").height="calc(100vh - "+(74+e+t)+"px)",QS("termarea3xdiv").height="calc(100vh - "+(74+e+t)+"px)",QS("termarea3x")["max-width"]="calc(1px)")),QS("p43iframe").height="calc(100vh - "+(84+e)+"px)",QS("p43iframe")["max-height"]="calc(100vh - "+(84+e)+"px)",QS("p6info").height="calc(100vh - "+(e-50+t)+"px)",QS("p6info")["max-height"]="calc(100vh - "+(e-50+t)+"px)",QS("p10info").height="calc(100vh - "+(20+e+t)+"px)",QS("p10info")["max-height"]="calc(100vh - "+(20+e+t)+"px)",QS("p17info").height="calc(100vh - "+(20+e+t)+"px)",QS("p17info")["max-height"]="calc(100vh - "+(20+e+t)+"px)",QS("p20main").height="calc(100vh - "+(e-50+t)+"px)",QS("p20main")["max-height"]="calc(100vh - "+(e-50+t)+"px)",QS("p21main").height="calc(100vh - "+(20+e+t)+"px)",QS("p21main")["max-height"]="calc(100vh - "+(20+e+t)+"px)",QS("p30info").height="calc(100vh - "+(20+e+t)+"px)",QS("p30info")["max-height"]="calc(100vh - "+(20+e+t)+"px)",QS("p51info").height="calc(100vh - "+(20+e+t)+"px)",QS("p51info")["max-height"]="calc(100vh - "+(20+e+t)+"px)",QS("p16events").height="calc(100vh - "+(50+e+t)+"px)",QS("p16events")["max-height"]="calc(100vh - "+(50+e+t)+"px)",QS("p31events").height="calc(100vh - "+(50+e+t)+"px)",QS("p31events")["max-height"]="calc(100vh - "+(50+e+t)+"px)",QS("p41events").height="calc(100vh - "+(48+e+t)+"px)",QS("p41events")["max-height"]="calc(100vh - "+(48+e+t)+"px)",QS("p52recordings").height="calc(100vh - "+(48+e+t)+"px)",QS("p52recordings")["max-height"]="calc(100vh - "+(48+e+t)+"px)",QS("p60report").height="calc(100vh - "+(48+e+t)+"px)",QS("p60report")["max-height"]="calc(100vh - "+(48+e+t)+"px)",(32&args.hide||""!="{{currentNode}}".toLowerCase())&&(QV("p10BackButton",!1),QV("p11BackButton",!1),QV("p12BackButton",!1),QV("p13BackButton",!1),QV("p14BackButton",!1),QV("p15BackButton",!1),QV("p16BackButton",!1),QV("p17BackButton",!1)),p1updateInfo()}function toggleAspectRatio(e){1===e&&putstore("deskAspectRatio",deskAspectRatio=(deskAspectRatio+1)%3),deskAdjust()}function toggleStackMenu(e){1==webPageFullScreen&&(1===e&&putstore("webPageStackMenu",webPageStackMenu=!webPageStackMenu),0==webPageStackMenu?QC("body").remove("menu_stack"):(QC("body").add("menu_stack"),10<=xxcurrentView&&QC("column_l").remove("room4submenu")),deskAdjust())}function showUserInterfaceSelectMenu(){if(!xxdialogMode){Q("uiViewButton1").classList.remove("uiSelectorSel"),Q("uiViewButton2").classList.remove("uiSelectorSel"),Q("uiViewButton3").classList.remove("uiSelectorSel"),Q("uiViewButton4").classList.remove("uiSelectorSel"),Q("uiViewButton5").classList.remove("uiSelectorSel");try{Q("uiViewButton"+uiMode).classList.add("uiSelectorSel")}catch(e){}QV("uiMenu","none"==QS("uiMenu").display),nightMode&&Q("uiViewButton4").classList.add("uiSelectorSel"),footerBar&&Q("uiViewButton5").classList.add("uiSelectorSel")}}function userInterfaceSelectMenu(e){e&&putstore("uiMode",uiMode=e),webPageFullScreen=uiMode<3,webPageStackMenu=1<uiMode,toggleFullScreen(0),toggleStackMenu(0),webPageStackMenu&&10<=xxcurrentView?QC("column_l").add("room4submenu"):QC("column_l").remove("room4submenu"),adjustPanels()}function toggleNightMode(){var e;xxdialogMode||(e=getstore("nightMode","0"),xxdialogButtons=3,setModalContent("xxAddAgent","Modalità notturna","<input type=radio id=night0 name=nightmoderadio value=0 "+(0==e?"checked":"")+"><label for=night0>Impostazioni predefinite del browser</label><br>"+("<input type=radio id=night2 name=nightmoderadio value=2 "+(2==e?"checked":"")+"><label for=night2>Modalità luce</label><br>")+("<input type=radio id=night1 name=nightmoderadio value=1 "+(1==e?"checked":"")+"><label for=night1>Modalità scura</label><br>")),showModal("xxAddAgentModal","idx_dlgOkButton",toggleNightModeEx),QV("uiMenu",!1))}function toggleNightModeEx(){var e="0";Q("night1").checked&&(e="1"),putstore("nightMode",e=Q("night2").checked?"2":e),setNightMode()}function setNightMode(){var e=getstore("nightMode","0");return nightMode=!1,0!=(1048576&features2)&&(e="1"),"1"==(e=0!=(2097152&features2)?"2":e)?nightMode=!0:"0"==e&&window.matchMedia&&(nightMode=window.matchMedia("(prefers-color-scheme: dark)").matches),nightMode?(document.documentElement.setAttribute("data-bs-theme","dark"),QC("body").add("night"),QS("body")["background-color"]="#000"):(document.documentElement.setAttribute("data-bs-theme","light"),QC("body").remove("night"),QS("body")["background-color"]="#d3d9d6"),nightMode}function toggleFooterBarMode(){putstore("footerBar",(footerBar=!footerBar)?"1":"0"),QS("container")["grid-template-rows"]=null,QS("container")["-ms-grid-rows"]=null,adjustPanels()}function toggleFullScreen(e){var t=document.getElementById("page_leftbar");1===e&&putstore("webPageFullScreen",webPageFullScreen=!webPageFullScreen),0==webPageFullScreen?(QC("body").remove("menu_stack"),QC("body").remove("fullscreen"),QC("body").remove("arg_hide"),10<=xxcurrentView&&QC("column_l").add("room4submenu"),QV("UserDummyMenuSpan",!1),t.classList.add("d-none")):(QC("body").add("fullscreen"),16&args.hide&&QC("body").add("arg_hide"),QV("page_leftbar",!(16&args.hide)),QV("MainMenuSpan",!(16&args.hide)),10<=xxcurrentView&&QC("column_l").remove("room4submenu"),QV("UserDummyMenuSpan",xxcurrentView<10&&webPageFullScreen),t.classList.remove("d-none")),mainUpdate(512),QV("body",!0)}function saveUserInterfaceMode(){var e=3;Q("ui0").checked&&(e=2),getstore("uiViewMode",3)!=e&&(putstore("uiViewMode",e),(e=new URL(window.location.href)).searchParams.has("sitestyle")&&(e.searchParams.delete("sitestyle"),window.history.replaceState({},document.title,e.toString())),reload())}function toggleBootstrapUIMode(){var e,t;xxdialogMode||(t="<div class=form-check><input type=radio class=form-check-input id=ui0 name=uiradio value=2 "+(2==(e=getstore("uiViewMode",3))?"checked":"")+"><label class=form-check-label for=ui0>Classic</label></div>",setModalContent("xxAddAgent","User Interface",t+="<div class=form-check><input type=radio class=form-check-input id=ui1 name=uiradio value=3 "+(3==e?"checked":"")+"><label class=form-check-label for=ui1>Modern</label></div>"),showModal("xxAddAgentModal","idx_dlgOkButton",saveUserInterfaceMode),QV("uiMenu",!1))}function getNodeFromId(e){if(null!=nodes)for(var t in nodes)if(nodes[t]._id==e)return nodes[t];return null}function reload(){var e=window.location.href;(e=e.endsWith("/#")?e.substring(0,e.length-2):e).endsWith("#")&&(e=e.substring(0,e.length-1)),window.location.href=e}function onStateChanged(e,t,i,o){0==t?(setDialogMode(0),go(0),deviceShares=powerTimelineUpdate=powerTimelineNode=powerTimelineReq=powerTimeline=null,deleteAllNotifications(),hideContextMenu(),QV("verifyEmailId2",!1),QV("logoutControl",!1),"noauth"==o?QH("p0span","Impossibile eseguire l'autenticazione"):"invalidorigin"==o?QH("p0span","Invalid origin in HTTP request"):(2==i?autoReconnect&&setTimeout(serverPoll,5e3):QH("p0span","Impossibile connettere  web socket"),null!=authCookieRenewTimer&&(clearInterval(authCookieRenewTimer),authCookieRenewTimer=null))):2==t&&(meshserver.send({action:"usergroups"}),meshserver.send({action:"meshes"}),meshserver.send({action:"nodes",id:"{{currentNode}}",skip:null==devicePagingState?0:devicePagingState.skip}),meshserver.send({action:"loginTokens"}),null!=pluginHandler&&meshserver.send({action:"plugins"}),""=="{{currentNode}}".toLowerCase()&&meshserver.send({action:"files"}),""=="{{viewmode}}".toLowerCase()&&go(1),authCookieRenewTimer=setInterval(function(){meshserver.send({action:"authcookie"})},18e5),40==xxcurrentView)&&refreshServerTimelineStats()}function serverPoll(){var e=null;try{e=new XDomainRequest}catch(e){}(e=e||new XMLHttpRequest).open("HEAD",window.location.href),e.timeout=15e3,e.onload=function(){e.status<500?reload():setTimeout(serverPoll,1e4)},e.onerror=e.ontimeout=function(){setTimeout(serverPoll,1e4)},e.send()}function detectWindowsBrowser(){var e=window.navigator.userAgent.toUpperCase();return 0<=e.indexOf("WINDOWS")||0<=e.indexOf("WIN32")||0<=e.indexOf("WIN64")}function updateSiteAdmin(){var e=parseInt("{{{serverfeatures}}}"),t=userinfo.siteadmin,i=4294967295!=t&&0!=(1024&t)||0!=(256&features2);QV("p2AccountSecurity",0==(4&features)&&0==serverinfo.domainauth&&0!=(4096&features)&&0==i),QV("p2AccountActions",!i),QV("managePhoneNumber1",33554432&features&&67108864&features&&1!=serverinfo.lock2factor),QV("managePhoneNumber2",33554432&features&&!(67108864&features)&&1!=serverinfo.lock2factor),QV("manageMessaging1",33554432&features2&&67108864&features2&&1!=serverinfo.lock2factor),QV("manageMessaging2",33554432&features2&&!(67108864&features2)&&1!=serverinfo.lock2factor),QV("manageEmail2FA",8388608&features&&1!=serverinfo.lock2factor),QV("p2AccountPassActions",0==(4&features)&&0==serverinfo.domainauth&&null!=userinfo&&0==userinfo._id.split("/")[2].startsWith("~")),QV("accountCreateLoginTokenSpan",128&features2),QV("p2AccountImageFrame",!i),QV("p2ServerActions",21&t&&0!=(143&e)),QV("LeftMenuMyServer",21&t&&0!=(64&e)),QV("MainMenuMyServer",21&t),QV("p2ServerActionsBackup",1&t&&0!=(1&e)),QV("p2ServerActionsRestore",4&t&&0!=(2&e)),QV("p2ServerActionsVersion",16&t&&0!=(4&e)),QV("p2ServerActionsErrors",16&t&&0!=(8&e)),QV("p2ServerActionsConfig",16&t&&0!=(128&e)),QV("MainMenuMyFiles",8&t),QV("LeftMenuMyFiles",8&t),0==(8&t)&&5==xxcurrentView&&(setDialogMode(0),go(1)),null!=currentNode&&gotoDevice(currentNode._id,xxcurrentView,!0),null!=userinfo.flags&&1&userinfo.flags?(null==userinfo.accountImageRnd&&(userinfo.accountImageRnd=Math.floor(9999999999*Math.random())),Q("p2AccountImage").src="userimage.ashx?rnd="+userinfo.accountImageRnd):Q("p2AccountImage").src="images/user-256.png",0!=(2&userinfo.siteadmin)?(null==users&&meshserver.send({action:"users"}),null==wssessions&&meshserver.send({action:"wssessioncount"}),mainUpdate(24576)):(wssessions=users=null,mainUpdate(16384),(4==xxcurrentView||30<=xxcurrentView&&xxcurrentView<40)&&(setDialogMode(0),go(1),currentUser=null)),meshserver.send({action:"events",limit:parseInt(p3limitdropdown.value)}),QV("ServerConsole",4294967295===userinfo.siteadmin&&0!=(16&e)),QV("ServerTrace",4294967295===userinfo.siteadmin&&0!=(32&e)),115==xxcurrentView&&4294967295!=userinfo.siteadmin&&go(6),6==xxcurrentView&&0==(21&userinfo.siteadmin)&&go(1),0!=(21&t)&&meshserver.send({action:"serverstats",interval:1e4})}check_webp_feature("lossy",function(e,t){(webpSupport=t)||(d7encoding.options[1].disabled=!0,d7encoding.value=1)}),window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").addEventListener("change",setNightMode);var updateNaggleTimer=null,updateNaggleFlags=0;function mainUpdate(e){updateNaggleFlags|=e,null==updateNaggleTimer&&(updateNaggleTimer=setTimeout(function(){512&updateNaggleFlags&&center(),1&updateNaggleFlags&&onSearchInputChanged(),2&updateNaggleFlags&&onSortSelectChange(!1),128&updateNaggleFlags&&updateMeshes(),4&updateNaggleFlags&&(updateDevices(),updateDeviceDetails(),21==xxcurrentView)&&p21updateMesh(),8&updateNaggleFlags&&drawNotifications(),16&updateNaggleFlags&&32768&features&&updateMapMarkers(),32&updateNaggleFlags&&eventsUpdate(),64&updateNaggleFlags&&32768&features&&refreshMap(!1,!0),256&updateNaggleFlags&&drawDeviceTimeline(),1024&updateNaggleFlags&&deviceEventsUpdate(),2048&updateNaggleFlags&&userEventsUpdate(),4096&updateNaggleFlags&&p20updateMesh(),8192&updateNaggleFlags&&updateUserGroups(),16384&updateNaggleFlags&&updateUsers(),32768&updateNaggleFlags&&updateRecordings(),65536&updateNaggleFlags&&updateLoginTokens(),updateNaggleTimer=null,updateNaggleFlags=0,gotoStartViewPage()},150))}function count2factoraAuths(){var e;return null==userinfo?-1:(e=0,1==userinfo.otpsecret&&e++,0<userinfo.otphkeys&&(e+=userinfo.otphkeys),8388608&features&&1==userinfo.otpekey&&e++,33554432&features&&67108864&features&&null!=userinfo.phone&&e++,33554432&features2&&67108864&features2&&null!=userinfo.msghandle&&e++,0<e&&0<userinfo.otpkeys&&0==(262144&features2)&&e++,e)}var backupCodesWarningDone=!1;function updateSelf(){var e,t=count2factoraAuths(),i=4294967295!=userinfo.siteadmin&&0!=(1024&userinfo.siteadmin),i=(QV("verifyEmailId",!0!==userinfo.emailVerified&&null!=userinfo.email&&1==serverinfo.emailcheck),QV("verifyEmailId2",!0!==userinfo.emailVerified&&null!=userinfo.email&&1==serverinfo.emailcheck&&0==i),QV("manageOtp",1!=serverinfo.lock2factor&&0<t&&0==(262144&features2)),QV("authPhoneNumberCheck",null!=userinfo.phone),QV("authMessagingCheck",null!=userinfo.msghandle),QV("authEmailSetupCheck",1==userinfo.otpekey&&null!=userinfo.email&&1==userinfo.emailVerified),QV("authDuoSetupCheck",1==userinfo.otpduo&&0!=(536870912&features2)),QV("authAppSetupCheck",1==userinfo.otpsecret),QV("manageAuthApp",1!=serverinfo.lock2factor&&(1==userinfo.otpsecret||0==(131072&features2))),QV("manageDuoApp",1!=serverinfo.lock2factor&&0!=(536870912&features2)),QV("authKeySetupCheck",0<userinfo.otphkeys),QV("authPushAuthDevCheck",0<userinfo.otpdev&&0!=(64&features2)),QV("authCodesSetupCheck",0<userinfo.otpkeys),QV("managePushAuthDev",1!=serverinfo.lock2factor&&64&features2&&0<t),QV("manageHardwareOtp",1!=serverinfo.lock2factor),mainUpdate(4228),0==backupCodesWarningDone&&1==t&&0==(524288&features2)&&(addNotification({text:"Aggiungi codici di backup a due fattori. Se il fattore corrente viene perso, non c'è modo di recuperare questo account.",title:"Autenticazione a due fattori",tag:"backupcodes"}),backupCodesWarningDone=!0),4294967295==userinfo.siteadmin||0==(64&userinfo.siteadmin));QV("p2createMeshLink1",i),QV("p2createMeshLink2",i),QV("getStarted1",i),QV("getStarted2",!i),"number"==typeof userinfo.passchange&&(-1==userinfo.passchange?QH("p2nextPasswordUpdateTime"," - Ripristino al prossimo accesso."):null!=passRequirements&&"number"==typeof passRequirements.reset&&((t=userinfo.passchange+86400*passRequirements.reset-Math.floor(Date.now()/1e3))<0?QH("p2nextPasswordUpdateTime"," - Ripristino al prossimo accesso."):t<3600?(i=Math.floor(t/60),QH("p2nextPasswordUpdateTime",format(1==i?" - Reimpostazione in 1 minuto.":" - Reimpostazione in {0} minuti.",i))):t<86400?(e=Math.floor(t/3600),QH("p2nextPasswordUpdateTime",format(1==e?" - Reimpostazione in 1 ora.":" - Reimpostazione in {0} ore.",e))):(i=Math.floor(t/86400),QH("p2nextPasswordUpdateTime",format(1==e?" - Reimpostazione in 1 giorno.":" - Reimpostazione in {0} giorni.",i))))),QV("MainMenuMyUsers",null!=users&&0==(4&features)||0!=(512&userinfo.siteadmin)&&0!=(134217728&features)),QV("LeftMenuMyUsers",null!=users&&0==(4&features)||0!=(512&userinfo.siteadmin)&&0!=(134217728&features)),QV("UsersGeneral",null!=users&&0==(4&features)),QV("UsersGroups",null!=users&&0==(4&features)),QV("UsersRecordings",0!=(512&userinfo.siteadmin)&&0!=(134217728&features))}function setSessionActivity(){sessionActivity=Date.now(),QH("idleTimeoutNotify","")}function checkIdleSessionTimeout(){var e=Date.now()-sessionActivity;e>serverinfo.timeout?(null!=desktop&&(desktop.Stop(),webRtcDesktopReset(),(desktopNode=desktop=null)!=pluginHandler)&&pluginHandler.callHook("onDesktopDisconnect"),null!=terminal&&(terminal.Stop(),terminal=null),null!=files&&(files.Stop(),files=null),serverinfo.logoutOnIdleSessionTimeout&&(window.location.href="logout")):(e=Math.round((serverinfo.timeout-e)/1e3))<=60?QH("idleTimeoutNotify","<br />"+format(1==e?"1 secondo fino alla disconnessione":"{0} secondi fino alla disconnessione",e)):(e=Math.round(e/60))<=5&&QH("idleTimeoutNotify","<br />"+format(1==e?"1 minuto fino alla disconnessione":"{0} minuti fino alla disconnessione",e))}function onMessage(z,i){switch(i.action){case"trace":serverTrace.unshift(i),displayServerTrace();break;case"intersession":"removeNotify"==i.subaction&&notificationDelete(i.id);break;case"traceinfo":"object"==typeof i.traceSources&&(null!=i.traceSources&&0<i.traceSources.length?(serverTraceSources=i.traceSources,QH("p41traceStatus",EscapeHtml(i.traceSources.join(", ")))):(serverTraceSources=[],QH("p41traceStatus","Nessuna ")));break;case"serverstats":updateGeneralServerStats(i);break;case"serverwarnings":if(null!=i.warnings&&0<i.warnings.length){var F={1:"",2:"Parametri WebDAV mancanti.",3:'Opzione di configurazione non riconosciuta "{0}".',4:"La compressione WebSocket è disabilitata, questa funzione è interrotta in NodeJS da v11.11 a v12.15 e v13.2",5:"Impossibile caricare il certificato radice Intel AMT TLS per il dominio predefinito.",6:"Impossibile caricare il certificato radice Intel AMT TLS per il dominio {0}.",7:"FQDN locali CIRA ignorati quando il server è in modalità solo LAN o solo WAN.",8:"Non può avere più di 4 FQDN locali CIRA. Ignorando il valore.",9:"Il controllo dell'hash dell'agente è stato ignorato, questo non è sicuro.",10:"Manca l'indirizzo e-mail Let's Encrypt.",11:"Nomi host Let's Encrypt non validi.",12:"Nomi Let's Encrypt non validi, non possono contenere un *.",13:"Impossibile configurare il modulo Let's Encrypt.",14:"Nomi Let's Encrypt non validi, impossibile da risolvere: {0}",15:"Indirizzo email Let's Encrypt non valido, impossibile da risolvere: {0}",16:"Impossibile caricare l'elenco di indirizzi IPv6 del proxy attendibile CloudFlare.",17:"Il server SendGrid ha un uso limitato in modalità LAN.",18:"Il server SMTP ha un uso limitato in modalità LAN.",19:"Il gateway SMS ha un uso limitato in modalità LAN.",20:'"LoginCookieEncryptionKey" non valido in config.json.',21:"Il percorso di backup non può essere impostato all'interno della cartella meshcentral-data, le impostazioni di backup ignorate.",22:"Impossibile firmare l'agente {0}: {1}",23:"Unable to load agent icon file: {0}.",24:"Unable to load agent logo file: {0}.",25:"This NodeJS version does not support OpenID.",26:"This NodeJS version does not support Discord.js.",27:"Firebase now requires a service account JSON file, Firebase disabled."},e="";for(r in i.warnings)"string"==typeof(t=i.warnings[r])?e+="<div style=color:red;padding-bottom:6px><b>AVVERTIMENTO:"+t+"</b></div>":(null==(n=F[t.id])?n=t.msg:null!=t.args&&(n=format(n,...t.args)),e+="<div style=color:red;padding-bottom:6px><b>AVVERTIMENTO:"+n+"</b></div>");QH("serverWarnings",e),QV("serverWarningsDiv",!0)}break;case"servertimelinestats":setServerTimelineStats(i.events);break;case"authcookie":authCookie=i.cookie,authRelayCookie=i.rcookie;break;case"serverinfo":if((serverinfo=i.serverinfo).timeout&&(setInterval(checkIdleSessionTimeout,1e4),checkIdleSessionTimeout()),1==debugmode&&console.log("Server time: ",printDateTime(new Date(serverinfo.serverTime))),setupServiceWorker(),null!=serverinfo.certExpire&&0<=(c=Math.floor((serverinfo.certExpire-Date.now())/864e5))&&c<20&&(QH("serverCertWarnings","<div style=color:red;padding-bottom:6px><b>AVVERTIMENTO:"+format("Il certificato scade tra {0} giorno(i)",c)+"</b></div>"),QV("serverWarningsDiv",!0),addNotification({text:format("Il certificato scade tra {0} giorno(i)",c)})),serverinfo.preConfiguredRemoteInput){e="";for(r in serverinfo.preConfiguredRemoteInput)e+='<div class="cmtext" onclick="cmdeskpreconfigtypeaction('+r+',event)">'+EscapeHtml(serverinfo.preConfiguredRemoteInput[r].name)+"</div>";""!=e&&(e+="<hr />"),QH("deskPreConfigShortcutContextMenu1",e)}if(serverinfo.preConfiguredScripts){var e="",t="";for(r in serverinfo.preConfiguredScripts){var o=serverinfo.preConfiguredScripts[r],n='<div class="cmtext" onclick="cmdeskpreconfigscriptaction('+r+',event)">'+EscapeHtml(serverinfo.preConfiguredScripts[r].name)+"</div>";3!=o.type&&(e+=n),3<=o.type&&(t+=n)}QH("deskPreConfigScriptContextMenu1",e),QH("deskPreConfigScriptContextMenu2",t)}break;case"userinfo":userinfo=i.userinfo,updateSiteAdmin(),updateSelf();break;case"users":for(var a in users={},i.users)users[i.users[a]._id]=i.users[a];null!=currentUser&&(currentUser=users[currentUser._id]),mainUpdate(16384),updateSelf();break;case"wssessioncount":wssessions=i.wssessions,mainUpdate(16384);break;case"meshes":for(var a in meshes={},i.meshes)meshes[i.meshes[a]._id]=i.meshes[a];null!=currentMesh&&(currentMesh=meshes[currentMesh._id]),mainUpdate(132);break;case"usergroups":var s=0;if(Array.isArray(i.ugroups))for(var r in usergroups={},i.ugroups)s++,usergroups[i.ugroups[r]._id]=i.ugroups[r];else for(var r in usergroups=i.ugroups,i.ugroups)s++,i.ugroups[r]._id=r;0==s&&(usergroups=null),mainUpdate(8192);break;case"files":filetree=setupBackPointers(i.filetree),updateFiles(),d3updatefiles();break;case"nodes":for(var a in nodes=[],i.nodes)for(var l in i.nodes[a])null==i.nodes[a][l]._id?console.log("Invalid node ("+l+"): "+JSON.stringify(i.nodes)):(null==i.nodes[a][l].name&&(i.nodes[a][l].name="???"),i.nodes[a][l].namel=i.nodes[a][l].name.toLowerCase(),i.nodes[a][l].rname?i.nodes[a][l].rnamel=i.nodes[a][l].rname.toLowerCase():i.nodes[a][l].rnamel=i.nodes[a][l].namel,i.nodes[a][l].meshnamel=meshes[a]?meshes[a].name.toLowerCase():"*",i.nodes[a][l].meshid=a,i.nodes[a][l].state=i.nodes[a][l].state||0,i.nodes[a][l].icon||(i.nodes[a][l].icon=1),i.nodes[a][l].ident=++nodeShortIdent,nodes.push(i.nodes[a][l]));for(var r in stars)null==getNodeFromId(r)&&delete stars[r];null!=currentNode&&0==IsNodeViewable(currentNode)&&(currentNode=null,go(1)),null!=currentNode&&(null!=(currentNode=getNodeFromId(currentNode._id))?gotoDevice(currentNode._id,xxcurrentView,!0):go(1)),devicePagingState=null==i.totalcount?null:{total:i.totalcount,skip:i.skip,limit:i.limit},updateDevicePageState(),mainUpdate(71);break;case"powertimeline":if(i.nodeid==powerTimelineReq){for(var r in powerTimelineNode=i.nodeid,powerTimeline=i.timeline,powerTimelineUpdate=Date.now()+3e5,powerTimeline)r%2==1&&(powerTimeline[r]=1e3*powerTimeline[r]);currentNode._id==i.nodeid&&mainUpdate(256)}break;case"deviceShares":i.nodeid==deviceSharesReq&&(deviceSharesNode=i.nodeid,deviceShares=i.deviceShares,null!=currentNode&&currentNode._id==i.nodeid)&&gotoDevice(currentNode._id,xxcurrentView,!0);break;case"deviceMeshShares":i.meshid==deviceSharesReq&&(deviceSharesNode=i.meshid,deviceShares=i.deviceShares,null!=currentMesh&&currentMesh._id==i.meshid)&&p20updateMesh();break;case"getsysinfo":i.nodeid==powerTimelineReq&&(!0===i.noinfo?updateDeviceDetails(getNodeFromId(i.nodeid)):updateDeviceDetails(getNodeFromId(i.nodeid),i.hardware));break;case"lastconnect":null!=(T=getNodeFromId(i.nodeid))&&(T.lastconnect=i.time,T.lastaddr=i.addr,currentNode._id==T._id)&&""==Q("MainComputerState").innerHTML&&null!=T.lastconnect&&QH("MainComputerState","<span>Ultima visualizzazione:<br />"+printDateTime(new Date(T.lastconnect))+"</span>");break;case"lastconnects":var H=Object.keys(i.lastconnects);for(r in H){var B=H[r];null!=(T=getNodeFromId(B))&&(T.lastconnect=i.lastconnects[B])}mainUpdate(4);case"msg":if(null!=i.nodeid){var d=-1;if(null!=nodes)for(var r in nodes)if(nodes[r]._id==i.nodeid){d=r;break}if(-1!=d)if("cpuinfo"===i.type&&null!=currentNode&&currentNode._id==i.nodeid){var c=Date.now()/1e3,u=0,p=0;"number"==typeof i.cpu.total&&(u=i.cpu.total),"number"==typeof i.memory.percentConsumed&&(p=i.memory.percentConsumed),deviceDetailsStatsData.push([c,u,p]),deviceDetailsStatsDraw(i)}else if("console"===i.type)p15consoleReceive(nodes[d],i.value,i.source);else if("notify"===i.type){if(0==(8&(l=getstore("notifications",0)))&&null!=i.amtMessage)break;l={text:i.value,title:i.title,icon:i.icon,titleid:i.titleid,msgid:i.msgid,args:i.args};null!=i.id&&(l.id=i.id),null!=i.nodeid&&(l.nodeid=i.nodeid),null!=i.tag&&(l.tag=i.tag),null!=i.url&&(l.url=i.url),null!=i.username&&(l.username=i.username),"number"==typeof i.maxtime&&(l.maxtime=i.maxtime),addNotification(l)}else if("ps"===i.type)showDeskToolsProcesses(i);else if("services"===i.type)showDeskToolsServices(i);else if("service"===i.type)showServiceDetailsDialog(i);else if("getclip"===i.type&&null!=currentNode&&currentNode._id==i.nodeid)1==i.tag&&"clipboard"===xxdialogTag?Q("d2clipText").value=i.data:2===i.tag&&null!=navigator.clipboard&&navigator.clipboard.writeText(i.data).then(function(){}).catch(function(e){console.log(e)});else if("setclip"===i.type&&"clipboard"===xxdialogTag&&null!=currentNode&&currentNode._id==i.nodeid)QH("dlgClipStatus",i.success?"<span style=color:green>Successo</span>":"<span style=color:red>Fallito</span>"),setTimeout(function(){try{QH("dlgClipStatus","")}catch(e){}},2e3);else if("userSessions"===i.type&&null!=currentNode&&currentNode._id===i.nodeid&&null==desktop){var m=[];if(null!=i.data)for(var r in i.data)"Active"!=i.data[r].State&&"Connected"!=i.data[r].State&&"Console"!=i.data[r].StationName&&3!=debugmode||m.push(i.data[r]);if(0===m.length)connectDesktop(null,1,null,i.tag);else if(1===m.length)connectDesktop(null,1,m[0].SessionId,i.tag);else{var e="",g="{{{userSessionsSort}}}";for(r in m.sort(function(e,t){return e[g]?t[g]?e[g]<t[g]?-1:t[g]<e[g]?1:0:1:-1}),m)e+='<div style="text-align:left;cursor:pointer;background-color:gray;margin:5px;padding:5px;border-radius:5px" onclick=connectDesktop(event,1,'+m[r].SessionId+","+i.tag+")>"+m[r].State+(m[r].StationName?", "+m[r].StationName:""),m[r].Username&&(m[r].Domain?e+=" - "+m[r].Domain+"/"+m[r].Username:e+=" - "+m[r].Username),e+="</div>";QH("p11DeskSessionSelector",e),QV("p11DeskSessionSelector",!0)}}else"psinfo"===i.type?xxdialogTag==="ps|"+i.nodeid+"|"+i.pid&&(e="<div style=max-height:200px;overflow-y:auto>","object"==typeof i.value&&0<Object.keys(i.value).length?(i.value=jsonToCamel(i.value),!i.value.cmd&&i.value.path&&(i.value.cmd=i.value.path),!i.value.processUser&&i.value.userName&&(i.value.processUser=i.value.userName.split("\\")[1]),!i.value.processDomain&&i.value.userName&&(i.value.processDomain=i.value.userName.split("\\")[0]),i.value.processName&&(e+="<div style=padding:4px><div style=padding-bottom:4px>Nome del processo</div><div style=word-wrap:break-word;padding-left:6px><b>"+i.value.processName+"</b></div></div>"),i.value.machineName&&(e+=addHtmlValue5("Nome della macchina",i.value.machineName)),i.value.cmd&&(e+="<div style=padding:4px><div style=padding-bottom:4px>Riga di comando</div><div style=word-wrap:break-word;padding-left:6px><b>"+i.value.cmd+"</b></div></div>"),i.value.mainWindowTitle&&(e+="<div style=padding:4px><div style=padding-bottom:4px>Titolo della finestra</div><div style=word-wrap:break-word;padding-left:6px><b>"+i.value.mainWindowTitle+"</b></div></div>"),i.value.processUser&&(e+=addHtmlValue5("Utente",i.value.processUser)),i.value.processDomain&&(e+=addHtmlValue5("Dominio",i.value.processDomain)),i.value.startTime&&(e+=addHtmlValue5("Ora di inizio",i.value.startTime)),e+="<hr />",i.value.PriorityBoostEnabled&&(e+=addHtmlValue5("Potenziamento priorità",i.value.PriorityBoostEnabled?"Abilitato":"Disabilitato")),i.value.sessionId&&(e+=addHtmlValue5("ID sessione",i.value.sessionId)),i.value.handleCount&&(e+=addHtmlValue5("Gestire il conteggio",i.value.handleCount)),i.value.privilegedProcessorTime&&(e+=addHtmlValue5("Tempo processore privilegiato",format("{0} secondi",i.value.privilegedProcessorTime))),i.value.totalProcessorTime&&(e+=addHtmlValue5("Tempo totale del processore",format("{0} secondi",i.value.totalProcessorTime))),i.value.userProcessorTime&&(e+=addHtmlValue5("Tempo processore utente",format("{0} secondi",i.value.userProcessorTime))),i.value.nonpagedSystemMemorySize&&(e+=addHtmlValue5("Memoria non paginata",getNiceSize2(i.value.nonpagedSystemMemorySize))),i.value.pagedMemorySize&&(e+=addHtmlValue5("Memoria paginata",getNiceSize2(i.value.pagedMemorySize))),i.value.privateMemorySize&&(e+=addHtmlValue5("Memoria privata",getNiceSize2(i.value.privateMemorySize))),i.value.virtualMemorySize&&(e+=addHtmlValue5("Memoria virtuale",getNiceSize2(i.value.virtualMemorySize))),i.value.workingSet&&(e+=addHtmlValue5("Set di lavoro",getNiceSize2(i.value.workingSet))),i.value.peakWorkingSet&&(e+=addHtmlValue5("Set di lavoro di picco",getNiceSize2(i.value.peakWorkingSet))),i.value.peakPagedMemorySize&&(e+=addHtmlValue5("Memoria paginata di picco",getNiceSize2(i.value.peakPagedMemorySize))),i.value.peakVirtualMemorySize&&(e+=addHtmlValue5("Memoria virtuale di picco",getNiceSize2(i.value.peakVirtualMemorySize)))):e+="Nessuna informazione fornita",e+="</div>",QH("id_dialogOptions",e)):"deskBackground"===i.type&&(""!=i.data?Q("DeskBackgroundButtonImage").style.color="":Q("DeskBackgroundButtonImage").style.color="red")}else"notify"===i.type&&(l={text:i.value,title:i.title,icon:i.icon,titleid:i.titleid,msgid:i.msgid,args:i.args},null!=i.id&&(l.id=i.id),null!=i.tag&&(l.tag=i.tag),null!=i.url&&(l.url=i.url),null!=i.username&&(l.username=i.username),"number"==typeof i.maxtime&&(l.maxtime=i.maxtime),addNotification(l));break;case"getnetworkinfo":if(currentNode._id!=i.nodeid)return;if(updateDeviceDetails(getNodeFromId(i.nodeid),null,i),2==xxdialogMode&&xxdialogTag=="if"+i.nodeid){var e="<div class=dialogText>";if(currentNode.lastconnect&&(e+=addHtmlValue2("Ultimo collegamento dell'agente",printDateTime(new Date(currentNode.lastconnect)))),currentNode.lastaddr&&(2<(c=currentNode.lastaddr.split(":")).length?e+=addHtmlValue2("Ultimo indirizzo dell'agente",currentNode.lastaddr+' <i class="fa-fw fa-regular fa-clipboard fa-sm" role=button title="Copia l\'indirizzo negli appunti" onclick=copyTextToClip2("'+encodeURIComponentEx(currentNode.lastaddr)+'")></i>'):isPrivateIP(currentNode.lastaddr)?e+=addHtmlValue2("Ultimo indirizzo dell'agente",c[0]+' <i class="fa-fw fa-regular fa-clipboard fa-sm" role=button title="Copia l\'indirizzo negli appunti" onclick=copyTextToClip2("'+encodeURIComponentEx(c[0])+'")></i>'):e+=addHtmlValue2("Ultimo indirizzo dell'agente",'<a href="https://iplocation.com/?ip='+c[0]+'" rel="noreferrer noopener" target="MeshIPLoopup">'+c[0]+'</a> <i class="fa-fw fa-regular fa-clipboard fa-sm" role=button title="Copia l\'indirizzo negli appunti" onclick=copyTextToClip2("'+encodeURIComponentEx(c[0])+'")></i>')),null!=i.updateTime&&(e+=addHtmlValue2("Ultimo aggiornamento delle interfacce",printDateTime(new Date(i.updateTime)))),null!=i.netif)for(var r in i.netif)e+="<hr />",(v=i.netif[r]).name&&(e+=addHtmlValue2("Nome","<b>"+EscapeHtml(v.name)+"</b>")),v.desc&&(e+=addHtmlValue2("Descrizione",EscapeHtml(v.desc).replace("(R)","&reg;").replace("(r)","&reg;"))),v.dnssuffix&&(e+=addHtmlValue2("Suffisso DNS",EscapeHtml(v.dnssuffix)+' <i class="fa-fw fa-regular fa-clipboard fa-sm" role=button title="Copia il nome negli appunti" onclick=copyTextToClip2("'+encodeURIComponentEx(v.dnssuffix)+'")></i>')),v.mac&&(e+=addHtmlValue2("Indirizzo MAC",'<a href="https://maclookup.app/search/result?mac='+v.mac.substring(0,6)+'" rel="noreferrer noopener" target="MeshMACLoopup">'+EscapeHtml(v.mac.toLowerCase())+'</a> <i class="fa-fw fa-regular fa-clipboard fa-sm" role=button title="Copia l\'indirizzo MAC negli appunti" onclick=copyTextToClip2("'+encodeURIComponentEx(v.mac.toLowerCase())+'")></i>')),v.v4addr&&(e+=addHtmlValue2("Indirizzo IPv4",EscapeHtml(v.v4addr)+' <i class="fa-fw fa-regular fa-clipboard fa-sm" role=button title="Copia l\'indirizzo negli appunti" onclick=copyTextToClip2("'+encodeURIComponentEx(v.v4addr)+'")></i>')),v.v4mask&&(e+=addHtmlValue2("Maschera IPv4",EscapeHtml(v.v4mask)+' <i class="fa-fw fa-regular fa-clipboard fa-sm" role=button title="Copia l\'indirizzo negli appunti" onclick=copyTextToClip2("'+encodeURIComponentEx(v.v4mask)+'")></i>')),v.v4gateway&&(e+=addHtmlValue2("Gateway IPv4",EscapeHtml(v.v4gateway)+' <i class="fa-fw fa-regular fa-clipboard fa-sm" role=button title="Copia l\'indirizzo negli appunti" onclick=copyTextToClip2("'+encodeURIComponentEx(v.v4gateway)+'")></i>')),v.gatewaymac&&(e+=addHtmlValue2("Gateway MAC",'<a href="https://maclookup.app/search/result?mac='+v.gatewaymac.substring(0,6)+'" rel="noreferrer noopener" target="MeshMACLoopup">'+EscapeHtml(v.gatewaymac.toLowerCase())+'</a> <i class="fa-fw fa-regular fa-clipboard fa-sm" role=button title="Copia l\'indirizzo MAC negli appunti" onclick=copyTextToClip2("'+encodeURIComponentEx(v.gatewaymac.toLowerCase())+'")></i>'));else if(null!=i.netif2)for(var r in i.netif2){var v=i.netif2[r];if(!(0==Array.isArray(v)||v.length<1||null==v[0]||"string"==typeof v[0].mac&&v[0].mac.startsWith("00:00:00:00"))){e=(e+="<hr />")+addHtmlValue2("Nome","<b>"+EscapeHtml(r)+"</b>"),"string"==typeof v[0].mac&&(e+=addHtmlValue2("Indirizzo MAC",'<a href="https://maclookup.app/search/result?mac='+v[0].mac.split(":").join("").substring(0,6)+'" rel="noreferrer noopener" target="MeshMACLoopup">'+EscapeHtml(v[0].mac.toLowerCase())+'</a> <i class="fa-fw fa-regular fa-clipboard fa-sm" role=button title="Copia l\'indirizzo MAC negli appunti" onclick=copyTextToClip2("'+encodeURIComponentEx(v[0].mac.toLowerCase())+'")></i>')),v[0].fqdn&&(e+=addHtmlValue2("FQDN",v[0].fqdn));for(var h=0;h<v.length;h++){var f=v[h];"IPv6"==f.family?(f.address&&(e+=addHtmlValue2("Indirizzo IPv6",EscapeHtml(f.address)+' <i class="fa-fw fa-regular fa-clipboard fa-sm" role=button title="Copia l\'indirizzo negli appunti" onclick=copyTextToClip2("'+encodeURIComponentEx(f.address)+'")></i>')),f.netmask&&(e+=addHtmlValue2("Maschera IPv6",EscapeHtml(f.netmask)+' <i class="fa-fw fa-regular fa-clipboard fa-sm" role=button title="Copia l\'indirizzo negli appunti" onclick=copyTextToClip2("'+encodeURIComponentEx(f.netmask)+'")></i>')),f.gateway&&(e+=addHtmlValue2("Gateway IPv6",EscapeHtml(f.gateway)+' <i class="fa-fw fa-regular fa-clipboard fa-sm" role=button title="Copia l\'indirizzo negli appunti" onclick=copyTextToClip2("'+encodeURIComponentEx(f.gateway)+'")></i>'))):"IPv4"==f.family&&(f.address&&(e+=addHtmlValue2("Indirizzo IPv4",EscapeHtml(f.address)+' <i class="fa-fw fa-regular fa-clipboard fa-sm" role=button title="Copia l\'indirizzo negli appunti" onclick=copyTextToClip2("'+encodeURIComponentEx(f.address)+'")></i>')),f.netmask&&(e+=addHtmlValue2("Maschera IPv4",EscapeHtml(f.netmask)+' <i class="fa-fw fa-regular fa-clipboard fa-sm" role=button title="Copia l\'indirizzo negli appunti" onclick=copyTextToClip2("'+encodeURIComponentEx(f.netmask)+'")></i>')),f.gateway)&&(e+=addHtmlValue2("Gateway IPv4",EscapeHtml(f.gateway)+' <i class="fa-fw fa-regular fa-clipboard fa-sm" role=button title="Copia l\'indirizzo negli appunti" onclick=copyTextToClip2("'+encodeURIComponentEx(f.gateway)+'")></i>'))}}}else e+="<hr />Nessuna informazione sull'interfaccia di rete disponibile per questo dispositivo. ";e+="</div>",QH("d2netinfo",e)}break;case"serverversion":2==xxdialogMode&&"MeshCentralServerUpdate"==xxdialogTag&&(e="<div class=dialogText>",i.tags.current||(i.tags.current="Sconosciuto"),i.tags.stable||(i.tags.stable="Sconosciuto"),i.tags.latest||(i.tags.latest="Sconosciuto"),e=(e=(e=e+addHtmlValue2("Versione corrente","<b>"+EscapeHtml(i.tags.current)+"</b>")+"<hr />")+addHtmlValue2('<label><input id=d2updateCheck1 type=checkbox class="form-check-input me-2" onclick=server_showVersionDlgUpdate()'+("Sconosciuto"==i.tags.stable||i.tags.current==i.tags.stable||0==(2048&features)?" disabled":"")+" /> Versione stabile</label>","<b>"+EscapeHtml(i.tags.stable)+"</b>"))+addHtmlValue2('<label><input id=d2updateCheck2 type=checkbox class="form-check-input me-2" onclick=server_showVersionDlgUpdate()'+("Sconosciuto"==i.tags.latest||i.tags.current==i.tags.latest||0==(2048&features)?" disabled":"")+" /> Ultima versione</label>","<b>"+EscapeHtml(i.tags.latest)+"</b>")+"</div>",i.tags.current==i.tags.latest&&i.tags.current==i.tags.stable||0==(2048&features)?(setModalContent("xxAddAgent","Versione MeshCentral",e),showModal("xxAddAgentModal","idx_dlgOkButton")):(xxdialogTag=i.tags,setModalContent("xxAddAgent","Versione MeshCentral",e+="<hr />Selezionare e fare clic su OK per avviare l'aggiornamento automatico del server."),showModal("xxAddAgentModal","idx_dlgOkButton",function(){server_showVersionDlgEx(2,i.tags)}),server_showVersionDlgUpdate()));break;case"servererrors":2==xxdialogMode&&"MeshCentralServerErrors"==xxdialogTag&&(null==i.data?(setModalContent("xxAddAgent","Server Errors","Il server non ha un registro degli errori."),showModal("xxAddAgentModal","idx_dlgOkButton")):(setModalContent("xxAddAgent","Errori del server MeshCentral",e=(e='<div class="dialogText dialogTextLog"><pre id=d2ServerErrorsLogPre>'+EscapeHtml(i.data)+"</pre></div>")+'<br /><div style=float:right><i role=button class="fa-fw fa-solid fa-download fa-sm" title="Scarica il registro degli errori" onclick=d2CopyServerErrorsToClip()></i></div>'+'<div><label><input id=d2clearErrorsCheck type=checkbox class="form-check-input me-2" onclick=server_showErrorsDlgUpdate() /> Controllare e fare clic su OK per cancellare il registro degli errori.</label></div>'),showModal("xxAddAgentModal","idx_dlgOkButton",server_showErrorsDlgEx),server_showErrorsDlgUpdate()));break;case"serverconfig":2==xxdialogMode&&"MeshCentralServerConfig"==xxdialogTag&&(null==i.data?setModalContent("xxAddAgent","Server Configuration","Server has no config file.","extra-large"):(setModalContent("xxAddAgent","Server Configuration",4,"extra-large"),QV("d4EncodingButton",!1),QV("d4LineBreakButton",!1),Q("d4editorarea").value=i.data,Q("d4editorarea").setAttribute("readonly","readonly")),showModal("xxAddAgentModal","idx_dlgOkButton"));break;case"serverconsole":p15consoleReceive("serverconsole",i.value);break;case"events":null!=i.nodeid&&null!=currentNode&&i.nodeid==currentNode._id?(currentDeviceEvents=i.events,mainUpdate(1024)):null!=i.userid&&null!=currentUser&&i.userid==currentUser._id?(currentUserEvents=i.events,mainUpdate(2048)):(events=i.events,mainUpdate(32));break;case"recordings":p52recordings=i.events,null!=i.error&&(p52recordings=i.error),updateRecordings();break;case"getcookie":"MCRouter"==i.tag?(-1!=(_=serverinfo.name).indexOf(".")&&0==(2&features)||(_=window.location.hostname),domainUrl.substring(0,domainUrl.length-1),V="mcrouter://"+_+(443==serverinfo.port?"":":"+serverinfo.port)+domainUrl+"control.ashx?c="+authCookie+"&t="+serverinfo.tlshash+"&l={{{lang}}}"+(urlargs.key?"&key="+urlargs.key:""),null!=i.nodeid&&(V+="&nodeid="+i.nodeid),null!=i.tcpport&&(V+="&protocol=1&remoteport="+i.tcpport),i.localRelay&&(V+="&local=1"),i.localport&&(V+="&localport="+i.localport),null!=i.name&&(V+="&name="+encodeURIComponentEx(i.name)),null!=i.ip&&(V+="&remoteip="+i.ip),downloadFile(V+="&appid="+i.protocol+"&autoexit=1","")):"novnc"==i.tag?(u=window.location.origin+domainUrl+"novnc/vnc.html?ws=wss%3A%2F%2F"+window.location.host+encodeURIComponentEx(domainUrl)+(i.localRelay?"local":"mesh")+"relay.ashx%3Fauth%3D"+i.cookie+"&show_dot=1"+(urlargs.key?"&key="+urlargs.key:"")+"&l={{{lang}}}",null!=(T=getNodeFromId(i.nodeid))&&(u+="&name="+encodeURIComponentEx(T.name)),safeNewWindow(u,"mcnovnc/"+i.nodeid)):"mstsc"==i.tag?(p=window.location.origin+domainUrl+"mstsc.html?ws="+i.cookie+(urlargs.key?"&key="+urlargs.key:""),null!=(T=getNodeFromId(i.nodeid))&&(p+="&name="+encodeURIComponentEx(T.name)),i.localRelay&&(p+="&local=1"),safeNewWindow(p,"mcmstsc/"+i.nodeid)):"ssh"==i.tag&&(c=window.location.origin+domainUrl+"ssh.html?ws="+i.cookie+(urlargs.key?"&key="+urlargs.key:""),null!=(T=getNodeFromId(i.nodeid))&&(c+="&name="+encodeURIComponentEx(T.name)),i.localRelay&&(c+="&local=1"),safeNewWindow(c,"mcssh/"+i.nodeid));break;case"getNotes":(l=Q("d2devNotes"))&&i.id==decodeURIComponent(l.attributes.noteid.value)?(i.notes?QH("d2devNotes",decodeURIComponent(i.notes)):QH("d2devNotes",""),0==("true"==l.attributes.ro.value)&&(l.removeAttribute("readonly"),QE("idx_dlgOkButton",!0),QV("idx_dlgOkButton",!0),focusTextBox("d2devNotes"))):(Q("notesPanelArea").innerHTML=i.notes&&marked&&DOMPurify?DOMPurify.sanitize(marked.parse(decodeURIComponent(i.notes),{breaks:!0}),{USE_PROFILES:{html:!0}}):"","true"===showNotesPanel&&i.notes?QV("notesPanel",!0):QV("notesPanel",!1));break;case"otpauth-request":2==xxdialogMode&&"otpauth-request"==xxdialogTag&&(null!=i.err?(u=["","2FA è bloccato","I codici di backup sono bloccati","Token di accesso in uso","OTP 2FA non consentito","L'account è bloccato","Impossibile caricare OTPLIB"],0<i.err&&i.err<u.length?QH("d2optinfo",u[i.err]):QH("d2optinfo",format("Errore n.{0}",i.err))):(52==(p=i.secret).length?p=p.split(/(.............)/).filter(Boolean).join(" "):32==p.length&&(p=(p=p.split(/(....)/).filter(Boolean).join(" ")).substring(0,20)+"<br/>"+p.substring(20)),QH("d2optinfo","<table style=width:380px><tr><td style=vertical-align:top>"+format('Installare <a href="https://play.google.com/store/apps/details?id=com.google.android.apps.authenticator2" rel="noreferrer noopener" target=_blank>Google Authenticator</a> o un\'applicazione compatibile ed esegui la scansione del codice a barre, utilizza <a href="{0}" rel="noreferrer noopener" target=_blank> questo link </ a > o inserisci il segreto. Quindi, inserisci l\'attuale token a 6 cifre di seguito per attivare l\'accesso in 2 passaggi.',i.url)+'<br /><br />Secret <img src=images/link4.png height=10 width=10 title="Copy Secret to clipboard" style=cursor:pointer onclick=d2CopySecretToClip()><br /><tt id=d2optsecret secret="'+i.secret+'" style=font-size:12px>'+p+'</tt><br /><br /></td><td style=width:1px;vertical-align:top><a href="'+i.url+'" rel="noreferrer noopener" target=_blank><div id="qrcode"></div></a></td><tr><td colspan=2 style="text-align:center;border-top:1px solid black"><br />Inserisci qui il token per l\'accesso in due passaggi: <input type=text autocomplete="one-time-code" inputmode="numeric" pattern="[0-9]*" onkeypress="return (event.keyCode == 8) || (event.charCode >= 48 && event.charCode <= 57)" onkeyup=account_addOtpCheck(event) onkeydown=account_addOtpCheck() maxlength=6 id=d2otpauthinput type=text></td></table>'),new QRCode(Q("qrcode"),{text:i.url,width:128,height:128,colorDark:"#000000",colorLight:"#EEE",correctLevel:QRCode.CorrectLevel.H}),QV("idx_dlgOkButton",!0),QE("idx_dlgOkButton",!1),Q("d2otpauthinput").focus()));break;case"otpauth-setup":if(xxdialogMode)return;setModalContent("xxAddAgent","App Autenticatrice",i.success?"<b style=color:green>Attivazione dell'app di autenticazionea 2 fattori  riuscita</b> Ora avrai bisogno di un token valido per accedere di nuovo. ":"<b style=color:red>Impossibile abilitare l'autenticazione a due fattori.</b> Cancella il segreto dall'applicazione e riprova. Hai solo pochi minuti per inserire il codice corretto."),showModal("xxAddAgentModal","idx_dlgOkButton");break;case"otpauth-clear":if(xxdialogMode)return;setModalContent("xxAddAgent","App Autenticatrice",i.success?"<b>Applicazione di autenticazione  a 2 fattori  rimossa.</b> Puoi riattivare questa funzione in qualsiasi momento. ":"<b style=color:red>Impossibile rimuovere l'autenticazione a due fattori.</b> Riprova."),showModal("xxAddAgentModal","idx_dlgOkButton");break;case"otpauth-getpasswords":if(xxdialogMode)return;e="I token una tantum possono essere utilizzati come autenticazione secondaria. Genera un set, stampali e conservali in un luogo sicuro.";if(e+='<div style="border-radius:6px;border: 2px dashed #888;width:100%;margin-top:8px"><div style="padding:8px;font-family:Arial, Helvetica, sans-serif;font-size:20px;font-weight:bold"><table class=selecttext style=width:100%;text-align:center>',i.passwords){var h=0,x="";for(r in i.passwords){++h%2&&(e+="<tr>");for(var k=""+i.passwords[r].p;k.length<8;)k="0"+k;!0===i.passwords[r].u?(e+="<td>"+k.substring(0,4)+"&nbsp;"+k.substring(4),""!=x&&(x+=" "),x+=k):e+="<td><strike style=color:#BBB>"+k.substring(0,4)+"&nbsp;"+k.substring(4)}}else e+="<tr><td>Nessun token attivo";e=(e+="</table></div></div><br />")+"<div>"+'<input type=button value="Genera nuovi token" onclick="account_manageOtp(1);"></input>',null!=i.passwords&&(e=(e+='<input type=button value="Tokens cancellati" onclick="account_manageOtp(2);"></input>')+'&nbsp;<img src=images/link4.png height=10 width=10 title="Copia i codici validi negli appunti" style=cursor:pointer onclick=copyTextToClip2("'+encodeURIComponentEx(x)+'")>'),setModalContent("xxAddAgent","Gestisci codici di backup",e+="</div><br />"),showModal("xxAddAgentModal","idx_dlgOkButton");break;case"otp-hkey-get":if(xxdialogMode&&"otpauth-hardware-manage"!=xxdialogTag)return;var O='<div style="border-radius:6px;border:2px solid #CCC;background-color:#BBB;width:100%;box-sizing:border-box;margin-bottom:6px"><div style="margin:3px;font-family:Arial, Helvetica, sans-serif;font-size:16px;font-weight:bold"><table style=width:100%;text-align:left>',P="</table></div></div>",e='<a href="https://www.yubico.com/" rel="noreferrer noopener" target="_blank">chiavi hardware</a> vengono utilizzate come autenticazione di accesso secondaria.';if(e+='<div style="max-height:150px;overflow-y:auto;overflow-x:hidden;margin-top:6px;margin-bottom:6px">',i.keys&&0<i.keys.length)for(var r in i.keys){var L=i.keys[r];e+=O+'<tr style=margin:5px><td style=width:30px><img width=24 height=18 src="images/hardware-key-'+(U=2==L.type?"OTP":"WebAuthn")+'-24.png" style=margin-top:4px><td style=width:250px>'+L.name+'<td><input type=button value="Rimuovere" onclick=account_removehkey('+L.i+")></input>"+P}else e+=O+"<tr style=text-align:center><td>Nessuna chiave configurata"+P;e=e+"</div>"+"<div>";c="number"==typeof userinfo.otphkeys?userinfo.otphkeys:0;"number"!=typeof serverinfo.maxfidokeys||serverinfo.maxfidokeys>c?(0!=(131072&features)&&(e+='<input id=d2addkey3 type=button value="Aggiungi chiave" onclick="account_addhkey(3);"></input>'),0!=(16384&features)&&(e+='<input id=d2addkey2 type=button value="Aggiungi YubiKey&reg; OTP" onclick="account_addhkey(2);"></input>')):e+="Massime chiavi raggiunte.",setModalContent("xxAddAgent","Gestisci chiavi di sicurezza",e+="</div><br />"),showModal("xxAddAgentModal","idx_dlgOkButton"),0==u2fSupported()&&QE("d2addkey1",!1);break;case"otp-hkey-yubikey-add":i.result?meshserver.send({action:"otp-hkey-get"}):(setModalContent("xxAddAgent","Aggiungi token di sicurezza","<br />Errore, impossibile aggiungere la chiave.<br /><br />"),showModal("xxAddAgentModal","idx_dlgOkButton"));break;case"otp-hkey-setup-response":if(xxdialogMode&&"otpauth-hardware-manage"!=xxdialogTag)return;1==i.result?meshserver.send({action:"otp-hkey-get"}):(setModalContent("xxAddAgent","Aggiungi token di sicurezza","<br />Errore, impossibile aggiungere la chiave.<br /><br />"),showModal("xxAddAgentModal","idx_dlgOkButton"));break;case"webauthn-startregister":if(xxdialogMode&&"otpauth-hardware-manage"!=xxdialogTag)return;setModalContent("xxAddAgent","Aggiungi token di sicurezza",e='Premi il pulsante chiave ora.<br /><br /><div style=width:100%;text-align:center><img width=120 height=117 src="images/hardware-keypress-120.png" /></div><input id=dp1keyname style=display:none value='+i.name+" />");u=i.request;i.request.challenge=Uint8Array.from(atob(i.request.challenge),function(e){return e.charCodeAt(0)}),i.request.user.id=Uint8Array.from(atob(i.request.user.id),function(e){return e.charCodeAt(0)}),navigator.credentials.create({publicKey:u}).then(function(e){meshserver.send({action:"webauthn-endregister",response:{rawId:btoa(String.fromCharCode.apply(null,new Uint8Array(e.rawId))),response:{attestationObject:btoa(String.fromCharCode.apply(null,new Uint8Array(e.response.attestationObject))),clientDataJSON:btoa(String.fromCharCode.apply(null,new Uint8Array(e.response.clientDataJSON)))},type:e.type}}),setDialogMode(0)},function(e){console.log("ERRORE:"+e),setModalContent("xxAddAgent","Aggiungi token di sicurezza","ERRORE:"+e)}),showModal("xxAddAgentModal","idx_dlgOkButton");break;case"verifyPhone":if(xxdialogMode&&"verifyPhone"!=xxdialogTag)return;setModalContent("xxAddAgent","Notifiche telefoniche",e=(e='<table><tr><td><img src="images/phone80.png" style=padding:8px>')+"<td>Controlla il tuo telefono e inserisci il codice di verifica."+'<br /><br /><div style=width:100%;text-align:center>Codice di verifica:  <input type=tel pattern="[0-9]" inputmode="number" maxlength=6 id=d2phoneCodeInput onKeyUp=account_managePhoneCodeValidate() onkeypress="if (event.key==\'Enter\') account_managePhoneCodeValidate(1)"></div></table>'),showModal("xxAddAgentModal","idx_dlgOkButton",()=>account_managePhoneConfirm(3,i.cookie)),Q("d2phoneCodeInput").focus(),account_managePhoneCodeValidate();break;case"verifyMessaging":if(xxdialogMode&&"verifyMessaging"!=xxdialogTag)return;setModalContent("xxAddAgent","Messaging Notifications",e=(e='<table><tr><td><img src="images/messaging40.png" style=padding:8px>')+"<td>Check your messaging application and enter the verification code."+'<br /><br /><div style=width:100%;text-align:center>Codice di verifica:  <input type=tel pattern="[0-9]" inputmode="number" maxlength=6 id=d2phoneCodeInput onKeyUp=account_managePhoneCodeValidate() onkeypress="if (event.key==\'Enter\') account_managePhoneCodeValidate(1)"></div></table>'),showModal("xxAddAgentModal","idx_dlgOkButton",()=>account_manageMessagingConfirm(3,i.cookie)),Q("d2phoneCodeInput").focus(),account_managePhoneCodeValidate();break;case"fileoperation":setModalContent("xxAddAgent",EscapeHtml(i.file),4,"extra-large"),showModal("xxAddAgentModal","idx_dlgOkButton",()=>{var e,t;e=i,t=Q("d4editorarea").value,t=0===d4EditLineBreakVal?t.replace(/\r?\n|\r/g,"\r\n"):2===d4EditLineBreakVal?t.replace(/\r\n|\n/g,"\r"):t.replace(/\r\n|\r/g,"\n"),t=1==d4EditEncodingVal?encode_utf8(t):t,meshserver.send({action:"fileoperation",fileop:"set",path:e.path,file:e.file,data:btoa(t)})}),QV("d4EncodingButton",!0),QV("d4LineBreakButton",!0),Q("d4editorarea").value=1==d4EditEncodingVal?decode_utf8(atob(i.data)):atob(i.data);break;case"event":if(!i.event.nolog){if(currentNode&&i.event.nodeid==currentNode._id&&null!=currentDeviceEvents&&(i.event.action==p16filterevents.value||""==p16filterevents.value)){if(null!=currentDeviceEvents){currentDeviceEvents.unshift(i.event);for(var b=parseInt(p16limitdropdown.value);currentDeviceEvents.length>b;)currentDeviceEvents.pop()}mainUpdate(1024)}if(currentUser&&i.event.userid==currentUser._id&&(i.event.action==p31filterevents.value||""==p31filterevents.value)){if(null!=currentUserEvents){currentUserEvents.unshift(i.event);for(b=parseInt(p31limitdropdown.value);currentUserEvents.length>b;)currentUserEvents.pop()}mainUpdate(2048)}if(i.event.action==p3filterevents.value||""==p3filterevents.value){if(null!=events){events.unshift(i.event);for(b=parseInt(p3limitdropdown.value);events.length>b;)events.pop()}mainUpdate(32)}}if(!i.event.noact)switch(i.event.action){case"serverinfochange":null!=i.event.lock2factor&&(serverinfo.lock2factor=i.event.lock2factor,updateSelf(),updateSiteAdmin());break;case"deviceShareUpdate":i.event.nodeid==deviceSharesReq&&(deviceSharesNode=i.event.nodeid,deviceShares=i.event.deviceShares,currentNode._id==deviceSharesNode)&&gotoDevice(currentNode._id,xxcurrentView,!0);break;case"agentlog":98==i.event.msgid&&0<GetNodeRights(i.event.nodeid)&&(l=getNodeFromId(i.event.nodeid),addNotification({text:format("Aiuto richiesto da {0}: {1}",i.event.msgArgs[0],i.event.msgArgs[1]),title:l.name,icon:l.icon,nodeid:i.event.nodeid}));break;case"recording":null!=p52recordings&&"object"==typeof p52recordings&&(p52recordings.unshift(i.event),i.event.present=1,updateRecordings());break;case"userWebState":try{if(null!=localStorage){var y=localStorage.getItem("showRealNames"),w=localStorage.getItem("uiMode"),G=localStorage.getItem("sort"),C=localStorage.getItem("loctag"),W=localStorage.getItem("nightMode"),q=localStorage.getItem("footerBar"),M=JSON.parse(i.event.state);for(r in M)localStorage.setItem(r,M[r]);if(null!=M.showRealNames&&M.showRealNames!=y&&(showRealNames=Q("RealNameCheckBox").checked="1"==M.showRealNames,mainUpdate(6)),null!=M.uiMode&&M.uiMode!=w&&userInterfaceSelectMenu(parseInt(M.uiMode)),null!=M.sort&&M.sort!=G&&(document.getElementById("sortselect").selectedIndex=sort=parseInt(M.sort),mainUpdate(6)),null!=M.loctag&&M.loctag!=C&&(null!=M.loctag?args.locale=M.loctag:delete args.locale,mainUpdate(4294967295)),null!=M.nightMode&&M.nightMode!=W&&(putstore("nightMode",M.nightMode),setNightMode()),null!=M.footerBar&&M.footerBar!=q&&(footerBar="1"==M.footerBar,QS("container")["grid-template-rows"]=null,QS("container")["-ms-grid-rows"]=null,adjustPanels()),null!=M.stars&&M.stars!=JSON.stringify(stars)&&(stars=JSON.parse(M.stars),3==Q("DevFilterSelect").value?mainUpdate(5):mainUpdate(4),currentNode)&&refreshDevice(currentNode._id),null!=M.deskKeyShortcuts){deskKeyboardShortcuts=[];var K=M.deskKeyShortcuts.split(",");for(r in K)""!=K[r]&&deskKeyboardShortcuts.push(parseInt(K[r]));updateDeskShortcutKeys()}if(null!=M.deskStrings){o=null;try{o=JSON.parse(M.deskStrings)}catch(e){}Array.isArray(o)&&(deskKeyboardStrings=o,updateDesktopStrings())}}}catch(e){}break;case"servertimelinestats":addServerTimelineStats(i.event.data);break;case"accountcreate":case"accountchange":if("object"!=typeof i.event.account||null==i.event.account)return void console.log(i.event);userinfo._id==i.event.account._id&&(y=i.event.account.siteadmin||0,w=userinfo.siteadmin||0,G=i.event.account.removeRights||0,C=userinfo.removeRights||0,(i.event.account.quota!=userinfo.quota||0==(8&userinfo.siteadmin)&&0!=(8&i.event.account.siteadmin))&&meshserver.send({action:"files"}),W=userinfo.groups,userinfo=i.event.account,w==y&&C==G&&1!=i.event.accountImageChange||(1==i.event.accountImageChange&&(userinfo.accountImageRnd=Math.floor(9999999999*Math.random())),updateSiteAdmin()),updateSelf(),0!=(2&userinfo.siteadmin)&&(q=userinfo.groups||[],(W||[]).join(",")!=q.join(","))&&(users=wssessions=null,meshserver.send({action:"users"}),meshserver.send({action:"wssessioncount"})),i.event.nodeListChange==userinfo._id)&&meshserver.send({action:"nodes",skip:null==devicePagingState?0:devicePagingState.skip}),currentNode&&refreshDevice(currentNode._id),null!=users&&(null==userinfo.groups||0==userinfo.groups.length||1==findOne(i.event.account.groups,userinfo.groups)?users[i.event.account._id]=i.event.account:delete users[i.event.account._id],mainUpdate(16388));break;case"accountremove":null!=users&&(delete users[i.event.userid],mainUpdate(16384));break;case"createusergroup":case"usergroupchange":w=(usergroups=null==usergroups?{}:usergroups)[i.event.ugrpid];null==w?usergroups[i.event.ugrpid]={_id:i.event.ugrpid,name:i.event.name,desc:i.event.desc,domain:i.event.domain,links:i.event.links}:(w.name=i.event.name,i.event.desc?w.desc=i.event.desc:delete w.desc,i.event.links?w.links=i.event.links:delete w.links,i.event.flags?w.flags=i.event.flags:delete w.flags,"number"==typeof i.event.consent&&(w.consent=i.event.consent)),mainUpdate(28672),meshserver.send({action:"meshes"}),meshserver.send({action:"nodes",skip:null==devicePagingState?0:devicePagingState.skip});break;case"deleteusergroup":if(null!=usergroups&&null!=usergroups[i.event.ugrpid]){delete usergroups[i.event.ugrpid];var S=0;for(r in usergroups)S++;0==S&&(usergroups=null),mainUpdate(24576)}break;case"createmesh":null!=meshes[i.event.meshid]||!serverinfo.manageAllDeviceGroups&&null==i.event.mesh.links[userinfo._id]||(meshes[i.event.meshid]=i.event.mesh,mainUpdate(24708),meshserver.send({action:"files"}));break;case"meshchange":if(null==meshes[i.event.meshid]){var A=!1;for(r in null!=i.event.links[userinfo._id]&&(A=!0),null!=userinfo.links[i.event.meshid]&&(A=!0),userinfo.links)r.startsWith("ugrp/")&&null!=i.event.links[r]&&(A=!0);A&&(meshes[i.event.meshid]={_id:i.event.meshid,name:i.event.name,mtype:i.event.mtype,desc:i.event.desc,links:i.event.links,amt:i.event.amt,invite:i.event.invite,expireDevs:i.event.expireDevs,relayid:i.event.relayid},meshserver.send({action:"nodes",skip:null==devicePagingState?0:devicePagingState.skip}))}else{if(null!=i.event.name)for(var r in meshes[i.event.meshid].name=i.event.name,nodes)nodes[r].meshid==i.event.meshid&&(nodes[r].meshnamel=i.event.name.toLowerCase());if(null!=i.event.desc&&(meshes[i.event.meshid].desc=i.event.desc),null!=i.event.flags&&(meshes[i.event.meshid].flags=i.event.flags),null!=i.event.consent&&(meshes[i.event.meshid].consent=i.event.consent),i.event.links&&(meshes[i.event.meshid].links=i.event.links),i.event.amt&&(meshes[i.event.meshid].amt=i.event.amt),null!=i.event.invite?meshes[i.event.meshid].invite=i.event.invite:delete meshes[i.event.meshid].invite,null!=i.event.expireDevs&&(0<i.event.expireDevs?meshes[i.event.meshid].expireDevs=i.event.expireDevs:delete meshes[i.event.meshid].expireDevs),null!=i.event.relayid&&(meshes[i.event.meshid].relayid=i.event.relayid),0==IsMeshViewable(i.event.meshid)){20==xxcurrentView&&currentMesh==meshes[i.event.meshid]&&go(2),delete meshes[i.event.meshid];var D=[];for(r in nodes)(nodes[r].meshid!=i.event.meshid||null!=userinfo.links&&null!=userinfo.links[nodes[r]._id])&&D.push(nodes[r]);nodes=D,10<=xxcurrentView&&xxcurrentView<20&&currentNode&&!IsNodeViewable(currentNode)&&(setDialogMode(0),go(1))}}mainUpdate(24708),currentNode&&!IsNodeViewable(currentNode)&&(currentNode=null,10<=xxcurrentView)&&xxcurrentView<20&&go(1),20==xxcurrentView&&currentMesh._id==i.event.meshid&&mainUpdate(4096);break;case"deletemesh":meshes[i.event.meshid]&&(delete meshes[i.event.meshid],mainUpdate(128),meshserver.send({action:"files"}));D=[];if(null!=nodes)for(var r in nodes)nodes[r].meshid!=i.event.meshid&&D.push(nodes[r]);nodes=D,mainUpdate(24580),20<=xxcurrentView&&xxcurrentView<30&&currentMesh._id==i.event.meshid&&(setDialogMode(0),go(2)),10<=xxcurrentView&&xxcurrentView<20&&currentNode&&!IsNodeViewable(currentNode)&&(setDialogMode(0),go(1));break;case"addnode":var T=i.event.node;meshes[T.meshid]&&null==getNodeFromId(T._id)&&(T.namel=T.name.toLowerCase(),T.rname?T.rnamel=T.rname.toLowerCase():T.rnamel=T.namel,T.meshnamel=meshes[T.meshid]?meshes[T.meshid].name.toLowerCase():"*",T.state=0,T.icon||(T.icon=1),T.ident=++nodeShortIdent,nodes.push(T),mainUpdate(23),20==xxcurrentView)&&null!=currentMesh&&currentMesh._id==T.meshid&&mainUpdate(4096);break;case"removenode":d=-1;for(r in nodes)if(nodes[r]._id==i.event.nodeid){d=r;break}-1!=d&&(T=nodes[d],currentNode==T&&(10<=xxcurrentView&&xxcurrentView<20&&(setDialogMode(0),go(1)),currentNode=null),nodes.splice(d,1),mainUpdate(20),20==xxcurrentView)&&null!=currentMesh&&currentMesh._id==T.meshid&&mainUpdate(4096);break;case"changenode":d=-1;for(r in nodes)if(nodes[r]._id==i.event.nodeid){d=r;break}if(-1!=d){if((T=nodes[d]).name=i.event.node.name,T.rname=i.event.node.rname,T.lusers=i.event.node.lusers,T.users=i.event.node.users,T.host=i.event.node.host,T.desc=i.event.node.desc,T.ip=i.event.node.ip,T.osdesc=i.event.node.osdesc,T.publicip=i.event.node.publicip,T.iploc=i.event.node.iploc,T.wifiloc=i.event.node.wifiloc,T.gpsloc=i.event.node.gpsloc,T.tags=i.event.node.tags,T.ssh=i.event.node.ssh,T.rdp=i.event.node.rdp,T.userloc=i.event.node.userloc,T.rdpport=i.event.node.rdpport,T.rfbport=i.event.node.rfbport,T.sshport=i.event.node.sshport,T.httpport=i.event.node.httpport,T.httpsport=i.event.node.httpsport,T.consent=i.event.node.consent,T.pmt=i.event.node.pmt,null!=i.event.node.links?T.links=i.event.node.links:delete T.links,null!=i.event.node.agent&&(null==T.agent&&(T.agent={}),null!=i.event.node.agent.ver&&(T.agent.ver=i.event.node.agent.ver),null!=i.event.node.agent.id&&(T.agent.id=i.event.node.agent.id),null!=i.event.node.agent.caps&&(T.agent.caps=i.event.node.agent.caps),null!=i.event.node.agent.root&&(T.agent.root=i.event.node.agent.root),null!=i.event.node.agent.core?T.agent.core=i.event.node.agent.core:T.agent.core&&delete T.agent.core,T.agent.tag=i.event.node.agent.tag),null!=i.event.node.intelamt&&(null==T.intelamt&&(T.intelamt={}),null!=i.event.node.intelamt.state&&(T.intelamt.state=i.event.node.intelamt.state),null!=i.event.node.intelamt.host&&(T.intelamt.user=i.event.node.intelamt.host),null!=i.event.node.intelamt.user?T.intelamt.user=i.event.node.intelamt.user:delete T.intelamt.user,null!=i.event.node.intelamt.tls&&(T.intelamt.tls=i.event.node.intelamt.tls),null!=i.event.node.intelamt.ver&&(T.intelamt.ver=i.event.node.intelamt.ver),null!=i.event.node.intelamt.tag&&(T.intelamt.tag=i.event.node.intelamt.tag),null!=i.event.node.intelamt.uuid&&(T.intelamt.uuid=i.event.node.intelamt.uuid),null!=i.event.node.intelamt.realm&&(T.intelamt.realm=i.event.node.intelamt.realm),null!=i.event.node.intelamt.flags&&(T.intelamt.flags=i.event.node.intelamt.flags),null!=i.event.node.intelamt.warn?T.intelamt.warn=i.event.node.intelamt.warn:delete T.intelamt.warn),null!=i.event.node.av&&(T.av=i.event.node.av),null!=i.event.node.wsc&&(T.wsc=i.event.node.wsc),null!=i.event.node.volumes&&(T.volumes=i.event.node.volumes),T.namel=T.name.toLowerCase(),T.rname?T.rnamel=T.rname.toLowerCase():T.rnamel=T.namel,i.event.node.icon&&(T.icon=i.event.node.icon),i.event.node.meshid!=T.meshid)if(null!=meshes[i.event.node.meshid]||null!=userinfo.links&&null!=userinfo.links[T._id])T.meshid=i.event.node.meshid,T.meshnamel=meshes[i.event.node.meshid]?meshes[i.event.node.meshid].name.toLowerCase():"*",mainUpdate(7);else{null!=currentNode&&currentNode._id==T._id&&10<=xxcurrentView&&xxcurrentView<20&&!IsNodeViewable(currentNode)&&(currentNode=null,setDialogMode(0),go(1));d=-1;for(r in nodes)if(nodes[r]._id==i.event.nodeid){d=r;break}nodes.splice(d,1),mainUpdate(20)}updateDeviceViewDevice(T),mainUpdate(26),refreshDevice(T._id),20==xxcurrentView&&null!=currentMesh&&currentMesh._id==T.meshid&&mainUpdate(4096),currentNode==T&&null!=xxdialogMode&&"@xxmap"==xxdialogTag&&p10showNodeLocationDialog()}break;case"nodemeshchange":d=-1;for(r in nodes)if(nodes[r]._id==i.event.nodeid){d=r;break}if(-1!=d){T=nodes[d];null!=meshes[i.event.newMeshId]||null!=userinfo.links&&null!=userinfo.links[T._id]?(T.meshid=i.event.newMeshId,T.meshnamel=meshes[i.event.newMeshId]?meshes[i.event.newMeshId].name.toLowerCase():"*",mainUpdate(7)):(null!=currentNode&&currentNode._id==T._id&&10<=xxcurrentView&&xxcurrentView<20&&!IsNodeViewable(currentNode)&&(currentNode=null,setDialogMode(0),go(1)),nodes.splice(d,1),mainUpdate(20)),refreshDevice(i.event.nodeid)}else{T=i.event.node;if(!meshes[T.meshid])break;T.namel=T.name.toLowerCase(),T.rname?T.rnamel=T.rname.toLowerCase():T.rnamel=T.namel,T.meshnamel=meshes[T.meshid]?meshes[T.meshid].name.toLowerCase():"*",T.state=0,T.icon||(T.icon=1),T.ident=++nodeShortIdent,nodes.push(T),mainUpdate(23)}break;case"nodeconnect":var E,d=-1;for(r in nodes)if(nodes[r]._id==i.event.nodeid){d=r;break}-1!=d&&(T=nodes[d],l=getstore("notifications",0),i.event.meshid&&userinfo.links&&userinfo.links[i.event.meshid]&&userinfo.links[i.event.meshid].notify&&(l|=userinfo.links[i.event.meshid].notify),null!=userinfo.notify&&(null!=userinfo.notify[i.event.meshid]&&(l|=userinfo.notify[i.event.meshid]),null!=userinfo.notify[i.event.nodeid])&&(l|=userinfo.notify[i.event.nodeid]),2&l&&(y="Agente connesso",null!=T.agent&&!1===T.agent.root&&(y="Agente connesso con privilegi limitati"),E={title:T.name,icon:T.icon,nodeid:T._id,id:i.event.id},0==(1&T.conn)&&0!=(1&i.event.conn)&&(E.text=y,addNotification(E)),0==(2&T.conn)&&0!=(2&i.event.conn)&&(E.text="Rilevata Intel AMT",addNotification(E)),0==(4&T.conn)&&0!=(4&i.event.conn)&&(E.text="Intel AMT CIRA connesso",addNotification(E)),0==(16&T.conn))&&0!=(16&i.event.conn)&&(E.text="MQTT connesso ",addNotification(E)),4&l&&(E={title:T.name,icon:T.icon,nodeid:T._id,id:i.event.id},0!=(1&T.conn)&&0==(1&i.event.conn)&&(E.text="Agente disconnesso",addNotification(E)),0!=(2&T.conn)&&0==(2&i.event.conn)&&(E.text="Intel AMT non rilevato",addNotification(E)),0!=(4&T.conn)&&0==(4&i.event.conn)&&(E.text="Intel AMT CIRA disconnesso",addNotification(E)),0!=(16&T.conn))&&0==(16&i.event.conn)&&(E.text="MQTT disconnesso ",addNotification(E)),T.conn=i.event.conn,T.pwr=i.event.pwr,T.lastconnect=Date.now(),0==(1&T.conn)&&delete T.sessions,1==(C=Q("DevFilterSelect").value)||5==C?mainUpdate(21):(updateDeviceViewDevice(T),mainUpdate(17)),refreshDevice(T._id),20==xxcurrentView)&&null!=currentMesh&&currentMesh._id==T.meshid&&mainUpdate(4096);break;case"wssessioncount":null!=wssessions&&(0==i.event.count&&wssessions[i.event.userid]?delete wssessions[i.event.userid]:wssessions[i.event.userid]=i.event.count,mainUpdate(16384));break;case"login":null!=users&&users[i.event.userid]&&(users[i.event.userid].login=Math.floor(new Date(i.event.time).getTime()/1e3));break;case"scanamtdevice":if(null==xxdialogMode||!Q("dp1range")||xxdialogTag!="AMTSCAN:"+i.event.range)return;e="";if(null==i.event.results)e="<div style=width:100%;text-align:center;margin-top:12px>Impossibile scansionare questo intervallo di indirizzi.</div><div style=width:100%;text-align:center;margin-top:12px;color:gray;line-height:1.5>Valori dell'intervallo IP di esempio<br />192.168.0.100<br />192.168.1.0/24<br />192.167.0.1-192.168.0.100</div>";else{for(var r in amtScanResults=i.event.results,i.event.results){var N=i.event.results[r],I=N.hostname,I=(20<(I="host"==N.hosttype?capitalizeFirstLetter(I.split(".")[0]):I).length&&(I=I.substring(0,20)+"..."),'<b title="'+EscapeHtml(N.hostname)+'">'+EscapeHtml(I)+"</b> - v"+N.ver);2==N.state?1==N.tls?I+=" con TLS.":I+=" senza TLS.":I+=" not activated.",e+='<div style=width:100%;margin-bottom:2px;background-color:lightgray><div style=padding:4px><div style=display:inline-block;margin-right:5px><input class="DevScanCheckbox form-check-input me-2" name=dp1checkbox tag="'+EscapeHtml(r)+'" type=checkbox onclick=addAmtScanToMeshCheckbox() /></div><div class=j1 style=display:inline-block></div><div style=display:inline-block;margin-left:5px;overflow-x:auto;white-space:nowrap>'+I+"</div></div></div>"}""==e&&(e="<div style=width:100%;text-align:center;margin-top:12px>La scansione non ha restituito risultati.</div><div style=width:100%;text-align:center;margin-top:12px;color:gray;line-height:1.5>Valori dell'intervallo IP di esempio<br />192.168.0.100<br />192.168.1.0/24<br />192.167.0.1-192.168.0.100</div>")}QH("dp1results",e),QE("dp1range",!0),QE("dp1rangebutton",!0),QE("d2scanSelectButton",!0);break;case"notify":l={text:i.event.value,title:i.event.title,icon:i.event.icon,titleid:i.titleid,msgid:i.msgid,args:i.args};null!=i.id&&(l.id=i.id),null!=i.event.tag&&(l.tag=i.event.tag),"number"==typeof i.maxtime&&(l.maxtime=i.maxtime),addNotification(l);break;case"traceinfo":"object"==typeof i.event.traceSources&&(null!=i.event.traceSources&&0<i.event.traceSources.length?(serverTraceSources=i.event.traceSources,QH("p41traceStatus",EscapeHtml(i.event.traceSources.join(", ")))):(serverTraceSources=[],QH("p41traceStatus","Nessuna ")));break;case"sysinfohash":null!=currentNode&&i.event.nodeid==powerTimelineReq&&meshserver.send({action:"getsysinfo",nodeid:i.event.nodeid});break;case"ifchange":null!=currentNode&&currentNode._id==i.event.nodeid&&meshserver.send({action:"getnetworkinfo",nodeid:currentNode._id});break;case"devicesessions":if(null!=(T=getNodeFromId(i.event.nodeid))){if(T.sessions=i.event.sessions,null!=T.sessions){for(var r in T.sessions)0==Object.keys(T.sessions[r]).length&&delete T.sessions[r];0==Object.keys(T.sessions).length&&delete T.sessions}updateDeviceViewDevice(T),null!=currentNode&&currentNode._id==i.event.nodeid&&gotoDevice(currentNode._id,xxcurrentView,!0),xxdialogTag=="SESSIONS-"+i.event.nodeid&&showDeviceSessions(i.event.nodeid,!0),xxdialogTag=="MESSAGES-"+i.event.nodeid&&showDeviceMessages(i.event.nodeid,!0),xxdialogTag=="HELPREQ-"+i.event.nodeid&&showDeviceHelpRequests(i.event.nodeid,!0),2!=Q("DevFilterSelect").value&&6!=Q("DevFilterSelect").value||mainUpdate(1)}break;case"loginTokenChanged":if(i.event.userid!=userinfo._id)return;loginTokens=i.event.loginTokens,mainUpdate(65536);break;case"loginTokenAdded":if(i.event.userid!=userinfo._id)return;(loginTokens=null==loginTokens?[]:loginTokens).push(i.event.newToken),mainUpdate(65536);break;case"stopped":break;case"updatePluginList":installedPluginList=i.event.list,updatePluginList();break;case"pluginStateChange":null!=pluginHandler&&pluginHandler.refreshPluginHandler();break;case"plugin":if(null!=pluginHandler)try{pluginHandler[i.event.plugin][i.event.pluginaction](i)}catch(e){console.log("PluginHandler non ha potuto inviare il messaggio di evento:",e)}}break;case"createInviteLink":var _,V;xxdialogTag==i.meshid&&(-1!=(_=serverinfo.name).indexOf(".")&&0==(2&features)||(_=window.location.hostname),domainUrl.substring(0,domainUrl.length-1),V=1==serverinfo.https?"https://"+_+(443==serverinfo.port?"":":"+serverinfo.port)+domainUrl+"agentinvite?c="+i.cookie+(urlargs.key?"&key="+urlargs.key:""):"http://"+_+(80==serverinfo.port?"":":"+serverinfo.port)+domainUrl+"agentinvite?c="+i.cookie+(urlargs.key?"&key="+urlargs.key:""),Q("agentInvitationLink").href=V,p=format(1==i.expire?"1 ora":"{0} ore",i.expire),24==i.expire&&(p="1 giorno"),168==i.expire&&(p="1 settimana"),5040==i.expire&&(p="1 mese"),0==i.expire&&(p="Illimitato"),QH("agentInvitationLink",format("Link di invito ({0})",p)),QV("agentInvitationLinkDiv",!0));break;case"createDeviceShareLink":var U;xxdialogTag||(e="",null!=(T=getNodeFromId(i.nodeid))&&(e=(e=(e+=addHtmlValue("Dispositivo",T.name))+addHtmlValue("Nome dell'ospite",i.guestname))+addHtmlValue("Input utente",i.viewOnly?"Non consentito, solo visualizzazione":"Permesso"),i.start&&i.expire&&(i.recurring?(e+=addHtmlValue("Ora di inizio",printDateTime(new Date(i.start))),i.expire<2?e+=addHtmlValue("Durata",format("{0} minuto",i.expire)):e+=addHtmlValue("Durata",format("{0} minuti",i.expire))):e=(e+=addHtmlValue("Ora di inizio",printDateTime(new Date(i.start))))+addHtmlValue("Scadenza",printDateTime(new Date(i.expire)))),1==i.recurring&&(e+=addHtmlValue("Ricorrente","Quotidiano")),2==i.recurring&&(e+=addHtmlValue("Ricorrente","settimanalmente")),t=[],7&i.consent&&t.push("Notifica"),56&i.consent&&t.push("Richiesta"),64&i.consent&&t.push("Privacy bar"),0==t.length&&t.push("Nessuna "),e+=addHtmlValue("Consenso dell'utente ",t.join(", ")),U="",i.p<=7?U=["","Collegamento terminale remoto","Collegamento desktop remoto","Desktop remoto + collegamento terminale","Collegamento file remoti","Terminale remoto + collegamento file","Desktop remoto + collegamento file","Desktop remoto + Terminale + Collegamento file"][i.p]:8==i.p?U=format("HTTP/{0} link",i.port):16==i.p&&(U=format("HTTPS/{0}",i.port)),setModalContent("xxAddAgent","Condividi dispositivo",e+='<div id=agentInvitationLinkDiv style="text-align:center;font-size:large;margin:16px"><a href="'+i.url+'" id=agentInvitationLink rel="noreferrer noopener" target="_blank" style=cursor:pointer>'+U+'</a> <i class="fa-regular fa-copy" title="Copia il link negli appunti" style=cursor:pointer onclick=d2CopyInviteToClip()></i></div></div>'),showModal("xxAddAgentModal","idx_dlgOkButton")));break;case"getmqttlogin":if(null==currentNode||currentNode._id!=i.nodeid||null!=xxdialogMode)return;e="Queste impostazioni possono essere utilizzate per connettere MQTT per questo dispositivo.<br /><br />";delete i.action,delete i.nodeid,setModalContent("xxAddAgent","Credenziali MQTT ",e+="<textarea readonly=readonly style=width:100%;resize:none;height:100px;overflow:auto;font-size:12px readonly>"+JSON.stringify(i)+"</textarea>"),showModal("xxAddAgentModal","idx_dlgOkButton");break;case"stopped":autoReconnect=!1,QH("p0span",i.msg);break;case"updatePluginList":installedPluginList=i.list,updatePluginList();break;case"pluginVersionsAvailable":null!=pluginHandler&&updatePluginList(i.list);break;case"downgradePluginVersions":var j='<select id="lastPluginVersion">';i.info.versionList.forEach(function(e){j+='<option value="'+e.zipball_url+'">'+e.name+"</option>"}),j+="</select>",setModalContent("xxAddAgent","Azione plug-in",format("Select the version to downgrade the plugin: {0}",i.info.name)+"<hr />"+j+"<hr />Tieni presente che il downgrade non è raccomandato. Si prega di farlo solo nel caso in cui un aggiornamento recente abbia danneggiato qualcosa.NaN"+i.info.id+'" />'),showModal("xxAddAgentModal","idx_dlgOkButton",pluginActionEx);break;case"serverBackup":"googleDrive"==i.service&&(QV("p2ServerActionsGoogleBackup",0<i.state),QV("p2ServerActionsGoogleBackupCheck",2<i.state),miscState.googleDrive={state:i.state},2==i.state)&&(e="<img style=float:right src=\"images/googledrive-48.png\" /><div>Vai all'URL di seguito, concedi l'accesso e copia nuovamente il codice del token. </div><br />",setModalContent("xxAddAgent","Backup di Google Drive",e=(e+=addHtmlValue("Attivazione",'<a href="'+i.url+'" rel="noreferrer noopener" target="_blank">Browse to this URL</a>'))+addHtmlFormFloating("Codice","<input id=gdcode onkeyup=server_setupGoogleDriveBackupCheck3() class=form-control></input>")),showModal("xxAddAgentModal","idx_dlgOkButton",()=>server_setupGoogleDriveBackupEx(3,"gd2")),Q("gdcode").focus(),QE("idx_dlgOkButton",!1));break;case"pluginError":setModalContent("xxAddAgent","Errore plug-in",i.msg),showModal("xxAddAgentModal","idx_dlgOkButton");break;case"plugin":if(null!=pluginHandler&&"string"==typeof i.plugin)try{pluginHandler[i.plugin][i.method](z,i)}catch(e){console.log("Error loading plugin handler ("+e+")")}break;case"amtsetupbin":saveAs(new Blob([Uint8Array.from(atob(i.file),function(e){return e.charCodeAt(0)})],{type:"application/octet-stream"}),"setup.bin");break;case"previousLogins":null!=i.userid&&i.userid;var e="",S="BBB",R="";if(0==i.events.length)e+="No previous login.";else{for(var r in e+="<div style=max-height:260px;overflow-y:scroll;overflow-x:hidden><table>",i.events)107==(a=i.events[r].m)?(a="Accesso valido",S="BBD1BB",R="",null!=i.events[r].tn&&(a=format("Token: {0}",i.events[r].tn),S="88D188")):108==a?(a="2FA non valido",S="DD9DC3",R="x"):109==a?(a="Account bloccato",S="E1BBBB",R="x"):110==a&&(a="Password non valida",S="E1BBBB",R="x"),e+="<tr><td><img src=images/user-32"+R+'.png height=32 width=32 style=float:left srcset="images/user-64'+R+'.png 2x"><td><div style=width:300px;background-color:#'+S+";border-radius:6px;margin-bottom:4px;padding:4px><div>"+printDateTime(new Date(i.events[r].t))+", <b>"+EscapeHtml(a)+"</b></div><div style=font-size:x-small>"+EscapeHtml(i.events[r].a.join(", "))+"</div></div></tr>";e+="</table></div>"}setModalContent("xxAddAgent","Login precedenti",e),showModal("xxAddAgentModal","idx_dlgOkButton");break;case"getDeviceDetails":saveAs(new Blob([i.data],{type:"application/octet-stream"}),"Elenco dispositivi."+i.type);break;case"createLoginToken":if(xxdialogMode)return;e="Prendi nota di questo nome utente e password, la password non può essere mostrata di nuovo.<br /><br />";e+=addHtmlValue("Nome",EscapeHtml(i.name)),0!=i.expire&&(e+=addHtmlValue("Scade",EscapeHtml(printDateTime(new Date(i.expire))))),setModalContent("xxAddAgent","Crea Token di Accesso",e=(e+=addHtmlValue("Nome utente",'<i class="fa-regular fa-copy" title="Copia il link negli appunti" style="margin:9px;cursor:pointer;float:right" onclick=copyTextToClip2("'+encodeURIComponentEx(i.tokenUser)+'")></i><div class=selecttext style=width:230px;padding:5px;background-color:orange;border-radius:5px;font-size:15px>'+EscapeHtml(i.tokenUser)+"</div>"))+addHtmlValue("Password",'<i class="fa-regular fa-copy" title="Copia il link negli appunti" style="margin:9px;cursor:pointer;float:right" onclick=copyTextToClip2("'+encodeURIComponentEx(i.tokenPass)+'")></i><div class=selecttext style=width:230px;padding:5px;background-color:orange;border-radius:5px;font-size:15px>'+EscapeHtml(i.tokenPass)+"</div>")),showModal("xxAddAgentModal","idx_dlgOkButton");break;case"loginTokens":loginTokens=i.loginTokens,mainUpdate(65536);break;case"report":renderReport(i.data)}}function gotoStartViewPage(){var e=parseInt("{{viewmode}}");if(-1==xxcurrentView){if(""!="{{currentNode}}".toLowerCase()){if(null==getNodeFromId("{{currentNode}}"))return;gotoDevice("{{currentNode}}",e)}else if(null!=args.gotonode){if(96==args.gotonode.length&&(args.gotonode=btoa(hex2rstr(args.gotonode)).split("+").join("@").split("/").join("$")),null==getNodeFromId("node/"+domain+"/"+args.gotonode))return;gotoDevice("node/"+domain+"/"+args.gotonode,e),goBackStack.push(1)}else if(null!=args.gotodevicename){var t=null;if(null!=nodes)for(var i in nodes)nodes[i].name==args.gotodevicename&&(t=nodes[i]._id);t&&(gotoDevice(t,e),goBackStack.push(1))}else if(null!=args.gotodeviceip){t=null;if(null!=nodes)for(var i in nodes)nodes[i].ip==args.gotodeviceip&&(t=nodes[i]._id);t&&(gotoDevice(t,e),goBackStack.push(1))}else if(null!=args.gotomesh){if(null==meshes["mesh/"+domain+"/"+args.gotomesh])return;gotoMesh("mesh/"+domain+"/"+args.gotomesh),go(e),goBackStack.push(2)}else if(null!=args.gotouser){var o=args.gotouser;if(args.gotouser.indexOf("/")<0&&(o="user/"+domain+"/"+args.gotouser),null==users||null==users[o])return;gotoUser(encodeURIComponentEx(o)),go(e),goBackStack.push(4)}else if(null!=args.gotougrp){o=args.gotougrp;if(args.gotougrp.indexOf("/")<0&&(o="ugrp/"+domain+"/"+args.gotougrp),null==usergroups||null==usergroups[o])return;gotoUserGroup(o),go(e),goBackStack.push(50)}else isNaN(e)?(setDialogMode(0),go(1)):go(e);delete args.gotonode,delete args.gotomesh,delete args.gotouser,delete args.gotougrp}}function topMenu(e){null!=xxdialogMode&&0!=xxdialogMode&&999!=xxdialogMode||(void 0===e?1==("none"==QS("topMenu").display)?0!=xxdialogMode&&null!=xxdialogMode||(QV("topMenu",!0),xxdialogMode=999):(QV("topMenu",!1),xxdialogMode=0):(QV("topMenu",!1),xxdialogMode=0,1==e&&goForward("devices"),2==e&&goForward("account"),3==e&&goForward("events"),4==e&&goForward("users"),5==e&&goForward("files"),6==e&&goForward("server")))}function onRealNameCheckBox(){putstore("showRealNames",(showRealNames=Q("RealNameCheckBox").checked)?1:0),mainUpdate(7)}function onOnlineCheckBox(e){putstore("devFilterSelect",Q("DevFilterSelect").value),onDeviceSearchChanged(e)}function updateDevicePageState(){var e,t;null==devicePagingState||devicePagingState.total<=devicePagingState.limit?(QV("devViewPageState",!1),QV("devViewPageButton1",!1),QV("devViewPageButton2",!1),QV("devViewPageButton3",!1),QV("devViewPageButton4",!1)):(e=Math.floor((devicePagingState.skip+devicePagingState.limit)/devicePagingState.limit),t=Math.ceil(devicePagingState.total/devicePagingState.limit),QV("devViewPageState",!0),QV("devViewPageButton1",!0),QV("devViewPageButton2",!0),QV("devViewPageButton3",!0),QV("devViewPageButton4",!0),QH("devViewPageState",e+"/"+t))}function onDeviceViewPageChange(e){if(null!=devicePagingState){var t=Math.floor((devicePagingState.skip+devicePagingState.limit)/devicePagingState.limit),i=Math.ceil(devicePagingState.total/devicePagingState.limit);switch(e){case 1:1<t&&meshserver.send({action:"nodes",skip:0});break;case 2:1<t&&meshserver.send({action:"nodes",skip:(t-2)*devicePagingState.limit});break;case 3:t<i&&meshserver.send({action:"nodes",skip:t*devicePagingState.limit});break;case 4:t<i&&meshserver.send({action:"nodes",skip:(i-1)*devicePagingState.limit})}}}function onDeviceViewChange(e){null!=e&&(Q("viewselect").value=e);for(var t=1;t<6;t++)Q("devViewButton"+t).classList.remove("viewSelectorSel");Q("devViewButton"+Q("viewselect").value).classList.add("viewSelectorSel"),putstore("deviceView",Q("viewselect").value),putstore("viewsize",Q("sizeselect").value),mainUpdate(4),setTimeout(function(){mainUpdate(512)},200)}function onDeviceViewSettings(){var e;xxdialogMode||(null==deviceViewSettings&&(deviceViewSettings={}),Array.isArray(deviceViewSettings.devsCols)||(deviceViewSettings.devsCols=["user","ip","conn"]),e="",setModalContent("xxAddAgent","Colonne vista dispositivo",e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e+='<label><input id=d2c8 type=checkbox class="form-check-input me-2"'+(0<=deviceViewSettings.devsCols.indexOf("agtype")?" checked":"")+">Tipo di agente</label><br />")+('<label><input id=d2c9 type=checkbox class="form-check-input me-2"'+(0<=deviceViewSettings.devsCols.indexOf("agver")?" checked":"")+">Versione agente</label><br />"))+('<label><input id=d2c6 type=checkbox class="form-check-input me-2"'+(0<=deviceViewSettings.devsCols.indexOf("desc")?" checked":"")+">Descrizione del dispositivo</label><br />"))+('<label><input id=d2c5 type=checkbox class="form-check-input me-2"'+(0<=deviceViewSettings.devsCols.indexOf("os")?" checked":"")+">Sistema operativo</label><br />"))+('<label><input id=d2c10 type=checkbox class="form-check-input me-2"'+(0<=deviceViewSettings.devsCols.indexOf("tags")?" checked":"")+">Tags</label><br />"))+('<label><input id=d2c11 type=checkbox class="form-check-input me-2"'+(0<=deviceViewSettings.devsCols.indexOf("windowsav")?" checked":"")+">Windows AV</label><br />"))+('<label><input id=d2c12 type=checkbox class="form-check-input me-2"'+(0<=deviceViewSettings.devsCols.indexOf("windowsupdate")?" checked":"")+">Windows Update</label><br />"))+('<label><input id=d2c13 type=checkbox class="form-check-input me-2"'+(0<=deviceViewSettings.devsCols.indexOf("windowsfirewall")?" checked":"")+">Windows Firewall</label><br />"))+('<label><input id=d2c14 type=checkbox class="form-check-input me-2"'+(0<=deviceViewSettings.devsCols.indexOf("lastbootuptime")?" checked":"")+">Last Boot Up Time</label><br />"))+('<label><input id=d2c1 type=checkbox class="form-check-input me-2"'+(0<=deviceViewSettings.devsCols.indexOf("links")?" checked":"")+">Collegamenti al router MeshCentral</label><br />"))+('<label><input id=d2c2 type=checkbox class="form-check-input me-2"'+(0<=deviceViewSettings.devsCols.indexOf("user")?" checked":"")+">Utenti che hanno effettuato l'accesso</label><br />"))+('<label><input id=d2c3 type=checkbox class="form-check-input me-2"'+(0<=deviceViewSettings.devsCols.indexOf("ip")?" checked":"")+">Indirizzo IP dell'agente</label><br />"))+('<label><input id=d2c4 type=checkbox class="form-check-input me-2"'+(0<=deviceViewSettings.devsCols.indexOf("conn")?" checked":"")+">Connettività del server</label><br />"))+('<label><input id=d2c7 type=checkbox class="form-check-input me-2"'+(0<=deviceViewSettings.devsCols.indexOf("lastseen")?" checked":"")+">Ultima visualizzazione</label><br />"))+('<label><input id=d2c15 type=checkbox class="form-check-input me-2"'+(0<=deviceViewSettings.devsCols.indexOf("amthost")?" checked":"")+">Intel&reg; AMT hostname</label><br />"))+('<label><input id=d2c17 type=checkbox class="form-check-input me-2"'+(0<=deviceViewSettings.devsCols.indexOf("amtstate")?" checked":"")+">Intel&reg; AMT state</label><br />")),showModal("xxAddAgentModal","idx_dlgOkButton",()=>onDeviceViewSettingsEx()))}function onDeviceViewSettingsEx(){var e=[];Q("d2c1").checked&&e.push("links"),Q("d2c2").checked&&e.push("user"),Q("d2c3").checked&&e.push("ip"),Q("d2c4").checked&&e.push("conn"),Q("d2c5").checked&&e.push("os"),Q("d2c6").checked&&e.push("desc"),Q("d2c7").checked&&e.push("lastseen"),Q("d2c8").checked&&e.push("agtype"),Q("d2c9").checked&&e.push("agver"),Q("d2c10").checked&&e.push("tags"),Q("d2c11").checked&&e.push("windowsav"),Q("d2c12").checked&&e.push("windowsupdate"),Q("d2c13").checked&&e.push("windowsfirewall"),Q("d2c14").checked&&e.push("lastbootuptime"),Q("d2c15").checked&&e.push("amthost"),Q("d2c17").checked&&e.push("amtstate"),deviceViewSettings.devsCols=e,putstore("_deviceViewSettings",JSON.stringify(deviceViewSettings)),mainUpdate(4)}function ondockeypress(e){if(!document.querySelector(".modal.show")){if(setSessionActivity(),!xxdialogMode&&11==xxcurrentView&&desktop&&Q("DeskControl").checked){if(null!=currentNode){var t=GetNodeRights(currentNode);if(0==(0==(8192&features2)&&(4294967295==t||0!=(8&t)&&0==(256&t))))return!1;t=4294967295!=t&&0!=(8&t)&&0==(256&t)&&0!=(4096&t);if(1==t&&(1==e.altKey||1==e.ctrlKey||e.keyCode<32&&8!=e.keyCode&&13!=e.keyCode||90<e.keyCode))return!1}return desktop.m.handleKeys(e)}if(!xxdialogMode&&12==xxcurrentView&&terminal&&3==terminal.State&&null==xterm)return terminal.m.TermHandleKeys(e);if(!xxdialogMode&&(15==xxcurrentView||115==xxcurrentView))return agentConsoleHandleKeys(e);if(!xxdialogMode&&4==xxcurrentView){if(1==e.ctrlKey||1==e.altKey||1==e.metaKey)return;var i=0;if(e.key?(1===e.key.length&&0==userSearchFocus&&(Q("UserSearchInput").value=Q("UserSearchInput").value+e.key,i=1),8==e.keyCode&&0==userSearchFocus&&(o=Q("UserSearchInput").value,Q("UserSearchInput").value=o.substring(0,o.length-1),i=1),27==e.keyCode&&(Q("UserSearchInput").value="",i=1)):0!=e.charCode&&0==userSearchFocus&&(Q("UserSearchInput").value=Q("UserSearchInput").value+String.fromCharCode(e.charCode),i=1),0<i)return 1==i&&onUserSearchInputChanged(),haltEvent(e)}if(!xxdialogMode&&1==xxcurrentView)if(1==e.ctrlKey&&96==e.charCode)showRealNames=!showRealNames,putstore("showRealNames",(Q("RealNameCheckBox").value=showRealNames)?1:0),mainUpdate(6);else if(1!=e.ctrlKey&&1!=e.altKey&&1!=e.metaKey){if(Q("viewselect").value<4){var o,i=0;if(e.key?(1===e.key.length&&0==searchFocus&&(Q("KvmSearchInput").value=Q("SearchInput").value=Q("SearchInput").value+e.key,i=1),8==e.keyCode&&0==searchFocus&&(o=Q("SearchInput").value,Q("KvmSearchInput").value=Q("SearchInput").value=o.substring(0,o.length-1),i=1),27==e.keyCode&&(Q("KvmSearchInput").value=Q("SearchInput").value="",i=1)):0!=e.charCode&&0==searchFocus&&(Q("KvmSearchInput").value=Q("SearchInput").value=Q("SearchInput").value+String.fromCharCode(e.charCode),i=1),0<i)return 1==i&&mainUpdate(5),haltEvent(e)}4==Q("viewselect").value&&(e.key?(1===e.key.length&&0==mapSearchFocus&&(Q("mapSearchLocation").value=Q("mapSearchLocation").value+e.key,i=1),27==e.keyCode&&(Q("mapSearchLocation").value="",mapCloseSearchWindow(),i=1),13==e.keyCode&&getSearchLocation()):0!=e.charCode&&0==mapSearchFocus&&(Q("mapSearchLocation").value=Q("mapSearchLocation").value+String.fromCharCode(e.charCode)))}}}function ondockeydown(e){if(setSessionActivity(),!xxdialogMode&&11==xxcurrentView&&desktop&&Q("DeskControl").checked){if(null!=currentNode){var t=GetNodeRights(currentNode);if(0==(0==(8192&features2)&&(4294967295==t||0!=(8&t)&&0==(256&t))))return!1;t=4294967295!=t&&0!=(8&t)&&0==(256&t)&&0!=(4096&t);if(1==t&&(1==e.altKey||1==e.ctrlKey||e.keyCode<32&&8!=e.keyCode&&13!=e.keyCode||90<e.keyCode))return!1}return desktop.m.handleKeyDown(e)}if(!xxdialogMode&&12==xxcurrentView&&terminal&&3==terminal.State&&null==xterm&&(terminal.m.TermHandleKeyDown(e),37<=e.keyCode)&&e.keyCode<=40&&haltEvent(e),!xxdialogMode&&13==xxcurrentView&&116==e.keyCode&&null!=p13filetree)return haltEvent(e),!1;if(!xxdialogMode&&(15==xxcurrentView||115==xxcurrentView))return agentConsoleHandleKeys(e);if(!xxdialogMode&&4==xxcurrentView&&(8===e.keyCode&&0==userSearchFocus&&(i=Q("UserSearchInput").value,Q("UserSearchInput").value=i.substring(0,i.length-1),o=1),27===e.keyCode&&(Q("UserSearchInput").value="",o=1),0<o))return 1==o&&mainUpdate(5),haltEvent(e);if(!xxdialogMode&&1==xxcurrentView&&1!=e.ctrlKey&&1!=e.altKey&&1!=e.metaKey){var i,o=0;if(Q("viewselect").value<4)if(8===e.keyCode&&0==searchFocus&&(i=Q("SearchInput").value,Q("KvmSearchInput").value=Q("SearchInput").value=i.substring(0,i.length-1),o=1),27===e.keyCode&&(Q("KvmSearchInput").value=Q("SearchInput").value="",o=1),0<o)return 1==o&&mainUpdate(5),haltEvent(e);4==Q("viewselect").value&&(8===e.keyCode&&0==mapSearchFocus&&(i=Q("mapSearchLocation").value,Q("mapSearchLocation").value=i.substring(0,i.length-1),o=1),27===e.keyCode)&&(Q("mapSearchLocation").value="",mapCloseSearchWindow())}}function ondockeyup(e){if(setSessionActivity(),!xxdialogMode&&11==xxcurrentView&&desktop&&Q("DeskControl").checked){if(null!=currentNode){var t=GetNodeRights(currentNode);if(0==(0==(8192&features2)&&(4294967295==t||0!=(8&t)&&0==(256&t))))return!1;t=4294967295!=t&&0!=(8&t)&&0==(256&t)&&0!=(4096&t);if(1==t&&(1==e.altKey||1==e.ctrlKey||e.keyCode<32&&8!=e.keyCode&&13!=e.keyCode||90<e.keyCode))return!1}return desktop.m.handleKeyUp(e)}return!xxdialogMode&&12==xxcurrentView&&terminal&&3==terminal.State&&null==xterm?terminal.m.TermHandleKeyUp(e):xxdialogMode||13!=xxcurrentView||116!=e.keyCode||null==p13filetree?xxdialogMode||4!=xxcurrentView||(8!==e.keyCode||0!=searchFocus)&&27!==e.keyCode?(xxdialogMode&&27==e.keyCode&&dialogclose(0),1!=e.shiftKey||27!=e.keyCode?!xxdialogMode&&0==xxcurrentView&&1!=e.ctrlKey&&1!=e.altKey&&1!=e.metaKey&&(Q("viewselect").value<4&&(8===e.keyCode&&0==searchFocus||27===e.keyCode)||4==Q("viewselect").value&&(8===e.keyCode&&0==mapSearchFocus||27===e.keyCode))?haltEvent(e):void 0:(dialogclose(0),Q("KvmSearchInput").value=Q("SearchInput").value="",mainUpdate(5),null!=desktop&&connectDesktop(),null!=terminal&&connectTerminal(),null!=files&&connectFiles(),void go(1))):haltEvent(e):(p13folderup(9999),haltEvent(e),!1)}function ondocblur(){if(!xxdialogMode&&11==xxcurrentView&&desktop&&Q("DeskControl").checked&&desktop.m.handleReleaseKeys)return desktop.m.handleReleaseKeys()}function devGrpMouseHover(e,t){setSessionActivity();Q("viewselect").value;e=e.children[1].children[1];e.children[0].classList.remove("g1s"),e.children[1].classList.remove("e2s"),e.children[2].classList.remove("g2s"),1==t&&(e.children[0].classList.add("g1s"),e.children[1].classList.add("e2s"),e.children[2].classList.add("g2s"))}function devMouseHover(e,t){setSessionActivity();var i,o=Q("viewselect").value;1==o?((i=e.children[0].children[0].children[1].children[0].children[0].children[0]).children[1].classList.remove("g1s"),i.children[2].classList.remove("e2s"),i.children[3].classList.remove("g2s"),1==t&&(i.children[1].classList.add("g1s"),i.children[2].classList.add("e2s"),i.children[3].classList.add("g2s"))):2==o&&((i=e).children[2].classList.remove("g1s"),i.children[4].classList.remove("e2s"),i.children[3].classList.remove("g2s"),1==t)&&(i.children[2].classList.add("g1s"),i.children[4].classList.add("e2s"),i.children[3].classList.add("g2s"))}var deviceHeaderCount,deviceHeaderId=0,deviceHeaderTotal=0,deviceHeadersTitles={},deviceHeaders={},oldviewmode=0;function updateDevices(){if(null!=nodes&&1==xxcurrentView){var e="",t=0,i=null,o={},n=Q("viewselect").value,a={},s={};if(QV("xdevices",4!=n),QV("xdevicesmap",4==n),QVH("devListToolbar",n<3),QVH("kvmListToolbar",3==n||5==n),QVH("devMapToolbar",4==n),QV("devListToolbarSize",3==n||5==n),QV("devListToolbarSettings",2==n),QV("NoMeshesPanel",0==nodes.length&&0==meshcount),QV("devListToolbarViewIcons",0<nodes.length),QV("devListToolbarSort",0<nodes.length&&4!=n),0==nodes.length&&(n=1,sort=0),4==n)setTimeout(function(){null!=xxmap.map&&xxmap.map.updateSize()},200);else{deviceHeaderCount={},deviceHeaders={},deviceHeadersTitles={};var r=[],l=((deviceHeaderTotal=deviceHeaderId=0)==sort?nodes.sort(meshSort):1==sort?nodes.sort(powerSort):2==sort?1==showRealNames?nodes.sort(deviceHostSort):nodes.sort(deviceSort):5==sort&&(deviceViewSettings&&deviceViewSettings.devsCols&&0<=deviceViewSettings.devsCols.indexOf("lastseen")||(0==requestedLastConnects&&(requestedLastConnects=!0,meshserver.send({action:"lastconnects"})),null==deviceViewSettings&&(deviceViewSettings={}),Array.isArray(deviceViewSettings.devsCols)?deviceViewSettings.devsCols.push("lastseen"):deviceViewSettings.devsCols=["user","ip","conn","lastseen"]),nodes.sort(lastConnectSort)),Q("column_l").clientWidth-60),d=Math.floor(l/301),d=301+Math.floor((l-301*d)/d),c=4;for(w in deviceViewSettings&&deviceViewSettings.devsCols&&(c=deviceViewSettings.devsCols.length+1,0<=deviceViewSettings.devsCols.indexOf("desc"))&&c--,nodes){var u=nodes[w];if(0!=u.v){var p,m,g=meshes[u.meshid],v=GetNodeRights(u);if(0==sort?(meshes[u.meshid]?u.meshid:"*")!=i&&(1!=n&&3!=n&&5!=n||null==i||(e+="</div>"),deviceHeaderSet(),p="",2==n&&(e+="<tr><td colspan="+c+">"),meshes[u.meshid]&&1==meshes[u.meshid].mtype&&(p="<span class=devHeaderx>, Intel&reg; Solo AMT</span>"),meshes[u.meshid]&&3==meshes[u.meshid].mtype&&(p=meshes[u.meshid].relayid?"<span class=devHeaderx>, Dispositivi inoltrati</span>":"<span class=devHeaderx>, Dispositivi locali</span>"),1==n&&null!=i&&(2==t&&(e+="<td><div style=width:301px></div></td>"),""!=e)&&(e+="</tr></table>"),2==n&&(e+="<div>"),e=(e+="<div class=DevSt style=width:100%;padding-top:4px><span style=float:right>")+"<span id=DevxHeader"+deviceHeaderId+" class=devHeaderx></span>"+p+"</span>",1!=n&&2!=n&&3!=n&&5!=n||(x=CollapsedGroups[u.meshid],e+='<i role="button" cmenu=expandAllContextMenu onclick=toggleCollapseGroup("'+deviceHeaderId+'","'+u.meshid+'",'+n+') class="fa-fw fa-solid '+(!0===x?"fa-chevron-right":"fa-chevron-down")+'" id="DevxColImg'+deviceHeaderId+'"></i>'),i=meshes[u.meshid]?(e+='<span id=MxMESH cmenu=meshContextMenu tabindex=0 style=cursor:pointer onclick=gotoMesh("'+u.meshid+"\") onkeypress=\"if (event.key=='Enter') gotoMesh('"+u.meshid+"')\">"+EscapeHtml(meshes[u.meshid].name)+"</span>"+getMeshActions(g,v)+"</div>",u.meshid):(e+="<span id=MxMESH><i>Dispositivi individuali</i></span></div>","*"),2==n&&(e+="</div>"),t=0,(o[i]=1)!=n&&3!=n&&5!=n||(e+="<div id=DevxCol"+deviceHeaderId+(!0===x?" style=display:none":"")+">")):1==sort?(p=u.pwr||0)!==i&&(1!=n&&3!=n&&5!=n||null==i||(e+="</div>"),deviceHeaderSet(),1==n&&null!==i&&(2==t&&(e+="<td><div style=width:301px></div></td>"),""!=e)&&(e+="</tr></table>"),2==n&&(e+="<tr><td colspan="+c+">"),e+="<div class=DevSt style=width:100%;padding-top:4px><span id=DevxHeader"+deviceHeaderId+" class=devHeaderx style=float:right></span>",1!=n&&2!=n&&3!=n&&5!=n||(x=CollapsedGroups["pwr:"+p],e+='<i role="button" cmenu=expandAllContextMenu onclick=toggleCollapseGroup("'+deviceHeaderId+'","pwr:'+p+'",'+n+') class="fa-fw fa-solid '+(!0===x?"fa-chevron-right":"fa-chevron-down")+'" id="DevxColImg'+deviceHeaderId+'"></i>'),e+="<span>"+PowerStateStr2(u.pwr)+"</span></div>",i=p,t=0,1!=n&&3!=n&&5!=n||(e+="<div id=DevxCol"+deviceHeaderId+(!0===x?" style=display:none":"")+">")):2!=sort&&5!=sort||null==i&&(i="1"),1==n?e+="<div name=xxdevice1 id=xv1"+u._id+" style=display:inline-block;position:relative;width:"+d+"px;height:50px;padding-top:1px;padding-bottom:1px></div>":2==n?(m=u.meshid,1==sort?m="pwr:"+(u.pwr||0):3!=sort&&4!=sort||(m="tag:**xx**xx*TaG*xx**xx**"),e+="<tr name=xxdevice2 colname=DevxCol"+m+" style=height:20px"+((x=3!=sort&4!=sort&CollapsedGroups[m])?";display:none":"")+" id=xv2"+u._id+"></tr>"):(3==n||5==n)&&1&u.conn&&0!=(8&v||256&v)&&u.agent&&0!=(1&u.agent.caps)&&(0!=Object.keys(checkedNodeids).length&&!checkedNodeids[u._id]||(e+=updateDeviceViewHtml(n,null,u),r.push(u._id))),(3==sort||4==sort)&&""!=e){if(u.tags)for(var h in u.tags){var f=u.tags[h],x=(4==sort&&(f=g?g.name+" - "+u.tags[h]:"**INDV*~*DEVS** - "+u.tags[h]),CollapsedGroups["tag:"+encodeURIComponentEx(f)]),k=e.replace("**xx**xx*TaG*xx**xx**",encodeURIComponentEx(f)+(x?" style=display:none":""));if(null==a[f]?(a[f]=k,s[f]=1):(a[f]+=k,s[f]+=1),3==n||5==n)break}else 4!=sort||null==g||null!=u.tags&&0!=u.tags.length||(f=g.name,x=CollapsedGroups["tag:"+encodeURIComponentEx(f)],k=e.replace("**xx**xx*TaG*xx**xx**",encodeURIComponentEx(f)+(x?" style=display:none":"")),null==a[f]?(a[f]=k,s[f]=1):(a[f]+=k,s[f]+=1));e=""}deviceHeaderTotal++,void 0===deviceHeaderCount[u.state]?deviceHeaderCount[u.state]=1:deviceHeaderCount[u.state]++}}if(1==n&&null!=i&&(e+="</div>"),32<=r.length&&(Q("autoConnectDesktopCheckbox").checked=!1),QE("autoConnectDesktopCheckbox",r.length<32),3==sort||4==sort){var b=[],y=0;for(w in a)b.push(w);for(h in b.sort(function(e,t){return sortCollator.compare(e.toLowerCase(),t.toLowerCase())}),b){var w=b[h];e=2==n?(e+="<tr><td colspan="+c+"><div class=DevSt style=width:100%;padding-top:4px>",x=CollapsedGroups["tag:"+encodeURIComponentEx(w)],(e+='<i role="button" cmenu=expandAllContextMenu onclick=toggleCollapseGroup("'+y+'","tag:'+encodeURIComponentEx(w)+'",2) class="fa-fw fa-solid '+(!0===x?"fa-chevron-right":"fa-chevron-down")+'" id="DevxColImg'+y+'"></i>')+"<span class=devHeaderx style=float:right>"+s[w]+" node"+(1<s[w]?"s":"")+"</span><span>"+EscapeHtml(w).split("|").join(" &rarr; ").split("**INDV*~*DEVS**").join("<i>Dispositivi individuali</i>")+"</span></div>"+a[w]):(e+="<div class=DevSt style=width:100%;padding-top:4px><span class=devHeaderx style=float:right>"+format(1<s[w]?"{0} nodes":"{0} node",s[w])+"</span>",x=CollapsedGroups["tag:"+encodeURIComponentEx(w)],(e=(e+='<i role="button" cmenu=expandAllContextMenu onclick=toggleCollapseGroup("'+y+'","tag:'+encodeURIComponentEx(w)+'") class="fa-fw fa-solid '+(!0===x?"fa-chevron-right":"fa-chevron-down")+'" id="DevxColImg'+y+'"></i>')+"<span>"+EscapeHtml(w).split("|").join(" &rarr; ").split("**INDV*~*DEVS**").join("<i>Dispositivi individuali</i>")+"</span></div>")+"<div id=DevxCol"+y+(!0===x?" style=display:none":"")+">"+a[w]+"</div>"),y++}}var C=!1;if(""==e&&0<nodes.length&&(""!=Q("SearchInput").value||0!=Q("DevFilterSelect").value)&&(C=!0,e=3==sort?'<div style="margin:30px">Nessun dispositivo è incluso in alcun gruppo, fai clic su "Gruppi" di un dispositivo per aggiungerlo a un gruppo. </div>':'<div style="margin:30px">Nessun dispositivo corrispondente a questa ricerca.  <a onclick=clearDeviceSearch()>Cancella filtro di ricerca</a></div>'),1==n&&2==t&&(e+="<td><div style=width:301px></div></td>"),0==sort&&""==Q("SearchInput").value&&0==Q("DevFilterSelect").value&&n<3){var M=deviceHeaderId,S=[];for(w in meshes)S.push(meshes[w]);for(w in S.sort(nameSort),S){var A=S[w],v=GetMeshRights(A);null==o[A._id]&&(""!=i&&""!=e&&(e+="</tr></table>"),e+="<table style=width:100%;padding-top:4px cellpadding=0 cellspacing=0><tr><td colspan=3 class=DevSt>",M++,x=CollapsedGroups[A._id],e=(e=(e+='<i role="button" cmenu=expandAllContextMenu onclick=toggleCollapseGroup("'+M+'","'+A._id+'") class="fa-fw fa-solid '+(!0===x?"fa-chevron-right":"fa-chevron-down")+'" id="DevxColImg'+M+'"></i>')+'<span id=MxMESH style=cursor:pointer onclick=gotoMesh("'+A._id+'")>'+EscapeHtml(A.name)+"</span><span>")+getMeshActions(A,v)+"</span></td></tr><tr>",1==A.mtype?(e+="<td><div style=padding:10px><i>Nessun Intel&reg; Dispositivi AMT in questo gruppo di dispositivi",0==(4&v)||4294967295!=userinfo.siteadmin&&0!=(4096&userinfo.siteadmin)||(e+=", <a href=# style=cursor:pointer onclick='return addDeviceToMesh(\""+A._id+"\")'>Aggiungi uno</a>")):2==A.mtype?(e=e+"<td><div id=DevxCol"+M+(!0===x?" style=display:none":"")+"><div style=padding:10px><i>Nessun dispositivo in questo gruppo di dispositivi",0==(4&v)||4294967295!=userinfo.siteadmin&&0!=(4096&userinfo.siteadmin)||(e+=", <a href=# style=cursor:pointer onclick='return addAgentToMesh(\""+A._id+"\")'>Aggiungi uno</a>")):3==A.mtype?(e=e+"<td><div id=DevxCol"+M+(!0===x?" style=display:none":"")+"><div style=padding:10px><i>Nessun dispositivo locale in questo gruppo di dispositivi",0==(4&v)||4294967295!=userinfo.siteadmin&&0!=(4096&userinfo.siteadmin)||(e+=", <a href=# style=cursor:pointer onclick='return addLocalDeviceToMesh(\""+A._id+"\")'>Aggiungi uno</a>")):4==A.mtype&&(e=e+"<td><div id=DevxCol"+M+(!0===x?" style=display:none":"")+"><div style=padding:10px><i>Nessun dispositivo in questo gruppo di dispositivi"),e+=".</i></div></td></div>",i=A._id,0)}}for(w in""!=e&&0==C?(e+="</table>",2==n&&(C="",null==deviceViewSettings&&(deviceViewSettings={}),Array.isArray(deviceViewSettings.devsCols)||(deviceViewSettings.devsCols=["user","ip","conn"]),0<=deviceViewSettings.devsCols.indexOf("agtype")&&(C+="<th style=width:100px>Tipo di agente"),0<=deviceViewSettings.devsCols.indexOf("agver")&&(C+="<th style=width:100px>Versione agente"),0<=deviceViewSettings.devsCols.indexOf("os")&&(C+="<th style=width:160px>OS"),0<=deviceViewSettings.devsCols.indexOf("tags")&&(C+="<th style=width:120px>Tags"),0<=deviceViewSettings.devsCols.indexOf("windowsav")&&(C+="<th style=width:100px>Windows AV"),0<=deviceViewSettings.devsCols.indexOf("windowsupdate")&&(C+="<th style=width:120px>Windows Update"),0<=deviceViewSettings.devsCols.indexOf("windowsfirewall")&&(C+="<th style=width:120px>Windows Firewall"),0<=deviceViewSettings.devsCols.indexOf("lastbootuptime")&&(C+="<th style=width:120px>Last Boot Up Time"),0<=deviceViewSettings.devsCols.indexOf("links")&&(C+="<th style=width:120px>Link"),0<=deviceViewSettings.devsCols.indexOf("user")&&(C+="<th style=width:120px>Utente"),0<=deviceViewSettings.devsCols.indexOf("ip")&&(C+="<th style=width:120px>Indirizzo"),0<=deviceViewSettings.devsCols.indexOf("conn")&&(C+="<th style=width:100px>Connettività"),0<=deviceViewSettings.devsCols.indexOf("amthost")&&(C+="<th style=width:100px>AMT Host"),0<=deviceViewSettings.devsCols.indexOf("amtstate")&&(C+="<th style=width:100px>AMT State"),0<=deviceViewSettings.devsCols.indexOf("lastseen")&&(C+="<th style=width:120px>Ultima visualizzazione",0==requestedLastConnects)&&(requestedLastConnects=!0,meshserver.send({action:"lastconnects"})),e="<table style=width:100%;margin-top:4px cellpadding=0 cellspacing=0><th>"+C+e+"</tr></table><div style=height:1px></div>")):(e+="</table>",3==sort&&(e='<div style="margin:10px"><i>Nessun dispositivo con tag trovato. </i></div>')),e+="<div style=border-top-style:solid;border-top-width:1px;border-top-color:#DDDDDD;cursor:pointer;font-size:small;margin-top:4px>",n<3&&0==sort&&0<Object.keys(meshes).length&&(4294967295==userinfo.siteadmin||0==(64&userinfo.siteadmin))&&(e+='<a href=# onclick="return account_createMesh()" title="Crea un nuovo gruppo di dispositivi" style=cursor:pointer>Aggiungi gruppo di dispositivi</a>&nbsp'),4294967295!=userinfo.siteadmin&&0!=(128&userinfo.siteadmin)||(e+="<a href=# onclick='return p10showMeshCmdDialog(0)' style=cursor:pointer title=\"Scarica MeshCmd, uno strumento da riga di comando che esegue molte funzioni.\">MeshCmd</a>&nbsp","win32"!=navigator.platform.toLowerCase()&&"macintel"!=navigator.platform.toLowerCase())||(e+="<a href=# onclick='return p10showMeshRouterDialog()' style=cursor:pointer title=\"Scarica MeshCentral Router, uno strumento di mappatura delle porte TCP.\">Router</a>&nbsp"),e+="</div><div style=height:60px></div>",QH("xdevices",e),deviceHeaderSet(),deviceHeaders)QH(w,deviceHeaders[w]);for(w in deviceHeadersTitles)Q(w).title=deviceHeadersTitles[w];if(p1updateInfo(),3!=n&&5!=n||1!=xxcurrentView)disconnectAllKvmFunction(),Q("autoConnectDesktopCheckbox").checked=!1;else{var D,T=[{x:180,y:101},{x:302,y:169},{x:454,y:255}][Q("sizeselect").selectedIndex];for(w in 3==n&&(C=T.x+2,l=l-5,D=Math.floor(l/C),D=C+Math.floor((l-D*C)/D),T.y=T.y*(D/T.x),T.x=D),multiDesktop)multiDesktop[w].xxdelete=!0;for(w in r){var E=r[w],N=E.split("/")[2],I=multiDesktop[E];if(null!=I){var _=5==n?I.m.width*T.y/I.m.height:T.x;I.m.CanvasId.setAttribute("style","background-color:black;width:"+_+"px;height:"+T.y+"px"),Q("xkvmid_"+N).appendChild(I.m.CanvasId),delete I.xxdelete,QH("skvmid_"+N,["Disconnesso","Collegamento ...","Impostare...","",""][null==I.m.State?I.m.state:I.m.State])}else{u=getNodeFromId(E);if(desktopNode==u&&null!=desktop){var t=desktop.m.CanvasId,_=5==n?desktop.m.width*T.y/desktop.m.height:T.x;t.setAttribute("id","kvmid_"+N),t.setAttribute("style","background-color:black;width:"+_+"px;height:"+T.y+"px"),t.setAttribute("onclick","toggleKvmDevice('"+E+"')"),t.removeAttribute("onmousedown"),t.removeAttribute("onmouseup"),t.removeAttribute("onmousemove"),Q("xkvmid_"+N).appendChild(t),QH("skvmid_"+N,["Disconnesso","Collegamento ...","Impostare...","",""][null==desktop.m.State?desktop.m.state:desktop.m.State]),desktop.m.SendCompressionLevel&&desktop.m.SendCompressionLevel(multidesktopsettings.agentencoding,multidesktopsettings.quality,multidesktopsettings.scaling,multidesktopsettings.framerate),desktop.shortid=N,desktop.onStateChanged=onMultiDesktopStateChange,desktop.m.onRemoteInputLockChanged=null,desktop.m.onKeyboardStateChanged=null,multiDesktop[E]=desktop,desktop=desktopNode=currentNode=null,QH("DeskParent",'<canvas id="Desk" oncontextmenu="return false" onmousedown=dmousedown(event) onmouseup=dmouseup(event) onmousemove=dmousemove(event)></canvas>')}else{(t=document.createElement("canvas")).setAttribute("id","kvmid_"+N),t.setAttribute("width",640),t.setAttribute("height",480),t.setAttribute("oncontextmenu","return false"),t.setAttribute("style","background-color:black;width:"+T.x+"px;height:"+T.y+"px"),t.setAttribute("onclick","toggleKvmDevice('"+E+"')");try{Q("xkvmid_"+N).appendChild(t)}catch(e){}1==Q("autoConnectDesktopCheckbox").checked&&setTimeout(function(){connectMultiDesktop(u,1)},100)}}}for(w in multiDesktop)1==multiDesktop[w].xxdelete?(multiDesktop[w].Stop(),delete multiDesktop[w]):debugmode&&multiDesktop[w].m&&multiDesktop[w].m.onScreenSizeChange&&mdeskAdjust(multiDesktop[w].m,multiDesktop[w].m.ScreenWidth,multiDesktop[w].m.ScreenHeight,multiDesktop[w].m.CanvasId);deskAdjust()}}oldviewmode=n,onDevicesScrollEx()}}var xxModal,onDevicesTouchActive=!1,onDevicesScrollnagleTimer=null;function onDevicesScroll(e){(e=void 0===e?!1:e)&&(Q("xdevices").scrollTop=0),null!=onDevicesScrollnagleTimer||onDevicesTouchActive||(onDevicesScrollnagleTimer=setTimeout(onDevicesScrollEx,250))}function onDeviceTouch(e){onDevicesTouchActive!=e&&0==(onDevicesTouchActive=e)&&onDevicesScrollEx()}function onDevicesScrollEx(){null!=onDevicesScrollnagleTimer&&(clearTimeout(onDevicesScrollnagleTimer),onDevicesScrollnagleTimer=null);for(var e,t=Q("xdevices").scrollTop-200,i=Q("xdevices").scrollTop+Q("xdevices").clientHeight+200,o=Q("viewselect").value,n=document.getElementsByName("xxdevice"+o),a=0;a<n.length;a++)n[a].offsetTop>=t&&n[a].offsetTop<i&&null!=(e=getNodeFromId(n[a].id.substring(3)))?updateDeviceViewHtml(o,n[a],e):n[a].innerHTML=""}function updateDeviceViewDevice(e){var t,i=Q("viewselect").value;1!=i&&2!=i?mainUpdate(4):null!=(e="string"==typeof e?getNodeFromId(e):e)&&null!=(t=Q("xv"+i+e._id))&&""!=t.innerHTML&&updateDeviceViewHtml(i,t,e)}function updateDeviceViewHtml(e,t,i){var o=EscapeHtml(i.name),n=(0==o.length&&(o="<i>Nessuna </i>"),null!=i.rname&&0<i.rname.length&&(o+=" / "+EscapeHtml(i.rname)),EscapeHtml(i.name));if(0==(n=1==showRealNames&&null!=i.rname?EscapeHtml(i.rname):n).length&&(n="<i>Nessuna </i>"),1==e&&"none"==t.parentNode.style.display||2==e&&"none"==t.style.display)t.innerHTML="";else{var a="",s="",r=(1==stars[i._id]&&(s+=2==e?"<img class=deviceNotifySmallDotSub src=images/icon-star-notify-10.png width=10 height=10>":"<img class=deviceNotifyDotSub src=images/icon-star-notify-16.png width=16 height=16>"),null!=i.sessions&&(null!=i.sessions.msg&&(s+=2==e?"<div onclick=showDeviceMessages('"+i._id+'\',null,event) style="width:10;height:10" class=deviceNotifySmallDotSub></div>':"<div onclick=showDeviceMessages('"+i._id+'\',null,event) style="width:16;height:16" class=deviceNotifyDotSub>'+Object.keys(i.sessions.msg).length+"</div>"),null==i.sessions.kvm&&null==i.sessions.terminal&&null==i.sessions.files&&null==i.sessions.tcp&&null==i.sessions.udp||(s+=2==e?"<img onclick=showDeviceSessions('"+i._id+"',null,event) class=deviceNotifySmallDotSub src=images/icon-relay-notify10.png width=10 height=10>":"<img onclick=showDeviceSessions('"+i._id+"',null,event) class=deviceNotifyDotSub src=images/icon-relay-notify.png width=16 height=16>"),null!=i.sessions.help&&(s+=2==e?"<img onclick=showDeviceHelpRequests('"+i._id+"',null,event) class=deviceNotifySmallDotSub src=images/icon-help-notify-10.png width=10 height=10>":"<img onclick=showDeviceHelpRequests('"+i._id+"',null,event) class=deviceNotifyDotSub src=images/icon-help-notify-16.png width=16 height=16>"),null!=i.sessions.battery)&&1==e&&(l="","ac"==(r=i.sessions.battery).state&&(l="Il dispositivo è collegato"),"dc"==r.state&&(l="Il dispositivo è alimentato a batteria"),c="",d=-1,"number"==typeof r.level&&0<=r.level&&r.level<=100&&(c=r.level+"%",5<(d=Math.floor((r.level+10)/25)+1)&&(lvl=5),"ac"==r.state)&&(100==r.level?d=11:d+=5),0<d)&&(a+='<div class="deviceBatterySmall deviceBatterySmall'+d+'" title="'+(null!=l?l+", "+c:c)+'"></div>'),""!=s&&(a+=2==e?"<div class=deviceNotifySmallDot>"+s+"</div>":"<div class=deviceNotifyDot>"+s+"</div>"),i.icon);if(i.conn&&0!=i.conn||3==i.mtype||(r+=" gray"),1==e)t.innerHTML='<table id=devs cmenu=devsContentMenu onmouseover=devMouseHover(this,1) onmouseout=devMouseHover(this,0) style=width:100%;height:100%><tr><td style=width:22px><input class="'+i.meshid+' DeviceCheckbox form-check-input me-2" onchange=p1devcheck(event) value=devid_'+i._id+" type=checkbox "+(checkedNodeids[i._id]?" checked":"")+"></td><td><table onmouseup=gotoDevice('"+i._id+"',null,null,event) border=0 cellspacing=0 style=width:100%;height:100%;cursor:pointer><tr><td style=width:50px tabindex=0 onkeypress=\"if (event.key=='Enter') gotoDevice('"+i._id+'\',null,null,event)"><div class="i'+r+'" style=width:50px></div></td><td class=g1t></td><td class=e2t><div class=e1t style=width:'+(t.clientWidth-120)+'px title="'+o+'">'+n+"</div><div>"+NodeStateStr(i)+"</div></td><td class=g2t></td></tr></table></td></tr></table>"+a;else if(2==e){var l,d=[],c=(i.conn&&(0!=(1&i.conn)&&(4==i.mtype?"PDU"==i.porttype?d.push('<span title="La porta dello switch è pronta per l\'uso.">Interruttore</span>'):d.push('<span title="La porta IP-KVM è collegata e pronta per l\'uso.">IP-KVM</span>'):d.push("<span title=\"L'agente mesh è connesso e pronto per l'uso.\">Agente</span>")),0!=(2&i.conn)?d.push('<span title="Intel&reg; AMT CIRA è connesso e pronto per l\'uso.">CIRA</span>'):0!=(4&i.conn)&&d.push('<span title="Intel&reg; AMT è instradabile.">AMT</span>'),0!=(8&i.conn)&&d.push('<span title="L\'agente mesh è raggiungibile utilizzando un altro agente come inoltro.">Ritrasmissioni</span>'),0!=(16&i.conn))&&d.push('<span title="La connessione MQTT al dispositivo è attiva.">MQTT </span>'),3==i.mtype&&((l=meshes[i.meshid])&&l.relayid?d.push('<span title="Connessione di rete locale tramite un agente di inoltro.">Ritrasmissioni</span>'):d.push('<span title="Connessione di rete locale.">Locale</span>')),i.desc&&0<=deviceViewSettings.devsCols.indexOf("desc")&&(n='<div class="flex-grow-1">'+n+"</div><div style=float:right"+(1==stars[i._id]?";padding-right:15px":"")+">"+EscapeHtml(i.desc)+"</div>"),i.meshid),u=(1==sort?c="pwr:"+(i.pwr||0):3!=sort&&4!=sort||(c="tag:**xx**xx*TaG*xx**xx**"),CollapsedGroups[c],"<td style=position:relative><div id=devs cmenu=devsContentMenu class=bar18 tabindex=0 onmouseover=devMouseHover(this,1) onmouseout=devMouseHover(this,0) style=height:18px;width:100%;font-size:medium onkeypress=\"if (event.key=='Enter') gotoDevice('"+i._id+"',null,null,event)\">");if(u=(u=(u+='<div class=deviceBarCheckbox><input class="'+i.meshid+' DeviceCheckbox form-check-input me-2" value=devid_'+i._id+" type=checkbox onchange=p1devcheck(event) "+(checkedNodeids[i._id]?" checked":"")+"></div>")+("<div class=deviceBarIcon onmouseup=gotoDevice('"+i._id+"',null,null,event)><div class=\"j"+r+'" style=width:16px;margin-top:1px;margin-left:2px;height:16px></div></div>'))+"<div class=g1 style=height:18px;float:left></div><div class=g2 style=height:18px;float:right></div>"+('<div class="style10 d-flex align-items-center" style=cursor:pointer;font-size:14px;max-height:18px;text-overflow:ellipsis;overflow:hidden;white-space:nowrap title="'+o+"\" onmouseup=gotoDevice('"+i._id+"',null,null,event)>"+n+"</div></div>"+a+"</td>"),null==deviceViewSettings&&(deviceViewSettings={}),Array.isArray(deviceViewSettings.devsCols)||(deviceViewSettings.devsCols=["user","ip","conn"]),0<=deviceViewSettings.devsCols.indexOf("agtype")&&(u+='<td style=text-align:center;font-size:x-small;padding-left:4px;padding-right:4px title="'+EscapeHtml(3!=i.mtype&&i.agent&&i.agent.id&&i.agent.id<=agentsStr.length?agentsStr[i.agent.id]:"")+'">'+EscapeHtml(3!=i.mtype&&i.agent&&i.agent.id&&i.agent.id<=agentsStr.length?agentsStr[i.agent.id]:"").replace(",","<br />")),0<=deviceViewSettings.devsCols.indexOf("agver")&&(u+='<td style=text-align:center;font-size:x-small;padding-left:4px;padding-right:4px title="'+EscapeHtml(i.agent&&i.agent.core?i.agent.core:"")+'">'+EscapeHtml(i.agent&&i.agent.core?i.agent.core:"").replace(",","<br />")),0<=deviceViewSettings.devsCols.indexOf("os")&&(3==i.mtype?(s="",4==i.agent.id&&(s="Windows"),6==i.agent.id&&(s="Linux"),29==i.agent.id&&(s="MacOS"),u+='<td style=text-align:center;font-size:x-small title="'+EscapeHtml(s)+'">'+EscapeHtml(s)):u+='<td style=text-align:center;font-size:x-small title="'+EscapeHtml(i.osdesc||"")+'">'+EscapeHtml(i.osdesc||"")),0<=deviceViewSettings.devsCols.indexOf("tags")){u+="<td style=text-align:center;font-size:x-small>";var p="";if(null!=i.tags)for(var m in i.tags)p+="<span class=tagSpan>"+EscapeHtml(i.tags[m])+"</span> ";u+="<span style=line-height:20px>"+p+"</span>"}0<=deviceViewSettings.devsCols.indexOf("windowsav")&&(u+="<td style=text-align:center>"+(i.wsc&&null!=i.wsc.antiVirus?"OK"==i.wsc.antiVirus?"<span style=color:green>OK</span>":"<span style=color:red>CATTIVO</span>":"")),0<=deviceViewSettings.devsCols.indexOf("windowsupdate")&&(u+="<td style=text-align:center>"+(i.wsc&&null!=i.wsc.autoUpdate?"OK"==i.wsc.autoUpdate?"<span style=color:green>OK</span>":"<span style=color:red>CATTIVO</span>":"")),0<=deviceViewSettings.devsCols.indexOf("windowsfirewall")&&(u+="<td style=text-align:center>"+(i.wsc&&null!=i.wsc.firewall?"OK"==i.wsc.firewall?"<span style=color:green>OK</span>":"<span style=color:red>CATTIVO</span>":"")),0<=deviceViewSettings.devsCols.indexOf("lastbootuptime")&&(u+="<td style=text-align:center;font-size:x-small>"+(null!=i.lastbootuptime?printDateTime(new Date(i.lastbootuptime)):"")),0<=deviceViewSettings.devsCols.indexOf("links")&&(u+="<td style=text-align:center;font-size:x-small>"+getShortRouterLinks(i)),0<=deviceViewSettings.devsCols.indexOf("user")&&(u+="<td style=text-align:center>"+getUserShortStr(i)),0<=deviceViewSettings.devsCols.indexOf("ip")&&(l="",3==i.mtype?l=i.host:i.ip&&(l=i.ip),u+="<td style=text-align:center>"+l),0<=deviceViewSettings.devsCols.indexOf("conn")&&(u+="<td style=text-align:center>"+d.join("&nbsp;+&nbsp;")),0<=deviceViewSettings.devsCols.indexOf("lastseen")&&(u+="<td style=text-align:center;font-size:x-small>",0<i.conn?u+="Collegato":null!=i.lastconnect&&(u+=printDateTime(new Date(i.lastconnect)))),0<=deviceViewSettings.devsCols.indexOf("amthost")&&(u+="<td style=text-align:center>"+(null==i.intelamt||null==i.intelamt.host?"":EscapeHtml(i.intelamt.host))),0<=deviceViewSettings.devsCols.indexOf("amtstate")&&(c="",i.intelamt&&(0==i.intelamt.state&&(c=' <span title="Intel&reg; AMT is not activated">Pre</span>'),1==i.intelamt.state&&(c=' <span title="Intel&reg; AMT is in activation mode">In</span>'),2==i.intelamt.state)&&i.intelamt.flags&&(2&i.intelamt.flags?c=' <span title="Intel&reg; AMT è attivato in modalità di controllo del cliente">CCM</span>':4&i.intelamt.flags&&(c+=' <span title="Intel&reg; AMT è attivato in modalità di controllo amministratore">ACM</span>')),u+="<td style=text-align:center>"+c),t.innerHTML=u}else if(3==e||5==e)return u="<div id=devs cmenu=devsContentMenu style=display:inline-block;position:relative;margin:1px;background-color:lightgray;border-radius:5px;position:relative><div tabindex=0 style=padding:3px;cursor:pointer onmouseup=gotoDevice('"+i._id+"',11,null,event) onkeypress=\"if (event.key=='Enter') gotoDevice('"+i._id+"',11,null,event)\">"+a,(u+='<div class="j'+r+'" style=width:16px;float:left></div>&nbsp;'+n+"</div>")+"<span onmouseup=gotoDevice('"+i._id+"',null,null,event)></span><div id=xkvmid_"+i._id.split("/")[2]+"><div id=skvmid_"+i._id.split("/")[2]+' tabindex=0 style="position:absolute;color:white;left:5px;top:27px;text-shadow:0px 0px 5px #000;z-index:10;cursor:default" onclick=toggleKvmDevice(\''+i._id+"') onkeypress=\"if (event.key=='Enter') toggleKvmDevice('"+i._id+"')\">Disconnesso</div></div></div>"}}function getShortRouterLinks(e){var t="",i=GetNodeRights(e);if((0!=(1&e.conn)||3==e.mtype)&&e.agent&&0!=(8&i)&&14!=e.agent.id&&(0!=webRelayPort&&(t=(t+='<a href=# onclick=p10WebRouter("'+e._id+'",1,'+(e.httpport||80)+")>HTTP"+(e.httpport&&80!=e.httpport?"/"+e.httpport:"")+"</a>&nbsp;")+'<a href=# onclick=p10WebRouter("'+e._id+'",2,'+(e.httpsport||443)+")>HTTPS"+(e.httspport&&443!=e.httpsport?"/"+e.httpsport:"")+"</a>&nbsp;"),0<e.agent.id&&e.agent.id<5&&("win32"!=navigator.platform.toLowerCase()||null!=serverinfo.devicemeshrouterlinks&&0==serverinfo.devicemeshrouterlinks.rdp||(t+='<a href=# cmenu=altPortContextMenu id=rdpMCRouterLink onclick=p10MCRouter("'+e._id+'",3)>RDP</a>&nbsp;')),4<e.agent.id&&("win32"!=navigator.platform.toLowerCase()&&"macintel"!=navigator.platform.toLowerCase()||null!=serverinfo.devicemeshrouterlinks&&0==serverinfo.devicemeshrouterlinks.ssh||(t+='<a href=# onclick=p10MCRouter("'+e._id+'",4,'+(e.sshport||22)+")>SSH</a>&nbsp;"),"win32"!=navigator.platform.toLowerCase()||null!=serverinfo.devicemeshrouterlinks&&0==serverinfo.devicemeshrouterlinks.scp||(t+='<a href=# onclick=p10MCRouter("'+e._id+'",5,'+(e.sshport||22)+")>SCP</a>&nbsp;")),"win32"==navigator.platform.toLowerCase()||"macintel"==navigator.platform.toLowerCase())&&null!=serverinfo.devicemeshrouterlinks&&Array.isArray(serverinfo.devicemeshrouterlinks.extralinks))for(var o in serverinfo.devicemeshrouterlinks.extralinks){var o=serverinfo.devicemeshrouterlinks.extralinks[o],n='"'+o.protocol+'"';doesDeviceMatchFilterTags(e,o.filter)&&(3!=e.mtype||"mcrdesktop"!=o.protocol&&"mcrfiles"!=o.protocol)&&("number"==typeof o.protocol?n=o.protocol:"http"==o.protocol?n=1:"https"==o.protocol?n=2:"rdp"==o.protocol?n=3:"ssh"==o.protocol?n=4:"scp"==o.protocol?n=5:"mcrdesktop"==o.protocol?n=6:"mcrfiles"==o.protocol&&(n=7),t+='<a href=# onclick=p10MCRouter("'+e._id+'",'+n+","+o.port+(o.ip?',"'+o.ip+'"':",null")+","+(o.localport||0)+")>"+o.name+"</a>&nbsp;")}return t}function doesDeviceMatchFilterTags(e,t){if(null==t)return!0;if(Array.isArray(t)){if(0<=t.indexOf(e.meshid))return!0;if(0<=t.indexOf(e._id))return!0;if(Array.isArray(e.tags))for(var i in e.tags)if(0<=t.indexOf("tag:"+e.tags[i]))return!0}return!1}function showDeviceHelpRequests(e,t,i){if(i&&haltEvent(i),!xxdialogMode||t){var o=null,n="";if(null==(o=null==e?currentNode:getNodeFromId(e))||null==o.sessions)setDialogMode(0);else{if(null!=o.sessions.help)for(var a in o.sessions.help)n+='<div style="background-color:#CCC;padding:6px;border-radius:6px"><a style="float:right" onclick=closeDeviceHelpRequest("'+encodeURIComponentEx(a)+'","'+encodeURIComponentEx(o._id)+'")>Respingere</a><div style=margin-bottom:6px><b>'+EscapeHtml(a)+"</b></div><div style=margin-bottom:6px>"+EscapeHtml(o.sessions.help[a])+"</div></div>";""!=n&&(xxdialogTag="HELPREQ-"+o._id,setModalContent("xxAddAgent","Richieste di aiuto - "+EscapeHtml(o.name),n),showModal("xxAddAgentModal","idx_dlgOkButton"))}}return!1}function closeDeviceHelpRequest(e,t){setDialogMode(0),meshserver.send({action:"msg",type:"localapp",nodeid:decodeURIComponent(t),appid:decodeURIComponent(e),value:{cmd:"cancelhelp"}})}function showDeviceSessions(e,t,i){if(i&&haltEvent(i),!xxdialogMode||t){var o=null,n="";if(null==(o=null==e?currentNode:getNodeFromId(e))||null==o.sessions)setDialogMode(0);else{for(var a in o.sessions)if("kvm"==a&&null==o.sessions.multidesk)for(var s in n+="<u>Desktop remoto</u>",o.sessions.kvm)s.startsWith("user/")?(r="",s!=userinfo._id&&4294967295!=GetNodeRights(o)||(r=' <i role=button onclick=\'return endDeviceSession("kvm", "'+encodeURIComponentEx(o._id)+'", "'+encodeURIComponentEx(s)+'")\' title="Disconnetti questa sessione" class="fa-fw fa-solid fa-trash text-danger" ></i>'),n+=addHtmlValue2(getUserName(s),(1==o.sessions.kvm[s]?"1 sessione":nobreak(format("{0} sessioni",o.sessions.kvm[s])))+r)):"busy"==s&&(n+=addHtmlValue2("Il dispositivo è occupato",1==o.sessions.kvm[s]?"1 sessione":nobreak(format("{0} sessioni",o.sessions.kvm[s]))));else if("multidesk"==a)for(var s in n+="<u>Desktop remoto</u>",o.sessions.multidesk){var r="";s!=userinfo._id&&4294967295!=GetNodeRights(o)||(r=' <i role=button onclick=\'return endDeviceSession("multidesk", "'+encodeURIComponentEx(o._id)+'", "'+encodeURIComponentEx(s)+'")\' title="Disconnetti questa sessione" class="fa-fw fa-solid fa-trash text-danger"></i>'),n+=addHtmlValue2(getUserName(s),(1==o.sessions.multidesk[s]?"1 sessione":nobreak(format("{0} sessioni",o.sessions.multidesk[s])))+r)}else if("terminal"==a)for(var s in n+="<u>Terminale</u>",o.sessions.terminal){r="";s!=userinfo._id&&4294967295!=GetNodeRights(o)||(r=' <i role=button onclick=\'return endDeviceSession("terminal", "'+encodeURIComponentEx(o._id)+'", "'+encodeURIComponentEx(s)+'")\' title="Disconnetti questa sessione" class="fa-fw fa-solid fa-trash text-danger"></i>'),n+=addHtmlValue2(getUserName(s),(1==o.sessions.terminal[s]?"1 sessione":nobreak(format("{0} sessioni",o.sessions.terminal[s])))+r)}else if("files"==a)for(var s in n+="<u>File</u>",o.sessions.files){r="";s!=userinfo._id&&4294967295!=GetNodeRights(o)||(r=' <i role=button onclick=\'return endDeviceSession("files", "'+encodeURIComponentEx(o._id)+'", "'+encodeURIComponentEx(s)+'")\' title="Disconnetti questa sessione" class="fa-fw fa-solid fa-trash text-danger"></i>'),n+=addHtmlValue2(getUserName(s),(1==o.sessions.files[s]?"1 sessione":nobreak(format("{0} sessioni",o.sessions.files[s])))+r)}else if("tcp"==a)for(var s in n+="<u>Instradamento TCP</u>",o.sessions.tcp){r="";s!=userinfo._id&&4294967295!=GetNodeRights(o)||(r=' <i role=button onclick=\'return endDeviceSession("tcp", "'+encodeURIComponentEx(o._id)+'", "'+encodeURIComponentEx(s)+'")\' title="Disconnetti questa sessione" class="fa-fw fa-solid fa-trash text-danger"></i>'),n+=addHtmlValue2(getUserName(s),(1==o.sessions.tcp[s]?"1 sessione":nobreak(format("{0} sessioni",o.sessions.tcp[s])))+r)}else if("udp"==a)for(var s in n+="<u>Instradamento UDP</u>",o.sessions.udp){r="";s!=userinfo._id&&4294967295!=GetNodeRights(o)||(r=' <i role=button onclick=\'return endDeviceSession("udp", "'+encodeURIComponentEx(o._id)+'", "'+encodeURIComponentEx(s)+'")\' title="Disconnetti questa sessione" class="fa-fw fa-solid fa-trash text-danger"></i>'),n+=addHtmlValue2(getUserName(s),(1==o.sessions.udp[s]?"1 sessione":nobreak(format("{0} sessioni",o.sessions.udp[s])))+r)}""!=n?(xxdialogTag="SESSIONS-"+o._id,setModalContent("xxAddAgent","sessioni - "+EscapeHtml(o.name),n),showModal("xxAddAgentModal","idx_dlgOkButton")):setDialogMode(0)}}return!1}function endDeviceSession(e,t,i){var i=decodeURIComponent(i).split("/"),o=i[0]+"/"+i[1]+"/"+i[2],n=null;4==i.length&&i[3].startsWith("guest:")&&(n=atob(i[3].substring(6))),"multidesk"==e?meshserver.send({action:"endDesktopMultiplex",nodeid:decodeURIComponent(t),xuserid:o,guestname:n,guestname:n}):meshserver.send({action:"msg",type:"endtunnel",nodeid:decodeURIComponent(t),xuserid:o,guestname:n,guestname:n,protocol:e})}function showDeviceMessages(e,t,i){if(i&&haltEvent(i),!xxdialogMode||t){var o=null,n="<div style=max-height:200px;overflow-y:auto>",a=0;if(null==(o=null==e?currentNode:getNodeFromId(e))||null==o.sessions||null==o.sessions.msg)setDialogMode(0);else{for(var s in o.sessions.msg){var r=s,l=5;"string"==typeof o.sessions.msg[s].msg&&(r=o.sessions.msg[s].msg),"number"==typeof o.sessions.msg[s].msgid&&null!=eventsMessageId[o.sessions.msg[s].msgid]&&(r=eventsMessageId[o.sessions.msg[s].msgid]),n+="<table style=width:96%><td style=width:24px><div class=NotifyIconSmall"+(l=(l="number"==typeof o.sessions.msg[s].icon?o.sessions.msg[s].icon:l)<1||9<l?5:l)+'></div><td><div style="border-radius:5px;background-color:#BBB;width:100%;padding:8px">'+EscapeHtml(r)+"</div></table>",a++}n+="</div>",0<a&&(xxdialogTag="MESSAGES-"+o._id,setModalContent("xxAddAgent","Messaggi dell'agente - "+EscapeHtml(o.name),n),showModal("xxAddAgentModal","idx_dlgOkButton"))}}return!1}function toggleCollapseGroup(e,t,i){if(2==i){var o=document.getElementsByName("xxdevice2");if(0==o.length)return;for(var n,a=[],s=0;s<o.length;s++)o[s].attributes.colname.value.substring(7)==t&&a.push(o[s]);(n="none"==a[0].style.display)?delete CollapsedGroups[t]:CollapsedGroups[t]=!0;for(s=0;s<a.length;s++)a[s].style.display=n?"":"none"}else(n="none"==QS("DevxCol"+e).display)?delete CollapsedGroups[t]:CollapsedGroups[t]=!0,QV("DevxCol"+e,n);n?(QC("DevxColImg"+e).remove("fa-chevron-right"),QC("DevxColImg"+e).add("fa-chevron-down")):(QC("DevxColImg"+e).remove("fa-chevron-down"),QC("DevxColImg"+e).add("fa-chevron-right")),putstore("_collapse",JSON.stringify(CollapsedGroups)),updateCollapseAllButton(),onDevicesScrollEx(),onDevicesScrollEx()}function toggleKvmDevice(e){var t=GetNodeRights(e="string"==typeof e?getNodeFromId(e):e);(8&t||256&t)&&1&e.conn&&connectMultiDesktop(e,1)}function getUserShortStr(e){var t,i;return null!=e&&null!=e.users&&Array.isArray(e.users)&&0!=e.users.length?1<e.users.length?'<span title="'+EscapeHtml(e.users.join(", "))+'">'+nobreak(format("{0} utenti",e.users.length))+"</span>":(0<(i=(t=e=e.users[0]).indexOf("\\"))&&(t=e.substring(i+1)),15<(t=EscapeHtml(t)).length&&(t=t.substring(0,14)+"&#8230;"),'<span title="'+EscapeHtml(e)+'">'+t+"</span>"):""}function autoConnectDesktops(){1==Q("autoConnectDesktopCheckbox").checked&&connectAllKvmFunction()}function connectAllKvmFunction(e){if(xxdialogMode)return!1;if(!0!==e){var i,t=0;for(a in nodes){var o=nodes[a],n=nodes[a]._id;null!=multiDesktop[n]||0!=Object.keys(checkedNodeids).length&&!checkedNodeids[n]||(8&(n=GetNodeRights(o))||256&n)&&1&o.conn&&1==o.v&&t++}if(8<t)return setModalContent("xxAddAgent","Connetti tutto",format("Sei sicuro di volerti connettere ai dispositivi {0}?",t)),i=function(e,t){document.getElementById("xxAddAgentModal").removeEventListener("hide.bs.modal",i),Q("autoConnectDesktopCheckbox").checked=!1},document.getElementById("xxAddAgentModal").addEventListener("hide.bs.modal",i),void showModal("xxAddAgentModal","idx_dlgOkButton",()=>{document.getElementById("xxAddAgentModal").removeEventListener("hide.bs.modal",i),connectAllKvmFunction(!0)})}for(var a in nodes)1!=nodes[a].v||null!=multiDesktop[nodes[a]._id]||0!=Object.keys(checkedNodeids).length&&!checkedNodeids[nodes[a]._id]||toggleKvmDevice(nodes[a]._id)}function disconnectAllKvmFunction(){if(xxdialogMode)return!1;for(var e in multiDesktop)multiDesktop[e].Stop();multiDesktop={}}function onMultiDesktopStateChange(e,t){try{QH("skvmid_"+e.shortid,["Disconnesso","Collegamento ...","Impostare...","",""][t])}catch(e){}}function onDeviceSearchChanged(e){var t=new URL(window.location.href);if(null==e||"SearchInput"!=e.target.id&&"KvmSearchInput"!=e.target.id?null!=e&&"DevFilterSelect"==e.target.id||(t.searchParams.delete("filter"),urlargs.filter&&delete urlargs.filter):("SearchInput"==e.target.id?Q("KvmSearchInput").value=Q("SearchInput").value:Q("SearchInput").value=Q("KvmSearchInput").value,""!=e.target.value?(t.searchParams.set("filter",e.target.value),urlargs.filter&&(urlargs.filter=e.target.value)):(t.searchParams.delete("filter"),urlargs.filter&&delete urlargs.filter)),0==(268435456&features)&&0<xxcurrentView)try{window.history.replaceState({},document.title,decodeURIComponent(t.toString()))}catch(e){}mainUpdate(5)}function showMultiDesktopSettings(){QV("td7amtkvm",!1),QV("td7meshkvm",!0),QV("td7rdpkvm",!1),QV("d7desktopOtherSettings",!1),d7bitmapquality.value=multidesktopsettings.quality,d7bitmapscaling.value=multidesktopsettings.scaling,d7encoding.value=multidesktopsettings.agentencoding,multidesktopsettings.framerate?d7framelimiter.value=multidesktopsettings.framerate:d7framelimiter.value=100,setModalContent("xxAddAgent","Impostazioni desktop remoto",x),showModal("xxAddAgentModal","idx_dlgOkButton",()=>showMultiDesktopSettingsChanged())}function showMultiDesktopSettingsChanged(){for(var e in multidesktopsettings.quality=d7bitmapquality.value,multidesktopsettings.scaling=d7bitmapscaling.value,multidesktopsettings.framerate=d7framelimiter.value,multidesktopsettings.agentencoding=d7encoding.value,localStorage.setItem("multidesktopsettings",JSON.stringify(multidesktopsettings)),multiDesktop)multiDesktop[e].m.SendCompressionLevel(multidesktopsettings.agentencoding,multidesktopsettings.quality,multidesktopsettings.scaling,multidesktopsettings.framerate)}function connectMultiDesktop(e,t){var i=e._id,o=i.split("/")[2],n=multiDesktop[i];null==n?null!=Q("kvmid_"+o)&&(2==t?null!=e.intelamt.user&&""!=e.intelamt.user&&((n=CreateAmtRedirect(CreateAmtRemoteDesktop("kvmid_"+o),authCookie)).shortid=o,n.onStateChanged=onMultiDesktopStateChange,n.m.bpp=1,n.m.useZRLE=!0,n.m.showmouse=!0,n.m.onKvmData=function(e){console.log("KVM Data received in multi-desktop mode, this is not supported.")},n.m.onScreenSizeChange=mdeskAdjust,n.Start(i,16994,"*","*",0),n.contype=2,multiDesktop[i]=n):1==t&&((n=CreateAgentRedirect(meshserver,CreateAgentRemoteDesktop("kvmid_"+o),serverPublicNamePort,authCookie,authRelayCookie,domainUrl)).m.UseExtendedKeyFlag=e.agent.id<5,n.m.mouseCursorActive(11==xxcurrentView),n.shortid=o,n.attemptWebRTC=attemptWebRTC,n.webrtcconfig=webrtcconfiguration,n.onStateChanged=onMultiDesktopStateChange,n.m.ImageType=multidesktopsettings.agentencoding,n.m.CompressionLevel=multidesktopsettings.quality,n.m.ScalingLevel=multidesktopsettings.scaling,multidesktopsettings.framerate&&(n.m.FrameRateTimer=multidesktopsettings.framerate),multidesktopsettings.swapmouse&&(n.m.SwapMouse=multidesktopsettings.swapmouse),multidesktopsettings.rmw&&(n.m.ReverseMouseWheel=multidesktopsettings.rmw),1==multidesktopsettings.remotekeymap&&(n.m.remoteKeyMap=multidesktopsettings.remotekeymap),n.m.onScreenSizeChange=mdeskAdjust,n.Start(i),n.contype=1,multiDesktop[i]=n)):(n.Stop(),delete multiDesktop[i])}function getMeshActions(e,t){return 0==(4&t)?"":(t="",1==e.mtype&&(0==(1&features)&&(t=(t+=' <a href=# role="button" title="Aggiungi un nuovo Intel&reg; Computer AMT che si trova sulla rete locale." onclick=\'return addDeviceToMesh("'+e._id+"\")'>Aggiungi locale</a>")+' <a href=# role="button" title="Aggiungi un nuovo Intel&reg; Computer AMT eseguendo la scansione della rete locale." onclick=\'return addAmtScanToMesh("'+e._id+"\")'>Scansione rete</a>"),e.amt)&&0<e.amt.type&&(t+=' <a href=# role="button" title="Esegui Intel&reg; Attivazione e configurazione AMT." onclick=\'return showAmtSetup("'+e._id+"\")'>Impostare</a>"),2!=e.mtype||4294967295!=userinfo.siteadmin&&0!=(4096&userinfo.siteadmin)||(t+=' <a href=# role="button" title="Aggiungi un nuovo computer a questo gruppo di dispositivi installando l\'agente mesh." onclick=\'return addAgentToMesh("'+e._id+"\")'>Aggiungi agente</a>",0==(2&features)&&(t+=' <a href=# role="button" title="Invita qualcuno a installare l\'agente mesh su questo gruppo di dispositivi." onclick=\'return inviteAgentToMesh("'+e._id+"\")'>Invitare</a>")),3==e.mtype&&(t+=' <a href=# role="button" title="Aggiungi dispositivo situato sulla rete locale." onclick=\'return addLocalDeviceToMesh("'+e._id+"\")'>Aggiungi dispositivo</a>"),t)}function addLocalDeviceToMesh(e){if(xxdialogMode)return!1;var t=meshes[e],t=format('Aggiungi un dispositivo locale al gruppo di dispositivi "{0}".',EscapeHtml(t.name))+"<br /><br />";setModalContent("xxAddAgent","Aggiungi dispositivo locale",(t+=addHtmlFormFloating("Nome del dispositivo","<input id=dp1devicename class=form-control maxlength=32 autocomplete=off onchange=validateLocalDeviceToMesh() onkeyup=validateLocalDeviceToMesh() />"))+addHtmlFormFloating("Nome host",'<input id=dp1hostname class=form-control maxlength=32 autocomplete=off placeholder="Uguale al nome del dispositivo" onchange=validateLocalDeviceToMesh() onkeyup=validateLocalDeviceToMesh() />')+addHtmlFormFloating("Digita","<select id=dp1type class=form-select><option value=4>Windows (RDP)</option><option value=6>Linux (SSH/SCP/VNC)</option><option value=29>macOS (SSH/SCP/VNC)</option></select>")),showModal("xxAddAgentModal","idx_dlgOkButton",()=>addLocalDeviceToMeshEx(3,e)),validateLocalDeviceToMesh(),Q("dp1devicename").focus()}function validateLocalDeviceToMesh(){QE("idx_dlgOkButton",0<Q("dp1devicename").value.length)}function addLocalDeviceToMeshEx(e,t){var i=Q("dp1hostname").value;""==i&&(i=Q("dp1devicename").value),meshserver.send({action:"addlocaldevice",meshid:t,devicename:Q("dp1devicename").value,hostname:i,type:parseInt(Q("dp1type").value)})}function addDeviceToMesh(e){var t;return xxdialogMode||(t=meshes[e],t=format('Aggiungi un nuovo Intel&reg; Da dispositivo AMT a gruppo di dispositivi "{0}".',EscapeHtml(t.name))+"<br /><br />",setModalContent("xxAddAgent","Aggiungi Intel&reg; Dispositivo AMT",t=(t=(t=(t=(t+=addHtmlFormFloating("Nome del dispositivo",'<input id=dp1devicename class="form-control" maxlength=32 autocomplete=off onchange=validateDeviceToMesh() onkeyup=validateDeviceToMesh() />'))+addHtmlFormFloating("Nome host",'<input id=dp1hostname class="form-control" maxlength=32 autocomplete=off placeholder="Uguale al nome del dispositivo" onchange=validateDeviceToMesh() onkeyup=validateDeviceToMesh() />'))+addHtmlFormFloating("Nome utente",'<input id=dp1username class="form-control" maxlength=32 autocomplete=off placeholder="admin" onchange=validateDeviceToMesh() onkeyup=validateDeviceToMesh() />'))+addHtmlFormFloating("Password",'<input id=dp1password type=password class="form-control" autocomplete=off maxlength=32 onchange=validateDeviceToMesh() onkeyup=validateDeviceToMesh() />'))+addHtmlFormFloating("Sicurezza",'<select id=dp1tls class="form-select"><option value=0>Nessuna sicurezza TLS </option><option value=1>Sicurezza TLS richiesta</option></select>')),showModal("xxAddAgentModal","idx_dlgOkButton",()=>addDeviceToMeshEx(3,e)),validateDeviceToMesh(),Q("dp1devicename").focus()),!1}function showAmtImport(e){xxdialogMode||(setModalContent("xxAddAgent","Intel&reg; AMT Device Import",'Create many Intel&reg; AMT device at once by importing a JSON file with the following format:<br /><pre>[\r\n  {\r\n    "fqdn":"mycomputer.com",\r\n    "uuid":"xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx",\r\n    "version":"12.0.1",\r\n    "username":"admin",\r\n    "password":"password",\r\n    "tls":true\r\n  }\r\n]</pre><input type=file id=d4importFile class="form-control" accept=".json" onchange=showAmtImportValidate() />'),showModal("xxAddAgentModal","idx_dlgOkButton",()=>showAmtImportEx(3,e)),QE("idx_dlgOkButton",!1))}function showAmtImportValidate(){QE("idx_dlgOkButton",null!=Q("d4importFile").value)}function showAmtImportEx(e,i){var t=new FileReader;t.onload=function(e){var t=null;try{t=JSON.parse(e.target.result)}catch(e){return setModalContent("xxAddAgent","Intel&reg; AMT Device Import",format("File JSON non valido: {0}.",e)),void showModal("xxAddAgentModal","idx_dlgOkButton")}null!=t?meshserver.send({action:"importamtdevices",meshid:i,amtdevices:t}):(setModalContent("xxAddAgent","Intel&reg; AMT Device Import","Formato file JSON non valido."),showModal("xxAddAgentModal","idx_dlgOkButton"))},t.readAsText(Q("d4importFile").files[0])}function showAmtSetup(e){var t,i;return xxdialogMode||(t=serverinfo.name,i=meshes[e],-1!=t.indexOf(".")&&0==(2&features)||(t=window.location.hostname),domainUrl.substring(0,domainUrl.length-1),t=1==serverinfo.https?"wss://"+t+(443==serverinfo.port?"":":"+serverinfo.port)+domainUrl:"ws://"+t+(80==serverinfo.port?"":":"+serverinfo.port)+domainUrl,i=format('Aggiungi, attiva e configura Intel&reg; AMT al gruppo "{0}" eseguendo periodicamente MeshCmd come amministratore sul dispositivo remoto.',EscapeHtml(i.name))+"<br /><br />",i+="<textarea readonly=readonly style=width:100%;resize:none;height:100px;overflow:auto;font-size:12px readonly>meshcmd amtconfig --url "+t+"apf.ashx --id '"+e.split("/")[2]+"' --serverhttpshash "+serverinfo.tlshash+"</textarea>",null!=serverinfo.amtAcmFqdn&&(i+="<div style=margin-top:8px>Per l'attivazione ACM, Intel&reg; AMT dovrà essere impostato sul seguente FQDN attendibile: <b>"+serverinfo.amtAcmFqdn.join(", ")+"</b></div>"),setModalContent("xxAddAgent","Intel&reg; Configurazione AMT",i),showModal("xxAddAgentModal","idx_dlgOkButton"),Q("idx_dlgOkButton").focus()),!1}function showAmtAcmSetup(){if(xxdialogMode)return!1;var e="<table><tr><td><img src=images/usbkey70.png height=70 width=31 style=margin-left:4px;margin-right:8px><td><div>Attiva Intel&reg; AMT in modalità di controllo amministratore (ACM) utilizzando una chiave USB formattata FAT. Posizionare setup.bin su di esso e avviare uno o più computer con questa chiave.</div><div style=margin-top:6px>Inizia inserendo la vecchia e la nuova password MBEx.</div></table>",e=(e=(e+=addHtmlFormFloating("vecchia password ",'<input id=dp1password0 type=password class="form-control" autocomplete=off maxlength=32 onchange=validateAmtAcmSetupEx() onkeyup=validateAmtAcmSetupEx() />'))+addHtmlFormFloating("Nuova password* ",'<input id=dp1password1 type=password class="form-control" autocomplete=off maxlength=32 onchange=validateAmtAcmSetupEx() onkeyup=validateAmtAcmSetupEx() />'))+addHtmlFormFloating("Nuova password* ",'<input id=dp1password2 type=password class="form-control" autocomplete=off maxlength=32 onchange=validateAmtAcmSetupEx() onkeyup=validateAmtAcmSetupEx() />');32&features2&&1==currentMesh.mtype&&serverinfo.amtProvServerMeshId==currentMesh._id&&(e+='<label><input id=dp1lanprov type=checkbox class="form-check-input me-2" /> Utilizzare per l\'attivazione LAN bare metal.</label>'),setModalContent("xxAddAgent","Intel&reg; AMT ACM",e+='<div><span id=dp10passNotify style="font-size:10px"> * 8-16 caratteri, 1 maiuscolo, 1 minuscolo, 1 numerico, 1 non alfanumerico.</span></div>'),showModal("xxAddAgentModal","idx_dlgOkButton",showAmtAcmSetupEx),Q("dp1password0").focus(),validateAmtAcmSetupEx()}function validateAmtAcmSetupEx(){var e=Q("dp1password0").value,t=Q("dp1password1").value,i=Q("dp1password2").value,o=!0;"admin"!=e&&0==checkPasswordRequirements(e,{min:8,max:16,numeric:1,lower:1,upper:1,nonalpha:1})&&(o=!1),t==i&&0!=checkPasswordRequirements(t,{min:8,max:16,numeric:1,lower:1,upper:1,nonalpha:1})||(o=!1),QE("idx_dlgOkButton",o)}function showAmtAcmSetupEx(){meshserver.send({action:"amtsetupbin",oldmebxpass:Q("dp1password0").value,newmebxpass:Q("dp1password1").value,baremetal:32&features2&&Q("dp1lanprov").checked})}function addAmtScanToMesh(e){return xxdialogMode||(setModalContent("xxAddAgent","Scansione per Intel&reg; Dispositivi AMT","Inserisci un intervallo di indirizzi IP per cercare Intel&reg; Dispositivi AMT.<br /><br />"+addHtmlValue("Intervallo IP",'<table style=width:250px><tr><td style=width:99%><input id=dp1range style=width:100% list=iprangelist value="192.168.1.0/24" onkeyup=addAmtScanToMeshKeyUp(event) /><td style=width:1%><input id=dp1rangebutton type=button value="Scansione" onclick=addAmtScanToMeshButton()></input></tr></table>')+'<div id=dp1results style="width:100%;height:200px;background-color:white;border:1px gray solid;overflow-y:scroll"></div>'+('<input type=hidden id=amtScanMeshId value="'+(xxdialogTag=e)+'" />')+'<div style="padding:10px;margin-bottom:5px"><input id="idx_dlgCancelButton2" type="button" value="Annulla" style="" onclick="dialogclose(0)" /><input id="idx_dlgOkButton2" type="button" value="OK" style="" onclick="dialogclose(1)" /><div><input id="d2scanSelectButton" type="button" value="Seleziona tutto" onclick="scanSelectAll()" /></div></div>'),showModal("xxAddAgentModal","idx_dlgOkButton",addAmtScanToMeshEx),QE("idx_dlgOkButton2",!1),QE("d2scanSelectButton",!1),QH("dp1results","<div style=width:100%;text-align:center;margin-top:12px;color:gray;line-height:1.5>Valori dell'intervallo IP di esempio<br />192.168.0.100<br />192.168.1.0/24<br />192.167.0.1-192.168.0.100</div>"),focusTextBox("dp1range"),addAmtScanToMeshKeyUp()),!1}function scanSelectAll(){for(var e=document.getElementsByClassName("DevScanCheckbox"),t=0;t<e.length;t++)e[t].checked=!0;addAmtScanToMeshCheckbox()}function addAmtScanToMeshKeyUp(e){QE("dp1rangebutton",3<Q("dp1range").value.split(".").length),e&&13==e.keyCode&&(haltEvent(e),addAmtScanToMeshButton())}function addAmtScanToMeshEx(e){for(var t,i,o=document.getElementsByClassName("DevScanCheckbox"),n=0;n<o.length;n++)o[n].checked&&(t=o[n].getAttribute("tag"),i=(t=amtScanResults[t]).hostname,"host"==t.hosttype&&(i=capitalizeFirstLetter(i.split(".")[0])),meshserver.send({action:"addamtdevice",meshid:Q("amtScanMeshId").value,devicename:i,hostname:t.hostname,amtusername:"",amtpassword:"",amttls:t.tls}))}function addAmtScanToMeshButton(){var e=Q("dp1range").value.trim(),t=e.split(" ");""!=(e=(e=1<t.length?t[t.length-1]:e).trim())&&(QE("dp1range",!1),QE("dp1rangebutton",!1),QH("dp1results","<div style=width:100%;text-align:center;margin-top:20px>Scansione in corso...</div><div style=width:100%;text-align:center;margin-top:6px;color:#666>"+e+"</div>"),xxdialogTag="AMTSCAN:"+e,meshserver.send({action:"scanamtdevice",range:e}))}function addAmtScanToMeshCheckbox(){for(var e=document.getElementsByClassName("DevScanCheckbox"),t=0,i=0;i<e.length;i++)e[i].checked&&t++;QE("idx_dlgOkButton2",0<t)}function checkEmail(e){var e=e.split("@"),t=2==e.length&&0<e[0].length&&1<e[1].split(".").length&&2<e[1].length;if(1==t){var i,o=e[1].split(".");for(i in o)0==o[i].length&&(t=!1)}return t}function inviteAgentToMesh(e){var t,i;return xxdialogMode||(t="",i=meshes[e],64&features&&(t=(t=(t=(t=(t=(t=(t=(t+=addHtmlFormFloating("Tipo di invito","<select id=d2InviteType onchange=d2ChangedInviteType() class=form-select><option value=0>Invito al collegamento</option><option value=1>Invito via e-mail</option></select>")+"<hr />")+"<div id=emailInviteDiv style=display:none>"+format("nvita qualcuno a installare l'agente mesh. Verrà inviata un'email con il collegamento all'installazione dell'agente mesh per il gruppo di dispositivi \"{0}\".",EscapeHtml(i.name))+"<br /><br />")+addHtmlFormFloating("Nome (facoltativo) ",'<input id=agentInviteName value="" placeholder="Name (optional)" class="form-control" maxlength=64 />'))+addHtmlFormFloating("E-mail",'<input id=agentInviteEmail placeholder="example@email.com" class="form-control" onkeyup=validateAgentInvite() />'))+addHtmlFormFloating("Sistema operativo","<select id=agentInviteNameOs onchange=d2ChangedInviteType() class=form-select><option value=4>Invia link di installazione</option><option value=0 selected>Qualsiasi supportato</option><option value=1>Solo Windows </option><option value=3>Solo Apple macOS</option><option value=2>Solo Linux</option><option value=5>Assistente MeshCentral</option></select>")+"<div id=d2agentexpirediv>")+addHtmlFormFloating("Scadenza collegamento","<select id=agentInviteExpire class=form-select><option value=1>1 ora</option><option value=8>8 ore</option><option value=24>1 giorno</option><option value=168>1 settimana</option><option value=5040>1 mese</option><option value=0>Illimitato</option></select>")+"</div><div id=d2agentInstallTypeDiv2>")+addHtmlFormFloating("Tipo di installazione","<select id=agentInviteType class=form-select><option value=0>Servizio e interattivo</option><option value=2>Solo Servizio</option><option value=1>Solo interattivo</option></select>")+"</div>")+addHtmlFormFloating("Messaggio (opzionale)",'<textarea id="agentInviteMessage" class="form-control" style="height:100px;resize:none;" maxlength="1024"></textarea>')+"</div>"),t=(t=(t=(t+="<div id=urlInviteDiv>"+format("Invita qualcuno a installare l'agente mesh condividendo un link di invito. Questo collegamento indirizza l'utente alle istruzioni di installazione per il gruppo di dispositivi \"{0}\". Il collegamento è pubblico e non è necessario alcun account per questo server.",EscapeHtml(i.name))+"<br /><br />")+addHtmlFormFloating("Scadenza collegamento","<select id=d2inviteExpire class=form-select onchange=d2RequestInvitationLink()><option value=1>1 ora</option><option value=8>8 ore</option><option value=24>1 giorno</option><option value=168>1 settimana</option><option value=5040>1 mese</option><option value=0>Illimitato</option></select>"))+addHtmlFormFloating("Agenti","<select id=d2agentType class=form-select onchange=d2ChangedInviteType()><option value=0>Tutti gli agenti disponibili</option><option value=1>Windows Mesh Agent</option><option value=2>Linux Mesh Agent</option><option value=4>Agente Mesh MacOS</option><option value=8>Assistente MeshCentral</option><option value=16>Android MeshAgent</option></select>")+"<div id=d2agentInstallTypeDiv>")+addHtmlFormFloating("Tipo di installazione","<select id=d2agentInviteType class=form-select onchange=d2RequestInvitationLink()><option value=0>Servizio e interattivo</option><option value=2>Solo Servizio</option><option value=1>Solo interattivo</option></select>"),xxdialogTag=e,setModalContent("xxAddAgent","Invitare",t=t+"</div>"+'<div id=agentInvitationLinkDiv style="text-align:center;font-size:large;margin:16px;display:none"><a href=# id=agentInvitationLink rel="noreferrer noopener" target="_blank" style=cursor:pointer></a> <img src=images/link4.png height=10 width=10 title="Copia il link negli appunti" style=cursor:pointer onclick=d2CopyInviteToClip()></div></div>'),showModal("xxAddAgentModal","idx_dlgOkButton",function(){performAgentInvite(3,e)}),(64&features?(Q("d2InviteType").focus(),d2ChangedInviteType):(Q("d2inviteExpire").focus(),validateAgentInvite))(),d2RequestInvitationLink()),!1}function d2RequestInvitationLink(){meshserver.send({action:"createInviteLink",meshid:xxdialogTag,expire:parseInt(Q("d2inviteExpire").value),flags:parseInt(Q("d2agentInviteType").value),agents:parseInt(Q("d2agentType").value)})}function d2ChangedInviteType(){64&features&&(QV("urlInviteDiv",0==Q("d2InviteType").value),QV("d2agentexpirediv",4==Q("agentInviteNameOs").value),QV("d2agentInstallTypeDiv2",Q("agentInviteNameOs").value<2),QV("emailInviteDiv",1==Q("d2InviteType").value)),QV("d2agentInstallTypeDiv",parseInt(Q("d2agentType").value)<2),validateAgentInvite(),d2RequestInvitationLink()}function d2CopyInviteToClip(){copyTextToClip(Q("agentInvitationLink").href)}function d2CopySecretToClip(){copyTextToClip(Q("d2optsecret").getAttribute("secret"))}function validateAgentInvite(){64&features&&1==Q("d2InviteType").value?(QE("idx_dlgOkButton",checkEmail(Q("agentInviteEmail").value)),QV("idx_dlgCancelButton",!0)):(QE("idx_dlgOkButton",!0),QV("idx_dlgCancelButton",!1))}function performAgentInvite(e,t){64&features&&1==Q("d2InviteType").value&&meshserver.send({action:"inviteAgent",meshid:t,email:Q("agentInviteEmail").value,name:Q("agentInviteName").value,os:Q("agentInviteNameOs").value,flags:Q("agentInviteType").value,msg:Q("agentInviteMessage").value,expire:parseInt(Q("agentInviteExpire").value)})}function addAgentToMesh(e){if(!xxdialogMode){var t,i=meshes[e],o="",n="",a="<select id=aginsSelect onchange=addAgentToMeshClick() class=form-select><option value=0>Windows</option><option value=1>Linux / BSD</option><option value=5>Linux / BSD / macOS Binary Installer</option><option value=2>Apple macOS</option>",a=(0==(2&features)&&(a+="<option value=6>Dispositivo mobile</option>"),o+=addHtmlFormFloating("Sistema operativo",a=a+"<option value=7>Assistente MeshCentral</option>"+"<option value=3>Windows (Disinstallazione) </option><option value=4>Linux / BSD (UnInstall)</option><option value=8>Apple macOS (UnInstall)</option></select>"),serverinfo.name),s=(-1!=a.indexOf(".")&&0==(2&features)||(a=window.location.hostname),domainUrl.substring(0,domainUrl.length-1)),r="",r=1==serverinfo.https?443==serverinfo.port?"":":"+serverinfo.port:80==serverinfo.port?"":":"+serverinfo.port,l=[6,5,10005,25,26,28,30,32,36,37,40,41,16,29],d={6:"Linux x86-64",5:"Linux x86-32",10005:"Apple OSX Universal",25:"Linux ARM-HF, Rasberry Pi",26:"Linux ARM64-HF",28:"Linux MIPS24KC (OpenWRT)",30:"FreeBSD x86-64",32:"Linux ARM 64 bit (glibc/2.24 NOKVM)",36:"OpenWRT x86-64",37:"OpenBSD x86-64",40:"Linux MIPSEL24KC (OpenWRT)",41:"ARMADA/CORTEX-A53/MUSL (OpenWRT)",16:"Apple macOS x86-64",29:"Apple macOS ARM-64"};for(t in l)n+='<option value="'+l[t]+'">'+d[l[t]]+"</option>";o=(o=(o=(o=(o+='<div id="aginsSysTypeDiv">')+addHtmlFormFloating("Tipo di sistema",'<select id="aginsSysType" onchange="addAgentToMeshClick()"  class="form-select">'+n+"</select>"))+"</div>"+'<div id="aginsTypeDiv">')+addHtmlFormFloating("Tipo di installazione",'<select id="aginsType" onchange="addAgentToMeshClick()" class="form-select"><option value="0">Servizio  & interattivo</option><option value="2">Solo Servizio</option><option value="1">Solo interattivo</option></select>')+'</div><div id="asinsTypeDiv">')+addHtmlFormFloating("Tipo di installazione",'<select id="asinsType" onchange="addAgentToMeshClick()" class="form-select"><option value="2">Applicazione, connessione su richiesta dell\'utente</option><option value="3">Applicazione, sempre connesso</option><option value="0">System Tray, Connetti su richiesta dell\'utente</option><option value="1">Vassoio di sistema, sempre connesso</option><option value="4">Barra delle applicazioni, solo monitor</option></select>')+"</div><hr>",i.name.split("\\").join("").split("/").join("").split(":").join("").split("*").join("").split("?").join("").split('"').join("").split("<").join("").split(">").join("").split("|").join("").split(" ").join("").split("'").join("");o=(o=(o=(o+="<div id=agins_windows>"+format('Per aggiungere un nuovo computer al gruppo di dispositivi "{0}", scarica l\'agente mesh e installalo sul computer da gestire. Questo agente contiene informazioni sul server e sul gruppo di dispositivi incorporate.',EscapeHtml(i.name))+"<br /><br />")+addHtmlValue("Agente Mesh",'<a class=text-decoration-underline id=aginsw32lnk name="meshagents?id=3&meshid='+e.split("/")[2]+"&installflags=0"+(urlargs.key?"&key="+urlargs.key:"")+'" title="x86 32bit version of the MeshAgent">Windows x86-32 (.exe)</a> <i class="fa-regular fa-clipboard" title="Copy Windows x86 32bit agent URL to clipboard" style=cursor:pointer onclick=copyAgentUrl("meshagents?id=3&meshid='+e.split("/")[2]+'&installflags=",1)></i>',["col-md-4","col-md-8"]))+addHtmlValue("Agente Mesh",'<a class=text-decoration-underline id=aginsw64lnk name="meshagents?id=4&meshid='+e.split("/")[2]+"&installflags=0"+(urlargs.key?"&key="+urlargs.key:"")+'" title="x86 64bit version of the MeshAgent">Windows x86-64 (.exe)</a> <i class="fa-regular fa-clipboard" title="Copy Windows x86 64bit agent URL to clipboard" style=cursor:pointer onclick=copyAgentUrl("meshagents?id=4&meshid='+e.split("/")[2]+'&installflags=",1)></i>',["col-md-4","col-md-8"]))+addHtmlValue("Agente Mesh",'<a class=text-decoration-underline id=aginswa64lnk name="meshagents?id=43&meshid='+e.split("/")[2]+"&installflags=0"+(urlargs.key?"&key="+urlargs.key:"")+'" title="ARM 64bit version of the MeshAgent">Windows ARM-64 (.exe)</a> <i class="fa-regular fa-clipboard" title="Copy Windows ARM 64bit agent URL to clipboard" style=cursor:pointer onclick=copyAgentUrl("meshagents?id=43&meshid='+e.split("/")[2]+'&installflags=",1)></i>',["col-md-4","col-md-8"]),0<debugmode&&(o+=addHtmlValue("File delle impostazioni",'<a id=aginswmshlnk name="meshsettings?id='+e.split("/")[2]+"&installflags=0"+(urlargs.key?"&key="+urlargs.key:"")+'">'+format("{0} impostazioni (.msh)",EscapeHtml(i.name))+"</a>")),setModalContent("xxAddAgent","Aggiungi agente mesh",o=(o=(o=(o=(o=(o=(o=(o=(o=(o=(o=(o=(o=(o=(o=(o=(o=(o=(o=(o=(o=(o=(o=(o=(o+="</div>")+("<div id=agins_linux style=display:none>"+format('Per aggiungere un computer a "{0}" esegui il comando seguente. Saranno necessarie le credenziali di root.',EscapeHtml(i.name))+"<br />"))+"<textarea id=agins_linux_area rows=2 cols=20 readonly=readonly style=border-radius:4px;padding:6px;margin-top:4px;margin-bottom:4px;border:0;width:100%;resize:none;height:160px;overflow:auto;font-size:12px class=form-control></textarea>"+'<div style=font-size:x-small;float:right>* Per BSD, esegui "pkg install wget sudo bash" prima.</div><a style=text-decoration:none title="Copia negli appunti" onclick=copyAgentIdValue("agins_linux_area")>Copia <i class="fa-regular fa-clipboard" style=cursor:pointer></i></a></div>')+("<div id=agins_osx style=display:none>"+format("Per aggiungere un nuovo computer al gruppo di dispositivi \"{0}\", scarica l'agente mesh e installalo sul computer da gestire. Questo programma di installazione dell'agente contiene informazioni sul server e sul gruppo di dispositivi incorporate. ",EscapeHtml(i.name))+"<br /><br />"))+addHtmlValue("Agente Mesh",'<a class=text-decoration-underline onclick=downloadFile("meshosxagent?id=16&meshid='+e.split("/")[2]+(urlargs.key?"&key="+urlargs.key:"")+'") title="x86-64bit version of macOS Mesh Agent">macOS x86-64bit</a> <i class="fa-regular fa-clipboard" title="Copia l\'URL dell\'agente macOS negli appunti" style=cursor:pointer onclick=copyAgentUrl("meshosxagent?id=16&meshid='+e.split("/")[2]+'",0)></i>',["col-md-4","col-md-8"]))+addHtmlValue("Agente Mesh",'<a class=text-decoration-underline onclick=downloadFile("meshosxagent?id=29&meshid='+e.split("/")[2]+(urlargs.key?"&key="+urlargs.key:"")+'") title="ARM 64bit version of macOS Mesh Agent">macOS ARM (64bit)</a> <i class="fa-regular fa-clipboard" title="Copia l\'URL dell\'agente macOS negli appunti" style=cursor:pointer onclick=copyAgentUrl("meshosxagent?id=29&meshid='+e.split("/")[2]+'",0)></i>',["col-md-4","col-md-8"]))+addHtmlValue("Agente Mesh",'<a class=text-decoration-underline onclick=downloadFile("meshosxagent?id=10005&meshid='+e.split("/")[2]+(urlargs.key?"&key="+urlargs.key:"")+'") title="Universal version of macOS Mesh Agent">macOS (Universal)</a> <i class="fa-regular fa-clipboard" title="Copia l\'URL dell\'agente macOS negli appunti" style=cursor:pointer onclick=copyAgentUrl("meshosxagent?id=10005&meshid='+e.split("/")[2]+'",0)></i>',["col-md-4","col-md-8"])+"</div>")+('<div id=agins_qrcode style=display:none;min-height:180px><a id=agins_qrimage_a rel="noreferrer noopener" target=_blank><div id=agins_qrimage style=float:right;margin-left:10px;width:180px;height:180px;cursor:pointer></div></a><div>'+format('Per aggiungere un dispositivo mobile al gruppo "{0}", scarica l\'applicazione MeshAgent e scansiona questo codice QR.',EscapeHtml(i.name))+"</div>"))+"<table style=width:180px>"+'<tr><td style=text-align:center><a title="Google Play Store"rel="noreferrer noopener" target=_blank href="https://play.google.com/store/apps/details?id=com.meshcentral.agent2"><img style=cursor:pointer src="images/google-play-140.png" width=140 srcset="images/google-play-280.png 2x" /></a></td></tr>')+'<tr><td style=text-align:center><a title="Amazon App Store" rel="noreferrer noopener" target=_blank href="https://www.amazon.co.uk/gp/product/B097Z4Q7SK/"><img style=cursor:pointer src="images/amazon-appstore-140.png"  width=140 srcset="images/amazon-appstore-280.png 2x" /></a></td></tr>'+"</table>")+addHtmlValue("Android APK",'<a class=text-decoration-underline onclick=downloadFile("meshagents?id=14'+(urlargs.key?"&key="+urlargs.key:"")+'",null,true) title="APK version of the MeshAgent">APK</a> <i class="fa-regular fa-clipboard" title="Copia l\'URL negli appunti" style=cursor:pointer onclick=copyAgentUrl("meshagents?id=14&meshid='+e.split("/")[2]+(urlargs.key?"&key="+urlargs.key:"")+'")></i>')+"</div>")+("<div id=agins_assistant style=display:none><table><tr><td style=vertical-align:top><div>"+format('MeshCentral Assistant è uno strumento Windows che gli utenti possono utilizzare per chiedere aiuto. Utilizzare il collegamento sottostante per scaricare una versione che si connetterà al gruppo di dispositivi "{0}".',EscapeHtml(i.name))+"</div><div></div><br />"))+('<a class=text-decoration-underline id=asinslnk name="meshagents?id=10006&meshid='+e.split("/")[2]+(urlargs.key?"&key="+urlargs.key:"")+'" title="Assistente MeshCentral per Windows">Assistente per Windows (.exe)</a> <i class="fa-regular fa-clipboard" title="Copia l\'URL negli appunti" style=cursor:pointer onclick=copyAgentUrl("meshagents?id=10006&meshid='+e.split("/")[2]+(urlargs.key?"&key="+urlargs.key:"")+'")></i>'))+'</td><td><img id=agass_img1 src=images/assistant-100.png width=74 height=100 srcset="images/assistant-200.png 2x"><img id=agass_img2 src=images/assistant2-100.png width=74 height=100 srcset="images/assistant2-200.png 2x"></td></tr></table></div>'+"<div id=agins_assistant2 style=display:none><table><tr><td style=vertical-align:top><div>MeshCentral Assistant è uno strumento Windows che gli utenti possono utilizzare per chiedere aiuto. Utilizzare il collegamento sottostante per scaricare una versione che monitorerà l'agente in background.</div><div></div><br />")+('<a class=text-decoration-underline id=asinslnk2 name="meshagents?id=10006&meshid='+e.split("/")[2]+(urlargs.key?"&key="+urlargs.key:"")+'" title="Assistente MeshCentral per Windows">Assistente per Windows (.exe)</a> <i class="fa-regular fa-clipboard" title="Copia l\'URL negli appunti" style=cursor:pointer onclick=copyAgentUrl("meshagents?id=10006&meshid='+e.split("/")[2]+(urlargs.key?"&key="+urlargs.key:"")+'")></i>'))+'</td><td><img src=images/assistant-100.png width=74 height=100 srcset="images/assistant-200.png 2x"></td></tr></table></div>'+'<div id=agins_windows_un style=display:none>Per rimuovere un agente mesh, scarica il file sottostante, eseguilo e fai clic su "disinstalla". <br /><br />')+addHtmlValue("Agente Mesh",'<a class=text-decoration-underline id=aginsw32unlnk name="meshagents?id=3&meshid='+e.split("/")[2]+"&installflags=0"+(urlargs.key?"&key="+urlargs.key:"")+'" title="x86 32bit version of the MeshAgent">Windows x86-32 (.exe)</a> <i class="fa-regular fa-clipboard" title="Copy Windows x86 32bit agent URL to clipboard" style=cursor:pointer onclick=copyAgentUrl("meshagents?id=3&meshid='+e.split("/")[2]+'&installflags=",1)></i>',["col-md-4","col-md-8"]))+addHtmlValue("Agente Mesh",'<a class=text-decoration-underline id=aginsw64unlnk name="meshagents?id=4&meshid='+e.split("/")[2]+"&installflags=0"+(urlargs.key?"&key="+urlargs.key:"")+'" title="x86 64bit version of the MeshAgent">Windows x86-64 (.exe)</a> <i class="fa-regular fa-clipboard" title="Copy Windows x86 64bit agent URL to clipboard" style=cursor:pointer onclick=copyAgentUrl("meshagents?id=4&meshid='+e.split("/")[2]+'&installflags=",1)></i>',["col-md-4","col-md-8"]))+addHtmlValue("Agente Mesh",'<a class=text-decoration-underline id=aginswa64unlnk name="meshagents?id=43&meshid='+e.split("/")[2]+"&installflags=0"+(urlargs.key?"&key="+urlargs.key:"")+'" title="ARM 64bit version of the MeshAgent">Windows ARM-64 (.exe)</a> <i class="fa-regular fa-clipboard" title="Copy Windows ARM 64bit agent URL to clipboard" style=cursor:pointer onclick=copyAgentUrl("meshagents?id=43&meshid='+e.split("/")[2]+'&installflags=",1)></i>',["col-md-4","col-md-8"])+"</div>")+"<div id=agins_linux_un style=display:none>Per rimuovere un agente mesh, esegui il seguente comando.Saranno necessarie le credenziali di root.<br />"+"<textarea id=agins_linux_area_un rows=2 cols=20 readonly=readonly style=border-radius:4px;padding:6px;margin-top:4px;margin-bottom:4px;border:0;width:100%;resize:none;height:160px;overflow:auto;font-size:12px  class=form-control></textarea>")+'<a style=text-decoration:none title="Copia negli appunti" onclick=copyAgentIdValue("agins_linux_area_un")>Copy <i class="fa-regular fa-clipboard" style=cursor:pointer></i></a></div>'+'<div id=agins_osx_un style=display:none>To remove a mesh agent, download the file below, right click on the ".mpkg" file and click "Show Package Contents", then right click on "Uninstall.command" and click "Open"<br /><br />')+addHtmlValue("Agente Mesh",'<a class=text-decoration-underline onclick=downloadFile("meshosxagent?id=10005&meshid='+e.split("/")[2]+(urlargs.key?"&key="+urlargs.key:"")+'") title="Universal version of macOS Mesh Agent">macOS Agent (Universal)</a> <i class="fa-regular fa-clipboard" title="Copia l\'URL dell\'agente macOS negli appunti" style=cursor:pointer onclick=copyAgentUrl("meshosxagent?id=10005&meshid='+e.split("/")[2]+'",0)></i>',["col-md-4","col-md-8"]))+"</div>"+"<div id=agins_linux_inst style=display:none>This is a executable on OS's with graphical user interfaces<br /><br />Apple macOS executables will need to be removed from quarantine to run 'xattr -r -d com.apple.quarantine meshagent'<br /><br />You need to 'chmod +x meshagent' and run this file<br /><br />")+addHtmlValue("Agente Mesh",'<a class=text-decoration-underline id=aginsbinlnk name="meshagents?id='+e.split("/")[2]+"&installflags=0"+(urlargs.key?"&key="+urlargs.key:"")+'">meshagent</a> <i class="fa-regular fa-clipboard" title="Copia l\'URL dell\'agente negli appunti" style=cursor:pointer onclick=copyAgentUrl("meshagents?id='+e.split("/")[2]+'&installflags=",1)></i>',["col-md-4","col-md-8"]))+addHtmlValue('Comando&nbsp;<i class="fa-regular fa-clipboard" title="Copia l\'URL dell\'agente negli appunti" style=cursor:pointer onclick=copyAgentIdValue("aginsbincmd")></i>','<input id=aginsbincmd type=text class="form-control" readonly value=\'wget -O meshagent'+(0!=(2147483648&features)?" --no-check-certificate":"")+' "https://'+a+r+domainUrl+"meshagents?id="+e.split("/")[2].split("$").join("%24").split("@").join("%40")+"' />",["col-md-4 d-flex align-items-center","col-md-8"])+"</div>"),showModal("xxAddAgentModal","idx_dlgOkButton"),new QRCode(Q("agins_qrimage"),{text:serverinfo.magenturl+","+serverinfo.agentCertHash+","+e.split("/")[2],width:180,height:180,colorDark:"#000000",colorLight:"#EEE",correctLevel:QRCode.CorrectLevel.M}),Q("agins_qrimage_a").setAttribute("href",serverinfo.magenturl+","+serverinfo.agentCertHash+","+e.split("/")[2]),0==(8192&features)?(Q("agins_linux_area").value='(wget "https://'+a+r+domainUrl+"meshagents?script=1"+(urlargs.key?"&key="+urlargs.key:"")+'"'+(0!=(2147483648&features)?" --no-check-certificate":"")+' -O ./meshinstall.sh || wget "https://'+a+r+domainUrl+'meshagents?script=1" --no-proxy'+(0!=(2147483648&features)?" --no-check-certificate":"")+" -O ./meshinstall.sh) && chmod 755 ./meshinstall.sh && sudo -E ./meshinstall.sh https://"+a+r+s+" '"+e.split("/")[2]+"' || ./meshinstall.sh https://"+a+r+s+" '"+e.split("/")[2]+"'\r\n",Q("agins_linux_area_un").value='(wget "https://'+a+r+domainUrl+"meshagents?script=1"+(urlargs.key?"&key="+urlargs.key:"")+'"'+(0!=(2147483648&features)?" --no-check-certificate":"")+' -O ./meshinstall.sh || wget "https://'+a+r+domainUrl+'meshagents?script=1" --no-proxy'+(0!=(2147483648&features)?" --no-check-certificate":"")+" -O ./meshinstall.sh) && chmod 755 ./meshinstall.sh && sudo -E ./meshinstall.sh uninstall https://"+a+r+s+" '"+e.split("/")[2]+"' || ./meshinstall.sh uninstall https://"+a+r+s+" '"+e.split("/")[2]+"'\r\n"):(Q("agins_linux_area").value='wget "https://'+a+r+domainUrl+"meshagents?script=1"+(urlargs.key?"&key="+urlargs.key:"")+'" --no-proxy'+(0!=(2147483648&features)?" --no-check-certificate":"")+" -O ./meshinstall.sh && chmod 755 ./meshinstall.sh && sudo -E ./meshinstall.sh https://"+a+r+s+" '"+e.split("/")[2]+"' || ./meshinstall.sh https://"+a+r+s+" '"+e.split("/")[2]+"'\r\n",Q("agins_linux_area_un").value='wget "https://'+a+r+domainUrl+"meshagents?script=1"+(urlargs.key?"&key="+urlargs.key:"")+'" --no-proxy'+(0!=(2147483648&features)?" --no-check-certificate":"")+" -O ./meshinstall.sh && chmod 755 ./meshinstall.sh && sudo -E ./meshinstall.sh uninstall https://"+a+r+s+" '"+e.split("/")[2]+"' || ./meshinstall.sh uninstall https://"+a+r+s+" '"+e.split("/")[2]+"'\r\n"),Q("aginsSelect").focus(),addAgentToMeshClick()}return!1}function setModalContent(e,t,i,o=null){var n=document.getElementById("xxAddAgentModalConf"),a=document.getElementById(e+"Title");if(n&&a){if(a.innerHTML=t,"number"==typeof i){for(var s=1;s<24;s++)QV("dialog"+s,s==i);xxdialogMode=s}else if("string"==typeof i){Q("dialog2").innerHTML=i;for(s=1;s<24;s++)QV("dialog"+s,2==s);xxdialogMode=2}if(o)switch(n.classList.remove("modal-sm","modal-lg","modal-xl"),o){case"small":n.classList.add("modal-sm");break;case"large":n.classList.add("modal-lg");break;case"extra-large":n.classList.add("modal-xl")}else n.classList.remove("modal-sm","modal-lg","modal-xl")}else console.error("Modal elements not found:",e+"Title",e+"Body")}function showModal(t,e,i,o=null,n=null){var a;null==xxModal&&(["idx_dlgOkButton","idx_dlgCancelButton"].forEach(function(e){Q(e).onclick=null,QE(e,!0),QV(e,!0)}),xxModal=new bootstrap.Modal(document.getElementById(t)),a=function(e){xxModal&&(xxModal.dispose(),xxModal=null),0!=xxdialogMode&&(xxdialogMode=0),document.getElementById(t).removeEventListener("hidden.bs.modal",a)},document.getElementById(t).addEventListener("hidden.bs.modal",a)),xxModal.show(),document.getElementById(e).onclick=function(){"function"==typeof i&&i?(xxdialogMode=0,!1!==i(o,n)&&xxModal.hide()):xxModal&&xxModal.hide()}}function copyAgentIdValue(e){copyTextToClip(Q(e).value)}function showNotification(e,t,i,o,n,a,s,r){Swal.fire({position:e,title:t,text:i,icon:o,confirmButtonText:n,timer:a,width:s,showConfirmButton:null!==n})}function copyAgentUrl(e,t){var i=serverinfo.name,i=(-1!=i.indexOf(".")&&0==(2&features)||(i=window.location.hostname),domainUrl.substring(0,domainUrl.length-1),"https://"+i+(443==serverinfo.port?"":":"+serverinfo.port)+domainUrl+e);1==t&&(i+=Q("aginsType").value),i+=urlargs.key?"&key="+urlargs.key:"",5==Q("aginsSelect").value&&(i+="&meshinstall="+Q("aginsSysType").value),7==Q("aginsSelect").value&&(i+="&ac="+Q("asinsType").value),copyTextToClip(i)}function addAgentToMeshClick(){var e=Q("aginsSelect").value;QV("agins_windows",0==e),QV("agins_linux",1==e),QV("agins_osx",2==e),QV("agins_windows_un",3==e),QV("agins_linux_un",4==e),QV("agins_linux_inst",5==e),QV("aginsSysTypeDiv",5==e),QV("agins_qrcode",6==e),QV("agins_assistant",7==e&&4!=Q("asinsType").value),QV("agins_assistant2",7==e&&4==Q("asinsType").value),QV("agins_osx_un",8==e),Q("aginsbinlnk").onclick=function(){downloadFile(Q("aginsbinlnk").name.split("installflags=")[0]+"installflags="+Q("aginsType").value+(urlargs.key?"&key="+urlargs.key:"")+"&meshinstall="+Q("aginsSysType").value)},Q("aginsbincmd").value=Q("aginsbincmd").value.split("&installflags=")[0]+"&installflags="+Q("aginsType").value+(urlargs.key?"&key="+urlargs.key:"")+"&meshinstall="+Q("aginsSysType").value+'"',QV("aginsTypeDiv",0==e||5==e),QV("asinsTypeDiv",7==e),Q("aginsw32lnk").onclick=function(){downloadFile(Q("aginsw32lnk").name.split("installflags=")[0]+"installflags="+Q("aginsType").value+(urlargs.key?"&key="+urlargs.key:""),null,!0)},Q("aginsw64lnk").onclick=function(){downloadFile(Q("aginsw64lnk").name.split("installflags=")[0]+"installflags="+Q("aginsType").value+(urlargs.key?"&key="+urlargs.key:""),null,!0)},Q("aginswa64lnk").onclick=function(){downloadFile(Q("aginswa64lnk").name.split("installflags=")[0]+"installflags="+Q("aginsType").value+(urlargs.key?"&key="+urlargs.key:""),null,!0)},Q("aginsw32unlnk").onclick=function(){downloadFile(Q("aginsw32lnk").name.split("installflags=")[0]+"installflags="+Q("aginsType").value+(urlargs.key?"&key="+urlargs.key:""),null,!0)},Q("aginsw64unlnk").onclick=function(){downloadFile(Q("aginsw64lnk").name.split("installflags=")[0]+"installflags="+Q("aginsType").value+(urlargs.key?"&key="+urlargs.key:""),null,!0)},Q("aginswa64unlnk").onclick=function(){downloadFile(Q("aginswa64lnk").name.split("installflags=")[0]+"installflags="+Q("aginsType").value+(urlargs.key?"&key="+urlargs.key:""),null,!0)},0<debugmode&&(Q("aginswmshlnk").onclick=function(){downloadFile(Q("aginswmshlnk").name.split("installflags=")[0]+"installflags="+Q("aginsType").value+(urlargs.key?"&key="+urlargs.key:""),null,!0)}),Q("asinslnk").onclick=function(){downloadFile(Q("asinslnk").name+"&ac="+Q("asinsType").value,null,!0)},Q("asinslnk2").onclick=function(){downloadFile(Q("asinslnk").name+"&ac="+Q("asinsType").value,null,!0)},7==e&&(QV("agass_img1",Q("asinsType").value<2),QV("agass_img2",2<=Q("asinsType").value))}function validateDeviceToMesh(){QE("idx_dlgOkButton",0<Q("dp1devicename").value.length&&passwordcheck(Q("dp1password").value))}function addDeviceToMeshEx(e,t){var i=Q("dp1username").value,o=(""==i&&(i="admin"),Q("dp1hostname").value);""==o&&(o=Q("dp1devicename").value),meshserver.send({action:"addamtdevice",meshid:t,devicename:Q("dp1devicename").value,hostname:o,amtusername:i,amtpassword:Q("dp1password").value,amttls:Q("dp1tls").value})}function deviceHeaderSet(){0==deviceHeaderId?deviceHeaderId=1:(deviceHeaders["DevxHeader"+deviceHeaderId]=1==deviceHeaderTotal?"1 nodo":format("{0} nodi",deviceHeaderTotal),deviceHeaderId++,deviceHeaderCount={},deviceHeaderTotal=0)}var powerStateStrings=["",'<span title="Il dispositivo è acceso.">Acceso</span>','<span title="Il dispositivo è in stato di sospensione (S1).">Standby</span>','<span title="Il dispositivo è in stato di sospensione (S2).">Standby</span>','<span title="Il dispositivo è in stato di sospensione profonda (S3).">Deep Sleep</span>','<span title="Il dispositivo è in stato di ibernazione (S4).">In ibernaziome</span>','<span title="Il dispositivo è spento (S5).">Soft-Off</span>','<span title="Il dispositivo è stato rilevato ma non è stato possibile ottenere lo stato di alimentazione.">Presente</span>','<span title="Il dispositivo è spento.">Spento</span>'],powerStateStrings2=["","Il dispositivo è alimentato","Il dispositivo è in stato di sospensione (S1)","Il dispositivo è in stato di sospensione (S2)","Il dispositivo è in stato di sospensione profonda (S3)","Il dispositivo è in ibernazione (S4)","Il dispositivo è in stato di spegnimento graduale (S5)","Il dispositivo è presente, ma non è possibile determinare lo stato di alimentazione","Il dispositivo è spento"],powerColorTable=["pwsTransparent","pwsBlack","pwsBlue","pwsBlue2","pwsLightblue","pwsBlueviolet","pwsDarkgreen","pwsLightseagreen","pwsLightseagreen2"];function NodeStateStr(e){var t=[];return 0<e.state&&e.state<powerStatetable.length&&state.push(powerStatetable[e.state]),e.conn&&(0!=(1&e.conn)&&(4==e.mtype?"PDU"==e.porttype?t.push("<span title=\"L'interruttore di alimentazione è pronto per l'uso.\">Interruttore</span>"):t.push('<span title="La porta IP-KVM è attiva e pronta per l\'uso.">IP-KVM</span>'):t.push("<span title=\"L'agente mesh è connesso e pronto per l'uso.\">Agente</span>")),0!=(2&e.conn)?t.push('<span title="Intel&reg; AMT CIRA è connesso e pronto per l\'uso.">CIRA</span>'):0!=(4&e.conn)&&t.push('<span title="Intel&reg; AMT è instradabile.">AMT</span>'),0!=(8&e.conn)&&t.push('<span title="L\'agente mesh è raggiungibile utilizzando un altro agente come inoltro.">Ritrasmissioni</span>'),0!=(16&e.conn))&&t.push('<span title="La connessione MQTT al dispositivo è attiva.">MQTT </span>'),null!=e.pwr&&0!=e.pwr&&t.push(powerStateStrings[e.pwr]),0==t.length?"&nbsp;":t.join(", ")}function PowerStateStr(e){return e<powerStatetable.length?powerStatetable[e]:""}function PowerStateStr2(e){return 0!=e&&e<powerStatetable.length?powerStatetable[e]:"Sconosciuto"}function updateCollapseAllButton(){var e=0<Object.keys(CollapsedGroups).length;QV("CollapseAllButton",!e),QV("ExpandAllButton",e),QV("CollapseAllButton2",!e),QV("ExpandAllButton2",e)}function selectallButtonFunction(){for(var e=document.getElementsByClassName("DeviceCheckbox"),t=Object.keys(checkedNodeids).length,i=0;i<e.length;i++)e[i].checked=0==t;if(checkedNodeids={},0==t){checkedNodeids={};for(var o=document.getElementsByName("xxdevice"+Q("viewselect").value),i=0;i<o.length;i++)(null==o[i].parentElement.attributes.style||o[i].parentElement.attributes.style.value.indexOf("display")<0)&&(checkedNodeids[o[i].id.substring(3)]=1)}p1updateInfo()}function p1devcheck(e){e.srcElement.checked?checkedNodeids[e.srcElement.value.substring(6)]=1:delete checkedNodeids[e.srcElement.value.substring(6)],p1updateInfo()}function p1updateInfo(){var e=Object.keys(checkedNodeids).length;if(0<e?(QE("GroupActionButton",!0),Q("SelectAllButton").value="Non selezionare niente",QV("cxmdesktop",!0)):(QE("GroupActionButton",!1),Q("SelectAllButton").value="Seleziona tutto",QV("cxmdesktop",!1)),null!=customui&&customui.devicesbarbuttons)for(var t in customui.devicesbarbuttons)"one"==customui.devicesbarbuttons[t].selection&&QE("cui:"+t,1==e),"many"==customui.devicesbarbuttons[t].selection&&QE("cui:"+t,1<=e)}function groupActionFunction(){var e=[],t=getCheckedDevices(),i=0;if(262144&features&&0==count2factoraAuths())setModalContent("xxAddAgent","Sicurezza dell 'Account",'Impossibile accedere a questa funzione finché non viene abilitata l\'autenticazione a due fattori. Questo è necessario per una maggiore sicurezza. Vai alla scheda "Il mio account" e guarda la sezione "Sicurezza dell\'account". '),showModal("xxAddAgentModal","idx_dlgOkButton");else{if(4194304&features)for(var o in t)if(0!=(16&getNodeFromId(t[o]).conn)){e.push({v:103,name:"Invia messaggio MQTT"});break}for(var o in e.push({v:105,name:"Esporta le informazioni sul dispositivo",s:!0}),t){var n=getNodeFromId(t[o]),a=GetNodeRights(n);1&a&&0==(2&i)&&(i|=2,e.push({v:102,name:"Sposta nel gruppo di dispositivi "})),0!=(1&n.conn)&&0!=(32768&a)&&0==(1&i)&&(i|=1,e.push({v:104,name:"Disinstalla agente"})),64&a&&0==(8&i)&&(i|=8,e.push({v:100,name:"Sveglia dispositivi"})),262144&a&&0==(4&i)&&(i|=4,e.push({v:4,name:"Addormenta  Dispositivi"}),e.push({v:3,name:"Ripristina dispositivi"}),e.push({v:2,name:"Spegnere i dispositivi"})),131072&a&&0==(16&i)&&(i|=16,e.push({v:106,name:"Esegui comandi"})),16384&a&&0==(32&i)&&(i|=32,e.push({v:108,name:"Notifica del dispositivo"})),4&a&&0==(64&i)&&(i|=64,e.push({v:107,name:"Modificare i tag"})),8&a&&0==(256&i)&&(i|=256,e.push({v:109,name:"Caricare files"})),32768&a&&0==(128&i)&&(i|=128,e.push({v:101,name:"Elimina dispositivi"})),null!=n.agent&&16&features2&&4294967295==a&&0==(512&i)&&(i|=512,e.push({v:110,name:"Forza l'aggiornamento dell'agente"}),e.push({v:111,name:"Pulire il core dell'agente"}),e.push({v:112,name:"Carica il core del server predefinito"}))}var s="";for(o in e.sort(nameSort),e)s+="<option value="+e[o].v+(e[o].s?" selected":"")+">"+e[o].name+"</option>";var r="Selezionare un'operazione da eseguire su tutti i dispositivi selezionati. Le azioni verranno eseguite solo con i diritti appropriati.<br /><br />";setModalContent("xxAddAgent","Azione di gruppo",r+=addHtmlFormFloating("operazione",'<select id=d2groupop class="form-select">'+s+"</select>")),showModal("xxAddAgentModal","idx_dlgOkButton",groupActionFunctionEx)}}function getCheckedDevices(){return Object.keys(checkedNodeids)}function uncheckAllDevices(){for(var e=document.getElementsByClassName("DeviceCheckbox"),t=0;t<e.length;t++)e[t].checked=!1;checkedNodeids={}}function groupActionFunctionEx(){var e=Q("d2groupop").value;if(100==e)return meshserver.send({action:"wakedevices",nodeids:getCheckedDevices()}),uncheckAllDevices(),!0;if(101==e){var t="";if(0==(l=getCheckedDevices()).length)return;if(1==l.length)t+="Confermare la rimozione del dispositivo selezionato?<br /><br />";else{t+=format("Confermare la rimozione di {0} dispositivi selezionati?<br />",l.length);var i=0,o=0;for(r in l)null!=(d=getNodeFromId(l[r])).conn&&0<d.conn?i++:o++;var n="";1==i?n+=format("1 dispositivo selezionato è online.<br />",i):1<i&&(n+=format("{0} dispositivi selezionati sono online.<br />",i)),1==o?n+=format("1 dispositivo selezionato è offline.<br />",o):1<o&&(n+=format("{0} dispositivi selezionati sono offline.<br />",o)),t+=""!=n?"<div style=padding:8px>"+n+"</div>":"<br />"}setModalContent("xxAddAgent","Elimina dispositivi",t+='<label><input id=d2check type=checkbox class="form-check-input me-2" onchange=d2groupActionFunctionDelCheck() />Confermare</label>'),showModal("xxAddAgentModal","idx_dlgOkButton",()=>d2groupActionFunctionDelExec()),QE("idx_dlgOkButton",!1)}else if(102==e)p10showChangeGroupDialog(getCheckedDevices());else if(103==e)p10showSendMqttMsgDialog(getCheckedDevices());else if(104==e)p10showSendUninstallAgentDialog(getCheckedDevices());else if(105==e)p2downloadDeviceInfo();else if(106==e)d2runCommandDialog({nodeids:getCheckedDevices(),title:"Esegui comandi sui dispositivi selezionati.",func:uncheckAllDevices});else if(107==e){var t="Eseguire l'operazione di tag del dispositivo in modalità batch<br /><br />",a=(t=(t+=addHtmlFormFloating("operazione",'<select id=d2deviceop class="form-select-sm me-2"><option value=1>Aggiungi i tag</option><option value=2>Imposta tag</option><option value=3>Rimuovi tag</option></select>'))+addHtmlFormFloating("Tags",'<input id=dp10devicevalue class="form-control" maxlength=4096 placeholder="Tag1, Tag2, Tag3" />'),[]),n="";for(r in nodes)if(nodes[r].tags)for(var s in nodes[r].tags)-1==a.indexOf(nodes[r].tags[s])&&a.push(nodes[r].tags[s]);if(0<a.length){for(var r in a.sort(),a)n+='<span style=padding:4px;background-color:#BBB;border-radius:3px;cursor:pointer onclick=showEditNodeValueDialogAddTag("'+encodeURIComponentEx(a[r])+'")>'+EscapeHtml(a[r])+"</span> ";t+="<div style=margin-top:8px;width:370px;line-height:26px;max-height:160px;overflow-y:auto>"+n+"</div>"}setModalContent("xxAddAgent","Modifica i tag del dispositivo",t),showModal("xxAddAgentModal","idx_dlgOkButton",()=>d2groupActionFunctionTagsExec())}else if(108==e){var t="<div style=margin-bottom:4px>Esegui notifica dispositivo in modalità  batch </div>";setModalContent("xxAddAgent","Notifica del dispositivo",t=(t=(t=(t=(t=(t+='<select id=d2deviceop class="form-select-sm me-2" style=width:100%;margin-bottom:4px><option value=2>Notifica di tipo toast</option><option value=1>Casella dei messaggi</option><option value=3>Alert Box</option></select>')+'<input id=dp2notifyTitle maxlength=256 placeholder="Titolo" style=width:100%;box-sizing:border-box;margin-bottom:4px />'+"<textarea id=d2notifyMsg style=width:100%;height:140px;resize:none;overflow-y:scroll;box-sizing:border-box;margin-bottom:4px></textarea>")+"<select style=width:100% id=d2notifyTimeout>"+'<option disabled value="">Only Applicable to Message Box Notifications</option>')+"<option value=2 selected>Show for 2 Minutes (Default)</option>"+"<option value=10>Show for 10 minutes</option>")+"<option value=30>Show for 30 minutes</option>"+"<option value=60>Show for 60 minutes</option>")+"<option value=0>Mostra messaggio fino a quando non viene respinto dall'utente</option>"+"</select>"),showModal("xxAddAgentModal","idx_dlgOkButton",()=>d2groupActionFunctionNotifyExec()),Q("d2notifyMsg").focus()}else if(109==e){var l,d,c=!1,u=!1;for(r in l=getCheckedDevices())(d=getNodeFromId(l[r])).agent&&(0<d.agent.id&&d.agent.id<5||34==d.agent.id?c=!0:u=!0);var t="Carica i file selezionati su tutti i dispositivi selezionati <br /><br />";t=(t+="<form method=post enctype=multipart/form-data action=uploadfilebatch.ashx target=fileUploadFrame>")+("<input type=hidden name=authCookie value="+authCookie+" /><input type=hidden name=nodeIds value="+l.join(",")+" /><input type=submit id=d2batchUploadSubmit style=display:none />")+'<input type=file name=files id=d2uploadinput class="form-control" multiple=multiple onchange="d2batchUploadValidate()" /><br /><br />',c&&(t+=addHtmlFormFloating("Percorso Windows ",'<input type=text class="form-control" onchange="d2batchUploadValidate()" onkeyup="d2batchUploadValidate()" name=winpath id=d2winuploadpath placeholder="C:\\temp" value="" />')),u&&(t+=addHtmlFormFloating("Percorso Linux",'<input type=text class="form-control" onchange="d2batchUploadValidate()" onkeyup="d2batchUploadValidate()" name=linuxpath id=d2linuxuploadpath placeholder="/tmp" value="" />')),setModalContent("xxAddAgent","Caricamento file batch",t=t+'<br /><label><input type=checkbox class="form-check-input me-2" name=createFolder />Creare una cartella se non esiste?</label><br />'+'<label><input type=checkbox class="form-check-input me-2" name=overwriteFiles />Sovrascrivere se il file esiste? </label></form>'),showModal("xxAddAgentModal","idx_dlgOkButton",()=>d2batchUploadValidateOk()),d2batchUploadValidate()}else if(110==e)setModalContent("xxAddAgent","Forza l'aggiornamento dell'agente",t="Forzare l'aggiornamento dell'agente sui dispositivi selezionati?<br /><br />"),showModal("xxAddAgentModal","idx_dlgOkButton",()=>d2groupActionFunctionAgentUpdateExec());else if(111==e)setModalContent("xxAddAgent","Pulire il core dell'agente",t="Pulire il core dell'agente sui dispositivi selezionati?<br /><br />"),showModal("xxAddAgentModal","idx_dlgOkButton",()=>d2groupActionFunctionAgentClearCoreExec());else{if(112!=e)return meshserver.send({action:"poweraction",nodeids:getCheckedDevices(),actiontype:parseInt(e)}),uncheckAllDevices(),!0;setModalContent("xxAddAgent","Carica il core del server predefinito",t="Carica il core del server predefinito sui dispositivi selezionati?<br /><br />"),showModal("xxAddAgentModal","idx_dlgOkButton",()=>d2groupActionFunctionAgentDefaultCodeExec())}return!1}function d2batchUploadValidate(){QE("idx_dlgOkButton",!(0==Q("d2uploadinput").files.length||null!=Q("d2winuploadpath")&&""==Q("d2winuploadpath").value||null!=Q("d2linuxuploadpath")&&""==Q("d2linuxuploadpath").value))}function d2batchUploadValidateOk(){Q("d2batchUploadSubmit").click()}function d2groupActionFunctionAgentUpdateExec(){meshserver.send({action:"updateAgents",nodeids:getCheckedDevices()})}function d2groupActionFunctionAgentClearCoreExec(){meshserver.send({action:"uploadagentcore",nodeids:getCheckedDevices(),type:"clear"})}function d2groupActionFunctionAgentDefaultCodeExec(){meshserver.send({action:"uploadagentcore",nodeids:getCheckedDevices(),type:"default"})}function d2groupActionFunctionNotifyExec(){var e=Q("d2deviceop").value,t=Q("dp2notifyTitle").value,i=Q("d2notifyMsg").value,o=getCheckedDevices(),n=parseFloat(Q("d2notifyTimeout").value);if(0!=i.length)if(""==(t=""==t?decodeURIComponent("{{{extitle}}}"):t)&&(t="MeshCentral"),isNaN(n)&&(n=2),1==e)for(var a=0;a<o.length;a++)meshserver.send({action:"msg",type:"messagebox",nodeid:o[a],title:t,msg:i,timeout:6e4*n});else if(2==e)meshserver.send({action:"toast",nodeids:o,title:t,msg:i});else if(3==e)for(a=0;a<o.length;a++)meshserver.send({action:"msg",type:"alertbox",nodeid:o[a],title:t,msg:i})}function d2groupActionFunctionTagsExec(){var e=getCheckedDevices(),t=Q("d2deviceop").value,i=Q("dp10devicevalue").value;if(2==t)for(var o in e)meshserver.send({action:"changedevice",nodeid:e[o],tags:i});else{var n=[];for(o in i=i.split(",")){var a=i[o].trim();0<a.length&&a.length<64&&-1==n.indexOf(a)&&n.push(a)}for(o in e){var s=null,r=!1,l=getNodeFromId(e[o]);null==(s=null!=l.tags?Clone(l.tags):s)&&(s=[]);for(var d,c=0;c<i.length;c++)1==t&&-1==s.indexOf(i[c])&&(s.push(i[c]),r=!0),3==t&&0<=(d=s.indexOf(i[c]))&&(s.splice(d,1),r=!0);r&&meshserver.send({action:"changedevice",nodeid:e[o],tags:s.join(",")})}}}function p2downloadDeviceInfo(){if(!xxdialogMode){var e,t=getCheckedDevices(),i=!1;for(e in t)null!=getNodeFromId(t[e]).intelamt&&(i=!0);var o="Scarica l'elenco dei dispositivi con uno dei formati di file di seguito.<br /><br />",o=(o+=addHtmlValue("Formato CSV","<a href=# style=cursor:pointer onclick='return p2downloadDeviceInfoCSV()'>elencodispositivi.csv</a>"))+addHtmlValue("Formato JSON","<a href=# style=cursor:pointer onclick='return p2downloadDeviceInfoJSON()'>elencodispositivi.json</a>");i&&(o+=addHtmlValue("Intel&reg; AMT JSON","<a href=# style=cursor:pointer onclick='return p2downloadAmtInfoJSON()'>computerlist.json</a>")),setModalContent("xxAddAgent","Esportazione delle informazioni sul dispositivo",o+='<div style=margin-top:8px><label><input type=checkbox class="form-check-input me-2" id=d2DevInfoDetailsCheck />Includi i dettagli del dispositivo</label></div>'),showModal("xxAddAgentModal","idx_dlgOkButton")}}function csvClean(e){return null==e?"":e.split(",").join("")}function p2downloadDeviceInfoCSV(){var e=getCheckedDevices();if(Q("d2DevInfoDetailsCheck").checked){var t=null;try{t=Intl.DateTimeFormat().resolvedOptions().timeZone}catch(e){}meshserver.send({action:"getDeviceDetails",nodeids:e,tz:t,tf:(new Date).getTimezoneOffset(),l:getLang(),type:"csv"})}else{var i,o="id,nome,rname,host,icona,ip,osdesc,stato,nomegruppo,conn,pwr,av,aggiornamento,firewall,bitlocker,dettagli av,tags,lastbootuptime\r\n";for(i in e){var n=getNodeFromId(e[i]);if(o+='"'+n._id.split(",").join("")+'","'+n.name.split(",").join("")+'","'+(n.rname?n.rname.split(",").join(""):"")+'","'+(n.host?n.host.split(",").join(""):"")+'","'+n.icon+'","'+(n.ip||"")+'","'+(n.osdesc?n.osdesc.split(",").join(""):"")+'","'+n.state+'","'+meshes[n.meshid].name.split(",").join("")+'","'+(n.conn||"")+'","'+(n.pwr||"")+'"',"object"==typeof n.wsc?o+=',"'+csvClean(n.wsc.antiVirus)+'","'+csvClean(n.wsc.autoUpdate)+'","'+csvClean(n.wsc.firewall)+'"':o+=",,,","object"==typeof n.volumes){var a="",s=!0;for(d in n.volumes)void 0!==n.volumes[d].protectionStatus&&(s?s=!1:a+="|",a+=d+"/"+n.volumes[d].volumeStatus);o+=',"'+csvClean(a)+'"'}else o+=",";if("object"==typeof n.av){var r="",l=!0;for(d in n.av)"string"==typeof n.av[d].product&&(l?l=!1:r+="|",r+=n.av[d].product+"/"+(n.av[d].enabled?"enabled":"disabled")+"/"+(n.av[d].updated?"updated":"notupdated"));o+=',"'+csvClean(r)+'"'}else o+=",";if("object"==typeof n.tags){var d,c="",u=!0;for(d in n.tags)u?u=!1:c+="|",c+=n.tags[d];o+=',"'+csvClean(c)+'"'}else o+=",";"number"==typeof n.lastbootuptime&&(o+=',"'+n.lastbootuptime+'"'),o+="\r\n"}saveAs(stringToUtf8Blob(o),"elencodispositivi.csv")}return!1}function p2downloadAmtInfoJSON(){var e,t=getCheckedDevices(),i={webappversion:"0.9.0",computers:[]};for(e in t){var o,n=getNodeFromId(t[e]);null!=n.intelamt&&(o={name:n.name,host:n.host,user:n.intelamt.user,pass:"",tls:1==n.intelamt.tls?1:0,ver:n.intelamt.ver,pstate:n.intelamt.state},2==n.intelamt.state&&(o.pmode=1),n.intelamt.realm&&(o.digestrealm=n.intelamt.realm),n.intelamt.hash&&(o.tlscerthash=n.intelamt.hash),i.computers.push(o))}saveAs(new Blob([JSON.stringify(i,null,2)],{type:"application/octet-stream"}),"computerlist.json")}function p2downloadDeviceInfoJSON(){var e=getCheckedDevices();if(Q("d2DevInfoDetailsCheck").checked){var t=null;try{t=Intl.DateTimeFormat().resolvedOptions().timeZone}catch(e){}meshserver.send({action:"getDeviceDetails",nodeids:e,tz:t,tf:(new Date).getTimezoneOffset(),l:getLang(),type:"json"})}else{var i,o=[];for(i in e)o.push(getNodeFromId(e[i]));saveAs(new Blob([JSON.stringify(o,null,2)],{type:"application/octet-stream"}),"elencodispositivi.json")}return!1}function d2groupActionFunctionDelCheck(){QE("idx_dlgOkButton",Q("d2check").checked)}function d2groupActionFunctionDelExec(){meshserver.send({action:"removedevices",nodeids:getCheckedDevices()}),uncheckAllDevices()}function d2runCommandDialog(e){var t,i=!1,o=!1,n=!1;for(t in e.nodeids){var a=getNodeFromId(e.nodeids[t]);a.agent&&(24==(24&GetNodeRights(a))&&(n=!0),0<a.agent.id&&a.agent.id<5?i=!0:o=!0)}if(1==i||1==o||1==n){var s={type:1,runAs:0,source:1,cmd:""};try{s=JSON.parse(getstore("runopt",s))}catch(e){}e.selectedFile&&(r=e.selectedFile.name.toLowerCase(),console.log("filename",r),r.endsWith(".bat")&&(s.type=1),r.endsWith(".ps1")&&(s.type=2),r.endsWith(".sh")&&(s.type=3),r.endsWith(".agentconsole"))&&(s.type=4);var r="";e.title&&(r+=e.title+"<br />"),r+="<select id=d2cmdtype onclick=d2runCommandValidate() style=width:100%;margin-bottom:4px;margin-top:4px class=form-select>",1==i&&(r+="<option value=1"+(1==s.type?" selected":"")+">Windows Command Prompt</option><option value=2"+(2==s.type?" selected":"")+">Windows PowerShell</option>"),1==o&&(r+="<option value=3"+(3==s.type?" selected":"")+">Shell dei comandi Linux / BSD / macOS</option>"),1==n&&(r+="<option value=4"+(4==s.type?" selected":"")+">Console Agente</option>"),r=r+"</select>"+("<select id=d2cmduser style=width:100%;margin-bottom:4px class=form-select><option value=0"+(0==s.runAs?" selected":"")+">Esegui come agente</option><option value=1"+(1==s.runAs?" selected":"")+">Esegui come utente, agente se nessun utente</option><option value=2"+(2==s.runAs?" selected":"")+">Deve essere eseguito come utente </option></select>"),null==e.selectedFile&&(r+="<select id=d2cmdsource onclick=d2runCommandValidate() style=width:100%;margin-bottom:4px class=form-select><option value=0"+(0==s.source?" selected":"")+">Commands from text box</option><option value=1"+(1==s.source?" selected":"")+">Commands from file</option>",8&userinfo.siteadmin&&(r+="<option value=2"+(2==s.source?" selected":"")+">Commands from file on server</option>"),r=r+("</select><textarea id=d2runcmd onkeyup=d2runCommandValidate() style=background-color:#fcf3cf;width:100%;height:200px;resize:none;overflow-y:scroll class=form-control>"+(s.cmd?EscapeHtml(decodeURIComponent(s.cmd)):""))+'</textarea><div id=d2runfile style=display:none><input id=d2runfileex class="form-control" type=file onchange=d2runCommandValidate() id=d2localFile name=files onchange=d2runCommandValidate() /></div>',8&userinfo.siteadmin)&&(r+='<div id=d2runsfile style=display:none><div id=d2serveraction valign=bottom><input type=button id=p2FolderUp disabled="disabled" onclick=d3folderup() value="Up" />&nbsp;<span id=p2CurrentFolder></span></div><div id=d2serverfiles></div></div>'),setModalContent("xxAddAgent","Esegui comandi",r),showModal("xxAddAgentModal","idx_dlgOkButton",function(){d2groupActionFunctionRunCommands(3,e)}),null==e.selectedFile&&(Q("d2runcmd").focus(),8&userinfo.siteadmin)&&(d3fileoptions={dialog:2,files:"d2serverfiles",folderup:"p2FolderUp",currentFolder:"p2CurrentFolder",func:null},d3updatefiles()),d2runCommandValidate()}}function d2runCommandValidate(){var e;QV("d2cmduser",Q("d2cmdtype").value<4),null==xxdialogTag.selectedFile?(QV("d2runcmd",0==Q("d2cmdsource").value),QV("d2runfile",1==Q("d2cmdsource").value),QV("d2runsfile",2==Q("d2cmdsource").value),e=!1,0==Q("d2cmdsource").value&&0<Q("d2runcmd").value.length&&(e=!0),1==Q("d2cmdsource").value&&1==Q("d2runfileex").files.length&&(e=!0),2==Q("d2cmdsource").value&&(e=!1),QE("idx_dlgOkButton",e)):QE("idx_dlgOkButton",!0)}function d2groupActionFunctionRunCommands(e,t){var i=3;try{i=parseInt(Q("d2cmdtype").value)}catch(e){}null==t.selectedFile&&putstore("runopt",JSON.stringify({type:i,runAs:parseInt(Q("d2cmduser").value),source:parseInt(Q("d2cmdsource").value),cmd:encodeURIComponent(Q("d2runcmd").value)}));var o,n={action:"runcommands",nodeids:t.nodeids,type:i,runAsUser:parseInt(Q("d2cmduser").value)};t.selectedFile?((o=new FileReader).onload=function(e){n.cmds=e.target.result,meshserver.send(n),t.func&&t.func()},o.readAsText(t.selectedFile)):0==Q("d2cmdsource").value?(n.cmds=Q("d2runcmd").value,meshserver.send(n),t.func&&t.func()):1==Q("d2cmdsource").value?((o=new FileReader).onload=function(e){n.cmds=e.target.result,meshserver.send(n),t.func&&t.func()},o.readAsText(Q("d2runfileex").files[0])):2==Q("d2cmdsource").value&&1==(i=d3getFileSel()).length&&(n.cmdpath=d3filetreelocation.join("/")+"/"+i[0],meshserver.send(n),t.func)&&t.func()}function onSortSelectChange(e){sort=document.getElementById("sortselect").selectedIndex,e||putstore("sort",sort)}var sortCollator=new Intl.Collator(void 0,{numeric:!0,sensitivity:"base"});function nameSort(e,t){e=e.name.toLowerCase(),t=t.name.toLowerCase();return sortCollator.compare(e,t)}function meshSort(e,t){var i=sortCollator.compare(e.meshnamel,t.meshnamel);return 0!=i||0!=(i=sortCollator.compare(e.meshid,t.meshid))?i:1==showRealNames?sortCollator.compare(e.rnamel,t.rnamel):sortCollator.compare(e.namel,t.namel)}function powerSort(e,t){var i=e.pwr||0,o=t.pwr||0;return o<i?-1:i<o?1:i==o?1==showRealNames?sortCollator.compare(e.rnamel,t.rnamel):sortCollator.compare(e.namel,t.namel):void 0}function deviceSort(e,t){return sortCollator.compare(e.namel,t.namel)}function deviceHostSort(e,t){return sortCollator.compare(e.rnamel,t.rnamel)}function lastConnectSort(e,t){var i=e.lastconnect,o=t.lastconnect;return null==i&&(i=99999999999999),null==o&&(o=99999999999999),(i=0<e.conn?99999999999998:i)==(o=0<t.conn?99999999999998:o)?nameSort(e,t):i-o}function onSearchFocus(e){searchFocus=e}function clearDeviceSearch(){Q("KvmSearchInput").value=Q("SearchInput").value="",onOnlineCheckBox(),mainUpdate(1)}function onMapSearchFocus(e){mapSearchFocus=e}function onUserSearchFocus(e){userSearchFocus=e}function onConsoleFocus(e){consoleFocus=e}function parseSearchAndInput(e){var t,i=e.split(" e "),o=null;for(t in i){var n=getDevicesThatMatchFilter(i[t]);if(null==o)o=n;else{var a,s=[];for(a in n)0<=o.indexOf(n[a])&&s.push(n[a]);o=s}}return o}function parseSearchOrInput(e){var t,i=e.split(" o "),o=null;for(t in i){var n=parseSearchAndInput(i[t]);if(null==o)o=n;else for(var a in n)o.indexOf(0<=n[a])&&o.push(n[a])}return o}function getDevicesThatMatchFilter(e){var t=[],i=null,o=null,n=null,a=null,s=null,r=null,l=null,d=null,c=null;if(e.startsWith("utente: ".toLowerCase())?i=e.substring("utente: ".length):e.startsWith("u:".toLowerCase())?i=e.substring("u:".length):e.startsWith("ip:".toLowerCase())?o=e.substring("ip:".length):e.startsWith("gruppo:".toLowerCase())?n=e.substring("gruppo:".length):e.startsWith("g:".toLowerCase())?n=e.substring("g:".length):e.startsWith("tag:".toLowerCase())?a=e.substring("tag:".length):e.startsWith("t:".toLowerCase())?a=e.substring("t:".length):e.startsWith("atag:".toLowerCase())?s=e.substring("atag:".length):e.startsWith("a:".toLowerCase())?s=e.substring("a:".length):e.startsWith("os:".toLowerCase())?l=e.substring("os:".length):e.startsWith("amt:".toLowerCase())?d=e.substring("amt:".length):e.startsWith("desc:".toLowerCase())?c=e.substring("desc:".length):"wsc:ok"==e?r=1:"wsc:noav"==e?r=2:"wsc:noupdate"==e?r=3:"wsc:nofirewall"==e?r=4:"wsc:any"==e&&(r=5),""==e)for(var u in nodes)t.push(u);else if(null!=o)for(var u in nodes)null!=nodes[u].ip&&0<=nodes[u].ip.toLowerCase().indexOf(o)&&t.push(u);else if(null!=n)for(var u in nodes)0<=meshes[nodes[u].meshid].name.toLowerCase().indexOf(n)&&t.push(u);else if(null!=a){for(var u in nodes)if(null==nodes[u].tags&&""==a)t.push(u);else if(null!=nodes[u].tags)for(var p in nodes[u].tags)if(0<=nodes[u].tags[p].toLowerCase().indexOf(a)){t.push(u);break}}else if(null!=s)for(var u in nodes)(null!=nodes[u].agent&&null==nodes[u].agent.tag&&""==s||null!=nodes[u].agent&&null!=nodes[u].agent.tag&&0<=nodes[u].agent.tag.toLowerCase().indexOf(s))&&t.push(u);else if(null!=i){for(var u in nodes)if(nodes[u].users&&0<nodes[u].users.length)for(var m in nodes[u].users)0<=nodes[u].users[m].toLowerCase().indexOf(i)&&t.push(u)}else if(null!=l)for(var u in nodes)null!=nodes[u].osdesc&&0<=nodes[u].osdesc.toLowerCase().indexOf(l)&&t.push(u);else if(null!=d)for(var u in nodes)null==nodes[u].intelamt||""!=d&&nodes[u].intelamt.state!=d||t.push(u);else if(null!=c)for(var u in nodes)null!=nodes[u].desc&&""!=nodes[u].desc&&(""==c||0<=nodes[u].desc.toLowerCase().indexOf(c))&&t.push(u);else if(null!=r)for(var u in nodes)!nodes[u].wsc||(1==r&&"OK"==nodes[u].wsc.antiVirus&&"OK"==nodes[u].wsc.autoUpdate&&"OK"==nodes[u].wsc.firewall||(2==r||5==r)&&"OK"!=nodes[u].wsc.antiVirus||(3==r||5==r)&&"OK"!=nodes[u].wsc.autoUpdate||(4==r||5==r)&&"OK"!=nodes[u].wsc.firewall)&&t.push(u);else if("*"==e)for(var u in nodes)1==stars[nodes[u]._id]&&t.push(u);else try{var g=e.split(/\s+/).join("|"),v=new RegExp(g);for(u in nodes)32768&features2?268435456&features2?(v.test(nodes[u].name.toLowerCase())||v.test(meshes[nodes[u].meshid].name.toLowerCase())||null!=nodes[u].rnamel&&v.test(nodes[u].rnamel.toLowerCase()))&&t.push(u):(v.test(nodes[u].name.toLowerCase())||null!=nodes[u].rnamel&&v.test(nodes[u].rnamel.toLowerCase()))&&t.push(u):268435456&features2?showRealNames?(null!=nodes[u].rnamel&&v.test(nodes[u].rnamel.toLowerCase())||v.test(meshes[nodes[u].meshid].name.toLowerCase()))&&t.push(u):(v.test(nodes[u].name.toLowerCase())||v.test(meshes[nodes[u].meshid].name.toLowerCase()))&&t.push(u):showRealNames?null!=nodes[u].rnamel&&v.test(nodes[u].rnamel.toLowerCase())&&t.push(u):v.test(nodes[u].name.toLowerCase())&&t.push(u)}catch(e){for(var u in nodes)t.push(u)}return t}function onSearchInputChanged(){var e=Q("SearchInput").value.toLowerCase().trim(),t=(putstore("_search",Q("SearchInput").value),""==e?QC("SearchInput").remove("search"):QC("SearchInput").add("search"),QV("SearchInputClearButton",""!=e),QV("KvmSearchInputClearButton",""!=e),parseSearchOrInput(e));for(o in nodes)nodes[o].v=0<=t.indexOf(o);var i,e=Q("DevFilterSelect").value;if(1==e)for(var o in nodes)null!=nodes[o].conn&&0!=nodes[o].conn||3==nodes[o].mtype||(nodes[o].v=!1);if(2==e)for(var o in nodes)(null==(i=nodes[o]).sessions||null==i.sessions.kvm&&null==i.sessions.terminal&&null==i.sessions.files&&null==i.sessions.tcp&&null==i.sessions.udp)&&(i.v=!1);if(3==e)for(var o in nodes)1!=stars[nodes[o]._id]&&(nodes[o].v=!1);if(4==e)for(var o in nodes)null==nodes[o].intelamt&&(nodes[o].v=!1);if(5==e)for(var o in nodes)null!=nodes[o].conn&&0!=nodes[o].conn&&(nodes[o].v=!1);if(6==e)for(var o in nodes)null!=(i=nodes[o]).sessions&&null!=i.sessions.help||(i.v=!1);if(7==e)for(var o in nodes)null!=(i=nodes[o]).tags&&0!=i.tags.length||(i.v=!1);if(8==e)for(var o in nodes)null!=(i=nodes[o]).tags&&0<i.tags.length&&(i.v=!1)}function newContextMenu(e,t){if(1===t){if(null==currentNode||null==currentNode.agent||3==currentNode.mtype)return!0;if(!(serverinfo.linuxshell&&4<currentNode.agent.id)){t=e.target.nextElementSibling;if(t)for(var i=t.children,o=4<currentNode.agent.id&&!isWindowsNode(currentNode)?"lin":34==currentNode.agent.id?"add":null,n=0;n<i.length;n++)i[n].style.display=o?i[n].classList.contains(o)?"block":"none":i[n].classList.contains("lin")||i[n].classList.contains("ass")?"none":"block"}}}var contextelement=null;function handleContextMenu(e){if(hideContextMenu(),!xxdialogMode){for(var t=null!==window.pageXOffset?window.pageXOffset:(document.documentElement||document.body.parentNode||document.body).scrollLeft,i=null!==window.pageYOffset?window.pageYOffset:(document.documentElement||document.body.parentNode||document.body).scrollTop,o=document.elementFromPoint(e.pageX-t,e.pageY-i);o&&null!=o&&null==o.attributes.cmenu;)o=o.parentElement;if(null==o)return!0;t=o.attributes.cmenu.value;if("devsContentMenu"===t){contextelement=o;var n=document.getElementById("contextMenu"),i=(showContextMenuDiv(n,e.pageX,e.pageY),getNodeFromId((i=(1==Q("viewselect").value?contextelement.children[0].children[0].children[1].children[0]:contextelement.children[1]).attributes.onmouseup.value).substring(12,i.length-18))),a=GetNodeRights(i),s=0!=(16&a),r=4294967295==a||0==(512&a),l=4294967295==a||0==(1024&a);QV("cxdesktop",0!=(1&i.conn)&&4!=i.mtype&&(1==i.mtype||null==i.agent||null==i.agent.caps||0!=(1&i.agent.caps)||i.intelamt&&2==i.intelamt.state)&&(8&a||256&a)&&(4294967295==a||0==(65536&a))),QV("cxterminal",0!=(1&i.conn)&&4!=i.mtype&&(1==i.mtype||null==i.agent||null==i.agent.caps||0!=(2&i.agent.caps)||i.intelamt&&2==i.intelamt.state)&&8&a&&r),QV("cxfiles",4!=i.mtype&&2==i.mtype&&(null==i.agent||null==i.agent.caps||0!=(4&i.agent.caps))&&8&a&&l),QV("cxevents",null!=i.intelamt&&(2==i.intelamt.state||2&i.conn)&&8&a),QV("cxdetails",i.mtype<3),QV("cxwebvnc",(0!=(1&i.conn)||3==i.mtype)&&i.agent&&0!=(8&a)&&0==(536870912&features)),QV("cxwebrdp",(0!=(1&i.conn)||3==i.mtype)&&i.agent&&0!=(8&a)&&0==(1073741824&features)),QV("cxwebssh",512&features2&&(0!=(1&i.conn)||3==i.mtype)&&i.agent&&0!=(8&a)),QV("cxconsole",s&&2==i.mtype&&(null==i.agent||null==i.agent.caps||0!=(8&i.agent.caps))&&8&a),QV("cxrdp",!1),0==(1&i.conn)&&3!=i.mtype||!i.agent||0==(8&a)||0<i.agent.id&&i.agent.id<5&&("win32"!=navigator.platform.toLowerCase()||null!=serverinfo.devicemeshrouterlinks&&0==serverinfo.devicemeshrouterlinks.rdp||QV("cxrdp",!0)),QV("cxmgroupsplit",!0),QV("cxstar",!0)}else{if(null==(n=document.getElementById(t)))return!0;contextelement=o,showContextMenuDiv(n,e.pageX,e.pageY)}return haltEvent(e)}}function showContextMenuDiv(e,t,i){var o=document.documentElement.getBoundingClientRect(),n=o.height,o=o.width;e.style.left=e.style.right=e.style.top=e.style.bottom=null,o/2<t?e.style.right=o-event.pageX+"px":e.style.left=event.pageX+"px",n/2<i?e.style.bottom=n-event.pageY+"px":e.style.top=event.pageY+"px",e.style.display="block"}function cmaction(e,t){var i,o=(1==Q("viewselect").value?contextelement.children[0].children[0].children[1].children[0]:contextelement.children[1]).attributes.onmouseup.value;if(o=o.substring(12,o.length-18),9==e&&(Q("viewselect").value=3,Q("viewselect").onchange(),Q("autoConnectDesktopCheckbox").checked=!0,Q("autoConnectDesktopCheckbox").onclick()),0<e&&e<9&&(i=[0,10,12,11,13,16,17,15,19][e],t&&1==t.shiftKey?safeNewWindow(window.location.origin+"?node="+o.split("/")[2]+"&viewmode="+i+"&hide=16"+(urlargs.key?"&key="+urlargs.key:""),"meshcentral:"+o):(gotoDevice(o,i),t=meshes[currentNode.meshid],1&currentNode.conn&&2==t.mtype&&(11==i&&null==desktop&&1&currentNode.agent.caps&&connectDesktop(null,3),12==i&&null==terminal&&2&currentNode.agent.caps&&connectTerminal(null,1),13==i)&&null==files&&connectFiles(null))),10==e){for(var n=document.getElementsByClassName("DeviceCheckbox"),a=[],s=0;s<n.length;s++)!0===n[s].checked&&a.push(n[s].defaultValue.substring(6));for(s in 0==a.length&&a.push(o),a)null!=stars[a[s]]&&(delete stars[a[s]],delete a[s]);var r=Object.keys(stars).length;for(s in a)r<200&&null==stars[a[s]]&&(stars[a[s]]=1,r++);putstore("stars",JSON.stringify(stars)),updateDeviceViewDevice(o),3==Q("DevFilterSelect").value&&mainUpdate(1)}else 11==e?p10mstsc(o):12==e?p10rfb(o):13==e?p10ssh(o):14==e&&p10MCRouter(o,3)}function cmmeshaction(e){var t=contextelement.attributes.onclick.value.substring(10,contextelement.attributes.onclick.value.length-2),i=document.getElementsByClassName("DeviceCheckbox");if(1==e||2==e){for(var o=0;o<i.length;o++)i[o].attributes&&i[o].attributes.class.value.split(" ")[0]==t&&(i[o].checked=1==e);if(1==e)for(var o in nodes)nodes[o].meshid==t&&1==nodes[o].v&&(checkedNodeids[nodes[o]._id]=1);else if(2==e)for(var o in checkedNodeids){var n=getNodeFromId(o);null!=n&&n.meshid==t&&1==n.v&&delete checkedNodeids[o]}}p1updateInfo()}function cmconnectfilesaction(){connectFiles(null,1,32)}function cmtermaction(e,t){e<100?connectTerminal(null,1,{protocol:e,consent:t}):100==e&&connectTerminal(null,1,{protocol:1,requireLogin:!0,consent:t})}function cmdeskaction(e){1==e&&connectDesktop(null,3,null,72),2==e&&connectDesktop(null,3,null,8),3==e&&connectDesktop(null,3,null,64),10==e&&null!=desktop&&(desktop.sendCtrlMsg('{"ctrlChannel":"102938","type":"autolock","value":true}'),connectDesktop()),11==e&&null!=desktop&&(desktop.sendCtrlMsg('{"ctrlChannel":"102938","type":"autolock","value":false}'),connectDesktop())}function cmaltportaction(e){xxdialogMode||(setModalContent("xxAddAgent","Connessione RDP",'Porta di connessione remota RDP:<br /><br /><input type=text placeholder="3389" inputmode="numeric" pattern="[0-9]*" onkeypress="return (event.keyCode == 8) || (event.charCode >= 48 && event.charCode <= 57)" maxlength=5 id=d10rdpport type=text>'),showModal("xxAddAgentModal","idx_dlgOkButton",function(){var e=0<Q("d10rdpport").value.length?parseInt(Q("d10rdpport").value):3389;meshserver.send({action:"changedevice",nodeid:currentNode._id,rdpport:e})}),Q("d10rdpport").focus(),null!=currentNode.rdpport&&(Q("d10rdpport").value=currentNode.rdpport))}function cmsshportaction(e){xxdialogMode||(setModalContent("xxAddAgent","Connessione SSH",'Porta di connessione remota SSH:<br /><br /><input type=text placeholder="22" inputmode="numeric" pattern="[0-9]*" onkeypress="return (event.keyCode == 8) || (event.charCode >= 48 && event.charCode <= 57)" maxlength=5 id=d10sshport type=text>'),showModal("xxAddAgentModal","idx_dlgOkButton",function(){var e=0<Q("d10sshport").value.length?parseInt(Q("d10sshport").value):22;meshserver.send({action:"changedevice",nodeid:currentNode._id,sshport:e})}),Q("d10sshport").focus(),null!=currentNode.sshport&&(Q("d10sshport").value=currentNode.sshport))}function cmrfbportaction(e){xxdialogMode||(setModalContent("xxAddAgent","Connessione VNC",'Porta di connessione remota VNC:<br /><br /><input type=text placeholder="5900" inputmode="numeric" pattern="[0-9]*" onkeypress="return (event.keyCode == 8) || (event.charCode >= 48 && event.charCode <= 57)" maxlength=5 id=d10rfbport type=text>'),showModal("xxAddAgentModal","idx_dlgOkButton",function(){var e=0<Q("d10rfbport").value.length?parseInt(Q("d10rfbport").value):3389;meshserver.send({action:"changedevice",nodeid:currentNode._id,rfbport:e})}),Q("d10rfbport").focus(),null!=currentNode.rfbport&&(Q("d10rfbport").value=currentNode.rfbport))}function cmhttpportaction(e){xxdialogMode||(setModalContent("xxAddAgent","Connessione HTTP",'Porta di connessione remota HTTP:<br /><br /><input type=text placeholder="80" inputmode="numeric" pattern="[0-9]*" onkeypress="return (event.keyCode == 8) || (event.charCode >= 48 && event.charCode <= 57)" maxlength=5 id=d10httpport type=text>'),showModal("xxAddAgentModal","idx_dlgOkButton",function(){var e=0<Q("d10httpport").value.length?parseInt(Q("d10httpport").value):80;meshserver.send({action:"changedevice",nodeid:currentNode._id,httpport:e})}),Q("d10httpport").focus(),null!=currentNode.httpport&&(Q("d10httpport").value=currentNode.httpport))}function cmhttpsportaction(e){xxdialogMode||(setModalContent("xxAddAgent","Connessione HTTPS",'Porta di connessione remota HTTPS:<br /><br /><input type=text placeholder="443" inputmode="numeric" pattern="[0-9]*" onkeypress="return (event.keyCode == 8) || (event.charCode >= 48 && event.charCode <= 57)" maxlength=5 id=d10httpsport type=text>'),showModal("xxAddAgentModal","idx_dlgOkButton",function(){var e=0<Q("d10httpsport").value.length?parseInt(Q("d10httpsport").value):443;meshserver.send({action:"changedevice",nodeid:currentNode._id,httpsport:e})}),Q("d10httpsport").focus(),null!=currentNode.httpsport&&(Q("d10httpsport").value=currentNode.httpsport))}function cmfilesaction(e){var t;xxdialogMode||(t=p13sort_files(p13filetree.dir)[parseInt(contextelement.attributes.fileindex.nodeValue)],1==e?(setModalContent("xxAddAgent","Rinominare",'<input type=text id=p13renameinput maxlength=64 onkeyup=p13fileNameCheck(event) style=width:100% value="'+t.n+'" />'),showModal("xxAddAgentModal","idx_dlgOkButton",()=>p13renamefileEx(3,{action:"rename",path:p13filetreelocation.join("/"),oldname:t.n})),focusTextBox("p13renameinput"),p13fileNameCheck()):2==e?t.s<=204800?p13downloadfile(encodeURIComponentEx(p13filetreelocation.join("/")+"/"+t.n),encodeURIComponentEx(t.n),t.s,"viewer"):messagebox("Editor di file","È possibile modificare solo i file inferiori a 200k."):3==e&&(setModalContent("xxAddAgent","Elimina","Cancella elemento?"),showModal("xxAddAgentModal","idx_dlgOkButton",()=>p13deletefileCm(3,t))))}function cmexpandaction(e){if(1==e)CollapsedGroups={};else{if(0==sort){for(var t in CollapsedGroups={},meshes)CollapsedGroups[t]=!0;for(var t in nodes)null==meshes[nodes[t].meshid]&&(CollapsedGroups[nodes[t].meshid]=!0)}if(1==sort){CollapsedGroups={};for(t=0;t<10;t++)CollapsedGroups["pwr:"+t]=!0}if(3==sort)for(var t in CollapsedGroups={},nodes)if((o=nodes[t]).tags)for(var i in o.tags)CollapsedGroups["tag:"+encodeURIComponentEx(o.tags[i])]=!0;if(4==sort)for(var t in CollapsedGroups={},nodes){var o=nodes[t],n=meshes[o.meshid];if(n){if(CollapsedGroups["tag:"+encodeURIComponentEx(n.name)]=!0,o.tags)for(var i in o.tags)CollapsedGroups["tag:"+encodeURIComponentEx(n.name+" - "+o.tags[i])]=!0}else if(o.tags)for(var i in o.tags)CollapsedGroups["tag:"+encodeURIComponentEx("**INDV*~*DEVS** - "+o.tags[i])]=!0}}putstore("_collapse",JSON.stringify(CollapsedGroups)),updateCollapseAllButton(),mainUpdate(4)}function cmdeskplayeraction(e){xxdialogMode||safeNewWindow(window.location.origin+"{{{domainurl}}}player.htm"+(urlargs.key?"?key="+urlargs.key:""),"meshcentral-deskplayer")}function cmdeskshortcutaction(e){xxdialogMode||deskCustomizeKeys()}function cmdeskpreconfigtypeaction(e){xxdialogMode||(-1==e?deskCustomizeStrings():showDeskTypeEx(e<1e3?serverinfo.preConfiguredRemoteInput[e].value:deskKeyboardStrings[e-1e3].v))}function cmdeskpreconfigscriptaction(e){meshserver.send({action:"runcommands",nodeids:[currentNode._id],presetcmd:e})}function p13deletefileCm(e,t){files.sendText({action:"rm",reqid:1,path:p13filetreelocation.join("/"),delfiles:[t.n],rec:!1}),p13folderup(999)}function hideContextMenu(){QV("contextMenu",!1),QV("meshContextMenu",!1),QV("altPortContextMenu",!1),QV("rfbPortContextMenu",!1),QV("sshPortContextMenu",!1),QV("httpPortContextMenu",!1),QV("httpsPortContextMenu",!1),QV("filesContextMenu",!1),QV("deskPlayerContextMenu",!1),QV("deskKeyShortcutContextMenu",!1),QV("deskPreConfigShortcutContextMenu",!1),QV("deskPreConfigScriptContextMenu",!1),QV("expandAllContextMenu",!1),contextelement=null}var map_cm_popup,map_cm_editMarker,map_cm_clearMarker,map_cm_saveMarker,map_cm_nodemenu_items,contextmenu_items,currentNode,xxmap={map:null,contextmenu:null,activeInteractions:[],showindex:0,markersSource:null,markersLayer:null,mapLayer:null,mapView:null};function updateMapMarkers(e){if(0!=(32768&features)){if(null!=xxmap&&null==xxmap.map)try{loadmap()}catch(e){console.error("loadmap() exception",e)}if(null!=xxmap){var t,i=null;for(t in nodes)try{var o,n,a=map_parseNodeLoc(nodes[t]),s=xxmap.markersSource.getFeatureById(nodes[t]._id);null==a||nodes[t].meshid!=e&&null!=e?s&&xxmap.markersSource.removeFeature(s):(o=a[0],n=a[1],a[2],null==i?i=[o,n,o,n,0]:(o<i[0]&&(i[0]=o),n<i[1]&&(i[1]=n),o>i[2]&&(i[2]=o),n>i[3]&&(i[3]=n)),null==s?(addFeature(nodes[t]),i[4]=1):(updateFeature(nodes[t],s),s.setStyle(markerStyle(nodes[t],a[2]))))}catch(e){console.error("updateMapMarkers() exception",e,JSON.stringify(nodes[t]))}return i}}}function stringToIntHash(e){for(var t=0,i=0;i<e.length;i++)t=(t<<5)-t+e.charCodeAt(i),t|=0;return t}function map_parseNodeLoc(e){var t=null,i=0;return e.iploc&&(t=e.iploc,i=1),e.wifiloc&&(t=e.wifiloc,i=2),e.gpsloc&&(t=e.gpsloc,i=3),e.userloc&&(t=e.userloc,i=4),null==t||"string"!=typeof t?null:(t=t.split(","),1==i?[parseFloat(t[0])+stringToIntHash(e._id.substring(0,20))/1e11,parseFloat(t[1])+stringToIntHash(e._id.substring(20))/1e11,i]:[parseFloat(t[0]),parseFloat(t[1]),i])}function loadmap(){if(0!=(32768&features)&&null!=xxmap)if(0==(32768&features))xxmap=null;else{QV("viewselectmapoption",!0),QV("devViewButton4",!0);try{xxmap.markersSource=new ol.source.Vector,xxmap.markersLayer=new ol.layer.Vector({source:xxmap.markersSource}),xxmap.mapLayer=new ol.layer.Tile({source:new ol.source.OSM}),xxmap.mapView=new ol.View({center:ol.proj.transform([0,0],"EPSG:4326","EPSG:3857"),zoom:2,minZoom:2,maxZoom:20,extent:ol.proj.transformExtent([-1e5,-69.55,1e5,69.55],"EPSG:4326","EPSG:3857")}),xxmap.map=new ol.Map({target:"xdevicesmap",layers:[xxmap.mapLayer,xxmap.markersLayer],view:xxmap.mapView}),xxmap.map.addOverlay(map_cm_popup),xxmap.map.on("click",function(e){var t,e=xxmap.map.forEachFeatureAtPixel(e.pixel,function(e,t){return e});e&&gotoDevice(null!=(t=e.getId())?t:getCorrespondingFeature(e).getId(),10)}),xxmap.map.on("pointermove",function(e){var t,e=xxmap.map.forEachFeatureAtPixel(e.pixel,function(e,t){return e});e?(xxmap.map.getTargetElement().style.cursor="pointer",t=e.getGeometry().getCoordinates(),map_cm_popup.setPosition(t),e.getId()?QH("xmap-info-window",e.get("name")):(t=getCorrespondingFeature(e),QH("xmap-info-window",t.get("name")))):(xxmap.map.getTargetElement().style.cursor="",QH("xmap-info-window",""))});var e=new ContextMenu({width:160,defaultItems:!1,items:contextmenu_items});e.on("open",function(e){var e=xxmap.map.forEachFeatureAtPixel(e.pixel,function(e,t){return e});xxmap.contextmenu.clear(),e?e.getId()?addContextMenuItems(e):(e=getCorrespondingFeature(e))?addContextMenuItems(e):xxmap.contextmenu.extend(contextmenu_items):xxmap.contextmenu.extend(contextmenu_items)}),null==xxmap.contextmenu&&(xxmap.contextmenu=e),xxmap.map.addControl(xxmap.contextmenu)}catch(e){console.log(e),QV("viewselectmapoption",!1),QV("devViewButton4",!1),xxmap=null}}}function addFeature(e,t,i){var o=getModifiedFeature(e._id);o?xxmap.markersSource.addFeature(o):(t||i||(t=(o=map_parseNodeLoc(e))[0],i=o[1]),180<i&&meshserver.send({action:"changedevice",nodeid:e._id,userloc:[t,i=180-i]}),t<90&&-90<t&&i<180&&-180<i&&((o=new ol.Feature({geometry:new ol.geom.Point(ol.proj.transform([i,t],"EPSG:4326","EPSG:3857")),name:e.name,status:e.conn,lat:t,lon:i})).setId(e._id),o.setStyle(markerStyle(e)),xxmap.markersSource.addFeature(o)))}function removeFeature(e){e=xxmap.markersSource.getFeatureById(e._id);e&&xxmap.markersSource.removeFeature(e)}function updateFeature(e,t){e.conn!=t.get("status")&&(t.set("status",e.conn),t.setStyle(markerStyle(e)));var i,o=map_parseNodeLoc(e);null!=o&&(i=o[0],o=o[1],i==t.get("lat")&&o==t.get("lon")||(t.set("lat",i),t.set("lon",o),o=ol.proj.transform([parseFloat(o),parseFloat(i)],"EPSG:4326","EPSG:3857"),t.getGeometry().setCoordinates(o))),e.name!=t.get("name")&&t.set("name",e.name)}function modifyMarkerloc(e){var t,i=e.getId();i&&(e.setStyle(markerStyle(getNodeFromId(e.a),4)),getActiveInteractions(e)||(t=new ol.interaction.Modify({features:new ol.Collection([e]),pixelTolerance:10}),xxmap.activeInteractions.push({featureid:i,feature:e,interaction:t}),xxmap.map.addInteraction(t)))}function saveMarkerloc(e){var t,i=e.getId();i&&(t=getActiveInteractions(e))&&(xxmap.map.removeInteraction(t),removeInteraction(i),t=e.getGeometry().getCoordinates(),180<(e=ol.proj.transform(t,"EPSG:3857","EPSG:4326"))[0]&&(e[0]=180-e[0]),meshserver.send({action:"changedevice",nodeid:i,userloc:[e[1],e[0]]}))}function markerStyle(e,t){null==t&&(t=0,e.iploc&&(t=1),e.wifiloc&&(t=2),e.gpsloc&&(t=3),e.userloc)&&(t=4);e=connStateColor(e);return[new ol.style.Style({image:new ol.style.Icon({color:e,anchor:[.5,1],src:"images/mapmarker"+["","-ip","-wifi","-gps","-user"][t]+".png"})})]}function connStateColor(e){return 1==e.conn||3==e.conn||5==e.conn?"#00ffdd":"#C70039"}function addContextMenuItems(t){getActiveInteractions(t)?(map_cm_saveMarker.data=t,xxmap.contextmenu.push(map_cm_saveMarker)):(map_cm_editMarker.data=t,xxmap.contextmenu.push(map_cm_editMarker),getNodeFromId(t.a).userloc&&(map_cm_clearMarker.data=t,xxmap.contextmenu.push(map_cm_clearMarker))),map_cm_nodemenu_items.forEach(function(e){"Zoom per ingrandire"==e.text||"Zoom per ridurre"==e.text?e.data=t:"-"!=e&&(e.data=t.getId())}),xxmap.contextmenu.extend(map_cm_nodemenu_items)}function getActiveInteractions(e){for(var t=e.getId(),i=0;i<xxmap.activeInteractions.length;i++)if(xxmap.activeInteractions[i].featureid==t)return xxmap.activeInteractions[i].interaction;return!1}function getModifiedFeature(e){if(e)for(var t=0;t<xxmap.activeInteractions.length;t++)if(xxmap.activeInteractions[t].featureid==e)return xxmap.activeInteractions[t].feature;return null}function removeInteraction(e){for(var t=-1,i=0;i<xxmap.activeInteractions.length;i++)if(xxmap.activeInteractions[i].featureid===e){t=i;break}0<=t&&xxmap.activeInteractions.splice(t,1)}function getCorrespondingFeature(e){for(var t=e.getGeometry().getCoordinates(),i=0;i<xxmap.activeInteractions.length;i++){var o=xxmap.activeInteractions[i].feature,n=o.getGeometry().getCoordinates();if(n[0].toFixed(5)==t[0].toFixed(5)&&n[1].toFixed(5)==t[1].toFixed(5))return o}return null}function refreshMap(e,t){e&&(xxmap.map.setTarget(null),xxmap.map=null,xxmap.markersSource=null,xxmap.mapView=null,xxmap.mapLayer=null,xxmap.activeInteractions=[]);e=updateMapMarkers();if(null!=e&&(t||1==e[4])){for(var t=(e[0]+e[2])/2,i=(e[1]+e[3])/2,o=Math.max(Math.abs(e[0]-e[2]),Math.abs(e[1]-e[3])),e=xxmap.map.getView(),n=(e.setCenter(ol.proj.transform([i,t],"EPSG:4326","EPSG:3857")),360),a=-2;o<n;)a++,n/=2;e.setZoom(a)}}function placeNode(e){if(!xxdialogMode){var t,i='<div style=margin-bottom:6px><label for=selectnode-search>Ricerca</label>&nbsp&nbsp<input type=text placeholder="Nome del dispositivo" id="selectnode-search" onchange=onPlaceNodeInputChange() onkeyup=onPlaceNodeInputChange() autocomplete=off style=width:120px></div><div id=placenode style="height:254px;overflow-y:auto;width:100%;margin:12px 1px 4px 1px;"><div id=noNodesMapPlace style=text-align:center;width:100%;display:none>Nessun dispositivo trovato. </div>';for(t in nodes)i=(i+="<div class=noselect id="+nodes[t]._id+"-rowid onclick=selectNodeToPlace(event,'"+nodes[t]._id+"') style=background-color:lightgray;margin-bottom:4px;border-radius:2px><input name=PlaceMapDeviceCheckbox id="+nodes[t]._id+'-checkid type=checkbox class="form-check-input me-2" style=width:16px;display:inline />')+"<div class=j"+nodes[t].icon+" style=width:16px;height:16px;margin-top:2px;margin-right:4px;display:inline-block></div><div style=width:16px;display:inline>"+nodes[t].name+"</div></div>";setModalContent("xxAddAgent","Seleziona un nodo da posizionare",i+"</div>"),showModal("xxAddAgentModal","idx_dlgOkButton",()=>placeNodeEx(3,e)),onPlaceNodeInputChange()}}function placeNodeEx(e,t){var i,o,n,a,s=document.getElementsByName("PlaceMapDeviceCheckbox");for(i in s)s[i].checked&&(o=getNodeFromId(s[i].id.substring(0,s[i].id.length-8)))&&(n=xxmap.markersSource.getFeatureById(i),a=[(a=ol.proj.transform(t,"EPSG:3857","EPSG:4326"))[1],a[0]],n&&(n.getGeometry().setCoordinates(t),getActiveInteractions(n))?saveMarkerloc(n):meshserver.send({action:"changedevice",nodeid:o._id,userloc:a}))}function onPlaceNodeInputChange(){updatePlaceNodeTable(Q("selectnode-search").value.trim().toLowerCase())}function updatePlaceNodeTable(e){document.getElementsByName("PlaceMapDeviceCheckbox");var t,i=0;for(t in nodes){var o=0<=nodes[t].namel.indexOf(e)||""==e||null!=nodes[t].rnamel&&0<=nodes[t].rnamel.indexOf(e);o&&i++,QV(nodes[t]._id+"-rowid",o)}QV("noNodesMapPlace",0==i)}function selectNodeToPlace(e,t){"PlaceMapDeviceCheckbox"!=e.target.name&&((e=Q(t+"-checkid")).checked=!e.checked);var i,o=document.getElementsByName("PlaceMapDeviceCheckbox"),n=0;for(i in o)o[i].checked&&n++;QE("idx_dlgOkButton",0<n)}function addMeshOptions(e,t){}function meshOptionRmvMod(e,t){}function meshExists(){for(var e in meshes)if(meshes[e])return!0;return!1}function setMeshView(e){var t=Q("select-mesh");t[t.selectedIndex].value==e&&(t[0].selected=!0,onSelectMeshChange())}function clearMeshOptions(){}function getSearchLocation(){try{var e,t=Q("mapSearchLocation").value.trim();0<t.length&&((e=new XMLHttpRequest).onreadystatechange=function(){4==e.readyState&&200==e.status&&formatSearchData(e.responseText)},e.open("GET","https://nominatim.openstreetmap.org/search?q="+t+"&format=json",!0),e.send())}catch(e){}}function formatSearchData(e){try{QH("xmapSearchResults","");for(var t=JSON.parse(e),i=0,o='<div class="xmapItem">',n=0;n<t.length;n++)t[n].display_name&&t[n].boundingbox[0]&&t[n].boundingbox[1]&&t[n].boundingbox[2]&&t[n].boundingbox[3]&&(i++,o+='<div class="xmapItemSel1" onclick=mapGotoSelectedLocation(this)><div>'+t[n].display_name+"</div><div style=display:none>"+t[n].boundingbox[0]+"!#!"+t[n].boundingbox[1]+"!#!"+t[n].boundingbox[2]+"!#!"+t[n].boundingbox[3]+"</div></div>");o+="</div>",1==i?zoomToExtent([parseFloat(t[0].boundingbox[2]),parseFloat(t[0].boundingbox[0]),parseFloat(t[0].boundingbox[3]),parseFloat(t[0].boundingbox[1])]):(0==i&&(o="<div style=width:200px>Nessuna posizione trovata. <div>"),QV("xmapSearchResultsDlg",!0)),QH("xmapSearchResults",o)}catch(e){}}function mapGotoSelectedLocation(e){e=e.children[1].innerHTML.split("!#!");zoomToExtent([parseFloat(e[2]),parseFloat(e[0]),parseFloat(e[3]),parseFloat(e[1])]),mapCloseSearchWindow()}function mapCloseSearchWindow(){QH("xmapSearchResults",""),QV("xmapSearchResultsDlg",!1)}function zoomToLocation(e,t){var i=xxmap.map.getView();i.setCenter(e),i.setZoom(t)}function zoomToFitExtent(){var e;0<xxmap.markersSource.getFeatures().length&&(e=xxmap.markersSource.getExtent(),xxmap.map.getView().fit(e,xxmap.map.getSize()))}function zoomToExtent(e){e=ol.proj.transformExtent(e,ol.proj.get("EPSG:4326"),ol.proj.get("EPSG:3857"));xxmap.map.getView().fit(e,xxmap.map.getSize())}function refreshDevice(e){currentNode&&currentNode._id==e&&gotoDevice(e,xxcurrentView,!0)}32768&features&&(map_cm_popup=new ol.Overlay({element:Q("xmap-info-window"),positioning:"bottom-center",stopEvent:!1}),map_cm_editMarker={text:"Modifica la posizione del nodo ",callback:function(e){modifyMarkerloc(e.data)}},map_cm_clearMarker={text:"Rimuovi la posizione del nodo",callback:function(e){meshserver.send({action:"changedevice",nodeid:e.data.a,userloc:[]})}},map_cm_saveMarker={text:"Salva la posizione del nodo",callback:function(e){saveMarkerloc(e.data)}},map_cm_nodemenu_items=[{text:"Informazione Generale",callback:function(e){null!=e.data&&gotoDevice(e.data,10)}},{text:"Desktop",callback:function(e){null!=e.data&&gotoDevice(e.data,11)}},{text:"Terminale",callback:function(e){null!=e.data&&gotoDevice(e.data,12)}},{text:"Intel&reg; AMT",callback:function(e){null!=e.data&&gotoDevice(e.data,14)}},"-",{text:"Zoom per ingrandire",callback:function(e){zoomToLocation(e.data.getGeometry().getCoordinates(),19)}},{text:"Zoom per ridurre",callback:function(e){zoomToLocation(e.data.getGeometry().getCoordinates(),2)}}],contextmenu_items=[{text:"ricaricare",callback:function(){refreshMap(!0,!0)}},{text:"Zoom per adattare l'estensione ",callback:function(){zoomToFitExtent()}},{text:"Centra la mappa qui",callback:function(e){xxmap.mapView.animate({center:e.coordinate})}},{text:"Posiziona il nodo qui",callback:function(e){placeNode(e.coordinate)}}]);var powerTimelineNode=null,powerTimelineReq=null,powerTimelineUpdate=null,powerTimeline=null,deviceSharesNode=null,deviceSharesReq=null,deviceShares=null;function getCurrentNode(){return currentNode}function gotoDevice(e,t,i,o){if(!o||3!=o.which&&2!=o.button)if(!0!==userinfo.emailVerified&&1==serverinfo.emailcheck&&4294967295!=userinfo.siteadmin)setModalContent("xxAddAgent","Sicurezza dell 'Account",'Impossibile accedere a questa funzione finché non viene verificato un indirizzo e-mail. Questo è necessario per il recupero della password. Vai alla scheda "Il mio account" per modificare e verificare un indirizzo email. '),showModal("xxAddAgentModal","idx_dlgOkButton");else if(262144&features&&0==count2factoraAuths())setModalContent("xxAddAgent","Sicurezza dell 'Account",'Impossibile accedere a questa funzione finché non viene abilitata l\'autenticazione a due fattori. Questo è necessario per una maggiore sicurezza. Vai alla scheda "Il mio account" e guarda la sezione "Sicurezza dell\'account". '),showModal("xxAddAgentModal","idx_dlgOkButton");else if(!o||1!=o.shiftKey&&2!=o.which&&1!=o.button){var n=getNodeFromId(e);if(null!=n){null!=currentNode&&currentNode._id==n._id&&0!=(1&n.conn)||deviceDetailsStatsClear();var a=meshes[n.meshid],s=GetNodeRights(n),z=null==currentNode||currentNode._id!=e;if(!currentNode||currentNode._id!=n._id||1==i){currentNode=n,QV("deskPreConfigScriptContextMenu1",2==currentNode.mtype&&isWindowsNode(currentNode)),QV("deskPreConfigScriptContextMenu2",2==currentNode.mtype&&!isWindowsNode(currentNode)),QV("p10deviceNotify",null!=currentNode.sessions&&(null!=currentNode.sessions.kvm||null!=currentNode.sessions.terminal||null!=currentNode.sessions.files||null!=currentNode.sessions.tcp||null!=currentNode.sessions.udp)),QV("p10deviceStar",1==stars[currentNode._id]),QV("p10deviceHelp",null!=currentNode.sessions&&null!=currentNode.sessions.help),null!=currentNode.sessions&&null!=currentNode.sessions.msg?(QV("p10deviceMsg",!0),QH("p10deviceMsg",Object.keys(currentNode.sessions.msg).length)):QV("p10deviceMsg",!1),QV("p10deviceBattery",!1),null!=currentNode.sessions&&null!=currentNode.sessions.battery?(f="","ac"==(r=currentNode.sessions.battery).state&&(f="Il dispositivo è collegato"),"dc"==r.state&&(f="Il dispositivo è alimentato a batteria"),d="",w=-1,"number"==typeof r.level&&0<=r.level&&r.level<=100&&(d=r.level+"%",5<(w=Math.floor((r.level+10)/25)+1)&&(lvl=5),"ac"==r.state)&&(100==r.level?w=11:w+=5),0<w&&(Q("p10deviceBattery").title=null!=f?f+", "+d:d,QV("p10deviceBattery",!0),Q("p10deviceBattery").className="deviceBatteryLarge deviceBatteryLarge"+w)):QV("p10deviceBattery",!1);var r=EscapeHtml(n.name),l=(0==r.length&&(r="<i>Nessuna </i>"),f=r=0==(4&s)||a.flags&&0!=(2&a.flags)?r:'<span tabindex=0 title="Fare clic qui per modificare il nome del dispositivo lato server" onclick=showEditNodeValueDialog(0) onkeyup="if (event.key == \'Enter\') showEditNodeValueDialog(0)" role="button">'+r+' <i class="fa-solid fa-pencil fa-2xs"/></i></span>',a&&(r+="<span style=color:#AAA;font-size:small> - "+EscapeHtml(a.name)+"</span>"),QH("p10deviceName",r),QH("p11deviceName",r),QH("p12deviceName",r),QH("p13deviceName",r),QH("p14deviceName",r),QH("p15deviceName","Console -"+r),QH("p16deviceName",r),QH("p17deviceName",r),QH("p19deviceName",r),"<table style=width:100%>"),d=(0!=(8&args.hide)&&(l+="<br />"+addDeviceAttribute("Nome",f)),a&&(l+=addDeviceAttribute('<span title="Il nome del gruppo di dispositivi a cui appartiene questo computer.">Gruppo</span>','<a href=# title="Il nome del gruppo di dispositivi a cui appartiene questo computer" onclick=gotoMesh("'+n.meshid+'") style=cursor:pointer>'+EscapeHtml(meshes[n.meshid].name)+"</a>")),null!=n.rname&&n.name!=n.rname&&(l+=addDeviceAttribute('<span title="Il nome di questo computer come impostato nel sistema operativo">Nome del sistema operativo </span>','<span title="Il nome di questo computer come impostato nel sistema operativo">'+EscapeHtml(n.rname)+"</span>")),(0==(1&features)&&4!=n.mtype||3==n.mtype)&&(l+=addDeviceAttribute("Nome host",addLinkConditional(n.host?EscapeHtml(n.host):"<i>Nessuna </i>","showEditNodeValueDialog(1)",4&s))),n.desc?EscapeHtml(n.desc):"<i>Nessuna </i>");if(l+=addDeviceAttribute("Descrizione",0!=(4&s)?"<span onclick=showEditNodeValueDialog(2) style=cursor:pointer>"+d+' <i class="fa-solid fa-pencil fa-xs" role="button"></i></span>':d),4==n.mtype&&(null!=n.portnum&&(l+=addDeviceAttribute("Numero di porta",n.portnum)),null!=n.porttype)&&(l+=addDeviceAttribute("Tipo di porta",n.porttype)),null!=n.agent&&null!=n.agent.id&&3==n.mtype?(4==n.agent.id&&(l+=addDeviceAttribute("Tipo di dispositivo","Windows")),6==n.agent.id&&(l+=addDeviceAttribute("Tipo di dispositivo","Linux")),29==n.agent.id&&(l+=addDeviceAttribute("Tipo di dispositivo","macOS"))):null!=n.agent&&null!=n.agent.id&&null!=n.agent.ver&&(x="",x=n.agent.id<=agentsStr.length?agentsStr[n.agent.id]:agentsStr[0],0!=n.agent.ver&&(x+=" v"+n.agent.ver),14==n.agent.id&&(x=n.agent.core),!1===n.agent.root&&0!=(1&n.conn)&&(x+=", Limitato"),l+=addDeviceAttribute("Agente Mesh",x)),null!=n.intelamt&&(x="",w={0:nobreak("Non attivato (pre) "),1:nobreak("Non attivato (in) "),2:nobreak("Attivato")},null!=n.intelamt.ver&&null==n.intelamt.state?x+="<i>Stato sconosciuto</i>, v"+EscapeHtml(n.intelamt.ver):null==n.intelamt.ver&&2==n.intelamt.state?x+="<i>Attivato</i>":null==n.intelamt.ver||null==n.intelamt.state?x+="<i>Versione e stato sconosciuti </i>":(x+=w[n.intelamt.state],2==n.intelamt.state&&n.intelamt.flags&&(2&n.intelamt.flags?x+=' <span title="Intel&reg; AMT è attivato in modalità di controllo del cliente">CCM</span>':4&n.intelamt.flags&&(x+=' <span title="Intel&reg; AMT è attivato in modalità di controllo amministratore">ACM</span>')),x+=", v"+EscapeHtml(n.intelamt.ver)),2==n.intelamt.state&&(1==n.intelamt.tls&&(x+=', <span title="Intel&reg; AMT è configurato con la sicurezza di rete TLS">TLS</span>'),r=!1,null==n.intelamt.user||""==n.intelamt.user?0!=(4&s)?(x+=', <i style=color:#FF0000;cursor:pointer title="Modifica Intel&reg; Credenziali AMT" onclick=editDeviceAmtSettings("'+n._id+'")>Nessuna credenziale</i>',r=!0):x+=", <i style=color:#FF0000>Nessuna credenziale</i>":0!=(1&features2)&&null!=n.intelamt.warn&&(f=null,0!=(1&n.intelamt.warn)&&(f="Credenziali non valide"),null!=(f=0!=(8&n.intelamt.warn)?"Provare le credenziali":f))&&(0!=(4&s)?(x+=', <i style=color:#FF0000;cursor:pointer title="Modifica Intel&reg; Credenziali AMT" onclick=editDeviceAmtSettings("'+n._id+'")>'+f+"</i>",r=!0):x+=", <i style=color:#FF0000>"+f+"</i>"),x+=" ",r=0!=(4&s)&&0==(1&features2)||r)&&(x+='<img src=images/link4.png height=10 width=10 title="Modifica Intel&reg; Credenziali AMT" style=cursor:pointer onclick=editDeviceAmtSettings("'+n._id+'")>'),d='<span title="Intel&reg; Manageability Engine">Intel&reg; ME<span>',"number"==typeof n.intelamt.sku&&(0!=(8&n.intelamt.sku)?d='<span title="Intel&reg; Active Management Technology">Intel&reg; AMT<span>':0!=(16&n.intelamt.sku)&&(d='<span title="Intel&reg; Standard Manageability">Intel&reg; SM<span>')),l+=addDeviceAttribute(d,x)),null!=n.agent&&null!=n.agent.tag?l+=addDeviceAttribute("Etichetta agente",p=(p=EscapeHtml(n.agent.tag)).startsWith("mailto:")?'<a href="'+EscapeHtml(p)+'">'+EscapeHtml(p.substring(7))+"</a>":p):null!=n.intelamt&&null!=n.intelamt.tag&&(l+=addDeviceAttribute("Intel&reg; Tag AMT",p=(p=EscapeHtml(n.intelamt.tag)).startsWith("mailto:")?'<a href="'+EscapeHtml(p)+'">'+EscapeHtml(p.substring(7))+"</a>":p)),n.osdesc&&(l+=addDeviceAttribute("Sistema operativo",n.osdesc)),n.wsc&&(u=[],null!=n.wsc.antiVirus&&("OK"==n.wsc.antiVirus?u.push("AV - <span style=color:green>OK</span>"):u.push("AV - <span style=color:red>CATTIVO</span>")),null!=n.wsc.autoUpdate&&("OK"==n.wsc.autoUpdate?u.push("Aggiornamenti - <span style=color:green>OK</span>"):u.push("Aggiornamenti - <span style=color:red>CATTIVO</span>")),null!=n.wsc.firewall&&("OK"==n.wsc.firewall?u.push("Firewall - <span style=color:green>OK</span>"):u.push("Firewall - <span style=color:red>CATTIVO</span>")),l+=addDeviceAttribute("Sicurezza di Windows",u.join(", "))),n.defender&&(u=[],null!=n.defender.RealTimeProtection&&(1==n.defender.RealTimeProtection?u.push("RealTimeProtection - <span style=color:green>On</span>"):u.push("RealTimeProtection - <span style=color:red>Spento</span>")),null!=n.defender.TamperProtected&&(1==n.defender.TamperProtected?u.push("TamperProtection - <span style=color:green>On</span>"):u.push("TamperProtection - <span style=color:red>Spento</span>")),0<u.length)&&(l+=addDeviceAttribute("Windows Defender",u.join(", "))),n.av&&0<n.av.length){var c,u=[];for(g in n.av)n.av[g].product&&(c=EscapeHtml(n.av[g].product),!0!==n.av[g].enabled&&(c+=" - <span style=color:red>Disabilitato</span>"),!0!==n.av[g].updated&&(c+=" - <span style=color:red>Scaduto</span>"),1==n.av[g].enabled&&1==n.av[g].updated&&(c+=" - <span style=color:green>OK</span>"),u.push(c));l+=addDeviceAttribute("Antivirus",u.join("<br />"))}n.users&&0<n.users.length&&(w=n.users.map(function(e){return addKeyLinkConditional(EscapeHtml(e),"Bloccato",n.lusers&&0<=n.lusers.indexOf(e))}).join(", "),l+=addDeviceAttribute(1<n.users.length?"Utenti attivi":"Utente attivo",w)),null!=n.agent&&14!=n.agent.id&&3!=n.mtype&&(f=[],r=0,n.consent&&(r=n.consent),serverinfo.consent&&(r|=serverinfo.consent),64&r&&8&r?f.push("Prompt desktop + barra degli strumenti"):64&r?f.push("Barra degli strumenti desktop"):8&r?f.push("Prompt del desktop"):1&r&&f.push("Notifica desktop"),16&r?f.push("Prompt del terminale"):2&r&&f.push("Notifica terminale"),32&r?f.push("Prompt file"):4&r&&f.push("Notifica file"),7==r&&(f=["Avvisa sempre"]),l+=addDeviceAttribute("Consenso dell'utente ",addLinkConditional(f=""==(f=(f=56==(56&r)?["Chiedi sempre"]:f).join(", "))?"<i>Nessuna </i>":f,"p20editmeshconsent(3)",1&s)));var d=[],p=(null!=userinfo.notify&&null!=userinfo.notify[n._id]&&(2&(x=userinfo.notify[n._id])&&d.push("Connetti"),4&x&&d.push("Disconnetti"),null!=n.intelamt&&8&x&&d.push("Intel&reg; AMT"),16384&features2&&userinfo.emailVerified&&(k=0,16&x&&k++,32&x&&k++,64&x&&k++,0<k)&&d.push(format("Email ({0})",k)),null!=userinfo.msghandle)&&0!=(33554432&features2)&&(k=0,128&x&&k++,256&x&&k++,512&x&&k++,0<k)&&d.push(format("Messaging ({0})",k)),l+=addDeviceAttribute("Notifiche ",addLink(d=""==(d=d.join(", "))?"<i>Nessuna </i>":d,"p20editDeviceNotify()")),n.conn),m=(p&&1<p&&(w=[],0!=(1&n.conn)&&w.push("<span title=\"L'agente mesh è connesso e pronto per l'uso.\">Agente Mesh</span>"),0!=(2&n.conn)?w.push('<span title="Intel&reg; AMT CIRA è connesso e pronto per l\'uso.">Intel&reg; AMT CIRA</span>'):0!=(4&n.conn)&&w.push('<span title="Intel&reg; AMT è instradabile e pronto per l\'uso.">Intel&reg; AMT</span>'),0!=(8&n.conn)&&w.push('<span title="L\'agente mesh è raggiungibile utilizzando un altro agente come inoltro.">Inoltro Mesh</span>'),0!=(16&n.conn)&&w.push('<span title="La connessione MQTT al dispositivo è attiva.">MQTT </span>'),l+=addDeviceAttribute("Connettività",w.join(", "))),"<i>Nessuna </i>");if(null!=n.tags)for(var g in m="",n.tags)m+="<span class=tagSpan>"+EscapeHtml(n.tags[g])+"</span> ";l+=addDeviceAttribute("Tags",0!=(4&s)?"<span onclick=showEditNodeValueDialog(3) style=line-height:26px;cursor:pointer>"+m+' <i class="fa-solid fa-pencil fa-xs" role="button"></i></span>':"<span style=line-height:26px>"+m+"</span>"),null==n.ssh&&null==n.rdp||(u=[],0!=(4&s)?(null!=n.ssh&&u.push("<span onclick=showClearSshDialog(3) style=cursor:pointer>"+(1==n.ssh?"Utente SSH+Pass":2==n.ssh?"Utente SSH+Chiave+Pass":"SSH-Utente+Chiave")+' <i class="fa-solid fa-pencil fa-xs" role="button"></i></span>'),null!=n.rdp&&u.push('<span onclick=showClearRdpDialog(3) style=cursor:pointer>RDP <i class="fa-solid fa-pencil fa-xs" role="button"></i></span>')):(null!=n.ssh&&u.push(1==n.ssh?"Utente SSH+Pass":2==n.ssh?"Utente SSH+Chiave+Pass":"SSH-Utente+Chiave"),null!=n.rdp&&u.push("RDP")),l+=addDeviceAttribute("Credenziali",u.join(", ")));var v=[];for(g in meshes)meshes[g].relayid==n._id&&v.push('<a href=# onclick=gotoMesh("'+meshes[g]._id+'") style=cursor:pointer>'+EscapeHtml(meshes[g].name)+"</a>");if(0<v.length&&(l+=addDeviceAttribute('<span title="Gruppi di dispositivi per i quali questo dispositivo è un relè">Relè per</span>',v.join(", "))),l+="</table><br />",0!=(262220&s)&&n.mtype<3&&(null==n.agent||34!=n.agent.id)&&(l+='<input type=button class="btn btn-primary btn-sm me-2" value="Azioni" title="Esegui azioni di accensione sul dispositivo" onclick=deviceActionFunction() />'),l=(l+='<input type=button class="btn btn-primary btn-sm me-2" value="Appunti " title="Visualizza le note su questo dispositivo" onclick=showNotes('+(0==(128&s))+',"'+encodeURIComponentEx(n._id)+'") />')+('<input type=button class="btn btn-primary btn-sm me-2" value="Evento di registro" title="Scrivi un evento per questo dispositivo " onclick=writeDeviceEvent("'+encodeURIComponentEx(n._id)+'") />'),2==n.mtype&&1&p&&0!=(131072&s)&&(l+='<input type=button class="btn btn-primary btn-sm me-2" cmenu=deskPreConfigScriptContextMenu value="Run" title="Esegui comandi su questo dispositivo." onclick=runDeviceCmd("'+encodeURIComponentEx(n._id)+'") />'),4!=n.mtype){if((8&s&&1&p&&0!=(16384&s)||1==n.pmt&&0!=(2&features2))&&(l+='<input type=button class="btn btn-primary btn-sm me-2" value="Messaggio" title="Visualizza un messaggio di testo sul dispositivo remoto" onclick=deviceMessageFunction() />'),(8&s&&1&p&&0!=(16384&s)||1==n.pmt&&0!=(2&features2))&&(l+='<input type=button class="btn btn-primary btn-sm me-2" value="Chat" title="Apri la finestra di chat su questo computer " onclick=deviceChat(event) />'),null!=serverinfo&&null!=serverinfo.altmessenging&&8&s&&1&p)for(var g in serverinfo.altmessenging){var h=serverinfo.altmessenging[g];null!=h.type&&"device"!=h.type||(l+='<input type=button class="btn btn-primary btn-sm me-2" value="'+EscapeHtml(serverinfo.altmessenging[g].name)+'" onclick=altDeviceChat(event,'+g+") />")}!1!==serverinfo.guestdevicesharing&&null!=n.agent&&3&n.agent.caps&&1&p&&524296==(524296&s)&&(4294967295==s||0==(4096&s))?(l+='<input type=button class="btn btn-primary btn-sm me-2" value="Condivisione" title="Crea un collegamento per condividere questo dispositivo con un ospite" onclick=showShareDevice() />',QV("DeskGuestShareButton",!0)):QV("DeskGuestShareButton",!1)}if(4==n.mtype&&1&p&&("PDU"==n.porttype?1==n.pwr?262144&s&&(l+='<input type=button class="btn btn-primary btn-sm me-2" value="Spegni" title="Spegni" onclick=setIpPduState(0) />'):8==n.pwr&&64&s&&(l+='<input type=button class="btn btn-primary btn-sm me-2" value="Accendere" title="Accendere" onclick=setIpPduState(1) />'):8&s&&(l+='<input type=button class="btn btn-primary btn-sm me-2" value="Controllo remoto" title="Controllo remoto" onclick=openIpKvmRemoteControl("'+encodeURIComponentEx(n._id)+'") />')),null!=customui&&null!=customui.devicebuttons)for(var g in customui.devicebuttons)(null==customui.devicebuttons[g].showif||null!=a&&customui.devicebuttons[g].showif==a._id||customui.devicebuttons[g].showif==currentNode._id)&&(l+='<input id="cui:'+g+'" type="button" class="btn btn-primary btn-sm me-2" value="'+customui.devicebuttons[g].name+'" onclick=customUIAction(event,"devicebuttons") />');QH("p10html",l),mainUpdate(256);var r=4294967295==s||0==(65536&s),f=4294967295==s||0==(512&s),x=4294967295==s||0==(1024&s),k=4294967295==s||0==(2048&s),l='<div class="p10html3right">';if(0!=(1&s)&&4!=n.mtype&&(l+='&nbsp;<a href=# onclick=p10showChangeGroupDialog(["'+n._id+'"]) title="Sposta questo dispositivo in un altro gruppo di dispositivi ">Cambia gruppo</a>'),0!=(32768&s)&&(l+='&nbsp;<a href=# onclick=p10showDeleteNodeDialog("'+n._id+'") title="Rimuovi questo dispositivo">Elimina dispositivo</a>'),l+='</div><div class="p10html3left">',n.agent&&3!=n.mtype&&0!=(1048576&s)&&(l+='<a href=# onclick=p10showNodeNetInfoDialog("'+n._id+'") title="Mostra le informazioni sull\'interfaccia di rete del dispositivo">Interfacce</a>&nbsp;'),32768&features&&null!=xxmap&&(l+='<a href=# onclick=p10showNodeLocationDialog("'+n._id+'") title="Mostra informazioni sulla posizione del dispositivo">Posizione</a>&nbsp;'),null==n.agent||14!=n.agent.id&&34!=n.agent.id){if(4294967295!=userinfo.siteadmin&&0!=(128&userinfo.siteadmin)||f&&0!=(8&s)&&null!=n.agent&&14!=n.agent.id&&(l+='<a href=# onclick=p10showMeshCmdDialog(1,"'+n._id+'") title="Router di traffico utilizzato per connettersi a un dispositivo tramite questo server.">MeshCmd</a>&nbsp;'),0!==args.xterm||!n.agent||0==(2&n.agent.caps)||0==(8&s)||4294967295!=s&&0!=(512&s)||(l+='<a href=# onclick=p10openxterm(event,"'+n._id+'") title="Apri terminale XTerm ">XTerm</a>&nbsp;'),(0!=(1&p)||3==n.mtype)&&n.agent&&0!=(8&s)&&(0!=webRelayPort&&(l=(l+='<a href=# cmenu=httpPortContextMenu onclick=p10WebRouter("'+n._id+'",1,'+(n.httpport||80)+")>HTTP"+(n.httpport&&80!=n.httpport?"/"+n.httpport:"")+"</a>&nbsp;")+'<a href=# cmenu=httpsPortContextMenu onclick=p10WebRouter("'+n._id+'",2,'+(n.httpsport||443)+")>HTTPS"+(n.httpsport&&443!=n.httpsport?"/"+n.httpsport:"")+"</a>&nbsp;"),0<n.agent.id&&n.agent.id<5&&("win32"!=navigator.platform.toLowerCase()||null!=serverinfo.devicemeshrouterlinks&&0==serverinfo.devicemeshrouterlinks.rdp||(l+='<a href=# cmenu=altPortContextMenu id=rdpMCRouterLink onclick=p10MCRouter("'+n._id+'",3) title="Richiede l\'installazione di MeshCentral Router.">RDP'+(n.rdpport&&3389!=n.rdpport?"/"+n.rdpport:"")+"</a>&nbsp;")),4<n.agent.id&&("win32"!=navigator.platform.toLowerCase()&&"macintel"!=navigator.platform.toLowerCase()||null!=serverinfo.devicemeshrouterlinks&&0==serverinfo.devicemeshrouterlinks.ssh||(l+='<a href=# cmenu=sshPortContextMenu onclick=p10MCRouter("'+n._id+'",4,'+(n.sshport||22)+') title="Richiede l\'installazione di MeshCentral Router.">SSH'+(n.sshport&&22!=n.sshport?"/"+n.sshport:"")+"</a>&nbsp;"),"win32"!=navigator.platform.toLowerCase()||null!=serverinfo.devicemeshrouterlinks&&0==serverinfo.devicemeshrouterlinks.scp||(l+='<a href=# cmenu=sshPortContextMenu onclick=p10MCRouter("'+n._id+'",5,'+(n.sshport||22)+') title="Richiede l\'installazione di MeshCentral Router.">SCP'+(n.sshport&&22!=n.sshport?"/"+n.sshport:"")+"</a>&nbsp;")),"win32"==navigator.platform.toLowerCase()||"macintel"==navigator.platform.toLowerCase())&&null!=serverinfo.devicemeshrouterlinks&&Array.isArray(serverinfo.devicemeshrouterlinks.extralinks))for(var g in serverinfo.devicemeshrouterlinks.extralinks){var b=serverinfo.devicemeshrouterlinks.extralinks[g],y='"'+b.protocol+'"';doesDeviceMatchFilterTags(n,b.filter)&&("number"==typeof b.protocol?y=b.protocol:"http"==b.protocol?y=1:"https"==b.protocol?y=2:"rdp"==b.protocol?y=3:"ssh"==b.protocol?y=4:"scp"==b.protocol?y=5:"mcrdesktop"==b.protocol?y=6:"mcrfiles"==b.protocol&&(y=7),6!=y&&7!=y||2==n.mtype)&&(l+='<a href=# onclick=p10MCRouter("'+n._id+'",'+y+","+b.port+(b.ip?',"'+b.ip+'"':",null")+","+(b.localport||0)+') title="Richiede l\'installazione di MeshCentral Router.">'+b.name+"</a>&nbsp;")}0==(1&p)&&3!=n.mtype||!n.agent||0==(8&s)||0!=(536870912&features)||(l+='<a href=# cmenu=rfbPortContextMenu id=rfbLink onclick=p10rfb("'+n._id+'") title="Avvia la sessione VNC basata sul Web su questo dispositivo.">Web-VNC</a>&nbsp;'),0==(1&p)&&3!=n.mtype||!n.agent||0==(8&s)||0!=(1073741824&features)||(l+='<a href=# cmenu=altPortContextMenu id=mstscLink onclick=p10mstsc("'+n._id+'") title="Avvia una sessione RDP basata sul Web su questo dispositivo.">Web-RDP</a>&nbsp;'),512&features2&&(0!=(1&p)||3==n.mtype)&&n.agent&&0!=(8&s)&&(l+='<a href=# cmenu=sshPortContextMenu id=sshLink onclick=p10ssh("'+n._id+'") title="Avvia la sessione SSH basata sul Web su questo dispositivo.">Web-SSH</a>&nbsp;'),4294967295==s&&4194304&features&&(l+='<a href=# onclick=p10showMqttLoginDialog("'+n._id+'") title="Ottieni le credenziali di accesso MQTT per questo dispositivo.">Accesso MQTT </a>&nbsp;')}l+="</div><br>",3==n.mtype?(QH("p10html3",""),QH("p10html5",l)):(QH("p10html3",l),QH("p10html5",""));var d=PowerStateStr(n.state),w="",w=(null!=n.agent&&!1===n.agent.root&&(w=', <span title="L\'agente è in esecuzione su un dispositivo remoto con privilegi ridotti.">Limitato</span>'),0!=(1&p)&&(0<d.length&&(d+="<br/>"),4==n.mtype?"PDU"==n.porttype?d+='<span style=font-size:12px title="Porta interruttore collegata">Porta interruttore collegata</span>'+w:d+='<span style=font-size:12px title="Porta IP-KVM collegata">Porta IP-KVM collegata</span>'+w:d+='<span style=font-size:12px title="Agente connesso">Agente connesso</span>'+w),0!=(2&p)?(0<d.length&&(d+="<br/>"),d+='<span style=font-size:12px title="Intel&reg; AMT connesso">Intel&reg; AMT connesso</span>'):0!=(4&p)&&(0<d.length&&(d+="<br/>"),d+='<span style=font-size:12px title="Intel&reg; Rilevato AMT">Intel&reg; Rilevato AMT</span>'),0!=(16&p)&&(0<d.length&&(d+="<br/>"),d+='<span style=font-size:12px title="MQTT connesso ">Canale MQTT collegato </span>'),""==d&&n.lastconnect?d="<span style=font-size:12px>Ultima visualizzazione:<br />"+printDateTime(new Date(n.lastconnect))+"</span>":("PDU"==n.porttype||1<n.pwr&&7!=n.pwr)&&(d+="<br/>"+powerStateStrings[n.pwr]),QH("MainComputerState",d),Q("MainComputerImage").setAttribute("src","images/icons256-"+n.icon+"-1.png"),Q("MainComputerImage").className=n.conn&&0!=n.conn||3==n.mtype?"":"gray",3==n.mtype&&null!=n.agent&&4<n.agent.id&&512&features2&&(n.agent.caps=6),f&&setupTerminal(),x&&setupFiles(),0!=(16&s)),p=(w?setupConsole():15==t&&(t=10),QV("MainDevDesktop",r&&(null==n.agent&&null!=n.intelamt&&("number"!=typeof n.intelamt.sku||0!=(8&n.intelamt.sku))||null!=n.agent&&(null==n.agent.caps||0!=(1&n.agent.caps)||n.intelamt&&2==n.intelamt.state)||3==n.mtype&&(3==n.agent.id||4==n.agent.id))&&(8&s||256&s)),QV("MainDevTerminal",(null==n.agent&&null!=n.intelamt||n.agent&&null==n.agent.caps||n.agent&&0!=(2&n.agent.caps)||n.intelamt&&2==n.intelamt.state)&&8&s&&f),QV("MainDevFiles",null!=n.agent&&null!=n.agent.caps&&0!=(4&n.agent.caps)&&8&s&&x),QV("MainDevInfo",n.mtype<3&&0!=(1048576&s)),QV("MainDevAmt",null!=n.intelamt&&(2==n.intelamt.state||2&n.conn)&&8&s&&k),QV("MainDevConsole",w&&null!=n.agent&&null!=n.agent.caps&&0!=(8&n.agent.caps)&&8&s),QV("MainDevPlugins",!1),QV("p15uploadCore",null!=n.agent&&null!=n.agent.caps&&0!=(16&n.agent.caps)),QH("p15coreName",null!=n.agent&&null!=n.agent.core?n.agent.core:""),null!=n.intelamt&&"number"==typeof n.intelamt.sku&&0!=(16&n.intelamt.sku)?(QH("MainDevAmt","Intel&reg;SM"),QH("p14deviceNamePrefix","Intel&reg; SM")):(QH("MainDevAmt","Intel&reg;AMT"),QH("p14deviceNamePrefix","Intel&reg; AMT")),Q("p14iframe").contentWindow.getCurrentMeshNode()),d=(null!=p&&p._id!=currentNode._id&&Q("p14iframe").contentWindow.disconnect(),0!=(6&n.conn));if(Q("p14iframe").contentWindow.setConnectionState(d),Q("p14iframe").contentWindow.setFrameHeight("650px"),Q("p14iframe").contentWindow.setAuthCallback(updateAmtCredentials),powerTimelineNode!=currentNode._id&&powerTimelineReq!=currentNode._id&&(QH("p10html2",""),powerTimelineReq=currentNode._id,meshserver.send({action:"powertimeline",nodeid:currentNode._id}),meshserver.send({action:"lastconnect",nodeid:currentNode._id}),meshserver.send({action:"getsysinfo",nodeid:currentNode._id}),meshserver.send({action:"getnetworkinfo",nodeid:currentNode._id}),meshserver.send({action:"getNotes",id:currentNode._id}),QH("p17info2","")),deviceSharesNode!=currentNode._id&&deviceSharesReq!=currentNode._id&&(deviceSharesReq=currentNode._id,meshserver.send({action:"deviceShares",nodeid:currentNode._id})),QV("DeskTools",!1),showDeskToolsProcesses(),refreshDeviceEvents(),document.title=currentNode&&10<=xxcurrentView&&xxcurrentView<20?currentNode.name+(a?" - "+a.name:"")+" - "+decodeURIComponent("{{{extitle}}}"):decodeURIComponent("{{{extitle}}}"),z&&(p11clearConsoleMsg(),p12clearConsoleMsg(),p13clearConsoleMsg()),null!=pluginHandler&&(QH("p19headers",""),QH("p19pages",""),pluginHandler.callHook("onDeviceRefreshEnd",e,t,i,o),null!=(r=getstore("_curPluginPage",null)))&&null!=Q("p19ph-"+r)&&pluginHandler.callPluginPage(r,Q("p19ph-"+r)),l="",7&s&&(l+='<button class="btn btn-primary btn-sm me-2" onclick="return p20showAddMeshUserDialog(5)" style=cursor:pointer;margin-right:10px><i class="fa-solid fa-circle-plus"></i> Aggiungi utente</button>',null!=usergroups)){var C=0,M=!1;for(g in usergroups)null==usergroups[g].membershipType&&usergroups[g]._id.split("/")[1]==e.split("/")[1]&&(C++,null==currentNode.links||null==currentNode.links[g])&&(M=!0);0<C&&M&&(l+='<a href=# onclick="return p20showAddMeshUserDialog(6)" style=cursor:pointer;margin-right:10px><i class="fa-solid fa-circle-plus"></i> Aggiungi gruppo utenti</a>')}l+='<table class="table table-hover" border=0 cellpadding=2 cellspacing=0 width=100%><tbody><tr style=background-color:#AAAAAA;font-weight:bold><th scope=col style=text-align:left;width:430px>Autorizzazioni utente </th><th scope=col style=text-align:left></th></tr>';var S=1;if(null!=currentNode.links){var A=[];for(g in currentNode.links)(g.startsWith("user/")||g.startsWith("ugrp/"))&&A.push(g);for(g in A.sort(),A){var D="",T="",E=A[g],N=currentNode.links[E].rights,I=EscapeHtml(E.split("/")[2]),T=makeUserDeviceRightsString(N),N=!1;null!=currentNode.links[E].name&&(I=EscapeHtml(currentNode.links[E].name)),E==userinfo._id&&(I=EscapeHtml(userinfo.name)),null!=users&&null!=users[E]&&(I=EscapeHtml(users[E].name)),null!=usergroups&&null!=usergroups[E]&&(I=EscapeHtml(usergroups[E].name),N=!0),0!=(2&s)&&(T=N?(D="<a href=# onclick='return p30removeUserFromNode(event,\""+encodeURIComponentEx(E)+'")\' title="Rimuovi i diritti del gruppo di utenti su questo gruppo di dispositivi" style=cursor:pointer><i class="fa-solid fa-trash text-danger hoverButton"></i></a>','<span style=cursor:pointer onclick=p20showAddMeshUserDialog(6,"'+encodeURIComponentEx(E)+'")>'+T+" <img class=hoverButton style=cursor:pointer src=images/link5.png></span>"):(D="<a href=# onclick='return p30removeUserFromNode(event,\""+encodeURIComponentEx(E)+'")\' title="Rimuovi i diritti utente su questo gruppo di dispositivi" style=cursor:pointer><i class="fa-solid fa-trash text-danger hoverButton"></i></a>','<span style=cursor:pointer onclick=p20showAddMeshUserDialog(5,"'+encodeURIComponentEx(E)+'")>'+T+" <img class=hoverButton style=cursor:pointer src=images/link5.png></span>")),l+="<tr "+(++S%2==0?"style=background-color:#DDD":"")+'><td style=width:30%><div title="'+(N?"Gruppo di utenti ":"Utente")+'" class=m'+(N?4:2)+"></div><div>&nbsp;"+(I=null!=users?N?"<a href=# onclick='gotoUserGroup(\""+encodeURIComponentEx(E)+"\");haltEvent(event);'>"+I+"</a>":"<a href=# onclick='gotoUser(\""+encodeURIComponentEx(E)+"\");haltEvent(event);'>"+I+"</a>":I)+"<div></div></div></td><td style=width:70%><div style=float:right>"+D+"</div><div>"+T+"</div></td></tr>"}}if(1==S&&(l+="<tr><td><div style=padding:6px>&nbsp;<i>Nessun utente con autorizzazioni speciali per il dispositivo </i><div></div></div></td><td></td></tr>"),l+="</tbody></table>",null!=deviceShares&&deviceSharesNode==currentNode._id&&0<deviceShares.length){l+='<br /><table class="table table-hover" border=0 cellpadding=2 cellspacing=0 width=100%><tbody><tr style=background-color:#AAAAAA;font-weight:bold><th scope=col style=text-align:left;width:430px>Condivisione attiva del dispositivo</th><th scope=col style=text-align:left></th></tr>';for(S=1,g=0;g<deviceShares.length;g++){var _=deviceShares[g],D="",V=(null!=_.url&&(D+='<a href="'+_.url+'" rel="noreferrer noopener" target=_blank title="Collegamento di condivisione del dispositivo" style=cursor:pointer><img src=images/link2.png border=0 height=10 width=10></a> '),D+="<i role=button onclick='return p30removeDeviceSharing(event,\""+encodeURIComponentEx(currentNode._id)+'","'+encodeURIComponentEx(_.publicid)+'","'+encodeURIComponentEx(_.guestName)+'")\' title="Rimuovi la condivisione del dispositivo" class="fa-fw fa-solid fa-trash text-danger"></i>',""),U=(_.p<=7?V=["","Terminale","Desktop","Desktop + Terminale","File","Terminale + File","Desktop + File","Desktop + Terminale + File"][_.p]:8==_.p?V="HTTP/"+_.port:16==_.p&&(V="HTTPS/"+_.port),V),V=(null!=_.startTime&&null!=_.expireTime&&(U=format("{0}, {1} a {2}",V,printFlexDateTime(new Date(_.startTime)),printFlexDateTime(new Date(_.expireTime)))),null!=_.startTime&&null!=_.duration&&(U=_.duration<2?format("{0}, {1} per {2} minuto",V,printFlexDateTime(new Date(_.startTime)),_.duration):format("{0}, {1} per {2} minuti",V,printFlexDateTime(new Date(_.startTime)),_.duration)),1==_.recurring&&(U+=", Ricorrente ogni giorno"),2==_.recurring&&(U+=", Ricorrente settimanale"),0!=(2&_.p)&&!0===_.viewOnly&&(U+=", Visualizza solo desktop"),null!=_.consent&&(0==_.consent?U+=", Nessun consenso":(0!=(56&_.consent)&&(U+=", Richiedi consenso"),0!=(64&_.consent)&&(U+=", Barra degli strumenti"))),EscapeHtml(_.guestName));l+="<tr "+(++S%2==0?"style=background-color:#DDD":"")+"><td style=width:30%><div class=m2></div><div>&nbsp;"+(V=_.publicid.startsWith("AS:node/")?"<i>Auto-condivisione dell'agente</i>":V)+"<div></div></div></td><td style=width:70%><div style=float:right>"+D+"</div><div>"+U+"</div></td></tr>"}l+="</tbody></table>"}QH("p10html4",l);var R="";if(0==(268435456&features)&&10<=xxcurrentView&&xxcurrentView<=19&&null!=currentNode){for(var g in R="?viewmode="+xxcurrentView+"&gotonode="+currentNode._id.split("/")[2],urlargs)R+="&"+g+"="+urlargs[g];try{window.history.replaceState({},document.title,window.location.pathname+R)}catch(e){}}QV("p11DeskSessionSelector",!1),QH("p11DeskSessionSelector","")}setupDesktop(),go(t=t||10)}}else safeNewWindow(window.location.origin+"?node="+e.split("/")[2]+"&viewmode=10&hide=16"+(urlargs.key?"&key="+urlargs.key:""),"meshcentral:"+e)}function setIpPduState(e){0==e?(setModalContent("xxAddAgent","Operazione di potenza","Perform power off?"),showModal("xxAddAgentModal","idx_dlgOkButton",function(){meshserver.send({action:"poweraction",nodeids:[currentNode._id],actiontype:2})})):(setModalContent("xxAddAgent","Operazione di potenza","Perform power on?"),showModal("xxAddAgentModal","idx_dlgOkButton",function(){meshserver.send({action:"wakedevices",nodeids:[currentNode._id]})}))}function p20editDeviceNotify(){var e,t,i;return xxdialogMode||(e=0,t=16384&features2&&userinfo.emailVerified?1:0,userinfo.notify&&userinfo.notify[currentNode._id]&&(e=userinfo.notify[currentNode._id]),i='<div style="border-bottom: 1px solid #888;margin-bottom:3px">Notifiche della pagina web</div><div><label><input id=p20notifyIntelDeviceConnect type=checkbox class="form-check-input me-2" />Connessioni del dispositivo</label></div><div><label><input id=p20notifyIntelDeviceDisconnect type=checkbox class="form-check-input me-2" />Disconnessioni del dispositivo</label></div>',null!=currentNode.intelamt&&(t+=2,i+='<div><label><input id=p20notifyIntelAmtKvmActions type=checkbox class="form-check-input me-2" />Intel&reg; Desktop AMT e eventi seriali</label></div>'),1&t&&(i+='<br /><div style="border-bottom: 1px solid #888;margin-bottom:3px">notifiche di posta elettronica</div><div><label><input id=p20enotifyIntelDeviceConnect type=checkbox class="form-check-input me-2" />Connessioni del dispositivo</label></div><div><label><input id=p20enotifyIntelDeviceDisconnect type=checkbox class="form-check-input me-2" />Disconnessioni del dispositivo</label></div><div><label><input id=p20enotifyIntelDeviceHelp type=checkbox class="form-check-input me-2" />Help requests</label></div>'),null!=userinfo.msghandle&&0!=(33554432&features2)&&(i+='<br /><div style="border-bottom: 1px solid #888;margin-bottom:3px">Messaging Notifications</div><div><label><input id=p20emsgDeviceConnect type=checkbox class="form-check-input me-2" />Connessioni del dispositivo</label></div><div><label><input id=p20emsgDeviceDisconnect type=checkbox class="form-check-input me-2" />Disconnessioni del dispositivo</label></div><div><label><input id=p20emsgDeviceHelp type=checkbox class="form-check-input me-2" />Help requests</label></div>'),setModalContent("xxAddAgent","Impostazioni di notifica",i),showModal("xxAddAgentModal","idx_dlgOkButton",()=>p20editDeviceNotifyEx(3,t)),Q("p20notifyIntelDeviceConnect").checked=2&e,Q("p20notifyIntelDeviceDisconnect").checked=4&e,2&t&&(Q("p20notifyIntelAmtKvmActions").checked=8&e),1&t&&(Q("p20enotifyIntelDeviceConnect").checked=16&e,Q("p20enotifyIntelDeviceDisconnect").checked=32&e,Q("p20enotifyIntelDeviceHelp").checked=64&e),null!=userinfo.msghandle&&0!=(33554432&features2)&&(Q("p20emsgDeviceConnect").checked=128&e,Q("p20emsgDeviceDisconnect").checked=256&e,Q("p20emsgDeviceHelp").checked=512&e)),!1}function p20editDeviceNotifyEx(e,t){var i=0,i=(i+=Q("p20notifyIntelDeviceConnect").checked?2:0)+(Q("p20notifyIntelDeviceDisconnect").checked?4:0);2&t&&(i+=Q("p20notifyIntelAmtKvmActions").checked?8:0),1&t&&(i=(i=(i+=Q("p20enotifyIntelDeviceConnect").checked?16:0)+(Q("p20enotifyIntelDeviceDisconnect").checked?32:0))+(Q("p20enotifyIntelDeviceHelp").checked?64:0)),null!=userinfo.msghandle&&0!=(33554432&features2)&&(i=(i=(i+=Q("p20emsgDeviceConnect").checked?128:0)+(Q("p20emsgDeviceDisconnect").checked?256:0))+(Q("p20emsgDeviceHelp").checked?512:0)),meshserver.send({action:"changeusernotify",nodeid:currentNode._id,notify:i})}function makeUserDeviceRightsString(e){var t,i;return 57592==e?"Diritti completi sul dispositivo":(t=[],8&e&&(i=[],256&e&&i.push("Nessun ingresso "),512&e&&i.push("Nessun terminale "),1024&e&&i.push("Nessun file"),2048&e&&i.push("Nessun AMT "),4096&e&&i.push("Input limitato"),65536&e&&i.push("Nessun desktop"),524288&e&&!1!==serverinfo.guestdevicesharing&&i.push("Condivisione degli ospiti"),t.push(0<i.length?"Control ("+i.join(", ")+")":"Controllo")),16&e&&t.push("Console"),32&e&&t.push("File del server"),64&e&&t.push("sveglia"),128&e&&t.push("Appunti "),8192&e&&t.push("Eventi limite"),16384&e&&t.push("Chat"),32768&e&&t.push("Disinstalla"),131072&e&&t.push("Comandi"),262144&e&&t.push("Ripristina/Spento"),524288&e&&t.push("Condivisione"),1048576&e&&t.push("Dettagli"),2097152&e&&t.push("Ritrasmissioni"),0==t.length?"Nessun diritto":t.join(", "))}function makeDeviceGroupRightsString(e){var t,i;return 4294967295==e?"Pieni diritti":(t=[],1&e&&t.push("Modifica gruppo"),2&e&&t.push("Gestisci utenti"),4&e&&t.push("Gestisci dispositivi"),8&e&&(i=[],256&e&&i.push("Nessun ingresso "),512&e&&i.push("Nessun terminale "),1024&e&&i.push("Nessun file"),2048&e&&i.push("Nessun AMT "),4096&e&&i.push("Input limitato"),65536&e&&i.push("Nessun desktop"),524288&e&&!1!==serverinfo.guestdevicesharing&&i.push("Condivisione degli ospiti"),t.push(0<i.length?"Control ("+i.join(", ")+")":"Controllo")),16&e&&t.push("Console"),32&e&&t.push("File del server"),64&e&&t.push("sveglia"),128&e&&t.push("Appunti "),8192&e&&t.push("Eventi limite"),16384&e&&t.push("Chat"),32768&e&&t.push("Disinstalla"),131072&e&&t.push("Comandi"),262144&e&&t.push("Ripristina/Spento"),524288&e&&t.push("Condivisione"),1048576&e&&t.push("Dettagli"),2097152&e&&t.push("Ritrasmissioni"),0==t.length?"Nessun diritto":t.join(", "))}function runDeviceCmd(e){xxdialogMode||d2runCommandDialog({nodeids:[e?decodeURIComponent(e):currentNode._id]})}function writeDeviceEvent(e){xxdialogMode||(setModalContent("xxAddAgent","Aggiungi evento dispositivo","<textarea id=d2devEvent style=width:100%;height:200px;resize:none;overflow-y:scroll></textarea><span style=font-size:10px>Questo aggiungerà una voce al registro eventi di questo dispositivo.<span>"),showModal("xxAddAgentModal","idx_dlgOkButton",function(){writeDeviceEventEx(3,e)}),Q("d2devEvent").focus())}function writeDeviceEventEx(e,t){meshserver.send({action:"setDeviceEvent",nodeid:decodeURIComponent(t),msg:encodeURIComponentEx(Q("d2devEvent").value)})}function showNotes(e,t){xxdialogMode||(e="<textarea id=d2devNotes ro="+e+" noteid="+(t=null==t?encodeURIComponentEx("p"+userinfo._id):t)+' readonly class="form-control" style=width:100%;height:200px;resize:none;overflow-y:scroll></textarea>',t.startsWith("node%2F%2F")&&(e+="<span style=font-size:10px>Le note del gruppo di dispositivi possono essere visualizzate e modificate da altri amministratori del gruppo di dispositivi.<span>"),"true"===showNotesPanel&&(e+=" <span style=font-size:10px><a target=_blank href='https://www.markdownguide.org/cheat-sheet/'>Markdown syntax supported</a></span>"),setModalContent("xxAddAgent","Appunti ",e),showModal("xxAddAgentModal","idx_dlgOkButton",function(){showNotesEx(2,t)}),meshserver.send({action:"getNotes",id:decodeURIComponent(t)}))}function showNotesEx(e,t){Q("notesPanelArea").innerHTML=marked&&DOMPurify?DOMPurify.sanitize(marked.parse(Q("d2devNotes").value,{breaks:!0}),{USE_PROFILES:{html:!0}}):Q("d2devNotes").value,meshserver.send({action:"setNotes",id:decodeURIComponent(t),notes:encodeURIComponentEx(Q("d2devNotes").value)}),"true"===showNotesPanel&&""!=Q("d2devNotes").value?QV("notesPanel",!0):QV("notesPanel",!1)}function openIpKvmRemoteControl(e){xxdialogMode||safeNewWindow("/ipkvm.ashx/"+(e=decodeURIComponent(e).split("/")[2])+"/","ipkvm:"+e)}function deviceChat(e){var t;xxdialogMode||(t="/messenger?id=meshmessenger/"+encodeURIComponentEx(currentNode._id)+"/"+encodeURIComponentEx(userinfo._id)+"&title="+currentNode.name,""!=serverinfo.domainsuffix&&(t="/"+serverinfo.domainsuffix+t),null!=authCookie&&""!=authCookie&&(t+="&auth="+authCookie),1==currentNode.pmt&&0!=(2&features2)&&(t+="&pmt=1"),e&&1==e.shiftKey?safeNewWindow(t,"meshmessenger:"+currentNode._id):safeNewWindow(t,"meshmessenger:"+currentNode._id,"directories=no,titlebar=no,toolbar=no,location=no,status=no,menubar=no,scrollbars=no,resizable=no,width=400,height=560"),meshserver.send({action:"meshmessenger",nodeid:decodeURIComponent(currentNode._id)}))}function altDeviceChat(e,t){var i,o,n,a,s,r;xxdialogMode||(i=serverinfo.altmessenging[t].url.split("{0}").join(currentNode._id.split("/")[2]).split("{1}").join(currentNode._id.split("/")[2]).split("{2}").join(currentNode._id.split("/")[2]).split("{3}").join(currentNode._id.split("/")[2]),a=o=encodeURIComponentEx(userinfo._id.split("/")[2]),s=n=encodeURIComponentEx(userinfo._id.split("/").join("-")),null!=userinfo.realname&&(a=encodeURIComponentEx(userinfo.realname.split(" ").join("")),s=encodeURIComponentEx(userinfo.realname.split(" ").join("-"))),r=i=i.split("{4}").join(o).split("{5}").join(n).split("{6}").join(a).split("{7}").join(s),"string"==typeof serverinfo.altmessenging[t].localurl&&(r=(r=serverinfo.altmessenging[t].localurl.split("{0}").join(currentNode._id.split("/")[2]).split("{1}").join(currentNode._id.split("/")[2]).split("{2}").join(currentNode._id.split("/")[2]).split("{3}").join(currentNode._id.split("/")[2])).split("{4}").join(o).split("{5}").join(n).split("{6}").join(a).split("{7}").join(s)),""!=i&&meshserver.send({action:"msg",type:"openUrl",nodeid:currentNode._id,url:i}),""!=r&&safeNewWindow(r,"altmessenger:"+currentNode._id,"directories=no,titlebar=no,toolbar=no,location=no,status=no,menubar=no,scrollbars=no,resizable=no,width=400,height=560"))}function deviceToggleBackground(){xxdialogMode||meshserver.send({action:"msg",type:"deskBackground",nodeid:currentNode._id,op:1})}function deviceUrlFunction(){xxdialogMode||(xxdialogButtons=3,setModalContent("xxAddAgent","Apri pagina sul dispositivo ",'<input id=d2devurl placeholder="http://server.com" style=width:100%;overflow-y:scroll onkeyup=deviceUrlFunctionValidate() onchange=deviceUrlFunctionValidate()></input>'),showModal("xxAddAgentModal","idx_dlgOkButton",deviceUrlFunctionEx),Q("d2devurl").focus(),deviceUrlFunctionValidate())}function deviceUrlFunctionValidate(){var e=Q("d2devurl").value.toLowerCase();QE("idx_dlgOkButton",e.startsWith("http://")&&7<e.length||e.startsWith("https://")&&8<e.length)}function deviceUrlFunctionEx(){meshserver.send({action:"msg",type:"openUrl",nodeid:currentNode._id,url:Q("d2devurl").value})}function deviceMessageFunction(){xxdialogMode||(xxdialogButtons=3,setModalContent("xxAddAgent","Messaggio del dispositivo","<div style=margin-bottom:4px>Visualizza una finestra di messaggio sul dispositivo remoto.</div><textarea id=d2devMessage style=width:100%;height:80px;resize:none;overflow-y:scroll;box-sizing:border-box;margin-bottom:4px></textarea><select style=width:100% id=d2devTimeout><option value=2 selected>Show for 2 Minutes (Default)</option><option value=10>Show for 10 minutes</option><option value=30>Show for 30 minutes</option><option value=60>Show for 60 minutes</option><option value=0>Mostra messaggio fino a quando non viene respinto dall'utente</option></select>"),showModal("xxAddAgentModal","idx_dlgOkButton",deviceMessageFunctionEx),Q("d2devMessage").focus())}function deviceMessageFunctionEx(){var e=decodeURIComponent("{{{extitle}}}"),t=parseFloat(Q("d2devTimeout").value);""==e&&(e="MeshCentral"),isNaN(t)&&(t=2),1==currentNode.pmt?meshserver.send({action:"pushmessage",nodeid:currentNode._id,title:e,msg:Q("d2devMessage").value}):meshserver.send({action:"msg",type:"messagebox",nodeid:currentNode._id,title:e,msg:Q("d2devMessage").value,timeout:6e4*t})}function deskClipboardInFunction(){var e;null!=desktop&&3==desktop.State&&(desktop.m.getClipboard?null!=(e=desktop.m.getClipboard())&&null!=navigator.clipboard&&navigator.clipboard.writeText(e).then(function(){}).catch(function(e){console.log(e)}):meshserver.send({action:"msg",type:"getclip",nodeid:currentNode._id,tag:2}))}function deskInputLockFunction(e){xxdialogMode||null==desktop||3!=desktop.State||(setModalContent("xxAddAgent","Blocco ingresso remoto",1==e?"Bloccare il mouse e la tastiera dell'utente remoto?":"Sbloccare il mouse e la tastiera dell'utente remoto?"),showModal("xxAddAgentModal","idx_dlgOkButton",function(){try{desktop.m.SendRemoteInputLock(e)}catch(e){}}))}function deskClipboardOutFunction(){if(null!=navigator.clipboard&&null!=navigator.clipboard.readText)try{navigator.clipboard.readText().then(function(e){desktop.m.setClipboard?desktop.m.setClipboard(e):meshserver.send({action:"msg",type:"setclip",nodeid:currentNode._id,data:e})}).catch(function(e){console.log(e)})}catch(e){console.log(e)}return!0}function deskRefreshFunction(){null!=desktop&&3==desktop.State&&desktop.m.SendRefresh()}function deviceToastFunction(){xxdialogMode||(xxdialogButtons=3,setModalContent("xxAddAgent","Notifica del dispositivo",'<select id=d2deviceop style=width:100%;margin-bottom:4px class=form-select><option value=2>Notifica di tipo toast</option><option value=1>Casella dei messaggi</option><option value=3>Alert Box</option></select><input id=dp2notifyTitle maxlength=256 placeholder="Titolo" style=width:100%;box-sizing:border-box;margin-bottom:4px class=form-control/><textarea id=d2notifyMsg style=background-color:#fcf3cf;width:100%;height:140px;resize:none;overflow-y:scroll;box-sizing:border-box;margin-bottom:4px class=form-control></textarea><select style=width:100% id=d2notifyTimeout class=form-select><option disabled value="">Only Applicable to Message Box Notifications</option><option value=2 selected>Show for 2 Minutes (Default)</option><option value=10>Show for 10 minutes</option><option value=30>Show for 30 minutes</option><option value=60>Show for 60 minutes</option><option value=0>Mostra messaggio fino a quando non viene respinto dall\'utente</option></select>'),showModal("xxAddAgentModal","idx_dlgOkButton",deviceToastFunctionEx),Q("d2notifyMsg").focus())}function deviceToastFunctionEx(){var e=Q("d2deviceop").value,t=Q("dp2notifyTitle").value,i=Q("d2notifyMsg").value,o=parseFloat(Q("d2notifyTimeout").value);0!=i.length&&(""==(t=""==t?decodeURIComponent("{{{extitle}}}"):t)&&(t="MeshCentral"),isNaN(o)&&(o=2),1==e?meshserver.send({action:"msg",type:"messagebox",nodeid:currentNode._id,title:t,msg:i,timeout:6e4*o}):2==e?meshserver.send({action:"toast",nodeids:[currentNode._id],title:t,msg:i}):3==e&&meshserver.send({action:"msg",type:"alertbox",nodeid:currentNode._id,title:t,msg:i}))}function deviceLockFunction(){null==xxdialogMode&&null!=desktop&&1==desktop.contype&&(setModalContent("xxAddAgent","Blocca desktop","Bloccare il desktop dell'utente?"),showModal("xxAddAgentModal","idx_dlgOkButton",function(){null!=desktop&&1==desktop.contype&&desktop.sendCtrlMsg('{"ctrlChannel":"102938","type":"lock"}')}))}function showShareDevice(){if(!xxdialogMode){var e,t=GetNodeRights(currentNode),i="",o="Crea un collegamento che consente a un ospite senza account di controllare in remoto questo dispositivo per un tempo limitato.<br /><br />",n=(o+=addHtmlFormFloating("Nome dell'ospite",'<input id=d2inviteName class="form-control" maxlength=128 type=text onkeyup=showShareDeviceValidate() />'),"<option value=2>Desktop</option>"),a=(4294967295!=t&&0!=(256&t)&&(n=""),"<option value=1>Terminale</option>"),s=(4294967295!=t&&0!=(512&t)&&(a=""),"<option value=4>File</option>"),r=(4294967295!=t&&0!=(1024&t)&&(s=""),"<option value=5>Desktop + File</option>"),l=(4294967295!=t&&0!=(1280&t)&&(r=""),"<option value=6>Terminale + File</option>"),d=(4294967295!=t&&0!=(1536&t)&&(l=""),"<option value=7>Desktop + Terminale + File</option>"),c=(4294967295!=t&&0!=(1792&t)&&(d=""),""),i=(0!=webRelayPort&&(c="<option value=8>HTTP</option><option value=9>HTTPS</option>",4294967295!=t)&&0!=(8&t)&&(c=""),""),u="",p=(1==(1&currentNode.agent.caps)&&(i+=n+"<option value=3>Desktop, solo visualizzazione</option>"),2==(2&currentNode.agent.caps)&&(i+=a),4==(4&currentNode.agent.caps)&&(i+=s),5==(5&currentNode.agent.caps)&&(i+=r),6==(6&currentNode.agent.caps)&&(i+=l),7==(7&currentNode.agent.caps)&&(i+=d),o+=addHtmlFormFloating("Digita",'<select id=d2shareType class="form-select" onchange=showShareDeviceValidate()>'+(i+=c)+"</select>"),{1:"1 minuto",5:"5 minuti",10:"10 minuti",15:"15 minuti",30:"30 minuti",45:"45 minuti",60:"60 minuti",120:"2 ore",240:"4 ore",480:"8 ore",720:"12 ore",960:"16 ore",1440:"24 ore",2880:"2 giorni",5760:"4 giorni",0:"Illimitato"});for(e in i="",p)(null==serverinfo.guestdevicesharingmaxtime||0<e&&e<=serverinfo.guestdevicesharingmaxtime)&&(i+="<option value="+e+">"+p[e]+"</option>"),0<e&&e<=720&&(null==serverinfo.guestdevicesharingmaxtime||0<e&&e<=serverinfo.guestdevicesharingmaxtime)&&(u+="<option value="+e+">"+p[e]+"</option>");o=(o=(o=(o=(o=o+addHtmlFormFloating("Validità ",'<select id=d2timeRange class="form-select" onchange=showShareDeviceValidate()><option value=0>A partire da adesso</option><option value=1>Intervallo di tempo</option><option value=2>Quotidiano ricorrente</option><option value=3>Settimanale ricorrente</option></select>')+"<div id=d2modenow>")+addHtmlFormFloating("Scadenza",'<select id=d2inviteExpire class="form-select">'+i+"</select>")+"</div><div id=d2moderange style=display:none>")+addHtmlFormFloating("Intervallo di tempo",'<input id=d2timeRangeSelector class="flatpickr form-select" type="text" placeholder="Seleziona data e ora..." data-id="altinput">')+"</div><div id=d2moderecurring style=display:none>")+addHtmlFormFloating("Ora di inizio",'<input id=d2timeStartSelector class="flatpickr form-select" type="text" placeholder="Seleziona data e ora..." data-id="altinput">'))+addHtmlFormFloating("Durata",'<select id=d2inviteDuration class="form-select">'+u+"</select>")+"</div>",1&currentNode.agent.caps&&(o+="<div id=d2userConsentSelector>"+addHtmlFormFloating("Consenso dell'utente ",'<select id=d2userConsent class="form-select"><option value=0>Solo notifica <option value=1>Richiedi il consenso</option><option value=2>No Consent</option></select>')+"</div>"),o=(o+="<div id=d2httpPortSelector>"+addHtmlFormFloating("Port",'<input id=d2httpPort class="form-control" value=80 onkeyup=showShareDeviceValidate()></input>')+"</div>")+("<div id=d2httpsPortSelector>"+addHtmlFormFloating("Port",'<input id=d2httpsPort class="form-control" value=443 onkeyup=showShareDeviceValidate()></input>')+"</div>"),xxdialogButtons=3,setModalContent("xxAddAgent","Condividi dispositivo",o),showModal("xxAddAgentModal","idx_dlgOkButton",showShareDeviceEx),showShareDeviceValidate();t=new Date,n=(t.setDate(t.getDate()+1),flatpickr("#d2timeRangeSelector",{mode:"range",enableTime:!0,minDate:new Date,defaultDate:[new Date,t],minuteIncrement:1})),a=flatpickr("#d2timeStartSelector",{enableTime:!0,minDate:new Date,defaultDate:new Date,minuteIncrement:1});xxdialogTag={range:n,start:a}}}function showShareDeviceValidate(){1&currentNode.agent.caps&&QV("d2userConsentSelector",Q("d2shareType").value<8),QV("d2httpPortSelector",8==Q("d2shareType").value),QV("d2httpsPortSelector",9==Q("d2shareType").value),QV("d2modenow",0==Q("d2timeRange").value),QV("d2moderange",1==Q("d2timeRange").value),QV("d2moderecurring",2<=Q("d2timeRange").value);var e,t=!0;8==Q("d2shareType").value&&(e=parseInt(Q("d2httpPort").value),Q("d2httpPort").value!=e||e<1||65535<e)&&(t=!1),9==Q("d2shareType").value&&(e=parseInt(Q("d2httpsPort").value),Q("d2httpsPort").value!=e||e<1||65535<e)&&(t=!1),0==Q("d2inviteName").value.trim().length&&(t=!1),QE("idx_dlgOkButton",t)}function showShareDeviceEx(e,t){var i=0,o=parseInt(Q("d2shareType").value),n=!1;8==o?meshserver.send({action:"createDeviceShareLink",nodeid:currentNode._id,guestname:Q("d2inviteName").value.trim(),p:8,expire:parseInt(Q("d2inviteExpire").value),port:parseInt(Q("d2httpPort").value),consent:0}):9==o?meshserver.send({action:"createDeviceShareLink",nodeid:currentNode._id,guestname:Q("d2inviteName").value.trim(),p:16,expire:parseInt(Q("d2inviteExpire").value),port:parseInt(Q("d2httpsPort").value),consent:0}):(3==o&&(n=!0),1&(o=[0,1,2,2,4,6,5,7][o])&&(i|=2,1&currentNode.agent.caps&&1==Q("d2userConsent").value&&(i|=16),1&currentNode.agent.caps)&&2==Q("d2userConsent").value&&(i=0),2&o&&(i|=65,1&currentNode.agent.caps&&1==Q("d2userConsent").value&&(i|=8),1&currentNode.agent.caps)&&2==Q("d2userConsent").value&&(i=0),4&o&&(i|=4,1&currentNode.agent.caps&&1==Q("d2userConsent").value&&(i|=32),1&currentNode.agent.caps)&&2==Q("d2userConsent").value&&(i=0),0==Q("d2timeRange").value?meshserver.send({action:"createDeviceShareLink",nodeid:currentNode._id,guestname:Q("d2inviteName").value.trim(),p:o,expire:parseInt(Q("d2inviteExpire").value),consent:i,viewOnly:n}):1==Q("d2timeRange").value?meshserver.send({action:"createDeviceShareLink",nodeid:currentNode._id,guestname:Q("d2inviteName").value.trim(),p:o,start:Math.floor(t.range.selectedDates[0].getTime()/1e3),end:Math.floor(t.range.selectedDates[1].getTime()/1e3),consent:i,viewOnly:n}):meshserver.send({action:"createDeviceShareLink",nodeid:currentNode._id,guestname:Q("d2inviteName").value.trim(),p:o,start:Math.floor(t.start.selectedDates[0].getTime()/1e3),expire:parseInt(Q("d2inviteDuration").value),recurring:Q("d2timeRange").value-1,consent:i,viewOnly:n}))}function deviceActionFunction(){var e,t,i,o,n;xxdialogMode||(e=GetNodeRights(currentNode),t=0,i="Seleziona un'operazione da eseguire su questo dispositivo.<br /><br />",o="<select id=d2deviceop onchange=deviceActionFunctionValidate() class=form-select>",n="",null!=currentNode.agent&&14==currentNode.agent.id?0!=(1&currentNode.conn)&&0!=(8&e)&&(t++,o+="<option value=400>Lampeggia</option><option value=401>Vibrare</option>",n+="<div id=d2devicetimediv>"+addHtmlFormFloating("Tempo","<select id=d2devicetime class=form-select><option value=1000>1 secondo</option><option value=5000>5 secondi</option><option value=10000>10 secondi</option></select>")+"</div>"):(0!=(64&e)&&(t++,o+="<option value=100>Risveglio</option>"),0!=(1&currentNode.conn)&&0!=(131072&e)&&(t++,o+="<option value=106>Esegui comandi</option>"),0!=currentNode.conn&&0!=(262144&e)&&(t++,o+="<option value=4>Standby</option><option value=3>Ripristina</option><option value=2>Spegni</option>"),0!=(16&currentNode.conn)&&(t++,o+="<option value=103>Invia messaggio MQTT</option>"),null!=currentNode.intelamt&&2==currentNode.intelamt.state&&0!=(6&currentNode.conn)&&0!=(262144&e)&&(t++,o+="<option value=310>Intel&reg; Ripristino AMT</option><option value=308>Intel&reg; Spegnimento AMT</option>",11!=xxcurrentView&&12!=xxcurrentView||(o+="<option value=312>Intel&reg; AMT Reset to BIOS</option><option value=311>Intel&reg; AMT Power on to BIOS</option><option value=315>Intel&reg; AMT Power on to PXE</option><option value=316>Intel&reg; AMT Reset to PXE</option>")),null!=currentNode.intelamt&&2==currentNode.intelamt.state&&0!=(6&currentNode.conn)&&0!=(64&e)&&(t++,o+="<option value=302>Intel&reg; Accensione AMT</option>"),(11==xxcurrentView||12==xxcurrentView)&&15<=getNodeAmtVersion(currentNode)&&2==currentNode.intelamt.state&&0!=(6&currentNode.conn)&&4294967295==e&&0==(1024&features)&&(t++,o+="<option value=107>Intel&reg; AMT Recupero con un clic</option>"),0!=(1&currentNode.conn)&&0!=(32768&e)&&(t++,o+="<option value=104>Disinstalla agente</option>")),i+=addHtmlFormFloating("operazione",o+="</select>"),xxdialogButtons=0==t?2:3,xxdialogTag=(i=0==t?"Nessuna azione attualmente disponibile per questo dispositivo.":i)+n,setModalContent("xxAddAgent","Azione del dispositivo",i),showModal("xxAddAgentModal","idx_dlgOkButton",deviceActionFunctionEx),0<t&&deviceActionFunctionValidate())}function deviceActionFunctionValidate(){var e=Q("d2deviceop").value;try{QV("d2devicetimediv",400==e||401==e)}catch(e){}}function deviceActionFunctionEx(){var e=Q("d2deviceop").value;if(100==e)return meshserver.send({action:"wakedevices",nodeids:[currentNode._id]}),!0;if(103==e)p10showSendMqttMsgDialog([currentNode._id]);else if(104==e)p10showSendUninstallAgentDialog([currentNode._id]);else if(106==e){var t,i=!1,o=!1;currentNode.agent&&(0<currentNode.agent.id&&currentNode.agent.id<5?i=!0:o=!0),1!=i&&1!=o||(t="Esegui comandi sui dispositivi selezionati.<br />",1==i&&(t+="<select id=d2cmdtype style=width:100%;margin-bottom:4px;margin-top:4px><option value=1>Windows Command Prompt</option><option value=2>Windows PowerShell</option>",1==o&&(t+="<option value=3>Shell dei comandi Linux / BSD / macOS</option>"),t+="</select>"),setModalContent("xxAddAgent","Esegui comandi",t=t+"<select id=d2cmduser style=width:100%;margin-bottom:4px><option value=0>Esegui come agente</option><option value=1>Esegui come utente, agente se nessun utente</option><option value=2>Deve essere eseguito come utente </option></select>"+"<textarea id=d2runcmd style=width:100%;height:200px;resize:none;overflow-y:scroll></textarea>"),showModal("xxAddAgentModal","idx_dlgOkButton",()=>deviceRunCmdsFunctionEx()),Q("d2runcmd").focus())}else if(107==e)Q("d3localmodeform").action="oneclickrecovery.ashx",Q("d3auth").value=authCookie,Q("d3filter").value=".efi",Q("d3attrib").value=currentNode._id,setModalContent("xxAddAgent","Intel&reg; AMT Recupero con un clic",t),showModal("xxAddAgentModal","idx_dlgOkButton",()=>deviceActionOneClickRecovery()),d3init();else if(302==e)setModalContent("xxAddAgent","Intel&reg; AMT Power Operation","Esegui Intel&reg; AMT acceso?"),showModal("xxAddAgentModal","idx_dlgOkButton",function(){meshserver.send({action:"poweraction",nodeids:[currentNode._id],actiontype:parseInt(e)})});else if(308==e)setModalContent("xxAddAgent","Intel&reg; AMT Power Operation","Perform Intel&reg; AMT power off?<br><br><b>NOTE: If there is an active AMT session, then power off command will be rejected, so you must disconnect from the AMT session first!</b>"),showModal("xxAddAgentModal","idx_dlgOkButton",function(){meshserver.send({action:"poweraction",nodeids:[currentNode._id],actiontype:parseInt(e)})});else if(310==e)setModalContent("xxAddAgent","Intel&reg; AMT Power Operation","Esegui Intel&reg; AMT resettato?"),showModal("xxAddAgentModal","idx_dlgOkButton",function(){meshserver.send({action:"poweraction",nodeids:[currentNode._id],actiontype:parseInt(e)})});else{if(311==e)setModalContent("xxAddAgent","Intel&reg; AMT Power Operation","Perform Intel&reg; AMT power on to BIOS?");else{if(312!=e)return 400==e||401==e?meshserver.send({action:"poweraction",nodeids:[currentNode._id],actiontype:parseInt(e),time:parseInt(Q("d2devicetime").value)}):meshserver.send({action:"poweraction",nodeids:[currentNode._id],actiontype:parseInt(e)}),!0;setModalContent("xxAddAgent","Intel&reg; AMT Power Operation","Perform Intel&reg; AMT reset to BIOS?")}showModal("xxAddAgentModal","idx_dlgOkButton",function(){meshserver.send({action:"poweraction",nodeids:[currentNode._id],actiontype:parseInt(e)+(12==xxcurrentView?2:0)})})}return!1}function deviceActionOneClickRecovery(){var e;1==Q("d3uploadMode").value?Q("d3submit").click():1==(e=d3getFileSel()).length&&meshserver.send({action:"oneclickrecovery",nodeids:[Q("d3attrib").value],type:"diskimage",path:d3filetreelocation.join("/")+"/"+e[0]})}function deviceRunCmdsFunctionEx(){var e=3;try{e=parseInt(Q("d2cmdtype").value)}catch(e){}meshserver.send({action:"runcommands",nodeids:[currentNode._id],type:e,cmds:Q("d2runcmd").value,runAsUser:parseInt(Q("d2cmduser").value)})}function updateAmtCredentials(e){var t=getNodeFromId(currentNode._id);1==e||null==t.intelamt.user||""==t.intelamt.user?editDeviceAmtSettings(currentNode._id,updateAmtCredentialsEx):Q("p14iframe").contentWindow.connectButtonfunctionEx()}function updateAmtCredentialsEx(e,t){Q("p14iframe").contentWindow.connectButtonfunctionEx()}function updateDeviceTimeline(){2==meshserver.State&&null!=powerTimelineNode&&null!=powerTimelineUpdate&&null!=currentNode&&3!=currentNode.mtype&&powerTimelineNode==powerTimelineReq&&currentNode._id==powerTimelineNode&&powerTimelineUpdate<Date.now()&&(powerTimelineUpdate=null,meshserver.send({action:"powertimeline",nodeid:currentNode._id}),meshserver.send({action:"lastconnect",nodeid:currentNode._id}))}function drawDeviceTimeline(){if(!(null==currentNode||xxcurrentView<10||19<xxcurrentView||3==currentNode.mtype||"true"===hidePowerTimeline)){var e=null,t=Date.now(),i=(currentNode._id==powerTimelineNode&&(e=powerTimeline),new Date),o=(i.setHours(0,0,0,0),(i=new Date(i.getTime()-5184e5)).getTime(),[]);if(null!=e&&1<e.length){o.push([0,e[1],e[0]]);for(var n=e[1],a=2;a<e.length;a+=2){var s=e[a],r=t;e.length>a+1&&(r=e[a+1]),o.push([n,n+r,s]),n+=r}}var l="",d=1,c=new Date,u=Q("column_l").offsetWidth-192;c.setHours(0,0,0,0);for(a=0;a<7;a++){var p,m="",g=c.getTime(),v=g+864e5;for(p in o){var h,f,x,k=o[p];1==isTimeBlockInside(g,v,k[0],k[1])&&(x=Math.max(g,k[0]),h=Math.min(Math.min(v,k[1]),t),0<(f=Math.round((h-x)*u/864e5)))&&(x=format("{0} da {1} a {2}.",powerStateStrings2[k[2]],printTime(new Date(x)),printTime(new Date(h))),m+='<div class="pwState '+powerColor(k[2])+'" title="'+x+'" style="width:'+f+'px;"></div>')}l+="<tr class="+(d%2==0?"altBack":"")+"><td><div>&nbsp;"+printDate(c)+"<div></div></div></td><td><div>"+m+"</div></td></tr>",++d,c=new Date(c.getFullYear(),c.getMonth(),c.getDate()-1)}i="";try{i="&tz="+encodeURIComponentEx(Intl.DateTimeFormat().resolvedOptions().timeZone)}catch(e){}QH("p10html2",'<table class="table table-striped align-middle text-center" cellpadding=2 cellspacing=0><thead><tr><th scope=col style=width:150px>Giorno</th><th scope=col>stato di alimentazione negli ultimi 7 giorni<div class="float-end pe-1"><i role="button" onclick=downloadFile("devicepowerevents.ashx?id='+currentNode._id+"&tf="+(new Date).getTimezoneOffset()+"&l="+encodeURIComponentEx(getLang())+i+(urlargs.key?"&key="+urlargs.key:"")+'",null,true) title="Scarica eventi di potenza" class="fa-solid fa-download"></i></div></th></tr></thead><tbody>'+l+"</tbody></table>")}}function powerColor(e){return e<powerColorTable.length?powerColorTable[e]:"pwsYellow"}function isTimeBlockInside(e,t,i,o){return i<e&&t<o||e<i&&i<t||e<o&&o<t}function addDeviceAttribute(e,t,i=[]){return`<div class="row mb-1"><div class="${i[0]||"col col-md-2 col-lg-2"}"><b> ${e} </b></div><div class="${i[1]||"col col-md-10 col-lg-10"}"> ${t} </div></div>`}function editDeviceAmtSettings(e,t,i){var o,n,a;xxdialogMode||(o="",n=getNodeFromId(e),a=3,0!=(4&GetNodeRights(n))&&(o=(o+=addHtmlFormFloating("Nome utente",'<input id=dp10username class="form-control" maxlength=32 autocomplete=nope placeholder="admin" onchange=validateDeviceAmtSettings() onkeyup=validateDeviceAmtSettings() />'))+addHtmlFormFloating("Password",'<input id=dp10password type=password class="form-control" autocomplete=nope maxlength=32 onchange=validateDeviceAmtSettings() onkeyup=validateDeviceAmtSettings() />'),0==(1&features2)&&(o+=addHtmlFormFloating("Sicurezza",'<select id=dp10tls class="form-select"><option value=0>Nessuna sicurezza TLS </option><option value=1>Sicurezza TLS richiesta</option></select>')),null!=n.intelamt.user&&""!=n.intelamt.user&&(a=7),setModalContent("xxAddAgent","Modifica Intel&reg; Credenziali AMT",o),showModal("xxAddAgentModal","idx_dlgOkButton",()=>editDeviceAmtSettingsEx(a,{node:n,func:t,arg:i})),null!=n.intelamt.user&&""!=n.intelamt.user?Q("dp10username").value=n.intelamt.user:Q("dp10username").value="admin",0==(1&features2)&&(Q("dp10tls").value=n.intelamt.tls),validateDeviceAmtSettings()))}function validateDeviceAmtSettings(){QE("idx_dlgOkButton",passwordcheck(Q("dp10password").value))}function editDeviceAmtSettingsEx(e,t){var i;2==e?meshserver.send({action:"changedevice",nodeid:t.node._id,intelamt:{user:"",pass:""}}):(""==(e=Q("dp10username").value)&&(e="admin"),i=Q("dp10password").value,e={action:"changedevice",nodeid:t.node._id,intelamt:{user:e=""==i?"":e,pass:i}},0==(1&features2)&&(e.intelamt.tls=parseInt(Q("dp10tls").value)),meshserver.send(e),t.func&&setTimeout(function(){t.func(null,t.arg)},1e3))}function p10showSendMqttMsgDialog(e){var t;return xxdialogMode||(t=addHtmlFormFloating("Argomento",'<input id=dp2topic class="form-control" maxlength=64 onchange=p10validateSendMqttMsgDialog() onkeyup=p10validateSendMqttMsgDialog(event,1) />'),setModalContent("xxAddAgent","Invia messaggio MQTT",t+=addHtmlFormFloating("Messaggio",'<textarea id=dp2msg class="form-control" maxlength=4096 style=width:100%;height:150px;resize:none onchange=p10validateSendMqttMsgDialog() onkeyup=p10validateSendMqttMsgDialog(event,1)></textarea>')),showModal("xxAddAgentModal","idx_dlgOkButton",()=>p10showSendMqttMsgDialogEx(3,e)),p10validateSendMqttMsgDialog(),Q("dp2topic").focus()),!1}function p10validateSendMqttMsgDialog(){QE("idx_dlgOkButton",0<Q("dp2topic").value.length&&0<Q("dp2msg").value.length)}function p10showSendMqttMsgDialogEx(e,t){meshserver.send({action:"sendmqttmsg",nodeids:t,topic:Q("dp2topic").value,msg:Q("dp2msg").value}),uncheckAllDevices()}function p10showSendUninstallAgentDialog(e){var t;return xxdialogMode||(t="",t=1<e.length?format("Sei sicuro di voler disinstallare gli agenti {0} selezionati?",e.length):"Sei sicuro di voler disinstallare l'agente selezionato?",setModalContent("xxAddAgent","Disinstalla agente",t=(t+="<br /><br />")+(1<e.length?"Ciò non rimuoverà i dispositivi dal server, ma i dispositivi non saranno più in grado di connettersi al server.Tutti gli accessi remoti ai dispositivi andranno persi.I dispositivi devono essere collegati affinché questo comando funzioni.":"Questo non rimuoverà questo dispositivo dal server, ma il dispositivo non sarà più in grado di connettersi al server.Tutti gli accessi remoti al dispositivo andranno persi.Il dispositivo deve essere connesso affinché questo comando funzioni.")+'<br /><br /><label style=color:red><input id=p10check type=checkbox class="form-check-input me-2" onchange=p10validateDeleteNodeDialog() />Confermare</label>'),showModal("xxAddAgentModal","idx_dlgOkButton",()=>p10showSendUninstallAgentDialogEx(3,e)),p10validateSendUninstallAgentDialog()),!1}function p10validateSendUninstallAgentDialog(){QE("idx_dlgOkButton",Q("p10check").checked)}function p10showSendUninstallAgentDialogEx(e,t){meshserver.send({action:"uninstallagent",nodeids:t}),uncheckAllDevices()}function p10showChangeGroupDialog(e){if(!xxdialogMode){var t=null;if(1==e.length)try{t=meshes[getNodeFromId(e[0]).meshid]._id}catch(e){}var i,o,n='<select id=p10newGroup class="form-select">',a=0,s=[];for(i in meshes){var r=GetMeshRights(i);meshes[i]._id!=t&&4&r&&s.push(meshes[i])}for(i in s.sort(nameSort),s)a++,n+="<option value='"+s[i]._id+"'>"+s[i].name+"</option>";n+="</select>",0<a?(o=1==e.length?"Seleziona un nuovo gruppo per questo dispositivo<br /><br />":"Seleziona un nuovo gruppo per i dispositivi selezionati<br /><br />",setModalContent("xxAddAgent","Cambia gruppo",o+=addHtmlFormFloating("Nuovo gruppo di dispositivi ",n)),showModal("xxAddAgentModal","idx_dlgOkButton",()=>p10showChangeGroupDialogEx(3,e))):(setModalContent("xxAddAgent","Cambia gruppo","No other device group of same type exists."),showModal("xxAddAgentModal","idx_dlgOkButton"))}return!1}function p10showChangeGroupDialogEx(e,t){meshserver.send({action:"changeDeviceMesh",nodeids:t,meshid:Q("p10newGroup").value}),uncheckAllDevices()}function p10showDeleteNodeDialog(e){var t;return xxdialogMode||(t=format("Sei sicuro di voler eliminare il nodo {0}?",EscapeHtml(currentNode.name))+'<br /><br /><label><input id=p10check type=checkbox class="form-check-input me-2" onchange=p10validateDeleteNodeDialog() />Confermare</label>',xxdialogButtons=3,xxdialogTag=e,setModalContent("xxAddAgent","Elimina nodo",t),showModal("xxAddAgentModal","idx_dlgOkButton",()=>p10showDeleteNodeDialogEx(0,e)),p10validateDeleteNodeDialog()),!1}function p10validateDeleteNodeDialog(){QE("idx_dlgOkButton",Q("p10check").checked)}function p10showDeleteNodeDialogEx(e,t){meshserver.send({action:"removedevices",nodeids:[t]})}function p10WebRouter(e,t,i,o){var n=null,a=getNodeFromId(e),s=(3==a.mtype&&(s=meshes[a.meshid])&&s.relayid&&(n=s.relayid,o=a.host),serverinfo.name),a=(-1!=s.indexOf(".")&&0==(2&features)||(s=window.location.hostname),"https://"+(s=""!=webRelayDns?webRelayDns:s)+":"+webRelayPort+"/control-redirect.ashx?n="+e+"&p="+i+"&appid="+t+"&c="+authRelayCookie);return null!=o&&(a+="&addr="+o),null!=n&&(a+="&relayid="+n),safeNewWindow(a,"WebRelay"),!1}function p10MCRouter(e,t,i,o,n){var a=getNodeFromId(e),s=meshes[a.meshid];return 3==t&&null==i&&(i=null!=a.rdpport?a.rdpport:3389),3==a.mtype&&s&&s.relayid&&(e=s.relayid,o=a.host),meshserver.send({action:"getcookie",nodeid:e,tcpport:i,ip:o,tag:"MCRouter",protocol:t,localport:n,name:s?s.name:null}),!1}function p10rfb(e,t){var i=getNodeFromId(e),o=null,n=meshes[i.meshid];null==t&&(t=null!=i.rfbport?i.rfbport:5900),3==i.mtype&&n&&n.relayid&&(e=n.relayid,o=i.host),meshserver.send({action:"getcookie",nodeid:e,tcpport:t,tcpaddr:o,tag:"novnc",name:n?n.name:null})}function p10mstsc(e,t){var i=getNodeFromId(e),o=meshes[i.meshid];null==t&&(t=null!=i.rdpport?i.rdpport:3389),meshserver.send({action:"getcookie",nodeid:e,tcpport:t,tag:"mstsc",name:o?o.name:null})}function p10ssh(e,t){var i=getNodeFromId(e),o=meshes[i.meshid];null==t&&(t=null!=i.sshport?i.sshport:22),meshserver.send({action:"getcookie",nodeid:e,tcpport:t,tag:"ssh",name:o?o.name:null})}var d2map=null;function p10showNodeLocationDialog(){if(null!=xxdialogMode&&"@xxmap"==xxdialogTag)setDialogMode(0);else if(xxdialogMode)return!1;function g(e){var t,i,o,n,a=[],s=["iploc","wifiloc","gpsloc","userloc"],r=null;for(t in s)null!=currentNode[s[t]]&&(o=currentNode[s[t]].split(","),i=parseFloat(o[0]),o=parseFloat(o[1]),i<90)&&-90<i&&o<180&&-180<o&&((n=new ol.Feature({geometry:new ol.geom.Point(ol.proj.fromLonLat([o,i]))})).setStyle(markerStyle(currentNode,parseInt(t)+1)),a.push(n),null==r?r=[i,o,i,o,0]:(i<r[0]&&(r[0]=i),o<r[1]&&(r[1]=o),i>r[2]&&(r[2]=i),o>r[3]&&(r[3]=o)));var l=new ol.source.Vector({features:a}),l=new ol.layer.Vector({source:l}),d=0,c=0,u=8;if(null!=r)for(var c=(r[0]+r[2])/2,d=(r[1]+r[3])/2,p=Math.max(Math.abs(r[0]-r[2]),Math.abs(r[1]-r[3])),m=360,u=-2;p<m;)u++,m/=2;1==a.length&&(u=8),d2map=new ol.Map({target:"d2map",interactions:ol.interaction.defaults({dragPan:!1,mouseWheelZoom:!1}),layers:[new ol.layer.Tile({source:new ol.source.OSM}),l],view:new ol.View({center:ol.proj.fromLonLat([d,c]),zoom:u})}),document.getElementById("xxAddAgentModal").removeEventListener("shown.bs.modal",g)}document.getElementById("xxAddAgentModal").addEventListener("shown.bs.modal",g);return xxdialogTag="@xxmap",setModalContent("xxAddAgent","Posizione del dispositivo","<div id=d2map style=width:100%;height:300px></div>"),showModal("xxAddAgentModal","idx_dlgOkButton"),!1}function p10showNodeNetInfoDialog(){return xxdialogMode||(xxdialogButtons=1,xxdialogTag="if"+currentNode._id,setModalContent("xxAddAgent","Interfacce di rete ","<div id=d2netinfo>Caricamento in corso...</div>"),showModal("xxAddAgentModal","idx_dlgOkButton"),meshserver.send({action:"getnetworkinfo",nodeid:currentNode._id})),!1}function p10showMeshRouterDialog(){var e,t;xxdialogMode||(e="<div>MeshCentral Router è uno strumento Windows per la mappatura delle porte TCP. È possibile, ad esempio, RDP in un dispositivo remoto tramite questo server.</div><br />",e=(e+='<div class="row mb-1"><div class="col-md-4"><b>Win32 Executable</b></div><div class="col-md-8"><a style="cursor:pointer" onclick="downloadFile(\'meshagents?meshaction=winrouter'+(urlargs.key?"&key="+urlargs.key:"")+'\',null,true)" class="link-primary">MeshCentralRouter.exe</a></div></div>')+'<div class="row mb-1"><div class="col-md-4"><b>MacOS Installer</b></div><div class="col-md-8"><a style="cursor:pointer" onclick="downloadFile(\'meshagents?meshaction=macrouter'+(urlargs.key?"&key="+urlargs.key:"")+'\',null,true)" class="link-primary">MeshCentralRouter.dmg</a></div></div>',-1!=(t=serverinfo.name).indexOf(".")&&0==(2&features)||(t=window.location.hostname),domainUrl.substring(0,domainUrl.length-1),setModalContent("xxAddAgent","Router MeshCentral",e=(e+='<br /><div class="alert alert-info">Esegui MeshCentral Router e fai clic su "installa" per renderlo avviabile dal browser.</div>')+('<br /><a style=cursor:pointer target="mcrouterframe" rel="noreferrer noopener" href="'+("mcrouter://"+t+(443==serverinfo.port?"":":"+serverinfo.port)+domainUrl+"control.ashx?c="+authCookie+"&t="+serverinfo.tlshash+"&l={{{lang}}}"+(urlargs.key?"&key="+urlargs.key:""))+'"><input type=button style=width:100%;cursor:pointer value="Avvia MeshCentral Router" class="btn btn-primary btn-block" /></a>')+'<iframe class="d-none" name="mcrouterframe"></iframe>'),showModal("xxAddAgentModal","idx_dlgOkButton",function(){p20showAddMeshUserDialogEx(1,"fileDownload")}))}function p10showMqttLoginDialog(e){meshserver.send({action:"getmqttlogin",nodeid:e})}function p10openxterm(e,t){haltEvent(e);var e="/xterm?nodeid="+encodeURIComponentEx(t)+"&auto=1",i=getNodeFromId(t);if(null!=i)return 0<=[1,2,3,4,21,22].indexOf(i.agent.id)?e+="&os=win":e+="&os=linux",urlargs.key&&(e+="&key="+urlargs.key),safeNewWindow(e,"xterm:"+t),!1}function p10showMeshCmdDialog(e,t){var i;xxdialogMode||(i="",0==e&&(i+="<div>MeshCmd è uno strumento da riga di comando che esegue molte operazioni diverse. Il file di azione può essere facoltativamente scaricato e modificato per fornire le informazioni e le credenziali del server.<br /><br />"),1==e&&(i+='<div>Scarica "meshcmd" con un file di azione per instradare il traffico attraverso questo server a questo dispositivo. Assicurati di modificare meshaction.txt e aggiungi la password del tuo account o apporta le modifiche necessarie.<br /><br />'),i=(i+=addHtmlFormFloating("Sistema operativo","<select id=aginsSelect onclick=meshCmdOsClick() class=form-select><option value=4>Windows x86 (64bit)</option><option value=3>Windows x86 (32bit)</option><option value=43>Windows ARM (64bit)</option><option value=6>Linux x86 (64bit)</option><option value=5>Linux x86 (32bit)</option><option value=16>macOS x86 (64bit)</option><option value=29>macOS ARM (64bit)</option><option value=25>Linux ARM, Raspberry Pi (32bit)</option><option value=26>Linux ARM, Raspberry Pi (64bit)</option></select>"))+addHtmlValue("MeshCmd",'<a id=meshcmddownloadid onclick=downloadFile("meshagents?meshcmd=3'+(urlargs.key?"&key="+urlargs.key:"")+'") class=link-primary></a>'),0==e&&(i+=addHtmlValue("File delle azioni",'<a onclick=downloadFile("meshagents?meshaction=generic'+(urlargs.key?"&key="+urlargs.key:"")+'") class=link-primary>MeshAction (.txt)</a>')),1==e&&(i+=addHtmlValue("File delle azioni",'<a onclick=downloadFile("meshagents?meshaction=route&nodeid='+t+(urlargs.key?"&key="+urlargs.key:"")+'") class=link-primary>MeshAction (.txt)</a>')),xxdialogButtons=9,xxdialogMode="fileDownload",setModalContent("xxAddAgent","Scarica MeshCmd",i+="</div>"),showModal("xxAddAgentModal","idx_dlgOkButton"),meshCmdOsClick())}function meshCmdOsClick(){var e=Q("aginsSelect").value,t="";3==e&&(t="MeshCmd (Win x86-32 executable)"),4==e&&(t="MeshCmd (Win x86-64 executable)"),43==e&&(t="MeshCmd (Win ARM-64 executable)"),5==e&&(t="MeshCmd (Linux x86, 32bit)"),6==e&&(t="MeshCmd (Linux x86, 64bit)"),16==e&&(t="MeshCmd (macOS, x86-64bit)"),29==e&&(t="MeshCmd (macOS, ARM-64bit)"),25==e&&(t="MeshCmd (Linux ARM, 32bit)"),26==e&&(t="MeshCmd (Linux ARM, 64bit)"),QH("meshcmddownloadid",t),Q("meshcmddownloadid").onclick=function(){downloadFile("meshagents?meshcmd="+e+(urlargs.key?"&key="+urlargs.key:""))}}function p10showiconselector(){xxdialogMode||0!=(4&GetNodeRights(currentNode))&&(setModalContent("xxAddAgent","Selezione dell'icona",'<div style=text-align:center><br /><div tabindex=0 style="display:inline-block;margin:0 10px 0 10px" class=i1 onclick=p10setIcon(1) onkeypress="if (event.key==\'Enter\') p10setIcon(1)"></div><div tabindex=0 style="display:inline-block;margin:0 10px 0 10px" class=i2 onclick=p10setIcon(2) onkeypress="if (event.key==\'Enter\') p10setIcon(2)"></div><div tabindex=0 style="display:inline-block;margin:0 10px 0 10px" class=i3 onclick=p10setIcon(3) onkeypress="if (event.key==\'Enter\') p10setIcon(3)"></div><div tabindex=0 style="display:inline-block;margin:0 10px 0 10px" class=i4 onclick=p10setIcon(4) onkeypress="if (event.key==\'Enter\') p10setIcon(4)"></div><br /><div tabindex=0 style="display:inline-block;margin:0 10px 0 10px" class=i5 onclick=p10setIcon(5) onkeypress="if (event.key==\'Enter\') p10setIcon(5)"></div><div tabindex=0 style="display:inline-block;margin:0 10px 0 10px" class=i6 onclick=p10setIcon(6) onkeypress="if (event.key==\'Enter\') p10setIcon(6)"></div><div tabindex=0 style="display:inline-block;margin:0 10px 0 10px" class=i7 onclick=p10setIcon(7) onkeypress="if (event.key==\'Enter\') p10setIcon(7)"></div><div tabindex=0 style="display:inline-block;margin:0 10px 0 10px" class=i8 onclick=p10setIcon(8) onkeypress="if (event.key==\'Enter\') p10setIcon(8)"></div><br /><br /></div>'),showModal("xxAddAgentModal","idx_dlgOkButton"),QV("id_dialogclose",!0))}function p10setIcon(e){setDialogMode(0),meshserver.send({action:"changedevice",nodeid:currentNode._id,icon:e})}function showClearSshDialog(){setModalContent("xxAddAgent","Modifica dispositivo","Clear SSH credentials?"),showModal("xxAddAgentModal","idx_dlgOkButton",()=>showClearSshDialogEx(3))}function showClearSshDialogEx(e,t){meshserver.send({action:"changedevice",nodeid:currentNode._id,ssh:0})}function showClearRdpDialog(){setModalContent("xxAddAgent","Modifica dispositivo","Clear RDP credentials?"),showModal("xxAddAgentModal","idx_dlgOkButton",()=>showClearRdpDialogEx(3))}function showClearRdpDialogEx(e,t){meshserver.send({action:"changedevice",nodeid:currentNode._id,rdp:0})}var desktopNode,showEditNodeValueDialog_modes=["Nome del dispositivo","Nome host","Descrizione","Tags"],showEditNodeValueDialog_modes2=["name","host","desc","tags"],showEditNodeValueDialog_modes3=["","","","Tag1, Tag2, Tag3"],showEditNodeValueDialog_modes4=[64,64,64,4096];function showEditNodeValueDialog(e){if(!xxdialogMode){var t="",i="",o=currentNode[showEditNodeValueDialog_modes2[e]];if(null==o&&(o=""),3==e){var t='<select id=dp10devicevalue multiple class="form-control" maxlength='+showEditNodeValueDialog_modes4[e]+" class=form-control>",n=[];for(s in nodes)if(nodes[s].tags)for(var a in nodes[s].tags)-1==n.indexOf(nodes[s].tags[a])&&n.push(nodes[s].tags[a]);if(0<n.length)for(var s in n.sort(),n){EscapeHtml(n[s]);i+=Array.isArray(o)&&-1!==o.indexOf(n[s])?"<option selected=selected>"+EscapeHtml(n[s])+"</option>":"<option>"+EscapeHtml(n[s])+"</option>"}setModalContent("xxAddAgent","Edit Tags",t+=i+"</select>"),$("#dp10devicevalue").select2({theme:"bootstrap-5",width:$(this).data("width")?$(this).data("width"):$(this).hasClass("w-100")?"100%":"style",placeholder:showEditNodeValueDialog_modes3[e],closeOnSelect:!1,allowClear:!0,tokenSeparators:[","],tags:!0})}else setModalContent("xxAddAgent","Modifica dispositivo",t=addHtmlFormFloating(showEditNodeValueDialog_modes[e],'<input id=dp10devicevalue class="form-control" maxlength='+showEditNodeValueDialog_modes4[e]+' placeholder="'+showEditNodeValueDialog_modes3[e]+'" onchange=p10editdevicevalueValidate('+e+",event) onkeyup=p10editdevicevalueValidate("+e+",event) class=form-control/>")),Array.isArray(o)&&(o=o.join(", ")),Q("dp10devicevalue").value=o,showModal("xxAddAgentModal","idx_dlgOkButton",function(){showEditNodeValueDialogEx(3,e)});p10editdevicevalueValidate(),showModal("xxAddAgentModal","idx_dlgOkButton",function(){showEditNodeValueDialogEx(3,e)}),Q("dp10devicevalue").focus()}}function showEditNodeValueDialogAddTag(e){var t,i=Q("dp10devicevalue").value.split(","),o=[];for(t in i)o.push(i[t].trim());0<=o.indexOf(e)||(Q("dp10devicevalue").value+=(0==Q("dp10devicevalue").value.length?"":", ")+decodeURIComponent(e),setTimeout(function(){Q("dp10devicevalue").selectionStart=Q("dp10devicevalue").selectionEnd=9e4},0),p10editdevicevalueValidate())}function showEditNodeValueDialogEx(e,t){var i="",o={action:"changedevice",nodeid:currentNode._id};if(3==t){var n,a=$("#dp10devicevalue").select2("data");for(n in a)i+=a[n].text.trim()+", ";o[showEditNodeValueDialog_modes2[t]]=decodeURIComponent(i.slice(0,-2))}else o[showEditNodeValueDialog_modes2[t]]=Q("dp10devicevalue").value;meshserver.send(o)}function p10editdevicevalueValidate(e,t){e=1<e||0<Q("dp10devicevalue").value.length;QE("idx_dlgOkButton",e),null!=t&&1==e&&13==t.keyCode&&dialogclose(1)}function setupDesktop(){var e,t;desktopNode!=currentNode&&null!=desktop&&desktopNode._id!=currentNode._id&&(desktop.Stop(),desktop=desktopNode=null),desktopNode==currentNode&&null!=desktop||(null!=(e=multiDesktop[currentNode._id])?(QH("DeskParent",""),(t=e.m.CanvasId).setAttribute("id","Desk"),t.setAttribute("onmousedown","dmousedown(event)"),t.setAttribute("onmouseup","dmouseup(event)"),t.setAttribute("onmousemove","dmousemove(event)"),t.removeAttribute("onclick"),Q("DeskParent").appendChild(t),(desktop=e).m.SendCompressionLevel&&desktop.m.SendCompressionLevel(desktopsettings.agentencoding,desktopsettings.quality,desktopsettings.scaling,desktopsettings.framerate),desktop.onStateChanged=onDesktopStateChange,desktop.onMetadataChange=function(e){updateMetadata(desktop,"deskmetadata")},0!=(8192&features2)&&(desktop.m.stopInput=!0),desktop&&desktop.m.mouseCursorActive&&desktop.m.mouseCursorActive(!0),QV("DeskInputLockedButton",1==desktop.m.RemoteInputLock),QV("DeskInputUnLockedButton",0==desktop.m.RemoteInputLock),desktop.m.onRemoteInputLockChanged=function(e,t){QV("DeskInputLockedButton",t),QV("DeskInputUnLockedButton",!t)},desktop.m.onKeyboardStateChanged=function(e,t){QS("p11numlock").display=1&t?"inline-block":"none",QS("p11scrolllock").display=2&t?"inline-block":"none",QS("p11capslock").display=4&t?"inline-block":"none"},desktopNode=currentNode,onDesktopStateChange(desktop,desktop.State),delete multiDesktop[currentNode._id]):(null==desktop&&QH("DeskParent",'<canvas id=Desk oncontextmenu="return false" onmousedown=dmousedown(event) onmouseup=dmouseup(event) onmousemove=dmousemove(event)></canvas>'),desktopNode=currentNode),Q("Desk").addEventListener("DOMMouseScroll",function(e){return dmousewheel(e)}),Q("Desk").addEventListener("mousewheel",function(e){return dmousewheel(e)})),desktopNode=currentNode,desktop&&(desktop.m.onDisplayinfo=deskDisplayInfo)(desktop.m,desktop.m.displays,desktop.m.selectedDisplay),updateDesktopButtons(),deskAdjust(),updateMetadata(desktop,"deskmetadata")}function updateDesktopButtons(){var e=0,t=(null!=desktop&&(e=desktop.State),GetNodeRights(currentNode)),i=1==currentNode.agent?1:2,i=(QV("disconnectbutton1span",0!=e),QV("connectbutton1span",0==e&&(8&t||256&t)&&null!=currentNode.agent&&1&currentNode.agent.caps),QV("connectbutton1rspan",0==(1073741824&features)&&0==e&&8&t&&null!=currentNode.agent&&(3==currentNode.agent.id||4==currentNode.agent.id)),1==i?QV("connectbutton1hspan",0==e&&8&t&&null!=currentNode.intelamt&&2==currentNode.intelamt.state):QV("connectbutton1hspan",0==e&&8&t&&null!=currentNode.intelamt&&2==currentNode.intelamt.state&&null!=currentNode.intelamt.ver&&(null==currentNode.intelamt.sku||"number"==typeof currentNode.intelamt.sku&&0!=(8&currentNode.intelamt.sku))),QV("td7amtkvm",!(null==currentNode.intelamt||"number"==typeof currentNode.intelamt.sku&&0!=(16&currentNode.intelamt.sku)||null==currentNode.intelamt.ver&&null!=currentNode.agent||0!=e&&2!=desktop.contype)),QV("td7meshkvm",webRtcDesktop||null!=currentNode.agent&&1&currentNode.agent.caps&&(0==e||1==desktop.contype)),QV("td7rdpkvm",!(null==currentNode.agent||3!=currentNode.agent.id&&4!=currentNode.agent.id||0!=e&&4!=desktop.contype)),0==(8192&features2)&&(null==currentNode.agent||14!=currentNode.agent.id)&&(4294967295==t||0!=(8&t)&&0==(256&t)&&0==(4096&t))),o=0!=(1&currentNode.conn),n=(QE("connectbutton1",o),QE("connectbutton1d",o),QE("connectbutton1r",o||3==currentNode.mtype),QE("connectbutton1rd",o||3==currentNode.mtype),currentNode.rdpport&&3389!=currentNode.rdpport?QH("desktopCustomUpperRight",'<a style="cursor:pointer;line-height:22px" onclick="cmaltportaction(1,event)">'+format("RDP Port {0}",currentNode.rdpport||3389)+"</a>"):QH("desktopCustomUpperRight",""),0!=(6&currentNode.conn)),n=(QE("connectbutton1h",n),QV("deskFocusBtn",null!=desktop&&2==desktop.contype&&0!=e&&desktopsettings.showfocus),QE("DeskClip",3==e),QV("DeskClip",i&&currentNode.agent&&6144!=(6144&features2)&&11!=currentNode.agent.id&&16!=currentNode.agent.id&&(null==desktop||2!=desktop.contype)&&(1!=desktopsettings.autoclipboard||null==navigator.clipboard||null==navigator.clipboard.readText)),QE("DeskESC",3==e&&4!=desktop.contype),QV("DeskESC",browserfullscreen&&i),QE("DeskType",3==e),QV("DeskType",i),QE("DeskWD",3==e),QV("DeskWD",i),QV("deskkeys",i),QE("deskkeys",null!=desktop),QV("DeskTimer",3==e),QV("DeskLatency",3==e),QS("DeskLatency").display=3==e?"inline-block":"none",desktop&&4==desktop.contype?desktopsettings.rdpautoclipboard:desktopsettings.autoclipboard);QV("DeskClipboardOutButton",o&&i&&null!=desktop&&0==(4096&features2)&&null!=navigator.clipboard&&null!=navigator.clipboard.readText&&(1!=n||null==navigator.clipboard||null==navigator.clipboard.readText)),QV("d7deskAutoClipboardLabel",null!=navigator.clipboard.readText&&0==(4096&features2)),QV("DeskClipboardInButton",o&&i&&null!=desktop&&0==(2048&features2)&&null!=navigator.clipboard&&null!=navigator.clipboard.writeText&&(1!=n||null==navigator.clipboard||null==navigator.clipboard.readText)),3!=e&&(QV("DeskInputLockedButton",!1),QV("DeskInputUnLockedButton",!1),QV("p11numlock",!1),QV("p11scrolllock",!1),QV("p11capslock",!1)),QV("DeskRunButton",0!=(131072&t)&&o),QV("DeskSaveImageButton",3==e&&null!=Q("Desk").toBlob&&0==(1024&features2)),QV("DeskRecordButton",3==e&&null!=Q("Desk").toBlob&&null!=desktop.m.StartRecording&&0==(1024&features2)),QV("DeskChatButton",0!=(16384&t)&&0==browserfullscreen&&currentNode.agent&&o),QV("DeskNotifyButton",0!=(16384&t)&&0==browserfullscreen&&currentNode.agent&&o),QV("DeskLockButton",0!=(16384&t)&&0==browserfullscreen&&currentNode.agent&&currentNode.agent.id<5&&i&&3==e),QV("DeskToolsButton",currentNode.agent&&o),QE("DeskToolsButton",i),QV("DeskOpenWebButton",0==browserfullscreen&&i&&currentNode.agent&&o),QV("DeskBackgroundButton",i&&3==e&&1==desktop.contype&&currentNode.agent&&11!=currentNode.agent.id&&16!=currentNode.agent.id&&o),QV("DeskControlSpan",i),QV("DeskRefreshButton",3==e&&1==desktop.contype),Q("DeskControl").checked=!!(8&t)&&1==getstore("DeskControl",1),QS("DeskControlSpan").color=Q("DeskControl").checked?null:"red",0==o&&QV("DeskTools",!1)}var autoConnectDesktopTimer=null;function autoConnectDesktop(e){autoConnectDesktopTimer=null==autoConnectDesktopTimer?setInterval(function(){connectDesktop(null,1)},1e3):(clearInterval(autoConnectDesktopTimer),null)}var agentConsoleMessages=["","In attesa che l'utente conceda l'accesso... ","Negato","Impossibile avviare la sessione del terminale remoto, {0} ({1})","Tempo scaduto","Dati di rete non validi ricevuti","Impossibile acquisire il display","Negoziazione del protocollo non riuscita ({0})","NLA non supportato","SSL richiesto dal server","SSL non consentito dal server","Certificato SSL non sul server","Bandiere incoerenti","Ibrido richiesto dal server","SSL con autenticazione utente richiesta dal server"];function formatAgentConsoleMessage(e,t,i){for(null==i&&(i=[]);i.length<3;)i.push("");return(t&&t<agentConsoleMessages.length?EscapeHtml(format(agentConsoleMessages[t],i[0],i[1],i[2])):EscapeHtml(e)).split("\n").join("<br />")+"<br /><br />"}function connectDesktop(e,t,i,o){xxdialogMode||(null!=e&&0!=e.shiftKey&&3==t&&(t=1),QV("p11DeskSessionSelector",!1),p11clearConsoleMsg(),null==desktop?(desktopNode=currentNode,2==t?null==desktopNode.intelamt.user||""==desktopNode.intelamt.user?editDeviceAmtSettings(desktopNode._id,connectDesktop,2):((desktop=CreateAmtRedirect(CreateAmtRemoteDesktop("Desk"),authCookie)).debugmode=debugmode,desktop.onStateChanged=onDesktopStateChange,desktop.m.bpp=1==desktopsettings.encoding||3==desktopsettings.encoding?1:2,desktop.m.useZRLE=desktopsettings.encoding<3,desktop.m.localKeyMap=desktopsettings.localkeymap,desktop.m.ReverseMouseWheel=desktopsettings.kvmrmw,desktop.m.showmouse=desktopsettings.showmouse,desktop.m.onScreenSizeChange=deskAdjust,desktop.m.onKvmData=function(e){if(0==e.length)desktop.m._sentPresence||(desktop.m._sentPresence=!0,desktop.m.sendKvmData(JSON.stringify({action:"present",ver:1})));else{var t=null;try{t=JSON.parse(e)}catch(e){}null!=t&&null!=t.action&&("restart"==t.action?(webRtcDesktopReset(),desktop.m.sendKvmData(JSON.stringify({action:"present",ver:1}))):"present"==t.action&&null==webRtcDesktop?(webRtcDesktop={platform:t.platform},"undefined"!=typeof RTCPeerConnection?webRtcDesktop.webrtc=new RTCPeerConnection(null):"undefined"!=typeof webkitRTCPeerConnection&&(webRtcDesktop.webrtc=new webkitRTCPeerConnection(null)),webRtcDesktop.webchannel=webRtcDesktop.webrtc.createDataChannel("Canale Dati",{}),webRtcDesktop.webchannel.onopen=function(){console.log("WebRTC Data Channel Open"),Q("deskstatus").textContent=StatusStrs[desktop.State]+", Soft-KVM",desktop.m.hold(!0),webRtcDesktop.webRtcActive=!0,webRtcDesktop.softdesktop=CreateKvmDataChannel(webRtcDesktop.webchannel,CreateAgentRemoteDesktop("Desk",Q("id_mainarea")),desktop.m),webRtcDesktop.softdesktop.m.setRotation(desktop.m.rotation),webRtcDesktop.softdesktop.m.onScreenSizeChange=deskAdjust,webRtcDesktop.softdesktop.m.ImageType=webpSupport?4:1,desktopsettings.quality&&(webRtcDesktop.softdesktop.m.CompressionLevel=desktopsettings.quality),desktopsettings.scaling&&(webRtcDesktop.softdesktop.m.ScalingLevel=desktopsettings.scaling),webRtcDesktop.softdesktop.Start()},webRtcDesktop.webchannel.onclose=function(e){console.log("WebRTC Data Channel Closed"),webRtcDesktopReset()},webRtcDesktop.webrtc.onicecandidate=function(e){null==e.candidate?desktop.m.sendKvmData(JSON.stringify({action:"offer",ver:1,sdp:webRtcDesktop.webrtcoffer.sdp})):webRtcDesktop.webrtcoffer.sdp+="a="+e.candidate.candidate+"\r\n"},webRtcDesktop.webrtc.oniceconnectionstatechange=function(){null==webRtcDesktop||null==webRtcDesktop.webrtc||"disconnected"!=webRtcDesktop.webrtc.iceConnectionState&&"failed"!=webRtcDesktop.webrtc.iceConnectionState||webRtcDesktopReset()},webRtcDesktop.webrtc.createOffer(function(e){webRtcDesktop.webrtcoffer=e,webRtcDesktop.webrtc.setLocalDescription(e,function(){},webRtcDesktopReset)},webRtcDesktopReset,{mandatory:{OfferToReceiveAudio:!1,OfferToReceiveVideo:!1}})):"answer"==t.action&&null!=webRtcDesktop&&webRtcDesktop.webrtc.setRemoteDescription(new RTCSessionDescription({type:"answer",sdp:t.sdp}),function(){},webRtcDesktopReset))}},4==desktopNode.conn&&null!=desktopNode.intelamt&&1==desktopNode.intelamt.tls?desktop.Start(desktopNode._id,16995,"*","*",1):desktop.Start(desktopNode._id,16994,"*","*",0),desktop.contype=2):null==t||1==t||3==t&&4<currentNode.agent.id&&null==debugmode?((desktop=CreateAgentRedirect(meshserver,CreateAgentRemoteDesktop("Desk"),serverPublicNamePort,authCookie,authRelayCookie,domainUrl)).m.UseExtendedKeyFlag=desktopNode.agent.id<5,desktop.m.mouseCursorActive(11==xxcurrentView),desktop.debugmode=debugmode,desktop.m.debugmode=debugmode,desktop.attemptWebRTC=attemptWebRTC,desktop.webrtcconfig=webrtcconfiguration,desktop.options={},null!=i&&(desktop.options.tsid=i),null!=o&&(desktop.options.consent=o),1==desktopsettings.autolock&&(desktop.options.autolock=!0),desktop.onStateChanged=onDesktopStateChange,0!=(8192&features2)&&(desktop.m.stopInput=!0),desktop.m.onRemoteInputLockChanged=function(e,t){QV("DeskInputLockedButton",t),QV("DeskInputUnLockedButton",!t)},desktop.m.onKeyboardStateChanged=function(e,t){QS("p11numlock").display=1&t?"inline-block":"none",QS("p11scrolllock").display=2&t?"inline-block":"none",QS("p11capslock").display=4&t?"inline-block":"none"},desktop.onConsoleMessageChange=function(){desktop.consoleMessage?(Q("p11DeskConsoleMsg").innerHTML+=formatAgentConsoleMessage(desktop.consoleMessage,desktop.consoleMessageId,desktop.consoleMessageArgs),QV("p11DeskConsoleMsg",!0),null!=p11DeskConsoleMsgTimer&&clearTimeout(p11DeskConsoleMsgTimer),desktop.consoleMessageTimeout&&(p11DeskConsoleMsgTimer=setTimeout(p11clearConsoleMsg,1e3*desktop.consoleMessageTimeout))):p11clearConsoleMsg()},desktop.onMetadataChange=function(e){updateMetadata(desktop,"deskmetadata")},desktop.m.ImageType=desktopsettings.agentencoding,desktop.m.CompressionLevel=desktopsettings.quality,desktop.m.ScalingLevel=desktopsettings.scaling,desktopsettings.framerate&&(desktop.m.FrameRateTimer=desktopsettings.framerate),desktopsettings.swapmouse&&(desktop.m.SwapMouse=desktopsettings.swapmouse),desktopsettings.rmw&&(desktop.m.ReverseMouseWheel=desktopsettings.rmw),1==desktopsettings.remotekeymap&&(desktop.m.remoteKeyMap=desktopsettings.remotekeymap),desktop.m.onScreenSizeChange=deskAdjust,desktop.Start(desktopNode._id),desktop.latency.callback=function(e){updateSessionTime()},desktop.contype=1):3==t?meshserver.send({action:"msg",type:"userSessions",nodeid:currentNode._id,tag:o}):4==t&&((desktop=CreateRDPDesktop("Desk",domainUrl)).onStateChanged=onDesktopStateChange,desktop.m.onScreenSizeChange=mdeskAdjust,desktop.m.onClipboardChanged=function(e){null!=e&&desktopsettings.rdpautoclipboard&&null!=navigator.clipboard&&navigator.clipboard.writeText(e).then(function(){}).catch(function(e){console.log(e)})},desktopsettings.rdpsmb&&(desktop.m.SwapMouse=desktopsettings.rdpsmb),desktopsettings.rdprmw&&(desktop.m.ReverseMouseWheel=desktopsettings.rdprmw),desktop.Start(desktopNode._id,currentNode.rdpport||3389,i),desktop.contype=4,desktop.onConsoleMessageChange=function(){desktop.consoleMessage?(Q("p11DeskConsoleMsg").innerHTML+=formatAgentConsoleMessage(desktop.consoleMessage,desktop.consoleMessageId,desktop.consoleMessageArgs),QV("p11DeskConsoleMsg",!0),null!=p11DeskConsoleMsgTimer&&clearTimeout(p11DeskConsoleMsgTimer),desktop.consoleMessageTimeout&&(p11DeskConsoleMsgTimer=setTimeout(p11clearConsoleMsg,1e3*desktop.consoleMessageTimeout))):p11clearConsoleMsg()})):(desktop.Stop(),webRtcDesktopReset(),(desktopNode=desktop=null)!=pluginHandler&&pluginHandler.callHook("onDesktopDisconnect")))}function askRdpCredentials(){var e;xxdialogMode||(e="<div>",1==currentNode.rdp?e=e+addHtmlFormFloating("Credenziali",'<select id=d2mode class="form-select" onchange=askRdpCredentialsValidate()><option value=1>Usa le credenziali del server</option><option value=2>Usa nuove credenziali</option></select>')+"<div id=d2cred style=display:none>":e+="<div id=d2cred>",e=(e=(e+=addHtmlFormFloating("Dominio",'<input type=text id=d2domain class="form-control" maxlength=128 />'))+addHtmlFormFloating("Nome utente",'<input type=text id=d2user class="form-control" onKeyUp=askRdpCredentialsValidate() maxlength=128 />'))+addHtmlFormFloating("Password",'<input type=password id=d2pass class="form-control" maxlength=128 autocomplete=off />'),0==(4194304&features2)&&(e+=addHtmlValue("",'<label><input type="checkbox" class="form-check-input me-2" id=d2savecred>Ricorda le credenziali</label>')),setModalContent("xxAddAgent","Credenziali PSR",e=(e=(e=(e=(e+="</div>")+MoreStart())+addHtmlFormFloating("Alt Shell",'<input type=text id=d2altshell class="form-control" maxlength=2048 />'))+addHtmlFormFloating("Dir. Lavoro",'<input type=text id=d2workdir class="form-control" maxlength=2048 />'))+MoreEnd()),showModal("xxAddAgentModal","idx_dlgOkButton",()=>askRdpCredentialsEx()))}function askRdpCredentialsValidate(){1==currentNode.rdp&&(QV("d2cred",2==Q("d2mode").value),1==Q("d2mode").value)?QE("idx_dlgOkButton",!0):QE("idx_dlgOkButton",""!=Q("d2user").value)}function askRdpCredentialsEx(){var e,t=null,i=null;desktopsettings.rdpsize?"browser"==desktopsettings.rdpsize?(t=window.innerWidth,i=window.innerHeight):"screen"==desktopsettings.rdpsize?(t=window.screen.width,i=window.screen.height):"canvas"==desktopsettings.rdpsize?(t=Q("DeskParent").offsetWidth,i=Q("DeskParent").offsetHeight):1<=(e=desktopsettings.rdpsize.indexOf("x"))&&(t=parseInt(desktopsettings.rdpsize.substring(0,e)),i=parseInt(desktopsettings.rdpsize.substring(e+1))):(t=Q("DeskParent").offsetWidth,i=Q("DeskParent").offsetHeight),1==currentNode.rdp&&1==Q("d2mode").value?connectDesktop(null,4,{servercred:!0,width:t,height:i,flags:null!=desktopsettings.rdpflags?desktopsettings.rdpflags:47,altshell:Q("d2altshell").value,workdir:Q("d2workdir").value}):(e=!1,0==(4194304&features2)&&(e=Q("d2savecred").checked),connectDesktop(null,4,{domain:Q("d2domain").value,username:Q("d2user").value,password:Q("d2pass").value,savecred:e,width:t,height:i,flags:null!=desktopsettings.rdpflags?desktopsettings.rdpflags:47,altshell:Q("d2altshell").value,workdir:Q("d2workdir").value}))}function updateMetadata(e,t){var i="",o=0;if(e&&3==e.State){if(e.metadata&&e.metadata.users)for(var n in e.metadata.users)o+=e.metadata.users[n];1<o&&(i="<span onclick=showSessionMetadata(1) style=cursor:pointer>"+format(", {0} guardando",o)+"</span>")}QH("deskmetadata",i),e==desktop&&"sessionMetadata1"==xxdialogTag&&showSessionMetadata(1)}function showSessionMetadata(e){if(!xxdialogMode||xxdialogTag=="sessionMetadata"+e){xxdialogMode&&setDialogMode(0);var t=1==e?desktop:null;if(t&&t.metadata){var i="";if(t.metadata.startTime&&(i+=addHtmlValue4("Ora di inizio",printDateTime(new Date(t.metadata.startTime)))),t.metadata.users)for(var o in t.metadata.users){var n=1==t.metadata.users[o]?"1 connessione":format("{0} connessioni",t.metadata.users[o]);i+=addHtmlValue2(getUserName(o),n)}xxdialogTag="sessionMetadata"+e,setModalContent("xxAddAgent","Informazioni sulla sessione",i),showModal("xxAddAgentModal","idx_dlgOkButton")}}}function p11clearConsoleMsg(){QH("p11DeskConsoleMsg",""),QV("p11DeskConsoleMsg",!1),p11DeskConsoleMsgTimer&&(clearTimeout(p11DeskConsoleMsgTimer),p11DeskConsoleMsgTimer=null)}function p12clearConsoleMsg(){QH("p12TermConsoleMsg",""),QV("p12TermConsoleMsg",!1),p12TermConsoleMsgTimer&&(clearTimeout(p12TermConsoleMsgTimer),p12TermConsoleMsgTimer=null)}function p13clearConsoleMsg(){QH("p13FilesConsoleMsg",""),QV("p13FilesConsoleMsg",!1),p13FilesConsoleMsgTimer&&(clearTimeout(p13FilesConsoleMsgTimer),p13FilesConsoleMsgTimer=null)}function p12setConsoleMsg(e,t){e?(Q("p12TermConsoleMsg").innerHTML+=e,QV("p12TermConsoleMsg",!0),null!=p12TermConsoleMsgTimer&&clearTimeout(p12TermConsoleMsgTimer),t&&(p12TermConsoleMsgTimer=setTimeout(p12clearConsoleMsg,t))):p12clearConsoleMsg()}function p13setConsoleMsg(e,t){e?(Q("p13FilesConsoleMsg").innerHTML+=e,QV("p13FilesConsoleMsg",!0),null!=p13FilesConsoleMsgTimer&&clearTimeout(p13FilesConsoleMsgTimer),t&&(p13FilesConsoleMsgTimer=setTimeout(p13clearConsoleMsg,t))):p13clearConsoleMsg()}var webRtcDesktop=null;function webRtcDesktopReset(){if(null!=webRtcDesktop){if(null!=webRtcDesktop.softdesktop&&(webRtcDesktop.softdesktop.Stop(),webRtcDesktop.softdesktop=null),null!=webRtcDesktop.webchannel){try{webRtcDesktop.webchannel.close()}catch(e){}webRtcDesktop.webchannel=null}if(null!=webRtcDesktop.webrtc){try{webRtcDesktop.webrtc.close()}catch(e){}webRtcDesktop.webrtc=null}webRtcDesktop=null,desktop&&desktop.m&&(desktop.m.hold(!1),Q("deskstatus").textContent=StatusStrs[desktop.State])}}function onDesktopStateChange(e,t){var i=t,e=(3==i&&2==e.contype&&i++,StatusStrs[i]);switch(null!=desktop&&1==desktop.webRtcActive&&(e+=", WebRTC"),null!=desktop&&3==i&&4==desktop.contype&&(e+=", RDP"),QH("deskstatus",e),t){case 0:null!=desktop&&(null!=desktop.m.recordedData&&deskRecordSession(),desktop.Stop()),desktopNode=desktop=null,QV("DeskFocus",!1),QV("DeskMonitorSelectionSpan",!1),QV("deskRecordIcon",!1),QV("DeskInputLockedButton",!1),QV("DeskInputUnLockedButton",!1),deskFocusBtn.value="Focalizza tutto",1==fullscreen&&deskToggleFull(),webRtcDesktopReset(),deskPreferedStickyDisplay=0;break;case 2:break;case 3:desktop&&1==desktop.serverIsRecording&&QV("deskRecordIcon",!0),desktop.startTime=new Date,(deskLastClipboardSent=null)==updateSessionTimer&&(updateSessionTimer=setInterval(updateSessionTime,1e3))}updateDesktopButtons(),deskAdjust(),setTimeout(deskAdjust,50),updateMetadata(desktop,"deskmetadata")}function updateSessionTime(){var e="",t=0;if(desktop&&desktop.startTime){if(desktop.latency&&0<=desktop.latency.current&&(e=format("{0} ms",desktop.latency.current)),t=Math.floor((new Date-desktop.startTime)/1e3),QH("DeskTimer",zeroPad(Math.floor(t/3600),2)+":"+zeroPad(Math.floor(t/60)%60,2)+":"+zeroPad(t%60,2)),QH("DeskLatency",e),(4!=desktop.contype&&!0===desktopsettings.autoclipboard||4==desktop.contype&&!0===desktopsettings.rdpautoclipboard)&&null!=navigator.clipboard&&null!=navigator.clipboard.readText){if("firefox"==Mstsc.browser())return;try{navigator.clipboard.readText().then(function(e){null!=desktop&&null!=e&&deskLastClipboardSent!=e&&(desktop.m.setClipboard?desktop.m.setClipboard(e):(console.log("s3"),meshserver.send({action:"msg",type:"setclip",nodeid:currentNode._id,data:e})),deskLastClipboardSent=e)}).catch(function(e){})}catch(e){console.log(e)}}}else QH("DeskTimer",""),QH("DeskLatency","");t=0,terminal&&terminal.startTime?(terminal.latency&&0<=terminal.latency.current&&(e=format("{0} ms, ",terminal.latency.current)),t=Math.floor((new Date-terminal.startTime)/1e3),QH("TermTimer",e+zeroPad(Math.floor(t/3600),2)+":"+zeroPad(Math.floor(t/60)%60,2)+":"+zeroPad(t%60,2))):QH("TermTimer",""),null==desktop&&null==terminal&&(clearInterval(updateSessionTimer),updateSessionTimer=null)}function showDesktopSettings(){var e;xxdialogMode||(applyDesktopSettings(),updateDesktopButtons(),e=!1,0==(e="none"!=QS("td7meshkvm").display&&0<Q("td7meshkvm").className.indexOf("active")||"none"!=QS("td7rdpkvm").display&&0<Q("td7rdpkvm").className.indexOf("active")||"none"!=QS("td7amtkvm").display&&0<Q("td7amtkvm").className.indexOf("active")?!0:e)&&("none"!=QS("td7meshkvm").display?changeDesktopSettingsTab(null,"d7meshkvm"):"none"!=QS("td7rdpkvm").display?changeDesktopSettingsTab(null,"d7rdpkvm"):"none"!=QS("td7amtkvm").display&&changeDesktopSettingsTab(null,"d7amtkvm")),xxdialogButtons=3,setModalContent("xxAddAgent","Impostazioni desktop remoto",7),showModal("xxAddAgentModal","idx_dlgOkButton",showDesktopSettingsChanged))}function changeDesktopSettingsTab(e,t){for(var i,o=document.getElementsByClassName("tabcontent"),n=0;n<o.length;n++)o[n].style.display="none";for(i=document.getElementsByClassName("tablinks"),n=0;n<i.length;n++)i[n].className=i[n].className.replace(" active","");document.getElementById(t).style.display="block",null!=e?e.currentTarget.className+=" active":document.getElementById("t"+t).className+=" active"}function showDesktopSettingsChanged(){desktopsettings.encoding=d7desktopmode.value,desktopsettings.showfocus=d7showfocus.checked,desktopsettings.showmouse=d7showcursor.checked,desktopsettings.quality=d7bitmapquality.value,desktopsettings.scaling=d7bitmapscaling.value,desktopsettings.framerate=d7framelimiter.value,desktopsettings.agentencoding=d7encoding.value,desktopsettings.swapmouse=d7deskSwapMouse.checked,desktopsettings.rmw=d7deskrmw.checked,desktopsettings.remotekeymap=d7deskRemoteKeyMap.checked,desktopsettings.autoclipboard=d7deskAutoClipboard.checked,desktopsettings.autolock=d7deskAutoLock.checked,desktopsettings.localkeymap=d7localKeyMap.checked,desktopsettings.kvmrmw=d7kvmrmw.checked,desktopsettings.rdpsize=d7rdpsize.value,desktopsettings.rdpsmb=d7rdpsmb.checked,desktopsettings.rdprmw=d7rdprmw.checked,desktopsettings.rdpautoclipboard=d7rdpclip.checked;for(var e=0,t=1;t<10;t++)5!=t&&Q("d7rdp"+t).checked&&(e|=1<<t-1);desktopsettings.rdpflags=e,localStorage.setItem("desktopsettings",JSON.stringify(desktopsettings)),applyDesktopSettings(),updateDesktopButtons(),desktop&&(1==desktop.contype&&(desktop.m.SwapMouse=desktopsettings.swapmouse,desktop.m.ReverseMouseWheel=desktopsettings.rmw,desktop.m.remoteKeyMap=desktopsettings.remotekeymap,0!=desktop.State)&&(desktop.m.SendCompressionLevel(desktopsettings.agentencoding,desktopsettings.quality,desktopsettings.scaling,desktopsettings.framerate),desktop.sendCtrlMsg('{"ctrlChannel":"102938","type":"autolock","value":'+desktopsettings.autolock+"}"),desktop.m.SendRefresh()),2==desktop.contype&&(desktop.m.ReverseMouseWheel=desktopsettings.kvmrmw,0==desktopsettings.showfocus&&(desktop.m.focusmode=0,deskFocusBtn.value="Focalizza tutto"),0!=desktop.State)&&(desktop.Stop(),setTimeout(function(){connectDesktop(null,2)},50)),4==desktop.contype)&&(desktop.m.SwapMouse=desktopsettings.rdpsmb,desktop.m.ReverseMouseWheel=desktopsettings.rdprmw)}function applyDesktopSettings(){var e="",t=512&features?[100,90,80,70,60,50,40,30,20,10,5,1]:[60,50,40,30,20,10,5,1];for(i in t)e+="<option value="+t[i]+">"+t[i]+"%</option>";QH("d7bitmapquality",e),d7desktopmode.value=desktopsettings.encoding,d7showfocus.checked=desktopsettings.showfocus,d7showcursor.checked=desktopsettings.showmouse,desktopsettings.agentencoding?d7encoding.value=desktopsettings.agentencoding:desktopsettings.agentencoding=4,d7bitmapquality.value=40,0<=t.indexOf(parseInt(desktopsettings.quality))&&(d7bitmapquality.value=desktopsettings.quality),d7bitmapscaling.value=desktopsettings.scaling,desktopsettings.framerate?d7framelimiter.value=desktopsettings.framerate:d7framelimiter.value=100,null!=desktopsettings.swapmouse&&(d7deskSwapMouse.checked=desktopsettings.swapmouse),null!=desktopsettings.rmw&&(d7deskrmw.checked=desktopsettings.rmw),null!=desktopsettings.remotekeymap&&(d7deskRemoteKeyMap.checked=desktopsettings.remotekeymap),null!=desktopsettings.autoclipboard&&(d7deskAutoClipboard.checked=desktopsettings.autoclipboard),null!=desktopsettings.autolock&&(d7deskAutoLock.checked=desktopsettings.autolock),desktopsettings.localkeymap&&(d7localKeyMap.checked=desktopsettings.localkeymap),desktopsettings.kvmrmw&&(d7kvmrmw.checked=desktopsettings.kvmrmw),QV("deskFocusBtn",null!=desktop&&2==desktop.contype&&0!=desktop.state&&desktopsettings.showfocus),null!=desktopsettings.rdpsize&&(d7rdpsize.value=desktopsettings.rdpsize),null==desktopsettings.rdpflags&&(desktopsettings.rdpflags=47),null!=desktopsettings.rdpsmb&&(d7rdpsmb.checked=desktopsettings.rdpsmb),null!=desktopsettings.rdprmw&&(d7rdprmw.checked=desktopsettings.rdprmw),null!=desktopsettings.rdpautoclipboard&&(d7rdpclip.checked=desktopsettings.rdpautoclipboard);for(var i=1;i<10;i++)5!=i&&(Q("d7rdp"+i).checked=0!=(desktopsettings.rdpflags&1<<i-1))}function enterBrowserFullscreen(e){navigator.keyboard&&navigator.keyboard.lock&&navigator.keyboard.lock(),e.requestFullscreen?e.requestFullscreen():e.msRequestFullscreen?e.msRequestFullscreen():e.mozRequestFullScreen?e.mozRequestFullScreen():e.webkitRequestFullscreen&&e.webkitRequestFullscreen(Element.ALLOW_KEYBOARD_INPUT)}function exitBrowserFullscreen(){document.exitFullscreen?document.exitFullscreen():document.msExitFullscreen?document.msExitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitExitFullscreen&&document.webkitExitFullscreen(),navigator.keyboard&&navigator.keyboard.unlock&&navigator.keyboard.unlock()}function isBrowserFullscreen(){return!!(document.fullscreenElement||document.mozFullScreenElement||document.webkitFullscreenElement||document.msFullscreenElement)}var fullscreen=!1,browserfullscreen=!1;function deskToggleFull(e){var t=!(0===args.xterm||null!=terminal&&null==xterm);(fullscreen=!fullscreen)?(QC("body").add("fulldesk"),QS("deskarea3x").height="100%",QS("deskarea3x")["max-height"]="100%",t?(QS("termTable").position="absolute",QS("termTable").top=QS("termTable").bottom=QS("termTable").left=QS("termTable").right="0"):(QS("termTable").height="100%",QS("termTable")["max-height"]="100%"),1==e.shiftKey&&(enterBrowserFullscreen(Q("container")),browserfullscreen=!0)):(QC("body").remove("fulldesk"),e=args.hide,0==footerBar&&(e|=4),e=(1&e?0:66)+(2&e?0:24)+(4&e?0:45)+(8&e?0:60),QS("deskarea3x").height="calc(100vh - "+(75+e)+"px)",QS("deskarea3x")["max-height"]="calc(100vh - "+(75+e)+"px)",t?(QS("termTable").position=null,QS("termTable").top=QS("termTable").bottom=QS("termTable").left=QS("termTable").right=null):(QS("termTable").height="calc(100vh - "+(75+e)+"px)",QS("termTable")["max-height"]="calc(100vh - "+(75+e)+"px)"),1==browserfullscreen&&(exitBrowserFullscreen(),browserfullscreen=!1)),deskAdjust(),updateDesktopButtons(),adjustPanels(),null!=xterm&&12==xxcurrentView&&(xtermfit.fit(),xterm.focus())}function deskToggleFocus(){desktop.m.focusmode=(desktop.m.focusmode+64)%192,Q("deskFocusBtn").value=["Focalizza tutto","Piccolo focus","Grande attenzione"][desktop.m.focusmode/64]}function deskAdjust(){var e=Q("DeskParent").clientHeight,t=Q("DeskParent").clientWidth,i=Q("Desk").height,o=Q("Desk").width;2==deskAspectRatio?(QS("Desk")["margin-top"]=null,QS("Desk").height="100%",QS("Desk").width="100%",QS("DeskParent").overflow="hidden"):1==deskAspectRatio?(QS("Desk")["margin-top"]="0px",QS("Desk").height=i+"px",QS("Desk").width=o+"px",QS("DeskParent").overflow="scroll"):(i/o<e/t?(t=i*t/o+"px",QS("Desk").height=t,QS("Desk").width="100%"):(t=o*e/i+"px",QS("Desk").height=webPageFullScreen||fullscreen?null:"100%",QS("Desk").width=t),QS("Desk")["margin-top"]=null,QS("DeskParent").overflow="hidden")}function mdeskAdjust(e,t,i,o){var n;e&&t&&i&&o&&(3!=(n=Q("viewselect").value)&&5!=n||("Desk"==o.id?deskAdjust():(5==n&&(n=[{x:180,y:101},{x:302,y:169},{x:454,y:255}][Q("sizeselect").selectedIndex],QS(o.id).width=(0!=e.State?t*n.y/i:n.x)+"px"),QS(o.id)["margin-top"]=null,QS(o.id)["margin-bottom"]=null)))}function sendDeskEsc(){null!=desktop&&3==desktop.State&&(2==desktop.contype?desktop.m.sendkey([[65307,1],[65307,0]]):desktop.m.SendKeyMsgKC([[desktop.m.KeyAction.EXDOWN,27],[desktop.m.KeyAction.EXUP,27]]))}function p11fileDragDrop(e){var t;haltEvent(e),QV("p11bigfail",!1),QV("p11bigok",!1),null==xxdialogMode&&null!=desktop&&3==desktop.State&&null!=e.dataTransfer&&0!=e.dataTransfer.files.length&&((t=(e=e.dataTransfer.files[0]).name.toLowerCase()).endsWith(".bat")||t.endsWith(".ps1")||t.endsWith(".sh")||t.endsWith(".agentconsole")?d2runCommandDialog({nodeids:[currentNode._id],selectedFile:e}):t.endsWith(".txt")&&((t=new FileReader).onload=function(e){showDeskType(e.target.result)},t.readAsText(e)))}var p11dragtimer=null;function p11fileDragOver(e){haltEvent(e),null!=p11dragtimer&&(clearTimeout(p11dragtimer),p11dragtimer=null);e=null==xxdialogMode&&null!=desktop&&3==desktop.State;QV("p11bigok",e),QV("p11bigfail",!e)}function p11fileDragLeave(e){haltEvent(e),"Desk"!=e.target.id?(QV("p11bigfail",!1),QV("p11bigok",!1)):p11dragtimer=setTimeout(function(){QV("p11bigfail",!1),QV("p11bigok",!1),p11dragtimer=null},10)}function updateDeskShortcutKeys(){var e,t="",i=parseInt(Q("deskkeys").value);for(e in""==i&&0<deskKeyboardShortcuts.length&&(i=deskKeyboardShortcuts[0]),deskKeyboardShortcuts)t+="<option value="+deskKeyboardShortcuts[e]+(i==deskKeyboardShortcuts[e]?" selected":"")+">"+keyShortcutTotext(deskKeyboardShortcuts[e])+"</option>";QH("deskkeys",t)}var keyStrings={8:"Tornare  indietro",9:"Tab",13:"accedere",27:"Escape",32:"Space",44:"Stampa schermo",45:"Inserire",46:"Canc",36:"Home",35:"Fine",33:"Pagina su",34:"Pagina giù",37:"Sinistra",38:"Su",39:"Destro",40:"Giù",0:"Nessuna "};function keyShortcutTotext(e){var t=[];return 65536&e&&t.push("Shift"),131072&e&&t.push("Alt"),524288&e&&t.push("Ctrl"),1048576&e&&t.push("Win"),112<=(e&=65535)&&e<=123?t.push("F"+(e-111)):0!=e&&keyStrings[e]?t.push(keyStrings[e]):0!=e&&t.push(String.fromCharCode(e)),t.join(" + ")}function deskCustomizeKeys(){if(!xxdialogMode){var e=(e='<div id=d2shortcuts style="width:100%;height:180px;padding:4px;overflow-y:auto;border:1px solid gray"></div><div style=width:100%;padding:5px>')+'<label><input id=d1kshift type=checkbox class="form-check-input me-2" /> Shift</label><label> <input id=d1kalt type=checkbox class="form-check-input me-2" /> Alt</label><label> <input id=d1kctrl type=checkbox class="form-check-input me-2" /> Ctrl</label> <input id=d1kwin type=checkbox class="form-check-input me-2" /> Win</label>'+" <select id=d2keySelect>";for(t in keyStrings)e+="<option value="+t+">"+keyStrings[t]+"</option>";for(var t=1;t<=12;t++)e+="<option value="+(t+111)+">F"+t+"</option>";for(t=0;t<10;t++)e+="<option value="+(t+48)+">"+t+"</option>";for(t=0;t<26;t++)e+="<option value="+(t+65)+">"+String.fromCharCode(t+65)+"</option>";setModalContent("xxAddAgent","Personalizzazione delle scorciatoie da tastiera",e=e+"</select> <input type=button value=Aggiungi onclick=addDeskCustomizeKey() /></div>"+'<div style=width:100%;padding:2px;text-align:center><input type=button value="Restore Default Keyboard Shortcuts" onclick=restoreDeskCustomizeKey() /></div>'),showModal("xxAddAgentModal","idx_dlgOkButton",()=>deskCustomizeKeysEx()),deskUpdateShortcutList()}}function deskCustomizeKeysEx(){putstore("deskKeyShortcuts",deskKeyboardShortcuts.join(",")),updateDeskShortcutKeys()}function deskUpdateShortcutList(){var e,t="";for(e in deskKeyboardShortcuts){var i=keyShortcutTotext(deskKeyboardShortcuts[e]),o="";e!=deskKeyboardShortcuts.length-1&&(o+='<img width=8 height=8 style=float:right;cursor:pointer;padding:3px src="images/c2.png" onclick=deskCustomizeKeyDown('+deskKeyboardShortcuts[e]+")>"),0!=e&&(o+='<img width=8 height=8 style=float:right;cursor:pointer;padding:3px src="images/c3.png" onclick=deskCustomizeKeyUp('+deskKeyboardShortcuts[e]+")>"),t+='<div style="width:100%;background-color:#AAA;border-radius:4px;margin-bottom:4px;padding:4px;text-align:left;box-sizing:border-box" value='+deskKeyboardShortcuts[e]+">"+i+'<img width=10 height=10 style=float:right;cursor:pointer;padding:2px;margin-left:8px src="images/trash.png" onclick=removeDeskCustomizeKey('+deskKeyboardShortcuts[e]+")>"+o+"</div>"}""==t&&(t="<i>Nessuna scorciatoia da tastiera definita</i>"),QH("d2shortcuts",t)}function deskCustomizeKeyDown(e){var e=deskKeyboardShortcuts.indexOf(e),t=deskKeyboardShortcuts[e+1];deskKeyboardShortcuts[e+1]=deskKeyboardShortcuts[e],deskKeyboardShortcuts[e]=t,deskUpdateShortcutList()}function deskCustomizeKeyUp(e){var e=deskKeyboardShortcuts.indexOf(e),t=deskKeyboardShortcuts[e];deskKeyboardShortcuts[e]=deskKeyboardShortcuts[e-1],deskKeyboardShortcuts[e-1]=t,deskUpdateShortcutList()}function removeDeskCustomizeKey(e){var t,i=[];for(t in deskKeyboardShortcuts)deskKeyboardShortcuts[t]!=e&&i.push(deskKeyboardShortcuts[t]);deskKeyboardShortcuts=i,deskUpdateShortcutList()}function restoreDeskCustomizeKey(){deskKeyboardShortcuts=[],putstore("deskKeyShortcuts",null);var e,t=getstore("deskKeyShortcuts","0x0A002E,0x100000,0x100028,0x100026,0x10004C,0x10004D,0x11004D,0x100052,0x020073,0x080057,0x020009,0x100025,0x100027").split(",");for(e in t)""!=t[e]&&deskKeyboardShortcuts.push(parseInt(t[e]));updateDeskShortcutKeys(),deskUpdateShortcutList()}function addDeskCustomizeKey(){var e=parseInt(Q("d2keySelect").value);Q("d1kshift").checked&&(e|=65536),Q("d1kalt").checked&&(e|=131072),Q("d1kctrl").checked&&(e|=524288),Q("d1kwin").checked&&(e|=1048576),0<e&&-1==deskKeyboardShortcuts.indexOf(e)&&(deskKeyboardShortcuts.push(e),deskUpdateShortcutList())}function deskCustomizeStrings(){var e;xxdialogMode||(e='<div id=d2strings style="width:100%;height:180px;padding:4px;overflow-y:auto;border:1px solid gray"></div><div style=width:100%;padding:5px>',setModalContent("xxAddAgent","Personalizzazione delle stringhe della tastiera",e=(e=(e+=addHtmlFormFloating("Nome",'<input type=text id=d2shortcutname class="form-control" maxlength=32 autocomplete=off onkeyup=deskCustomizeStringsUpdate(event) />'))+addHtmlFormFloating("Valore",'<input type=text id=d2shortcutvalue class="form-control" maxlength=256 autocomplete=off onkeyup=deskCustomizeStringsUpdate(event) />'))+addHtmlFormFloating("",'<input id=d2addbutton type=button value=Aggiungi onclick=addDeskCustomizeString() class="form-control" />')),showModal("xxAddAgentModal","idx_dlgOkButton",()=>deskCustomizeStringsEx()),deskUpdateStringsList(),deskCustomizeStringsUpdate())}function deskCustomizeStringsUpdate(){QE("d2addbutton",""!=Q("d2shortcutname").value&&""!=Q("d2shortcutvalue").value)}function deskCustomizeStringsEx(){putstore("deskStrings",JSON.stringify(deskKeyboardStrings)),updateDesktopStrings()}function deskUpdateStringsList(){var e,t="";for(e in deskKeyboardStrings){var i="";e!=deskKeyboardStrings.length-1&&(i+='<img width=8 height=8 style=float:right;cursor:pointer;padding:3px src="images/c2.png" onclick=deskCustomizeStringDown('+e+")>"),0!=e&&(i+='<img width=8 height=8 style=float:right;cursor:pointer;padding:3px src="images/c3.png" onclick=deskCustomizeStringUp('+e+")>"),t=(t+='<div style="width:100%;background-color:#AAA;border-radius:4px;margin-bottom:4px;padding:4px;text-align:left;box-sizing:border-box" value='+(e+1e3)+"><div><b>"+EscapeHtml(deskKeyboardStrings[e].n)+'</b><img width=10 height=10 style=float:right;cursor:pointer;padding:2px;margin-left:8px src="images/trash.png" onclick=removeDeskCustomizeString('+e+")>"+i+"</div>")+("<div stlye=font-size:x-small>"+EscapeHtml(deskKeyboardStrings[e].v)+"</div>")+"</div>"}""==t&&(t="<i>Nessuna stringa della tastiera definita</i>"),QH("d2strings",t)}function deskCustomizeStringDown(e){var t=deskKeyboardStrings[e+1];deskKeyboardStrings[e+1]=deskKeyboardStrings[e],deskKeyboardStrings[e]=t,deskUpdateStringsList()}function deskCustomizeStringUp(e){var t=deskKeyboardStrings[e];deskKeyboardStrings[e]=deskKeyboardStrings[e-1],deskKeyboardStrings[e-1]=t,deskUpdateStringsList()}function removeDeskCustomizeString(e){deskKeyboardStrings.splice(e,1),deskUpdateStringsList()}function addDeskCustomizeString(){Array.isArray(deskKeyboardStrings)||(deskKeyboardStrings=[]);var e=Q("d2shortcutname").value,t=Q("d2shortcutvalue").value;""!=e&&""!=t&&(deskKeyboardStrings.push({n:e,v:t}),deskUpdateStringsList())}function updateDesktopStrings(){var e,t="";for(e in deskKeyboardStrings)t+='<div class="cmtext" onclick="cmdeskpreconfigtypeaction('+(parseInt(e)+1e3)+',event)">'+EscapeHtml(deskKeyboardStrings[e].n)+"</div>";""!=t&&(t+="<hr />"),QH("deskPreConfigShortcutContextMenu2",t)}function deskSendKeys(){if(Q("DeskWD").blur(),!xxdialogMode&&null!=desktop&&3==desktop.State){var e=parseInt(Q("deskkeys").value);if(655406==e)desktop.m.sendcad();else{var t=(16711680&e)>>16,e=65535&e,i=[],o=[],n={8:65288,9:65289,13:65293,27:65307,45:65379,46:65535,36:65360,35:65367,33:65365,34:65366,37:65361,38:65362,39:65363,40:65364,112:65470,113:65471,114:65472,115:65473,116:65474,117:65475,118:65476,119:65477,120:65478,121:65479,122:65480,123:65481};if(2==desktop.contype){1&t&&(i.push([65505,1]),o.push([65505,0])),2&t&&(i.push([65513,1]),o.push([65513,0])),8&t&&(i.push([65507,1]),o.push([65507,0])),16&t&&(i.push([65511,1]),o.push([65511,0])),65<=(e=n[e]?n[e]:e)&&e<=90&&(e+=32),0!=e&&(i.push([e,1]),o.push([e,0])),o.reverse();for(var a=0;a<o.length;a++)i.push(o[a]);desktop.m.sendkey(i)}else{1&t&&(i.push([desktop.m.KeyAction.DOWN,16]),o.push([desktop.m.KeyAction.UP,16])),2&t&&(i.push([desktop.m.KeyAction.EXDOWN,18]),o.push([desktop.m.KeyAction.EXUP,18])),8&t&&(i.push([desktop.m.KeyAction.EXDOWN,17]),o.push([desktop.m.KeyAction.EXUP,17])),16&t&&(i.push([desktop.m.KeyAction.EXDOWN,91]),o.push([desktop.m.KeyAction.EXUP,91])),0!=e&&(i.push([desktop.m.KeyAction.DOWN,e]),o.push([desktop.m.KeyAction.UP,e])),o.reverse();for(a=0;a<o.length;a++)i.push(o[a]);desktop.m.SendKeyMsgKC(i)}}}}function showDeskType(e){var t;xxdialogMode||null==desktop||3!=desktop.State||(Q("DeskType").blur(),t="<div>Immettere il testo e fare clic su OK per digitarlo in remoto. Assicurarsi di posizionare il cursore remoto nella posizione corretta prima di procedere.<div>",setModalContent("xxAddAgent","Immissione da tastiera remota",t+='<textarea id=d2typeText style="margin-top:5px;width:100%;height:184px;resize:none" maxlength=2000>'+(e?EscapeHtml(e):"")+"</textarea>"),showModal("xxAddAgentModal","idx_dlgOkButton",()=>showDeskTypeEx()),Q("d2typeText").focus())}var AmtDeskTypeTimer=null,AmtDeskTypeContent=null,DeskTypeTranslate={39:222,42:106,43:107,44:188,45:189,46:190,47:191,59:186,61:187,91:219,92:220,93:221,96:192,191:111},DeskTypeShiftTranslate={33:49,34:222,35:51,36:52,37:53,38:55,40:57,41:48,58:186,60:188,62:190,63:191,64:50,94:54,95:189,106:56,107:187,123:219,124:220,125:221,126:192};function showDeskTypeEx(e){var t,i=[],o=!1,n=("string"==typeof e?t=e:(t=Q("d2typeText").value,Q("d2typeText").value)).toUpperCase();if(2==desktop.contype){for(var a in t){var s=t.charCodeAt(a);i.push([s,1],[s,0])}AmtDeskTypeContent=i,AmtDeskTypeTimer=setInterval(function(){var e=AmtDeskTypeContent.shift();desktop&&desktop.m.sendkey(e[0],e[1]),null!=desktop&&0!=AmtDeskTypeContent.length||(clearInterval(AmtDeskTypeTimer),AmtDeskTypeContent=null)},10)}else if(4==desktop.contype)desktop.m.SendStringUnicode(t);else if(!0!==desktopsettings.remotekeymap)desktop.m.SendStringUnicode(t);else{for(var a in t){var s=t.charCodeAt(a),r=n.charCodeAt(a);65<=s&&s<=90||97<=s&&s<=122?(s==r&&0==o&&(i.push([desktop.m.KeyAction.DOWN,16]),o=!0),s!=r&&1==o&&(i.push([desktop.m.KeyAction.UP,16]),o=!1)):48<=s&&s<=57?1==o&&(i.push([desktop.m.KeyAction.UP,16]),o=!1):DeskTypeTranslate[s]?(1==o&&(i.push([desktop.m.KeyAction.UP,16]),o=!1),r=DeskTypeTranslate[s]):DeskTypeShiftTranslate[s]&&(0==o&&(i.push([desktop.m.KeyAction.DOWN,16]),o=!0),r=DeskTypeShiftTranslate[s]),i.push([desktop.m.KeyAction.DOWN,r],[desktop.m.KeyAction.UP,r])}1==o&&(i.push([desktop.m.KeyAction.UP,16]),o=!1),desktop.m.SendKeyMsgKC(i)}}function showDeskClip(){var e;xxdialogMode||null==desktop||3!=desktop.State||(Q("DeskClip").blur(),e="",0==(2048&features2)&&(e+='<input id=dlgClipGet type=button value="Ottieni Appunti" style=width:160px onclick=showDeskClipGet()>'),0==(4096&features2)&&(e+='<input id=dlgClipSet type=button value="Imposta appunti" style=width:160px onclick=showDeskClipSet()>'),xxdialogTag="clipboard",setModalContent("xxAddAgent","Appunti remoti",e=(e+='<div id=dlgClipStatus style="display:inline-block;margin-left:8px" ></div>')+'<textarea id=d2clipText style="width:100%;height:184px;resize:none" maxlength=65535></textarea>'+'<input type=button value="Close" style=width:80px;float:right onclick=dialogclose(0)><div style=height:26px;margin-top:3px><span id=linuxClipWarn style=display:none>Gli appunti remoti sono validi per 60 secondi.</span>&nbsp;</div><div></div>'),showModal("xxAddAgentModal","idx_dlgOkButton"),Q("d2clipText").focus())}function showDeskClipGet(){null!=desktop&&3==desktop.State&&meshserver.send({action:"msg",type:"getclip",nodeid:currentNode._id,tag:1})}function showDeskClipSet(){null!=desktop&&3==desktop.State&&(desktop.m.setClipboard?desktop.m.setClipboard(Q("d2clipText").value):(meshserver.send({action:"msg",type:"setclip",nodeid:currentNode._id,data:Q("d2clipText").value}),QV("linuxClipWarn",currentNode&&currentNode.agent&&4<currentNode.agent.id&&21!=currentNode.agent.id&&22!=currentNode.agent.id&&34!=currentNode.agent.id)))}function sendCAD(){xxdialogMode||null==desktop||3!=desktop.State||desktop.m.sendcad()}function toggleDeskTools(){Q("DeskToolsButton").blur(),xxdialogMode||("none"==QS("DeskTools").display?(QV("DeskTools",!0),Q("DeskTools").nodeid=currentNode._id,QH("DeskToolsProcesses",""),QH("DeskToolsServices",""),QV("deskToolsTopTabService",!1),changeDeskToolTab(0),refreshDeskTools(0),refreshDeskTools(1)):QV("DeskTools",!1))}var deskToolTabSelection=0;function changeDeskToolTab(e){deskToolTabSelection=e,QV("DeskToolsProcessTab",0==e),QV("DeskToolsServiceTab",1==e),QS("deskToolsTopTabProcess").bottom=0==e?"0px":"3px",QS("deskToolsTopTabService").bottom=1==e?"0px":"3px",QS("deskToolsTopTabProcess").color=0==e?"black":"gray",QS("deskToolsTopTabService").color=1==e?"black":"gray"}function refreshDeskTools(e){e=null==e?deskToolTabSelection:e;QV("DeskToolsRefreshButton",!1),setTimeout(refreshDeskToolsEx,500),0==e&&meshserver.send({action:"msg",type:"ps",nodeid:currentNode._id}),1==e&&meshserver.send({action:"msg",type:"services",nodeid:currentNode._id})}function refreshDeskToolsEx(){QV("DeskToolsRefreshButton",!0)}var deskTools={sort:1,ssort:1,msg:null,smsg:null,resizing:!1};function sortProcess(e){deskTools.sort=e,showDeskToolsProcesses(deskTools.msg)}function sortService(e){deskTools.ssort=e,showDeskToolsServices(deskTools.smsg)}function sortProcessPid(e,t){return e.p>t.p?1:e.p<t.p?-1:sortProcessName(e,t)}function sortProcessName(e,t){return e.d>t.d?1:e.d<t.d?-1:0}function showDeskToolsProcesses(e){if(null==(deskTools.msg=e))QH("DeskToolsProcesses","");else if(Q("DeskTools").nodeid==e.nodeid){var t=[],i=null;try{i=JSON.parse(e.value)}catch(e){}if(null!=i){for(var o in i)t.push({p:parseInt(o),c:i[o].cmd,d:i[o].cmd.toLowerCase(),u:i[o].user});0==deskTools.sort?t.sort(sortProcessPid):1==deskTools.sort&&t.sort(sortProcessName);var n,a,s="";for(n in t)0!=t[n].p&&(a=t[n].c,s=(s=(s=(s=(s+="<div onclick=showProcessDetails("+t[n].p+') class="deskToolsBar d-flex">')+'<div class="pe-1 text-start" style=width:50px;>'+EscapeHtml(t[n].p)+"</div>")+'<div style="white-space:nowrap;overflow:hidden;text-overflow:ellipsis;" title="'+EscapeHtml(a)+'">'+a+"</div>")+'<div class="ms-auto">'+(t[n].u?EscapeHtml(t[n].u):""))+'<i class="ps-1 fa-solid fa-trash-can" role="button" title="Interrompi processo" onclick=\'return stopProcess('+EscapeHtml(t[n].p)+',"'+EscapeHtml(t[n].c)+"\")'></i></div></div>");QH("DeskToolsProcesses",s)}}}function showProcessDetails(e){xxdialogMode||(setModalContent("xxAddAgent",format("Dettagli processo, #{0}",e),"Requesting Process Details..."),xxdialogTag="ps|"+currentNode._id+"|"+e,showModal("xxAddAgentModal","idx_dlgOkButton"),meshserver.send({action:"msg",type:"psinfo",nodeid:currentNode._id,pid:e}))}function showDeskToolsServices(e){if(null==(deskTools.smsg=e))QH("DeskToolsProcesses","");else if(Q("DeskTools").nodeid==e.nodeid){QV("deskToolsTopTabService",!0);var t=[],i=null;try{i=JSON.parse(e.value)}catch(e){}if(null!=(deskTools.services=i)){for(var o in i)i[o].status?t.push({p:capitalizeFirstLetter(i[o].status.state.toLowerCase()),d:i[o].displayName,i:o}):i[o].serviceType&&t.push({p:i[o].serviceType,d:i[o].name,i:o});0==deskTools.ssort?t.sort(sortProcessPid):1==deskTools.ssort&&t.sort(sortProcessName);var n,a,s="";for(o in t)0!=t[o].p&&(n=t[o].d,"Stopped"==(a=t[o].p)?a="Fermato":"Running"==a&&(a="In esecuzione"),s=(s=(s+="<div onclick=showServiceWaitDialog("+t[o].i+") class=deskToolsBar>")+"<div style=width:70px;float:left;padding-right:5px>"+EscapeHtml(a)+"</div>")+'<div style="white-space:nowrap;overflow:hidden;text-overflow:ellipsis" title="'+n+'">'+EscapeHtml(n)+"</div></div>");QH("DeskToolsServices",s)}}}function showServiceDetailsDialog(e){var t,i,o;xxdialogMode&&-1!=xxdialogTag.indexOf("service_")&&(t=xxdialogTag.replace("service_",""),i=e.value?JSON.parse(e.value):deskTools.services[t],e.value&&(i.displayName=deskTools.services[t].displayName),null!=i)&&(e="",i.name&&(e+=addHtmlValue("Nome",i.name)),i.displayName&&(e+=addHtmlValue("Nome da visualizzare",i.displayName)),i.status&&("Stopped"==(o=capitalizeFirstLetter(i.status.state.toLowerCase()))?o="Fermato":"Running"==o&&(o="In esecuzione"),i.status.state&&(e+=addHtmlValue("Stato",o)),i.status.pid&&(e+=addHtmlValue("PID",i.status.pid)),o=[],!0===i.status.isFileSystemDriver&&o.push("FileSystemDriver"),!0===i.status.isInteractive&&o.push("Interattivo"),!0===i.status.isKernelDriver&&o.push("KernelDriver"),!0===i.status.isOwnProcess&&o.push("ProprioProcesso"),!0===i.status.isSharedProcess&&o.push("Processo Condiviso"),0<o.length)&&(e+=addHtmlValue("Digita",o.join(", "))),i.startType&&(e+=addHtmlValue("Start Type",i.startType)),i.user&&(e+=addHtmlValue("Utente",i.user)),i.installedBy&&(e+=addHtmlValue("Installed By",i.installedBy)),i.installedDate&&(e+=addHtmlValue("Installed Date",printDateTime(new Date(i.installedDate)))),i.failureActions&&(i.failureActions.resetPeriod&&(e+=addHtmlValue("Restart Fail Count After ",(o=(i.failureActions.resetPeriod<86400?0:i.failureActions.resetPeriod)/86400)+" Day"+(1!=o?"s":""))),i.failureActions.actions)&&(i.failureActions.actions[0]&&(e+=addHtmlValue("First Failure",i.failureActions.actions[0].type)),i.failureActions.actions[1]&&(e+=addHtmlValue("Second Failure",i.failureActions.actions[1].type)),i.failureActions.actions[2])&&(e+=addHtmlValue("Subsequent Failures",i.failureActions.actions[2].type)),xxdialogTag="service_"+t,setModalContent("xxAddAgent","Dettagli del servizio",e+='<br/><div style=float:right;margin-bottom:12px><input type=button value="Chiudere" onclick=showServiceDetailsDialogEx(0,'+t+')></div><div style=margin-bottom:12px><input type=button value="Inizio" onclick=showServiceDetailsDialogEx(1,'+t+')><input type=button value="Stop" onclick=showServiceDetailsDialogEx(2,'+t+')><input type=button value="Riavvia" onclick=showServiceDetailsDialogEx(3,'+t+")></div>"),showModal("xxAddAgentModal","idx_dlgOkButton"))}function showServiceWaitDialog(e){var t;return xxdialogMode||null!=(t=deskTools.services[e])&&(meshserver.send({action:"msg",type:"service",nodeid:currentNode._id,serviceName:t.name}),xxdialogTag="service_"+e,setModalContent("xxAddAgent","Dettagli del servizio","Requesting Service Details..."),showModal("xxAddAgentModal","idx_dlgOkButton")),!1}function showServiceDetailsDialogEx(e,t){setDialogMode(0),0!=e&&null!=(t=deskTools.services[t])&&(1==e&&meshserver.send({action:"msg",type:"serviceStart",nodeid:currentNode._id,serviceName:t.name}),2==e&&meshserver.send({action:"msg",type:"serviceStop",nodeid:currentNode._id,serviceName:t.name}),3==e&&meshserver.send({action:"msg",type:"serviceRestart",nodeid:currentNode._id,serviceName:t.name}),setTimeout(function(){refreshDeskTools(1)},1e3))}function toggleKvmControl(){Q("DeskControl").blur(),putstore("DeskControl",Q("DeskControl").checked?1:0),QS("DeskControlSpan").color=Q("DeskControl").checked?null:"red"}function deskRecordSession(){var e;null!=desktop&&(null==desktop.m.recordedData?(Q("DeskRecordButtonImage").style.color="red",desktop.m.StartRecording()):(Q("DeskRecordButtonImage").style.color="",e=new Date,e="Sessione desktop-"+currentNode.name+"-"+e.getFullYear()+"-"+("0"+(e.getMonth()+1)).slice(-2)+"-"+("0"+e.getDate()).slice(-2)+"-"+("0"+e.getHours()).slice(-2)+"-"+("0"+e.getMinutes()).slice(-2),saveAs(data2blob(desktop.m.StopRecording().join("")),e+".mcrec")))}function deskSaveImage(){var e,t;xxdialogMode||null==desktop||3!=desktop.State||(e=new Date,t="Desktop-"+currentNode.name+"-"+e.getFullYear()+"-"+("0"+(e.getMonth()+1)).slice(-2)+"-"+("0"+e.getDate()).slice(-2)+"-"+("0"+e.getHours()).slice(-2)+"-"+("0"+e.getMinutes()).slice(-2),Q("Desk").toBlob(function(e){saveAs(e,t+".png")}))}function deskDisplayInfo(e,t,i){var o,n=0,a="";for(o in t){n++;var s=t[o],r=1,s=("All Displays"==s&&(s="Tutti i display",r=2),s.startsWith("Display ")&&(s=format("Display {0}",s.substring(8))),"id=DeskMonitorSelectionX"+o+' title="'+EscapeHtml(s)+'" onclick=deskSetDisplay('+o+") role=button");a+=2==r?"<span "+s+' class="fa-layers fa-fw '+(i==o?"":" gray")+'"><i class="fa-solid fa-desktop"></i><i class="fa-solid fa-square" data-fa-transform="shrink-12 left-3 up-3"></i><i class="fa-solid fa-square" data-fa-transform="shrink-12 right-3 up-3"></i></span>':"<i "+s+' class="fa-fw fa-solid fa-desktop '+(i==o?"":" gray")+'"></i>',deskPreferedStickyDisplay==o&&i!=deskPreferedStickyDisplay&&desktop.m.SetDisplay(o),deskPreferedStickyDisplay=-1}QH("DeskMonitorSelectionSpan",a),QV("DeskMonitorSelectionSpan",1<n)}function deskGetDisplayNumbers(e){desktop.m.GetDisplayNumbers()}Q("DeskTools").addEventListener("mousemove",function(e){e=e.clientX-Q("DeskTools").getBoundingClientRect().left;Q("DeskTools").style.cursor=e<5?"col-resize":"default"}),Q("DeskTools").addEventListener("mousedown",function(e){"col-resize"===Q("DeskTools").style.cursor&&(deskTools.resizing=!0,Q("Desk").removeAttribute("onmouseup"),Q("Desk").removeAttribute("onmousedown"),Q("Desk").removeAttribute("onmousemove"))}),document.addEventListener("mouseup",function(){!0===deskTools.resizing&&"col-resize"===Q("DeskTools").style.cursor&&(deskTools.resizing=!1)}),document.addEventListener("mousemove",function(e){deskTools.resizing&&(e=Q("DeskTools").getBoundingClientRect().right-e.clientX)<Q("DeskParent").clientWidth-10&&(Q("DeskTools").style.width=e+"px")});var deskPreferedStickyDisplay=-1;function deskSetDisplay(e){desktop.m.SetDisplay(deskPreferedStickyDisplay=parseInt(e))}var terminalNode,dblClickDetectArgs={t:0,x:0,y:0};function dblClickDetect(e){var t;1==e.buttons&&((t=Date.now())-dblClickDetectArgs.t<250&&Math.abs(e.clientX-dblClickDetectArgs.x)<2&&Math.abs(e.clientY-dblClickDetectArgs.y)<2&&!xxdialogMode&&null!=desktop&&Q("DeskControl").checked&&(null!=webRtcDesktop&&null!=webRtcDesktop.softdesktop?(webRtcDesktop.softdesktop.m.mousedblclick(e),desktop.m.sendKeepAlive()):desktop.m.mousedblclick(e)),dblClickDetectArgs.t=t,dblClickDetectArgs.x=e.clientX,dblClickDetectArgs.y=e.clientY)}function dmousedown(e){setSessionActivity(),e.addx=Q("DeskParent").scrollLeft,e.addy=Q("DeskParent").scrollTop,!xxdialogMode&&null!=desktop&&Q("DeskControl").checked&&(null!=webRtcDesktop&&null!=webRtcDesktop.softdesktop?(webRtcDesktop.softdesktop.m.mousedown(e),desktop.m.sendKeepAlive()):desktop.m.mousedown(e)),dblClickDetect(e)}function dmouseup(e){setSessionActivity(),e.addx=Q("DeskParent").scrollLeft,e.addy=Q("DeskParent").scrollTop,!xxdialogMode&&null!=desktop&&Q("DeskControl").checked&&(null!=webRtcDesktop&&null!=webRtcDesktop.softdesktop?(webRtcDesktop.softdesktop.m.mouseup(e),desktop.m.sendKeepAlive()):desktop.m.mouseup(e))}function dmousemove(e){setSessionActivity(),e.addx=Q("DeskParent").scrollLeft,e.addy=Q("DeskParent").scrollTop,!xxdialogMode&&null!=desktop&&Q("DeskControl").checked?(Q("Desk").style.cursor="",null!=webRtcDesktop&&null!=webRtcDesktop.softdesktop?(webRtcDesktop.softdesktop.m.mousemove(e),desktop.m.sendKeepAlive()):desktop.m.mousemove(e)):xxdialogMode||null==desktop||Q("DeskControl").checked||(Q("Desk").style.cursor="not-allowed")}function dmousewheel(e){return setSessionActivity(),e.addx=Q("DeskParent").scrollLeft,e.addy=Q("DeskParent").scrollTop,!(xxdialogMode||null==desktop||!Q("DeskControl").checked||(null!=webRtcDesktop&&null!=webRtcDesktop.softdesktop?(webRtcDesktop.softdesktop.m.mousewheel(e),desktop.m.sendKeepAlive()):desktop.m.mousewheel&&desktop.m.mousewheel(e),haltEvent(e),0))}function drotate(e){xxdialogMode||null==desktop||(desktop.m.setRotation(desktop.m.rotation+e),deskAdjust(),deskAdjust())}function stopProcess(e,t){return setModalContent("xxAddAgent","Controllo di processo",format('Arrestare il processo #{0} "{1}"?',e,t)),showModal("xxAddAgentModal","idx_dlgOkButton",()=>stopProcessEx(3,e)),!1}function stopProcessEx(e,t){meshserver.send({action:"msg",type:"pskill",nodeid:currentNode._id,value:t}),setTimeout(refreshDeskTools,300)}function setupTerminal(){terminalNode!=currentNode&&null!=terminal&&terminalNode._id!=currentNode._id&&(terminal.Stop(),terminal=terminalNode=null),terminalNode=currentNode,updateTerminalButtons()}function updateTerminalButtons(){var e=null!=terminal&&0!=terminal.state,t=(3==terminalNode.mtype&&null!=terminalNode.agent&&4<terminalNode.agent.id&&512&features2&&(terminalNode.agent.caps=6),QV("disconnectbutton2span",1==e),QV("connectbutton2span",0==e&&null!=terminalNode.agent&&2&terminalNode.agent.caps&&3!=terminalNode.mtype),QV("connectbutton2sspan",512&features2&&0==e&&null!=terminalNode.agent&&2&terminalNode.agent.caps&&3!=terminalNode.agent.id&&0==(16777216&features2)),1==terminalNode.mtype?(QV("connectbutton2hspan",0==e&&null!=terminalNode.intelamt&&2==terminalNode.intelamt.state),QV("terminalSizeDropDown",0==e&&null!=terminalNode.intelamt&&2==terminalNode.intelamt.state)):(QV("connectbutton2hspan",0==e&&null!=terminalNode.intelamt&&2==terminalNode.intelamt.state&&null!=terminalNode.intelamt.ver),QV("terminalSizeDropDown",0==e&&null!=terminalNode.intelamt&&2==terminalNode.intelamt.state&&null!=terminalNode.intelamt.ver)),QV("termActionsBtn",3!=terminalNode.mtype),1==e&&3!=terminal.contype||null==terminalNode.agent||3==terminalNode.agent.id||4==terminalNode.agent.id?QH("terminalCustomUpperRight",""):QH("terminalCustomUpperRight","<a style=cursor:pointer onclick=cmsshportaction(1,event)>"+format("Porta SSH {0}",terminalNode.sshport||22)+"</a>"),0!=(1&terminalNode.conn)||3==terminalNode.mtype),t=(QE("connectbutton2",t),QE("connectbutton2d",t),QE("connectbutton2s",t),QE("connectbutton2sd",t),0!=(6&terminalNode.conn)),t=(QE("connectbutton2h",t),QE("ctrlcbutton",e),QE("ctrlxbutton",e),QE("escbutton",e),QE("bsbutton",e),QE("pastebutton",e),QE("specialkeylist",e),QE("specialkeylistinput",e),QV("terminalSettingsButtons",terminal&&2==terminal.contype),terminal&&(Q("id_ttypebutton").value=terminalEmulations[terminal.m.terminalEmulation],Q("id_tfxkeysbutton").value=fxEmulations[terminal.m.fxEmulation],Q("id_tcrbutton").value="\r\n"==terminal.m.lineFeed?"CR+LF":"LF"),!(0===args.xterm||null!=terminal&&null==xterm));QV("termarea3xdiv",t),QV("Term",!t),QV("bsbutton",!t),QV("pastebutton",!t),QV("devListToolbarViewIcons2",t),QE("termSizeList",null==terminal)}function onTerminalStateChange(e,t){if(terminal==e){var i=t,o=(3==i&&2==e.contype&&i++,StatusStrs[i]);switch(3==i&&(3==e.contype&&(o+=", SSH"),1==e.webRtcActive)&&(o+=", WebRTC"),QH("termstatus",o),t){case 0:if(QH("termtitle",""),QV("termRecordIcon",!1),null==xterm)try{e.m.TermResetScreen(),e.m.TermDraw()}catch(e){}else xterm.dispose(),xterm=xtermfit=null;null!=e&&(e.Stop(),terminal=null);break;case 3:e&&1==e.serverIsRecording&&QV("termRecordIcon",!0),e.startTime=new Date,null==updateSessionTimer&&(updateSessionTimer=setInterval(updateSessionTime,1e3)),null!=xterm&&xterm.focus()}updateTerminalButtons()}}var autoConnectTerminalTimer=null;function autoConnectTerminal(e){autoConnectTerminalTimer=null==autoConnectTerminalTimer?setInterval(connectTerminal,100):(clearInterval(autoConnectTerminalTimer),null)}function CreateRemoteTunnel(e,t){var i={protocol:1};return null!=t&&"number"==typeof t.protocol&&(i.protocol=t.protocol),i.onTunnelUpdate=e,i.xxStateChange=function(e){},i.ProcessBinaryData=function(e){i.onTunnelUpdate(e)},i.ProcessData=function(e){i.onTunnelUpdate(e)},i.terminalEmulation=1,i.fxEmulation=0,i.lineFeed="\r\n",i}function tunnelUpdate(e){null!=xterm&&(xterm.writeUtf8?"string"==typeof e?xterm.writeUtf8(e):xterm.writeUtf8(new Uint8Array(e)):"string"==typeof e?xterm.write(e):xterm.write(new Uint8Array(e)))}function sshTunnelAuthDialog(e,t){function i(e,t){document.getElementById("xxAddAgentModal").removeEventListener("hide.bs.modal",i),connectTerminal()}var o="";e.askkeypass?o+=addHtmlFormFloating("Autenticazione",'<select id=dp2authmethod class="form-select" onchange=sshAuthUpdate(event)><option value=3 selected>Chiave memorizzata</option><option value=1>Nome utente e password</option><option value=2>Nome utente e chiave</option></select>'):o+=addHtmlFormFloating("Autenticazione",'<select id=dp2authmethod class="form-select" onchange=sshAuthUpdate(event)><option value=1 selected>Nome utente e password</option><option value=2>Nome utente e chiave</option></select>'),o=(o=(o+="<div id=d2userauth style=display:none>")+addHtmlFormFloating("Nome utente",'<input id=dp2user class="form-control" maxlength=64 autocomplete=off onkeyup=sshAuthUpdate(event) />')+"</div><div id=d2passauth style=display:none>")+addHtmlFormFloating("Password",'<input type=password id=dp2pass class="form-control" maxlength=64 autocomplete=off onkeyup=sshAuthUpdate(event) />'),0==(4194304&features2)&&(o+=addHtmlValue("",'<label><input id=dp2keep type=checkbox class="form-check-input me-2">Ricorda le credenziali</label>')),o=(o=(o+="</div><div id=d2keyauth style=display:none>")+addHtmlValue("File chiave",'<input type=file id=dp2key class="form-control" maxlength=64 autocomplete=off onchange=sshAuthUpdate(event) /><div id=d2badkey style=font-size:x-small>Il file chiave deve essere in formato OpenSSH.</div>'))+addHtmlFormFloating("Password chiave",'<input type=password id=dp2keypass class="form-control" maxlength=64 autocomplete=off onkeyup=sshAuthUpdate(event) />'),0==(4194304&features2)&&(o=(o+=addHtmlValue("",'<label><input id=dp2keep1 type=checkbox class="form-check-input me-2" onchange=sshAuthUpdate(event)>Ricorda utente e chiave</label>'))+addHtmlValue("",'<label><input id=dp2keep2 type=checkbox class="form-check-input me-2">Ricordare la password</label>')),o+="</div>",setModalContent("xxAddAgent","Autenticazione",o=e.askkeypass?(o+="<div id=d2keyauth2 style=display:none>")+addHtmlFormFloating("Password",'<input type=password id=dp2keypass2 class="form-control" maxlength=64 autocomplete=off onkeyup=sshAuthUpdate(event) />')+"</div>":o);document.getElementById("xxAddAgentModal").addEventListener("hide.bs.modal",i),showModal("xxAddAgentModal","idx_dlgOkButton",()=>{document.getElementById("xxAddAgentModal").removeEventListener("hide.bs.modal",i),t(11,"ssh")}),Q("dp2user").focus(),sshAuthUpdate(),setTimeout(sshAuthUpdate,50)}function sshTunnelUpdate(e){if("string"==typeof e)if("{"==e[0]){var t=JSON.parse(e);switch(t.action){case"sshauth":sshTunnelAuthDialog(t,sshConnectEx);break;case"sshautoauth":terminal.socket.send(JSON.stringify({action:"sshautoauth",cols:xterm.cols,rows:xterm.rows,width:Q("termarea3xdiv").offsetWidth,height:Q("termarea3xdiv").offsetHeight}));break;case"connectionerror":p12setConsoleMsg("Errore di connessione",5e3);break;case"autherror":p12setConsoleMsg("Errore di autenticazione",5e3);break;case"sessionerror":p12setConsoleMsg("Sessione scaduta",5e3);break;case"sessiontimeout":p12setConsoleMsg("Timeout della sessione",5e3)}}else"~"==e[0]&&(xterm.writeUtf8?xterm.writeUtf8(e.substring(1)):xterm.write(e.substring(1)))}function sshAuthUpdate(e){var t;QV("d2userauth",3!=Q("dp2authmethod").value),QV("d2passauth",1==Q("dp2authmethod").value),QV("d2keyauth",2==Q("dp2authmethod").value),QV("d2keyauth2",3==Q("dp2authmethod").value),1==Q("dp2authmethod").value?QE("idx_dlgOkButton",0<Q("dp2user").value.length&&0<Q("dp2pass").value.length):3==Q("dp2authmethod").value?QE("idx_dlgOkButton",0<Q("dp2keypass2").value.length):(QE("idx_dlgOkButton",!1),0==(4194304&features2)&&QE("dp2keep2",Q("dp2keep1").checked),1==(0<Q("dp2user").value.length&&null!=Q("dp2key").files&&1==Q("dp2key").files.length&&Q("dp2key").files[0].size<8e3)&&((t=new FileReader).onload=function(e){e=0<=e.target.result.indexOf("-----BEGIN OPENSSH PRIVATE KEY-----")&&0<=e.target.result.indexOf("-----END OPENSSH PRIVATE KEY-----")||0<=e.target.result.indexOf("-----BEGIN RSA PRIVATE KEY-----")&&0<=e.target.result.indexOf("-----END RSA PRIVATE KEY-----");QE("idx_dlgOkButton",e),QS("d2badkey").color=e?"#000":"#F00"},t.readAsText(Q("dp2key").files[0]))),e&&13==e.keyCode&&e.target&&1==Q("dp2authmethod").value&&("dp2user"==e.target.id&&Q("dp2pass").focus(),"dp2pass"==e.target.id)&&dialogclose(1)}function sshConnectEx(e){var t,i,o;0==e?null!=terminal&&connectTerminal():(t=0,1==Q("dp2authmethod").value?(0==(4194304&features2)&&(t=Q("dp2keep").checked?1:0),terminal.socket.send(JSON.stringify({action:"sshauth",username:Q("dp2user").value,password:Q("dp2pass").value,keep:t,cols:xterm.cols,rows:xterm.rows,width:Q("termarea3xdiv").offsetWidth,height:Q("termarea3xdiv").offsetHeight}))):3==Q("dp2authmethod").value?terminal.socket.send(JSON.stringify({action:"sshkeyauth",keypass:Q("dp2keypass2").value,cols:xterm.cols,rows:xterm.rows,width:Q("termarea3xdiv").offsetWidth,height:Q("termarea3xdiv").offsetHeight})):(0==(4194304&features2)&&1==(t=Q("dp2keep1").checked?1:0)&&(t+=Q("dp2keep2").checked?1:0),e=new FileReader,i=Q("dp2user").value,o=Q("dp2keypass").value,e.onload=function(e){terminal.socket.send(JSON.stringify({action:"sshauth",username:i,keypass:o,key:e.target.result,keep:t,cols:xterm.cols,rows:xterm.rows,width:Q("termarea3xdiv").offsetWidth,height:Q("termarea3xdiv").offsetHeight}))},e.readAsText(Q("dp2key").files[0])))}function xTermSendResize(){(xtermResizeTimer=null)!=xterm&&null!=terminal&&null!=terminal.sendCtrlMsg&&("sshterminalrelay.ashx"==terminal.urlname?terminal.socket.send(JSON.stringify({action:"resize",cols:xterm.cols,rows:xterm.rows,width:Q("termarea3xdiv").offsetWidth,height:Q("termarea3xdiv").offsetHeight})):terminal.sendCtrlMsg(JSON.stringify({ctrlChannel:"102938",type:"termsize",cols:xterm.cols,rows:xterm.rows})))}function connectTerminal(e,t,i){if(p12clearConsoleMsg(),terminal)"ssh"==xxdialogTag&&setDialogMode(0),terminal.Stop(),terminal=null,fullscreen&&deskToggleFull();else if(2==t){if(null==terminalNode.intelamt.user||""==terminalNode.intelamt.user)return void editDeviceAmtSettings(terminalNode._id,connectTerminal,2);var o={};1==Q("termSizeList").value?(o.cols=80,o.rows=25):2==Q("termSizeList").value&&(o.cols=100,o.rows=30),fullscreen&&deskToggleFull(),QV("termarea3xdiv",!1),QV("Term",!0),(terminal=CreateAmtRedirect(CreateAmtRemoteTerminal("Term",o),authCookie)).debugmode=debugmode,terminal.m.debugmode=debugmode,terminal.m.onTitleChange=function(e,t){QH("termtitle"," - "+EscapeHtml(t))},terminal.onStateChanged=onTerminalStateChange,terminal.Start(terminalNode._id,16994,"*","*",0),terminal.contype=2,Q("id_ttypebutton").value=terminalEmulations[terminal.m.terminalEmulation]}else{o={protocol:null!=i&&"number"==typeof i.protocol?i.protocol:1};i&&i.requireLogin&&(o.requireLogin=!0),i&&i.consent&&(o.consent=i.consent),-1==[1,2,3,4,21,22].indexOf(currentNode.agent.id)&&(1==Q("termSizeList").value?(o.cols=80,o.rows=25,o.xterm=!0):2==Q("termSizeList").value?(o.cols=100,o.rows=30,o.xterm=!0):3==Q("termSizeList").value&&(o.cols=Math.floor((Q("column_l").clientWidth-60)/10),o.rows=Math.floor((Q("column_l").clientHeight-120)/20),o.xterm=!0)),e&&1==e.shiftKey&&(4<currentNode.agent.id?1==o.protocol&&(o.protocol=7):1==o.protocol&&(o.protocol=6)),null!=serverinfo.linuxshell&&4<currentNode.agent.id&&("root"==serverinfo.linuxshell&&(o.protocol=1,delete o.requireLogin),"user"==serverinfo.linuxshell&&(o.protocol=8,delete o.requireLogin),"login"==serverinfo.linuxshell)&&(o.protocol=1,o.requireLogin=!0),0!==args.xterm?(QV("termarea3xdiv",!0),QV("Term",!1),null!=xterm&&xterm.dispose(),xtermfit=new FitAddon.FitAddon,xterm=new Terminal,xtermfit&&xterm.loadAddon(xtermfit),xterm.open(Q("termarea3xdiv")),xterm.onData(function(e){null!=terminal&&("sshterminalrelay.ashx"==terminal.urlname?terminal.socket.send("~"+e):terminal.sendText(e))}),xtermfit&&xtermfit.fit(),xterm.onTitleChange(function(e){QH("termtitle"," - "+EscapeHtml(e))}),xterm.onResize(function(e){xtermResizeTimer&&clearTimeout(xtermResizeTimer),xtermResizeTimer=setTimeout(xTermSendResize,200)}),o.cols=xterm.cols,o.rows=xterm.rows,terminal=CreateAgentRedirect(meshserver,CreateRemoteTunnel(3==t?sshTunnelUpdate:tunnelUpdate,o),serverPublicNamePort,authCookie,authRelayCookie,domainUrl),3==t&&(terminal.urlname="sshterminalrelay.ashx"),terminal.debugmode=debugmode,terminal.m.debugmode=debugmode,(terminal.options=o).requireLogin&&(terminal.options.requireLogin=!0),terminal.Start(terminalNode._id),terminal.onStateChanged=onTerminalStateChange,terminal.contype=t,terminal.attemptWebRTC=!1,terminal.onConsoleMessageChange=function(){p12setConsoleMsg(terminal.consoleMessage?formatAgentConsoleMessage(terminal.consoleMessage,terminal.consoleMessageId,terminal.consoleMessageArgs):null,terminal.consoleMessageTimeout)}):(QV("termarea3xdiv",!1),QV("Term",!0),(terminal=CreateAgentRedirect(meshserver,CreateAmtRemoteTerminal("Term",o),serverPublicNamePort,authCookie,authRelayCookie,domainUrl)).options=o,terminal.debugmode=debugmode,terminal.m.debugmode=debugmode,terminal.m.onTitleChange=function(e,t){QH("termtitle"," - "+EscapeHtml(t))},terminal.m.lineFeed=0<=[1,2,3,4,21,22].indexOf(currentNode.agent.id)?"\r\n":"\r",terminal.attemptWebRTC=!1,terminal.onStateChanged=onTerminalStateChange,terminal.onConsoleMessageChange=function(){p12setConsoleMsg(terminal.consoleMessage?formatAgentConsoleMessage(terminal.consoleMessage,terminal.consoleMessageId,terminal.consoleMessageArgs):null,terminal.consoleMessageTimeout)},terminal.Start(terminalNode._id),terminal.contype=t,terminal.m.terminalEmulation=0,terminal.m.fxEmulation=0,Q("id_ttypebutton").value=terminalEmulations[0])}Q("connectbutton2").blur()}var terminalEmulations=["Terminale UTF8 ","ASCII esteso","Intel ASCII"];function termToggleType(){terminal&&!xxdialogMode&&(terminal.m.terminalEmulation=(terminal.m.terminalEmulation+1)%3,Q("id_ttypebutton").value=terminalEmulations[terminal.m.terminalEmulation],Q("id_ttypebutton").blur())}var filesNode,fxEmulations=["Intel (F10 = ESC + [OM)","Alternativo (F10 = ESC + 0)","VT100+ (F10 = ESC+[OY)"];function termToggleFx(){terminal&&!xxdialogMode&&(terminal.m.fxEmulation=(terminal.m.fxEmulation+1)%3,Q("id_tfxkeysbutton").value=fxEmulations[terminal.m.fxEmulation],Q("id_tfxkeysbutton").blur())}function termToggleCr(){terminal&&!xxdialogMode&&("\n"==terminal.m.lineFeed?terminal.m.lineFeed="\r\n":terminal.m.lineFeed="\n",Q("id_tcrbutton").value="\r\n"==terminal.m.lineFeed?"CR+LF":"LF")}function termSendKey(e,t){terminal&&!xxdialogMode&&(null!=xterm?("sshterminalrelay.ashx"==terminal.urlname?terminal.socket.send("~"+String.fromCharCode(e)):terminal.sendText?terminal.sendText(String.fromCharCode(e)):terminal.send(String.fromCharCode(e)),xterm.focus()):null!=terminal&&(terminal.m.TermSendKey(e),Q(t).blur()))}function showTermPasteDialog(){terminal&&!xxdialogMode&&(Q("pastebutton").blur(),setModalContent("xxAddAgent","Incolla",'<textarea id=d2pasteText style="width:100%;height:184px;resize:none"></textarea>'),showModal("xxAddAgentModal","idx_dlgOkButton",()=>showTermPasteDialogEx()),Q("d2pasteText").focus())}function showTermPasteDialogEx(){terminal&&terminal.m.TermSendKeys(Q("d2pasteText").value)}function sendSpecialKey(){null!=xterm?("sshterminalrelay.ashx"==terminal.urlname?terminal.socket.send("~"+String.fromCharCode(Q("specialkeylist").value)):terminal.sendText(String.fromCharCode(Q("specialkeylist").value)),xterm.focus()):null!=terminal&&(terminal.m.TermSendKey(Q("specialkeylist").value),Q("specialkeylist").blur(),Q("specialkeylistinput").blur())}function setupFiles(){filesNode!=currentNode&&null!=files&&filesNode._id!=currentNode._id&&(files.Stop(),files=filesNode=null);var e=0!=(1&(filesNode=currentNode).conn)||3==filesNode.mtype;QE("p13Connect",e),QE("p13Connectdrop",e),QE("p13Connects",e),QE("p13Connectsdrop",e),QV("p13Connectspan",null==files&&2==filesNode.mtype),QV("p13Connectsspan",0!=(512&features2)&&null!=filesNode.agent&&3!=filesNode.agent.id&&4!=filesNode.agent.id&&0==(8388608&features2)),QV("p13Disconnect",null!=files),p13setActions()}function onFilesStateChange(e,t){setSessionActivity(),QV("p13Connectspan",0==t&&2==filesNode.mtype),QV("p13Connectsspan",0==t&&512&features2&&null!=filesNode.agent&&3!=filesNode.agent.id&&4!=filesNode.agent.id&&0==(8388608&features2)),QV("p13Disconnect",0!=t);var i=StatusStrs[t];switch(3==t&&(2==files.contype&&(i+=", SFTP"),1==files.webRtcActive)&&(i+=", WebRTC"),Q("p13Status").textContent=i,t){case 0:QH("p13files",""),p13filetree=null,p13filetreelocation=[],QH("p13currentpath",""),QE("p13FolderUp",!1),QV("filesRecordIcon",!1),p13setActions(),null!=files&&(files.Stop(),files=null),"fileMsgDialog"==xxdialogTag&&setDialogMode(0),null!=uploadFile&&(p13uploadFileTransferDone(),uploadFile=null);break;case 3:if(p13filetreelocation=[],p13targetpath="",files){var o=[];try{o=JSON.parse(getstore("_devFilePaths","[]"))}catch(e){}for(var n=0;n<o.length;n++)o[n].n==currentNode._id&&(p13targetpath=o[n].p);p13filetreelocation=p13targetpath.split("/"),files.sendText({action:"ls",reqid:1,path:p13targetpath}),1==files.serverIsRecording&&QV("filesRecordIcon",!0)}}}function CreateRemoteFiles(e){var t={protocol:5};return t.onFileUpdate=e,t.xxStateChange=function(e){},t.ProcessData=function(e){t.onFileUpdate(e)},t}var autoConnectFilesTimer=null;function autoConnectFiles(e){autoConnectFilesTimer=null==autoConnectFilesTimer?setInterval(connectFiles,100):(clearInterval(autoConnectFilesTimer),null)}function connectFiles(e,t,i){p13clearConsoleMsg(),files?(files.Stop(),files=null):(files=CreateAgentRedirect(meshserver,CreateRemoteFiles(p13gotFiles),serverPublicNamePort,authCookie,authRelayCookie,domainUrl),2==t&&(files.urlname="sshfilesrelay.ashx"),files.contype=t,files.options={consent:i},files.attemptWebRTC=attemptWebRTC,files.webrtcconfig=webrtcconfiguration,files.onStateChanged=onFilesStateChange,files.onConsoleMessageChange=function(){files.consoleMessage?(Q("p13FilesConsoleMsg").innerHTML+=formatAgentConsoleMessage(files.consoleMessage,files.consoleMessageId,files.consoleMessageArgs),QV("p13FilesConsoleMsg",!0),null!=p13FilesConsoleMsgTimer&&clearTimeout(p13FilesConsoleMsgTimer),files.consoleMessageTimeout&&(p13FilesConsoleMsgTimer=setTimeout(p13clearConsoleMsg,1e3*files.consoleMessageTimeout))):p13clearConsoleMsg()},files.Start(filesNode._id)),p13clipboard=p13clipboardFolder=null,p13clipboardCut=0,p13updateClipview()}var p13sortorder,p13filetree=null,p13targetpath=null,p13filetreelocation=[];function p13fileOperationDialogEx(e){0==e&&null!=files&&files.sendText({action:"cancel"})}function p13gotFiles(t){if(0<t.length&&123!=t.charCodeAt(0))p13gotDownloadBinaryData(t);else{try{t=JSON.parse(decode_utf8(t))}catch(e){try{t=JSON.parse(t)}catch(e){return void console.log("Unable to parse: "+t)}}if("download"==t.action)p13gotDownloadCommand(t);else if("findfile"==t.action)xxdialogTag==t.reqid&&(null==t.r?(QE("d2findFilter",!0),QE("filefind_dlgOkButton",!0),xxdialogTag=null,""==Q("d2findResults").innerHTML&&QH("d2findResults","<div style=text-align:center;margin:10px><i>Nessun file trovato </i></div>")):QA("d2findResults","<div style=white-space:nowrap>"+EscapeHtml(t.r)+"</div>"));else if(null!=t.action&&t.action.startsWith("upload"))p13gotUploadData(t);else{switch(t.action){case"sshauth":return void sshTunnelAuthDialog(t,p13sshConnectEx);case"autherror":return void p13setConsoleMsg("Errore di autenticazione",5e3);case"connectionerror":return void p13setConsoleMsg("Errore di connessione",5e3);case"sessionerror":return void p13setConsoleMsg("Sessione scaduta",5e3);case"sessiontimeout":return void p13setConsoleMsg("Timeout della sessione",5e3)}if("dialogmessage"==t.action)null==t.msg&&"fileMsgDialog"==xxdialogTag?setDialogMode(0):"zipping"!=t.msg||xxdialogMode&&"fileMsgDialog"!=xxdialogTag?"unzipping"!=t.msg||xxdialogMode&&"fileMsgDialog"!=xxdialogTag?"unziperror"!=t.msg||xxdialogMode&&"fileMsgDialog"!=xxdialogTag?"zippingFile"!=t.msg||xxdialogMode&&"fileMsgDialog"!=xxdialogTag||(setModalContent("xxAddAgent","Operazione sui file","<div style=margin:10px>"+EscapeHtml(t.file)+"</div><br /><progress value="+EscapeHtml(t.progress)+" style=width:100% max=100 />"),showModal("xxAddAgentModal","idx_dlgOkButton",()=>p13fileOperationDialogEx(10))):(setModalContent("xxAddAgent","Operazione sui file","<div style=margin:10px>Unzipping Error</div><br />"+EscapeHtml(t.error)),showModal("xxAddAgentModal","idx_dlgOkButton")):(setModalContent("xxAddAgent","Operazione sui file","<div style=margin:10px>Unzipping file...</div>"),showModal("xxAddAgentModal","idx_dlgOkButton")):(setModalContent("xxAddAgent","Operazione sui file","<div style=margin:10px>Compressione dei file ...</div>"),showModal("xxAddAgentModal","idx_dlgOkButton",()=>p13fileOperationDialogEx(10)));else if("refresh"==t.action)p13folderup(9999);else if(null!=t.path)if(null==t.dir)""!=p13targetpath&&p13folderup();else if(t.path=t.path.replace(/\//g,"\\"),null!=p13filetree&&t.path==p13filetree.path){var e=p13getCheckedNames();p13filetree=t,p13updateFiles(e)}else{for(var i=t.path.replace(/\//g,"\\"),o=p13targetpath.replace(/\//g,"\\");0<i.length&&"\\"==i[0];)i=i.substring(1);for(;0<o.length&&"\\"==o[0];)o=o.substring(1);(i==o||"\\"==t.path&&""==p13targetpath)&&(p13filetree=t,p13updateFiles())}}}}function p13sshConnectEx(e){var t,i,o;0==e?null!=files&&connectFiles():(t=0,1==Q("dp2authmethod").value?(0==(4194304&features2)&&(t=Q("dp2keep").checked?1:0),files.socket.send(JSON.stringify({action:"sshauth",username:Q("dp2user").value,password:Q("dp2pass").value,keep:t}))):3==Q("dp2authmethod").value?files.socket.send(JSON.stringify({action:"sshkeyauth",keypass:Q("dp2keypass2").value})):(0==(4194304&features2)&&1==(t=Q("dp2keep1").checked?1:0)&&(t+=Q("dp2keep2").checked?1:0),e=new FileReader,i=Q("dp2user").value,o=Q("dp2keypass").value,e.onload=function(e){files.socket.send(JSON.stringify({action:"sshauth",username:i,keypass:o,key:e.target.result,keep:t}))},e.readAsText(Q("dp2key").files[0])))}function p13getCheckedNames(){for(var e=[],t=document.getElementsByName("fd"),i=0;i<t.length;i++)t[i].checked&&e.push(p13filetree.dir[t[i].value].n);return e}function p13updateFiles(e){var t="",i="",o='<a href=# style=cursor:pointer onclick="return p13folderup(0)">Root</a>';if(null!=p13filetree){var n=p13filetree.path.split("\\");for(v in p13filetreelocation=[],n)""!=n[v]&&p13filetreelocation.push(n[v]);for(v in p13filetreelocation)o+=' / <a href=# style=cursor:pointer onclick="return p13folderup('+(parseInt(v)+1)+')">'+EscapeHtml(p13filetreelocation[v])+"</a>";var a=p13filetreelocation.join("/"),s=p13sort_files(p13filetree.dir);for(v in s){var r=s[v],l=r.n,d=70<l.length?'<span title="'+EscapeHtml(l)+'">'+EscapeHtml(l.substring(0,70))+"...</span>":EscapeHtml(l),c="",u=(null!=r.d&&(u=new Date(r.d),c=printDateTime(u="number"==typeof r.d?new Date(1e3*r.d):u)+"&nbsp;"),"");if(null!=r.s){var p=["Bytes","KB","MB","GB","TB"];let e=parseInt(Math.floor(Math.log(Math.abs(r.s))/Math.log(1024)),10);var m=Q("p13sizedropdown").options[Q("p13sizedropdown").selectedIndex],u=0==Q("p13sizedropdown").value?0===r.s?"n/a":0===e?r.s+" "+p[e]:(r.s/1024**e).toFixed(2)+" "+p[e]:1==Q("p13sizedropdown").value?getFileSizeStr(r.s):(r.s/2**m.value).toFixed(2)+" "+m.title}p="";r.t<3?(p="<div class=filelist file=999>",p=(p+='<input file=999 style=float:left name=fd class=fcb type=checkbox class="form-check-input me-2" onchange=p13setActions() value=\''+r.nx+'\'>&nbsp;<span style=float:right title=""></span>')+"<span><div class=fileIcon"+("REMOVABLE"==r.dt?5:"CDROM"==r.dt?6:r.t)+' onclick=p13folderset("'+encodeURIComponentEx(r.nx)+'")></div><a href=# style=cursor:pointer onclick=\'return p13folderset("'+encodeURIComponentEx(r.nx)+"\")'>",isWindowsNode(currentNode)&&r.dt&&currentNode.volumes&&currentNode.volumes[d.charAt(0).toUpperCase()]&&currentNode.volumes[d.charAt(0).toUpperCase()].name?p+=currentNode.volumes[d.charAt(0).toUpperCase()].name+" ("+d+")":p+=d,p+="</a></span></div>"):(m=d,0<r.s&&(m=3==filesNode.mtype?"<a href=# style=cursor:pointer onclick=\"return p13downloadfile('"+encodeURIComponentEx(a+"/"+l)+"','"+encodeURIComponentEx(l)+"',"+r.s+')">'+d+"</a>":'<a onclick=downloadFile("devicefile.ashx?c='+authCookie+"&m="+currentNode.meshid.split("/")[2]+"&n="+currentNode._id.split("/")[2]+"&f="+encodeURIComponentEx(a+"/"+l)+'","'+encodeURIComponentEx(l)+'") style=cursor:pointer>'+d+"</a>"),p="<div id=fileEntry cmenu=filesContextMenu fileIndex="+v+' class=filelist file=3><input file=3 style=float:left name=fd class=fcb type=checkbox class="form-check-input me-2" onchange=p13setActions() value=\''+r.nx+"'>&nbsp;<span class=fsize>"+c+"</span><span style=float:right>"+EscapeHtml(u)+"</span><span><div class=fileIcon"+r.t+"></div>"+m+"</span></div>"),r.t<3?t+=p:i+=p}if(QH("p13files",t+i),QH("p13currentpath",o),QE("p13FolderUp",0!=p13filetreelocation.length),null!=e)for(var g=document.getElementsByName("fd"),v=0;v<g.length;v++)0<=e.indexOf(p13filetree.dir[g[v].value].n)&&(g[v].checked=!0);p13setActions()}}function p13openfilefolder(){setModalContent("xxAddAgent","Open File/Folder","Are you sure you want to open this file/folder on the remote devices desktop ?"),showModal("xxAddAgentModal","idx_dlgOkButton",()=>p13openfilefolderEx())}function p13openfilefolderEx(){for(var e="",t=document.getElementsByName("fd"),i=0;i<t.length;i++)t[i].checked&&(e=(isWindowsNode(currentNode)?"":"/")+p13filetreelocation.join(isWindowsNode(currentNode)?"\\":"/")+(isWindowsNode(currentNode)?"\\":"/")+p13filetree.dir[t[i].value].n);""!=e&&files.sendText({action:"open",reqid:1,path:e,dir:1==p13getFileSelDirCount()})}function p13gotofolder(){xxdialogButtons=3,setModalContent("xxAddAgent","Go To Folder",'<input type=text id=p13folderinput style=width:100% placeholder="'+(isWindowsNode(currentNode)?"C:\\":"/var/www")+'" />'),showModal("xxAddAgentModal","idx_dlgOkButton",p13gotofolderEx),focusTextBox("p13folderinput")}function p13gotofolderEx(){p13targetpath=Q("p13folderinput").value.split("\\").join("/"),files&&(p13storeCurrentPath(p13targetpath),files.sendText({action:"ls",reqid:1,path:p13targetpath}))}function p13folderset(e){p13targetpath=joinPaths(p13filetree.path,p13filetree.dir[e].n).split("\\").join("/"),files&&(p13storeCurrentPath(p13targetpath),files.sendText({action:"ls",reqid:1,path:p13targetpath}))}function p13folderup(e){if(null==e)p13filetreelocation.pop();else for(;p13filetreelocation.length>e;)p13filetreelocation.pop();return p13targetpath=p13filetreelocation.join("/"),files&&(p13storeCurrentPath(p13targetpath),files.sendText({action:"ls",reqid:1,path:p13targetpath})),!1}function p13storeCurrentPath(e){var t=[],i=-1;try{t=JSON.parse(getstore("_devFilePaths","[]"))}catch(e){}for(var o=0;o<t.length;o++)t[o].n==currentNode._id&&(i=o);for(0<=i&&t.splice(i,1),t.push({n:currentNode._id,p:e});40<t.length;)t.shift();putstore("_devFilePaths",JSON.stringify(t))}function p13findfile(){var e;xxdialogMode||(e=addHtmlFormFloating("Filtro",'<input id=d2findFilter class="form-control" onkeyup=p13findfileValidate() onkeydown=p13findfileDown(event) placeholder="*.txt"></input>'),setModalContent("xxAddAgent","Trova file",e=(e+='<div id=d2findResults style="width:100%;height:184px;background-color:white;border:1px solid black;padding:3px;overflow:scroll;margin-top:8px"></div>')+"<div style=margin-top:8px><input id=filefind_dlgCancelButton type=button value=Chiudere style=float:right;width:80px;margin-left:5px onclick=p13findfileCancel()>"+"<input id=filefind_dlgOkButton type=submit value=Ricerca style=float:right;width:80px onclick=p13findfileEx()><br /><br /></div>"),showModal("xxAddAgentModal","idx_dlgOkButton"),p13findfileValidate(),Q("d2findFilter").focus())}function p13findfileDown(e){"accedere"==e.code&&p13findfileEx()}function p13findfileValidate(){QE("filefind_dlgOkButton",0<Q("d2findFilter").value.length)}function p13findfileCancel(){null!=xxdialogTag&&files.sendText({action:"cancelfindfile",reqid:xxdialogTag}),dialogclose(0)}function p13findfileEx(e,t){var i,o,n;0!=Q("d2findFilter").value.length&&(i=0<currentNode.agent.id&&currentNode.agent.id<5||14==currentNode.agent.id||34==currentNode.agent.id,n=p13filetreelocation.join(o=i?"\\":"/")+o,i||(n=o+n),xxdialogTag="find:"+Math.random(),files.sendText({action:"findfile",reqid:xxdialogTag,path:n,filter:Q("d2findFilter").value}),QH("d2findResults",""),QE("d2findFilter",!1),QE("filefind_dlgOkButton",!1))}function p13sort_filename(e,t){return e.ln>t.ln?+p13sortorder:e.ln<t.ln?-1*p13sortorder:0}function p13sort_timestamp(e,t){return e.d>t.d?+p13sortorder:e.d<t.d?-1*p13sortorder:0}function p13sort_bysize(e,t){return e.s==t.s?p13sort_filename(e,t):(e.s-t.s)*p13sortorder}function p13sort_files(e){var t,i=[],o=Q("p13sortdropdown").value;for(t in e)e[t].nx=t,null==e[t].s&&(e[t].s=0),null==e[t].n&&(e[t].n=t),e[t].ln=e[t].n.toLowerCase(),i.push(e[t]);return p13sortorder=1,3<o&&(p13sortorder=-1,o-=3),1==o?i.sort(p13sort_filename):2==o?i.sort(p13sort_bysize):3==o&&i.sort(p13sort_timestamp),i}function p13setActions(){var e,t,i,o,n=null!=currentNode.agent&&14!=currentNode.agent.id;null==p13filetree?(QE("p13DeleteFileButton",!1),QE("p13NewFolderButton",!1),QE("p13UploadButton",!1),QE("p13RenameFileButton",!1),QE("p13ViewFileButton",!1),QE("p13SelectAllButton",!1),Q("p13SelectAllButton").value="Seleziona tutto",QE("p13RefreshButton",!1),QE("p13FindButton",!1),QE("p13CutButton",!1),QE("p13CopyButton",!1),QE("p13ZipButton",!1),QE("p13UnZipButton",!1),QE("p13PasteButton",!1),QE("p13GoToFolderButton",!1),QE("p13DownloadButton",!1),QE("p13OpenButton",!1)):(e=p13getFileSelCount(),t=p13getFileCount(),i=p13getFileSelCount(!1),o=0<currentNode.agent.id&&currentNode.agent.id<5||14==currentNode.agent.id||34==currentNode.agent.id,QE("p13DeleteFileButton",0<e&&(0<p13filetreelocation.length||0==o)),QE("p13NewFolderButton",n&&(0<p13filetreelocation.length||0==o)),QE("p13UploadButton",0<p13filetreelocation.length||0==o||14==currentNode.agent.id),QE("p13RenameFileButton",n&&1==e&&(0<p13filetreelocation.length||0==o)),QE("p13ViewFileButton",n&&1==e&&1==i&&(0<p13filetreelocation.length||0==o)),QE("p13SelectAllButton",0<t),Q("p13SelectAllButton").value=0<e?"Non selezionare niente":"Seleziona tutto",QE("p13RefreshButton",!0),QE("p13FindButton",n&&(0<p13filetreelocation.length||0==o)),QE("p13CutButton",n&&0<e&&e==i&&(0<p13filetreelocation.length||0==o)),QE("p13CopyButton",n&&0<e&&e==i&&(0<p13filetreelocation.length||0==o)),QE("p13ZipButton",n&&0<e&&(0<p13filetreelocation.length||0==o)),QE("p13UnzipButton",n&&1==e&&1==i&&(0<p13filetreelocation.length||0==o)&&p13getFileSelAllowedExt(".zip")),QE("p13PasteButton",n&&(0<p13filetreelocation.length||0==o)&&null!=p13clipboard&&0<p13clipboard.length),QE("p13GoToFolderButton",n),QE("p13OpenButton",n&&1==e),QE("p13DownloadButton",0<e&&e==i&&(0<p13filetreelocation.length||0==o))),1==(null!=files&&0!=files.state)&&2!=files.contype||null==filesNode.agent||3==filesNode.agent.id||4==filesNode.agent.id?QH("filesCustomUpperRight",""):QH("filesCustomUpperRight","<a style=cursor:pointer onclick=cmsshportaction(1,event)>"+format("Porta SSH {0}",filesNode.sshport||22)+"</a>"),QV("filesActionsBtn",3!=filesNode.mtype),QV("p13FindButton",3!=filesNode.mtype),QV("p13CutButton",3!=filesNode.mtype),QV("p13CopyButton",3!=filesNode.mtype),QV("p13ZipButton",3!=filesNode.mtype),QV("p13UnzipButton",3!=filesNode.mtype),QV("p13PasteButton",3!=filesNode.mtype)}function p13getFileSelCount(e){for(var t=0,i=document.getElementsByName("fd"),o=0;o<i.length;o++)!i[o].checked||0==e&&"3"!=i[o].attributes.file.value||t++;return t}function p13getFileSelDirCount(){for(var e=0,t=document.getElementsByName("fd"),i=0;i<t.length;i++)t[i].checked&&"999"==t[i].attributes.file.value&&e++;return e}function p13getFileCount(){return document.getElementsByName("fd").length}function p13getFileSelAllowedExt(e){for(var t=document.getElementsByName("fd"),i=0;i<t.length;i++)if(t[i].checked&&!p13filetree.dir[t[i].value].n.endsWith(e))return!1;return!0}function p13selectallfile(){for(var e=0==p13getFileSelCount(),t=document.getElementsByName("fd"),i=0;i<t.length;i++)t[i].checked=e;p13setActions()}function p13createfolder(){setModalContent("xxAddAgent","Nuova cartella","<input type=text id=p13renameinput maxlength=64 onkeyup=p13fileNameCheck(event) style=width:100% />"),showModal("xxAddAgentModal","idx_dlgOkButton",()=>p13createfolderEx()),focusTextBox("p13renameinput"),p13fileNameCheck()}function p13createfolderEx(){files.sendText({action:"mkdir",reqid:1,path:p13filetreelocation.join("/")+"/"+Q("p13renameinput").value}),p13folderup(999)}function p13deletefile(){var e=p13getFileSelCount(),t=0<p13getFileSelDirCount()?'<br /><br /><label><input type=checkbox class="form-check-input me-2" id=p13recdeleteinput>Eliminazione ricorsiva</label><br>':"<input type=checkbox class=\"form-check-input me-2\" id=p13recdeleteinput style='display:none'>";setModalContent("xxAddAgent","Elimina",1<e?format("Eliminare {0} elementi selezionati?",e)+t:"Eliminare l'elemento selezionato?"+t),showModal("xxAddAgentModal","idx_dlgOkButton",()=>p13deletefileEx())}function p13deletefileEx(){for(var e=[],t=document.getElementsByName("fd"),i=0;i<t.length;i++)t[i].checked&&e.push(p13filetree.dir[t[i].value].n);files.sendText({action:"rm",reqid:1,path:p13filetreelocation.join("/"),delfiles:e,rec:Q("p13recdeleteinput").checked}),p13folderup(999)}function p13renamefile(){for(var e,t=document.getElementsByName("fd"),i=0;i<t.length;i++)t[i].checked&&(e=p13filetree.dir[t[i].value].n);setModalContent("xxAddAgent","Rinominare",'<input type=text id=p13renameinput maxlength=64 onkeyup=p13fileNameCheck(event) style=width:100% value="'+e+'" />'),showModal("xxAddAgentModal","idx_dlgOkButton",()=>p13renamefileEx(3,{oldname:e})),focusTextBox("p13renameinput"),p13fileNameCheck()}function p13renamefileEx(e,t){t.newname=Q("p13renameinput").value,files.sendText(t),p13folderup(999)}function p13fileNameCheck(e){var t=isFilenameValid(Q("p13renameinput").value);QE("idx_dlgOkButton",t),1==t&&null!=e&&13==e.keyCode&&dialogclose(1)}function p13uploadFile(){setModalContent("xxAddAgent","Caricare un file",'<input type=file name=files id=p13uploadinput class="form-control" multiple=multiple onchange="updateUploadDialogOk(\'p13uploadinput\')" />'),showModal("xxAddAgentModal","idx_dlgOkButton",()=>p13uploadFileEx()),updateUploadDialogOk("p13uploadinput")}function updateUploadDialogOk(e){QE("idx_dlgOkButton",0<Q("p13uploadinput").files.length)}function p13uploadFileEx(){return p13doUploadFiles(Q("p13uploadinput").files),!1}function p13viewfile(){for(var e=document.getElementsByName("fd"),t=0;t<e.length;t++)if(e[t].checked){p13filetree.dir[e[t].value].s<=204800?p13downloadfile(encodeURIComponentEx(p13filetreelocation.join("/")+"/"+p13filetree.dir[e[t].value].n),encodeURIComponentEx(p13filetree.dir[e[t].value].n),p13filetree.dir[e[t].value].s,"viewer"):messagebox("Editor di file","È possibile modificare solo i file inferiori a 200k.");break}}function p13unzipFile(){for(var e,t,i,o=document.getElementsByName("fd"),n=0;n<o.length;n++)o[n].checked&&(e=isWindowsNode(currentNode)?"\\":"/",t=(isWindowsNode(currentNode)?"":"/")+p13filetreelocation.join(e)+e+p13filetree.dir[o[n].value].n.split(".zip")[0]+e,i=(isWindowsNode(currentNode)?"":"/")+p13filetreelocation.join(e)+e+p13filetree.dir[o[n].value].n);setModalContent("xxAddAgent","Unzip To Folder",'<input type=text id=p13unzipfolderinput maxlength=64 style=width:100% value="'+t+'" />'),showModal("xxAddAgentModal","idx_dlgOkButton",p13unzipFileEx(3,{action:"unzip",input:i})),focusTextBox("p13unzipfolderinput")}function p13unzipFileEx(e,t){t.dest=Q("p13unzipfolderinput").value,files.sendText(t)}function p13zipFiles(){for(var e=[],t=document.getElementsByName("fd"),i=0;i<t.length;i++)t[i].checked&&e.push(p13filetree.dir[t[i].value].n);setModalContent("xxAddAgent","Zip nome file ",'<input type=text id=p13renameinput maxlength=64 onkeyup=p13fileNameCheck(event) style=width:100% value="" />'),showModal("xxAddAgentModal","idx_dlgOkButton",()=>p13zipFilesEx(3,{action:"zip",path:p13filetreelocation.join("/"),files:e})),focusTextBox("p13renameinput"),p13fileNameCheck()}function p13zipFilesEx(e,t){t.output=Q("p13renameinput").value,t.output.toLowerCase().endsWith(".zip")||(t.output+=".zip"),files.sendText(t)}var p13clipboard=null,p13clipboardFolder=null,p13clipboardCut=0;function p13copyFile(e){var t=document.getElementsByName("fd");p13clipboard=[],p13clipboardCut=e,p13clipboardFolder=p13targetpath;for(var i=0;i<t.length;i++)t[i].checked&&"3"==t[i].attributes.file.value&&p13clipboard.push(p13filetree.dir[t[i].value].n);p13updateClipview()}function p13pasteFile(){var e="";setModalContent("xxAddAgent","Incolla",e=null!=p13clipboard&&0<p13clipboard.length?0==p13clipboardCut?1<p13clipboard.length?format("Confermare la copia di {0} voci in questa posizione?",p13clipboard.length):format("Confermare la copia di 1 voce in questa posizione?"):1<p13clipboard.length?format("Confermare lo spostamento di {0} voci in questa posizione?",p13clipboard.length):format("Confermare lo spostamento di 1 voce in questa posizione?"):e),showModal("xxAddAgentModal","idx_dlgOkButton",()=>p13pasteFileEx())}function p13pasteFileEx(){files.sendText({action:0==p13clipboardCut?"copy":"move",reqid:1,scpath:p13clipboardFolder,dspath:p13targetpath,names:p13clipboard}),p13folderup(999),1==p13clipboardCut&&(p13clipboardFolder=p13clipboard=null,p13clipboardCut=0,p13updateClipview())}function p13updateClipview(){var e="";null!=p13clipboard&&0<p13clipboard.length&&(e=0==p13clipboardCut?1<p13clipboard.length?format('Conservazione di {0} voci per la copia, <a href=# onclick="return p13clearClip()" style=cursor:pointer>Pulire</a>.',p13clipboard.length):format('Tenendo 1 entrata per la copia, <a href=# onclick="return p13clearClip()" style=cursor:pointer>Pulire</a>.'):1<p13clipboard.length?format('Trattenendo {0} voci per lo spostamento, <a href=# onclick="return p13clearClip()" style=cursor:pointer>Pulire</a>.',p13clipboard.length):format('Tenendo premuto 1 ingresso per il movimento, <a href=# onclick="return p13clearClip()" style=cursor:pointer>Pulire</a>.')),QH("p13bottomstatus",e),p13setActions()}function p13clearClip(){return p13clipboardFolder=p13clipboard=null,p13clipboardCut=0,p13updateClipview(),!1}function p13fileDragDrop(e){if(haltEvent(e),QV("p13bigfail",!1),QV("p13bigok",!1),null!=e.dataTransfer&&0!=e.dataTransfer.files.length&&null!=p13filetree){var t,i=[];for(t in e.dataTransfer.files)null!=e.dataTransfer.files[t].size&&0!=e.dataTransfer.files[t].size&&i.push(e.dataTransfer.files[t]);0!=i.length&&p13doUploadFiles(i)}}var gdownloadFile,p13dragtimer=null;function p13fileDragOver(e){haltEvent(e),null!=p13dragtimer&&(clearTimeout(p13dragtimer),p13dragtimer=null);e=null!=p13filetree;QV("p13bigok",e),QV("p13bigfail",!e)}function p13fileDragLeave(e){haltEvent(e),"p13filetable"!=e.target.id?(QV("p13bigfail",!1),QV("p13bigok",!1)):p13dragtimer=setTimeout(function(){QV("p13bigfail",!1),QV("p13bigok",!1),p13dragtimer=null},10)}function p13downloadfile(e,t,i,o){!xxdialogMode&&files&&(gdownloadFile={path:decodeURIComponent(e),file:decodeURIComponent(t),size:i,tsize:0,data:"",state:0,id:Math.random(),tag:o},files.sendText({action:"download",sub:"start",id:gdownloadFile.id,path:gdownloadFile.path}),setModalContent("xxAddAgent","Scarca  File","<div>"+gdownloadFile.file+"</div><br /><progress id=d2progressBar style=width:100% value=0 max="+i+" />"),showModal("xxAddAgentModal","idx_dlgOkButton",()=>p13downloadFileCancel()))}function p13downloadFileCancel(){setDialogMode(0),files.sendText({action:"download",sub:"cancel",id:gdownloadFile.id}),gdownloadFile=null}function p13gotDownloadCommand(e){null!=gdownloadFile&&e.id==gdownloadFile.id&&("start"==e.sub?(gdownloadFile.state=1,files.sendText({action:"download",sub:"startack",id:gdownloadFile.id})):"cancel"==e.sub&&(gdownloadFile=null,setDialogMode(0)))}function p13gotDownloadBinaryData(e){var t;gdownloadFile&&0!=gdownloadFile.state&&(4<e.length&&(gdownloadFile.tsize+=e.length-4,gdownloadFile.data+=e.substring(4),Q("d2progressBar").value=gdownloadFile.tsize),0!=(1&ReadInt(e,0))?"viewer"==gdownloadFile.tag?(setModalContent("xxAddAgent",EscapeHtml(gdownloadFile.file),4,"extra-large"),t=gdownloadFile.file,showModal("xxAddAgentModal","idx_dlgOkButton",()=>p13editSaveBack(3,t)),QV("d4EncodingButton",!0),QV("d4LineBreakButton",!0),Q("d4editorarea").value=1==d4EditEncodingVal?decode_utf8(gdownloadFile.data):gdownloadFile.data,gdownloadFile=null):(saveAs(data2blob(gdownloadFile.data),gdownloadFile.file),gdownloadFile=null,setDialogMode(0)):files.sendText({action:"download",sub:"ack",id:gdownloadFile.id}))}function p13downloadButton(){for(var e,t,i=document.getElementsByName("fd"),o=0;o<i.length;o++)i[o].checked&&(e=p13filetree.dir[i[o].value],t="devicefile.ashx?c="+authCookie,downloadFile(t=(t=(t+="&m="+currentNode.meshid.split("/")[2])+("&n="+currentNode._id.split("/")[2]))+("&f="+encodeURIComponentEx(p13filetreelocation.join("/")+"/"+e.n)),encodeURIComponentEx(e.n)))}var uploadFile,d4EditWrapVal=0,d4EditSizeVal=0,d4EditEncodingVal=0,d4EditLineBreakVal=0;function d4ToggleWrap(e){e||(d4EditWrapVal=++d4EditWrapVal%2),Q("d4WrapButton").value=["Avvolgi: ON ","Avvolgere: OFF "][d4EditWrapVal],QS("d4editorarea").overflow=0==d4EditWrapVal?"auto":"scroll",QS("d4editorarea")["white-space"]=0==d4EditWrapVal?null:"pre",putstore("editorWrap",d4EditWrapVal)}function d4ToggleSize(e){e||(d4EditSizeVal=++d4EditSizeVal%4),QS("d4editorarea")["font-size"]=["100%","125%","150%","200%"][d4EditSizeVal],Q("d4SizeButton").value=["Dimensione: 100%","Dimensione: 125%","Dimensione: 150%","Dimensione: 200%"][d4EditSizeVal],putstore("editorSize",d4EditSizeVal)}function d4ToggleEncoding(e){e||(d4EditEncodingVal=++d4EditEncodingVal%2,Q("d4editorarea").value=(1==d4EditEncodingVal?decode_utf8:encode_utf8)(Q("d4editorarea").value)),Q("d4EncodingButton").value=["Codifica: RAW","Codifica: UTF8"][d4EditEncodingVal],putstore("editorEncoding",d4EditEncodingVal)}function d4ToggleLineBreak(e){e||(d4EditLineBreakVal=++d4EditLineBreakVal%3),Q("d4LineBreakButton").value=["Line Break: Windows (CR LF)","Line Break: Linux (LF)","Line Break: Mac (CR)"][d4EditLineBreakVal],putstore("editorLineBreak",d4EditLineBreakVal)}function p13editSaveBack(e,t){var i=Q("d4editorarea").value,i=0===d4EditLineBreakVal?i.replace(/\r?\n|\r/g,"\r\n"):2===d4EditLineBreakVal?i.replace(/\r\n|\n/g,"\r"):i.replace(/\r\n|\r/g,"\n"),i=1==d4EditEncodingVal?(new TextEncoder).encode(i):(new TextEncoder).encode(decode_utf8(i));p13uploadFileContinue(1,[{name:t,size:i.byteLength,type:"text/plain",xdata:i}])}function p13doUploadFiles(e){if(!xxdialogMode){var t=0<currentNode.agent.id&&currentNode.agent.id<5||14==currentNode.agent.id||34==currentNode.agent.id,i=[],o=0;for(n in p13filetree.dir)i.push(t?p13filetree.dir[n].n.toLowerCase():p13filetree.dir[n].n);for(var n=0;n<e.length;n++)t?0<=i.indexOf(e[n].name.toLowerCase())&&o++:0<=i.indexOf(e[n].name)&&o++;0==o?p13uploadFileContinue(1,e):(setModalContent("xxAddAgent","Caricare un file",format(1==o?"Il caricamento sovrascriverà 1 file. Continua? ":"Il caricamento sovrascriverà {0} file. Continua? ",o)),showModal("xxAddAgentModal","idx_dlgOkButton",()=>p13uploadFileContinue(3,e)))}}function p13uploadFileContinue(e,t){if((uploadFile={}).xpath=p13filetreelocation.join("/"),uploadFile.xfiles=t,uploadFile.xfilePtr=-1,setModalContent("xxAddAgent","Caricare un file","<div id=p13dfileName>Collegamento ...</div><br /><progress id=d2progressBar style=width:100% value=0 max=0 />"),showModal("xxAddAgentModal","idx_dlgCancelButton",()=>p13uploadFileCancel(10)),document.getElementById("idx_dlgOkButton").style.display="none",p13uploadNextFile(),3==e)return!1}let byteToHex=[];for(var n=0;n<=255;++n){var hexOctet=n.toString(16).padStart(2,"0");byteToHex.push(hexOctet)}function arrayBufferToHex(e){return Array.prototype.map.call(new Uint8Array(e),e=>byteToHex[e]).join("")}function performHash(e,t){window.crypto.subtle.digest("SHA-384",e).then(function(e){t(arrayBufferToHex(e))},function(){t(null)})}function performHashOnFile(e,t){var i=new FileReader;i.onerror=function(e){t(null)},i.onload=function(){window.crypto.subtle.digest("SHA-384",i.result).then(function(e){t(arrayBufferToHex(e))},function(){t(null)})},i.readAsArrayBuffer(e)}function p13uploadNextFile(){if(uploadFile.xfilePtr++,uploadFile.xfiles.length>uploadFile.xfilePtr){uploadFile.xptr=0;var t=uploadFile.xfiles[uploadFile.xfilePtr];if(QH("p13dfileName",EscapeHtml(t.name)),Q("d2progressBar").max=t.size,Q("d2progressBar").value=0,null==t.xdata){uploadFile.xfile=t;var e,i=null;for(e in p13filetree.dir)p13filetree.dir[e].n==t.name&&(i=p13filetree.dir[e]);null!=i&&i.s<=uploadFile.xfile.size?performHashOnFile(uploadFile.xfile,function(e){files.sendText(JSON.stringify({action:"uploadhash",reqid:uploadFile.xfilePtr,path:uploadFile.xpath,name:t.name,tag:{h:e.toUpperCase(),s:i.s,skip:i.s==uploadFile.xfile.size}}))}):files.sendText(JSON.stringify({action:"upload",reqid:uploadFile.xfilePtr,path:uploadFile.xpath,name:t.name,size:uploadFile.xfile.size}))}else uploadFile.xdata=t.xdata,files.sendText(JSON.stringify({action:"upload",reqid:uploadFile.xfilePtr,path:uploadFile.xpath,name:t.name,size:uploadFile.xdata.byteLength}))}else p13uploadFileTransferDone()}function p13uploadFileCancel(e,t){null!=uploadFile&&(files.sendText(JSON.stringify({action:"uploadcancel",reqid:uploadFile.xfilePtr})),uploadFile=null),p13uploadFileTransferDone()}function p13uploadFileTransferDone(){uploadFile=null,setDialogMode(0),p13folderup(9999)}function p13gotUploadData(e){if(null!=uploadFile&&parseInt(uploadFile.xfilePtr)==parseInt(e.reqid))switch(e.action){case"uploadstart":p13uploadNextPart(!(uploadFile.xdataPriming=8));break;case"uploadack":p13uploadNextPart(!1);break;case"uploaddone":(uploadFile.xfiles.length>uploadFile.xfilePtr+1?p13uploadNextFile:p13uploadFileTransferDone)();break;case"uploaderror":p13uploadFileCancel();break;case"uploadhash":var t=uploadFile.xfiles[uploadFile.xfilePtr];t&&(e.tag.h===e.hash?e.tag.skip?p13uploadNextFile():(uploadFile.xptr=e.tag.s,files.sendText(JSON.stringify({action:"upload",reqid:uploadFile.xfilePtr,path:uploadFile.xpath,name:t.name,size:uploadFile.xfile.size,append:!0}))):files.sendText(JSON.stringify({action:"upload",reqid:uploadFile.xfilePtr,path:uploadFile.xpath,name:t.name,size:uploadFile.xfile.size,append:!1})))}}function p13uploadNextPart(e){if(uploadFile.xdata){var t=uploadFile.xdata,i=uploadFile.xptr;if(i>=t.byteLength)files.sendText(JSON.stringify({action:"uploaddone",reqid:uploadFile.xfilePtr}));else{if((o=uploadFile.xptr+(attemptWebRTC?16384:65536))>t.byteLength){if(1==e)return;o=t.byteLength}t=new Uint8Array(t.slice(i,o));123==t[0]||0==t[0]?((i=new Uint8Array(o-i+1)).set(t,1),files.send(i)):files.send(t),uploadFile.xptr=o,Q("d2progressBar").value=o}}else if(uploadFile.xfile&&null==uploadFile.xreader&&!(uploadFile.xptr>=uploadFile.xfile.size)){var o;if((o=uploadFile.xptr+(attemptWebRTC?16384:65536))>uploadFile.xfile.size){if(1==e)return;o=uploadFile.xfile.size}uploadFile.xreader=new FileReader,uploadFile.xreader.onerror=function(e){console.log(e)},uploadFile.xreader.onload=function(){var e,t=uploadFile.xreader.result;delete uploadFile.xreader,null!=t&&(123==(e=new Uint8Array(t))[0]||0==e[0]?((t=new Uint8Array(t.byteLength+1)).set(e,1),files.send(t)):files.send(e),uploadFile.xptr=o,Q("d2progressBar").value=o,uploadFile.xptr>=uploadFile.xfile.size?files.sendText(JSON.stringify({action:"uploaddone",reqid:uploadFile.xfilePtr})):0<uploadFile.xdataPriming&&(uploadFile.xdataPriming--,p13uploadNextPart(!0)))},uploadFile.xreader.readAsArrayBuffer(uploadFile.xfile.slice(uploadFile.xptr,o))}}var currentDeviceEvents=null;function deviceEventsUpdate(){var e="",t=null;for(r in currentDeviceEvents){var i=currentDeviceEvents[r],o=new Date(i.time);if(i.msg){null==i.h&&(i.h=Math.random()),printDate(o)!=t&&(null!=t&&(e+="</table>"),e+='<table class="table table-hover p3eventsTable" cellpadding=0 cellspacing=0><tr><td colspan=4 class=DevSt>'+(t=printDate(o))+"</td></tr>");var n,a,s="fa-mobile-screen";if("user"==i.etype&&(s="fa-user"),"server"==i.etype&&(s="fa-server"),null==i.msgid||null==eventsMessageId[i.msgid])n="string"==typeof i.msg?EscapeHtml(i.msg).split("(R)").join("&reg;"):"";else{for(var r in n=eventsMessageId[i.msgid],i.msgArgs){var l=i.msgArgs[r];"string"==typeof l&&0==l.indexOf("DATETIME:")&&(l=printFlexDateTime(new Date(parseInt(l.substring(9))))),n=n.split("{"+r+"}").join(l)}n=EscapeHtml(n).split("(R)").join("&reg;")}i.username&&(a="",i.guestname&&(a=' / <span title="Questa è una sessione di condivisione degli ospiti">'+EscapeHtml(i.guestname)+"</span>"),n=2&userinfo.siteadmin&&i.userid?"<a href=# onclick='gotoUser(\""+encodeURIComponentEx(i.userid)+"\");haltEvent(event);'>"+EscapeHtml(i.username)+"</a>"+a+" &rarr; "+n:EscapeHtml(i.username)+a+" &rarr; "+n),"relay"!=i.etype&&"relaylog"!=i.action||(s="fa-arrow-right-arrow-left"),e+="<tr onclick=showEventDetails("+i.h+',1) onmouseover=eventMouseHover(this,1) onmouseout=eventMouseHover(this,0) role="button"><td style=width:18px><i class="fa-solid '+s+'"></i></td><td class=g1>&nbsp;</td><td class=style10>'+printTime(o)+" - "+n+"</td></tr><tr></tr>"}}null!=t&&(e+="</table>"),""==e&&(e="<br><i>Nessun evento trovato </i><br><br>"),QH("p16events",e)}function refreshDeviceEvents(){""!=p16filterevents.value?meshserver.send({action:"events",nodeid:currentNode._id,limit:parseInt(p16limitdropdown.value),filter:p16filterevents.value}):meshserver.send({action:"events",nodeid:currentNode._id,limit:parseInt(p16limitdropdown.value)})}function showEventDetails(e,t){if(xxdialogMode)return!1;var i,o;for(n in 1==t&&(i=currentDeviceEvents),2==t&&(i=events),i=3==t?currentUserEvents:i)if(i[n].h==e){o=i[n];break}if(o){var n,a="<div style=overflow-y:auto;max-height:300px>";for(n in o)"h"!=n&&"_id"!=n&&"ids"!=n&&"domain"!=n&&null!=o[n]&&("object"==typeof o[n]?a+=addHtmlValue3(EscapeHtml(n),EscapeHtml(JSON.stringify(o[n]))):a+=addHtmlValue3(EscapeHtml(n),EscapeHtml(o[n])));setModalContent("xxAddAgent","dettagli dell'evento",a+="</div>"),showModal("xxAddAgentModal","idx_dlgOkButton")}}var deviceDetailsStats=null,deviceDetailsStatsTimer=null,deviceDetailsStatsData=[],deviceDetailsConfig={type:"line",data:{labels:[],datasets:[{label:"CPU",backgroundColor:"rgba(134, 16, 158, .5)",borderColor:"rgb(134, 16, 158)",data:[],fill:!0},{label:"Memoria",backgroundColor:"rgba(255, 99, 132, .5)",borderColor:"rgb(255, 99, 132)",data:[],fill:!0}]},options:{events:["click"],animation:!1,responsive:!0,maintainAspectRatio:!1,tooltips:{enabled:!1},elements:{line:{cubicInterpolationMode:"monotone"}},scales:{x:{type:"linear",display:!0,title:{display:!1,text:""},min:0,max:100,reverse:!0},y:{type:"linear",display:!0,title:{display:!1,text:""},min:0,max:100}}}};function deskToggleCpuGraph(){("none"==QS("p17graph").display?(QV("p17graph",!0),window.deviceDetailsStatsChart=new Chart(document.getElementById("deviceDetailsStats").getContext("2d"),deviceDetailsConfig),deviceDetailsStatsTimer=setInterval(deviceDetailsStatsTimerFunc,2e3),deviceDetailsStatsTimerFunc):deviceDetailsStatsClear)()}function deviceDetailsStatsClear(){QV("p17graph",!1),null!=window.deviceDetailsStatsChart&&(window.deviceDetailsStatsChart.destroy(),delete window.deviceDetailsStatsChart),null!=deviceDetailsStatsTimer&&(clearInterval(deviceDetailsStatsTimer),deviceDetailsStatsTimer=null),deviceDetailsStatsData=[],deviceDetailsStatsDraw(),QV("extraGraphValues",!1),QH("extraGraphValues","")}function deviceDetailsStatsTimerFunc(){null!=currentNode&&meshserver.send({action:"msg",type:"cpuinfo",nodeid:currentNode._id})}function deviceDetailsStatsDraw(e){for(var t=Date.now()/1e3-100;0<deviceDetailsStatsData.length&&deviceDetailsStatsData[0][0]<t-5;)deviceDetailsStatsData.shift();var i=[],o=[];for(a in deviceDetailsStatsData){var n=deviceDetailsStatsData[a];i.push({x:100-(n[0]-t),y:n[1]}),o.push({x:100-(n[0]-t),y:n[2]})}if(deviceDetailsConfig.data.datasets[0].data=i,deviceDetailsConfig.data.datasets[1].data=o,window.deviceDetailsStatsChart&&window.deviceDetailsStatsChart.update(),null!=e&&Array.isArray(e.thermals)&&0<e.thermals.length){var a,s="&nbsp;";for(a in e.thermals)s+='<div class=thermalSensor title="'+e.thermals[a].InstanceName+'">'+parseFloat(e.thermals[a].CurrentTemperature).toFixed(2)+"&deg;C / "+parseFloat(1.8*e.thermals[a].CurrentTemperature+32).toFixed(2)+"&deg;F</div>";QV("extraGraphValues",!0),QH("extraGraphValues",s)}}var consoleNode,DeviceDetailsHardware=null,DeviceDetailsNetwork=null,DeviceDetailsNodeId=null;function updateDeviceDetails(e,t,i){if(null!=currentNode&&(null==e&&(e=currentNode),currentNode._id==e._id)){DeviceDetailsNodeId!=e._id&&(DeviceDetailsNetwork=DeviceDetailsHardware=null,DeviceDetailsNodeId=e._id),null==(t=DeviceDetailsHardware=null!=t?t:DeviceDetailsHardware)&&(t={}),null==(i=DeviceDetailsNetwork=null!=i?i:DeviceDetailsNetwork)&&(i={});var o,n,a=[],s={},r="";if(e.rname&&(r+=addDetailItem("Nome",EscapeHtml(e.rname),s)),t.windows&&t.windows.osinfo&&t.windows.osinfo.Description&&(r+=addDetailItem("Descrizione",EscapeHtml(t.windows.osinfo.Description),s)),e.osdesc&&(r+=addDetailItem("Versione ",EscapeHtml(e.osdesc),s)),t.windows&&t.windows.osinfo&&((d=t.windows.osinfo).OSArchitecture&&(d.OSArchitecture.startsWith("32")?r+=addDetailItem("Architettura","32 bit",s):d.OSArchitecture.startsWith("64")?r+=addDetailItem("Architettura","64 bit",s):r+=addDetailItem("Architettura",EscapeHtml(d.OSArchitecture),s)),d.LastBootUpTime)&&(n={year:parseInt(d.LastBootUpTime.substring(0,4)),month:parseInt(d.LastBootUpTime.substring(4,6))-1,day:parseInt(d.LastBootUpTime.substring(6,8)),hours:parseInt(d.LastBootUpTime.substring(8,10)),minutes:parseInt(d.LastBootUpTime.substring(10,12)),seconds:parseInt(d.LastBootUpTime.substring(12,14))},r+=addDetailItem("Last Boot Up Time",printDateTime(new Date(n.year,n.month,n.day,n.hours,n.minutes,n.seconds)))),t.linux&&t.linux.LastBootUpTime&&(r+=addDetailItem("Last Boot Up Time",printDateTime(new Date(t.linux.LastBootUpTime)))),t.darwin&&t.darwin.LastBootUpTime&&(r+=addDetailItem("Last Boot Up Time",printDateTime(new Date(1e3*t.darwin.LastBootUpTime)))),""!=r&&a.push({name:"Sistema operativo",html:r,img:"software64.png"}),e.agent&&(r="",null!=e.agent&&null!=e.agent.id&&null!=e.agent.ver&&(n="",n=e.agent.id<=agentsStr.length?agentsStr[e.agent.id]:agentsStr[0],0!=e.agent.ver&&(n+=" v"+e.agent.ver),r+=addDetailItem("Agente Mesh",n=14==e.agent.id?e.agent.core:n)),0!=(1&e.conn)?r+=addDetailItem("Ultimo collegamento dell'agente","Connesso ora"):e.lastconnect&&(r+=addDetailItem("Ultimo collegamento dell'agente",printDateTime(new Date(e.lastconnect)))),e.lastaddr&&(2<(n=e.lastaddr.split(":")).length?r+=addDetailItem("Ultimo indirizzo dell'agente",e.lastaddr):isPrivateIP(e.lastaddr)?r+=addDetailItem("Ultimo indirizzo dell'agente",n[0]):r+=addDetailItem("Ultimo indirizzo dell'agente",'<a href="https://iplocation.com/?ip='+n[0]+'" rel="noreferrer noopener" target="MeshIPLoopup">'+n[0]+"</a>")),null!=t.agentvers&&t.agentvers.compileTime&&(n=Date.parse(t.agentvers.compileTime),r+=addDetailItem("Tempo di compilazione",isNaN(n)?t.agentvers.compileTime:printDateTime(new Date(n)))),""!=r)&&a.push({name:"Agente Mesh",html:r,img:"meshagent64.png"}),t.mobile&&(r="",t.mobile.brand&&t.mobile.model&&(r+=addDetailItem("Modello",EscapeHtml(t.mobile.brand+", "+t.mobile.model),s)),t.mobile.device&&(r+=addDetailItem("Dispositivo",EscapeHtml(t.mobile.device),s)),t.mobile.bootloader&&(r+=addDetailItem("Boot loader",EscapeHtml(t.mobile.bootloader),s)),t.mobile.id&&(r+=addDetailItem("Identificatore",EscapeHtml(t.mobile.id),s)),t.mobile.host&&(r+=addDetailItem("Nome host",EscapeHtml(t.mobile.host),s)),t.mobile.androidapi&&t.mobile.androidrelease&&(r+=addDetailItem("Android Version",EscapeHtml(t.mobile.androidrelease+", API Level "+t.mobile.androidapi),s)),""!=r)&&a.push({name:"Dispositivo mobile",html:r,img:"mobile64.png"}),null!=i.netif){var l={};for(h in i.netif)"string"==typeof(d=i.netif[h]).mac&&(null==l[d.mac]?(l[d.mac]=d,l[d.mac].ipv4layer=[{v4addr:d.v4addr,v4mask:d.v4mask,v4gateway:d.v4gateway}]):l[d.mac].ipv4layer.push({v4addr:d.v4addr,v4mask:d.v4mask,v4gateway:d.v4gateway}));var r="";for(h in r+='<table class="table table-hover" style=width:100%>',l){var d=l[h];for(p in r=(r+="<tr><td><div class=style10 style=border-radius:5px;padding:8px>")+("<div style=margin-bottom:3px><b>"+EscapeHtml(d.name+(d.dnssuffix?", "+d.dnssuffix:""))+"</b></div>"),d.desc&&(r+=addDetailItem("Descrizione",EscapeHtml(d.desc).split("(R)").join("&reg;"))),d.mac&&(d.gatewaymac?r+=addDetailItem("Livello MAC",format("MAC: {0}, Gateway: {1}",EscapeHtml(d.mac),EscapeHtml(d.gatewaymac))):d.mac&&(r+=addDetailItem("Livello MAC",format("MAC: {0}",EscapeHtml(d.mac))))),d.ipv4layer){var c=d.ipv4layer[p];c.v4gateway&&c.v4mask?r+=addDetailItem("Livello IPv4",format("IP: {0}, Mask: {1}, Gateway: {2}",EscapeHtml(c.v4addr),EscapeHtml(c.v4mask),EscapeHtml(c.v4gateway))):c.v4addr&&(r+=addDetailItem("Livello IPv4",format("IP: {0}",EscapeHtml(c.v4addr))))}r+="</div></td></tr>"}""!=(r+="</table>")&&a.push({name:"Rete ",html:r,img:"networking64.png"})}if(null!=i.netif2){var r="";for(h in r+='<table class="table table-hover" style=width:100%>',i.netif2){d=i.netif2[h];if(!(0==Array.isArray(d)||d.length<1||null==d[0]||"string"==typeof d[0].mac&&d[0].mac.startsWith("00:00:00:00"))){r+="<tr><td><div class=style10 style=border-radius:5px;padding:8px>";var u="";null!=h&&(u+=h),null!=d[0].fqdn&&""!=d[0].fqdn&&(u+=", "+d[0].fqdn),0<u.length&&(r+="<div style=margin-bottom:3px><b>"+EscapeHtml(u)+"</b></div>"),d.desc&&(r+=addDetailItem("Descrizione",EscapeHtml(d.desc).split("(R)").join("&reg;"))),"string"==typeof d[0].mac&&(d[0].gatewaymac?r+=addDetailItem("Livello MAC",format("MAC: {0}, Gateway: {1}",EscapeHtml(d[0].mac),EscapeHtml(d[0].gatewaymac))):r+=addDetailItem("Livello MAC",format("MAC: {0}",EscapeHtml(d[0].mac))));for(var p=0;p<d.length;p++){var m=d[p],g=[];m.address&&g.push(format("IP: {0}",EscapeHtml(m.address))),m.netmask&&g.push(format("Maschera: {0}",EscapeHtml(m.netmask))),m.gateway&&g.push(format("Gateway: {0}",EscapeHtml(m.gateway))),0<g.length&&("IPv4"==m.family&&(r+=addDetailItem("Livello IPv4",g.join(", "))),"IPv6"==m.family)&&(r+=addDetailItem("Livello IPv6",g.join(", ")))}r+="</div></td></tr>"}}t.network&&t.network.dns&&(r=(r+="<tr><td><div class=style10 style=border-radius:5px;padding:8px>")+addDetailItem("<b>DNS Servers</b>",t.network.dns.join(", "))+"</div></td></tr>"),""!=(r+="</table>")&&a.push({name:"Rete ",html:r,img:"networking64.png"})}if(null!=e.intelamt&&(r="",r+=addDetailItem("Versione ",e.intelamt.ver?"v"+EscapeHtml(e.intelamt.ver):"<i>Sconosciuto</i>",s),n={0:nobreak("Non attivato"),1:nobreak("Preattivazione"),2:nobreak("Attivato")},o="",2==e.intelamt.state&&e.intelamt.flags&&(2&e.intelamt.flags?o=", Modalità di controllo client (CCM)":4&e.intelamt.flags&&(o=", Modalità di controllo amministratore (ACM)")),""!=(r=(r=(r+=addDetailItem("Stato di pprovvigionamento",(e.intelamt.state?n[e.intelamt.state]:"<i>Sconosciuto</i>")+o,s))+addDetailItem("Sicurezza",1==e.intelamt.tls?"Protetto tramite TLS":"TLS non è configurato",s))+addDetailItem("Credenziali di amministratore",null==e.intelamt.user||""==e.intelamt.user||null!=e.intelamt.warn&&0!=(9&e.intelamt.warn)?"Non conosciuto":"Conosciuto",s)))&&("number"==typeof e.intelamt.sku&&0!=(16&e.intelamt.sku)?a.push({name:"Gestibilità standard Intel&reg; (Intel&reg; SM)",html:r,img:"amt64.png"}):a.push({name:"Intel&reg; Active Management Technology (Intel&reg; AMT)",html:r,img:"amt64.png"})),t.identifiers){var r="",v=t.identifiers;if(v.bios_vendor&&(r+=addDetailItem("Venditore",EscapeHtml(v.bios_vendor),s)),v.bios_version&&(r+=addDetailItem("Versione ",EscapeHtml(v.bios_version),s)),v.bios_serial&&(r+=addDetailItem("Seriale",EscapeHtml(v.bios_serial),s)),v.bios_mode&&(r+=addDetailItem("Mode",EscapeHtml(v.bios_mode),s)),""!=r&&a.push({name:"BIOS",html:r,img:"chip64.png"}),r="",v.board_vendor&&(r+=addDetailItem("Venditore",EscapeHtml(v.board_vendor),s)),v.board_name&&(r+=addDetailItem("Nome",EscapeHtml(v.board_name),s)),v.board_serial&&""!=v.board_serial&&(r+=addDetailItem("Seriale",EscapeHtml(v.board_serial),s)),v.board_version&&(r+=addDetailItem("Versione ",EscapeHtml(v.board_version),s)),v.product_uuid&&(r+=addDetailItem("Identificatore",EscapeHtml(v.product_uuid),s)),v.cpu_name&&(r+=addDetailItem("CPU",EscapeHtml(v.cpu_name).split("(TM)").join("&trade;").split("(R)").join("&reg;"),s)),v.gpu_name)for(var h in v.gpu_name)r+=addDetailItem("GPU",EscapeHtml(v.gpu_name[h]).split("(TM)").join("&trade;").split("(R)").join("&reg;"),s);""!=r&&a.push({name:"Scheda madre ",html:r,img:"motherboard64.png"})}if(t.tpm&&(r="",(n=t.tpm).SpecVersion&&(r+=addDetailItem("SpecVersion",parseFloat(EscapeHtml(n.SpecVersion)).toFixed(1),s)),n.ManufacturerId&&(r+=addDetailItem("ManufacturerId",EscapeHtml(n.ManufacturerId),s)),n.ManufacturerVersion&&(r+=addDetailItem("ManufacturerVersion",EscapeHtml(n.ManufacturerVersion),s)),null!=n.IsActivated&&(r+=addDetailItem("IsActivated",n.IsActivated?"Yes":"No",s)),null!=n.IsEnabled&&(r+=addDetailItem("IsEnabled",n.IsEnabled?"Yes":"No",s)),null!=n.IsOwned&&(r+=addDetailItem("IsOwned",n.IsOwned?"Yes":"No",s)),""!=r)&&a.push({name:"TPM",html:r,img:"tpm64.png"}),t.windows&&t.windows.memory&&0<t.windows.memory.length){r="";for(h in t.windows.memory.sort(function(e,t){return e.BankLabel>t.BankLabel?1:e.BankLabel<t.BankLabel?-1:0}),r+='<table class="table table-hover" style=width:100%>',t.windows.memory){d=t.windows.memory[h];r=(r+="<tr><td><div class=style10 style=border-radius:5px;padding:8px>")+("<div style=margin-bottom:3px><b>"+EscapeHtml(d.BankLabel||d.DeviceLocator||"Unknown")+"</b></div>"),d.Capacity&&d.Speed?r+=addDetailItem("Capacità / velocità",format("{0} Mb, {1} Mhz",d.Capacity/1024/1024,d.Speed),s):d.Capacity&&(r+=addDetailItem("Capacità",format("{0} Mb",d.Capacity/1024/1024),s)),d.PartNumber&&(r+=addDetailItem("Numero di parte ",EscapeHtml(d.Manufacturer&&"Undefined"!=d.Manufacturer?d.Manufacturer+", ":"")+EscapeHtml(d.PartNumber),s)),r+="</div>"}""!=(r+="</table>")&&a.push({name:"Memoria",html:r,img:"ram64.png"})}if(t.linux&&t.linux.memory&&0<t.linux.memory.Memory_Device.length){r="";for(h in t.linux.memory.Memory_Device.sort(function(e,t){return e.Locator>t.Locator?1:e.Locator<t.Locator?-1:0}),r+='<table class="table table-hover" style=width:100%>',t.linux.memory.Memory_Device)(d=t.linux.memory.Memory_Device[h]).Size&&"No Module Installed"==d.Size||(r=(r+="<tr><td><div class=style10 style=border-radius:5px;padding:8px>")+"<div style=margin-bottom:3px><b>"+EscapeHtml(d.Locator||"Unknown")+"</b></div>",d.Size&&d.Speed?r+=addDetailItem("Capacità / velocità",format("{0}, {1}",d.Size,d.Speed),s):d.Size&&(r+=addDetailItem("Capacità",format("{0}",d.Size),s)),d.PartNumber&&(r+=addDetailItem("Numero di parte ",EscapeHtml(d.Manufacturer&&"Undefined"!=d.Manufacturer?d.Manufacturer+", ":"")+EscapeHtml(d.PartNumber),s)),r+="</div>");""!=(r+="</table>")&&a.push({name:"Memoria",html:r,img:"ram64.png"})}if(t.darwin&&t.darwin.memory&&0<t.darwin.memory.length){r="";for(h in r+='<table class="table table-hover" style=width:100%>',t.darwin.memory)(d=t.darwin.memory[h]).Size&&"No Module Installed"==d.Size||(r=(r+="<tr><td><div class=style10 style=border-radius:5px;padding:8px>")+"<div style=margin-bottom:3px><b>"+EscapeHtml(d.DeviceLocator||"Unknown")+"</b></div>",d.Size&&d.Speed?r+=addDetailItem("Capacità / velocità",format("{0}, {1}",d.Size,d.Speed),s):d.Size&&(r+=addDetailItem("Capacità",format("{0}",d.Size),s)),d.PartNumber&&(r+=addDetailItem("Numero di parte ",EscapeHtml(d.Manufacturer&&""!=d.Manufacturer?d.Manufacturer+", ":"")+EscapeHtml(d.PartNumber),s)),r+="</div>");""!=(r+="</table>")&&a.push({name:"Memoria",html:r,img:"ram64.png"})}if(t.identifiers&&t.identifiers.storage_devices){var f,r="";for(h in v.storage_devices.sort(function(e,t){return e.Caption>t.Caption?1:e.Caption<t.Caption?-1:0}),r+="<table style=width:100%>",v.storage_devices)(d=v.storage_devices[h]).Size&&(r=(r+="<tr><td><div class=style10 style=border-radius:5px;padding:8px>")+"<div style=margin-bottom:3px><b>"+EscapeHtml(d.Caption)+"</b></div>",d.Model&&d.Model!=d.Caption&&(r+=addDetailItem("Modello",EscapeHtml(d.Model),s)),d.Size&&("string"==typeof d.Size&&parseInt(d.Size)==d.Size&&(d.Size=parseInt(d.Size)),"number"==typeof d.Size&&(r+=addDetailItem("Capacità",format("{0} Mb",Math.floor(d.Size/1024/1024)),s)),"string"==typeof d.Size)&&(r+=addDetailItem("Capacità",EscapeHtml(d.Size),s)),t.windows&&t.windows.drives&&d.Model&&(f=t.windows.drives.find(e=>e.Model===d.Model))&&f.Status&&(r+=addDetailItem("Stato",EscapeHtml(f.Status),s)),r+="</div>");""!=(r+="</table>")&&a.push({name:"Spazio di archiviazione",html:r,img:"storage64.png"})}if(t.windows&&t.windows.volumes){var x,r="";for(h in t.windows.volumes)r=(r+="<tr><td><div class=style10 style=border-radius:5px;padding:8px>")+("<div style=margin-bottom:3px><b>"+h+":"+(null==(d=t.windows.volumes[h]).name||""==d.name?"":" - "+EscapeHtml(d.name))+"</b></div>"),d.size&&(k=["Bytes","KB","MB","GB","TB"],b=0===(p=parseInt(Math.floor(Math.log(Math.abs(d.size))/Math.log(1024)),10))?d.size+" "+k[p]:(d.size/1024**p).toFixed(2)+" "+k[p],r+=addDetailItem("Capacità",EscapeHtml(b),s)),d.sizeremaining&&(k=["Bytes","KB","MB","GB","TB"],b=0===(p=parseInt(Math.floor(Math.log(Math.abs(d.sizeremaining))/Math.log(1024)),10))?d.sizeremaining+" "+k[p]:(d.sizeremaining/1024**p).toFixed(2)+" "+k[p],r+=addDetailItem("Capacity Remaining",EscapeHtml(b),s)),d.type&&(r+=addDetailItem("File System",(""!=(y=1==d.removable?"Removable":1==d.cdrom?"CD-ROM":"")?y+" / ":"")+("Unknown"==d.type?"Sconosciuto":EscapeHtml(d.type)),s)),(d.protectionStatus||d.volumeStatus)&&(x=[],d.protectionStatus&&x.push("Abilitato"),d.volumeStatus&&"FullyDecrypted"==d.volumeStatus&&x.push("Fully Decrypted"),d.volumeStatus&&"EncryptionInProgress"==d.volumeStatus&&x.push("Encryption In Progress"),d.volumeStatus&&"FullyEncrypted"==d.volumeStatus&&x.push("Fully Encrypted"),x=x.join(" - "),d.recoveryPassword&&(x+=addKeyLink("",'deviceDetailsShowBitlockerInfo("'+encodeURIComponentEx(h)+'","'+encodeURIComponentEx(d.identifier)+'","'+encodeURIComponentEx(d.recoveryPassword)+'")')),r+=addDetailItem("BitLocker",x,s)),r+="</div>";""!=r&&a.push({name:"Storage Volumes",html:"<table style=width:100%>"+r+"</table>",img:"storage64.png"})}if(t.linux&&t.linux.volumes){var k,b,r="";for(h in t.linux.volumes)(d=t.linux.volumes[h]).mount_point.startsWith("/var/lib/docker/overlay2")||(r=(r+="<tr><td><div class=style10 style=border-radius:5px;padding:8px>")+"<div style=margin-bottom:3px><b>"+d.mount_point+"</b></div>",d.size&&(k=["KB","MB","GB","TB"],b=0===(p=parseInt(Math.floor(Math.log(Math.abs(d.size))/Math.log(1024)),10))?d.size+" "+k[p]:(d.size/1024**p).toFixed(2)+" "+k[p],r+=addDetailItem("Capacità",EscapeHtml(b),s)),d.available&&(b=0==Math.abs(d.available)?"0 KB":(k=["KB","MB","GB","TB"],0===(p=parseInt(Math.floor(Math.log(Math.abs(d.available))/Math.log(1024)),10))?d.available+" "+k[p]:(d.available/1024**p).toFixed(2)+" "+k[p]),r+=addDetailItem("Capacity Remaining",EscapeHtml(b),s)),d.type&&(r+=addDetailItem("File System",(""!=(y=1==d.removable?"Removable":1==d.cdrom?"CD-ROM":"")?y+" / ":"")+("Unknown"==d.type?"Sconosciuto":EscapeHtml(d.type)),s)),r+="</div>");""!=r&&a.push({name:"Storage Volumes",html:"<table style=width:100%>"+r+"</table>",img:"storage64.png"})}if(t.darwin&&t.darwin.volumes){var y,r="";for(h in t.darwin.volumes)(d=t.darwin.volumes[h]).mount_point.startsWith("/var/lib/docker/overlay2")||(r=(r+="<tr><td><div class=style10 style=border-radius:5px;padding:8px>")+"<div style=margin-bottom:3px><b>"+d.mount_point+"</b></div>",d.size&&(r+=addDetailItem("Capacità",EscapeHtml(d.size),s)),d.available&&(r+=addDetailItem("Capacity Remaining",EscapeHtml(d.available),s)),d.type&&(r+=addDetailItem("File System",(""!=(y=1==d.removable?"Removable":1==d.cdrom?"CD-ROM":"")?y+" / ":"")+("Unknown"==d.type?"Sconosciuto":EscapeHtml(d.type)),s)),r+="</div>");""!=r&&a.push({name:"Storage Volumes",html:"<table style=width:100%>"+r+"</table>",img:"storage64.png"})}r="";for(h in a)null==a[h].img?r+="<div class=DevSt style=margin-bottom:3px;margin-left:16px><b>"+a[h].name+"</b></div><div style=margin-bottom:10px;margin-left:16px>"+a[h].html+"</div>":r=(r=(r+="<table style=width:100%><tr>")+"<td style=width:64px;vertical-align:top><img src=images/details/"+a[h].img+" border=0 width=64 /></td>")+"<td><div class=DevSt style=margin-bottom:3px;margin-left:16px><b>"+a[h].name+"</b></div><div style=margin-bottom:10px;margin-left:16px>"+a[h].html+"</div></td></tr></table>";""==r?QH("p17info2","Nessuna informazione per questo dispositivo."):QH("p17info2",r)}}function deviceDetailsShowBitlockerInfo(e,t,i){if(xxdialogMode)return!1;t="<div><p>Identificatore</p><p style=user-select:text;font-weight:bold>"+(t?decodeURIComponent(t):"Sconosciuto")+"</p>";t+="<p>Recovery Password</p><p style=user-select:text;font-weight:bold>"+(i?decodeURIComponent(i):"Sconosciuto")+"</p></div>",setModalContent("xxAddAgent",decodeURIComponent(e)+": BitLocker Information",t),showModal("xxAddAgentModal","idx_dlgOkButton")}function agentConsoleHandleKeys(e){var t,i,o;return!(!e.ctrlKey&&!e.altKey)||(t=0,i=Q("p15consoleText"),e.key?13==e.keyCode&&0==consoleFocus?(p15consoleSend(e),t=1):8==e.keyCode&&0==consoleFocus?(o=i.value,i.value=o.substring(0,o.length-1),t=1):27==e.keyCode?(i.value="",t=1):38==e.keyCode||40==e.keyCode?(o=consoleHistory.indexOf(i.value),38==e.keyCode&&consoleHistory.length-1>o?i.value=consoleHistory[o+1]:40==e.keyCode&&0<o?i.value=consoleHistory[o-1]:40==e.keyCode&&0==o&&(i.value=""),t=1):1===e.key.length&&(insertTextAtCursor(i,e.key),t=1):0!=e.charCode&&0==consoleFocus&&(i.value=i.value+String.fromCharCode(e.charCode),t=1),0<t?haltEvent(e):void 0)}function insertTextAtCursor(e,t){var i,o;document.selection?(e.focus(),(sel=document.selection.createRange()).text=t):e.selectionStart||"0"==e.selectionStart?(i=e.selectionStart,o=e.selectionEnd,e.value=e.value.substring(0,i)+t+e.value.substring(o,e.value.length),e.setSelectionRange(o+1,o+1)):e.value+=myValue}var consoleServerText="";function setupConsole(){var e,t;115==xxcurrentView?(e="server"==consoleNode,consoleNode="server",QH("p15deviceName","La mia console del server "),QE("p15consoleText",!0),QH("p15statetext",""),QH("p15coreName",""),QV("p15outputselecttd",!1),0==e&&(QH("p15agentConsoleText",consoleServerText),Q("p15agentConsoleText").scrollTop=Q("p15agentConsoleText").scrollHeight)):(e=consoleNode==currentNode,meshes[(consoleNode=currentNode).meshid],0!=(16&GetNodeRights(currentNode))?(null==consoleNode.consoleText&&(consoleNode.consoleText=""),0==e&&(QH("p15agentConsoleText",consoleNode.consoleText),Q("p15agentConsoleText").scrollTop=Q("p15agentConsoleText").scrollHeight),0==(1&consoleNode.conn)&&consoleNode.conn,e=0!=(1&consoleNode.conn)?"L'agente è online":"L'agente è offline",0!=(16&consoleNode.conn)&&(e+=", MQTT è online"),QH("p15statetext",e),QE("p15uploadCore",0!=(1&consoleNode.conn)),QV("p15outputselecttd",0!=(16&consoleNode.conn)||1==currentNode.pmt&&0!=(4&features2)),QV("p15outputselect2",0!=(16&consoleNode.conn)),QV("p15outputselect3",1==currentNode.pmt&&0!=(4&features2)),e=Q("p15outputselect").value,0==(16&consoleNode.conn)&&2==e&&(e=1,Q("p15outputselect").value=1),1==currentNode.pmt&&0!=(4&features2)||3!=e||(e=1,Q("p15outputselect").value=1),t=!1,0!=(1&consoleNode.conn)&&1==e&&(t=!0),0!=(16&consoleNode.conn)&&2==e&&(t=!0),1==currentNode.pmt&&0!=(4&features2)&&3==e&&(t=!0),QE("p15consoleText",t)):(QH("p15statetext","Accesso Negato"),QE("p15consoleText",!1),QE("p15uploadCore",!1),QV("p15outputselecttd",!1)),QV("devListToolbarViewIcons3",0!=(1&consoleNode.conn)))}function p15consoleClear(){QH("p15agentConsoleText",""),Q("id_p15consoleClear").blur(),115==xxcurrentView?consoleServerText="":consoleNode.consoleText=""}var consoleHistory=[];function p15consoleSend(e){var t;e&&13!=e.keyCode||(e=Q("p15consoleText").value,t="<div style=color:green>&gt; "+EscapeHtml(e)+"<br/></div>",115==xxcurrentView?(consoleServerText+=t,meshserver.send({action:"serverconsole",value:e})):0!=(16&consoleNode.conn)&&2==Q("p15outputselect").value?(t="<div style=color:orange>MQTT &gt; "+EscapeHtml(e)+"<br/></div>",consoleNode.consoleText+=t,meshserver.send({action:"sendmqttmsg",topic:"console",nodeids:[consoleNode._id],msg:e})):1==consoleNode.pmt&&3==Q("p15outputselect").value&&0!=(4&features2)?(t="<div style=color:violet>SPINGERE&gt; "+EscapeHtml(e)+"<br/></div>",consoleNode.consoleText+=t,meshserver.send({action:"pushconsole",nodeid:consoleNode._id,console:e})):0!=(1&consoleNode.conn)&&(consoleNode.consoleText+=t,meshserver.send({action:"msg",type:"console",nodeid:consoleNode._id,value:e})),Q("p15agentConsoleText").innerHTML+=t,Q("p15agentConsoleText").scrollTop=Q("p15agentConsoleText").scrollHeight,Q("p15consoleText").value="",0<e.length&&(0<=(t=consoleHistory.indexOf(e))&&consoleHistory.splice(t,1),consoleHistory.unshift(e),consoleHistory.splice(10)))}function p15consoleReceive(e,t,i){"serverconsole"===e?(t="<div>"+EscapeHtml(t)+"</div>",consoleServerText+=t,"server"==consoleNode&&(Q("p15agentConsoleText").innerHTML+=t,Q("p15agentConsoleText").scrollTop=Q("p15agentConsoleText").scrollHeight)):(t="MQTT"==i?"<div style=color:red>MQTT &gt; "+EscapeHtml(t)+"<br/></div>":"<div>"+EscapeHtml(t)+"</div>",null==e.consoleText?e.consoleText=t:e.consoleText+=t,consoleNode==e&&(Q("p15agentConsoleText").innerHTML+=t,Q("p15agentConsoleText").scrollTop=Q("p15agentConsoleText").scrollHeight))}function p15downloadConsoleText(){saveAs(new Blob([Q("p15agentConsoleText").innerText],{type:"application/octet-stream"}),"console.txt")}function p15uploadCore(e){xxdialogMode||(1==e.shiftKey?meshserver.send({action:"uploadagentcore",nodeids:[consoleNode._id],type:"default"}):1==e.altKey?meshserver.send({action:"uploadagentcore",nodeids:[consoleNode._id],type:"clear"}):1==e.ctrlKey?p15uploadCore2():(setModalContent("xxAddAgent","Esegui azione agente ",addHtmlFormFloating("Azione",'<select id=d3coreMode class="form-select me-2"><option value=1>Carica il core del server predefinito</option><option value=2>Cancella il core</option><option value=6>Carica core di ripristino </option><option value=7>Carica un piccolo nucleo</option><option value=3>Carica un file core</option><option value=4>Disconnessione agente soft</option><option value=5>Disconnessione forzata dell\'agente</option><option value=8>Restart agent service</select>')),showModal("xxAddAgentModal","idx_dlgOkButton",p15uploadCoreEx)))}function p15uploadCoreEx(){1==Q("d3coreMode").value?meshserver.send({action:"uploadagentcore",nodeids:[consoleNode._id],type:"default"}):2==Q("d3coreMode").value?meshserver.send({action:"uploadagentcore",nodeids:[consoleNode._id],type:"clear"}):3==Q("d3coreMode").value?p15uploadCore2():4==Q("d3coreMode").value?meshserver.send({action:"agentdisconnect",nodeid:consoleNode._id,disconnectMode:1}):5==Q("d3coreMode").value?meshserver.send({action:"agentdisconnect",nodeid:consoleNode._id,disconnectMode:2}):6==Q("d3coreMode").value?meshserver.send({action:"uploadagentcore",nodeids:[consoleNode._id],type:"recovery"}):7==Q("d3coreMode").value?meshserver.send({action:"uploadagentcore",nodeids:[consoleNode._id],type:"tiny"}):8==Q("d3coreMode").value&&meshserver.send({action:"msg",type:"console",nodeid:consoleNode._id,value:"service restart"})}function p15uploadCore2(){xxdialogMode||(Q("d3localmodeform").action="uploadmeshcorefile.ashx",Q("d3auth").value=authCookie,Q("d3filter").value=".js",Q("d3attrib").value=currentNode._id,setModalContent("xxAddAgent","Carica il core dell'agente mesh",""),showModal("xxAddAgentModal","idx_dlgOkButton",()=>p15uploadCoreEx2()),d3init())}function p15uploadCoreEx2(){var e;1==Q("d3uploadMode").value?Q("d3submit").click():1==(e=d3getFileSel()).length&&meshserver.send({action:"uploadagentcore",nodeids:[consoleNode._id],type:"custom",path:d3filetreelocation.join("/")+"/"+e[0]})}function account_viewPreviousLogins(){xxdialogMode||(xxdialogTag="previousLogins",setModalContent("xxAddAgent","Login precedenti","Loading..."),showModal("xxAddAgentModal","idx_dlgOkButton"),meshserver.send({action:"previousLogins"}))}function account_manageImage(e){var t,i,o,n;xxdialogMode||(t=0==e?userinfo:currentUser,setModalContent("xxAddAgent","Gestisci l'immagine dell'account",'<input id=p2file type=file class="form-control" accept="image/*" onchange=account_manageImageEx()><div style=width:100%><canvas id=p2canvas width=256 height=256 style="width:256px;height:256px;margin-left:60px;margin-top:8px;border-radius:16px;background: var(--sub-menu-bg);border: 1px solid #cfcdcd; cursor: pointer;" onclick=account_canvasClick() /></div>'),showModal("xxAddAgentModal","idx_dlgOkButton",account_manageImageEx2),i=Q("p2canvas").getContext("2d"),null==t.accountImageRnd&&(t.accountImageRnd=Math.floor(9999999999*Math.random())),o="",1==e&&(o="&id="+t._id.split("/")[2]),(n=new Image).onload=function(){i.clearRect(0,0,256,256),i.drawImage(n,0,0)},n.src=null!=t.flags&&1&t.flags?"userimage.ashx?rnd="+t.accountImageRnd+o:"images/user-256.png",QE("idx_dlgDeleteButton",null!=t.flags&&1&t.flags),QE("idx_dlgOkButton",!1))}function account_canvasClick(){Q("p2file").click()}function account_manageImageEx(){var e=Q("p2file").files[0],n=new Image;n.onload=function(){var e=0,t=0,i=Math.min(n.width,n.height),o=(n.width>i&&(e=(n.width-i)/2),n.height>i&&(t=(n.height-i)/2),Q("p2canvas").getContext("2d"));o.imageSmoothingEnabled=!0,o.webkitImageSmoothingEnabled=!0,o.mozImageSmoothingEnabled=!0,o.clearRect(0,0,256,256),o.drawImage(n,e,t,i,i,0,0,256,256),QE("idx_dlgOkButton",!0)},n.src=URL.createObjectURL(e)}function account_manageImageEx2(e,t){meshserver.send({action:"updateUserImage",userid:t,image:2==e?0:Q("p2canvas").toDataURL(Q("p2file").files[0].type)})}function account_managePhone(){xxdialogMode||0==(33554432&features)||(null!=userinfo.phone?(setModalContent("xxAddAgent","Notifiche telefoniche",'<table style=width:100%><tr><td style=width:56px><img src="images/phone80.png" style=padding:8px>'+("<td style=text-align:center><div style=padding:6px>Numero di telefono verificato</div><div style=font-size:20px>"+EscapeHtml(userinfo.phone)+"</div>")+'<div style=margin:10px><label><input id=d2delPhone type=checkbox class="form-check-input me-2" onclick=account_managePhoneRemoveValidate() />Rimuovi il numero di telefono</label></div>'),showModal("xxAddAgentModal","idx_dlgOkButton",()=>account_managePhoneRemove()),account_managePhoneRemoveValidate):(xxdialogTag="verifyPhone",setModalContent("xxAddAgent","Notifiche telefoniche",'<table style=width:100%><tr><td style=width:56px><img src="images/phone80.png" style=padding:8px>'+"<td>Inserisci il tuo numero di telefono abilitato agli SMS. Una volta verificato, il numero può essere utilizzato per la verifica dell'accesso e altre notifiche."+'<br /><br /><div style=width:100%;text-align:center>Numero di telefono: <input type=tel pattern="[0-9]" autocomplete="tel" inputmode="tel" maxlength=18 id=d2phoneinput onKeyUp=account_managePhoneValidate() onkeypress="if (event.key==\'Enter\') account_managePhoneValidate(1)"></div></table>'),showModal("xxAddAgentModal","idx_dlgOkButton",()=>account_managePhoneAdd()),Q("d2phoneinput").focus(),account_managePhoneValidate))()}function isPhoneNumber(e){var t=!0;e.startsWith("+")&&(e=e.substring(1));for(var i=0;i<e.length;i++){var o=e.charCodeAt(i);(o<48||57<o)&&32!=o&&45!=o&&46!=o&&(t=!1)}return t&&10<=e.length}function account_managePhoneValidate(e){var t=isPhoneNumber(Q("d2phoneinput").value);QE("idx_dlgOkButton",t),1==e&&t&&dialogclose(1)}function account_managePhoneCodeValidate(e){var t=6==Q("d2phoneCodeInput").value.length&&Q("d2phoneCodeInput").value.match(/[0-9]/);QE("idx_dlgOkButton",t),1==e&&t&&dialogclose(1)}function account_managePhoneConfirm(e,t){meshserver.send({action:"confirmPhone",code:Q("d2phoneCodeInput").value,cookie:t})}function account_managePhoneAdd(){0!=isPhoneNumber(Q("d2phoneinput").value)&&(QE("d2phoneinput",!1),meshserver.send({action:"verifyPhone",phone:Q("d2phoneinput").value}))}function account_managePhoneRemove(){Q("d2delPhone").checked&&meshserver.send({action:"removePhone"})}function account_managePhoneRemoveValidate(){QE("idx_dlgOkButton",Q("d2delPhone").checked)}function account_manageMessaging(){var e,t;xxdialogMode||0==(33554432&features2)||(null!=userinfo.msghandle?(setModalContent("xxAddAgent","Messaging Notifications",e=(e='<table style=width:100%><tr><td style=width:56px><img src="images/messaging40.png" style=padding:8px>')+("<td style=text-align:center><div style=padding:6px>Verified handle</div><div style=font-weight:bold>"+EscapeHtml(userinfo.msghandle)+"</div>")+'<div style=margin:10px><label><input id=d2delPhone type=checkbox class="form-check-input me-2" onclick=account_managePhoneRemoveValidate() />Remove messaging</label></div>'),showModal("xxAddAgentModal","idx_dlgOkButton",()=>account_manageMessagingRemove()),account_managePhoneRemoveValidate):(t="<select id=d2serviceselect style=width:160px;margin-left:8px onchange=account_manageMessagingValidate()>",0!=(1&serverinfo.userMsgProviders)&&(t+="<option value=1>Telegram</option>"),0!=(4&serverinfo.userMsgProviders)&&(t+="<option value=4>Discord</option>"),0!=(8&serverinfo.userMsgProviders)&&(t+="<option value=8>XMPP</option>"),0!=(16&serverinfo.userMsgProviders)&&(t+="<option value=16>CallMeBot</option>"),0!=(32&serverinfo.userMsgProviders)&&(t+="<option value=32>Pushover</option>"),0!=(64&serverinfo.userMsgProviders)&&(t+="<option value=64>ntfy</option>"),0!=(128&serverinfo.userMsgProviders)&&(t+="<option value=128>Zulip</option>"),0!=(256&serverinfo.userMsgProviders)&&(t+="<option value=256>Slack</option>"),e=(e='<table style=width:100%><tr><td style=width:56px;vertical-align:top><img src="images/messaging40.png" style=padding:8px>')+"<td>Enter your messaging service and handle. Once verified, this server can send you login verification and other notifications.<br /><br /><table><tr><td>Service<td>"+(t+="</select>")+"<tr><td>Handle<td><input maxlength=1024 style=width:160px;margin-left:8px id=d2handleinput onKeyUp=account_manageMessagingValidate() onkeypress=\"if (event.key=='Enter') account_manageMessagingValidate(1)\"></table>",serverinfo.discordUrl&&(e+="<div id=d2discordurl style=display:none><br /><a href="+serverinfo.discordUrl+' target="_discord">Join this Discord server to receive notifications.</a></div>'),e+='<div id=d2callmebotinfo style=display:none><br /><a href=https://www.callmebot.com/blog/free-api-signal-send-messages/ target="_callmebot">Signal</a>, <a href=https://www.callmebot.com/blog/free-api-whatsapp-messages/ target="_callmebot">Whatsapp</a>, <a href=https://www.callmebot.com/blog/free-api-facebook-messenger/ target="_callmebot">Facebook</a>, <a href=https://www.callmebot.com/blog/telegram-text-messages/ target="_callmebot">Telegram</a></div><div id=d2pushoverinfo style=display:none><br /><a href=https://pushover.net/ target="_pushover">Information at Pushover.net</a></div>',console.log(serverinfo.userMsgNftyUrl),e+='<div id=d2ntfyinfo style=display:none><br /><a href="'+(serverinfo.userMsgNftyUrl||"https://ntfy.sh/")+'" target="_ntfy">Free service at ntfy.sh</a></div>',xxdialogTag="VerifyMessaging",setModalContent("xxAddAgent","Messaging Notifications",e+='<div id=d2slackinfo style=display:none><br /><a href=https://api.slack.com/messaging/webhooks target="_slack">Slack Webhook Setup</a></div>'),showModal("xxAddAgentModal","idx_dlgOkButton",account_manageMessagingAdd()),Q("d2handleinput").focus(),account_manageMessagingValidate))()}function account_manageMessagingValidate(e){serverinfo.discordUrl&&QV("d2discordurl",4==Q("d2serviceselect").value),QV("d2callmebotinfo",16==Q("d2serviceselect").value),QV("d2pushoverinfo",32==Q("d2serviceselect").value),QV("d2ntfyinfo",64==Q("d2serviceselect").value),QV("d2slackinfo",256==Q("d2serviceselect").value),4==Q("d2serviceselect").value?Q("d2handleinput").placeholder="Username:0000":8==Q("d2serviceselect").value?Q("d2handleinput").placeholder="username@server.com":16==Q("d2serviceselect").value?Q("d2handleinput").placeholder="https://api.callmebot.com/...":32==Q("d2serviceselect").value?Q("d2handleinput").placeholder="User key":64==Q("d2serviceselect").value?Q("d2handleinput").placeholder="Argomento":128==Q("d2serviceselect").value?Q("d2handleinput").placeholder="username@sample.com":256==Q("d2serviceselect").value?Q("d2handleinput").placeholder="https://hooks.slack.com/...":Q("d2handleinput").placeholder="Nome utente";var t=0<Q("d2handleinput").value.length;QE("idx_dlgOkButton",t),1==e&&t&&dialogclose(1)}function account_manageMessagingAdd(){0!=Q("d2handleinput").value.length&&(QE("d2handleinput",!1),meshserver.send({action:"verifyMessaging",service:Q("d2serviceselect").value,handle:Q("d2handleinput").value}))}function account_manageMessagingConfirm(e,t){meshserver.send({action:"confirmMessaging",code:Q("d2phoneCodeInput").value,cookie:t})}function account_manageMessagingRemove(){Q("d2delPhone").checked&&meshserver.send({action:"removeMessaging"})}function account_manageAuthEmail(){var e;xxdialogMode||0==(8388608&features)||(setModalContent("xxAddAgent","Autenticazione e-mail",'Quando abilitato, ad ogni accesso, ti verrà data la possibilità di ricevere un token di accesso al tuo account e-mail per una maggiore sicurezza. <br /><br /><label><input id=email2facheck type=checkbox class="form-check-input me-2" '+((e=1==userinfo.otpekey&&null!=userinfo.email&&1==userinfo.emailVerified)?"checked":"")+"/>Abilita l'autenticazione a due fattori della posta elettronica.</label>"),showModal("xxAddAgentModal","idx_dlgOkButton",function(){e!=Q("email2facheck").checked&&meshserver.send({action:"otpemail",enabled:Q("email2facheck").checked})}))}function account_manageAuthDuo(){xxdialogMode||0==(536870912&features2)||(0==(1==userinfo.otpduo)?(setModalContent("xxAddAgent","Duo Authentication",'Confirm enabling of Duo 2FA login security. Once enabled you will be given the option to use Duo at login for added security. Click ok to go thru the steps to enable Duo.<p style="text-align:center;margin-top:10px"><img src="images/duo-2fa-250.png"></p>'),showModal("xxAddAgentModal","idx_dlgOkButton",function(){window.location.href="/add-duo?rurl="+encodeURIComponentEx(window.location.href)+(urlargs.key?"&key="+urlargs.key:"")})):(setModalContent("xxAddAgent","Duo Authentication",'<p><label><input id=duo2facheck type=checkbox onclick=account_manageAuthDuoConfirm() /> Confirm disabling 2FA Duo login security.</label></p><p style="text-align: center"><img src="images/duo-2fa-250-disable.png"></p>'),showModal("xxAddAgentModal","idx_dlgOkButton",function(){meshserver.send({action:"otpduo",enabled:!1})}),QE("idx_dlgOkButton",!1)))}function account_manageAuthDuoConfirm(){QE("idx_dlgOkButton",Q("duo2facheck").checked)}function account_manageAuthApp(){if(!xxdialogMode&&0!=(4096&features))return(1==userinfo.otpsecret?account_removeOtp:account_addOtp)(),!1}function account_addOtp(){xxdialogMode||1==userinfo.otpsecret||0==(4096&features)||(xxdialogTag="otpauth-request",setModalContent("xxAddAgent","App Autenticatrice","<div id=d2optinfo>Caricamento in corso...</div>"),showModal("xxAddAgentModal","idx_dlgOkButton",function(){meshserver.send({action:"otpauth-setup",secret:Q("d2optsecret").attributes.secret.value,token:Q("d2otpauthinput").value})}),meshserver.send({action:"otpauth-request"}))}function account_addOtpCheck(e){var t=6==Q("d2otpauthinput").value.length;QE("idx_dlgOkButton",t),e&&13==e.keyCode&&t&&dialogclose(1)}function account_removeOtp(){xxdialogMode||1!=userinfo.otpsecret||0==(4096&features)||(setModalContent("xxAddAgent","App Autenticatrice","Confermare la rimozione dell'applicazione di autenticazione accesso in 2 passaggi?"),showModal("xxAddAgentModal","idx_dlgOkButton",function(){meshserver.send({action:"otpauth-clear"})}))}function account_manageOtp(e){return 2==xxdialogMode&&"otpauth-manage"==xxdialogTag&&dialogclose(0),xxdialogMode||0==(4096&features)||0<count2factoraAuths()&&meshserver.send({action:"otpauth-getpasswords",subaction:e}),!1}function account_managePushAuthDev(){if(!xxdialogMode&&0!=(64&features2)){if(1==userinfo.otpdev)setModalContent("xxAddAgent","Dispositivo di autenticazione","Confermare la rimozione del dispositivo di autenticazione push?"),showModal("xxAddAgentModal","idx_dlgOkButton",function(){meshserver.send({action:"otpdev-clear"})});else{var e=[];for(i in nodes){var t=nodes[i];null!=t.agent&&14==t.agent.id&&1==t.pmt&&4294967295==GetNodeRights(t)&&e.push(t)}if(0==e.length)setModalContent("xxAddAgent","Dispositivo di autenticazione","In order to use push notification authentication, a mobile device must be setup in your account with full rights."),showModal("xxAddAgentModal","idx_dlgOkButton");else{var i,o="Seleziona un dispositivo da registrare per l'autenticazione tramite notifica push.Una volta selezionato, il dispositivo chiederà conferma.<br /><br />",n='<select id=d2devselect class="form-select">';for(i in e)n+='<option value="'+e[i]._id+'">'+EscapeHtml(e[i].name)+"</option>";setModalContent("xxAddAgent","Dispositivo di autenticazione",o+=addHtmlFormFloating("Dispositivo",n+="</select>")),showModal("xxAddAgentModal","idx_dlgOkButton",function(){meshserver.send({action:"otpdev-set",nodeid:Q("d2devselect").value})})}}return!1}}function account_manageHardwareOtp(){return 2==xxdialogMode&&"otpauth-hardware-manage"==xxdialogTag&&dialogclose(0),xxdialogMode||0==(4096&features)||meshserver.send({action:"otp-hkey-get"}),!1}function account_addhkey(e){var t;3==e?(t="Digita il nome della chiave da aggiungere.<br /><br />",t+=addHtmlFormFloating("Nome chiave",'<input id=dp1keyname class="form-control" maxlength=20 autocomplete=off placeholder="La mia chiave" onkeyup=account_addhkeyValidate(event,2) />')):2==e&&(t="Digita il nome di una chiave, seleziona la casella OTP e premi il pulsante su YubiKeytrade;.<br /><br />",t=(t+=addHtmlFormFloating("Nome chiave",'<input id=dp1keyname class="form-control" maxlength=20 autocomplete=off placeholder="La mia chiave" onkeyup=account_addhkeyValidate(event,1) />'))+addHtmlFormFloating("YubiKey&trade; OTP",'<input id=dp1key class="form-control" autocomplete=off onkeyup=account_addhkeyValidate(event,2) />')),setModalContent("xxAddAgent","Aggiungi token di sicurezza",t),showModal("xxAddAgentModal","idx_dlgOkButton",()=>account_addhkeyEx(3,e)),Q("dp1keyname").focus()}function account_addhkeyValidate(e,t){null!=e&&13==e.keyCode&&(2==t?dialogclose(1):Q("dp1key").focus())}function account_addhkeyEx(e,t){var i=Q("dp1keyname").value;""==i&&(i="MyKey"),2==t?(meshserver.send({action:"otp-hkey-yubikey-add",name:i,otp:Q("dp1key").value}),xxdialogTag="otpauth-hardware-manage",setModalContent("xxAddAgent","Aggiungi token di sicurezza","<br />Controllo ...<br /><br /><br />"),showModal("xxAddAgentModal","idx_dlgOkButton")):3==t&&meshserver.send({action:"webauthn-startregister",name:i})}function account_removehkey(e){meshserver.send({action:"otp-hkey-remove",index:e}),meshserver.send({action:"otp-hkey-get"})}var currentMesh,filetreelinkpath,loclist={af:"Afrikaans",sq:"albanese",ar:"Arabo (standard)","ar-dz":"Arabo (Algeria)","ar-bh":"Arabo (Bahrain)","ar-eg":"Arabo (Egitto)","ar-iq":"Arabo (Iraq)","ar-jo":"Arabo (Giordania)","ar-kw":"Arabo (Kuwait)","ar-lb":"Arabo (Libano)","ar-ly":"Arabo (Libia)","ar-ma":"Arabo (Marocco)","ar-om":"Arabo (Oman)","ar-qa":"Arabo (Qatar)","ar-sa":"Arabo (Arabia Saudita)","ar-sy":"Arabo (Siria)","ar-tn":"Arabo (Tunisia)","ar-ae":"Arabo (U.A.E.)","ar-ye":"Arabo (Yemen)",an:"Aragonese",hy:"Armeno",as:"Assamese",ast:"Asturiano",az:"Azero",eu:"Basco",bg:"Bulgaro",be:"Bielorusso",bn:"Bengalese",bs:"Bosniaco",br:"Bretone",my:"Birmano",ca:"Catalano",ch:"Chamorro",ce:"Ceceno",zh:"Cinese","zh-hk":"Cinese (Hong Kong)","zh-cn":"Cinese (PRC)","zh-sg":"Cinese (Singapore)","zh-tw":"Cinese (Taiwan)",cv:"Chuvash",co:"Corso",cr:"Cree",hr:"Croato",cs:"Ceco",da:"Danese",nl:"Olandese (Standard)","nl-be":"Olandese (belga)",en:"Inglese","en-au":"Inglese (Australia)","en-bz":"Inglese (Belize)","en-ca":"Inglese (Canada)","en-ie":"Inglese (Irlanda)","en-jm":"Inglese (Giamaica)","en-nz":"Inglese (Nuova Zelanda)","en-ph":"Inglese (Filippine)","en-za":"Inglese (Sud Africa)","en-tt":"Inglese (Trinidad e Tobago)","en-gb":"Inglese (Regno Unito)","en-us":"Inglese (Stati Uniti)","en-zw":"Inglese (Zimbabwe)",eo:"Esperanto",et:"Estone",fo:"Faeroese",fa:"Farsi (persiano)",fj:"Fijiano",fi:"finlandese",fr:"Francese (Standard)","fr-be":"Francese (Belgio)","fr-ca":"Francese (Canada)","fr-fr":"Francese (Francia)","fr-lu":"Francese (Lussemburgo)","fr-mc":"Francese (Monaco)","fr-ch":"Francese (Svizzera)",fy:"Frisone",fur:"Friulano",gd:"Gaelico (scozzese)","gd-ie":"Gaelico (irlandese)",gl:"galiziano",ka:"Georgiano",de:"Tedesco (Standard)","de-at":"Tedesco (Austria)","de-de":"Tedesco (Germania)","de-li":"Tedesco (Liechtenstein)","de-lu":"Tedesco (Lussemburgo)","de-ch":"Tedesco (Svizzera)",el:"Greco",gu:"Gujarati",ht:"Haitiano",he:"Ebraico",hi:"hindi",hu:"ungherese",is:"islandese",id:"Indonesiano",iu:"Inuktitut",ga:"irlandese",it:"Italiano (Standard)","it-ch":"Italiano (Svizzera)",ja:"giapponese",kn:"Kannada",ks:"Kashmir",kk:"Kazako",km:"Khmer",ky:"Kirghiz",tlh:"Klingon",ko:"Coreano","ko-kp":"Coreano (Corea del Nord)","ko-kr":"Coreano (Corea del Sud)",la:"Latino",lv:"lettone",lt:"Lituano",lb:"Lussemburghese",mk:"FYRO macedone",ms:"malese",ml:"Malayalam",mt:"Maltese",mi:"Maori",mr:"Marathi",mo:"Moldavo",nv:"Navajo",ng:"Ndonga",ne:"nepalese ",no:"norvegese ",nb:"norvegese (bokmal)",nn:"Norvegese (Nynorsk) ",oc:"occitano ",or:"Oriya",om:"Oromo ","fa-ir":"Persiano/Iran",pl:"Polacco",pt:"portoghese","pt-br":"Portoghese (Brasile)",pa:"Punjabi","pa-in":"Punjabi (India)","pa-pk":"Punjabi (Pakistan)",qu:"Quechua",rm:"Retoromanzo",ro:"Rumeno","ro-mo":"Rumeno (Moldavia)",ru:"Russo","ru-mo":"Russo (Moldavia)",sz:"Sami (lappone)",sg:"Sango",sa:"Sanscrito",sc:"Sardo",sd:"Sindhi",si:"cingalese",sr:"Serbo",sk:"Slovacco",sl:"Sloveno",so:"Somani",sb:"sorabo",es:"Spagnolo","es-ar":"Spagnolo (Argentina)","es-bo":"Spagnolo (Bolivia)","es-cl":"Spagnolo (Cile)","es-co":"Spagnolo (Colombia)","es-cr":"Spagnolo (Costa Rica)","es-do":"Spagnolo (Repubblica Dominicana)","es-ec":"Spagnolo (Ecuador)","es-sv":"Spagnolo (Salvador)","es-gt":"Spagnolo (Guatemala)","es-hn":"Spagnolo (Honduras)","es-mx":"Spagnolo (Messico)","es-ni":"Spagnolo (Nicaragua)","es-pa":"Spagnolo (Panamá)","es-py":"Spagnolo (Paraguay)","es-pe":"Spagnolo (Perù)","es-pr":"Spagnolo (Portorico)","es-es":"Spagnolo (Spagna)","es-uy":"Spagnolo (Uruguay)","es-ve":"Spagnolo (Venezuela)",sx:"Sutu",sw:"Swahili",sv:"svedese","sv-fi":"Svedese (Finlandia)","sv-sv":"Svedese (Svezia)",ta:"Tamil",tt:"Tatar",te:"Teluga",th:"Thai",tig:"Tigre",ts:"Tsonga",tn:"Tswana",tr:"Turco",tk:"turkmeno",uk:"ucraino",hsb:"sorabo superiore ",ur:"Urdu",ve:"Venda",vi:"vietnamita ",vo:"Volapuk",wa:"Vallone",cy:"gallese ",xh:"Xhosa",ji:"yiddish ",zu:"Zulu"},loclistex={"zh-chs":"Cinese semplificato)","zh-cht":"Cinese tradizionale"};function account_showLocalizationSettings(){if(!xxdialogMode){var e=getstore("loctag",0),t="",i='<select id=d2locselect class="form-select"><option value="*">Valore del browser dell\'utente </option>';for(o in loclist)i+='<option value="'+o+'"'+(e==o?" selected":"")+">"+o+" - "+loclist[o]+"</option>";if(i+="</select>",serverinfo.languages&&0<serverinfo.languages.length){t+="La modifica della lingua richiederà un aggiornamento della pagina.<br /><br />";var o,n='<select id=d2langselect class="form-select"><option value="*">Valore del browser dell\'utente </option>';for(o in serverinfo.languages){var a=serverinfo.languages[o];n+='<option value="'+a+'"'+(userinfo.lang==a?" selected":"")+">"+a+" - "+(loclist[a]||loclistex[a])+"</option>"}t+=addHtmlFormFloating("linguaggio",n+="</select>")}t+=addHtmlFormFloating("Date e ora",i),4294967295==userinfo.siteadmin&&""==domain&&(t+='<br /><a rel="noreferrer noopener" target="_blank" href="translator.htm">Aiutaci a tradurre MeshCentral</a>'),setModalContent("xxAddAgent","Impostazioni di localizzazione",t),showModal("xxAddAgentModal","idx_dlgOkButton",account_showLocalizationSettingsEx)}return!1}function account_showLocalizationSettingsEx(){var e=Q("d2langselect"),e=e?e.value:null,e=((e="*"==e&&null==userinfo.lang?userinfo.lang:e)!=userinfo.lang&&meshserver.send({action:"changelang",lang:e}),getstore("loctag",0)),t=Q("d2locselect").value;e!=t&&("*"!=t?args.locale=t:delete args.locale,putstore("loctag",args.locale),mainUpdate(4294967295))}function account_enableNotifications(){return Notification&&Notification.requestPermission().then(function(e){QV("accountEnableNotificationsSpan","granted"!=e),setupServiceWorker()}),!1}function account_createLoginToken(){if(xxdialogMode)return!1;var e,t="",i="Crea un nome utente e una password temporanei che possono essere utilizzati come accesso alternativo al tuo account. Questo è utile per consentire a strumenti o altri servizi di accedere al tuo account.<br /><br />",o={0:"Illimitato",1:"1 minuto",5:"5 minuti",10:"10 minuti",15:"15 minuti",30:"30 minuti",45:"45 minuti",60:"60 minuti",120:"2 ore",240:"4 ore",480:"8 ore",720:"12 ore",960:"16 ore",1440:"24 ore",2880:"2 giorni",5760:"4 giorni",10080:"7 giorni"};for(e in o)t+="<option value="+e+">"+o[e]+"</option>";setModalContent("xxAddAgent","Crea Token di Accesso",i+'<div class="form-floating mb-3">'+'<input type=text class="boxsize form-control" id=d2tokenName maxlength="100" placeholder="Nome token" onchange=account_createLoginTokenValidate() onkeyup=account_createLoginTokenValidate()>'+"<label for=d2tokenName>Nome token</label>"+"</div>"+addHtmlFormFloating("Scadenza",'<select class="boxsize form-select" id=d2tokenExpire>'+t+"</select>")),showModal("xxAddAgentModal","idx_dlgOkButton",account_createLoginTokenEx),QE("idx_dlgOkButton",!1),Q("d2tokenName").focus()}function account_createLoginTokenValidate(){QE("idx_dlgOkButton",0<Q("d2tokenName").value.length)}function account_createLoginTokenEx(){meshserver.send({action:"createLoginToken",name:Q("d2tokenName").value,expire:parseInt(Q("d2tokenExpire").value)})}function account_showAccountNotifySettings(){var e;return xxdialogMode||(setModalContent("xxAddAgent","Impostazioni di notifica",'<div class="form-check"><label><input id=p2notifyPlayNotifySound class="form-check-input me-2" type=checkbox />Suono di notifica</label></div><div class="form-check"><label><input id=p2notifyGroupName class="form-check-input me-2" type=checkbox />Visualizza il nome del gruppo di dispositivi</label></div><div class="form-check"><label><input id=p2notifyIntelDeviceConnect class="form-check-input me-2" type=checkbox />Connessioni del dispositivo</label></div><div class="form-check"><label><input id=p2notifyIntelDeviceDisconnect class="form-check-input me-2" type=checkbox />Disconnessioni del dispositivo</label></div><div class="form-check"><label><input id=p2notifyIntelAmtKvmActions class="form-check-input me-2" type=checkbox />Intel&reg; Desktop AMT e eventi seriali</label></div>'),showModal("xxAddAgentModal","idx_dlgOkButton",account_showAccountNotifySettingsEx),e=getstore("notifications",0),Q("p2notifyPlayNotifySound").checked=1&e,Q("p2notifyIntelDeviceConnect").checked=2&e,Q("p2notifyIntelDeviceDisconnect").checked=4&e,Q("p2notifyIntelAmtKvmActions").checked=8&e,Q("p2notifyGroupName").checked=16&e),!1}function account_showAccountNotifySettingsEx(){var e=0;putstore("notifications",(e+=Q("p2notifyPlayNotifySound").checked?1:0)+(Q("p2notifyIntelDeviceConnect").checked?2:0)+(Q("p2notifyIntelDeviceDisconnect").checked?4:0)+(Q("p2notifyIntelAmtKvmActions").checked?8:0)+(Q("p2notifyGroupName").checked?16:0))}function account_showVerifyEmail(){return xxdialogMode||1==userinfo.emailVerified||1!=serverinfo.emailcheck||(setModalContent("xxAddAgent","verifica email","Fare clic su OK per inviare un'e-mail di verifica a:<br /><div style=padding:8px><b>"+EscapeHtml(userinfo.email)+"</b></div>Attendi qualche minuto per ricevere la verifica."),showModal("xxAddAgentModal","idx_dlgOkButton",()=>account_showVerifyEmailEx())),!1}function account_showVerifyEmailEx(){meshserver.send({action:"verifyemail",email:userinfo.email})}function account_showChangeEmail(){return xxdialogMode||(setModalContent("xxAddAgent","Modifica dell'indirizzo e-mail",'Modifica qui l\'indirizzo email del tuo account.<br /><br /><div class="form-floating"><input id=dp2email class="form-control" maxlength=256 onchange=account_validateEmail() onkeyup=account_validateEmail(event) placeholder=Email /> <label for=dp2email>Email</label></div>'),showModal("xxAddAgentModal","idx_dlgOkButton",account_changeEmail),null!=userinfo.email&&(Q("dp2email").value=userinfo.email),account_validateEmail(),Q("dp2email").focus()),!1}function account_validateEmail(e,t){QE("idx_dlgOkButton",validateEmail(Q("dp2email").value)&&Q("dp2email").value!=userinfo.email),null!=e&&13==e.keyCode&&dialogclose(1)}function account_changeEmail(){meshserver.send({action:"changeemail",email:Q("dp2email").value})}function account_showDeleteAccount(){return xxdialogMode||(setModalContent("xxAddAgent","Eliminare l'account","Per eliminare questo account, digita la password dell'account in entrambe le caselle sottostanti e premi ok. <br /><br />"+"<form method=post>"+"<input type=hidden name=action value=deleteaccount />"+('<input type=hidden name=authcookie value="'+authCookie+'" />')+'<div class="container">'+'<div class="form-floating mb-2">'+'<input type=password class="form-control" id=apassword1 name=apassword1 autocomplete=off placeholder="Password" onchange=account_validateDeleteAccount() onkeyup=account_validateDeleteAccount()>'+'<label for="apassword1">Password</label>'+"</div>"+'<div class="form-floating mb-3">'+'<input type=password class="form-control" id=apassword2 name=apassword2 autocomplete=off placeholder="Confirm Password" onchange=account_validateDeleteAccount() onkeyup=account_validateDeleteAccount()>'+"<label for=apassword2>Confirm Password</label>"+"</div>"+"</div>"+"</form>"),showModal("xxAddAgentModal","idx_dlgOkButton",function(){dialogclose(1)}),account_validateDeleteAccount(),Q("apassword1").focus()),!1}function account_showChangePassword(){if(!xxdialogMode){var e="Cambia la password del tuo account inserendo la vecchia password e due volte la nuova password nelle caselle sottostanti.",e=(e=(e=(e=(e=(e=(e=(e+="<br /><br />")+'<div class="container">'+'<div class="form-floating mb-2">')+'<input type=password class="form-control" id=apassword0 name=apassword0 autocomplete=off placeholder="Old password" onchange=account_validateNewPassword() onkeyup=account_validateNewPassword() onkeydown=account_validateNewPassword()>'+"<label for=apassword0>Old password</label>")+"</div>"+'<div class="form-floating mb-2">')+'<input type=password class="form-control" id=apassword1 name=apassword1 autocomplete=off placeholder="New password" onchange=account_validateNewPassword() onkeyup=account_validateNewPassword() onkeydown=account_validateNewPassword()>'+"<label for=apassword1>New password</label>")+"<b><span id=dxPassWarn></span></b>"+"</div>")+'<div class="form-floating mb-2">'+'<input type=password class="form-control" id=apassword2 name=apassword2 autocomplete=off placeholder="Confirm new password" onchange=account_validateNewPassword() onkeyup=account_validateNewPassword() onkeydown=account_validateNewPassword()>')+"<label for=apassword2>Confirm new password</label>"+"</div>";if(65536&features&&(e+='<div class="form-floating mb-2"><input type=text class="form-control" id=apasswordhint name=apasswordhint maxlength=250 autocomplete=off onchange=account_validateNewPassword() onkeyup=account_validateNewPassword() onkeydown=account_validateNewPassword()><label for=apasswordhint>Password hint</label></div>'),e+="</div>",passRequirements){var t,i=[],o=0;for(t in passRequirements)"reset"!=t&&"hint"!=t&&(i.push(t+":"+passRequirements[t]),o++);0<o&&(e+="<br /><span style=font-size:x-small>Requisiti:"+i.join(", ")+".</span>")}setModalContent("xxAddAgent","Cambia la password",e+="<br />"),showModal("xxAddAgentModal","idx_dlgOkButton",account_showChangePasswordEx),Q("apassword0").focus(),account_validateNewPassword()}return!1}function account_showChangePasswordEx(){var e;Q("apassword1").value==Q("apassword2").value&&(e={action:"changepassword",oldpass:Q("apassword0").value,newpass:Q("apassword1").value},65536&features&&(e.hint=Q("apasswordhint").value),meshserver.send(e))}function account_showThemesSwitcher(){var i,e,o,n;return xxdialogMode||(i=getstore("theme")||"default",e=JSON.parse(getstore("lastThemes")||"[]"),o=new Set(e),n='<div class="form-group"><label for="theme-switcher">Select a theme:</label>',n+='<select id="theme-switcher" class="form-select" onchange="account_switchThemeEx()">',0<e.length&&(n+='<optgroup label="Recent Themes"">',e.forEach(function(e){n+=`<option value="${e}"${e===i?" selected":""}>${e.charAt(0).toUpperCase()+e.slice(1)}</option>`}),n+="</optgroup>"),n+='<optgroup label="All Themes">',[{value:"default",label:"Predefinito"},{value:"cerulean",label:"Cerulean"},{value:"cosmo",label:"Cosmo"},{value:"cyborg",label:"Cyborg"},{value:"darkly",label:"Darkly"},{value:"flatly",label:"Flatly"},{value:"journal",label:"Journal"},{value:"litera",label:"Litera"},{value:"lumen",label:"Lumen"},{value:"lux",label:"Lux"},{value:"materia",label:"Materia"},{value:"minty",label:"Minty"},{value:"morph",label:"Morph"},{value:"pulse",label:"Pulse"},{value:"sandstone",label:"Sandstone"},{value:"simplex",label:"Simplex"},{value:"sketchy",label:"Sketchy"},{value:"solar",label:"Solar"},{value:"spacelab",label:"Spacelab"},{value:"united",label:"United"},{value:"vapor",label:"Vapor"},{value:"yeti",label:"Yeti"},{value:"zephyr",label:"Zephyr"}].forEach(function(e){var t;o.has(e.value)||(t=e.value===i?" selected":"",n+=`<option value="${e.value}"${t}>${e.label}</option>`)}),setModalContent("xxAddAgent","Switch theme",n=n+"</optgroup>"+"</select></div>"),showModal("xxAddAgentModal","idx_dlgOkButton")),!1}function account_switchThemeEx(){let e=document.getElementById("theme-switcher"),t=e.value;var i="default"!=t?encodeURIComponent(t):encodeURIComponent(".."),i=(document.getElementById("theme-stylesheet").href=`styles/themes/${i}/bootstrap-min.css`,putstore("theme",t),JSON.parse(getstore("lastThemes")||"[]"));(i.includes(t)?i=i.filter(e=>e!==t):(4<=i.length&&i.pop(),i)).unshift(t),putstore("lastThemes",JSON.stringify(i))}function account_createMesh(){if(4294967295!=userinfo.siteadmin&&0!=(64&userinfo.siteadmin))setModalContent("xxAddAgent","Nuovo gruppo di dispositivi ","This account does not have the rights to create a new device group."),showModal("xxAddAgentModal","idx_dlgOkButton");else if(!0!==userinfo.emailVerified&&1==serverinfo.emailcheck&&4294967295!=userinfo.siteadmin)setModalContent("xxAddAgent","Sicurezza dell 'Account",'Unable to access this feature until a email address is verified. This is required for password recovery. Go to the "My Account" tab to change and verify an email address.'),showModal("xxAddAgentModal","idx_dlgOkButton");else if(262144&features&&0==count2factoraAuths())setModalContent("xxAddAgent","Sicurezza dell 'Account",'Unable to access this feature until two-factor authentication is enabled. This is required for extra security. Go to the "My Account" tab and look at the "Account Security" section.'),showModal("xxAddAgentModal","idx_dlgOkButton");else{var e=[];if(0==(2&features))for(var t in nodes){var i=nodes[t];2==i.mtype&&null!=i.agent&&4294967295==GetNodeRights(i)&&e.push(i)}var o="Crea un nuovo gruppo di dispositivi utilizzando le opzioni seguenti.<br /><br />",n="";if(o+=addHtmlFormFloating("Nome",'<input id=dp2meshname maxlength=128 placeholder="Name" class=form-control onchange=account_validateMeshCreate() onkeyup=account_validateMeshCreate(event,1) />'),0==(1&features)&&(n+="<option value=3>Dispositivi locali, nessun agente</option>"),0==(2&features)&&0<e.length&&(n+="<option value=103>Nessun dispositivo agente trasmesso tramite agente</option>"),65536&features2&&(0==(1&features)&&(n+="<option value=4>IP-KVM / Dispositivo di alimentazione</option>"),0==(2&features))&&0<e.length&&(n+="<option value=104>IP-KVM/Dispositivo di alimentazione inoltrato tramite agente</option>"),o+=addHtmlFormFloating("Digita","<select id=dp2meshtype class=form-select onchange=account_validateMeshCreate() onkeyup=account_validateMeshCreate(event,2) ><option value=2>Gestisci utilizzando un agente software</option><option value=1>Intel&reg; AMT only, no agent</option>"+n+"</select>"),0<e.length){o+="<div id=d2devrelaydiv style=display:none>",e.sort(nameSort);var a=[];for(t in e)a.push('<option value="'+e[t]._id+'">'+EscapeHtml(e[t].name)+"</option>");o=o+addHtmlFormFloating("Dispositivo ripetitore","<select id=d2devrelay onchange=account_validateMeshCreate() onkeyup=account_validateMeshCreate(event,2) class=form-select >"+a.join("")+"</select>")+"</div>"}setModalContent("xxAddAgent","Nuovo gruppo di dispositivi ",o=(o=(o=(o=(o=o+addHtmlFormFloating("Descrizione","<textarea id=dp2meshdesc maxlength=1024 class=form-control></textarea>")+"<div id=d2ipkvm style=display:none><hr />")+addHtmlFormFloating("Modello","<select id=dp2ipkvmmodel onchange=account_validateMeshCreate() onkeyup=account_validateMeshCreate(event,2) class=form-select ><option value=1>Dominio Raritan KX III</option><option value=2>Interruttore di alimentazione web 7</option></select>"))+addHtmlFormFloating("Nome host",'<input id=dp2ipkvmhost maxlength=128 placeholder="Hostname" onchange=account_validateMeshCreate() onkeyup=account_validateMeshCreate(event,1) class=form-control />'))+addHtmlFormFloating("Nome utente",'<input id=dp2ipkvmuser maxlength=128 placeholder="Username" onchange=account_validateMeshCreate() onkeyup=account_validateMeshCreate(event,1) class=form-control />'))+addHtmlFormFloating("Password",'<input id=dp2ipkvmpass type=password placeholder="Password" maxlength=128 onchange=account_validateMeshCreate() onkeyup=account_validateMeshCreate(event,1) class="form-control" />')+"</div>"),showModal("xxAddAgentModal","idx_dlgOkButton",account_createMeshEx),account_validateMeshCreate(),document.getElementById("dp2meshname").focus()}return!1}function account_validateMeshCreate(e,t){var i=parseInt(Q("dp2meshtype").value),t=(1==t&&null!=e&&"accedere"==e.key&&0<Q("dp2meshname").value.length&&Q("dp2meshtype").focus(),2==t&&null!=e&&"accedere"==e.key&&Q("dp2meshdesc").focus(),0<Q("dp2meshname").value.length);QV("d2ipkvm",4==i||104==i);try{QV("d2devrelaydiv",100<i)}catch(e){}4==i&&0==Q("dp2ipkvmhost").value.length&&0==Q("dp2ipkvmuser").value.length&&0==Q("dp2ipkvmpass").value.length&&(t=!1),QE("idx_dlgOkButton",t)}function account_createMeshEx(e,t){var i=parseInt(Q("dp2meshtype").value),o={action:"createmesh",meshname:Q("dp2meshname").value,meshtype:i,desc:Q("dp2meshdesc").value};4!=i&&104!=i||(o.kvmmodel=parseInt(Q("dp2ipkvmmodel").value),o.kvmhost=Q("dp2ipkvmhost").value,o.kvmuser=Q("dp2ipkvmuser").value,o.kvmpass=Q("dp2ipkvmpass").value),100<i&&(o.meshtype=i-100,o.relayid=Q("d2devrelay").value),meshserver.send(o)}function account_validateDeleteAccount(){QE("account_dlgOkButton",0<Q("apassword1").value.length&&Q("apassword1").value==Q("apassword2").value)}function account_validateNewPassword(){var e,t="",i=0<Q("apassword0").value.length&&0<Q("apassword1").value.length&&Q("apassword1").value==Q("apassword2").value&&Q("apassword0").value!=Q("apassword1").value;65536&features&&Q("apasswordhint").value==Q("apassword1").value&&(i=!1),""!=Q("apassword1").value&&(null==passRequirements||""==passRequirements?t=80<=(e=checkPasswordStrength(Q("apassword1").value))?"<span style=color:green>Forte<span>":60<=e?"<span style=color:blue>Buona<span>":"<span style=color:red>Debole <span>":0==checkPasswordRequirements(Q("apassword1").value,passRequirements)&&(i=!1,t="<span style=color:red>Politica<span>")),QH("dxPassWarn",t),QE("idx_dlgOkButton",i)}function checkPasswordStrength(e){var t=0,i={},o=0,n={digits:/\d/.test(e),lower:/[a-z]/.test(e),upper:/[A-Z]/.test(e),nonWords:/\W/.test(e)};if(!e)return 0;for(var a,s=0;s<e.length;s++)i[e[s]]=(i[e[s]]||0)+1,t+=5/i[e[s]];for(a in n)o+=1==n[a]?1:0;return parseInt(t+10*(o-1))}function checkPasswordRequirements(e,t){if(null==t||""==t||"object"!=typeof t)return!0;if(t.min&&e.length<t.min)return!1;if(t.max&&e.length>t.max)return!1;for(var i=0,o=0,n=0,a=0,s=0;s<e.length;s++)/\d/.test(e[s])&&i++,/[a-z]/.test(e[s])&&o++,/[A-Z]/.test(e[s])&&n++,/\W/.test(e[s])&&a++;return!(t.numeric&&i<t.numeric||t.lower&&o<t.lower||t.upper&&n<t.upper||t.nonalpha&&a<t.nonalpha)}function updateMeshes(){var e='<div class="row">',t=0,o=0,n=[];for(i in meshes)n.push(meshes[i]);for(i in n.sort(nameSort),n){1<t&&(e+="</tr><tr>",t=0),t++,o++;var a=GetMeshRights(n[i]),s="Diritti parziali ";4294967295==a?s="Amministratore completo":0==a&&(s="Nessun diritto"),e+=`
                    <div class="col-sm-12 col-md-6 col-lg-4 col-xl-3 mb-2"
                            onclick="gotoMesh('`+n[i]._id+`')"
                            onkeypress="if (event.key=='Enter') gotoMesh('`+n[i]._id+`')"
                            style="cursor:pointer;">
                        <div class="card mb-3">
                            <div class="row g-0">
                                <div class="col-2 parent" style="display: flex; justify-content: center; align-items: center;">
                                    <i class="mi me-1"></i>
                                </div>
                                <div class="col-10 mx-auto" tabindex="0">
                                    <div class="card-body" style=padding:0;>
                                        <h5 class="card-title e1">`+EscapeHtml(n[i].name)+`</h5>
                                        <p class="card-text">`+s+`</p>
                                        <div class="g2"></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    `}e+="</div>",meshcount=o,QH("p2meshes",e),QV("p2noMeshFound",0==o)}function updateLoginTokens(){var e="",t=1;if(null!=loginTokens&&0<loginTokens.length){for(var e=e+'<p><strong>Token di accesso attivi</strong> - <span id="p2createMeshLink1"> <button class="btn btn-primary btn-sm" onclick="return account_createLoginToken()"><i class="fa-fw fa-solid fa-circle-plus"></i> Nuovo</button></span></p>'+'<div style=margin-left:40px><table class="table table-hover table-striped"><tbody><tr class="table-active"><th scope=col style=text-align:left;width:430px>Nome</th><th scope=col style=text-align:left>Nome utente</th></tr>',i=0;i<loginTokens.length;i++){var o=loginTokens[i],n="<a href=# onclick='return p2removeLoginToken(event,\""+encodeURIComponentEx(o.tokenUser)+'")\' title="Rimuovi token di accesso" role=button><i class="fa-solid fa-trash text-danger fa-xs"></i></a>',a="";0!=o.expire&&(a=EscapeHtml(format("Scade il {0}",printDateTime(new Date(o.expire))))+" "),e+="<tr "+(++t%2==0?"style=background-color:#DDD":"")+'><td style=width:30%><i class="fa-fw fa-solid fa-user"></i>&nbsp;'+EscapeHtml(o.name)+"<div></div></div></td><td style=width:70%><div style=float:right>"+a+n+"</div><div>"+EscapeHtml(o.tokenUser)+"</div></td></tr>"}e+="</tbody></table></div><br />",QV("accountCreateLoginTokenSpan",!1)}else QV("accountCreateLoginTokenSpan",128&features2);QH("p2logintokens",e)}function p2removeLoginToken(e,t){if(t=decodeURIComponent(t),null!=loginTokens){for(var i,o=null,n=0;n<loginTokens.length;n++)loginTokens[n].tokenUser==t&&(o=loginTokens[n]);null!=o&&(i="Confermare la rimozione di questo token di accesso?<br /><br />",setModalContent("xxAddAgent","Rimuovi token di accesso",i=(i+=addHtmlValue("Nome",EscapeHtml(o.name)))+addHtmlValue("Nome utente",EscapeHtml(o.tokenUser))),showModal("xxAddAgentModal","idx_dlgOkButton",()=>function(e,t){meshserver.send({action:"loginTokens",remove:[t]})}))}}function gotoMesh(e){return currentMesh=meshes[e],p20updateMesh(),go(20),!1}function server_setupGoogleDriveBackup(){if(xxdialogMode||null==miscState.googleDrive)return!1;var e,t=miscState.googleDrive;t.state<3?(e='<img style=float:right src="images/googledrive-48.png" /><div>Configura questo server per caricare automaticamente i backup su Google Drive. Inizia creando e inserendo un ClientID e un ClientSecret di Google Drive per il tuo account.</div><br />',setModalContent("xxAddAgent","Backup di Google Drive",e=(e=(e+=addHtmlValue("Credenziali",'<a href="https://console.developers.google.com/apis/api/drive.googleapis.com/credentials" rel="noreferrer noopener" target="_blank">Console di Google Drive</a>'))+addHtmlFormFloating("Identificativo client",'<input id=gdclientid class="form-control" placeholder="xxxxxxxx.apps.googleusercontent.com" onkeyup=server_setupGoogleDriveBackupCheck1()></input>'))+addHtmlFormFloating("Segreto del client",'<input id=gdclientsecret class="form-control" onkeyup=server_setupGoogleDriveBackupCheck1()></input>')),showModal("xxAddAgentModal","idx_dlgOkButton",()=>server_setupGoogleDriveBackupEx(3,"gd1")),Q("gdclientid").focus(),QE("idx_dlgOkButton",!1)):3==t.state&&(e='<img style=float:right src="images/googledrive-48.png" /><div>Il backup di Google Drive è attualmente attivo.</div>',setModalContent("xxAddAgent","Backup di Google Drive",e+='<br /><label><input id=gdcheck type=checkbox class="form-check-input me-2" onchange=server_setupGoogleDriveBackupCheck2() />Rimuovi configurazione</label>'),showModal("xxAddAgentModal","idx_dlgOkButton",()=>server_setupGoogleDriveBackupEx(3,"gd0")),QE("idx_dlgOkButton",!1))}function server_setupGoogleDriveBackupCheck1(){QE("idx_dlgOkButton",0<Q("gdclientid").value.length&&0<Q("gdclientsecret").value.length)}function server_setupGoogleDriveBackupCheck2(){QE("idx_dlgOkButton",Q("gdcheck").checked)}function server_setupGoogleDriveBackupCheck3(){QE("idx_dlgOkButton",0<Q("gdcode").value.length)}function server_setupGoogleDriveBackupEx(e,t){"gd0"==t&&meshserver.send({action:"serverBackup",service:"googleDrive",state:0}),"gd1"==t&&meshserver.send({action:"serverBackup",service:"googleDrive",state:1,clientid:Q("gdclientid").value,clientsecret:Q("gdclientsecret").value}),"gd2"==t&&meshserver.send({action:"serverBackup",service:"googleDrive",state:2,code:Q("gdcode").value})}function server_showRestoreDlg(){var e;return xxdialogMode||(e="Ripristina il server utilizzando un backup, <span style=color:red>questo cancellerà i dati del server esistente.</span> Fallo solo se sai cosa stai facendo.<br /><br />",setModalContent("xxAddAgent","Ripristina server",e=(e=(e+='<form action="/restoreserver.ashx'+(urlargs.key?"?key="+urlargs.key:"")+'" enctype="multipart/form-data" method="post"><div>')+("<input type=hidden name=auth value="+authCookie+">"))+'<input id=account_dlgFileInput type=file name=datafile class="form-control" accept=".zip,application/octet-stream,application/zip,application/x-zip,application/x-zip-compressed" onchange=account_validateServerRestore()>'+"</div></form>"),showModal("xxAddAgentModal","idx_dlgOkButton"),account_validateServerRestore()),!1}function account_validateServerRestore(){QE("idx_dlgOkButton",1==Q("account_dlgFileInput").files.length)}function server_showVersionDlg(){return xxdialogMode||(xxdialogMode=2,xxdialogTag="MeshCentralServerUpdate",setModalContent("xxAddAgent","Versione MeshCentral","Caricamento in corso..."),showModal("xxAddAgentModal","idx_dlgOkButton"),meshserver.send({action:"serverversion"})),!1}function server_showVersionDlgUpdate(){var e=Q("d2updateCheck1").checked,t=Q("d2updateCheck2").checked;QE("d2updateCheck1","Sconosciuto"!=xxdialogTag.stable&&xxdialogTag.current!=xxdialogTag.stable&&0==t),QE("d2updateCheck2","Sconosciuto"!=xxdialogTag.latest&&xxdialogTag.current!=xxdialogTag.latest&&0==e),QE("idx_dlgOkButton",e&&!t||!e&&t)}function server_showVersionDlgEx(e,t){Q("d2updateCheck1").checked&&meshserver.send({action:"serverupdate",tag:"stable",version:t.stable}),Q("d2updateCheck2").checked&&meshserver.send({action:"serverupdate",tag:"latest",version:t.latest})}function server_showErrorsDlg(){return xxdialogMode||(xxdialogMode=2,xxdialogTag="MeshCentralServerErrors",setModalContent("xxAddAgent","Server Errors","Caricamento in corso..."),meshserver.send({action:"servererrors"})),!1}function server_showErrorsDlgUpdate(){QE("idx_dlgOkButton",Q("d2clearErrorsCheck").checked)}function server_showErrorsDlgEx(){meshserver.send({action:"serverclearerrorlog"})}function d2CopyServerErrorsToClip(){saveAs(new Blob([Q("d2ServerErrorsLogPre").innerText],{type:"application/octet-stream"}),"servererrors.txt")}function server_showConfigDlg(){return xxdialogMode||(xxdialogMode=2,xxdialogTag="MeshCentralServerConfig",meshserver.send({action:"serverconfig"})),!1}function d2CopyServerConfigToClip(){saveAs(new Blob([Q("d2ServerConfigPre").innerText],{type:"application/octet-stream"}),"config.json")}function p20updateMesh(){if(null!=currentMesh){var e,t,i=GetMeshRights(currentMesh),o=EscapeHtml(currentMesh.name),n=(0==o.length&&(o="<i>Nessuna </i>"),0!=(1&i)&&(o='<span role=button tabindex=0 title="Fare clic qui per modificare il nome del gruppo di dispositivi" onclick=p20editmesh(1) onkeyup="if (event.key == \'Enter\') p20editmesh(1)">'+o+' <i class="fa-solid fa-pencil fa-2xs"></i></span>'),QH("p20meshName",o),QV("MeshSummary",4!=currentMesh.mtype),format("Sconosciuto #{0}",currentMesh.mtype)),a=(1==currentMesh.mtype&&(n="Intel&reg; AMT only, no agent"),2==currentMesh.mtype&&(n="Gestito tramite un agente software"),3==currentMesh.mtype&&(n=null==currentMesh.relayid?"Dispositivi locali, nessun agente":"Nessun dispositivo agente trasmesso tramite agente"),4==currentMesh.mtype&&(n=null==currentMesh.relayid?"Dispositivo IP-KVM":"Dispositivo IP-KVM inoltrato tramite agente",1==currentMesh.kvm.model)&&(n+=", Raritan KX III"),"");if(0!=(8&args.hide)&&(a+=addHtmlValue("Nome",o)),a=(a+=addHtmlValue("Descrizione",addLinkConditional(currentMesh.desc&&""!=currentMesh.desc?EscapeHtml(currentMesh.desc):"<i>Nessuna </i>","p20editmesh(2)",0!=(1&i))))+addHtmlValue("Digita",n),3!=currentMesh.mtype&&4!=currentMesh.mtype||null==currentMesh.relayid||(o="<i>Sconosciuto</i>",a+=addHtmlValue("Dispositivo ripetitore",addLinkConditional(o=null!=(n=getNodeFromId(currentMesh.relayid))?EscapeHtml(n.name):o,"p20editmeshrelay()",0!=(1&i)))),4==currentMesh.mtype&&(a=(a+=addHtmlValue("Nome host",currentMesh.kvm.host))+addHtmlValue("Nome utente",currentMesh.kvm.user)),null!=currentMesh.creatorid&&null!=users&&null!=users[currentMesh.creatorid]?a+=addHtmlValue("Creatore",'<a href=# onclick=gotoUser("'+encodeURIComponentEx((n=users[currentMesh.creatorid])._id)+'",false,null)>'+EscapeHtml(n.name)+"</a>"):null!=currentMesh.creatorname&&(a+=addHtmlValue("Creatore",EscapeHtml(currentMesh.creatorname))),null!=currentMesh.creation&&(a+=addHtmlValue("Tempo di creazione",printDateTime(new Date(currentMesh.creation)))),3!=currentMesh.mtype&&(e=[],currentMesh.flags&&(1&currentMesh.flags&&e.push("Rimozione Automatica"),2&currentMesh.flags&&e.push(4==currentMesh.mtype?"Sincronizzazione nome porta":"Hostname Sync"),1==serverinfo.devGroupSessionRecording)&&4&currentMesh.flags&&e.push("Registra sessioni"),"number"==typeof currentMesh.expireDevs&&0<currentMesh.expireDevs&&e.push("Rimuovi inattivo"),a+=addHtmlValue("Caratteristiche",addLinkConditional(e=""==(e=e.join(", "))?"<i>Nessuna </i>":e,"p20editmeshfeatures()",1&i))),2==currentMesh.mtype&&(e=[],o=0,currentMesh.consent&&(o=currentMesh.consent),serverinfo.consent&&(o|=serverinfo.consent),64&o&&8&o?e.push("Prompt desktop + barra degli strumenti"):64&o?e.push("Barra degli strumenti desktop"):8&o?e.push("Prompt del desktop"):1&o&&e.push("Notifica desktop"),16&o?e.push("Prompt del terminale"):2&o&&e.push("Notifica terminale"),32&o?e.push("Prompt file"):4&o&&e.push("Notifica file"),7==o&&(e=["Avvisa sempre"]),a+=addHtmlValue("Consenso dell'utente ",addLinkConditional(e=""==(e=(e=56==(56&o)?["Chiedi sempre"]:e).join(", "))?"<i>Nessuna </i>":e,"p20editmeshconsent(1)",1&i))),3==currentMesh.mtype||4294967295!=userinfo.siteadmin&&0!=(1024&userinfo.siteadmin)||(n=0,o=[],userinfo.links&&userinfo.links[currentMesh._id]&&userinfo.links[currentMesh._id].notify&&(n|=userinfo.links[currentMesh._id].notify),userinfo.notify&&userinfo.notify[currentMesh._id]&&(n|=userinfo.notify[currentMesh._id]),2&n&&o.push("Connetti"),4&n&&o.push("Disconnetti"),8&n&&o.push("Intel&reg; AMT"),16384&features2&&userinfo.emailVerified&&(t=0,16&n&&t++,32&n&&t++,64&n&&t++,0<t)&&o.push(format("Email ({0})",t)),null!=userinfo.msghandle&&0!=(33554432&features2)&&(t=0,128&n&&t++,256&n&&t++,512&n&&t++,0<t)&&o.push(format("Messaging ({0})",t)),0==o.length&&o.push("<i>Nessuna </i>"),a+=addHtmlValue("Notifiche ",addLink(o.join(", "),"p20editMeshNotify()"))),16777216&features&&2==currentMesh.mtype&&(n=!(e="<i>Nessuna </i>"),null!=currentMesh.invite&&(n=!0,e=currentMesh.invite.codes.join(", ")),a+=addHtmlValue("Codici di invito",addLinkConditional(e,"p20editmeshInviteCode()",1&i||n))),currentMesh.mtype<3&&0!=(1&features2)&&(t="Nessuna politica",currentMesh.amt&&(1==currentMesh.amt.type?t="Disattivare":2==currentMesh.amt.type?(t="Modalità di controllo client semplice (CCM)",2==currentMesh.amt.cirasetup&&(t+=" + CIRA")):3==currentMesh.amt.type?(t="Modalità di controllo semplice dell'amministratore (ACM)",2==currentMesh.amt.cirasetup&&(t+=" + CIRA")):4==currentMesh.amt.type&&(t="Completamente automatico")),a+=addHtmlValue("Intel&reg; AMT",addLinkConditional(t,"p20editMeshAmt()",1&i))),1&i&&(a+='<br><input type=button class="btn btn-primary btn-sm mb-1" value=Appunti  title="Visualizza le note su questo gruppo di dispositivi " onclick=showNotes(false,"'+encodeURIComponentEx(currentMesh._id)+'") />'),a+="<br style=clear:both><br>",2&i&&(a+='<button class="btn btn-primary btn-sm me-2 mb-1" onclick="return p20showAddMeshUserDialog()"><i class="fa-solid fa-circle-plus"></i> Aggiungi utenti</button>',null!=usergroups)){var s=0,r=!1;for(v in usergroups)null==usergroups[v].membershipType&&usergroups[v]._id.split("/")[1]==currentMesh._id.split("/")[1]&&(s++,null==currentMesh.links||null==currentMesh.links[v])&&(r=!0);0<s&&r&&(a+='<button class="btn btn-primary btn-sm me-2 mb-1" onclick="return p20showAddMeshUserDialog(2)"><i class="fa-solid fa-circle-plus"></i> Aggiungi gruppo utenti</button>')}1==currentMesh.mtype&&(1&i&&(a+='<button class="btn btn-primary btn-sm me-2 mb-1" title="Import Intel&reg; AMT devices." onclick=\'return showAmtImport("'+currentMesh._id+'")\'><i class="fa-solid fa-circle-arrow-down"></i> Import</button>'),null!=currentMesh.amt)&&0<currentMesh.amt.type&&(a+='<button class="btn btn-primary btn-sm me-2 mb-1" title="Esegui Intel&reg; Attivazione e configurazione AMT." onclick=\'return showAmtSetup("'+currentMesh._id+'")\'><i class="fa-solid fa-gear"></i> Impostare</button>'),2!=currentMesh.mtype||4294967295!=userinfo.siteadmin&&0!=(4096&userinfo.siteadmin)||(a=(a+='<button class="btn btn-primary btn-sm me-2 mb-1" onclick=\'return addAgentToMesh("'+currentMesh._id+'")\' title="Aggiungi un nuovo computer a questo gruppo di dispositivi installando l\'agente mesh."><i class="fa-solid fa-circle-plus"></i> Aggiungi agente</button>')+'<button class="btn btn-primary btn-sm me-2 mb-1" onclick=\'return inviteAgentToMesh("'+currentMesh._id+'")\' title="Invita qualcuno a installare l\'agente mesh su questo gruppo di dispositivi."><i class="fa-solid fa-user-plus"></i> Invitare</button>'),3!=currentMesh.mtype||4294967295!=userinfo.siteadmin&&0!=(4096&userinfo.siteadmin)||(a+='<button class="btn btn-primary btn-sm me-2 mb-1" onclick=\'return addLocalDeviceToMesh("'+currentMesh._id+'")\' title="Aggiungi dispositivo situato sulla rete locale."><i class="fa-solid fa-circle-plus"></i> Aggiungi dispositivo</button>'),currentMesh.amt&&2<currentMesh.amt.type&&(4294967295==userinfo.siteadmin||0==(4096&userinfo.siteadmin))&&(a+='<button class="btn btn-primary btn-sm me-2 mb-1" title="Passa Intel AMT alla modalità di controllo amministratore (ACM)." onclick=\'return showAmtAcmSetup()\'><i class="fa-solid fa-circle-arrow-down"></i> ACM</button>'),a+='<table class="table table-hover table-striped" cellpadding=2 cellspacing=0><tbody><tr><th scope=col>Autorizzazioni utente </th><th scope=col></th></tr>';var l=1,d=[];for(v in currentMesh.links){var c=v.split("/")[2];currentMesh.links[v].name&&(c=currentMesh.links[v].name),v==userinfo._id&&(c=userinfo.name),null!=usergroups&&null!=usergroups[v]&&(c=usergroups[v].name),d.push({id:v,name:c,rights:currentMesh.links[v].rights})}for(v in d.sort(function(e,t){return e.name>t.name?1:e.name<t.name?-1:0}),d){var u="",p=makeDeviceGroupRightsString(d[v].rights),m="fa-user",g=(d[v].id==userinfo._id||4294967295!=i&&0==(2&i)||(4294967295!=i&&4294967295==currentMesh.links[d[v].id].rights||(u="<a href=# onclick='return p20deleteUser(event,\""+encodeURIComponentEx(d[v].id)+'")\' title="Rimuovi i diritti utente su questo gruppo di dispositivi"><i role=button class="fa-solid fa-trash text-danger fa-fw fa-xs"></i></a>'),p='<span tabindex=0 style=cursor:pointer onclick=p20viewuser("'+encodeURIComponentEx(d[v].id)+"\") onkeypress=\"if (event.key=='Enter') p20viewuser('"+encodeURIComponentEx(d[v].id)+"')\">"+p+' <i class="fa-fw fa-solid fa-pencil fa-xs"></i></span>'),d[v].id.startsWith("ugrp/")&&(m="fa-users"),EscapeHtml(decodeURIComponent(d[v].name)));null!=usergroups&&d[v].id.startsWith("ugrp/")&&(g="<a tabindex=0 href=# onclick='gotoUserGroup(\""+encodeURIComponentEx(d[v].id)+"\");haltEvent(event);'>"+g+"</a>"),a+="<tr style="+(l%2==0?";background-color:#DDD":"")+'><td style=width:30%><div><i title="Utente" class="fa-solid fa-fw '+m+'"></i>&nbsp;'+(g=null!=users&&d[v].id.startsWith("user/")?"<a tabindex=0 href=# onclick='gotoUser(\""+encodeURIComponentEx(d[v].id)+"\");haltEvent(event);'>"+g+"</a>":g)+"<div></div></div></td><td style=width:70%><div style=float:right>"+u+"</div><div>"+p+"</div></td></tr>",++l}if(a+="</tbody></table>",null!=deviceShares&&deviceSharesNode==currentMesh._id&&0<deviceShares.length){a+='<p></p><table class="table table-hover table-striped" cellpadding=2 cellspacing=0 width=100%><tbody><tr style=background-color:#AAAAAA;font-weight:bold><th scope=col style=text-align:left;width:430px>Condivisione attiva del dispositivo</th><th scope=col style=text-align:left><th scope=col style=text-align:left></th></tr>';for(var l=1,v=0;v<deviceShares.length;v++){var h=deviceShares[v],u="",f=(null!=h.url&&(u+='<a href="'+h.url+'" rel="noreferrer noopener" target=_blank title="Collegamento di condivisione del dispositivo" style=cursor:pointer><img src=images/link2.png border=0 height=10 width=10></a> '),u+="<a href=# onclick='return p30removeDeviceSharing(event,\""+encodeURIComponentEx(h.nodeid)+'","'+encodeURIComponentEx(h.publicid)+'","'+encodeURIComponentEx(h.guestName)+'")\' title="Rimuovi la condivisione del dispositivo" style=cursor:pointer><img src=images/trash.png border=0 height=10 width=10></a>',""),x=(h.p<=7?f=["","Terminale","Desktop","Desktop + Terminale","File","Terminale + File","Desktop + File","Desktop + Terminale + File"][h.p]:8==h.p?f="HTTP/"+h.port:16==h.p&&(f="HTTPS/"+h.port),f),f=(null!=h.startTime&&null!=h.expireTime&&(x=format("{0}, {1} a {2}",f,printFlexDateTime(new Date(h.startTime)),printFlexDateTime(new Date(h.expireTime)))),null!=h.startTime&&null!=h.duration&&(x=h.duration<2?format("{0}, {1} per {2} minuto",f,printFlexDateTime(new Date(h.startTime)),h.duration):format("{0}, {1} per {2} minuti",f,printFlexDateTime(new Date(h.startTime)),h.duration)),1==h.recurring&&(x+=", Ricorrente ogni giorno"),2==h.recurring&&(x+=", Ricorrente settimanale"),0!=(2&h.p)&&!0===h.viewOnly&&(x+=", Visualizza solo desktop"),null!=h.consent&&(0==h.consent?x+=", Nessun consenso":(0!=(56&h.consent)&&(x+=", Richiedi consenso"),0!=(64&h.consent)&&(x+=", Barra degli strumenti"))),EscapeHtml(h.guestName));h.publicid.startsWith("AS:node/")&&(f="<i>Auto-condivisione dell'agente</i>"),null!=(b=getNodeFromId(h.nodeid))&&(y=0<b.conn?"":" gray",a+="<tr "+(++l%2==0?"style=background-color:#DDD":"")+"><td style=width:30%>"+("<div onclick='gotoDevice(\""+b._id+'",10);haltEvent(event);\' style=float:left class="j'+b.icon+y+'"></div>&nbsp;<a onclick=\'gotoDevice("'+b._id+"\",10);haltEvent(event);'>"+EscapeHtml(b.name)+"</a>")+"<td style=width:30%><div class=m2></div><div>&nbsp;"+f+"<div></div></div></td><td style=width:70%><div style=float:right>"+u+"</div><div>"+x+"</div></td></tr>")}a+="</tbody></table>"}else deviceSharesNode!=currentMesh._id&&deviceSharesReq!=currentMesh._id&&(deviceSharesReq=currentMesh._id,meshserver.send({action:"deviceMeshShares",meshid:currentMesh._id}));l=0,nodes.sort(deviceSort);var o="",k=(1==currentMesh.mtype&&(o+='<a onclick=meshDownloadDeviceList()><img title="Scarica l\'elenco dei dispositivi" src="images/link4.png" /></a>',0==(1&features))&&(o+=' <a onclick=meshImportDeviceList()><img title="Importa elenco dispositivi" src="images/link6.png" /></a>'),'<table class="table table-hover table-striped"><tbody><tr class="class="fw-bold"><th>Dispositivi</th><th scope=col class="text-end">'+o+"</th></tr>");for(v in nodes){var b,y=0<(b=nodes[v]).conn?"":" gray";currentMesh._id==b.meshid&&(k+="<tr><td style=width:30%><div onclick='gotoDevice(\""+b._id+'",10);haltEvent(event);\' style=float:left class="j'+b.icon+y+'"></div>&nbsp;<a onclick=\'gotoDevice("'+b._id+"\",10);haltEvent(event);'>"+EscapeHtml(b.name)+"</a></div></div></td><td><div style=float:right>"+PowerStateStr(b.pwr)+"&nbsp;</div><div>"+(b.osdesc?EscapeHtml(b.osdesc):"")+"</div></td></tr>",++l)}0==l&&(k+='<tr><td colspan="2"><i>Nessuna </i></td></tr>'),k+="</tbody></table>",4294967295==i&&(k+="<div style=font-size:small;text-align:right><span><a href=# onclick=p20showDeleteMeshDialog() style=cursor:pointer>Elimina Gruppo</a></span></div>"),QH("p20info",a),QH("p20info2",k);var w="";if(0==(268435456&features)&&20<=xxcurrentView&&xxcurrentView<=29&&null!=currentMesh){for(var v in w="?viewmode="+xxcurrentView+"&gotomesh="+currentMesh._id.split("/")[2],urlargs)w+="&"+v+"="+urlargs[v];try{window.history.replaceState({},document.title,window.location.pathname+w)}catch(e){}}}}function meshDownloadDeviceList(){if(!xxdialogMode){var e,t={webappversion:"0.9.0",computers:[]};for(e in nodes){var i,o=nodes[e];currentMesh._id==o.meshid&&null!=o.intelamt&&(i={name:o.name,host:o.host,user:o.intelamt.user,pass:"",tls:1==o.intelamt.tls?1:0,ver:o.intelamt.ver,pstate:o.intelamt.state},2==o.intelamt.state&&(i.pmode=1),o.intelamt.realm&&(i.digestrealm=o.intelamt.realm),o.intelamt.hash&&(i.tlscerthash=o.intelamt.hash),t.computers.push(i))}saveAs(stringToUtf8BlobNoHeader(JSON.stringify(t,null,2)),currentMesh.name+".json")}}function meshImportDeviceList(){xxdialogMode||(setModalContent("xxAddAgent","Importa dispositivi Intel&reg; AMT",'Importa un elenco di dispositivi Intel&reg; AMT locali in formato JSON MeshCommander.<br /><br /><input type=file id=d4importFile class="form-control" accept=".json" onchange=meshImportDeviceListValidate() />'),showModal("xxAddAgentModal","idx_dlgOkButton",()=>meshImportDeviceListEx()),QE("idx_dlgOkButton",!1))}function meshImportDeviceListValidate(){QE("idx_dlgOkButton",null!=Q("d4importFile").value)}function meshImportDeviceListEx(){var e=new FileReader;e.onload=function(e){var t=null;try{t=JSON.parse(e.target.result)}catch(e){return setModalContent("xxAddAgent","Importa dispositivi Intel&reg; AMT",format("File JSON non valido: {0}.",e)),void showModal("xxAddAgentModal","idx_dlgOkButton")}if("object"==typeof t&&"string"==typeof t.webappversion&&"object"==typeof t.computers&&Array.isArray(t.computers)){var i,o=0;for(i in t.computers){var n,a=t.computers[i];"string"==typeof a.name&&"string"==typeof a.host&&"string"==typeof a.user&&"string"==typeof a.pass&&(n={action:"addamtdevice",meshid:currentMesh._id,devicename:a.name,hostname:a.host,amtusername:a.user,amtpassword:a.pass,amttls:1==a.tls?1:0},"string"==typeof a.ver&&(n.ver=a.ver),"number"==typeof a.pstate&&(n.state=a.pstate),"string"==typeof a.digestrealm&&(n.realm=a.digestrealm),"string"==typeof a.tlscerthash&&(n.hash=a.tlscerthash),meshserver.send(n),o++)}0==o&&setModalContent("xxAddAgent","Importazione dell'account utente ","Unable to import any device.")}else setModalContent("xxAddAgent","Importa dispositivi Intel&reg; AMT","Invalid JSON file format.");showModal("xxAddAgentModal","idx_dlgOkButton")},e.readAsText(Q("d4importFile").files[0])}function p20editMeshAmt(){xxdialogMode||(setModalContent("xxAddAgent","Intel&reg; Politica AMT",""+addHtmlFormFloating("Digita",'<select id=dp20amtpolicy class="form-select" onchange=p20editMeshAmtChange()><option value=0>Nessuna politica</option><option value=1>Disattivare</option><option value=2>Modalità di controllo client semplice (CCM)</option>'+(0!=(1048576&features)?"<option value=3>Modalità di controllo semplice dell'amministratore (ACM)</option>":"")+"<option value=4>Completamente automatico</option></select>")+"<div id=dp20amtpolicydiv></div>"),showModal("xxAddAgentModal","idx_dlgOkButton",p20editMeshAmtEx),currentMesh.amt&&(Q("dp20amtpolicy").value=currentMesh.amt.type),p20editMeshAmtChange(),!currentMesh.amt||2!=currentMesh.amt.type&&3!=currentMesh.amt.type||(Q("dp20amtpolicypass").value=currentMesh.amt.password,2!=currentMesh.amt.type&&3!=currentMesh.amt.type||(null!=currentMesh.amt.badpass&&(Q("dp20amtbadpass").value=currentMesh.amt.badpass),3==currentMesh.amt.type&&null!=currentMesh.amt.ccm&&(Q("dp20amtccmmode").value=currentMesh.amt.ccm)),0==(1024&features)&&(Q("dp20amtcira").value=currentMesh.amt.cirasetup)),dp20amtValidatePolicy())}function p20editMeshAmtChange(){var e=Q("dp20amtpolicy").value,t="";2!=e&&3!=e||(t=(t=(t=t+addHtmlFormFloating("Password",'<select id=dp20amtpass class="form-select" onchange=dp20amtValidatePolicy() onkeyup=dp20amtValidatePolicy()><option value=0>Password casuale</option>'+(null!=currentMesh.amt&&1==currentMesh.amt.password?"<option value=1 selected>Mantieni la password esistente</option>":"")+"<option value=2>Seleziona nuova password</option></select>")+"<div id=dp20amtpassdiv style=display:none>")+addHtmlFormFloating("Nuova password*",'<input id=dp20amtpolicypass type=password class="form-control" maxlength=32 placeholder="New password*" onchange=dp20amtValidatePolicy() onkeyup=dp20amtValidatePolicy() autocomplete=off />'))+addHtmlFormFloating("Nuova password*",'<input id=dp20amtpolicypass2 type=password class="form-control" maxlength=32 placeholder="New password*" onchange=dp20amtValidatePolicy() onkeyup=dp20amtValidatePolicy() autocomplete=off />')+"</div>",3==e&&(t+=addHtmlFormFloating("Modalità CCM",'<select id=dp20amtccmmode class="form-select" onchange=dp20amtValidatePolicy() onkeyup=dp20amtValidatePolicy()><option value=0>Non cambiare, mantieni CCM se configurato</option><option value=1>Disattiva CCM se configurato</option><option value=2>Attiva in CCM, se ACM fallisce</option></select>')),t=(t+="<div id=dp20amtbadpassdiv style=display:none>")+addHtmlFormFloating("Password sconosciuta",'<select id=dp20amtbadpass class="form-select"><option value=0>Fare niente</option><option value=1>Se in CCM, riattiva Intel&reg; AMT</option></select>')+"</div>",0==(1024&features)&&(t+=addHtmlFormFloating("Configurazione CIRA",'<select id=dp20amtcira class="form-select" title="Accesso remoto avviato dal client"><option value=0>Fare niente</option><option value=1>Non connettersi al server</option><option value=2>Connettiti al server</option></select>')),t+='<span id=dp10passNotify style="font-size:10px"> * 8-16 caratteri, 1 maiuscolo, 1 minuscolo, 1 numerico, 1 non alfanumerico.</span>',2==currentMesh.mtype&&2==e&&(t+='<span style="font-size:10px"> Questa pilitica non influirà sui dispositivi con Intel&reg; AMT in modalità ACM.</span>')),0==e&&(t='<div class="row"><div class="col-2"><i class="fa-solid fa-times-circle text-danger" style="padding-right:8px; font-size:60px;"></i></div><div class="col-10">Quando questa politica è selezionata, Intel&reg; AMT non è gestito da questo server. Intel AMT può ancora essere utilizzato attivandolo e configurandolo manualmente. </div></div>'),1==e&&(t='<div class="row"><div class="col-2"><i class="fa-solid fa-times-circle text-danger" style="font-size:60px; padding-right:8px; color:green;"></i></div><div class="col-10">Quando viene selezionato questo criterio, qualsiasi Intel&reg; L\'AMT in modalità di controllo del cliente (CCM) verrà disattivato. Altri dispositivi avranno l\'autorizzazione CIRA e potranno ancora essere gestiti manualmente. </div></div>'),4==e&&(t='<div class="row"><div class="col-2"><i class="fa-solid fa-check-circle text-success" style="font-size:60px; padding-right:8px; color:blue;"></i></div><div class="col-10">Questa è la politica consigliata. Intel&reg; L\'attivazione e la gestione di AMT sono completamente automatizzate e il server tenterà di utilizzare al meglio la gestione dell\'hardware.</div></div>'),QH("dp20amtpolicydiv",t),setTimeout(dp20amtValidatePolicy,500)}function dp20amtValidatePolicy(){var e,t=!0,i=Q("dp20amtpolicy").value;2!=i&&3!=i||2!=Q("dp20amtpass").value||(t=(e=Q("dp20amtpolicypass").value)===Q("dp20amtpolicypass2").value&&passwordcheck(e)),QE("idx_dlgOkButton",t),2!=i&&3!=i||QV("dp20amtpassdiv",2==Q("dp20amtpass").value),QV("dp10passNotify",(2==i||3==i)&&2==Q("dp20amtpass").value),QV("dp20amtbadpassdiv",2==i||3==i&&1!=Q("dp20amtccmmode").value)}function p20editMeshAmtEx(){var e=parseInt(Q("dp20amtpolicy").value),t={type:e},i=null;2!=e&&3!=e||(0==Q("dp20amtpass").value&&(i=""),1==Q("dp20amtpass").value&&(i=null),2==Q("dp20amtpass").value&&(i=Q("dp20amtpolicypass").value)),2==e?(t={type:e,password:i,badpass:parseInt(Q("dp20amtbadpass").value)}).cirasetup=0==(1024&features)?parseInt(Q("dp20amtcira").value):1:3==e?(t={type:e,password:i,badpass:parseInt(Q("dp20amtbadpass").value),ccm:parseInt(Q("dp20amtccmmode").value)}).cirasetup=0==(1024&features)?parseInt(Q("dp20amtcira").value):1:4==e&&(t={type:e}),meshserver.send({action:"meshamtpolicy",meshid:currentMesh._id,amtpolicy:t})}function p20showDeleteMeshDialog(){var e;return xxdialogMode||(e=format("Sei sicuro di voler eliminare il gruppo {0}? L'eliminazione del gruppo di dispositivi eliminerà anche tutte le informazioni sui dispositivi all'interno di questo gruppo.",EscapeHtml(currentMesh.name))+"<br /><br />",setModalContent("xxAddAgent","Elimina Gruppo",e+='<label class=form-check-label><input id=p20check type=checkbox class="form-check-input m-2" onchange=p20validateDeleteMeshDialog() />Confermare</label>'),showModal("xxAddAgentModal","idx_dlgOkButton",function(){p20showDeleteMeshDialogEx(3,"")}),p20validateDeleteMeshDialog()),!1}function p20validateDeleteMeshDialog(){QE("idx_dlgOkButton",Q("p20check").checked)}function p20showDeleteMeshDialogEx(e,t){meshserver.send({action:"deletemesh",meshid:currentMesh._id,meshname:currentMesh.name})}function p20editmeshrelay(){if(!xxdialogMode){var e=[];if(0==(2&features))for(var t in nodes){var i=nodes[t];2==i.mtype&&null!=i.agent&&4294967295==GetNodeRights(i)&&e.push(i)}if(e.sort(nameSort),0==e.length)setModalContent("xxAddAgent","Modifica gruppo di dispositivi",n="Nessun dispositivo relè disponibile."),showModal("xxAddAgentModal","idx_dlgOkButton");else{var o=[];for(t in e)o.push('<option value="'+e[t]._id+'"'+(currentMesh.relayid==e[t]._id?" selected":"")+">"+EscapeHtml(e[t].name)+"</option>");var n=addHtmlFormFloating("Dispositivo ripetitore",'<select id=d2devrelay class="form-select">'+o.join("")+"</select>");setModalContent("xxAddAgent","Modifica gruppo di dispositivi",n),showModal("xxAddAgentModal","idx_dlgOkButton",p20editmeshrelayEx)}}}function p20editmeshrelayEx(){meshserver.send({action:"editmesh",meshid:currentMesh._id,relayid:Q("d2devrelay").value})}function p20editmesh(e){xxdialogMode||(setModalContent("xxAddAgent","Modifica gruppo di dispositivi",'<div class="form-floating mb-2"><input type=text class="form-control" id=dp20meshname maxlength=128 placeholder="Nome" onchange=p20editmeshValidate() onkeyup=p20editmeshValidate(event) /><label for=dp20meshname>Nome</label></div><div class="form-floating mb-2"><textarea id=dp20meshdesc class="form-control" maxlength=1024 placeholder="Descrizione"></textarea><label for=dp20meshdesc>Descrizione</label></div>'),showModal("xxAddAgentModal","idx_dlgOkButton",p20editmeshEx),Q("dp20meshname").value=currentMesh.name,currentMesh.desc&&(Q("dp20meshdesc").value=currentMesh.desc),p20editmeshValidate(),(2==e?Q("dp20meshdesc"):Q("dp20meshname")).focus())}function p20editmeshEx(){meshserver.send({action:"editmesh",meshid:currentMesh._id,meshname:Q("dp20meshname").value,desc:Q("dp20meshdesc").value})}function p20editmeshValidate(e){QE("idx_dlgOkButton",0<Q("dp20meshname").value.length),e&&"Enter"==e.key&&Q("dp20meshdesc").focus()}function p20editmeshconsent(e){var t,i,o;xxdialogMode||(i=0,o=t="",1==e&&(i=currentMesh.consent||0,o="Modifica consenso utente del gruppo di dispositivi"),2==e&&(i=currentUser.consent||0,o="Modifica consenso utente"),3==e&&(i=currentNode.consent||0,o="Modifica consenso utente dispositivo"),4==e&&(i=currentUserGroup.consent||0,o="Modifica consenso utente del gruppo di utenti"),setModalContent("xxAddAgent",o,t=(t=(t=(t=(t=t+'<div style="width:100%;border-bottom:1px solid gray;margin-bottom:5px"><b>Desktop</b></div>'+('<div><label for=d20flag1><input type=checkbox id=d20flag1 class="form-check-input me-2" '+(1&i?"checked":"")+">Notifica all'utente </label></div>"))+('<div><label for=d20flag2><input type=checkbox id=d20flag2 class="form-check-input me-2" '+(8&i?"checked":"")+">Richiedi il consenso dell'utente</label></div>")+('<div><label for=d20flag7><input type=checkbox id=d20flag7 class="form-check-input me-2" '+(64&i?"checked":"")+">Mostra la barra degli strumenti di connessione</label></div>"))+'<div style="width:100%;border-bottom:1px solid gray;margin-bottom:5px;margin-top:8px"><b>Terminale</b></div>'+('<div><label for=d20flag3><input type=checkbox id=d20flag3 class="form-check-input me-2" '+(2&i?"checked":"")+">Notifica all'utente </label></div>"))+('<div><label for=d20flag4><input type=checkbox id=d20flag4 class="form-check-input me-2" '+(16&i?"checked":"")+">Richiedi il consenso dell'utente</label></div>")+'<div style="width:100%;border-bottom:1px solid gray;margin-bottom:5px;margin-top:8px"><b>File</b></div>')+('<div><label for=d20flag5><input type=checkbox id=d20flag5 class="form-check-input me-2" '+(4&i?"checked":"")+">Notifica all'utente </label></div>")+('<div><label for=d20flag6><input type=checkbox id=d20flag6 class="form-check-input me-2" '+(32&i?"checked":"")+">Richiedi il consenso dell'utente</label></div>")),xxdialogButtons=3,xxdialogTag=e,showModal("xxAddAgentModal","idx_dlgOkButton",function(){p20editmeshconsentEx(xxdialogButtons,xxdialogTag)}),serverinfo.consent&&(1&serverinfo.consent&&(Q("d20flag1").checked=!0),8&serverinfo.consent&&(Q("d20flag2").checked=!0),2&serverinfo.consent&&(Q("d20flag3").checked=!0),16&serverinfo.consent&&(Q("d20flag4").checked=!0),4&serverinfo.consent&&(Q("d20flag5").checked=!0),32&serverinfo.consent&&(Q("d20flag6").checked=!0),64&serverinfo.consent&&(Q("d20flag7").checked=!0),QE("d20flag1",!(1&serverinfo.consent)),QE("d20flag2",!(8&serverinfo.consent)),QE("d20flag3",!(2&serverinfo.consent)),QE("d20flag4",!(16&serverinfo.consent)),QE("d20flag5",!(4&serverinfo.consent)),QE("d20flag6",!(32&serverinfo.consent)),QE("d20flag7",!(64&serverinfo.consent))))}function p20editmeshconsentEx(e,t){var i=0;Q("d20flag1").checked&&(i+=1),Q("d20flag2").checked&&(i+=8),Q("d20flag3").checked&&(i+=2),Q("d20flag4").checked&&(i+=16),Q("d20flag5").checked&&(i+=4),Q("d20flag6").checked&&(i+=32),Q("d20flag7").checked&&(i+=64),1==t&&meshserver.send({action:"editmesh",meshid:currentMesh._id,consent:i}),2==t&&meshserver.send({action:"edituser",id:currentUser._id,consent:i}),3==t&&meshserver.send({action:"changedevice",nodeid:currentNode._id,consent:i}),4==t&&meshserver.send({action:"editusergroup",ugrpid:currentUserGroup._id,consent:i})}function p20editmeshfeatures(){var e,t,i;xxdialogMode||(e=currentMesh.flags||0,t="",i=0,"number"==typeof currentMesh.expireDevs&&0<currentMesh.expireDevs&&2e3<(i=currentMesh.expireDevs)&&(i=2e3),1==serverinfo.devGroupSessionRecording&&4!=currentMesh.mtype&&(t+='<div class="form-check"><label><input type=checkbox id=d20flag4 class="form-check-input me-2" onchange=p20editmeshfeaturesValidate() '+(4&e?"checked":"")+">Registra sessioni</label><br></div>"),t=(t=2!=currentMesh.mtype&&4!=currentMesh.mtype?t:t+('<div class="form-check"><label><input type=checkbox id=d20flag2 class="form-check-input me-2" onchange=p20editmeshfeaturesValidate() '+(2&e?"checked":"")+">"+(4==currentMesh.mtype?"Sincronizza il nome del dispositivo del server con il nome della porta":"Sincronizza il nome del dispositivo del server con il nome host"))+'</label><br></div><div class="form-check"><label><input type=checkbox id=d20flag1 class="form-check-input me-2" onchange=p20editmeshfeaturesValidate() '+(1&e?"checked":"")+">Rimuovere il dispositivo alla disconnessione</label><br></div>")+'<div class="form-check"><label><input type=checkbox id=d20expireDevice class="form-check-input me-2" onchange=p20editmeshfeaturesValidate() '+(0<i?"checked":"")+'>Rimuovi automaticamente i dispositivi inattivi</label><br></div><div style=margin-left:20px id=d20expireDeviceDev>Disattiva giorni fino alla rimozione <label><input type=number inputmode=numeric class="form-control" onchange=p20editmeshfeaturesValidate() onkeyup=p20editmeshfeaturesValidate() onpaste=p20editmeshfeaturesValidate() onkeydown=p20editmeshfeaturesValidate() maxlength=4 min=1 max=2000 style=width:80px value="'+(0==i?30:i)+'" id=d20expireDeviceDays></label><br></div>',serverinfo.autoremoveinactivedevices&&(1==serverinfo.autoremoveinactivedevices?t+=format("<span style=font-size:x-small;margin-left:6px>Per impostazione predefinita, i dispositivi inattivi verranno rimossi dopo 1 giorno.</span>",serverinfo.autoremoveinactivedevices):t+=format("<span style=font-size:x-small;margin-left:6px>Per impostazione predefinita, i dispositivi inattivi verranno rimossi dopo {0} giorni.</span>",serverinfo.autoremoveinactivedevices)),setModalContent("xxAddAgent","Modifica le funzionalità del gruppo di dispositivi",t),showModal("xxAddAgentModal","idx_dlgOkButton",p20editmeshfeaturesEx),p20editmeshfeaturesValidate())}function p20editmeshfeaturesValidate(){var e=0,t=!0,e=(2!=currentMesh.mtype&&4!=currentMesh.mtype||!Q("d20flag1").checked||(e+=1),QE("d20expireDevice",0==(1&e)),0==(1&e)&&Q("d20expireDevice").checked);QV("d20expireDeviceDev",e),e&&(e=parseInt(Q("d20expireDeviceDays").value),isNaN(e)||e<1||2e3<e||e!=Q("d20expireDeviceDays").value)&&(t=!1),QE("idx_dlgOkButton",t)}function p20editmeshfeaturesEx(){var e=0,t=(2!=currentMesh.mtype&&4!=currentMesh.mtype||(Q("d20flag1").checked&&(e+=1),Q("d20flag2").checked&&(e+=2)),1==serverinfo.devGroupSessionRecording&&4!=currentMesh.mtype&&Q("d20flag4").checked&&(e+=4),0);0==(1&e)&&Q("d20expireDevice").checked&&(t=parseInt(Q("d20expireDeviceDays").value)),meshserver.send({action:"editmesh",meshid:currentMesh._id,flags:e,expireDevs:t})}function p20showAddMeshUserDialog(e,t){if(!xxdialogMode){var i="";if(null==e||5==e)null==t&&(i+=null==e?"Consenti agli utenti di gestire questo gruppo di dispositivi e i dispositivi in ​​questo gruppo.":"Consenti agli utenti di gestire questo dispositivo.",524288&features&&(i+=" Gli utenti devono accedere a questo server una volta prima di poter essere aggiunti a un gruppo di dispositivi."),i+="<br /><br />"),i=(i+="<div style='position:relative'>")+addHtmlFormFloating("Identificatori utente ",'<input id=dp20username maxlength=256 onchange=p20validateAddMeshUserDialog() onkeyup=p20validateAddMeshUserDialog() placeholder="user1, user2, user3" class="form-control" />')+"<div id=dp20usersuggest class=suggestionBox style='top:30px;left:130px;display:none'></div></div><br>";else if(1==e){var o="";if(null==t)for(l in a=getOrderedList(meshes,"name"))null!=currentUser.links&&null!=currentUser.links[a[l]._id]||(o+="<option value="+encodeURIComponentEx(a[l]._id)+">"+EscapeHtml(a[l].name)+"</option>");else o+="<option value="+t+">"+EscapeHtml(meshes[decodeURIComponent(t)].name)+"</option>";i+=addHtmlFormFloating("Gruppo di dispositivi","<select onchange=p20validateAddMeshUserDialog() id=dp2groupid class=form-select"+(t?" disabled":"")+">"+o+"</select>")}else if(2==e){if(null==usergroups)return;o="";for(l in n=getOrderedList(usergroups,"name"))currentMesh._id.split("/")[1]!=n[l]._id.split("/")[1]||null!=currentMesh.links&&null!=currentMesh.links[n[l]._id]||(o+="<option value="+encodeURIComponentEx(n[l]._id)+">"+EscapeHtml(n[l].name)+"</option>");i+=addHtmlFormFloating("Gruppo di utenti ",'<select onchange=p20validateAddMeshUserDialog() id=dp2groupid class="form-select">'+o+"</select>")}else if(6==e){if(null==usergroups)return;var n,o="";if(null==t)for(l in n=getOrderedList(usergroups,"name"))null!=n[l].membershipType||currentNode._id.split("/")[1]!=n[l]._id.split("/")[1]||null!=currentNode.links&&null!=currentNode.links[n[l]._id]||(o+="<option value="+encodeURIComponentEx(n[l]._id)+">"+EscapeHtml(n[l].name)+"</option>");else o+="<option value="+t+">"+EscapeHtml(usergroups[decodeURIComponent(t)].name)+"</option>";i+=addHtmlFormFloating("Gruppo di utenti ","<select onchange=p20validateAddMeshUserDialog() id=dp2groupid "+(t?" disabled":"")+' class="form-select">'+o+"</select>")}else if(3==e){o="";for(l in t=t&&decodeURIComponent(t),a=getOrderedList(meshes,"name"))null==t&&null!=currentUserGroup.links&&null!=currentUserGroup.links[a[l]._id]||(o+="<option value="+encodeURIComponentEx(a[l]._id)+(t==a[l]._id?" selected":" ")+">"+EscapeHtml(a[l].name)+"</option>");i+=addHtmlFormFloating("Gruppo di dispositivi","<select onchange=p20validateAddMeshUserDialog("+e+') id=dp2groupid class="form-select">'+o+"</select>")}else if(4==e||7==e){var a,o="",s=null,r=null;for(l in null!=t&&null!=(r=getNodeFromId(decodeURIComponent(t)))&&(s=r.meshid),a=getOrderedList(meshes,"name"))null!=a[l].links[userinfo._id]&&7&a[l].links[userinfo._id].rights&&(null==s&&(s=a[l]._id),o+="<option value="+encodeURIComponentEx(a[l]._id)+(s==a[l]._id?" selected":" ")+">"+EscapeHtml(a[l].name)+"</option>");i+=addHtmlFormFloating("Gruppo di dispositivi","<select onchange=p20changeMeshAddMeshUserDialog("+e+') id=dp2meshid class="form-select">'+o+"</select>"),o="";var l,d=getOrderedList(nodes,"name");for(l in d)d[l].meshid==s&&(o+="<option value="+encodeURIComponentEx(d[l]._id)+(r==d[l]?" selected":" ")+">"+EscapeHtml(d[l].name)+"</option>");i+=addHtmlFormFloating("Dispositivo","<select onchange=p20validateAddMeshUserDialog("+e+') id=dp2nodeid class="form-select">'+o+"</select>")}else{var c=(e=decodeURIComponent(e)).split("/")[2];users&&users[e]&&(c=users[e].name),usergroups&&usergroups[e]&&(c=usergroups[e].name),userinfo._id==e&&(c=userinfo.name),e.startsWith("ugrp/")?i+=format("Autorizzazioni di gruppo per {0}.",c)+"<br /><br />":i+=format("Autorizzazioni di gruppo per l'utente {0}.",c)+"<br /><br />"}var c=-1,u=4!=e&&5!=e&&6!=e&&7!=e;i+='<div style="height:120px;overflow-y:scroll;border:1px solid var(--sub-menu-color);resize:vertical;padding:8px;border-radius:0.375rem;">',u&&(i+='<label><input type=checkbox class="form-check-input me-2" onchange=p20validateAddMeshUserDialog() id=p20fulladmin>Amministratore completo</label><br><label><input type=checkbox class="form-check-input me-2" onchange=p20validateAddMeshUserDialog() id=p20editmesh>Modifica gruppo di dispositivi</label><br><label><input type=checkbox class="form-check-input me-2" onchange=p20validateAddMeshUserDialog() id=p20manageusers>Gestisci utenti del gruppo di dispositivi</label><br><label><input type=checkbox class="form-check-input me-2" onchange=p20validateAddMeshUserDialog() id=p20managecomputers>Gestisci computer del gruppo di dispositivi</label><br>'),i=(i+='<label><input type=checkbox class="form-check-input me-2" onchange=p20validateAddMeshUserDialog() id=p20remotecontrol>Remote Control & Relay</label><br>')+'<label><input type=checkbox class="form-check-input me-2" onchange=p20validateAddMeshUserDialog() id=p20remoteview style=margin-left:12px>Solo visualizzazione remota</label><br>'+'<label><input type=checkbox class="form-check-input me-2" onchange=p20validateAddMeshUserDialog() id=p20remotelimitedinput style=margin-left:12px>Solo input limitato</label><br>',!1!==serverinfo.guestdevicesharing&&(i+='<label><input type=checkbox class="form-check-input me-2" onchange=p20validateAddMeshUserDialog() id=p20guestshare style=margin-left:12px>Condivisione degli ospiti</label><br>'),i=(i=(i=(i=(i=(i=(i=(i=i+'<label><input type=checkbox class="form-check-input me-2" onchange=p20validateAddMeshUserDialog() id=p20nodesktop style=margin-left:12px>Nessun accesso al desktop</label><br>'+'<label><input type=checkbox class="form-check-input me-2" onchange=p20validateAddMeshUserDialog() id=p20noterminal style=margin-left:12px>Nessun accesso al terminale </label><br>')+'<label><input type=checkbox class="form-check-input me-2" onchange=p20validateAddMeshUserDialog() id=p20nofiles style=margin-left:12px>Nessun accesso ai file </label><br>'+'<label><input type=checkbox class="form-check-input me-2" onchange=p20validateAddMeshUserDialog() id=p20noamt style=margin-left:12px>Nessun Intel&reg; AMT </label><br>')+'<label><input type=checkbox class="form-check-input me-2" onchange=p20validateAddMeshUserDialog() id=p20meshagentconsole>Console dell\'agente mesh</label><br>'+'<label><input type=checkbox class="form-check-input me-2" onchange=p20validateAddMeshUserDialog() id=p20meshserverfiles>File del server</label><br>')+'<label><input type=checkbox class="form-check-input me-2" onchange=p20validateAddMeshUserDialog() id=p20wakedevices>Riattiva i dispositivi</label><br>'+'<label><input type=checkbox class="form-check-input me-2" onchange=p20validateAddMeshUserDialog() id=p20editnotes>Modifica note dispositivo</label><br>')+'<label><input type=checkbox class="form-check-input me-2" onchange=p20validateAddMeshUserDialog() id=p20limitevents>Mostra solo i propri eventi</label><br>'+'<label><input type=checkbox class="form-check-input me-2" onchange=p20validateAddMeshUserDialog() id=p20chatnotify>Chat e notifica</label><br>')+'<label><input type=checkbox class="form-check-input me-2" onchange=p20validateAddMeshUserDialog() id=p20uninstall>Disinstalla agente / Elimina dispositivo</label><br>'+'<label><input type=checkbox class="form-check-input me-2" onchange=p20validateAddMeshUserDialog() id=p20commands>Comandi remoti</label><br>')+'<label><input type=checkbox class="form-check-input me-2" onchange=p20validateAddMeshUserDialog() id=p20resetoff>Ripristino / Spegnimento</label><br>'+'<label><input type=checkbox class="form-check-input me-2" onchange=p20validateAddMeshUserDialog() id=p20details>Dettagli del dispositivo</label><br>')+'<label><input type=checkbox class="form-check-input me-2" onchange=p20validateAddMeshUserDialog() id=p20relay>Use as Relay</label><br>'+"</div>",null==e?(xxdialogButtons=3,xxdialogTag="",setModalContent("xxAddAgent","Aggiungi utenti al gruppo di dispositivi",i),showModal("xxAddAgentModal","idx_dlgOkButton",function(){p20showAddMeshUserDialogEx(xxdialogButtons,xxdialogTag)}),QE("p20fulladmin",4294967295==GetMeshRights(currentMesh)),Q("dp20username").focus()):1===e?(xxdialogButtons=t?7:3,xxdialogTag=e,setModalContent("xxAddAgent",null==t?"Aggiungi autorizzazioni gruppo di dispositivi":"Modifica autorizzazioni gruppo di dispositivi",i),showModal("xxAddAgentModal","idx_dlgOkButton",function(){p20showAddMeshUserDialogEx(xxdialogButtons,xxdialogTag)}),4294967295==(c=null!=t?meshes[decodeURIComponent(t)].links[currentUser._id].rights:c)&&(Q("p20fulladmin").checked=!0,c=-1)):2===e?(xxdialogButtons=3,xxdialogTag=e,setModalContent("xxAddAgent","Aggiungi gruppo utenti",i),showModal("xxAddAgentModal","idx_dlgOkButton",function(){p20showAddMeshUserDialogEx(xxdialogButtons,xxdialogTag)}),QE("p20fulladmin",4294967295==GetMeshRights(currentMesh))):3===e?(xxdialogButtons=t?7:3,xxdialogTag=e,setModalContent("xxAddAgent",null==t?"Aggiungi gruppo di dispositivi":"Modifica gruppo di dispositivi",i),showModal("xxAddAgentModal","idx_dlgOkButton",function(){p20showAddMeshUserDialogEx(xxdialogButtons,xxdialogTag)}),QE("dp2groupid",null==t),4294967295==(c=null!=t?currentUserGroup.links[decodeURIComponent(t)].rights:c)&&(Q("p20fulladmin").checked=!0,c=-1)):4===e?(xxdialogButtons=t?7:3,xxdialogTag=e,setModalContent("xxAddAgent",null==t?"Aggiungi autorizzazioni dispositivo":"Modifica autorizzazioni dispositivo",i),showModal("xxAddAgentModal","idx_dlgOkButton",function(){p20showAddMeshUserDialogEx(xxdialogButtons,xxdialogTag)}),QE("dp2meshid",null==t),QE("dp2nodeid",null==t)):7===e?(xxdialogButtons=t?7:3,xxdialogTag=e,setModalContent("xxAddAgent",null==t?"Aggiungi autorizzazioni dispositivo":"Modifica autorizzazioni dispositivo",i),showModal("xxAddAgentModal","idx_dlgOkButton",function(){p20showAddMeshUserDialogEx(xxdialogButtons,xxdialogTag)}),QE("dp2meshid",null==t),QE("dp2nodeid",null==t),null!=t&&(c=currentUserGroup.links[decodeURIComponent(t)].rights,QE("dp20username",!1))):5===e?(xxdialogButtons=t?7:3,xxdialogTag=e,setModalContent("xxAddAgent",t?"Modifica autorizzazioni dispositivo utente":"Aggiungi autorizzazioni dispositivo utente",i),showModal("xxAddAgentModal","idx_dlgOkButton",function(){p20showAddMeshUserDialogEx(xxdialogButtons,xxdialogTag)}),null!=t&&(t=decodeURIComponent(t),null!=users&&null!=users[t]?Q("dp20username").value=users[t].name:Q("dp20username").value=t.split("/")[2],c=currentNode.links[t].rights,QE("dp20username",!1)),Q("dp20username").focus()):6===e?(xxdialogButtons=t?7:3,xxdialogTag=e,setModalContent("xxAddAgent",t?"Modifica autorizzazioni dispositivo gruppo utenti":"Aggiungi autorizzazioni dispositivo gruppo utenti",i),showModal("xxAddAgentModal","idx_dlgOkButton",function(){p20showAddMeshUserDialogEx(xxdialogButtons,xxdialogTag)}),null!=t&&(c=currentNode.links[decodeURIComponent(t)].rights)):(e.startsWith("ugrp/")?(xxdialogButtons=7,xxdialogTag=e,setModalContent("xxAddAgent","Modifica autorizzazioni gruppo di dispositivi",i)):(xxdialogButtons=7,xxdialogTag=e,setModalContent("xxAddAgent","Modifica autorizzazioni gruppo di dispositivi utente",i)),showModal("xxAddAgentModal","idx_dlgOkButton",function(){p20showAddMeshUserDialogEx(xxdialogButtons,xxdialogTag)}),GetMeshRights(currentMesh),4294967295==(c=GetMeshRights(currentMesh,e))&&(Q("p20fulladmin").checked=!0,c=-1),QE("p20fulladmin",4294967295==GetMeshRights(currentMesh))),-1!=c&&(u&&(1&c&&(Q("p20editmesh").checked=!0),2&c&&(Q("p20manageusers").checked=!0),4&c)&&(Q("p20managecomputers").checked=!0),8&c&&(Q("p20remotecontrol").checked=!0,65536&c&&(Q("p20nodesktop").checked=!0),256&c&&(Q("p20remoteview").checked=!0),524288&c&&!1!==serverinfo.guestdevicesharing&&(Q("p20guestshare").checked=!0),512&c&&(Q("p20noterminal").checked=!0),1024&c&&(Q("p20nofiles").checked=!0),2048&c&&(Q("p20noamt").checked=!0),4096&c)&&(Q("p20remotelimitedinput").checked=!0),16&c&&(Q("p20meshagentconsole").checked=!0),32&c&&(Q("p20meshserverfiles").checked=!0),64&c&&(Q("p20wakedevices").checked=!0),128&c&&(Q("p20editnotes").checked=!0),8192&c&&(Q("p20limitevents").checked=!0),16384&c&&(Q("p20chatnotify").checked=!0),32768&c&&(Q("p20uninstall").checked=!0),131072&c&&(Q("p20commands").checked=!0),262144&c&&(Q("p20resetoff").checked=!0),524288&c&&!1!==serverinfo.guestdevicesharing&&(Q("p20guestshare").checked=!0),1048576&c&&(Q("p20details").checked=!0),2097152&c)&&(Q("p20relay").checked=!0),p20validateAddMeshUserDialog(e)}return!1}function p20changeMeshAddMeshUserDialog(e){var t,i="",o=decodeURIComponent(Q("dp2meshid").value);for(t in nodes)nodes[t].meshid==o&&(i+="<option value="+encodeURIComponentEx(nodes[t]._id)+">"+EscapeHtml(nodes[t].name)+"</option>");QH("dp2nodeid",i),p20validateAddMeshUserDialog(e)}function p20setname(e){e=decodeURIComponent(e);var t,i=Q("dp20username").value.split(",");for(t in i)i[t]=i[t].trim();return i[i.length-1]=e,Q("dp20username").value=i.join(", "),p20validateAddMeshUserDialog(),!1}function p20validateAddMeshUserDialog(e){var t,i,o=!0;if(4===e&&(e=0,""!=(t=decodeURIComponent(Q("dp2nodeid").value))&&null!=currentUser.links&&null!=currentUser.links[t]&&(e=currentUser.links[t].rights),Q("p20remotecontrol").checked=0!=(8&e),Q("p20meshagentconsole").checked=0!=(16&e),Q("p20meshserverfiles").checked=0!=(32&e),Q("p20wakedevices").checked=0!=(64&e),Q("p20editnotes").checked=0!=(128&e),Q("p20remoteview").checked=0!=(256&e),Q("p20noterminal").checked=0!=(512&e),Q("p20nofiles").checked=0!=(1024&e),Q("p20noamt").checked=0!=(2048&e),Q("p20remotelimitedinput").checked=0!=(4096&e),Q("p20limitevents").checked=0!=(8192&e),Q("p20chatnotify").checked=0!=(16384&e),Q("p20uninstall").checked=0!=(32768&e),Q("p20nodesktop").checked=0!=(65536&e),Q("p20commands").checked=0!=(131072&e),Q("p20resetoff").checked=0!=(262144&e),!1!==serverinfo.guestdevicesharing&&(Q("p20guestshare").checked=0!=(524288&e)),Q("p20details").checked=0!=(1048576&e),Q("p20relay").checked=0!=(2097152&e),o=""!=t),Q("dp20username")){var n=Q("dp20username").value.split(",");for(c in n){var a=n[c]=n[c].trim();(0==a.length||0<=a.indexOf('"'))&&(o=!1)}var e=!1,s=!1;if(null!=users){var r=n[n.length-1].trim(),l=r.toLowerCase(),d=[];if(0<r.length){for(var c in users){var u=users[c]._id.split("/");if((null==currentMesh||currentMesh.domain==u[1])&&(null==currentNode||currentNode.domain==u[1])){if(u[2]===l){s=!0;break}if(0<=users[c].name.toLowerCase().indexOf(l)&&(d.push([users[c]._id,users[c].name]),8<=d.length))break}}if(0==s&&0<d.length){var p="";for(c in d){var m=d[c][0],g=d[c][1];m.split("/")[2]==g.toLowerCase()?p+="<div class=suggestionBoxItem onclick='p20setname(\""+encodeURIComponentEx(m.split("/")[2])+"\")'>"+EscapeHtml(g)+"</div>":p+="<div class=suggestionBoxItem onclick='p20setname(\""+encodeURIComponentEx(m.split("/")[2])+"\")'><div>"+EscapeHtml(g)+"</div><div class=suggestionBoxSubItem>"+EscapeHtml(m.split("/")[2])+"</div></div>"}QH("dp20usersuggest",p),e=!0}}}QV("dp20usersuggest",e)}QE("idx_dlgOkButton",o),null!=Q("p20fulladmin")?(i=!Q("p20fulladmin").checked,QE("p20editmesh",i),QE("p20manageusers",i),QE("p20managecomputers",i)):i=""!=t,QE("p20remotecontrol",i),QE("p20meshagentconsole",i),QE("p20meshserverfiles",i),QE("p20wakedevices",i),QE("p20editnotes",i),QE("p20limitevents",i),QE("p20remoteview",i&&Q("p20remotecontrol").checked),!1!==serverinfo.guestdevicesharing&&QE("p20guestshare",i&&Q("p20remotecontrol").checked&&(Q("p20remoteview").checked||!Q("p20remotelimitedinput").checked)),QE("p20remotelimitedinput",i&&Q("p20remotecontrol").checked&&!Q("p20remoteview").checked),QE("p20nodesktop",i&&Q("p20remotecontrol").checked),QE("p20noterminal",i&&Q("p20remotecontrol").checked),QE("p20nofiles",i&&Q("p20remotecontrol").checked),QE("p20noamt",i&&Q("p20remotecontrol").checked),QE("p20chatnotify",i),QE("p20uninstall",i),QE("p20commands",i),QE("p20resetoff",i),QE("p20details",i),QE("p20relay",i)}function p20showAddMeshUserDialogEx(e,t){var i,o,n=0;if(null!=Q("p20fulladmin")&&1==Q("p20fulladmin").checked?n=4294967295:(null!=Q("p20fulladmin")&&(1==Q("p20editmesh").checked&&(n+=1),1==Q("p20manageusers").checked&&(n+=2),1==Q("p20managecomputers").checked)&&(n+=4),1==Q("p20remotecontrol").checked&&(n+=8),1==Q("p20meshagentconsole").checked&&(n+=16),1==Q("p20meshserverfiles").checked&&(n+=32),1==Q("p20wakedevices").checked&&(n+=64),1==Q("p20editnotes").checked&&(n+=128),1==Q("p20remoteview").checked&&(n+=256),1==Q("p20nodesktop").checked&&(n+=65536),1==Q("p20noterminal").checked&&(n+=512),1==Q("p20nofiles").checked&&(n+=1024),1==Q("p20noamt").checked&&(n+=2048),1!=Q("p20remotelimitedinput").checked||Q("p20remoteview").checked||(n+=4096),1==Q("p20limitevents").checked&&(n+=8192),1==Q("p20chatnotify").checked&&(n+=16384),1==Q("p20uninstall").checked&&(n+=32768),1==Q("p20commands").checked&&(n+=131072),1==Q("p20resetoff").checked&&(n+=262144),!1===serverinfo.guestdevicesharing||1!=Q("p20guestshare").checked||!Q("p20remoteview").checked&&(Q("p20remoteview").checked||Q("p20remotelimitedinput").checked)||(n+=524288),1==Q("p20details").checked&&(n+=1048576),1==Q("p20relay").checked&&(n+=2097152)),0==(8&n)&&(256&n&&(n-=256),512&n&&(n-=512),1024&n&&(n-=1024),2048&n&&(n-=2048),4096&n&&(n-=4096),65536&n)&&(n-=65536),1===t){var a=decodeURIComponent(Q("dp2groupid").value);null!=(r=meshes[a])&&meshserver.send({action:"addmeshuser",meshid:a,meshname:r.name,userids:[currentUser._id],meshadmin:n,remove:2==e})}else if(2===t){var s=decodeURIComponent(Q("dp2groupid").value);null!=(r=meshes[currentMesh._id])&&meshserver.send({action:"addmeshuser",meshid:currentMesh._id,meshname:currentMesh.name,userid:s,meshadmin:n,remove:2==e})}else if(3===t){var r,a=decodeURIComponent(Q("dp2groupid").value);null!=(r=meshes[a])&&meshserver.send({action:"addmeshuser",meshid:a,meshname:r.name,userids:[currentUserGroup._id],meshadmin:n,remove:2==e})}else if(4===t)null!=(o=getNodeFromId(i=decodeURIComponent(Q("dp2nodeid").value)))&&meshserver.send({action:"adddeviceuser",nodeid:i,nodename:o.name,userids:[currentUser._id],rights:n,remove:2==e});else if(5===t){var l=[];for(c in d=Q("dp20username").value.split(","))l.push(d[c].trim());meshserver.send({action:"adddeviceuser",nodeid:currentNode._id,nodename:currentNode.name,usernames:l,rights:n,remove:2==e})}else if(6===t){s=decodeURIComponent(Q("dp2groupid").value);null!=currentNode&&meshserver.send({action:"adddeviceuser",nodeid:currentNode._id,nodename:currentNode.name,userids:[s],rights:n,remove:2==e})}else if(7===t)null!=(o=getNodeFromId(i=decodeURIComponent(Q("dp2nodeid").value)))&&meshserver.send({action:"adddeviceuser",nodeid:i,nodename:o.name,userids:[currentUserGroup._id],rights:n,remove:2==e});else if(null==t){var d,c,l=[];for(c in d=Q("dp20username").value.split(","))l.push(d[c].trim());meshserver.send({action:"addmeshuser",meshid:currentMesh._id,meshname:currentMesh.name,usernames:l,meshadmin:n,remove:2==e})}else meshserver.send({action:"addmeshuser",meshid:currentMesh._id,meshname:currentMesh.name,userids:[t],meshadmin:n,remove:2==e})}function p20viewuser(e){var t,i,o,n,a,s;xxdialogMode||(t=decodeURIComponent(e),i=GetMeshRights(currentMesh),o=GetMeshRights(currentMesh,t),userinfo._id!=t&&(4294967295==i||0!=(2&i)&&4294967295!=o)?p20showAddMeshUserDialog(e):(e=[],4294967295==o?e.push("Amministratore completo (tutti i diritti)"):(0!=(1&o)&&e.push("Modifica gruppo di dispositivi"),0!=(2&o)&&e.push("Gestisci utenti del gruppo di dispositivi"),0!=(4&o)&&e.push("Gestisci computer del gruppo di dispositivi"),0!=(8&o)&&e.push("Controllo remoto"),0!=(16&o)&&e.push("Console Agente"),0!=(32&o)&&e.push("File del server"),0!=(64&o)&&e.push("Riattiva i dispositivi"),0!=(128&o)&&e.push("Modifica note"),0!=(8&o)&&0!=(256&o)&&e.push("Solo visualizzazione remota"),0!=(8&o)&&0!=(65536&o)&&e.push("Nessun desktop"),0!=(8&o)&&0!=(512&o)&&e.push("Nessun terminale "),0!=(8&o)&&0!=(1024&o)&&e.push("Nessun file"),0!=(8&o)&&0!=(2048&o)&&e.push("Nessun Intel&reg; AMT "),0!=(8&o)&&0!=(4096&o)&&0==(256&o)&&e.push("Input limitato"),0!=(8192&o)&&e.push("Solo eventi personali"),0!=(16384&o)&&e.push("Chat e notifica"),0!=(32768&o)&&e.push("Disinstalla"),0!=(131072&o)&&e.push("Comandi"),0!=(262144&o)&&e.push("Ripristina/Spento"),0!=(524288&o)&&e.push("Condivisione"),0!=(1048576&o)&&e.push("Dettagli"),0!=(2097152&o)&&e.push("Ritrasmissioni")),0==e.length&&e.push("Nessun diritto"),n=t.split("/")[2],users&&users[t]&&(n=users[t].name),userinfo._id==t&&(n=userinfo.name),a=1,s=addHtmlValue("Nome utente ",EscapeHtml(decodeURIComponent(n))),t.split("/")[2]!=n&&(s+=addHtmlValue("Identificatore utente ",EscapeHtml(t.split("/")[2]))),s+=addHtmlValue("permessi",e.join(", ")),userinfo._id!=t&&(4294967295==i||0!=(2&i)&&4294967295!=o)&&(a+=4),setModalContent("xxAddAgent","Utente del gruppo di dispositivi",s),showModal("xxAddAgentModal","idx_dlgOkButton",()=>p20viewuserEx(a,t))))}function p20viewuserEx(e,t){2==e&&(e=t.split("/")[2],users&&users[t]&&(e=users[t].name),usergroups&&usergroups[t]&&(e=usergroups[t].name),userinfo._id==t&&(e=userinfo.name),t.startsWith("user/")&&setModalContent("xxAddAgent","Rimuovere i permessi dell'utente",format('Confermare la rimozione dei diritti per l\'utente "{0}"?',EscapeHtml(decodeURIComponent(e)))),t.startsWith("ugrp/")&&setModalContent("xxAddAgent","Rimuovere i permessi del gruppo di utenti",format('Confermare la rimozione dei diritti per il gruppo utenti "{0}"?',EscapeHtml(decodeURIComponent(e))),t),showModal("xxAddAgentModal","idx_dlgOkButton",()=>p20viewuserEx2(3,t)))}function p20deleteUser(e,t){return haltEvent(e),p20viewuserEx(2,decodeURIComponent(t)),!1}function p20viewuserEx2(e,t){meshserver.send({action:"removemeshuser",meshid:currentMesh._id,meshname:currentMesh.name,userid:t})}function p20editmeshInviteCode(){if(xxdialogMode)return!1;var e,t=GetMeshRights(currentMesh),i=serverinfo.name;-1!=i.indexOf(".")&&0==(2&features)||(i=window.location.hostname),i=1==serverinfo.https?"https://"+i+(443==serverinfo.port?"":":"+serverinfo.port)+domainUrl+"invite"+(urlargs.key?"?key="+urlargs.key:""):"http://"+i+(80==serverinfo.port?"":":"+serverinfo.port)+domainUrl+"invite"+(urlargs.key?"?key="+urlargs.key:""),1&t?(setModalContent("xxAddAgent","Codici di invito",e=(e=(e=(e=(e="Se abilitati, i codici di invito possono essere utilizzati da chiunque per unire i dispositivi a questo gruppo di dispositivi utilizzando il seguente collegamento pubblico: <br /><br />")+('<div style=width:100%;text-align:center><a rel="noreferrer noopener" target=_blank href="'+i+'">'+i+"</a></div><br />")+'<div style=margin-bottom:5px><label><input id=agentJoinCheck type=checkbox class="form-check-input me-2" onclick=p20editmeshInviteCodeValidate() />Abilita codici di invito</label></div>')+addHtmlFormFloating("Codici di invito",'<input id=agentInviteCode class="form-control" onkeyup=p20editmeshInviteCodeValidate() placeholder="code1, code2, code3" />'))+addHtmlFormFloating("Agenti",'<select id=agentType class="form-select" onchange=p20editmeshInviteCodeValidate()><option value=0>Tutti gli agenti disponibili</option><option value=1>Windows Mesh Agent</option><option value=2>Linux Mesh Agent</option><option value=4>Agente Mesh MacOS</option><option value=8>Assistente MeshCentral</option></select>')+"<div id=d2agentInstallTypeDiv>")+addHtmlFormFloating("Tipo di installazione",'<select id=agentInviteType class="form-select"><option value=0>Servizio e interattivo</option><option value=2>Solo Servizio</option><option value=1>Solo interattivo</option></select>')+"</div>"),showModal("xxAddAgentModal","idx_dlgOkButton",p20editmeshInviteCodeEx),null!=currentMesh.invite&&(Q("agentJoinCheck").checked=!0,Q("agentInviteCode").value=currentMesh.invite.codes.join(", "),currentMesh.invite.ag&&(Q("agentType").value=currentMesh.invite.ag),Q("agentInviteType").value=3&currentMesh.invite.flags),p20editmeshInviteCodeValidate()):(e="I codici di invito possono essere utilizzati da chiunque per unire i dispositivi a questo gruppo di dispositivi utilizzando il seguente collegamento pubblico:<br /><br />",setModalContent("xxAddAgent","Codici di invito",e=(e=(e+='<div style=width:100%;text-align:center><a rel="noreferrer noopener" target=_blank href="'+i+'">'+i+"</a></div><br />")+addHtmlValue("Codici di invito",currentMesh.invite.codes.join(", ")))+addHtmlValue("Tipo di installazione",["Servizio e interattivo","Solo interattivo","Solo Servizio"][3&currentMesh.invite.flags])),showModal("xxAddAgentModal","idx_dlgOkButton"))}function p20editmeshInviteCodeValidate(){var e,t=!0,i=Q("agentInviteCode").value.split(",");for(e in i)i[e]=i[e].trim(),""==i[e]&&(t=!1);QE("agentInviteCode",Q("agentJoinCheck").checked),QE("agentType",Q("agentJoinCheck").checked),QE("agentInviteType",Q("agentJoinCheck").checked),QE("idx_dlgOkButton",0==Q("agentJoinCheck").checked||t),QV("d2agentInstallTypeDiv",parseInt(Q("agentType").value)<2)}function p20editmeshInviteCodeEx(){if(1==Q("agentJoinCheck").checked){var e,t=Q("agentInviteCode").value.split(",");for(e in t)t[e]=t[e].trim();meshserver.send({action:"editmesh",meshid:currentMesh._id,invite:{codes:t,flags:parseInt(Q("agentInviteType").value),ag:parseInt(Q("agentType").value)}})}else meshserver.send({action:"editmesh",meshid:currentMesh._id,invite:"*"})}function p20editMeshNotify(){var e,t,i;return xxdialogMode||(e=0,t=16384&features2&&userinfo.emailVerified,userinfo.links&&userinfo.links[currentMesh._id]&&userinfo.links[currentMesh._id].notify&&(e|=userinfo.links[currentMesh._id].notify),userinfo.notify&&userinfo.notify[currentMesh._id]&&(e|=userinfo.notify[currentMesh._id]),i='<div style="border-bottom: 1px solid #888;margin-bottom:3px">Notifiche della pagina web</div><div class="form-check"><label><input id=p20notifyIntelDeviceConnect class="form-check-input me-2" type=checkbox />Connessioni del dispositivo</label></div><div class="form-check"><label><input id=p20notifyIntelDeviceDisconnect class="form-check-input me-2" type=checkbox />Disconnessioni del dispositivo</label></div>',currentMesh.mtype<3&&(i+='<div class="form-check"><label><input id=p20notifyIntelAmtKvmActions class="form-check-input me-2" type=checkbox />Intel&reg; Desktop AMT e eventi seriali</label></div>'),t&&(i+='<br /><div style="border-bottom: 1px solid #888;margin-bottom:3px">notifiche di posta elettronica</div><div class="form-check"><label><input id=p20enotifyIntelDeviceConnect class="form-check-input me-2" type=checkbox />Connessioni del dispositivo</label></div><div class="form-check"><label><input id=p20enotifyIntelDeviceDisconnect class="form-check-input me-2" type=checkbox />Disconnessioni del dispositivo</label></div><div class="form-check"><label><input id=p20enotifyIntelDeviceHelp class="form-check-input me-2" type=checkbox />Help requests</label></div>'),null!=userinfo.msghandle&&0!=(33554432&features2)&&(i+='<br /><div style="border-bottom: 1px solid #888;margin-bottom:3px">Messaging Notifications</div><div class="form-check"><label><input id=p20emsgDeviceConnect class="form-check-input me-2" type=checkbox />Connessioni del dispositivo</label></div><div class="form-check"><label><input id=p20emsgDeviceDisconnect class="form-check-input me-2" type=checkbox />Disconnessioni del dispositivo</label></div><div class="form-check"><label><input id=p20emsgDeviceHelp class="form-check-input me-2" type=checkbox />Help requests</label></div>'),setModalContent("xxAddAgent","Impostazioni di notifica",i),showModal("xxAddAgentModal","idx_dlgOkButton",p20editMeshNotifyEx),Q("p20notifyIntelDeviceConnect").checked=2&e,Q("p20notifyIntelDeviceDisconnect").checked=4&e,currentMesh.mtype<3&&(Q("p20notifyIntelAmtKvmActions").checked=8&e),t&&(Q("p20enotifyIntelDeviceConnect").checked=16&e,Q("p20enotifyIntelDeviceDisconnect").checked=32&e,Q("p20enotifyIntelDeviceHelp").checked=64&e),null!=userinfo.msghandle&&0!=(33554432&features2)&&(Q("p20emsgDeviceConnect").checked=128&e,Q("p20emsgDeviceDisconnect").checked=256&e,Q("p20emsgDeviceHelp").checked=512&e)),!1}function p20editMeshNotifyEx(e,t){var i=0,i=(i+=Q("p20notifyIntelDeviceConnect").checked?2:0)+(Q("p20notifyIntelDeviceDisconnect").checked?4:0);currentMesh.mtype<3&&(i+=Q("p20notifyIntelAmtKvmActions").checked?8:0),t&&(i=(i=(i+=Q("p20enotifyIntelDeviceConnect").checked?16:0)+(Q("p20enotifyIntelDeviceDisconnect").checked?32:0))+(Q("p20enotifyIntelDeviceHelp").checked?64:0)),null!=userinfo.msghandle&&0!=(33554432&features2)&&(i=(i=(i+=Q("p20emsgDeviceConnect").checked?128:0)+(Q("p20emsgDeviceDisconnect").checked?256:0))+(Q("p20emsgDeviceHelp").checked?512:0)),meshserver.send({action:"changemeshnotify",meshid:currentMesh._id,notify:i})}function setupMeshSummaryStats(){window.meshPowerChart=new Chart(document.getElementById("meshPowerChart").getContext("2d"),{type:"doughnut",data:{datasets:[{data:[0,0],backgroundColor:["#20F","#40D","#60B","#809","#A07","#C05"]}]},options:{shadowColor:"blue",responsive:!0,plugins:{legend:{display:!1}},animation:{animateScale:!0,animateRotate:!0},layout:{padding:{left:10,right:10,top:10,bottom:10}}}}),window.meshOsChart=new Chart(document.getElementById("meshOsChart").getContext("2d"),{type:"doughnut",data:{datasets:[{data:[0,0],backgroundColor:["#20F","#30E","#40D","#50C","#60B","#70A","#809","#908","#A07","#B06","#C05"]}]},options:{responsive:!0,plugins:{legend:{display:!1}},animation:{animateScale:!0,animateRotate:!0},layout:{padding:{left:10,right:10,top:10,bottom:10}}}}),window.meshConnChart=new Chart(document.getElementById("meshConnChart").getContext("2d"),{type:"doughnut",data:{datasets:[{data:[0,0],backgroundColor:["#20F","#40D","#60B","#809","#A07","#C05"]}],labels:["Non connesso","Agente","Intel&reg; AMT","Agent + Intel&reg; AMT"]},options:{responsive:!0,plugins:{legend:{display:!1}},animation:{animateScale:!0,animateRotate:!0},layout:{padding:{left:10,right:10,top:10,bottom:10}}}}),window.meshSecurityChart=new Chart(document.getElementById("meshSecurityChart").getContext("2d"),{type:"doughnut",data:{datasets:[{data:[0,0],backgroundColor:["#20F","#40D","#60B","#809","#A07","#C05"]}],labels:["OK","Antivirus non attivo","Nessun aggiornamento automatico","Firewall non attivo","Problemi multipli"]},options:{responsive:!0,plugins:{legend:{display:!1}},animation:{animateScale:!0,animateRotate:!0},layout:{padding:{left:10,right:10,top:10,bottom:10}}}})}function p21updateMesh(){if(null!=currentMesh){var e,t=GetMeshRights(currentMesh),i=EscapeHtml(currentMesh.name),o=(0==i.length&&(i="<i>Nessuna </i>"),0!=(1&t)&&(i='<span tabindex=0 title="Fare clic qui per modificare il nome del gruppo di dispositivi" onclick=p20editmesh(1) onkeyup="if (event.key == \'Enter\') p20editmesh(1)" role=button>'+i+' <i class="fa-solid fa-pencil fa-2xs"></i></span>'),QH("p21meshName",i),{}),n={},a=[0,0,0,0],s=[0,0,0,0,0],r=!1,l=!1,d=!1,c=!1;for(y in nodes)nodes[y].meshid==currentMesh._id&&(nodes[y].agent&&(r=!0,null==o[nodes[y].agent.id]?o[nodes[y].agent.id]=1:o[nodes[y].agent.id]++),nodes[y].pwr&&(l=!0,null==n[nodes[y].pwr]?n[nodes[y].pwr]=1:n[nodes[y].pwr]++),0==nodes[y].conn?(d=!0,a[0]++):0!=(6&nodes[y].conn)?(d=!0,0!=(1&nodes[y].conn)?a[3]++:a[2]++):0!=(1&nodes[y].conn)&&(d=!0,a[1]++),nodes[y].wsc)&&(c=!0,e=0,"OK"==nodes[y].wsc.antiVirus&&e++,"OK"==nodes[y].wsc.autoUpdate&&e++,"OK"==nodes[y].wsc.firewall&&e++,3==e?s[0]++:e<2?s[4]++:"OK"!=nodes[y].wsc.antiVirus?s[1]++:"OK"!=nodes[y].wsc.autoUpdate?s[2]++:"OK"!=nodes[y].wsc.firewall&&s[3]++);var u=[],p=[],m=[],g=[],v=3==currentMesh.mtype?agentsStrNoAgent:agentsStr;for(y in o)u.push(o[y]),p.push(v[y]);for(y in n)m.push(n[y]),g.push(powerStatetable[y]);window.meshPowerChart.config.data.datasets[0].data=m,window.meshPowerChart.config.data.labels=g,window.meshPowerChart.update(),2<=currentMesh.mtype&&(window.meshOsChart.config.data.datasets[0].data=u,window.meshOsChart.config.data.labels=p,window.meshOsChart.update()),window.meshConnChart.config.data.datasets[0].data=a,window.meshConnChart.update(),window.meshSecurityChart.config.data.datasets[0].data=s,window.meshSecurityChart.update();var h="",f=0;if(0<m.length){var x=[];for(y in n)x.push([powerStatetable[y],n[y]]);for(y in x.sort(function(e,t){return-(e[1]-t[1])}),h+='<table class="table table-hover table-striped" border=0 cellpadding=2 cellspacing=0 width=100%><tbody><tr style=background-color:#AAAAAA;font-weight:bold><th scope=col colspan=2 style=text-align:left;width:430px>Stati di alimentazione</th></tr>',x)h+="<tr style="+(++f%2==0?"background-color:#DDD":"")+"><td style=text-align:right;width:60px>"+x[y][1]+" <td> "+x[y][0]+"</tr>";h+="</tbody></table>"}if(0<u.length&&2<=currentMesh.mtype){var f=0,k=[];for(y in o)k.push([v[y],o[y]]);for(y in k.sort(function(e,t){return-(e[1]-t[1])}),h+='<table class="table table-hover table-striped" border=0 cellpadding=2 cellspacing=0 width=100%><tbody><tr style=background-color:#AAAAAA;font-weight:bold><th scope=col colspan=2 style=text-align:left;width:430px>Tipi di agente</th></tr>',k)h+="<tr style="+(++f%2==0?"background-color:#DDD":"")+"><td style=text-align:right;width:60px>"+k[y][1]+"<td> "+k[y][0]+"</tr>";h+="</tbody></table>"}if(d){for(var b=[],y=f=0;y<4;y++)b.push([["Non connesso","Agente","Intel&reg; AMT","Agent + Intel&reg; AMT"][y],a[y]]);b.sort(function(e,t){return-(e[1]-t[1])}),h+='<table class="table table-hover table-striped" border=0 cellpadding=2 cellspacing=0 width=100%><tbody><tr style=background-color:#AAAAAA;font-weight:bold><th scope=col colspan=2 style=text-align:left;width:430px>Connettività</th></tr>';for(y=0;y<4;y++)0<b[y][1]&&(h+="<tr style="+(++f%2==0?"background-color:#DDD":"")+"><td style=text-align:right;width:60px>"+b[y][1]+"<td> "+b[y][0]+"</tr>");h+="</tbody></table>"}if(c){for(var w=[],y=f=0;y<4;y++)w.push([['<img src="images/link2.png" style=cursor:pointer onclick=\'return p21setDevicesFilter("wsc:ok")\' width=10 height=10 /> OK','<img src="images/link2.png" style=cursor:pointer onclick=\'return p21setDevicesFilter("wsc:noav")\' width=10 height=10 /> Antivirus non attivo','<img src="images/link2.png" style=cursor:pointer onclick=\'return p21setDevicesFilter("wsc:noupdate")\' width=10 height=10 /> Nessun aggiornamento automatico','<img src="images/link2.png" style=cursor:pointer onclick=\'return p21setDevicesFilter("wsc:nofirewall")\' width=10 height=10 /> Firewall non attivo','<img src="images/link2.png" style=cursor:pointer onclick=\'return p21setDevicesFilter("wsc:any")\' width=10 height=10 /> Problemi multipli'][y],s[y]]);w.sort(function(e,t){return-(e[1]-t[1])}),h+='<table class="table table-hover table-striped" border=0 cellpadding=2 cellspacing=0 width=100%><tbody><tr style=background-color:#AAAAAA;font-weight:bold><th scope=col colspan=2 style=text-align:left;width:430px>Sicurezza</th></tr>';for(y=0;y<4;y++)0<w[y][1]&&(h+="<tr style="+(++f%2==0?"background-color:#DDD":"")+"><td style=text-align:right;width:60px>"+w[y][1]+"<td> "+w[y][0]+"</tr>");h+="</tbody></table>"}""==h&&(h="<i>Nessun dispositivo in questo gruppo di dispositivi. </i>"),QH("p21info",h);t=(l?1:0)+(2<=currentMesh.mtype&&r?1:0)+(d?1:0)+(c?1:0);QS("meshPowerChartDiv").display=l?"inline-block":"none",QS("meshOsChartDiv").display=2<=currentMesh.mtype&&r?"inline-block":"none",QS("meshConnChartDiv").display=d?"inline-block":"none",QS("meshSecurityChartDiv").display=c?"inline-block":"none",QS("meshPowerChartDiv").width=3<t?"23%":"31%",QS("meshOsChartDiv").width=3<t?"23%":"31%",QS("meshConnChartDiv").width=3<t?"23%":"31%",QS("meshSecurityChartDiv").width=3<t?"23%":"31%"}}function p21setDevicesFilter(e){go(1),Q("KvmSearchInput").value=Q("SearchInput").value=e,mainUpdate(5)}var sortorder,filetreelocation=[];function updateFiles(){if(QV("MainMenuMyFiles",0==(8&features)),0==(8&features)){for(var e,t,i="",o="",n='<a href=# style=cursor:pointer onclick="return p5folderup(0)">Root</a>',a="Root",s=filetree,r=1,l=[],d=filetreelinkpath,c=[],u=document.getElementsByName("fc"),p=0;p<u.length;p++)u[p].checked&&c.push(u[p].value);for(p in filetreelinkpath="",filetreelocation){if(null==s.f||null==s.f[filetreelocation[p]])break;l.push(filetreelocation[p]),a+=" / "+filetreelocation[p],1==r?(e=filetreelocation[p].split("/"),t=window.location.origin+domainUrl+e[0]+"files/"+e[2],filetreelinkpath+=filetreelocation[p]):""!=filetreelinkpath&&(filetreelinkpath+="/"+filetreelocation[p],2<r)&&(t+="/"+filetreelocation[p]),s=s.f[filetreelocation[p]],n+=' / <a href=# style=cursor:pointer onclick="return p5folderup('+r+')">'+EscapeHtml(null!=s.n?s.n:filetreelocation[p])+"</a>",r++}filetreelocation=l;var m=a.toLowerCase().startsWith("root / "+userinfo._id+" / public"),g=p5sort_files(s.f);for(p in g){var v,h,f=g[p],x=f.n,k=70<x.length?'<span title="'+EscapeHtml(x)+'">'+EscapeHtml(x.substring(0,70))+"...</span>":EscapeHtml(x),b="",y=(null!=f.d&&(b=printDateTime(new Date(f.d))+"&nbsp;"),""),w=(null!=f.s&&(y=getFileSizeStr(f.s)),"");w=f.t<3||4==f.t?(v=1==f.t||4==f.t?p5getQuotabar(f):"",'<div class=filelist file=999><input file=999 style=float:left name=fc class="fcb form-check-input me-2" type=checkbox onchange=p5setActions() value="'+EscapeHtml(x)+'">&nbsp;<span style=float:right title="">'+v+"</span><span><div class=fileIcon"+f.t+' onclick=p5folderset("'+encodeURIComponentEx(f.nx)+'")></div><a href=# style=cursor:pointer onclick=\'return p5folderset("'+encodeURIComponentEx(f.nx)+"\")'>"+k+"</a></span></div>"):(x=k,v="",h=urlargs.key?"&key="+urlargs.key:"",m&&(v='<i class="fa-regular fa-copy" style=cursor:pointer title="Visualizza link pubblico" onclick=\'return p5showPublicLink("'+t+"/"+encodeURIComponentEx(f.nx)+"?download=1"+h+'")\'></i> <i class="fa-regular fa-copy" title="Copia il link negli appunti" style="cursor:pointer" onclick=copyTextToClip2("'+encodeURIComponentEx(t+"/"+encodeURIComponentEx(f.nx)+"?download=1"+h)+'")></i>'),0<f.s&&(x=v+'<a onclick=downloadFile("downloadfile.ashx?link='+encodeURIComponentEx(filetreelinkpath+"/"+f.nx)+'")>'+k+"</a>"),'<div class=filelist file=3><input file=3 style=float:left name=fc class="fcb form-check-input me-2" type=checkbox onchange=p5setActions() value="'+f.nx+'">&nbsp;<span class=fsize>'+b+"</span><span style=float:right>"+y+"</span><span><div class=fileIcon"+f.t+"></div>"+x+"</span></div>"),f.t<3?i+=w:o+=w}if(QH("p5rightOfButtons",p5getQuotabar(s)),QH("p5files",i+o),QH("p5currentpath",n),QE("p5FolderUp",0!=filetreelocation.length),QV("p5PublicShare",m),d==filetreelinkpath)for(u=document.getElementsByName("fc"),p=0;p<u.length;p++)u[p].checked=0<=c.indexOf(u[p].value);p5setActions()}}function getNiceSize(e){return e<=0?"Limite di archiviazione superato":e<2048?format("{0} byte rimanenti",e):e<2097152?format("{0} kilobyte rimanenti",Math.round(e/1024)):e<2147483648?format("{0} megabyte rimanenti",Math.round(e/1024/1024)):format("{0} gigabyte rimanenti",Math.round(e/1024/1024/1024))}function getNiceSize2(e){return e<=0?"Nessuna ":e<2048?format("{0} b",e):e<2097152?format("{0} Kb",Math.round(e/1024)):e<2147483648?format("{0} Mb",Math.round(e/1024/1024)):format("{0} Gb",Math.round(e/1024/1024/1024))}function getNiceSize3(e){return e<=0?"Nessuna ":e<2048?format("{0} b",e):e<2097152?format("{0} Kb",round(e/1024,1)):e<2147483648?format("{0} Mb",round(e/1024/1024,1)):format("{0} Gb",round(e/1024/1024/1024,1))}function p5getQuotabar(e){for(;1<e.t&&4!=e.t;)e=e.parent;var t,i;return 1!=e.t&&4!=e.t||null==e.maxbytes?"":(t=Math.floor(e.s/1024),i=e.maxbytes-e.s,'<span title="'+(1<e.c?format("{0} k in {1} files. {2} k massimo",t,e.c,Math.floor(e.maxbytes/1024/1024)):format("{0} k in 1 file. {1} k massimo",t,Math.floor(e.maxbytes/1024/1024)))+'">'+getNiceSize(i)+" <progress style=height:10px;width:100px value="+e.s+" max="+e.maxbytes+" /></span>")}function p5showPublicLink(e){return setModalContent("xxAddAgent","Public Link",'<input type=text style=width:350px value="'+e+'" readonly /> <i class="fa-regular fa-copy" title="Copia il link negli appunti" style="cursor:pointer" onclick=copyTextToClip2("'+encodeURIComponentEx(e)+'")></i>'),showModal("xxAddAgentModal","idx_dlgOkButton"),!1}function p5sort_filename(e,t){return e.ln>t.ln?+sortorder:e.ln<t.ln?-1*sortorder:0}function p5sort_timestamp(e,t){return e.d>t.d?+sortorder:e.d<t.d?-1*sortorder:0}function p5sort_bysize(e,t){return e.s==t.s?p5sort_filename(e,t):(e.s-t.s)*sortorder}function p5sort_files(e){var t,i=[],o=Q("p5sortdropdown").value;for(t in e)e[t].nx=t,null==e[t].n&&(e[t].n=t),e[t].ln=e[t].n.toLowerCase(),i.push(e[t]);return sortorder=1,3<o&&(sortorder=-1,o-=3),1==o?i.sort(p5sort_filename):2==o?i.sort(p5sort_bysize):3==o&&i.sort(p5sort_timestamp),i}function p5setActions(){var e=getFileSelCount(),t=getFileCount(),i=getFileSelCount(!1);QE("p5DeleteFileButton",0<e&&0<filetreelocation.length),QE("p5ViewFileButton",1==e&&1==i&&0<filetreelocation.length),QE("p5NewFolderButton",0<filetreelocation.length),QE("p5UploadButton",0<filetreelocation.length),QE("p5DownloadButton",0<e&&e==i&&0<filetreelocation.length),QE("p5RenameFileButton",1==e&&0<filetreelocation.length),QE("p5SelectAllButton",0<t),Q("p5SelectAllButton").value=0<e?"Non selezionare niente":"Seleziona tutto",QE("p5CutButton",0<i&&e==i),QE("p5CopyButton",0<i&&e==i),QE("p5PasteButton",null!=p5clipboard&&0<p5clipboard.length&&0<filetreelocation.length)}function getFileSelCount(e){for(var t=0,i=document.getElementsByName("fc"),o=0;o<i.length;o++)!i[o].checked||0==e&&"3"!=i[o].attributes.file.value||t++;return t}function getFileSelDirCount(){for(var e=0,t=document.getElementsByName("fc"),i=0;i<t.length;i++)t[i].checked&&"999"==t[i].attributes.file.value&&e++;return e}function getFileCount(){return document.getElementsByName("fc").length}function p5selectallfile(){for(var e=0==getFileSelCount(),t=document.getElementsByName("fc"),i=0;i<t.length;i++)t[i].checked=e;p5setActions()}function setupBackPointers(e){if(null!=e.f){var t,i=0,o=0;for(t in e.f)setupBackPointers(e.f[t]),(e.f[t].parent=e).f[t].s&&(i+=e.f[t].s),e.f[t].c&&(o+=e.f[t].c),3==e.f[t].t&&o++;e.s=i,e.c=o}return e}function getFileSizeStr(e){return 1==(e="number"!=typeof e?0:e)?"1 byte":format("{0} byte",e)}function p5folderup(e){if(null==e)filetreelocation.pop();else for(;filetreelocation.length>e;)filetreelocation.pop();return updateFiles(),!1}function p5folderset(e){return filetreelocation.push(decodeURIComponent(e)),updateFiles(),!1}function p5createfolder(){setModalContent("xxAddAgent","Nuova cartella",'<input type=text id=p5renameinput class="form-control" maxlength=64 onkeyup=p5fileNameCheck(event) />'),showModal("xxAddAgentModal","idx_dlgOkButton",p5createfolderEx),focusTextBox("p5renameinput"),p5fileNameCheck()}function p5createfolderEx(){meshserver.send({action:"fileoperation",fileop:"createfolder",path:filetreelocation,newfolder:Q("p5renameinput").value})}function p5deletefile(){var e=getFileSelCount(),t=0<getFileSelDirCount()?'<br /><br /><label><input type=checkbox class="form-check-input me-2" id=p5recdeleteinput>Eliminazione ricorsiva</label><br>':"<input type=checkbox id=p5recdeleteinput class=\"form-check-input me-2\" style='display:none'>";setModalContent("xxAddAgent","Elimina",1<e?format("Eliminare {0} elementi selezionati?",e)+t:"Eliminare l'elemento selezionato?"+t),showModal("xxAddAgentModal","idx_dlgOkButton",p5deletefileEx)}function p5deletefileEx(){for(var e=[],t=document.getElementsByName("fc"),i=0;i<t.length;i++)t[i].checked&&e.push(t[i].value);meshserver.send({action:"fileoperation",fileop:"delete",path:filetreelocation,delfiles:e,rec:Q("p5recdeleteinput").checked})}function p5renamefile(){for(var e,t=document.getElementsByName("fc"),i=0;i<t.length;i++)t[i].checked&&(e=t[i].value);setModalContent("xxAddAgent","Rinominare",'<input type=text id=p5renameinput class="form-control" maxlength=64 onkeyup=p5fileNameCheck(event) value="'+e+'" />'),showModal("xxAddAgentModal","idx_dlgOkButton",p5renamefileEx),focusTextBox("p5renameinput"),p5fileNameCheck()}function p5renamefileEx(e,t){t.newname=Q("p5renameinput").value,meshserver.send(t)}function p5fileNameCheck(e){var t=isFilenameValid(Q("p5renameinput").value);QE("idx_dlgOkButton",t),1==t&&e&&13==e.keyCode&&dialogclose(1)}var isFilenameValid=(()=>{var t=/^[^\\/:\*\?"<>\|]+$/,i=/^\./,o=/^(nul|prn|con|lpt[0-9]|com[0-9])(\.|$)/i;return function(e){return t.test(e)&&!i.test(e)&&!o.test(e)&&"."!=e[0]}})();function p5uploadFile(){setModalContent("xxAddAgent","Caricare un file",'<form method=post enctype=multipart/form-data action=uploadfile.ashx target=fileUploadFrame><input type=text name=link style=display:none id=p5uploadpath value="'+encodeURIComponentEx(filetreelinkpath)+'" /><input type=file name=files id=p5uploadinput class="form-control" multiple=multiple onchange="p5updateUploadDialogOk(\'p5uploadinput\')" /><input type=hidden name=authCookie value='+authCookie+' /><input type=submit id=p5loginSubmit class="btn btn-outline-success mt-2" style="display:none" /><span id=p5confirmOverwriteSpan style=display:none><br/><label><input type=checkbox class="form-check-input me-2" id=p5confirmOverwrite onchange="p5updateUploadDialogOk(\'p5uploadinput\')" />Confermare la sovrascrittura?</label></span></ >'),showModal("xxAddAgentModal","idx_dlgOkButton",p5uploadFileEx),p5updateUploadDialogOk("p5uploadinput")}function p5uploadFileEx(){Q("p5loginSubmit").click()}function p5GetFileInfo(e){var t,i=filetree;for(t in filetreelocation)null!=i.f&&null!=i.f[filetreelocation[t]]&&(i=i.f[filetreelocation[t]]);return i.f[e]}function p5updateUploadDialogOk(){var e=Q("p5uploadinput").files,t=[];for(a in e)null!=e[a].size&&0!=e[a].size&&t.push(e[a]);var i=filetree,o=[],n=0;for(a in filetreelocation)null!=i.f&&null!=i.f[filetreelocation[a]]&&(i=i.f[filetreelocation[a]]);if(QE("idx_dlgOkButton",0<e.length),0<e.length){if(null!=i.f){for(var a in i.f)o.push(a);for(a=0;a<e.length;a++)0<=o.indexOf(e[a].name)&&n++}QV("p5confirmOverwriteSpan",0<n),0<n?QE("idx_dlgOkButton",Q("p5confirmOverwrite").checked):(Q("p5confirmOverwrite").checked=!1,QE("idx_dlgOkButton",!0))}}function p5viewfile(){for(var e,t=document.getElementsByName("fc"),i=0;i<t.length;i++)if(t[i].checked)return null==(e=p5GetFileInfo(t[i].value))?void 0:void(e.s<=204800?meshserver.send({action:"fileoperation",fileop:"get",path:filetreelocation,file:t[i].value,tag:"edit"}):messagebox("Editor di file","È possibile modificare solo i file inferiori a 200k."))}var p5clipboard=null,p5clipboardFolder=null,p5clipboardCut=0;function p5copyFile(e){var t=document.getElementsByName("fc");p5clipboard=[],p5clipboardCut=e,p5clipboardFolder=Clone(filetreelocation);for(var i=0;i<t.length;i++)t[i].checked&&"3"==t[i].attributes.file.value&&p5clipboard.push(t[i].value);p5updateClipview()}function p5pasteFile(){var e="";setModalContent("xxAddAgent","Incolla",e=null!=p5clipboard&&0<p5clipboard.length?format("Confermare {0} di {1} voce {2} in questa posizione?",0==p5clipboardCut?"copy":"move",p5clipboard.length,1<p5clipboard.length?"s":""):e),showModal("xxAddAgentModal","idx_dlgOkButton",p5pasteFileEx)}function p5pasteFileEx(){meshserver.send({action:"fileoperation",fileop:0==p5clipboardCut?"copy":"move",scpath:p5clipboardFolder,path:filetreelocation,names:p5clipboard}),p5folderup(999),1==p5clipboardCut&&(p5clipboardFolder=p5clipboard=null,p5clipboardCut=0,p5updateClipview())}function p5updateClipview(){var e="";null!=p5clipboard&&0<p5clipboard.length&&(e=format("Trattenendo {0} entrie {1} per {2}",p5clipboard.length,1<p5clipboard.length?"s":"",0==p5clipboardCut?"copia":"sposta")+', <a href=# onclick="return p5clearClip()" style=cursor:pointer>Pulire</a>.'),QH("p5bottomstatus",e),p5setActions()}function p5clearClip(){return p5clipboardFolder=p5clipboard=null,p5clipboardCut=0,p5updateClipview(),!1}function p5fileDragDrop(e){if(!xxdialogMode&&(haltEvent(e),QV("bigfail",!1),QV("bigok",!1),null!=e.dataTransfer)){var t=[];for(a in e.dataTransfer.files)null!=e.dataTransfer.files[a].size&&0!=e.dataTransfer.files[a].size&&t.push(e.dataTransfer.files[a]);if(0!=t.length){var i=filetree,o=[],n=0;for(a in filetreelocation)null!=i.f&&null!=i.f[filetreelocation[a]]&&(i=i.f[filetreelocation[a]]);if(null!=i.f){for(var a in i.f)o.push(a);for(a=0;a<e.dataTransfer.files.length;a++)0<=o.indexOf(e.dataTransfer.files[a].name)&&n++}0==n?p5PerformUpload(1,e.dataTransfer.files):(setModalContent("xxAddAgent","Caricare un file",format(1==n?"Il caricamento sovrascriverà 1 file. Continua? ":"Il caricamento sovrascriverà {0} file. Continua? ",n)),showModal("xxAddAgentModal","idx_dlgOkButton",()=>p5PerformUpload(3,e.dataTransfer.files)))}}}function p5PerformUpload(e,t){var i=0;p5uploadFile();try{Q("p5uploadinput").files=t}catch(e){i=1}if(0==i&&p5uploadFileEx(),setDialogMode(0),1==i&&0!=filetreelocation.length){for(var o=[],n=[],a=[],s=[],r=t.length,l=0,d=0;d<t.length;d++)l+=t[d].size;if(13e5<l)p5uploadFile();else for(d=0;d<t.length;d++){var c=new FileReader,u=t[d];o.push(u.name),n.push(u.size),a.push(u.type),c.onload=function(e){s.push(e.target.result),0==--r&&(Q("p5fileDragName").value=o.join("*"),Q("p5fileDragSize").value=n.join("*"),Q("p5fileDragType").value=a.join("*"),Q("p5fileDragData").value=s.join("*"),Q("p5fileDragLink").value=encodeURIComponentEx(filetreelinkpath),Q("p5fileDragAuthCookie").value=authCookie,Q("p5loginSubmit2").click())},c.readAsDataURL(u)}}}var p5dragtimer=null;function p5fileDragOver(e){xxdialogMode||(haltEvent(e),null!=p5dragtimer&&(clearTimeout(p5dragtimer),p5dragtimer=null),e=!0,0==filetreelocation.length&&(e=!1),QV("bigok",e),QV("bigfail",!e))}function p5fileDragLeave(e){xxdialogMode||(haltEvent(e),"p5filetable"!=e.target.id?(QV("bigfail",!1),QV("bigok",!1)):p5dragtimer=setTimeout(function(){QV("bigfail",!1),QV("bigok",!1),p5dragtimer=null},10))}function p5downloadButton(){for(var e=document.getElementsByName("fc"),t=0;t<e.length;t++)e[t].checked&&downloadFile("downloadfile.ashx?link="+encodeURIComponentEx(filetreelinkpath+"/"+e[t].value))}var eventsMessageId={1:"connessione all'account.",2:"disconnessione  dall'account",3:"Lingua modificata da {1} a {2}",4:"Sessione multiplex desktop unita",5:"Ha lasciato la sessione multiplex desktop",6:"Sessione multiplex desktop avviata",7:"Sessione di registrazione terminata, {0} secondo / i",8:"Sessione multiplex desktop chiusa, {0} secondo / i",9:'Sessione di inoltro terminata "{0}" da {1} a {2}, {3} secondo / i',10:'Sessione terminale terminata "{0}" da {1} a {2}, {3} secondo / i',11:'Sessione desktop terminata "{0}" da {1} a {2}, {3} secondo / i',12:'Sessione di gestione file terminata "{0}" da {1} a {2}, {3} secondo / i',13:'Avviata sessione di inoltro "{0}" da {1} a {2}',14:'Avviata sessione terminale "{0}" da {1} a {2}',15:'Avviata sessione desktop "{0}" da {1} a {2}',16:'Sessione di gestione file avviata "{0}" da {1} a {2}',17:'Comando della console di elaborazione: "{0}"',18:'Visualizzazione della finestra del messaggio, titolo = "{0}", messaggio = "{1}"',19:"Processo di uccisione {0}",20:"Apertura: {0} ",21:"Getting clipboard content, {0} byte(s)",22:"Impostazione del contenuto degli appunti, {0} byte",23:"Tentativo di modalità di attivazione Intel (R) AMT ACM",24:"Comandi in esecuzione",25:"Esecuzione dell'azione di accensione={0}, forzata={1}",26:'Visualizzazione del messaggio di avviso popup, titolo = "{0}", messaggio = "{1}"',27:"L'utente locale ha accettato la richiesta del terminale remoto",28:"L'utente locale ha rifiutato la richiesta del terminale remoto",29:"Connessione desktop remoto chiusa forzatamente dall'utente locale",30:"Avvio del desktop remoto dopo l'accettazione dell'utente locale",31:"Barra di connessione desktop remoto attivata/aggiornata",32:"Barra di connessione desktop remoto non riuscita o non supportata",33:"Connessione desktop remoto chiusa forzatamente dall'utente locale",34:"Impossibile avviare il desktop remoto dopo che l'utente locale ha rifiutato",35:"Avviato desktop remoto con notifica di tipo toast",36:"Avviato desktop remoto senza notifica",37:"Barra di connessione desktop remoto attivata/aggiornata",38:"Barra di connessione desktop remoto non riuscita o non supportata",39:"Connessione desktop remoto chiusa forzatamente dall'utente locale",40:"Avvio di file remoti dopo che l'utente locale ha accettato",41:"Impossibile avviare i file remoti dopo che l'utente locale ha rifiutato",42:"File remoti avviati con notifica di tipo toast",43:"File remoti avviati senza notifica",44:'Crea cartella: "{0}"',45:'Elimina: "{0}"',46:'Elimina ricorsivo: "{0}", {1} elemento / i rimosso / i',47:'Elimina: "{0}", {1} elemento / i rimosso / i',48:'Rinomina: "{0}" in "{1}"',49:'Scarica: "{0}"',50:'Carica: "{0}" ',51:'Copia: "{0}" in "{1}"',52:'Sposta: "{0}" in "{1}" ',53:"Blocco dell'utente remoto dal desktop",54:"L'agente ha chiuso la sessione con {0}% di compressione dall'agente al server. Inviato: {1}, compresso: {2}",55:"Gruppo di dispositivi creato: {0}",56:"Gruppo di dispositivi ripristinato: {0}",57:"Dispositivo aggiunto {0} al gruppo di dispositivi {1}",58:"Il dispositivo ha richiesto l'attivazione di Intel (R) AMT ACM, FQDN: {0}",59:"Dispositivo modificato {0} dal gruppo {1}: {2}",60:"Diritti dispositivo utente rimossi per {0}",61:"Diritti del dispositivo dell'utente modificati per {0}",62:"Rimosso l'utente {0} dal gruppo di utenti {1}",63:"Account rimosso",64:"Account creato, il nome utente è {0}",65:"Account creato, l'email è {0}",66:"Account cambiato: {0}",67:"Appartenenza al gruppo di utenti modificata: {0} ",68:"Gruppo utenti aggiunto {0} al gruppo di dispositivi {1}",69:"Gruppo utenti creato: {0} ",70:"Rimosso il gruppo di utenti {0} dal gruppo di dispositivi {1}",71:"Utente {0} aggiunto al gruppo di utenti {1}",72:"Rimosso l'utente {0} dal gruppo di utenti {1}",73:"Notifica del gruppo di dispositivi modificata",74:"Password dell'account modificata: {0}",75:"Credenziali dell'account modificate",76:"Gruppo di dispositivi creato: {0}",77:"Gruppo di dispositivi eliminato: {0}",78:"Appartenenza al gruppo di dispositivi modificata: {0}",79:"Gruppo utenti modificato: {0} ",80:"Utente {0} aggiunto al gruppo di utenti {1}",81:"Diritti dispositivo utente rimossi per {0}",82:"Diritti del dispositivo dell'utente modificati per {0}",83:"Rimosso l'utente {0} dal gruppo di dispositivi {1}",84:"Dispositivo aggiunto {0} al gruppo di dispositivi {1}",85:"Dispositivo spostato {0} nel gruppo {1} ",86:"Diritti dispositivo utente rimossi per {0}",87:"Dispositivo rimosso {0} dal gruppo di dispositivi {1}",88:"Abilitata l'autenticazione a due fattori della posta elettronica",89:"Autenticazione a due fattori della posta elettronica disabilitata",90:"Aggiunta applicazione di autenticazione",91:"Applicazione di autenticazione rimossa",92:"Nuovi codici di backup 2FA generati ",93:"Codici di backup 2FA cancellati",94:"Chiave di sicurezza rimossa",95:"Aggiunta chiave di sicurezza",96:"Numero di telefono verificato dell'utente {0} ",97:"Rimosso il numero di telefono dell'utente {0}",98:"Richiesta di assistenza, utente: {0}, dettagli: {1}",99:"Esecuzione di comandi come utente",100:"Se possibile, eseguire comandi come utente",101:"Condivisione dispositivo aggiunta {0} da {1} a {2}",102:"Condivisione dispositivo rimossa {0}",103:"Caricamento in gruppo di {0} file nella cartella {1}",104:'Download automatico del file di dump del core dell\'agente: "{0}"',105:'Carica: "{0}", Dimensioni: {1}',106:'Scarica: "{0}", Dimensioni: {1}',107:"Accesso all'account da {0}, {1}, {2}",108:"Tentativo di accesso utente con 2° fattore errato da {0}, {1}, {2}",109:"Tentativo di accesso utente su account bloccato da {0}, {1}, {2}",110:"Tentativo di accesso utente non valido da {0}, {1}, {2}",111:"Il dispositivo ha richiesto l'attivazione di Intel(R) AMT ACM TLS, FQDN: {0}",112:'Terminata la sessione di messaggistica "{0}" da {1} a {2}, {3} secondo(i)',113:"Aggiunto dispositivo di autenticazione delle notifiche push",114:"Dispositivo di autenticazione delle notifiche push rimosso",115:"Aggiunto token di accesso",116:"Token di accesso rimosso",117:"Questa è una vecchia versione dell'agente, considera l'aggiornamento.",118:"Questo agente ha un meccanismo di convalida del certificato obsoleto, considerare l'aggiornamento.",119:"Questo agente utilizza tunnel non sicuri, considera l'aggiornamento.",120:'Avviata sessione di inoltro locale "{0}", protocollo da {1} a {2}',121:'Terminata la sessione di inoltro locale "{0}", protocollo da {1} a {2}, {3} secondo/i',122:"Ha lasciato la sessione multiplex desktop dopo {0} secondo/i.",123:'Ha lasciato la sessione Web-SSH "{1}" dopo {0} secondo/i.',124:'Ha lasciato la sessione Web-SFTP "{1}" dopo {0} secondo/i.',125:'Ha lasciato la sessione Web-RDP "{1}" dopo {0} secondo/i.',126:"Ha lasciato la sessione Web-VNC dopo {0} secondo/i.",127:"Nome visualizzato dell'account modificato in {0}.",128:"Account creato, il nome è {0}.",129:"Nome visualizzato dell'account rimosso.",130:"Notifiche utente cambiate",131:"Aggiunta condivisione dispositivo {0} con tempo illimitato.",132:"Accendere.",133:"Spegni.",134:"Sessione desktop dell'utente {0} disconnessa forzatamente",135:"Sessione terminale dell'utente {0} disconnessa forzatamente",136:"Sessione di file disconnessa forzatamente dell'utente {0}",137:"Sessione di routing disconnessa forzatamente dell'utente {0}",138:"Aggiunta condivisione dispositivo {0} ricorrente ogni giorno.",139:"Aggiunta la condivisione del dispositivo {0} ricorrente ogni settimana.",140:"Dispositivo modificato {0} dal gruppo {1}: {2}",141:"Modifica della politica Intel(r) AMT",142:"Il gruppo di dispositivi {0} è stato modificato: {1}",143:'Sessione multiplex desktop collegata "{0}"',144:'Ha lasciato la sessione multiplex desktop "{0}" dopo {1} secondo/i.',145:'Sessione multiplex desktop avviata "{0}"',146:'Sessione di registrazione terminata "{0}", {1} secondo/i',147:'Sessione multiplex desktop chiusa "{0}", {1} secondo/i',148:'Sessione Web-SSH avviata "{0}".',149:'Sessione Web-SFTP avviata "{0}".',150:'Sessione Web-RDP avviata "{0}".',151:'Sessione Web-VNC avviata "{0}".',152:'Non è più un relè per "{0}".',153:'È un relè per "{0}".',154:"Account changed to sync with LDAP data.",155:"Denied user login from {0}, {1}, {2}",156:"Verified messaging account of user {0}",157:"Removed messaging account of user {0}",158:'Displaying alert box, title="{0}", message="{1}"',159:"Device Powered On",160:"Enabled Duo two-factor authentication",161:"Disabled Duo two-factor authentication"},eventsShortMessageId={1:"Nome del gruppo",2:"Descrizione",3:"Bandiere",4:"Consenso",5:"Rimozione Automatica",6:"Codice di invito",7:"Dispositivo relè"};function eventMouseHover(e,t){e.children[1].classList.remove("g1s"),e.children[2].classList.remove("style10s"),1==t&&(e.children[1].classList.add("g1s"),e.children[2].classList.add("style10s"))}function eventsUpdate(){var e="",t=null;for(s in events){var i=events[s],o=new Date(i.time);if(i.msg){null==i.h&&(i.h=Math.random()),printDate(o)!=t&&(null!=t&&(e+="</table>"),e+='<table class="table table-hover p3eventsTable" cellpadding=0 cellspacing=0><tr><td colspan=4 class=DevSt>'+(t=printDate(o))+"</td></tr>");var n,a="fa-mobile-screen";if("ugrp"==i.etype&&(a="fa-users"),"user"==i.etype&&(a="fa-user"),"server"==i.etype&&(a="fa-server"),null==i.msgid||null==eventsMessageId[i.msgid])n="string"==typeof i.msg?EscapeHtml(i.msg).split("(R)").join("&reg;"):"";else{if(n=eventsMessageId[i.msgid],null!=i.msgArgs)for(var s in i.msgArgs){var r=i.msgArgs[s];if(Array.isArray(r)){var l,d=[];for(l in r)"number"==typeof r[l]&&eventsShortMessageId[r[l]]?d.push(eventsShortMessageId[r[l]]):d.push(r[l]);r=d.join(", ")}else"string"==typeof r&&0==r.indexOf("DATETIME:")&&(r=printFlexDateTime(new Date(parseInt(r.substring(9)))));n=n.split("{"+s+"}").join(r)}n=EscapeHtml(n).split("(R)").join("&reg;")}if(i.nodeid){var c=getNodeFromId(i.nodeid);if(null!=c){switch(c.icon){case 1:a="fa-computer";break;case 2:a="fa-laptop";break;case 8:a="fa-laptop-code"}n="<a href=# onclick='gotoDevice(\""+i.nodeid+"\",10);haltEvent(event);'>"+EscapeHtml(c.name)+"</a> &rarr; "+n}}i.username&&(c="",i.guestname&&(c=' / <span title="Questa è una sessione di condivisione degli ospiti">'+EscapeHtml(i.guestname)+"</span>"),n=2&userinfo.siteadmin&&i.userid?"<a href=# onclick='gotoUser(\""+encodeURIComponentEx(i.userid)+"\");haltEvent(event);'>"+EscapeHtml(i.username)+"</a>"+c+" &rarr; "+n:EscapeHtml(i.username)+c+" &rarr; "+n),i.remoteaddr&&(n+=" ("+i.remoteaddr+")"),"relay"!=i.etype&&"relaylog"!=i.action||(a="fa-arrow-right-arrow-left"),e+="<tr onclick=showEventDetails("+i.h+',2)  onmouseover=eventMouseHover(this,1) onmouseout=eventMouseHover(this,0) role=button><td style=width:18px><i class="fa-fw fa-solid '+a+'"></i></td><td class=g1>&nbsp;</td><td class=style10>'+printTime(o)+" - "+n+"</td></tr><tr></tr>"}}null!=t&&(e+="</table>"),""==e&&(e="<br><i>Nessun evento trovato </i><br><br>"),QH("p3events",e)}function refreshEvents(){""!=p3filterevents.value?meshserver.send({action:"events",limit:parseInt(p3limitdropdown.value),filter:p3filterevents.value}):meshserver.send({action:"events",limit:parseInt(p3limitdropdown.value)})}function p3showReportDialog(){var e;xxdialogMode||(e="<div style=float:right><img src='images/report60.png' height=74 width=60 style=padding-top:2px /></div><div>",setModalContent("xxAddAgent","Scarica rapporto",e=(e=(e=(e=(e+=addHtmlFormFloating("Tipo di rapporto",'<select id=d2reportType class="form-select" onchange=p3showReportValidation()><option value=1>Tutti gli eventi</option>'))+addHtmlFormFloating("TimIntervallo di tempoe Span",'<select id=d2reportSpan class="form-select" onchange=p3showReportValidation()><option value=1>Tutto disponibile</option><option value=2>Un giorno </option></select>'))+("<div id=d2daySelector>"+addHtmlFormFloating("Rapporto giornaliero",'<input type=date id=d2reportDay class="form-control" onchange=p3showReportValidation()></input>')+"</div>"))+addHtmlFormFloating("Raggruppa per",'<select id=d2reportGroupBy class="form-select" onchange=p3showReportValidation()><option value=1>Nessuna </option><option value=2>Gruppo di dispositivi</option><option value=3>Utente</option>'))+addHtmlFormFloating("Formato",'<select id=d2reportFormat class="form-select" onchange=p3showReportValidation()><option value=1>CSV</option><option value=2>JSON</option>')+"</div>"),showModal("xxAddAgentModal","idx_dlgOkButton"),p3showReportValidation(),Q("d2reportType").focus())}function p3showReportValidation(){Q("d2reportType").value;var e=Q("d2reportSpan").value,t=Q("d2reportDay").value,i=(Q("d2reportGroupBy").value,Q("d2reportFormat").value,QV("d2daySelector",2==e),!0);2==e&&""==t&&(i=!1),QE("idx_dlgOkButton",i)}function p3showDownloadEventsDialog(e){var t;xxdialogMode||(t="Scarica l'elenco degli eventi con uno dei formati di file di seguito.<br /><br />",setModalContent("xxAddAgent","Esportazione elenco eventi",t=(t+=addHtmlValue("Formato CSV",'<a href=# style=cursor:pointer onclick="return p3downloadEventsDialogCSV('+e+')">eventslist.csv</a>'))+addHtmlValue("Formato JSON",'<a href=# style=cursor:pointer onclick="return p3downloadEventsDialogJSON('+e+')">eventslist.json</a>')),showModal("xxAddAgentModal","idx_dlgOkButton"))}function p3downloadEventsDialogCSV(e){var t,i,o;for(o in 1==e&&(i=currentDeviceEvents),2==e&&(i=events),t="utc, time, type, action, user, device, message\r\n",i=3==e?currentUserEvents:i){var n,a="";i[o].nodeid&&(n=getNodeFromId(i[o].nodeid))&&n.name&&(a=n.name),t+='"'+i[o].time+'","'+printDateTime(new Date(i[o].time))+'","'+i[o].etype+'","'+(null!=i[o].action?i[o].action:"")+'","'+(null!=i[o].username?i[o].username:"")+'","'+EscapeHtml(a)+'","'+(null!=i[o].msg?i[o].msg:"").split(",").join(" -")+'"\r\n'}return saveAs(stringToUtf8Blob(t),"eventslist.csv"),!1}function p3downloadEventsDialogJSON(e){var t,i,o=[];for(i in 1==e&&(t=currentDeviceEvents),2==e&&(t=events),t=3==e?currentUserEvents:t)o.push(events[i]);return saveAs(new Blob([JSON.stringify(o,null,2)],{type:"application/octet-stream"}),"eventslist.json"),!1}function updateUsers(){if(QV("UserNewAccountButton",0==(4&features)&&0==serverinfo.domainauth),null==users||0!=(4&features))QH("p3users","");else{var e=null!=userViewSettings&&userViewSettings.noViewLimit?1e5:100,t=[],i=e,o=0;for(c in users)t.push(users[c]);t.sort(nameSort);for(var n=Q("UserSearchInput").value.toLowerCase(),a=n,s=(n.startsWith("email:")?(n=null,a=a.substring(6)):n.startsWith("name:")?(a=null,n=n.substring(5)):n.startsWith("e:")?(n=null,a=a.substring(2)):n.startsWith("n:")&&(a=null,n=n.substring(2)),'<table class="table table-hover" cellpadding=0 cellspacing=0>'),r=!0,l=(s+="<th>Nome<th style=width:80px>Gruppi di dispositivi<th style=width:120px>"+nobreak("Ultimo accesso")+"<th style=width:120px>permessi",[]),d=document.getElementsByClassName("UserCheckbox"),c=0;c<d.length;c++)d[c].checked&&l.push(d[c].value);for(c in t){var u=t[c],p=null;null!=(p=null!=wssessions?wssessions[u._id]:p)&&(null!=n&&(""==n||0<=u.name.toLowerCase().indexOf(n))||null!=a&&null!=u.email&&0<=u.email.toLowerCase().indexOf(a))&&(0<i?(r&&(s+="<tr><td class=userTableHeader colspan=4>Utenti online",r=!1),s+=addUserHtml(u,p),i--):o++)}for(c in r=!0,t){u=t[c],p=null;null==(p=null!=wssessions?wssessions[u._id]:p)&&(null!=n&&(""==n||0<=u.name.toLowerCase().indexOf(n))||null!=a&&null!=u.email&&0<=u.email.toLowerCase().indexOf(a))&&(0<i?(r&&(s+="<tr><td class=userTableHeader colspan=4>Utenti offline ",r=!1),s+=addUserHtml(u,p),i--):o++)}s+="</table>",1==o?s+="<br />1 altro utente non mostrato, usa la casella di ricerca per cercare gli utenti ...<br />":1<o&&(s+="<br />"+format("{0} altri utenti non visualizzati, utilizza la casella di ricerca per cercare gli utenti ...",o)+"<br />"),i==e&&(s+="<br />Nessun utente trovato.<br />"),QH("p3users",s);for(var d=document.getElementsByClassName("UserCheckbox"),m=encodeURIComponentEx(userinfo._id),c=0;c<d.length;c++)d[c].checked=0<=l.indexOf(d[c].value)&&d[c].value!=m;p3updateInfo(),null!=currentUser&&30==xxcurrentView&&gotoUser(encodeURIComponentEx(currentUser._id),!0)}}function addUserHtml(e,t){var i="",o=" gray",n="",a=e._id!=userinfo._id,s="",r="",t=(null!=t?(o="",a&&(n='<span style=float:right;margin-top:1px;margin-right:4px title=Chat><a href=# onclick=userChat(event,"'+encodeURIComponentEx(e._id)+'","'+encodeURIComponentEx(e.name)+"\")><img src='images/icon-chat.png' height=16 width=16 style=padding-top:2px /></a></span>",n+="<span style=float:right;margin-top:1px;margin-left:4px;margin-right:4px title=Notify><a href=# onclick='return showUserAlertDialog(event,\""+encodeURIComponentEx(e._id)+"\")'><img src='images/icon-notify.png' height=16 width=16 style=padding-top:2px /></a></span>"),s+=nobreak(1==t?"1 sessione":format("{0} sessioni",t))):e.access?s+='<span title="'+format("Ultimo accesso: {0}",printDateTime(new Date(1e3*e.access)))+'">'+printDate(new Date(1e3*e.access))+"</span>":e.login&&(s+='<span title="'+format("Ultimo accesso: {0}",printDateTime(new Date(1e3*e.login)))+'">'+printDate(new Date(1e3*e.login))+"</span>"),a&&(r+="<a href=# style=cursor:pointer onclick='return showUserAdminDialog(event,\""+encodeURIComponentEx(e._id)+"\")'>"),null!=e.siteadmin&&0!=(32&e.siteadmin)&&4294967295!=e.siteadmin&&(r+="Bloccato,&nbsp;"),r+="<span title='Permessi del server'>",4294966047&e.siteadmin),l=(null==e.siteadmin||0==t?r+="Utente":8==t?r+="Utente + File ":4294967295==e.siteadmin?r+="Administrator":r+=0!=(2&t)?"Manager":"Parziale",null!=e.siteadmin&&4294967295!=e.siteadmin&&0!=(1216&e.siteadmin)&&(r+="*"),r+="</span>",a&&(r+="</a>"),0);if(e.links)for(var d in e.links)d.startsWith("mesh/")&&l++;var t=EscapeHtml(e.name),a="";return 1==serverinfo.emailcheck&&(a=1!=e.emailVerified?' <b style=color:red title="L\'e-mail non è verificata">&#x2717;</b>':' <b style=color:green title="L\'email è verificata">&#x2713</b>'),null!=e.email&&(0==(2097152&features)||e.email.toLowerCase()!=e.name.toLowerCase()?t+=', <a href="mailto:'+EscapeHtml(e.email)+'">'+EscapeHtml(e.email)+"</a>"+a:t+=' <a href="mailto:'+EscapeHtml(e.email)+'"><img src="images/mail12.png" height=9 width=12 title="Invia email all\'utente" style="margin-top:2px" /></a>'+a),null!=serverinfo.crossDomain&&""!=(a=e._id.split("/")[1])&&(t+=", <span style=color:#26F>"+a+"</span>"),(0<e.otpsecret||0<e.otphkeys||1==e.otpekey&&8388608&features||1==e.otpduo||null!=e.phone&&67108864&features)&&(t+=' <i class="fa-solid fa-key" title="Autenticazione due fattori abilitata" style="margin-top:2px"></i>'),null!=e.phone&&(t+=' <i class="fa-solid fa-mobile-screen" title="Numero di telefono verificato" style="margin-top:2px"></i>'),null!=e.siteadmin&&0!=(32&e.siteadmin)&&4294967295!=e.siteadmin&&(t+=' <img src="images/padlock12.png" height=12 width=8 title="L\'account è bloccato" style="margin-top:2px" />'),null!=e.msghandle&&33554432&features2&&(t+=' <i class="fa-solid fa-comment fa-xs" title="Verified messaging account" style="margin-top:2px" />'),i+("<tr tabindex=0 onkeypress=\"if (event.key=='Enter') gotoUser('"+encodeURIComponentEx(e._id)+"')\"><td>")+"<div>"+('<div class=baricon><input class="UserCheckbox form-check-input me-2" value='+encodeURIComponentEx(e._id)+" onclick=p3updateInfo() type=checkbox"+(e._id==userinfo._id?" disabled":"")+'></div><div style=cursor:pointer onclick=gotoUser("'+encodeURIComponentEx(e._id)+'",false,event)>')+('<div class=baricon><i class="fa-fw fa-solid fa-user '+o+'"></i></div>')+"<div>"+("<div><span style=line-height:24px>"+t+"</span>"+n+"</div></div><td style=text-align:center>"+l+"<td style=text-align:center>"+s+"<td style=text-align:center>"+r)}function p3updateInfo(){for(var e=document.getElementsByClassName("UserCheckbox"),t=0,i=0;i<e.length;i++)!0===e[i].checked&&t++;QE("UsersGroupActionButton",0<t),Q("UsersSelectAllButton").value=0<t?"Non selezionare niente":"Seleziona tutto"}function p3usersSelectallButtonFunction(){for(var e=encodeURIComponentEx(userinfo._id),t=document.getElementsByClassName("UserCheckbox"),i=0,o=0;o<t.length;o++)!0===t[o].checked&&i++;for(o=0;o<t.length;o++)t[o].checked=0==i&&t[o].value!=e;p3updateInfo()}function p3usersGroupActionFunction(){for(var e,t,i=document.getElementsByClassName("UserCheckbox"),o=0,n=0;n<i.length;n++)!0===i[n].checked&&o++;0!=o&&(e="",serverinfo.emailcheck&&(e+="<option value=4>Convalida e-mail </option><option value=5>Email invalida</option>"),t="Seleziona un'operazione da eseguire su tutti gli utenti selezionati.<br /><br />",setModalContent("xxAddAgent","Azione di gruppo",t+=addHtmlFormFloating("operazione","<select id=d3groupop class=form-select><option value=1>Blocca account</option><option value=2>Sblocca account</option>"+e+"<option value=3>Eliminare l'account</option></select>")),showModal("xxAddAgentModal","idx_dlgOkButton",p3usersGroupActionFunctionEx))}function p3usersGroupActionFunctionEx(){for(var e=document.getElementsByClassName("UserCheckbox"),t=[],i=0;i<e.length;i++)!0===e[i].checked&&t.push(decodeURIComponent(e[i].value));var o,n,a=Q("d3groupop").value;if(1==a)for(var i in t)0==(32&(o=null==(n=users[t[i]]).siteadmin?0:n.siteadmin))&&(o+=32,meshserver.send({action:"edituser",id:n._id,siteadmin:o}));else if(2==a)for(var i in t)0!=(32&(o=null==(n=users[t[i]]).siteadmin?0:n.siteadmin))&&(o-=32,meshserver.send({action:"edituser",id:n._id,siteadmin:o}));else if(3==a)QE("idx_dlgOkButton",!1);else if(4==a)for(var i in t)!0!==(n=users[t[i]]).emailVerified&&meshserver.send({action:"edituser",id:n._id,emailVerified:!0});else if(5==a)for(var i in t)!0===(n=users[t[i]]).emailVerified&&meshserver.send({action:"edituser",id:n._id,emailVerified:!1})}function p3usersGroupActionFunctionDelCheck(){QE("idx_dlgOkButton",Q("d3check").checked)}function p3groupActionFunctionDelExec(e){for(var t=document.getElementsByClassName("UserCheckbox"),i=[],o=0;o<t.length;o++)!0===t[o].checked&&i.push(decodeURIComponent(t[o].value));for(o in i){var n=users[i[o]];meshserver.send({action:"deleteuser",userid:n._id,username:n.name})}}function userMouseHover(e,t){var i=e.children[0].children[0].children[1];i.children[1].classList.remove("g1s"),i.children[2].classList.remove("g2s"),e.children[0].children[0].classList.remove("sbar"),1==t&&(i.children[1].classList.add("g1s"),i.children[2].classList.add("g2s"),e.children[0].children[0].classList.add("sbar"))}function userMouseHover2(e,t){var i=e.children[0].children[0];i.children[2].classList.remove("g1s"),i.children[3].classList.remove("g2s"),e.children[0].children[0].classList.remove("sbar"),1==t&&(i.children[2].classList.add("g1s"),i.children[3].classList.add("g2s"),e.children[0].children[0].classList.add("sbar"))}function userChat(e,t,i){if(!xxdialogMode)return haltEvent(e),e="/messenger?id=meshmessenger/"+t+"/"+encodeURIComponentEx(userinfo._id)+"&title="+i,null!=authCookie&&""!=authCookie&&(e+="&auth="+authCookie),urlargs.key&&(e+="&key="+urlargs.key),safeNewWindow(e,"meshmessenger:"+t),meshserver.send({action:"meshmessenger",userid:decodeURIComponent(t)}),!1}function altUserChat(e,t,i,o){var n,a,s,r,l;if(!xxdialogMode)return haltEvent(e),e=serverinfo.altmessenging[o].url,s=n=encodeURIComponentEx((l=decodeURIComponent(t)).split("/")[2]),r=a=encodeURIComponentEx(l.split("/").join("-")),null!=(l=users[l])&&null!=l.realname&&(s=encodeURIComponentEx(l.realname.split(" ").join("")),r=encodeURIComponentEx(l.realname.split(" ").join("-"))),e=e.split("{0}").join(n).split("{1}").join(a).split("{2}").join(s).split("{3}").join(r),urlargs.key&&(e+="&key="+urlargs.key),safeNewWindow(e,"altmessenger:"+t),meshserver.send({action:"notifyuser",userid:decodeURIComponent(t),msg:serverinfo.altmessenging[o].name,msgid:11,url:e}),!1}function showSendSMS(e){xxdialogMode||(setModalContent("xxAddAgent","Inviare SMS","<textarea id=d2smsText maxlength=160 style=width:100%;height:100px;resize:none onKeyUp=showSendSMSValidate()></textarea><span style=font-size:10px><span>"),showModal("xxAddAgentModal","idx_dlgOkButton",()=>showSendSMSEx(3,e)),Q("d2smsText").focus(),showSendSMSValidate())}function showSendSMSValidate(){QE("idx_dlgOkButton",0<Q("d2smsText").value.length)}function showSendSMSEx(e,t){0<Q("d2smsText").value.length&&meshserver.send({action:"smsuser",userid:decodeURIComponent(t),msg:Q("d2smsText").value})}function showSendMessage(e){xxdialogMode||(setModalContent("xxAddAgent","Send Message","<textarea id=d2smsText maxlength=160 style=width:100%;height:100px;resize:none onKeyUp=showSendSMSValidate()></textarea><span style=font-size:10px><span>"),showModal("xxAddAgentModal","idx_dlgOkButton",()=>showSendMessageEx(3,e)),Q("d2smsText").focus(),showSendSMSValidate())}function showSendMessageEx(e,t){0<Q("d2smsText").value.length&&meshserver.send({action:"msguser",userid:decodeURIComponent(t),msg:Q("d2smsText").value})}function showSendEmail(e){xxdialogMode||(setModalContent("xxAddAgent","Invia una email",'<input id=d2emailSubject style=width:100% placeholder="Soggetto"></input><textarea id=d2emailText maxlength=10000 style="width:100%;height:200px;resize:none;overflow-y:auto" onKeyUp=showSendEmailValidate()></textarea>'),showModal("xxAddAgentModal","idx_dlgOkButton",()=>showSendEmailEx(3,e)),Q("d2emailSubject").focus(),showSendEmailValidate())}function showSendEmailValidate(){QE("idx_dlgOkButton",0<Q("d2emailSubject").value.length&&0<Q("d2emailText").value.length)}function showSendEmailEx(e,t){0<Q("d2emailText").value.length&&meshserver.send({action:"emailuser",userid:decodeURIComponent(t),subject:Q("d2emailSubject").value,msg:Q("d2emailText").value})}function showUserAlertDialog(e,t){if(!xxdialogMode)return haltEvent(e),setModalContent("xxAddAgent",format("Notifica {0} ",EscapeHtml(users[decodeURIComponent(t)].name)),'<div style=margin-bottom:6px>Invia una notifica di testo a questo utente.</div><textarea id=d2notifyText maxlength=2048 style="width:100%;height:184px;resize:none"></textarea><select style=width:100% id=broadcastMessageMaxTime><option value=0>Mostra messaggio fino a quando non viene respinto dall\'utente</option><option value=10>Mostra per 10 secondi</option><option value=60>Mostra per 1 minuto</option><option value=300>Mostra per 5 minuti</option></select>'),showModal("xxAddAgentModal","idx_dlgOkButton",()=>showUserAlertDialogEx(3,t)),Q("d2notifyText").focus(),!1}function showUserAlertDialogEx(e,t){meshserver.send({action:"notifyuser",userid:decodeURIComponent(t),msg:Q("d2notifyText").value,maxtime:parseInt(Q("broadcastMessageMaxTime").value)})}function onUsersViewSettings(){var e;xxdialogMode||(e="",setModalContent("xxAddAgent","Visualizzazione utenti",e+='<label><input id=d2c1 type=checkbox class="form-check-input me-2"'+((userViewSettings=null==userViewSettings?{}:userViewSettings).noViewLimit?"":" checked")+">Visualizza solo i primi 100 utenti</label><br />"),showModal("xxAddAgentModal","idx_dlgOkButton",onUsersViewSettingsEx))}function onUsersViewSettingsEx(){userViewSettings.noViewLimit=!Q("d2c1").checked,putstore("_usersViewSettings",JSON.stringify(userViewSettings)),mainUpdate(16384)}function p4batchAccountCreate(){xxdialogMode||(setModalContent("xxAddAgent","Importazione dell'account utente ",'Create many accounts at once by importing a JSON or CSV file<br /><br />JSON file format is as follows:<br /><pre>[\r\n {"user":"x1","pass":"x","email":"x1@x"},\r\n {"user":"x2","pass":"x","resetNextLogin":true}\r\n]</pre><br />CSV file format is as follows:<br /><pre>user,pass,email,resetNextLogin\r\nx1,x,x1@x,\r\nx2,x,,true\r\n</pre><br /><input type=file id=d4importFile class="form-control" accept=".json,.csv" onchange=p4batchAccountCreateValidate() />'),showModal("xxAddAgentModal","idx_dlgOkButton",p4batchAccountCreateEx))}function p4batchAccountCreateValidate(){QE("idx_dlgOkButton",null!=Q("d4importFile").value)}function p4batchAccountCreateEx(){var e=new FileReader;e.onload=function(e){var t=null;if(Q("d4importFile").value.endsWith(".csv")){var i=e.target.result.split("\n"),o=i[0].trim().split(","),n=[];for(let e=1;e<i.length;e++){var a=i[e].trim();if(""!==a){var s=a.split(",");let t=!1;for(let e=0;e<s.length;e++)if(""!==s[e].trim()){t=!0;break}if(t){var r={};for(let e=0;e<o.length;e++){var l=s[e].trim();""!==o[e].trim()&&""!==l&&(r[o[e]]="true"===l.toLowerCase()||l)}n.push(r)}}}if(null!=(t=n)&&Array.isArray(t)){var d=!0;for(c in t)("string"!=typeof t[c].user||t[c].user.length<1||64<t[c].user.length)&&(d=!1),("string"!=typeof t[c].pass||t[c].pass.length<1||256<t[c].pass.length)&&(d=!1),0==checkPasswordRequirements(t[c].pass,passRequirements)&&(d=!1),null!=t[c].email&&("string"!=typeof t[c].email||t[c].email.length<1||128<t[c].email.length)&&(d=!1);0==d?setModalContent("xxAddAgent","Importazione dell'account utente ","Invalid CSV file format."):meshserver.send({action:"adduserbatch",users:t})}else setModalContent("xxAddAgent","Importazione dell'account utente ","Invalid CSV file format.")}else{try{t=JSON.parse(e.target.result)}catch(e){return setModalContent("xxAddAgent","Importazione dell'account utente ",format("File JSON non valido: {0}.",e)),void showModal("xxAddAgentModal","idx_dlgOkButton")}if(null!=t&&Array.isArray(t)){var c,d=!0;for(c in t)("string"!=typeof t[c].user||t[c].user.length<1||64<t[c].user.length)&&(d=!1),("string"!=typeof t[c].pass||t[c].pass.length<1||256<t[c].pass.length)&&(d=!1),0==checkPasswordRequirements(t[c].pass,passRequirements)&&(d=!1),null!=t[c].email&&("string"!=typeof t[c].email||t[c].email.length<1||128<t[c].email.length)&&(d=!1);0==d?setModalContent("xxAddAgent","Importazione dell'account utente ","Formato file JSON non valido."):meshserver.send({action:"adduserbatch",users:t})}else setModalContent("xxAddAgent","Importazione dell'account utente ","Formato file JSON non valido.");showModal("xxAddAgentModal","idx_dlgOkButton")}},e.readAsText(Q("d4importFile").files[0])}function p4downloadUserInfo(){var e;xxdialogMode||(e="Scarica l'elenco degli utenti con uno dei formati di file seguenti.<br /><br />",setModalContent("xxAddAgent","Esportazione elenco utenti ",e=(e+=addHtmlValue("Formato CSV","<a href=# style=cursor:pointer onclick='return p4downloadUserInfoCSV()'>userlist.csv</a>"))+addHtmlValue("Formato JSON","<a href=# style=cursor:pointer onclick='return p4downloadUserInfoJSON()'>userlist.json</a>")),showModal("xxAddAgentModal","idx_dlgOkButton"))}function p4downloadUserInfoCSV(){var e,t="ID,nome,e-mail,creazione,ultimo accesso,gruppi,authfactors,amministratore del sito,amministratore utente,bloccato\r\n";for(e in users){var i=!1,o=[];(0<users[e].otpsecret||0<users[e].otphkeys)&&(i=!0,0<users[e].otpsecret&&o.push("AuthApp"),0<users[e].otphkeys&&o.push("SecurityKey"),0<users[e].otpkeys)&&o.push("BackupCodes"),t=(t=(t=(t+='"'+users[e]._id+'","'+users[e].name+'","'+(users[e].email||"")+'","'+(users[e].creation?new Date(1e3*users[e].creation):"")+'","'+(users[e].login?new Date(1e3*users[e].login):"")+'","'+(users[e].groups?users[e].groups.join(","):"")+'","'+(i?o.join(","):"")+'"')+(","+(4294967295==users[e].siteadmin?"1":"0")))+(","+(0!=(2&users[e].siteadmin)?"1":"0")))+(","+(0!=(32&users[e].siteadmin)?"1":"0"))+"\r\n"}return saveAs(stringToUtf8Blob(t),"userlist.csv"),!1}function p4downloadUserInfoJSON(){var e,t=[];for(e in users)t.push(users[e]);return saveAs(new Blob([JSON.stringify(t,null,2)],{type:"application/octet-stream"}),"userlist.json"),!1}function showUserBroadcastDialog(e){xxdialogMode||(setModalContent("xxAddAgent","Messaggio di trasmissione",'<div style=margin-bottom:6px>Trasmetti un messaggio a tutti gli utenti collegati.</div><textarea id=broadcastMessage class="form-control mb-2" style="width:100%;height:184px;resize:none" value="" maxlength=2048 /></textarea><select style=width:100% class="form-select" id=broadcastMessageMaxTime><option value=0>Mostra messaggio fino a quando non viene respinto dall\'utente</option><option value=10>Mostra per 10 secondi</option><option value=60>Mostra per 1 minuto</option><option value=300>Mostra per 5 minuti</option></select>'),showModal("xxAddAgentModal","idx_dlgOkButton",function(){showUserBroadcastDialogEx(3,e?decodeURIComponent(e):null)}),Q("broadcastMessage").focus())}function showUserBroadcastDialogEx(e,t){meshserver.send({action:"userbroadcast",msg:Q("broadcastMessage").value,target:t,maxtime:parseInt(Q("broadcastMessageMaxTime").value)})}function showCreateNewAccountDialog(){if(!xxdialogMode){var e="";if(serverinfo.crossDomain){var t='<select class="form-select" id=p4domain>';for(i in serverinfo.crossDomain)t+="<option value="+i+">"+(""==serverinfo.crossDomain[i]?"Predefinito":EscapeHtml(serverinfo.crossDomain[i]))+"</option>";e+=addHtmlFormFloating("Dominio",t+="</select>")}if(0==(2097152&features)&&(e+=addHtmlFormFloating("<span id=p4hname>Nome utente</span>",'<input id=p4name class="form-control" maxlength=64 autocomplete=username onchange=showCreateNewAccountDialogValidate() onkeyup=showCreateNewAccountDialogValidate() />')),e=(e=(e=(e=e+addHtmlFormFloating("<span id=p4hemail>E-mail",'<input id=p4email type=email class="form-control" maxlength=256 autocomplete="email" inputmode="email" onchange=showCreateNewAccountDialogValidate() onkeyup=showCreateNewAccountDialogValidate() />')+"")+addHtmlFormFloating("<span id=p4hp1>Password</span>",'<input id=p4pass1 type=password class="form-control" maxlength=256 autocomplete="new-password" onchange=showCreateNewAccountDialogValidate() onkeyup=showCreateNewAccountDialogValidate() />'))+addHtmlFormFloating("<span id=p4hp2>Confirm Password</span>",'<input id=p4pass2 type=password class="form-control" maxlength=256 autocomplete="new-password" onchange=showCreateNewAccountDialogValidate() onkeyup=showCreateNewAccountDialogValidate() />')+'<div><label><input id=p4randomPassword onchange=showCreateNewAccountDialogValidate() type=checkbox class="form-check-input me-2" />Randomizza la password.</label></div>')+'<div><label><input id=p4removeEvents onchange=showCreateNewAccountDialogValidate() type=checkbox class="form-check-input me-2" />Rimuovi tutti gli eventi precedenti per questo ID utente.</label></div>'+'<div><label><input id=p4resetNextLogin onchange=showCreateNewAccountDialogValidate() type=checkbox class="form-check-input me-2" />Forza la reimpostazione della password al prossimo accesso.</label></div>',serverinfo.emailcheck&&(e+='<div><label><input id=p4verifiedEmail onchange=showCreateNewAccountDialogValidate() type=checkbox class="form-check-input me-2" />L\'email è verificata.</label></div><div><label><input id=p4invitationEmail type=checkbox class="form-check-input me-2" title=Email verificata e reimpostazione forzata della password richiesta. />Invia email di invito.</label></div>'),passRequirements){var i,o=[],n=0;for(i in passRequirements)"reset"!=i&&"hint"!=i&&(o.push(i+":"+passRequirements[i]),n++);0<n&&(e+="<div style=font-size:x-small;padding:6px>"+format("Requisiti: {0}.",o.join(", "))+"</div>")}setModalContent("xxAddAgent","Creare un utente",e),showModal("xxAddAgentModal","idx_dlgOkButton",showCreateNewAccountDialogEx),showCreateNewAccountDialogValidate(),(0==(2097152&features)?Q("p4name"):Q("p4email")).focus()}}function showCreateNewAccountDialogValidate(){var e=validateEmail(Q("p4email").value),t=!0,i=0<Q("p4pass1").value.length&&Q("p4pass1").value==Q("p4pass2").value&&checkPasswordRequirements(Q("p4pass1").value,passRequirements),t=(0==(2097152&features)&&(t=!Q("p4name")||0<Q("p4name").value.length&&-1==Q("p4name").value.indexOf(" "),QS("p4hname").color=t?"black":"#7b241c"),QS("p4hemail").color=e?"black":"#7b241c",serverinfo.emailcheck&&(QE("p4verifiedEmail",e),QE("p4invitationEmail",e&&Q("p4resetNextLogin").checked&&Q("p4verifiedEmail").checked),0==e&&(Q("p4verifiedEmail").checked=!1),0!=Q("p4resetNextLogin").checked&&0!=Q("p4verifiedEmail").checked||(Q("p4invitationEmail").checked=!1)),QE("p4pass1",!Q("p4randomPassword").checked),QE("p4pass2",!Q("p4randomPassword").checked),QS("p4hp1").color=i||Q("p4randomPassword").checked?"black":"#7b241c",QS("p4hp2").color=i||Q("p4randomPassword").checked?"black":"#7b241c",t&e);0==Q("p4randomPassword").checked&&(t&=i),QE("idx_dlgOkButton",t)}function showCreateNewAccountDialogEx(){var e={action:"adduser",username:(0==(2097152&features)?Q("p4name"):Q("p4email")).value,email:Q("p4email").value,pass:Q("p4pass1").value,resetNextLogin:Q("p4resetNextLogin").checked,randomPassword:Q("p4randomPassword").checked,removeEvents:Q("p4removeEvents").checked};serverinfo.emailcheck&&(e.emailVerified=Q("p4verifiedEmail").checked,e.emailInvitation=Q("p4invitationEmail").checked),serverinfo.crossDomain&&(e.domain=serverinfo.crossDomain[parseInt(Q("p4domain").value)]),meshserver.send(e)}function showUserGroupDialog(e,t){var i,o,n;if(!xxdialogMode)return haltEvent(e),t=decodeURIComponent(t),o="",n="Immettere un elenco separato da virgole di nomi di ambiti amministrativi.<br /><br />",setModalContent("xxAddAgent","Regni amministrativi",n+=`<div class="form-floating mb-2"><input id=dp4usergroups value="${o=null!=(i=users[t.toLowerCase()]).groups?i.groups.join(", "):o}" class="form-control" placeholder="Name1, Name2, Name3" maxlength=256 onchange=p4validateUserGroups() onkeyup=p4validateUserGroups() /><label for=dp4usergroups>Realms</label></div>`),showModal("xxAddAgentModal","idx_dlgOkButton",function(){showUserGroupDialogEx(e,i)}),focusTextBox("dp4usergroups"),p4validateUserGroups(),!1}function p4validateUserGroups(){var e,t=Q("dp4usergroups").value,i=0,o=t.indexOf('"')+t.indexOf("/")+t.indexOf(">")+t.indexOf("<")+t.indexOf("'"),n=t.split(",");for(e in n)0==n[e].trim().length&&i++;QE("idx_dlgOkButton",""==t||-5==o&&i<1)}function showUserGroupDialogEx(e,t){var i,o=Q("dp4usergroups").value.split(","),n=[];for(i in o){var a=o[i].trim();0<a.length&&n.push(a)}meshserver.send({action:"edituser",id:t._id,groups:n})}function showUserAdminDialog(e,t){if(!xxdialogMode){haltEvent(e),t=decodeURIComponent(t);var i,o=users[t];if(null!=o)return i=userinfo._id==o._id,(e="")!=(e=(e=(e=(e=(e+='<div class="d-inline-flex align-items-center"><label class="form-label me-2"><input type=checkbox onchange=showUserAdminDialogValidate() class="form-check-input me-2" id=ua_fileaccess>File del server</label>, <input type=number class="me-1 form-control" onchange=showUserAdminDialogValidate() maxlength=10 id=ua_fileaccessquota>k max, vuoto per impostazione predefinita</div><br><hr/>')+'<label><input type=checkbox onchange=showUserAdminDialogValidate() class="form-check-input me-2" id=ua_fulladmin>Amministratore completo</label><br>'+'<label><input type=checkbox onchange=showUserAdminDialogValidate() class="form-check-input me-2" id=ua_serverbackup>Backup del server</label><br>')+'<label><input type=checkbox onchange=showUserAdminDialogValidate() class="form-check-input me-2" id=ua_serverrestore>Ripristino del server</label><br>'+'<label><input type=checkbox onchange=showUserAdminDialogValidate() class="form-check-input me-2" id=ua_serverupdate>Aggiornamenti del server</label><br></div>')+'<div id=d2MngUsr><label><input type=checkbox onchange=showUserAdminDialogValidate() class="form-check-input me-2" id=ua_manageusers>Gestisci utenti</label><br></div>'+'<div id=d2MngGrp><label><input type=checkbox onchange=showUserAdminDialogValidate() class="form-check-input me-2" id=ua_manageusergroups>Gestisci gruppi di utenti</label><br></div>')+'<div id=d2MngRec><label><input type=checkbox onchange=showUserAdminDialogValidate() class="form-check-input me-2" id=ua_managerecordings>Gestisci registrazioni</label><br></div>'+'<div id=d2AllEvnt><label><input type=checkbox onchange=showUserAdminDialogValidate() class="form-check-input me-2" id=ua_allevents>Visualizza tutti gli eventi </label><br></div>')&&(e+="<hr/>"),setModalContent("xxAddAgent","Permessi del server",e=(e=(e=(e="<div><div id=d2AdminPermissions>"+e)+'<label><input type=checkbox onchange=showUserAdminDialogValidate() class="form-check-input me-2" id=ua_lockedaccount>Blocca account</label><br>'+'<label><input type=checkbox onchange=showUserAdminDialogValidate() class="form-check-input me-2" id=ua_nonewgroups>Nessun nuovo gruppo di dispositivi</label><br>')+'<label><input type=checkbox onchange=showUserAdminDialogValidate() class="form-check-input me-2" id=ua_nonewdevices>Nessun nuovo dispositivo</label><br>'+'<label><input type=checkbox onchange=showUserAdminDialogValidate() class="form-check-input me-2" id=ua_nomeshcmd>Nessuno strumento (MeshCmd/Router) </label><br>')+'<label><input type=checkbox onchange=showUserAdminDialogValidate() class="form-check-input me-2" id=ua_locksettings>Blocca le impostazioni dell\'account</label><br>'+"</div>"),showModal("xxAddAgentModal","idx_dlgOkButton",function(){showUserAdminDialogEx(2+(i?0:1),o)}),o.siteadmin&&0!=o.siteadmin&&(Q("ua_fulladmin").checked=4294967295==o.siteadmin,Q("ua_serverbackup").checked=4294967295!=o.siteadmin&&0!=(1&o.siteadmin),Q("ua_serverrestore").checked=4294967295!=o.siteadmin&&0!=(4&o.siteadmin),Q("ua_fileaccess").checked=4294967295!=o.siteadmin&&0!=(8&o.siteadmin),Q("ua_serverupdate").checked=4294967295!=o.siteadmin&&0!=(16&o.siteadmin),Q("ua_lockedaccount").checked=4294967295!=o.siteadmin&&0!=(32&o.siteadmin),Q("ua_nonewgroups").checked=4294967295!=o.siteadmin&&0!=(64&o.siteadmin),Q("ua_nomeshcmd").checked=4294967295!=o.siteadmin&&0!=(128&o.siteadmin),Q("ua_locksettings").checked=4294967295!=o.siteadmin&&0!=(1024&o.siteadmin),Q("ua_nonewdevices").checked=4294967295!=o.siteadmin&&0!=(4096&o.siteadmin)),0!=(2&userinfo.siteadmin)&&(Q("ua_manageusers").checked=4294967295!=o.siteadmin&&0!=(2&o.siteadmin),QE("ua_manageusers",!i&&2&userinfo.siteadmin)),0!=(256&userinfo.siteadmin)&&(Q("ua_manageusergroups").checked=4294967295!=o.siteadmin&&0!=(256&o.siteadmin),QE("ua_manageusergroups",!i&&256&userinfo.siteadmin)),0!=(512&userinfo.siteadmin)&&(Q("ua_managerecordings").checked=4294967295!=o.siteadmin&&0!=(512&o.siteadmin),QE("ua_managerecordings",!i&&512&userinfo.siteadmin)),0!=(2048&userinfo.siteadmin)&&(Q("ua_allevents").checked=4294967295!=o.siteadmin&&0!=(2048&o.siteadmin),QE("ua_allevents",!i&&2048&userinfo.siteadmin)),QE("ua_fulladmin",!i&&4294967295==userinfo.siteadmin),QE("ua_serverbackup",!i&&4294967295==userinfo.siteadmin),QE("ua_serverrestore",!i&&4294967295==userinfo.siteadmin),QE("ua_fileaccess",!i&&4294967295==userinfo.siteadmin),QE("ua_fileaccessquota",!i&&4294967295==userinfo.siteadmin),QE("ua_serverupdate",!i&&4294967295==userinfo.siteadmin),QV("d2AdminPermissions",4294967295==userinfo.siteadmin),QV("d2MngUsr",0!=(2&userinfo.siteadmin)),QV("d2MngGrp",0!=(256&userinfo.siteadmin)),QV("d2MngRec",0!=(512&userinfo.siteadmin)),QE("ua_lockedaccount",!i&&2&userinfo.siteadmin&&4294967295!=o.siteadmin&&userinfo._id!=o._id),QE("ua_nonewgroups",!i&&2&userinfo.siteadmin&&4294967295!=o.siteadmin&&userinfo._id!=o._id),QE("ua_nomeshcmd",!i&&2&userinfo.siteadmin&&4294967295!=o.siteadmin&&userinfo._id!=o._id),QE("ua_nonewdevices",!i&&2&userinfo.siteadmin&&4294967295!=o.siteadmin&&userinfo._id!=o._id),QE("ua_locksettings",!i&&2&userinfo.siteadmin&&4294967295!=o.siteadmin&&userinfo._id!=o._id),Q("ua_fileaccessquota").value=null!=o.quota?o.quota/1024:"",showUserAdminDialogValidate(),!1}}function showUserAdminDialogValidate(){4294967295==userinfo.siteadmin&&(QE("ua_serverbackup",!Q("ua_fulladmin").checked),QE("ua_manageusers",!Q("ua_fulladmin").checked),QE("ua_serverrestore",!Q("ua_fulladmin").checked),QE("ua_fileaccess",!Q("ua_fulladmin").checked),QE("ua_serverupdate",!Q("ua_fulladmin").checked),QE("ua_lockedaccount",!Q("ua_fulladmin").checked),QE("ua_nonewgroups",!Q("ua_fulladmin").checked),QE("ua_nomeshcmd",!Q("ua_fulladmin").checked),QE("ua_nonewdevices",!Q("ua_fulladmin").checked),QE("ua_manageusergroups",!Q("ua_fulladmin").checked),QE("ua_managerecordings",!Q("ua_fulladmin").checked),QE("ua_allevents",!Q("ua_fulladmin").checked),QE("ua_locksettings",!Q("ua_fulladmin").checked),QE("ua_fileaccessquota",Q("ua_fileaccess").checked&&!Q("ua_fulladmin").checked))}function showUserAdminDialogEx(e,t){var i=0,o=parseInt(Q("ua_fileaccessquota").value),t=(1==Q("ua_fulladmin").checked?i=4294967295:(1==Q("ua_serverbackup").checked&&(i+=1),1==Q("ua_manageusers").checked&&(i+=2),1==Q("ua_serverrestore").checked&&(i+=4),1==Q("ua_fileaccess").checked&&(i+=8),1==Q("ua_serverupdate").checked&&(i+=16),1==Q("ua_lockedaccount").checked&&(i+=32),1==Q("ua_nonewgroups").checked&&(i+=64),1==Q("ua_nomeshcmd").checked&&(i+=128),1==Q("ua_manageusergroups").checked&&(i+=256),1==Q("ua_managerecordings").checked&&(i+=512),1==Q("ua_locksettings").checked&&(i+=1024),1==Q("ua_allevents").checked&&(i+=2048),1==Q("ua_nonewdevices").checked&&(i+=4096)),{action:"edituser",id:t._id,siteadmin:i});0==isNaN(o)&&(t.quota=1024*o),meshserver.send(t)}function onUserSearchInputChanged(){mainUpdate(16384)}function updateUserGroups(){QV("p50userGroupOps",0!=(256&userinfo.siteadmin));var e=[],t="";if(usergroups)for(var i in usergroups)e.push(usergroups[i]);e.sort(nameSort);for(var o=[],n=document.getElementsByClassName("UserGroupCheckbox"),i=0;i<n.length;i++)n[i].checked&&o.push(n[i].value);if(0==e.length)t+="<br />Nessun gruppo trovato. <br />",QV("DuplicateUserGroupButton",!1);else{for(var i in t=t+'<table class="table table-hover p3usersTable" cellpadding=0 cellspacing=0>'+"<th>Nome<th style=width:80px>Utenti <th style=width:80px>Gruppi di dispositivi<th style=width:80px>Dispositivi",e)t+=addUserGroupHtml(e[i]);t+="</table>",QV("DuplicateUserGroupButton",!0)}QH("p50groups",t);for(n=document.getElementsByClassName("UserGroupCheckbox"),i=0;i<n.length;i++)n[i].checked=0<=o.indexOf(n[i].value);p50updateInfo(),null!=currentUserGroup&&51==xxcurrentView&&gotoUserGroup(encodeURIComponentEx(currentUserGroup._id),!0)}function addUserGroupHtml(e){var t=0,i=0,o=0;if(e.links)for(var n in e.links)n.startsWith("user/")&&t++,n.startsWith("mesh/")&&i++,n.startsWith("node/")&&o++;var a=EscapeHtml(e.name),s=(null!=serverinfo.crossDomain&&""!=(s=e._id.split("/")[1])&&(a+=", <span style=color:#26F>"+EscapeHtml(s)+"</span>"),"<tr tabindex=0 onkeypress=\"if (event.key=='Enter') gotoUserGroup('"+encodeURIComponentEx(e._id)+"')\"><td style=cursor:pointer>");return(s+="<div style=width:100%>")+('<div class=baricon><input class="form-check-input me-2 UserGroupCheckbox" value='+encodeURIComponentEx(e._id)+" onclick=p50updateInfo() type=checkbox></div>")+('<div class=baricon onclick=gotoUserGroup("'+encodeURIComponentEx(e._id)+'")><i class="fa-solid fa-users"></i></div>')+('<div onclick=gotoUserGroup("'+encodeURIComponentEx(e._id)+'")></div><div onclick=gotoUserGroup("'+encodeURIComponentEx(e._id)+'")></div>')+('<div style=line-height:24px onclick=gotoUserGroup("'+encodeURIComponentEx(e._id)+'")><span style=font-size:16px>'+a+"</span></div></div><td style=text-align:center>"+t+"<td style=text-align:center>"+i+"<td style=text-align:center>"+o)}function p50updateInfo(){for(var e=document.getElementsByClassName("UserGroupCheckbox"),t=0,i=0;i<e.length;i++)!0===e[i].checked&&t++;QE("UsersGroupsGroupActionButton",0<t),Q("UsersGroupsSelectAllButton").value=0<t?"Non selezionare niente":"Seleziona tutto"}function p50usersSelectallButtonFunction(){for(var e=encodeURIComponentEx(userinfo._id),t=document.getElementsByClassName("UserGroupCheckbox"),i=0,o=0;o<t.length;o++)!0===t[o].checked&&i++;for(o=0;o<t.length;o++)t[o].checked=0==i&&t[o].value!=e;p50updateInfo()}function p50usersGroupActionFunction(){for(var e,t=document.getElementsByClassName("UserGroupCheckbox"),i=0,o=0;o<t.length;o++)!0===t[o].checked&&i++;0!=i&&(e="Seleziona un'operazione da eseguire su tutti gli utenti selezionati.<br /><br />",e+=addHtmlFormFloating("operazione","<select id=d50groupop class=form-select><option value=1>Elimina gruppo</option></select>"),xxdialogButtons=3,setModalContent("xxAddAgent","Azione di gruppo",e),showModal("xxAddAgentModal","idx_dlgOkButton",p50usersGroupActionFunctionEx))}function p50usersGroupActionFunctionEx(){for(var e=document.getElementsByClassName("UserGroupCheckbox"),t=[],i=0;i<e.length;i++)!0===e[i].checked&&t.push(decodeURIComponent(e[i].value));1==Q("d50groupop").value&&(setModalContent("xxAddAgent","Elimina gruppi di utenti",'Confermare l\'eliminazione dei gruppi di utenti selezionati?<br /><br /><label><input id=d3check type=checkbox class="form-check-input me-2" onchange=p50usersGroupActionFunctionDelCheck() />Confermare</label>'),document.getElementById("idx_dlgOkButton").onclick=function(){p50groupActionFunctionDelExec(3)})}function p50usersGroupActionFunctionDelCheck(){QE("idx_dlgOkButton",Q("d3check").checked)}function p50groupActionFunctionDelExec(e){for(var t=document.getElementsByClassName("UserGroupCheckbox"),i=0;i<t.length;i++)!0===t[i].checked&&meshserver.send({action:"deleteusergroup",ugrpid:decodeURIComponent(t[i].value)})}function showCreateUserGroupDialog(e){if(!xxdialogMode){var t="",i="";if(2==e){if(usergroups)for(var o in usergroups)i+="<option value="+encodeURIComponentEx(o)+">"+EscapeHtml(usergroups[o].name)+"</option>";t+=addHtmlFormFloating("Gruppo di utenti ",'<select id=dp4groupid class="form-select">'+i+"</select>")}if(1==e&&serverinfo.crossDomain){i='<select id=p4domain class="form-select">';for(o in serverinfo.crossDomain)i+="<option value="+o+">"+(""==serverinfo.crossDomain[o]?"Predefinito":EscapeHtml(serverinfo.crossDomain[o]))+"</option>";t+=addHtmlFormFloating("Dominio",i+="</select>")}t=(t+=addHtmlFormFloating("Nome","<input id=p4name class=form-control maxlength=64 onchange=showCreateUserGroupDialogValidate() onkeyup=showCreateUserGroupDialogValidate() />"))+addHtmlFormFloating("Descrizione",'<textarea id=p4desc class=form-control value="" maxlength=1024 /></textarea>'),setModalContent("xxAddAgent",1==e?"Crea gruppo utenti":"Duplica gruppo utenti",t),showModal("xxAddAgentModal","idx_dlgOkButton",function(){showCreateUserGroupDialogEx(3,e)}),showCreateUserGroupDialogValidate(),Q("p4name").focus()}}function showCreateUserGroupDialogValidate(){QE("idx_dlgOkButton",0<Q("p4name").value.length)}function showCreateUserGroupDialogEx(e,t){var i={action:"createusergroup",name:Q("p4name").value,desc:Q("p4desc").value};2==t&&(i.clone=decodeURIComponent(Q("dp4groupid").value)),1==t&&serverinfo.crossDomain&&(i.domain=serverinfo.crossDomain[parseInt(Q("p4domain").value)]),meshserver.send(i)}var currentUserGroup=null;function gotoUserGroup(e,t){if(!xxdialogMode||t){t=currentUserGroup=usergroups?usergroups[decodeURIComponent(e)]:null;if(null==t)51==xxcurrentView&&go(50);else{var e=EscapeHtml(t.name),i=(0==e.length&&(e="<i>Nessuna </i>"),null==currentUserGroup.membershipType&&0!=(256&userinfo.siteadmin)&&(e='<span role=button tabindex=0 title="Fare clic qui per modificare il nome del gruppo di utenti" onclick=p51editgroup(1) onkeyup="if (event.key == \'Enter\') p51editgroup(1)">'+e+'  <i class="fa-solid fa-pencil fa-2xs"/></i></span>'),QH("p51groupName",e),0),o=0,n=0;if(t.links)for(var a in t.links)a.startsWith("user/")&&i++,a.startsWith("mesh/")&&o++,a.startsWith("node/")&&n++;var s,r=null==(r=t.desc)||""==r?"<i>Nessuna <i>":EscapeHtml(r),l="<div style=min-height:80px><table style=width:100%>",r=(0!=(8&args.hide)&&(l+="<br />"+addDeviceAttribute("Nome",e)),null==serverinfo.crossDomain&&0==debugmode||(l=(l+=addDeviceAttribute("Dominio",""!=(e=t._id.split("/")[1])?EscapeHtml(e):"<i>Predefinito</i>"))+addDeviceAttribute("Identificatore di gruppo",EscapeHtml(t._id))),null!=currentUserGroup.membershipType&&(l+=addDeviceAttribute("Group Type",EscapeHtml(currentUserGroup.membershipType))),0!=(256&userinfo.siteadmin)?l+=addDeviceAttribute("Descrizione","<span role=button onclick=p51editgroup(2,"+(null!=currentUserGroup.membershipType)+")>"+r+' <i class="fa-solid fa-pencil fa-xs"/></i></span>'):l+=addDeviceAttribute("Descrizione",r),1==serverinfo.userGroupsSessionRecording&&(e=[],t.flags&&2&t.flags&&e.push("Registra sessioni"),l+=addDeviceAttribute("Caratteristiche",addLink(e=""==(e=e.join(", "))?"<i>Nessuna </i>":e,"p51edituserGroupFeatures()"))),[]),e=0,d=(t.consent&&(e=t.consent),serverinfo.consent&&(e|=serverinfo.consent),64&e&&8&e?r.push("Prompt desktop + barra degli strumenti"):64&e?r.push("Barra degli strumenti desktop"):8&e?r.push("Prompt del desktop"):1&e&&r.push("Notifica desktop"),16&e?r.push("Prompt del terminale"):2&e&&r.push("Notifica terminale"),32&e?r.push("Prompt file"):4&e&&r.push("Notifica file"),7==e&&(r=["Avvisa sempre"]),l=(l=(l=(l+=addDeviceAttribute("Consenso dell'utente ",addLinkConditional(r=""==(r=(r=56==(56&e)?["Chiedi sempre"]:r).join(", "))?"<i>Nessuna </i>":r,"p20editmeshconsent(4)",!0)))+addDeviceAttribute("Utenti ",i))+addDeviceAttribute("Gruppi di dispositivi",o))+addDeviceAttribute("Dispositivi",n)+"</table></div><br />",0!=(256&userinfo.siteadmin)&&(l+='<input type=button class="btn btn-primary btn-sm" value="Trasmissione" title="Invia un avviso a tutti gli utenti di questo gruppo." onclick=showUserBroadcastDialog("'+encodeURIComponentEx(t._id)+'") />'),QH("p51group",l),l="<br />",null==currentUserGroup.membershipType&&0!=(256&userinfo.siteadmin)&&(l+='<button class="btn btn-primary btn-sm me-2 mb-1" onclick="return p51showAddUserDialog()"><i class="fa-solid fa-circle-plus"></i> Aggiungi utenti</button>'),l+='<table class="table table-hover"><tbody><tr class="table-active"><th scope=col>Membri del gruppo</th><th scope=col></th></tr>',1),c=[];for(a in currentUserGroup.links)0!=a.startsWith("user/")&&(s=a.split("/")[2],currentUserGroup.links[a].name&&(s=currentUserGroup.links[a].name),a==userinfo._id&&(s=userinfo.name),c.push({id:a,name:s,rights:currentUserGroup.links[a].rights}));for(a in c.sort(function(e,t){return e.name>t.name?1:e.name<t.name?-1:0}),c){var u="",p=(null==currentUserGroup.membershipType&&(u="<a href=# onclick='return p51deleteUser(event,\""+encodeURIComponentEx(c[a].id)+'")\' title="Rimuovi i diritti utente su questo gruppo di dispositivi" style=cursor:pointer><img src=images/trash.png border=0 height=10 width=10></a>'),EscapeHtml(decodeURIComponent(c[a].name)));l+="<tr "+(d%2==0?"style=background-color:#DDD":"")+'><td><i class="fa-solid fa-user fa-fw" title="Utente"></i>&nbsp;'+(p=null!=users?"<a href=# onclick='gotoUser(\""+encodeURIComponentEx(c[a].id)+"\");haltEvent(event);'>"+p+"</a>":p)+"</td><td><div style=float:right>"+u+"</div></td></tr>",++d}1==d&&(l+="<tr><td><div style=padding:6px>&nbsp;<i>Nessun membro </i><div></div></div></td><td></td></tr>"),l+="</tbody></table><br />";var d=1,m=0,g=!1;for(a in meshes)currentUserGroup._id.split("/")[1]==meshes[a]._id.split("/")[1]&&(m++,null==currentUserGroup.links||null==currentUserGroup.links[a])&&(g=!0);if(0<m&&g&&(l+='<button class="btn btn-primary btn-sm me-2 mb-1"onclick="return p20showAddMeshUserDialog(3)"><i class="fa-solid fa-circle-plus"></i> Aggiungi gruppo di dispositivi</button>'),l+='<table class="table table-hover"><tbody><tr class="table-active"><th scope=col>Gruppi di dispositivi comuni</th><th scope=col></th></tr>',currentUserGroup.links){var v=[];for(a in currentUserGroup.links)a.startsWith("mesh/")&&null!=meshes[a]&&v.push(meshes[a]);for(a in v=getOrderedList(v,"name")){var h=0,f=v[a],u="",x=makeDeviceGroupRightsString(currentUserGroup.links[f._id].rights),k=(userinfo.links&&null!=userinfo.links[f._id]&&null!=userinfo.links[f._id].rights&&(h=userinfo.links[f._id].rights),"<i>Gruppo di dispositivi sconosciuto</i>");f&&(k="<a href=# onclick='gotoMesh(\""+f._id+"\");haltEvent(event);'>"+f.name+"</a>"),0!=(2&h)&&(u="<a href=# onclick='return p51removeMeshFromUserGroup(event,\""+encodeURIComponentEx(f._id)+'")\' title="Rimuovi i diritti del gruppo di utenti su questo gruppo di dispositivi" style=cursor:pointer><i class="fa-solid fa-trash text-danger hoverButton"></i></a>',x='<span style=cursor:pointer onclick=p20showAddMeshUserDialog(3,"'+encodeURIComponentEx(f._id)+'")>'+x+" <img class=hoverButton style=cursor:pointer src=images/link5.png></span>"),l+="<tr "+(++d%2==0?"style=background-color:#DDD":"")+'><td style=width:30%><div title="Gruppo di dispositivi" class=m99></div><div>&nbsp;'+k+"<div></div></div></td><td style=width:70%><div style=float:right>"+u+"</div><div>"+x+"</div></td></tr>"}}if(1==d&&(l+="<tr><td><div style=padding:6px>&nbsp;<i>Nessun gruppo di dispositivi in comune </i><div></div></div></td><td></td></tr>"),d=1,l=l+"</tbody></table>"+"<br />",currentUserGroup._id.split("/")[1]==userinfo._id.split("/")[1]&&(l+='<button class="btn btn-primary btn-sm me-2 mb-1" onclick="return p20showAddMeshUserDialog(7)"><i class="fa-solid fa-circle-plus"></i> Aggiungi dispositivo</button>'),l+='<table class="table table-hover"><tbody><tr class="table-active"><th scope=col>Dispositivi comuni</th><th scope=col></th></tr>',currentUserGroup.links){var b=[];for(a in currentUserGroup.links)a.startsWith("node/")&&null!=(y=getNodeFromId(a))&&b.push(y);for(a in b=getOrderedList(b,"name")){var y=b[a],u="",x=makeUserDeviceRightsString(currentUserGroup.links[y._id].rights),h=GetNodeRights(y),w="<i>Dispositivo sconosciuto</i>";y&&(w="<a href=# onclick='gotoDevice(\""+y._id+"\");haltEvent(event);'>"+y.name+"</a>"),0!=(2&h)&&(u="<a href=# onclick='return p51removeDeviceFromUserGroup(event,\""+encodeURIComponentEx(y._id)+'")\' title="Rimuovi i diritti del gruppo di utenti su questo dispositivo" style=cursor:pointer><img src=images/trash.png border=0 height=10 width=10></a>',x='<span style=cursor:pointer onclick=p20showAddMeshUserDialog(7,"'+encodeURIComponentEx(y._id)+'")>'+x+" <img class=hoverButton style=cursor:pointer src=images/link5.png></span>"),l+="<tr "+(++d%2==0?"style=background-color:#DDD":"")+'><td style=width:30%><div title="Gruppo di dispositivi" class=m99></div><div>&nbsp;'+w+"<div></div></div></td><td style=width:70%><div style=float:right>"+u+"</div><div>"+x+"</div></td></tr>"}}1==d&&(l+="<tr><td><div style=padding:6px>&nbsp;<i>Nessun dispositivo in comune </i><div></div></div></td><td></td></tr>"),l+="</tbody></table>",null!=currentUserGroup.membershipType&&0!=i||0==(256&userinfo.siteadmin)||(l+="<div style=font-size:small;text-align:right><span><a href=# onclick=p51showDeleteUserGroupDialog() style=cursor:pointer>Elimina gruppo utenti</a></span></div>"),QH("p51group2",l),go(51);var C="";if(0==(268435456&features)&&51<=xxcurrentView&&xxcurrentView<=59&&null!=currentUserGroup){for(var a in C="?viewmode="+xxcurrentView+"&gotougrp="+(serverinfo.crossDomain?currentUserGroup._id:currentUserGroup._id.split("/")[2]),urlargs)C+="&"+a+"="+urlargs[a];try{window.history.replaceState({},document.title,window.location.pathname+C)}catch(e){}}}}}function p51edituserGroupFeatures(){var e,t;xxdialogMode||(e=currentUserGroup.flags||0,t="",1==serverinfo.userGroupsSessionRecording&&(t+='<div><label><input type=checkbox class="form-check-input me-2" id=d51flag1 '+(2&e?"checked":"")+">Registra sessioni</label><br></div>"),xxdialogButtons=3,setModalContent("xxAddAgent","Modifica le caratteristiche del gruppo di utenti",t),showModal("xxAddAgentModal","idx_dlgOkButton",p51edituserGroupFeaturesEx))}function p51edituserGroupFeaturesEx(){var e=0;1==serverinfo.userGroupsSessionRecording&&Q("d51flag1").checked&&(e+=2),meshserver.send({action:"editusergroup",ugrpid:currentUserGroup._id,flags:e})}function p51removeDeviceFromUserGroup(e,t){var i;xxdialogMode||null!=(i=getNodeFromId(decodeURIComponent(t)))&&(setModalContent("xxAddAgent","Rimuovi i permessi del dispositivo",format('Confermare la rimozione dei diritti di accesso per il dispositivo "{0}"?',i.name)),showModal("xxAddAgentModal","idx_dlgOkButton",()=>p51removeDeviceFromUserGroupEx(3,i._id)))}function p51removeDeviceFromUserGroupEx(e,t){meshserver.send({action:"adddeviceuser",nodeid:t,userids:[currentUserGroup._id],rights:0,remove:!0})}function p51removeMeshFromUserGroup(e,t){var i;xxdialogMode||null!=(i=meshes[decodeURIComponent(t)])&&(setModalContent("xxAddAgent","Rimuovere i permessi del gruppo di dispositivi",format('Confermare la rimozione dei diritti di accesso per il gruppo di dispositivi "{0}"?',i.name)),showModal("xxAddAgentModal","idx_dlgOkButton",()=>p51removeMeshFromUserGroupEx(3,i._id)))}function p51editgroup(e,t){xxdialogMode||(t=addHtmlFormFloating("Nome",'<input id=dp51name class="form-control" maxlength=32 onchange=p51editgroupValidate() onkeyup=p51editgroupValidate(event) '+(t?"readonly disabled":"")+"/>"),t+=addHtmlFormFloating("Descrizione",'<textarea id=dp51desc class="form-control" maxlength=1024 style=width:100%;resize:none></textarea>'),xxdialogButtons=3,setModalContent("xxAddAgent","Modifica gruppo utenti",t),showModal("xxAddAgentModal","idx_dlgOkButton",p51editgroupEx),Q("dp51name").value=currentUserGroup.name,currentUserGroup.desc&&(Q("dp51desc").value=currentUserGroup.desc),p51editgroupValidate(),(2==e?Q("dp51desc"):Q("dp51name")).focus())}function p51editgroupEx(){meshserver.send({action:"editusergroup",ugrpid:currentUserGroup._id,name:Q("dp51name").value,desc:Q("dp51desc").value})}function p51editgroupValidate(e){QE("idx_dlgOkButton",0<Q("dp51name").value.length),e&&"Enter"==e.key&&Q("dp51desc").focus()}function p51showDeleteUserGroupDialog(){var e;return xxdialogMode||(e=format("Eliminare il gruppo di utenti {0}?",EscapeHtml(currentUserGroup.name))+"<br /><br />",xxdialogButtons=3,setModalContent("xxAddAgent","Elimina gruppo utenti",e+='<label><input id=p51check type=checkbox class="form-check-input me-2" onchange=p51validateDeleteGroupDialog() />Confermare</label>'),showModal("xxAddAgentModal","idx_dlgOkButton",function(){p51showDeleteUserGroupDialogEx(xxdialogButtons,xxdialogTag)}),p51validateDeleteGroupDialog()),!1}function p51validateDeleteGroupDialog(){QE("idx_dlgOkButton",Q("p51check").checked)}function p51showDeleteUserGroupDialogEx(e,t){meshserver.send({action:"deleteusergroup",ugrpid:currentUserGroup._id})}function p51deleteUser(e,t){return haltEvent(e),p51viewuserEx(2,decodeURIComponent(t)),!1}function p51viewuserEx(e,t){2==e&&(e=t.split("/")[2],users&&users[t]&&(e=users[t].name),userinfo._id==t&&(e=userinfo.name),setModalContent("xxAddAgent","Rimuovere l'appartenenza dell'utente",format("Confermare la rimozione dell'iscrizione dell'utente \"{0}\"?",EscapeHtml(decodeURIComponent(e)))),showModal("xxAddAgentModal","idx_dlgOkButton",p51viewuserEx2(3,t)))}function p51viewuserEx2(e,t){meshserver.send({action:"removeuserfromusergroup",ugrpid:currentUserGroup._id,userid:t})}function p51showAddUserDialog(){var e;return xxdialogMode||(e="Consenti agli utenti di gestire questo gruppo di dispositivi e i dispositivi in ​​questo gruppo.",524288&features&&(e+=" Gli utenti devono accedere a questo server una volta prima di poter essere aggiunti a un gruppo di dispositivi."),setModalContent("xxAddAgent","Aggiungi utenti al gruppo utenti",e=(e=(e+="<br /><br /><div style='position:relative'>")+addHtmlFormFloating("Identificatori utente ",'<input id=dp51username maxlength=32 class="form-control" onchange=p51validateAddUserDialog() onkeyup=p51validateAddUserDialog() placeholder="user1, user2, user3" />'))+"<div id=dp51usersuggest class=suggestionBox style='top:30px;left:130px;display:none'></div>"+"</div><br>"),showModal("xxAddAgentModal","idx_dlgOkButton",function(){p51showAddUserDialogEx(3,xxdialogTag)}),Q("dp51username").focus(),p51validateAddUserDialog()),!1}function p51setname(e){e=decodeURIComponent(e);var t,i=Q("dp51username").value.split(",");for(t in i)i[t]=i[t].trim();return i[i.length-1]=e,Q("dp51username").value=i.join(", "),p51validateAddUserDialog(),!1}function p51validateAddUserDialog(){var e=!0;if(Q("dp51username")){var t=Q("dp51username").value.split(",");for(l in t){var i=t[l]=t[l].trim();(0==i.length||0<=i.indexOf('"'))&&(e=!1)}var o=!1,n=!1;if(null!=users){var a=t[t.length-1].trim(),s=a.toLowerCase(),r=[];if(0<a.length){for(var l in users){var d=users[l]._id.split("/");if(currentUserGroup.domain==d[1]&&d[2]===s){n=!0;break}if(0<=users[l].name.toLowerCase().indexOf(s)&&currentUserGroup.domain==d[1]&&(r.push([users[l]._id,users[l].name]),8<=r.length))break}if(0==n&&0<r.length){var c="";for(l in r){var u=r[l][0],p=r[l][1];u.split("/")[2]==p.toLowerCase()?c+="<div class=suggestionBoxItem onclick='p51setname(\""+encodeURIComponentEx(u.split("/")[2])+"\")'>"+EscapeHtml(p)+"</div>":c+="<div class=suggestionBoxItem onclick='p51setname(\""+encodeURIComponentEx(u.split("/")[2])+"\")'><div>"+EscapeHtml(p)+"</div><div class=suggestionBoxSubItem>"+EscapeHtml(u.split("/")[2])+"</div></div>"}QH("dp51usersuggest",c),o=!0}}}QV("dp51usersuggest",o)}QE("idx_dlgOkButton",e)}function p51showAddUserDialogEx(e,t){if(null==t){var i,o=Q("dp51username").value.split(","),n=[];for(i in o)n.push(o[i].trim());meshserver.send({action:"addusertousergroup",ugrpid:currentUserGroup._id,usernames:n})}else meshserver.send({action:"addusertousergroup",ugrpid:currentUserGroup._id,usernames:[t.split("/")[2]]})}var currentUser=null;function gotoUser(e,t,i){if((!xxdialogMode||t)&&(null==i||null==i.originalTarget||null==i.originalTarget.href)){var o=currentUser=users[decodeURIComponent(e)];if(null==o)go(4);else{QH("p30userName",EscapeHtml(o.name)),QH("p31userName",EscapeHtml(o.name));var t=o._id==userinfo._id,i=0,e=(null!=wssessions&&wssessions[o._id]&&(i=wssessions[o._id]),null!=o.flags&&1&o.flags?(QV("MainUserImage",!1),QV("MainUserImageEx",!0),null==o.accountImageRnd&&(o.accountImageRnd=Math.floor(9999999999*Math.random())),Q("MainUserImageEx").src="userimage.ashx?id="+o._id.split("/")[2]+"&rnd="+o.accountImageRnd):(Q("MainUserImage").classList.remove("gray"),0==i&&Q("MainUserImage").classList.add("gray"),QV("MainUserImage",!0),QV("MainUserImageEx",!1)),o._id.split("/")[2]),e=(e.startsWith("~twitter:")?(QV("p30userAuthServiceLogo",!0),Q("p30userAuthServiceLogo").src="images/login/twitter64.png"):e.startsWith("~google:")?(QV("p30userAuthServiceLogo",!0),Q("p30userAuthServiceLogo").src="images/login/google64.png"):e.startsWith("~github:")?(QV("p30userAuthServiceLogo",!0),Q("p30userAuthServiceLogo").src="images/login/github64.png"):e.startsWith("~azure:")?(QV("p30userAuthServiceLogo",!0),Q("p30userAuthServiceLogo").src="images/login/azure64.png"):e.startsWith("~oidc:")?(QV("p30userAuthServiceLogo",!0),Q("p30userAuthServiceLogo").src="images/login/oidc64.png"):e.startsWith("~jumpcloud:")?(QV("p30userAuthServiceLogo",!0),Q("p30userAuthServiceLogo").src="images/login/jumpcloud64.png"):e.startsWith("~intel:")?(QV("p30userAuthServiceLogo",!0),Q("p30userAuthServiceLogo").src="images/login/intel64.png"):e.startsWith("~:")?(QV("p30userAuthServiceLogo",!0),Q("p30userAuthServiceLogo").src="images/login/generic64.png"):QV("p30userAuthServiceLogo",!1),[]),n="",a=(null!=o.siteadmin&&0!=(32&o.siteadmin)&&4294967295!=o.siteadmin&&(n='<img src="images/padlock12.png" height=12 width=8 title="L\'account è bloccato" style="margin-top:2px" /> ',e.push("Account bloccato")),null==o.siteadmin||0==(4294966047&o.siteadmin)?e.push("Nessun diritto del server"):8==o.siteadmin?e.push("Accesso al file server"):4294967295==o.siteadmin?e.push("Amministratore completo"):e.push("Diritti parziali"),null!=o.siteadmin&&4294967295!=o.siteadmin&&0!=(1216&o.siteadmin)&&e.push("Restrizioni"),"<div style=min-height:80px><table style=width:100%>"),s=(0!=(8&args.hide)&&(a+="<br />"+addDeviceAttribute("Nome",o.name)),o.email?EscapeHtml(o.email):"<i>Non impostato</i>"),r="",l=o.realname?EscapeHtml(o.realname):"<i>Non impostato</i>",d=(serverinfo.emailcheck&&(r=1==o.emailVerified?'<b style=color:green;cursor:pointer title="L\'email è verificata">&#x2713</b> ':'<b style=color:red;cursor:pointer title="Email non verificata">&#x2717;</b> '),serverinfo.crossDomain||0!=debugmode?a=(a+=addDeviceAttribute("Dominio",""!=(d=o._id.split("/")[1])?EscapeHtml(d):"<i>Predefinito</i>"))+addDeviceAttribute("Identificatore utente ",EscapeHtml(o._id)):o.name.toLowerCase()!=o._id.split("/")[2]&&(a+=addDeviceAttribute("Identificatore utente ",EscapeHtml(o._id.split("/")[2]))),""),r=(o.email&&(d=' <a href="mailto:'+EscapeHtml(o.email)+'" \'><i class="fa-solid fa-arrow-up-right-from-square fa-xs"></i></a>'),a=4294967295!=o.siteadmin||4294967295==userinfo.siteadmin?(a+=addDeviceAttribute("E-mail",'<span role=button onclick=p30showUserEmailChangeDialog(event,"'+encodeURIComponentEx(o._id)+'")>'+r+s+d+' <i class="fa-solid fa-pencil fa-xs"></i></span>'))+addDeviceAttribute("Vero nome",'<span role=button onclick=p30showUserRealNameChangeDialog(event,"'+encodeURIComponentEx(o._id)+'")>'+l+' <i class="fa-solid fa-pencil fa-xs"></i></span>'):(a+=addDeviceAttribute("E-mail",r+s+d))+addDeviceAttribute("Vero nome",l),(33554432&features||null!=o.phone)&&(a+=addDeviceAttribute("Numero di telefono","<span role=button onclick=p30editPhone()>"+(o.phone||"<i>Nessuna </i>")+' <i class="fa-solid fa-pencil fa-xs"></i></span>')),(33554432&features2||null!=o.msghandle)&&(a+=addDeviceAttribute("Messaging",'<span role=button onclick=p30editMessaging()><i class="fa-solid fa-comment fa-xs" title="Messaging enabled" style="margin-top:2px"></i> '+(o.msghandle||"<i>Nessuna </i>")+' <i class="fa-solid fa-pencil fa-xs"></i></span>')),[]),c=(1==serverinfo.usersSessionRecording&&o.flags&&2&o.flags&&r.push("Registra sessioni"),o.removeRights&&(0!=(8&o.removeRights)?r.push("Nessun telecomando"):(0!=(65536&o.removeRights)?r.push("Nessun desktop"):0!=(256&o.removeRights)&&r.push("Solo visualizzazione desktop"),0!=(512&o.removeRights)&&r.push("Nessun terminale "),0!=(1024&o.removeRights)&&r.push("Nessun file")),0!=(16&o.removeRights)&&r.push("Nessuna console"),0!=(32768&o.removeRights)&&r.push("Nessuna disinstallazione"),0!=(131072&o.removeRights)&&r.push("Nessun comando a distanza"),0!=(64&o.removeRights)&&r.push("Nessun risveglio"),0!=(262144&o.removeRights))&&r.push("Nessun ripristino/disattivazione"),a=(a+=addDeviceAttribute("Caratteristiche",addLink(r=""==(r=r.join(", "))?"<i>Nessuna </i>":r,"p20edituserfeatures()")))+addDeviceAttribute("Diritti del server","<span role=button onclick='return showUserAdminDialog(event,\""+encodeURIComponentEx(o._id)+"\")'>"+n+e.join(", ")+' <i class="fa-solid fa-pencil fa-xs"></i></span>'),o.quota&&(a+=addDeviceAttribute("Quota server",EscapeHtml(parseInt(o.quota)/1024)+" k")),a+=addDeviceAttribute("Creazione",printDateTime(new Date(1e3*o.creation))),o.login&&(a+=addDeviceAttribute("Ultimo accesso",printDateTime(new Date(1e3*o.login)))),-1==o.passchange?a+=addDeviceAttribute("Password","Verrà modificato al prossimo accesso."):o.passchange&&(a+=addDeviceAttribute("Password",format("Ultima modifica: {0}",printDateTime(new Date(1e3*o.passchange))))),0),s="<i>Nessuna <i>";if(o.links){for(var u in o.links)u.startsWith("mesh/")&&c++;1==c?s="1 gruppo":1<c&&(s=format("{0} gruppi",c))}if(a+=addDeviceAttribute("Gruppi di dispositivi",s),4294967295==userinfo.siteadmin||2&userinfo.siteadmin){var p="<i>Nessuna </i>";if(o.groups)for(var u in p="",o.groups)p+='<span class="tagSpan">'+EscapeHtml(o.groups[u])+"</span>";a+=addDeviceAttribute("Regni amministrativi",addLinkConditional(p,'showUserGroupDialog(event,"'+encodeURIComponentEx(o._id)+'")',4294967295==userinfo.siteadmin||null==userinfo.groups&&userinfo._id!=o._id&&4294967295!=o.siteadmin))}d=[],l=0,r=(o.consent&&(l=o.consent),serverinfo.consent&&(l|=serverinfo.consent),64&l&&8&l?d.push("Prompt desktop + barra degli strumenti"):64&l?d.push("Barra degli strumenti desktop"):8&l?d.push("Prompt del desktop"):1&l&&d.push("Notifica desktop"),16&l?d.push("Prompt del terminale"):2&l&&d.push("Notifica terminale"),32&l?d.push("Prompt file"):4&l&&d.push("Notifica file"),7==l&&(d=["Avvisa sempre"]),a+=addDeviceAttribute("Consenso dell'utente ",addLinkConditional(d=""==(d=(d=56==(56&l)?["Chiedi sempre"]:d).join(", "))?"<i>Nessuna </i>":d,"p20editmeshconsent(2)",!0)),0);if((0<o.otpsecret||0<o.otphkeys||0<o.otpekey||0<o.otpduo)&&(r=1,n=[],0<o.otpsecret&&n.push("App di autenticazione"),0<o.otphkeys&&n.push("Chiave di sicurezza"),0<o.otpekey&&n.push("E-mail"),0<o.otpduo&&n.push("Duo"),0<o.otpkeys&&n.push("Codici di backup"),0<o.otpdev&&n.push("Spinta dispositivo"),null!=o.phone&&67108864&features&&n.push("SMS"),null!=o.msghandle&&67108864&features2&&n.push("Messaging"),a+=addDeviceAttribute("Sicurezza",'<i class="fa-solid fa-key" title="Autenticazione due fattori abilitata" style="margin-top:2px"></i> '+n.join(", "))),a=(a+="</table></div><br />")+('<input type=button class="btn btn-primary btn-sm me-1" value="Appunti " title="Visualizza le note su questo utente " onclick=showNotes(false,"'+encodeURIComponentEx(o._id)+'") />'),o.phone&&33554432&features&&(a+='<input type=button class="btn btn-primary btn-sm me-1" value="SMS" title="Invia un messaggio SMS a questo utente" onclick=showSendSMS("'+encodeURIComponentEx(o._id)+'") />'),o.msghandle&&33554432&features2&&(a+='<input type=button class="btn btn-primary btn-sm me-1" value="Messaggio" title="Send a message to this user" onclick=showSendMessage("'+encodeURIComponentEx(o._id)+'") />'),"string"==typeof o.email&&!0===o.emailVerified&&64&features&&(a+='<input type=button class="btn btn-primary btn-sm me-1" value="E-mail" title="Invia un messaggio di posta elettronica a questo utente" onclick=showSendEmail("'+encodeURIComponentEx(o._id)+'") />'),!t&&(0<i||8&features2&&o.webpush)&&(a=(a+='<input type=button class="btn btn-primary btn-sm me-1" value="Notifica" title="Invia notifica utente" onclick=showUserAlertDialog(event,"'+encodeURIComponentEx(o._id)+'") />')+'<input type=button class="btn btn-primary btn-sm me-1" value="Chat" title="Chat" onclick=userChat(event,"'+encodeURIComponentEx(o._id)+'","'+encodeURIComponentEx(o.name)+'") />',0<i)&&null!=serverinfo&&null!=serverinfo.altmessenging)for(var u in serverinfo.altmessenging){var m=serverinfo.altmessenging[u];null!=m.type&&"user"!=m.type||(a+='<input type=button class="btn btn-primary btn-sm me-1" value="'+EscapeHtml(m.name)+'" onclick=altUserChat(event,"'+encodeURIComponentEx(o._id)+'","'+encodeURIComponentEx(o.name)+'",'+u+") />")}QH("p30html",a),drawUserPermissions();var e=null!=userinfo.siteadmin&&2&userinfo.siteadmin&&4294967295!=o.siteadmin||4294967295==userinfo.siteadmin,g=(a="<div style=float:right;font-size:small>",e&&userinfo._id!=o._id&&(a+="<a href=# style=cursor:pointer onclick='return p30showDeleteUserDialog()' title=\"Rimuovi questo utente\">Elimina utente</a>"),a+="</div><div style=font-size:small>",e&&0==(524288&features)&&"~"!=o._id.split("/")[2][0]&&(a=a+"<a href=# style=cursor:pointer onclick='return p30showUserChangePassDialog("+r+')\' title="Cambia la password per questo utente">Cambia la password</a> <a href=# style=cursor:pointer onclick=\'return p30viewPreviousLogins()\' title="Visualizza gli accessi precedenti per questo utente">Login precedenti</a>'),a+="</div><br>",QH("p30html3",a),a="",1==i?a="1 sessione attiva":1<i&&(a=format("{0} sessioni attive",i)),QH("MainUserState",a),go(30),QH("p31events",""),refreshUsersEvents(),"");if(0==(268435456&features)&&30<=xxcurrentView&&xxcurrentView<=39&&null!=currentUser){for(var u in g="?viewmode="+xxcurrentView+"&gotouser="+(serverinfo.crossDomain?currentUser._id:currentUser._id.split("/")[2]),urlargs)g+="&"+u+"="+urlargs[u];try{window.history.replaceState({},document.title,window.location.pathname+g)}catch(e){}}}}}function p30editPhone(){var e;xxdialogMode||(e=(e='<table style=width:100%><tr><td style=width:56px><img src="images/phone80.png" style=padding:8px>')+'<td style=width:100%;text-align:center>Numero di telefono compatibile con SMS per questo utente.<br />Non lasciare vuoto per nessuno<br /><br /><div style=width:100%;text-align:center>Numero di telefono: <input type=tel pattern="[0-9]" autocomplete="tel" value="'+(currentUser.phone||"")+'" inputmode="tel" maxlength=18 id=d2phoneinput onKeyUp=p30editPhoneValidate() onkeypress="if (event.key==\'Enter\') p30editPhoneValidate(1)"></div></table>',xxdialogButtons=3,xxdialogTag="verifyPhone",setModalContent("xxAddAgent","Notifiche telefoniche",e),showModal("xxAddAgentModal","idx_dlgOkButton",p30editPhoneEx),Q("d2phoneinput").focus(),p30editPhoneValidate())}function p30editMessaging(){var e,t;xxdialogMode||(t="<select id=d2serviceselect style=width:160px;margin-left:8px onchange=p30editMessagingValidate()><option value=0>Nessuna </option>",0!=(1&serverinfo.userMsgProviders)&&(t+="<option value=1>Telegram</option>"),0!=(4&serverinfo.userMsgProviders)&&(t+="<option value=4>Discord</option>"),0!=(8&serverinfo.userMsgProviders)&&(t+="<option value=8>XMPP</option>"),0!=(16&serverinfo.userMsgProviders)&&(t+="<option value=16>CallMeBot</option>"),0!=(32&serverinfo.userMsgProviders)&&(t+="<option value=32>Pushover</option>"),0!=(64&serverinfo.userMsgProviders)&&(t+="<option value=64>ntfy</option>"),0!=(128&serverinfo.userMsgProviders)&&(t+="<option value=128>Zulip</option>"),0!=(256&serverinfo.userMsgProviders)&&(t+="<option value=256>Slack</option>"),e=(e='<table style=width:100%><tr><td style=width:56px;vertical-align:top><img src="images/messaging40.png" style=padding:8px>')+"<td style=width:100%>Messaging account for this user.<table style=margin-top:12px><tr><td>Service<td>"+(t+="</select>")+"<tr><td>Handle<td><input maxlength=1024 style=width:160px;margin-left:8px id=d2handleinput onKeyUp=p30editMessagingValidate() onkeypress=\"if (event.key=='Enter') p30editMessagingValidate(1)\"></table>",serverinfo.discordUrl&&(e+="<div id=d2discordurl style=display:none><br /><a href="+serverinfo.discordUrl+' target="_discord">Join this Discord server to receive notifications.</a></div>'),e=(e+='<div id=d2callmebotinfo style=display:none><br /><a href=https://www.callmebot.com/blog/free-api-signal-send-messages/ target="_callmebot">Signal</a>, <a href=https://www.callmebot.com/blog/free-api-whatsapp-messages/ target="_callmebot">Whatsapp</a>, <a href=https://www.callmebot.com/blog/free-api-facebook-messenger/ target="_callmebot">Facebook</a>, <a href=https://www.callmebot.com/blog/telegram-text-messages/ target="_callmebot">Telegram</a></div>')+'<div id=d2pushoverinfo style=display:none><br /><a href=https://pushover.net/ target="_pushover">Information at Pushover.net</a></div><div id=d2ntfyinfo style=display:none><br /><a href="'+(serverinfo.userMsgNftyUrl||"https://ntfy.sh/")+'" target="_ntfy">Free service at ntfy.sh</a></div>',xxdialogButtons=3,xxdialogTag="verifyMessaging",setModalContent("xxAddAgent","Messaging Notifications",e+='<div id=d2slackinfo style=display:none><br /><a href=https://api.slack.com/messaging/webhooks target="_slack">Slack Webhook Setup</a></div>'),showModal("xxAddAgentModal","idx_dlgOkButton",p30editMessagingEx),Q("d2handleinput").focus(),currentUser.msghandle&&(currentUser.msghandle.startsWith("telegram:")&&0!=(1&serverinfo.userMsgProviders)&&(Q("d2serviceselect").value=1,Q("d2handleinput").value=currentUser.msghandle.substring(10)),currentUser.msghandle.startsWith("discord:")&&0!=(4&serverinfo.userMsgProviders)&&(Q("d2serviceselect").value=4,Q("d2handleinput").value=currentUser.msghandle.substring(8)),currentUser.msghandle.startsWith("xmpp:")&&0!=(8&serverinfo.userMsgProviders)&&(Q("d2serviceselect").value=8,Q("d2handleinput").value=currentUser.msghandle.substring(5)),currentUser.msghandle.startsWith("callmebot:")&&0!=(16&serverinfo.userMsgProviders)&&(Q("d2serviceselect").value=16,"signal"==(t=currentUser.msghandle.substring(10).split("|"))[0]&&3==t.length&&(Q("d2handleinput").value="https://api.callmebot.com/signal/send.php?phone="+decodeURIComponent(t[1])+"&apikey="+decodeURIComponent(t[2])),"whatsapp"==t[0]&&3==t.length&&(Q("d2handleinput").value="https://api.callmebot.com/whatsapp.php?phone="+decodeURIComponent(t[1])+"&apikey="+decodeURIComponent(t[2])),"facebook"==t[0])&&2==t.length&&(Q("d2handleinput").value="https://api.callmebot.com/facebook/send.php?apikey="+decodeURIComponent(t[1])),currentUser.msghandle.startsWith("pushover:")&&0!=(32&serverinfo.userMsgProviders)&&(Q("d2serviceselect").value=32,Q("d2handleinput").value=currentUser.msghandle.substring(9)),currentUser.msghandle.startsWith("ntfy:")&&0!=(64&serverinfo.userMsgProviders)&&(Q("d2serviceselect").value=64,Q("d2handleinput").value=currentUser.msghandle.substring(5)),currentUser.msghandle.startsWith("zulip:")&&0!=(128&serverinfo.userMsgProviders)&&(Q("d2serviceselect").value=128,Q("d2handleinput").value=currentUser.msghandle.substring(6)),currentUser.msghandle.startsWith("slack:"))&&0!=(256&serverinfo.userMsgProviders)&&(Q("d2serviceselect").value=256,Q("d2handleinput").value=currentUser.msghandle.substring(6)),p30editMessagingValidate())}function p30editMessagingValidate(e){QE("d2handleinput",0!=Q("d2serviceselect").value),serverinfo.discordUrl&&QV("d2discordurl",4==Q("d2serviceselect").value),QV("d2callmebotinfo",16==Q("d2serviceselect").value),QV("d2pushoverinfo",32==Q("d2serviceselect").value),QV("d2ntfyinfo",64==Q("d2serviceselect").value),QV("d2slackinfo",256==Q("d2serviceselect").value),0==Q("d2serviceselect").value?Q("d2handleinput").placeholder="":4==Q("d2serviceselect").value?Q("d2handleinput").placeholder="Username:0000":8==Q("d2serviceselect").value?Q("d2handleinput").placeholder="username@server.com":16==Q("d2serviceselect").value?Q("d2handleinput").placeholder="https://api.callmebot.com/...":32==Q("d2serviceselect").value?Q("d2handleinput").placeholder="User key":64==Q("d2serviceselect").value?Q("d2handleinput").placeholder="Argomento":128==Q("d2serviceselect").value?Q("d2handleinput").placeholder="username@sample.com":256==Q("d2serviceselect").value?Q("d2handleinput").placeholder="https://hooks.slack.com/...":Q("d2handleinput").placeholder="Nome utente",1==e&&dialogclose(1)}function p30editMessagingEx(){var e=null;""==Q("d2handleinput").value||0==Q("d2serviceselect").value?e="":1==Q("d2serviceselect").value?e="telegram:@"+Q("d2handleinput").value:4==Q("d2serviceselect").value?e="discord:"+Q("d2handleinput").value:8==Q("d2serviceselect").value?e="xmpp:"+Q("d2handleinput").value:16==Q("d2serviceselect").value?e="callmebot:"+Q("d2handleinput").value:32==Q("d2serviceselect").value?e="pushover:"+Q("d2handleinput").value:64==Q("d2serviceselect").value?e="ntfy:"+Q("d2handleinput").value:128==Q("d2serviceselect").value?e="zulip:"+Q("d2handleinput").value:256==Q("d2serviceselect").value&&(e="slack:"+Q("d2handleinput").value),null!=e&&meshserver.send({action:"edituser",id:currentUser._id,msghandle:e})}function p20edituserfeatures(){var e,t,i;xxdialogMode||(e=currentUser.flags||0,t=currentUser.removeRights||0,i=i="",1==serverinfo.usersSessionRecording&&(i+='<div><label><input type=checkbox id=d20flag1 class="form-check-input me-2" onchange=p20edituserfeaturesValidate() '+(2&e?"checked":"")+">Registra sessioni</label><br></div>"),setModalContent("xxAddAgent","Modifica caratteristiche utente",i=(i=(i=(i=(i=i+('<div><label><input type=checkbox id=d20flag7 class="form-check-input me-2" onchange=p20edituserfeaturesValidate() '+(8&t?"checked":"")+">Nessun telecomando</label><br></div>")+('<div style=margin-left:8px><label><input type=checkbox id=d20flag2 class="form-check-input me-2" onchange=p20edituserfeaturesValidate() '+(65536&t?"checked":"")+">Nessun accesso al desktop</label><br></div>"))+('<div style=margin-left:16px><label><input type=checkbox id=d20flag3 class="form-check-input me-2" onchange=p20edituserfeaturesValidate() '+(256&t?"checked":"")+">Solo visualizzazione remota</label><br></div>")+('<div style=margin-left:8px><label><input type=checkbox id=d20flag4 class="form-check-input me-2" onchange=p20edituserfeaturesValidate() '+(512&t?"checked":"")+">Nessun accesso al terminale </label><br></div>"))+('<div style=margin-left:8px><label><input type=checkbox id=d20flag5 class="form-check-input me-2" onchange=p20edituserfeaturesValidate() '+(1024&t?"checked":"")+">Nessun accesso ai file </label><br></div>")+('<div><label><input type=checkbox id=d20flag6 class="form-check-input me-2" onchange=p20edituserfeaturesValidate() '+(16&t?"checked":"")+">Nessuna console agente</label><br></div>"))+('<div><label><input type=checkbox id=d20flag8 class="form-check-input me-2" onchange=p20edituserfeaturesValidate() '+(32768&t?"checked":"")+">Nessuna disinstallazione</label><br></div>")+('<div><label><input type=checkbox id=d20flag9 class="form-check-input me-2" onchange=p20edituserfeaturesValidate() '+(131072&t?"checked":"")+">Nessun comando a distanza</label><br></div>"))+('<div><label><input type=checkbox id=d20flag10 class="form-check-input me-2" onchange=p20edituserfeaturesValidate() '+(64&t?"checked":"")+">Nessun risveglio</label><br></div>")+('<div><label><input type=checkbox id=d20flag11 class="form-check-input me-2" onchange=p20edituserfeaturesValidate() '+(262144&t?"checked":"")+">Nessun ripristino/disattivazione</label><br></div>")),showModal("xxAddAgentModal","idx_dlgOkButton",p20edituserfeaturesEx),p20edituserfeaturesValidate())}function p20edituserfeaturesValidate(){QE("d20flag2",!Q("d20flag7").checked),QE("d20flag3",!Q("d20flag7").checked&&!Q("d20flag2").checked),QE("d20flag4",!Q("d20flag7").checked),QE("d20flag5",!Q("d20flag7").checked)}function p20edituserfeaturesEx(){var e=1&(currentUser.flags||0),t=(1==serverinfo.usersSessionRecording&&Q("d20flag1").checked&&(e+=2),0);Q("d20flag7").checked?t+=8:(Q("d20flag2").checked?t+=65536:Q("d20flag3").checked&&(t+=256),Q("d20flag4").checked&&(t+=512),Q("d20flag5").checked&&(t+=1024)),Q("d20flag6").checked&&(t+=16),Q("d20flag8").checked&&(t+=32768),Q("d20flag9").checked&&(t+=131072),Q("d20flag10").checked&&(t+=64),Q("d20flag11").checked&&(t+=262144),meshserver.send({action:"edituser",id:currentUser._id,flags:e,removeRights:t})}function p30editPhoneValidate(e){var t=""==Q("d2phoneinput").value||isPhoneNumber(Q("d2phoneinput").value);QE("idx_dlgOkButton",t),1==e&&t&&dialogclose(1)}function p30editPhoneEx(){meshserver.send({action:"edituser",id:currentUser._id,phone:Q("d2phoneinput").value})}function p30showUserRealNameChangeDialog(e){return xxdialogMode||(xxdialogButtons=3,setModalContent("xxAddAgent",format("Cambia nome reale per {0}",EscapeHtml(currentUser.name)),'<div class="form-floating mb-2"><input id=dp30realname class="form-control" placeholder="Real Name" maxlength=256 /><label for=dp30realname>Real Name</label></div>'),showModal("xxAddAgentModal","idx_dlgOkButton",p30showUserRealNameChangeDialogEx),Q("dp30realname").focus(),Q("dp30realname").value=currentUser.realname||""),!1}function p30showUserRealNameChangeDialogEx(){meshserver.send({action:"edituser",id:currentUser._id,realname:Q("dp30realname").value})}function p30showUserEmailChangeDialog(e){var t;return xxdialogMode||(t="",t+='<div class="form-floating mb-2"><input id=dp30email class="form-control" maxlength=32 onchange=p30validateEmail() onkeyup=p30validateEmail() placeholder=Email /><label for=dp30email>Email</label></div>',serverinfo.emailcheck&&(t+=addHtmlFormFloating("Stato",'<select id=dp30verified class="form-control" onchange=p30validateEmail()><option value=0>Non verificato</option><option value=1>verificato </option></select>')),setModalContent("xxAddAgent",format("Cambia email per {0}",EscapeHtml(currentUser.name)),t),xxdialogButtons=3,showModal("xxAddAgentModal","idx_dlgOkButton",p30showUserEmailChangeDialogEx),Q("dp30email").focus(),Q("dp30email").value=currentUser.email||"",serverinfo.emailcheck&&(Q("dp30verified").value=currentUser.emailVerified?1:0),p30validateEmail()),!1}function p30validateEmail(){var e=Q("dp30email").value,t=e.split("@"),t=0==e.length||2==t.length&&0<t[0].length&&1<t[1].split(".").length&&2<t[1].length&&e.length<1024&&(e!=userinfo.email||1==serverinfo.emailcheck&&Q("dp30verified").value!=(userinfo.emailVerified?1:0));QE("idx_dlgOkButton",t)}function p30showUserEmailChangeDialogEx(){var e={action:"edituser",id:currentUser._id,email:Q("dp30email").value};serverinfo.emailcheck&&(e.emailVerified=1==Q("dp30verified").value),meshserver.send(e)}function p30viewPreviousLogins(){xxdialogMode||(setModalContent("xxAddAgent","Login precedenti","Loading..."),meshserver.send({action:"previousLogins",userid:currentUser._id}))}function p30showUserChangePassDialog(e){if(!xxdialogMode){var t=(t="")+'<div class="form-floating mb-2"><input id=p4pass1 type=password class="form-control" maxlength=256 onchange=p30showUserChangePassDialogValidate(1) onkeyup=p30showUserChangePassDialogValidate(1) placeholder=Password></input><label for=p4pass1>Password</label></div>'+'<div class="form-floating mb-2"><input id=p4pass2 type=password class="form-control" maxlength=256 onchange=p30showUserChangePassDialogValidate(1) onkeyup=p30showUserChangePassDialogValidate(1) placeholder=Password></input><label for=p4pass2>Confirm Password</label></div>';if(65536&features&&(t+='<div class="form-floating mb-2"><input id=p4hint type=text class="form-control" maxlength=256 placeholder="Password hint"></input><label for=p4hint>Password hint</label></div>'),passRequirements){var i,o=[],n=0;for(i in passRequirements)"reset"!=i&&"hint"!=i&&(o.push(i+":"+passRequirements[i]),n++);0<n&&(t+="<div style=font-size:x-small;padding:6px>"+format("Requisiti: {0}.",o.join(", "))+"</div>")}t+='<div><label><input id=p4resetNextLogin class="form-check-input me-2" type=checkbox />Forza la reimpostazione della password al prossimo accesso.</label></div>',1==e&&(t+='<div><label><input id=p4twoFactorRemove class="form-check-input me-2" type=checkbox />Rimuovi tutta l\'autenticazione del secondo fattore.</label></div>'),setModalContent("xxAddAgent",format("Cambia password per {0}",EscapeHtml(currentUser.name)),t),showModal("xxAddAgentModal","idx_dlgOkButton",function(){p30showUserChangePassDialogEx(3,e)}),p30showUserChangePassDialogValidate(),Q("p4pass1").focus(),-1==currentUser.passchange&&(Q("p4resetNextLogin").checked=!0)}}function p30showUserChangePassDialogValidate(){var e=!0;""==Q("p4pass1").value&&""==Q("p4pass2").value||(Q("p4pass1").value!=Q("p4pass2").value||passRequirements&&0==checkPasswordRequirements(Q("p4pass1").value,passRequirements))&&(e=!1),QE("idx_dlgOkButton",e)}function p30showUserChangePassDialogEx(e,t){var i=!1;1==t&&1==Q("p4twoFactorRemove").checked&&(i=!0),Q("p4pass1").value==Q("p4pass2").value&&(t={action:"changeuserpass",userid:currentUser._id,pass:Q("p4pass1").value,removeMultiFactor:i,resetNextLogin:Q("p4resetNextLogin").checked},65536&features&&(t.hint=Q("p4hint").value),meshserver.send(t))}function p30showDeleteUserDialog(){xxdialogMode||(setModalContent("xxAddAgent",format("Elimina utente {0}",EscapeHtml(currentUser.name)),format("Confermare l'eliminazione dell'utente {0}?",EscapeHtml(currentUser.name))+'<br /><br /><label><input id=p10check type=checkbox class="form-check-input me-2" onchange=p10validateDeleteNodeDialog() />Confermare</label>'),showModal("xxAddAgentModal","idx_dlgOkButton",p30showDeleteUserDialogEx),p10validateDeleteNodeDialog())}function p30showDeleteUserDialogEx(){meshserver.send({action:"deleteuser",userid:currentUser._id,username:currentUser.name})}function drawUserPermissions(){var e=1,t="",i=0,o=!1;for(h in meshes)meshes[h]._id.split("/")[1]==currentUser._id.split("/")[1]&&(i++,null==currentUser.links||null==currentUser.links[h])&&(o=!0);if(0<i&&o&&(t+='<button class="btn btn-primary btn-sm me-2 mb-1" onclick="return p20showAddMeshUserDialog(1)"><i class="fa-solid fa-circle-plus"></i> Aggiungi gruppo di dispositivi</button>'),t+='<table class="table table-hover"><tbody><tr class="table-active"><th scope=col>Gruppi di dispositivi comuni</th><th scope=col></th></tr>',currentUser.links){var n=[];for(h in currentUser.links)h.startsWith("mesh/")&&null!=meshes[h]&&n.push(meshes[h]);for(h in n=getOrderedList(n,"name")){var a,s=0,r=n[h],l="",d=makeDeviceGroupRightsString(g=currentUser.links[r._id].rights);null!=r&&(userinfo.links&&null!=userinfo.links[r._id]&&null!=userinfo.links[r._id].rights&&(s=userinfo.links[r._id].rights),a="<i>Gruppo di dispositivi sconosciuto</i>",r&&(a="<a href=# onclick='gotoMesh(\""+r._id+"\");haltEvent(event);'>"+EscapeHtml(r.name)+"</a>"),currentUser._id!=userinfo._id&&0!=(2&s)&&(l="<a href=# onclick='return p30removeMeshFromUser(event,\""+encodeURIComponentEx(r._id)+'")\' title="Rimuovi i diritti utente su questo gruppo di dispositivi" style=cursor:pointer><img src=images/trash.png border=0 height=10 width=10></a>',d='<span style=cursor:pointer onclick=p20showAddMeshUserDialog(1,"'+encodeURIComponentEx(r._id)+'")>'+d+" <img class=hoverButton style=cursor:pointer src=images/link5.png></span>"),t+="<tr "+(++e%2==0?"style=background-color:#DDD":"")+'><td style=width:30%><div title="Gruppo di dispositivi" class=m99></div><div>&nbsp;'+a+"<div></div></div></td><td style=width:70%><div style=float:right>"+l+"</div><div>"+d+"</div></td></tr>")}}if(1==e&&(t+="<tr><td><div style=padding:6px>&nbsp;<i>Nessun gruppo di dispositivi in comune </i><div></div></div></td><td></td></tr>"),t+="</tbody></table>",null!=usergroups){if(e=1,t+="<br />",0!=(256&userinfo.siteadmin)){var c=0,u=!1;for(h in usergroups)null==usergroups[h].membershipType&&usergroups[h]._id.split("/")[1]==currentUser._id.split("/")[1]&&(c++,null==currentUser.links||null==currentUser.links[h])&&(u=!0);0<c&&u&&(t+='<button class="btn btn-primary btn-sm me-2 mb-1" onclick="return p30showAddUserGroupDialog()"><i class="fa-solid fa-circle-plus"></i> Aggiungi gruppo utenti</button>')}if(t+='<table class="table table-hover"><tbody><tr class="table-active"><th scope=col>Iscrizioni ai gruppi di utenti </th><th scope=col></th></tr>',currentUser.links){var p=[];for(h in currentUser.links)h.startsWith("ugrp/")&&null!=usergroups[h]&&p.push(usergroups[h]);for(h in p=getOrderedList(p,"name")){var m=p[h],g=currentUser.links[p[h]._id].rights,l="",v="<i>Gruppo di utenti sconosciuto</i>";t+="<tr "+(++e%2==0?"style=background-color:#DDD":"")+'><td><div title="Gruppo di utenti " class=m4></div><div>&nbsp;'+(v=null!=m&&(v=EscapeHtml(m.name),null!=usergroups)?"<a href=# onclick='gotoUserGroup(\""+encodeURIComponentEx(p[h]._id)+"\");haltEvent(event);'>"+v+"</a>":v)+"<div></div></div></td><td><div style=float:right>"+(l=null==m.membershipType&&0!=(256&userinfo.siteadmin)?"<a href=# onclick='return p30RemoveUserGroup(event,\""+encodeURIComponentEx(p[h]._id)+'")\' title="Rimuovere l\'appartenenza al gruppo di utenti" style=cursor:pointer><i class="fa-solid fa-trash text-danger hoverButton"></i></a>':l)+"</div></td></tr>"}}1==e&&(t+="<tr><td><div style=padding:6px>&nbsp;<i>Nessuna appartenenza a gruppi di utenti </i><div></div></div></td><td></td></tr>"),t+="</tbody></table>"}if(e=1,t+="<br />",currentUser._id.split("/")[1]==userinfo._id.split("/")[1]&&(t+='<button class="btn btn-primary btn-sm me-2 mb-1" onclick="return p20showAddMeshUserDialog(4)"><i class="fa-solid fa-circle-plus"></i> Aggiungi dispositivo</button>'),t+='<table class="table table-hover"><tbody><tr class="table-active"><th scope=col>Dispositivi comuni</th><th scope=col></th></tr>',currentUser.links){var h,f=[];for(h in currentUser.links)h.startsWith("node/")&&null!=(x=getNodeFromId(h))&&f.push(x);for(h in f.sort(nameSort),f){var x=f[h],g=currentUser.links[x._id].rights,l="",s=GetNodeRights(x),k=(userinfo.links&&null!=userinfo.links[h]&&null!=userinfo.links[h].rights&&(s=userinfo.links[h].rights),x?EscapeHtml(x.name):"<i>Dispositivo sconosciuto</i>");0!=(2&s)&&(l="<a href=# onclick='return p30removeNodeFromUser(event,\""+encodeURIComponentEx(x._id)+'")\' title="Rimuovi i diritti utente su questo gruppo di dispositivi" style=cursor:pointer><img src=images/trash.png border=0 height=10 width=10></a>',d='<span style=cursor:pointer onclick=p20showAddMeshUserDialog(4,"'+encodeURIComponentEx(x._id)+'")>'+makeUserDeviceRightsString(g)+" <img class=hoverButton style=cursor:pointer src=images/link5.png></span>"),k="<a href=# onclick='gotoDevice(\""+x._id+"\",10);haltEvent(event);'>"+k+"</a>",t+="<tr "+(++e%2==0?"style=background-color:#DDD":"")+'><td style=width:30%><div title="Dispositivo" class=si'+x.icon+"></div><div>&nbsp;"+k+"<div></div></div></td><td style=width:70%><div style=float:right>"+l+"</div><div>"+d+"</div></td></tr>"}}1==e&&(t+="<tr><td><div style=padding:6px>&nbsp;<i>Nessun dispositivo in comune </i><div></div></div></td><td></td></tr>"),t+="</tbody></table>",QH("p30html2",t)}function p30removeDeviceSharing(e,t,i,o){xxdialogMode||(setModalContent("xxAddAgent","Rimuovi condivisione dispositivo",format('Confermare la rimozione della condivisione del dispositivo "{0}"?',decodeURIComponent(o))),showModal("xxAddAgentModal","idx_dlgOkButton",function(e,t){meshserver.send({action:"removeDeviceShare",nodeid:t[0],publicid:t[1]})},3,[decodeURIComponent(t),decodeURIComponent(i)]))}function p30removeNodeFromUser(e,t){xxdialogMode||(setModalContent("xxAddAgent","Rimuovi i permessi del dispositivo",format('Confermare la rimozione dei diritti di accesso per il dispositivo "{0}"?',(t=getNodeFromId(decodeURIComponent(t))).name)),showModal("xxAddAgentModal","idx_dlgOkButton",function(e,t){meshserver.send({action:"adddeviceuser",nodeid:t._id,nodename:t.name,userids:[currentUser._id],rights:0,remove:!0})},3,t))}function p30removeUserFromNode(e,i){var t,o;xxdialogMode||(t=null,o="",i=decodeURIComponent(i),xxdialogButtons=3,xxdialogTag=t,i.startsWith("user/")?(setModalContent("xxAddAgent","Rimuovere i permessi dell'utente",(o=users&&null!=(t=users[i])?t.name:o)?format('Confermare la rimozione dei diritti di accesso per l\'utente "{0}"?',o):"Confermare la rimozione dei diritti di accesso?"),showModal("xxAddAgentModal","idx_dlgOkButton",function(e,t){meshserver.send({action:"adddeviceuser",nodeid:currentNode._id,nodename:currentNode.name,userids:[i],rights:0,remove:!0})})):i.startsWith("ugrp/")&&(setModalContent("xxAddAgent","Rimuovere i permessi del gruppo di utenti",(o=usergroups&&null!=(t=usergroups[i])?t.name:o)?format('Confermare la rimozione dei diritti di accesso per il gruppo utenti "{0}"?',o):"Confermare la rimozione dei diritti di accesso?"),showModal("xxAddAgentModal","idx_dlgOkButton",function(e,t){meshserver.send({action:"adddeviceuser",nodeid:currentNode._id,nodename:currentNode.name,userids:[i],rights:0,remove:!0})})))}function p30RemoveUserGroup(e,t){var i;xxdialogMode||null==usergroups||(i=decodeURIComponent(t),setModalContent("xxAddAgent","Rimuovere l'appartenenza al gruppo di utenti",format('Confermare la rimozione dell\'appartenenza al gruppo utenti "{0}"?',null!=(t=usergroups[i])?EscapeHtml(t.name):"<i>Sconosciuto</i>")),showModal("xxAddAgentModal","idx_dlgOkButton",function(){p30RemoveUserGroupEx(3,i)}))}function p30RemoveUserGroupEx(e,t){meshserver.send({action:"removeuserfromusergroup",ugrpid:t,userid:currentUser._id})}function p30showAddUserGroupDialog(){if(!xxdialogMode&&null!=usergroups){var e,t="";for(e in usergroups)null!=usergroups[e].membershipType||usergroups[e]._id.split("/")[1]!=currentUser._id.split("/")[1]||null!=currentUser.links&&null!=currentUser.links[e]||(t+="<option value="+encodeURIComponentEx(e)+">"+EscapeHtml(usergroups[e].name)+"</option>");var i=addHtmlFormFloating("Gruppo di utenti ",'<select id=dp2groupid class="form-select">'+t+"</select>");return xxdialogButtons=3,setModalContent("xxAddAgent","aggiungere l'appartenenza",i),showModal("xxAddAgentModal","idx_dlgOkButton",p30showAddUserGroupDialogEx),Q("dp2groupid").focus(),!1}}function p30showAddUserGroupDialogEx(){meshserver.send({action:"addusertousergroup",ugrpid:decodeURIComponent(Q("dp2groupid").value),usernames:[currentUser._id.split("/")[2]]})}function p30removeMeshFromUser(e,t){var i;xxdialogMode||null!=(i=meshes[decodeURIComponent(t)])&&(setModalContent("xxAddAgent","Rimuovere i permessi del gruppo di dispositivi",format('Confermare la rimozione dei diritti di accesso per il gruppo di dispositivi "{0}"?',i.name)),showModal("xxAddAgentModal","idx_dlgOkButton",function(){p30removeMeshFromUserEx(3,i._id)}))}function p30removeMeshFromUserEx(e,t){meshserver.send({action:"removemeshuser",meshid:t,userid:currentUser._id})}var currentUserEvents=null;function userEventsUpdate(){if(null!=currentUser){var e="",t=null;for(r in currentUserEvents){var i=currentUserEvents[r],o=new Date(i.time);if(i.msg){null==i.h&&(i.h=Math.random()),printDate(o)!=t&&(null!=t&&(e+="</table>"),e+='<table class="table table-hover p3eventsTable" cellpadding=0 cellspacing=0><tr><td colspan=4 class=DevSt>'+(t=printDate(o))+"</td></tr>");var n,a,s="fa-mobile-screen";if("user"==i.etype&&(s="fa-user"),"server"==i.etype&&(s="fa-server"),null==i.msgid||null==eventsMessageId[i.msgid])n="string"==typeof i.msg?EscapeHtml(i.msg).split("(R)").join("&reg;"):"";else{for(var r in n=eventsMessageId[i.msgid],i.msgArgs){var l=i.msgArgs[r];"string"==typeof l&&0==l.indexOf("DATETIME:")&&(l=printFlexDateTime(new Date(parseInt(l.substring(9))))),n=n.split("{"+r+"}").join(l)}n=EscapeHtml(n).split("(R)").join("&reg;")}i.nodeid&&null!=(a=getNodeFromId(i.nodeid))&&(s="si"+a.icon,n="<a href=# onclick='gotoDevice(\""+i.nodeid+"\",10);haltEvent(event);'>"+EscapeHtml(a.name)+"</a> &rarr; "+n),i.username&&i.username!=currentUser.name?(a="",i.guestname&&(a=' / <span title="Questa è una sessione di condivisione degli ospiti">'+EscapeHtml(i.guestname)+"</span>"),n=2&userinfo.siteadmin&&i.userid?"<a href=# onclick='gotoUser(\""+encodeURIComponentEx(i.userid)+"\");haltEvent(event);'>"+EscapeHtml(i.username)+"</a>"+a+" &rarr; "+n:EscapeHtml(i.guestname)+" &rarr; "+n):i.guestname&&(n='<span title="Questa è una sessione di condivisione degli ospiti">'+EscapeHtml(i.guestname)+"</span> &rarr; "+n),"relay"!=i.etype&&"relaylog"!=i.action||(s="fa-arrow-right-arrow-left"),e+="<tr onclick=showEventDetails("+i.h+',3)  onmouseover=eventMouseHover(this,1) onmouseout=eventMouseHover(this,0) style=cursor:pointer><td style=width:18px><i class="fa-solid '+s+'"></i></td><td class=g1>&nbsp;</td><td class=style10>'+printTime(o)+" - "+n+"</td></tr><tr></tr>"}}null!=t&&(e+="</table>"),""==e&&(e="<br><i>Nessun evento trovato </i><br><br>"),QH("p31events",e)}}function refreshUsersEvents(){""!=p31filterevents.value?meshserver.send({action:"events",limit:parseInt(p31limitdropdown.value),userid:currentUser._id,filter:p31filterevents.value}):meshserver.send({action:"events",limit:parseInt(p31limitdropdown.value),userid:currentUser._id})}var d3filetreelinkpath,p52recordings=null;function updateRecordings(){for(var e=[],t=document.getElementsByClassName("RecordingCheckbox"),i="",o=0;o<t.length;o++)t[o].checked&&e.push(t[o].value);if(null==p52recordings)i+="<div style=width:100%;text-align:center;margin-top:20px><i>Caricamento in corso...</i></div>";else if("number"==typeof p52recordings)i+=1==p52recordings?"<div style=width:100%;text-align:center;margin-top:20px><i>Server is unable to read from the recordings folder.</i></div>":2==p52recordings?"<div style=width:100%;text-align:center;margin-top:20px><i>Server is unable to get recordings from the database.</i></div>":"<div style=width:100%;text-align:center;margin-top:20px><i>An unknown error occured.</i></div>";else if(0==p52recordings.length)i+="<div style=width:100%;text-align:center;margin-top:20px><i>Nessuna registrazione. </i></div>";else{if(i=(i+='<table class="table table-hover" cellpadding=0 cellspacing=0><thead class="text-center"><tr>')+("<th>Sessione</th><th style=width:110px>"+nobreak("Ora di inizio")+"</th><th style=width:110px>Durata</th><th style=width:110px>Dimensione</th></tr></thead><tbody>"),null!=p52recordings){var n=null;for(o in p52recordings){var a=p52recordings[o],s=printDate(new Date(a.time));s!=n&&(i+="<tr><td class=userTableHeader colspan=4>"+(n=s)),i+=addRecordingHtml(o,a)}}i+="</tbody></table>"}QH("p52recordings",i);for(t=document.getElementsByClassName("RecordingCheckbox"),o=0;o<t.length;o++)t[o].checked=0<=e.indexOf(t[o].value);p52updateInfo()}function addRecordingHtml(e,t){var i="",o=(t.lengthTime&&(i=pad2(Math.floor(t.lengthTime/3600))+":"+pad2(Math.floor(t.lengthTime%3600/60))+":"+pad2(Math.floor(t.lengthTime%60))),printTime(new Date(t.time))),n=(t.sessionStart&&(o=printTime(new Date(t.sessionStart))),""),a=(t.size&&(n=format("{0} Kb",Math.round(t.size/1024))),"<i>Sconosciuto</i>"),s=(t.name&&t.meshname&&(a=null!=meshes[t.meshid]?"<a href=# onclick='gotoMesh(\""+t.meshid+"\")'>"+EscapeHtml(t.meshname)+"</a> - <a href=# onclick='gotoDevice(\""+t.nodeid+"\",10)'>"+EscapeHtml(t.name)+"</a>":EscapeHtml(t.meshname)+" - "+EscapeHtml(t.name)),null!=t.userids&&0<t.userids.length&&(1<t.userids.length?a+=" - "+format("{0} users",t.userids.length):a+=(s=null)!=(s=null!=users?users[t.userids[0]]:s)?" - <a href=# onclick='gotoUser(\""+encodeURIComponentEx(t.userids[0])+"\")'>"+EscapeHtml(s.name)+"</a>":" - "+EscapeHtml(t.userids[0].split("/")[2])),1==t.protocol&&(a+=" - Sessione terminale"),2==t.protocol&&(a+=" - Sessione desktop"),5==t.protocol&&(a+=" - Trasferimento di file"),100==t.protocol&&(a+=" - Intel&reg; AMT WSMAN"),101==t.protocol&&(a+=" - Intel&reg; Reindirizzamento AMT"),200==t.protocol&&(a+=" - Messaggero"),""),r="fa-circle-xmark text-danger",t=(1==t.present&&(r="fa-circle-check text-success",s='<div style=cursor:pointer;float:right><a onclick=downloadFile("recordings.ashx?file='+encodeURIComponentEx(t.filename)+'")><i class="fa-fw fa-solid fa-download fa-sm" title="Download Recording"></i></a>&nbsp;</div>',s+='<div style=cursor:pointer;float:right><a href="player.htm?stream='+encodeURIComponentEx(t.filename)+'") rel="noreferrer noopener" target="mcplay-'+encodeURIComponentEx(t.filename)+'"><i class="fa-fw fa-solid fa-play fa-sm" title="Play Recording"></i></a>&nbsp;</div>'),"<tr tabindex=0 onmouseover=userMouseHover2(this,1) onmouseout=userMouseHover2(this,0) onkeypress=\"if (event.key=='Enter') showRecordingDialog(event,'"+e+"')\"><td style=cursor:pointer>");return(t+="<div class=bar style=width:100%>")+"<div></div>"+('<div class=baricon onclick=showRecordingDialog(event,"'+e+'")><i class="fa-fw fa-solid '+r+'"></i></div>')+('<div class=g1 onclick=showRecordingDialog(event,"'+e+'")></div><div class=g2 onclick=showRecordingDialog("'+e+'")></div>')+('<div style=line-height:24px onclick=showRecordingDialog(event,"'+e+'")>'+s+"<div style=font-size:16px>"+a+"</div></div></div><td style=text-align:center>"+o+"<td style=text-align:center>"+i+"<td style=text-align:center>"+n)}function showRecordingDialog(e,t){if(!xxdialogMode&&"IMG"!=e.target.tagName&&"A"!=e.target.tagName){var i=p52recordings[t],o="";if(i.protocol&&(e="Sconosciuto",1==i.protocol&&(e="Terminale"),2==i.protocol&&(e="Desktop"),5==i.protocol&&(e="File"),100==i.protocol&&(e="Intel&reg; AMT WSMAN"),o+=addHtmlValue4("Protocollo",e=101==i.protocol?"Intel&reg; Reindirizzamento AMT":e)),o+=addHtmlValue4("Stato",1==i.present?"Presente sul server":"Non sul server "),i.name&&(o+=addHtmlValue4("Nome del dispositivo",EscapeHtml(i.name))),i.meshname&&(o+=addHtmlValue4("Gruppo di dispositivi",EscapeHtml(i.meshname))),i.size&&(o+=addHtmlValue4("Dimensione",format("{0} byte",i.size))),i.startTime&&(o+=addHtmlValue4("Ora di inizio",printTime(new Date(i.startTime)))),i.time&&(o+=addHtmlValue4("Tempo scaduto",printTime(new Date(i.time)))),i.lengthTime&&(o+=addHtmlValue4("Durata",pad2(Math.floor(i.lengthTime/3600))+":"+pad2(Math.floor(i.lengthTime%3600/60))+":"+pad2(Math.floor(i.lengthTime%60)))),1==i.multiplex&&(o+=addHtmlValue4("Multiplexor","Abilitato")),i.userids)for(var t in i.userids)o+=addHtmlValue4("Utente",i.userids[t].split("/")[2]);xxdialogButtons=9,setModalContent("xxAddAgent","Dettagli di registrazione",o),showModal("xxAddAgentModal","idx_dlgOkButton",null)}}function refreshRecodings(){meshserver.send({action:"recordings",limit:1e3})}function openRecodringPlayer(){xxdialogMode||safeNewWindow(window.location.origin+"{{{domainurl}}}player.htm","meshcentral-deskplayer")}function p52updateInfo(){for(var e=document.getElementsByClassName("RecordingCheckbox"),t=0;t<e.length;t++)!0===e[t].checked&&0}function d3init(){d3fileoptions={dialog:1,filter:"d3filter",files:"d3serverfiles",folderup:"p3FolderUp",currentFolder:"p3CurrentFolder",func:d3setActions},Q("d3localFile").value="",Q("d3localFile").accept=Q("d3filter").value,d3modechange()}function d3modechange(){var e=Q("d3uploadMode").value;QV("d3localmode",1==e),QV("d3servermode",2==e),(1==e?d3setActions:d3updatefiles)()}var d3filetreelocation=[],d3fileoptions=null;function d3updatefiles(){if(null!=d3fileoptions&&("d3filter"!=d3fileoptions.filter||1!=Q("d3uploadMode").value)){for(var e,t="",i="",o=filetree,n=1,a="",s=[],r=[],l=document.getElementsByName("fc"),d=0;d<l.length;d++)l[d].checked&&r.push(l[d].value);for(d in d3filetreelinkpath="",d3filetreelocation){if(null==o.f||null==o.f[d3filetreelocation[d]])break;s.push(d3filetreelocation[d]),1==n?(e=d3filetreelocation[d].split("/"),window.location.origin,e[0],d3filetreelocation[d]===userinfo._id?d3filetreelinkpath+="self":d3filetreelinkpath+=e[0]+"/"+e[2]):""!=d3filetreelinkpath&&(d3filetreelinkpath+="/"+d3filetreelocation[d],2<n)&&d3filetreelocation[d],a=(o=o.f[d3filetreelocation[d]]).n,n++}d3filetreelocation=s;var c=p5sort_files(o.f),u="";for(d in d3fileoptions.filter&&(u=Q(d3fileoptions.filter).value),c){var p,m,g=c[d],v=g.n;3==g.t&&""!=u&&0==g.nx.toLowerCase().endsWith(u)||(v=70<v.length?'<span title="'+EscapeHtml(v)+'">'+EscapeHtml(v.substring(0,70))+"...</span>":EscapeHtml(v),p="",null!=g.s&&(p=getFileSizeStr(g.s)),m="",m=3!=g.t?'<div class=filelist file=999><span style=float:right title=""></span><span><div class=fileIcon'+g.t+' onclick=d3folderset("'+encodeURIComponentEx(g.nx)+'")></div>&nbsp;<a href=# style=cursor:pointer onclick=\'return d3folderset("'+encodeURIComponentEx(g.nx)+"\")'>"+v+"</a></span></div>":(v=v,'<div class=filelist file=3><input style=float:left name=fcx class="fcb form-check-input me-2" type=checkbox onchange=d3setActions() value="'+g.nx+'">&nbsp;<span style=float:right>'+EscapeHtml(p)+"</span><span><div class=fileIcon"+g.t+"></div>"+v+"</span></div>"),g.t<3?t+=m:i+=m)}d3fileoptions.currentFolder&&QH(d3fileoptions.currentFolder,a),QH(d3fileoptions.files,t+i),QE(d3fileoptions.folderup,0<d3filetreelocation.length),d3fileoptions.func&&d3fileoptions.func()}}function d3folderset(e){return d3filetreelocation.push(decodeURIComponent(e)),d3updatefiles(),!1}function d3folderup(e){if(null==e)d3filetreelocation.pop();else for(;d3filetreelocation.length>e;)d3filetreelocation.pop();d3updatefiles()}function d3getFileSel(){for(var e=[],t=document.getElementsByName("fcx"),i=0;i<t.length;i++)t[i].checked&&e.push(t[i].value);return e}function d3setActions(){1==d3fileoptions.dialog?1==Q("d3uploadMode").value?QE("idx_dlgOkButton",0<Q("d3localFile").value.length):QE("idx_dlgOkButton",1==d3getFileSel().length):2==d3fileoptions.dialog&&QE("idx_dlgOkButton",1==d3getFileSel().length)}var reportCSV=null;function generateReportDialog(){if(!xxdialogMode){var e="",t="",i=JSON.parse(getstore("_ReportSettings","{}")),o={1:"Sessioni remote",2:"Utilizzo del traffico degli utenti",3:"Accesso utenti"};for(n in 4294967295==userinfo.siteadmin&&(o[4]="Database Records"),o)e+="<option value="+n+(i.type==n?" selected":"")+">"+o[n]+"</option>";t=t+addHtmlFormFloating("Digita",'<select id=d2reportType class="form-select" onchange=generateReportDialogValidate()>'+e+"</select>")+"<div id=d2GroupByDiv style=display:none>",e="";for(n in o={1:"Utente",2:"Dispositivo",3:"Giorno"})e+="<option value="+n+(i.groupBy==n?" selected":"")+">"+o[n]+"</option>";for(n in t=(t+=addHtmlFormFloating("Raggruppa per",'<select id=d2groupBy class="form-select" onchange=generateReportDialogValidate()>'+e+"</select>"))+"</div>"+"<div id=d2GroupByDiv2 style=display:none>",e="",o={1:"Utente",3:"Giorno"})e+="<option value="+n+(i.groupBy2==n?" selected":"")+">"+o[n]+"</option>";t=(t+=addHtmlFormFloating("Raggruppa per",'<select id=d2groupBy2 class="form-select" onchange=generateReportDialogValidate()>'+e+"</select>"))+"</div>"+"<div id=d2DeviceGroupDiv style=display:none>",e="<option value=0"+(0==i.devGroup?" selected":"")+">Tutti</option>";var n,a=getOrderedList(meshes,"name");for(n in a)e+="<option value="+encodeURIComponentEx(a[n]._id)+(i.devGroup==a[n]._id?" selected":"")+">"+EscapeHtml(a[n].name)+"</option>";for(n in t=(t+=addHtmlFormFloating("Gruppo di dispositivi",'<select onchange=generateReportDialogValidate() id=d2groupId class="form-select">'+e+"</select>"))+"</div>"+"<div id=d2timeBackDiv style=display:none>",e="",null==i.timeRange&&(i.timeRange=1),o={1:"Ultimo giorno",7:"Ultimi 7 giorni",30:"Ultimi 30 giorni",0:"Intervallo di tempo"})e+="<option value="+n+(i.timeRange==n?" selected":"")+">"+o[n]+"</option>";setModalContent("xxAddAgent","Genera rapporto",t=(t=(t=(t=(t+=addHtmlFormFloating("Tempo",'<select id=d2timeRange class="form-select" onchange=generateReportDialogValidate()>'+e+"</select>"))+"</div>"+"<div id=d2timeRangeDiv style=display:none>")+addHtmlFormFloating("Intervallo di tempo",'<input id=d2timeRangeSelector class="flatpickr form-control" type="text" placeholder="Seleziona data e ora..." data-id="altinput">'))+"</div>"+"<div id=d2showTrafficDiv style=display:none>")+addHtmlValue("",'<div style=width:250px><label><input type=checkbox class="form-check-input me-2" id=d2showTraffic '+(i.showTraffic?"checked":"")+">Mostra traffico</label><div>")+"</div>"),showModal("xxAddAgentModal","idx_dlgOkButton",generateReportDialogEx),generateReportDialogValidate();t=new Date,t=(t.setDate(t.getDate()-7),flatpickr("#d2timeRangeSelector",{mode:"range",enableTime:!0,maxDate:new Date,defaultDate:[t,new Date],minuteIncrement:1}));xxdialogTag=t}}function generateReportDialogValidate(){QV("d2timeRangeDiv",0==Q("d2timeRange").value),QV("d2timeBackDiv",4!=Q("d2reportType").value),QV("d2GroupByDiv",1==Q("d2reportType").value),QV("d2GroupByDiv2",3==Q("d2reportType").value),QV("d2DeviceGroupDiv",1==Q("d2reportType").value),QV("d2showTrafficDiv",1==Q("d2reportType").value)}function generateReportDialogEx(e,t){var i,o=0==Q("d2timeRange").value?(i=Math.floor(t.selectedDates[1].getTime()/1e3),Math.floor(t.selectedDates[0].getTime()/1e3)):(i=Math.floor(new Date/1e3),o=new Date,Math.floor(o.setDate(o.getDate()-Q("d2timeRange").value)/1e3)),t=null;try{t=Intl.DateTimeFormat().resolvedOptions().timeZone}catch(e){}var n=decodeURIComponent(Q("d2groupId").value),a=(0==n&&(n=null),putstore("_ReportSettings",JSON.stringify({type:parseInt(Q("d2reportType").value),groupBy:parseInt(Q("d2groupBy").value),groupBy2:parseInt(Q("d2groupBy2").value),timeRange:parseInt(Q("d2timeRange").value),devGroup:n,showTraffic:Q("d2showTraffic").checked})),parseInt(Q("d2groupBy").value));3==Q("d2reportType").value&&(a=parseInt(Q("d2groupBy2").value)),meshserver.send({action:"report",type:parseInt(Q("d2reportType").value),groupBy:a,start:o,end:i,tz:t,tf:(new Date).getTimezoneOffset(),l:getLang(),devGroup:n,showTraffic:Q("d2showTraffic").checked})}function renderReport(e){var t={time:"Tempo",device:"Dispositivo",session:"Sessione",user:"Utente",devgroup:"Gruppo di dispositivi",guest:"Ospite",length:"Lunghezza",bytesin:"Byte dentro",bytesout:"Byte in uscita",os:"Sistema operativo",ip:"Indirizzo IP",browser:"Browser",msg:"Messaggio",twofactor:"2° fattore"},i='<table class="table table-hover">',o=null,n=[];if(0==Object.keys(e.groups).length)reportCSV=null,QV("p60downloadReportDiv",!1),i+="<tr><td style=text-align:center;padding-top:32px>Il rapporto non ha restituito l'intero.</tr></td>";else{for(var a in reportCSV='"Gruppo"',i+="<tr>",e.columns){var s=null!=t[e.columns[a].title]?t[e.columns[a].title]:EscapeHtml(e.columns[a].title),r="";e.columns[a].align?r+=";text-align:"+EscapeHtml(e.columns[a].align):r+=";text-align:left",0!=a||"datetime"!=e.columns[a].format&&"time"!=e.columns[a].format||(r+=";width:1%"),i+="<th style="+r+">"+s+"</th>",reportCSV+=',"'+csvClean(s)+'"'}for(var a in i+="</tr>",reportCSV+="\r\n",e.groups)for(var l in i=(i+="<tr style=height:8px></tr>")+("<tr><td colspan="+e.columns.length+' style="border-bottom:1pt solid black"><b>'),0!=a&&(i+=renderReportFormat(a,e.groupFormat)),i+="</b></td></tr>",e.groups[a].entries){var d,c=e.groups[a].entries[l];for(d in i+="<tr>",reportCSV+=0!=a?'"'+csvClean(renderReportFormatCSV(a,e.groupFormat))+'"':'""',e.columns){var u,p,r="";null!=e.columns[d].format&&(r="white-space:nowrap;"),e.columns[d].align&&(r="text-align:"+EscapeHtml(e.columns[d].align)),null!=c[e.columns[d].id]?(i+='<td style="'+r+'">'+renderReportFormat(c[e.columns[d].id],e.columns[d].format)+"</td>",reportCSV+=',"'+csvClean(renderReportFormatCSV(c[e.columns[d].id],e.columns[d].format))+'"'):(i+="<td></td>",reportCSV+=","),null!=e.columns[d].sumBy&&(u=c[e.columns[d].sumBy],!0===e.columns[d].sumBy&&(u=!0),p=c[e.columns[d].id],o=e.columns[d].sumBy,null!=p)&&(-1==n.indexOf(u)&&n.push(u),null==e.columns[d].subtotals&&(e.columns[d].subtotals={},e.columns[d].totals={}),null==e.columns[d].subtotals[u]?e.columns[d].subtotals[u]=p:e.columns[d].subtotals[u]+=p,null==e.columns[d].totals[u]?e.columns[d].totals[u]=p:e.columns[d].totals[u]+=p)}i+="</tr>",reportCSV+="\r\n"}if(null!=o){var m=-1;if(!0===o)m=99999;else for(var a in e.columns)e.columns[a].id==o&&(m=a);if(0<=m){n.sort();var g=!0;for(l in i+="<tr style=height:8px></tr>",n){for(var a in i+="<tr>",e.columns)a==m?(r="",e.columns[d].align&&(r+=";text-align:"+EscapeHtml(e.columns[d].align)),g&&(r+=";border-top:1pt solid #777"),i+='<td style="color:#777'+r+'">'+renderReportFormat(n[l],e.columns[a].format)):null!=e.columns[a].totals?(r="",e.columns[d].align&&(r+=";text-align:"+EscapeHtml(e.columns[d].align)),g&&(r+=";border-top:1pt solid #777"),i+='<td style="color:#777'+r+'">'+renderReportFormat(e.columns[a].totals[n[l]],e.columns[a].format)):i+="<td></td>";i+="</tr>",g=!1}}}QV("p60downloadReportDiv",!0)}i+="</table>",QH("p60report",i)}function renderReportFormat(e,t){if(null==e)return"";if("datetime"==t)return printDateTime(new Date(e));if("time"==t)return printTime(new Date(e));if("protocol"==t)return 1==e?"Terminale":2==e?"Desktop":5==e?"File":100==e?"AMT-WSMAN":101==e?"AMT-Redir":200==e?"Messaggero":201==e?"Web-RDP":202==e?"Web-SSH":203==e?"Web-SFTP":204==e?"Web-VNC":"Sconosciuto ("+e+")";if("seconds"==t)return s=e%60,a=60&Math.floor(e/60),n=Math.floor(e/3600),zeroPad(n,2)+":"+zeroPad(a,2)+":"+zeroPad(s,2);if("node"==t)return null!=(o=getNodeFromId(e))?"<div onclick='gotoDevice(\""+o._id+'",10);haltEvent(event);\' style=float:left;margin-right:4px class="j'+o.icon+'"></div>'+EscapeHtml(o.name):"<i>Sconosciuto</i>";if("mesh"==t)return null!=(i=meshes[e])?"<div onclick='gotoMesh(\""+i._id+'",10);haltEvent(event);\' style=float:left;margin-right:4px;cursor:pointer class="m99"></div>'+EscapeHtml(i.name):"<i>Sconosciuto</i>";if("nodemesh"==t){var i,o,n=null,a=null,s=e.split("/"),r="<table><tr>";if(3<=s.length&&(n=s[0]+"/"+s[1]+"/"+s[2]),null!=(a=6<=s.length?s[3]+"/"+s[4]+"/"+s[5]:a)){if(null==(i=meshes[a]))return"<i>Sconosciuto</i>";r+="<td><div onclick='gotoMesh(\""+i._id+'",10);haltEvent(event);\' style=float:left;margin-right:4px;cursor:pointer class="m99"></div>'+EscapeHtml(i.name)+"&nbsp;&nbsp;&nbsp;</td>"}return null==(o=getNodeFromId(n))?"<i>Sconosciuto</i>":r=r+("<td><div onclick='gotoDevice(\""+o._id+'",10);haltEvent(event);\' style=float:left;margin-right:4px class="j'+o.icon+'"></div>'+EscapeHtml(o.name)+"</td>")+"</tr></table>"}if("user"==t)return s=null,e==userinfo._id?s=userinfo:null!=users&&(s=users[e]),null!=s?(a=s.name,null!=s.realname&&(a+=", "+s.realname),"<div onclick='gotoUser(\""+s._id+'",10);haltEvent(event);\' style=float:left;margin-right:4px;cursor:pointer><i class="fa-solid fa-user-circle"></i></div>'+EscapeHtml(a)):"<i>Utente sconosciuto</i>";if("msg"==t){if(107==e)return'<div style=float:left;margin-right:4px;cursor:pointer><i class="fa-solid fa-check-circle text-success"></i></div>Accesso riuscito';if(108==e)return'<div style=float:left;margin-right:4px;cursor:pointer class="NotifyIconTiny2"></div>2° fattore errato';if(109==e)return'<div style=float:left;margin-right:4px;cursor:pointer class="NotifyIconTiny4"></div>Account bloccato';if(110==e)return'<div style=float:left;margin-right:4px;cursor:pointer><i class="fa-solid fa-exclamation-triangle text-warning"></i></div>Tentativo di accesso non valido'}if("2fa"==t){if(""==e)return"Nessuna ";if("backup"==e)return"Codici di backup";if("fido"==e)return"Chiave FIDO";if("sms"==e)return"messaggio SMS";if("hwotp"==e)return"OTP hardware";if("messenger"==e)return"Messenging";if("push"==e)return"Notifica push";if("otp"==e)return"Password monouso";if("cookie"==e)return"Ricorda dispositivo";if("tokenlogin"==e)return"Token di accesso";if("ipaddr"==e)return"Indirizzo IP";if("sso"==e)return"Accesso singolo"}return"records"==t?null!=(i={node:"Device record",mesh:"Device group record",user:"User records",sysinfo:"Device information records",iploc:"IP location information records",note:"Text notes records",ifinfo:"Network interface information records",cfile:"Configuration file records",lastconnect:"Last connection time records",power:"Device power transition records",events:"Event records",serverstats:"Server statistics records",ugrp:"User group records",deviceshare:"Device sharing records",logintoken:"Account login token records",smbios:"Device SMBIOS record",pmt:"Device Push Notification Record",meshcentral:"Device, users, groups and other records"})[e]?i[e]:e:EscapeHtml(e)}function renderReportFormatCSV(e,t){if("datetime"==t)return printDateTime(new Date(e));if("time"==t)return printTime(new Date(e));if("protocol"==t)return 1==e?"Terminale":2==e?"Desktop":5==e?"File":"Sconosciuto";if("node"==t){var i=getNodeFromId(e);if(null!=i)return i.name}if("mesh"==t){i=meshes[e];if(null!=i)return i.name}var o;if("user"==t)return i=null,e==userinfo._id?i=userinfo:null!=users&&(i=users[e]),null!=i?(o=i.name,null!=i.realname&&(o+=" - "+i.realname),o):"Utente sconosciuto";if("msg"==t){if(107==e)return"Accesso riuscito";if(108==e)return"2° fattore errato";if(109==e)return"Account bloccato";if(110==e)return"Tentativo di accesso non valido"}return"records"==t?renderReportFormat(e,t):""+e}function p60downloadReport(){xxdialogMode||null==reportCSV||saveAs(stringToUtf8Blob(reportCSV),"Report.csv")}var notifications=[];function clickNotificationIcon(e){1==e?QV("notifiyBox",!0):0==e?QV("notifiyBox",!1):QV("notifiyBox","none"==QS("notifiyBox").display),drawNotifications()}function setNotificationCount(e){parseInt(Q("notificationCount").innerHTML)!=e&&(QH("notificationCount",e),QS("notificationCount")["background-color"]=0==e?"lightblue":"orange",QV("notificationCount",0<e))}function drawNotifications(){var e=getstore("notifications",0),t="";if(0==notifications.length)t="<div style=margin:5px>Al momento non ci sono notifiche</div>";else for(var i in notifications){var o,i=notifications[i],n="",a=new Date(i.time),s=0;null!=i.title&&(n="<b>"+EscapeHtml(i.title)+"</b>: "),null!=i.nodeid&&null!=(o=getNodeFromId(i.nodeid))&&(s=o.icon,n=16&e?"<b>"+EscapeHtml(meshes[o.meshid].name)+" / "+EscapeHtml(o.name)+"</b>: ":"<b>"+EscapeHtml(o.name)+"</b>: "),t+='<div title="'+format("Si è verificato alle {0} ",printDateTime(a))+'" id="notifyx'+i.id+'" class=notification style="cursor:pointer;border-top:1px solid '+(""==t?"transparent":"orange")+'">',s&&(t+="<div class=j"+s+' onclick="notificationSelected('+i.id+')" style=margin:5px;float:left></div>'),t+='<div onclick="notificationDelete('+i.id+')" class=unselectable title="Cancella questa notifica" style=margin:5px;float:right;color:orange><b>X</b></div><div onclick="notificationSelected('+i.id+')" style=margin:5px>'+n+EscapeHtml(i.text)+"</div><div style=margin-left:5px;margin-bottom:5px;color:gray;font-size:10px>"+printDateTime(a)+"</div></div>"}var r="";1<notifications.length&&(r='<div id="notifyRemoveAll" onclick="deleteAllNotifications()" style="cursor:pointer;border-top:1px solid orange;margin:5px;color:orange;text-align:right;padding-right:3px">Cancella tutto</div>'),QH("notifiyBox",'<div class=customScroll style="max-height:170px;overflow-y:auto;margin:5px">'+t+r+"</div>")}function notificationSelected(e,t){var i,o=-1;for(i in notifications)notifications[i].id==e&&(o=i);-1!=o&&(notificationSelectedEx(notifications[o],e),t)&&notifications[o]&&(notifications[o].notification&&(notifications[o].notification.close(),delete notifications[o].notification),notificationDelete(e))}function notificationSelectedEx(e,t){null!=e.nodeid?"desktop"==e.tag?gotoDevice(e.nodeid,12):"terminal"==e.tag?gotoDevice(e.nodeid,11):"files"==e.tag?gotoDevice(e.nodeid,13):"intelamt"==e.tag?gotoDevice(e.nodeid,14):"console"==e.tag?gotoDevice(e.nodeid,15):gotoDevice(e.nodeid,10):"backupcodes"!=e.tag||xxdialogMode?null!=e.tag&&e.tag.startsWith("meshmessenger/")?(safeNewWindow("/messenger?id="+e.tag+"&title="+encodeURIComponentEx(e.username),e.tag.split("/")[2]),notificationDelete(t)):null!=e.url&&(safeNewWindow(e.url),notificationDelete(t)):(go(2),account_manageOtp(0),notificationDelete(t))}function notificationDelete(e){var t=-1,i=Q("notifyx"+e);if(null!=i){for(var o in notifications)notifications[o].id==e&&(t=o);-1!=t&&(meshserver.send({action:"intersession",subaction:"removeNotify",id:e}),notifications[t].notification&&(notifications[t].notification.close(),delete notifications[t].notification),notifications.splice(t,1),i.parentNode.removeChild(i),setNotificationCount(notifications.length),0==notifications.length&&QV("notifiyBox",!1),1==notifications.length&&QV("notifyRemoveAll",!1),0<notifications.length)&&0==t&&(i=notifications[0],QS("notifyx"+i.id)["border-top"]="1px solid transparent")}}function addNotification(e){if("number"==typeof e.titleid)try{e.title=[null,"Nuovo account ","Limite del server","Avviso di sicurezza","Impostazioni dell 'account","Gruppo di dispositivi","Codici di invito"][e.titleid]}catch(e){}if("number"==typeof e.msgid)try{e.text=[null,"Permesso negato","Nome utente non valido","Password non valida","E-mail non valido","Dominio non valido","Autorizzazioni del sito non valide","L'utente esiste già","Impossibile aggiungere l'utente in questa modalità","Eccezione di convalida ","Limite di account raggiunto.","Richiesta di chat, fare clic qui per accettare.","Ci sono stati {0} tentativi di accesso falliti su questo account dall'ultimo accesso.","Impossibile modificare l'indirizzo email, un altro account che già utilizza: {0}.","Email inviata.","Utente {0} non trovato. ","Utenti {0} non trovati ","Errore, impossibile modificare la password utilizzata in precedenza.","Errore, impossibile modificare la password di uso comune.","Errore, password non modificata.","Password cambiata.","Password attuale non corretta.",'Errore, codice di invito "{0}" già in uso.',"Gateway SMS non abilitato","Nessun diritto di gestione degli utenti ","Messaggio SMS non valido","Nessun numero di telefono per questo utente","SMS succesfully sent.","SMS error","SMS error: {0}",'Il dominio email "{0}" non è consentito. Sono consentiti solo ({1}).',"Invalid message","Message succesfully sent.","Message error","Message error: {0}"][e.msgid],Array.isArray(e.args)&&(e.text=format(e.text,e.args[0],e.args[1],e.args[2],e.args[3],e.args[4],e.args[5]))}catch(e){}null==e.time&&(e.time=Date.now()),null==e.id&&(e.id=Math.random()),notifications.unshift(e),setNotificationCount(notifications.length),clickNotificationIcon(!0);var t,i,o=getstore("notifications",0),n=(1&o&&Q("chimes").play(),null);Notification&&"granted"==Notification.permission&&(t=e.text.split("&reg;").join("").split("<b>").join("").split("</b>").join("").split("<br />").join("\r\n"),e.nodeid?(i=getNodeFromId(e.nodeid))&&(n=16&o?new Notification(decodeURIComponent("{{{extitle}}}")+" - "+meshes[i.meshid].name+" - "+i.name,{tag:e.tag,body:t,icon:"/images/notify/icons128-"+i.icon+".png"}):new Notification(decodeURIComponent("{{{extitle}}}")+" - "+i.name,{tag:e.tag,body:t,icon:"/images/notify/icons128-"+i.icon+".png"})):(null==e.icon&&(e.icon=0),o=null==(o=e.title)?"":" - "+e.title,n=new Notification(decodeURIComponent("{{{extitle}}}")+o,{tag:e.tag,body:t,icon:"/images/notify/icons128-"+e.icon+".png"})),n.id=e.id,n.xtag=e.tag,n.url=e.url,n.nodeid=e.nodeid,n.username=e.username,n.onclick=function(e){notificationSelected(e.target.id,!0)},e.notification=n),"number"==typeof e.maxtime&&0<e.maxtime&&((i=function e(){notificationDelete(e.xid)}).xid=e.id,setTimeout(i,1e3*e.maxtime))}function deleteAllNotifications(){notifications=[],setNotificationCount(0),drawNotifications(),QV("notifiyBox",!1)}function setupGeneralServerStats(){window.serverStatCpu&&window.serverStatCpu.destroy(),window.serverStatMemory&&window.serverStatMemory.destroy(),window.serverStatCpu=new Chart(document.getElementById("serverCpuChart").getContext("2d"),{type:"doughnut",data:{datasets:[{data:[0,0],backgroundColor:["#AAAAAA","#00AA00"]}],labels:["Usato","Libero"]},options:{events:[],responsive:!0,plugins:{legend:{display:!1}},animation:{animateScale:!0,animateRotate:!0},width:"40px"}}),window.serverStatMemory=new Chart(document.getElementById("serverMemoryChart").getContext("2d"),{type:"doughnut",data:{datasets:[{data:[0,0],backgroundColor:["#AAAAAA","#00AA00"]}],labels:["Usato","Libero"]},options:{events:[],responsive:!0,plugins:{legend:{display:!1}},animation:{animateScale:!0,animateRotate:!0},width:"40px"}})}var lastServerStats=null;function updateGeneralServerStats(e){if(null!=e?lastServerStats=e:e=lastServerStats,null!=e){var t,i={ServerState:"Stato del server",AgentErrorCounters:"Contatori errori agente",UnknownGroup:"Gruppo sconosciuto",InvalidPKCSsignature:"Firma PKCS non valida",InvalidRSAsignature:"Firma RSA non valida",InvalidJSON:"JSON non valido",UnknownAction:"Azione sconosciuta",BadWebCertificate:"Certificato Web non valido",BadSignature:"Cattiva firma",MaxSessionsReached:"Numero massimo di sessioni raggiunto",UnknownDeviceGroup:"Gruppo di dispositivi sconosciuto",InvalidDeviceGroupType:"Tipo di gruppo di dispositivi non valido",DuplicateAgent:"Agente duplicato",ConnectedIntelAMT:"Connesso Intel&reg; AMT",RelayErrors:"Errori ritrasmissioni",UserAccounts:"Profili utente",DeviceGroups:"Gruppi di dispositivi",AgentSessions:"Sessioni agente",ConnectedUsers:"Utenti connessi",UsersSessions:"Sessioni utenti",RelaySessions:"Sessioni di ritrasmissione",RelayCount:"Conteggio ritrasmissioni"},o=(setupGeneralServerStats(),"object"==typeof e.cpuavg&&(t=Math.min(e.cpuavg[0],1),window.serverStatCpu.config.data.datasets[0].data=[t,1-t],QH("serverCpuChartText",'<div style=margin-bottom:5px>Carico della CPU</div><div><b title="Carico della CPU nell\'ultimo minuto">'+Math.round(100*e.cpuavg[0])/100+'</b>, <b title="Carico della CPU negli ultimi 5 minuti">'+Math.round(100*e.cpuavg[1])/100+'</b>, <b title="Carico della CPU negli ultimi 15 minuti">'+Math.round(100*e.cpuavg[2])/100+"</b></div>"),QS("serverCpuChartView").display="inline-block",window.serverStatCpu.update()),"number"==typeof e.totalmem&&"number"==typeof e.availablemem?(window.serverStatMemory.config.data.datasets[0].data=[e.totalmem-e.availablemem,e.availablemem],QH("serverMemoryChartText","<div style=margin-bottom:5px>Memoria disponibile</div><div><b>"+getNiceSize3(e.availablemem)+"</b> libero, <b>"+getNiceSize3(e.totalmem)+"</b> totale</div>"),QS("serverMemoryChartView").display="inline-block",window.serverStatMemory.update()):"number"==typeof e.totalmem&&"number"==typeof e.freemem&&(window.serverStatMemory.config.data.datasets[0].data=[e.totalmem-e.freemem,e.freemem],QH("serverMemoryChartText","<div style=margin-bottom:5px>Memoria</div><div><b>"+getNiceSize3(e.freemem)+"</b> libero, <b>"+getNiceSize3(e.totalmem)+"</b> totale</div>"),QS("serverMemoryChartView").display="inline-block",window.serverStatMemory.update()),"<div style=width:100% cellpadding=0 cellspacing=0>");if("object"==typeof e.values)for(var n in e.values)for(var a in o+="<div class=userTableHeader style=margin-bottom:4px;width:200px>"+(i[n]||n)+"</div>",e.values[n])o+='<div style=display:inline-block class="me-2"><table class=serverStateTableCell><tr><td></td><td><span>'+(i[a]||a)+"</span><span style=float:right>"+e.values[n][a]+"</span></td><td></td></tr></table></div>";o+="</div>",QH("serverStatsTable",o)}}var serverTimelineStats=null,serverTimelineConfig={type:"line",data:{labels:[],datasets:[{label:"",backgroundColor:"rgba(255, 99, 132, .5)",borderColor:"rgb(255, 99, 132)",data:[],fill:!0}]},options:{animation:!1,responsive:!0,maintainAspectRatio:!1,elements:{line:{cubicInterpolationMode:"monotone"}},scales:{x:{type:"time",time:{tooltipFormat:"ll HH:mm"},display:!0,title:{display:!1,text:""}},y:{type:"linear",display:!0,title:{display:!0,text:""},stacked:!0}}}};function refreshServerTimelineStats(e){null!=meshserver&&2==meshserver.State&&meshserver.send({action:"servertimelinestats",hours:720})}function pastDate(e){var t=new Date;return t.setTime(t.getTime()-36e5*e),t}function setServerTimelineStats(e){serverTimelineStats=e,updateServerTimelineStats()}function addServerTimelineStats(e){var t;null!=serverTimelineStats&&((t=null)!=Q("p40server").value&&""==(t=decodeURIComponent(Q("p40server").value))&&(t=null),e.s==t)&&(serverTimelineStats.push(e),0==(t=Q("p40type").value)?(serverTimelineConfig.data.datasets[0].data.push({x:e.time,y:e.conn.ca}),serverTimelineConfig.data.datasets[1].data.push({x:e.time,y:e.conn.cu}),serverTimelineConfig.data.datasets[2].data.push({x:e.time,y:e.conn.us}),serverTimelineConfig.data.datasets[3].data.push({x:e.time,y:e.conn.rs}),null!=e.conn.am&&serverTimelineConfig.data.datasets[4].data.push({x:e.time,y:e.conn.am})):1==t?(serverTimelineConfig.data.datasets[0].data.push({x:e.time,y:e.mem.external/1048576}),serverTimelineConfig.data.datasets[1].data.push({x:e.time,y:e.mem.heapUsed/1048576}),serverTimelineConfig.data.datasets[2].data.push({x:e.time,y:e.mem.heapTotal/1048576}),serverTimelineConfig.data.datasets[3].data.push({x:e.time,y:e.mem.rss/1048576})):3==t||4==t?updateServerTimelineStats():5==t&&"object"==typeof e.cpu&&"number"==typeof e.cpu[0]&&serverTimelineConfig.data.datasets[0].data.push({x:e.time,y:e.cpu[0]}),updateServerTimelineHours())}function updateServerTimelineHours(){serverTimelineConfig.options.scales.y.type=Q("p40log").checked?"logarithmic":"linear",serverTimelineConfig.options.scales.x.min=pastDate(Q("p40time").value),window.serverMainStats.update()}function setupServerTimelineStats(){window.serverMainStats=new Chart(document.getElementById("serverMainStats").getContext("2d"),serverTimelineConfig)}let trafficSeriesNames=["Agente","CIRA","AMT-OS","HTTP","Ritrasmissioni","Terminale","Desktop","File","WebRDP","WebSSH","WebVNC","Desktop Multiplex"],seriesColors=[[158,151,16],[16,84,158],[255,99,132],[39,158,16],[134,16,158],[0,148,255],[255,216,0],[255,127,237],[109,213,255],[89,94,255],[179,104,255],[179,104,255]];function seriesColor1(e){return"rgba("+(seriesColors[e][0]+(255-seriesColors[e][0])/1.5)+","+(seriesColors[e][1]+(255-seriesColors[e][1])/1.5)+","+(seriesColors[e][2]+(255-seriesColors[e][2])/1.5)+")"}function seriesColor2(e){return"rgba("+seriesColors[e][0]+","+seriesColors[e][1]+","+seriesColors[e][2]+")"}function updateServerTimelineStats(){if(null!=serverTimelineStats){var e=Q("p40type").value,t=pastDate(Q("p40time").value),i=[],o=null,n=!1,a=!0;if(null!=Q("p40server").value&&(""==(o=decodeURIComponent(Q("p40server").value))&&(o=null),a=!1),serverTimelineConfig.options.scales.x.min=t,serverTimelineConfig.options.scales.y.stacked=3==e||4==e,0==e){serverTimelineConfig.options.scales.y.title.text="Conteggio connessioni";for(var s={labels:[pastDate(0),t],datasets:[{label:"Agenti",data:[],backgroundColor:"rgba(158, 151, 16, .1)",borderColor:"rgb(158, 151, 16)",fill:!0},{label:"Utenti ",data:[],backgroundColor:"rgba(16, 84, 158, .1)",borderColor:"rgb(16, 84, 158)",fill:!0},{label:"Sessioni utente",data:[],backgroundColor:"rgba(255, 99, 132, .1)",borderColor:"rgb(255, 99, 132)",fill:!0},{label:"Sessioni di ritrasmissione",data:[],backgroundColor:"rgba(39, 158, 16, .1)",borderColor:"rgb(39, 158, 16)",fill:!0},{label:"Intel AMT",data:[],backgroundColor:"rgba(134, 16, 158, .1)",borderColor:"rgb(134, 16, 158)",fill:!0}]},r=0;r<serverTimelineStats.length;r++){new Date(serverTimelineStats[r].time);null!=serverTimelineStats[r].s&&-1==i.indexOf(serverTimelineStats[r].s)&&(i.push(serverTimelineStats[r].s),a)&&(o=serverTimelineStats[r].s,a=!1),null==serverTimelineStats[r].s&&(n=!0),serverTimelineStats[r].s==o&&(1==serverTimelineStats[r].first&&(s.datasets[0].data.push({x:serverTimelineStats[r].time-1,y:NaN}),s.datasets[1].data.push({x:serverTimelineStats[r].time-1,y:NaN}),s.datasets[2].data.push({x:serverTimelineStats[r].time-1,y:NaN}),s.datasets[3].data.push({x:serverTimelineStats[r].time-1,y:NaN}),s.datasets[4].data.push({x:serverTimelineStats[r].time-1,y:NaN})),serverTimelineStats[r].conn&&(s.datasets[0].data.push({x:serverTimelineStats[r].time,y:serverTimelineStats[r].conn.ca}),s.datasets[1].data.push({x:serverTimelineStats[r].time,y:serverTimelineStats[r].conn.cu}),s.datasets[2].data.push({x:serverTimelineStats[r].time,y:serverTimelineStats[r].conn.us}),s.datasets[3].data.push({x:serverTimelineStats[r].time,y:serverTimelineStats[r].conn.rs}),null!=serverTimelineStats[r].conn.am))&&s.datasets[4].data.push({x:serverTimelineStats[r].time,y:serverTimelineStats[r].conn.am})}}else if(1==e){serverTimelineConfig.options.scales.y.title.text="Megabyte",s={labels:[pastDate(0),t],datasets:[{label:"Esterno",data:[],backgroundColor:"rgba(158, 151, 16, .1)",borderColor:"rgb(158, 151, 16)",fill:!0},{label:"Heap usato",data:[],backgroundColor:"rgba(16, 84, 158, .1)",borderColor:"rgb(16, 84, 158)",fill:!0},{label:"Totale heap",data:[],backgroundColor:"rgba(255, 99, 132, .1)",borderColor:"rgb(255, 99, 132)",fill:!0},{label:"RSS",data:[],backgroundColor:"rgba(39, 158, 16, .1)",borderColor:"rgb(39, 158, 16)",fill:!0}]};for(r=0;r<serverTimelineStats.length;r++)null!=serverTimelineStats[r].s&&-1==i.indexOf(serverTimelineStats[r].s)&&(i.push(serverTimelineStats[r].s),a)&&(o=serverTimelineStats[r].s,a=!1),null==serverTimelineStats[r].s&&(n=!0),serverTimelineStats[r].s==o&&(1==serverTimelineStats[r].first&&(s.datasets[0].data.push({x:serverTimelineStats[r].time-1,y:NaN}),s.datasets[1].data.push({x:serverTimelineStats[r].time-1,y:NaN}),s.datasets[2].data.push({x:serverTimelineStats[r].time-1,y:NaN}),s.datasets[3].data.push({x:serverTimelineStats[r].time-1,y:NaN})),s.datasets[0].data.push({x:serverTimelineStats[r].time,y:serverTimelineStats[r].mem.external/1048576}),s.datasets[1].data.push({x:serverTimelineStats[r].time,y:serverTimelineStats[r].mem.heapUsed/1048576}),s.datasets[2].data.push({x:serverTimelineStats[r].time,y:serverTimelineStats[r].mem.heapTotal/1048576}),s.datasets[3].data.push({x:serverTimelineStats[r].time,y:serverTimelineStats[r].mem.rss/1048576}))}else if(3==e||4==e){serverTimelineConfig.options.scales.y.title.text="Megabyte",s={labels:[pastDate(0),t],datasets:[]};for(var l=0,r=0;r<serverTimelineStats.length;r++)null!=serverTimelineStats[r].traffic&&(null!=serverTimelineStats[r].s&&-1==i.indexOf(serverTimelineStats[r].s)&&(i.push(serverTimelineStats[r].s),a)&&(o=serverTimelineStats[r].s,a=!1),null==serverTimelineStats[r].s&&(n=!0),serverTimelineStats[r].s==o)&&serverTimelineStats[r].traffic&&(0<serverTimelineStats[r].traffic.AgentCtrlIn&&(l|=1),0<serverTimelineStats[r].traffic.CIRAIn&&(l|=2),0<serverTimelineStats[r].traffic.LMSIn&&(l|=4),0<serverTimelineStats[r].traffic.httpIn&&(l|=8),serverTimelineStats[r].traffic.relayIn&&(0<serverTimelineStats[r].traffic.relayIn[0]&&(l|=16),0<serverTimelineStats[r].traffic.relayIn[1]&&(l|=32),0<serverTimelineStats[r].traffic.relayIn[2]&&(l|=64),0<serverTimelineStats[r].traffic.relayIn[5]&&(l|=128),0<serverTimelineStats[r].traffic.relayIn[10]&&(l|=256),0<serverTimelineStats[r].traffic.relayIn[11]&&(l|=512),0<serverTimelineStats[r].traffic.relayIn[12])&&(l|=1024),serverTimelineStats[r].traffic.desktopMultiplex)&&0<serverTimelineStats[r].traffic.desktopMultiplex.in&&(l|=2048);for(r=0;r<13;r++)l&1<<r&&s.datasets.push({label:trafficSeriesNames[r],data:[],backgroundColor:seriesColor1(r),borderColor:seriesColor2(r),fill:!0,steppedLine:!0});for(r=0;r<serverTimelineStats.length;r++)if(null!=serverTimelineStats[r].traffic&&(null!=serverTimelineStats[r].s&&-1==i.indexOf(serverTimelineStats[r].s)&&(i.push(serverTimelineStats[r].s),a)&&(o=serverTimelineStats[r].s,a=!1),null==serverTimelineStats[r].s&&(n=!0),serverTimelineStats[r].s==o)){if(1==serverTimelineStats[r].first)for(var d=1;d<61440;d<<=1)l&d&&s.datasets[0].data.push({x:serverTimelineStats[r].time-1,y:NaN});var c=0;3==e?(1&l&&s.datasets[c++].data.push({x:serverTimelineStats[r].time,y:serverTimelineStats[r].traffic.AgentCtrlIn?serverTimelineStats[r].traffic.AgentCtrlIn/1048576:0}),2&l&&s.datasets[c++].data.push({x:serverTimelineStats[r].time,y:serverTimelineStats[r].traffic.CIRAIn?serverTimelineStats[r].traffic.CIRAIn/1048576:0}),4&l&&s.datasets[c++].data.push({x:serverTimelineStats[r].time,y:serverTimelineStats[r].traffic.LMSIn?serverTimelineStats[r].traffic.LMSIn/1048576:0}),8&l&&s.datasets[c++].data.push({x:serverTimelineStats[r].time,y:serverTimelineStats[r].traffic.httpIn?serverTimelineStats[r].traffic.httpIn/1048576:0}),16&l&&s.datasets[c++].data.push({x:serverTimelineStats[r].time,y:serverTimelineStats[r].traffic.relayIn&&serverTimelineStats[r].traffic.relayIn[0]?serverTimelineStats[r].traffic.relayIn[0]/1048576:0}),32&l&&s.datasets[c++].data.push({x:serverTimelineStats[r].time,y:serverTimelineStats[r].traffic.relayIn&&serverTimelineStats[r].traffic.relayIn[1]?serverTimelineStats[r].traffic.relayIn[1]/1048576:0}),64&l&&s.datasets[c++].data.push({x:serverTimelineStats[r].time,y:serverTimelineStats[r].traffic.relayIn&&serverTimelineStats[r].traffic.relayIn[2]?serverTimelineStats[r].traffic.relayIn[2]/1048576:0}),128&l&&s.datasets[c++].data.push({x:serverTimelineStats[r].time,y:serverTimelineStats[r].traffic.relayIn&&serverTimelineStats[r].traffic.relayIn[5]?serverTimelineStats[r].traffic.relayIn[5]/1048576:0}),256&l&&s.datasets[c++].data.push({x:serverTimelineStats[r].time,y:serverTimelineStats[r].traffic.relayIn&&serverTimelineStats[r].traffic.relayIn[10]?serverTimelineStats[r].traffic.relayIn[10]/1048576:0}),512&l&&s.datasets[c++].data.push({x:serverTimelineStats[r].time,y:serverTimelineStats[r].traffic.relayIn&&serverTimelineStats[r].traffic.relayIn[11]?serverTimelineStats[r].traffic.relayIn[11]/1048576:0}),1024&l&&s.datasets[c++].data.push({x:serverTimelineStats[r].time,y:serverTimelineStats[r].traffic.relayIn&&serverTimelineStats[r].traffic.relayIn[12]?serverTimelineStats[r].traffic.relayIn[12]/1048576:0}),2048&l&&s.datasets[c++].data.push({x:serverTimelineStats[r].time,y:serverTimelineStats[r].traffic.desktopMultiplex&&serverTimelineStats[r].traffic.desktopMultiplex.in?serverTimelineStats[r].traffic.desktopMultiplex.in/1048576:0})):4==e&&(1&l&&s.datasets[c++].data.push({x:serverTimelineStats[r].time,y:serverTimelineStats[r].traffic.AgentCtrlOut?serverTimelineStats[r].traffic.AgentCtrlOut/1048576:0}),2&l&&s.datasets[c++].data.push({x:serverTimelineStats[r].time,y:serverTimelineStats[r].traffic.CIRAOut?serverTimelineStats[r].traffic.CIRAOut/1048576:0}),4&l&&s.datasets[c++].data.push({x:serverTimelineStats[r].time,y:serverTimelineStats[r].traffic.LMSOut?serverTimelineStats[r].traffic.LMSOut/1048576:0}),8&l&&s.datasets[c++].data.push({x:serverTimelineStats[r].time,y:serverTimelineStats[r].traffic.httpOut?serverTimelineStats[r].traffic.httpOut/1048576:0}),16&l&&s.datasets[c++].data.push({x:serverTimelineStats[r].time,y:serverTimelineStats[r].traffic.relayOut&&serverTimelineStats[r].traffic.relayOut[0]?serverTimelineStats[r].traffic.relayOut[0]/1048576:0}),32&l&&s.datasets[c++].data.push({x:serverTimelineStats[r].time,y:serverTimelineStats[r].traffic.relayOut&&serverTimelineStats[r].traffic.relayOut[1]?serverTimelineStats[r].traffic.relayOut[1]/1048576:0}),64&l&&s.datasets[c++].data.push({x:serverTimelineStats[r].time,y:serverTimelineStats[r].traffic.relayOut&&serverTimelineStats[r].traffic.relayOut[2]?serverTimelineStats[r].traffic.relayOut[2]/1048576:0}),128&l&&s.datasets[c++].data.push({x:serverTimelineStats[r].time,y:serverTimelineStats[r].traffic.relayOut&&serverTimelineStats[r].traffic.relayOut[5]?serverTimelineStats[r].traffic.relayOut[5]/1048576:0}),256&l&&s.datasets[c++].data.push({x:serverTimelineStats[r].time,y:serverTimelineStats[r].traffic.relayOut&&serverTimelineStats[r].traffic.relayOut[10]?serverTimelineStats[r].traffic.relayOut[10]/1048576:0}),512&l&&s.datasets[c++].data.push({x:serverTimelineStats[r].time,y:serverTimelineStats[r].traffic.relayOut&&serverTimelineStats[r].traffic.relayOut[11]?serverTimelineStats[r].traffic.relayOut[11]/1048576:0}),1024&l&&s.datasets[c++].data.push({x:serverTimelineStats[r].time,y:serverTimelineStats[r].traffic.relayOut&&serverTimelineStats[r].traffic.relayOut[12]?serverTimelineStats[r].traffic.relayOut[12]/1048576:0}),2048&l)&&s.datasets[c++].data.push({x:serverTimelineStats[r].time,y:serverTimelineStats[r].traffic.desktopMultiplex&&serverTimelineStats[r].traffic.desktopMultiplex.out?serverTimelineStats[r].traffic.desktopMultiplex.out/1048576:0})}}else if(5==e){serverTimelineConfig.options.scales.y.title.text="Utilizzo",s={labels:[pastDate(0),t],datasets:[{label:"CPU",data:[],backgroundColor:"rgba(158, 151, 16, .1)",borderColor:"rgb(158, 151, 16)",fill:!0}]};for(r=0;r<serverTimelineStats.length;r++)"object"==typeof serverTimelineStats[r].cpu&&"number"==typeof serverTimelineStats[r].cpu[0]&&(null!=serverTimelineStats[r].s&&-1==i.indexOf(serverTimelineStats[r].s)&&(i.push(serverTimelineStats[r].s),a)&&(o=serverTimelineStats[r].s,a=!1),null==serverTimelineStats[r].s&&(n=!0),serverTimelineStats[r].s==o)&&(1==serverTimelineStats[r].first&&s.datasets[0].data.push({x:serverTimelineStats[r].time-1,y:NaN}),s.datasets[0].data.push({x:serverTimelineStats[r].time,y:serverTimelineStats[r].cpu[0]}))}if(serverTimelineConfig.data=s,window.serverMainStats.update(),0<i.length){for(var u="",r=0;r<i.length;r++)u+='<option value="'+encodeURIComponentEx(i[r])+'"'+(o==i[r]?" selected":"")+">"+EscapeHtml(i[r])+"</option>";n&&(u+='<option value=""'+(null==o?" selected":"")+">Nullo</option>"),QH("p40server",u)}QV("p40server",0<i.length)}}function p40downloadEvents(){for(var e="time, conn.agent, conn.users, conn.usersessions, conn.relaysession, conn.intelamt, mem.external, mem.heapused, mem.heaptotal, mem.rss\r\n",t=0;t<serverTimelineStats.length;t++)serverTimelineStats[t].conn&&serverTimelineStats[t].mem&&(e+=new Date(serverTimelineStats[t].time)+", "+serverTimelineStats[t].conn.ca+", "+serverTimelineStats[t].conn.cu+", "+serverTimelineStats[t].conn.us+", "+serverTimelineStats[t].conn.rs+", "+(serverTimelineStats[t].conn.am||"")+", "+serverTimelineStats[t].mem.external+", "+serverTimelineStats[t].mem.heapUsed+", "+serverTimelineStats[t].mem.heapTotal+", "+serverTimelineStats[t].mem.rss+"\r\n");saveAs(stringToUtf8Blob(e),"ServerStats.csv")}var xxdialogMode,xxdialogFunc,xxdialogButtons,xxdialogTag,serverTrace=[],serverTraceSources=[];function displayServerTrace(){var e,t="",i=parseInt(Q("p41limitdropdown").value);for(e in serverTrace.length>i&&serverTrace.splice(i),serverTrace){var o,n=[];for(o in serverTrace[e].args)"object"==typeof serverTrace[e].args[o]?n.push(JSON.stringify(serverTrace[e].args[o])):n.push(serverTrace[e].args[o]);t+="<div class=traceEvent onclick=showTraceEvent("+e+")>"+EscapeHtml(new Date(serverTrace[e].time).toLocaleTimeString())+" - <b>"+EscapeHtml(serverTrace[e].source.toUpperCase())+"</b>: "+EscapeHtml(n.join(", "))+"</div>"}QH("p41events",t)}function showTraceEvent(e){var t=serverTrace[e],i="";if(!xxdialogMode&&null!=t){for(var e in t.args)"object"==typeof t.args[e]?i+=EscapeHtml(JSON.stringify(t.args[e]))+"<br /><br />":i+=EscapeHtml(t.args[e])+"<br /><br />";xxdialogButtons=1,setModalContent("xxAddAgent","Evento di tracciamento del server","<div class=selecttext style=max-height:300px;overflow-y:auto>"+i+"</div>"),showModal("xxAddAgentModal","idx_dlgOkButton",null)}}function clearServerTracing(){serverTrace=[],displayServerTrace()}function setServerTracing(){var e='<div style="max-height:200px;overflow-y:auto">';setModalContent("xxAddAgent","Tracciamento del server",(e+='<div style="width:100%;border-bottom:1px solid gray;margin-bottom:5px;margin-top:5px"><b>Server principale</b></div>')+('<div><label><input type=checkbox class="form-check-input me-2" id=p41c1 '+(0<=serverTraceSources.indexOf("cookie")?"checked":"")+">Codificatore di cookie</label></div>")+('<div><label><input type=checkbox class="form-check-input me-2" id=p41c2 '+(0<=serverTraceSources.indexOf("dispatch")?"checked":"")+">Message Dispatcher</label></div>")+('<div><label><input type=checkbox class="form-check-input me-2" id=p41c3 '+(0<=serverTraceSources.indexOf("main")?"checked":"")+">Messaggi del server principale</label></div>")+('<div><label><input type=checkbox class="form-check-input me-2" id=p41c4 '+(0<=serverTraceSources.indexOf("peer")?"checked":"")+">Peering del server MeshCentral</label></div>")+('<div><label><input type=checkbox class="form-check-input me-2" id=p41c15 '+(0<=serverTraceSources.indexOf("agent")?"checked":"")+">Traffico MeshAgent</label></div>")+('<div><label><input type=checkbox class="form-check-input me-2" id=p41c14 '+(0<=serverTraceSources.indexOf("agentupdate")?"checked":"")+">Aggiornamento MeshAgent</label></div>")+('<div><label><input type=checkbox class="form-check-input me-2" id=p41c16 '+(0<=serverTraceSources.indexOf("cert")?"checked":"")+">Certificato del server</label></div>")+('<div><label><input type=checkbox class="form-check-input me-2" id=p41c17 '+(0<=serverTraceSources.indexOf("db")?"checked":"")+">Database del server</label></div>")+('<div><label><input type=checkbox class="form-check-input me-2" id=p41c18 '+(0<=serverTraceSources.indexOf("email")?"checked":"")+">Email/SMS/Push Traffico</label></div>")+'<div style="width:100%;border-bottom:1px solid gray;margin-bottom:5px;margin-top:5px"><b>Server web</b></div>'+('<div><label><input type=checkbox class="form-check-input me-2" id=p41c5 '+(0<=serverTraceSources.indexOf("web")?"checked":"")+">Server web</label></div>")+('<div><label><input type=checkbox class="form-check-input me-2" id=p41c6 '+(0<=serverTraceSources.indexOf("webrequest")?"checked":"")+">Richieste del server web</label></div>")+('<div><label><input type=checkbox class="form-check-input me-2" id=p41c7 '+(0<=serverTraceSources.indexOf("relay")?"checked":"")+">Rilancio Web Socket</label></div>")+('<div><label><input type=checkbox class="form-check-input me-2" id=p41c20 '+(0<=serverTraceSources.indexOf("httpheaders")?"checked":"")+">Intestazioni HTTP del server Web</label></div>")+('<div><label><input type=checkbox class="form-check-input me-2" id=p41c21 '+(0<=serverTraceSources.indexOf("authlog")?"checked":"")+">User Authentication Log</label></div>")+'<div style="width:100%;border-bottom:1px solid gray;margin-bottom:5px;margin-top:5px"><b>Intel&reg; AMT</b></div>'+('<div><label><input type=checkbox class="form-check-input me-2" id=p41c19 '+(0<=serverTraceSources.indexOf("amt")?"checked":"")+">Gestore Intel AMT</label></div>")+('<div><label><input type=checkbox class="form-check-input me-2" id=p41c9 '+(0<=serverTraceSources.indexOf("webrelay")?"checked":"")+">Rilancio di connessione</label></div>")+('<div><label><input type=checkbox class="form-check-input me-2" id=p41c10 '+(0<=serverTraceSources.indexOf("mps")?"checked":"")+">Server CIRA</label></div>")+('<div><label><input type=checkbox class="form-check-input me-2" id=p41c11 '+(0<=serverTraceSources.indexOf("mpscmd")?"checked":"")+">Comandi server CIRA</label></div>")+"</div>"),showModal("xxAddAgentModal","idx_dlgOkButton",setServerTracingEx)}function setServerTracingEx(){for(var e=[],t=["cookie","dispatch","main","peer","web","webrequest","relay","webrelaydata","webrelay","mps","mpscmd","swarm","swarmcmd","agentupdate","agent","cert","db","email","amt","httpheaders","authlog"],i=1;i<22;i++)try{Q("p41c"+i).checked&&e.push(t[i-1])}catch(e){}meshserver.send({action:"traceinfo",traceSources:e})}function p41downloadServerTrace(){var e,t="time, source, message\r\n";for(e in serverTrace)t+='"'+new Date(serverTrace[e].time).toLocaleTimeString()+'","'+serverTrace[e].source+'","'+serverTrace[e].args.join(", ")+'"\r\n';return saveAs(stringToUtf8Blob(t),"servertrace.csv"),!1}function setupServiceWorker(){0!=(8&features2)&&"string"==typeof serverinfo.vapidpublickey&&null!=Notification&&"granted"==Notification.permission&&"serviceWorker"in navigator&&navigator.serviceWorker.register("serviceworker.js").then(function(e){navigator.serviceWorker.ready.then(function(e){e.pushManager.subscribe({applicationServerKey:urlBase64ToUint8Array(serverinfo.vapidpublickey),userVisibleOnly:!0}).then(function(e){meshserver.send({action:"webpush",sub:e})}).catch(function(e){console.error("Worker: Unable to subscribe to push",e)})})}).catch(function(e){console.log("Worker: Registration failed",e)})}var xxcurrentView=-1;function setDialogMode(e,t,i,o,n,a){setSessionActivity(),QV("uiMenu",!1),xxdialogMode=e,xxdialogFunc=o,xxdialogButtons=i,xxdialogTag=a,QV("id_dialogclose",2&i||8&i),QV("idx_dlgDeleteButton",4&i),QV("idx_dlgButtonBar",7&i),QV("idx_dlgMoreButtons",16&i),t&&QH("xxAddAgentTitle",t);for(var s=1;s<24;s++)QV("dialog"+s,s==e);QV("dialog",e),n&&(2==e?QH("id_dialogOptions",n):QH("id_dialogMessage",n)),0==e&&xxModal&&xxModal.hide(),MoreToggle(!1)}function dialogclose(e){setSessionActivity(),(8&xxdialogButtons||e)&&xxdialogFunc&&xxdialogFunc(e,xxdialogTag)}function center(){setSessionActivity(),11==xxcurrentView?deskAdjust():10==xxcurrentView?mainUpdate(256):1==xxcurrentView&&mainUpdate(4)}function messagebox(e,t){setSessionActivity(),QH("id_dialogMessage",t),setDialogMode(1,e,1)}function statusbox(e,t){setSessionActivity(),QH("id_dialogMessage",t),setDialogMode(1,e)}var backStack=[];function goBack(){setSessionActivity(),xxdialogMode||0==goBackStack.length||(fullscreen&&deskToggleFull(),go(goBackStack.pop()),goBackStack.pop())}function goForward(e){xxdialogMode||(backStack.push(e),goStack())}function goStack(){if(0==backStack.length)go(2);else{var e=backStack[backStack.length-1],t=e.split("/")[0];if("node"==t&&(setupDeviceMenu(0),gotoDevice(e)),"mesh"==t&&gotoMesh(e),"devices"==t&&go(1),"account"==t&&go(2),"events"==t&&go(3),"users"==t&&go(4),"files"==t){if(262144&features&&!(1==userinfo.otpsecret||0<userinfo.otphkeys||0<userinfo.otpkeys||8388608&features&&1==userinfo.otpekey))return void setDialogMode(2,"Sicurezza dell 'Account",1,null,'Unable to access this feature until two-factor authentication is enabled. This is required for extra security. Go to the "My Account" and look at the "Account Security" section.');go(5)}"server"==t&&go(6)}}function go(e,t){if((!t||3!=t.which&&2!=t.button)&&(262144&features&&0==count2factoraAuths()&&2<e&&(e=2,setModalContent("xxAddAgent","Sicurezza dell 'Account",'Unable to access this feature until two - factor authentication is enabled.This is required for extra security.Go to the "My Account" tab and look at the "Account Security" section.'),showModal("xxAddAgentModal","idx_dlgOkButton")),null!=pluginHandler&&pluginHandler.callHook("goPageStart",e,t),setSessionActivity(),!xxdialogMode))if(QV("uiMenu",!1),!t||1!=t.shiftKey&&2!=t.which&&1!=t.button||15==e||""!="{{{currentNode}}}".toLowerCase()){if(xxcurrentView!=e){xxcurrentView<0||e<10?goBackStack=[]:50!=xxcurrentView&&Math.floor(xxcurrentView/10)==Math.floor(e/10)||goBackStack.push(xxcurrentView),11==xxcurrentView&&null!=desktop&&null!=desktop.m.recordedData&&deskRecordSession(),(4==e&&null!=userinfo&&0==(2&userinfo.siteadmin)||0!=(4&features))&&(e=52),17==xxcurrentView&&deviceDetailsStatsClear();for(var i=0;i<61;i++)QV("p"+i,i==e);if(xxcurrentView=e,fullscreen&&deskToggleFull(),0==(268435456&features)&&0<xxcurrentView){var o="";for(i in 10<=xxcurrentView&&xxcurrentView<=19?null!=currentNode&&(o="?viewmode="+xxcurrentView+"&gotonode="+currentNode._id.split("/")[2]):20<=xxcurrentView&&xxcurrentView<=29?null!=currentMesh&&(o="?viewmode="+xxcurrentView+"&gotomesh="+currentMesh._id.split("/")[2]):30<=xxcurrentView&&xxcurrentView<=39?null!=currentUser&&(o="?viewmode="+xxcurrentView+"&gotouser="+(serverinfo.crossDomain?currentUser._id:currentUser._id.split("/")[2])):51<=xxcurrentView&&xxcurrentView<=51?null!=currentUserGroup&&null!=currentUserGroup._id&&(o="?viewmode="+xxcurrentView+"&gotougrp="+(serverinfo.crossDomain?currentUserGroup._id:currentUserGroup._id.split("/")[2])):1<xxcurrentView&&(o="?viewmode="+xxcurrentView),urlargs)o+=(""==o?"?":"&")+i+"="+urlargs[i];try{window.history.replaceState({},document.title,window.location.pathname+o)}catch(e){}}var n=["MainMenuMyDevices","MainMenuMyAccount","MainMenuMyEvents","MainMenuMyFiles","MainMenuMyUsers","MainMenuMyServer"];for(i in n)QC(n[i]).remove("fullselect"),QC(n[i]).remove("semiselect");var a=["LeftMenuMyDevices","LeftMenuMyAccount","LeftMenuMyEvents","LeftMenuMyFiles","LeftMenuMyUsers","LeftMenuMyServer"];for(i in a)QC(a[i]).remove("lbbuttonsel"),QC(a[i]).remove("lbbuttonsel2");var s=e<9?"fullselect":"semiselect",r=e<9||115==e||40==e||41==e||42==e?"lbbuttonsel2":"lbbuttonsel",l=0,d=(0<goBackStack.length&&(l=goBackStack[goBackStack.length-1]),1==e||1==l||0==l&&10<=e&&e<20?(QC("MainMenuMyDevices").add(s),QC("LeftMenuMyDevices").add(r)):2==e||2==l||0==l&&20<=e&&e<30?(QC("MainMenuMyAccount").add(s),QC("LeftMenuMyAccount").add(r)):3==e||60==e?(QC("MainMenuMyEvents").add(s),QC("LeftMenuMyEvents").add(r)):4==e||30<=e&&e<40||50==e||51==e||52==e?(QC("MainMenuMyUsers").add(s),QC("LeftMenuMyUsers").add(r)):5==e?(QC("MainMenuMyFiles").add(s),QC("LeftMenuMyFiles").add(r)):(6==e||115==e||40<=e&&e<50)&&(QC("MainMenuMyServer").add(s),QC("LeftMenuMyServer").add(r)),QV("ServerPlugins",null!=pluginHandler),webPageStackMenu&&10<=e?QC("column_l").add("room4submenu"):QC("column_l").remove("room4submenu"),QV("topbar",0!=e),0==e&&webPageFullScreen&&QC("body").add("arg_hide"),QV("MainSubMenuSpan",10<=e&&e<20),QV("UserDummyMenuSpan",51==e||e<10&&6!=e&&webPageFullScreen),QV("MeshSubMenuSpan",20<=e&&e<30),QV("UserSubMenuSpan",30<=e&&e<40),QV("ServerSubMenuSpan",6==e||115==e||40==e||41==e||42==e||43==e),QV("UsersSubMenuSpan",4==e||50==e||52==e),QV("EventsSubMenuSpan",3==e||60==e),{3:"EventsLive",4:"UsersGeneral",10:"MainDev",11:"MainDevDesktop",12:"MainDevTerminal",13:"MainDevFiles",14:"MainDevAmt",15:"MainDevConsole",16:"MainDevEvents",17:"MainDevInfo",19:"MainDevPlugins",20:"MeshGeneral",21:"MeshSummary",30:"UserGeneral",31:"UserEvents",6:"ServerGeneral",40:"ServerStats",41:"ServerTrace",42:"ServerPlugins",50:"UsersGroups",52:"UsersRecordings",60:"EventsReport",115:"ServerConsole"});for(i in d)QC(d[i]).remove("style3x"),QC(d[i]).remove("style3sel"),QC(d[i]).add(e==i?"style3sel":"style3x");11==e&&deskAdjust(),115==e&&QV("p15",!0),QV("p15uploadCore",115!=e),QV("p15BackButton",115!=e&&0==(32&args.hide)&&""=="{{currentNode}}".toLowerCase()),15!=e&&115!=e||setupConsole(),1==e&&mainUpdate(4),2==e&&Notification&&QV("accountEnableNotificationsSpan","granted"!=Notification.permission),40==e&&null==serverTimelineStats&&refreshServerTimelineStats(),42==e&&refreshPluginLatest(),21==e&&p21updateMesh(),52==e&&(null==p52recordings&&refreshRecodings(),updateRecordings()),12==e&&null!=xtermfit&&(xtermfit.fit(),xterm.focus()),document.title=currentNode&&10<=e&&e<20?currentNode.name+(meshes[currentNode.meshid]?" - "+meshes[currentNode.meshid].name:"")+" - "+decodeURIComponent("{{{extitle}}}"):decodeURIComponent("{{{extitle}}}"),null!=pluginHandler&&pluginHandler.callHook("goPageEnd",e,t),QS("column_l").overflow=0<=[11,12].indexOf(e)?"hidden":null}}else 10<=e&&e<=19?currentNode&&safeNewWindow(window.location.origin+"{{{domainurl}}}?gotonode="+currentNode._id.split("/")[2]+"&viewmode="+e+"&hide=16"+(urlargs.key?"&key="+urlargs.key:""),"meshcentral:"+currentNode._id):20<=e&&e<=29?currentMesh&&safeNewWindow(window.location.origin+"{{{domainurl}}}?gotomesh="+currentMesh._id.split("/")[2]+"&viewmode="+e+"&hide=16"+(urlargs.key?"&key="+urlargs.key:""),"meshcentral:"+currentMesh._id):30<=e&&e<=39?currentUser&&safeNewWindow(window.location.origin+"{{{domainurl}}}?gotouser="+(serverinfo.crossDomain?currentUser._id:currentUser._id.split("/")[2])+"&viewmode="+e+"&hide=16"+(urlargs.key?"&key="+urlargs.key:""),"meshcentral:"+currentUser._id):50<=e&&e<=59?currentUserGroup&&safeNewWindow(window.location.origin+"{{{domainurl}}}?gotougrp="+(serverinfo.crossDomain?currentUserGroup._id:currentUserGroup._id.split("/")[2])+"&viewmode="+e+"&hide=16"+(urlargs.key?"&key="+urlargs.key:""),"meshcentral:"+currentUserGroup._id):safeNewWindow(window.location.origin+"{{{domainurl}}}?viewmode="+e+"&hide=0"+(urlargs.key?"&key="+urlargs.key:""),"meshcentral:"+e)}function updatePluginList(e){if(null!=pluginHandler){if(Array.isArray(e)&&e.forEach(function(e){updatePluginList(e)}),QV("pluginNoneNotice",0==installedPluginList.length),installedPluginList.length){if(null!=e&&(null==installedPluginList.version_info&&(installedPluginList.version_info=[]),installedPluginList.version_info[e.id]=e),(i=Q("p42tbl").querySelectorAll(".p42tblRow")).length)for(var t in Object.values(i))i[t].parentNode.removeChild(i[t]);var s={0:{text:"Disabled",color:"858483"},1:{text:"Installed",color:"00aa00"}},r={0:{install:"Install",delete:"Delete"},1:{disable:"Disable",upgrade:"Upgrade"}},l=Q("p42tbl");installedPluginList.forEach(function(e){var t,i=[],o=(1==e.hasAdminPanel&&e.status?e.nameHtml="<a onclick=\"return goPlugin('"+e.shortName+"', '"+e.name.replace(/'/g,"\\'")+"');\">"+EscapeHtml(e.name)+"</a>":e.nameHtml=EscapeHtml(e.name),e.statusText=s[e.status].text,e.statusColor=s[e.status].color,null==e.versionHistoryUrl&&i.push("downgrade"),e.status||(e.version=" - "),e.upgradeAvail="Controllo ...",null!=installedPluginList.version_info&&null!=installedPluginList.version_info[e._id]&&(!(n=installedPluginList.version_info[e._id]).hasUpdate&&(i.push("upgrade"),e.status)?e.upgradeAvail="Aggiornato":e.upgradeAvail='<a title="Visualizza il registro delle modifiche " rel="noreferrer noopener" target="_blank" href="'+n.changelogUrl+'">'+n.version+"</a>",n.meshCentralCompat||(e.upgradeAvail+=" [ <span onclick=\"return setModalContent('xxAddAgent', 'Compatibility Issue', 'This plugin version is not compatible with your MeshCentral installation, please upgrade MeshCentral first.');showModal('xxAddAgentModal', 'idx_dlgOkButton');\" title=\"Versione incompatibile, aggiornare prima l'installazione di MeshCentral \" style=\"cursor: pointer; color:red;\"> ! </span> ]",i.push("install"),i.push("upgrade"))),e.actions="<select onchange=\"return pluginAction(this,'"+e._id+'\');"><option value=""> --</option>',Object.entries(r[e.status]));for(t in o)-1===i.indexOf(o[t][0])&&(e.actions+='<option value="'+o[t][0]+'">'+o[t][1]+"</option>");e.actions+="</select>";var n="<td><img style=margin-top:3px src=images/plugin24.png></td><td class=gradTable1>&nbsp;</td><td class=gradTable2>"+e.nameHtml+"</td><td class=gradTable2>"+EscapeHtml(e.description)+'</td><td class=gradTable2 style=text-align:center><a href="'+EscapeHtml(e.homepage)+'" rel="noreferrer noopener" target="_blank">Home</a></td><td class=gradTable2 style=text-align:center>'+EscapeHtml(e.version)+'</td><td style=text-align:center class="pluginUpgradeAvailable gradTable2">'+e.upgradeAvail+'</td><td class=gradTable2 style="text-align:center;color:#'+e.statusColor+'">'+e.statusText+'</td><td class="pluginAction gradTable2" style=text-align:center>'+e.actions+"</td><td class=gradTable3>&nbsp;</td>",a=l.insertRow(-1);a.innerHTML=n,a.classList.add("p42tblRow"),a.setAttribute("data-id",e._id),a.setAttribute("id","pluginRow-"+e._id)})}else{var i=Q("p42tbl").querySelectorAll(".p42tblRow");for(t in Object.values(i))i[t].parentNode.removeChild(i[t])}null==e&&refreshPluginLatest()}}function refreshPluginLatest(){null!=pluginHandler&&meshserver.send({action:"pluginLatestCheck"})}function distributeCore(){null!=pluginHandler&&(meshserver.send({action:"distributeCore",nodes:nodes}),QV("pluginRestartNotice",!1))}function pluginActionEx(){if(null!=pluginHandler){var e=Q("lastPluginAct").value,t=Q("lastPluginId").value,i=Q("lastPluginVersion").value;switch(e){case"upgrade":case"install":meshserver.send({action:"installplugin",id:t,version_only:!1});break;case"downgrade":Q("lastPluginVersion").querySelectorAll("option").forEach(function(e){e.value==i&&(pVers=e.text)}),meshserver.send({action:"installplugin",id:t,version_only:{name:pVers,url:i}});break;case"delete":meshserver.send({action:"removeplugin",id:t});break;case"disable":meshserver.send({action:"disableplugin",id:t})}QV("pluginRestartNotice",!0)}}function pluginAction(e,t){if(null!=pluginHandler){if("downgrade"==e.value)meshserver.send({action:"getpluginversions",id:t});else{var i,o=null;for(i in installedPluginList)installedPluginList[i]._id==t&&(o=installedPluginList[i]);setModalContent("xxAddAgent","Azione plug-in",format("Sei sicuro di voler {0} il plug-in: {1}",e.value,o.name)+'<input id="lastPluginAct" type="hidden" value="'+e.value+'" /><input id="lastPluginId" type="hidden" value="'+t+'" /><input id="lastPluginVersion" type="hidden" value="" />'),showModal("xxAddAgentModal","idx_dlgOkButton",()=>pluginActionEx())}e.value=""}}function goPlugin(e,t){null!=pluginHandler&&(null==e?Q("p43iframe").src="":(QH("p43title",t),Q("p43iframe").src="/pluginadmin.ashx?pin="+e,go(43)))}function removeUserRights(e,t){var i;return t==userinfo._id&&null!=userinfo.removeRights&&((i=t=0)!=(8&userinfo.removeRights)&&(i+=8),0!=(65536&userinfo.removeRights)&&(t+=65536),0!=(256&userinfo.removeRights)&&(t+=256),0!=(512&userinfo.removeRights)&&(t+=512),0!=(1024&userinfo.removeRights)&&(t+=1024),0!=(16&userinfo.removeRights)&&(i+=16),0!=(32768&userinfo.removeRights)&&(i+=32768),0!=(131072&userinfo.removeRights)&&(i+=131072),0!=(64&userinfo.removeRights)&&(i+=64),0!=(262144&userinfo.removeRights)&&(i+=262144),e=4294967295!=e?(e|t)&4294967295-i:((e=2015471)|t)&4294967295-i),e}function GetMeshRights(e,t){if(null==e)return 0;if(null==t&&(t=userinfo._id),null==(e="string"==typeof e?meshes[e]:e)||null==e.links)return 0;if(serverinfo.manageAllDeviceGroups&&t==userinfo._id)return removeUserRights(4294967295,t);var i=0,o=e.links[t];if(null!=o){if(4294967295==o.rights)return removeUserRights(4294967295,t);i=o.rights}var n=null;if(t==userinfo._id?n=userinfo:null!=users&&(n=users[t]),null!=n)for(var a in n.links)if(a.startsWith("ugrp/")&&null!=(o=e.links[a])){if(4294967295==o.rights)return removeUserRights(4294967295,t);i|=o.rights}return removeUserRights(i,t)}function IsMeshViewable(e,t){if(null!=e&&(null==t&&(t=userinfo._id),null!=(e="string"==typeof e?meshes[e]:e))&&null!=e.links){if(null!=e.links[t])return!0;if(serverinfo.manageAllDeviceGroups&&t==userinfo._id)return!0;var i=null;if(t==userinfo._id?i=userinfo:null!=users&&(i=users[t]),null!=i)for(var o in i.links)if(o.startsWith("ugrp/")&&null!=e.links[o])return!0}return!1}function GetNodeRights(e,t){if(null==e)return 0;if(null==t&&(t=userinfo._id),"string"==typeof e&&null==(e=getNodeFromId(e)))return 0;var i=GetMeshRights(e.meshid,t);if(4294967295!=i&&(null!=e.links&&null!=e.links[t]&&(i|=e.links[t].rights),null!=e.links)&&null!=userinfo.links)for(var o in e.links)o.startsWith("ugrp/")&&null!=userinfo.links[o]&&null!=e.links[o].rights&&(i|=e.links[o].rights);return removeUserRights(i,t)}function IsNodeViewable(e,t){if(null!=e&&(null==t&&(t=userinfo._id),"string"!=typeof e||null!=(e=getNodeFromId(e)))){if(IsMeshViewable(e.meshid,t))return!0;if(null!=e.links&&null!=e.links[t])return!0;if(null!=e.links&&null!=userinfo.links)for(var i in e.links)if(i.startsWith("ugrp/")&&null!=userinfo.links[i]&&null!=e.links[i].rights)return!0}return!1}if("undefined"==typeof TextEncoder){window.TextEncoder=function(){},TextEncoder.prototype.encode=function(e){for(var t,i=e.length,o=-1,n="undefined"==typeof Uint8Array?new Array(1.5*i):new Uint8Array(3*i),a=0,s=0;s!==i;){if(a=e.charCodeAt(s),s+=1,55296<=a&&a<=56319){if(s===i){n[o+=1]=239,n[o+=1]=191,n[o+=1]=189;break}if(!(56320<=(t=e.charCodeAt(s))&&t<=57343)){n[o+=1]=239,n[o+=1]=191,n[o+=1]=189;continue}if(s+=1,65535<(a=1024*(a-55296)+t-56320+65536)){n[o+=1]=240|a>>>18,n[o+=1]=128|a>>>12&63,n[o+=1]=128|a>>>6&63,n[o+=1]=128|63&a;continue}}a<=127?n[o+=1]=0|a:(a<=2047?n[o+=1]=192|a>>>6:(n[o+=1]=224|a>>>12,n[o+=1]=128|a>>>6&63),n[o+=1]=128|63&a)}return"undefined"!=typeof Uint8Array?n.subarray(0,o+1):(n.length=o+1,n)},TextEncoder.prototype.toString=function(){return"[object TextEncoder]"};try{Object.defineProperty(TextEncoder.prototype,"encoding",{get:function(){if(TextEncoder.prototype.isPrototypeOf(this))return"utf-8";throw TypeError("Illegal invocation")}})}catch(e){TextEncoder.prototype.encoding="utf-8"}"undefined"!=typeof Symbol&&(TextEncoder.prototype[Symbol.toStringTag]="TextEncoder")}function urlBase64ToUint8Array(e){for(var e=(e+"=".repeat((4-e.length%4)%4)).replace(/-/g,"+").replace(/_/g,"/"),t=atob(e),i=new Uint8Array(t.length),o=0;o<t.length;++o)i[o]=t.charCodeAt(o);return i}function joinPaths(){var e,t=[];for(e in arguments){var i=arguments[e];if(null!=i&&""!=i){for(;i.endsWith("/")||i.endsWith("\\");)i=i.substring(0,i.length-1);for(;i.startsWith("/")||i.startsWith("\\");)i=i.substring(1);t.push(i)}}return t.join("/")}function putstore(e,t){try{if("undefined"==typeof localStorage||localStorage.getItem(e)==t)return;null==t?localStorage.removeItem(e):localStorage.setItem(e,t)}catch(e){}if("_"!=e[0]){var i={};try{for(var o=0,n=localStorage.length;o<n;++o){var a=localStorage.key(o);"_"!=a[0]&&(i[a]=localStorage.getItem(a),"desktopsettings"!=a)&&"stars"!=a&&"deskKeyShortcuts"!=a&&"deskStrings"!=a&&"cmdopt"!=a&&"string"==typeof i[a]&&64<i[a].length&&delete i[a]}}catch(e){}meshserver.send({action:"userWebState",state:JSON.stringify(i)})}}function stringToUtf8Blob(e){var t=(new TextEncoder).encode(e),i=new Uint8Array(3+t.length);i[0]=239,i[1]=187,i[2]=191;for(var o=0;o<t.length;o++)i[o+3]=t[o];return new Blob([i],{type:"application/octet-stream"})}function stringToUtf8BlobNoHeader(e){return new Blob([(new TextEncoder).encode(e)],{type:"application/octet-stream"})}function multiTranslate(e){var t=e.indexOf("]|");return e.substring(t+2)}function getLang(){return null!=navigator.languages?navigator.languages[0]:navigator.language}function getNodeAmtVersion(e){return null==e||null==e.intelamt||"string"!=typeof e.intelamt.ver||(e=e.intelamt.ver.split(".")).length<2?0:parseInt(e[0])+parseInt(e[1])/100}function getstore(e,t){try{var i;return"undefined"==typeof localStorage?t:null==(i=localStorage.getItem(e))?t:i}catch(e){return t}}function addLink(e,t){return'<span tabindex=0 role="button" onclick=\''+t+"' onkeypress=\"if (event.key=='Enter') {"+t+'} ">'+e+' <i class="fa-solid fa-pencil fa-xs"></i></span>'}function addLinkConditional(e,t,i){return i?addLink(e,t):e}function addKeyLink(e,t){return"<span tabindex=0 role=button onclick="+t+" onkeypress=\"if (event.key=='Enter') { "+t+' } ">'+e+' <i class="fa-solid fa-key"></i></span>'}function addKeyLinkConditional(e,t,i){return i?"<span title='"+t+"'>"+e+' <i class="fa-solid fa-key"></i></span>':e}function haltEvent(e){return e.preventDefault&&e.preventDefault(),e.stopPropagation&&e.stopPropagation(),!1}function addOption(e,t,i){var o=document.createElement("option");o.text=t,o.value=i,Q(e).add(o)}function passwordcheck(e){return 7<e.length&&/\d/.test(e)&&/[a-z]/.test(e)&&/[A-Z]/.test(e)&&/\W/.test(e)}function methodcheck(e){return!(!e||null==e||!e.Body||"SUCCESS"==e.Body.ReturnValueStr||(messagebox("Errore di chiamata",e.Header.Method+": "+e.Body.ReturnValueStr.replace("_"," ")),0))}function TableStart(){return"<table cellpadding=0 cellspacing=0 style=width:100%;border-radius:8px><tr><td width=200px><p><td>"}function TableStart2(){return"<table cellpadding=0 cellspacing=0 style=width:100%;border-radius:8px><tr><td><p><td>"}function TableEntry(e,t){return"<tr><td><p>"+e+"<td>"+t}function FullTable(e,t){var o=TableStart();for(i in e)i&&e[i]&&(o+=TableEntry(i,e[i]));return o+TableEnd(t)}function TableEnd(e){return"<tr><td colspan=2><p>"+(e||"")+"</table>"}function AddButton(e,t){return'<input type=button value="'+e+'" onclick="'+t+'" style=margin:4px>'}function AddButton2(e,t){return'<input type=button value="'+e+'" onclick="'+t+'">'}function AddRefreshButton(e){return'<input type=button name=refreshbtn value=Refresh onclick="refreshButtons(false);'+e+'" style=margin:4px '+(0==refreshButtonsState?"disabled":"")+">"}function MoreStart(){return"<div id=idx_dlgMoreButtons3 style=display:none><hr>"}function MoreEnd(){return"</div>"}function MoreToggle(e){QV("idx_dlgMoreButtons1",!e),QV("idx_dlgMoreButtons2",e),QV("idx_dlgMoreButtons3",e)}function getSelectedOptions(e){for(var t,i=[],o=0,n=e.options.length;o<n;o++)(t=e.options[o]).selected&&i.push(t.value);return i}function getInstance(e,t){for(var i in e)if(e[i].InstanceID==t)return e[i];return null}function getItem(e,t,i){for(var o in e)if(e[o][t]==i)return e[o];return null}function guidToStr(e){return e.substring(6,8)+e.substring(4,6)+e.substring(2,4)+e.substring(0,2)+"-"+e.substring(10,12)+e.substring(8,10)+"-"+e.substring(14,16)+e.substring(12,14)+"-"+e.substring(16,20)+"-"+e.substring(20)}function getUrlVars(){for(var e,t=[],i=window.location.href.slice(window.location.href.indexOf("?")+1).split("&"),o=0;o<i.length;o++)0<(e=i[o].indexOf("="))&&(t[i[o].substring(0,e)]=i[o].substring(e+1,i[o].length));return t}function addHtmlValue(e,t,i=[]){return`<div class="row mb-1"><div class="${i[0]||"col col-md-2 col-lg-2"}"><b>${e}</b></div><div class="${i[1]||"col col-md-10 col-lg-10"}">${t}</div></div>`}function addHtmlFormFloating(e,t,i=[]){return`<div class="row mb-1"><div class="form-floating mb-3 ${i[0]||"col-md-12"}">${t}<label class="${i[1]||"ms-2"}">${e}</label></div></div>`}function addHtmlValue2(e,t){return"<div><div style=display:inline-block;float:right>"+t+"</div><div style=display:inline-block>"+e+"</div></div>"}function addHtmlValue3(e,t){return"<div><b>"+e+"</b></div><div style=margin-left:16px>"+t+"</div>"}function addHtmlValue4(e,t){return"<table style=width:100%><td style=width:120px>"+e+"<td style=text-align:right><b>"+t+"</b></table>"}function addHtmlValue5(e,t){return"<div style=padding:4px><div style=display:inline-block;float:right><b>"+t+"</b></div><div style=display:inline-block>"+e+"</div></div>"}function focusTextBox(e){setTimeout(function(){Q(e).selectionStart=Q(e).selectionEnd=65535,Q(e).focus()},0)}function validateEmail(e){return/^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/.test(e)}function isPrivateIP(e){return e.startsWith("10.")||e.startsWith("172.16.")||e.startsWith("192.168.")}function u2fSupported(){return window.u2f&&(0<navigator.userAgent.indexOf("Chrome/")||0<navigator.userAgent.indexOf("Firefox/")||0<navigator.userAgent.indexOf("Opera/")||0<navigator.userAgent.indexOf("Safari/"))}function findOne(t,e){return null!=t&&null!=e&&e.some(function(e){return 0<=t.indexOf(e)})}function copyTextToClip(e){var t,i=document.createElement("DIV");i.textContent=e,document.body.appendChild(i),e=i,document.selection?((t=document.body.createTextRange()).moveToElementText(e),t.select()):window.getSelection&&((t=document.createRange()).selectNode(e),window.getSelection().removeAllRanges(),window.getSelection().addRange(t)),document.execCommand("copy"),i.remove()}function copyTextToClip2(e){var t,i=document.createElement("DIV");i.textContent=decodeURIComponent(e),document.body.appendChild(i),e=i,document.selection?((t=document.body.createTextRange()).moveToElementText(e),t.select()):window.getSelection&&((t=document.createRange()).selectNode(e),window.getSelection().removeAllRanges(),window.getSelection().addRange(t)),document.execCommand("copy"),i.remove()}function capitalizeFirstLetter(e){return e.charAt(0).toUpperCase()+e.slice(1)}function printDate(e){return e.toLocaleDateString(args.locale)}function printTime(e){return e.toLocaleTimeString(args.locale)}function printDateTime(e){return e.toLocaleString(args.locale)}function printFlexDateTime(e){return(printDate(new Date)==printDate(e)?printTime:printDateTime)(e)}function addDetailItem(e,t,i,o=[]){return`<div class="row mb-1"><div class="${o[0]||"col-md-8"}"> ${nobreak(e)} </div><div class="${o[1]||"col-md-4 text-end"}"> ${t} </div></div>`}function format(e){var i=Array.prototype.slice.call(arguments,1);return e.replace(/{(\d+)}/g,function(e,t){return void 0!==i[t]?i[t]:e})}function addTextLink(e,t,i){var o=t.toLowerCase().indexOf(e.toLowerCase());return-1==o?t:t.substring(0,o)+'<a href="'+i+'">'+e+"</a>"+t.substring(o+e.length)}function getOrderedList(e,i){var t,o=[];for(t in e)o.push(e[t]);return o.sort(function(e,t){e=e[i].toLowerCase(),t=t[i].toLowerCase();return t<e?1:e<t?-1:0}),o}function capitalizeFirstLetter(e){return e.charAt(0).toUpperCase()+e.slice(1)}function nobreak(e){return e.split(" ").join("&nbsp;")}function pad2(e){e="00"+e;return e.substr(e.length-2)}function encodeURIComponentEx(e){return encodeURIComponent(e).replace(/'/g,"%27")}function getUserName(e){var t=e.split("/"),i=t[0]+"/"+t[1]+"/"+t[2],o="";if(4==t.length&&t[3].startsWith("guest:")&&(o=" - "+decode_utf8(atob(t[3].substring(6)))),users&&null!=users[i])return null!=users[i].realname?users[i].realname+o:users[i].name+o;if(currentNode&&currentNode.links&&currentNode.links[e]&&null!=currentNode.links[e].name)return currentNode.links[e].name+o;if(e==userinfo._id)return userinfo.name+o;if(nodes)for(var n in nodes)if(nodes[n].links)for(var a in nodes[n].links)if(nodes[n].links[a].name&&a==e)return nodes[n].links[a].name+o;return t[2]+o}function round(e,t){t=Math.pow(10,t||0);return Math.round(e*t)/t}function safeNewWindow(e,t){e=window.open(e,t,"noopener,noreferrer");e&&(e.opener=null)}function isWindowsNode(e){return 2==e.mtype&&null!=e.agent&&null!=e.agent.id&&0<=[1,2,3,4,21,22,34,42,43].indexOf(e.agent.id)}function downloadFile(e,t,i){var o=document.createElement("a");o.setAttribute("href",e),o.setAttribute("rel","noreferrer noopener"),o.setAttribute("target","fileDownloadFrame"),o.setAttribute("download",decodeURIComponent(t||"")),document.body.appendChild(o),o.click(),document.body.removeChild(o),i&&setDialogMode(0)}function dialogBoxDrag(){var t=Q("xxAddAgentModal"),i=0,o=0,n=0,a=0;function s(e){(e=e||window.event).preventDefault(),i=n-e.clientX,o=a-e.clientY,n=e.clientX,a=e.clientY,t.style.top=t.offsetTop-o+"px",t.style.left=t.offsetLeft-i+"px"}function r(){document.onmouseup=null,document.onmousemove=null}Q("dialogHeader").onmousedown=function(e){(e=e||window.event).preventDefault(),n=e.clientX,a=e.clientY,document.onmouseup=r,document.onmousemove=s}}window.addEventListener("beforeunload",function(e){(null!=desktop&&11==xxcurrentView||null!=terminal&&12==xxcurrentView)&&(e.preventDefault(),e.returnValue="")})</script>